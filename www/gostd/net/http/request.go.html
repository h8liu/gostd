<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4784135">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4784190">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4784244">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4784295">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784333">package</span>&nbsp;<span class="ident" id="4784341">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784347">import</span>&nbsp;<span class="op" id="4784354">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784357">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784366">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784375">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784389">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784408">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784418">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784425">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784431">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784444">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784452">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784470">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784487">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784498">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784509">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4784520">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="4784527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784530">const</span>&nbsp;<span class="op" id="4784536">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784539">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4784556">=</span>&nbsp;<span class="num" id="4784558">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784564">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4784581">=</span>&nbsp;<span class="num" id="4784583">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784589">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4784606">=</span>&nbsp;<span class="num" id="4784608">4</span>&nbsp;<span class="op" id="4784610">&lt;&lt;</span>&nbsp;<span class="num" id="4784613">10</span>&nbsp;&nbsp;<span class="comment" id="4784617">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784633">defaultMaxMemory</span>&nbsp;<span class="op" id="4784650">=</span>&nbsp;<span class="num" id="4784652">32</span>&nbsp;<span class="op" id="4784655">&lt;&lt;</span>&nbsp;<span class="num" id="4784658">20</span>&nbsp;<span class="comment" id="4784661">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="4784670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4784673">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="4784749">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="4784810">var</span>&nbsp;<span class="ident" id="4784814">ErrMissingFile</span>&nbsp;<span class="op" id="4784829">=</span>&nbsp;<span class="ident" id="4784831">errors</span><span class="op" id="4784837">.</span><span class="ident" id="4784838">New</span><span class="op" id="4784841">(</span><span class="string" id="4784842">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="4784862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4784865">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="4784897">type</span>&nbsp;<span class="ident" id="4784902">ProtocolError</span>&nbsp;<span class="keyword" id="4784916">struct</span>&nbsp;<span class="op" id="4784923">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784926">ErrorString</span>&nbsp;<span class="builtintype" id="4784938">string</span><br>
<span class="lineno"></span><span class="op" id="4784945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784948">func</span>&nbsp;<span class="op" id="4784953">(</span><span class="ident" id="4784954">err</span>&nbsp;<span class="op" id="4784958">*</span><span class="ident" id="4784959">ProtocolError</span><span class="op" id="4784972">)</span>&nbsp;<span class="ident" id="4784974">Error</span><span class="op" id="4784979">(</span><span class="op" id="4784980">)</span>&nbsp;<span class="builtintype" id="4784982">string</span>&nbsp;<span class="op" id="4784989">{</span>&nbsp;<span class="keyword" id="4784991">return</span>&nbsp;<span class="ident" id="4784998">err</span><span class="op" id="4785001">.</span><span class="ident" id="4785002">ErrorString</span>&nbsp;<span class="op" id="4785014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4785017">var</span>&nbsp;<span class="op" id="4785021">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785024">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785048">=</span>&nbsp;<span class="op" id="4785050">&amp;</span><span class="ident" id="4785051">ProtocolError</span><span class="op" id="4785064">{</span><span class="string" id="4785065">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="4785082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785085">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785109">=</span>&nbsp;<span class="op" id="4785111">&amp;</span><span class="ident" id="4785112">ProtocolError</span><span class="op" id="4785125">{</span><span class="string" id="4785126">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="4785149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785152">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785176">=</span>&nbsp;<span class="op" id="4785178">&amp;</span><span class="ident" id="4785179">ProtocolError</span><span class="op" id="4785192">{</span><span class="string" id="4785193">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4785216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785219">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785243">=</span>&nbsp;<span class="op" id="4785245">&amp;</span><span class="ident" id="4785246">ProtocolError</span><span class="op" id="4785259">{</span><span class="string" id="4785260">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="4785310">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785313">ErrMissingContentLength</span>&nbsp;<span class="op" id="4785337">=</span>&nbsp;<span class="op" id="4785339">&amp;</span><span class="ident" id="4785340">ProtocolError</span><span class="op" id="4785353">{</span><span class="string" id="4785354">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="4785394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785397">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785421">=</span>&nbsp;<span class="op" id="4785423">&amp;</span><span class="ident" id="4785424">ProtocolError</span><span class="op" id="4785437">{</span><span class="string" id="4785438">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="4785486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785489">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4785513">=</span>&nbsp;<span class="op" id="4785515">&amp;</span><span class="ident" id="4785516">ProtocolError</span><span class="op" id="4785529">{</span><span class="string" id="4785530">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="4785575">}</span><br>
<span class="lineno"></span><span class="op" id="4785577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4785580">type</span>&nbsp;<span class="ident" id="4785585">badStringError</span>&nbsp;<span class="keyword" id="4785600">struct</span>&nbsp;<span class="op" id="4785607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785610">what</span>&nbsp;<span class="builtintype" id="4785615">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785623">str</span>&nbsp;&nbsp;<span class="builtintype" id="4785628">string</span><br>
<span class="lineno"></span><span class="op" id="4785635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4785638">func</span>&nbsp;<span class="op" id="4785643">(</span><span class="ident" id="4785644">e</span>&nbsp;<span class="op" id="4785646">*</span><span class="ident" id="4785647">badStringError</span><span class="op" id="4785661">)</span>&nbsp;<span class="ident" id="4785663">Error</span><span class="op" id="4785668">(</span><span class="op" id="4785669">)</span>&nbsp;<span class="builtintype" id="4785671">string</span>&nbsp;<span class="op" id="4785678">{</span>&nbsp;<span class="keyword" id="4785680">return</span>&nbsp;<span class="ident" id="4785687">fmt</span><span class="op" id="4785690">.</span><span class="ident" id="4785691">Sprintf</span><span class="op" id="4785698">(</span><span class="string" id="4785699">&#34;%s&nbsp;%q&#34;</span><span class="op" id="4785706">,</span>&nbsp;<span class="ident" id="4785708">e</span><span class="op" id="4785709">.</span><span class="ident" id="4785710">what</span><span class="op" id="4785714">,</span>&nbsp;<span class="ident" id="4785716">e</span><span class="op" id="4785717">.</span><span class="ident" id="4785718">str</span><span class="op" id="4785721">)</span>&nbsp;<span class="op" id="4785723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4785726">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="4785794">var</span>&nbsp;<span class="ident" id="4785798">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="4785820">=</span>&nbsp;<span class="keyword" id="4785822">map</span><span class="op" id="4785825">[</span><span class="builtintype" id="4785826">string</span><span class="op" id="4785832">]</span><span class="builtintype" id="4785833">bool</span><span class="op" id="4785837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785840">&#34;Host&#34;</span><span class="op" id="4785846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4785861">true</span><span class="op" id="4785865">,</span>&nbsp;<span class="comment" id="4785867">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785896">&#34;User-Agent&#34;</span><span class="op" id="4785908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4785917">true</span><span class="op" id="4785921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785924">&#34;Content-Length&#34;</span><span class="op" id="4785940">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4785945">true</span><span class="op" id="4785949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785952">&#34;Transfer-Encoding&#34;</span><span class="op" id="4785971">:</span>&nbsp;<span class="builtintype" id="4785973">true</span><span class="op" id="4785977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785980">&#34;Trailer&#34;</span><span class="op" id="4785989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4786001">true</span><span class="op" id="4786005">,</span><br>
<span class="lineno"></span><span class="op" id="4786007">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4786010">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4786071">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="4786101">//</span><br>
<span class="lineno"></span><span class="comment" id="4786104">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="4786169">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4786233">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="4786286">type</span>&nbsp;<span class="ident" id="4786291">Request</span>&nbsp;<span class="keyword" id="4786299">struct</span>&nbsp;<span class="op" id="4786306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786309">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786370">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786421">Method</span>&nbsp;<span class="builtintype" id="4786428">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786437">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786498">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786556">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786560">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786615">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786678">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786741">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786782">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786786">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786850">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786908">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786964">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786977">URL</span>&nbsp;<span class="op" id="4786981">*</span><span class="ident" id="4786982">url</span><span class="op" id="4786985">.</span><span class="ident" id="4786986">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786992">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787040">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787081">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4787092">string</span>&nbsp;<span class="comment" id="4787099">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787114">ProtoMajor</span>&nbsp;<span class="builtintype" id="4787125">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787132">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787138">ProtoMinor</span>&nbsp;<span class="builtintype" id="4787149">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787156">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787163">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787212">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787235">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787239">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787274">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787301">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787328">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787332">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787341">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787345">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787379">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787422">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787457">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787492">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787498">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787502">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787559">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787620">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787676">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787733">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787737">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787795">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787840">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787844">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787900">Header</span>&nbsp;<span class="ident" id="4787907">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787916">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787948">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787952">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788012">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788073">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788122">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788126">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788185">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788246">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788304">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788334">Body</span>&nbsp;<span class="ident" id="4788339">io</span><span class="op" id="4788341">.</span><span class="ident" id="4788342">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788355">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788419">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788474">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788534">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788557">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788629">ContentLength</span>&nbsp;<span class="ident" id="4788643">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788651">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788719">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788781">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788846">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788912">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788936">TransferEncoding</span>&nbsp;<span class="op" id="4788953">[</span><span class="op" id="4788954">]</span><span class="builtintype" id="4788955">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788964">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789022">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789082">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789113">Close</span>&nbsp;<span class="builtintype" id="4789119">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789126">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789187">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789248">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789312">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789351">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789355">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789414">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789474">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789501">Host</span>&nbsp;<span class="builtintype" id="4789506">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789515">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789578">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789638">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789698">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789754">Form</span>&nbsp;<span class="ident" id="4789759">url</span><span class="op" id="4789762">.</span><span class="ident" id="4789763">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789772">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789832">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789853">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789913">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789973">PostForm</span>&nbsp;<span class="ident" id="4789982">url</span><span class="op" id="4789985">.</span><span class="ident" id="4789986">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789995">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790067">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790136">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790201">MultipartForm</span>&nbsp;<span class="op" id="4790215">*</span><span class="ident" id="4790216">multipart</span><span class="op" id="4790225">.</span><span class="ident" id="4790226">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790233">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790306">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790316">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790320">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790388">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790462">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790533">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790605">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790678">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790697">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790701">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790773">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790846">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790920">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790991">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791064">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791088">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791092">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791157">Trailer</span>&nbsp;<span class="ident" id="4791165">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791174">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791238">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791297">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791357">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791416">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791478">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791491">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791537">RemoteAddr</span>&nbsp;<span class="builtintype" id="4791548">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791557">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791609">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791672">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791735">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791799">RequestURI</span>&nbsp;<span class="builtintype" id="4791810">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791819">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791876">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791938">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792000">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792055">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792110">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792149">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792195">TLS</span>&nbsp;<span class="op" id="4792199">*</span><span class="ident" id="4792200">tls</span><span class="op" id="4792203">.</span><span class="ident" id="4792204">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="4792220">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4792223">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4792278">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="4792321">func</span>&nbsp;<span class="op" id="4792326">(</span><span class="ident" id="4792327">r</span>&nbsp;<span class="op" id="4792329">*</span><span class="ident" id="4792330">Request</span><span class="op" id="4792337">)</span>&nbsp;<span class="ident" id="4792339">ProtoAtLeast</span><span class="op" id="4792351">(</span><span class="ident" id="4792352">major</span><span class="op" id="4792357">,</span>&nbsp;<span class="ident" id="4792359">minor</span>&nbsp;<span class="builtintype" id="4792365">int</span><span class="op" id="4792368">)</span>&nbsp;<span class="builtintype" id="4792370">bool</span>&nbsp;<span class="op" id="4792375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792378">return</span>&nbsp;<span class="ident" id="4792385">r</span><span class="op" id="4792386">.</span><span class="ident" id="4792387">ProtoMajor</span>&nbsp;<span class="op" id="4792398">&gt;</span>&nbsp;<span class="ident" id="4792400">major</span>&nbsp;<span class="op" id="4792406">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792411">r</span><span class="op" id="4792412">.</span><span class="ident" id="4792413">ProtoMajor</span>&nbsp;<span class="op" id="4792424">==</span>&nbsp;<span class="ident" id="4792427">major</span>&nbsp;<span class="op" id="4792433">&amp;&amp;</span>&nbsp;<span class="ident" id="4792436">r</span><span class="op" id="4792437">.</span><span class="ident" id="4792438">ProtoMinor</span>&nbsp;<span class="op" id="4792449">&gt;=</span>&nbsp;<span class="ident" id="4792452">minor</span><br>
<span class="lineno"></span><span class="op" id="4792458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4792461">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="4792531">func</span>&nbsp;<span class="op" id="4792536">(</span><span class="ident" id="4792537">r</span>&nbsp;<span class="op" id="4792539">*</span><span class="ident" id="4792540">Request</span><span class="op" id="4792547">)</span>&nbsp;<span class="ident" id="4792549">UserAgent</span><span class="op" id="4792558">(</span><span class="op" id="4792559">)</span>&nbsp;<span class="builtintype" id="4792561">string</span>&nbsp;<span class="op" id="4792568">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792571">return</span>&nbsp;<span class="ident" id="4792578">r</span><span class="op" id="4792579">.</span><span class="ident" id="4792580">Header</span><span class="op" id="4792586">.</span><span class="ident" id="4792587">Get</span><span class="op" id="4792590">(</span><span class="string" id="4792591">&#34;User-Agent&#34;</span><span class="op" id="4792603">)</span><br>
<span class="lineno"></span><span class="op" id="4792605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4792608">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="4792678">func</span>&nbsp;<span class="op" id="4792683">(</span><span class="ident" id="4792684">r</span>&nbsp;<span class="op" id="4792686">*</span><span class="ident" id="4792687">Request</span><span class="op" id="4792694">)</span>&nbsp;<span class="ident" id="4792696">Cookies</span><span class="op" id="4792703">(</span><span class="op" id="4792704">)</span>&nbsp;<span class="op" id="4792706">[</span><span class="op" id="4792707">]</span><span class="op" id="4792708">*</span><span class="ident" id="4792709">Cookie</span>&nbsp;<span class="op" id="4792716">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792719">return</span>&nbsp;<span class="ident" id="4792726">readCookies</span><span class="op" id="4792737">(</span><span class="ident" id="4792738">r</span><span class="op" id="4792739">.</span><span class="ident" id="4792740">Header</span><span class="op" id="4792746">,</span>&nbsp;<span class="string" id="4792748">&#34;&#34;</span><span class="op" id="4792750">)</span><br>
<span class="lineno"></span><span class="op" id="4792752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4792755">var</span>&nbsp;<span class="ident" id="4792759">ErrNoCookie</span>&nbsp;<span class="op" id="4792771">=</span>&nbsp;<span class="ident" id="4792773">errors</span><span class="op" id="4792779">.</span><span class="ident" id="4792780">New</span><span class="op" id="4792783">(</span><span class="string" id="4792784">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="4792816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="4792819">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4792881">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4792910">func</span>&nbsp;<span class="op" id="4792915">(</span><span class="ident" id="4792916">r</span>&nbsp;<span class="op" id="4792918">*</span><span class="ident" id="4792919">Request</span><span class="op" id="4792926">)</span>&nbsp;<span class="ident" id="4792928">Cookie</span><span class="op" id="4792934">(</span><span class="ident" id="4792935">name</span>&nbsp;<span class="builtintype" id="4792940">string</span><span class="op" id="4792946">)</span>&nbsp;<span class="op" id="4792948">(</span><span class="op" id="4792949">*</span><span class="ident" id="4792950">Cookie</span><span class="op" id="4792956">,</span>&nbsp;<span class="builtintype" id="4792958">error</span><span class="op" id="4792963">)</span>&nbsp;<span class="op" id="4792965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792968">for</span>&nbsp;<span class="ident" id="4792972">_</span><span class="op" id="4792973">,</span>&nbsp;<span class="ident" id="4792975">c</span>&nbsp;<span class="op" id="4792977">:=</span>&nbsp;<span class="keyword" id="4792980">range</span>&nbsp;<span class="ident" id="4792986">readCookies</span><span class="op" id="4792997">(</span><span class="ident" id="4792998">r</span><span class="op" id="4792999">.</span><span class="ident" id="4793000">Header</span><span class="op" id="4793006">,</span>&nbsp;<span class="ident" id="4793008">name</span><span class="op" id="4793012">)</span>&nbsp;<span class="op" id="4793014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793018">return</span>&nbsp;<span class="ident" id="4793025">c</span><span class="op" id="4793026">,</span>&nbsp;<span class="ident" id="4793028">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793036">return</span>&nbsp;<span class="ident" id="4793043">nil</span><span class="op" id="4793046">,</span>&nbsp;<span class="ident" id="4793048">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="4793060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4793063">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="4793133">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="4793203">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="4793265">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="4793292">func</span>&nbsp;<span class="op" id="4793297">(</span><span class="ident" id="4793298">r</span>&nbsp;<span class="op" id="4793300">*</span><span class="ident" id="4793301">Request</span><span class="op" id="4793308">)</span>&nbsp;<span class="ident" id="4793310">AddCookie</span><span class="op" id="4793319">(</span><span class="ident" id="4793320">c</span>&nbsp;<span class="op" id="4793322">*</span><span class="ident" id="4793323">Cookie</span><span class="op" id="4793329">)</span>&nbsp;<span class="op" id="4793331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793334">s</span>&nbsp;<span class="op" id="4793336">:=</span>&nbsp;<span class="ident" id="4793339">fmt</span><span class="op" id="4793342">.</span><span class="ident" id="4793343">Sprintf</span><span class="op" id="4793350">(</span><span class="string" id="4793351">&#34;%s=%s&#34;</span><span class="op" id="4793358">,</span>&nbsp;<span class="ident" id="4793360">sanitizeCookieName</span><span class="op" id="4793378">(</span><span class="ident" id="4793379">c</span><span class="op" id="4793380">.</span><span class="ident" id="4793381">Name</span><span class="op" id="4793385">)</span><span class="op" id="4793386">,</span>&nbsp;<span class="ident" id="4793388">sanitizeCookieValue</span><span class="op" id="4793407">(</span><span class="ident" id="4793408">c</span><span class="op" id="4793409">.</span><span class="ident" id="4793410">Value</span><span class="op" id="4793415">)</span><span class="op" id="4793416">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793419">if</span>&nbsp;<span class="ident" id="4793422">c</span>&nbsp;<span class="op" id="4793424">:=</span>&nbsp;<span class="ident" id="4793427">r</span><span class="op" id="4793428">.</span><span class="ident" id="4793429">Header</span><span class="op" id="4793435">.</span><span class="ident" id="4793436">Get</span><span class="op" id="4793439">(</span><span class="string" id="4793440">&#34;Cookie&#34;</span><span class="op" id="4793448">)</span><span class="op" id="4793449">;</span>&nbsp;<span class="ident" id="4793451">c</span>&nbsp;<span class="op" id="4793453">!=</span>&nbsp;<span class="string" id="4793456">&#34;&#34;</span>&nbsp;<span class="op" id="4793459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793463">r</span><span class="op" id="4793464">.</span><span class="ident" id="4793465">Header</span><span class="op" id="4793471">.</span><span class="ident" id="4793472">Set</span><span class="op" id="4793475">(</span><span class="string" id="4793476">&#34;Cookie&#34;</span><span class="op" id="4793484">,</span>&nbsp;<span class="ident" id="4793486">c</span><span class="op" id="4793487">+</span><span class="string" id="4793488">&#34;;&nbsp;&#34;</span><span class="op" id="4793492">+</span><span class="ident" id="4793493">s</span><span class="op" id="4793494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793497">}</span>&nbsp;<span class="keyword" id="4793499">else</span>&nbsp;<span class="op" id="4793504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793508">r</span><span class="op" id="4793509">.</span><span class="ident" id="4793510">Header</span><span class="op" id="4793516">.</span><span class="ident" id="4793517">Set</span><span class="op" id="4793520">(</span><span class="string" id="4793521">&#34;Cookie&#34;</span><span class="op" id="4793529">,</span>&nbsp;<span class="ident" id="4793531">s</span><span class="op" id="4793532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793535">}</span><br>
<span class="lineno">270</span><span class="op" id="4793537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4793540">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4793602">//</span><br>
<span class="lineno"></span><span class="comment" id="4793605">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="4793675">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4793742">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="4793813">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4793884">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="4793950">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="4794000">func</span>&nbsp;<span class="op" id="4794005">(</span><span class="ident" id="4794006">r</span>&nbsp;<span class="op" id="4794008">*</span><span class="ident" id="4794009">Request</span><span class="op" id="4794016">)</span>&nbsp;<span class="ident" id="4794018">Referer</span><span class="op" id="4794025">(</span><span class="op" id="4794026">)</span>&nbsp;<span class="builtintype" id="4794028">string</span>&nbsp;<span class="op" id="4794035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794038">return</span>&nbsp;<span class="ident" id="4794045">r</span><span class="op" id="4794046">.</span><span class="ident" id="4794047">Header</span><span class="op" id="4794053">.</span><span class="ident" id="4794054">Get</span><span class="op" id="4794057">(</span><span class="string" id="4794058">&#34;Referer&#34;</span><span class="op" id="4794067">)</span><br>
<span class="lineno"></span><span class="op" id="4794069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794072">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="4794114">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="4794193">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="4794273">var</span>&nbsp;<span class="ident" id="4794277">multipartByReader</span>&nbsp;<span class="op" id="4794295">=</span>&nbsp;<span class="op" id="4794297">&amp;</span><span class="ident" id="4794298">multipart</span><span class="op" id="4794307">.</span><span class="ident" id="4794308">Form</span><span class="op" id="4794312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794315">Value</span><span class="op" id="4794320">:</span>&nbsp;<span class="builtinfunc" id="4794322">make</span><span class="op" id="4794326">(</span><span class="keyword" id="4794327">map</span><span class="op" id="4794330">[</span><span class="builtintype" id="4794331">string</span><span class="op" id="4794337">]</span><span class="op" id="4794338">[</span><span class="op" id="4794339">]</span><span class="builtintype" id="4794340">string</span><span class="op" id="4794346">)</span><span class="op" id="4794347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794350">File</span><span class="op" id="4794354">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4794357">make</span><span class="op" id="4794361">(</span><span class="keyword" id="4794362">map</span><span class="op" id="4794365">[</span><span class="builtintype" id="4794366">string</span><span class="op" id="4794372">]</span><span class="op" id="4794373">[</span><span class="op" id="4794374">]</span><span class="op" id="4794375">*</span><span class="ident" id="4794376">multipart</span><span class="op" id="4794385">.</span><span class="ident" id="4794386">FileHeader</span><span class="op" id="4794396">)</span><span class="op" id="4794397">,</span><br>
<span class="lineno">290</span><span class="op" id="4794399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794402">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4794466">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4794534">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="4794588">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4794629">func</span>&nbsp;<span class="op" id="4794634">(</span><span class="ident" id="4794635">r</span>&nbsp;<span class="op" id="4794637">*</span><span class="ident" id="4794638">Request</span><span class="op" id="4794645">)</span>&nbsp;<span class="ident" id="4794647">MultipartReader</span><span class="op" id="4794662">(</span><span class="op" id="4794663">)</span>&nbsp;<span class="op" id="4794665">(</span><span class="op" id="4794666">*</span><span class="ident" id="4794667">multipart</span><span class="op" id="4794676">.</span><span class="ident" id="4794677">Reader</span><span class="op" id="4794683">,</span>&nbsp;<span class="builtintype" id="4794685">error</span><span class="op" id="4794690">)</span>&nbsp;<span class="op" id="4794692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794695">if</span>&nbsp;<span class="ident" id="4794698">r</span><span class="op" id="4794699">.</span><span class="ident" id="4794700">MultipartForm</span>&nbsp;<span class="op" id="4794714">==</span>&nbsp;<span class="ident" id="4794717">multipartByReader</span>&nbsp;<span class="op" id="4794735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794739">return</span>&nbsp;<span class="ident" id="4794746">nil</span><span class="op" id="4794749">,</span>&nbsp;<span class="ident" id="4794751">errors</span><span class="op" id="4794757">.</span><span class="ident" id="4794758">New</span><span class="op" id="4794761">(</span><span class="string" id="4794762">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="4794798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794801">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794804">if</span>&nbsp;<span class="ident" id="4794807">r</span><span class="op" id="4794808">.</span><span class="ident" id="4794809">MultipartForm</span>&nbsp;<span class="op" id="4794823">!=</span>&nbsp;<span class="ident" id="4794826">nil</span>&nbsp;<span class="op" id="4794830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794834">return</span>&nbsp;<span class="ident" id="4794841">nil</span><span class="op" id="4794844">,</span>&nbsp;<span class="ident" id="4794846">errors</span><span class="op" id="4794852">.</span><span class="ident" id="4794853">New</span><span class="op" id="4794856">(</span><span class="string" id="4794857">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="4794904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794910">r</span><span class="op" id="4794911">.</span><span class="ident" id="4794912">MultipartForm</span>&nbsp;<span class="op" id="4794926">=</span>&nbsp;<span class="ident" id="4794928">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794947">return</span>&nbsp;<span class="ident" id="4794954">r</span><span class="op" id="4794955">.</span><span class="ident" id="4794956">multipartReader</span><span class="op" id="4794971">(</span><span class="op" id="4794972">)</span><br>
<span class="lineno">305</span><span class="op" id="4794974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794977">func</span>&nbsp;<span class="op" id="4794982">(</span><span class="ident" id="4794983">r</span>&nbsp;<span class="op" id="4794985">*</span><span class="ident" id="4794986">Request</span><span class="op" id="4794993">)</span>&nbsp;<span class="ident" id="4794995">multipartReader</span><span class="op" id="4795010">(</span><span class="op" id="4795011">)</span>&nbsp;<span class="op" id="4795013">(</span><span class="op" id="4795014">*</span><span class="ident" id="4795015">multipart</span><span class="op" id="4795024">.</span><span class="ident" id="4795025">Reader</span><span class="op" id="4795031">,</span>&nbsp;<span class="builtintype" id="4795033">error</span><span class="op" id="4795038">)</span>&nbsp;<span class="op" id="4795040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795043">v</span>&nbsp;<span class="op" id="4795045">:=</span>&nbsp;<span class="ident" id="4795048">r</span><span class="op" id="4795049">.</span><span class="ident" id="4795050">Header</span><span class="op" id="4795056">.</span><span class="ident" id="4795057">Get</span><span class="op" id="4795060">(</span><span class="string" id="4795061">&#34;Content-Type&#34;</span><span class="op" id="4795075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795078">if</span>&nbsp;<span class="ident" id="4795081">v</span>&nbsp;<span class="op" id="4795083">==</span>&nbsp;<span class="string" id="4795086">&#34;&#34;</span>&nbsp;<span class="op" id="4795089">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795093">return</span>&nbsp;<span class="ident" id="4795100">nil</span><span class="op" id="4795103">,</span>&nbsp;<span class="ident" id="4795105">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4795122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795125">d</span><span class="op" id="4795126">,</span>&nbsp;<span class="ident" id="4795128">params</span><span class="op" id="4795134">,</span>&nbsp;<span class="ident" id="4795136">err</span>&nbsp;<span class="op" id="4795140">:=</span>&nbsp;<span class="ident" id="4795143">mime</span><span class="op" id="4795147">.</span><span class="ident" id="4795148">ParseMediaType</span><span class="op" id="4795162">(</span><span class="ident" id="4795163">v</span><span class="op" id="4795164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795167">if</span>&nbsp;<span class="ident" id="4795170">err</span>&nbsp;<span class="op" id="4795174">!=</span>&nbsp;<span class="ident" id="4795177">nil</span>&nbsp;<span class="op" id="4795181">||</span>&nbsp;<span class="ident" id="4795184">d</span>&nbsp;<span class="op" id="4795186">!=</span>&nbsp;<span class="string" id="4795189">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="4795211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795215">return</span>&nbsp;<span class="ident" id="4795222">nil</span><span class="op" id="4795225">,</span>&nbsp;<span class="ident" id="4795227">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4795244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795247">boundary</span><span class="op" id="4795255">,</span>&nbsp;<span class="ident" id="4795257">ok</span>&nbsp;<span class="op" id="4795260">:=</span>&nbsp;<span class="ident" id="4795263">params</span><span class="op" id="4795269">[</span><span class="string" id="4795270">&#34;boundary&#34;</span><span class="op" id="4795280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795283">if</span>&nbsp;<span class="op" id="4795286">!</span><span class="ident" id="4795287">ok</span>&nbsp;<span class="op" id="4795290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795294">return</span>&nbsp;<span class="ident" id="4795301">nil</span><span class="op" id="4795304">,</span>&nbsp;<span class="ident" id="4795306">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4795326">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795329">return</span>&nbsp;<span class="ident" id="4795336">multipart</span><span class="op" id="4795345">.</span><span class="ident" id="4795346">NewReader</span><span class="op" id="4795355">(</span><span class="ident" id="4795356">r</span><span class="op" id="4795357">.</span><span class="ident" id="4795358">Body</span><span class="op" id="4795362">,</span>&nbsp;<span class="ident" id="4795364">boundary</span><span class="op" id="4795372">)</span><span class="op" id="4795373">,</span>&nbsp;<span class="ident" id="4795375">nil</span><br>
<span class="lineno"></span><span class="op" id="4795379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4795382">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4795426">func</span>&nbsp;<span class="ident" id="4795431">valueOrDefault</span><span class="op" id="4795445">(</span><span class="ident" id="4795446">value</span><span class="op" id="4795451">,</span>&nbsp;<span class="ident" id="4795453">def</span>&nbsp;<span class="builtintype" id="4795457">string</span><span class="op" id="4795463">)</span>&nbsp;<span class="builtintype" id="4795465">string</span>&nbsp;<span class="op" id="4795472">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795475">if</span>&nbsp;<span class="ident" id="4795478">value</span>&nbsp;<span class="op" id="4795484">!=</span>&nbsp;<span class="string" id="4795487">&#34;&#34;</span>&nbsp;<span class="op" id="4795490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795494">return</span>&nbsp;<span class="ident" id="4795501">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4795508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795511">return</span>&nbsp;<span class="ident" id="4795518">def</span><br>
<span class="lineno"></span><span class="op" id="4795522">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4795525">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="4795600">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4795673">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4795746">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="4795802">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="4795849">const</span>&nbsp;<span class="ident" id="4795855">defaultUserAgent</span>&nbsp;<span class="op" id="4795872">=</span>&nbsp;<span class="string" id="4795874">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4795897">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="4795971">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="4796032">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="4796040">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="4796047">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4796077">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="4796087">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="4796104">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4796124">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="4796132">//</span><br>
<span class="lineno"></span><span class="comment" id="4796135">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4796202">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="4796267">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4796327">func</span>&nbsp;<span class="op" id="4796332">(</span><span class="ident" id="4796333">r</span>&nbsp;<span class="op" id="4796335">*</span><span class="ident" id="4796336">Request</span><span class="op" id="4796343">)</span>&nbsp;<span class="ident" id="4796345">Write</span><span class="op" id="4796350">(</span><span class="ident" id="4796351">w</span>&nbsp;<span class="ident" id="4796353">io</span><span class="op" id="4796355">.</span><span class="ident" id="4796356">Writer</span><span class="op" id="4796362">)</span>&nbsp;<span class="builtintype" id="4796364">error</span>&nbsp;<span class="op" id="4796370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796373">return</span>&nbsp;<span class="ident" id="4796380">r</span><span class="op" id="4796381">.</span><span class="ident" id="4796382">write</span><span class="op" id="4796387">(</span><span class="ident" id="4796388">w</span><span class="op" id="4796389">,</span>&nbsp;<span class="builtintype" id="4796391">false</span><span class="op" id="4796396">,</span>&nbsp;<span class="ident" id="4796398">nil</span><span class="op" id="4796401">)</span><br>
<span class="lineno"></span><span class="op" id="4796403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="4796406">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4796469">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4796537">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="4796606">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4796667">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="4796730">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="4796762">func</span>&nbsp;<span class="op" id="4796767">(</span><span class="ident" id="4796768">r</span>&nbsp;<span class="op" id="4796770">*</span><span class="ident" id="4796771">Request</span><span class="op" id="4796778">)</span>&nbsp;<span class="ident" id="4796780">WriteProxy</span><span class="op" id="4796790">(</span><span class="ident" id="4796791">w</span>&nbsp;<span class="ident" id="4796793">io</span><span class="op" id="4796795">.</span><span class="ident" id="4796796">Writer</span><span class="op" id="4796802">)</span>&nbsp;<span class="builtintype" id="4796804">error</span>&nbsp;<span class="op" id="4796810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796813">return</span>&nbsp;<span class="ident" id="4796820">r</span><span class="op" id="4796821">.</span><span class="ident" id="4796822">write</span><span class="op" id="4796827">(</span><span class="ident" id="4796828">w</span><span class="op" id="4796829">,</span>&nbsp;<span class="builtintype" id="4796831">true</span><span class="op" id="4796835">,</span>&nbsp;<span class="ident" id="4796837">nil</span><span class="op" id="4796840">)</span><br>
<span class="lineno"></span><span class="op" id="4796842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4796845">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="4796872">func</span>&nbsp;<span class="op" id="4796877">(</span><span class="ident" id="4796878">req</span>&nbsp;<span class="op" id="4796882">*</span><span class="ident" id="4796883">Request</span><span class="op" id="4796890">)</span>&nbsp;<span class="ident" id="4796892">write</span><span class="op" id="4796897">(</span><span class="ident" id="4796898">w</span>&nbsp;<span class="ident" id="4796900">io</span><span class="op" id="4796902">.</span><span class="ident" id="4796903">Writer</span><span class="op" id="4796909">,</span>&nbsp;<span class="ident" id="4796911">usingProxy</span>&nbsp;<span class="builtintype" id="4796922">bool</span><span class="op" id="4796926">,</span>&nbsp;<span class="ident" id="4796928">extraHeaders</span>&nbsp;<span class="ident" id="4796941">Header</span><span class="op" id="4796947">)</span>&nbsp;<span class="builtintype" id="4796949">error</span>&nbsp;<span class="op" id="4796955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796958">host</span>&nbsp;<span class="op" id="4796963">:=</span>&nbsp;<span class="ident" id="4796966">req</span><span class="op" id="4796969">.</span><span class="ident" id="4796970">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796976">if</span>&nbsp;<span class="ident" id="4796979">host</span>&nbsp;<span class="op" id="4796984">==</span>&nbsp;<span class="string" id="4796987">&#34;&#34;</span>&nbsp;<span class="op" id="4796990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796994">if</span>&nbsp;<span class="ident" id="4796997">req</span><span class="op" id="4797000">.</span><span class="ident" id="4797001">URL</span>&nbsp;<span class="op" id="4797005">==</span>&nbsp;<span class="ident" id="4797008">nil</span>&nbsp;<span class="op" id="4797012">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797017">return</span>&nbsp;<span class="ident" id="4797024">errors</span><span class="op" id="4797030">.</span><span class="ident" id="4797031">New</span><span class="op" id="4797034">(</span><span class="string" id="4797035">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="4797091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797099">host</span>&nbsp;<span class="op" id="4797104">=</span>&nbsp;<span class="ident" id="4797106">req</span><span class="op" id="4797109">.</span><span class="ident" id="4797110">URL</span><span class="op" id="4797113">.</span><span class="ident" id="4797114">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797124">ruri</span>&nbsp;<span class="op" id="4797129">:=</span>&nbsp;<span class="ident" id="4797132">req</span><span class="op" id="4797135">.</span><span class="ident" id="4797136">URL</span><span class="op" id="4797139">.</span><span class="ident" id="4797140">RequestURI</span><span class="op" id="4797150">(</span><span class="op" id="4797151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797154">if</span>&nbsp;<span class="ident" id="4797157">usingProxy</span>&nbsp;<span class="op" id="4797168">&amp;&amp;</span>&nbsp;<span class="ident" id="4797171">req</span><span class="op" id="4797174">.</span><span class="ident" id="4797175">URL</span><span class="op" id="4797178">.</span><span class="ident" id="4797179">Scheme</span>&nbsp;<span class="op" id="4797186">!=</span>&nbsp;<span class="string" id="4797189">&#34;&#34;</span>&nbsp;<span class="op" id="4797192">&amp;&amp;</span>&nbsp;<span class="ident" id="4797195">req</span><span class="op" id="4797198">.</span><span class="ident" id="4797199">URL</span><span class="op" id="4797202">.</span><span class="ident" id="4797203">Opaque</span>&nbsp;<span class="op" id="4797210">==</span>&nbsp;<span class="string" id="4797213">&#34;&#34;</span>&nbsp;<span class="op" id="4797216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797220">ruri</span>&nbsp;<span class="op" id="4797225">=</span>&nbsp;<span class="ident" id="4797227">req</span><span class="op" id="4797230">.</span><span class="ident" id="4797231">URL</span><span class="op" id="4797234">.</span><span class="ident" id="4797235">Scheme</span>&nbsp;<span class="op" id="4797242">+</span>&nbsp;<span class="string" id="4797244">&#34;://&#34;</span>&nbsp;<span class="op" id="4797250">+</span>&nbsp;<span class="ident" id="4797252">host</span>&nbsp;<span class="op" id="4797257">+</span>&nbsp;<span class="ident" id="4797259">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797265">}</span>&nbsp;<span class="keyword" id="4797267">else</span>&nbsp;<span class="keyword" id="4797272">if</span>&nbsp;<span class="ident" id="4797275">req</span><span class="op" id="4797278">.</span><span class="ident" id="4797279">Method</span>&nbsp;<span class="op" id="4797286">==</span>&nbsp;<span class="string" id="4797289">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4797299">&amp;&amp;</span>&nbsp;<span class="ident" id="4797302">req</span><span class="op" id="4797305">.</span><span class="ident" id="4797306">URL</span><span class="op" id="4797309">.</span><span class="ident" id="4797310">Path</span>&nbsp;<span class="op" id="4797315">==</span>&nbsp;<span class="string" id="4797318">&#34;&#34;</span>&nbsp;<span class="op" id="4797321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797325">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797401">ruri</span>&nbsp;<span class="op" id="4797406">=</span>&nbsp;<span class="ident" id="4797408">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797417">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797472">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797540">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797603">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797665">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797675">var</span>&nbsp;<span class="ident" id="4797679">bw</span>&nbsp;<span class="op" id="4797682">*</span><span class="ident" id="4797683">bufio</span><span class="op" id="4797688">.</span><span class="ident" id="4797689">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797697">if</span>&nbsp;<span class="ident" id="4797700">_</span><span class="op" id="4797701">,</span>&nbsp;<span class="ident" id="4797703">ok</span>&nbsp;<span class="op" id="4797706">:=</span>&nbsp;<span class="ident" id="4797709">w</span><span class="op" id="4797710">.</span><span class="op" id="4797711">(</span><span class="ident" id="4797712">io</span><span class="op" id="4797714">.</span><span class="ident" id="4797715">ByteWriter</span><span class="op" id="4797725">)</span><span class="op" id="4797726">;</span>&nbsp;<span class="op" id="4797728">!</span><span class="ident" id="4797729">ok</span>&nbsp;<span class="op" id="4797732">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797736">bw</span>&nbsp;<span class="op" id="4797739">=</span>&nbsp;<span class="ident" id="4797741">bufio</span><span class="op" id="4797746">.</span><span class="ident" id="4797747">NewWriter</span><span class="op" id="4797756">(</span><span class="ident" id="4797757">w</span><span class="op" id="4797758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797762">w</span>&nbsp;<span class="op" id="4797764">=</span>&nbsp;<span class="ident" id="4797766">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797774">_</span><span class="op" id="4797775">,</span>&nbsp;<span class="ident" id="4797777">err</span>&nbsp;<span class="op" id="4797781">:=</span>&nbsp;<span class="ident" id="4797784">fmt</span><span class="op" id="4797787">.</span><span class="ident" id="4797788">Fprintf</span><span class="op" id="4797795">(</span><span class="ident" id="4797796">w</span><span class="op" id="4797797">,</span>&nbsp;<span class="string" id="4797799">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="4797819">,</span>&nbsp;<span class="ident" id="4797821">valueOrDefault</span><span class="op" id="4797835">(</span><span class="ident" id="4797836">req</span><span class="op" id="4797839">.</span><span class="ident" id="4797840">Method</span><span class="op" id="4797846">,</span>&nbsp;<span class="string" id="4797848">&#34;GET&#34;</span><span class="op" id="4797853">)</span><span class="op" id="4797854">,</span>&nbsp;<span class="ident" id="4797856">ruri</span><span class="op" id="4797860">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797863">if</span>&nbsp;<span class="ident" id="4797866">err</span>&nbsp;<span class="op" id="4797870">!=</span>&nbsp;<span class="ident" id="4797873">nil</span>&nbsp;<span class="op" id="4797877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797881">return</span>&nbsp;<span class="ident" id="4797888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797897">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797914">_</span><span class="op" id="4797915">,</span>&nbsp;<span class="ident" id="4797917">err</span>&nbsp;<span class="op" id="4797921">=</span>&nbsp;<span class="ident" id="4797923">fmt</span><span class="op" id="4797926">.</span><span class="ident" id="4797927">Fprintf</span><span class="op" id="4797934">(</span><span class="ident" id="4797935">w</span><span class="op" id="4797936">,</span>&nbsp;<span class="string" id="4797938">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="4797952">,</span>&nbsp;<span class="ident" id="4797954">host</span><span class="op" id="4797958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797961">if</span>&nbsp;<span class="ident" id="4797964">err</span>&nbsp;<span class="op" id="4797968">!=</span>&nbsp;<span class="ident" id="4797971">nil</span>&nbsp;<span class="op" id="4797975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797979">return</span>&nbsp;<span class="ident" id="4797986">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797995">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798062">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798103">userAgent</span>&nbsp;<span class="op" id="4798113">:=</span>&nbsp;<span class="ident" id="4798116">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798134">if</span>&nbsp;<span class="ident" id="4798137">req</span><span class="op" id="4798140">.</span><span class="ident" id="4798141">Header</span>&nbsp;<span class="op" id="4798148">!=</span>&nbsp;<span class="ident" id="4798151">nil</span>&nbsp;<span class="op" id="4798155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798159">if</span>&nbsp;<span class="ident" id="4798162">ua</span>&nbsp;<span class="op" id="4798165">:=</span>&nbsp;<span class="ident" id="4798168">req</span><span class="op" id="4798171">.</span><span class="ident" id="4798172">Header</span><span class="op" id="4798178">[</span><span class="string" id="4798179">&#34;User-Agent&#34;</span><span class="op" id="4798191">]</span><span class="op" id="4798192">;</span>&nbsp;<span class="builtinfunc" id="4798194">len</span><span class="op" id="4798197">(</span><span class="ident" id="4798198">ua</span><span class="op" id="4798200">)</span>&nbsp;<span class="op" id="4798202">&gt;</span>&nbsp;<span class="num" id="4798204">0</span>&nbsp;<span class="op" id="4798206">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798211">userAgent</span>&nbsp;<span class="op" id="4798221">=</span>&nbsp;<span class="ident" id="4798223">ua</span><span class="op" id="4798225">[</span><span class="num" id="4798226">0</span><span class="op" id="4798227">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798237">if</span>&nbsp;<span class="ident" id="4798240">userAgent</span>&nbsp;<span class="op" id="4798250">!=</span>&nbsp;<span class="string" id="4798253">&#34;&#34;</span>&nbsp;<span class="op" id="4798256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798260">_</span><span class="op" id="4798261">,</span>&nbsp;<span class="ident" id="4798263">err</span>&nbsp;<span class="op" id="4798267">=</span>&nbsp;<span class="ident" id="4798269">fmt</span><span class="op" id="4798272">.</span><span class="ident" id="4798273">Fprintf</span><span class="op" id="4798280">(</span><span class="ident" id="4798281">w</span><span class="op" id="4798282">,</span>&nbsp;<span class="string" id="4798284">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="4798304">,</span>&nbsp;<span class="ident" id="4798306">userAgent</span><span class="op" id="4798315">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798319">if</span>&nbsp;<span class="ident" id="4798322">err</span>&nbsp;<span class="op" id="4798326">!=</span>&nbsp;<span class="ident" id="4798329">nil</span>&nbsp;<span class="op" id="4798333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798338">return</span>&nbsp;<span class="ident" id="4798345">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798358">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798403">tw</span><span class="op" id="4798405">,</span>&nbsp;<span class="ident" id="4798407">err</span>&nbsp;<span class="op" id="4798411">:=</span>&nbsp;<span class="ident" id="4798414">newTransferWriter</span><span class="op" id="4798431">(</span><span class="ident" id="4798432">req</span><span class="op" id="4798435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798438">if</span>&nbsp;<span class="ident" id="4798441">err</span>&nbsp;<span class="op" id="4798445">!=</span>&nbsp;<span class="ident" id="4798448">nil</span>&nbsp;<span class="op" id="4798452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798456">return</span>&nbsp;<span class="ident" id="4798463">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798468">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798471">err</span>&nbsp;<span class="op" id="4798475">=</span>&nbsp;<span class="ident" id="4798477">tw</span><span class="op" id="4798479">.</span><span class="ident" id="4798480">WriteHeader</span><span class="op" id="4798491">(</span><span class="ident" id="4798492">w</span><span class="op" id="4798493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798496">if</span>&nbsp;<span class="ident" id="4798499">err</span>&nbsp;<span class="op" id="4798503">!=</span>&nbsp;<span class="ident" id="4798506">nil</span>&nbsp;<span class="op" id="4798510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798514">return</span>&nbsp;<span class="ident" id="4798521">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798530">err</span>&nbsp;<span class="op" id="4798534">=</span>&nbsp;<span class="ident" id="4798536">req</span><span class="op" id="4798539">.</span><span class="ident" id="4798540">Header</span><span class="op" id="4798546">.</span><span class="ident" id="4798547">WriteSubset</span><span class="op" id="4798558">(</span><span class="ident" id="4798559">w</span><span class="op" id="4798560">,</span>&nbsp;<span class="ident" id="4798562">reqWriteExcludeHeader</span><span class="op" id="4798583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798586">if</span>&nbsp;<span class="ident" id="4798589">err</span>&nbsp;<span class="op" id="4798593">!=</span>&nbsp;<span class="ident" id="4798596">nil</span>&nbsp;<span class="op" id="4798600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798604">return</span>&nbsp;<span class="ident" id="4798611">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798620">if</span>&nbsp;<span class="ident" id="4798623">extraHeaders</span>&nbsp;<span class="op" id="4798636">!=</span>&nbsp;<span class="ident" id="4798639">nil</span>&nbsp;<span class="op" id="4798643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798647">err</span>&nbsp;<span class="op" id="4798651">=</span>&nbsp;<span class="ident" id="4798653">extraHeaders</span><span class="op" id="4798665">.</span><span class="ident" id="4798666">Write</span><span class="op" id="4798671">(</span><span class="ident" id="4798672">w</span><span class="op" id="4798673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798677">if</span>&nbsp;<span class="ident" id="4798680">err</span>&nbsp;<span class="op" id="4798684">!=</span>&nbsp;<span class="ident" id="4798687">nil</span>&nbsp;<span class="op" id="4798691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798696">return</span>&nbsp;<span class="ident" id="4798703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798709">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798716">_</span><span class="op" id="4798717">,</span>&nbsp;<span class="ident" id="4798719">err</span>&nbsp;<span class="op" id="4798723">=</span>&nbsp;<span class="ident" id="4798725">io</span><span class="op" id="4798727">.</span><span class="ident" id="4798728">WriteString</span><span class="op" id="4798739">(</span><span class="ident" id="4798740">w</span><span class="op" id="4798741">,</span>&nbsp;<span class="string" id="4798743">&#34;\r\n&#34;</span><span class="op" id="4798749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798752">if</span>&nbsp;<span class="ident" id="4798755">err</span>&nbsp;<span class="op" id="4798759">!=</span>&nbsp;<span class="ident" id="4798762">nil</span>&nbsp;<span class="op" id="4798766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798770">return</span>&nbsp;<span class="ident" id="4798777">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798786">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798813">err</span>&nbsp;<span class="op" id="4798817">=</span>&nbsp;<span class="ident" id="4798819">tw</span><span class="op" id="4798821">.</span><span class="ident" id="4798822">WriteBody</span><span class="op" id="4798831">(</span><span class="ident" id="4798832">w</span><span class="op" id="4798833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798836">if</span>&nbsp;<span class="ident" id="4798839">err</span>&nbsp;<span class="op" id="4798843">!=</span>&nbsp;<span class="ident" id="4798846">nil</span>&nbsp;<span class="op" id="4798850">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798854">return</span>&nbsp;<span class="ident" id="4798861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798870">if</span>&nbsp;<span class="ident" id="4798873">bw</span>&nbsp;<span class="op" id="4798876">!=</span>&nbsp;<span class="ident" id="4798879">nil</span>&nbsp;<span class="op" id="4798883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798887">return</span>&nbsp;<span class="ident" id="4798894">bw</span><span class="op" id="4798896">.</span><span class="ident" id="4798897">Flush</span><span class="op" id="4798902">(</span><span class="op" id="4798903">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798909">return</span>&nbsp;<span class="ident" id="4798916">nil</span><br>
<span class="lineno"></span><span class="op" id="4798920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4798923">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="4798973">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="4799009">func</span>&nbsp;<span class="ident" id="4799014">ParseHTTPVersion</span><span class="op" id="4799030">(</span><span class="ident" id="4799031">vers</span>&nbsp;<span class="builtintype" id="4799036">string</span><span class="op" id="4799042">)</span>&nbsp;<span class="op" id="4799044">(</span><span class="ident" id="4799045">major</span><span class="op" id="4799050">,</span>&nbsp;<span class="ident" id="4799052">minor</span>&nbsp;<span class="builtintype" id="4799058">int</span><span class="op" id="4799061">,</span>&nbsp;<span class="ident" id="4799063">ok</span>&nbsp;<span class="builtintype" id="4799066">bool</span><span class="op" id="4799070">)</span>&nbsp;<span class="op" id="4799072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799075">const</span>&nbsp;<span class="ident" id="4799081">Big</span>&nbsp;<span class="op" id="4799085">=</span>&nbsp;<span class="num" id="4799087">1000000</span>&nbsp;<span class="comment" id="4799095">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799121">switch</span>&nbsp;<span class="ident" id="4799128">vers</span>&nbsp;<span class="op" id="4799133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799136">case</span>&nbsp;<span class="string" id="4799141">&#34;HTTP/1.1&#34;</span><span class="op" id="4799151">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799155">return</span>&nbsp;<span class="num" id="4799162">1</span><span class="op" id="4799163">,</span>&nbsp;<span class="num" id="4799165">1</span><span class="op" id="4799166">,</span>&nbsp;<span class="builtintype" id="4799168">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799174">case</span>&nbsp;<span class="string" id="4799179">&#34;HTTP/1.0&#34;</span><span class="op" id="4799189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799193">return</span>&nbsp;<span class="num" id="4799200">1</span><span class="op" id="4799201">,</span>&nbsp;<span class="num" id="4799203">0</span><span class="op" id="4799204">,</span>&nbsp;<span class="builtintype" id="4799206">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799215">if</span>&nbsp;<span class="op" id="4799218">!</span><span class="ident" id="4799219">strings</span><span class="op" id="4799226">.</span><span class="ident" id="4799227">HasPrefix</span><span class="op" id="4799236">(</span><span class="ident" id="4799237">vers</span><span class="op" id="4799241">,</span>&nbsp;<span class="string" id="4799243">&#34;HTTP/&#34;</span><span class="op" id="4799250">)</span>&nbsp;<span class="op" id="4799252">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799256">return</span>&nbsp;<span class="num" id="4799263">0</span><span class="op" id="4799264">,</span>&nbsp;<span class="num" id="4799266">0</span><span class="op" id="4799267">,</span>&nbsp;<span class="builtintype" id="4799269">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799279">dot</span>&nbsp;<span class="op" id="4799283">:=</span>&nbsp;<span class="ident" id="4799286">strings</span><span class="op" id="4799293">.</span><span class="ident" id="4799294">Index</span><span class="op" id="4799299">(</span><span class="ident" id="4799300">vers</span><span class="op" id="4799304">,</span>&nbsp;<span class="string" id="4799306">&#34;.&#34;</span><span class="op" id="4799309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799312">if</span>&nbsp;<span class="ident" id="4799315">dot</span>&nbsp;<span class="op" id="4799319">&lt;</span>&nbsp;<span class="num" id="4799321">0</span>&nbsp;<span class="op" id="4799323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799327">return</span>&nbsp;<span class="num" id="4799334">0</span><span class="op" id="4799335">,</span>&nbsp;<span class="num" id="4799337">0</span><span class="op" id="4799338">,</span>&nbsp;<span class="builtintype" id="4799340">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799350">major</span><span class="op" id="4799355">,</span>&nbsp;<span class="ident" id="4799357">err</span>&nbsp;<span class="op" id="4799361">:=</span>&nbsp;<span class="ident" id="4799364">strconv</span><span class="op" id="4799371">.</span><span class="ident" id="4799372">Atoi</span><span class="op" id="4799376">(</span><span class="ident" id="4799377">vers</span><span class="op" id="4799381">[</span><span class="num" id="4799382">5</span><span class="op" id="4799383">:</span><span class="ident" id="4799384">dot</span><span class="op" id="4799387">]</span><span class="op" id="4799388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799391">if</span>&nbsp;<span class="ident" id="4799394">err</span>&nbsp;<span class="op" id="4799398">!=</span>&nbsp;<span class="ident" id="4799401">nil</span>&nbsp;<span class="op" id="4799405">||</span>&nbsp;<span class="ident" id="4799408">major</span>&nbsp;<span class="op" id="4799414">&lt;</span>&nbsp;<span class="num" id="4799416">0</span>&nbsp;<span class="op" id="4799418">||</span>&nbsp;<span class="ident" id="4799421">major</span>&nbsp;<span class="op" id="4799427">&gt;</span>&nbsp;<span class="ident" id="4799429">Big</span>&nbsp;<span class="op" id="4799433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799437">return</span>&nbsp;<span class="num" id="4799444">0</span><span class="op" id="4799445">,</span>&nbsp;<span class="num" id="4799447">0</span><span class="op" id="4799448">,</span>&nbsp;<span class="builtintype" id="4799450">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799457">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799460">minor</span><span class="op" id="4799465">,</span>&nbsp;<span class="ident" id="4799467">err</span>&nbsp;<span class="op" id="4799471">=</span>&nbsp;<span class="ident" id="4799473">strconv</span><span class="op" id="4799480">.</span><span class="ident" id="4799481">Atoi</span><span class="op" id="4799485">(</span><span class="ident" id="4799486">vers</span><span class="op" id="4799490">[</span><span class="ident" id="4799491">dot</span><span class="op" id="4799494">+</span><span class="num" id="4799495">1</span><span class="op" id="4799496">:</span><span class="op" id="4799497">]</span><span class="op" id="4799498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799501">if</span>&nbsp;<span class="ident" id="4799504">err</span>&nbsp;<span class="op" id="4799508">!=</span>&nbsp;<span class="ident" id="4799511">nil</span>&nbsp;<span class="op" id="4799515">||</span>&nbsp;<span class="ident" id="4799518">minor</span>&nbsp;<span class="op" id="4799524">&lt;</span>&nbsp;<span class="num" id="4799526">0</span>&nbsp;<span class="op" id="4799528">||</span>&nbsp;<span class="ident" id="4799531">minor</span>&nbsp;<span class="op" id="4799537">&gt;</span>&nbsp;<span class="ident" id="4799539">Big</span>&nbsp;<span class="op" id="4799543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799547">return</span>&nbsp;<span class="num" id="4799554">0</span><span class="op" id="4799555">,</span>&nbsp;<span class="num" id="4799557">0</span><span class="op" id="4799558">,</span>&nbsp;<span class="builtintype" id="4799560">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799570">return</span>&nbsp;<span class="ident" id="4799577">major</span><span class="op" id="4799582">,</span>&nbsp;<span class="ident" id="4799584">minor</span><span class="op" id="4799589">,</span>&nbsp;<span class="builtintype" id="4799591">true</span><br>
<span class="lineno">485</span><span class="op" id="4799596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4799599">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4799675">//</span><br>
<span class="lineno"></span><span class="comment" id="4799678">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="4799737">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="4799801">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="4799861">func</span>&nbsp;<span class="ident" id="4799866">NewRequest</span><span class="op" id="4799876">(</span><span class="ident" id="4799877">method</span><span class="op" id="4799883">,</span>&nbsp;<span class="ident" id="4799885">urlStr</span>&nbsp;<span class="builtintype" id="4799892">string</span><span class="op" id="4799898">,</span>&nbsp;<span class="ident" id="4799900">body</span>&nbsp;<span class="ident" id="4799905">io</span><span class="op" id="4799907">.</span><span class="ident" id="4799908">Reader</span><span class="op" id="4799914">)</span>&nbsp;<span class="op" id="4799916">(</span><span class="op" id="4799917">*</span><span class="ident" id="4799918">Request</span><span class="op" id="4799925">,</span>&nbsp;<span class="builtintype" id="4799927">error</span><span class="op" id="4799932">)</span>&nbsp;<span class="op" id="4799934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799937">u</span><span class="op" id="4799938">,</span>&nbsp;<span class="ident" id="4799940">err</span>&nbsp;<span class="op" id="4799944">:=</span>&nbsp;<span class="ident" id="4799947">url</span><span class="op" id="4799950">.</span><span class="ident" id="4799951">Parse</span><span class="op" id="4799956">(</span><span class="ident" id="4799957">urlStr</span><span class="op" id="4799963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799966">if</span>&nbsp;<span class="ident" id="4799969">err</span>&nbsp;<span class="op" id="4799973">!=</span>&nbsp;<span class="ident" id="4799976">nil</span>&nbsp;<span class="op" id="4799980">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799984">return</span>&nbsp;<span class="ident" id="4799991">nil</span><span class="op" id="4799994">,</span>&nbsp;<span class="ident" id="4799996">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800004">rc</span><span class="op" id="4800006">,</span>&nbsp;<span class="ident" id="4800008">ok</span>&nbsp;<span class="op" id="4800011">:=</span>&nbsp;<span class="ident" id="4800014">body</span><span class="op" id="4800018">.</span><span class="op" id="4800019">(</span><span class="ident" id="4800020">io</span><span class="op" id="4800022">.</span><span class="ident" id="4800023">ReadCloser</span><span class="op" id="4800033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800036">if</span>&nbsp;<span class="op" id="4800039">!</span><span class="ident" id="4800040">ok</span>&nbsp;<span class="op" id="4800043">&amp;&amp;</span>&nbsp;<span class="ident" id="4800046">body</span>&nbsp;<span class="op" id="4800051">!=</span>&nbsp;<span class="ident" id="4800054">nil</span>&nbsp;<span class="op" id="4800058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800062">rc</span>&nbsp;<span class="op" id="4800065">=</span>&nbsp;<span class="ident" id="4800067">ioutil</span><span class="op" id="4800073">.</span><span class="ident" id="4800074">NopCloser</span><span class="op" id="4800083">(</span><span class="ident" id="4800084">body</span><span class="op" id="4800088">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800094">req</span>&nbsp;<span class="op" id="4800098">:=</span>&nbsp;<span class="op" id="4800101">&amp;</span><span class="ident" id="4800102">Request</span><span class="op" id="4800109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800113">Method</span><span class="op" id="4800119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800125">method</span><span class="op" id="4800131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800135">URL</span><span class="op" id="4800138">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800147">u</span><span class="op" id="4800148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800152">Proto</span><span class="op" id="4800157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4800164">&#34;HTTP/1.1&#34;</span><span class="op" id="4800174">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800178">ProtoMajor</span><span class="op" id="4800188">:</span>&nbsp;<span class="num" id="4800190">1</span><span class="op" id="4800191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800195">ProtoMinor</span><span class="op" id="4800205">:</span>&nbsp;<span class="num" id="4800207">1</span><span class="op" id="4800208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800212">Header</span><span class="op" id="4800218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4800224">make</span><span class="op" id="4800228">(</span><span class="ident" id="4800229">Header</span><span class="op" id="4800235">)</span><span class="op" id="4800236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800240">Body</span><span class="op" id="4800244">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800252">rc</span><span class="op" id="4800254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800258">Host</span><span class="op" id="4800262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800270">u</span><span class="op" id="4800271">.</span><span class="ident" id="4800272">Host</span><span class="op" id="4800276">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800282">if</span>&nbsp;<span class="ident" id="4800285">body</span>&nbsp;<span class="op" id="4800290">!=</span>&nbsp;<span class="ident" id="4800293">nil</span>&nbsp;<span class="op" id="4800297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800301">switch</span>&nbsp;<span class="ident" id="4800308">v</span>&nbsp;<span class="op" id="4800310">:=</span>&nbsp;<span class="ident" id="4800313">body</span><span class="op" id="4800317">.</span><span class="op" id="4800318">(</span><span class="keyword" id="4800319">type</span><span class="op" id="4800323">)</span>&nbsp;<span class="op" id="4800325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800329">case</span>&nbsp;<span class="op" id="4800334">*</span><span class="ident" id="4800335">bytes</span><span class="op" id="4800340">.</span><span class="ident" id="4800341">Buffer</span><span class="op" id="4800347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800352">req</span><span class="op" id="4800355">.</span><span class="ident" id="4800356">ContentLength</span>&nbsp;<span class="op" id="4800370">=</span>&nbsp;<span class="ident" id="4800372">int64</span><span class="op" id="4800377">(</span><span class="ident" id="4800378">v</span><span class="op" id="4800379">.</span><span class="ident" id="4800380">Len</span><span class="op" id="4800383">(</span><span class="op" id="4800384">)</span><span class="op" id="4800385">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800389">case</span>&nbsp;<span class="op" id="4800394">*</span><span class="ident" id="4800395">bytes</span><span class="op" id="4800400">.</span><span class="ident" id="4800401">Reader</span><span class="op" id="4800407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800412">req</span><span class="op" id="4800415">.</span><span class="ident" id="4800416">ContentLength</span>&nbsp;<span class="op" id="4800430">=</span>&nbsp;<span class="ident" id="4800432">int64</span><span class="op" id="4800437">(</span><span class="ident" id="4800438">v</span><span class="op" id="4800439">.</span><span class="ident" id="4800440">Len</span><span class="op" id="4800443">(</span><span class="op" id="4800444">)</span><span class="op" id="4800445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800449">case</span>&nbsp;<span class="op" id="4800454">*</span><span class="ident" id="4800455">strings</span><span class="op" id="4800462">.</span><span class="ident" id="4800463">Reader</span><span class="op" id="4800469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800474">req</span><span class="op" id="4800477">.</span><span class="ident" id="4800478">ContentLength</span>&nbsp;<span class="op" id="4800492">=</span>&nbsp;<span class="ident" id="4800494">int64</span><span class="op" id="4800499">(</span><span class="ident" id="4800500">v</span><span class="op" id="4800501">.</span><span class="ident" id="4800502">Len</span><span class="op" id="4800505">(</span><span class="op" id="4800506">)</span><span class="op" id="4800507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800511">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800518">return</span>&nbsp;<span class="ident" id="4800525">req</span><span class="op" id="4800528">,</span>&nbsp;<span class="ident" id="4800530">nil</span><br>
<span class="lineno"></span><span class="op" id="4800534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="4800537">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4800610">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="4800682">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4800710">func</span>&nbsp;<span class="op" id="4800715">(</span><span class="ident" id="4800716">r</span>&nbsp;<span class="op" id="4800718">*</span><span class="ident" id="4800719">Request</span><span class="op" id="4800726">)</span>&nbsp;<span class="ident" id="4800728">BasicAuth</span><span class="op" id="4800737">(</span><span class="op" id="4800738">)</span>&nbsp;<span class="op" id="4800740">(</span><span class="ident" id="4800741">username</span><span class="op" id="4800749">,</span>&nbsp;<span class="ident" id="4800751">password</span>&nbsp;<span class="builtintype" id="4800760">string</span><span class="op" id="4800766">,</span>&nbsp;<span class="ident" id="4800768">ok</span>&nbsp;<span class="builtintype" id="4800771">bool</span><span class="op" id="4800775">)</span>&nbsp;<span class="op" id="4800777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800780">auth</span>&nbsp;<span class="op" id="4800785">:=</span>&nbsp;<span class="ident" id="4800788">r</span><span class="op" id="4800789">.</span><span class="ident" id="4800790">Header</span><span class="op" id="4800796">.</span><span class="ident" id="4800797">Get</span><span class="op" id="4800800">(</span><span class="string" id="4800801">&#34;Authorization&#34;</span><span class="op" id="4800816">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800819">if</span>&nbsp;<span class="ident" id="4800822">auth</span>&nbsp;<span class="op" id="4800827">==</span>&nbsp;<span class="string" id="4800830">&#34;&#34;</span>&nbsp;<span class="op" id="4800833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800837">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800848">return</span>&nbsp;<span class="ident" id="4800855">parseBasicAuth</span><span class="op" id="4800869">(</span><span class="ident" id="4800870">auth</span><span class="op" id="4800874">)</span><br>
<span class="lineno"></span><span class="op" id="4800876">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="4800879">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="4800941">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="4801023">func</span>&nbsp;<span class="ident" id="4801028">parseBasicAuth</span><span class="op" id="4801042">(</span><span class="ident" id="4801043">auth</span>&nbsp;<span class="builtintype" id="4801048">string</span><span class="op" id="4801054">)</span>&nbsp;<span class="op" id="4801056">(</span><span class="ident" id="4801057">username</span><span class="op" id="4801065">,</span>&nbsp;<span class="ident" id="4801067">password</span>&nbsp;<span class="builtintype" id="4801076">string</span><span class="op" id="4801082">,</span>&nbsp;<span class="ident" id="4801084">ok</span>&nbsp;<span class="builtintype" id="4801087">bool</span><span class="op" id="4801091">)</span>&nbsp;<span class="op" id="4801093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801096">if</span>&nbsp;<span class="op" id="4801099">!</span><span class="ident" id="4801100">strings</span><span class="op" id="4801107">.</span><span class="ident" id="4801108">HasPrefix</span><span class="op" id="4801117">(</span><span class="ident" id="4801118">auth</span><span class="op" id="4801122">,</span>&nbsp;<span class="string" id="4801124">&#34;Basic&nbsp;&#34;</span><span class="op" id="4801132">)</span>&nbsp;<span class="op" id="4801134">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801138">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801149">c</span><span class="op" id="4801150">,</span>&nbsp;<span class="ident" id="4801152">err</span>&nbsp;<span class="op" id="4801156">:=</span>&nbsp;<span class="ident" id="4801159">base64</span><span class="op" id="4801165">.</span><span class="ident" id="4801166">StdEncoding</span><span class="op" id="4801177">.</span><span class="ident" id="4801178">DecodeString</span><span class="op" id="4801190">(</span><span class="ident" id="4801191">strings</span><span class="op" id="4801198">.</span><span class="ident" id="4801199">TrimPrefix</span><span class="op" id="4801209">(</span><span class="ident" id="4801210">auth</span><span class="op" id="4801214">,</span>&nbsp;<span class="string" id="4801216">&#34;Basic&nbsp;&#34;</span><span class="op" id="4801224">)</span><span class="op" id="4801225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801228">if</span>&nbsp;<span class="ident" id="4801231">err</span>&nbsp;<span class="op" id="4801235">!=</span>&nbsp;<span class="ident" id="4801238">nil</span>&nbsp;<span class="op" id="4801242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801246">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801257">cs</span>&nbsp;<span class="op" id="4801260">:=</span>&nbsp;<span class="builtintype" id="4801263">string</span><span class="op" id="4801269">(</span><span class="ident" id="4801270">c</span><span class="op" id="4801271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801274">s</span>&nbsp;<span class="op" id="4801276">:=</span>&nbsp;<span class="ident" id="4801279">strings</span><span class="op" id="4801286">.</span><span class="ident" id="4801287">IndexByte</span><span class="op" id="4801296">(</span><span class="ident" id="4801297">cs</span><span class="op" id="4801299">,</span>&nbsp;<span class="string" id="4801301">&#39;:&#39;</span><span class="op" id="4801304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801307">if</span>&nbsp;<span class="ident" id="4801310">s</span>&nbsp;<span class="op" id="4801312">&lt;</span>&nbsp;<span class="num" id="4801314">0</span>&nbsp;<span class="op" id="4801316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801320">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801331">return</span>&nbsp;<span class="ident" id="4801338">cs</span><span class="op" id="4801340">[</span><span class="op" id="4801341">:</span><span class="ident" id="4801342">s</span><span class="op" id="4801343">]</span><span class="op" id="4801344">,</span>&nbsp;<span class="ident" id="4801346">cs</span><span class="op" id="4801348">[</span><span class="ident" id="4801349">s</span><span class="op" id="4801350">+</span><span class="num" id="4801351">1</span><span class="op" id="4801352">:</span><span class="op" id="4801353">]</span><span class="op" id="4801354">,</span>&nbsp;<span class="builtintype" id="4801356">true</span><br>
<span class="lineno"></span><span class="op" id="4801361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801364">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="4801432">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="4801497">//</span><br>
<span class="lineno"></span><span class="comment" id="4801500">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4801569">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4801591">func</span>&nbsp;<span class="op" id="4801596">(</span><span class="ident" id="4801597">r</span>&nbsp;<span class="op" id="4801599">*</span><span class="ident" id="4801600">Request</span><span class="op" id="4801607">)</span>&nbsp;<span class="ident" id="4801609">SetBasicAuth</span><span class="op" id="4801621">(</span><span class="ident" id="4801622">username</span><span class="op" id="4801630">,</span>&nbsp;<span class="ident" id="4801632">password</span>&nbsp;<span class="builtintype" id="4801641">string</span><span class="op" id="4801647">)</span>&nbsp;<span class="op" id="4801649">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801652">r</span><span class="op" id="4801653">.</span><span class="ident" id="4801654">Header</span><span class="op" id="4801660">.</span><span class="ident" id="4801661">Set</span><span class="op" id="4801664">(</span><span class="string" id="4801665">&#34;Authorization&#34;</span><span class="op" id="4801680">,</span>&nbsp;<span class="string" id="4801682">&#34;Basic&nbsp;&#34;</span><span class="op" id="4801690">+</span><span class="ident" id="4801691">basicAuth</span><span class="op" id="4801700">(</span><span class="ident" id="4801701">username</span><span class="op" id="4801709">,</span>&nbsp;<span class="ident" id="4801711">password</span><span class="op" id="4801719">)</span><span class="op" id="4801720">)</span><br>
<span class="lineno"></span><span class="op" id="4801722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801725">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="4801794">func</span>&nbsp;<span class="ident" id="4801799">parseRequestLine</span><span class="op" id="4801815">(</span><span class="ident" id="4801816">line</span>&nbsp;<span class="builtintype" id="4801821">string</span><span class="op" id="4801827">)</span>&nbsp;<span class="op" id="4801829">(</span><span class="ident" id="4801830">method</span><span class="op" id="4801836">,</span>&nbsp;<span class="ident" id="4801838">requestURI</span><span class="op" id="4801848">,</span>&nbsp;<span class="ident" id="4801850">proto</span>&nbsp;<span class="builtintype" id="4801856">string</span><span class="op" id="4801862">,</span>&nbsp;<span class="ident" id="4801864">ok</span>&nbsp;<span class="builtintype" id="4801867">bool</span><span class="op" id="4801871">)</span>&nbsp;<span class="op" id="4801873">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801876">s1</span>&nbsp;<span class="op" id="4801879">:=</span>&nbsp;<span class="ident" id="4801882">strings</span><span class="op" id="4801889">.</span><span class="ident" id="4801890">Index</span><span class="op" id="4801895">(</span><span class="ident" id="4801896">line</span><span class="op" id="4801900">,</span>&nbsp;<span class="string" id="4801902">&#34;&nbsp;&#34;</span><span class="op" id="4801905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801908">s2</span>&nbsp;<span class="op" id="4801911">:=</span>&nbsp;<span class="ident" id="4801914">strings</span><span class="op" id="4801921">.</span><span class="ident" id="4801922">Index</span><span class="op" id="4801927">(</span><span class="ident" id="4801928">line</span><span class="op" id="4801932">[</span><span class="ident" id="4801933">s1</span><span class="op" id="4801935">+</span><span class="num" id="4801936">1</span><span class="op" id="4801937">:</span><span class="op" id="4801938">]</span><span class="op" id="4801939">,</span>&nbsp;<span class="string" id="4801941">&#34;&nbsp;&#34;</span><span class="op" id="4801944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801947">if</span>&nbsp;<span class="ident" id="4801950">s1</span>&nbsp;<span class="op" id="4801953">&lt;</span>&nbsp;<span class="num" id="4801955">0</span>&nbsp;<span class="op" id="4801957">||</span>&nbsp;<span class="ident" id="4801960">s2</span>&nbsp;<span class="op" id="4801963">&lt;</span>&nbsp;<span class="num" id="4801965">0</span>&nbsp;<span class="op" id="4801967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801971">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801979">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801982">s2</span>&nbsp;<span class="op" id="4801985">+=</span>&nbsp;<span class="ident" id="4801988">s1</span>&nbsp;<span class="op" id="4801991">+</span>&nbsp;<span class="num" id="4801993">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801996">return</span>&nbsp;<span class="ident" id="4802003">line</span><span class="op" id="4802007">[</span><span class="op" id="4802008">:</span><span class="ident" id="4802009">s1</span><span class="op" id="4802011">]</span><span class="op" id="4802012">,</span>&nbsp;<span class="ident" id="4802014">line</span><span class="op" id="4802018">[</span><span class="ident" id="4802019">s1</span><span class="op" id="4802021">+</span><span class="num" id="4802022">1</span>&nbsp;<span class="op" id="4802024">:</span>&nbsp;<span class="ident" id="4802026">s2</span><span class="op" id="4802028">]</span><span class="op" id="4802029">,</span>&nbsp;<span class="ident" id="4802031">line</span><span class="op" id="4802035">[</span><span class="ident" id="4802036">s2</span><span class="op" id="4802038">+</span><span class="num" id="4802039">1</span><span class="op" id="4802040">:</span><span class="op" id="4802041">]</span><span class="op" id="4802042">,</span>&nbsp;<span class="builtintype" id="4802044">true</span><br>
<span class="lineno"></span><span class="op" id="4802049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802052">var</span>&nbsp;<span class="ident" id="4802056">textprotoReaderPool</span>&nbsp;<span class="ident" id="4802076">sync</span><span class="op" id="4802080">.</span><span class="ident" id="4802081">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="4802087">func</span>&nbsp;<span class="ident" id="4802092">newTextprotoReader</span><span class="op" id="4802110">(</span><span class="ident" id="4802111">br</span>&nbsp;<span class="op" id="4802114">*</span><span class="ident" id="4802115">bufio</span><span class="op" id="4802120">.</span><span class="ident" id="4802121">Reader</span><span class="op" id="4802127">)</span>&nbsp;<span class="op" id="4802129">*</span><span class="ident" id="4802130">textproto</span><span class="op" id="4802139">.</span><span class="ident" id="4802140">Reader</span>&nbsp;<span class="op" id="4802147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802150">if</span>&nbsp;<span class="ident" id="4802153">v</span>&nbsp;<span class="op" id="4802155">:=</span>&nbsp;<span class="ident" id="4802158">textprotoReaderPool</span><span class="op" id="4802177">.</span><span class="ident" id="4802178">Get</span><span class="op" id="4802181">(</span><span class="op" id="4802182">)</span><span class="op" id="4802183">;</span>&nbsp;<span class="ident" id="4802185">v</span>&nbsp;<span class="op" id="4802187">!=</span>&nbsp;<span class="ident" id="4802190">nil</span>&nbsp;<span class="op" id="4802194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802198">tr</span>&nbsp;<span class="op" id="4802201">:=</span>&nbsp;<span class="ident" id="4802204">v</span><span class="op" id="4802205">.</span><span class="op" id="4802206">(</span><span class="op" id="4802207">*</span><span class="ident" id="4802208">textproto</span><span class="op" id="4802217">.</span><span class="ident" id="4802218">Reader</span><span class="op" id="4802224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802228">tr</span><span class="op" id="4802230">.</span><span class="ident" id="4802231">R</span>&nbsp;<span class="op" id="4802233">=</span>&nbsp;<span class="ident" id="4802235">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802240">return</span>&nbsp;<span class="ident" id="4802247">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802254">return</span>&nbsp;<span class="ident" id="4802261">textproto</span><span class="op" id="4802270">.</span><span class="ident" id="4802271">NewReader</span><span class="op" id="4802280">(</span><span class="ident" id="4802281">br</span><span class="op" id="4802283">)</span><br>
<span class="lineno"></span><span class="op" id="4802285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="4802288">func</span>&nbsp;<span class="ident" id="4802293">putTextprotoReader</span><span class="op" id="4802311">(</span><span class="ident" id="4802312">r</span>&nbsp;<span class="op" id="4802314">*</span><span class="ident" id="4802315">textproto</span><span class="op" id="4802324">.</span><span class="ident" id="4802325">Reader</span><span class="op" id="4802331">)</span>&nbsp;<span class="op" id="4802333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802336">r</span><span class="op" id="4802337">.</span><span class="ident" id="4802338">R</span>&nbsp;<span class="op" id="4802340">=</span>&nbsp;<span class="ident" id="4802342">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802347">textprotoReaderPool</span><span class="op" id="4802366">.</span><span class="ident" id="4802367">Put</span><span class="op" id="4802370">(</span><span class="ident" id="4802371">r</span><span class="op" id="4802372">)</span><br>
<span class="lineno"></span><span class="op" id="4802374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4802377">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4802427">func</span>&nbsp;<span class="ident" id="4802432">ReadRequest</span><span class="op" id="4802443">(</span><span class="ident" id="4802444">b</span>&nbsp;<span class="op" id="4802446">*</span><span class="ident" id="4802447">bufio</span><span class="op" id="4802452">.</span><span class="ident" id="4802453">Reader</span><span class="op" id="4802459">)</span>&nbsp;<span class="op" id="4802461">(</span><span class="ident" id="4802462">req</span>&nbsp;<span class="op" id="4802466">*</span><span class="ident" id="4802467">Request</span><span class="op" id="4802474">,</span>&nbsp;<span class="ident" id="4802476">err</span>&nbsp;<span class="builtintype" id="4802480">error</span><span class="op" id="4802485">)</span>&nbsp;<span class="op" id="4802487">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802491">tp</span>&nbsp;<span class="op" id="4802494">:=</span>&nbsp;<span class="ident" id="4802497">newTextprotoReader</span><span class="op" id="4802515">(</span><span class="ident" id="4802516">b</span><span class="op" id="4802517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802520">req</span>&nbsp;<span class="op" id="4802524">=</span>&nbsp;<span class="builtinfunc" id="4802526">new</span><span class="op" id="4802529">(</span><span class="ident" id="4802530">Request</span><span class="op" id="4802537">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4802541">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802582">var</span>&nbsp;<span class="ident" id="4802586">s</span>&nbsp;<span class="builtintype" id="4802588">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802596">if</span>&nbsp;<span class="ident" id="4802599">s</span><span class="op" id="4802600">,</span>&nbsp;<span class="ident" id="4802602">err</span>&nbsp;<span class="op" id="4802606">=</span>&nbsp;<span class="ident" id="4802608">tp</span><span class="op" id="4802610">.</span><span class="ident" id="4802611">ReadLine</span><span class="op" id="4802619">(</span><span class="op" id="4802620">)</span><span class="op" id="4802621">;</span>&nbsp;<span class="ident" id="4802623">err</span>&nbsp;<span class="op" id="4802627">!=</span>&nbsp;<span class="ident" id="4802630">nil</span>&nbsp;<span class="op" id="4802634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802638">return</span>&nbsp;<span class="ident" id="4802645">nil</span><span class="op" id="4802648">,</span>&nbsp;<span class="ident" id="4802650">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802658">defer</span>&nbsp;<span class="keyword" id="4802664">func</span><span class="op" id="4802668">(</span><span class="op" id="4802669">)</span>&nbsp;<span class="op" id="4802671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802675">putTextprotoReader</span><span class="op" id="4802693">(</span><span class="ident" id="4802694">tp</span><span class="op" id="4802696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802700">if</span>&nbsp;<span class="ident" id="4802703">err</span>&nbsp;<span class="op" id="4802707">==</span>&nbsp;<span class="ident" id="4802710">io</span><span class="op" id="4802712">.</span><span class="ident" id="4802713">EOF</span>&nbsp;<span class="op" id="4802717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802722">err</span>&nbsp;<span class="op" id="4802726">=</span>&nbsp;<span class="ident" id="4802728">io</span><span class="op" id="4802730">.</span><span class="ident" id="4802731">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802753">}</span><span class="op" id="4802754">(</span><span class="op" id="4802755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802759">var</span>&nbsp;<span class="ident" id="4802763">ok</span>&nbsp;<span class="builtintype" id="4802766">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802772">req</span><span class="op" id="4802775">.</span><span class="ident" id="4802776">Method</span><span class="op" id="4802782">,</span>&nbsp;<span class="ident" id="4802784">req</span><span class="op" id="4802787">.</span><span class="ident" id="4802788">RequestURI</span><span class="op" id="4802798">,</span>&nbsp;<span class="ident" id="4802800">req</span><span class="op" id="4802803">.</span><span class="ident" id="4802804">Proto</span><span class="op" id="4802809">,</span>&nbsp;<span class="ident" id="4802811">ok</span>&nbsp;<span class="op" id="4802814">=</span>&nbsp;<span class="ident" id="4802816">parseRequestLine</span><span class="op" id="4802832">(</span><span class="ident" id="4802833">s</span><span class="op" id="4802834">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802837">if</span>&nbsp;<span class="op" id="4802840">!</span><span class="ident" id="4802841">ok</span>&nbsp;<span class="op" id="4802844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802848">return</span>&nbsp;<span class="ident" id="4802855">nil</span><span class="op" id="4802858">,</span>&nbsp;<span class="op" id="4802860">&amp;</span><span class="ident" id="4802861">badStringError</span><span class="op" id="4802875">{</span><span class="string" id="4802876">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="4802900">,</span>&nbsp;<span class="ident" id="4802902">s</span><span class="op" id="4802903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802909">rawurl</span>&nbsp;<span class="op" id="4802916">:=</span>&nbsp;<span class="ident" id="4802919">req</span><span class="op" id="4802922">.</span><span class="ident" id="4802923">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802935">if</span>&nbsp;<span class="ident" id="4802938">req</span><span class="op" id="4802941">.</span><span class="ident" id="4802942">ProtoMajor</span><span class="op" id="4802952">,</span>&nbsp;<span class="ident" id="4802954">req</span><span class="op" id="4802957">.</span><span class="ident" id="4802958">ProtoMinor</span><span class="op" id="4802968">,</span>&nbsp;<span class="ident" id="4802970">ok</span>&nbsp;<span class="op" id="4802973">=</span>&nbsp;<span class="ident" id="4802975">ParseHTTPVersion</span><span class="op" id="4802991">(</span><span class="ident" id="4802992">req</span><span class="op" id="4802995">.</span><span class="ident" id="4802996">Proto</span><span class="op" id="4803001">)</span><span class="op" id="4803002">;</span>&nbsp;<span class="op" id="4803004">!</span><span class="ident" id="4803005">ok</span>&nbsp;<span class="op" id="4803008">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803012">return</span>&nbsp;<span class="ident" id="4803019">nil</span><span class="op" id="4803022">,</span>&nbsp;<span class="op" id="4803024">&amp;</span><span class="ident" id="4803025">badStringError</span><span class="op" id="4803039">{</span><span class="string" id="4803040">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="4803064">,</span>&nbsp;<span class="ident" id="4803066">req</span><span class="op" id="4803069">.</span><span class="ident" id="4803070">Proto</span><span class="op" id="4803075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803082">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803161">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803224">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803302">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803387">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803391">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803468">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803544">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803624">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803641">justAuthority</span>&nbsp;<span class="op" id="4803655">:=</span>&nbsp;<span class="ident" id="4803658">req</span><span class="op" id="4803661">.</span><span class="ident" id="4803662">Method</span>&nbsp;<span class="op" id="4803669">==</span>&nbsp;<span class="string" id="4803672">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4803682">&amp;&amp;</span>&nbsp;<span class="op" id="4803685">!</span><span class="ident" id="4803686">strings</span><span class="op" id="4803693">.</span><span class="ident" id="4803694">HasPrefix</span><span class="op" id="4803703">(</span><span class="ident" id="4803704">rawurl</span><span class="op" id="4803710">,</span>&nbsp;<span class="string" id="4803712">&#34;/&#34;</span><span class="op" id="4803715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803718">if</span>&nbsp;<span class="ident" id="4803721">justAuthority</span>&nbsp;<span class="op" id="4803735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803739">rawurl</span>&nbsp;<span class="op" id="4803746">=</span>&nbsp;<span class="string" id="4803748">&#34;http://&#34;</span>&nbsp;<span class="op" id="4803758">+</span>&nbsp;<span class="ident" id="4803760">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803772">if</span>&nbsp;<span class="ident" id="4803775">req</span><span class="op" id="4803778">.</span><span class="ident" id="4803779">URL</span><span class="op" id="4803782">,</span>&nbsp;<span class="ident" id="4803784">err</span>&nbsp;<span class="op" id="4803788">=</span>&nbsp;<span class="ident" id="4803790">url</span><span class="op" id="4803793">.</span><span class="ident" id="4803794">ParseRequestURI</span><span class="op" id="4803809">(</span><span class="ident" id="4803810">rawurl</span><span class="op" id="4803816">)</span><span class="op" id="4803817">;</span>&nbsp;<span class="ident" id="4803819">err</span>&nbsp;<span class="op" id="4803823">!=</span>&nbsp;<span class="ident" id="4803826">nil</span>&nbsp;<span class="op" id="4803830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803834">return</span>&nbsp;<span class="ident" id="4803841">nil</span><span class="op" id="4803844">,</span>&nbsp;<span class="ident" id="4803846">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803851">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803855">if</span>&nbsp;<span class="ident" id="4803858">justAuthority</span>&nbsp;<span class="op" id="4803872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803876">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803917">req</span><span class="op" id="4803920">.</span><span class="ident" id="4803921">URL</span><span class="op" id="4803924">.</span><span class="ident" id="4803925">Scheme</span>&nbsp;<span class="op" id="4803932">=</span>&nbsp;<span class="string" id="4803934">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803938">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803942">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803976">mimeHeader</span><span class="op" id="4803986">,</span>&nbsp;<span class="ident" id="4803988">err</span>&nbsp;<span class="op" id="4803992">:=</span>&nbsp;<span class="ident" id="4803995">tp</span><span class="op" id="4803997">.</span><span class="ident" id="4803998">ReadMIMEHeader</span><span class="op" id="4804012">(</span><span class="op" id="4804013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804016">if</span>&nbsp;<span class="ident" id="4804019">err</span>&nbsp;<span class="op" id="4804023">!=</span>&nbsp;<span class="ident" id="4804026">nil</span>&nbsp;<span class="op" id="4804030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804034">return</span>&nbsp;<span class="ident" id="4804041">nil</span><span class="op" id="4804044">,</span>&nbsp;<span class="ident" id="4804046">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804054">req</span><span class="op" id="4804057">.</span><span class="ident" id="4804058">Header</span>&nbsp;<span class="op" id="4804065">=</span>&nbsp;<span class="ident" id="4804067">Header</span><span class="op" id="4804073">(</span><span class="ident" id="4804074">mimeHeader</span><span class="op" id="4804084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804088">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804112">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804141">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804166">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804174">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804224">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804247">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804308">req</span><span class="op" id="4804311">.</span><span class="ident" id="4804312">Host</span>&nbsp;<span class="op" id="4804317">=</span>&nbsp;<span class="ident" id="4804319">req</span><span class="op" id="4804322">.</span><span class="ident" id="4804323">URL</span><span class="op" id="4804326">.</span><span class="ident" id="4804327">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804333">if</span>&nbsp;<span class="ident" id="4804336">req</span><span class="op" id="4804339">.</span><span class="ident" id="4804340">Host</span>&nbsp;<span class="op" id="4804345">==</span>&nbsp;<span class="string" id="4804348">&#34;&#34;</span>&nbsp;<span class="op" id="4804351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804355">req</span><span class="op" id="4804358">.</span><span class="ident" id="4804359">Host</span>&nbsp;<span class="op" id="4804364">=</span>&nbsp;<span class="ident" id="4804366">req</span><span class="op" id="4804369">.</span><span class="ident" id="4804370">Header</span><span class="op" id="4804376">.</span><span class="ident" id="4804377">get</span><span class="op" id="4804380">(</span><span class="string" id="4804381">&#34;Host&#34;</span><span class="op" id="4804387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4804393">delete</span><span class="op" id="4804399">(</span><span class="ident" id="4804400">req</span><span class="op" id="4804403">.</span><span class="ident" id="4804404">Header</span><span class="op" id="4804410">,</span>&nbsp;<span class="string" id="4804412">&#34;Host&#34;</span><span class="op" id="4804418">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804422">fixPragmaCacheControl</span><span class="op" id="4804443">(</span><span class="ident" id="4804444">req</span><span class="op" id="4804447">.</span><span class="ident" id="4804448">Header</span><span class="op" id="4804454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804458">err</span>&nbsp;<span class="op" id="4804462">=</span>&nbsp;<span class="ident" id="4804464">readTransfer</span><span class="op" id="4804476">(</span><span class="ident" id="4804477">req</span><span class="op" id="4804480">,</span>&nbsp;<span class="ident" id="4804482">b</span><span class="op" id="4804483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804486">if</span>&nbsp;<span class="ident" id="4804489">err</span>&nbsp;<span class="op" id="4804493">!=</span>&nbsp;<span class="ident" id="4804496">nil</span>&nbsp;<span class="op" id="4804500">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804504">return</span>&nbsp;<span class="ident" id="4804511">nil</span><span class="op" id="4804514">,</span>&nbsp;<span class="ident" id="4804516">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804525">req</span><span class="op" id="4804528">.</span><span class="ident" id="4804529">Close</span>&nbsp;<span class="op" id="4804535">=</span>&nbsp;<span class="ident" id="4804537">shouldClose</span><span class="op" id="4804548">(</span><span class="ident" id="4804549">req</span><span class="op" id="4804552">.</span><span class="ident" id="4804553">ProtoMajor</span><span class="op" id="4804563">,</span>&nbsp;<span class="ident" id="4804565">req</span><span class="op" id="4804568">.</span><span class="ident" id="4804569">ProtoMinor</span><span class="op" id="4804579">,</span>&nbsp;<span class="ident" id="4804581">req</span><span class="op" id="4804584">.</span><span class="ident" id="4804585">Header</span><span class="op" id="4804591">,</span>&nbsp;<span class="builtintype" id="4804593">false</span><span class="op" id="4804598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804601">return</span>&nbsp;<span class="ident" id="4804608">req</span><span class="op" id="4804611">,</span>&nbsp;<span class="ident" id="4804613">nil</span><br>
<span class="lineno">670</span><span class="op" id="4804617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4804620">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4804687">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4804751">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="4804821">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4804882">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="4804936">//</span><br>
<span class="lineno"></span><span class="comment" id="4804939">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="4805007">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="4805064">func</span>&nbsp;<span class="ident" id="4805069">MaxBytesReader</span><span class="op" id="4805083">(</span><span class="ident" id="4805084">w</span>&nbsp;<span class="ident" id="4805086">ResponseWriter</span><span class="op" id="4805100">,</span>&nbsp;<span class="ident" id="4805102">r</span>&nbsp;<span class="ident" id="4805104">io</span><span class="op" id="4805106">.</span><span class="ident" id="4805107">ReadCloser</span><span class="op" id="4805117">,</span>&nbsp;<span class="ident" id="4805119">n</span>&nbsp;<span class="ident" id="4805121">int64</span><span class="op" id="4805126">)</span>&nbsp;<span class="ident" id="4805128">io</span><span class="op" id="4805130">.</span><span class="ident" id="4805131">ReadCloser</span>&nbsp;<span class="op" id="4805142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805145">return</span>&nbsp;<span class="op" id="4805152">&amp;</span><span class="ident" id="4805153">maxBytesReader</span><span class="op" id="4805167">{</span><span class="ident" id="4805168">w</span><span class="op" id="4805169">:</span>&nbsp;<span class="ident" id="4805171">w</span><span class="op" id="4805172">,</span>&nbsp;<span class="ident" id="4805174">r</span><span class="op" id="4805175">:</span>&nbsp;<span class="ident" id="4805177">r</span><span class="op" id="4805178">,</span>&nbsp;<span class="ident" id="4805180">n</span><span class="op" id="4805181">:</span>&nbsp;<span class="ident" id="4805183">n</span><span class="op" id="4805184">}</span><br>
<span class="lineno"></span><span class="op" id="4805186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4805189">type</span>&nbsp;<span class="ident" id="4805194">maxBytesReader</span>&nbsp;<span class="keyword" id="4805209">struct</span>&nbsp;<span class="op" id="4805216">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805219">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805227">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805243">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805251">io</span><span class="op" id="4805253">.</span><span class="ident" id="4805254">ReadCloser</span>&nbsp;<span class="comment" id="4805265">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805287">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805295">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805309">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805333">stopped</span>&nbsp;<span class="builtintype" id="4805341">bool</span><br>
<span class="lineno"></span><span class="op" id="4805346">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4805349">func</span>&nbsp;<span class="op" id="4805354">(</span><span class="ident" id="4805355">l</span>&nbsp;<span class="op" id="4805357">*</span><span class="ident" id="4805358">maxBytesReader</span><span class="op" id="4805372">)</span>&nbsp;<span class="ident" id="4805374">Read</span><span class="op" id="4805378">(</span><span class="ident" id="4805379">p</span>&nbsp;<span class="op" id="4805381">[</span><span class="op" id="4805382">]</span><span class="builtintype" id="4805383">byte</span><span class="op" id="4805387">)</span>&nbsp;<span class="op" id="4805389">(</span><span class="ident" id="4805390">n</span>&nbsp;<span class="builtintype" id="4805392">int</span><span class="op" id="4805395">,</span>&nbsp;<span class="ident" id="4805397">err</span>&nbsp;<span class="builtintype" id="4805401">error</span><span class="op" id="4805406">)</span>&nbsp;<span class="op" id="4805408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805411">if</span>&nbsp;<span class="ident" id="4805414">l</span><span class="op" id="4805415">.</span><span class="ident" id="4805416">n</span>&nbsp;<span class="op" id="4805418">&lt;=</span>&nbsp;<span class="num" id="4805421">0</span>&nbsp;<span class="op" id="4805423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805427">if</span>&nbsp;<span class="op" id="4805430">!</span><span class="ident" id="4805431">l</span><span class="op" id="4805432">.</span><span class="ident" id="4805433">stopped</span>&nbsp;<span class="op" id="4805441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805446">l</span><span class="op" id="4805447">.</span><span class="ident" id="4805448">stopped</span>&nbsp;<span class="op" id="4805456">=</span>&nbsp;<span class="builtintype" id="4805458">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805466">if</span>&nbsp;<span class="ident" id="4805469">res</span><span class="op" id="4805472">,</span>&nbsp;<span class="ident" id="4805474">ok</span>&nbsp;<span class="op" id="4805477">:=</span>&nbsp;<span class="ident" id="4805480">l</span><span class="op" id="4805481">.</span><span class="ident" id="4805482">w</span><span class="op" id="4805483">.</span><span class="op" id="4805484">(</span><span class="op" id="4805485">*</span><span class="ident" id="4805486">response</span><span class="op" id="4805494">)</span><span class="op" id="4805495">;</span>&nbsp;<span class="ident" id="4805497">ok</span>&nbsp;<span class="op" id="4805500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805506">res</span><span class="op" id="4805509">.</span><span class="ident" id="4805510">requestTooLarge</span><span class="op" id="4805525">(</span><span class="op" id="4805526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805539">return</span>&nbsp;<span class="num" id="4805546">0</span><span class="op" id="4805547">,</span>&nbsp;<span class="ident" id="4805549">errors</span><span class="op" id="4805555">.</span><span class="ident" id="4805556">New</span><span class="op" id="4805559">(</span><span class="string" id="4805560">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="4805590">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805596">if</span>&nbsp;<span class="ident" id="4805599">int64</span><span class="op" id="4805604">(</span><span class="builtinfunc" id="4805605">len</span><span class="op" id="4805608">(</span><span class="ident" id="4805609">p</span><span class="op" id="4805610">)</span><span class="op" id="4805611">)</span>&nbsp;<span class="op" id="4805613">&gt;</span>&nbsp;<span class="ident" id="4805615">l</span><span class="op" id="4805616">.</span><span class="ident" id="4805617">n</span>&nbsp;<span class="op" id="4805619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805623">p</span>&nbsp;<span class="op" id="4805625">=</span>&nbsp;<span class="ident" id="4805627">p</span><span class="op" id="4805628">[</span><span class="op" id="4805629">:</span><span class="ident" id="4805630">l</span><span class="op" id="4805631">.</span><span class="ident" id="4805632">n</span><span class="op" id="4805633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805639">n</span><span class="op" id="4805640">,</span>&nbsp;<span class="ident" id="4805642">err</span>&nbsp;<span class="op" id="4805646">=</span>&nbsp;<span class="ident" id="4805648">l</span><span class="op" id="4805649">.</span><span class="ident" id="4805650">r</span><span class="op" id="4805651">.</span><span class="ident" id="4805652">Read</span><span class="op" id="4805656">(</span><span class="ident" id="4805657">p</span><span class="op" id="4805658">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805661">l</span><span class="op" id="4805662">.</span><span class="ident" id="4805663">n</span>&nbsp;<span class="op" id="4805665">-=</span>&nbsp;<span class="ident" id="4805668">int64</span><span class="op" id="4805673">(</span><span class="ident" id="4805674">n</span><span class="op" id="4805675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805678">return</span><br>
<span class="lineno"></span><span class="op" id="4805685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4805688">func</span>&nbsp;<span class="op" id="4805693">(</span><span class="ident" id="4805694">l</span>&nbsp;<span class="op" id="4805696">*</span><span class="ident" id="4805697">maxBytesReader</span><span class="op" id="4805711">)</span>&nbsp;<span class="ident" id="4805713">Close</span><span class="op" id="4805718">(</span><span class="op" id="4805719">)</span>&nbsp;<span class="builtintype" id="4805721">error</span>&nbsp;<span class="op" id="4805727">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805730">return</span>&nbsp;<span class="ident" id="4805737">l</span><span class="op" id="4805738">.</span><span class="ident" id="4805739">r</span><span class="op" id="4805740">.</span><span class="ident" id="4805741">Close</span><span class="op" id="4805746">(</span><span class="op" id="4805747">)</span><br>
<span class="lineno"></span><span class="op" id="4805749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4805752">func</span>&nbsp;<span class="ident" id="4805757">copyValues</span><span class="op" id="4805767">(</span><span class="ident" id="4805768">dst</span><span class="op" id="4805771">,</span>&nbsp;<span class="ident" id="4805773">src</span>&nbsp;<span class="ident" id="4805777">url</span><span class="op" id="4805780">.</span><span class="ident" id="4805781">Values</span><span class="op" id="4805787">)</span>&nbsp;<span class="op" id="4805789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805792">for</span>&nbsp;<span class="ident" id="4805796">k</span><span class="op" id="4805797">,</span>&nbsp;<span class="ident" id="4805799">vs</span>&nbsp;<span class="op" id="4805802">:=</span>&nbsp;<span class="keyword" id="4805805">range</span>&nbsp;<span class="ident" id="4805811">src</span>&nbsp;<span class="op" id="4805815">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805819">for</span>&nbsp;<span class="ident" id="4805823">_</span><span class="op" id="4805824">,</span>&nbsp;<span class="ident" id="4805826">value</span>&nbsp;<span class="op" id="4805832">:=</span>&nbsp;<span class="keyword" id="4805835">range</span>&nbsp;<span class="ident" id="4805841">vs</span>&nbsp;<span class="op" id="4805844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805849">dst</span><span class="op" id="4805852">.</span><span class="ident" id="4805853">Add</span><span class="op" id="4805856">(</span><span class="ident" id="4805857">k</span><span class="op" id="4805858">,</span>&nbsp;<span class="ident" id="4805860">value</span><span class="op" id="4805865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805872">}</span><br>
<span class="lineno"></span><span class="op" id="4805874">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="4805877">func</span>&nbsp;<span class="ident" id="4805882">parsePostForm</span><span class="op" id="4805895">(</span><span class="ident" id="4805896">r</span>&nbsp;<span class="op" id="4805898">*</span><span class="ident" id="4805899">Request</span><span class="op" id="4805906">)</span>&nbsp;<span class="op" id="4805908">(</span><span class="ident" id="4805909">vs</span>&nbsp;<span class="ident" id="4805912">url</span><span class="op" id="4805915">.</span><span class="ident" id="4805916">Values</span><span class="op" id="4805922">,</span>&nbsp;<span class="ident" id="4805924">err</span>&nbsp;<span class="builtintype" id="4805928">error</span><span class="op" id="4805933">)</span>&nbsp;<span class="op" id="4805935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805938">if</span>&nbsp;<span class="ident" id="4805941">r</span><span class="op" id="4805942">.</span><span class="ident" id="4805943">Body</span>&nbsp;<span class="op" id="4805948">==</span>&nbsp;<span class="ident" id="4805951">nil</span>&nbsp;<span class="op" id="4805955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805959">err</span>&nbsp;<span class="op" id="4805963">=</span>&nbsp;<span class="ident" id="4805965">errors</span><span class="op" id="4805971">.</span><span class="ident" id="4805972">New</span><span class="op" id="4805975">(</span><span class="string" id="4805976">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="4805995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805999">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806010">ct</span>&nbsp;<span class="op" id="4806013">:=</span>&nbsp;<span class="ident" id="4806016">r</span><span class="op" id="4806017">.</span><span class="ident" id="4806018">Header</span><span class="op" id="4806024">.</span><span class="ident" id="4806025">Get</span><span class="op" id="4806028">(</span><span class="string" id="4806029">&#34;Content-Type&#34;</span><span class="op" id="4806043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806046">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806087">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806139">if</span>&nbsp;<span class="ident" id="4806142">ct</span>&nbsp;<span class="op" id="4806145">==</span>&nbsp;<span class="string" id="4806148">&#34;&#34;</span>&nbsp;<span class="op" id="4806151">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806155">ct</span>&nbsp;<span class="op" id="4806158">=</span>&nbsp;<span class="string" id="4806160">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806191">ct</span><span class="op" id="4806193">,</span>&nbsp;<span class="ident" id="4806195">_</span><span class="op" id="4806196">,</span>&nbsp;<span class="ident" id="4806198">err</span>&nbsp;<span class="op" id="4806202">=</span>&nbsp;<span class="ident" id="4806204">mime</span><span class="op" id="4806208">.</span><span class="ident" id="4806209">ParseMediaType</span><span class="op" id="4806223">(</span><span class="ident" id="4806224">ct</span><span class="op" id="4806226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806229">switch</span>&nbsp;<span class="op" id="4806236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806239">case</span>&nbsp;<span class="ident" id="4806244">ct</span>&nbsp;<span class="op" id="4806247">==</span>&nbsp;<span class="string" id="4806250">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="4806285">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806289">var</span>&nbsp;<span class="ident" id="4806293">reader</span>&nbsp;<span class="ident" id="4806300">io</span><span class="op" id="4806302">.</span><span class="ident" id="4806303">Reader</span>&nbsp;<span class="op" id="4806310">=</span>&nbsp;<span class="ident" id="4806312">r</span><span class="op" id="4806313">.</span><span class="ident" id="4806314">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806321">maxFormSize</span>&nbsp;<span class="op" id="4806333">:=</span>&nbsp;<span class="ident" id="4806336">int64</span><span class="op" id="4806341">(</span><span class="num" id="4806342">1</span><span class="op" id="4806343">&lt;&lt;</span><span class="num" id="4806345">63</span>&nbsp;<span class="op" id="4806348">-</span>&nbsp;<span class="num" id="4806350">1</span><span class="op" id="4806351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806355">if</span>&nbsp;<span class="ident" id="4806358">_</span><span class="op" id="4806359">,</span>&nbsp;<span class="ident" id="4806361">ok</span>&nbsp;<span class="op" id="4806364">:=</span>&nbsp;<span class="ident" id="4806367">r</span><span class="op" id="4806368">.</span><span class="ident" id="4806369">Body</span><span class="op" id="4806373">.</span><span class="op" id="4806374">(</span><span class="op" id="4806375">*</span><span class="ident" id="4806376">maxBytesReader</span><span class="op" id="4806390">)</span><span class="op" id="4806391">;</span>&nbsp;<span class="op" id="4806393">!</span><span class="ident" id="4806394">ok</span>&nbsp;<span class="op" id="4806397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806402">maxFormSize</span>&nbsp;<span class="op" id="4806414">=</span>&nbsp;<span class="ident" id="4806416">int64</span><span class="op" id="4806421">(</span><span class="num" id="4806422">10</span>&nbsp;<span class="op" id="4806425">&lt;&lt;</span>&nbsp;<span class="num" id="4806428">20</span><span class="op" id="4806430">)</span>&nbsp;<span class="comment" id="4806432">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806462">reader</span>&nbsp;<span class="op" id="4806469">=</span>&nbsp;<span class="ident" id="4806471">io</span><span class="op" id="4806473">.</span><span class="ident" id="4806474">LimitReader</span><span class="op" id="4806485">(</span><span class="ident" id="4806486">r</span><span class="op" id="4806487">.</span><span class="ident" id="4806488">Body</span><span class="op" id="4806492">,</span>&nbsp;<span class="ident" id="4806494">maxFormSize</span><span class="op" id="4806505">+</span><span class="num" id="4806506">1</span><span class="op" id="4806507">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806515">b</span><span class="op" id="4806516">,</span>&nbsp;<span class="ident" id="4806518">e</span>&nbsp;<span class="op" id="4806520">:=</span>&nbsp;<span class="ident" id="4806523">ioutil</span><span class="op" id="4806529">.</span><span class="ident" id="4806530">ReadAll</span><span class="op" id="4806537">(</span><span class="ident" id="4806538">reader</span><span class="op" id="4806544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806548">if</span>&nbsp;<span class="ident" id="4806551">e</span>&nbsp;<span class="op" id="4806553">!=</span>&nbsp;<span class="ident" id="4806556">nil</span>&nbsp;<span class="op" id="4806560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806565">if</span>&nbsp;<span class="ident" id="4806568">err</span>&nbsp;<span class="op" id="4806572">==</span>&nbsp;<span class="ident" id="4806575">nil</span>&nbsp;<span class="op" id="4806579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806585">err</span>&nbsp;<span class="op" id="4806589">=</span>&nbsp;<span class="ident" id="4806591">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806601">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806613">if</span>&nbsp;<span class="ident" id="4806616">int64</span><span class="op" id="4806621">(</span><span class="builtinfunc" id="4806622">len</span><span class="op" id="4806625">(</span><span class="ident" id="4806626">b</span><span class="op" id="4806627">)</span><span class="op" id="4806628">)</span>&nbsp;<span class="op" id="4806630">&gt;</span>&nbsp;<span class="ident" id="4806632">maxFormSize</span>&nbsp;<span class="op" id="4806644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806649">err</span>&nbsp;<span class="op" id="4806653">=</span>&nbsp;<span class="ident" id="4806655">errors</span><span class="op" id="4806661">.</span><span class="ident" id="4806662">New</span><span class="op" id="4806665">(</span><span class="string" id="4806666">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="4806688">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806693">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806706">vs</span><span class="op" id="4806708">,</span>&nbsp;<span class="ident" id="4806710">e</span>&nbsp;<span class="op" id="4806712">=</span>&nbsp;<span class="ident" id="4806714">url</span><span class="op" id="4806717">.</span><span class="ident" id="4806718">ParseQuery</span><span class="op" id="4806728">(</span><span class="builtintype" id="4806729">string</span><span class="op" id="4806735">(</span><span class="ident" id="4806736">b</span><span class="op" id="4806737">)</span><span class="op" id="4806738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806742">if</span>&nbsp;<span class="ident" id="4806745">err</span>&nbsp;<span class="op" id="4806749">==</span>&nbsp;<span class="ident" id="4806752">nil</span>&nbsp;<span class="op" id="4806756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806761">err</span>&nbsp;<span class="op" id="4806765">=</span>&nbsp;<span class="ident" id="4806767">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806774">case</span>&nbsp;<span class="ident" id="4806779">ct</span>&nbsp;<span class="op" id="4806782">==</span>&nbsp;<span class="string" id="4806785">&#34;multipart/form-data&#34;</span><span class="op" id="4806806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806810">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806881">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806930">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806975">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807016">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807065">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807115">return</span><br>
<span class="lineno">765</span><span class="op" id="4807122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4807125">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4807192">//</span><br>
<span class="lineno"></span><span class="comment" id="4807195">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="4807270">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4807322">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4807399">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4807413">//</span><br>
<span class="lineno"></span><span class="comment" id="4807416">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="4807494">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="4807525">//</span><br>
<span class="lineno"></span><span class="comment" id="4807528">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="4807581">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="4807602">func</span>&nbsp;<span class="op" id="4807607">(</span><span class="ident" id="4807608">r</span>&nbsp;<span class="op" id="4807610">*</span><span class="ident" id="4807611">Request</span><span class="op" id="4807618">)</span>&nbsp;<span class="ident" id="4807620">ParseForm</span><span class="op" id="4807629">(</span><span class="op" id="4807630">)</span>&nbsp;<span class="builtintype" id="4807632">error</span>&nbsp;<span class="op" id="4807638">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807641">var</span>&nbsp;<span class="ident" id="4807645">err</span>&nbsp;<span class="builtintype" id="4807649">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807656">if</span>&nbsp;<span class="ident" id="4807659">r</span><span class="op" id="4807660">.</span><span class="ident" id="4807661">PostForm</span>&nbsp;<span class="op" id="4807670">==</span>&nbsp;<span class="ident" id="4807673">nil</span>&nbsp;<span class="op" id="4807677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807681">if</span>&nbsp;<span class="ident" id="4807684">r</span><span class="op" id="4807685">.</span><span class="ident" id="4807686">Method</span>&nbsp;<span class="op" id="4807693">==</span>&nbsp;<span class="string" id="4807696">&#34;POST&#34;</span>&nbsp;<span class="op" id="4807703">||</span>&nbsp;<span class="ident" id="4807706">r</span><span class="op" id="4807707">.</span><span class="ident" id="4807708">Method</span>&nbsp;<span class="op" id="4807715">==</span>&nbsp;<span class="string" id="4807718">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4807724">||</span>&nbsp;<span class="ident" id="4807727">r</span><span class="op" id="4807728">.</span><span class="ident" id="4807729">Method</span>&nbsp;<span class="op" id="4807736">==</span>&nbsp;<span class="string" id="4807739">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="4807747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807752">r</span><span class="op" id="4807753">.</span><span class="ident" id="4807754">PostForm</span><span class="op" id="4807762">,</span>&nbsp;<span class="ident" id="4807764">err</span>&nbsp;<span class="op" id="4807768">=</span>&nbsp;<span class="ident" id="4807770">parsePostForm</span><span class="op" id="4807783">(</span><span class="ident" id="4807784">r</span><span class="op" id="4807785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807789">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807793">if</span>&nbsp;<span class="ident" id="4807796">r</span><span class="op" id="4807797">.</span><span class="ident" id="4807798">PostForm</span>&nbsp;<span class="op" id="4807807">==</span>&nbsp;<span class="ident" id="4807810">nil</span>&nbsp;<span class="op" id="4807814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807819">r</span><span class="op" id="4807820">.</span><span class="ident" id="4807821">PostForm</span>&nbsp;<span class="op" id="4807830">=</span>&nbsp;<span class="builtinfunc" id="4807832">make</span><span class="op" id="4807836">(</span><span class="ident" id="4807837">url</span><span class="op" id="4807840">.</span><span class="ident" id="4807841">Values</span><span class="op" id="4807847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807857">if</span>&nbsp;<span class="ident" id="4807860">r</span><span class="op" id="4807861">.</span><span class="ident" id="4807862">Form</span>&nbsp;<span class="op" id="4807867">==</span>&nbsp;<span class="ident" id="4807870">nil</span>&nbsp;<span class="op" id="4807874">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807878">if</span>&nbsp;<span class="builtinfunc" id="4807881">len</span><span class="op" id="4807884">(</span><span class="ident" id="4807885">r</span><span class="op" id="4807886">.</span><span class="ident" id="4807887">PostForm</span><span class="op" id="4807895">)</span>&nbsp;<span class="op" id="4807897">&gt;</span>&nbsp;<span class="num" id="4807899">0</span>&nbsp;<span class="op" id="4807901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807906">r</span><span class="op" id="4807907">.</span><span class="ident" id="4807908">Form</span>&nbsp;<span class="op" id="4807913">=</span>&nbsp;<span class="builtinfunc" id="4807915">make</span><span class="op" id="4807919">(</span><span class="ident" id="4807920">url</span><span class="op" id="4807923">.</span><span class="ident" id="4807924">Values</span><span class="op" id="4807930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807935">copyValues</span><span class="op" id="4807945">(</span><span class="ident" id="4807946">r</span><span class="op" id="4807947">.</span><span class="ident" id="4807948">Form</span><span class="op" id="4807952">,</span>&nbsp;<span class="ident" id="4807954">r</span><span class="op" id="4807955">.</span><span class="ident" id="4807956">PostForm</span><span class="op" id="4807964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807972">var</span>&nbsp;<span class="ident" id="4807976">newValues</span>&nbsp;<span class="ident" id="4807986">url</span><span class="op" id="4807989">.</span><span class="ident" id="4807990">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807999">if</span>&nbsp;<span class="ident" id="4808002">r</span><span class="op" id="4808003">.</span><span class="ident" id="4808004">URL</span>&nbsp;<span class="op" id="4808008">!=</span>&nbsp;<span class="ident" id="4808011">nil</span>&nbsp;<span class="op" id="4808015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808020">var</span>&nbsp;<span class="ident" id="4808024">e</span>&nbsp;<span class="builtintype" id="4808026">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808035">newValues</span><span class="op" id="4808044">,</span>&nbsp;<span class="ident" id="4808046">e</span>&nbsp;<span class="op" id="4808048">=</span>&nbsp;<span class="ident" id="4808050">url</span><span class="op" id="4808053">.</span><span class="ident" id="4808054">ParseQuery</span><span class="op" id="4808064">(</span><span class="ident" id="4808065">r</span><span class="op" id="4808066">.</span><span class="ident" id="4808067">URL</span><span class="op" id="4808070">.</span><span class="ident" id="4808071">RawQuery</span><span class="op" id="4808079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808084">if</span>&nbsp;<span class="ident" id="4808087">err</span>&nbsp;<span class="op" id="4808091">==</span>&nbsp;<span class="ident" id="4808094">nil</span>&nbsp;<span class="op" id="4808098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808104">err</span>&nbsp;<span class="op" id="4808108">=</span>&nbsp;<span class="ident" id="4808110">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808123">if</span>&nbsp;<span class="ident" id="4808126">newValues</span>&nbsp;<span class="op" id="4808136">==</span>&nbsp;<span class="ident" id="4808139">nil</span>&nbsp;<span class="op" id="4808143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808148">newValues</span>&nbsp;<span class="op" id="4808158">=</span>&nbsp;<span class="builtinfunc" id="4808160">make</span><span class="op" id="4808164">(</span><span class="ident" id="4808165">url</span><span class="op" id="4808168">.</span><span class="ident" id="4808169">Values</span><span class="op" id="4808175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808179">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808183">if</span>&nbsp;<span class="ident" id="4808186">r</span><span class="op" id="4808187">.</span><span class="ident" id="4808188">Form</span>&nbsp;<span class="op" id="4808193">==</span>&nbsp;<span class="ident" id="4808196">nil</span>&nbsp;<span class="op" id="4808200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808205">r</span><span class="op" id="4808206">.</span><span class="ident" id="4808207">Form</span>&nbsp;<span class="op" id="4808212">=</span>&nbsp;<span class="ident" id="4808214">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808226">}</span>&nbsp;<span class="keyword" id="4808228">else</span>&nbsp;<span class="op" id="4808233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808238">copyValues</span><span class="op" id="4808248">(</span><span class="ident" id="4808249">r</span><span class="op" id="4808250">.</span><span class="ident" id="4808251">Form</span><span class="op" id="4808255">,</span>&nbsp;<span class="ident" id="4808257">newValues</span><span class="op" id="4808266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808270">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808276">return</span>&nbsp;<span class="ident" id="4808283">err</span><br>
<span class="lineno"></span><span class="op" id="4808287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4808290">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="4808358">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4808434">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4808503">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4808531">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="4808583">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="4808657">func</span>&nbsp;<span class="op" id="4808662">(</span><span class="ident" id="4808663">r</span>&nbsp;<span class="op" id="4808665">*</span><span class="ident" id="4808666">Request</span><span class="op" id="4808673">)</span>&nbsp;<span class="ident" id="4808675">ParseMultipartForm</span><span class="op" id="4808693">(</span><span class="ident" id="4808694">maxMemory</span>&nbsp;<span class="ident" id="4808704">int64</span><span class="op" id="4808709">)</span>&nbsp;<span class="builtintype" id="4808711">error</span>&nbsp;<span class="op" id="4808717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808720">if</span>&nbsp;<span class="ident" id="4808723">r</span><span class="op" id="4808724">.</span><span class="ident" id="4808725">MultipartForm</span>&nbsp;<span class="op" id="4808739">==</span>&nbsp;<span class="ident" id="4808742">multipartByReader</span>&nbsp;<span class="op" id="4808760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808764">return</span>&nbsp;<span class="ident" id="4808771">errors</span><span class="op" id="4808777">.</span><span class="ident" id="4808778">New</span><span class="op" id="4808781">(</span><span class="string" id="4808782">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="4808826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808832">if</span>&nbsp;<span class="ident" id="4808835">r</span><span class="op" id="4808836">.</span><span class="ident" id="4808837">Form</span>&nbsp;<span class="op" id="4808842">==</span>&nbsp;<span class="ident" id="4808845">nil</span>&nbsp;<span class="op" id="4808849">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808853">err</span>&nbsp;<span class="op" id="4808857">:=</span>&nbsp;<span class="ident" id="4808860">r</span><span class="op" id="4808861">.</span><span class="ident" id="4808862">ParseForm</span><span class="op" id="4808871">(</span><span class="op" id="4808872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808876">if</span>&nbsp;<span class="ident" id="4808879">err</span>&nbsp;<span class="op" id="4808883">!=</span>&nbsp;<span class="ident" id="4808886">nil</span>&nbsp;<span class="op" id="4808890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808895">return</span>&nbsp;<span class="ident" id="4808902">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808911">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808914">if</span>&nbsp;<span class="ident" id="4808917">r</span><span class="op" id="4808918">.</span><span class="ident" id="4808919">MultipartForm</span>&nbsp;<span class="op" id="4808933">!=</span>&nbsp;<span class="ident" id="4808936">nil</span>&nbsp;<span class="op" id="4808940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808944">return</span>&nbsp;<span class="ident" id="4808951">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808960">mr</span><span class="op" id="4808962">,</span>&nbsp;<span class="ident" id="4808964">err</span>&nbsp;<span class="op" id="4808968">:=</span>&nbsp;<span class="ident" id="4808971">r</span><span class="op" id="4808972">.</span><span class="ident" id="4808973">multipartReader</span><span class="op" id="4808988">(</span><span class="op" id="4808989">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808992">if</span>&nbsp;<span class="ident" id="4808995">err</span>&nbsp;<span class="op" id="4808999">!=</span>&nbsp;<span class="ident" id="4809002">nil</span>&nbsp;<span class="op" id="4809006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809010">return</span>&nbsp;<span class="ident" id="4809017">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809026">f</span><span class="op" id="4809027">,</span>&nbsp;<span class="ident" id="4809029">err</span>&nbsp;<span class="op" id="4809033">:=</span>&nbsp;<span class="ident" id="4809036">mr</span><span class="op" id="4809038">.</span><span class="ident" id="4809039">ReadForm</span><span class="op" id="4809047">(</span><span class="ident" id="4809048">maxMemory</span><span class="op" id="4809057">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809060">if</span>&nbsp;<span class="ident" id="4809063">err</span>&nbsp;<span class="op" id="4809067">!=</span>&nbsp;<span class="ident" id="4809070">nil</span>&nbsp;<span class="op" id="4809074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809078">return</span>&nbsp;<span class="ident" id="4809085">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809093">for</span>&nbsp;<span class="ident" id="4809097">k</span><span class="op" id="4809098">,</span>&nbsp;<span class="ident" id="4809100">v</span>&nbsp;<span class="op" id="4809102">:=</span>&nbsp;<span class="keyword" id="4809105">range</span>&nbsp;<span class="ident" id="4809111">f</span><span class="op" id="4809112">.</span><span class="ident" id="4809113">Value</span>&nbsp;<span class="op" id="4809119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809123">r</span><span class="op" id="4809124">.</span><span class="ident" id="4809125">Form</span><span class="op" id="4809129">[</span><span class="ident" id="4809130">k</span><span class="op" id="4809131">]</span>&nbsp;<span class="op" id="4809133">=</span>&nbsp;<span class="builtinfunc" id="4809135">append</span><span class="op" id="4809141">(</span><span class="ident" id="4809142">r</span><span class="op" id="4809143">.</span><span class="ident" id="4809144">Form</span><span class="op" id="4809148">[</span><span class="ident" id="4809149">k</span><span class="op" id="4809150">]</span><span class="op" id="4809151">,</span>&nbsp;<span class="ident" id="4809153">v</span><span class="op" id="4809154">...</span><span class="op" id="4809157">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809163">r</span><span class="op" id="4809164">.</span><span class="ident" id="4809165">MultipartForm</span>&nbsp;<span class="op" id="4809179">=</span>&nbsp;<span class="ident" id="4809181">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809185">return</span>&nbsp;<span class="ident" id="4809192">nil</span><br>
<span class="lineno"></span><span class="op" id="4809196">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="4809199">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="4809274">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="4809352">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="4809429">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="4809472">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4809537">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4809576">func</span>&nbsp;<span class="op" id="4809581">(</span><span class="ident" id="4809582">r</span>&nbsp;<span class="op" id="4809584">*</span><span class="ident" id="4809585">Request</span><span class="op" id="4809592">)</span>&nbsp;<span class="ident" id="4809594">FormValue</span><span class="op" id="4809603">(</span><span class="ident" id="4809604">key</span>&nbsp;<span class="builtintype" id="4809608">string</span><span class="op" id="4809614">)</span>&nbsp;<span class="builtintype" id="4809616">string</span>&nbsp;<span class="op" id="4809623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809626">if</span>&nbsp;<span class="ident" id="4809629">r</span><span class="op" id="4809630">.</span><span class="ident" id="4809631">Form</span>&nbsp;<span class="op" id="4809636">==</span>&nbsp;<span class="ident" id="4809639">nil</span>&nbsp;<span class="op" id="4809643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809647">r</span><span class="op" id="4809648">.</span><span class="ident" id="4809649">ParseMultipartForm</span><span class="op" id="4809667">(</span><span class="ident" id="4809668">defaultMaxMemory</span><span class="op" id="4809684">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809690">if</span>&nbsp;<span class="ident" id="4809693">vs</span>&nbsp;<span class="op" id="4809696">:=</span>&nbsp;<span class="ident" id="4809699">r</span><span class="op" id="4809700">.</span><span class="ident" id="4809701">Form</span><span class="op" id="4809705">[</span><span class="ident" id="4809706">key</span><span class="op" id="4809709">]</span><span class="op" id="4809710">;</span>&nbsp;<span class="builtinfunc" id="4809712">len</span><span class="op" id="4809715">(</span><span class="ident" id="4809716">vs</span><span class="op" id="4809718">)</span>&nbsp;<span class="op" id="4809720">&gt;</span>&nbsp;<span class="num" id="4809722">0</span>&nbsp;<span class="op" id="4809724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809728">return</span>&nbsp;<span class="ident" id="4809735">vs</span><span class="op" id="4809737">[</span><span class="num" id="4809738">0</span><span class="op" id="4809739">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809745">return</span>&nbsp;<span class="string" id="4809752">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="4809755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809758">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="4809835">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4809893">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="4809974">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="4810017">func</span>&nbsp;<span class="op" id="4810022">(</span><span class="ident" id="4810023">r</span>&nbsp;<span class="op" id="4810025">*</span><span class="ident" id="4810026">Request</span><span class="op" id="4810033">)</span>&nbsp;<span class="ident" id="4810035">PostFormValue</span><span class="op" id="4810048">(</span><span class="ident" id="4810049">key</span>&nbsp;<span class="builtintype" id="4810053">string</span><span class="op" id="4810059">)</span>&nbsp;<span class="builtintype" id="4810061">string</span>&nbsp;<span class="op" id="4810068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810071">if</span>&nbsp;<span class="ident" id="4810074">r</span><span class="op" id="4810075">.</span><span class="ident" id="4810076">PostForm</span>&nbsp;<span class="op" id="4810085">==</span>&nbsp;<span class="ident" id="4810088">nil</span>&nbsp;<span class="op" id="4810092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810096">r</span><span class="op" id="4810097">.</span><span class="ident" id="4810098">ParseMultipartForm</span><span class="op" id="4810116">(</span><span class="ident" id="4810117">defaultMaxMemory</span><span class="op" id="4810133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810136">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810139">if</span>&nbsp;<span class="ident" id="4810142">vs</span>&nbsp;<span class="op" id="4810145">:=</span>&nbsp;<span class="ident" id="4810148">r</span><span class="op" id="4810149">.</span><span class="ident" id="4810150">PostForm</span><span class="op" id="4810158">[</span><span class="ident" id="4810159">key</span><span class="op" id="4810162">]</span><span class="op" id="4810163">;</span>&nbsp;<span class="builtinfunc" id="4810165">len</span><span class="op" id="4810168">(</span><span class="ident" id="4810169">vs</span><span class="op" id="4810171">)</span>&nbsp;<span class="op" id="4810173">&gt;</span>&nbsp;<span class="num" id="4810175">0</span>&nbsp;<span class="op" id="4810177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810181">return</span>&nbsp;<span class="ident" id="4810188">vs</span><span class="op" id="4810190">[</span><span class="num" id="4810191">0</span><span class="op" id="4810192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810198">return</span>&nbsp;<span class="string" id="4810205">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4810208">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="4810211">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4810273">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="4810338">func</span>&nbsp;<span class="op" id="4810343">(</span><span class="ident" id="4810344">r</span>&nbsp;<span class="op" id="4810346">*</span><span class="ident" id="4810347">Request</span><span class="op" id="4810354">)</span>&nbsp;<span class="ident" id="4810356">FormFile</span><span class="op" id="4810364">(</span><span class="ident" id="4810365">key</span>&nbsp;<span class="builtintype" id="4810369">string</span><span class="op" id="4810375">)</span>&nbsp;<span class="op" id="4810377">(</span><span class="ident" id="4810378">multipart</span><span class="op" id="4810387">.</span><span class="ident" id="4810388">File</span><span class="op" id="4810392">,</span>&nbsp;<span class="op" id="4810394">*</span><span class="ident" id="4810395">multipart</span><span class="op" id="4810404">.</span><span class="ident" id="4810405">FileHeader</span><span class="op" id="4810415">,</span>&nbsp;<span class="builtintype" id="4810417">error</span><span class="op" id="4810422">)</span>&nbsp;<span class="op" id="4810424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810427">if</span>&nbsp;<span class="ident" id="4810430">r</span><span class="op" id="4810431">.</span><span class="ident" id="4810432">MultipartForm</span>&nbsp;<span class="op" id="4810446">==</span>&nbsp;<span class="ident" id="4810449">multipartByReader</span>&nbsp;<span class="op" id="4810467">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810471">return</span>&nbsp;<span class="ident" id="4810478">nil</span><span class="op" id="4810481">,</span>&nbsp;<span class="ident" id="4810483">nil</span><span class="op" id="4810486">,</span>&nbsp;<span class="ident" id="4810488">errors</span><span class="op" id="4810494">.</span><span class="ident" id="4810495">New</span><span class="op" id="4810498">(</span><span class="string" id="4810499">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="4810543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810549">if</span>&nbsp;<span class="ident" id="4810552">r</span><span class="op" id="4810553">.</span><span class="ident" id="4810554">MultipartForm</span>&nbsp;<span class="op" id="4810568">==</span>&nbsp;<span class="ident" id="4810571">nil</span>&nbsp;<span class="op" id="4810575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810579">err</span>&nbsp;<span class="op" id="4810583">:=</span>&nbsp;<span class="ident" id="4810586">r</span><span class="op" id="4810587">.</span><span class="ident" id="4810588">ParseMultipartForm</span><span class="op" id="4810606">(</span><span class="ident" id="4810607">defaultMaxMemory</span><span class="op" id="4810623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810627">if</span>&nbsp;<span class="ident" id="4810630">err</span>&nbsp;<span class="op" id="4810634">!=</span>&nbsp;<span class="ident" id="4810637">nil</span>&nbsp;<span class="op" id="4810641">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810646">return</span>&nbsp;<span class="ident" id="4810653">nil</span><span class="op" id="4810656">,</span>&nbsp;<span class="ident" id="4810658">nil</span><span class="op" id="4810661">,</span>&nbsp;<span class="ident" id="4810663">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810675">if</span>&nbsp;<span class="ident" id="4810678">r</span><span class="op" id="4810679">.</span><span class="ident" id="4810680">MultipartForm</span>&nbsp;<span class="op" id="4810694">!=</span>&nbsp;<span class="ident" id="4810697">nil</span>&nbsp;<span class="op" id="4810701">&amp;&amp;</span>&nbsp;<span class="ident" id="4810704">r</span><span class="op" id="4810705">.</span><span class="ident" id="4810706">MultipartForm</span><span class="op" id="4810719">.</span><span class="ident" id="4810720">File</span>&nbsp;<span class="op" id="4810725">!=</span>&nbsp;<span class="ident" id="4810728">nil</span>&nbsp;<span class="op" id="4810732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810736">if</span>&nbsp;<span class="ident" id="4810739">fhs</span>&nbsp;<span class="op" id="4810743">:=</span>&nbsp;<span class="ident" id="4810746">r</span><span class="op" id="4810747">.</span><span class="ident" id="4810748">MultipartForm</span><span class="op" id="4810761">.</span><span class="ident" id="4810762">File</span><span class="op" id="4810766">[</span><span class="ident" id="4810767">key</span><span class="op" id="4810770">]</span><span class="op" id="4810771">;</span>&nbsp;<span class="builtinfunc" id="4810773">len</span><span class="op" id="4810776">(</span><span class="ident" id="4810777">fhs</span><span class="op" id="4810780">)</span>&nbsp;<span class="op" id="4810782">&gt;</span>&nbsp;<span class="num" id="4810784">0</span>&nbsp;<span class="op" id="4810786">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810791">f</span><span class="op" id="4810792">,</span>&nbsp;<span class="ident" id="4810794">err</span>&nbsp;<span class="op" id="4810798">:=</span>&nbsp;<span class="ident" id="4810801">fhs</span><span class="op" id="4810804">[</span><span class="num" id="4810805">0</span><span class="op" id="4810806">]</span><span class="op" id="4810807">.</span><span class="ident" id="4810808">Open</span><span class="op" id="4810812">(</span><span class="op" id="4810813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810818">return</span>&nbsp;<span class="ident" id="4810825">f</span><span class="op" id="4810826">,</span>&nbsp;<span class="ident" id="4810828">fhs</span><span class="op" id="4810831">[</span><span class="num" id="4810832">0</span><span class="op" id="4810833">]</span><span class="op" id="4810834">,</span>&nbsp;<span class="ident" id="4810836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810848">return</span>&nbsp;<span class="ident" id="4810855">nil</span><span class="op" id="4810858">,</span>&nbsp;<span class="ident" id="4810860">nil</span><span class="op" id="4810863">,</span>&nbsp;<span class="ident" id="4810865">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="4810880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4810883">func</span>&nbsp;<span class="op" id="4810888">(</span><span class="ident" id="4810889">r</span>&nbsp;<span class="op" id="4810891">*</span><span class="ident" id="4810892">Request</span><span class="op" id="4810899">)</span>&nbsp;<span class="ident" id="4810901">expectsContinue</span><span class="op" id="4810916">(</span><span class="op" id="4810917">)</span>&nbsp;<span class="builtintype" id="4810919">bool</span>&nbsp;<span class="op" id="4810924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810927">return</span>&nbsp;<span class="ident" id="4810934">hasToken</span><span class="op" id="4810942">(</span><span class="ident" id="4810943">r</span><span class="op" id="4810944">.</span><span class="ident" id="4810945">Header</span><span class="op" id="4810951">.</span><span class="ident" id="4810952">get</span><span class="op" id="4810955">(</span><span class="string" id="4810956">&#34;Expect&#34;</span><span class="op" id="4810964">)</span><span class="op" id="4810965">,</span>&nbsp;<span class="string" id="4810967">&#34;100-continue&#34;</span><span class="op" id="4810981">)</span><br>
<span class="lineno"></span><span class="op" id="4810983">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="4810986">func</span>&nbsp;<span class="op" id="4810991">(</span><span class="ident" id="4810992">r</span>&nbsp;<span class="op" id="4810994">*</span><span class="ident" id="4810995">Request</span><span class="op" id="4811002">)</span>&nbsp;<span class="ident" id="4811004">wantsHttp10KeepAlive</span><span class="op" id="4811024">(</span><span class="op" id="4811025">)</span>&nbsp;<span class="builtintype" id="4811027">bool</span>&nbsp;<span class="op" id="4811032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811035">if</span>&nbsp;<span class="ident" id="4811038">r</span><span class="op" id="4811039">.</span><span class="ident" id="4811040">ProtoMajor</span>&nbsp;<span class="op" id="4811051">!=</span>&nbsp;<span class="num" id="4811054">1</span>&nbsp;<span class="op" id="4811056">||</span>&nbsp;<span class="ident" id="4811059">r</span><span class="op" id="4811060">.</span><span class="ident" id="4811061">ProtoMinor</span>&nbsp;<span class="op" id="4811072">!=</span>&nbsp;<span class="num" id="4811075">0</span>&nbsp;<span class="op" id="4811077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811081">return</span>&nbsp;<span class="builtintype" id="4811088">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811095">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811098">return</span>&nbsp;<span class="ident" id="4811105">hasToken</span><span class="op" id="4811113">(</span><span class="ident" id="4811114">r</span><span class="op" id="4811115">.</span><span class="ident" id="4811116">Header</span><span class="op" id="4811122">.</span><span class="ident" id="4811123">get</span><span class="op" id="4811126">(</span><span class="string" id="4811127">&#34;Connection&#34;</span><span class="op" id="4811139">)</span><span class="op" id="4811140">,</span>&nbsp;<span class="string" id="4811142">&#34;keep-alive&#34;</span><span class="op" id="4811154">)</span><br>
<span class="lineno"></span><span class="op" id="4811156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4811159">func</span>&nbsp;<span class="op" id="4811164">(</span><span class="ident" id="4811165">r</span>&nbsp;<span class="op" id="4811167">*</span><span class="ident" id="4811168">Request</span><span class="op" id="4811175">)</span>&nbsp;<span class="ident" id="4811177">wantsClose</span><span class="op" id="4811187">(</span><span class="op" id="4811188">)</span>&nbsp;<span class="builtintype" id="4811190">bool</span>&nbsp;<span class="op" id="4811195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811198">return</span>&nbsp;<span class="ident" id="4811205">hasToken</span><span class="op" id="4811213">(</span><span class="ident" id="4811214">r</span><span class="op" id="4811215">.</span><span class="ident" id="4811216">Header</span><span class="op" id="4811222">.</span><span class="ident" id="4811223">get</span><span class="op" id="4811226">(</span><span class="string" id="4811227">&#34;Connection&#34;</span><span class="op" id="4811239">)</span><span class="op" id="4811240">,</span>&nbsp;<span class="string" id="4811242">&#34;close&#34;</span><span class="op" id="4811249">)</span><br>
<span class="lineno">915</span><span class="op" id="4811251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4811254">func</span>&nbsp;<span class="op" id="4811259">(</span><span class="ident" id="4811260">r</span>&nbsp;<span class="op" id="4811262">*</span><span class="ident" id="4811263">Request</span><span class="op" id="4811270">)</span>&nbsp;<span class="ident" id="4811272">closeBody</span><span class="op" id="4811281">(</span><span class="op" id="4811282">)</span>&nbsp;<span class="op" id="4811284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811287">if</span>&nbsp;<span class="ident" id="4811290">r</span><span class="op" id="4811291">.</span><span class="ident" id="4811292">Body</span>&nbsp;<span class="op" id="4811297">!=</span>&nbsp;<span class="ident" id="4811300">nil</span>&nbsp;<span class="op" id="4811304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811308">r</span><span class="op" id="4811309">.</span><span class="ident" id="4811310">Body</span><span class="op" id="4811314">.</span><span class="ident" id="4811315">Close</span><span class="op" id="4811320">(</span><span class="op" id="4811321">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811324">}</span><br>
<span class="lineno"></span><span class="op" id="4811326">}</span>
</div>
</body>
</html>
