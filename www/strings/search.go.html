<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2941314">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2941369">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2941423">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2941474">package</span>&nbsp;<span class="ident" id="2941482">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2941491">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2941568">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2941618">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2941686">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2941763">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2941798">type</span>&nbsp;<span class="ident" id="2941803">stringFinder</span>&nbsp;<span class="keyword" id="2941816">struct</span>&nbsp;<span class="op" id="2941823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2941826">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941891">pattern</span>&nbsp;<span class="builtintype" id="2941899">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2941908">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2941982">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942056">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942092">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942096">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942168">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942241">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942286">badCharSkip</span>&nbsp;<span class="op" id="2942298">[</span><span class="num" id="2942299">256</span><span class="op" id="2942302">]</span><span class="builtintype" id="2942303">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942309">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942385">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942457">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942499">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942503">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942575">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942649">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942719">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942792">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942857">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942892">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942896">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942971">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943039">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943113">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943179">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943247">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943317">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943388">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943461">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943518">goodSuffixSkip</span>&nbsp;<span class="op" id="2943533">[</span><span class="op" id="2943534">]</span><span class="builtintype" id="2943535">int</span><br>
<span class="lineno"></span><span class="op" id="2943539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2943542">func</span>&nbsp;<span class="ident" id="2943547">makeStringFinder</span><span class="op" id="2943563">(</span><span class="ident" id="2943564">pattern</span>&nbsp;<span class="builtintype" id="2943572">string</span><span class="op" id="2943578">)</span>&nbsp;<span class="op" id="2943580">*</span><span class="ident" id="2943581"><a href="/strings/search.go.html#2941803">stringFinder</a></span>&nbsp;<span class="op" id="2943594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943597">f</span>&nbsp;<span class="op" id="2943599">:=</span>&nbsp;<span class="op" id="2943602">&amp;</span><span class="ident" id="2943603"><a href="/strings/search.go.html#2941803">stringFinder</a></span><span class="op" id="2943615">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943619">pattern</span><span class="op" id="2943626">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2943635"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2943642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943646">goodSuffixSkip</span><span class="op" id="2943660">:</span>&nbsp;<span class="builtinfunc" id="2943662">make</span><span class="op" id="2943666">(</span><span class="op" id="2943667">[</span><span class="op" id="2943668">]</span><span class="builtintype" id="2943669">int</span><span class="op" id="2943672">,</span>&nbsp;<span class="builtinfunc" id="2943674">len</span><span class="op" id="2943677">(</span><span class="ident" id="2943678"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2943685">)</span><span class="op" id="2943686">)</span><span class="op" id="2943687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943693">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943753">last</span>&nbsp;<span class="op" id="2943758">:=</span>&nbsp;<span class="builtinfunc" id="2943761">len</span><span class="op" id="2943764">(</span><span class="ident" id="2943765"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2943772">)</span>&nbsp;<span class="op" id="2943774">-</span>&nbsp;<span class="num" id="2943776">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943780">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943811">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943871">for</span>&nbsp;<span class="ident" id="2943875">i</span>&nbsp;<span class="op" id="2943877">:=</span>&nbsp;<span class="keyword" id="2943880">range</span>&nbsp;<span class="ident" id="2943886"><a href="/strings/search.go.html#2943597">f</a></span><span class="op" id="2943887">.</span><span class="ident" id="2943888">badCharSkip</span>&nbsp;<span class="op" id="2943900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2943904"><a href="/strings/search.go.html#2943597">f</a></span><span class="op" id="2943905">.</span><span class="ident" id="2943906">badCharSkip</span><span class="op" id="2943917">[</span><span class="ident" id="2943918"><a href="/strings/search.go.html#2943875">i</a></span><span class="op" id="2943919">]</span>&nbsp;<span class="op" id="2943921">=</span>&nbsp;<span class="builtinfunc" id="2943923">len</span><span class="op" id="2943926">(</span><span class="ident" id="2943927"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2943934">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2943937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943940">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944013">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944088">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944129">for</span>&nbsp;<span class="ident" id="2944133">i</span>&nbsp;<span class="op" id="2944135">:=</span>&nbsp;<span class="num" id="2944138">0</span><span class="op" id="2944139">;</span>&nbsp;<span class="ident" id="2944141"><a href="/strings/search.go.html#2944133">i</a></span>&nbsp;<span class="op" id="2944143">&lt;</span>&nbsp;<span class="ident" id="2944145"><a href="/strings/search.go.html#2943753">last</a></span><span class="op" id="2944149">;</span>&nbsp;<span class="ident" id="2944151"><a href="/strings/search.go.html#2944133">i</a></span><span class="op" id="2944152">++</span>&nbsp;<span class="op" id="2944155">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944159"><a href="/strings/search.go.html#2943597">f</a></span><span class="op" id="2944160">.</span><span class="ident" id="2944161">badCharSkip</span><span class="op" id="2944172">[</span><span class="ident" id="2944173"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944180">[</span><span class="ident" id="2944181"><a href="/strings/search.go.html#2944133">i</a></span><span class="op" id="2944182">]</span><span class="op" id="2944183">]</span>&nbsp;<span class="op" id="2944185">=</span>&nbsp;<span class="ident" id="2944187"><a href="/strings/search.go.html#2943753">last</a></span>&nbsp;<span class="op" id="2944192">-</span>&nbsp;<span class="ident" id="2944194"><a href="/strings/search.go.html#2944133">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2944197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944201">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944230">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944304">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944317">lastPrefix</span>&nbsp;<span class="op" id="2944328">:=</span>&nbsp;<span class="ident" id="2944331"><a href="/strings/search.go.html#2943753">last</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944337">for</span>&nbsp;<span class="ident" id="2944341">i</span>&nbsp;<span class="op" id="2944343">:=</span>&nbsp;<span class="ident" id="2944346"><a href="/strings/search.go.html#2943753">last</a></span><span class="op" id="2944350">;</span>&nbsp;<span class="ident" id="2944352"><a href="/strings/search.go.html#2944341">i</a></span>&nbsp;<span class="op" id="2944354">&gt;=</span>&nbsp;<span class="num" id="2944357">0</span><span class="op" id="2944358">;</span>&nbsp;<span class="ident" id="2944360"><a href="/strings/search.go.html#2944341">i</a></span><span class="op" id="2944361">--</span>&nbsp;<span class="op" id="2944364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944368">if</span>&nbsp;<span class="ident" id="2944371"><a href="/strings/strings.go.html#2955362">HasPrefix</a></span><span class="op" id="2944380">(</span><span class="ident" id="2944381"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944388">,</span>&nbsp;<span class="ident" id="2944390"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944397">[</span><span class="ident" id="2944398"><a href="/strings/search.go.html#2944341">i</a></span><span class="op" id="2944399">+</span><span class="num" id="2944400">1</span><span class="op" id="2944401">:</span><span class="op" id="2944402">]</span><span class="op" id="2944403">)</span>&nbsp;<span class="op" id="2944405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944410"><a href="/strings/search.go.html#2944317">lastPrefix</a></span>&nbsp;<span class="op" id="2944421">=</span>&nbsp;<span class="ident" id="2944423"><a href="/strings/search.go.html#2944341">i</a></span>&nbsp;<span class="op" id="2944425">+</span>&nbsp;<span class="num" id="2944427">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2944431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944435">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944494"><a href="/strings/search.go.html#2943597">f</a></span><span class="op" id="2944495">.</span><span class="ident" id="2944496">goodSuffixSkip</span><span class="op" id="2944510">[</span><span class="ident" id="2944511"><a href="/strings/search.go.html#2944341">i</a></span><span class="op" id="2944512">]</span>&nbsp;<span class="op" id="2944514">=</span>&nbsp;<span class="ident" id="2944516"><a href="/strings/search.go.html#2944317">lastPrefix</a></span>&nbsp;<span class="op" id="2944527">+</span>&nbsp;<span class="ident" id="2944529"><a href="/strings/search.go.html#2943753">last</a></span>&nbsp;<span class="op" id="2944534">-</span>&nbsp;<span class="ident" id="2944536"><a href="/strings/search.go.html#2944341">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2944539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944542">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944617">for</span>&nbsp;<span class="ident" id="2944621">i</span>&nbsp;<span class="op" id="2944623">:=</span>&nbsp;<span class="num" id="2944626">0</span><span class="op" id="2944627">;</span>&nbsp;<span class="ident" id="2944629"><a href="/strings/search.go.html#2944621">i</a></span>&nbsp;<span class="op" id="2944631">&lt;</span>&nbsp;<span class="ident" id="2944633"><a href="/strings/search.go.html#2943753">last</a></span><span class="op" id="2944637">;</span>&nbsp;<span class="ident" id="2944639"><a href="/strings/search.go.html#2944621">i</a></span><span class="op" id="2944640">++</span>&nbsp;<span class="op" id="2944643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944647">lenSuffix</span>&nbsp;<span class="op" id="2944657">:=</span>&nbsp;<span class="ident" id="2944660"><a href="/strings/search.go.html#2944904">longestCommonSuffix</a></span><span class="op" id="2944679">(</span><span class="ident" id="2944680"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944687">,</span>&nbsp;<span class="ident" id="2944689"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944696">[</span><span class="num" id="2944697">1</span><span class="op" id="2944698">:</span><span class="ident" id="2944699"><a href="/strings/search.go.html#2944621">i</a></span><span class="op" id="2944700">+</span><span class="num" id="2944701">1</span><span class="op" id="2944702">]</span><span class="op" id="2944703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944707">if</span>&nbsp;<span class="ident" id="2944710"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944717">[</span><span class="ident" id="2944718"><a href="/strings/search.go.html#2944621">i</a></span><span class="op" id="2944719">-</span><span class="ident" id="2944720"><a href="/strings/search.go.html#2944647">lenSuffix</a></span><span class="op" id="2944729">]</span>&nbsp;<span class="op" id="2944731">!=</span>&nbsp;<span class="ident" id="2944734"><a href="/strings/search.go.html#2943564">pattern</a></span><span class="op" id="2944741">[</span><span class="ident" id="2944742"><a href="/strings/search.go.html#2943753">last</a></span><span class="op" id="2944746">-</span><span class="ident" id="2944747"><a href="/strings/search.go.html#2944647">lenSuffix</a></span><span class="op" id="2944756">]</span>&nbsp;<span class="op" id="2944758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944763">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944822"><a href="/strings/search.go.html#2943597">f</a></span><span class="op" id="2944823">.</span><span class="ident" id="2944824">goodSuffixSkip</span><span class="op" id="2944838">[</span><span class="ident" id="2944839"><a href="/strings/search.go.html#2943753">last</a></span><span class="op" id="2944843">-</span><span class="ident" id="2944844"><a href="/strings/search.go.html#2944647">lenSuffix</a></span><span class="op" id="2944853">]</span>&nbsp;<span class="op" id="2944855">=</span>&nbsp;<span class="ident" id="2944857"><a href="/strings/search.go.html#2944647">lenSuffix</a></span>&nbsp;<span class="op" id="2944867">+</span>&nbsp;<span class="ident" id="2944869"><a href="/strings/search.go.html#2943753">last</a></span>&nbsp;<span class="op" id="2944874">-</span>&nbsp;<span class="ident" id="2944876"><a href="/strings/search.go.html#2944621">i</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2944880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2944883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944887">return</span>&nbsp;<span class="ident" id="2944894"><a href="/strings/search.go.html#2943597">f</a></span><br>
<span class="lineno"></span><span class="op" id="2944896">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2944899">func</span>&nbsp;<span class="ident" id="2944904">longestCommonSuffix</span><span class="op" id="2944923">(</span><span class="ident" id="2944924">a</span><span class="op" id="2944925">,</span>&nbsp;<span class="ident" id="2944927">b</span>&nbsp;<span class="builtintype" id="2944929">string</span><span class="op" id="2944935">)</span>&nbsp;<span class="op" id="2944937">(</span><span class="ident" id="2944938">i</span>&nbsp;<span class="builtintype" id="2944940">int</span><span class="op" id="2944943">)</span>&nbsp;<span class="op" id="2944945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944948">for</span>&nbsp;<span class="op" id="2944952">;</span>&nbsp;<span class="ident" id="2944954"><a href="/strings/search.go.html#2944938">i</a></span>&nbsp;<span class="op" id="2944956">&lt;</span>&nbsp;<span class="builtinfunc" id="2944958">len</span><span class="op" id="2944961">(</span><span class="ident" id="2944962"><a href="/strings/search.go.html#2944924">a</a></span><span class="op" id="2944963">)</span>&nbsp;<span class="op" id="2944965">&amp;&amp;</span>&nbsp;<span class="ident" id="2944968"><a href="/strings/search.go.html#2944938">i</a></span>&nbsp;<span class="op" id="2944970">&lt;</span>&nbsp;<span class="builtinfunc" id="2944972">len</span><span class="op" id="2944975">(</span><span class="ident" id="2944976"><a href="/strings/search.go.html#2944927">b</a></span><span class="op" id="2944977">)</span><span class="op" id="2944978">;</span>&nbsp;<span class="ident" id="2944980"><a href="/strings/search.go.html#2944938">i</a></span><span class="op" id="2944981">++</span>&nbsp;<span class="op" id="2944984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2944988">if</span>&nbsp;<span class="ident" id="2944991"><a href="/strings/search.go.html#2944924">a</a></span><span class="op" id="2944992">[</span><span class="builtinfunc" id="2944993">len</span><span class="op" id="2944996">(</span><span class="ident" id="2944997"><a href="/strings/search.go.html#2944924">a</a></span><span class="op" id="2944998">)</span><span class="op" id="2944999">-</span><span class="num" id="2945000">1</span><span class="op" id="2945001">-</span><span class="ident" id="2945002"><a href="/strings/search.go.html#2944938">i</a></span><span class="op" id="2945003">]</span>&nbsp;<span class="op" id="2945005">!=</span>&nbsp;<span class="ident" id="2945008"><a href="/strings/search.go.html#2944927">b</a></span><span class="op" id="2945009">[</span><span class="builtinfunc" id="2945010">len</span><span class="op" id="2945013">(</span><span class="ident" id="2945014"><a href="/strings/search.go.html#2944927">b</a></span><span class="op" id="2945015">)</span><span class="op" id="2945016">-</span><span class="num" id="2945017">1</span><span class="op" id="2945018">-</span><span class="ident" id="2945019"><a href="/strings/search.go.html#2944938">i</a></span><span class="op" id="2945020">]</span>&nbsp;<span class="op" id="2945022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945027">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945041">return</span><br>
<span class="lineno"></span><span class="op" id="2945048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2945051">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2945128">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2945172">func</span>&nbsp;<span class="op" id="2945177">(</span><span class="ident" id="2945178">f</span>&nbsp;<span class="op" id="2945180">*</span><span class="ident" id="2945181"><a href="/strings/search.go.html#2941803">stringFinder</a></span><span class="op" id="2945193">)</span>&nbsp;<span class="ident" id="2945195">next</span><span class="op" id="2945199">(</span><span class="ident" id="2945200">text</span>&nbsp;<span class="builtintype" id="2945205">string</span><span class="op" id="2945211">)</span>&nbsp;<span class="builtintype" id="2945213">int</span>&nbsp;<span class="op" id="2945217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945220">i</span>&nbsp;<span class="op" id="2945222">:=</span>&nbsp;<span class="builtinfunc" id="2945225">len</span><span class="op" id="2945228">(</span><span class="ident" id="2945229"><a href="/strings/search.go.html#2945178">f</a></span><span class="op" id="2945230">.</span><span class="ident" id="2945231">pattern</span><span class="op" id="2945238">)</span>&nbsp;<span class="op" id="2945240">-</span>&nbsp;<span class="num" id="2945242">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945245">for</span>&nbsp;<span class="ident" id="2945249"><a href="/strings/search.go.html#2945220">i</a></span>&nbsp;<span class="op" id="2945251">&lt;</span>&nbsp;<span class="builtinfunc" id="2945253">len</span><span class="op" id="2945256">(</span><span class="ident" id="2945257"><a href="/strings/search.go.html#2945200">text</a></span><span class="op" id="2945261">)</span>&nbsp;<span class="op" id="2945263">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945267">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945341">j</span>&nbsp;<span class="op" id="2945343">:=</span>&nbsp;<span class="builtinfunc" id="2945346">len</span><span class="op" id="2945349">(</span><span class="ident" id="2945350"><a href="/strings/search.go.html#2945178">f</a></span><span class="op" id="2945351">.</span><span class="ident" id="2945352">pattern</span><span class="op" id="2945359">)</span>&nbsp;<span class="op" id="2945361">-</span>&nbsp;<span class="num" id="2945363">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945367">for</span>&nbsp;<span class="ident" id="2945371"><a href="/strings/search.go.html#2945341">j</a></span>&nbsp;<span class="op" id="2945373">&gt;=</span>&nbsp;<span class="num" id="2945376">0</span>&nbsp;<span class="op" id="2945378">&amp;&amp;</span>&nbsp;<span class="ident" id="2945381"><a href="/strings/search.go.html#2945200">text</a></span><span class="op" id="2945385">[</span><span class="ident" id="2945386"><a href="/strings/search.go.html#2945220">i</a></span><span class="op" id="2945387">]</span>&nbsp;<span class="op" id="2945389">==</span>&nbsp;<span class="ident" id="2945392"><a href="/strings/search.go.html#2945178">f</a></span><span class="op" id="2945393">.</span><span class="ident" id="2945394">pattern</span><span class="op" id="2945401">[</span><span class="ident" id="2945402"><a href="/strings/search.go.html#2945341">j</a></span><span class="op" id="2945403">]</span>&nbsp;<span class="op" id="2945405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945410"><a href="/strings/search.go.html#2945220">i</a></span><span class="op" id="2945411">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945417"><a href="/strings/search.go.html#2945341">j</a></span><span class="op" id="2945418">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945427">if</span>&nbsp;<span class="ident" id="2945430"><a href="/strings/search.go.html#2945341">j</a></span>&nbsp;<span class="op" id="2945432">&lt;</span>&nbsp;<span class="num" id="2945434">0</span>&nbsp;<span class="op" id="2945436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945441">return</span>&nbsp;<span class="ident" id="2945448"><a href="/strings/search.go.html#2945220">i</a></span>&nbsp;<span class="op" id="2945450">+</span>&nbsp;<span class="num" id="2945452">1</span>&nbsp;<span class="comment" id="2945454">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945469"><a href="/strings/search.go.html#2945220">i</a></span>&nbsp;<span class="op" id="2945471">+=</span>&nbsp;<span class="ident" id="2945474"><a href="/strings/search.go.html#2945545">max</a></span><span class="op" id="2945477">(</span><span class="ident" id="2945478"><a href="/strings/search.go.html#2945178">f</a></span><span class="op" id="2945479">.</span><span class="ident" id="2945480">badCharSkip</span><span class="op" id="2945491">[</span><span class="ident" id="2945492"><a href="/strings/search.go.html#2945200">text</a></span><span class="op" id="2945496">[</span><span class="ident" id="2945497"><a href="/strings/search.go.html#2945220">i</a></span><span class="op" id="2945498">]</span><span class="op" id="2945499">]</span><span class="op" id="2945500">,</span>&nbsp;<span class="ident" id="2945502"><a href="/strings/search.go.html#2945178">f</a></span><span class="op" id="2945503">.</span><span class="ident" id="2945504">goodSuffixSkip</span><span class="op" id="2945518">[</span><span class="ident" id="2945519"><a href="/strings/search.go.html#2945341">j</a></span><span class="op" id="2945520">]</span><span class="op" id="2945521">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945527">return</span>&nbsp;<span class="op" id="2945534">-</span><span class="num" id="2945535">1</span><br>
<span class="lineno"></span><span class="op" id="2945537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2945540">func</span>&nbsp;<span class="ident" id="2945545">max</span><span class="op" id="2945548">(</span><span class="ident" id="2945549">a</span><span class="op" id="2945550">,</span>&nbsp;<span class="ident" id="2945552">b</span>&nbsp;<span class="builtintype" id="2945554">int</span><span class="op" id="2945557">)</span>&nbsp;<span class="builtintype" id="2945559">int</span>&nbsp;<span class="op" id="2945563">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945566">if</span>&nbsp;<span class="ident" id="2945569"><a href="/strings/search.go.html#2945549">a</a></span>&nbsp;<span class="op" id="2945571">&gt;</span>&nbsp;<span class="ident" id="2945573"><a href="/strings/search.go.html#2945552">b</a></span>&nbsp;<span class="op" id="2945575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945579">return</span>&nbsp;<span class="ident" id="2945586"><a href="/strings/search.go.html#2945549">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945592">return</span>&nbsp;<span class="ident" id="2945599"><a href="/strings/search.go.html#2945552">b</a></span><br>
<span class="lineno"></span><span class="op" id="2945601">}</span>
</div>
</body>
</html>
