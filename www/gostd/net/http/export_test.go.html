<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html" class="current">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7474170">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7474226">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7474280">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7474331">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="7474400">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7474413">package</span>&nbsp;<span class="ident" id="7474421">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7474427">import</span>&nbsp;<span class="op" id="7474434">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7474437">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7474444">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7474455">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7474462">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7474465">func</span>&nbsp;<span class="ident" id="7474470">NewLoggingConn</span><span class="op" id="7474484">(</span><span class="ident" id="7474485">baseName</span>&nbsp;<span class="builtintype" id="7474494">string</span><span class="op" id="7474500">,</span>&nbsp;<span class="ident" id="7474502">c</span>&nbsp;<span class="ident" id="7474504">net</span><span class="op" id="7474507">.</span><span class="ident" id="7474508">Conn</span><span class="op" id="7474512">)</span>&nbsp;<span class="ident" id="7474514">net</span><span class="op" id="7474517">.</span><span class="ident" id="7474518">Conn</span>&nbsp;<span class="op" id="7474523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474526">return</span>&nbsp;<span class="ident" id="7474533">newLoggingConn</span><span class="op" id="7474547">(</span><span class="ident" id="7474548">baseName</span><span class="op" id="7474556">,</span>&nbsp;<span class="ident" id="7474558">c</span><span class="op" id="7474559">)</span><br>
<span class="lineno"></span><span class="op" id="7474561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7474564">var</span>&nbsp;<span class="ident" id="7474568">ExportAppendTime</span>&nbsp;<span class="op" id="7474585">=</span>&nbsp;<span class="ident" id="7474587">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7474599">func</span>&nbsp;<span class="op" id="7474604">(</span><span class="ident" id="7474605">t</span>&nbsp;<span class="op" id="7474607">*</span><span class="ident" id="7474608">Transport</span><span class="op" id="7474617">)</span>&nbsp;<span class="ident" id="7474619">NumPendingRequestsForTesting</span><span class="op" id="7474647">(</span><span class="op" id="7474648">)</span>&nbsp;<span class="builtintype" id="7474650">int</span>&nbsp;<span class="op" id="7474654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474657">t</span><span class="op" id="7474658">.</span><span class="ident" id="7474659">reqMu</span><span class="op" id="7474664">.</span><span class="ident" id="7474665">Lock</span><span class="op" id="7474669">(</span><span class="op" id="7474670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474673">defer</span>&nbsp;<span class="ident" id="7474679">t</span><span class="op" id="7474680">.</span><span class="ident" id="7474681">reqMu</span><span class="op" id="7474686">.</span><span class="ident" id="7474687">Unlock</span><span class="op" id="7474693">(</span><span class="op" id="7474694">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474697">return</span>&nbsp;<span class="builtinfunc" id="7474704">len</span><span class="op" id="7474707">(</span><span class="ident" id="7474708">t</span><span class="op" id="7474709">.</span><span class="ident" id="7474710">reqCanceler</span><span class="op" id="7474721">)</span><br>
<span class="lineno"></span><span class="op" id="7474723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7474726">func</span>&nbsp;<span class="op" id="7474731">(</span><span class="ident" id="7474732">t</span>&nbsp;<span class="op" id="7474734">*</span><span class="ident" id="7474735">Transport</span><span class="op" id="7474744">)</span>&nbsp;<span class="ident" id="7474746">IdleConnKeysForTesting</span><span class="op" id="7474768">(</span><span class="op" id="7474769">)</span>&nbsp;<span class="op" id="7474771">(</span><span class="ident" id="7474772">keys</span>&nbsp;<span class="op" id="7474777">[</span><span class="op" id="7474778">]</span><span class="builtintype" id="7474779">string</span><span class="op" id="7474785">)</span>&nbsp;<span class="op" id="7474787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474790">keys</span>&nbsp;<span class="op" id="7474795">=</span>&nbsp;<span class="builtinfunc" id="7474797">make</span><span class="op" id="7474801">(</span><span class="op" id="7474802">[</span><span class="op" id="7474803">]</span><span class="builtintype" id="7474804">string</span><span class="op" id="7474810">,</span>&nbsp;<span class="num" id="7474812">0</span><span class="op" id="7474813">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474816">t</span><span class="op" id="7474817">.</span><span class="ident" id="7474818">idleMu</span><span class="op" id="7474824">.</span><span class="ident" id="7474825">Lock</span><span class="op" id="7474829">(</span><span class="op" id="7474830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474833">defer</span>&nbsp;<span class="ident" id="7474839">t</span><span class="op" id="7474840">.</span><span class="ident" id="7474841">idleMu</span><span class="op" id="7474847">.</span><span class="ident" id="7474848">Unlock</span><span class="op" id="7474854">(</span><span class="op" id="7474855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474858">if</span>&nbsp;<span class="ident" id="7474861">t</span><span class="op" id="7474862">.</span><span class="ident" id="7474863">idleConn</span>&nbsp;<span class="op" id="7474872">==</span>&nbsp;<span class="builtintype" id="7474875">nil</span>&nbsp;<span class="op" id="7474879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474883">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7474891">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474894">for</span>&nbsp;<span class="ident" id="7474898">key</span>&nbsp;<span class="op" id="7474902">:=</span>&nbsp;<span class="keyword" id="7474905">range</span>&nbsp;<span class="ident" id="7474911">t</span><span class="op" id="7474912">.</span><span class="ident" id="7474913">idleConn</span>&nbsp;<span class="op" id="7474922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474926">keys</span>&nbsp;<span class="op" id="7474931">=</span>&nbsp;<span class="builtinfunc" id="7474933">append</span><span class="op" id="7474939">(</span><span class="ident" id="7474940">keys</span><span class="op" id="7474944">,</span>&nbsp;<span class="ident" id="7474946">key</span><span class="op" id="7474949">.</span><span class="ident" id="7474950">String</span><span class="op" id="7474956">(</span><span class="op" id="7474957">)</span><span class="op" id="7474958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7474961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7474964">return</span><br>
<span class="lineno"></span><span class="op" id="7474971">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7474974">func</span>&nbsp;<span class="op" id="7474979">(</span><span class="ident" id="7474980">t</span>&nbsp;<span class="op" id="7474982">*</span><span class="ident" id="7474983">Transport</span><span class="op" id="7474992">)</span>&nbsp;<span class="ident" id="7474994">IdleConnCountForTesting</span><span class="op" id="7475017">(</span><span class="ident" id="7475018">cacheKey</span>&nbsp;<span class="builtintype" id="7475027">string</span><span class="op" id="7475033">)</span>&nbsp;<span class="builtintype" id="7475035">int</span>&nbsp;<span class="op" id="7475039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475042">t</span><span class="op" id="7475043">.</span><span class="ident" id="7475044">idleMu</span><span class="op" id="7475050">.</span><span class="ident" id="7475051">Lock</span><span class="op" id="7475055">(</span><span class="op" id="7475056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475059">defer</span>&nbsp;<span class="ident" id="7475065">t</span><span class="op" id="7475066">.</span><span class="ident" id="7475067">idleMu</span><span class="op" id="7475073">.</span><span class="ident" id="7475074">Unlock</span><span class="op" id="7475080">(</span><span class="op" id="7475081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475084">if</span>&nbsp;<span class="ident" id="7475087">t</span><span class="op" id="7475088">.</span><span class="ident" id="7475089">idleConn</span>&nbsp;<span class="op" id="7475098">==</span>&nbsp;<span class="builtintype" id="7475101">nil</span>&nbsp;<span class="op" id="7475105">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475109">return</span>&nbsp;<span class="num" id="7475116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7475119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475122">for</span>&nbsp;<span class="ident" id="7475126">k</span><span class="op" id="7475127">,</span>&nbsp;<span class="ident" id="7475129">conns</span>&nbsp;<span class="op" id="7475135">:=</span>&nbsp;<span class="keyword" id="7475138">range</span>&nbsp;<span class="ident" id="7475144">t</span><span class="op" id="7475145">.</span><span class="ident" id="7475146">idleConn</span>&nbsp;<span class="op" id="7475155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475159">if</span>&nbsp;<span class="ident" id="7475162">k</span><span class="op" id="7475163">.</span><span class="ident" id="7475164">String</span><span class="op" id="7475170">(</span><span class="op" id="7475171">)</span>&nbsp;<span class="op" id="7475173">==</span>&nbsp;<span class="ident" id="7475176">cacheKey</span>&nbsp;<span class="op" id="7475185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475190">return</span>&nbsp;<span class="builtinfunc" id="7475197">len</span><span class="op" id="7475200">(</span><span class="ident" id="7475201">conns</span><span class="op" id="7475206">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7475210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7475213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475216">return</span>&nbsp;<span class="num" id="7475223">0</span><br>
<span class="lineno"></span><span class="op" id="7475225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7475228">func</span>&nbsp;<span class="op" id="7475233">(</span><span class="ident" id="7475234">t</span>&nbsp;<span class="op" id="7475236">*</span><span class="ident" id="7475237">Transport</span><span class="op" id="7475246">)</span>&nbsp;<span class="ident" id="7475248">IdleConnChMapSizeForTesting</span><span class="op" id="7475275">(</span><span class="op" id="7475276">)</span>&nbsp;<span class="builtintype" id="7475278">int</span>&nbsp;<span class="op" id="7475282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475285">t</span><span class="op" id="7475286">.</span><span class="ident" id="7475287">idleMu</span><span class="op" id="7475293">.</span><span class="ident" id="7475294">Lock</span><span class="op" id="7475298">(</span><span class="op" id="7475299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475302">defer</span>&nbsp;<span class="ident" id="7475308">t</span><span class="op" id="7475309">.</span><span class="ident" id="7475310">idleMu</span><span class="op" id="7475316">.</span><span class="ident" id="7475317">Unlock</span><span class="op" id="7475323">(</span><span class="op" id="7475324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475327">return</span>&nbsp;<span class="builtinfunc" id="7475334">len</span><span class="op" id="7475337">(</span><span class="ident" id="7475338">t</span><span class="op" id="7475339">.</span><span class="ident" id="7475340">idleConnCh</span><span class="op" id="7475350">)</span><br>
<span class="lineno"></span><span class="op" id="7475352">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7475355">func</span>&nbsp;<span class="op" id="7475360">(</span><span class="ident" id="7475361">t</span>&nbsp;<span class="op" id="7475363">*</span><span class="ident" id="7475364">Transport</span><span class="op" id="7475373">)</span>&nbsp;<span class="ident" id="7475375">IsIdleForTesting</span><span class="op" id="7475391">(</span><span class="op" id="7475392">)</span>&nbsp;<span class="builtintype" id="7475394">bool</span>&nbsp;<span class="op" id="7475399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475402">t</span><span class="op" id="7475403">.</span><span class="ident" id="7475404">idleMu</span><span class="op" id="7475410">.</span><span class="ident" id="7475411">Lock</span><span class="op" id="7475415">(</span><span class="op" id="7475416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475419">defer</span>&nbsp;<span class="ident" id="7475425">t</span><span class="op" id="7475426">.</span><span class="ident" id="7475427">idleMu</span><span class="op" id="7475433">.</span><span class="ident" id="7475434">Unlock</span><span class="op" id="7475440">(</span><span class="op" id="7475441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475444">return</span>&nbsp;<span class="ident" id="7475451">t</span><span class="op" id="7475452">.</span><span class="ident" id="7475453">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="7475462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7475465">func</span>&nbsp;<span class="op" id="7475470">(</span><span class="ident" id="7475471">t</span>&nbsp;<span class="op" id="7475473">*</span><span class="ident" id="7475474">Transport</span><span class="op" id="7475483">)</span>&nbsp;<span class="ident" id="7475485">RequestIdleConnChForTesting</span><span class="op" id="7475512">(</span><span class="op" id="7475513">)</span>&nbsp;<span class="op" id="7475515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475518">t</span><span class="op" id="7475519">.</span><span class="ident" id="7475520">getIdleConnCh</span><span class="op" id="7475533">(</span><span class="ident" id="7475534">connectMethod</span><span class="op" id="7475547">{</span><span class="builtintype" id="7475548">nil</span><span class="op" id="7475551">,</span>&nbsp;<span class="string" id="7475553">&#34;http&#34;</span><span class="op" id="7475559">,</span>&nbsp;<span class="string" id="7475561">&#34;example.com&#34;</span><span class="op" id="7475574">}</span><span class="op" id="7475575">)</span><br>
<span class="lineno"></span><span class="op" id="7475577">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7475580">func</span>&nbsp;<span class="op" id="7475585">(</span><span class="ident" id="7475586">t</span>&nbsp;<span class="op" id="7475588">*</span><span class="ident" id="7475589">Transport</span><span class="op" id="7475598">)</span>&nbsp;<span class="ident" id="7475600">PutIdleTestConn</span><span class="op" id="7475615">(</span><span class="op" id="7475616">)</span>&nbsp;<span class="builtintype" id="7475618">bool</span>&nbsp;<span class="op" id="7475623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475626">c</span><span class="op" id="7475627">,</span>&nbsp;<span class="ident" id="7475629">_</span>&nbsp;<span class="op" id="7475631">:=</span>&nbsp;<span class="ident" id="7475634">net</span><span class="op" id="7475637">.</span><span class="ident" id="7475638">Pipe</span><span class="op" id="7475642">(</span><span class="op" id="7475643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475646">return</span>&nbsp;<span class="ident" id="7475653">t</span><span class="op" id="7475654">.</span><span class="ident" id="7475655">putIdleConn</span><span class="op" id="7475666">(</span><span class="op" id="7475667">&amp;</span><span class="ident" id="7475668">persistConn</span><span class="op" id="7475679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475683">t</span><span class="op" id="7475684">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475693">t</span><span class="op" id="7475694">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475698">conn</span><span class="op" id="7475702">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475708">c</span><span class="op" id="7475709">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7475729">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475740">closech</span><span class="op" id="7475747">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="7475750">make</span><span class="op" id="7475754">(</span><span class="keyword" id="7475755">chan</span>&nbsp;<span class="keyword" id="7475760">struct</span><span class="op" id="7475766">{</span><span class="op" id="7475767">}</span><span class="op" id="7475768">)</span><span class="op" id="7475769">,</span>&nbsp;<span class="comment" id="7475771">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475796">cacheKey</span><span class="op" id="7475804">:</span>&nbsp;<span class="ident" id="7475806">connectMethodKey</span><span class="op" id="7475822">{</span><span class="string" id="7475823">&#34;&#34;</span><span class="op" id="7475825">,</span>&nbsp;<span class="string" id="7475827">&#34;http&#34;</span><span class="op" id="7475833">,</span>&nbsp;<span class="string" id="7475835">&#34;example.com&#34;</span><span class="op" id="7475848">}</span><span class="op" id="7475849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7475852">}</span><span class="op" id="7475853">)</span><br>
<span class="lineno"></span><span class="op" id="7475855">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7475858">func</span>&nbsp;<span class="ident" id="7475863">NewTestTimeoutHandler</span><span class="op" id="7475884">(</span><span class="ident" id="7475885">handler</span>&nbsp;<span class="ident" id="7475893">Handler</span><span class="op" id="7475900">,</span>&nbsp;<span class="ident" id="7475902">ch</span>&nbsp;<span class="op" id="7475905">&lt;-</span><span class="keyword" id="7475907">chan</span>&nbsp;<span class="ident" id="7475912">time</span><span class="op" id="7475916">.</span><span class="ident" id="7475917">Time</span><span class="op" id="7475921">)</span>&nbsp;<span class="ident" id="7475923">Handler</span>&nbsp;<span class="op" id="7475931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7475934">f</span>&nbsp;<span class="op" id="7475936">:=</span>&nbsp;<span class="keyword" id="7475939">func</span><span class="op" id="7475943">(</span><span class="op" id="7475944">)</span>&nbsp;<span class="op" id="7475946">&lt;-</span><span class="keyword" id="7475948">chan</span>&nbsp;<span class="ident" id="7475953">time</span><span class="op" id="7475957">.</span><span class="ident" id="7475958">Time</span>&nbsp;<span class="op" id="7475963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475967">return</span>&nbsp;<span class="ident" id="7475974">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7475978">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7475981">return</span>&nbsp;<span class="op" id="7475988">&amp;</span><span class="ident" id="7475989">timeoutHandler</span><span class="op" id="7476003">{</span><span class="ident" id="7476004">handler</span><span class="op" id="7476011">,</span>&nbsp;<span class="ident" id="7476013">f</span><span class="op" id="7476014">,</span>&nbsp;<span class="string" id="7476016">&#34;&#34;</span><span class="op" id="7476018">}</span><br>
<span class="lineno"></span><span class="op" id="7476020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7476023">func</span>&nbsp;<span class="ident" id="7476028">ResetCachedEnvironment</span><span class="op" id="7476050">(</span><span class="op" id="7476051">)</span>&nbsp;<span class="op" id="7476053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7476056">httpProxyEnv</span><span class="op" id="7476068">.</span><span class="ident" id="7476069">reset</span><span class="op" id="7476074">(</span><span class="op" id="7476075">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7476078">httpsProxyEnv</span><span class="op" id="7476091">.</span><span class="ident" id="7476092">reset</span><span class="op" id="7476097">(</span><span class="op" id="7476098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7476101">noProxyEnv</span><span class="op" id="7476111">.</span><span class="ident" id="7476112">reset</span><span class="op" id="7476117">(</span><span class="op" id="7476118">)</span><br>
<span class="lineno"></span><span class="op" id="7476120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7476123">var</span>&nbsp;<span class="ident" id="7476127">DefaultUserAgent</span>&nbsp;<span class="op" id="7476144">=</span>&nbsp;<span class="ident" id="7476146">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="7476164">func</span>&nbsp;<span class="ident" id="7476169">ExportRefererForURL</span><span class="op" id="7476188">(</span><span class="ident" id="7476189">lastReq</span><span class="op" id="7476196">,</span>&nbsp;<span class="ident" id="7476198">newReq</span>&nbsp;<span class="op" id="7476205">*</span><span class="ident" id="7476206">url</span><span class="op" id="7476209">.</span><span class="ident" id="7476210">URL</span><span class="op" id="7476213">)</span>&nbsp;<span class="builtintype" id="7476215">string</span>&nbsp;<span class="op" id="7476222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7476225">return</span>&nbsp;<span class="ident" id="7476232">refererForURL</span><span class="op" id="7476245">(</span><span class="ident" id="7476246">lastReq</span><span class="op" id="7476253">,</span>&nbsp;<span class="ident" id="7476255">newReq</span><span class="op" id="7476261">)</span><br>
<span class="lineno"></span><span class="op" id="7476263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="7476266">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="7476339">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="7476357">func</span>&nbsp;<span class="ident" id="7476362">SetPendingDialHooks</span><span class="op" id="7476381">(</span><span class="ident" id="7476382">before</span><span class="op" id="7476388">,</span>&nbsp;<span class="ident" id="7476390">after</span>&nbsp;<span class="keyword" id="7476396">func</span><span class="op" id="7476400">(</span><span class="op" id="7476401">)</span><span class="op" id="7476402">)</span>&nbsp;<span class="op" id="7476404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7476407">prePendingDial</span><span class="op" id="7476421">,</span>&nbsp;<span class="ident" id="7476423">postPendingDial</span>&nbsp;<span class="op" id="7476439">=</span>&nbsp;<span class="ident" id="7476441">before</span><span class="op" id="7476447">,</span>&nbsp;<span class="ident" id="7476449">after</span><br>
<span class="lineno"></span><span class="op" id="7476455">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7476458">var</span>&nbsp;<span class="ident" id="7476462">ExportServerNewConn</span>&nbsp;<span class="op" id="7476482">=</span>&nbsp;<span class="op" id="7476484">(</span><span class="op" id="7476485">*</span><span class="ident" id="7476486">Server</span><span class="op" id="7476492">)</span><span class="op" id="7476493">.</span><span class="ident" id="7476494">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7476503">var</span>&nbsp;<span class="ident" id="7476507">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="7476531">=</span>&nbsp;<span class="op" id="7476533">(</span><span class="op" id="7476534">*</span><span class="ident" id="7476535">conn</span><span class="op" id="7476539">)</span><span class="op" id="7476540">.</span><span class="ident" id="7476541">closeWriteAndWait</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
