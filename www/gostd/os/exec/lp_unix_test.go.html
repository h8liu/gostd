<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7415068">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7415124">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7415178">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7415229">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7415294">package</span>&nbsp;<span class="ident" id="7415302">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7415308">import</span>&nbsp;<span class="op" id="7415315">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7415318">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7415331">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7415337">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7415347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7415350">func</span>&nbsp;<span class="ident" id="7415355">TestLookPathUnixEmptyPath</span><span class="op" id="7415380">(</span><span class="ident" id="7415381">t</span>&nbsp;<span class="op" id="7415383">*</span><span class="ident" id="7415384">testing</span><span class="op" id="7415391">.</span><span class="ident" id="7415392">T</span><span class="op" id="7415393">)</span>&nbsp;<span class="op" id="7415395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415398">tmp</span><span class="op" id="7415401">,</span>&nbsp;<span class="ident" id="7415403">err</span>&nbsp;<span class="op" id="7415407">:=</span>&nbsp;<span class="ident" id="7415410">ioutil</span><span class="op" id="7415416">.</span><span class="ident" id="7415417">TempDir</span><span class="op" id="7415424">(</span><span class="string" id="7415425">&#34;&#34;</span><span class="op" id="7415427">,</span>&nbsp;<span class="string" id="7415429">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="7415456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415459">if</span>&nbsp;<span class="ident" id="7415462">err</span>&nbsp;<span class="op" id="7415466">!=</span>&nbsp;<span class="ident" id="7415469">nil</span>&nbsp;<span class="op" id="7415473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415477">t</span><span class="op" id="7415478">.</span><span class="ident" id="7415479">Fatal</span><span class="op" id="7415484">(</span><span class="string" id="7415485">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7415503">,</span>&nbsp;<span class="ident" id="7415505">err</span><span class="op" id="7415508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7415511">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415514">defer</span>&nbsp;<span class="ident" id="7415520">os</span><span class="op" id="7415522">.</span><span class="ident" id="7415523">RemoveAll</span><span class="op" id="7415532">(</span><span class="ident" id="7415533">tmp</span><span class="op" id="7415536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415539">wd</span><span class="op" id="7415541">,</span>&nbsp;<span class="ident" id="7415543">err</span>&nbsp;<span class="op" id="7415547">:=</span>&nbsp;<span class="ident" id="7415550">os</span><span class="op" id="7415552">.</span><span class="ident" id="7415553">Getwd</span><span class="op" id="7415558">(</span><span class="op" id="7415559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415562">if</span>&nbsp;<span class="ident" id="7415565">err</span>&nbsp;<span class="op" id="7415569">!=</span>&nbsp;<span class="ident" id="7415572">nil</span>&nbsp;<span class="op" id="7415576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415580">t</span><span class="op" id="7415581">.</span><span class="ident" id="7415582">Fatal</span><span class="op" id="7415587">(</span><span class="string" id="7415588">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7415604">,</span>&nbsp;<span class="ident" id="7415606">err</span><span class="op" id="7415609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7415612">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415615">err</span>&nbsp;<span class="op" id="7415619">=</span>&nbsp;<span class="ident" id="7415621">os</span><span class="op" id="7415623">.</span><span class="ident" id="7415624">Chdir</span><span class="op" id="7415629">(</span><span class="ident" id="7415630">tmp</span><span class="op" id="7415633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415636">if</span>&nbsp;<span class="ident" id="7415639">err</span>&nbsp;<span class="op" id="7415643">!=</span>&nbsp;<span class="ident" id="7415646">nil</span>&nbsp;<span class="op" id="7415650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415654">t</span><span class="op" id="7415655">.</span><span class="ident" id="7415656">Fatal</span><span class="op" id="7415661">(</span><span class="string" id="7415662">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7415678">,</span>&nbsp;<span class="ident" id="7415680">err</span><span class="op" id="7415683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7415686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415689">defer</span>&nbsp;<span class="ident" id="7415695">os</span><span class="op" id="7415697">.</span><span class="ident" id="7415698">Chdir</span><span class="op" id="7415703">(</span><span class="ident" id="7415704">wd</span><span class="op" id="7415706">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415710">f</span><span class="op" id="7415711">,</span>&nbsp;<span class="ident" id="7415713">err</span>&nbsp;<span class="op" id="7415717">:=</span>&nbsp;<span class="ident" id="7415720">os</span><span class="op" id="7415722">.</span><span class="ident" id="7415723">OpenFile</span><span class="op" id="7415731">(</span><span class="string" id="7415732">&#34;exec_me&#34;</span><span class="op" id="7415741">,</span>&nbsp;<span class="ident" id="7415743">os</span><span class="op" id="7415745">.</span><span class="ident" id="7415746">O_CREATE</span><span class="op" id="7415754">|</span><span class="ident" id="7415755">os</span><span class="op" id="7415757">.</span><span class="ident" id="7415758">O_EXCL</span><span class="op" id="7415764">,</span>&nbsp;<span class="num" id="7415766">0700</span><span class="op" id="7415770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415773">if</span>&nbsp;<span class="ident" id="7415776">err</span>&nbsp;<span class="op" id="7415780">!=</span>&nbsp;<span class="ident" id="7415783">nil</span>&nbsp;<span class="op" id="7415787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415791">t</span><span class="op" id="7415792">.</span><span class="ident" id="7415793">Fatal</span><span class="op" id="7415798">(</span><span class="string" id="7415799">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7415818">,</span>&nbsp;<span class="ident" id="7415820">err</span><span class="op" id="7415823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7415826">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415829">err</span>&nbsp;<span class="op" id="7415833">=</span>&nbsp;<span class="ident" id="7415835">f</span><span class="op" id="7415836">.</span><span class="ident" id="7415837">Close</span><span class="op" id="7415842">(</span><span class="op" id="7415843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415846">if</span>&nbsp;<span class="ident" id="7415849">err</span>&nbsp;<span class="op" id="7415853">!=</span>&nbsp;<span class="ident" id="7415856">nil</span>&nbsp;<span class="op" id="7415860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415864">t</span><span class="op" id="7415865">.</span><span class="ident" id="7415866">Fatal</span><span class="op" id="7415871">(</span><span class="string" id="7415872">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7415888">,</span>&nbsp;<span class="ident" id="7415890">err</span><span class="op" id="7415893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7415896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415900">pathenv</span>&nbsp;<span class="op" id="7415908">:=</span>&nbsp;<span class="ident" id="7415911">os</span><span class="op" id="7415913">.</span><span class="ident" id="7415914">Getenv</span><span class="op" id="7415920">(</span><span class="string" id="7415921">&#34;PATH&#34;</span><span class="op" id="7415927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415930">defer</span>&nbsp;<span class="ident" id="7415936">os</span><span class="op" id="7415938">.</span><span class="ident" id="7415939">Setenv</span><span class="op" id="7415945">(</span><span class="string" id="7415946">&#34;PATH&#34;</span><span class="op" id="7415952">,</span>&nbsp;<span class="ident" id="7415954">pathenv</span><span class="op" id="7415961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7415965">err</span>&nbsp;<span class="op" id="7415969">=</span>&nbsp;<span class="ident" id="7415971">os</span><span class="op" id="7415973">.</span><span class="ident" id="7415974">Setenv</span><span class="op" id="7415980">(</span><span class="string" id="7415981">&#34;PATH&#34;</span><span class="op" id="7415987">,</span>&nbsp;<span class="string" id="7415989">&#34;&#34;</span><span class="op" id="7415991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7415994">if</span>&nbsp;<span class="ident" id="7415997">err</span>&nbsp;<span class="op" id="7416001">!=</span>&nbsp;<span class="ident" id="7416004">nil</span>&nbsp;<span class="op" id="7416008">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7416012">t</span><span class="op" id="7416013">.</span><span class="ident" id="7416014">Fatal</span><span class="op" id="7416019">(</span><span class="string" id="7416020">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7416037">,</span>&nbsp;<span class="ident" id="7416039">err</span><span class="op" id="7416042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7416045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7416049">path</span><span class="op" id="7416053">,</span>&nbsp;<span class="ident" id="7416055">err</span>&nbsp;<span class="op" id="7416059">:=</span>&nbsp;<span class="ident" id="7416062">LookPath</span><span class="op" id="7416070">(</span><span class="string" id="7416071">&#34;exec_me&#34;</span><span class="op" id="7416080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7416083">if</span>&nbsp;<span class="ident" id="7416086">err</span>&nbsp;<span class="op" id="7416090">==</span>&nbsp;<span class="ident" id="7416093">nil</span>&nbsp;<span class="op" id="7416097">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7416101">t</span><span class="op" id="7416102">.</span><span class="ident" id="7416103">Fatal</span><span class="op" id="7416108">(</span><span class="string" id="7416109">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="7416148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7416151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7416154">if</span>&nbsp;<span class="ident" id="7416157">path</span>&nbsp;<span class="op" id="7416162">!=</span>&nbsp;<span class="string" id="7416165">&#34;&#34;</span>&nbsp;<span class="op" id="7416168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7416172">t</span><span class="op" id="7416173">.</span><span class="ident" id="7416174">Fatalf</span><span class="op" id="7416180">(</span><span class="string" id="7416181">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7416218">,</span>&nbsp;<span class="ident" id="7416220">path</span><span class="op" id="7416224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7416227">}</span><br>
<span class="lineno">55</span><span class="op" id="7416229">}</span>
</div>
</body>
</html>
