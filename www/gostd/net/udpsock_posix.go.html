<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3270298">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3270354">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3270408">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3270459">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3270537">package</span>&nbsp;<span class="ident" id="3270545">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3270550">import</span>&nbsp;<span class="op" id="3270557">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3270560">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3270571">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3270578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3270581">func</span>&nbsp;<span class="ident" id="3270586">sockaddrToUDP</span><span class="op" id="3270599">(</span><span class="ident" id="3270600">sa</span>&nbsp;<span class="ident" id="3270603">syscall</span><span class="op" id="3270610">.</span><span class="ident" id="3270611">Sockaddr</span><span class="op" id="3270619">)</span>&nbsp;<span class="ident" id="3270621">Addr</span>&nbsp;<span class="op" id="3270626">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270629">switch</span>&nbsp;<span class="ident" id="3270636">sa</span>&nbsp;<span class="op" id="3270639">:=</span>&nbsp;<span class="ident" id="3270642">sa</span><span class="op" id="3270644">.</span><span class="op" id="3270645">(</span><span class="keyword" id="3270646">type</span><span class="op" id="3270650">)</span>&nbsp;<span class="op" id="3270652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270655">case</span>&nbsp;<span class="op" id="3270660">*</span><span class="ident" id="3270661">syscall</span><span class="op" id="3270668">.</span><span class="ident" id="3270669">SockaddrInet4</span><span class="op" id="3270682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270686">return</span>&nbsp;<span class="op" id="3270693">&amp;</span><span class="ident" id="3270694">UDPAddr</span><span class="op" id="3270701">{</span><span class="ident" id="3270702">IP</span><span class="op" id="3270704">:</span>&nbsp;<span class="ident" id="3270706">sa</span><span class="op" id="3270708">.</span><span class="ident" id="3270709">Addr</span><span class="op" id="3270713">[</span><span class="num" id="3270714">0</span><span class="op" id="3270715">:</span><span class="op" id="3270716">]</span><span class="op" id="3270717">,</span>&nbsp;<span class="ident" id="3270719">Port</span><span class="op" id="3270723">:</span>&nbsp;<span class="ident" id="3270725">sa</span><span class="op" id="3270727">.</span><span class="ident" id="3270728">Port</span><span class="op" id="3270732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270735">case</span>&nbsp;<span class="op" id="3270740">*</span><span class="ident" id="3270741">syscall</span><span class="op" id="3270748">.</span><span class="ident" id="3270749">SockaddrInet6</span><span class="op" id="3270762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270766">return</span>&nbsp;<span class="op" id="3270773">&amp;</span><span class="ident" id="3270774">UDPAddr</span><span class="op" id="3270781">{</span><span class="ident" id="3270782">IP</span><span class="op" id="3270784">:</span>&nbsp;<span class="ident" id="3270786">sa</span><span class="op" id="3270788">.</span><span class="ident" id="3270789">Addr</span><span class="op" id="3270793">[</span><span class="num" id="3270794">0</span><span class="op" id="3270795">:</span><span class="op" id="3270796">]</span><span class="op" id="3270797">,</span>&nbsp;<span class="ident" id="3270799">Port</span><span class="op" id="3270803">:</span>&nbsp;<span class="ident" id="3270805">sa</span><span class="op" id="3270807">.</span><span class="ident" id="3270808">Port</span><span class="op" id="3270812">,</span>&nbsp;<span class="ident" id="3270814">Zone</span><span class="op" id="3270818">:</span>&nbsp;<span class="ident" id="3270820">zoneToString</span><span class="op" id="3270832">(</span><span class="builtintype" id="3270833">int</span><span class="op" id="3270836">(</span><span class="ident" id="3270837">sa</span><span class="op" id="3270839">.</span><span class="ident" id="3270840">ZoneId</span><span class="op" id="3270846">)</span><span class="op" id="3270847">)</span><span class="op" id="3270848">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3270851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270854">return</span>&nbsp;<span class="ident" id="3270861">nil</span><br>
<span class="lineno"></span><span class="op" id="3270865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3270868">func</span>&nbsp;<span class="op" id="3270873">(</span><span class="ident" id="3270874">a</span>&nbsp;<span class="op" id="3270876">*</span><span class="ident" id="3270877">UDPAddr</span><span class="op" id="3270884">)</span>&nbsp;<span class="ident" id="3270886">family</span><span class="op" id="3270892">(</span><span class="op" id="3270893">)</span>&nbsp;<span class="builtintype" id="3270895">int</span>&nbsp;<span class="op" id="3270899">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270902">if</span>&nbsp;<span class="ident" id="3270905">a</span>&nbsp;<span class="op" id="3270907">==</span>&nbsp;<span class="ident" id="3270910">nil</span>&nbsp;<span class="op" id="3270914">||</span>&nbsp;<span class="builtinfunc" id="3270917">len</span><span class="op" id="3270920">(</span><span class="ident" id="3270921">a</span><span class="op" id="3270922">.</span><span class="ident" id="3270923">IP</span><span class="op" id="3270925">)</span>&nbsp;<span class="op" id="3270927">&lt;=</span>&nbsp;<span class="ident" id="3270930">IPv4len</span>&nbsp;<span class="op" id="3270938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270942">return</span>&nbsp;<span class="ident" id="3270949">syscall</span><span class="op" id="3270956">.</span><span class="ident" id="3270957">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3270966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270969">if</span>&nbsp;<span class="ident" id="3270972">a</span><span class="op" id="3270973">.</span><span class="ident" id="3270974">IP</span><span class="op" id="3270976">.</span><span class="ident" id="3270977">To4</span><span class="op" id="3270980">(</span><span class="op" id="3270981">)</span>&nbsp;<span class="op" id="3270983">!=</span>&nbsp;<span class="ident" id="3270986">nil</span>&nbsp;<span class="op" id="3270990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3270994">return</span>&nbsp;<span class="ident" id="3271001">syscall</span><span class="op" id="3271008">.</span><span class="ident" id="3271009">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3271018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271021">return</span>&nbsp;<span class="ident" id="3271028">syscall</span><span class="op" id="3271035">.</span><span class="ident" id="3271036">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3271045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3271048">func</span>&nbsp;<span class="op" id="3271053">(</span><span class="ident" id="3271054">a</span>&nbsp;<span class="op" id="3271056">*</span><span class="ident" id="3271057">UDPAddr</span><span class="op" id="3271064">)</span>&nbsp;<span class="ident" id="3271066">isWildcard</span><span class="op" id="3271076">(</span><span class="op" id="3271077">)</span>&nbsp;<span class="builtintype" id="3271079">bool</span>&nbsp;<span class="op" id="3271084">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271087">if</span>&nbsp;<span class="ident" id="3271090">a</span>&nbsp;<span class="op" id="3271092">==</span>&nbsp;<span class="ident" id="3271095">nil</span>&nbsp;<span class="op" id="3271099">||</span>&nbsp;<span class="ident" id="3271102">a</span><span class="op" id="3271103">.</span><span class="ident" id="3271104">IP</span>&nbsp;<span class="op" id="3271107">==</span>&nbsp;<span class="ident" id="3271110">nil</span>&nbsp;<span class="op" id="3271114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271118">return</span>&nbsp;<span class="builtintype" id="3271125">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3271131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271134">return</span>&nbsp;<span class="ident" id="3271141">a</span><span class="op" id="3271142">.</span><span class="ident" id="3271143">IP</span><span class="op" id="3271145">.</span><span class="ident" id="3271146">IsUnspecified</span><span class="op" id="3271159">(</span><span class="op" id="3271160">)</span><br>
<span class="lineno"></span><span class="op" id="3271162">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3271165">func</span>&nbsp;<span class="op" id="3271170">(</span><span class="ident" id="3271171">a</span>&nbsp;<span class="op" id="3271173">*</span><span class="ident" id="3271174">UDPAddr</span><span class="op" id="3271181">)</span>&nbsp;<span class="ident" id="3271183">sockaddr</span><span class="op" id="3271191">(</span><span class="ident" id="3271192">family</span>&nbsp;<span class="builtintype" id="3271199">int</span><span class="op" id="3271202">)</span>&nbsp;<span class="op" id="3271204">(</span><span class="ident" id="3271205">syscall</span><span class="op" id="3271212">.</span><span class="ident" id="3271213">Sockaddr</span><span class="op" id="3271221">,</span>&nbsp;<span class="builtintype" id="3271223">error</span><span class="op" id="3271228">)</span>&nbsp;<span class="op" id="3271230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271233">if</span>&nbsp;<span class="ident" id="3271236">a</span>&nbsp;<span class="op" id="3271238">==</span>&nbsp;<span class="ident" id="3271241">nil</span>&nbsp;<span class="op" id="3271245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271249">return</span>&nbsp;<span class="ident" id="3271256">nil</span><span class="op" id="3271259">,</span>&nbsp;<span class="ident" id="3271261">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3271266">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271269">return</span>&nbsp;<span class="ident" id="3271276">ipToSockaddr</span><span class="op" id="3271288">(</span><span class="ident" id="3271289">family</span><span class="op" id="3271295">,</span>&nbsp;<span class="ident" id="3271297">a</span><span class="op" id="3271298">.</span><span class="ident" id="3271299">IP</span><span class="op" id="3271301">,</span>&nbsp;<span class="ident" id="3271303">a</span><span class="op" id="3271304">.</span><span class="ident" id="3271305">Port</span><span class="op" id="3271309">,</span>&nbsp;<span class="ident" id="3271311">a</span><span class="op" id="3271312">.</span><span class="ident" id="3271313">Zone</span><span class="op" id="3271317">)</span><br>
<span class="lineno"></span><span class="op" id="3271319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3271322">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3271393">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3271425">type</span>&nbsp;<span class="ident" id="3271430">UDPConn</span>&nbsp;<span class="keyword" id="3271438">struct</span>&nbsp;<span class="op" id="3271445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3271448">conn</span><br>
<span class="lineno"></span><span class="op" id="3271453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3271456">func</span>&nbsp;<span class="ident" id="3271461">newUDPConn</span><span class="op" id="3271471">(</span><span class="ident" id="3271472">fd</span>&nbsp;<span class="op" id="3271475">*</span><span class="ident" id="3271476">netFD</span><span class="op" id="3271481">)</span>&nbsp;<span class="op" id="3271483">*</span><span class="ident" id="3271484">UDPConn</span>&nbsp;<span class="op" id="3271492">{</span>&nbsp;<span class="keyword" id="3271494">return</span>&nbsp;<span class="op" id="3271501">&amp;</span><span class="ident" id="3271502">UDPConn</span><span class="op" id="3271509">{</span><span class="ident" id="3271510">conn</span><span class="op" id="3271514">{</span><span class="ident" id="3271515">fd</span><span class="op" id="3271517">}</span><span class="op" id="3271518">}</span>&nbsp;<span class="op" id="3271520">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3271523">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3271593">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3271664">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3271691">//</span><br>
<span class="lineno">60</span><span class="comment" id="3271694">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3271758">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3271825">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3271845">func</span>&nbsp;<span class="op" id="3271850">(</span><span class="ident" id="3271851">c</span>&nbsp;<span class="op" id="3271853">*</span><span class="ident" id="3271854">UDPConn</span><span class="op" id="3271861">)</span>&nbsp;<span class="ident" id="3271863">ReadFromUDP</span><span class="op" id="3271874">(</span><span class="ident" id="3271875">b</span>&nbsp;<span class="op" id="3271877">[</span><span class="op" id="3271878">]</span><span class="builtintype" id="3271879">byte</span><span class="op" id="3271883">)</span>&nbsp;<span class="op" id="3271885">(</span><span class="ident" id="3271886">n</span>&nbsp;<span class="builtintype" id="3271888">int</span><span class="op" id="3271891">,</span>&nbsp;<span class="ident" id="3271893">addr</span>&nbsp;<span class="op" id="3271898">*</span><span class="ident" id="3271899">UDPAddr</span><span class="op" id="3271906">,</span>&nbsp;<span class="ident" id="3271908">err</span>&nbsp;<span class="builtintype" id="3271912">error</span><span class="op" id="3271917">)</span>&nbsp;<span class="op" id="3271919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271922">if</span>&nbsp;<span class="op" id="3271925">!</span><span class="ident" id="3271926">c</span><span class="op" id="3271927">.</span><span class="ident" id="3271928">ok</span><span class="op" id="3271930">(</span><span class="op" id="3271931">)</span>&nbsp;<span class="op" id="3271933">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3271937">return</span>&nbsp;<span class="num" id="3271944">0</span><span class="op" id="3271945">,</span>&nbsp;<span class="ident" id="3271947">nil</span><span class="op" id="3271950">,</span>&nbsp;<span class="ident" id="3271952">syscall</span><span class="op" id="3271959">.</span><span class="ident" id="3271960">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3271968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3271971">n</span><span class="op" id="3271972">,</span>&nbsp;<span class="ident" id="3271974">sa</span><span class="op" id="3271976">,</span>&nbsp;<span class="ident" id="3271978">err</span>&nbsp;<span class="op" id="3271982">:=</span>&nbsp;<span class="ident" id="3271985">c</span><span class="op" id="3271986">.</span><span class="ident" id="3271987">fd</span><span class="op" id="3271989">.</span><span class="ident" id="3271990">readFrom</span><span class="op" id="3271998">(</span><span class="ident" id="3271999">b</span><span class="op" id="3272000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272003">switch</span>&nbsp;<span class="ident" id="3272010">sa</span>&nbsp;<span class="op" id="3272013">:=</span>&nbsp;<span class="ident" id="3272016">sa</span><span class="op" id="3272018">.</span><span class="op" id="3272019">(</span><span class="keyword" id="3272020">type</span><span class="op" id="3272024">)</span>&nbsp;<span class="op" id="3272026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272029">case</span>&nbsp;<span class="op" id="3272034">*</span><span class="ident" id="3272035">syscall</span><span class="op" id="3272042">.</span><span class="ident" id="3272043">SockaddrInet4</span><span class="op" id="3272056">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3272060">addr</span>&nbsp;<span class="op" id="3272065">=</span>&nbsp;<span class="op" id="3272067">&amp;</span><span class="ident" id="3272068">UDPAddr</span><span class="op" id="3272075">{</span><span class="ident" id="3272076">IP</span><span class="op" id="3272078">:</span>&nbsp;<span class="ident" id="3272080">sa</span><span class="op" id="3272082">.</span><span class="ident" id="3272083">Addr</span><span class="op" id="3272087">[</span><span class="num" id="3272088">0</span><span class="op" id="3272089">:</span><span class="op" id="3272090">]</span><span class="op" id="3272091">,</span>&nbsp;<span class="ident" id="3272093">Port</span><span class="op" id="3272097">:</span>&nbsp;<span class="ident" id="3272099">sa</span><span class="op" id="3272101">.</span><span class="ident" id="3272102">Port</span><span class="op" id="3272106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272109">case</span>&nbsp;<span class="op" id="3272114">*</span><span class="ident" id="3272115">syscall</span><span class="op" id="3272122">.</span><span class="ident" id="3272123">SockaddrInet6</span><span class="op" id="3272136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3272140">addr</span>&nbsp;<span class="op" id="3272145">=</span>&nbsp;<span class="op" id="3272147">&amp;</span><span class="ident" id="3272148">UDPAddr</span><span class="op" id="3272155">{</span><span class="ident" id="3272156">IP</span><span class="op" id="3272158">:</span>&nbsp;<span class="ident" id="3272160">sa</span><span class="op" id="3272162">.</span><span class="ident" id="3272163">Addr</span><span class="op" id="3272167">[</span><span class="num" id="3272168">0</span><span class="op" id="3272169">:</span><span class="op" id="3272170">]</span><span class="op" id="3272171">,</span>&nbsp;<span class="ident" id="3272173">Port</span><span class="op" id="3272177">:</span>&nbsp;<span class="ident" id="3272179">sa</span><span class="op" id="3272181">.</span><span class="ident" id="3272182">Port</span><span class="op" id="3272186">,</span>&nbsp;<span class="ident" id="3272188">Zone</span><span class="op" id="3272192">:</span>&nbsp;<span class="ident" id="3272194">zoneToString</span><span class="op" id="3272206">(</span><span class="builtintype" id="3272207">int</span><span class="op" id="3272210">(</span><span class="ident" id="3272211">sa</span><span class="op" id="3272213">.</span><span class="ident" id="3272214">ZoneId</span><span class="op" id="3272220">)</span><span class="op" id="3272221">)</span><span class="op" id="3272222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3272225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272228">return</span><br>
<span class="lineno">75</span><span class="op" id="3272235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3272238">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3272293">func</span>&nbsp;<span class="op" id="3272298">(</span><span class="ident" id="3272299">c</span>&nbsp;<span class="op" id="3272301">*</span><span class="ident" id="3272302">UDPConn</span><span class="op" id="3272309">)</span>&nbsp;<span class="ident" id="3272311">ReadFrom</span><span class="op" id="3272319">(</span><span class="ident" id="3272320">b</span>&nbsp;<span class="op" id="3272322">[</span><span class="op" id="3272323">]</span><span class="builtintype" id="3272324">byte</span><span class="op" id="3272328">)</span>&nbsp;<span class="op" id="3272330">(</span><span class="builtintype" id="3272331">int</span><span class="op" id="3272334">,</span>&nbsp;<span class="ident" id="3272336">Addr</span><span class="op" id="3272340">,</span>&nbsp;<span class="builtintype" id="3272342">error</span><span class="op" id="3272347">)</span>&nbsp;<span class="op" id="3272349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272352">if</span>&nbsp;<span class="op" id="3272355">!</span><span class="ident" id="3272356">c</span><span class="op" id="3272357">.</span><span class="ident" id="3272358">ok</span><span class="op" id="3272360">(</span><span class="op" id="3272361">)</span>&nbsp;<span class="op" id="3272363">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272367">return</span>&nbsp;<span class="num" id="3272374">0</span><span class="op" id="3272375">,</span>&nbsp;<span class="ident" id="3272377">nil</span><span class="op" id="3272380">,</span>&nbsp;<span class="ident" id="3272382">syscall</span><span class="op" id="3272389">.</span><span class="ident" id="3272390">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3272398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3272401">n</span><span class="op" id="3272402">,</span>&nbsp;<span class="ident" id="3272404">addr</span><span class="op" id="3272408">,</span>&nbsp;<span class="ident" id="3272410">err</span>&nbsp;<span class="op" id="3272414">:=</span>&nbsp;<span class="ident" id="3272417">c</span><span class="op" id="3272418">.</span><span class="ident" id="3272419">ReadFromUDP</span><span class="op" id="3272430">(</span><span class="ident" id="3272431">b</span><span class="op" id="3272432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272435">return</span>&nbsp;<span class="ident" id="3272442">n</span><span class="op" id="3272443">,</span>&nbsp;<span class="ident" id="3272445">addr</span><span class="op" id="3272449">.</span><span class="ident" id="3272450">toAddr</span><span class="op" id="3272456">(</span><span class="op" id="3272457">)</span><span class="op" id="3272458">,</span>&nbsp;<span class="ident" id="3272460">err</span><br>
<span class="lineno"></span><span class="op" id="3272464">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3272467">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3272535">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3272603">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3272671">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3272738">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3272749">func</span>&nbsp;<span class="op" id="3272754">(</span><span class="ident" id="3272755">c</span>&nbsp;<span class="op" id="3272757">*</span><span class="ident" id="3272758">UDPConn</span><span class="op" id="3272765">)</span>&nbsp;<span class="ident" id="3272767">ReadMsgUDP</span><span class="op" id="3272777">(</span><span class="ident" id="3272778">b</span><span class="op" id="3272779">,</span>&nbsp;<span class="ident" id="3272781">oob</span>&nbsp;<span class="op" id="3272785">[</span><span class="op" id="3272786">]</span><span class="builtintype" id="3272787">byte</span><span class="op" id="3272791">)</span>&nbsp;<span class="op" id="3272793">(</span><span class="ident" id="3272794">n</span><span class="op" id="3272795">,</span>&nbsp;<span class="ident" id="3272797">oobn</span><span class="op" id="3272801">,</span>&nbsp;<span class="ident" id="3272803">flags</span>&nbsp;<span class="builtintype" id="3272809">int</span><span class="op" id="3272812">,</span>&nbsp;<span class="ident" id="3272814">addr</span>&nbsp;<span class="op" id="3272819">*</span><span class="ident" id="3272820">UDPAddr</span><span class="op" id="3272827">,</span>&nbsp;<span class="ident" id="3272829">err</span>&nbsp;<span class="builtintype" id="3272833">error</span><span class="op" id="3272838">)</span>&nbsp;<span class="op" id="3272840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272843">if</span>&nbsp;<span class="op" id="3272846">!</span><span class="ident" id="3272847">c</span><span class="op" id="3272848">.</span><span class="ident" id="3272849">ok</span><span class="op" id="3272851">(</span><span class="op" id="3272852">)</span>&nbsp;<span class="op" id="3272854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272858">return</span>&nbsp;<span class="num" id="3272865">0</span><span class="op" id="3272866">,</span>&nbsp;<span class="num" id="3272868">0</span><span class="op" id="3272869">,</span>&nbsp;<span class="num" id="3272871">0</span><span class="op" id="3272872">,</span>&nbsp;<span class="ident" id="3272874">nil</span><span class="op" id="3272877">,</span>&nbsp;<span class="ident" id="3272879">syscall</span><span class="op" id="3272886">.</span><span class="ident" id="3272887">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3272895">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272898">var</span>&nbsp;<span class="ident" id="3272902">sa</span>&nbsp;<span class="ident" id="3272905">syscall</span><span class="op" id="3272912">.</span><span class="ident" id="3272913">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3272923">n</span><span class="op" id="3272924">,</span>&nbsp;<span class="ident" id="3272926">oobn</span><span class="op" id="3272930">,</span>&nbsp;<span class="ident" id="3272932">flags</span><span class="op" id="3272937">,</span>&nbsp;<span class="ident" id="3272939">sa</span><span class="op" id="3272941">,</span>&nbsp;<span class="ident" id="3272943">err</span>&nbsp;<span class="op" id="3272947">=</span>&nbsp;<span class="ident" id="3272949">c</span><span class="op" id="3272950">.</span><span class="ident" id="3272951">fd</span><span class="op" id="3272953">.</span><span class="ident" id="3272954">readMsg</span><span class="op" id="3272961">(</span><span class="ident" id="3272962">b</span><span class="op" id="3272963">,</span>&nbsp;<span class="ident" id="3272965">oob</span><span class="op" id="3272968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272971">switch</span>&nbsp;<span class="ident" id="3272978">sa</span>&nbsp;<span class="op" id="3272981">:=</span>&nbsp;<span class="ident" id="3272984">sa</span><span class="op" id="3272986">.</span><span class="op" id="3272987">(</span><span class="keyword" id="3272988">type</span><span class="op" id="3272992">)</span>&nbsp;<span class="op" id="3272994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3272997">case</span>&nbsp;<span class="op" id="3273002">*</span><span class="ident" id="3273003">syscall</span><span class="op" id="3273010">.</span><span class="ident" id="3273011">SockaddrInet4</span><span class="op" id="3273024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3273028">addr</span>&nbsp;<span class="op" id="3273033">=</span>&nbsp;<span class="op" id="3273035">&amp;</span><span class="ident" id="3273036">UDPAddr</span><span class="op" id="3273043">{</span><span class="ident" id="3273044">IP</span><span class="op" id="3273046">:</span>&nbsp;<span class="ident" id="3273048">sa</span><span class="op" id="3273050">.</span><span class="ident" id="3273051">Addr</span><span class="op" id="3273055">[</span><span class="num" id="3273056">0</span><span class="op" id="3273057">:</span><span class="op" id="3273058">]</span><span class="op" id="3273059">,</span>&nbsp;<span class="ident" id="3273061">Port</span><span class="op" id="3273065">:</span>&nbsp;<span class="ident" id="3273067">sa</span><span class="op" id="3273069">.</span><span class="ident" id="3273070">Port</span><span class="op" id="3273074">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273077">case</span>&nbsp;<span class="op" id="3273082">*</span><span class="ident" id="3273083">syscall</span><span class="op" id="3273090">.</span><span class="ident" id="3273091">SockaddrInet6</span><span class="op" id="3273104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3273108">addr</span>&nbsp;<span class="op" id="3273113">=</span>&nbsp;<span class="op" id="3273115">&amp;</span><span class="ident" id="3273116">UDPAddr</span><span class="op" id="3273123">{</span><span class="ident" id="3273124">IP</span><span class="op" id="3273126">:</span>&nbsp;<span class="ident" id="3273128">sa</span><span class="op" id="3273130">.</span><span class="ident" id="3273131">Addr</span><span class="op" id="3273135">[</span><span class="num" id="3273136">0</span><span class="op" id="3273137">:</span><span class="op" id="3273138">]</span><span class="op" id="3273139">,</span>&nbsp;<span class="ident" id="3273141">Port</span><span class="op" id="3273145">:</span>&nbsp;<span class="ident" id="3273147">sa</span><span class="op" id="3273149">.</span><span class="ident" id="3273150">Port</span><span class="op" id="3273154">,</span>&nbsp;<span class="ident" id="3273156">Zone</span><span class="op" id="3273160">:</span>&nbsp;<span class="ident" id="3273162">zoneToString</span><span class="op" id="3273174">(</span><span class="builtintype" id="3273175">int</span><span class="op" id="3273178">(</span><span class="ident" id="3273179">sa</span><span class="op" id="3273181">.</span><span class="ident" id="3273182">ZoneId</span><span class="op" id="3273188">)</span><span class="op" id="3273189">)</span><span class="op" id="3273190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3273193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273196">return</span><br>
<span class="lineno"></span><span class="op" id="3273203">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3273206">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3273275">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3273286">//</span><br>
<span class="lineno"></span><span class="comment" id="3273289">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3273352">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3273419">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3273488">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3273501">func</span>&nbsp;<span class="op" id="3273506">(</span><span class="ident" id="3273507">c</span>&nbsp;<span class="op" id="3273509">*</span><span class="ident" id="3273510">UDPConn</span><span class="op" id="3273517">)</span>&nbsp;<span class="ident" id="3273519">WriteToUDP</span><span class="op" id="3273529">(</span><span class="ident" id="3273530">b</span>&nbsp;<span class="op" id="3273532">[</span><span class="op" id="3273533">]</span><span class="builtintype" id="3273534">byte</span><span class="op" id="3273538">,</span>&nbsp;<span class="ident" id="3273540">addr</span>&nbsp;<span class="op" id="3273545">*</span><span class="ident" id="3273546">UDPAddr</span><span class="op" id="3273553">)</span>&nbsp;<span class="op" id="3273555">(</span><span class="builtintype" id="3273556">int</span><span class="op" id="3273559">,</span>&nbsp;<span class="builtintype" id="3273561">error</span><span class="op" id="3273566">)</span>&nbsp;<span class="op" id="3273568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273571">if</span>&nbsp;<span class="op" id="3273574">!</span><span class="ident" id="3273575">c</span><span class="op" id="3273576">.</span><span class="ident" id="3273577">ok</span><span class="op" id="3273579">(</span><span class="op" id="3273580">)</span>&nbsp;<span class="op" id="3273582">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273586">return</span>&nbsp;<span class="num" id="3273593">0</span><span class="op" id="3273594">,</span>&nbsp;<span class="ident" id="3273596">syscall</span><span class="op" id="3273603">.</span><span class="ident" id="3273604">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3273612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273615">if</span>&nbsp;<span class="ident" id="3273618">c</span><span class="op" id="3273619">.</span><span class="ident" id="3273620">fd</span><span class="op" id="3273622">.</span><span class="ident" id="3273623">isConnected</span>&nbsp;<span class="op" id="3273635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273639">return</span>&nbsp;<span class="num" id="3273646">0</span><span class="op" id="3273647">,</span>&nbsp;<span class="op" id="3273649">&amp;</span><span class="ident" id="3273650">OpError</span><span class="op" id="3273657">{</span><span class="string" id="3273658">&#34;write&#34;</span><span class="op" id="3273665">,</span>&nbsp;<span class="ident" id="3273667">c</span><span class="op" id="3273668">.</span><span class="ident" id="3273669">fd</span><span class="op" id="3273671">.</span><span class="ident" id="3273672">net</span><span class="op" id="3273675">,</span>&nbsp;<span class="ident" id="3273677">addr</span><span class="op" id="3273681">,</span>&nbsp;<span class="ident" id="3273683">ErrWriteToConnected</span><span class="op" id="3273702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3273705">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273708">if</span>&nbsp;<span class="ident" id="3273711">addr</span>&nbsp;<span class="op" id="3273716">==</span>&nbsp;<span class="ident" id="3273719">nil</span>&nbsp;<span class="op" id="3273723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273727">return</span>&nbsp;<span class="num" id="3273734">0</span><span class="op" id="3273735">,</span>&nbsp;<span class="op" id="3273737">&amp;</span><span class="ident" id="3273738">OpError</span><span class="op" id="3273745">{</span><span class="ident" id="3273746">Op</span><span class="op" id="3273748">:</span>&nbsp;<span class="string" id="3273750">&#34;write&#34;</span><span class="op" id="3273757">,</span>&nbsp;<span class="ident" id="3273759">Net</span><span class="op" id="3273762">:</span>&nbsp;<span class="ident" id="3273764">c</span><span class="op" id="3273765">.</span><span class="ident" id="3273766">fd</span><span class="op" id="3273768">.</span><span class="ident" id="3273769">net</span><span class="op" id="3273772">,</span>&nbsp;<span class="ident" id="3273774">Addr</span><span class="op" id="3273778">:</span>&nbsp;<span class="ident" id="3273780">nil</span><span class="op" id="3273783">,</span>&nbsp;<span class="ident" id="3273785">Err</span><span class="op" id="3273788">:</span>&nbsp;<span class="ident" id="3273790">errMissingAddress</span><span class="op" id="3273807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3273810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3273813">sa</span><span class="op" id="3273815">,</span>&nbsp;<span class="ident" id="3273817">err</span>&nbsp;<span class="op" id="3273821">:=</span>&nbsp;<span class="ident" id="3273824">addr</span><span class="op" id="3273828">.</span><span class="ident" id="3273829">sockaddr</span><span class="op" id="3273837">(</span><span class="ident" id="3273838">c</span><span class="op" id="3273839">.</span><span class="ident" id="3273840">fd</span><span class="op" id="3273842">.</span><span class="ident" id="3273843">family</span><span class="op" id="3273849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273852">if</span>&nbsp;<span class="ident" id="3273855">err</span>&nbsp;<span class="op" id="3273859">!=</span>&nbsp;<span class="ident" id="3273862">nil</span>&nbsp;<span class="op" id="3273866">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273870">return</span>&nbsp;<span class="num" id="3273877">0</span><span class="op" id="3273878">,</span>&nbsp;<span class="op" id="3273880">&amp;</span><span class="ident" id="3273881">OpError</span><span class="op" id="3273888">{</span><span class="string" id="3273889">&#34;write&#34;</span><span class="op" id="3273896">,</span>&nbsp;<span class="ident" id="3273898">c</span><span class="op" id="3273899">.</span><span class="ident" id="3273900">fd</span><span class="op" id="3273902">.</span><span class="ident" id="3273903">net</span><span class="op" id="3273906">,</span>&nbsp;<span class="ident" id="3273908">addr</span><span class="op" id="3273912">,</span>&nbsp;<span class="ident" id="3273914">err</span><span class="op" id="3273917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3273920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3273923">return</span>&nbsp;<span class="ident" id="3273930">c</span><span class="op" id="3273931">.</span><span class="ident" id="3273932">fd</span><span class="op" id="3273934">.</span><span class="ident" id="3273935">writeTo</span><span class="op" id="3273942">(</span><span class="ident" id="3273943">b</span><span class="op" id="3273944">,</span>&nbsp;<span class="ident" id="3273946">sa</span><span class="op" id="3273948">)</span><br>
<span class="lineno"></span><span class="op" id="3273950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3273953">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3274006">func</span>&nbsp;<span class="op" id="3274011">(</span><span class="ident" id="3274012">c</span>&nbsp;<span class="op" id="3274014">*</span><span class="ident" id="3274015">UDPConn</span><span class="op" id="3274022">)</span>&nbsp;<span class="ident" id="3274024">WriteTo</span><span class="op" id="3274031">(</span><span class="ident" id="3274032">b</span>&nbsp;<span class="op" id="3274034">[</span><span class="op" id="3274035">]</span><span class="builtintype" id="3274036">byte</span><span class="op" id="3274040">,</span>&nbsp;<span class="ident" id="3274042">addr</span>&nbsp;<span class="ident" id="3274047">Addr</span><span class="op" id="3274051">)</span>&nbsp;<span class="op" id="3274053">(</span><span class="builtintype" id="3274054">int</span><span class="op" id="3274057">,</span>&nbsp;<span class="builtintype" id="3274059">error</span><span class="op" id="3274064">)</span>&nbsp;<span class="op" id="3274066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274069">if</span>&nbsp;<span class="op" id="3274072">!</span><span class="ident" id="3274073">c</span><span class="op" id="3274074">.</span><span class="ident" id="3274075">ok</span><span class="op" id="3274077">(</span><span class="op" id="3274078">)</span>&nbsp;<span class="op" id="3274080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274084">return</span>&nbsp;<span class="num" id="3274091">0</span><span class="op" id="3274092">,</span>&nbsp;<span class="ident" id="3274094">syscall</span><span class="op" id="3274101">.</span><span class="ident" id="3274102">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274110">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274113">a</span><span class="op" id="3274114">,</span>&nbsp;<span class="ident" id="3274116">ok</span>&nbsp;<span class="op" id="3274119">:=</span>&nbsp;<span class="ident" id="3274122">addr</span><span class="op" id="3274126">.</span><span class="op" id="3274127">(</span><span class="op" id="3274128">*</span><span class="ident" id="3274129">UDPAddr</span><span class="op" id="3274136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274139">if</span>&nbsp;<span class="op" id="3274142">!</span><span class="ident" id="3274143">ok</span>&nbsp;<span class="op" id="3274146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274150">return</span>&nbsp;<span class="num" id="3274157">0</span><span class="op" id="3274158">,</span>&nbsp;<span class="op" id="3274160">&amp;</span><span class="ident" id="3274161">OpError</span><span class="op" id="3274168">{</span><span class="string" id="3274169">&#34;write&#34;</span><span class="op" id="3274176">,</span>&nbsp;<span class="ident" id="3274178">c</span><span class="op" id="3274179">.</span><span class="ident" id="3274180">fd</span><span class="op" id="3274182">.</span><span class="ident" id="3274183">net</span><span class="op" id="3274186">,</span>&nbsp;<span class="ident" id="3274188">addr</span><span class="op" id="3274192">,</span>&nbsp;<span class="ident" id="3274194">syscall</span><span class="op" id="3274201">.</span><span class="ident" id="3274202">EINVAL</span><span class="op" id="3274208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274214">return</span>&nbsp;<span class="ident" id="3274221">c</span><span class="op" id="3274222">.</span><span class="ident" id="3274223">WriteToUDP</span><span class="op" id="3274233">(</span><span class="ident" id="3274234">b</span><span class="op" id="3274235">,</span>&nbsp;<span class="ident" id="3274237">a</span><span class="op" id="3274238">)</span><br>
<span class="lineno">140</span><span class="op" id="3274240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3274243">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3274314">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3274381">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3274433">func</span>&nbsp;<span class="op" id="3274438">(</span><span class="ident" id="3274439">c</span>&nbsp;<span class="op" id="3274441">*</span><span class="ident" id="3274442">UDPConn</span><span class="op" id="3274449">)</span>&nbsp;<span class="ident" id="3274451">WriteMsgUDP</span><span class="op" id="3274462">(</span><span class="ident" id="3274463">b</span><span class="op" id="3274464">,</span>&nbsp;<span class="ident" id="3274466">oob</span>&nbsp;<span class="op" id="3274470">[</span><span class="op" id="3274471">]</span><span class="builtintype" id="3274472">byte</span><span class="op" id="3274476">,</span>&nbsp;<span class="ident" id="3274478">addr</span>&nbsp;<span class="op" id="3274483">*</span><span class="ident" id="3274484">UDPAddr</span><span class="op" id="3274491">)</span>&nbsp;<span class="op" id="3274493">(</span><span class="ident" id="3274494">n</span><span class="op" id="3274495">,</span>&nbsp;<span class="ident" id="3274497">oobn</span>&nbsp;<span class="builtintype" id="3274502">int</span><span class="op" id="3274505">,</span>&nbsp;<span class="ident" id="3274507">err</span>&nbsp;<span class="builtintype" id="3274511">error</span><span class="op" id="3274516">)</span>&nbsp;<span class="op" id="3274518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274521">if</span>&nbsp;<span class="op" id="3274524">!</span><span class="ident" id="3274525">c</span><span class="op" id="3274526">.</span><span class="ident" id="3274527">ok</span><span class="op" id="3274529">(</span><span class="op" id="3274530">)</span>&nbsp;<span class="op" id="3274532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274536">return</span>&nbsp;<span class="num" id="3274543">0</span><span class="op" id="3274544">,</span>&nbsp;<span class="num" id="3274546">0</span><span class="op" id="3274547">,</span>&nbsp;<span class="ident" id="3274549">syscall</span><span class="op" id="3274556">.</span><span class="ident" id="3274557">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274568">if</span>&nbsp;<span class="ident" id="3274571">c</span><span class="op" id="3274572">.</span><span class="ident" id="3274573">fd</span><span class="op" id="3274575">.</span><span class="ident" id="3274576">isConnected</span>&nbsp;<span class="op" id="3274588">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274592">return</span>&nbsp;<span class="num" id="3274599">0</span><span class="op" id="3274600">,</span>&nbsp;<span class="num" id="3274602">0</span><span class="op" id="3274603">,</span>&nbsp;<span class="op" id="3274605">&amp;</span><span class="ident" id="3274606">OpError</span><span class="op" id="3274613">{</span><span class="string" id="3274614">&#34;write&#34;</span><span class="op" id="3274621">,</span>&nbsp;<span class="ident" id="3274623">c</span><span class="op" id="3274624">.</span><span class="ident" id="3274625">fd</span><span class="op" id="3274627">.</span><span class="ident" id="3274628">net</span><span class="op" id="3274631">,</span>&nbsp;<span class="ident" id="3274633">addr</span><span class="op" id="3274637">,</span>&nbsp;<span class="ident" id="3274639">ErrWriteToConnected</span><span class="op" id="3274658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274664">if</span>&nbsp;<span class="ident" id="3274667">addr</span>&nbsp;<span class="op" id="3274672">==</span>&nbsp;<span class="ident" id="3274675">nil</span>&nbsp;<span class="op" id="3274679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274683">return</span>&nbsp;<span class="num" id="3274690">0</span><span class="op" id="3274691">,</span>&nbsp;<span class="num" id="3274693">0</span><span class="op" id="3274694">,</span>&nbsp;<span class="op" id="3274696">&amp;</span><span class="ident" id="3274697">OpError</span><span class="op" id="3274704">{</span><span class="ident" id="3274705">Op</span><span class="op" id="3274707">:</span>&nbsp;<span class="string" id="3274709">&#34;write&#34;</span><span class="op" id="3274716">,</span>&nbsp;<span class="ident" id="3274718">Net</span><span class="op" id="3274721">:</span>&nbsp;<span class="ident" id="3274723">c</span><span class="op" id="3274724">.</span><span class="ident" id="3274725">fd</span><span class="op" id="3274727">.</span><span class="ident" id="3274728">net</span><span class="op" id="3274731">,</span>&nbsp;<span class="ident" id="3274733">Addr</span><span class="op" id="3274737">:</span>&nbsp;<span class="ident" id="3274739">nil</span><span class="op" id="3274742">,</span>&nbsp;<span class="ident" id="3274744">Err</span><span class="op" id="3274747">:</span>&nbsp;<span class="ident" id="3274749">errMissingAddress</span><span class="op" id="3274766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274769">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3274772">sa</span><span class="op" id="3274774">,</span>&nbsp;<span class="ident" id="3274776">err</span>&nbsp;<span class="op" id="3274780">:=</span>&nbsp;<span class="ident" id="3274783">addr</span><span class="op" id="3274787">.</span><span class="ident" id="3274788">sockaddr</span><span class="op" id="3274796">(</span><span class="ident" id="3274797">c</span><span class="op" id="3274798">.</span><span class="ident" id="3274799">fd</span><span class="op" id="3274801">.</span><span class="ident" id="3274802">family</span><span class="op" id="3274808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274811">if</span>&nbsp;<span class="ident" id="3274814">err</span>&nbsp;<span class="op" id="3274818">!=</span>&nbsp;<span class="ident" id="3274821">nil</span>&nbsp;<span class="op" id="3274825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274829">return</span>&nbsp;<span class="num" id="3274836">0</span><span class="op" id="3274837">,</span>&nbsp;<span class="num" id="3274839">0</span><span class="op" id="3274840">,</span>&nbsp;<span class="op" id="3274842">&amp;</span><span class="ident" id="3274843">OpError</span><span class="op" id="3274850">{</span><span class="string" id="3274851">&#34;write&#34;</span><span class="op" id="3274858">,</span>&nbsp;<span class="ident" id="3274860">c</span><span class="op" id="3274861">.</span><span class="ident" id="3274862">fd</span><span class="op" id="3274864">.</span><span class="ident" id="3274865">net</span><span class="op" id="3274868">,</span>&nbsp;<span class="ident" id="3274870">addr</span><span class="op" id="3274874">,</span>&nbsp;<span class="ident" id="3274876">err</span><span class="op" id="3274879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3274882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3274885">return</span>&nbsp;<span class="ident" id="3274892">c</span><span class="op" id="3274893">.</span><span class="ident" id="3274894">fd</span><span class="op" id="3274896">.</span><span class="ident" id="3274897">writeMsg</span><span class="op" id="3274905">(</span><span class="ident" id="3274906">b</span><span class="op" id="3274907">,</span>&nbsp;<span class="ident" id="3274909">oob</span><span class="op" id="3274912">,</span>&nbsp;<span class="ident" id="3274914">sa</span><span class="op" id="3274916">)</span><br>
<span class="lineno">160</span><span class="op" id="3274918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3274921">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3274989">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3275060">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3275109">func</span>&nbsp;<span class="ident" id="3275114">DialUDP</span><span class="op" id="3275121">(</span><span class="ident" id="3275122">net</span>&nbsp;<span class="builtintype" id="3275126">string</span><span class="op" id="3275132">,</span>&nbsp;<span class="ident" id="3275134">laddr</span><span class="op" id="3275139">,</span>&nbsp;<span class="ident" id="3275141">raddr</span>&nbsp;<span class="op" id="3275147">*</span><span class="ident" id="3275148">UDPAddr</span><span class="op" id="3275155">)</span>&nbsp;<span class="op" id="3275157">(</span><span class="op" id="3275158">*</span><span class="ident" id="3275159">UDPConn</span><span class="op" id="3275166">,</span>&nbsp;<span class="builtintype" id="3275168">error</span><span class="op" id="3275173">)</span>&nbsp;<span class="op" id="3275175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275178">switch</span>&nbsp;<span class="ident" id="3275185">net</span>&nbsp;<span class="op" id="3275189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275192">case</span>&nbsp;<span class="string" id="3275197">&#34;udp&#34;</span><span class="op" id="3275202">,</span>&nbsp;<span class="string" id="3275204">&#34;udp4&#34;</span><span class="op" id="3275210">,</span>&nbsp;<span class="string" id="3275212">&#34;udp6&#34;</span><span class="op" id="3275218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275221">default</span><span class="op" id="3275228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275232">return</span>&nbsp;<span class="ident" id="3275239">nil</span><span class="op" id="3275242">,</span>&nbsp;<span class="op" id="3275244">&amp;</span><span class="ident" id="3275245">OpError</span><span class="op" id="3275252">{</span><span class="ident" id="3275253">Op</span><span class="op" id="3275255">:</span>&nbsp;<span class="string" id="3275257">&#34;dial&#34;</span><span class="op" id="3275263">,</span>&nbsp;<span class="ident" id="3275265">Net</span><span class="op" id="3275268">:</span>&nbsp;<span class="ident" id="3275270">net</span><span class="op" id="3275273">,</span>&nbsp;<span class="ident" id="3275275">Addr</span><span class="op" id="3275279">:</span>&nbsp;<span class="ident" id="3275281">raddr</span><span class="op" id="3275286">,</span>&nbsp;<span class="ident" id="3275288">Err</span><span class="op" id="3275291">:</span>&nbsp;<span class="ident" id="3275293">UnknownNetworkError</span><span class="op" id="3275312">(</span><span class="ident" id="3275313">net</span><span class="op" id="3275316">)</span><span class="op" id="3275317">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275323">if</span>&nbsp;<span class="ident" id="3275326">raddr</span>&nbsp;<span class="op" id="3275332">==</span>&nbsp;<span class="ident" id="3275335">nil</span>&nbsp;<span class="op" id="3275339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275343">return</span>&nbsp;<span class="ident" id="3275350">nil</span><span class="op" id="3275353">,</span>&nbsp;<span class="op" id="3275355">&amp;</span><span class="ident" id="3275356">OpError</span><span class="op" id="3275363">{</span><span class="ident" id="3275364">Op</span><span class="op" id="3275366">:</span>&nbsp;<span class="string" id="3275368">&#34;dial&#34;</span><span class="op" id="3275374">,</span>&nbsp;<span class="ident" id="3275376">Net</span><span class="op" id="3275379">:</span>&nbsp;<span class="ident" id="3275381">net</span><span class="op" id="3275384">,</span>&nbsp;<span class="ident" id="3275386">Addr</span><span class="op" id="3275390">:</span>&nbsp;<span class="ident" id="3275392">nil</span><span class="op" id="3275395">,</span>&nbsp;<span class="ident" id="3275397">Err</span><span class="op" id="3275400">:</span>&nbsp;<span class="ident" id="3275402">errMissingAddress</span><span class="op" id="3275419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275425">return</span>&nbsp;<span class="ident" id="3275432">dialUDP</span><span class="op" id="3275439">(</span><span class="ident" id="3275440">net</span><span class="op" id="3275443">,</span>&nbsp;<span class="ident" id="3275445">laddr</span><span class="op" id="3275450">,</span>&nbsp;<span class="ident" id="3275452">raddr</span><span class="op" id="3275457">,</span>&nbsp;<span class="ident" id="3275459">noDeadline</span><span class="op" id="3275469">)</span><br>
<span class="lineno">175</span><span class="op" id="3275471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3275474">func</span>&nbsp;<span class="ident" id="3275479">dialUDP</span><span class="op" id="3275486">(</span><span class="ident" id="3275487">net</span>&nbsp;<span class="builtintype" id="3275491">string</span><span class="op" id="3275497">,</span>&nbsp;<span class="ident" id="3275499">laddr</span><span class="op" id="3275504">,</span>&nbsp;<span class="ident" id="3275506">raddr</span>&nbsp;<span class="op" id="3275512">*</span><span class="ident" id="3275513">UDPAddr</span><span class="op" id="3275520">,</span>&nbsp;<span class="ident" id="3275522">deadline</span>&nbsp;<span class="ident" id="3275531">time</span><span class="op" id="3275535">.</span><span class="ident" id="3275536">Time</span><span class="op" id="3275540">)</span>&nbsp;<span class="op" id="3275542">(</span><span class="op" id="3275543">*</span><span class="ident" id="3275544">UDPConn</span><span class="op" id="3275551">,</span>&nbsp;<span class="builtintype" id="3275553">error</span><span class="op" id="3275558">)</span>&nbsp;<span class="op" id="3275560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3275563">fd</span><span class="op" id="3275565">,</span>&nbsp;<span class="ident" id="3275567">err</span>&nbsp;<span class="op" id="3275571">:=</span>&nbsp;<span class="ident" id="3275574">internetSocket</span><span class="op" id="3275588">(</span><span class="ident" id="3275589">net</span><span class="op" id="3275592">,</span>&nbsp;<span class="ident" id="3275594">laddr</span><span class="op" id="3275599">,</span>&nbsp;<span class="ident" id="3275601">raddr</span><span class="op" id="3275606">,</span>&nbsp;<span class="ident" id="3275608">deadline</span><span class="op" id="3275616">,</span>&nbsp;<span class="ident" id="3275618">syscall</span><span class="op" id="3275625">.</span><span class="ident" id="3275626">SOCK_DGRAM</span><span class="op" id="3275636">,</span>&nbsp;<span class="num" id="3275638">0</span><span class="op" id="3275639">,</span>&nbsp;<span class="string" id="3275641">&#34;dial&#34;</span><span class="op" id="3275647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275650">if</span>&nbsp;<span class="ident" id="3275653">err</span>&nbsp;<span class="op" id="3275657">!=</span>&nbsp;<span class="ident" id="3275660">nil</span>&nbsp;<span class="op" id="3275664">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275668">return</span>&nbsp;<span class="ident" id="3275675">nil</span><span class="op" id="3275678">,</span>&nbsp;<span class="op" id="3275680">&amp;</span><span class="ident" id="3275681">OpError</span><span class="op" id="3275688">{</span><span class="ident" id="3275689">Op</span><span class="op" id="3275691">:</span>&nbsp;<span class="string" id="3275693">&#34;dial&#34;</span><span class="op" id="3275699">,</span>&nbsp;<span class="ident" id="3275701">Net</span><span class="op" id="3275704">:</span>&nbsp;<span class="ident" id="3275706">net</span><span class="op" id="3275709">,</span>&nbsp;<span class="ident" id="3275711">Addr</span><span class="op" id="3275715">:</span>&nbsp;<span class="ident" id="3275717">raddr</span><span class="op" id="3275722">,</span>&nbsp;<span class="ident" id="3275724">Err</span><span class="op" id="3275727">:</span>&nbsp;<span class="ident" id="3275729">err</span><span class="op" id="3275732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3275735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3275738">return</span>&nbsp;<span class="ident" id="3275745">newUDPConn</span><span class="op" id="3275755">(</span><span class="ident" id="3275756">fd</span><span class="op" id="3275758">)</span><span class="op" id="3275759">,</span>&nbsp;<span class="ident" id="3275761">nil</span><br>
<span class="lineno"></span><span class="op" id="3275765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3275768">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3275837">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3275908">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3275965">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3276028">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3276098">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3276169">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3276184">func</span>&nbsp;<span class="ident" id="3276189">ListenUDP</span><span class="op" id="3276198">(</span><span class="ident" id="3276199">net</span>&nbsp;<span class="builtintype" id="3276203">string</span><span class="op" id="3276209">,</span>&nbsp;<span class="ident" id="3276211">laddr</span>&nbsp;<span class="op" id="3276217">*</span><span class="ident" id="3276218">UDPAddr</span><span class="op" id="3276225">)</span>&nbsp;<span class="op" id="3276227">(</span><span class="op" id="3276228">*</span><span class="ident" id="3276229">UDPConn</span><span class="op" id="3276236">,</span>&nbsp;<span class="builtintype" id="3276238">error</span><span class="op" id="3276243">)</span>&nbsp;<span class="op" id="3276245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276248">switch</span>&nbsp;<span class="ident" id="3276255">net</span>&nbsp;<span class="op" id="3276259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276262">case</span>&nbsp;<span class="string" id="3276267">&#34;udp&#34;</span><span class="op" id="3276272">,</span>&nbsp;<span class="string" id="3276274">&#34;udp4&#34;</span><span class="op" id="3276280">,</span>&nbsp;<span class="string" id="3276282">&#34;udp6&#34;</span><span class="op" id="3276288">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276291">default</span><span class="op" id="3276298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276302">return</span>&nbsp;<span class="ident" id="3276309">nil</span><span class="op" id="3276312">,</span>&nbsp;<span class="op" id="3276314">&amp;</span><span class="ident" id="3276315">OpError</span><span class="op" id="3276322">{</span><span class="ident" id="3276323">Op</span><span class="op" id="3276325">:</span>&nbsp;<span class="string" id="3276327">&#34;listen&#34;</span><span class="op" id="3276335">,</span>&nbsp;<span class="ident" id="3276337">Net</span><span class="op" id="3276340">:</span>&nbsp;<span class="ident" id="3276342">net</span><span class="op" id="3276345">,</span>&nbsp;<span class="ident" id="3276347">Addr</span><span class="op" id="3276351">:</span>&nbsp;<span class="ident" id="3276353">laddr</span><span class="op" id="3276358">,</span>&nbsp;<span class="ident" id="3276360">Err</span><span class="op" id="3276363">:</span>&nbsp;<span class="ident" id="3276365">UnknownNetworkError</span><span class="op" id="3276384">(</span><span class="ident" id="3276385">net</span><span class="op" id="3276388">)</span><span class="op" id="3276389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276395">if</span>&nbsp;<span class="ident" id="3276398">laddr</span>&nbsp;<span class="op" id="3276404">==</span>&nbsp;<span class="ident" id="3276407">nil</span>&nbsp;<span class="op" id="3276411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276415">laddr</span>&nbsp;<span class="op" id="3276421">=</span>&nbsp;<span class="op" id="3276423">&amp;</span><span class="ident" id="3276424">UDPAddr</span><span class="op" id="3276431">{</span><span class="op" id="3276432">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276438">fd</span><span class="op" id="3276440">,</span>&nbsp;<span class="ident" id="3276442">err</span>&nbsp;<span class="op" id="3276446">:=</span>&nbsp;<span class="ident" id="3276449">internetSocket</span><span class="op" id="3276463">(</span><span class="ident" id="3276464">net</span><span class="op" id="3276467">,</span>&nbsp;<span class="ident" id="3276469">laddr</span><span class="op" id="3276474">,</span>&nbsp;<span class="ident" id="3276476">nil</span><span class="op" id="3276479">,</span>&nbsp;<span class="ident" id="3276481">noDeadline</span><span class="op" id="3276491">,</span>&nbsp;<span class="ident" id="3276493">syscall</span><span class="op" id="3276500">.</span><span class="ident" id="3276501">SOCK_DGRAM</span><span class="op" id="3276511">,</span>&nbsp;<span class="num" id="3276513">0</span><span class="op" id="3276514">,</span>&nbsp;<span class="string" id="3276516">&#34;listen&#34;</span><span class="op" id="3276524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276527">if</span>&nbsp;<span class="ident" id="3276530">err</span>&nbsp;<span class="op" id="3276534">!=</span>&nbsp;<span class="ident" id="3276537">nil</span>&nbsp;<span class="op" id="3276541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276545">return</span>&nbsp;<span class="ident" id="3276552">nil</span><span class="op" id="3276555">,</span>&nbsp;<span class="op" id="3276557">&amp;</span><span class="ident" id="3276558">OpError</span><span class="op" id="3276565">{</span><span class="ident" id="3276566">Op</span><span class="op" id="3276568">:</span>&nbsp;<span class="string" id="3276570">&#34;listen&#34;</span><span class="op" id="3276578">,</span>&nbsp;<span class="ident" id="3276580">Net</span><span class="op" id="3276583">:</span>&nbsp;<span class="ident" id="3276585">net</span><span class="op" id="3276588">,</span>&nbsp;<span class="ident" id="3276590">Addr</span><span class="op" id="3276594">:</span>&nbsp;<span class="ident" id="3276596">laddr</span><span class="op" id="3276601">,</span>&nbsp;<span class="ident" id="3276603">Err</span><span class="op" id="3276606">:</span>&nbsp;<span class="ident" id="3276608">err</span><span class="op" id="3276611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3276614">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276617">return</span>&nbsp;<span class="ident" id="3276624">newUDPConn</span><span class="op" id="3276634">(</span><span class="ident" id="3276635">fd</span><span class="op" id="3276637">)</span><span class="op" id="3276638">,</span>&nbsp;<span class="ident" id="3276640">nil</span><br>
<span class="lineno"></span><span class="op" id="3276644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3276647">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3276712">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3276780">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3276845">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3276873">func</span>&nbsp;<span class="ident" id="3276878">ListenMulticastUDP</span><span class="op" id="3276896">(</span><span class="ident" id="3276897">net</span>&nbsp;<span class="builtintype" id="3276901">string</span><span class="op" id="3276907">,</span>&nbsp;<span class="ident" id="3276909">ifi</span>&nbsp;<span class="op" id="3276913">*</span><span class="ident" id="3276914">Interface</span><span class="op" id="3276923">,</span>&nbsp;<span class="ident" id="3276925">gaddr</span>&nbsp;<span class="op" id="3276931">*</span><span class="ident" id="3276932">UDPAddr</span><span class="op" id="3276939">)</span>&nbsp;<span class="op" id="3276941">(</span><span class="op" id="3276942">*</span><span class="ident" id="3276943">UDPConn</span><span class="op" id="3276950">,</span>&nbsp;<span class="builtintype" id="3276952">error</span><span class="op" id="3276957">)</span>&nbsp;<span class="op" id="3276959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276962">switch</span>&nbsp;<span class="ident" id="3276969">net</span>&nbsp;<span class="op" id="3276973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3276976">case</span>&nbsp;<span class="string" id="3276981">&#34;udp&#34;</span><span class="op" id="3276986">,</span>&nbsp;<span class="string" id="3276988">&#34;udp4&#34;</span><span class="op" id="3276994">,</span>&nbsp;<span class="string" id="3276996">&#34;udp6&#34;</span><span class="op" id="3277002">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277005">default</span><span class="op" id="3277012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277016">return</span>&nbsp;<span class="ident" id="3277023">nil</span><span class="op" id="3277026">,</span>&nbsp;<span class="op" id="3277028">&amp;</span><span class="ident" id="3277029">OpError</span><span class="op" id="3277036">{</span><span class="ident" id="3277037">Op</span><span class="op" id="3277039">:</span>&nbsp;<span class="string" id="3277041">&#34;listen&#34;</span><span class="op" id="3277049">,</span>&nbsp;<span class="ident" id="3277051">Net</span><span class="op" id="3277054">:</span>&nbsp;<span class="ident" id="3277056">net</span><span class="op" id="3277059">,</span>&nbsp;<span class="ident" id="3277061">Addr</span><span class="op" id="3277065">:</span>&nbsp;<span class="ident" id="3277067">gaddr</span><span class="op" id="3277072">,</span>&nbsp;<span class="ident" id="3277074">Err</span><span class="op" id="3277077">:</span>&nbsp;<span class="ident" id="3277079">UnknownNetworkError</span><span class="op" id="3277098">(</span><span class="ident" id="3277099">net</span><span class="op" id="3277102">)</span><span class="op" id="3277103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277109">if</span>&nbsp;<span class="ident" id="3277112">gaddr</span>&nbsp;<span class="op" id="3277118">==</span>&nbsp;<span class="ident" id="3277121">nil</span>&nbsp;<span class="op" id="3277125">||</span>&nbsp;<span class="ident" id="3277128">gaddr</span><span class="op" id="3277133">.</span><span class="ident" id="3277134">IP</span>&nbsp;<span class="op" id="3277137">==</span>&nbsp;<span class="ident" id="3277140">nil</span>&nbsp;<span class="op" id="3277144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277148">return</span>&nbsp;<span class="ident" id="3277155">nil</span><span class="op" id="3277158">,</span>&nbsp;<span class="op" id="3277160">&amp;</span><span class="ident" id="3277161">OpError</span><span class="op" id="3277168">{</span><span class="ident" id="3277169">Op</span><span class="op" id="3277171">:</span>&nbsp;<span class="string" id="3277173">&#34;listen&#34;</span><span class="op" id="3277181">,</span>&nbsp;<span class="ident" id="3277183">Net</span><span class="op" id="3277186">:</span>&nbsp;<span class="ident" id="3277188">net</span><span class="op" id="3277191">,</span>&nbsp;<span class="ident" id="3277193">Addr</span><span class="op" id="3277197">:</span>&nbsp;<span class="ident" id="3277199">nil</span><span class="op" id="3277202">,</span>&nbsp;<span class="ident" id="3277204">Err</span><span class="op" id="3277207">:</span>&nbsp;<span class="ident" id="3277209">errMissingAddress</span><span class="op" id="3277226">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277232">fd</span><span class="op" id="3277234">,</span>&nbsp;<span class="ident" id="3277236">err</span>&nbsp;<span class="op" id="3277240">:=</span>&nbsp;<span class="ident" id="3277243">internetSocket</span><span class="op" id="3277257">(</span><span class="ident" id="3277258">net</span><span class="op" id="3277261">,</span>&nbsp;<span class="ident" id="3277263">gaddr</span><span class="op" id="3277268">,</span>&nbsp;<span class="ident" id="3277270">nil</span><span class="op" id="3277273">,</span>&nbsp;<span class="ident" id="3277275">noDeadline</span><span class="op" id="3277285">,</span>&nbsp;<span class="ident" id="3277287">syscall</span><span class="op" id="3277294">.</span><span class="ident" id="3277295">SOCK_DGRAM</span><span class="op" id="3277305">,</span>&nbsp;<span class="num" id="3277307">0</span><span class="op" id="3277308">,</span>&nbsp;<span class="string" id="3277310">&#34;listen&#34;</span><span class="op" id="3277318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277321">if</span>&nbsp;<span class="ident" id="3277324">err</span>&nbsp;<span class="op" id="3277328">!=</span>&nbsp;<span class="ident" id="3277331">nil</span>&nbsp;<span class="op" id="3277335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277339">return</span>&nbsp;<span class="ident" id="3277346">nil</span><span class="op" id="3277349">,</span>&nbsp;<span class="op" id="3277351">&amp;</span><span class="ident" id="3277352">OpError</span><span class="op" id="3277359">{</span><span class="ident" id="3277360">Op</span><span class="op" id="3277362">:</span>&nbsp;<span class="string" id="3277364">&#34;listen&#34;</span><span class="op" id="3277372">,</span>&nbsp;<span class="ident" id="3277374">Net</span><span class="op" id="3277377">:</span>&nbsp;<span class="ident" id="3277379">net</span><span class="op" id="3277382">,</span>&nbsp;<span class="ident" id="3277384">Addr</span><span class="op" id="3277388">:</span>&nbsp;<span class="ident" id="3277390">gaddr</span><span class="op" id="3277395">,</span>&nbsp;<span class="ident" id="3277397">Err</span><span class="op" id="3277400">:</span>&nbsp;<span class="ident" id="3277402">err</span><span class="op" id="3277405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277408">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277411">c</span>&nbsp;<span class="op" id="3277413">:=</span>&nbsp;<span class="ident" id="3277416">newUDPConn</span><span class="op" id="3277426">(</span><span class="ident" id="3277427">fd</span><span class="op" id="3277429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277432">if</span>&nbsp;<span class="ident" id="3277435">ip4</span>&nbsp;<span class="op" id="3277439">:=</span>&nbsp;<span class="ident" id="3277442">gaddr</span><span class="op" id="3277447">.</span><span class="ident" id="3277448">IP</span><span class="op" id="3277450">.</span><span class="ident" id="3277451">To4</span><span class="op" id="3277454">(</span><span class="op" id="3277455">)</span><span class="op" id="3277456">;</span>&nbsp;<span class="ident" id="3277458">ip4</span>&nbsp;<span class="op" id="3277462">!=</span>&nbsp;<span class="ident" id="3277465">nil</span>&nbsp;<span class="op" id="3277469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277473">if</span>&nbsp;<span class="ident" id="3277476">err</span>&nbsp;<span class="op" id="3277480">:=</span>&nbsp;<span class="ident" id="3277483">listenIPv4MulticastUDP</span><span class="op" id="3277505">(</span><span class="ident" id="3277506">c</span><span class="op" id="3277507">,</span>&nbsp;<span class="ident" id="3277509">ifi</span><span class="op" id="3277512">,</span>&nbsp;<span class="ident" id="3277514">ip4</span><span class="op" id="3277517">)</span><span class="op" id="3277518">;</span>&nbsp;<span class="ident" id="3277520">err</span>&nbsp;<span class="op" id="3277524">!=</span>&nbsp;<span class="ident" id="3277527">nil</span>&nbsp;<span class="op" id="3277531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277536">c</span><span class="op" id="3277537">.</span><span class="ident" id="3277538">Close</span><span class="op" id="3277543">(</span><span class="op" id="3277544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277549">return</span>&nbsp;<span class="ident" id="3277556">nil</span><span class="op" id="3277559">,</span>&nbsp;<span class="op" id="3277561">&amp;</span><span class="ident" id="3277562">OpError</span><span class="op" id="3277569">{</span><span class="ident" id="3277570">Op</span><span class="op" id="3277572">:</span>&nbsp;<span class="string" id="3277574">&#34;listen&#34;</span><span class="op" id="3277582">,</span>&nbsp;<span class="ident" id="3277584">Net</span><span class="op" id="3277587">:</span>&nbsp;<span class="ident" id="3277589">net</span><span class="op" id="3277592">,</span>&nbsp;<span class="ident" id="3277594">Addr</span><span class="op" id="3277598">:</span>&nbsp;<span class="op" id="3277600">&amp;</span><span class="ident" id="3277601">IPAddr</span><span class="op" id="3277607">{</span><span class="ident" id="3277608">IP</span><span class="op" id="3277610">:</span>&nbsp;<span class="ident" id="3277612">ip4</span><span class="op" id="3277615">}</span><span class="op" id="3277616">,</span>&nbsp;<span class="ident" id="3277618">Err</span><span class="op" id="3277621">:</span>&nbsp;<span class="ident" id="3277623">err</span><span class="op" id="3277626">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277633">}</span>&nbsp;<span class="keyword" id="3277635">else</span>&nbsp;<span class="op" id="3277640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277644">if</span>&nbsp;<span class="ident" id="3277647">err</span>&nbsp;<span class="op" id="3277651">:=</span>&nbsp;<span class="ident" id="3277654">listenIPv6MulticastUDP</span><span class="op" id="3277676">(</span><span class="ident" id="3277677">c</span><span class="op" id="3277678">,</span>&nbsp;<span class="ident" id="3277680">ifi</span><span class="op" id="3277683">,</span>&nbsp;<span class="ident" id="3277685">gaddr</span><span class="op" id="3277690">.</span><span class="ident" id="3277691">IP</span><span class="op" id="3277693">)</span><span class="op" id="3277694">;</span>&nbsp;<span class="ident" id="3277696">err</span>&nbsp;<span class="op" id="3277700">!=</span>&nbsp;<span class="ident" id="3277703">nil</span>&nbsp;<span class="op" id="3277707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277712">c</span><span class="op" id="3277713">.</span><span class="ident" id="3277714">Close</span><span class="op" id="3277719">(</span><span class="op" id="3277720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277725">return</span>&nbsp;<span class="ident" id="3277732">nil</span><span class="op" id="3277735">,</span>&nbsp;<span class="op" id="3277737">&amp;</span><span class="ident" id="3277738">OpError</span><span class="op" id="3277745">{</span><span class="ident" id="3277746">Op</span><span class="op" id="3277748">:</span>&nbsp;<span class="string" id="3277750">&#34;listen&#34;</span><span class="op" id="3277758">,</span>&nbsp;<span class="ident" id="3277760">Net</span><span class="op" id="3277763">:</span>&nbsp;<span class="ident" id="3277765">net</span><span class="op" id="3277768">,</span>&nbsp;<span class="ident" id="3277770">Addr</span><span class="op" id="3277774">:</span>&nbsp;<span class="op" id="3277776">&amp;</span><span class="ident" id="3277777">IPAddr</span><span class="op" id="3277783">{</span><span class="ident" id="3277784">IP</span><span class="op" id="3277786">:</span>&nbsp;<span class="ident" id="3277788">gaddr</span><span class="op" id="3277793">.</span><span class="ident" id="3277794">IP</span><span class="op" id="3277796">}</span><span class="op" id="3277797">,</span>&nbsp;<span class="ident" id="3277799">Err</span><span class="op" id="3277802">:</span>&nbsp;<span class="ident" id="3277804">err</span><span class="op" id="3277807">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277817">return</span>&nbsp;<span class="ident" id="3277824">c</span><span class="op" id="3277825">,</span>&nbsp;<span class="ident" id="3277827">nil</span><br>
<span class="lineno"></span><span class="op" id="3277831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3277834">func</span>&nbsp;<span class="ident" id="3277839">listenIPv4MulticastUDP</span><span class="op" id="3277861">(</span><span class="ident" id="3277862">c</span>&nbsp;<span class="op" id="3277864">*</span><span class="ident" id="3277865">UDPConn</span><span class="op" id="3277872">,</span>&nbsp;<span class="ident" id="3277874">ifi</span>&nbsp;<span class="op" id="3277878">*</span><span class="ident" id="3277879">Interface</span><span class="op" id="3277888">,</span>&nbsp;<span class="ident" id="3277890">ip</span>&nbsp;<span class="ident" id="3277893">IP</span><span class="op" id="3277895">)</span>&nbsp;<span class="builtintype" id="3277897">error</span>&nbsp;<span class="op" id="3277903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277906">if</span>&nbsp;<span class="ident" id="3277909">ifi</span>&nbsp;<span class="op" id="3277913">!=</span>&nbsp;<span class="ident" id="3277916">nil</span>&nbsp;<span class="op" id="3277920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277924">if</span>&nbsp;<span class="ident" id="3277927">err</span>&nbsp;<span class="op" id="3277931">:=</span>&nbsp;<span class="ident" id="3277934">setIPv4MulticastInterface</span><span class="op" id="3277959">(</span><span class="ident" id="3277960">c</span><span class="op" id="3277961">.</span><span class="ident" id="3277962">fd</span><span class="op" id="3277964">,</span>&nbsp;<span class="ident" id="3277966">ifi</span><span class="op" id="3277969">)</span><span class="op" id="3277970">;</span>&nbsp;<span class="ident" id="3277972">err</span>&nbsp;<span class="op" id="3277976">!=</span>&nbsp;<span class="ident" id="3277979">nil</span>&nbsp;<span class="op" id="3277983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277988">return</span>&nbsp;<span class="ident" id="3277995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278001">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278007">if</span>&nbsp;<span class="ident" id="3278010">err</span>&nbsp;<span class="op" id="3278014">:=</span>&nbsp;<span class="ident" id="3278017">setIPv4MulticastLoopback</span><span class="op" id="3278041">(</span><span class="ident" id="3278042">c</span><span class="op" id="3278043">.</span><span class="ident" id="3278044">fd</span><span class="op" id="3278046">,</span>&nbsp;<span class="builtintype" id="3278048">false</span><span class="op" id="3278053">)</span><span class="op" id="3278054">;</span>&nbsp;<span class="ident" id="3278056">err</span>&nbsp;<span class="op" id="3278060">!=</span>&nbsp;<span class="ident" id="3278063">nil</span>&nbsp;<span class="op" id="3278067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278071">return</span>&nbsp;<span class="ident" id="3278078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278086">if</span>&nbsp;<span class="ident" id="3278089">err</span>&nbsp;<span class="op" id="3278093">:=</span>&nbsp;<span class="ident" id="3278096">joinIPv4Group</span><span class="op" id="3278109">(</span><span class="ident" id="3278110">c</span><span class="op" id="3278111">.</span><span class="ident" id="3278112">fd</span><span class="op" id="3278114">,</span>&nbsp;<span class="ident" id="3278116">ifi</span><span class="op" id="3278119">,</span>&nbsp;<span class="ident" id="3278121">ip</span><span class="op" id="3278123">)</span><span class="op" id="3278124">;</span>&nbsp;<span class="ident" id="3278126">err</span>&nbsp;<span class="op" id="3278130">!=</span>&nbsp;<span class="ident" id="3278133">nil</span>&nbsp;<span class="op" id="3278137">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278141">return</span>&nbsp;<span class="ident" id="3278148">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278156">return</span>&nbsp;<span class="ident" id="3278163">nil</span><br>
<span class="lineno"></span><span class="op" id="3278167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3278170">func</span>&nbsp;<span class="ident" id="3278175">listenIPv6MulticastUDP</span><span class="op" id="3278197">(</span><span class="ident" id="3278198">c</span>&nbsp;<span class="op" id="3278200">*</span><span class="ident" id="3278201">UDPConn</span><span class="op" id="3278208">,</span>&nbsp;<span class="ident" id="3278210">ifi</span>&nbsp;<span class="op" id="3278214">*</span><span class="ident" id="3278215">Interface</span><span class="op" id="3278224">,</span>&nbsp;<span class="ident" id="3278226">ip</span>&nbsp;<span class="ident" id="3278229">IP</span><span class="op" id="3278231">)</span>&nbsp;<span class="builtintype" id="3278233">error</span>&nbsp;<span class="op" id="3278239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278242">if</span>&nbsp;<span class="ident" id="3278245">ifi</span>&nbsp;<span class="op" id="3278249">!=</span>&nbsp;<span class="ident" id="3278252">nil</span>&nbsp;<span class="op" id="3278256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278260">if</span>&nbsp;<span class="ident" id="3278263">err</span>&nbsp;<span class="op" id="3278267">:=</span>&nbsp;<span class="ident" id="3278270">setIPv6MulticastInterface</span><span class="op" id="3278295">(</span><span class="ident" id="3278296">c</span><span class="op" id="3278297">.</span><span class="ident" id="3278298">fd</span><span class="op" id="3278300">,</span>&nbsp;<span class="ident" id="3278302">ifi</span><span class="op" id="3278305">)</span><span class="op" id="3278306">;</span>&nbsp;<span class="ident" id="3278308">err</span>&nbsp;<span class="op" id="3278312">!=</span>&nbsp;<span class="ident" id="3278315">nil</span>&nbsp;<span class="op" id="3278319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278324">return</span>&nbsp;<span class="ident" id="3278331">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278337">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278343">if</span>&nbsp;<span class="ident" id="3278346">err</span>&nbsp;<span class="op" id="3278350">:=</span>&nbsp;<span class="ident" id="3278353">setIPv6MulticastLoopback</span><span class="op" id="3278377">(</span><span class="ident" id="3278378">c</span><span class="op" id="3278379">.</span><span class="ident" id="3278380">fd</span><span class="op" id="3278382">,</span>&nbsp;<span class="builtintype" id="3278384">false</span><span class="op" id="3278389">)</span><span class="op" id="3278390">;</span>&nbsp;<span class="ident" id="3278392">err</span>&nbsp;<span class="op" id="3278396">!=</span>&nbsp;<span class="ident" id="3278399">nil</span>&nbsp;<span class="op" id="3278403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278407">return</span>&nbsp;<span class="ident" id="3278414">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278422">if</span>&nbsp;<span class="ident" id="3278425">err</span>&nbsp;<span class="op" id="3278429">:=</span>&nbsp;<span class="ident" id="3278432">joinIPv6Group</span><span class="op" id="3278445">(</span><span class="ident" id="3278446">c</span><span class="op" id="3278447">.</span><span class="ident" id="3278448">fd</span><span class="op" id="3278450">,</span>&nbsp;<span class="ident" id="3278452">ifi</span><span class="op" id="3278455">,</span>&nbsp;<span class="ident" id="3278457">ip</span><span class="op" id="3278459">)</span><span class="op" id="3278460">;</span>&nbsp;<span class="ident" id="3278462">err</span>&nbsp;<span class="op" id="3278466">!=</span>&nbsp;<span class="ident" id="3278469">nil</span>&nbsp;<span class="op" id="3278473">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278477">return</span>&nbsp;<span class="ident" id="3278484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278492">return</span>&nbsp;<span class="ident" id="3278499">nil</span><br>
<span class="lineno"></span><span class="op" id="3278503">}</span>
</div>
</body>
</html>
