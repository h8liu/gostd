<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6982728">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6982783">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6982837">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6982888">package</span>&nbsp;<span class="ident" id="6982896">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6982906">import</span>&nbsp;<span class="op" id="6982913">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982916">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982925">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982934">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982941">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982947">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982960">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6982971">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6982981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6982984">func</span>&nbsp;<span class="ident" id="6982989">TestChunk</span><span class="op" id="6982998">(</span><span class="ident" id="6982999">t</span>&nbsp;<span class="op" id="6983001">*</span><span class="ident" id="6983002"><a href="/net/http/internal/chunked_test.go.html#6982971">testing</a></span><span class="op" id="6983009">.</span><span class="ident" id="6983010">T</span><span class="op" id="6983011">)</span>&nbsp;<span class="op" id="6983013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983016">var</span>&nbsp;<span class="ident" id="6983020">b</span>&nbsp;<span class="ident" id="6983022"><a href="/net/http/internal/chunked_test.go.html#6982925">bytes</a></span><span class="op" id="6983027">.</span><span class="ident" id="6983028">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983037">w</span>&nbsp;<span class="op" id="6983039">:=</span>&nbsp;<span class="ident" id="6983042"><a href="/net/http/internal/chunked.go.html#4293898">NewChunkedWriter</a></span><span class="op" id="6983058">(</span><span class="op" id="6983059">&amp;</span><span class="ident" id="6983060"><a href="/net/http/internal/chunked_test.go.html#6983020">b</a></span><span class="op" id="6983061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983064">const</span>&nbsp;<span class="ident" id="6983070">chunk1</span>&nbsp;<span class="op" id="6983077">=</span>&nbsp;<span class="string" id="6983079">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983090">const</span>&nbsp;<span class="ident" id="6983096">chunk2</span>&nbsp;<span class="op" id="6983103">=</span>&nbsp;<span class="string" id="6983105">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983132"><a href="/net/http/internal/chunked_test.go.html#6983037">w</a></span><span class="op" id="6983133">.</span><span class="ident" id="6983134">Write</span><span class="op" id="6983139">(</span><span class="op" id="6983140">[</span><span class="op" id="6983141">]</span><span class="builtintype" id="6983142">byte</span><span class="op" id="6983146">(</span><span class="ident" id="6983147"><a href="/net/http/internal/chunked_test.go.html#6983070">chunk1</a></span><span class="op" id="6983153">)</span><span class="op" id="6983154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983157"><a href="/net/http/internal/chunked_test.go.html#6983037">w</a></span><span class="op" id="6983158">.</span><span class="ident" id="6983159">Write</span><span class="op" id="6983164">(</span><span class="op" id="6983165">[</span><span class="op" id="6983166">]</span><span class="builtintype" id="6983167">byte</span><span class="op" id="6983171">(</span><span class="ident" id="6983172"><a href="/net/http/internal/chunked_test.go.html#6983096">chunk2</a></span><span class="op" id="6983178">)</span><span class="op" id="6983179">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983182"><a href="/net/http/internal/chunked_test.go.html#6983037">w</a></span><span class="op" id="6983183">.</span><span class="ident" id="6983184">Close</span><span class="op" id="6983189">(</span><span class="op" id="6983190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983194">if</span>&nbsp;<span class="ident" id="6983197">g</span><span class="op" id="6983198">,</span>&nbsp;<span class="ident" id="6983200">e</span>&nbsp;<span class="op" id="6983202">:=</span>&nbsp;<span class="ident" id="6983205"><a href="/net/http/internal/chunked_test.go.html#6983020">b</a></span><span class="op" id="6983206">.</span><span class="ident" id="6983207">String</span><span class="op" id="6983213">(</span><span class="op" id="6983214">)</span><span class="op" id="6983215">,</span>&nbsp;<span class="string" id="6983217">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="6983273">;</span>&nbsp;<span class="ident" id="6983275"><a href="/net/http/internal/chunked_test.go.html#6983197">g</a></span>&nbsp;<span class="op" id="6983277">!=</span>&nbsp;<span class="ident" id="6983280"><a href="/net/http/internal/chunked_test.go.html#6983200">e</a></span>&nbsp;<span class="op" id="6983282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983286"><a href="/net/http/internal/chunked_test.go.html#6982999">t</a></span><span class="op" id="6983287">.</span><span class="ident" id="6983288">Fatalf</span><span class="op" id="6983294">(</span><span class="string" id="6983295">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6983327">,</span>&nbsp;<span class="ident" id="6983329"><a href="/net/http/internal/chunked_test.go.html#6983197">g</a></span><span class="op" id="6983330">,</span>&nbsp;<span class="ident" id="6983332"><a href="/net/http/internal/chunked_test.go.html#6983200">e</a></span><span class="op" id="6983333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983336">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983340">r</span>&nbsp;<span class="op" id="6983342">:=</span>&nbsp;<span class="ident" id="6983345"><a href="/net/http/internal/chunked.go.html#4291007">NewChunkedReader</a></span><span class="op" id="6983361">(</span><span class="op" id="6983362">&amp;</span><span class="ident" id="6983363"><a href="/net/http/internal/chunked_test.go.html#6983020">b</a></span><span class="op" id="6983364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983367">data</span><span class="op" id="6983371">,</span>&nbsp;<span class="ident" id="6983373">err</span>&nbsp;<span class="op" id="6983377">:=</span>&nbsp;<span class="ident" id="6983380"><a href="/net/http/internal/chunked_test.go.html#6982947">ioutil</a></span><span class="op" id="6983386">.</span><span class="ident" id="6983387">ReadAll</span><span class="op" id="6983394">(</span><span class="ident" id="6983395"><a href="/net/http/internal/chunked_test.go.html#6983340">r</a></span><span class="op" id="6983396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983399">if</span>&nbsp;<span class="ident" id="6983402"><a href="/net/http/internal/chunked_test.go.html#6983373">err</a></span>&nbsp;<span class="op" id="6983406">!=</span>&nbsp;<span class="ident" id="6983409">nil</span>&nbsp;<span class="op" id="6983413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983417"><a href="/net/http/internal/chunked_test.go.html#6982999">t</a></span><span class="op" id="6983418">.</span><span class="ident" id="6983419">Logf</span><span class="op" id="6983423">(</span><span class="string" id="6983424">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="6983436">,</span>&nbsp;<span class="ident" id="6983438"><a href="/net/http/internal/chunked_test.go.html#6983367">data</a></span><span class="op" id="6983442">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983446"><a href="/net/http/internal/chunked_test.go.html#6982999">t</a></span><span class="op" id="6983447">.</span><span class="ident" id="6983448">Fatalf</span><span class="op" id="6983454">(</span><span class="string" id="6983455">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="6983480">,</span>&nbsp;<span class="ident" id="6983482"><a href="/net/http/internal/chunked_test.go.html#6983373">err</a></span><span class="op" id="6983485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983491">if</span>&nbsp;<span class="ident" id="6983494">g</span><span class="op" id="6983495">,</span>&nbsp;<span class="ident" id="6983497">e</span>&nbsp;<span class="op" id="6983499">:=</span>&nbsp;<span class="builtintype" id="6983502">string</span><span class="op" id="6983508">(</span><span class="ident" id="6983509"><a href="/net/http/internal/chunked_test.go.html#6983367">data</a></span><span class="op" id="6983513">)</span><span class="op" id="6983514">,</span>&nbsp;<span class="ident" id="6983516"><a href="/net/http/internal/chunked_test.go.html#6983070">chunk1</a></span><span class="op" id="6983522">+</span><span class="ident" id="6983523"><a href="/net/http/internal/chunked_test.go.html#6983096">chunk2</a></span><span class="op" id="6983529">;</span>&nbsp;<span class="ident" id="6983531"><a href="/net/http/internal/chunked_test.go.html#6983494">g</a></span>&nbsp;<span class="op" id="6983533">!=</span>&nbsp;<span class="ident" id="6983536"><a href="/net/http/internal/chunked_test.go.html#6983497">e</a></span>&nbsp;<span class="op" id="6983538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983542"><a href="/net/http/internal/chunked_test.go.html#6982999">t</a></span><span class="op" id="6983543">.</span><span class="ident" id="6983544">Errorf</span><span class="op" id="6983550">(</span><span class="string" id="6983551">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6983582">,</span>&nbsp;<span class="ident" id="6983584"><a href="/net/http/internal/chunked_test.go.html#6983494">g</a></span><span class="op" id="6983585">,</span>&nbsp;<span class="ident" id="6983587"><a href="/net/http/internal/chunked_test.go.html#6983497">e</a></span><span class="op" id="6983588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983591">}</span><br>
<span class="lineno">40</span><span class="op" id="6983593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6983596">func</span>&nbsp;<span class="ident" id="6983601">TestChunkReadMultiple</span><span class="op" id="6983622">(</span><span class="ident" id="6983623">t</span>&nbsp;<span class="op" id="6983625">*</span><span class="ident" id="6983626"><a href="/net/http/internal/chunked_test.go.html#6982971">testing</a></span><span class="op" id="6983633">.</span><span class="ident" id="6983634">T</span><span class="op" id="6983635">)</span>&nbsp;<span class="op" id="6983637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6983640">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983686">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983690">var</span>&nbsp;<span class="ident" id="6983694">b</span>&nbsp;<span class="ident" id="6983696"><a href="/net/http/internal/chunked_test.go.html#6982925">bytes</a></span><span class="op" id="6983701">.</span><span class="ident" id="6983702">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983711">w</span>&nbsp;<span class="op" id="6983713">:=</span>&nbsp;<span class="ident" id="6983716"><a href="/net/http/internal/chunked.go.html#4293898">NewChunkedWriter</a></span><span class="op" id="6983732">(</span><span class="op" id="6983733">&amp;</span><span class="ident" id="6983734"><a href="/net/http/internal/chunked_test.go.html#6983694">b</a></span><span class="op" id="6983735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983739"><a href="/net/http/internal/chunked_test.go.html#6983711">w</a></span><span class="op" id="6983740">.</span><span class="ident" id="6983741">Write</span><span class="op" id="6983746">(</span><span class="op" id="6983747">[</span><span class="op" id="6983748">]</span><span class="builtintype" id="6983749">byte</span><span class="op" id="6983753">(</span><span class="string" id="6983754">&#34;foo&#34;</span><span class="op" id="6983759">)</span><span class="op" id="6983760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983764"><a href="/net/http/internal/chunked_test.go.html#6983711">w</a></span><span class="op" id="6983765">.</span><span class="ident" id="6983766">Write</span><span class="op" id="6983771">(</span><span class="op" id="6983772">[</span><span class="op" id="6983773">]</span><span class="builtintype" id="6983774">byte</span><span class="op" id="6983778">(</span><span class="string" id="6983779">&#34;bar&#34;</span><span class="op" id="6983784">)</span><span class="op" id="6983785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983789"><a href="/net/http/internal/chunked_test.go.html#6983711">w</a></span><span class="op" id="6983790">.</span><span class="ident" id="6983791">Close</span><span class="op" id="6983796">(</span><span class="op" id="6983797">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983802">r</span>&nbsp;<span class="op" id="6983804">:=</span>&nbsp;<span class="ident" id="6983807"><a href="/net/http/internal/chunked.go.html#4291007">NewChunkedReader</a></span><span class="op" id="6983823">(</span><span class="op" id="6983824">&amp;</span><span class="ident" id="6983825"><a href="/net/http/internal/chunked_test.go.html#6983694">b</a></span><span class="op" id="6983826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983830">buf</span>&nbsp;<span class="op" id="6983834">:=</span>&nbsp;<span class="builtinfunc" id="6983837">make</span><span class="op" id="6983841">(</span><span class="op" id="6983842">[</span><span class="op" id="6983843">]</span><span class="builtintype" id="6983844">byte</span><span class="op" id="6983848">,</span>&nbsp;<span class="num" id="6983850">10</span><span class="op" id="6983852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983856">n</span><span class="op" id="6983857">,</span>&nbsp;<span class="ident" id="6983859">err</span>&nbsp;<span class="op" id="6983863">:=</span>&nbsp;<span class="ident" id="6983866"><a href="/net/http/internal/chunked_test.go.html#6983802">r</a></span><span class="op" id="6983867">.</span><span class="ident" id="6983868">Read</span><span class="op" id="6983872">(</span><span class="ident" id="6983873"><a href="/net/http/internal/chunked_test.go.html#6983830">buf</a></span><span class="op" id="6983876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983880">if</span>&nbsp;<span class="ident" id="6983883"><a href="/net/http/internal/chunked_test.go.html#6983856">n</a></span>&nbsp;<span class="op" id="6983885">!=</span>&nbsp;<span class="num" id="6983888">6</span>&nbsp;<span class="op" id="6983890">||</span>&nbsp;<span class="ident" id="6983893"><a href="/net/http/internal/chunked_test.go.html#6983859">err</a></span>&nbsp;<span class="op" id="6983897">!=</span>&nbsp;<span class="ident" id="6983900"><a href="/net/http/internal/chunked_test.go.html#6982941">io</a></span><span class="op" id="6983902">.</span><span class="ident" id="6983903">EOF</span>&nbsp;<span class="op" id="6983907">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983912"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6983913">.</span><span class="ident" id="6983914">Errorf</span><span class="op" id="6983920">(</span><span class="string" id="6983921">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="6983949">,</span>&nbsp;<span class="ident" id="6983951"><a href="/net/http/internal/chunked_test.go.html#6983856">n</a></span><span class="op" id="6983952">,</span>&nbsp;<span class="ident" id="6983954"><a href="/net/http/internal/chunked_test.go.html#6983859">err</a></span><span class="op" id="6983957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983965"><a href="/net/http/internal/chunked_test.go.html#6983830">buf</a></span>&nbsp;<span class="op" id="6983969">=</span>&nbsp;<span class="ident" id="6983971"><a href="/net/http/internal/chunked_test.go.html#6983830">buf</a></span><span class="op" id="6983974">[</span><span class="op" id="6983975">:</span><span class="ident" id="6983976"><a href="/net/http/internal/chunked_test.go.html#6983856">n</a></span><span class="op" id="6983977">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983981">if</span>&nbsp;<span class="builtintype" id="6983984">string</span><span class="op" id="6983990">(</span><span class="ident" id="6983991"><a href="/net/http/internal/chunked_test.go.html#6983830">buf</a></span><span class="op" id="6983994">)</span>&nbsp;<span class="op" id="6983996">!=</span>&nbsp;<span class="string" id="6983999">&#34;foobar&#34;</span>&nbsp;<span class="op" id="6984008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984013"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6984014">.</span><span class="ident" id="6984015">Errorf</span><span class="op" id="6984021">(</span><span class="string" id="6984022">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6984042">,</span>&nbsp;<span class="ident" id="6984044"><a href="/net/http/internal/chunked_test.go.html#6983830">buf</a></span><span class="op" id="6984047">,</span>&nbsp;<span class="string" id="6984049">&#34;foobar&#34;</span><span class="op" id="6984057">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984068">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984146">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984210">var</span>&nbsp;<span class="ident" id="6984214">b</span>&nbsp;<span class="ident" id="6984216"><a href="/net/http/internal/chunked_test.go.html#6982925">bytes</a></span><span class="op" id="6984221">.</span><span class="ident" id="6984222">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984231">w</span>&nbsp;<span class="op" id="6984233">:=</span>&nbsp;<span class="ident" id="6984236"><a href="/net/http/internal/chunked.go.html#4293898">NewChunkedWriter</a></span><span class="op" id="6984252">(</span><span class="op" id="6984253">&amp;</span><span class="ident" id="6984254"><a href="/net/http/internal/chunked_test.go.html#6984214">b</a></span><span class="op" id="6984255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984259">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984335">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984402">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984477">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984540">const</span>&nbsp;<span class="ident" id="6984546">fillBufChunk</span>&nbsp;<span class="op" id="6984559">=</span>&nbsp;<span class="string" id="6984561">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984577">const</span>&nbsp;<span class="ident" id="6984583">shortChunk</span>&nbsp;<span class="op" id="6984594">=</span>&nbsp;<span class="string" id="6984596">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984604"><a href="/net/http/internal/chunked_test.go.html#6984231">w</a></span><span class="op" id="6984605">.</span><span class="ident" id="6984606">Write</span><span class="op" id="6984611">(</span><span class="op" id="6984612">[</span><span class="op" id="6984613">]</span><span class="builtintype" id="6984614">byte</span><span class="op" id="6984618">(</span><span class="ident" id="6984619"><a href="/net/http/internal/chunked_test.go.html#6984546">fillBufChunk</a></span><span class="op" id="6984631">)</span><span class="op" id="6984632">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984636"><a href="/net/http/internal/chunked_test.go.html#6984231">w</a></span><span class="op" id="6984637">.</span><span class="ident" id="6984638">Write</span><span class="op" id="6984643">(</span><span class="op" id="6984644">[</span><span class="op" id="6984645">]</span><span class="builtintype" id="6984646">byte</span><span class="op" id="6984650">(</span><span class="ident" id="6984651"><a href="/net/http/internal/chunked_test.go.html#6984583">shortChunk</a></span><span class="op" id="6984661">)</span><span class="op" id="6984662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984666"><a href="/net/http/internal/chunked_test.go.html#6984231">w</a></span><span class="op" id="6984667">.</span><span class="ident" id="6984668">Close</span><span class="op" id="6984673">(</span><span class="op" id="6984674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984679">r</span>&nbsp;<span class="op" id="6984681">:=</span>&nbsp;<span class="ident" id="6984684"><a href="/net/http/internal/chunked.go.html#4291007">NewChunkedReader</a></span><span class="op" id="6984700">(</span><span class="ident" id="6984701"><a href="/net/http/internal/chunked_test.go.html#6982916">bufio</a></span><span class="op" id="6984706">.</span><span class="ident" id="6984707">NewReaderSize</span><span class="op" id="6984720">(</span><span class="op" id="6984721">&amp;</span><span class="ident" id="6984722"><a href="/net/http/internal/chunked_test.go.html#6984214">b</a></span><span class="op" id="6984723">,</span>&nbsp;<span class="num" id="6984725">16</span><span class="op" id="6984727">)</span><span class="op" id="6984728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984732">buf</span>&nbsp;<span class="op" id="6984736">:=</span>&nbsp;<span class="builtinfunc" id="6984739">make</span><span class="op" id="6984743">(</span><span class="op" id="6984744">[</span><span class="op" id="6984745">]</span><span class="builtintype" id="6984746">byte</span><span class="op" id="6984750">,</span>&nbsp;<span class="builtinfunc" id="6984752">len</span><span class="op" id="6984755">(</span><span class="ident" id="6984756"><a href="/net/http/internal/chunked_test.go.html#6984546">fillBufChunk</a></span><span class="op" id="6984768">)</span><span class="op" id="6984769">+</span><span class="builtinfunc" id="6984770">len</span><span class="op" id="6984773">(</span><span class="ident" id="6984774"><a href="/net/http/internal/chunked_test.go.html#6984583">shortChunk</a></span><span class="op" id="6984784">)</span><span class="op" id="6984785">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984789">n</span><span class="op" id="6984790">,</span>&nbsp;<span class="ident" id="6984792">err</span>&nbsp;<span class="op" id="6984796">:=</span>&nbsp;<span class="ident" id="6984799"><a href="/net/http/internal/chunked_test.go.html#6984679">r</a></span><span class="op" id="6984800">.</span><span class="ident" id="6984801">Read</span><span class="op" id="6984805">(</span><span class="ident" id="6984806"><a href="/net/http/internal/chunked_test.go.html#6984732">buf</a></span><span class="op" id="6984809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984813">if</span>&nbsp;<span class="ident" id="6984816"><a href="/net/http/internal/chunked_test.go.html#6984789">n</a></span>&nbsp;<span class="op" id="6984818">!=</span>&nbsp;<span class="builtinfunc" id="6984821">len</span><span class="op" id="6984824">(</span><span class="ident" id="6984825"><a href="/net/http/internal/chunked_test.go.html#6984546">fillBufChunk</a></span><span class="op" id="6984837">)</span>&nbsp;<span class="op" id="6984839">||</span>&nbsp;<span class="ident" id="6984842"><a href="/net/http/internal/chunked_test.go.html#6984792">err</a></span>&nbsp;<span class="op" id="6984846">!=</span>&nbsp;<span class="ident" id="6984849">nil</span>&nbsp;<span class="op" id="6984853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984858"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6984859">.</span><span class="ident" id="6984860">Errorf</span><span class="op" id="6984866">(</span><span class="string" id="6984867">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6984896">,</span>&nbsp;<span class="ident" id="6984898"><a href="/net/http/internal/chunked_test.go.html#6984789">n</a></span><span class="op" id="6984899">,</span>&nbsp;<span class="ident" id="6984901"><a href="/net/http/internal/chunked_test.go.html#6984792">err</a></span><span class="op" id="6984904">,</span>&nbsp;<span class="builtinfunc" id="6984906">len</span><span class="op" id="6984909">(</span><span class="ident" id="6984910"><a href="/net/http/internal/chunked_test.go.html#6984546">fillBufChunk</a></span><span class="op" id="6984922">)</span><span class="op" id="6984923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984931"><a href="/net/http/internal/chunked_test.go.html#6984732">buf</a></span>&nbsp;<span class="op" id="6984935">=</span>&nbsp;<span class="ident" id="6984937"><a href="/net/http/internal/chunked_test.go.html#6984732">buf</a></span><span class="op" id="6984940">[</span><span class="op" id="6984941">:</span><span class="ident" id="6984942"><a href="/net/http/internal/chunked_test.go.html#6984789">n</a></span><span class="op" id="6984943">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984947">if</span>&nbsp;<span class="builtintype" id="6984950">string</span><span class="op" id="6984956">(</span><span class="ident" id="6984957"><a href="/net/http/internal/chunked_test.go.html#6984732">buf</a></span><span class="op" id="6984960">)</span>&nbsp;<span class="op" id="6984962">!=</span>&nbsp;<span class="ident" id="6984965"><a href="/net/http/internal/chunked_test.go.html#6984546">fillBufChunk</a></span>&nbsp;<span class="op" id="6984978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984983"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6984984">.</span><span class="ident" id="6984985">Errorf</span><span class="op" id="6984991">(</span><span class="string" id="6984992">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6985012">,</span>&nbsp;<span class="ident" id="6985014"><a href="/net/http/internal/chunked_test.go.html#6984732">buf</a></span><span class="op" id="6985017">,</span>&nbsp;<span class="ident" id="6985019"><a href="/net/http/internal/chunked_test.go.html#6984546">fillBufChunk</a></span><span class="op" id="6985031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985040"><a href="/net/http/internal/chunked_test.go.html#6984789">n</a></span><span class="op" id="6985041">,</span>&nbsp;<span class="ident" id="6985043"><a href="/net/http/internal/chunked_test.go.html#6984792">err</a></span>&nbsp;<span class="op" id="6985047">=</span>&nbsp;<span class="ident" id="6985049"><a href="/net/http/internal/chunked_test.go.html#6984679">r</a></span><span class="op" id="6985050">.</span><span class="ident" id="6985051">Read</span><span class="op" id="6985055">(</span><span class="ident" id="6985056"><a href="/net/http/internal/chunked_test.go.html#6984732">buf</a></span><span class="op" id="6985059">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985063">if</span>&nbsp;<span class="ident" id="6985066"><a href="/net/http/internal/chunked_test.go.html#6984789">n</a></span>&nbsp;<span class="op" id="6985068">!=</span>&nbsp;<span class="builtinfunc" id="6985071">len</span><span class="op" id="6985074">(</span><span class="ident" id="6985075"><a href="/net/http/internal/chunked_test.go.html#6984583">shortChunk</a></span><span class="op" id="6985085">)</span>&nbsp;<span class="op" id="6985087">||</span>&nbsp;<span class="ident" id="6985090"><a href="/net/http/internal/chunked_test.go.html#6984792">err</a></span>&nbsp;<span class="op" id="6985094">!=</span>&nbsp;<span class="ident" id="6985097"><a href="/net/http/internal/chunked_test.go.html#6982941">io</a></span><span class="op" id="6985099">.</span><span class="ident" id="6985100">EOF</span>&nbsp;<span class="op" id="6985104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985109"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6985110">.</span><span class="ident" id="6985111">Errorf</span><span class="op" id="6985117">(</span><span class="string" id="6985118">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="6985147">,</span>&nbsp;<span class="ident" id="6985149"><a href="/net/http/internal/chunked_test.go.html#6984789">n</a></span><span class="op" id="6985150">,</span>&nbsp;<span class="ident" id="6985152"><a href="/net/http/internal/chunked_test.go.html#6984792">err</a></span><span class="op" id="6985155">,</span>&nbsp;<span class="builtinfunc" id="6985157">len</span><span class="op" id="6985160">(</span><span class="ident" id="6985161"><a href="/net/http/internal/chunked_test.go.html#6984583">shortChunk</a></span><span class="op" id="6985171">)</span><span class="op" id="6985172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6985183">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985266">r</span>&nbsp;<span class="op" id="6985268">:=</span>&nbsp;<span class="ident" id="6985271"><a href="/net/http/internal/chunked.go.html#4291007">NewChunkedReader</a></span><span class="op" id="6985287">(</span><span class="ident" id="6985288"><a href="/net/http/internal/chunked_test.go.html#6982916">bufio</a></span><span class="op" id="6985293">.</span><span class="ident" id="6985294">NewReader</span><span class="op" id="6985303">(</span><span class="ident" id="6985304"><a href="/net/http/internal/chunked_test.go.html#6982960">strings</a></span><span class="op" id="6985311">.</span><span class="ident" id="6985312">NewReader</span><span class="op" id="6985321">(</span><span class="string" id="6985322">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="6985341">)</span><span class="op" id="6985342">)</span><span class="op" id="6985343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985347">buf</span>&nbsp;<span class="op" id="6985351">:=</span>&nbsp;<span class="builtinfunc" id="6985354">make</span><span class="op" id="6985358">(</span><span class="op" id="6985359">[</span><span class="op" id="6985360">]</span><span class="builtintype" id="6985361">byte</span><span class="op" id="6985365">,</span>&nbsp;<span class="num" id="6985367">3</span><span class="op" id="6985368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985372">n</span><span class="op" id="6985373">,</span>&nbsp;<span class="ident" id="6985375">err</span>&nbsp;<span class="op" id="6985379">:=</span>&nbsp;<span class="ident" id="6985382"><a href="/net/http/internal/chunked_test.go.html#6985266">r</a></span><span class="op" id="6985383">.</span><span class="ident" id="6985384">Read</span><span class="op" id="6985388">(</span><span class="ident" id="6985389"><a href="/net/http/internal/chunked_test.go.html#6985347">buf</a></span><span class="op" id="6985392">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985396">if</span>&nbsp;<span class="ident" id="6985399"><a href="/net/http/internal/chunked_test.go.html#6985372">n</a></span>&nbsp;<span class="op" id="6985401">!=</span>&nbsp;<span class="num" id="6985404">3</span>&nbsp;<span class="op" id="6985406">||</span>&nbsp;<span class="ident" id="6985409"><a href="/net/http/internal/chunked_test.go.html#6985375">err</a></span>&nbsp;<span class="op" id="6985413">!=</span>&nbsp;<span class="ident" id="6985416"><a href="/net/http/internal/chunked_test.go.html#6982941">io</a></span><span class="op" id="6985418">.</span><span class="ident" id="6985419">EOF</span>&nbsp;<span class="op" id="6985423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985428"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6985429">.</span><span class="ident" id="6985430">Errorf</span><span class="op" id="6985436">(</span><span class="string" id="6985437">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="6985465">,</span>&nbsp;<span class="ident" id="6985467"><a href="/net/http/internal/chunked_test.go.html#6985372">n</a></span><span class="op" id="6985468">,</span>&nbsp;<span class="ident" id="6985470"><a href="/net/http/internal/chunked_test.go.html#6985375">err</a></span><span class="op" id="6985473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985481">if</span>&nbsp;<span class="builtintype" id="6985484">string</span><span class="op" id="6985490">(</span><span class="ident" id="6985491"><a href="/net/http/internal/chunked_test.go.html#6985347">buf</a></span><span class="op" id="6985494">)</span>&nbsp;<span class="op" id="6985496">!=</span>&nbsp;<span class="string" id="6985499">&#34;foo&#34;</span>&nbsp;<span class="op" id="6985505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985510"><a href="/net/http/internal/chunked_test.go.html#6983623">t</a></span><span class="op" id="6985511">.</span><span class="ident" id="6985512">Errorf</span><span class="op" id="6985518">(</span><span class="string" id="6985519">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="6985539">,</span>&nbsp;<span class="ident" id="6985541"><a href="/net/http/internal/chunked_test.go.html#6985347">buf</a></span><span class="op" id="6985544">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985551">}</span><br>
<span class="lineno"></span><span class="op" id="6985553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6985556">func</span>&nbsp;<span class="ident" id="6985561">TestChunkReaderAllocs</span><span class="op" id="6985582">(</span><span class="ident" id="6985583">t</span>&nbsp;<span class="op" id="6985585">*</span><span class="ident" id="6985586"><a href="/net/http/internal/chunked_test.go.html#6982971">testing</a></span><span class="op" id="6985593">.</span><span class="ident" id="6985594">T</span><span class="op" id="6985595">)</span>&nbsp;<span class="op" id="6985597">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985600">if</span>&nbsp;<span class="ident" id="6985603"><a href="/net/http/internal/chunked_test.go.html#6982971">testing</a></span><span class="op" id="6985610">.</span><span class="ident" id="6985611">Short</span><span class="op" id="6985616">(</span><span class="op" id="6985617">)</span>&nbsp;<span class="op" id="6985619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985623"><a href="/net/http/internal/chunked_test.go.html#6985583">t</a></span><span class="op" id="6985624">.</span><span class="ident" id="6985625">Skip</span><span class="op" id="6985629">(</span><span class="string" id="6985630">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6985654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985660">var</span>&nbsp;<span class="ident" id="6985664">buf</span>&nbsp;<span class="ident" id="6985668"><a href="/net/http/internal/chunked_test.go.html#6982925">bytes</a></span><span class="op" id="6985673">.</span><span class="ident" id="6985674">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985682">w</span>&nbsp;<span class="op" id="6985684">:=</span>&nbsp;<span class="ident" id="6985687"><a href="/net/http/internal/chunked.go.html#4293898">NewChunkedWriter</a></span><span class="op" id="6985703">(</span><span class="op" id="6985704">&amp;</span><span class="ident" id="6985705"><a href="/net/http/internal/chunked_test.go.html#6985664">buf</a></span><span class="op" id="6985708">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985711">a</span><span class="op" id="6985712">,</span>&nbsp;<span class="ident" id="6985714">b</span><span class="op" id="6985715">,</span>&nbsp;<span class="ident" id="6985717">c</span>&nbsp;<span class="op" id="6985719">:=</span>&nbsp;<span class="op" id="6985722">[</span><span class="op" id="6985723">]</span><span class="builtintype" id="6985724">byte</span><span class="op" id="6985728">(</span><span class="string" id="6985729">&#34;aaaaaa&#34;</span><span class="op" id="6985737">)</span><span class="op" id="6985738">,</span>&nbsp;<span class="op" id="6985740">[</span><span class="op" id="6985741">]</span><span class="builtintype" id="6985742">byte</span><span class="op" id="6985746">(</span><span class="string" id="6985747">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="6985761">)</span><span class="op" id="6985762">,</span>&nbsp;<span class="op" id="6985764">[</span><span class="op" id="6985765">]</span><span class="builtintype" id="6985766">byte</span><span class="op" id="6985770">(</span><span class="string" id="6985771">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="6985797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985800"><a href="/net/http/internal/chunked_test.go.html#6985682">w</a></span><span class="op" id="6985801">.</span><span class="ident" id="6985802">Write</span><span class="op" id="6985807">(</span><span class="ident" id="6985808"><a href="/net/http/internal/chunked_test.go.html#6985711">a</a></span><span class="op" id="6985809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985812"><a href="/net/http/internal/chunked_test.go.html#6985682">w</a></span><span class="op" id="6985813">.</span><span class="ident" id="6985814">Write</span><span class="op" id="6985819">(</span><span class="ident" id="6985820"><a href="/net/http/internal/chunked_test.go.html#6985714">b</a></span><span class="op" id="6985821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985824"><a href="/net/http/internal/chunked_test.go.html#6985682">w</a></span><span class="op" id="6985825">.</span><span class="ident" id="6985826">Write</span><span class="op" id="6985831">(</span><span class="ident" id="6985832"><a href="/net/http/internal/chunked_test.go.html#6985717">c</a></span><span class="op" id="6985833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985836"><a href="/net/http/internal/chunked_test.go.html#6985682">w</a></span><span class="op" id="6985837">.</span><span class="ident" id="6985838">Close</span><span class="op" id="6985843">(</span><span class="op" id="6985844">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985848">readBuf</span>&nbsp;<span class="op" id="6985856">:=</span>&nbsp;<span class="builtinfunc" id="6985859">make</span><span class="op" id="6985863">(</span><span class="op" id="6985864">[</span><span class="op" id="6985865">]</span><span class="builtintype" id="6985866">byte</span><span class="op" id="6985870">,</span>&nbsp;<span class="builtinfunc" id="6985872">len</span><span class="op" id="6985875">(</span><span class="ident" id="6985876"><a href="/net/http/internal/chunked_test.go.html#6985711">a</a></span><span class="op" id="6985877">)</span><span class="op" id="6985878">+</span><span class="builtinfunc" id="6985879">len</span><span class="op" id="6985882">(</span><span class="ident" id="6985883"><a href="/net/http/internal/chunked_test.go.html#6985714">b</a></span><span class="op" id="6985884">)</span><span class="op" id="6985885">+</span><span class="builtinfunc" id="6985886">len</span><span class="op" id="6985889">(</span><span class="ident" id="6985890"><a href="/net/http/internal/chunked_test.go.html#6985717">c</a></span><span class="op" id="6985891">)</span><span class="op" id="6985892">+</span><span class="num" id="6985893">1</span><span class="op" id="6985894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985897">byter</span>&nbsp;<span class="op" id="6985903">:=</span>&nbsp;<span class="ident" id="6985906"><a href="/net/http/internal/chunked_test.go.html#6982925">bytes</a></span><span class="op" id="6985911">.</span><span class="ident" id="6985912">NewReader</span><span class="op" id="6985921">(</span><span class="ident" id="6985922"><a href="/net/http/internal/chunked_test.go.html#6985664">buf</a></span><span class="op" id="6985925">.</span><span class="ident" id="6985926">Bytes</span><span class="op" id="6985931">(</span><span class="op" id="6985932">)</span><span class="op" id="6985933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985936">bufr</span>&nbsp;<span class="op" id="6985941">:=</span>&nbsp;<span class="ident" id="6985944"><a href="/net/http/internal/chunked_test.go.html#6982916">bufio</a></span><span class="op" id="6985949">.</span><span class="ident" id="6985950">NewReader</span><span class="op" id="6985959">(</span><span class="ident" id="6985960"><a href="/net/http/internal/chunked_test.go.html#6985897">byter</a></span><span class="op" id="6985965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985968">mallocs</span>&nbsp;<span class="op" id="6985976">:=</span>&nbsp;<span class="ident" id="6985979"><a href="/net/http/internal/chunked_test.go.html#6982971">testing</a></span><span class="op" id="6985986">.</span><span class="ident" id="6985987">AllocsPerRun</span><span class="op" id="6985999">(</span><span class="num" id="6986000">100</span><span class="op" id="6986003">,</span>&nbsp;<span class="keyword" id="6986005">func</span><span class="op" id="6986009">(</span><span class="op" id="6986010">)</span>&nbsp;<span class="op" id="6986012">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986016"><a href="/net/http/internal/chunked_test.go.html#6985897">byter</a></span><span class="op" id="6986021">.</span><span class="ident" id="6986022">Seek</span><span class="op" id="6986026">(</span><span class="num" id="6986027">0</span><span class="op" id="6986028">,</span>&nbsp;<span class="num" id="6986030">0</span><span class="op" id="6986031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986035"><a href="/net/http/internal/chunked_test.go.html#6985936">bufr</a></span><span class="op" id="6986039">.</span><span class="ident" id="6986040">Reset</span><span class="op" id="6986045">(</span><span class="ident" id="6986046"><a href="/net/http/internal/chunked_test.go.html#6985897">byter</a></span><span class="op" id="6986051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986055">r</span>&nbsp;<span class="op" id="6986057">:=</span>&nbsp;<span class="ident" id="6986060"><a href="/net/http/internal/chunked.go.html#4291007">NewChunkedReader</a></span><span class="op" id="6986076">(</span><span class="ident" id="6986077"><a href="/net/http/internal/chunked_test.go.html#6985936">bufr</a></span><span class="op" id="6986081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986085">n</span><span class="op" id="6986086">,</span>&nbsp;<span class="ident" id="6986088">err</span>&nbsp;<span class="op" id="6986092">:=</span>&nbsp;<span class="ident" id="6986095"><a href="/net/http/internal/chunked_test.go.html#6982941">io</a></span><span class="op" id="6986097">.</span><span class="ident" id="6986098">ReadFull</span><span class="op" id="6986106">(</span><span class="ident" id="6986107"><a href="/net/http/internal/chunked_test.go.html#6986055">r</a></span><span class="op" id="6986108">,</span>&nbsp;<span class="ident" id="6986110"><a href="/net/http/internal/chunked_test.go.html#6985848">readBuf</a></span><span class="op" id="6986117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986121">if</span>&nbsp;<span class="ident" id="6986124"><a href="/net/http/internal/chunked_test.go.html#6986085">n</a></span>&nbsp;<span class="op" id="6986126">!=</span>&nbsp;<span class="builtinfunc" id="6986129">len</span><span class="op" id="6986132">(</span><span class="ident" id="6986133"><a href="/net/http/internal/chunked_test.go.html#6985848">readBuf</a></span><span class="op" id="6986140">)</span><span class="op" id="6986141">-</span><span class="num" id="6986142">1</span>&nbsp;<span class="op" id="6986144">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986149"><a href="/net/http/internal/chunked_test.go.html#6985583">t</a></span><span class="op" id="6986150">.</span><span class="ident" id="6986151">Fatalf</span><span class="op" id="6986157">(</span><span class="string" id="6986158">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6986182">,</span>&nbsp;<span class="ident" id="6986184"><a href="/net/http/internal/chunked_test.go.html#6986085">n</a></span><span class="op" id="6986185">,</span>&nbsp;<span class="builtinfunc" id="6986187">len</span><span class="op" id="6986190">(</span><span class="ident" id="6986191"><a href="/net/http/internal/chunked_test.go.html#6985848">readBuf</a></span><span class="op" id="6986198">)</span><span class="op" id="6986199">-</span><span class="num" id="6986200">1</span><span class="op" id="6986201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986209">if</span>&nbsp;<span class="ident" id="6986212"><a href="/net/http/internal/chunked_test.go.html#6986088">err</a></span>&nbsp;<span class="op" id="6986216">!=</span>&nbsp;<span class="ident" id="6986219"><a href="/net/http/internal/chunked_test.go.html#6982941">io</a></span><span class="op" id="6986221">.</span><span class="ident" id="6986222">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6986239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986244"><a href="/net/http/internal/chunked_test.go.html#6985583">t</a></span><span class="op" id="6986245">.</span><span class="ident" id="6986246">Fatalf</span><span class="op" id="6986252">(</span><span class="string" id="6986253">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="6986293">,</span>&nbsp;<span class="ident" id="6986295"><a href="/net/http/internal/chunked_test.go.html#6986088">err</a></span><span class="op" id="6986298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986302">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986305">}</span><span class="op" id="6986306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986309">if</span>&nbsp;<span class="ident" id="6986312"><a href="/net/http/internal/chunked_test.go.html#6985968">mallocs</a></span>&nbsp;<span class="op" id="6986320">&gt;</span>&nbsp;<span class="num" id="6986322">1.5</span>&nbsp;<span class="op" id="6986326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986330"><a href="/net/http/internal/chunked_test.go.html#6985583">t</a></span><span class="op" id="6986331">.</span><span class="ident" id="6986332">Errorf</span><span class="op" id="6986338">(</span><span class="string" id="6986339">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="6986361">,</span>&nbsp;<span class="ident" id="6986363"><a href="/net/http/internal/chunked_test.go.html#6985968">mallocs</a></span><span class="op" id="6986370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986373">}</span><br>
<span class="lineno"></span><span class="op" id="6986375">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6986378">func</span>&nbsp;<span class="ident" id="6986383">TestParseHexUint</span><span class="op" id="6986399">(</span><span class="ident" id="6986400">t</span>&nbsp;<span class="op" id="6986402">*</span><span class="ident" id="6986403"><a href="/net/http/internal/chunked_test.go.html#6982971">testing</a></span><span class="op" id="6986410">.</span><span class="ident" id="6986411">T</span><span class="op" id="6986412">)</span>&nbsp;<span class="op" id="6986414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986417">for</span>&nbsp;<span class="ident" id="6986421">i</span>&nbsp;<span class="op" id="6986423">:=</span>&nbsp;<span class="ident" id="6986426">uint64</span><span class="op" id="6986432">(</span><span class="num" id="6986433">0</span><span class="op" id="6986434">)</span><span class="op" id="6986435">;</span>&nbsp;<span class="ident" id="6986437"><a href="/net/http/internal/chunked_test.go.html#6986421">i</a></span>&nbsp;<span class="op" id="6986439">&lt;=</span>&nbsp;<span class="num" id="6986442">1234</span><span class="op" id="6986446">;</span>&nbsp;<span class="ident" id="6986448"><a href="/net/http/internal/chunked_test.go.html#6986421">i</a></span><span class="op" id="6986449">++</span>&nbsp;<span class="op" id="6986452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986456">line</span>&nbsp;<span class="op" id="6986461">:=</span>&nbsp;<span class="op" id="6986464">[</span><span class="op" id="6986465">]</span><span class="builtintype" id="6986466">byte</span><span class="op" id="6986470">(</span><span class="ident" id="6986471"><a href="/net/http/internal/chunked_test.go.html#6982934">fmt</a></span><span class="op" id="6986474">.</span><span class="ident" id="6986475">Sprintf</span><span class="op" id="6986482">(</span><span class="string" id="6986483">&#34;%x&#34;</span><span class="op" id="6986487">,</span>&nbsp;<span class="ident" id="6986489"><a href="/net/http/internal/chunked_test.go.html#6986421">i</a></span><span class="op" id="6986490">)</span><span class="op" id="6986491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986495">got</span><span class="op" id="6986498">,</span>&nbsp;<span class="ident" id="6986500">err</span>&nbsp;<span class="op" id="6986504">:=</span>&nbsp;<span class="ident" id="6986507"><a href="/net/http/internal/chunked.go.html#4294893">parseHexUint</a></span><span class="op" id="6986519">(</span><span class="ident" id="6986520"><a href="/net/http/internal/chunked_test.go.html#6986456">line</a></span><span class="op" id="6986524">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986528">if</span>&nbsp;<span class="ident" id="6986531"><a href="/net/http/internal/chunked_test.go.html#6986500">err</a></span>&nbsp;<span class="op" id="6986535">!=</span>&nbsp;<span class="ident" id="6986538">nil</span>&nbsp;<span class="op" id="6986542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986547"><a href="/net/http/internal/chunked_test.go.html#6986400">t</a></span><span class="op" id="6986548">.</span><span class="ident" id="6986549">Fatalf</span><span class="op" id="6986555">(</span><span class="string" id="6986556">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6986567">,</span>&nbsp;<span class="ident" id="6986569"><a href="/net/http/internal/chunked_test.go.html#6986421">i</a></span><span class="op" id="6986570">,</span>&nbsp;<span class="ident" id="6986572"><a href="/net/http/internal/chunked_test.go.html#6986500">err</a></span><span class="op" id="6986575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986583">if</span>&nbsp;<span class="ident" id="6986586"><a href="/net/http/internal/chunked_test.go.html#6986495">got</a></span>&nbsp;<span class="op" id="6986590">!=</span>&nbsp;<span class="ident" id="6986593"><a href="/net/http/internal/chunked_test.go.html#6986421">i</a></span>&nbsp;<span class="op" id="6986595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986600"><a href="/net/http/internal/chunked_test.go.html#6986400">t</a></span><span class="op" id="6986601">.</span><span class="ident" id="6986602">Errorf</span><span class="op" id="6986608">(</span><span class="string" id="6986609">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6986637">,</span>&nbsp;<span class="ident" id="6986639"><a href="/net/http/internal/chunked_test.go.html#6986456">line</a></span><span class="op" id="6986643">,</span>&nbsp;<span class="ident" id="6986645"><a href="/net/http/internal/chunked_test.go.html#6986495">got</a></span><span class="op" id="6986648">,</span>&nbsp;<span class="ident" id="6986650"><a href="/net/http/internal/chunked_test.go.html#6986421">i</a></span><span class="op" id="6986651">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986661">_</span><span class="op" id="6986662">,</span>&nbsp;<span class="ident" id="6986664">err</span>&nbsp;<span class="op" id="6986668">:=</span>&nbsp;<span class="ident" id="6986671"><a href="/net/http/internal/chunked.go.html#4294893">parseHexUint</a></span><span class="op" id="6986683">(</span><span class="op" id="6986684">[</span><span class="op" id="6986685">]</span><span class="builtintype" id="6986686">byte</span><span class="op" id="6986690">(</span><span class="string" id="6986691">&#34;bogus&#34;</span><span class="op" id="6986698">)</span><span class="op" id="6986699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986702">if</span>&nbsp;<span class="ident" id="6986705"><a href="/net/http/internal/chunked_test.go.html#6986664">err</a></span>&nbsp;<span class="op" id="6986709">==</span>&nbsp;<span class="ident" id="6986712">nil</span>&nbsp;<span class="op" id="6986716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986720"><a href="/net/http/internal/chunked_test.go.html#6986400">t</a></span><span class="op" id="6986721">.</span><span class="ident" id="6986722">Error</span><span class="op" id="6986727">(</span><span class="string" id="6986728">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="6986759">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986762">}</span><br>
<span class="lineno"></span><span class="op" id="6986764">}</span>
</div>
</body>
</html>
