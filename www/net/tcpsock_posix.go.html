<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2692730">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2692786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2692840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2692891">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2692969">package</span>&nbsp;<span class="ident" id="2692977">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2692982">import</span>&nbsp;<span class="op" id="2692989">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2692992">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2692998">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2693004">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2693015">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2693022">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2693025">//&nbsp;BUG(rsc):&nbsp;On&nbsp;OpenBSD,&nbsp;listening&nbsp;on&nbsp;the&nbsp;&#34;tcp&#34;&nbsp;network&nbsp;does&nbsp;not&nbsp;listen&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2693101">//&nbsp;both&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections.&nbsp;This&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;IPv4&nbsp;traffic</span><br>
<span class="lineno"></span><span class="comment" id="2693178">//&nbsp;will&nbsp;not&nbsp;be&nbsp;routed&nbsp;to&nbsp;an&nbsp;IPv6&nbsp;socket&nbsp;-&nbsp;two&nbsp;separate&nbsp;sockets&nbsp;are&nbsp;required</span><br>
<span class="lineno"></span><span class="comment" id="2693254">//&nbsp;if&nbsp;both&nbsp;AFs&nbsp;are&nbsp;to&nbsp;be&nbsp;supported.&nbsp;See&nbsp;inet6(4)&nbsp;on&nbsp;OpenBSD&nbsp;for&nbsp;details.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2693328">func</span>&nbsp;<span class="ident" id="2693333">sockaddrToTCP</span><span class="op" id="2693346">(</span><span class="ident" id="2693347">sa</span>&nbsp;<span class="ident" id="2693350"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693357">.</span><span class="ident" id="2693358">Sockaddr</span><span class="op" id="2693366">)</span>&nbsp;<span class="ident" id="2693368"><a href="/net/net.go.html#2652238">Addr</a></span>&nbsp;<span class="op" id="2693373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693376">switch</span>&nbsp;<span class="ident" id="2693383">sa</span>&nbsp;<span class="op" id="2693386">:=</span>&nbsp;<span class="ident" id="2693389"><a href="/net/tcpsock_posix.go.html#2693347">sa</a></span><span class="op" id="2693391">.</span><span class="op" id="2693392">(</span><span class="keyword" id="2693393">type</span><span class="op" id="2693397">)</span>&nbsp;<span class="op" id="2693399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693402">case</span>&nbsp;<span class="op" id="2693407">*</span><span class="ident" id="2693408"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693415">.</span><span class="ident" id="2693416">SockaddrInet4</span><span class="op" id="2693429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693433">return</span>&nbsp;<span class="op" id="2693440">&amp;</span><span class="ident" id="2693441"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2693448">{</span><span class="ident" id="2693449">IP</span><span class="op" id="2693451">:</span>&nbsp;<span class="ident" id="2693453"><a href="/net/tcpsock_posix.go.html#2693383">sa</a></span><span class="op" id="2693455">.</span><span class="ident" id="2693456">Addr</span><span class="op" id="2693460">[</span><span class="num" id="2693461">0</span><span class="op" id="2693462">:</span><span class="op" id="2693463">]</span><span class="op" id="2693464">,</span>&nbsp;<span class="ident" id="2693466">Port</span><span class="op" id="2693470">:</span>&nbsp;<span class="ident" id="2693472"><a href="/net/tcpsock_posix.go.html#2693383">sa</a></span><span class="op" id="2693474">.</span><span class="ident" id="2693475">Port</span><span class="op" id="2693479">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693482">case</span>&nbsp;<span class="op" id="2693487">*</span><span class="ident" id="2693488"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693495">.</span><span class="ident" id="2693496">SockaddrInet6</span><span class="op" id="2693509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693513">return</span>&nbsp;<span class="op" id="2693520">&amp;</span><span class="ident" id="2693521"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2693528">{</span><span class="ident" id="2693529">IP</span><span class="op" id="2693531">:</span>&nbsp;<span class="ident" id="2693533"><a href="/net/tcpsock_posix.go.html#2693383">sa</a></span><span class="op" id="2693535">.</span><span class="ident" id="2693536">Addr</span><span class="op" id="2693540">[</span><span class="num" id="2693541">0</span><span class="op" id="2693542">:</span><span class="op" id="2693543">]</span><span class="op" id="2693544">,</span>&nbsp;<span class="ident" id="2693546">Port</span><span class="op" id="2693550">:</span>&nbsp;<span class="ident" id="2693552"><a href="/net/tcpsock_posix.go.html#2693383">sa</a></span><span class="op" id="2693554">.</span><span class="ident" id="2693555">Port</span><span class="op" id="2693559">,</span>&nbsp;<span class="ident" id="2693561">Zone</span><span class="op" id="2693565">:</span>&nbsp;<span class="ident" id="2693567"><a href="/net/ipsock.go.html#2635208">zoneToString</a></span><span class="op" id="2693579">(</span><span class="builtintype" id="2693580">int</span><span class="op" id="2693583">(</span><span class="ident" id="2693584"><a href="/net/tcpsock_posix.go.html#2693383">sa</a></span><span class="op" id="2693586">.</span><span class="ident" id="2693587">ZoneId</span><span class="op" id="2693593">)</span><span class="op" id="2693594">)</span><span class="op" id="2693595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2693598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693601">return</span>&nbsp;<span class="ident" id="2693608">nil</span><br>
<span class="lineno"></span><span class="op" id="2693612">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="2693615">func</span>&nbsp;<span class="op" id="2693620">(</span><span class="ident" id="2693621">a</span>&nbsp;<span class="op" id="2693623">*</span><span class="ident" id="2693624"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2693631">)</span>&nbsp;<span class="ident" id="2693633">family</span><span class="op" id="2693639">(</span><span class="op" id="2693640">)</span>&nbsp;<span class="builtintype" id="2693642">int</span>&nbsp;<span class="op" id="2693646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693649">if</span>&nbsp;<span class="ident" id="2693652"><a href="/net/tcpsock_posix.go.html#2693621">a</a></span>&nbsp;<span class="op" id="2693654">==</span>&nbsp;<span class="ident" id="2693657">nil</span>&nbsp;<span class="op" id="2693661">||</span>&nbsp;<span class="builtinfunc" id="2693664">len</span><span class="op" id="2693667">(</span><span class="ident" id="2693668"><a href="/net/tcpsock_posix.go.html#2693621">a</a></span><span class="op" id="2693669">.</span><span class="ident" id="2693670">IP</span><span class="op" id="2693672">)</span>&nbsp;<span class="op" id="2693674">&lt;=</span>&nbsp;<span class="ident" id="2693677"><a href="/net/ip.go.html#2603910">IPv4len</a></span>&nbsp;<span class="op" id="2693685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693689">return</span>&nbsp;<span class="ident" id="2693696"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693703">.</span><span class="ident" id="2693704">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2693713">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693716">if</span>&nbsp;<span class="ident" id="2693719"><a href="/net/tcpsock_posix.go.html#2693621">a</a></span><span class="op" id="2693720">.</span><span class="ident" id="2693721">IP</span><span class="op" id="2693723">.</span><span class="ident" id="2693724">To4</span><span class="op" id="2693727">(</span><span class="op" id="2693728">)</span>&nbsp;<span class="op" id="2693730">!=</span>&nbsp;<span class="ident" id="2693733">nil</span>&nbsp;<span class="op" id="2693737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693741">return</span>&nbsp;<span class="ident" id="2693748"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693755">.</span><span class="ident" id="2693756">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2693765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693768">return</span>&nbsp;<span class="ident" id="2693775"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693782">.</span><span class="ident" id="2693783">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="2693792">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2693795">func</span>&nbsp;<span class="op" id="2693800">(</span><span class="ident" id="2693801">a</span>&nbsp;<span class="op" id="2693803">*</span><span class="ident" id="2693804"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2693811">)</span>&nbsp;<span class="ident" id="2693813">isWildcard</span><span class="op" id="2693823">(</span><span class="op" id="2693824">)</span>&nbsp;<span class="builtintype" id="2693826">bool</span>&nbsp;<span class="op" id="2693831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693834">if</span>&nbsp;<span class="ident" id="2693837"><a href="/net/tcpsock_posix.go.html#2693801">a</a></span>&nbsp;<span class="op" id="2693839">==</span>&nbsp;<span class="ident" id="2693842">nil</span>&nbsp;<span class="op" id="2693846">||</span>&nbsp;<span class="ident" id="2693849"><a href="/net/tcpsock_posix.go.html#2693801">a</a></span><span class="op" id="2693850">.</span><span class="ident" id="2693851">IP</span>&nbsp;<span class="op" id="2693854">==</span>&nbsp;<span class="ident" id="2693857">nil</span>&nbsp;<span class="op" id="2693861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693865">return</span>&nbsp;<span class="ident" id="2693872">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2693878">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693881">return</span>&nbsp;<span class="ident" id="2693888"><a href="/net/tcpsock_posix.go.html#2693801">a</a></span><span class="op" id="2693889">.</span><span class="ident" id="2693890">IP</span><span class="op" id="2693892">.</span><span class="ident" id="2693893">IsUnspecified</span><span class="op" id="2693906">(</span><span class="op" id="2693907">)</span><br>
<span class="lineno"></span><span class="op" id="2693909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2693912">func</span>&nbsp;<span class="op" id="2693917">(</span><span class="ident" id="2693918">a</span>&nbsp;<span class="op" id="2693920">*</span><span class="ident" id="2693921"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2693928">)</span>&nbsp;<span class="ident" id="2693930">sockaddr</span><span class="op" id="2693938">(</span><span class="ident" id="2693939">family</span>&nbsp;<span class="builtintype" id="2693946">int</span><span class="op" id="2693949">)</span>&nbsp;<span class="op" id="2693951">(</span><span class="ident" id="2693952"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2693959">.</span><span class="ident" id="2693960">Sockaddr</span><span class="op" id="2693968">,</span>&nbsp;<span class="builtintype" id="2693970">error</span><span class="op" id="2693975">)</span>&nbsp;<span class="op" id="2693977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693980">if</span>&nbsp;<span class="ident" id="2693983"><a href="/net/tcpsock_posix.go.html#2693918">a</a></span>&nbsp;<span class="op" id="2693985">==</span>&nbsp;<span class="ident" id="2693988">nil</span>&nbsp;<span class="op" id="2693992">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2693996">return</span>&nbsp;<span class="ident" id="2694003">nil</span><span class="op" id="2694006">,</span>&nbsp;<span class="ident" id="2694008">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2694013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694016">return</span>&nbsp;<span class="ident" id="2694023"><a href="/net/ipsock_posix.go.html#2640171">ipToSockaddr</a></span><span class="op" id="2694035">(</span><span class="ident" id="2694036"><a href="/net/tcpsock_posix.go.html#2693939">family</a></span><span class="op" id="2694042">,</span>&nbsp;<span class="ident" id="2694044"><a href="/net/tcpsock_posix.go.html#2693918">a</a></span><span class="op" id="2694045">.</span><span class="ident" id="2694046">IP</span><span class="op" id="2694048">,</span>&nbsp;<span class="ident" id="2694050"><a href="/net/tcpsock_posix.go.html#2693918">a</a></span><span class="op" id="2694051">.</span><span class="ident" id="2694052">Port</span><span class="op" id="2694056">,</span>&nbsp;<span class="ident" id="2694058"><a href="/net/tcpsock_posix.go.html#2693918">a</a></span><span class="op" id="2694059">.</span><span class="ident" id="2694060">Zone</span><span class="op" id="2694064">)</span><br>
<span class="lineno"></span><span class="op" id="2694066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2694069">//&nbsp;TCPConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;TCP&nbsp;network</span><br>
<span class="lineno"></span><span class="comment" id="2694139">//&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="2694155">type</span>&nbsp;<span class="ident" id="2694160">TCPConn</span>&nbsp;<span class="keyword" id="2694168">struct</span>&nbsp;<span class="op" id="2694175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2694178"><a href="/net/net.go.html#2654243">conn</a></span><br>
<span class="lineno"></span><span class="op" id="2694183">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="2694186">func</span>&nbsp;<span class="ident" id="2694191">newTCPConn</span><span class="op" id="2694201">(</span><span class="ident" id="2694202">fd</span>&nbsp;<span class="op" id="2694205">*</span><span class="ident" id="2694206"><a href="/net/fd_unix.go.html#2575420">netFD</a></span><span class="op" id="2694211">)</span>&nbsp;<span class="op" id="2694213">*</span><span class="ident" id="2694214"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span>&nbsp;<span class="op" id="2694222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2694225">c</span>&nbsp;<span class="op" id="2694227">:=</span>&nbsp;<span class="op" id="2694230">&amp;</span><span class="ident" id="2694231"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2694238">{</span><span class="ident" id="2694239"><a href="/net/net.go.html#2654243">conn</a></span><span class="op" id="2694243">{</span><span class="ident" id="2694244"><a href="/net/tcpsock_posix.go.html#2694202">fd</a></span><span class="op" id="2694246">}</span><span class="op" id="2694247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2694250"><a href="/net/tcpsock_posix.go.html#2694225">c</a></span><span class="op" id="2694251">.</span><span class="ident" id="2694252">SetNoDelay</span><span class="op" id="2694262">(</span><span class="ident" id="2694263">true</span><span class="op" id="2694267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694270">return</span>&nbsp;<span class="ident" id="2694277"><a href="/net/tcpsock_posix.go.html#2694225">c</a></span><br>
<span class="lineno">65</span><span class="op" id="2694279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2694282">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;io.ReaderFrom&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2694340">func</span>&nbsp;<span class="op" id="2694345">(</span><span class="ident" id="2694346">c</span>&nbsp;<span class="op" id="2694348">*</span><span class="ident" id="2694349"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2694356">)</span>&nbsp;<span class="ident" id="2694358">ReadFrom</span><span class="op" id="2694366">(</span><span class="ident" id="2694367">r</span>&nbsp;<span class="ident" id="2694369"><a href="/net/tcpsock_posix.go.html#2692992">io</a></span><span class="op" id="2694371">.</span><span class="ident" id="2694372">Reader</span><span class="op" id="2694378">)</span>&nbsp;<span class="op" id="2694380">(</span><span class="ident" id="2694381">int64</span><span class="op" id="2694386">,</span>&nbsp;<span class="builtintype" id="2694388">error</span><span class="op" id="2694393">)</span>&nbsp;<span class="op" id="2694395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694398">if</span>&nbsp;<span class="ident" id="2694401">n</span><span class="op" id="2694402">,</span>&nbsp;<span class="ident" id="2694404">err</span><span class="op" id="2694407">,</span>&nbsp;<span class="ident" id="2694409">handled</span>&nbsp;<span class="op" id="2694417">:=</span>&nbsp;<span class="ident" id="2694420"><a href="/net/sendfile_linux.go.html#2671583">sendFile</a></span><span class="op" id="2694428">(</span><span class="ident" id="2694429"><a href="/net/tcpsock_posix.go.html#2694346">c</a></span><span class="op" id="2694430">.</span><span class="ident" id="2694431">fd</span><span class="op" id="2694433">,</span>&nbsp;<span class="ident" id="2694435"><a href="/net/tcpsock_posix.go.html#2694367">r</a></span><span class="op" id="2694436">)</span><span class="op" id="2694437">;</span>&nbsp;<span class="ident" id="2694439"><a href="/net/tcpsock_posix.go.html#2694409">handled</a></span>&nbsp;<span class="op" id="2694447">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694451">return</span>&nbsp;<span class="ident" id="2694458"><a href="/net/tcpsock_posix.go.html#2694401">n</a></span><span class="op" id="2694459">,</span>&nbsp;<span class="ident" id="2694461"><a href="/net/tcpsock_posix.go.html#2694404">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2694466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694469">return</span>&nbsp;<span class="ident" id="2694476"><a href="/net/net.go.html#2661940">genericReadFrom</a></span><span class="op" id="2694491">(</span><span class="ident" id="2694492"><a href="/net/tcpsock_posix.go.html#2694346">c</a></span><span class="op" id="2694493">,</span>&nbsp;<span class="ident" id="2694495"><a href="/net/tcpsock_posix.go.html#2694367">r</a></span><span class="op" id="2694496">)</span><br>
<span class="lineno"></span><span class="op" id="2694498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="2694501">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="2694565">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="2694604">func</span>&nbsp;<span class="op" id="2694609">(</span><span class="ident" id="2694610">c</span>&nbsp;<span class="op" id="2694612">*</span><span class="ident" id="2694613"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2694620">)</span>&nbsp;<span class="ident" id="2694622">CloseRead</span><span class="op" id="2694631">(</span><span class="op" id="2694632">)</span>&nbsp;<span class="builtintype" id="2694634">error</span>&nbsp;<span class="op" id="2694640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694643">if</span>&nbsp;<span class="op" id="2694646">!</span><span class="ident" id="2694647"><a href="/net/tcpsock_posix.go.html#2694610">c</a></span><span class="op" id="2694648">.</span><span class="ident" id="2694649">ok</span><span class="op" id="2694651">(</span><span class="op" id="2694652">)</span>&nbsp;<span class="op" id="2694654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694658">return</span>&nbsp;<span class="ident" id="2694665"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2694672">.</span><span class="ident" id="2694673">EINVAL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2694681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694684">return</span>&nbsp;<span class="ident" id="2694691"><a href="/net/tcpsock_posix.go.html#2694610">c</a></span><span class="op" id="2694692">.</span><span class="ident" id="2694693">fd</span><span class="op" id="2694695">.</span><span class="ident" id="2694696">closeRead</span><span class="op" id="2694705">(</span><span class="op" id="2694706">)</span><br>
<span class="lineno"></span><span class="op" id="2694708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2694711">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno">85</span><span class="comment" id="2694776">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="2694815">func</span>&nbsp;<span class="op" id="2694820">(</span><span class="ident" id="2694821">c</span>&nbsp;<span class="op" id="2694823">*</span><span class="ident" id="2694824"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2694831">)</span>&nbsp;<span class="ident" id="2694833">CloseWrite</span><span class="op" id="2694843">(</span><span class="op" id="2694844">)</span>&nbsp;<span class="builtintype" id="2694846">error</span>&nbsp;<span class="op" id="2694852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694855">if</span>&nbsp;<span class="op" id="2694858">!</span><span class="ident" id="2694859"><a href="/net/tcpsock_posix.go.html#2694821">c</a></span><span class="op" id="2694860">.</span><span class="ident" id="2694861">ok</span><span class="op" id="2694863">(</span><span class="op" id="2694864">)</span>&nbsp;<span class="op" id="2694866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694870">return</span>&nbsp;<span class="ident" id="2694877"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2694884">.</span><span class="ident" id="2694885">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2694893">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2694896">return</span>&nbsp;<span class="ident" id="2694903"><a href="/net/tcpsock_posix.go.html#2694821">c</a></span><span class="op" id="2694904">.</span><span class="ident" id="2694905">fd</span><span class="op" id="2694907">.</span><span class="ident" id="2694908">closeWrite</span><span class="op" id="2694918">(</span><span class="op" id="2694919">)</span><br>
<span class="lineno"></span><span class="op" id="2694921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2694924">//&nbsp;SetLinger&nbsp;sets&nbsp;the&nbsp;behavior&nbsp;of&nbsp;Close&nbsp;on&nbsp;a&nbsp;connection&nbsp;which&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="2694992">//&nbsp;has&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;sent&nbsp;or&nbsp;to&nbsp;be&nbsp;acknowledged.</span><br>
<span class="lineno">95</span><span class="comment" id="2695046">//</span><br>
<span class="lineno"></span><span class="comment" id="2695049">//&nbsp;If&nbsp;sec&nbsp;&lt;&nbsp;0&nbsp;(the&nbsp;default),&nbsp;the&nbsp;operating&nbsp;system&nbsp;finishes&nbsp;sending&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2695120">//&nbsp;data&nbsp;in&nbsp;the&nbsp;background.</span><br>
<span class="lineno"></span><span class="comment" id="2695147">//</span><br>
<span class="lineno"></span><span class="comment" id="2695150">//&nbsp;If&nbsp;sec&nbsp;==&nbsp;0,&nbsp;the&nbsp;operating&nbsp;system&nbsp;discards&nbsp;any&nbsp;unsent&nbsp;or</span><br>
<span class="lineno">100</span><span class="comment" id="2695210">//&nbsp;unacknowledged&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="2695234">//</span><br>
<span class="lineno"></span><span class="comment" id="2695237">//&nbsp;If&nbsp;sec&nbsp;&gt;&nbsp;0,&nbsp;the&nbsp;data&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;background&nbsp;as&nbsp;with&nbsp;sec&nbsp;&lt;&nbsp;0.&nbsp;On</span><br>
<span class="lineno"></span><span class="comment" id="2695307">//&nbsp;some&nbsp;operating&nbsp;systems&nbsp;after&nbsp;sec&nbsp;seconds&nbsp;have&nbsp;elapsed&nbsp;any&nbsp;remaining</span><br>
<span class="lineno"></span><span class="comment" id="2695378">//&nbsp;unsent&nbsp;data&nbsp;may&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">105</span><span class="keyword" id="2695411">func</span>&nbsp;<span class="op" id="2695416">(</span><span class="ident" id="2695417">c</span>&nbsp;<span class="op" id="2695419">*</span><span class="ident" id="2695420"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2695427">)</span>&nbsp;<span class="ident" id="2695429">SetLinger</span><span class="op" id="2695438">(</span><span class="ident" id="2695439">sec</span>&nbsp;<span class="builtintype" id="2695443">int</span><span class="op" id="2695446">)</span>&nbsp;<span class="builtintype" id="2695448">error</span>&nbsp;<span class="op" id="2695454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695457">if</span>&nbsp;<span class="op" id="2695460">!</span><span class="ident" id="2695461"><a href="/net/tcpsock_posix.go.html#2695417">c</a></span><span class="op" id="2695462">.</span><span class="ident" id="2695463">ok</span><span class="op" id="2695465">(</span><span class="op" id="2695466">)</span>&nbsp;<span class="op" id="2695468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695472">return</span>&nbsp;<span class="ident" id="2695479"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2695486">.</span><span class="ident" id="2695487">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2695495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695498">return</span>&nbsp;<span class="ident" id="2695505"><a href="/net/sockopt_posix.go.html#2688465">setLinger</a></span><span class="op" id="2695514">(</span><span class="ident" id="2695515"><a href="/net/tcpsock_posix.go.html#2695417">c</a></span><span class="op" id="2695516">.</span><span class="ident" id="2695517">fd</span><span class="op" id="2695519">,</span>&nbsp;<span class="ident" id="2695521"><a href="/net/tcpsock_posix.go.html#2695439">sec</a></span><span class="op" id="2695524">)</span><br>
<span class="lineno">110</span><span class="op" id="2695526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2695529">//&nbsp;SetKeepAlive&nbsp;sets&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;send</span><br>
<span class="lineno"></span><span class="comment" id="2695591">//&nbsp;keepalive&nbsp;messages&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="2695632">func</span>&nbsp;<span class="op" id="2695637">(</span><span class="ident" id="2695638">c</span>&nbsp;<span class="op" id="2695640">*</span><span class="ident" id="2695641"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2695648">)</span>&nbsp;<span class="ident" id="2695650">SetKeepAlive</span><span class="op" id="2695662">(</span><span class="ident" id="2695663">keepalive</span>&nbsp;<span class="builtintype" id="2695673">bool</span><span class="op" id="2695677">)</span>&nbsp;<span class="builtintype" id="2695679">error</span>&nbsp;<span class="op" id="2695685">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695688">if</span>&nbsp;<span class="op" id="2695691">!</span><span class="ident" id="2695692"><a href="/net/tcpsock_posix.go.html#2695638">c</a></span><span class="op" id="2695693">.</span><span class="ident" id="2695694">ok</span><span class="op" id="2695696">(</span><span class="op" id="2695697">)</span>&nbsp;<span class="op" id="2695699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695703">return</span>&nbsp;<span class="ident" id="2695710"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2695717">.</span><span class="ident" id="2695718">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2695726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695729">return</span>&nbsp;<span class="ident" id="2695736"><a href="/net/sockopt_posix.go.html#2688201">setKeepAlive</a></span><span class="op" id="2695748">(</span><span class="ident" id="2695749"><a href="/net/tcpsock_posix.go.html#2695638">c</a></span><span class="op" id="2695750">.</span><span class="ident" id="2695751">fd</span><span class="op" id="2695753">,</span>&nbsp;<span class="ident" id="2695755"><a href="/net/tcpsock_posix.go.html#2695663">keepalive</a></span><span class="op" id="2695764">)</span><br>
<span class="lineno"></span><span class="op" id="2695766">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="2695769">//&nbsp;SetKeepAlivePeriod&nbsp;sets&nbsp;period&nbsp;between&nbsp;keep&nbsp;alives.</span><br>
<span class="lineno"></span><span class="keyword" id="2695824">func</span>&nbsp;<span class="op" id="2695829">(</span><span class="ident" id="2695830">c</span>&nbsp;<span class="op" id="2695832">*</span><span class="ident" id="2695833"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2695840">)</span>&nbsp;<span class="ident" id="2695842">SetKeepAlivePeriod</span><span class="op" id="2695860">(</span><span class="ident" id="2695861">d</span>&nbsp;<span class="ident" id="2695863"><a href="/net/tcpsock_posix.go.html#2693015">time</a></span><span class="op" id="2695867">.</span><span class="ident" id="2695868">Duration</span><span class="op" id="2695876">)</span>&nbsp;<span class="builtintype" id="2695878">error</span>&nbsp;<span class="op" id="2695884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695887">if</span>&nbsp;<span class="op" id="2695890">!</span><span class="ident" id="2695891"><a href="/net/tcpsock_posix.go.html#2695830">c</a></span><span class="op" id="2695892">.</span><span class="ident" id="2695893">ok</span><span class="op" id="2695895">(</span><span class="op" id="2695896">)</span>&nbsp;<span class="op" id="2695898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695902">return</span>&nbsp;<span class="ident" id="2695909"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2695916">.</span><span class="ident" id="2695917">EINVAL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2695925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2695928">return</span>&nbsp;<span class="ident" id="2695935"><a href="/net/tcpsockopt_unix.go.html#2703130">setKeepAlivePeriod</a></span><span class="op" id="2695953">(</span><span class="ident" id="2695954"><a href="/net/tcpsock_posix.go.html#2695830">c</a></span><span class="op" id="2695955">.</span><span class="ident" id="2695956">fd</span><span class="op" id="2695958">,</span>&nbsp;<span class="ident" id="2695960"><a href="/net/tcpsock_posix.go.html#2695861">d</a></span><span class="op" id="2695961">)</span><br>
<span class="lineno"></span><span class="op" id="2695963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2695966">//&nbsp;SetNoDelay&nbsp;controls&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;delay</span><br>
<span class="lineno">130</span><span class="comment" id="2696031">//&nbsp;packet&nbsp;transmission&nbsp;in&nbsp;hopes&nbsp;of&nbsp;sending&nbsp;fewer&nbsp;packets&nbsp;(Nagle&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2696097">//&nbsp;algorithm).&nbsp;&nbsp;The&nbsp;default&nbsp;is&nbsp;true&nbsp;(no&nbsp;delay),&nbsp;meaning&nbsp;that&nbsp;data&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2696166">//&nbsp;sent&nbsp;as&nbsp;soon&nbsp;as&nbsp;possible&nbsp;after&nbsp;a&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="2696209">func</span>&nbsp;<span class="op" id="2696214">(</span><span class="ident" id="2696215">c</span>&nbsp;<span class="op" id="2696217">*</span><span class="ident" id="2696218"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2696225">)</span>&nbsp;<span class="ident" id="2696227">SetNoDelay</span><span class="op" id="2696237">(</span><span class="ident" id="2696238">noDelay</span>&nbsp;<span class="builtintype" id="2696246">bool</span><span class="op" id="2696250">)</span>&nbsp;<span class="builtintype" id="2696252">error</span>&nbsp;<span class="op" id="2696258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696261">if</span>&nbsp;<span class="op" id="2696264">!</span><span class="ident" id="2696265"><a href="/net/tcpsock_posix.go.html#2696215">c</a></span><span class="op" id="2696266">.</span><span class="ident" id="2696267">ok</span><span class="op" id="2696269">(</span><span class="op" id="2696270">)</span>&nbsp;<span class="op" id="2696272">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696276">return</span>&nbsp;<span class="ident" id="2696283"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2696290">.</span><span class="ident" id="2696291">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2696299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696302">return</span>&nbsp;<span class="ident" id="2696309"><a href="/net/tcpsockopt_posix.go.html#2702621">setNoDelay</a></span><span class="op" id="2696319">(</span><span class="ident" id="2696320"><a href="/net/tcpsock_posix.go.html#2696215">c</a></span><span class="op" id="2696321">.</span><span class="ident" id="2696322">fd</span><span class="op" id="2696324">,</span>&nbsp;<span class="ident" id="2696326"><a href="/net/tcpsock_posix.go.html#2696238">noDelay</a></span><span class="op" id="2696333">)</span><br>
<span class="lineno"></span><span class="op" id="2696335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="2696338">//&nbsp;DialTCP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="2696406">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2696477">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="2696526">func</span>&nbsp;<span class="ident" id="2696531">DialTCP</span><span class="op" id="2696538">(</span><span class="ident" id="2696539">net</span>&nbsp;<span class="builtintype" id="2696543">string</span><span class="op" id="2696549">,</span>&nbsp;<span class="ident" id="2696551">laddr</span><span class="op" id="2696556">,</span>&nbsp;<span class="ident" id="2696558">raddr</span>&nbsp;<span class="op" id="2696564">*</span><span class="ident" id="2696565"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2696572">)</span>&nbsp;<span class="op" id="2696574">(</span><span class="op" id="2696575">*</span><span class="ident" id="2696576"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2696583">,</span>&nbsp;<span class="builtintype" id="2696585">error</span><span class="op" id="2696590">)</span>&nbsp;<span class="op" id="2696592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696595">switch</span>&nbsp;<span class="ident" id="2696602"><a href="/net/tcpsock_posix.go.html#2696539">net</a></span>&nbsp;<span class="op" id="2696606">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696609">case</span>&nbsp;<span class="string" id="2696614">&#34;tcp&#34;</span><span class="op" id="2696619">,</span>&nbsp;<span class="string" id="2696621">&#34;tcp4&#34;</span><span class="op" id="2696627">,</span>&nbsp;<span class="string" id="2696629">&#34;tcp6&#34;</span><span class="op" id="2696635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696638">default</span><span class="op" id="2696645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696649">return</span>&nbsp;<span class="ident" id="2696656">nil</span><span class="op" id="2696659">,</span>&nbsp;<span class="op" id="2696661">&amp;</span><span class="ident" id="2696662"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2696669">{</span><span class="ident" id="2696670">Op</span><span class="op" id="2696672">:</span>&nbsp;<span class="string" id="2696674">&#34;dial&#34;</span><span class="op" id="2696680">,</span>&nbsp;<span class="ident" id="2696682">Net</span><span class="op" id="2696685">:</span>&nbsp;<span class="ident" id="2696687"><a href="/net/tcpsock_posix.go.html#2696539">net</a></span><span class="op" id="2696690">,</span>&nbsp;<span class="ident" id="2696692">Addr</span><span class="op" id="2696696">:</span>&nbsp;<span class="ident" id="2696698"><a href="/net/tcpsock_posix.go.html#2696558">raddr</a></span><span class="op" id="2696703">,</span>&nbsp;<span class="ident" id="2696705">Err</span><span class="op" id="2696708">:</span>&nbsp;<span class="ident" id="2696710"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="2696729">(</span><span class="ident" id="2696730"><a href="/net/tcpsock_posix.go.html#2696539">net</a></span><span class="op" id="2696733">)</span><span class="op" id="2696734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2696737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696740">if</span>&nbsp;<span class="ident" id="2696743"><a href="/net/tcpsock_posix.go.html#2696558">raddr</a></span>&nbsp;<span class="op" id="2696749">==</span>&nbsp;<span class="ident" id="2696752">nil</span>&nbsp;<span class="op" id="2696756">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696760">return</span>&nbsp;<span class="ident" id="2696767">nil</span><span class="op" id="2696770">,</span>&nbsp;<span class="op" id="2696772">&amp;</span><span class="ident" id="2696773"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2696780">{</span><span class="ident" id="2696781">Op</span><span class="op" id="2696783">:</span>&nbsp;<span class="string" id="2696785">&#34;dial&#34;</span><span class="op" id="2696791">,</span>&nbsp;<span class="ident" id="2696793">Net</span><span class="op" id="2696796">:</span>&nbsp;<span class="ident" id="2696798"><a href="/net/tcpsock_posix.go.html#2696539">net</a></span><span class="op" id="2696801">,</span>&nbsp;<span class="ident" id="2696803">Addr</span><span class="op" id="2696807">:</span>&nbsp;<span class="ident" id="2696809">nil</span><span class="op" id="2696812">,</span>&nbsp;<span class="ident" id="2696814">Err</span><span class="op" id="2696817">:</span>&nbsp;<span class="ident" id="2696819"><a href="/net/net.go.html#2659161">errMissingAddress</a></span><span class="op" id="2696836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2696839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2696842">return</span>&nbsp;<span class="ident" id="2696849"><a href="/net/tcpsock_posix.go.html#2696896">dialTCP</a></span><span class="op" id="2696856">(</span><span class="ident" id="2696857"><a href="/net/tcpsock_posix.go.html#2696539">net</a></span><span class="op" id="2696860">,</span>&nbsp;<span class="ident" id="2696862"><a href="/net/tcpsock_posix.go.html#2696551">laddr</a></span><span class="op" id="2696867">,</span>&nbsp;<span class="ident" id="2696869"><a href="/net/tcpsock_posix.go.html#2696558">raddr</a></span><span class="op" id="2696874">,</span>&nbsp;<span class="ident" id="2696876"><a href="/net/net.go.html#2660335">noDeadline</a></span><span class="op" id="2696886">)</span><br>
<span class="lineno"></span><span class="op" id="2696888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="2696891">func</span>&nbsp;<span class="ident" id="2696896">dialTCP</span><span class="op" id="2696903">(</span><span class="ident" id="2696904">net</span>&nbsp;<span class="builtintype" id="2696908">string</span><span class="op" id="2696914">,</span>&nbsp;<span class="ident" id="2696916">laddr</span><span class="op" id="2696921">,</span>&nbsp;<span class="ident" id="2696923">raddr</span>&nbsp;<span class="op" id="2696929">*</span><span class="ident" id="2696930"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2696937">,</span>&nbsp;<span class="ident" id="2696939">deadline</span>&nbsp;<span class="ident" id="2696948"><a href="/net/tcpsock_posix.go.html#2693015">time</a></span><span class="op" id="2696952">.</span><span class="ident" id="2696953">Time</span><span class="op" id="2696957">)</span>&nbsp;<span class="op" id="2696959">(</span><span class="op" id="2696960">*</span><span class="ident" id="2696961"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2696968">,</span>&nbsp;<span class="builtintype" id="2696970">error</span><span class="op" id="2696975">)</span>&nbsp;<span class="op" id="2696977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2696980">fd</span><span class="op" id="2696982">,</span>&nbsp;<span class="ident" id="2696984">err</span>&nbsp;<span class="op" id="2696988">:=</span>&nbsp;<span class="ident" id="2696991"><a href="/net/ipsock_posix.go.html#2639894">internetSocket</a></span><span class="op" id="2697005">(</span><span class="ident" id="2697006"><a href="/net/tcpsock_posix.go.html#2696904">net</a></span><span class="op" id="2697009">,</span>&nbsp;<span class="ident" id="2697011"><a href="/net/tcpsock_posix.go.html#2696916">laddr</a></span><span class="op" id="2697016">,</span>&nbsp;<span class="ident" id="2697018"><a href="/net/tcpsock_posix.go.html#2696923">raddr</a></span><span class="op" id="2697023">,</span>&nbsp;<span class="ident" id="2697025"><a href="/net/tcpsock_posix.go.html#2696939">deadline</a></span><span class="op" id="2697033">,</span>&nbsp;<span class="ident" id="2697035"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2697042">.</span><span class="ident" id="2697043">SOCK_STREAM</span><span class="op" id="2697054">,</span>&nbsp;<span class="num" id="2697056">0</span><span class="op" id="2697057">,</span>&nbsp;<span class="string" id="2697059">&#34;dial&#34;</span><span class="op" id="2697065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697069">//&nbsp;TCP&nbsp;has&nbsp;a&nbsp;rarely&nbsp;used&nbsp;mechanism&nbsp;called&nbsp;a&nbsp;&#39;simultaneous&nbsp;connection&#39;&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697143">//&nbsp;which&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr1,&nbsp;addr2)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine&nbsp;at&nbsp;addr1&nbsp;can</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697211">//&nbsp;connect&nbsp;to&nbsp;a&nbsp;simultaneous&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr2,&nbsp;addr1)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697286">//&nbsp;at&nbsp;addr2,&nbsp;without&nbsp;either&nbsp;machine&nbsp;executing&nbsp;Listen.&nbsp;&nbsp;If&nbsp;laddr&nbsp;==&nbsp;nil,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697359">//&nbsp;it&nbsp;means&nbsp;we&nbsp;want&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate&nbsp;originating&nbsp;local</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697432">//&nbsp;address.&nbsp;&nbsp;Some&nbsp;Linux&nbsp;kernels&nbsp;cycle&nbsp;blindly&nbsp;through&nbsp;a&nbsp;fixed&nbsp;range&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697504">//&nbsp;local&nbsp;ports,&nbsp;regardless&nbsp;of&nbsp;destination&nbsp;port.&nbsp;&nbsp;If&nbsp;a&nbsp;kernel&nbsp;happens&nbsp;to</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697577">//&nbsp;pick&nbsp;local&nbsp;port&nbsp;50001&nbsp;as&nbsp;the&nbsp;source&nbsp;for&nbsp;a&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;&#34;,&nbsp;&#34;localhost:50001&#34;),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697659">//&nbsp;then&nbsp;the&nbsp;Dial&nbsp;will&nbsp;succeed,&nbsp;having&nbsp;simultaneously&nbsp;connected&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697734">//&nbsp;This&nbsp;can&nbsp;only&nbsp;happen&nbsp;when&nbsp;we&nbsp;are&nbsp;letting&nbsp;the&nbsp;kernel&nbsp;pick&nbsp;a&nbsp;port&nbsp;(laddr&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697817">//&nbsp;and&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;listener&nbsp;for&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697880">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;argue&nbsp;this&nbsp;is&nbsp;anything&nbsp;other&nbsp;than&nbsp;a&nbsp;kernel&nbsp;bug.&nbsp;&nbsp;If&nbsp;we</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2697952">//&nbsp;see&nbsp;this&nbsp;happen,&nbsp;rather&nbsp;than&nbsp;expose&nbsp;the&nbsp;buggy&nbsp;effect&nbsp;to&nbsp;users,&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698022">//&nbsp;close&nbsp;the&nbsp;fd&nbsp;and&nbsp;try&nbsp;again.&nbsp;&nbsp;If&nbsp;it&nbsp;happens&nbsp;twice&nbsp;more,&nbsp;we&nbsp;relent&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698095">//&nbsp;use&nbsp;the&nbsp;result.&nbsp;&nbsp;See&nbsp;also:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698126">//&nbsp;&nbsp;&nbsp;&nbsphttp://golang.org/issue/2690</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698159">//&nbsp;&nbsp;&nbsp;&nbsphttp://stackoverflow.com/questions/4949858/</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698207">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698211">//&nbsp;The&nbsp;opposite&nbsp;can&nbsp;also&nbsp;happen:&nbsp;if&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698289">//&nbsp;originating&nbsp;local&nbsp;address,&nbsp;sometimes&nbsp;it&nbsp;picks&nbsp;one&nbsp;that&nbsp;is&nbsp;already&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698367">//&nbsp;So&nbsp;if&nbsp;the&nbsp;error&nbsp;is&nbsp;EADDRNOTAVAIL,&nbsp;we&nbsp;have&nbsp;to&nbsp;try&nbsp;again&nbsp;too,&nbsp;just&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698440">//&nbsp;a&nbsp;different&nbsp;reason.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698464">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698468">//&nbsp;The&nbsp;kernel&nbsp;socket&nbsp;code&nbsp;is&nbsp;no&nbsp;doubt&nbsp;enjoying&nbsp;watching&nbsp;us&nbsp;squirm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2698536">for</span>&nbsp;<span class="ident" id="2698540">i</span>&nbsp;<span class="op" id="2698542">:=</span>&nbsp;<span class="num" id="2698545">0</span><span class="op" id="2698546">;</span>&nbsp;<span class="ident" id="2698548"><a href="/net/tcpsock_posix.go.html#2698540">i</a></span>&nbsp;<span class="op" id="2698550">&lt;</span>&nbsp;<span class="num" id="2698552">2</span>&nbsp;<span class="op" id="2698554">&amp;&amp;</span>&nbsp;<span class="op" id="2698557">(</span><span class="ident" id="2698558"><a href="/net/tcpsock_posix.go.html#2696916">laddr</a></span>&nbsp;<span class="op" id="2698564">==</span>&nbsp;<span class="ident" id="2698567">nil</span>&nbsp;<span class="op" id="2698571">||</span>&nbsp;<span class="ident" id="2698574"><a href="/net/tcpsock_posix.go.html#2696916">laddr</a></span><span class="op" id="2698579">.</span><span class="ident" id="2698580">Port</span>&nbsp;<span class="op" id="2698585">==</span>&nbsp;<span class="num" id="2698588">0</span><span class="op" id="2698589">)</span>&nbsp;<span class="op" id="2698591">&amp;&amp;</span>&nbsp;<span class="op" id="2698594">(</span><span class="ident" id="2698595"><a href="/net/tcpsock_posix.go.html#2698902">selfConnect</a></span><span class="op" id="2698606">(</span><span class="ident" id="2698607"><a href="/net/tcpsock_posix.go.html#2696980">fd</a></span><span class="op" id="2698609">,</span>&nbsp;<span class="ident" id="2698611"><a href="/net/tcpsock_posix.go.html#2696984">err</a></span><span class="op" id="2698614">)</span>&nbsp;<span class="op" id="2698616">||</span>&nbsp;<span class="ident" id="2698619"><a href="/net/tcpsock_posix.go.html#2699724">spuriousENOTAVAIL</a></span><span class="op" id="2698636">(</span><span class="ident" id="2698637"><a href="/net/tcpsock_posix.go.html#2696984">err</a></span><span class="op" id="2698640">)</span><span class="op" id="2698641">)</span><span class="op" id="2698642">;</span>&nbsp;<span class="ident" id="2698644"><a href="/net/tcpsock_posix.go.html#2698540">i</a></span><span class="op" id="2698645">++</span>&nbsp;<span class="op" id="2698648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2698652">if</span>&nbsp;<span class="ident" id="2698655"><a href="/net/tcpsock_posix.go.html#2696984">err</a></span>&nbsp;<span class="op" id="2698659">==</span>&nbsp;<span class="ident" id="2698662">nil</span>&nbsp;<span class="op" id="2698666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2698671"><a href="/net/tcpsock_posix.go.html#2696980">fd</a></span><span class="op" id="2698673">.</span><span class="ident" id="2698674">Close</span><span class="op" id="2698679">(</span><span class="op" id="2698680">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2698684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2698688"><a href="/net/tcpsock_posix.go.html#2696980">fd</a></span><span class="op" id="2698690">,</span>&nbsp;<span class="ident" id="2698692"><a href="/net/tcpsock_posix.go.html#2696984">err</a></span>&nbsp;<span class="op" id="2698696">=</span>&nbsp;<span class="ident" id="2698698"><a href="/net/ipsock_posix.go.html#2639894">internetSocket</a></span><span class="op" id="2698712">(</span><span class="ident" id="2698713"><a href="/net/tcpsock_posix.go.html#2696904">net</a></span><span class="op" id="2698716">,</span>&nbsp;<span class="ident" id="2698718"><a href="/net/tcpsock_posix.go.html#2696916">laddr</a></span><span class="op" id="2698723">,</span>&nbsp;<span class="ident" id="2698725"><a href="/net/tcpsock_posix.go.html#2696923">raddr</a></span><span class="op" id="2698730">,</span>&nbsp;<span class="ident" id="2698732"><a href="/net/tcpsock_posix.go.html#2696939">deadline</a></span><span class="op" id="2698740">,</span>&nbsp;<span class="ident" id="2698742"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2698749">.</span><span class="ident" id="2698750">SOCK_STREAM</span><span class="op" id="2698761">,</span>&nbsp;<span class="num" id="2698763">0</span><span class="op" id="2698764">,</span>&nbsp;<span class="string" id="2698766">&#34;dial&#34;</span><span class="op" id="2698772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2698775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2698779">if</span>&nbsp;<span class="ident" id="2698782"><a href="/net/tcpsock_posix.go.html#2696984">err</a></span>&nbsp;<span class="op" id="2698786">!=</span>&nbsp;<span class="ident" id="2698789">nil</span>&nbsp;<span class="op" id="2698793">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2698797">return</span>&nbsp;<span class="ident" id="2698804">nil</span><span class="op" id="2698807">,</span>&nbsp;<span class="op" id="2698809">&amp;</span><span class="ident" id="2698810"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2698817">{</span><span class="ident" id="2698818">Op</span><span class="op" id="2698820">:</span>&nbsp;<span class="string" id="2698822">&#34;dial&#34;</span><span class="op" id="2698828">,</span>&nbsp;<span class="ident" id="2698830">Net</span><span class="op" id="2698833">:</span>&nbsp;<span class="ident" id="2698835"><a href="/net/tcpsock_posix.go.html#2696904">net</a></span><span class="op" id="2698838">,</span>&nbsp;<span class="ident" id="2698840">Addr</span><span class="op" id="2698844">:</span>&nbsp;<span class="ident" id="2698846"><a href="/net/tcpsock_posix.go.html#2696923">raddr</a></span><span class="op" id="2698851">,</span>&nbsp;<span class="ident" id="2698853">Err</span><span class="op" id="2698856">:</span>&nbsp;<span class="ident" id="2698858"><a href="/net/tcpsock_posix.go.html#2696984">err</a></span><span class="op" id="2698861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2698864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2698867">return</span>&nbsp;<span class="ident" id="2698874"><a href="/net/tcpsock_posix.go.html#2694191">newTCPConn</a></span><span class="op" id="2698884">(</span><span class="ident" id="2698885"><a href="/net/tcpsock_posix.go.html#2696980">fd</a></span><span class="op" id="2698887">)</span><span class="op" id="2698888">,</span>&nbsp;<span class="ident" id="2698890">nil</span><br>
<span class="lineno"></span><span class="op" id="2698894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="2698897">func</span>&nbsp;<span class="ident" id="2698902">selfConnect</span><span class="op" id="2698913">(</span><span class="ident" id="2698914">fd</span>&nbsp;<span class="op" id="2698917">*</span><span class="ident" id="2698918"><a href="/net/fd_unix.go.html#2575420">netFD</a></span><span class="op" id="2698923">,</span>&nbsp;<span class="ident" id="2698925">err</span>&nbsp;<span class="builtintype" id="2698929">error</span><span class="op" id="2698934">)</span>&nbsp;<span class="builtintype" id="2698936">bool</span>&nbsp;<span class="op" id="2698941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2698944">//&nbsp;If&nbsp;the&nbsp;connect&nbsp;failed,&nbsp;we&nbsp;clearly&nbsp;didn&#39;t&nbsp;connect&nbsp;to&nbsp;ourselves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2699011">if</span>&nbsp;<span class="ident" id="2699014"><a href="/net/tcpsock_posix.go.html#2698925">err</a></span>&nbsp;<span class="op" id="2699018">!=</span>&nbsp;<span class="ident" id="2699021">nil</span>&nbsp;<span class="op" id="2699025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2699029">return</span>&nbsp;<span class="ident" id="2699036">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2699043">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699047">//&nbsp;The&nbsp;socket&nbsp;constructor&nbsp;can&nbsp;return&nbsp;an&nbsp;fd&nbsp;with&nbsp;raddr&nbsp;nil&nbsp;under&nbsp;certain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699120">//&nbsp;unknown&nbsp;conditions.&nbsp;The&nbsp;errors&nbsp;in&nbsp;the&nbsp;calls&nbsp;there&nbsp;to&nbsp;Getpeername</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699189">//&nbsp;are&nbsp;discarded,&nbsp;but&nbsp;we&nbsp;can&#39;t&nbsp;catch&nbsp;the&nbsp;problem&nbsp;there&nbsp;because&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699259">//&nbsp;calls&nbsp;are&nbsp;sometimes&nbsp;legally&nbsp;erroneous&nbsp;with&nbsp;a&nbsp;&#34;socket&nbsp;not&nbsp;connected&#34;.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699332">//&nbsp;Since&nbsp;this&nbsp;code&nbsp;(selfConnect)&nbsp;is&nbsp;already&nbsp;trying&nbsp;to&nbsp;work&nbsp;around</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699399">//&nbsp;a&nbsp;problem,&nbsp;we&nbsp;make&nbsp;sure&nbsp;if&nbsp;this&nbsp;happens&nbsp;we&nbsp;recognize&nbsp;trouble&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699468">//&nbsp;ask&nbsp;the&nbsp;DialTCP&nbsp;routine&nbsp;to&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2699510">//&nbsp;TODO:&nbsp;try&nbsp;to&nbsp;understand&nbsp;what&#39;s&nbsp;really&nbsp;going&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2699562">if</span>&nbsp;<span class="ident" id="2699565"><a href="/net/tcpsock_posix.go.html#2698914">fd</a></span><span class="op" id="2699567">.</span><span class="ident" id="2699568">laddr</span>&nbsp;<span class="op" id="2699574">==</span>&nbsp;<span class="ident" id="2699577">nil</span>&nbsp;<span class="op" id="2699581">||</span>&nbsp;<span class="ident" id="2699584"><a href="/net/tcpsock_posix.go.html#2698914">fd</a></span><span class="op" id="2699586">.</span><span class="ident" id="2699587">raddr</span>&nbsp;<span class="op" id="2699593">==</span>&nbsp;<span class="ident" id="2699596">nil</span>&nbsp;<span class="op" id="2699600">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2699604">return</span>&nbsp;<span class="ident" id="2699611">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2699617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2699620">l</span>&nbsp;<span class="op" id="2699622">:=</span>&nbsp;<span class="ident" id="2699625"><a href="/net/tcpsock_posix.go.html#2698914">fd</a></span><span class="op" id="2699627">.</span><span class="ident" id="2699628">laddr</span><span class="op" id="2699633">.</span><span class="op" id="2699634">(</span><span class="op" id="2699635">*</span><span class="ident" id="2699636"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2699643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2699646">r</span>&nbsp;<span class="op" id="2699648">:=</span>&nbsp;<span class="ident" id="2699651"><a href="/net/tcpsock_posix.go.html#2698914">fd</a></span><span class="op" id="2699653">.</span><span class="ident" id="2699654">raddr</span><span class="op" id="2699659">.</span><span class="op" id="2699660">(</span><span class="op" id="2699661">*</span><span class="ident" id="2699662"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2699669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2699672">return</span>&nbsp;<span class="ident" id="2699679"><a href="/net/tcpsock_posix.go.html#2699620">l</a></span><span class="op" id="2699680">.</span><span class="ident" id="2699681">Port</span>&nbsp;<span class="op" id="2699686">==</span>&nbsp;<span class="ident" id="2699689"><a href="/net/tcpsock_posix.go.html#2699646">r</a></span><span class="op" id="2699690">.</span><span class="ident" id="2699691">Port</span>&nbsp;<span class="op" id="2699696">&amp;&amp;</span>&nbsp;<span class="ident" id="2699699"><a href="/net/tcpsock_posix.go.html#2699620">l</a></span><span class="op" id="2699700">.</span><span class="ident" id="2699701">IP</span><span class="op" id="2699703">.</span><span class="ident" id="2699704">Equal</span><span class="op" id="2699709">(</span><span class="ident" id="2699710"><a href="/net/tcpsock_posix.go.html#2699646">r</a></span><span class="op" id="2699711">.</span><span class="ident" id="2699712">IP</span><span class="op" id="2699714">)</span><br>
<span class="lineno">215</span><span class="op" id="2699716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2699719">func</span>&nbsp;<span class="ident" id="2699724">spuriousENOTAVAIL</span><span class="op" id="2699741">(</span><span class="ident" id="2699742">err</span>&nbsp;<span class="builtintype" id="2699746">error</span><span class="op" id="2699751">)</span>&nbsp;<span class="builtintype" id="2699753">bool</span>&nbsp;<span class="op" id="2699758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2699761">e</span><span class="op" id="2699762">,</span>&nbsp;<span class="ident" id="2699764">ok</span>&nbsp;<span class="op" id="2699767">:=</span>&nbsp;<span class="ident" id="2699770"><a href="/net/tcpsock_posix.go.html#2699742">err</a></span><span class="op" id="2699773">.</span><span class="op" id="2699774">(</span><span class="op" id="2699775">*</span><span class="ident" id="2699776"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2699783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2699786">return</span>&nbsp;<span class="ident" id="2699793"><a href="/net/tcpsock_posix.go.html#2699764">ok</a></span>&nbsp;<span class="op" id="2699796">&amp;&amp;</span>&nbsp;<span class="ident" id="2699799"><a href="/net/tcpsock_posix.go.html#2699761">e</a></span><span class="op" id="2699800">.</span><span class="ident" id="2699801">Err</span>&nbsp;<span class="op" id="2699805">==</span>&nbsp;<span class="ident" id="2699808"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2699815">.</span><span class="ident" id="2699816">EADDRNOTAVAIL</span><br>
<span class="lineno">220</span><span class="op" id="2699830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2699833">//&nbsp;TCPListener&nbsp;is&nbsp;a&nbsp;TCP&nbsp;network&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="2699901">//&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;TCP.</span><br>
<span class="lineno"></span><span class="keyword" id="2699960">type</span>&nbsp;<span class="ident" id="2699965">TCPListener</span>&nbsp;<span class="keyword" id="2699977">struct</span>&nbsp;<span class="op" id="2699984">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2699987">fd</span>&nbsp;<span class="op" id="2699990">*</span><span class="ident" id="2699991"><a href="/net/fd_unix.go.html#2575420">netFD</a></span><br>
<span class="lineno"></span><span class="op" id="2699997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2700000">//&nbsp;AcceptTCP&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="2700064">//&nbsp;connection.</span><br>
<span class="lineno">230</span><span class="keyword" id="2700079">func</span>&nbsp;<span class="op" id="2700084">(</span><span class="ident" id="2700085">l</span>&nbsp;<span class="op" id="2700087">*</span><span class="ident" id="2700088"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2700099">)</span>&nbsp;<span class="ident" id="2700101">AcceptTCP</span><span class="op" id="2700110">(</span><span class="op" id="2700111">)</span>&nbsp;<span class="op" id="2700113">(</span><span class="op" id="2700114">*</span><span class="ident" id="2700115"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2700122">,</span>&nbsp;<span class="builtintype" id="2700124">error</span><span class="op" id="2700129">)</span>&nbsp;<span class="op" id="2700131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700134">if</span>&nbsp;<span class="ident" id="2700137"><a href="/net/tcpsock_posix.go.html#2700085">l</a></span>&nbsp;<span class="op" id="2700139">==</span>&nbsp;<span class="ident" id="2700142">nil</span>&nbsp;<span class="op" id="2700146">||</span>&nbsp;<span class="ident" id="2700149"><a href="/net/tcpsock_posix.go.html#2700085">l</a></span><span class="op" id="2700150">.</span><span class="ident" id="2700151">fd</span>&nbsp;<span class="op" id="2700154">==</span>&nbsp;<span class="ident" id="2700157">nil</span>&nbsp;<span class="op" id="2700161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700165">return</span>&nbsp;<span class="ident" id="2700172">nil</span><span class="op" id="2700175">,</span>&nbsp;<span class="ident" id="2700177"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2700184">.</span><span class="ident" id="2700185">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2700193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2700196">fd</span><span class="op" id="2700198">,</span>&nbsp;<span class="ident" id="2700200">err</span>&nbsp;<span class="op" id="2700204">:=</span>&nbsp;<span class="ident" id="2700207"><a href="/net/tcpsock_posix.go.html#2700085">l</a></span><span class="op" id="2700208">.</span><span class="ident" id="2700209">fd</span><span class="op" id="2700211">.</span><span class="ident" id="2700212">accept</span><span class="op" id="2700218">(</span><span class="op" id="2700219">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700222">if</span>&nbsp;<span class="ident" id="2700225"><a href="/net/tcpsock_posix.go.html#2700200">err</a></span>&nbsp;<span class="op" id="2700229">!=</span>&nbsp;<span class="ident" id="2700232">nil</span>&nbsp;<span class="op" id="2700236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700240">return</span>&nbsp;<span class="ident" id="2700247">nil</span><span class="op" id="2700250">,</span>&nbsp;<span class="ident" id="2700252"><a href="/net/tcpsock_posix.go.html#2700200">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2700257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700260">return</span>&nbsp;<span class="ident" id="2700267"><a href="/net/tcpsock_posix.go.html#2694191">newTCPConn</a></span><span class="op" id="2700277">(</span><span class="ident" id="2700278"><a href="/net/tcpsock_posix.go.html#2700196">fd</a></span><span class="op" id="2700280">)</span><span class="op" id="2700281">,</span>&nbsp;<span class="ident" id="2700283">nil</span><br>
<span class="lineno"></span><span class="op" id="2700287">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2700290">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2700359">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="2700414">func</span>&nbsp;<span class="op" id="2700419">(</span><span class="ident" id="2700420">l</span>&nbsp;<span class="op" id="2700422">*</span><span class="ident" id="2700423"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2700434">)</span>&nbsp;<span class="ident" id="2700436">Accept</span><span class="op" id="2700442">(</span><span class="op" id="2700443">)</span>&nbsp;<span class="op" id="2700445">(</span><span class="ident" id="2700446"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2700450">,</span>&nbsp;<span class="builtintype" id="2700452">error</span><span class="op" id="2700457">)</span>&nbsp;<span class="op" id="2700459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2700462">c</span><span class="op" id="2700463">,</span>&nbsp;<span class="ident" id="2700465">err</span>&nbsp;<span class="op" id="2700469">:=</span>&nbsp;<span class="ident" id="2700472"><a href="/net/tcpsock_posix.go.html#2700420">l</a></span><span class="op" id="2700473">.</span><span class="ident" id="2700474">AcceptTCP</span><span class="op" id="2700483">(</span><span class="op" id="2700484">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700487">if</span>&nbsp;<span class="ident" id="2700490"><a href="/net/tcpsock_posix.go.html#2700465">err</a></span>&nbsp;<span class="op" id="2700494">!=</span>&nbsp;<span class="ident" id="2700497">nil</span>&nbsp;<span class="op" id="2700501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700505">return</span>&nbsp;<span class="ident" id="2700512">nil</span><span class="op" id="2700515">,</span>&nbsp;<span class="ident" id="2700517"><a href="/net/tcpsock_posix.go.html#2700465">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2700522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700525">return</span>&nbsp;<span class="ident" id="2700532"><a href="/net/tcpsock_posix.go.html#2700462">c</a></span><span class="op" id="2700533">,</span>&nbsp;<span class="ident" id="2700535">nil</span><br>
<span class="lineno"></span><span class="op" id="2700539">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="2700542">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="2700587">//&nbsp;Already&nbsp;Accepted&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="2700635">func</span>&nbsp;<span class="op" id="2700640">(</span><span class="ident" id="2700641">l</span>&nbsp;<span class="op" id="2700643">*</span><span class="ident" id="2700644"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2700655">)</span>&nbsp;<span class="ident" id="2700657">Close</span><span class="op" id="2700662">(</span><span class="op" id="2700663">)</span>&nbsp;<span class="builtintype" id="2700665">error</span>&nbsp;<span class="op" id="2700671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700674">if</span>&nbsp;<span class="ident" id="2700677"><a href="/net/tcpsock_posix.go.html#2700641">l</a></span>&nbsp;<span class="op" id="2700679">==</span>&nbsp;<span class="ident" id="2700682">nil</span>&nbsp;<span class="op" id="2700686">||</span>&nbsp;<span class="ident" id="2700689"><a href="/net/tcpsock_posix.go.html#2700641">l</a></span><span class="op" id="2700690">.</span><span class="ident" id="2700691">fd</span>&nbsp;<span class="op" id="2700694">==</span>&nbsp;<span class="ident" id="2700697">nil</span>&nbsp;<span class="op" id="2700701">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700705">return</span>&nbsp;<span class="ident" id="2700712"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2700719">.</span><span class="ident" id="2700720">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2700728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2700731">return</span>&nbsp;<span class="ident" id="2700738"><a href="/net/tcpsock_posix.go.html#2700641">l</a></span><span class="op" id="2700739">.</span><span class="ident" id="2700740">fd</span><span class="op" id="2700742">.</span><span class="ident" id="2700743">Close</span><span class="op" id="2700748">(</span><span class="op" id="2700749">)</span><br>
<span class="lineno"></span><span class="op" id="2700751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="2700754">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address,&nbsp;a&nbsp;*TCPAddr.</span><br>
<span class="lineno"></span><span class="keyword" id="2700814">func</span>&nbsp;<span class="op" id="2700819">(</span><span class="ident" id="2700820">l</span>&nbsp;<span class="op" id="2700822">*</span><span class="ident" id="2700823"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2700834">)</span>&nbsp;<span class="ident" id="2700836">Addr</span><span class="op" id="2700840">(</span><span class="op" id="2700841">)</span>&nbsp;<span class="ident" id="2700843"><a href="/net/net.go.html#2652238">Addr</a></span>&nbsp;<span class="op" id="2700848">{</span>&nbsp;<span class="keyword" id="2700850">return</span>&nbsp;<span class="ident" id="2700857"><a href="/net/tcpsock_posix.go.html#2700820">l</a></span><span class="op" id="2700858">.</span><span class="ident" id="2700859">fd</span><span class="op" id="2700861">.</span><span class="ident" id="2700862">laddr</span>&nbsp;<span class="op" id="2700868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2700871">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="2700934">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno">265</span><span class="keyword" id="2700978">func</span>&nbsp;<span class="op" id="2700983">(</span><span class="ident" id="2700984">l</span>&nbsp;<span class="op" id="2700986">*</span><span class="ident" id="2700987"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2700998">)</span>&nbsp;<span class="ident" id="2701000">SetDeadline</span><span class="op" id="2701011">(</span><span class="ident" id="2701012">t</span>&nbsp;<span class="ident" id="2701014"><a href="/net/tcpsock_posix.go.html#2693015">time</a></span><span class="op" id="2701018">.</span><span class="ident" id="2701019">Time</span><span class="op" id="2701023">)</span>&nbsp;<span class="builtintype" id="2701025">error</span>&nbsp;<span class="op" id="2701031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701034">if</span>&nbsp;<span class="ident" id="2701037"><a href="/net/tcpsock_posix.go.html#2700984">l</a></span>&nbsp;<span class="op" id="2701039">==</span>&nbsp;<span class="ident" id="2701042">nil</span>&nbsp;<span class="op" id="2701046">||</span>&nbsp;<span class="ident" id="2701049"><a href="/net/tcpsock_posix.go.html#2700984">l</a></span><span class="op" id="2701050">.</span><span class="ident" id="2701051">fd</span>&nbsp;<span class="op" id="2701054">==</span>&nbsp;<span class="ident" id="2701057">nil</span>&nbsp;<span class="op" id="2701061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701065">return</span>&nbsp;<span class="ident" id="2701072"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2701079">.</span><span class="ident" id="2701080">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2701088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701091">return</span>&nbsp;<span class="ident" id="2701098"><a href="/net/tcpsock_posix.go.html#2700984">l</a></span><span class="op" id="2701099">.</span><span class="ident" id="2701100">fd</span><span class="op" id="2701102">.</span><span class="ident" id="2701103">setDeadline</span><span class="op" id="2701114">(</span><span class="ident" id="2701115"><a href="/net/tcpsock_posix.go.html#2701012">t</a></span><span class="op" id="2701116">)</span><br>
<span class="lineno">270</span><span class="op" id="2701118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2701121">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="2701187">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="2701257">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">275</span><span class="comment" id="2701322">//</span><br>
<span class="lineno"></span><span class="comment" id="2701325">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2701389">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="2701455">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="2701519">func</span>&nbsp;<span class="op" id="2701524">(</span><span class="ident" id="2701525">l</span>&nbsp;<span class="op" id="2701527">*</span><span class="ident" id="2701528"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2701539">)</span>&nbsp;<span class="ident" id="2701541">File</span><span class="op" id="2701545">(</span><span class="op" id="2701546">)</span>&nbsp;<span class="op" id="2701548">(</span><span class="ident" id="2701549">f</span>&nbsp;<span class="op" id="2701551">*</span><span class="ident" id="2701552"><a href="/net/tcpsock_posix.go.html#2692998">os</a></span><span class="op" id="2701554">.</span><span class="ident" id="2701555">File</span><span class="op" id="2701559">,</span>&nbsp;<span class="ident" id="2701561">err</span>&nbsp;<span class="builtintype" id="2701565">error</span><span class="op" id="2701570">)</span>&nbsp;<span class="op" id="2701572">{</span>&nbsp;<span class="keyword" id="2701574">return</span>&nbsp;<span class="ident" id="2701581"><a href="/net/tcpsock_posix.go.html#2701525">l</a></span><span class="op" id="2701582">.</span><span class="ident" id="2701583">fd</span><span class="op" id="2701585">.</span><span class="ident" id="2701586">dup</span><span class="op" id="2701589">(</span><span class="op" id="2701590">)</span>&nbsp;<span class="op" id="2701592">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="2701595">//&nbsp;ListenTCP&nbsp;announces&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="2701661">//&nbsp;listener.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2701729">//&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenTCP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.&nbsp;&nbsp;The&nbsp;caller&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="2701800">//&nbsp;use&nbsp;the&nbsp;Addr&nbsp;method&nbsp;of&nbsp;TCPListener&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;chosen&nbsp;address.</span><br>
<span class="lineno">285</span><span class="keyword" id="2701870">func</span>&nbsp;<span class="ident" id="2701875">ListenTCP</span><span class="op" id="2701884">(</span><span class="ident" id="2701885">net</span>&nbsp;<span class="builtintype" id="2701889">string</span><span class="op" id="2701895">,</span>&nbsp;<span class="ident" id="2701897">laddr</span>&nbsp;<span class="op" id="2701903">*</span><span class="ident" id="2701904"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2701911">)</span>&nbsp;<span class="op" id="2701913">(</span><span class="op" id="2701914">*</span><span class="ident" id="2701915"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2701926">,</span>&nbsp;<span class="builtintype" id="2701928">error</span><span class="op" id="2701933">)</span>&nbsp;<span class="op" id="2701935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701938">switch</span>&nbsp;<span class="ident" id="2701945"><a href="/net/tcpsock_posix.go.html#2701885">net</a></span>&nbsp;<span class="op" id="2701949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701952">case</span>&nbsp;<span class="string" id="2701957">&#34;tcp&#34;</span><span class="op" id="2701962">,</span>&nbsp;<span class="string" id="2701964">&#34;tcp4&#34;</span><span class="op" id="2701970">,</span>&nbsp;<span class="string" id="2701972">&#34;tcp6&#34;</span><span class="op" id="2701978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701981">default</span><span class="op" id="2701988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2701992">return</span>&nbsp;<span class="ident" id="2701999">nil</span><span class="op" id="2702002">,</span>&nbsp;<span class="op" id="2702004">&amp;</span><span class="ident" id="2702005"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2702012">{</span><span class="ident" id="2702013">Op</span><span class="op" id="2702015">:</span>&nbsp;<span class="string" id="2702017">&#34;listen&#34;</span><span class="op" id="2702025">,</span>&nbsp;<span class="ident" id="2702027">Net</span><span class="op" id="2702030">:</span>&nbsp;<span class="ident" id="2702032"><a href="/net/tcpsock_posix.go.html#2701885">net</a></span><span class="op" id="2702035">,</span>&nbsp;<span class="ident" id="2702037">Addr</span><span class="op" id="2702041">:</span>&nbsp;<span class="ident" id="2702043"><a href="/net/tcpsock_posix.go.html#2701897">laddr</a></span><span class="op" id="2702048">,</span>&nbsp;<span class="ident" id="2702050">Err</span><span class="op" id="2702053">:</span>&nbsp;<span class="ident" id="2702055"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="2702074">(</span><span class="ident" id="2702075"><a href="/net/tcpsock_posix.go.html#2701885">net</a></span><span class="op" id="2702078">)</span><span class="op" id="2702079">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2702082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2702085">if</span>&nbsp;<span class="ident" id="2702088"><a href="/net/tcpsock_posix.go.html#2701897">laddr</a></span>&nbsp;<span class="op" id="2702094">==</span>&nbsp;<span class="ident" id="2702097">nil</span>&nbsp;<span class="op" id="2702101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2702105"><a href="/net/tcpsock_posix.go.html#2701897">laddr</a></span>&nbsp;<span class="op" id="2702111">=</span>&nbsp;<span class="op" id="2702113">&amp;</span><span class="ident" id="2702114"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2702121">{</span><span class="op" id="2702122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2702125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2702128">fd</span><span class="op" id="2702130">,</span>&nbsp;<span class="ident" id="2702132">err</span>&nbsp;<span class="op" id="2702136">:=</span>&nbsp;<span class="ident" id="2702139"><a href="/net/ipsock_posix.go.html#2639894">internetSocket</a></span><span class="op" id="2702153">(</span><span class="ident" id="2702154"><a href="/net/tcpsock_posix.go.html#2701885">net</a></span><span class="op" id="2702157">,</span>&nbsp;<span class="ident" id="2702159"><a href="/net/tcpsock_posix.go.html#2701897">laddr</a></span><span class="op" id="2702164">,</span>&nbsp;<span class="ident" id="2702166">nil</span><span class="op" id="2702169">,</span>&nbsp;<span class="ident" id="2702171"><a href="/net/net.go.html#2660335">noDeadline</a></span><span class="op" id="2702181">,</span>&nbsp;<span class="ident" id="2702183"><a href="/net/tcpsock_posix.go.html#2693004">syscall</a></span><span class="op" id="2702190">.</span><span class="ident" id="2702191">SOCK_STREAM</span><span class="op" id="2702202">,</span>&nbsp;<span class="num" id="2702204">0</span><span class="op" id="2702205">,</span>&nbsp;<span class="string" id="2702207">&#34;listen&#34;</span><span class="op" id="2702215">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2702218">if</span>&nbsp;<span class="ident" id="2702221"><a href="/net/tcpsock_posix.go.html#2702132">err</a></span>&nbsp;<span class="op" id="2702225">!=</span>&nbsp;<span class="ident" id="2702228">nil</span>&nbsp;<span class="op" id="2702232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2702236">return</span>&nbsp;<span class="ident" id="2702243">nil</span><span class="op" id="2702246">,</span>&nbsp;<span class="op" id="2702248">&amp;</span><span class="ident" id="2702249"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2702256">{</span><span class="ident" id="2702257">Op</span><span class="op" id="2702259">:</span>&nbsp;<span class="string" id="2702261">&#34;listen&#34;</span><span class="op" id="2702269">,</span>&nbsp;<span class="ident" id="2702271">Net</span><span class="op" id="2702274">:</span>&nbsp;<span class="ident" id="2702276"><a href="/net/tcpsock_posix.go.html#2701885">net</a></span><span class="op" id="2702279">,</span>&nbsp;<span class="ident" id="2702281">Addr</span><span class="op" id="2702285">:</span>&nbsp;<span class="ident" id="2702287"><a href="/net/tcpsock_posix.go.html#2701897">laddr</a></span><span class="op" id="2702292">,</span>&nbsp;<span class="ident" id="2702294">Err</span><span class="op" id="2702297">:</span>&nbsp;<span class="ident" id="2702299"><a href="/net/tcpsock_posix.go.html#2702132">err</a></span><span class="op" id="2702302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2702305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2702308">return</span>&nbsp;<span class="op" id="2702315">&amp;</span><span class="ident" id="2702316"><a href="/net/tcpsock_posix.go.html#2699965">TCPListener</a></span><span class="op" id="2702327">{</span><span class="ident" id="2702328"><a href="/net/tcpsock_posix.go.html#2702128">fd</a></span><span class="op" id="2702330">}</span><span class="op" id="2702331">,</span>&nbsp;<span class="ident" id="2702333">nil</span><br>
<span class="lineno"></span><span class="op" id="2702337">}</span>
</div>
</body>
</html>
