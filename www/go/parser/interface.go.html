<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6031580">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6031635">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6031689">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6031740">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6031814">package</span>&nbsp;<span class="ident" id="6031822">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6031830">import</span>&nbsp;<span class="op" id="6031837">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031840">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031849">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031859">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031869">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031881">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031887">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031900">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031906">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6031923">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6031933">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6031936">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="6032003">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="6032071">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="6032128">//</span><br>
<span class="lineno">25</span><span class="keyword" id="6032131">func</span>&nbsp;<span class="ident" id="6032136">readSource</span><span class="op" id="6032146">(</span><span class="ident" id="6032147">filename</span>&nbsp;<span class="builtintype" id="6032156">string</span><span class="op" id="6032162">,</span>&nbsp;<span class="ident" id="6032164">src</span>&nbsp;<span class="keyword" id="6032168">interface</span><span class="op" id="6032177">{</span><span class="op" id="6032178">}</span><span class="op" id="6032179">)</span>&nbsp;<span class="op" id="6032181">(</span><span class="op" id="6032182">[</span><span class="op" id="6032183">]</span><span class="builtintype" id="6032184">byte</span><span class="op" id="6032188">,</span>&nbsp;<span class="builtintype" id="6032190">error</span><span class="op" id="6032195">)</span>&nbsp;<span class="op" id="6032197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032200">if</span>&nbsp;<span class="ident" id="6032203"><a href="/go/parser/interface.go.html#6032164">src</a></span>&nbsp;<span class="op" id="6032207">!=</span>&nbsp;<span class="ident" id="6032210">nil</span>&nbsp;<span class="op" id="6032214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032218">switch</span>&nbsp;<span class="ident" id="6032225">s</span>&nbsp;<span class="op" id="6032227">:=</span>&nbsp;<span class="ident" id="6032230"><a href="/go/parser/interface.go.html#6032164">src</a></span><span class="op" id="6032233">.</span><span class="op" id="6032234">(</span><span class="keyword" id="6032235">type</span><span class="op" id="6032239">)</span>&nbsp;<span class="op" id="6032241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032245">case</span>&nbsp;<span class="builtintype" id="6032250">string</span><span class="op" id="6032256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032261">return</span>&nbsp;<span class="op" id="6032268">[</span><span class="op" id="6032269">]</span><span class="builtintype" id="6032270">byte</span><span class="op" id="6032274">(</span><span class="ident" id="6032275"><a href="/go/parser/interface.go.html#6032225">s</a></span><span class="op" id="6032276">)</span><span class="op" id="6032277">,</span>&nbsp;<span class="ident" id="6032279">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032285">case</span>&nbsp;<span class="op" id="6032290">[</span><span class="op" id="6032291">]</span><span class="builtintype" id="6032292">byte</span><span class="op" id="6032296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032301">return</span>&nbsp;<span class="ident" id="6032308"><a href="/go/parser/interface.go.html#6032225">s</a></span><span class="op" id="6032309">,</span>&nbsp;<span class="ident" id="6032311">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032317">case</span>&nbsp;<span class="op" id="6032322">*</span><span class="ident" id="6032323"><a href="/go/parser/interface.go.html#6031840">bytes</a></span><span class="op" id="6032328">.</span><span class="ident" id="6032329">Buffer</span><span class="op" id="6032335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032340">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032404">if</span>&nbsp;<span class="ident" id="6032407"><a href="/go/parser/interface.go.html#6032225">s</a></span>&nbsp;<span class="op" id="6032409">!=</span>&nbsp;<span class="ident" id="6032412">nil</span>&nbsp;<span class="op" id="6032416">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032422">return</span>&nbsp;<span class="ident" id="6032429"><a href="/go/parser/interface.go.html#6032225">s</a></span><span class="op" id="6032430">.</span><span class="ident" id="6032431">Bytes</span><span class="op" id="6032436">(</span><span class="op" id="6032437">)</span><span class="op" id="6032438">,</span>&nbsp;<span class="ident" id="6032440">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032451">case</span>&nbsp;<span class="ident" id="6032456"><a href="/go/parser/interface.go.html#6031881">io</a></span><span class="op" id="6032458">.</span><span class="ident" id="6032459">Reader</span><span class="op" id="6032465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032470">var</span>&nbsp;<span class="ident" id="6032474">buf</span>&nbsp;<span class="ident" id="6032478"><a href="/go/parser/interface.go.html#6031840">bytes</a></span><span class="op" id="6032483">.</span><span class="ident" id="6032484">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032494">if</span>&nbsp;<span class="ident" id="6032497">_</span><span class="op" id="6032498">,</span>&nbsp;<span class="ident" id="6032500">err</span>&nbsp;<span class="op" id="6032504">:=</span>&nbsp;<span class="ident" id="6032507"><a href="/go/parser/interface.go.html#6031881">io</a></span><span class="op" id="6032509">.</span><span class="ident" id="6032510">Copy</span><span class="op" id="6032514">(</span><span class="op" id="6032515">&amp;</span><span class="ident" id="6032516"><a href="/go/parser/interface.go.html#6032474">buf</a></span><span class="op" id="6032519">,</span>&nbsp;<span class="ident" id="6032521"><a href="/go/parser/interface.go.html#6032225">s</a></span><span class="op" id="6032522">)</span><span class="op" id="6032523">;</span>&nbsp;<span class="ident" id="6032525"><a href="/go/parser/interface.go.html#6032500">err</a></span>&nbsp;<span class="op" id="6032529">!=</span>&nbsp;<span class="ident" id="6032532">nil</span>&nbsp;<span class="op" id="6032536">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032542">return</span>&nbsp;<span class="ident" id="6032549">nil</span><span class="op" id="6032552">,</span>&nbsp;<span class="ident" id="6032554"><a href="/go/parser/interface.go.html#6032500">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032566">return</span>&nbsp;<span class="ident" id="6032573"><a href="/go/parser/interface.go.html#6032474">buf</a></span><span class="op" id="6032576">.</span><span class="ident" id="6032577">Bytes</span><span class="op" id="6032582">(</span><span class="op" id="6032583">)</span><span class="op" id="6032584">,</span>&nbsp;<span class="ident" id="6032586">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032596">return</span>&nbsp;<span class="ident" id="6032603">nil</span><span class="op" id="6032606">,</span>&nbsp;<span class="ident" id="6032608"><a href="/go/parser/interface.go.html#6031849">errors</a></span><span class="op" id="6032614">.</span><span class="ident" id="6032615">New</span><span class="op" id="6032618">(</span><span class="string" id="6032619">&#34;invalid&nbsp;source&#34;</span><span class="op" id="6032635">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032641">return</span>&nbsp;<span class="ident" id="6032648"><a href="/go/parser/interface.go.html#6031887">ioutil</a></span><span class="op" id="6032654">.</span><span class="ident" id="6032655">ReadFile</span><span class="op" id="6032663">(</span><span class="ident" id="6032664"><a href="/go/parser/interface.go.html#6032147">filename</a></span><span class="op" id="6032672">)</span><br>
<span class="lineno"></span><span class="op" id="6032674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6032677">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="6032719">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="6032787">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="6032812">//</span><br>
<span class="lineno"></span><span class="keyword" id="6032815">type</span>&nbsp;<span class="ident" id="6032820">Mode</span>&nbsp;<span class="builtintype" id="6032825">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6032831">const</span>&nbsp;<span class="op" id="6032837">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032840">PackageClauseOnly</span>&nbsp;<span class="ident" id="6032858"><a href="/go/parser/interface.go.html#6032820">Mode</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032875">=</span>&nbsp;<span class="num" id="6032877">1</span>&nbsp;<span class="op" id="6032879">&lt;&lt;</span>&nbsp;<span class="ident" id="6032882">iota</span>&nbsp;<span class="comment" id="6032887">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032925">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032972">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033015">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033062">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033101">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033148">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033188">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033235">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033265">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033312">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033362">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033380">=</span>&nbsp;<span class="ident" id="6033382"><a href="/go/parser/interface.go.html#6033265">SpuriousErrors</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033409">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="6033473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6033476">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="6033551">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="6033623">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6033685">//</span><br>
<span class="lineno"></span><span class="comment" id="6033688">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="6033763">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="6033838">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="6033901">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="6033968">//</span><br>
<span class="lineno"></span><span class="comment" id="6033971">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="6034045">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6034119">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="6034137">//</span><br>
<span class="lineno"></span><span class="comment" id="6034140">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6034213">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="6034282">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="6034353">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="6034426">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6034500">//</span><br>
<span class="lineno"></span><span class="keyword" id="6034503">func</span>&nbsp;<span class="ident" id="6034508">ParseFile</span><span class="op" id="6034517">(</span><span class="ident" id="6034518">fset</span>&nbsp;<span class="op" id="6034523">*</span><span class="ident" id="6034524"><a href="/go/parser/interface.go.html#6031869">token</a></span><span class="op" id="6034529">.</span><span class="ident" id="6034530">FileSet</span><span class="op" id="6034537">,</span>&nbsp;<span class="ident" id="6034539">filename</span>&nbsp;<span class="builtintype" id="6034548">string</span><span class="op" id="6034554">,</span>&nbsp;<span class="ident" id="6034556">src</span>&nbsp;<span class="keyword" id="6034560">interface</span><span class="op" id="6034569">{</span><span class="op" id="6034570">}</span><span class="op" id="6034571">,</span>&nbsp;<span class="ident" id="6034573">mode</span>&nbsp;<span class="ident" id="6034578"><a href="/go/parser/interface.go.html#6032820">Mode</a></span><span class="op" id="6034582">)</span>&nbsp;<span class="op" id="6034584">(</span><span class="ident" id="6034585">f</span>&nbsp;<span class="op" id="6034587">*</span><span class="ident" id="6034588"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6034591">.</span><span class="ident" id="6034592">File</span><span class="op" id="6034596">,</span>&nbsp;<span class="ident" id="6034598">err</span>&nbsp;<span class="builtintype" id="6034602">error</span><span class="op" id="6034607">)</span>&nbsp;<span class="op" id="6034609">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034612">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034627">text</span><span class="op" id="6034631">,</span>&nbsp;<span class="ident" id="6034633"><a href="/go/parser/interface.go.html#6034598">err</a></span>&nbsp;<span class="op" id="6034637">:=</span>&nbsp;<span class="ident" id="6034640"><a href="/go/parser/interface.go.html#6032136">readSource</a></span><span class="op" id="6034650">(</span><span class="ident" id="6034651"><a href="/go/parser/interface.go.html#6034539">filename</a></span><span class="op" id="6034659">,</span>&nbsp;<span class="ident" id="6034661"><a href="/go/parser/interface.go.html#6034556">src</a></span><span class="op" id="6034664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034667">if</span>&nbsp;<span class="ident" id="6034670"><a href="/go/parser/interface.go.html#6034598">err</a></span>&nbsp;<span class="op" id="6034674">!=</span>&nbsp;<span class="ident" id="6034677">nil</span>&nbsp;<span class="op" id="6034681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034685">return</span>&nbsp;<span class="ident" id="6034692">nil</span><span class="op" id="6034695">,</span>&nbsp;<span class="ident" id="6034697"><a href="/go/parser/interface.go.html#6034598">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034702">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034706">var</span>&nbsp;<span class="ident" id="6034710">p</span>&nbsp;<span class="ident" id="6034712"><a href="/go/parser/parser.go.html#6038167">parser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034720">defer</span>&nbsp;<span class="keyword" id="6034726">func</span><span class="op" id="6034730">(</span><span class="op" id="6034731">)</span>&nbsp;<span class="op" id="6034733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034737">if</span>&nbsp;<span class="ident" id="6034740">e</span>&nbsp;<span class="op" id="6034742">:=</span>&nbsp;<span class="builtinfunc" id="6034745">recover</span><span class="op" id="6034752">(</span><span class="op" id="6034753">)</span><span class="op" id="6034754">;</span>&nbsp;<span class="ident" id="6034756"><a href="/go/parser/interface.go.html#6034740">e</a></span>&nbsp;<span class="op" id="6034758">!=</span>&nbsp;<span class="ident" id="6034761">nil</span>&nbsp;<span class="op" id="6034765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034770">_</span>&nbsp;<span class="op" id="6034772">=</span>&nbsp;<span class="ident" id="6034774"><a href="/go/parser/interface.go.html#6034740">e</a></span><span class="op" id="6034775">.</span><span class="op" id="6034776">(</span><span class="ident" id="6034777"><a href="/go/parser/parser.go.html#6047882">bailout</a></span><span class="op" id="6034784">)</span>&nbsp;<span class="comment" id="6034786">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034828">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034851">if</span>&nbsp;<span class="ident" id="6034854"><a href="/go/parser/interface.go.html#6034585">f</a></span>&nbsp;<span class="op" id="6034856">==</span>&nbsp;<span class="ident" id="6034859">nil</span>&nbsp;<span class="op" id="6034863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034868">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034921">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034972">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034988"><a href="/go/parser/interface.go.html#6034585">f</a></span>&nbsp;<span class="op" id="6034990">=</span>&nbsp;<span class="op" id="6034992">&amp;</span><span class="ident" id="6034993"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6034996">.</span><span class="ident" id="6034997">File</span><span class="op" id="6035001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035007">Name</span><span class="op" id="6035011">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="6035014">new</span><span class="op" id="6035017">(</span><span class="ident" id="6035018"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6035021">.</span><span class="ident" id="6035022">Ident</span><span class="op" id="6035027">)</span><span class="op" id="6035028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035034">Scope</span><span class="op" id="6035039">:</span>&nbsp;<span class="ident" id="6035041"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6035044">.</span><span class="ident" id="6035045">NewScope</span><span class="op" id="6035053">(</span><span class="ident" id="6035054">nil</span><span class="op" id="6035057">)</span><span class="op" id="6035058">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035072"><a href="/go/parser/interface.go.html#6034710">p</a></span><span class="op" id="6035073">.</span><span class="ident" id="6035074">errors</span><span class="op" id="6035080">.</span><span class="ident" id="6035081">Sort</span><span class="op" id="6035085">(</span><span class="op" id="6035086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035090"><a href="/go/parser/interface.go.html#6034598">err</a></span>&nbsp;<span class="op" id="6035094">=</span>&nbsp;<span class="ident" id="6035096"><a href="/go/parser/interface.go.html#6034710">p</a></span><span class="op" id="6035097">.</span><span class="ident" id="6035098">errors</span><span class="op" id="6035104">.</span><span class="ident" id="6035105">Err</span><span class="op" id="6035108">(</span><span class="op" id="6035109">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035112">}</span><span class="op" id="6035113">(</span><span class="op" id="6035114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035118">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035135"><a href="/go/parser/interface.go.html#6034710">p</a></span><span class="op" id="6035136">.</span><span class="ident" id="6035137">init</span><span class="op" id="6035141">(</span><span class="ident" id="6035142"><a href="/go/parser/interface.go.html#6034518">fset</a></span><span class="op" id="6035146">,</span>&nbsp;<span class="ident" id="6035148"><a href="/go/parser/interface.go.html#6034539">filename</a></span><span class="op" id="6035156">,</span>&nbsp;<span class="ident" id="6035158"><a href="/go/parser/interface.go.html#6034627">text</a></span><span class="op" id="6035162">,</span>&nbsp;<span class="ident" id="6035164"><a href="/go/parser/interface.go.html#6034573">mode</a></span><span class="op" id="6035168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035171"><a href="/go/parser/interface.go.html#6034585">f</a></span>&nbsp;<span class="op" id="6035173">=</span>&nbsp;<span class="ident" id="6035175"><a href="/go/parser/interface.go.html#6034710">p</a></span><span class="op" id="6035176">.</span><span class="ident" id="6035177">parseFile</span><span class="op" id="6035186">(</span><span class="op" id="6035187">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035191">return</span><br>
<span class="lineno"></span><span class="op" id="6035198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6035201">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="6035277">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="6035353">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="6035389">//</span><br>
<span class="lineno"></span><span class="comment" id="6035392">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="6035469">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="6035546">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="6035615">//</span><br>
<span class="lineno"></span><span class="comment" id="6035618">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6035695">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6035772">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="6035813">//</span><br>
<span class="lineno"></span><span class="keyword" id="6035816">func</span>&nbsp;<span class="ident" id="6035821">ParseDir</span><span class="op" id="6035829">(</span><span class="ident" id="6035830">fset</span>&nbsp;<span class="op" id="6035835">*</span><span class="ident" id="6035836"><a href="/go/parser/interface.go.html#6031869">token</a></span><span class="op" id="6035841">.</span><span class="ident" id="6035842">FileSet</span><span class="op" id="6035849">,</span>&nbsp;<span class="ident" id="6035851">path</span>&nbsp;<span class="builtintype" id="6035856">string</span><span class="op" id="6035862">,</span>&nbsp;<span class="ident" id="6035864">filter</span>&nbsp;<span class="keyword" id="6035871">func</span><span class="op" id="6035875">(</span><span class="ident" id="6035876"><a href="/go/parser/interface.go.html#6031900">os</a></span><span class="op" id="6035878">.</span><span class="ident" id="6035879">FileInfo</span><span class="op" id="6035887">)</span>&nbsp;<span class="builtintype" id="6035889">bool</span><span class="op" id="6035893">,</span>&nbsp;<span class="ident" id="6035895">mode</span>&nbsp;<span class="ident" id="6035900"><a href="/go/parser/interface.go.html#6032820">Mode</a></span><span class="op" id="6035904">)</span>&nbsp;<span class="op" id="6035906">(</span><span class="ident" id="6035907">pkgs</span>&nbsp;<span class="keyword" id="6035912">map</span><span class="op" id="6035915">[</span><span class="builtintype" id="6035916">string</span><span class="op" id="6035922">]</span><span class="op" id="6035923">*</span><span class="ident" id="6035924"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6035927">.</span><span class="ident" id="6035928">Package</span><span class="op" id="6035935">,</span>&nbsp;<span class="ident" id="6035937">first</span>&nbsp;<span class="builtintype" id="6035943">error</span><span class="op" id="6035948">)</span>&nbsp;<span class="op" id="6035950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035953">fd</span><span class="op" id="6035955">,</span>&nbsp;<span class="ident" id="6035957">err</span>&nbsp;<span class="op" id="6035961">:=</span>&nbsp;<span class="ident" id="6035964"><a href="/go/parser/interface.go.html#6031900">os</a></span><span class="op" id="6035966">.</span><span class="ident" id="6035967">Open</span><span class="op" id="6035971">(</span><span class="ident" id="6035972"><a href="/go/parser/interface.go.html#6035851">path</a></span><span class="op" id="6035976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035979">if</span>&nbsp;<span class="ident" id="6035982"><a href="/go/parser/interface.go.html#6035957">err</a></span>&nbsp;<span class="op" id="6035986">!=</span>&nbsp;<span class="ident" id="6035989">nil</span>&nbsp;<span class="op" id="6035993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035997">return</span>&nbsp;<span class="ident" id="6036004">nil</span><span class="op" id="6036007">,</span>&nbsp;<span class="ident" id="6036009"><a href="/go/parser/interface.go.html#6035957">err</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036017">defer</span>&nbsp;<span class="ident" id="6036023"><a href="/go/parser/interface.go.html#6035953">fd</a></span><span class="op" id="6036025">.</span><span class="ident" id="6036026">Close</span><span class="op" id="6036031">(</span><span class="op" id="6036032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036036">list</span><span class="op" id="6036040">,</span>&nbsp;<span class="ident" id="6036042"><a href="/go/parser/interface.go.html#6035957">err</a></span>&nbsp;<span class="op" id="6036046">:=</span>&nbsp;<span class="ident" id="6036049"><a href="/go/parser/interface.go.html#6035953">fd</a></span><span class="op" id="6036051">.</span><span class="ident" id="6036052">Readdir</span><span class="op" id="6036059">(</span><span class="op" id="6036060">-</span><span class="num" id="6036061">1</span><span class="op" id="6036062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036065">if</span>&nbsp;<span class="ident" id="6036068"><a href="/go/parser/interface.go.html#6035957">err</a></span>&nbsp;<span class="op" id="6036072">!=</span>&nbsp;<span class="ident" id="6036075">nil</span>&nbsp;<span class="op" id="6036079">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036083">return</span>&nbsp;<span class="ident" id="6036090">nil</span><span class="op" id="6036093">,</span>&nbsp;<span class="ident" id="6036095"><a href="/go/parser/interface.go.html#6035957">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036104"><a href="/go/parser/interface.go.html#6035907">pkgs</a></span>&nbsp;<span class="op" id="6036109">=</span>&nbsp;<span class="builtinfunc" id="6036111">make</span><span class="op" id="6036115">(</span><span class="keyword" id="6036116">map</span><span class="op" id="6036119">[</span><span class="builtintype" id="6036120">string</span><span class="op" id="6036126">]</span><span class="op" id="6036127">*</span><span class="ident" id="6036128"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6036131">.</span><span class="ident" id="6036132">Package</span><span class="op" id="6036139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036142">for</span>&nbsp;<span class="ident" id="6036146">_</span><span class="op" id="6036147">,</span>&nbsp;<span class="ident" id="6036149">d</span>&nbsp;<span class="op" id="6036151">:=</span>&nbsp;<span class="keyword" id="6036154">range</span>&nbsp;<span class="ident" id="6036160"><a href="/go/parser/interface.go.html#6036036">list</a></span>&nbsp;<span class="op" id="6036165">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036169">if</span>&nbsp;<span class="ident" id="6036172"><a href="/go/parser/interface.go.html#6031923">strings</a></span><span class="op" id="6036179">.</span><span class="ident" id="6036180">HasSuffix</span><span class="op" id="6036189">(</span><span class="ident" id="6036190"><a href="/go/parser/interface.go.html#6036149">d</a></span><span class="op" id="6036191">.</span><span class="ident" id="6036192">Name</span><span class="op" id="6036196">(</span><span class="op" id="6036197">)</span><span class="op" id="6036198">,</span>&nbsp;<span class="string" id="6036200">&#34;.go&#34;</span><span class="op" id="6036205">)</span>&nbsp;<span class="op" id="6036207">&amp;&amp;</span>&nbsp;<span class="op" id="6036210">(</span><span class="ident" id="6036211"><a href="/go/parser/interface.go.html#6035864">filter</a></span>&nbsp;<span class="op" id="6036218">==</span>&nbsp;<span class="ident" id="6036221">nil</span>&nbsp;<span class="op" id="6036225">||</span>&nbsp;<span class="ident" id="6036228"><a href="/go/parser/interface.go.html#6035864">filter</a></span><span class="op" id="6036234">(</span><span class="ident" id="6036235"><a href="/go/parser/interface.go.html#6036149">d</a></span><span class="op" id="6036236">)</span><span class="op" id="6036237">)</span>&nbsp;<span class="op" id="6036239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036244">filename</span>&nbsp;<span class="op" id="6036253">:=</span>&nbsp;<span class="ident" id="6036256"><a href="/go/parser/interface.go.html#6031906">filepath</a></span><span class="op" id="6036264">.</span><span class="ident" id="6036265">Join</span><span class="op" id="6036269">(</span><span class="ident" id="6036270"><a href="/go/parser/interface.go.html#6035851">path</a></span><span class="op" id="6036274">,</span>&nbsp;<span class="ident" id="6036276"><a href="/go/parser/interface.go.html#6036149">d</a></span><span class="op" id="6036277">.</span><span class="ident" id="6036278">Name</span><span class="op" id="6036282">(</span><span class="op" id="6036283">)</span><span class="op" id="6036284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036289">if</span>&nbsp;<span class="ident" id="6036292">src</span><span class="op" id="6036295">,</span>&nbsp;<span class="ident" id="6036297">err</span>&nbsp;<span class="op" id="6036301">:=</span>&nbsp;<span class="ident" id="6036304"><a href="/go/parser/interface.go.html#6034508">ParseFile</a></span><span class="op" id="6036313">(</span><span class="ident" id="6036314"><a href="/go/parser/interface.go.html#6035830">fset</a></span><span class="op" id="6036318">,</span>&nbsp;<span class="ident" id="6036320"><a href="/go/parser/interface.go.html#6036244">filename</a></span><span class="op" id="6036328">,</span>&nbsp;<span class="ident" id="6036330">nil</span><span class="op" id="6036333">,</span>&nbsp;<span class="ident" id="6036335"><a href="/go/parser/interface.go.html#6035895">mode</a></span><span class="op" id="6036339">)</span><span class="op" id="6036340">;</span>&nbsp;<span class="ident" id="6036342"><a href="/go/parser/interface.go.html#6036297">err</a></span>&nbsp;<span class="op" id="6036346">==</span>&nbsp;<span class="ident" id="6036349">nil</span>&nbsp;<span class="op" id="6036353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036359">name</span>&nbsp;<span class="op" id="6036364">:=</span>&nbsp;<span class="ident" id="6036367"><a href="/go/parser/interface.go.html#6036292">src</a></span><span class="op" id="6036370">.</span><span class="ident" id="6036371">Name</span><span class="op" id="6036375">.</span><span class="ident" id="6036376">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036385">pkg</span><span class="op" id="6036388">,</span>&nbsp;<span class="ident" id="6036390">found</span>&nbsp;<span class="op" id="6036396">:=</span>&nbsp;<span class="ident" id="6036399"><a href="/go/parser/interface.go.html#6035907">pkgs</a></span><span class="op" id="6036403">[</span><span class="ident" id="6036404"><a href="/go/parser/interface.go.html#6036359">name</a></span><span class="op" id="6036408">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036414">if</span>&nbsp;<span class="op" id="6036417">!</span><span class="ident" id="6036418"><a href="/go/parser/interface.go.html#6036390">found</a></span>&nbsp;<span class="op" id="6036424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036431"><a href="/go/parser/interface.go.html#6036385">pkg</a></span>&nbsp;<span class="op" id="6036435">=</span>&nbsp;<span class="op" id="6036437">&amp;</span><span class="ident" id="6036438"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6036441">.</span><span class="ident" id="6036442">Package</span><span class="op" id="6036449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036457">Name</span><span class="op" id="6036461">:</span>&nbsp;&nbsp;<span class="ident" id="6036464"><a href="/go/parser/interface.go.html#6036359">name</a></span><span class="op" id="6036468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036476">Files</span><span class="op" id="6036481">:</span>&nbsp;<span class="builtinfunc" id="6036483">make</span><span class="op" id="6036487">(</span><span class="keyword" id="6036488">map</span><span class="op" id="6036491">[</span><span class="builtintype" id="6036492">string</span><span class="op" id="6036498">]</span><span class="op" id="6036499">*</span><span class="ident" id="6036500"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6036503">.</span><span class="ident" id="6036504">File</span><span class="op" id="6036508">)</span><span class="op" id="6036509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036516">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036523"><a href="/go/parser/interface.go.html#6035907">pkgs</a></span><span class="op" id="6036527">[</span><span class="ident" id="6036528"><a href="/go/parser/interface.go.html#6036359">name</a></span><span class="op" id="6036532">]</span>&nbsp;<span class="op" id="6036534">=</span>&nbsp;<span class="ident" id="6036536"><a href="/go/parser/interface.go.html#6036385">pkg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036550"><a href="/go/parser/interface.go.html#6036385">pkg</a></span><span class="op" id="6036553">.</span><span class="ident" id="6036554">Files</span><span class="op" id="6036559">[</span><span class="ident" id="6036560"><a href="/go/parser/interface.go.html#6036244">filename</a></span><span class="op" id="6036568">]</span>&nbsp;<span class="op" id="6036570">=</span>&nbsp;<span class="ident" id="6036572"><a href="/go/parser/interface.go.html#6036292">src</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036579">}</span>&nbsp;<span class="keyword" id="6036581">else</span>&nbsp;<span class="keyword" id="6036586">if</span>&nbsp;<span class="ident" id="6036589"><a href="/go/parser/interface.go.html#6035937">first</a></span>&nbsp;<span class="op" id="6036595">==</span>&nbsp;<span class="ident" id="6036598">nil</span>&nbsp;<span class="op" id="6036602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036608"><a href="/go/parser/interface.go.html#6035937">first</a></span>&nbsp;<span class="op" id="6036614">=</span>&nbsp;<span class="ident" id="6036616"><a href="/go/parser/interface.go.html#6036297">err</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036634">return</span><br>
<span class="lineno">165</span><span class="op" id="6036641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6036644">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="6036725">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="6036805">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="6036847">//</span><br>
<span class="lineno"></span><span class="keyword" id="6036850">func</span>&nbsp;<span class="ident" id="6036855">ParseExpr</span><span class="op" id="6036864">(</span><span class="ident" id="6036865">x</span>&nbsp;<span class="builtintype" id="6036867">string</span><span class="op" id="6036873">)</span>&nbsp;<span class="op" id="6036875">(</span><span class="ident" id="6036876"><a href="/go/parser/interface.go.html#6031859">ast</a></span><span class="op" id="6036879">.</span><span class="ident" id="6036880">Expr</span><span class="op" id="6036884">,</span>&nbsp;<span class="builtintype" id="6036886">error</span><span class="op" id="6036891">)</span>&nbsp;<span class="op" id="6036893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036896">var</span>&nbsp;<span class="ident" id="6036900">p</span>&nbsp;<span class="ident" id="6036902"><a href="/go/parser/parser.go.html#6038167">parser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036910"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6036911">.</span><span class="ident" id="6036912">init</span><span class="op" id="6036916">(</span><span class="ident" id="6036917"><a href="/go/parser/interface.go.html#6031869">token</a></span><span class="op" id="6036922">.</span><span class="ident" id="6036923">NewFileSet</span><span class="op" id="6036933">(</span><span class="op" id="6036934">)</span><span class="op" id="6036935">,</span>&nbsp;<span class="string" id="6036937">&#34;&#34;</span><span class="op" id="6036939">,</span>&nbsp;<span class="op" id="6036941">[</span><span class="op" id="6036942">]</span><span class="builtintype" id="6036943">byte</span><span class="op" id="6036947">(</span><span class="ident" id="6036948"><a href="/go/parser/interface.go.html#6036865">x</a></span><span class="op" id="6036949">)</span><span class="op" id="6036950">,</span>&nbsp;<span class="num" id="6036952">0</span><span class="op" id="6036953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036957">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037014">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037071">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037130">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037161"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037162">.</span><span class="ident" id="6037163">openScope</span><span class="op" id="6037172">(</span><span class="op" id="6037173">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037176"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037177">.</span><span class="ident" id="6037178">pkgScope</span>&nbsp;<span class="op" id="6037187">=</span>&nbsp;<span class="ident" id="6037189"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037190">.</span><span class="ident" id="6037191">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037201">e</span>&nbsp;<span class="op" id="6037203">:=</span>&nbsp;<span class="ident" id="6037206"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037207">.</span><span class="ident" id="6037208">parseRhsOrType</span><span class="op" id="6037222">(</span><span class="op" id="6037223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037226"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037227">.</span><span class="ident" id="6037228">closeScope</span><span class="op" id="6037238">(</span><span class="op" id="6037239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037242"><a href="/go/parser/parser.go.html#6049843">assert</a></span><span class="op" id="6037248">(</span><span class="ident" id="6037249"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037250">.</span><span class="ident" id="6037251">topScope</span>&nbsp;<span class="op" id="6037260">==</span>&nbsp;<span class="ident" id="6037263">nil</span><span class="op" id="6037266">,</span>&nbsp;<span class="string" id="6037268">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="6037287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037291">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037336">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037380">if</span>&nbsp;<span class="ident" id="6037383"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037384">.</span><span class="ident" id="6037385">tok</span>&nbsp;<span class="op" id="6037389">==</span>&nbsp;<span class="ident" id="6037392"><a href="/go/parser/interface.go.html#6031869">token</a></span><span class="op" id="6037397">.</span><span class="ident" id="6037398">SEMICOLON</span>&nbsp;<span class="op" id="6037408">&amp;&amp;</span>&nbsp;<span class="ident" id="6037411"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037412">.</span><span class="ident" id="6037413">lit</span>&nbsp;<span class="op" id="6037417">==</span>&nbsp;<span class="string" id="6037420">&#34;\n&#34;</span>&nbsp;<span class="op" id="6037425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037429"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037430">.</span><span class="ident" id="6037431">next</span><span class="op" id="6037435">(</span><span class="op" id="6037436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037439">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037442"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037443">.</span><span class="ident" id="6037444">expect</span><span class="op" id="6037450">(</span><span class="ident" id="6037451"><a href="/go/parser/interface.go.html#6031869">token</a></span><span class="op" id="6037456">.</span><span class="ident" id="6037457">EOF</span><span class="op" id="6037460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037464">if</span>&nbsp;<span class="ident" id="6037467"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037468">.</span><span class="ident" id="6037469">errors</span><span class="op" id="6037475">.</span><span class="ident" id="6037476">Len</span><span class="op" id="6037479">(</span><span class="op" id="6037480">)</span>&nbsp;<span class="op" id="6037482">&gt;</span>&nbsp;<span class="num" id="6037484">0</span>&nbsp;<span class="op" id="6037486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037490"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037491">.</span><span class="ident" id="6037492">errors</span><span class="op" id="6037498">.</span><span class="ident" id="6037499">Sort</span><span class="op" id="6037503">(</span><span class="op" id="6037504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037508">return</span>&nbsp;<span class="ident" id="6037515">nil</span><span class="op" id="6037518">,</span>&nbsp;<span class="ident" id="6037520"><a href="/go/parser/interface.go.html#6036900">p</a></span><span class="op" id="6037521">.</span><span class="ident" id="6037522">errors</span><span class="op" id="6037528">.</span><span class="ident" id="6037529">Err</span><span class="op" id="6037532">(</span><span class="op" id="6037533">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037540">return</span>&nbsp;<span class="ident" id="6037547"><a href="/go/parser/interface.go.html#6037201">e</a></span><span class="op" id="6037548">,</span>&nbsp;<span class="ident" id="6037550">nil</span><br>
<span class="lineno"></span><span class="op" id="6037554">}</span>
</div>
</body>
</html>
