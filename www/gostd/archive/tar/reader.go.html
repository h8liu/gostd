<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6086421">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6086476">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6086530">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6086581">package</span>&nbsp;<span class="ident" id="6086589">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086594">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="6086613">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6086636">import</span>&nbsp;<span class="op" id="6086643">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086646">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086655">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086665">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086671">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086684">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086690">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086701">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6086712">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6086719">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6086722">var</span>&nbsp;<span class="op" id="6086726">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086729">ErrHeader</span>&nbsp;<span class="op" id="6086739">=</span>&nbsp;<span class="ident" id="6086741">errors</span><span class="op" id="6086747">.</span><span class="ident" id="6086748">New</span><span class="op" id="6086751">(</span><span class="string" id="6086752">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="6086785">)</span><br>
<span class="lineno"></span><span class="op" id="6086787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6086790">const</span>&nbsp;<span class="ident" id="6086796">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6086817">=</span>&nbsp;<span class="num" id="6086819">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086822">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6086895">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6086945">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="6087028">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6087101">type</span>&nbsp;<span class="ident" id="6087106">Reader</span>&nbsp;<span class="keyword" id="6087113">struct</span>&nbsp;<span class="op" id="6087120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087123">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087131">io</span><span class="op" id="6087133">.</span><span class="ident" id="6087134">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087142">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6087150">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087157">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087165">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087181">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087238">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087246">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="6087262">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087296">hdrBuff</span>&nbsp;<span class="op" id="6087304">[</span><span class="ident" id="6087305">blockSize</span><span class="op" id="6087314">]</span><span class="builtintype" id="6087315">byte</span>&nbsp;<span class="comment" id="6087320">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="6087351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087354">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="6087435">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6087489">type</span>&nbsp;<span class="ident" id="6087494">numBytesReader</span>&nbsp;<span class="keyword" id="6087509">interface</span>&nbsp;<span class="op" id="6087519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087522">io</span><span class="op" id="6087524">.</span><span class="ident" id="6087525">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087533">numBytes</span><span class="op" id="6087541">(</span><span class="op" id="6087542">)</span>&nbsp;<span class="ident" id="6087544">int64</span><br>
<span class="lineno"></span><span class="op" id="6087550">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6087553">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6087634">type</span>&nbsp;<span class="ident" id="6087639">regFileReader</span>&nbsp;<span class="keyword" id="6087653">struct</span>&nbsp;<span class="op" id="6087660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087663">r</span>&nbsp;&nbsp;<span class="ident" id="6087666">io</span><span class="op" id="6087668">.</span><span class="ident" id="6087669">Reader</span>&nbsp;<span class="comment" id="6087676">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087698">nb</span>&nbsp;<span class="ident" id="6087701">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087711">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="6087760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087763">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6087854">type</span>&nbsp;<span class="ident" id="6087859">sparseFileReader</span>&nbsp;<span class="keyword" id="6087876">struct</span>&nbsp;<span class="op" id="6087883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087886">rfr</span>&nbsp;<span class="op" id="6087890">*</span><span class="ident" id="6087891">regFileReader</span>&nbsp;<span class="comment" id="6087905">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087944">sp</span>&nbsp;&nbsp;<span class="op" id="6087948">[</span><span class="op" id="6087949">]</span><span class="ident" id="6087950">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="6087963">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087995">pos</span>&nbsp;<span class="ident" id="6087999">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088014">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088047">tot</span>&nbsp;<span class="ident" id="6088051">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088066">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="6088092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6088095">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="6088153">const</span>&nbsp;<span class="op" id="6088159">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088162">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="6088184">=</span>&nbsp;<span class="string" id="6088186">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088210">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088232">=</span>&nbsp;<span class="string" id="6088234">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088255">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="6088277">=</span>&nbsp;<span class="string" id="6088279">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088302">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088324">=</span>&nbsp;<span class="string" id="6088326">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088344">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088366">=</span>&nbsp;<span class="string" id="6088368">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088387">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088409">=</span>&nbsp;<span class="string" id="6088411">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088431">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088453">=</span>&nbsp;<span class="string" id="6088455">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088475">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088497">=</span>&nbsp;<span class="string" id="6088499">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088518">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="6088540">=</span>&nbsp;<span class="string" id="6088542">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="6088564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088567">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="6088606">const</span>&nbsp;<span class="op" id="6088612">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088615">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088658">=</span>&nbsp;<span class="num" id="6088660">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088665">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088708">=</span>&nbsp;<span class="num" id="6088710">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088715">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088758">=</span>&nbsp;<span class="num" id="6088760">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088763">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="6088806">=</span>&nbsp;<span class="num" id="6088808">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088813">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088856">=</span>&nbsp;<span class="num" id="6088858">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088862">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088905">=</span>&nbsp;<span class="num" id="6088907">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088911">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088954">=</span>&nbsp;<span class="num" id="6088956">12</span><br>
<span class="lineno"></span><span class="op" id="6088959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088962">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="6089012">func</span>&nbsp;<span class="ident" id="6089017">NewReader</span><span class="op" id="6089026">(</span><span class="ident" id="6089027">r</span>&nbsp;<span class="ident" id="6089029">io</span><span class="op" id="6089031">.</span><span class="ident" id="6089032">Reader</span><span class="op" id="6089038">)</span>&nbsp;<span class="op" id="6089040">*</span><span class="ident" id="6089041">Reader</span>&nbsp;<span class="op" id="6089048">{</span>&nbsp;<span class="keyword" id="6089050">return</span>&nbsp;<span class="op" id="6089057">&amp;</span><span class="ident" id="6089058">Reader</span><span class="op" id="6089064">{</span><span class="ident" id="6089065">r</span><span class="op" id="6089066">:</span>&nbsp;<span class="ident" id="6089068">r</span><span class="op" id="6089069">}</span>&nbsp;<span class="op" id="6089071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6089074">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6089129">func</span>&nbsp;<span class="op" id="6089134">(</span><span class="ident" id="6089135">tr</span>&nbsp;<span class="op" id="6089138">*</span><span class="ident" id="6089139">Reader</span><span class="op" id="6089145">)</span>&nbsp;<span class="ident" id="6089147">Next</span><span class="op" id="6089151">(</span><span class="op" id="6089152">)</span>&nbsp;<span class="op" id="6089154">(</span><span class="op" id="6089155">*</span><span class="ident" id="6089156">Header</span><span class="op" id="6089162">,</span>&nbsp;<span class="builtintype" id="6089164">error</span><span class="op" id="6089169">)</span>&nbsp;<span class="op" id="6089171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089174">var</span>&nbsp;<span class="ident" id="6089178">hdr</span>&nbsp;<span class="op" id="6089182">*</span><span class="ident" id="6089183">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089191">if</span>&nbsp;<span class="ident" id="6089194">tr</span><span class="op" id="6089196">.</span><span class="ident" id="6089197">err</span>&nbsp;<span class="op" id="6089201">==</span>&nbsp;<span class="ident" id="6089204">nil</span>&nbsp;<span class="op" id="6089208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089212">tr</span><span class="op" id="6089214">.</span><span class="ident" id="6089215">skipUnread</span><span class="op" id="6089225">(</span><span class="op" id="6089226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089232">if</span>&nbsp;<span class="ident" id="6089235">tr</span><span class="op" id="6089237">.</span><span class="ident" id="6089238">err</span>&nbsp;<span class="op" id="6089242">!=</span>&nbsp;<span class="ident" id="6089245">nil</span>&nbsp;<span class="op" id="6089249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089253">return</span>&nbsp;<span class="ident" id="6089260">hdr</span><span class="op" id="6089263">,</span>&nbsp;<span class="ident" id="6089265">tr</span><span class="op" id="6089267">.</span><span class="ident" id="6089268">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089276">hdr</span>&nbsp;<span class="op" id="6089280">=</span>&nbsp;<span class="ident" id="6089282">tr</span><span class="op" id="6089284">.</span><span class="ident" id="6089285">readHeader</span><span class="op" id="6089295">(</span><span class="op" id="6089296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089299">if</span>&nbsp;<span class="ident" id="6089302">hdr</span>&nbsp;<span class="op" id="6089306">==</span>&nbsp;<span class="ident" id="6089309">nil</span>&nbsp;<span class="op" id="6089313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089317">return</span>&nbsp;<span class="ident" id="6089324">hdr</span><span class="op" id="6089327">,</span>&nbsp;<span class="ident" id="6089329">tr</span><span class="op" id="6089331">.</span><span class="ident" id="6089332">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089337">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089340">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089370">switch</span>&nbsp;<span class="ident" id="6089377">hdr</span><span class="op" id="6089380">.</span><span class="ident" id="6089381">Typeflag</span>&nbsp;<span class="op" id="6089390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089393">case</span>&nbsp;<span class="ident" id="6089398">TypeXHeader</span><span class="op" id="6089409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089413">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089439">headers</span><span class="op" id="6089446">,</span>&nbsp;<span class="ident" id="6089448">err</span>&nbsp;<span class="op" id="6089452">:=</span>&nbsp;<span class="ident" id="6089455">parsePAX</span><span class="op" id="6089463">(</span><span class="ident" id="6089464">tr</span><span class="op" id="6089466">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089470">if</span>&nbsp;<span class="ident" id="6089473">err</span>&nbsp;<span class="op" id="6089477">!=</span>&nbsp;<span class="ident" id="6089480">nil</span>&nbsp;<span class="op" id="6089484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089489">return</span>&nbsp;<span class="ident" id="6089496">nil</span><span class="op" id="6089499">,</span>&nbsp;<span class="ident" id="6089501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089511">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089549">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089587">tr</span><span class="op" id="6089589">.</span><span class="ident" id="6089590">skipUnread</span><span class="op" id="6089600">(</span><span class="op" id="6089601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089605">hdr</span>&nbsp;<span class="op" id="6089609">=</span>&nbsp;<span class="ident" id="6089611">tr</span><span class="op" id="6089613">.</span><span class="ident" id="6089614">readHeader</span><span class="op" id="6089624">(</span><span class="op" id="6089625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089629">mergePAX</span><span class="op" id="6089637">(</span><span class="ident" id="6089638">hdr</span><span class="op" id="6089641">,</span>&nbsp;<span class="ident" id="6089643">headers</span><span class="op" id="6089650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089655">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089695">sp</span><span class="op" id="6089697">,</span>&nbsp;<span class="ident" id="6089699">err</span>&nbsp;<span class="op" id="6089703">:=</span>&nbsp;<span class="ident" id="6089706">tr</span><span class="op" id="6089708">.</span><span class="ident" id="6089709">checkForGNUSparsePAXHeaders</span><span class="op" id="6089736">(</span><span class="ident" id="6089737">hdr</span><span class="op" id="6089740">,</span>&nbsp;<span class="ident" id="6089742">headers</span><span class="op" id="6089749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089753">if</span>&nbsp;<span class="ident" id="6089756">err</span>&nbsp;<span class="op" id="6089760">!=</span>&nbsp;<span class="ident" id="6089763">nil</span>&nbsp;<span class="op" id="6089767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089772">tr</span><span class="op" id="6089774">.</span><span class="ident" id="6089775">err</span>&nbsp;<span class="op" id="6089779">=</span>&nbsp;<span class="ident" id="6089781">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089788">return</span>&nbsp;<span class="ident" id="6089795">nil</span><span class="op" id="6089798">,</span>&nbsp;<span class="ident" id="6089800">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089806">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089810">if</span>&nbsp;<span class="ident" id="6089813">sp</span>&nbsp;<span class="op" id="6089816">!=</span>&nbsp;<span class="ident" id="6089819">nil</span>&nbsp;<span class="op" id="6089823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089828">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089880">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089939">tr</span><span class="op" id="6089941">.</span><span class="ident" id="6089942">curr</span>&nbsp;<span class="op" id="6089947">=</span>&nbsp;<span class="op" id="6089949">&amp;</span><span class="ident" id="6089950">sparseFileReader</span><span class="op" id="6089966">{</span><span class="ident" id="6089967">rfr</span><span class="op" id="6089970">:</span>&nbsp;<span class="ident" id="6089972">tr</span><span class="op" id="6089974">.</span><span class="ident" id="6089975">curr</span><span class="op" id="6089979">.</span><span class="op" id="6089980">(</span><span class="op" id="6089981">*</span><span class="ident" id="6089982">regFileReader</span><span class="op" id="6089995">)</span><span class="op" id="6089996">,</span>&nbsp;<span class="ident" id="6089998">sp</span><span class="op" id="6090000">:</span>&nbsp;<span class="ident" id="6090002">sp</span><span class="op" id="6090004">,</span>&nbsp;<span class="ident" id="6090006">tot</span><span class="op" id="6090009">:</span>&nbsp;<span class="ident" id="6090011">hdr</span><span class="op" id="6090014">.</span><span class="ident" id="6090015">Size</span><span class="op" id="6090019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090023">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090027">return</span>&nbsp;<span class="ident" id="6090034">hdr</span><span class="op" id="6090037">,</span>&nbsp;<span class="ident" id="6090039">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090044">case</span>&nbsp;<span class="ident" id="6090049">TypeGNULongName</span><span class="op" id="6090064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090068">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090142">realname</span><span class="op" id="6090150">,</span>&nbsp;<span class="ident" id="6090152">err</span>&nbsp;<span class="op" id="6090156">:=</span>&nbsp;<span class="ident" id="6090159">ioutil</span><span class="op" id="6090165">.</span><span class="ident" id="6090166">ReadAll</span><span class="op" id="6090173">(</span><span class="ident" id="6090174">tr</span><span class="op" id="6090176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090180">if</span>&nbsp;<span class="ident" id="6090183">err</span>&nbsp;<span class="op" id="6090187">!=</span>&nbsp;<span class="ident" id="6090190">nil</span>&nbsp;<span class="op" id="6090194">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090199">return</span>&nbsp;<span class="ident" id="6090206">nil</span><span class="op" id="6090209">,</span>&nbsp;<span class="ident" id="6090211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090221">hdr</span><span class="op" id="6090224">,</span>&nbsp;<span class="ident" id="6090226">err</span>&nbsp;<span class="op" id="6090230">:=</span>&nbsp;<span class="ident" id="6090233">tr</span><span class="op" id="6090235">.</span><span class="ident" id="6090236">Next</span><span class="op" id="6090240">(</span><span class="op" id="6090241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090245">hdr</span><span class="op" id="6090248">.</span><span class="ident" id="6090249">Name</span>&nbsp;<span class="op" id="6090254">=</span>&nbsp;<span class="ident" id="6090256">cString</span><span class="op" id="6090263">(</span><span class="ident" id="6090264">realname</span><span class="op" id="6090272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090276">return</span>&nbsp;<span class="ident" id="6090283">hdr</span><span class="op" id="6090286">,</span>&nbsp;<span class="ident" id="6090288">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090293">case</span>&nbsp;<span class="ident" id="6090298">TypeGNULongLink</span><span class="op" id="6090313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090317">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090354">realname</span><span class="op" id="6090362">,</span>&nbsp;<span class="ident" id="6090364">err</span>&nbsp;<span class="op" id="6090368">:=</span>&nbsp;<span class="ident" id="6090371">ioutil</span><span class="op" id="6090377">.</span><span class="ident" id="6090378">ReadAll</span><span class="op" id="6090385">(</span><span class="ident" id="6090386">tr</span><span class="op" id="6090388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090392">if</span>&nbsp;<span class="ident" id="6090395">err</span>&nbsp;<span class="op" id="6090399">!=</span>&nbsp;<span class="ident" id="6090402">nil</span>&nbsp;<span class="op" id="6090406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090411">return</span>&nbsp;<span class="ident" id="6090418">nil</span><span class="op" id="6090421">,</span>&nbsp;<span class="ident" id="6090423">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090433">hdr</span><span class="op" id="6090436">,</span>&nbsp;<span class="ident" id="6090438">err</span>&nbsp;<span class="op" id="6090442">:=</span>&nbsp;<span class="ident" id="6090445">tr</span><span class="op" id="6090447">.</span><span class="ident" id="6090448">Next</span><span class="op" id="6090452">(</span><span class="op" id="6090453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090457">hdr</span><span class="op" id="6090460">.</span><span class="ident" id="6090461">Linkname</span>&nbsp;<span class="op" id="6090470">=</span>&nbsp;<span class="ident" id="6090472">cString</span><span class="op" id="6090479">(</span><span class="ident" id="6090480">realname</span><span class="op" id="6090488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090492">return</span>&nbsp;<span class="ident" id="6090499">hdr</span><span class="op" id="6090502">,</span>&nbsp;<span class="ident" id="6090504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090509">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090512">return</span>&nbsp;<span class="ident" id="6090519">hdr</span><span class="op" id="6090522">,</span>&nbsp;<span class="ident" id="6090524">tr</span><span class="op" id="6090526">.</span><span class="ident" id="6090527">err</span><br>
<span class="lineno"></span><span class="op" id="6090531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6090534">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="6090636">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="6090746">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6090779">func</span>&nbsp;<span class="op" id="6090784">(</span><span class="ident" id="6090785">tr</span>&nbsp;<span class="op" id="6090788">*</span><span class="ident" id="6090789">Reader</span><span class="op" id="6090795">)</span>&nbsp;<span class="ident" id="6090797">checkForGNUSparsePAXHeaders</span><span class="op" id="6090824">(</span><span class="ident" id="6090825">hdr</span>&nbsp;<span class="op" id="6090829">*</span><span class="ident" id="6090830">Header</span><span class="op" id="6090836">,</span>&nbsp;<span class="ident" id="6090838">headers</span>&nbsp;<span class="keyword" id="6090846">map</span><span class="op" id="6090849">[</span><span class="builtintype" id="6090850">string</span><span class="op" id="6090856">]</span><span class="builtintype" id="6090857">string</span><span class="op" id="6090863">)</span>&nbsp;<span class="op" id="6090865">(</span><span class="op" id="6090866">[</span><span class="op" id="6090867">]</span><span class="ident" id="6090868">sparseEntry</span><span class="op" id="6090879">,</span>&nbsp;<span class="builtintype" id="6090881">error</span><span class="op" id="6090886">)</span>&nbsp;<span class="op" id="6090888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090891">var</span>&nbsp;<span class="ident" id="6090895">sparseFormat</span>&nbsp;<span class="builtintype" id="6090908">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090917">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090956">major</span><span class="op" id="6090961">,</span>&nbsp;<span class="ident" id="6090963">majorOk</span>&nbsp;<span class="op" id="6090971">:=</span>&nbsp;<span class="ident" id="6090974">headers</span><span class="op" id="6090981">[</span><span class="ident" id="6090982">paxGNUSparseMajor</span><span class="op" id="6090999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091002">minor</span><span class="op" id="6091007">,</span>&nbsp;<span class="ident" id="6091009">minorOk</span>&nbsp;<span class="op" id="6091017">:=</span>&nbsp;<span class="ident" id="6091020">headers</span><span class="op" id="6091027">[</span><span class="ident" id="6091028">paxGNUSparseMinor</span><span class="op" id="6091045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091048">sparseName</span><span class="op" id="6091058">,</span>&nbsp;<span class="ident" id="6091060">sparseNameOk</span>&nbsp;<span class="op" id="6091073">:=</span>&nbsp;<span class="ident" id="6091076">headers</span><span class="op" id="6091083">[</span><span class="ident" id="6091084">paxGNUSparseName</span><span class="op" id="6091100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091103">_</span><span class="op" id="6091104">,</span>&nbsp;<span class="ident" id="6091106">sparseMapOk</span>&nbsp;<span class="op" id="6091118">:=</span>&nbsp;<span class="ident" id="6091121">headers</span><span class="op" id="6091128">[</span><span class="ident" id="6091129">paxGNUSparseMap</span><span class="op" id="6091144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091147">sparseSize</span><span class="op" id="6091157">,</span>&nbsp;<span class="ident" id="6091159">sparseSizeOk</span>&nbsp;<span class="op" id="6091172">:=</span>&nbsp;<span class="ident" id="6091175">headers</span><span class="op" id="6091182">[</span><span class="ident" id="6091183">paxGNUSparseSize</span><span class="op" id="6091199">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091202">sparseRealSize</span><span class="op" id="6091216">,</span>&nbsp;<span class="ident" id="6091218">sparseRealSizeOk</span>&nbsp;<span class="op" id="6091235">:=</span>&nbsp;<span class="ident" id="6091238">headers</span><span class="op" id="6091245">[</span><span class="ident" id="6091246">paxGNUSparseRealSize</span><span class="op" id="6091266">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091270">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091351">if</span>&nbsp;<span class="ident" id="6091354">majorOk</span>&nbsp;<span class="op" id="6091362">&amp;&amp;</span>&nbsp;<span class="ident" id="6091365">minorOk</span>&nbsp;<span class="op" id="6091373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091377">sparseFormat</span>&nbsp;<span class="op" id="6091390">=</span>&nbsp;<span class="ident" id="6091392">major</span>&nbsp;<span class="op" id="6091398">+</span>&nbsp;<span class="string" id="6091400">&#34;.&#34;</span>&nbsp;<span class="op" id="6091404">+</span>&nbsp;<span class="ident" id="6091406">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091413">}</span>&nbsp;<span class="keyword" id="6091415">else</span>&nbsp;<span class="keyword" id="6091420">if</span>&nbsp;<span class="ident" id="6091423">sparseNameOk</span>&nbsp;<span class="op" id="6091436">&amp;&amp;</span>&nbsp;<span class="ident" id="6091439">sparseMapOk</span>&nbsp;<span class="op" id="6091451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091455">sparseFormat</span>&nbsp;<span class="op" id="6091468">=</span>&nbsp;<span class="string" id="6091470">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091477">}</span>&nbsp;<span class="keyword" id="6091479">else</span>&nbsp;<span class="keyword" id="6091484">if</span>&nbsp;<span class="ident" id="6091487">sparseSizeOk</span>&nbsp;<span class="op" id="6091500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091504">sparseFormat</span>&nbsp;<span class="op" id="6091517">=</span>&nbsp;<span class="string" id="6091519">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091526">}</span>&nbsp;<span class="keyword" id="6091528">else</span>&nbsp;<span class="op" id="6091533">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091537">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091576">return</span>&nbsp;<span class="ident" id="6091583">nil</span><span class="op" id="6091586">,</span>&nbsp;<span class="ident" id="6091588">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091597">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091633">if</span>&nbsp;<span class="ident" id="6091636">sparseFormat</span>&nbsp;<span class="op" id="6091649">!=</span>&nbsp;<span class="string" id="6091652">&#34;0.0&#34;</span>&nbsp;<span class="op" id="6091658">&amp;&amp;</span>&nbsp;<span class="ident" id="6091661">sparseFormat</span>&nbsp;<span class="op" id="6091674">!=</span>&nbsp;<span class="string" id="6091677">&#34;0.1&#34;</span>&nbsp;<span class="op" id="6091683">&amp;&amp;</span>&nbsp;<span class="ident" id="6091686">sparseFormat</span>&nbsp;<span class="op" id="6091699">!=</span>&nbsp;<span class="string" id="6091702">&#34;1.0&#34;</span>&nbsp;<span class="op" id="6091708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091712">return</span>&nbsp;<span class="ident" id="6091719">nil</span><span class="op" id="6091722">,</span>&nbsp;<span class="ident" id="6091724">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091733">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091776">if</span>&nbsp;<span class="ident" id="6091779">sparseNameOk</span>&nbsp;<span class="op" id="6091792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091796">hdr</span><span class="op" id="6091799">.</span><span class="ident" id="6091800">Name</span>&nbsp;<span class="op" id="6091805">=</span>&nbsp;<span class="ident" id="6091807">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091822">if</span>&nbsp;<span class="ident" id="6091825">sparseSizeOk</span>&nbsp;<span class="op" id="6091838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091842">realSize</span><span class="op" id="6091850">,</span>&nbsp;<span class="ident" id="6091852">err</span>&nbsp;<span class="op" id="6091856">:=</span>&nbsp;<span class="ident" id="6091859">strconv</span><span class="op" id="6091866">.</span><span class="ident" id="6091867">ParseInt</span><span class="op" id="6091875">(</span><span class="ident" id="6091876">sparseSize</span><span class="op" id="6091886">,</span>&nbsp;<span class="num" id="6091888">10</span><span class="op" id="6091890">,</span>&nbsp;<span class="num" id="6091892">0</span><span class="op" id="6091893">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091897">if</span>&nbsp;<span class="ident" id="6091900">err</span>&nbsp;<span class="op" id="6091904">!=</span>&nbsp;<span class="ident" id="6091907">nil</span>&nbsp;<span class="op" id="6091911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091916">return</span>&nbsp;<span class="ident" id="6091923">nil</span><span class="op" id="6091926">,</span>&nbsp;<span class="ident" id="6091928">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091944">hdr</span><span class="op" id="6091947">.</span><span class="ident" id="6091948">Size</span>&nbsp;<span class="op" id="6091953">=</span>&nbsp;<span class="ident" id="6091955">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091965">}</span>&nbsp;<span class="keyword" id="6091967">else</span>&nbsp;<span class="keyword" id="6091972">if</span>&nbsp;<span class="ident" id="6091975">sparseRealSizeOk</span>&nbsp;<span class="op" id="6091992">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091996">realSize</span><span class="op" id="6092004">,</span>&nbsp;<span class="ident" id="6092006">err</span>&nbsp;<span class="op" id="6092010">:=</span>&nbsp;<span class="ident" id="6092013">strconv</span><span class="op" id="6092020">.</span><span class="ident" id="6092021">ParseInt</span><span class="op" id="6092029">(</span><span class="ident" id="6092030">sparseRealSize</span><span class="op" id="6092044">,</span>&nbsp;<span class="num" id="6092046">10</span><span class="op" id="6092048">,</span>&nbsp;<span class="num" id="6092050">0</span><span class="op" id="6092051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092055">if</span>&nbsp;<span class="ident" id="6092058">err</span>&nbsp;<span class="op" id="6092062">!=</span>&nbsp;<span class="ident" id="6092065">nil</span>&nbsp;<span class="op" id="6092069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092074">return</span>&nbsp;<span class="ident" id="6092081">nil</span><span class="op" id="6092084">,</span>&nbsp;<span class="ident" id="6092086">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6092098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092102">hdr</span><span class="op" id="6092105">.</span><span class="ident" id="6092106">Size</span>&nbsp;<span class="op" id="6092111">=</span>&nbsp;<span class="ident" id="6092113">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6092123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6092127">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092203">var</span>&nbsp;<span class="ident" id="6092207">sp</span>&nbsp;<span class="op" id="6092210">[</span><span class="op" id="6092211">]</span><span class="ident" id="6092212">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092225">var</span>&nbsp;<span class="ident" id="6092229">err</span>&nbsp;<span class="builtintype" id="6092233">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092240">switch</span>&nbsp;<span class="ident" id="6092247">sparseFormat</span>&nbsp;<span class="op" id="6092260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092263">case</span>&nbsp;<span class="string" id="6092268">&#34;0.0&#34;</span><span class="op" id="6092273">,</span>&nbsp;<span class="string" id="6092275">&#34;0.1&#34;</span><span class="op" id="6092280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092284">sp</span><span class="op" id="6092286">,</span>&nbsp;<span class="ident" id="6092288">err</span>&nbsp;<span class="op" id="6092292">=</span>&nbsp;<span class="ident" id="6092294">readGNUSparseMap0x1</span><span class="op" id="6092313">(</span><span class="ident" id="6092314">headers</span><span class="op" id="6092321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092324">case</span>&nbsp;<span class="string" id="6092329">&#34;1.0&#34;</span><span class="op" id="6092334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092338">sp</span><span class="op" id="6092340">,</span>&nbsp;<span class="ident" id="6092342">err</span>&nbsp;<span class="op" id="6092346">=</span>&nbsp;<span class="ident" id="6092348">readGNUSparseMap1x0</span><span class="op" id="6092367">(</span><span class="ident" id="6092368">tr</span><span class="op" id="6092370">.</span><span class="ident" id="6092371">curr</span><span class="op" id="6092375">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6092378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092381">return</span>&nbsp;<span class="ident" id="6092388">sp</span><span class="op" id="6092390">,</span>&nbsp;<span class="ident" id="6092392">err</span><br>
<span class="lineno"></span><span class="op" id="6092396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6092399">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="6092464">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="6092520">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6092580">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="6092642">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6092675">func</span>&nbsp;<span class="ident" id="6092680">mergePAX</span><span class="op" id="6092688">(</span><span class="ident" id="6092689">hdr</span>&nbsp;<span class="op" id="6092693">*</span><span class="ident" id="6092694">Header</span><span class="op" id="6092700">,</span>&nbsp;<span class="ident" id="6092702">headers</span>&nbsp;<span class="keyword" id="6092710">map</span><span class="op" id="6092713">[</span><span class="builtintype" id="6092714">string</span><span class="op" id="6092720">]</span><span class="builtintype" id="6092721">string</span><span class="op" id="6092727">)</span>&nbsp;<span class="builtintype" id="6092729">error</span>&nbsp;<span class="op" id="6092735">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092738">for</span>&nbsp;<span class="ident" id="6092742">k</span><span class="op" id="6092743">,</span>&nbsp;<span class="ident" id="6092745">v</span>&nbsp;<span class="op" id="6092747">:=</span>&nbsp;<span class="keyword" id="6092750">range</span>&nbsp;<span class="ident" id="6092756">headers</span>&nbsp;<span class="op" id="6092764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092768">switch</span>&nbsp;<span class="ident" id="6092775">k</span>&nbsp;<span class="op" id="6092777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092781">case</span>&nbsp;<span class="ident" id="6092786">paxPath</span><span class="op" id="6092793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092798">hdr</span><span class="op" id="6092801">.</span><span class="ident" id="6092802">Name</span>&nbsp;<span class="op" id="6092807">=</span>&nbsp;<span class="ident" id="6092809">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092813">case</span>&nbsp;<span class="ident" id="6092818">paxLinkpath</span><span class="op" id="6092829">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092834">hdr</span><span class="op" id="6092837">.</span><span class="ident" id="6092838">Linkname</span>&nbsp;<span class="op" id="6092847">=</span>&nbsp;<span class="ident" id="6092849">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092853">case</span>&nbsp;<span class="ident" id="6092858">paxGname</span><span class="op" id="6092866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092871">hdr</span><span class="op" id="6092874">.</span><span class="ident" id="6092875">Gname</span>&nbsp;<span class="op" id="6092881">=</span>&nbsp;<span class="ident" id="6092883">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092887">case</span>&nbsp;<span class="ident" id="6092892">paxUname</span><span class="op" id="6092900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092905">hdr</span><span class="op" id="6092908">.</span><span class="ident" id="6092909">Uname</span>&nbsp;<span class="op" id="6092915">=</span>&nbsp;<span class="ident" id="6092917">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092921">case</span>&nbsp;<span class="ident" id="6092926">paxUid</span><span class="op" id="6092932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092937">uid</span><span class="op" id="6092940">,</span>&nbsp;<span class="ident" id="6092942">err</span>&nbsp;<span class="op" id="6092946">:=</span>&nbsp;<span class="ident" id="6092949">strconv</span><span class="op" id="6092956">.</span><span class="ident" id="6092957">ParseInt</span><span class="op" id="6092965">(</span><span class="ident" id="6092966">v</span><span class="op" id="6092967">,</span>&nbsp;<span class="num" id="6092969">10</span><span class="op" id="6092971">,</span>&nbsp;<span class="num" id="6092973">0</span><span class="op" id="6092974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092979">if</span>&nbsp;<span class="ident" id="6092982">err</span>&nbsp;<span class="op" id="6092986">!=</span>&nbsp;<span class="ident" id="6092989">nil</span>&nbsp;<span class="op" id="6092993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092999">return</span>&nbsp;<span class="ident" id="6093006">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093013">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093018">hdr</span><span class="op" id="6093021">.</span><span class="ident" id="6093022">Uid</span>&nbsp;<span class="op" id="6093026">=</span>&nbsp;<span class="builtintype" id="6093028">int</span><span class="op" id="6093031">(</span><span class="ident" id="6093032">uid</span><span class="op" id="6093035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093039">case</span>&nbsp;<span class="ident" id="6093044">paxGid</span><span class="op" id="6093050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093055">gid</span><span class="op" id="6093058">,</span>&nbsp;<span class="ident" id="6093060">err</span>&nbsp;<span class="op" id="6093064">:=</span>&nbsp;<span class="ident" id="6093067">strconv</span><span class="op" id="6093074">.</span><span class="ident" id="6093075">ParseInt</span><span class="op" id="6093083">(</span><span class="ident" id="6093084">v</span><span class="op" id="6093085">,</span>&nbsp;<span class="num" id="6093087">10</span><span class="op" id="6093089">,</span>&nbsp;<span class="num" id="6093091">0</span><span class="op" id="6093092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093097">if</span>&nbsp;<span class="ident" id="6093100">err</span>&nbsp;<span class="op" id="6093104">!=</span>&nbsp;<span class="ident" id="6093107">nil</span>&nbsp;<span class="op" id="6093111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093117">return</span>&nbsp;<span class="ident" id="6093124">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093136">hdr</span><span class="op" id="6093139">.</span><span class="ident" id="6093140">Gid</span>&nbsp;<span class="op" id="6093144">=</span>&nbsp;<span class="builtintype" id="6093146">int</span><span class="op" id="6093149">(</span><span class="ident" id="6093150">gid</span><span class="op" id="6093153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093157">case</span>&nbsp;<span class="ident" id="6093162">paxAtime</span><span class="op" id="6093170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093175">t</span><span class="op" id="6093176">,</span>&nbsp;<span class="ident" id="6093178">err</span>&nbsp;<span class="op" id="6093182">:=</span>&nbsp;<span class="ident" id="6093185">parsePAXTime</span><span class="op" id="6093197">(</span><span class="ident" id="6093198">v</span><span class="op" id="6093199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093204">if</span>&nbsp;<span class="ident" id="6093207">err</span>&nbsp;<span class="op" id="6093211">!=</span>&nbsp;<span class="ident" id="6093214">nil</span>&nbsp;<span class="op" id="6093218">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093224">return</span>&nbsp;<span class="ident" id="6093231">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093243">hdr</span><span class="op" id="6093246">.</span><span class="ident" id="6093247">AccessTime</span>&nbsp;<span class="op" id="6093258">=</span>&nbsp;<span class="ident" id="6093260">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093264">case</span>&nbsp;<span class="ident" id="6093269">paxMtime</span><span class="op" id="6093277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093282">t</span><span class="op" id="6093283">,</span>&nbsp;<span class="ident" id="6093285">err</span>&nbsp;<span class="op" id="6093289">:=</span>&nbsp;<span class="ident" id="6093292">parsePAXTime</span><span class="op" id="6093304">(</span><span class="ident" id="6093305">v</span><span class="op" id="6093306">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093311">if</span>&nbsp;<span class="ident" id="6093314">err</span>&nbsp;<span class="op" id="6093318">!=</span>&nbsp;<span class="ident" id="6093321">nil</span>&nbsp;<span class="op" id="6093325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093331">return</span>&nbsp;<span class="ident" id="6093338">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093350">hdr</span><span class="op" id="6093353">.</span><span class="ident" id="6093354">ModTime</span>&nbsp;<span class="op" id="6093362">=</span>&nbsp;<span class="ident" id="6093364">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093368">case</span>&nbsp;<span class="ident" id="6093373">paxCtime</span><span class="op" id="6093381">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093386">t</span><span class="op" id="6093387">,</span>&nbsp;<span class="ident" id="6093389">err</span>&nbsp;<span class="op" id="6093393">:=</span>&nbsp;<span class="ident" id="6093396">parsePAXTime</span><span class="op" id="6093408">(</span><span class="ident" id="6093409">v</span><span class="op" id="6093410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093415">if</span>&nbsp;<span class="ident" id="6093418">err</span>&nbsp;<span class="op" id="6093422">!=</span>&nbsp;<span class="ident" id="6093425">nil</span>&nbsp;<span class="op" id="6093429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093435">return</span>&nbsp;<span class="ident" id="6093442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093454">hdr</span><span class="op" id="6093457">.</span><span class="ident" id="6093458">ChangeTime</span>&nbsp;<span class="op" id="6093469">=</span>&nbsp;<span class="ident" id="6093471">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093475">case</span>&nbsp;<span class="ident" id="6093480">paxSize</span><span class="op" id="6093487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093492">size</span><span class="op" id="6093496">,</span>&nbsp;<span class="ident" id="6093498">err</span>&nbsp;<span class="op" id="6093502">:=</span>&nbsp;<span class="ident" id="6093505">strconv</span><span class="op" id="6093512">.</span><span class="ident" id="6093513">ParseInt</span><span class="op" id="6093521">(</span><span class="ident" id="6093522">v</span><span class="op" id="6093523">,</span>&nbsp;<span class="num" id="6093525">10</span><span class="op" id="6093527">,</span>&nbsp;<span class="num" id="6093529">0</span><span class="op" id="6093530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093535">if</span>&nbsp;<span class="ident" id="6093538">err</span>&nbsp;<span class="op" id="6093542">!=</span>&nbsp;<span class="ident" id="6093545">nil</span>&nbsp;<span class="op" id="6093549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093555">return</span>&nbsp;<span class="ident" id="6093562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093569">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093574">hdr</span><span class="op" id="6093577">.</span><span class="ident" id="6093578">Size</span>&nbsp;<span class="op" id="6093583">=</span>&nbsp;<span class="ident" id="6093585">int64</span><span class="op" id="6093590">(</span><span class="ident" id="6093591">size</span><span class="op" id="6093595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093599">default</span><span class="op" id="6093606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093611">if</span>&nbsp;<span class="ident" id="6093614">strings</span><span class="op" id="6093621">.</span><span class="ident" id="6093622">HasPrefix</span><span class="op" id="6093631">(</span><span class="ident" id="6093632">k</span><span class="op" id="6093633">,</span>&nbsp;<span class="ident" id="6093635">paxXattr</span><span class="op" id="6093643">)</span>&nbsp;<span class="op" id="6093645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093651">if</span>&nbsp;<span class="ident" id="6093654">hdr</span><span class="op" id="6093657">.</span><span class="ident" id="6093658">Xattrs</span>&nbsp;<span class="op" id="6093665">==</span>&nbsp;<span class="ident" id="6093668">nil</span>&nbsp;<span class="op" id="6093672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093679">hdr</span><span class="op" id="6093682">.</span><span class="ident" id="6093683">Xattrs</span>&nbsp;<span class="op" id="6093690">=</span>&nbsp;<span class="builtinfunc" id="6093692">make</span><span class="op" id="6093696">(</span><span class="keyword" id="6093697">map</span><span class="op" id="6093700">[</span><span class="builtintype" id="6093701">string</span><span class="op" id="6093707">]</span><span class="builtintype" id="6093708">string</span><span class="op" id="6093714">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093726">hdr</span><span class="op" id="6093729">.</span><span class="ident" id="6093730">Xattrs</span><span class="op" id="6093736">[</span><span class="ident" id="6093737">k</span><span class="op" id="6093738">[</span><span class="builtinfunc" id="6093739">len</span><span class="op" id="6093742">(</span><span class="ident" id="6093743">paxXattr</span><span class="op" id="6093751">)</span><span class="op" id="6093752">:</span><span class="op" id="6093753">]</span><span class="op" id="6093754">]</span>&nbsp;<span class="op" id="6093756">=</span>&nbsp;<span class="ident" id="6093758">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093770">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093773">return</span>&nbsp;<span class="ident" id="6093780">nil</span><br>
<span class="lineno"></span><span class="op" id="6093784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6093787">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6093852">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="6093878">func</span>&nbsp;<span class="ident" id="6093883">parsePAXTime</span><span class="op" id="6093895">(</span><span class="ident" id="6093896">t</span>&nbsp;<span class="builtintype" id="6093898">string</span><span class="op" id="6093904">)</span>&nbsp;<span class="op" id="6093906">(</span><span class="ident" id="6093907">time</span><span class="op" id="6093911">.</span><span class="ident" id="6093912">Time</span><span class="op" id="6093916">,</span>&nbsp;<span class="builtintype" id="6093918">error</span><span class="op" id="6093923">)</span>&nbsp;<span class="op" id="6093925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093928">buf</span>&nbsp;<span class="op" id="6093932">:=</span>&nbsp;<span class="op" id="6093935">[</span><span class="op" id="6093936">]</span><span class="builtintype" id="6093937">byte</span><span class="op" id="6093941">(</span><span class="ident" id="6093942">t</span><span class="op" id="6093943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093946">pos</span>&nbsp;<span class="op" id="6093950">:=</span>&nbsp;<span class="ident" id="6093953">bytes</span><span class="op" id="6093958">.</span><span class="ident" id="6093959">IndexByte</span><span class="op" id="6093968">(</span><span class="ident" id="6093969">buf</span><span class="op" id="6093972">,</span>&nbsp;<span class="string" id="6093974">&#39;.&#39;</span><span class="op" id="6093977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093980">var</span>&nbsp;<span class="ident" id="6093984">seconds</span><span class="op" id="6093991">,</span>&nbsp;<span class="ident" id="6093993">nanoseconds</span>&nbsp;<span class="ident" id="6094005">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094012">var</span>&nbsp;<span class="ident" id="6094016">err</span>&nbsp;<span class="builtintype" id="6094020">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094027">if</span>&nbsp;<span class="ident" id="6094030">pos</span>&nbsp;<span class="op" id="6094034">==</span>&nbsp;<span class="op" id="6094037">-</span><span class="num" id="6094038">1</span>&nbsp;<span class="op" id="6094040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094044">seconds</span><span class="op" id="6094051">,</span>&nbsp;<span class="ident" id="6094053">err</span>&nbsp;<span class="op" id="6094057">=</span>&nbsp;<span class="ident" id="6094059">strconv</span><span class="op" id="6094066">.</span><span class="ident" id="6094067">ParseInt</span><span class="op" id="6094075">(</span><span class="ident" id="6094076">t</span><span class="op" id="6094077">,</span>&nbsp;<span class="num" id="6094079">10</span><span class="op" id="6094081">,</span>&nbsp;<span class="num" id="6094083">0</span><span class="op" id="6094084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094088">if</span>&nbsp;<span class="ident" id="6094091">err</span>&nbsp;<span class="op" id="6094095">!=</span>&nbsp;<span class="ident" id="6094098">nil</span>&nbsp;<span class="op" id="6094102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094107">return</span>&nbsp;<span class="ident" id="6094114">time</span><span class="op" id="6094118">.</span><span class="ident" id="6094119">Time</span><span class="op" id="6094123">{</span><span class="op" id="6094124">}</span><span class="op" id="6094125">,</span>&nbsp;<span class="ident" id="6094127">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094133">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094136">}</span>&nbsp;<span class="keyword" id="6094138">else</span>&nbsp;<span class="op" id="6094143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094147">seconds</span><span class="op" id="6094154">,</span>&nbsp;<span class="ident" id="6094156">err</span>&nbsp;<span class="op" id="6094160">=</span>&nbsp;<span class="ident" id="6094162">strconv</span><span class="op" id="6094169">.</span><span class="ident" id="6094170">ParseInt</span><span class="op" id="6094178">(</span><span class="builtintype" id="6094179">string</span><span class="op" id="6094185">(</span><span class="ident" id="6094186">buf</span><span class="op" id="6094189">[</span><span class="op" id="6094190">:</span><span class="ident" id="6094191">pos</span><span class="op" id="6094194">]</span><span class="op" id="6094195">)</span><span class="op" id="6094196">,</span>&nbsp;<span class="num" id="6094198">10</span><span class="op" id="6094200">,</span>&nbsp;<span class="num" id="6094202">0</span><span class="op" id="6094203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094207">if</span>&nbsp;<span class="ident" id="6094210">err</span>&nbsp;<span class="op" id="6094214">!=</span>&nbsp;<span class="ident" id="6094217">nil</span>&nbsp;<span class="op" id="6094221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094226">return</span>&nbsp;<span class="ident" id="6094233">time</span><span class="op" id="6094237">.</span><span class="ident" id="6094238">Time</span><span class="op" id="6094242">{</span><span class="op" id="6094243">}</span><span class="op" id="6094244">,</span>&nbsp;<span class="ident" id="6094246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094252">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094256">nano_buf</span>&nbsp;<span class="op" id="6094265">:=</span>&nbsp;<span class="builtintype" id="6094268">string</span><span class="op" id="6094274">(</span><span class="ident" id="6094275">buf</span><span class="op" id="6094278">[</span><span class="ident" id="6094279">pos</span><span class="op" id="6094282">+</span><span class="num" id="6094283">1</span><span class="op" id="6094284">:</span><span class="op" id="6094285">]</span><span class="op" id="6094286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6094290">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6094341">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094401">if</span>&nbsp;<span class="builtinfunc" id="6094404">len</span><span class="op" id="6094407">(</span><span class="ident" id="6094408">nano_buf</span><span class="op" id="6094416">)</span>&nbsp;<span class="op" id="6094418">&lt;</span>&nbsp;<span class="ident" id="6094420">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6094441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6094446">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094462">nano_buf</span>&nbsp;<span class="op" id="6094471">+=</span>&nbsp;<span class="ident" id="6094474">strings</span><span class="op" id="6094481">.</span><span class="ident" id="6094482">Repeat</span><span class="op" id="6094488">(</span><span class="string" id="6094489">&#34;0&#34;</span><span class="op" id="6094492">,</span>&nbsp;<span class="ident" id="6094494">maxNanoSecondIntSize</span><span class="op" id="6094514">-</span><span class="builtinfunc" id="6094515">len</span><span class="op" id="6094518">(</span><span class="ident" id="6094519">nano_buf</span><span class="op" id="6094527">)</span><span class="op" id="6094528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094532">}</span>&nbsp;<span class="keyword" id="6094534">else</span>&nbsp;<span class="keyword" id="6094539">if</span>&nbsp;<span class="builtinfunc" id="6094542">len</span><span class="op" id="6094545">(</span><span class="ident" id="6094546">nano_buf</span><span class="op" id="6094554">)</span>&nbsp;<span class="op" id="6094556">&gt;</span>&nbsp;<span class="ident" id="6094558">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6094579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6094584">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094605">nano_buf</span>&nbsp;<span class="op" id="6094614">=</span>&nbsp;<span class="ident" id="6094616">nano_buf</span><span class="op" id="6094624">[</span><span class="op" id="6094625">:</span><span class="ident" id="6094626">maxNanoSecondIntSize</span><span class="op" id="6094646">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094650">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094654">nanoseconds</span><span class="op" id="6094665">,</span>&nbsp;<span class="ident" id="6094667">err</span>&nbsp;<span class="op" id="6094671">=</span>&nbsp;<span class="ident" id="6094673">strconv</span><span class="op" id="6094680">.</span><span class="ident" id="6094681">ParseInt</span><span class="op" id="6094689">(</span><span class="builtintype" id="6094690">string</span><span class="op" id="6094696">(</span><span class="ident" id="6094697">nano_buf</span><span class="op" id="6094705">)</span><span class="op" id="6094706">,</span>&nbsp;<span class="num" id="6094708">10</span><span class="op" id="6094710">,</span>&nbsp;<span class="num" id="6094712">0</span><span class="op" id="6094713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094717">if</span>&nbsp;<span class="ident" id="6094720">err</span>&nbsp;<span class="op" id="6094724">!=</span>&nbsp;<span class="ident" id="6094727">nil</span>&nbsp;<span class="op" id="6094731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094736">return</span>&nbsp;<span class="ident" id="6094743">time</span><span class="op" id="6094747">.</span><span class="ident" id="6094748">Time</span><span class="op" id="6094752">{</span><span class="op" id="6094753">}</span><span class="op" id="6094754">,</span>&nbsp;<span class="ident" id="6094756">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094765">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094768">ts</span>&nbsp;<span class="op" id="6094771">:=</span>&nbsp;<span class="ident" id="6094774">time</span><span class="op" id="6094778">.</span><span class="ident" id="6094779">Unix</span><span class="op" id="6094783">(</span><span class="ident" id="6094784">seconds</span><span class="op" id="6094791">,</span>&nbsp;<span class="ident" id="6094793">nanoseconds</span><span class="op" id="6094804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094807">return</span>&nbsp;<span class="ident" id="6094814">ts</span><span class="op" id="6094816">,</span>&nbsp;<span class="ident" id="6094818">nil</span><br>
<span class="lineno"></span><span class="op" id="6094822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094825">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="6094857">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="6094927">func</span>&nbsp;<span class="ident" id="6094932">parsePAX</span><span class="op" id="6094940">(</span><span class="ident" id="6094941">r</span>&nbsp;<span class="ident" id="6094943">io</span><span class="op" id="6094945">.</span><span class="ident" id="6094946">Reader</span><span class="op" id="6094952">)</span>&nbsp;<span class="op" id="6094954">(</span><span class="keyword" id="6094955">map</span><span class="op" id="6094958">[</span><span class="builtintype" id="6094959">string</span><span class="op" id="6094965">]</span><span class="builtintype" id="6094966">string</span><span class="op" id="6094972">,</span>&nbsp;<span class="builtintype" id="6094974">error</span><span class="op" id="6094979">)</span>&nbsp;<span class="op" id="6094981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094984">buf</span><span class="op" id="6094987">,</span>&nbsp;<span class="ident" id="6094989">err</span>&nbsp;<span class="op" id="6094993">:=</span>&nbsp;<span class="ident" id="6094996">ioutil</span><span class="op" id="6095002">.</span><span class="ident" id="6095003">ReadAll</span><span class="op" id="6095010">(</span><span class="ident" id="6095011">r</span><span class="op" id="6095012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095015">if</span>&nbsp;<span class="ident" id="6095018">err</span>&nbsp;<span class="op" id="6095022">!=</span>&nbsp;<span class="ident" id="6095025">nil</span>&nbsp;<span class="op" id="6095029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095033">return</span>&nbsp;<span class="ident" id="6095040">nil</span><span class="op" id="6095043">,</span>&nbsp;<span class="ident" id="6095045">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095054">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095097">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095188">var</span>&nbsp;<span class="ident" id="6095192">sparseMap</span>&nbsp;<span class="ident" id="6095202">bytes</span><span class="op" id="6095207">.</span><span class="ident" id="6095208">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095217">headers</span>&nbsp;<span class="op" id="6095225">:=</span>&nbsp;<span class="builtinfunc" id="6095228">make</span><span class="op" id="6095232">(</span><span class="keyword" id="6095233">map</span><span class="op" id="6095236">[</span><span class="builtintype" id="6095237">string</span><span class="op" id="6095243">]</span><span class="builtintype" id="6095244">string</span><span class="op" id="6095250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095253">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095287">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095332">for</span>&nbsp;<span class="builtinfunc" id="6095336">len</span><span class="op" id="6095339">(</span><span class="ident" id="6095340">buf</span><span class="op" id="6095343">)</span>&nbsp;<span class="op" id="6095345">&gt;</span>&nbsp;<span class="num" id="6095347">0</span>&nbsp;<span class="op" id="6095349">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095353">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095397">var</span>&nbsp;<span class="ident" id="6095401">sp</span>&nbsp;<span class="builtintype" id="6095404">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095410">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095455">sp</span>&nbsp;<span class="op" id="6095458">=</span>&nbsp;<span class="ident" id="6095460">bytes</span><span class="op" id="6095465">.</span><span class="ident" id="6095466">IndexByte</span><span class="op" id="6095475">(</span><span class="ident" id="6095476">buf</span><span class="op" id="6095479">,</span>&nbsp;<span class="string" id="6095481">&#39;&nbsp;&#39;</span><span class="op" id="6095484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095488">if</span>&nbsp;<span class="ident" id="6095491">sp</span>&nbsp;<span class="op" id="6095494">==</span>&nbsp;<span class="op" id="6095497">-</span><span class="num" id="6095498">1</span>&nbsp;<span class="op" id="6095500">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095505">return</span>&nbsp;<span class="ident" id="6095512">nil</span><span class="op" id="6095515">,</span>&nbsp;<span class="ident" id="6095517">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095533">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095582">n</span><span class="op" id="6095583">,</span>&nbsp;<span class="ident" id="6095585">err</span>&nbsp;<span class="op" id="6095589">:=</span>&nbsp;<span class="ident" id="6095592">strconv</span><span class="op" id="6095599">.</span><span class="ident" id="6095600">ParseInt</span><span class="op" id="6095608">(</span><span class="builtintype" id="6095609">string</span><span class="op" id="6095615">(</span><span class="ident" id="6095616">buf</span><span class="op" id="6095619">[</span><span class="op" id="6095620">:</span><span class="ident" id="6095621">sp</span><span class="op" id="6095623">]</span><span class="op" id="6095624">)</span><span class="op" id="6095625">,</span>&nbsp;<span class="num" id="6095627">10</span><span class="op" id="6095629">,</span>&nbsp;<span class="num" id="6095631">0</span><span class="op" id="6095632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095636">if</span>&nbsp;<span class="ident" id="6095639">err</span>&nbsp;<span class="op" id="6095643">!=</span>&nbsp;<span class="ident" id="6095646">nil</span>&nbsp;<span class="op" id="6095650">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095655">return</span>&nbsp;<span class="ident" id="6095662">nil</span><span class="op" id="6095665">,</span>&nbsp;<span class="ident" id="6095667">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095683">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095747">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095813">var</span>&nbsp;<span class="ident" id="6095817">record</span>&nbsp;<span class="op" id="6095824">[</span><span class="op" id="6095825">]</span><span class="builtintype" id="6095826">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095833">record</span><span class="op" id="6095839">,</span>&nbsp;<span class="ident" id="6095841">buf</span>&nbsp;<span class="op" id="6095845">=</span>&nbsp;<span class="ident" id="6095847">buf</span><span class="op" id="6095850">[</span><span class="ident" id="6095851">sp</span><span class="op" id="6095853">+</span><span class="num" id="6095854">1</span><span class="op" id="6095855">:</span><span class="ident" id="6095856">n</span><span class="op" id="6095857">-</span><span class="num" id="6095858">1</span><span class="op" id="6095859">]</span><span class="op" id="6095860">,</span>&nbsp;<span class="ident" id="6095862">buf</span><span class="op" id="6095865">[</span><span class="ident" id="6095866">n</span><span class="op" id="6095867">:</span><span class="op" id="6095868">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095872">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6095936">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095967">eq</span>&nbsp;<span class="op" id="6095970">:=</span>&nbsp;<span class="ident" id="6095973">bytes</span><span class="op" id="6095978">.</span><span class="ident" id="6095979">IndexByte</span><span class="op" id="6095988">(</span><span class="ident" id="6095989">record</span><span class="op" id="6095995">,</span>&nbsp;<span class="string" id="6095997">&#39;=&#39;</span><span class="op" id="6096000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096004">if</span>&nbsp;<span class="ident" id="6096007">eq</span>&nbsp;<span class="op" id="6096010">==</span>&nbsp;<span class="op" id="6096013">-</span><span class="num" id="6096014">1</span>&nbsp;<span class="op" id="6096016">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096021">return</span>&nbsp;<span class="ident" id="6096028">nil</span><span class="op" id="6096031">,</span>&nbsp;<span class="ident" id="6096033">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096049">key</span><span class="op" id="6096052">,</span>&nbsp;<span class="ident" id="6096054">value</span>&nbsp;<span class="op" id="6096060">:=</span>&nbsp;<span class="ident" id="6096063">record</span><span class="op" id="6096069">[</span><span class="op" id="6096070">:</span><span class="ident" id="6096071">eq</span><span class="op" id="6096073">]</span><span class="op" id="6096074">,</span>&nbsp;<span class="ident" id="6096076">record</span><span class="op" id="6096082">[</span><span class="ident" id="6096083">eq</span><span class="op" id="6096085">+</span><span class="num" id="6096086">1</span><span class="op" id="6096087">:</span><span class="op" id="6096088">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096093">keyStr</span>&nbsp;<span class="op" id="6096100">:=</span>&nbsp;<span class="builtintype" id="6096103">string</span><span class="op" id="6096109">(</span><span class="ident" id="6096110">key</span><span class="op" id="6096113">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096117">if</span>&nbsp;<span class="ident" id="6096120">keyStr</span>&nbsp;<span class="op" id="6096127">==</span>&nbsp;<span class="ident" id="6096130">paxGNUSparseOffset</span>&nbsp;<span class="op" id="6096149">||</span>&nbsp;<span class="ident" id="6096152">keyStr</span>&nbsp;<span class="op" id="6096159">==</span>&nbsp;<span class="ident" id="6096162">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="6096183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6096188">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096282">sparseMap</span><span class="op" id="6096291">.</span><span class="ident" id="6096292">Write</span><span class="op" id="6096297">(</span><span class="ident" id="6096298">value</span><span class="op" id="6096303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096308">sparseMap</span><span class="op" id="6096317">.</span><span class="ident" id="6096318">Write</span><span class="op" id="6096323">(</span><span class="op" id="6096324">[</span><span class="op" id="6096325">]</span><span class="builtintype" id="6096326">byte</span><span class="op" id="6096330">{</span><span class="string" id="6096331">&#39;,&#39;</span><span class="op" id="6096334">}</span><span class="op" id="6096335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096339">}</span>&nbsp;<span class="keyword" id="6096341">else</span>&nbsp;<span class="op" id="6096346">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6096351">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096403">headers</span><span class="op" id="6096410">[</span><span class="ident" id="6096411">keyStr</span><span class="op" id="6096417">]</span>&nbsp;<span class="op" id="6096419">=</span>&nbsp;<span class="builtintype" id="6096421">string</span><span class="op" id="6096427">(</span><span class="ident" id="6096428">value</span><span class="op" id="6096433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096443">if</span>&nbsp;<span class="ident" id="6096446">sparseMap</span><span class="op" id="6096455">.</span><span class="ident" id="6096456">Len</span><span class="op" id="6096459">(</span><span class="op" id="6096460">)</span>&nbsp;<span class="op" id="6096462">!=</span>&nbsp;<span class="num" id="6096465">0</span>&nbsp;<span class="op" id="6096467">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6096471">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096533">sparseMap</span><span class="op" id="6096542">.</span><span class="ident" id="6096543">Truncate</span><span class="op" id="6096551">(</span><span class="ident" id="6096552">sparseMap</span><span class="op" id="6096561">.</span><span class="ident" id="6096562">Len</span><span class="op" id="6096565">(</span><span class="op" id="6096566">)</span>&nbsp;<span class="op" id="6096568">-</span>&nbsp;<span class="num" id="6096570">1</span><span class="op" id="6096571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096575">headers</span><span class="op" id="6096582">[</span><span class="ident" id="6096583">paxGNUSparseMap</span><span class="op" id="6096598">]</span>&nbsp;<span class="op" id="6096600">=</span>&nbsp;<span class="ident" id="6096602">sparseMap</span><span class="op" id="6096611">.</span><span class="ident" id="6096612">String</span><span class="op" id="6096618">(</span><span class="op" id="6096619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096625">return</span>&nbsp;<span class="ident" id="6096632">headers</span><span class="op" id="6096639">,</span>&nbsp;<span class="ident" id="6096641">nil</span><br>
<span class="lineno">365</span><span class="op" id="6096645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6096648">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="6096708">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="6096784">func</span>&nbsp;<span class="ident" id="6096789">cString</span><span class="op" id="6096796">(</span><span class="ident" id="6096797">b</span>&nbsp;<span class="op" id="6096799">[</span><span class="op" id="6096800">]</span><span class="builtintype" id="6096801">byte</span><span class="op" id="6096805">)</span>&nbsp;<span class="builtintype" id="6096807">string</span>&nbsp;<span class="op" id="6096814">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096817">n</span>&nbsp;<span class="op" id="6096819">:=</span>&nbsp;<span class="num" id="6096822">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096825">for</span>&nbsp;<span class="ident" id="6096829">n</span>&nbsp;<span class="op" id="6096831">&lt;</span>&nbsp;<span class="builtinfunc" id="6096833">len</span><span class="op" id="6096836">(</span><span class="ident" id="6096837">b</span><span class="op" id="6096838">)</span>&nbsp;<span class="op" id="6096840">&amp;&amp;</span>&nbsp;<span class="ident" id="6096843">b</span><span class="op" id="6096844">[</span><span class="ident" id="6096845">n</span><span class="op" id="6096846">]</span>&nbsp;<span class="op" id="6096848">!=</span>&nbsp;<span class="num" id="6096851">0</span>&nbsp;<span class="op" id="6096853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096857">n</span><span class="op" id="6096858">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096865">return</span>&nbsp;<span class="builtintype" id="6096872">string</span><span class="op" id="6096878">(</span><span class="ident" id="6096879">b</span><span class="op" id="6096880">[</span><span class="num" id="6096881">0</span><span class="op" id="6096882">:</span><span class="ident" id="6096883">n</span><span class="op" id="6096884">]</span><span class="op" id="6096885">)</span><br>
<span class="lineno">375</span><span class="op" id="6096887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6096890">func</span>&nbsp;<span class="op" id="6096895">(</span><span class="ident" id="6096896">tr</span>&nbsp;<span class="op" id="6096899">*</span><span class="ident" id="6096900">Reader</span><span class="op" id="6096906">)</span>&nbsp;<span class="ident" id="6096908">octal</span><span class="op" id="6096913">(</span><span class="ident" id="6096914">b</span>&nbsp;<span class="op" id="6096916">[</span><span class="op" id="6096917">]</span><span class="builtintype" id="6096918">byte</span><span class="op" id="6096922">)</span>&nbsp;<span class="ident" id="6096924">int64</span>&nbsp;<span class="op" id="6096930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6096933">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096968">if</span>&nbsp;<span class="builtinfunc" id="6096971">len</span><span class="op" id="6096974">(</span><span class="ident" id="6096975">b</span><span class="op" id="6096976">)</span>&nbsp;<span class="op" id="6096978">&gt;</span>&nbsp;<span class="num" id="6096980">0</span>&nbsp;<span class="op" id="6096982">&amp;&amp;</span>&nbsp;<span class="ident" id="6096985">b</span><span class="op" id="6096986">[</span><span class="num" id="6096987">0</span><span class="op" id="6096988">]</span><span class="op" id="6096989">&amp;</span><span class="num" id="6096990">0x80</span>&nbsp;<span class="op" id="6096995">!=</span>&nbsp;<span class="num" id="6096998">0</span>&nbsp;<span class="op" id="6097000">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097004">var</span>&nbsp;<span class="ident" id="6097008">x</span>&nbsp;<span class="ident" id="6097010">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097018">for</span>&nbsp;<span class="ident" id="6097022">i</span><span class="op" id="6097023">,</span>&nbsp;<span class="ident" id="6097025">c</span>&nbsp;<span class="op" id="6097027">:=</span>&nbsp;<span class="keyword" id="6097030">range</span>&nbsp;<span class="ident" id="6097036">b</span>&nbsp;<span class="op" id="6097038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097043">if</span>&nbsp;<span class="ident" id="6097046">i</span>&nbsp;<span class="op" id="6097048">==</span>&nbsp;<span class="num" id="6097051">0</span>&nbsp;<span class="op" id="6097053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097059">c</span>&nbsp;<span class="op" id="6097061">&amp;=</span>&nbsp;<span class="num" id="6097064">0x7f</span>&nbsp;<span class="comment" id="6097069">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097107">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097112">x</span>&nbsp;<span class="op" id="6097114">=</span>&nbsp;<span class="ident" id="6097116">x</span><span class="op" id="6097117">&lt;&lt;</span><span class="num" id="6097119">8</span>&nbsp;<span class="op" id="6097121">|</span>&nbsp;<span class="ident" id="6097123">int64</span><span class="op" id="6097128">(</span><span class="ident" id="6097129">c</span><span class="op" id="6097130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097138">return</span>&nbsp;<span class="ident" id="6097145">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6097152">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6097208">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6097265">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6097285">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6097342">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097355">b</span>&nbsp;<span class="op" id="6097357">=</span>&nbsp;<span class="ident" id="6097359">bytes</span><span class="op" id="6097364">.</span><span class="ident" id="6097365">Trim</span><span class="op" id="6097369">(</span><span class="ident" id="6097370">b</span><span class="op" id="6097371">,</span>&nbsp;<span class="string" id="6097373">&#34;&nbsp;\x00&#34;</span><span class="op" id="6097380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097384">if</span>&nbsp;<span class="builtinfunc" id="6097387">len</span><span class="op" id="6097390">(</span><span class="ident" id="6097391">b</span><span class="op" id="6097392">)</span>&nbsp;<span class="op" id="6097394">==</span>&nbsp;<span class="num" id="6097397">0</span>&nbsp;<span class="op" id="6097399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097403">return</span>&nbsp;<span class="num" id="6097410">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097413">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097416">x</span><span class="op" id="6097417">,</span>&nbsp;<span class="ident" id="6097419">err</span>&nbsp;<span class="op" id="6097423">:=</span>&nbsp;<span class="ident" id="6097426">strconv</span><span class="op" id="6097433">.</span><span class="ident" id="6097434">ParseUint</span><span class="op" id="6097443">(</span><span class="ident" id="6097444">cString</span><span class="op" id="6097451">(</span><span class="ident" id="6097452">b</span><span class="op" id="6097453">)</span><span class="op" id="6097454">,</span>&nbsp;<span class="num" id="6097456">8</span><span class="op" id="6097457">,</span>&nbsp;<span class="num" id="6097459">64</span><span class="op" id="6097461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097464">if</span>&nbsp;<span class="ident" id="6097467">err</span>&nbsp;<span class="op" id="6097471">!=</span>&nbsp;<span class="ident" id="6097474">nil</span>&nbsp;<span class="op" id="6097478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097482">tr</span><span class="op" id="6097484">.</span><span class="ident" id="6097485">err</span>&nbsp;<span class="op" id="6097489">=</span>&nbsp;<span class="ident" id="6097491">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097499">return</span>&nbsp;<span class="ident" id="6097506">int64</span><span class="op" id="6097511">(</span><span class="ident" id="6097512">x</span><span class="op" id="6097513">)</span><br>
<span class="lineno">405</span><span class="op" id="6097515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6097518">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="6097617">func</span>&nbsp;<span class="op" id="6097622">(</span><span class="ident" id="6097623">tr</span>&nbsp;<span class="op" id="6097626">*</span><span class="ident" id="6097627">Reader</span><span class="op" id="6097633">)</span>&nbsp;<span class="ident" id="6097635">skipUnread</span><span class="op" id="6097645">(</span><span class="op" id="6097646">)</span>&nbsp;<span class="op" id="6097648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097651">nr</span>&nbsp;<span class="op" id="6097654">:=</span>&nbsp;<span class="ident" id="6097657">tr</span><span class="op" id="6097659">.</span><span class="ident" id="6097660">numBytes</span><span class="op" id="6097668">(</span><span class="op" id="6097669">)</span>&nbsp;<span class="op" id="6097671">+</span>&nbsp;<span class="ident" id="6097673">tr</span><span class="op" id="6097675">.</span><span class="ident" id="6097676">pad</span>&nbsp;<span class="comment" id="6097680">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097708">tr</span><span class="op" id="6097710">.</span><span class="ident" id="6097711">curr</span><span class="op" id="6097715">,</span>&nbsp;<span class="ident" id="6097717">tr</span><span class="op" id="6097719">.</span><span class="ident" id="6097720">pad</span>&nbsp;<span class="op" id="6097724">=</span>&nbsp;<span class="ident" id="6097726">nil</span><span class="op" id="6097729">,</span>&nbsp;<span class="num" id="6097731">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097734">if</span>&nbsp;<span class="ident" id="6097737">sr</span><span class="op" id="6097739">,</span>&nbsp;<span class="ident" id="6097741">ok</span>&nbsp;<span class="op" id="6097744">:=</span>&nbsp;<span class="ident" id="6097747">tr</span><span class="op" id="6097749">.</span><span class="ident" id="6097750">r</span><span class="op" id="6097751">.</span><span class="op" id="6097752">(</span><span class="ident" id="6097753">io</span><span class="op" id="6097755">.</span><span class="ident" id="6097756">Seeker</span><span class="op" id="6097762">)</span><span class="op" id="6097763">;</span>&nbsp;<span class="ident" id="6097765">ok</span>&nbsp;<span class="op" id="6097768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097772">if</span>&nbsp;<span class="ident" id="6097775">_</span><span class="op" id="6097776">,</span>&nbsp;<span class="ident" id="6097778">err</span>&nbsp;<span class="op" id="6097782">:=</span>&nbsp;<span class="ident" id="6097785">sr</span><span class="op" id="6097787">.</span><span class="ident" id="6097788">Seek</span><span class="op" id="6097792">(</span><span class="ident" id="6097793">nr</span><span class="op" id="6097795">,</span>&nbsp;<span class="ident" id="6097797">os</span><span class="op" id="6097799">.</span><span class="ident" id="6097800">SEEK_CUR</span><span class="op" id="6097808">)</span><span class="op" id="6097809">;</span>&nbsp;<span class="ident" id="6097811">err</span>&nbsp;<span class="op" id="6097815">==</span>&nbsp;<span class="ident" id="6097818">nil</span>&nbsp;<span class="op" id="6097822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097827">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097836">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097842">_</span><span class="op" id="6097843">,</span>&nbsp;<span class="ident" id="6097845">tr</span><span class="op" id="6097847">.</span><span class="ident" id="6097848">err</span>&nbsp;<span class="op" id="6097852">=</span>&nbsp;<span class="ident" id="6097854">io</span><span class="op" id="6097856">.</span><span class="ident" id="6097857">CopyN</span><span class="op" id="6097862">(</span><span class="ident" id="6097863">ioutil</span><span class="op" id="6097869">.</span><span class="ident" id="6097870">Discard</span><span class="op" id="6097877">,</span>&nbsp;<span class="ident" id="6097879">tr</span><span class="op" id="6097881">.</span><span class="ident" id="6097882">r</span><span class="op" id="6097883">,</span>&nbsp;<span class="ident" id="6097885">nr</span><span class="op" id="6097887">)</span><br>
<span class="lineno"></span><span class="op" id="6097889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6097892">func</span>&nbsp;<span class="op" id="6097897">(</span><span class="ident" id="6097898">tr</span>&nbsp;<span class="op" id="6097901">*</span><span class="ident" id="6097902">Reader</span><span class="op" id="6097908">)</span>&nbsp;<span class="ident" id="6097910">verifyChecksum</span><span class="op" id="6097924">(</span><span class="ident" id="6097925">header</span>&nbsp;<span class="op" id="6097932">[</span><span class="op" id="6097933">]</span><span class="builtintype" id="6097934">byte</span><span class="op" id="6097938">)</span>&nbsp;<span class="builtintype" id="6097940">bool</span>&nbsp;<span class="op" id="6097945">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097948">if</span>&nbsp;<span class="ident" id="6097951">tr</span><span class="op" id="6097953">.</span><span class="ident" id="6097954">err</span>&nbsp;<span class="op" id="6097958">!=</span>&nbsp;<span class="ident" id="6097961">nil</span>&nbsp;<span class="op" id="6097965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097969">return</span>&nbsp;<span class="builtintype" id="6097976">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097987">given</span>&nbsp;<span class="op" id="6097993">:=</span>&nbsp;<span class="ident" id="6097996">tr</span><span class="op" id="6097998">.</span><span class="ident" id="6097999">octal</span><span class="op" id="6098004">(</span><span class="ident" id="6098005">header</span><span class="op" id="6098011">[</span><span class="num" id="6098012">148</span><span class="op" id="6098015">:</span><span class="num" id="6098016">156</span><span class="op" id="6098019">]</span><span class="op" id="6098020">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098023">unsigned</span><span class="op" id="6098031">,</span>&nbsp;<span class="ident" id="6098033">signed</span>&nbsp;<span class="op" id="6098040">:=</span>&nbsp;<span class="ident" id="6098043">checksum</span><span class="op" id="6098051">(</span><span class="ident" id="6098052">header</span><span class="op" id="6098058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098061">return</span>&nbsp;<span class="ident" id="6098068">given</span>&nbsp;<span class="op" id="6098074">==</span>&nbsp;<span class="ident" id="6098077">unsigned</span>&nbsp;<span class="op" id="6098086">||</span>&nbsp;<span class="ident" id="6098089">given</span>&nbsp;<span class="op" id="6098095">==</span>&nbsp;<span class="ident" id="6098098">signed</span><br>
<span class="lineno"></span><span class="op" id="6098105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6098108">func</span>&nbsp;<span class="op" id="6098113">(</span><span class="ident" id="6098114">tr</span>&nbsp;<span class="op" id="6098117">*</span><span class="ident" id="6098118">Reader</span><span class="op" id="6098124">)</span>&nbsp;<span class="ident" id="6098126">readHeader</span><span class="op" id="6098136">(</span><span class="op" id="6098137">)</span>&nbsp;<span class="op" id="6098139">*</span><span class="ident" id="6098140">Header</span>&nbsp;<span class="op" id="6098147">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098150">header</span>&nbsp;<span class="op" id="6098157">:=</span>&nbsp;<span class="ident" id="6098160">tr</span><span class="op" id="6098162">.</span><span class="ident" id="6098163">hdrBuff</span><span class="op" id="6098170">[</span><span class="op" id="6098171">:</span><span class="op" id="6098172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6098175">copy</span><span class="op" id="6098179">(</span><span class="ident" id="6098180">header</span><span class="op" id="6098186">,</span>&nbsp;<span class="ident" id="6098188">zeroBlock</span><span class="op" id="6098197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098201">if</span>&nbsp;<span class="ident" id="6098204">_</span><span class="op" id="6098205">,</span>&nbsp;<span class="ident" id="6098207">tr</span><span class="op" id="6098209">.</span><span class="ident" id="6098210">err</span>&nbsp;<span class="op" id="6098214">=</span>&nbsp;<span class="ident" id="6098216">io</span><span class="op" id="6098218">.</span><span class="ident" id="6098219">ReadFull</span><span class="op" id="6098227">(</span><span class="ident" id="6098228">tr</span><span class="op" id="6098230">.</span><span class="ident" id="6098231">r</span><span class="op" id="6098232">,</span>&nbsp;<span class="ident" id="6098234">header</span><span class="op" id="6098240">)</span><span class="op" id="6098241">;</span>&nbsp;<span class="ident" id="6098243">tr</span><span class="op" id="6098245">.</span><span class="ident" id="6098246">err</span>&nbsp;<span class="op" id="6098250">!=</span>&nbsp;<span class="ident" id="6098253">nil</span>&nbsp;<span class="op" id="6098257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098261">return</span>&nbsp;<span class="ident" id="6098268">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6098277">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098336">if</span>&nbsp;<span class="ident" id="6098339">bytes</span><span class="op" id="6098344">.</span><span class="ident" id="6098345">Equal</span><span class="op" id="6098350">(</span><span class="ident" id="6098351">header</span><span class="op" id="6098357">,</span>&nbsp;<span class="ident" id="6098359">zeroBlock</span><span class="op" id="6098368">[</span><span class="num" id="6098369">0</span><span class="op" id="6098370">:</span><span class="ident" id="6098371">blockSize</span><span class="op" id="6098380">]</span><span class="op" id="6098381">)</span>&nbsp;<span class="op" id="6098383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098387">if</span>&nbsp;<span class="ident" id="6098390">_</span><span class="op" id="6098391">,</span>&nbsp;<span class="ident" id="6098393">tr</span><span class="op" id="6098395">.</span><span class="ident" id="6098396">err</span>&nbsp;<span class="op" id="6098400">=</span>&nbsp;<span class="ident" id="6098402">io</span><span class="op" id="6098404">.</span><span class="ident" id="6098405">ReadFull</span><span class="op" id="6098413">(</span><span class="ident" id="6098414">tr</span><span class="op" id="6098416">.</span><span class="ident" id="6098417">r</span><span class="op" id="6098418">,</span>&nbsp;<span class="ident" id="6098420">header</span><span class="op" id="6098426">)</span><span class="op" id="6098427">;</span>&nbsp;<span class="ident" id="6098429">tr</span><span class="op" id="6098431">.</span><span class="ident" id="6098432">err</span>&nbsp;<span class="op" id="6098436">!=</span>&nbsp;<span class="ident" id="6098439">nil</span>&nbsp;<span class="op" id="6098443">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098448">return</span>&nbsp;<span class="ident" id="6098455">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098465">if</span>&nbsp;<span class="ident" id="6098468">bytes</span><span class="op" id="6098473">.</span><span class="ident" id="6098474">Equal</span><span class="op" id="6098479">(</span><span class="ident" id="6098480">header</span><span class="op" id="6098486">,</span>&nbsp;<span class="ident" id="6098488">zeroBlock</span><span class="op" id="6098497">[</span><span class="num" id="6098498">0</span><span class="op" id="6098499">:</span><span class="ident" id="6098500">blockSize</span><span class="op" id="6098509">]</span><span class="op" id="6098510">)</span>&nbsp;<span class="op" id="6098512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098517">tr</span><span class="op" id="6098519">.</span><span class="ident" id="6098520">err</span>&nbsp;<span class="op" id="6098524">=</span>&nbsp;<span class="ident" id="6098526">io</span><span class="op" id="6098528">.</span><span class="ident" id="6098529">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098535">}</span>&nbsp;<span class="keyword" id="6098537">else</span>&nbsp;<span class="op" id="6098542">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098547">tr</span><span class="op" id="6098549">.</span><span class="ident" id="6098550">err</span>&nbsp;<span class="op" id="6098554">=</span>&nbsp;<span class="ident" id="6098556">ErrHeader</span>&nbsp;<span class="comment" id="6098566">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098610">return</span>&nbsp;<span class="ident" id="6098617">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098626">if</span>&nbsp;<span class="op" id="6098629">!</span><span class="ident" id="6098630">tr</span><span class="op" id="6098632">.</span><span class="ident" id="6098633">verifyChecksum</span><span class="op" id="6098647">(</span><span class="ident" id="6098648">header</span><span class="op" id="6098654">)</span>&nbsp;<span class="op" id="6098656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098660">tr</span><span class="op" id="6098662">.</span><span class="ident" id="6098663">err</span>&nbsp;<span class="op" id="6098667">=</span>&nbsp;<span class="ident" id="6098669">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098681">return</span>&nbsp;<span class="ident" id="6098688">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6098697">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098708">hdr</span>&nbsp;<span class="op" id="6098712">:=</span>&nbsp;<span class="builtinfunc" id="6098715">new</span><span class="op" id="6098718">(</span><span class="ident" id="6098719">Header</span><span class="op" id="6098725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098728">s</span>&nbsp;<span class="op" id="6098730">:=</span>&nbsp;<span class="ident" id="6098733">slicer</span><span class="op" id="6098739">(</span><span class="ident" id="6098740">header</span><span class="op" id="6098746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098750">hdr</span><span class="op" id="6098753">.</span><span class="ident" id="6098754">Name</span>&nbsp;<span class="op" id="6098759">=</span>&nbsp;<span class="ident" id="6098761">cString</span><span class="op" id="6098768">(</span><span class="ident" id="6098769">s</span><span class="op" id="6098770">.</span><span class="ident" id="6098771">next</span><span class="op" id="6098775">(</span><span class="num" id="6098776">100</span><span class="op" id="6098779">)</span><span class="op" id="6098780">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098783">hdr</span><span class="op" id="6098786">.</span><span class="ident" id="6098787">Mode</span>&nbsp;<span class="op" id="6098792">=</span>&nbsp;<span class="ident" id="6098794">tr</span><span class="op" id="6098796">.</span><span class="ident" id="6098797">octal</span><span class="op" id="6098802">(</span><span class="ident" id="6098803">s</span><span class="op" id="6098804">.</span><span class="ident" id="6098805">next</span><span class="op" id="6098809">(</span><span class="num" id="6098810">8</span><span class="op" id="6098811">)</span><span class="op" id="6098812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098815">hdr</span><span class="op" id="6098818">.</span><span class="ident" id="6098819">Uid</span>&nbsp;<span class="op" id="6098823">=</span>&nbsp;<span class="builtintype" id="6098825">int</span><span class="op" id="6098828">(</span><span class="ident" id="6098829">tr</span><span class="op" id="6098831">.</span><span class="ident" id="6098832">octal</span><span class="op" id="6098837">(</span><span class="ident" id="6098838">s</span><span class="op" id="6098839">.</span><span class="ident" id="6098840">next</span><span class="op" id="6098844">(</span><span class="num" id="6098845">8</span><span class="op" id="6098846">)</span><span class="op" id="6098847">)</span><span class="op" id="6098848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098851">hdr</span><span class="op" id="6098854">.</span><span class="ident" id="6098855">Gid</span>&nbsp;<span class="op" id="6098859">=</span>&nbsp;<span class="builtintype" id="6098861">int</span><span class="op" id="6098864">(</span><span class="ident" id="6098865">tr</span><span class="op" id="6098867">.</span><span class="ident" id="6098868">octal</span><span class="op" id="6098873">(</span><span class="ident" id="6098874">s</span><span class="op" id="6098875">.</span><span class="ident" id="6098876">next</span><span class="op" id="6098880">(</span><span class="num" id="6098881">8</span><span class="op" id="6098882">)</span><span class="op" id="6098883">)</span><span class="op" id="6098884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098887">hdr</span><span class="op" id="6098890">.</span><span class="ident" id="6098891">Size</span>&nbsp;<span class="op" id="6098896">=</span>&nbsp;<span class="ident" id="6098898">tr</span><span class="op" id="6098900">.</span><span class="ident" id="6098901">octal</span><span class="op" id="6098906">(</span><span class="ident" id="6098907">s</span><span class="op" id="6098908">.</span><span class="ident" id="6098909">next</span><span class="op" id="6098913">(</span><span class="num" id="6098914">12</span><span class="op" id="6098916">)</span><span class="op" id="6098917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098920">hdr</span><span class="op" id="6098923">.</span><span class="ident" id="6098924">ModTime</span>&nbsp;<span class="op" id="6098932">=</span>&nbsp;<span class="ident" id="6098934">time</span><span class="op" id="6098938">.</span><span class="ident" id="6098939">Unix</span><span class="op" id="6098943">(</span><span class="ident" id="6098944">tr</span><span class="op" id="6098946">.</span><span class="ident" id="6098947">octal</span><span class="op" id="6098952">(</span><span class="ident" id="6098953">s</span><span class="op" id="6098954">.</span><span class="ident" id="6098955">next</span><span class="op" id="6098959">(</span><span class="num" id="6098960">12</span><span class="op" id="6098962">)</span><span class="op" id="6098963">)</span><span class="op" id="6098964">,</span>&nbsp;<span class="num" id="6098966">0</span><span class="op" id="6098967">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098970">s</span><span class="op" id="6098971">.</span><span class="ident" id="6098972">next</span><span class="op" id="6098976">(</span><span class="num" id="6098977">8</span><span class="op" id="6098978">)</span>&nbsp;<span class="comment" id="6098980">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098991">hdr</span><span class="op" id="6098994">.</span><span class="ident" id="6098995">Typeflag</span>&nbsp;<span class="op" id="6099004">=</span>&nbsp;<span class="ident" id="6099006">s</span><span class="op" id="6099007">.</span><span class="ident" id="6099008">next</span><span class="op" id="6099012">(</span><span class="num" id="6099013">1</span><span class="op" id="6099014">)</span><span class="op" id="6099015">[</span><span class="num" id="6099016">0</span><span class="op" id="6099017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099020">hdr</span><span class="op" id="6099023">.</span><span class="ident" id="6099024">Linkname</span>&nbsp;<span class="op" id="6099033">=</span>&nbsp;<span class="ident" id="6099035">cString</span><span class="op" id="6099042">(</span><span class="ident" id="6099043">s</span><span class="op" id="6099044">.</span><span class="ident" id="6099045">next</span><span class="op" id="6099049">(</span><span class="num" id="6099050">100</span><span class="op" id="6099053">)</span><span class="op" id="6099054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6099058">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6099121">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6099187">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099249">magic</span>&nbsp;<span class="op" id="6099255">:=</span>&nbsp;<span class="builtintype" id="6099258">string</span><span class="op" id="6099264">(</span><span class="ident" id="6099265">s</span><span class="op" id="6099266">.</span><span class="ident" id="6099267">next</span><span class="op" id="6099271">(</span><span class="num" id="6099272">8</span><span class="op" id="6099273">)</span><span class="op" id="6099274">)</span>&nbsp;<span class="comment" id="6099276">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099312">var</span>&nbsp;<span class="ident" id="6099316">format</span>&nbsp;<span class="builtintype" id="6099323">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099331">switch</span>&nbsp;<span class="op" id="6099338">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099341">case</span>&nbsp;<span class="ident" id="6099346">magic</span><span class="op" id="6099351">[</span><span class="op" id="6099352">:</span><span class="num" id="6099353">6</span><span class="op" id="6099354">]</span>&nbsp;<span class="op" id="6099356">==</span>&nbsp;<span class="string" id="6099359">&#34;ustar\x00&#34;</span><span class="op" id="6099370">:</span>&nbsp;<span class="comment" id="6099372">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099401">if</span>&nbsp;<span class="builtintype" id="6099404">string</span><span class="op" id="6099410">(</span><span class="ident" id="6099411">header</span><span class="op" id="6099417">[</span><span class="num" id="6099418">508</span><span class="op" id="6099421">:</span><span class="num" id="6099422">512</span><span class="op" id="6099425">]</span><span class="op" id="6099426">)</span>&nbsp;<span class="op" id="6099428">==</span>&nbsp;<span class="string" id="6099431">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="6099441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099446">format</span>&nbsp;<span class="op" id="6099453">=</span>&nbsp;<span class="string" id="6099455">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099464">}</span>&nbsp;<span class="keyword" id="6099466">else</span>&nbsp;<span class="op" id="6099471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099476">format</span>&nbsp;<span class="op" id="6099483">=</span>&nbsp;<span class="string" id="6099485">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099498">case</span>&nbsp;<span class="ident" id="6099503">magic</span>&nbsp;<span class="op" id="6099509">==</span>&nbsp;<span class="string" id="6099512">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6099525">:</span>&nbsp;<span class="comment" id="6099527">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099544">format</span>&nbsp;<span class="op" id="6099551">=</span>&nbsp;<span class="string" id="6099553">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099564">switch</span>&nbsp;<span class="ident" id="6099571">format</span>&nbsp;<span class="op" id="6099578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099581">case</span>&nbsp;<span class="string" id="6099586">&#34;posix&#34;</span><span class="op" id="6099593">,</span>&nbsp;<span class="string" id="6099595">&#34;gnu&#34;</span><span class="op" id="6099600">,</span>&nbsp;<span class="string" id="6099602">&#34;star&#34;</span><span class="op" id="6099608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099612">hdr</span><span class="op" id="6099615">.</span><span class="ident" id="6099616">Uname</span>&nbsp;<span class="op" id="6099622">=</span>&nbsp;<span class="ident" id="6099624">cString</span><span class="op" id="6099631">(</span><span class="ident" id="6099632">s</span><span class="op" id="6099633">.</span><span class="ident" id="6099634">next</span><span class="op" id="6099638">(</span><span class="num" id="6099639">32</span><span class="op" id="6099641">)</span><span class="op" id="6099642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099646">hdr</span><span class="op" id="6099649">.</span><span class="ident" id="6099650">Gname</span>&nbsp;<span class="op" id="6099656">=</span>&nbsp;<span class="ident" id="6099658">cString</span><span class="op" id="6099665">(</span><span class="ident" id="6099666">s</span><span class="op" id="6099667">.</span><span class="ident" id="6099668">next</span><span class="op" id="6099672">(</span><span class="num" id="6099673">32</span><span class="op" id="6099675">)</span><span class="op" id="6099676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099680">devmajor</span>&nbsp;<span class="op" id="6099689">:=</span>&nbsp;<span class="ident" id="6099692">s</span><span class="op" id="6099693">.</span><span class="ident" id="6099694">next</span><span class="op" id="6099698">(</span><span class="num" id="6099699">8</span><span class="op" id="6099700">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099704">devminor</span>&nbsp;<span class="op" id="6099713">:=</span>&nbsp;<span class="ident" id="6099716">s</span><span class="op" id="6099717">.</span><span class="ident" id="6099718">next</span><span class="op" id="6099722">(</span><span class="num" id="6099723">8</span><span class="op" id="6099724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099728">if</span>&nbsp;<span class="ident" id="6099731">hdr</span><span class="op" id="6099734">.</span><span class="ident" id="6099735">Typeflag</span>&nbsp;<span class="op" id="6099744">==</span>&nbsp;<span class="ident" id="6099747">TypeChar</span>&nbsp;<span class="op" id="6099756">||</span>&nbsp;<span class="ident" id="6099759">hdr</span><span class="op" id="6099762">.</span><span class="ident" id="6099763">Typeflag</span>&nbsp;<span class="op" id="6099772">==</span>&nbsp;<span class="ident" id="6099775">TypeBlock</span>&nbsp;<span class="op" id="6099785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099790">hdr</span><span class="op" id="6099793">.</span><span class="ident" id="6099794">Devmajor</span>&nbsp;<span class="op" id="6099803">=</span>&nbsp;<span class="ident" id="6099805">tr</span><span class="op" id="6099807">.</span><span class="ident" id="6099808">octal</span><span class="op" id="6099813">(</span><span class="ident" id="6099814">devmajor</span><span class="op" id="6099822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099827">hdr</span><span class="op" id="6099830">.</span><span class="ident" id="6099831">Devminor</span>&nbsp;<span class="op" id="6099840">=</span>&nbsp;<span class="ident" id="6099842">tr</span><span class="op" id="6099844">.</span><span class="ident" id="6099845">octal</span><span class="op" id="6099850">(</span><span class="ident" id="6099851">devminor</span><span class="op" id="6099859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099863">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099867">var</span>&nbsp;<span class="ident" id="6099871">prefix</span>&nbsp;<span class="builtintype" id="6099878">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099887">switch</span>&nbsp;<span class="ident" id="6099894">format</span>&nbsp;<span class="op" id="6099901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099905">case</span>&nbsp;<span class="string" id="6099910">&#34;posix&#34;</span><span class="op" id="6099917">,</span>&nbsp;<span class="string" id="6099919">&#34;gnu&#34;</span><span class="op" id="6099924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099929">prefix</span>&nbsp;<span class="op" id="6099936">=</span>&nbsp;<span class="ident" id="6099938">cString</span><span class="op" id="6099945">(</span><span class="ident" id="6099946">s</span><span class="op" id="6099947">.</span><span class="ident" id="6099948">next</span><span class="op" id="6099952">(</span><span class="num" id="6099953">155</span><span class="op" id="6099956">)</span><span class="op" id="6099957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099961">case</span>&nbsp;<span class="string" id="6099966">&#34;star&#34;</span><span class="op" id="6099972">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099977">prefix</span>&nbsp;<span class="op" id="6099984">=</span>&nbsp;<span class="ident" id="6099986">cString</span><span class="op" id="6099993">(</span><span class="ident" id="6099994">s</span><span class="op" id="6099995">.</span><span class="ident" id="6099996">next</span><span class="op" id="6100000">(</span><span class="num" id="6100001">131</span><span class="op" id="6100004">)</span><span class="op" id="6100005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100010">hdr</span><span class="op" id="6100013">.</span><span class="ident" id="6100014">AccessTime</span>&nbsp;<span class="op" id="6100025">=</span>&nbsp;<span class="ident" id="6100027">time</span><span class="op" id="6100031">.</span><span class="ident" id="6100032">Unix</span><span class="op" id="6100036">(</span><span class="ident" id="6100037">tr</span><span class="op" id="6100039">.</span><span class="ident" id="6100040">octal</span><span class="op" id="6100045">(</span><span class="ident" id="6100046">s</span><span class="op" id="6100047">.</span><span class="ident" id="6100048">next</span><span class="op" id="6100052">(</span><span class="num" id="6100053">12</span><span class="op" id="6100055">)</span><span class="op" id="6100056">)</span><span class="op" id="6100057">,</span>&nbsp;<span class="num" id="6100059">0</span><span class="op" id="6100060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100065">hdr</span><span class="op" id="6100068">.</span><span class="ident" id="6100069">ChangeTime</span>&nbsp;<span class="op" id="6100080">=</span>&nbsp;<span class="ident" id="6100082">time</span><span class="op" id="6100086">.</span><span class="ident" id="6100087">Unix</span><span class="op" id="6100091">(</span><span class="ident" id="6100092">tr</span><span class="op" id="6100094">.</span><span class="ident" id="6100095">octal</span><span class="op" id="6100100">(</span><span class="ident" id="6100101">s</span><span class="op" id="6100102">.</span><span class="ident" id="6100103">next</span><span class="op" id="6100107">(</span><span class="num" id="6100108">12</span><span class="op" id="6100110">)</span><span class="op" id="6100111">)</span><span class="op" id="6100112">,</span>&nbsp;<span class="num" id="6100114">0</span><span class="op" id="6100115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100123">if</span>&nbsp;<span class="builtinfunc" id="6100126">len</span><span class="op" id="6100129">(</span><span class="ident" id="6100130">prefix</span><span class="op" id="6100136">)</span>&nbsp;<span class="op" id="6100138">&gt;</span>&nbsp;<span class="num" id="6100140">0</span>&nbsp;<span class="op" id="6100142">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100147">hdr</span><span class="op" id="6100150">.</span><span class="ident" id="6100151">Name</span>&nbsp;<span class="op" id="6100156">=</span>&nbsp;<span class="ident" id="6100158">prefix</span>&nbsp;<span class="op" id="6100165">+</span>&nbsp;<span class="string" id="6100167">&#34;/&#34;</span>&nbsp;<span class="op" id="6100171">+</span>&nbsp;<span class="ident" id="6100173">hdr</span><span class="op" id="6100176">.</span><span class="ident" id="6100177">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100191">if</span>&nbsp;<span class="ident" id="6100194">tr</span><span class="op" id="6100196">.</span><span class="ident" id="6100197">err</span>&nbsp;<span class="op" id="6100201">!=</span>&nbsp;<span class="ident" id="6100204">nil</span>&nbsp;<span class="op" id="6100208">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100212">tr</span><span class="op" id="6100214">.</span><span class="ident" id="6100215">err</span>&nbsp;<span class="op" id="6100219">=</span>&nbsp;<span class="ident" id="6100221">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100233">return</span>&nbsp;<span class="ident" id="6100240">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100249">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100307">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100352">nb</span>&nbsp;<span class="op" id="6100355">:=</span>&nbsp;<span class="ident" id="6100358">int64</span><span class="op" id="6100363">(</span><span class="ident" id="6100364">hdr</span><span class="op" id="6100367">.</span><span class="ident" id="6100368">Size</span><span class="op" id="6100372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100375">tr</span><span class="op" id="6100377">.</span><span class="ident" id="6100378">pad</span>&nbsp;<span class="op" id="6100382">=</span>&nbsp;<span class="op" id="6100384">-</span><span class="ident" id="6100385">nb</span>&nbsp;<span class="op" id="6100388">&amp;</span>&nbsp;<span class="op" id="6100390">(</span><span class="ident" id="6100391">blockSize</span>&nbsp;<span class="op" id="6100401">-</span>&nbsp;<span class="num" id="6100403">1</span><span class="op" id="6100404">)</span>&nbsp;<span class="comment" id="6100406">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100439">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100472">tr</span><span class="op" id="6100474">.</span><span class="ident" id="6100475">curr</span>&nbsp;<span class="op" id="6100480">=</span>&nbsp;<span class="op" id="6100482">&amp;</span><span class="ident" id="6100483">regFileReader</span><span class="op" id="6100496">{</span><span class="ident" id="6100497">r</span><span class="op" id="6100498">:</span>&nbsp;<span class="ident" id="6100500">tr</span><span class="op" id="6100502">.</span><span class="ident" id="6100503">r</span><span class="op" id="6100504">,</span>&nbsp;<span class="ident" id="6100506">nb</span><span class="op" id="6100508">:</span>&nbsp;<span class="ident" id="6100510">nb</span><span class="op" id="6100512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100516">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100559">if</span>&nbsp;<span class="ident" id="6100562">hdr</span><span class="op" id="6100565">.</span><span class="ident" id="6100566">Typeflag</span>&nbsp;<span class="op" id="6100575">==</span>&nbsp;<span class="ident" id="6100578">TypeGNUSparse</span>&nbsp;<span class="op" id="6100592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100596">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100632">hdr</span><span class="op" id="6100635">.</span><span class="ident" id="6100636">Size</span>&nbsp;<span class="op" id="6100641">=</span>&nbsp;<span class="ident" id="6100643">tr</span><span class="op" id="6100645">.</span><span class="ident" id="6100646">octal</span><span class="op" id="6100651">(</span><span class="ident" id="6100652">header</span><span class="op" id="6100658">[</span><span class="num" id="6100659">483</span><span class="op" id="6100662">:</span><span class="num" id="6100663">495</span><span class="op" id="6100666">]</span><span class="op" id="6100667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100672">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100698">sp</span>&nbsp;<span class="op" id="6100701">:=</span>&nbsp;<span class="ident" id="6100704">tr</span><span class="op" id="6100706">.</span><span class="ident" id="6100707">readOldGNUSparseMap</span><span class="op" id="6100726">(</span><span class="ident" id="6100727">header</span><span class="op" id="6100733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100737">if</span>&nbsp;<span class="ident" id="6100740">tr</span><span class="op" id="6100742">.</span><span class="ident" id="6100743">err</span>&nbsp;<span class="op" id="6100747">!=</span>&nbsp;<span class="ident" id="6100750">nil</span>&nbsp;<span class="op" id="6100754">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100759">return</span>&nbsp;<span class="ident" id="6100766">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6100776">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100848">tr</span><span class="op" id="6100850">.</span><span class="ident" id="6100851">curr</span>&nbsp;<span class="op" id="6100856">=</span>&nbsp;<span class="op" id="6100858">&amp;</span><span class="ident" id="6100859">sparseFileReader</span><span class="op" id="6100875">{</span><span class="ident" id="6100876">rfr</span><span class="op" id="6100879">:</span>&nbsp;<span class="ident" id="6100881">tr</span><span class="op" id="6100883">.</span><span class="ident" id="6100884">curr</span><span class="op" id="6100888">.</span><span class="op" id="6100889">(</span><span class="op" id="6100890">*</span><span class="ident" id="6100891">regFileReader</span><span class="op" id="6100904">)</span><span class="op" id="6100905">,</span>&nbsp;<span class="ident" id="6100907">sp</span><span class="op" id="6100909">:</span>&nbsp;<span class="ident" id="6100911">sp</span><span class="op" id="6100913">,</span>&nbsp;<span class="ident" id="6100915">tot</span><span class="op" id="6100918">:</span>&nbsp;<span class="ident" id="6100920">hdr</span><span class="op" id="6100923">.</span><span class="ident" id="6100924">Size</span><span class="op" id="6100928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100931">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100935">return</span>&nbsp;<span class="ident" id="6100942">hdr</span><br>
<span class="lineno"></span><span class="op" id="6100946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6100949">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="6101018">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6101088">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6101106">type</span>&nbsp;<span class="ident" id="6101111">sparseEntry</span>&nbsp;<span class="keyword" id="6101123">struct</span>&nbsp;<span class="op" id="6101130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101133">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6101142">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101149">numBytes</span>&nbsp;<span class="ident" id="6101158">int64</span><br>
<span class="lineno">545</span><span class="op" id="6101164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6101167">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6101251">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="6101353">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="6101437">func</span>&nbsp;<span class="op" id="6101442">(</span><span class="ident" id="6101443">tr</span>&nbsp;<span class="op" id="6101446">*</span><span class="ident" id="6101447">Reader</span><span class="op" id="6101453">)</span>&nbsp;<span class="ident" id="6101455">readOldGNUSparseMap</span><span class="op" id="6101474">(</span><span class="ident" id="6101475">header</span>&nbsp;<span class="op" id="6101482">[</span><span class="op" id="6101483">]</span><span class="builtintype" id="6101484">byte</span><span class="op" id="6101488">)</span>&nbsp;<span class="op" id="6101490">[</span><span class="op" id="6101491">]</span><span class="ident" id="6101492">sparseEntry</span>&nbsp;<span class="op" id="6101504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101507">isExtended</span>&nbsp;<span class="op" id="6101518">:=</span>&nbsp;<span class="ident" id="6101521">header</span><span class="op" id="6101527">[</span><span class="ident" id="6101528">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="6101566">]</span>&nbsp;<span class="op" id="6101568">!=</span>&nbsp;<span class="num" id="6101571">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101574">spCap</span>&nbsp;<span class="op" id="6101580">:=</span>&nbsp;<span class="ident" id="6101583">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101617">if</span>&nbsp;<span class="ident" id="6101620">isExtended</span>&nbsp;<span class="op" id="6101631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101635">spCap</span>&nbsp;<span class="op" id="6101641">+=</span>&nbsp;<span class="ident" id="6101644">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101685">sp</span>&nbsp;<span class="op" id="6101688">:=</span>&nbsp;<span class="builtinfunc" id="6101691">make</span><span class="op" id="6101695">(</span><span class="op" id="6101696">[</span><span class="op" id="6101697">]</span><span class="ident" id="6101698">sparseEntry</span><span class="op" id="6101709">,</span>&nbsp;<span class="num" id="6101711">0</span><span class="op" id="6101712">,</span>&nbsp;<span class="ident" id="6101714">spCap</span><span class="op" id="6101719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101722">s</span>&nbsp;<span class="op" id="6101724">:=</span>&nbsp;<span class="ident" id="6101727">slicer</span><span class="op" id="6101733">(</span><span class="ident" id="6101734">header</span><span class="op" id="6101740">[</span><span class="ident" id="6101741">oldGNUSparseMainHeaderOffset</span><span class="op" id="6101769">:</span><span class="op" id="6101770">]</span><span class="op" id="6101771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6101775">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101826">for</span>&nbsp;<span class="ident" id="6101830">i</span>&nbsp;<span class="op" id="6101832">:=</span>&nbsp;<span class="num" id="6101835">0</span><span class="op" id="6101836">;</span>&nbsp;<span class="ident" id="6101838">i</span>&nbsp;<span class="op" id="6101840">&lt;</span>&nbsp;<span class="ident" id="6101842">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="6101874">;</span>&nbsp;<span class="ident" id="6101876">i</span><span class="op" id="6101877">++</span>&nbsp;<span class="op" id="6101880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101884">offset</span>&nbsp;<span class="op" id="6101891">:=</span>&nbsp;<span class="ident" id="6101894">tr</span><span class="op" id="6101896">.</span><span class="ident" id="6101897">octal</span><span class="op" id="6101902">(</span><span class="ident" id="6101903">s</span><span class="op" id="6101904">.</span><span class="ident" id="6101905">next</span><span class="op" id="6101909">(</span><span class="ident" id="6101910">oldGNUSparseOffsetSize</span><span class="op" id="6101932">)</span><span class="op" id="6101933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101937">numBytes</span>&nbsp;<span class="op" id="6101946">:=</span>&nbsp;<span class="ident" id="6101949">tr</span><span class="op" id="6101951">.</span><span class="ident" id="6101952">octal</span><span class="op" id="6101957">(</span><span class="ident" id="6101958">s</span><span class="op" id="6101959">.</span><span class="ident" id="6101960">next</span><span class="op" id="6101964">(</span><span class="ident" id="6101965">oldGNUSparseNumBytesSize</span><span class="op" id="6101989">)</span><span class="op" id="6101990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101994">if</span>&nbsp;<span class="ident" id="6101997">tr</span><span class="op" id="6101999">.</span><span class="ident" id="6102000">err</span>&nbsp;<span class="op" id="6102004">!=</span>&nbsp;<span class="ident" id="6102007">nil</span>&nbsp;<span class="op" id="6102011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102016">tr</span><span class="op" id="6102018">.</span><span class="ident" id="6102019">err</span>&nbsp;<span class="op" id="6102023">=</span>&nbsp;<span class="ident" id="6102025">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102038">return</span>&nbsp;<span class="ident" id="6102045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102055">if</span>&nbsp;<span class="ident" id="6102058">offset</span>&nbsp;<span class="op" id="6102065">==</span>&nbsp;<span class="num" id="6102068">0</span>&nbsp;<span class="op" id="6102070">&amp;&amp;</span>&nbsp;<span class="ident" id="6102073">numBytes</span>&nbsp;<span class="op" id="6102082">==</span>&nbsp;<span class="num" id="6102085">0</span>&nbsp;<span class="op" id="6102087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102092">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102100">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102104">sp</span>&nbsp;<span class="op" id="6102107">=</span>&nbsp;<span class="builtinfunc" id="6102109">append</span><span class="op" id="6102115">(</span><span class="ident" id="6102116">sp</span><span class="op" id="6102118">,</span>&nbsp;<span class="ident" id="6102120">sparseEntry</span><span class="op" id="6102131">{</span><span class="ident" id="6102132">offset</span><span class="op" id="6102138">:</span>&nbsp;<span class="ident" id="6102140">offset</span><span class="op" id="6102146">,</span>&nbsp;<span class="ident" id="6102148">numBytes</span><span class="op" id="6102156">:</span>&nbsp;<span class="ident" id="6102158">numBytes</span><span class="op" id="6102166">}</span><span class="op" id="6102167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102174">for</span>&nbsp;<span class="ident" id="6102178">isExtended</span>&nbsp;<span class="op" id="6102189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6102193">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102270">sparseHeader</span>&nbsp;<span class="op" id="6102283">:=</span>&nbsp;<span class="builtinfunc" id="6102286">make</span><span class="op" id="6102290">(</span><span class="op" id="6102291">[</span><span class="op" id="6102292">]</span><span class="builtintype" id="6102293">byte</span><span class="op" id="6102297">,</span>&nbsp;<span class="ident" id="6102299">blockSize</span><span class="op" id="6102308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102312">if</span>&nbsp;<span class="ident" id="6102315">_</span><span class="op" id="6102316">,</span>&nbsp;<span class="ident" id="6102318">tr</span><span class="op" id="6102320">.</span><span class="ident" id="6102321">err</span>&nbsp;<span class="op" id="6102325">=</span>&nbsp;<span class="ident" id="6102327">io</span><span class="op" id="6102329">.</span><span class="ident" id="6102330">ReadFull</span><span class="op" id="6102338">(</span><span class="ident" id="6102339">tr</span><span class="op" id="6102341">.</span><span class="ident" id="6102342">r</span><span class="op" id="6102343">,</span>&nbsp;<span class="ident" id="6102345">sparseHeader</span><span class="op" id="6102357">)</span><span class="op" id="6102358">;</span>&nbsp;<span class="ident" id="6102360">tr</span><span class="op" id="6102362">.</span><span class="ident" id="6102363">err</span>&nbsp;<span class="op" id="6102367">!=</span>&nbsp;<span class="ident" id="6102370">nil</span>&nbsp;<span class="op" id="6102374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102379">return</span>&nbsp;<span class="ident" id="6102386">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102396">isExtended</span>&nbsp;<span class="op" id="6102407">=</span>&nbsp;<span class="ident" id="6102409">sparseHeader</span><span class="op" id="6102421">[</span><span class="ident" id="6102422">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="6102464">]</span>&nbsp;<span class="op" id="6102466">!=</span>&nbsp;<span class="num" id="6102469">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102473">s</span>&nbsp;<span class="op" id="6102475">=</span>&nbsp;<span class="ident" id="6102477">slicer</span><span class="op" id="6102483">(</span><span class="ident" id="6102484">sparseHeader</span><span class="op" id="6102496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102500">for</span>&nbsp;<span class="ident" id="6102504">i</span>&nbsp;<span class="op" id="6102506">:=</span>&nbsp;<span class="num" id="6102509">0</span><span class="op" id="6102510">;</span>&nbsp;<span class="ident" id="6102512">i</span>&nbsp;<span class="op" id="6102514">&lt;</span>&nbsp;<span class="ident" id="6102516">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="6102552">;</span>&nbsp;<span class="ident" id="6102554">i</span><span class="op" id="6102555">++</span>&nbsp;<span class="op" id="6102558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102563">offset</span>&nbsp;<span class="op" id="6102570">:=</span>&nbsp;<span class="ident" id="6102573">tr</span><span class="op" id="6102575">.</span><span class="ident" id="6102576">octal</span><span class="op" id="6102581">(</span><span class="ident" id="6102582">s</span><span class="op" id="6102583">.</span><span class="ident" id="6102584">next</span><span class="op" id="6102588">(</span><span class="ident" id="6102589">oldGNUSparseOffsetSize</span><span class="op" id="6102611">)</span><span class="op" id="6102612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102617">numBytes</span>&nbsp;<span class="op" id="6102626">:=</span>&nbsp;<span class="ident" id="6102629">tr</span><span class="op" id="6102631">.</span><span class="ident" id="6102632">octal</span><span class="op" id="6102637">(</span><span class="ident" id="6102638">s</span><span class="op" id="6102639">.</span><span class="ident" id="6102640">next</span><span class="op" id="6102644">(</span><span class="ident" id="6102645">oldGNUSparseNumBytesSize</span><span class="op" id="6102669">)</span><span class="op" id="6102670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102675">if</span>&nbsp;<span class="ident" id="6102678">tr</span><span class="op" id="6102680">.</span><span class="ident" id="6102681">err</span>&nbsp;<span class="op" id="6102685">!=</span>&nbsp;<span class="ident" id="6102688">nil</span>&nbsp;<span class="op" id="6102692">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102698">tr</span><span class="op" id="6102700">.</span><span class="ident" id="6102701">err</span>&nbsp;<span class="op" id="6102705">=</span>&nbsp;<span class="ident" id="6102707">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102721">return</span>&nbsp;<span class="ident" id="6102728">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102740">if</span>&nbsp;<span class="ident" id="6102743">offset</span>&nbsp;<span class="op" id="6102750">==</span>&nbsp;<span class="num" id="6102753">0</span>&nbsp;<span class="op" id="6102755">&amp;&amp;</span>&nbsp;<span class="ident" id="6102758">numBytes</span>&nbsp;<span class="op" id="6102767">==</span>&nbsp;<span class="num" id="6102770">0</span>&nbsp;<span class="op" id="6102772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102778">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102792">sp</span>&nbsp;<span class="op" id="6102795">=</span>&nbsp;<span class="builtinfunc" id="6102797">append</span><span class="op" id="6102803">(</span><span class="ident" id="6102804">sp</span><span class="op" id="6102806">,</span>&nbsp;<span class="ident" id="6102808">sparseEntry</span><span class="op" id="6102819">{</span><span class="ident" id="6102820">offset</span><span class="op" id="6102826">:</span>&nbsp;<span class="ident" id="6102828">offset</span><span class="op" id="6102834">,</span>&nbsp;<span class="ident" id="6102836">numBytes</span><span class="op" id="6102844">:</span>&nbsp;<span class="ident" id="6102846">numBytes</span><span class="op" id="6102854">}</span><span class="op" id="6102855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102865">return</span>&nbsp;<span class="ident" id="6102872">sp</span><br>
<span class="lineno">595</span><span class="op" id="6102875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6102878">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="6102972">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="6103072">func</span>&nbsp;<span class="ident" id="6103077">readGNUSparseMap1x0</span><span class="op" id="6103096">(</span><span class="ident" id="6103097">r</span>&nbsp;<span class="ident" id="6103099">io</span><span class="op" id="6103101">.</span><span class="ident" id="6103102">Reader</span><span class="op" id="6103108">)</span>&nbsp;<span class="op" id="6103110">(</span><span class="op" id="6103111">[</span><span class="op" id="6103112">]</span><span class="ident" id="6103113">sparseEntry</span><span class="op" id="6103124">,</span>&nbsp;<span class="builtintype" id="6103126">error</span><span class="op" id="6103131">)</span>&nbsp;<span class="op" id="6103133">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103136">buf</span>&nbsp;<span class="op" id="6103140">:=</span>&nbsp;<span class="builtinfunc" id="6103143">make</span><span class="op" id="6103147">(</span><span class="op" id="6103148">[</span><span class="op" id="6103149">]</span><span class="builtintype" id="6103150">byte</span><span class="op" id="6103154">,</span>&nbsp;<span class="num" id="6103156">2</span><span class="op" id="6103157">*</span><span class="ident" id="6103158">blockSize</span><span class="op" id="6103167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103170">sparseHeader</span>&nbsp;<span class="op" id="6103183">:=</span>&nbsp;<span class="ident" id="6103186">buf</span><span class="op" id="6103189">[</span><span class="op" id="6103190">:</span><span class="ident" id="6103191">blockSize</span><span class="op" id="6103200">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103204">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103287">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103359">readDecimal</span>&nbsp;<span class="op" id="6103371">:=</span>&nbsp;<span class="keyword" id="6103374">func</span><span class="op" id="6103378">(</span><span class="op" id="6103379">)</span>&nbsp;<span class="op" id="6103381">(</span><span class="ident" id="6103382">int64</span><span class="op" id="6103387">,</span>&nbsp;<span class="builtintype" id="6103389">error</span><span class="op" id="6103394">)</span>&nbsp;<span class="op" id="6103396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103400">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103422">nl</span>&nbsp;<span class="op" id="6103425">:=</span>&nbsp;<span class="ident" id="6103428">bytes</span><span class="op" id="6103433">.</span><span class="ident" id="6103434">IndexByte</span><span class="op" id="6103443">(</span><span class="ident" id="6103444">sparseHeader</span><span class="op" id="6103456">,</span>&nbsp;<span class="string" id="6103458">&#39;\n&#39;</span><span class="op" id="6103462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6103466">if</span>&nbsp;<span class="ident" id="6103469">nl</span>&nbsp;<span class="op" id="6103472">==</span>&nbsp;<span class="op" id="6103475">-</span><span class="num" id="6103476">1</span>&nbsp;<span class="op" id="6103478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6103483">if</span>&nbsp;<span class="builtinfunc" id="6103486">len</span><span class="op" id="6103489">(</span><span class="ident" id="6103490">sparseHeader</span><span class="op" id="6103502">)</span>&nbsp;<span class="op" id="6103504">&gt;=</span>&nbsp;<span class="ident" id="6103507">blockSize</span>&nbsp;<span class="op" id="6103517">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103523">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6103547">return</span>&nbsp;<span class="num" id="6103554">0</span><span class="op" id="6103555">,</span>&nbsp;<span class="ident" id="6103557">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6103570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103575">oldLen</span>&nbsp;<span class="op" id="6103582">:=</span>&nbsp;<span class="builtinfunc" id="6103585">len</span><span class="op" id="6103588">(</span><span class="ident" id="6103589">sparseHeader</span><span class="op" id="6103601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103606">newLen</span>&nbsp;<span class="op" id="6103613">:=</span>&nbsp;<span class="ident" id="6103616">oldLen</span>&nbsp;<span class="op" id="6103623">+</span>&nbsp;<span class="ident" id="6103625">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6103638">if</span>&nbsp;<span class="builtinfunc" id="6103641">cap</span><span class="op" id="6103644">(</span><span class="ident" id="6103645">sparseHeader</span><span class="op" id="6103657">)</span>&nbsp;<span class="op" id="6103659">&lt;</span>&nbsp;<span class="ident" id="6103661">newLen</span>&nbsp;<span class="op" id="6103668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103674">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6103746">copy</span><span class="op" id="6103750">(</span><span class="ident" id="6103751">buf</span><span class="op" id="6103754">,</span>&nbsp;<span class="ident" id="6103756">sparseHeader</span><span class="op" id="6103768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103774">sparseHeader</span>&nbsp;<span class="op" id="6103787">=</span>&nbsp;<span class="ident" id="6103789">buf</span><span class="op" id="6103792">[</span><span class="op" id="6103793">:</span><span class="ident" id="6103794">newLen</span><span class="op" id="6103800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6103805">}</span>&nbsp;<span class="keyword" id="6103807">else</span>&nbsp;<span class="op" id="6103812">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103818">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6103870">sparseHeader</span>&nbsp;<span class="op" id="6103883">=</span>&nbsp;<span class="ident" id="6103885">sparseHeader</span><span class="op" id="6103897">[</span><span class="op" id="6103898">:</span><span class="ident" id="6103899">newLen</span><span class="op" id="6103905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6103910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6103916">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6103977">if</span>&nbsp;<span class="ident" id="6103980">_</span><span class="op" id="6103981">,</span>&nbsp;<span class="ident" id="6103983">err</span>&nbsp;<span class="op" id="6103987">:=</span>&nbsp;<span class="ident" id="6103990">io</span><span class="op" id="6103992">.</span><span class="ident" id="6103993">ReadFull</span><span class="op" id="6104001">(</span><span class="ident" id="6104002">r</span><span class="op" id="6104003">,</span>&nbsp;<span class="ident" id="6104005">sparseHeader</span><span class="op" id="6104017">[</span><span class="ident" id="6104018">oldLen</span><span class="op" id="6104024">:</span><span class="ident" id="6104025">newLen</span><span class="op" id="6104031">]</span><span class="op" id="6104032">)</span><span class="op" id="6104033">;</span>&nbsp;<span class="ident" id="6104035">err</span>&nbsp;<span class="op" id="6104039">!=</span>&nbsp;<span class="ident" id="6104042">nil</span>&nbsp;<span class="op" id="6104046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104052">return</span>&nbsp;<span class="num" id="6104059">0</span><span class="op" id="6104060">,</span>&nbsp;<span class="ident" id="6104062">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104075">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104116">nl</span>&nbsp;<span class="op" id="6104119">=</span>&nbsp;<span class="ident" id="6104121">bytes</span><span class="op" id="6104126">.</span><span class="ident" id="6104127">IndexByte</span><span class="op" id="6104136">(</span><span class="ident" id="6104137">sparseHeader</span><span class="op" id="6104149">[</span><span class="ident" id="6104150">oldLen</span><span class="op" id="6104156">:</span><span class="ident" id="6104157">newLen</span><span class="op" id="6104163">]</span><span class="op" id="6104164">,</span>&nbsp;<span class="string" id="6104166">&#39;\n&#39;</span><span class="op" id="6104170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104175">if</span>&nbsp;<span class="ident" id="6104178">nl</span>&nbsp;<span class="op" id="6104181">==</span>&nbsp;<span class="op" id="6104184">-</span><span class="num" id="6104185">1</span>&nbsp;<span class="op" id="6104187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104193">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104217">return</span>&nbsp;<span class="num" id="6104224">0</span><span class="op" id="6104225">,</span>&nbsp;<span class="ident" id="6104227">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104240">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104245">nl</span>&nbsp;<span class="op" id="6104248">+=</span>&nbsp;<span class="ident" id="6104251">oldLen</span>&nbsp;<span class="comment" id="6104258">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104307">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104358">n</span><span class="op" id="6104359">,</span>&nbsp;<span class="ident" id="6104361">err</span>&nbsp;<span class="op" id="6104365">:=</span>&nbsp;<span class="ident" id="6104368">strconv</span><span class="op" id="6104375">.</span><span class="ident" id="6104376">ParseInt</span><span class="op" id="6104384">(</span><span class="builtintype" id="6104385">string</span><span class="op" id="6104391">(</span><span class="ident" id="6104392">sparseHeader</span><span class="op" id="6104404">[</span><span class="op" id="6104405">:</span><span class="ident" id="6104406">nl</span><span class="op" id="6104408">]</span><span class="op" id="6104409">)</span><span class="op" id="6104410">,</span>&nbsp;<span class="num" id="6104412">10</span><span class="op" id="6104414">,</span>&nbsp;<span class="num" id="6104416">0</span><span class="op" id="6104417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104421">if</span>&nbsp;<span class="ident" id="6104424">err</span>&nbsp;<span class="op" id="6104428">!=</span>&nbsp;<span class="ident" id="6104431">nil</span>&nbsp;<span class="op" id="6104435">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104440">return</span>&nbsp;<span class="num" id="6104447">0</span><span class="op" id="6104448">,</span>&nbsp;<span class="ident" id="6104450">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104467">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104515">sparseHeader</span>&nbsp;<span class="op" id="6104528">=</span>&nbsp;<span class="ident" id="6104530">sparseHeader</span><span class="op" id="6104542">[</span><span class="ident" id="6104543">nl</span><span class="op" id="6104545">+</span><span class="num" id="6104546">1</span><span class="op" id="6104547">:</span><span class="op" id="6104548">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104552">return</span>&nbsp;<span class="ident" id="6104559">n</span><span class="op" id="6104560">,</span>&nbsp;<span class="ident" id="6104562">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104571">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104596">if</span>&nbsp;<span class="ident" id="6104599">_</span><span class="op" id="6104600">,</span>&nbsp;<span class="ident" id="6104602">err</span>&nbsp;<span class="op" id="6104606">:=</span>&nbsp;<span class="ident" id="6104609">io</span><span class="op" id="6104611">.</span><span class="ident" id="6104612">ReadFull</span><span class="op" id="6104620">(</span><span class="ident" id="6104621">r</span><span class="op" id="6104622">,</span>&nbsp;<span class="ident" id="6104624">sparseHeader</span><span class="op" id="6104636">)</span><span class="op" id="6104637">;</span>&nbsp;<span class="ident" id="6104639">err</span>&nbsp;<span class="op" id="6104643">!=</span>&nbsp;<span class="ident" id="6104646">nil</span>&nbsp;<span class="op" id="6104650">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104654">return</span>&nbsp;<span class="ident" id="6104661">nil</span><span class="op" id="6104664">,</span>&nbsp;<span class="ident" id="6104666">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104675">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104725">numEntries</span><span class="op" id="6104735">,</span>&nbsp;<span class="ident" id="6104737">err</span>&nbsp;<span class="op" id="6104741">:=</span>&nbsp;<span class="ident" id="6104744">readDecimal</span><span class="op" id="6104755">(</span><span class="op" id="6104756">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104759">if</span>&nbsp;<span class="ident" id="6104762">err</span>&nbsp;<span class="op" id="6104766">!=</span>&nbsp;<span class="ident" id="6104769">nil</span>&nbsp;<span class="op" id="6104773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104777">return</span>&nbsp;<span class="ident" id="6104784">nil</span><span class="op" id="6104787">,</span>&nbsp;<span class="ident" id="6104789">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104798">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104823">sp</span>&nbsp;<span class="op" id="6104826">:=</span>&nbsp;<span class="builtinfunc" id="6104829">make</span><span class="op" id="6104833">(</span><span class="op" id="6104834">[</span><span class="op" id="6104835">]</span><span class="ident" id="6104836">sparseEntry</span><span class="op" id="6104847">,</span>&nbsp;<span class="num" id="6104849">0</span><span class="op" id="6104850">,</span>&nbsp;<span class="ident" id="6104852">numEntries</span><span class="op" id="6104862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104865">for</span>&nbsp;<span class="ident" id="6104869">i</span>&nbsp;<span class="op" id="6104871">:=</span>&nbsp;<span class="ident" id="6104874">int64</span><span class="op" id="6104879">(</span><span class="num" id="6104880">0</span><span class="op" id="6104881">)</span><span class="op" id="6104882">;</span>&nbsp;<span class="ident" id="6104884">i</span>&nbsp;<span class="op" id="6104886">&lt;</span>&nbsp;<span class="ident" id="6104888">numEntries</span><span class="op" id="6104898">;</span>&nbsp;<span class="ident" id="6104900">i</span><span class="op" id="6104901">++</span>&nbsp;<span class="op" id="6104904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6104908">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6104929">offset</span><span class="op" id="6104935">,</span>&nbsp;<span class="ident" id="6104937">err</span>&nbsp;<span class="op" id="6104941">:=</span>&nbsp;<span class="ident" id="6104944">readDecimal</span><span class="op" id="6104955">(</span><span class="op" id="6104956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104960">if</span>&nbsp;<span class="ident" id="6104963">err</span>&nbsp;<span class="op" id="6104967">!=</span>&nbsp;<span class="ident" id="6104970">nil</span>&nbsp;<span class="op" id="6104974">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6104979">return</span>&nbsp;<span class="ident" id="6104986">nil</span><span class="op" id="6104989">,</span>&nbsp;<span class="ident" id="6104991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6104997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6105001">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105020">numBytes</span><span class="op" id="6105028">,</span>&nbsp;<span class="ident" id="6105030">err</span>&nbsp;<span class="op" id="6105034">:=</span>&nbsp;<span class="ident" id="6105037">readDecimal</span><span class="op" id="6105048">(</span><span class="op" id="6105049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105053">if</span>&nbsp;<span class="ident" id="6105056">err</span>&nbsp;<span class="op" id="6105060">!=</span>&nbsp;<span class="ident" id="6105063">nil</span>&nbsp;<span class="op" id="6105067">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105072">return</span>&nbsp;<span class="ident" id="6105079">nil</span><span class="op" id="6105082">,</span>&nbsp;<span class="ident" id="6105084">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105095">sp</span>&nbsp;<span class="op" id="6105098">=</span>&nbsp;<span class="builtinfunc" id="6105100">append</span><span class="op" id="6105106">(</span><span class="ident" id="6105107">sp</span><span class="op" id="6105109">,</span>&nbsp;<span class="ident" id="6105111">sparseEntry</span><span class="op" id="6105122">{</span><span class="ident" id="6105123">offset</span><span class="op" id="6105129">:</span>&nbsp;<span class="ident" id="6105131">offset</span><span class="op" id="6105137">,</span>&nbsp;<span class="ident" id="6105139">numBytes</span><span class="op" id="6105147">:</span>&nbsp;<span class="ident" id="6105149">numBytes</span><span class="op" id="6105157">}</span><span class="op" id="6105158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105161">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105165">return</span>&nbsp;<span class="ident" id="6105172">sp</span><span class="op" id="6105174">,</span>&nbsp;<span class="ident" id="6105176">nil</span><br>
<span class="lineno"></span><span class="op" id="6105180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6105183">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="6105277">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6105325">func</span>&nbsp;<span class="ident" id="6105330">readGNUSparseMap0x1</span><span class="op" id="6105349">(</span><span class="ident" id="6105350">headers</span>&nbsp;<span class="keyword" id="6105358">map</span><span class="op" id="6105361">[</span><span class="builtintype" id="6105362">string</span><span class="op" id="6105368">]</span><span class="builtintype" id="6105369">string</span><span class="op" id="6105375">)</span>&nbsp;<span class="op" id="6105377">(</span><span class="op" id="6105378">[</span><span class="op" id="6105379">]</span><span class="ident" id="6105380">sparseEntry</span><span class="op" id="6105391">,</span>&nbsp;<span class="builtintype" id="6105393">error</span><span class="op" id="6105398">)</span>&nbsp;<span class="op" id="6105400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6105403">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105429">numEntriesStr</span><span class="op" id="6105442">,</span>&nbsp;<span class="ident" id="6105444">ok</span>&nbsp;<span class="op" id="6105447">:=</span>&nbsp;<span class="ident" id="6105450">headers</span><span class="op" id="6105457">[</span><span class="ident" id="6105458">paxGNUSparseNumBlocks</span><span class="op" id="6105479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105482">if</span>&nbsp;<span class="op" id="6105485">!</span><span class="ident" id="6105486">ok</span>&nbsp;<span class="op" id="6105489">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105493">return</span>&nbsp;<span class="ident" id="6105500">nil</span><span class="op" id="6105503">,</span>&nbsp;<span class="ident" id="6105505">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105519">numEntries</span><span class="op" id="6105529">,</span>&nbsp;<span class="ident" id="6105531">err</span>&nbsp;<span class="op" id="6105535">:=</span>&nbsp;<span class="ident" id="6105538">strconv</span><span class="op" id="6105545">.</span><span class="ident" id="6105546">ParseInt</span><span class="op" id="6105554">(</span><span class="ident" id="6105555">numEntriesStr</span><span class="op" id="6105568">,</span>&nbsp;<span class="num" id="6105570">10</span><span class="op" id="6105572">,</span>&nbsp;<span class="num" id="6105574">0</span><span class="op" id="6105575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105578">if</span>&nbsp;<span class="ident" id="6105581">err</span>&nbsp;<span class="op" id="6105585">!=</span>&nbsp;<span class="ident" id="6105588">nil</span>&nbsp;<span class="op" id="6105592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105596">return</span>&nbsp;<span class="ident" id="6105603">nil</span><span class="op" id="6105606">,</span>&nbsp;<span class="ident" id="6105608">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105623">sparseMap</span>&nbsp;<span class="op" id="6105633">:=</span>&nbsp;<span class="ident" id="6105636">strings</span><span class="op" id="6105643">.</span><span class="ident" id="6105644">Split</span><span class="op" id="6105649">(</span><span class="ident" id="6105650">headers</span><span class="op" id="6105657">[</span><span class="ident" id="6105658">paxGNUSparseMap</span><span class="op" id="6105673">]</span><span class="op" id="6105674">,</span>&nbsp;<span class="string" id="6105676">&#34;,&#34;</span><span class="op" id="6105679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6105683">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105743">if</span>&nbsp;<span class="ident" id="6105746">int64</span><span class="op" id="6105751">(</span><span class="builtinfunc" id="6105752">len</span><span class="op" id="6105755">(</span><span class="ident" id="6105756">sparseMap</span><span class="op" id="6105765">)</span><span class="op" id="6105766">)</span>&nbsp;<span class="op" id="6105768">!=</span>&nbsp;<span class="num" id="6105771">2</span><span class="op" id="6105772">*</span><span class="ident" id="6105773">numEntries</span>&nbsp;<span class="op" id="6105784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105788">return</span>&nbsp;<span class="ident" id="6105795">nil</span><span class="op" id="6105798">,</span>&nbsp;<span class="ident" id="6105800">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6105811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6105815">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105862">sp</span>&nbsp;<span class="op" id="6105865">:=</span>&nbsp;<span class="builtinfunc" id="6105868">make</span><span class="op" id="6105872">(</span><span class="op" id="6105873">[</span><span class="op" id="6105874">]</span><span class="ident" id="6105875">sparseEntry</span><span class="op" id="6105886">,</span>&nbsp;<span class="num" id="6105888">0</span><span class="op" id="6105889">,</span>&nbsp;<span class="ident" id="6105891">numEntries</span><span class="op" id="6105901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6105904">for</span>&nbsp;<span class="ident" id="6105908">i</span>&nbsp;<span class="op" id="6105910">:=</span>&nbsp;<span class="ident" id="6105913">int64</span><span class="op" id="6105918">(</span><span class="num" id="6105919">0</span><span class="op" id="6105920">)</span><span class="op" id="6105921">;</span>&nbsp;<span class="ident" id="6105923">i</span>&nbsp;<span class="op" id="6105925">&lt;</span>&nbsp;<span class="ident" id="6105927">numEntries</span><span class="op" id="6105937">;</span>&nbsp;<span class="ident" id="6105939">i</span><span class="op" id="6105940">++</span>&nbsp;<span class="op" id="6105943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6105947">offset</span><span class="op" id="6105953">,</span>&nbsp;<span class="ident" id="6105955">err</span>&nbsp;<span class="op" id="6105959">:=</span>&nbsp;<span class="ident" id="6105962">strconv</span><span class="op" id="6105969">.</span><span class="ident" id="6105970">ParseInt</span><span class="op" id="6105978">(</span><span class="ident" id="6105979">sparseMap</span><span class="op" id="6105988">[</span><span class="num" id="6105989">2</span><span class="op" id="6105990">*</span><span class="ident" id="6105991">i</span><span class="op" id="6105992">]</span><span class="op" id="6105993">,</span>&nbsp;<span class="num" id="6105995">10</span><span class="op" id="6105997">,</span>&nbsp;<span class="num" id="6105999">0</span><span class="op" id="6106000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106004">if</span>&nbsp;<span class="ident" id="6106007">err</span>&nbsp;<span class="op" id="6106011">!=</span>&nbsp;<span class="ident" id="6106014">nil</span>&nbsp;<span class="op" id="6106018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106023">return</span>&nbsp;<span class="ident" id="6106030">nil</span><span class="op" id="6106033">,</span>&nbsp;<span class="ident" id="6106035">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106051">numBytes</span><span class="op" id="6106059">,</span>&nbsp;<span class="ident" id="6106061">err</span>&nbsp;<span class="op" id="6106065">:=</span>&nbsp;<span class="ident" id="6106068">strconv</span><span class="op" id="6106075">.</span><span class="ident" id="6106076">ParseInt</span><span class="op" id="6106084">(</span><span class="ident" id="6106085">sparseMap</span><span class="op" id="6106094">[</span><span class="num" id="6106095">2</span><span class="op" id="6106096">*</span><span class="ident" id="6106097">i</span><span class="op" id="6106098">+</span><span class="num" id="6106099">1</span><span class="op" id="6106100">]</span><span class="op" id="6106101">,</span>&nbsp;<span class="num" id="6106103">10</span><span class="op" id="6106105">,</span>&nbsp;<span class="num" id="6106107">0</span><span class="op" id="6106108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106112">if</span>&nbsp;<span class="ident" id="6106115">err</span>&nbsp;<span class="op" id="6106119">!=</span>&nbsp;<span class="ident" id="6106122">nil</span>&nbsp;<span class="op" id="6106126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106131">return</span>&nbsp;<span class="ident" id="6106138">nil</span><span class="op" id="6106141">,</span>&nbsp;<span class="ident" id="6106143">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106155">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106159">sp</span>&nbsp;<span class="op" id="6106162">=</span>&nbsp;<span class="builtinfunc" id="6106164">append</span><span class="op" id="6106170">(</span><span class="ident" id="6106171">sp</span><span class="op" id="6106173">,</span>&nbsp;<span class="ident" id="6106175">sparseEntry</span><span class="op" id="6106186">{</span><span class="ident" id="6106187">offset</span><span class="op" id="6106193">:</span>&nbsp;<span class="ident" id="6106195">offset</span><span class="op" id="6106201">,</span>&nbsp;<span class="ident" id="6106203">numBytes</span><span class="op" id="6106211">:</span>&nbsp;<span class="ident" id="6106213">numBytes</span><span class="op" id="6106221">}</span><span class="op" id="6106222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106229">return</span>&nbsp;<span class="ident" id="6106236">sp</span><span class="op" id="6106238">,</span>&nbsp;<span class="ident" id="6106240">nil</span><br>
<span class="lineno"></span><span class="op" id="6106244">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="6106247">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="6106328">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6106385">func</span>&nbsp;<span class="op" id="6106390">(</span><span class="ident" id="6106391">tr</span>&nbsp;<span class="op" id="6106394">*</span><span class="ident" id="6106395">Reader</span><span class="op" id="6106401">)</span>&nbsp;<span class="ident" id="6106403">numBytes</span><span class="op" id="6106411">(</span><span class="op" id="6106412">)</span>&nbsp;<span class="ident" id="6106414">int64</span>&nbsp;<span class="op" id="6106420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106423">if</span>&nbsp;<span class="ident" id="6106426">tr</span><span class="op" id="6106428">.</span><span class="ident" id="6106429">curr</span>&nbsp;<span class="op" id="6106434">==</span>&nbsp;<span class="ident" id="6106437">nil</span>&nbsp;<span class="op" id="6106441">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6106445">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106479">return</span>&nbsp;<span class="num" id="6106486">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106492">return</span>&nbsp;<span class="ident" id="6106499">tr</span><span class="op" id="6106501">.</span><span class="ident" id="6106502">curr</span><span class="op" id="6106506">.</span><span class="ident" id="6106507">numBytes</span><span class="op" id="6106515">(</span><span class="op" id="6106516">)</span><br>
<span class="lineno"></span><span class="op" id="6106518">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6106521">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6106578">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="6106641">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="6106695">func</span>&nbsp;<span class="op" id="6106700">(</span><span class="ident" id="6106701">tr</span>&nbsp;<span class="op" id="6106704">*</span><span class="ident" id="6106705">Reader</span><span class="op" id="6106711">)</span>&nbsp;<span class="ident" id="6106713">Read</span><span class="op" id="6106717">(</span><span class="ident" id="6106718">b</span>&nbsp;<span class="op" id="6106720">[</span><span class="op" id="6106721">]</span><span class="builtintype" id="6106722">byte</span><span class="op" id="6106726">)</span>&nbsp;<span class="op" id="6106728">(</span><span class="ident" id="6106729">n</span>&nbsp;<span class="builtintype" id="6106731">int</span><span class="op" id="6106734">,</span>&nbsp;<span class="ident" id="6106736">err</span>&nbsp;<span class="builtintype" id="6106740">error</span><span class="op" id="6106745">)</span>&nbsp;<span class="op" id="6106747">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106750">if</span>&nbsp;<span class="ident" id="6106753">tr</span><span class="op" id="6106755">.</span><span class="ident" id="6106756">curr</span>&nbsp;<span class="op" id="6106761">==</span>&nbsp;<span class="ident" id="6106764">nil</span>&nbsp;<span class="op" id="6106768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106772">return</span>&nbsp;<span class="num" id="6106779">0</span><span class="op" id="6106780">,</span>&nbsp;<span class="ident" id="6106782">io</span><span class="op" id="6106784">.</span><span class="ident" id="6106785">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106793">n</span><span class="op" id="6106794">,</span>&nbsp;<span class="ident" id="6106796">err</span>&nbsp;<span class="op" id="6106800">=</span>&nbsp;<span class="ident" id="6106802">tr</span><span class="op" id="6106804">.</span><span class="ident" id="6106805">curr</span><span class="op" id="6106809">.</span><span class="ident" id="6106810">Read</span><span class="op" id="6106814">(</span><span class="ident" id="6106815">b</span><span class="op" id="6106816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106819">if</span>&nbsp;<span class="ident" id="6106822">err</span>&nbsp;<span class="op" id="6106826">!=</span>&nbsp;<span class="ident" id="6106829">nil</span>&nbsp;<span class="op" id="6106833">&amp;&amp;</span>&nbsp;<span class="ident" id="6106836">err</span>&nbsp;<span class="op" id="6106840">!=</span>&nbsp;<span class="ident" id="6106843">io</span><span class="op" id="6106845">.</span><span class="ident" id="6106846">EOF</span>&nbsp;<span class="op" id="6106850">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6106854">tr</span><span class="op" id="6106856">.</span><span class="ident" id="6106857">err</span>&nbsp;<span class="op" id="6106861">=</span>&nbsp;<span class="ident" id="6106863">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6106868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106871">return</span><br>
<span class="lineno"></span><span class="op" id="6106878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="6106881">func</span>&nbsp;<span class="op" id="6106886">(</span><span class="ident" id="6106887">rfr</span>&nbsp;<span class="op" id="6106891">*</span><span class="ident" id="6106892">regFileReader</span><span class="op" id="6106905">)</span>&nbsp;<span class="ident" id="6106907">Read</span><span class="op" id="6106911">(</span><span class="ident" id="6106912">b</span>&nbsp;<span class="op" id="6106914">[</span><span class="op" id="6106915">]</span><span class="builtintype" id="6106916">byte</span><span class="op" id="6106920">)</span>&nbsp;<span class="op" id="6106922">(</span><span class="ident" id="6106923">n</span>&nbsp;<span class="builtintype" id="6106925">int</span><span class="op" id="6106928">,</span>&nbsp;<span class="ident" id="6106930">err</span>&nbsp;<span class="builtintype" id="6106934">error</span><span class="op" id="6106939">)</span>&nbsp;<span class="op" id="6106941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106944">if</span>&nbsp;<span class="ident" id="6106947">rfr</span><span class="op" id="6106950">.</span><span class="ident" id="6106951">nb</span>&nbsp;<span class="op" id="6106954">==</span>&nbsp;<span class="num" id="6106957">0</span>&nbsp;<span class="op" id="6106959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6106963">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6106982">return</span>&nbsp;<span class="num" id="6106989">0</span><span class="op" id="6106990">,</span>&nbsp;<span class="ident" id="6106992">io</span><span class="op" id="6106994">.</span><span class="ident" id="6106995">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107000">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107003">if</span>&nbsp;<span class="ident" id="6107006">int64</span><span class="op" id="6107011">(</span><span class="builtinfunc" id="6107012">len</span><span class="op" id="6107015">(</span><span class="ident" id="6107016">b</span><span class="op" id="6107017">)</span><span class="op" id="6107018">)</span>&nbsp;<span class="op" id="6107020">&gt;</span>&nbsp;<span class="ident" id="6107022">rfr</span><span class="op" id="6107025">.</span><span class="ident" id="6107026">nb</span>&nbsp;<span class="op" id="6107029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107033">b</span>&nbsp;<span class="op" id="6107035">=</span>&nbsp;<span class="ident" id="6107037">b</span><span class="op" id="6107038">[</span><span class="num" id="6107039">0</span><span class="op" id="6107040">:</span><span class="ident" id="6107041">rfr</span><span class="op" id="6107044">.</span><span class="ident" id="6107045">nb</span><span class="op" id="6107047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107053">n</span><span class="op" id="6107054">,</span>&nbsp;<span class="ident" id="6107056">err</span>&nbsp;<span class="op" id="6107060">=</span>&nbsp;<span class="ident" id="6107062">rfr</span><span class="op" id="6107065">.</span><span class="ident" id="6107066">r</span><span class="op" id="6107067">.</span><span class="ident" id="6107068">Read</span><span class="op" id="6107072">(</span><span class="ident" id="6107073">b</span><span class="op" id="6107074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107077">rfr</span><span class="op" id="6107080">.</span><span class="ident" id="6107081">nb</span>&nbsp;<span class="op" id="6107084">-=</span>&nbsp;<span class="ident" id="6107087">int64</span><span class="op" id="6107092">(</span><span class="ident" id="6107093">n</span><span class="op" id="6107094">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107098">if</span>&nbsp;<span class="ident" id="6107101">err</span>&nbsp;<span class="op" id="6107105">==</span>&nbsp;<span class="ident" id="6107108">io</span><span class="op" id="6107110">.</span><span class="ident" id="6107111">EOF</span>&nbsp;<span class="op" id="6107115">&amp;&amp;</span>&nbsp;<span class="ident" id="6107118">rfr</span><span class="op" id="6107121">.</span><span class="ident" id="6107122">nb</span>&nbsp;<span class="op" id="6107125">&gt;</span>&nbsp;<span class="num" id="6107127">0</span>&nbsp;<span class="op" id="6107129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107133">err</span>&nbsp;<span class="op" id="6107137">=</span>&nbsp;<span class="ident" id="6107139">io</span><span class="op" id="6107141">.</span><span class="ident" id="6107142">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107163">return</span><br>
<span class="lineno">755</span><span class="op" id="6107170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6107173">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6107265">func</span>&nbsp;<span class="op" id="6107270">(</span><span class="ident" id="6107271">rfr</span>&nbsp;<span class="op" id="6107275">*</span><span class="ident" id="6107276">regFileReader</span><span class="op" id="6107289">)</span>&nbsp;<span class="ident" id="6107291">numBytes</span><span class="op" id="6107299">(</span><span class="op" id="6107300">)</span>&nbsp;<span class="ident" id="6107302">int64</span>&nbsp;<span class="op" id="6107308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107311">return</span>&nbsp;<span class="ident" id="6107318">rfr</span><span class="op" id="6107321">.</span><span class="ident" id="6107322">nb</span><br>
<span class="lineno">760</span><span class="op" id="6107325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6107328">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="6107391">func</span>&nbsp;<span class="op" id="6107396">(</span><span class="ident" id="6107397">sfr</span>&nbsp;<span class="op" id="6107401">*</span><span class="ident" id="6107402">sparseFileReader</span><span class="op" id="6107418">)</span>&nbsp;<span class="ident" id="6107420">readHole</span><span class="op" id="6107428">(</span><span class="ident" id="6107429">b</span>&nbsp;<span class="op" id="6107431">[</span><span class="op" id="6107432">]</span><span class="builtintype" id="6107433">byte</span><span class="op" id="6107437">,</span>&nbsp;<span class="ident" id="6107439">toOffset</span>&nbsp;<span class="ident" id="6107448">int64</span><span class="op" id="6107453">)</span>&nbsp;<span class="builtintype" id="6107455">int</span>&nbsp;<span class="op" id="6107459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107462">n64</span>&nbsp;<span class="op" id="6107466">:=</span>&nbsp;<span class="ident" id="6107469">toOffset</span>&nbsp;<span class="op" id="6107478">-</span>&nbsp;<span class="ident" id="6107480">sfr</span><span class="op" id="6107483">.</span><span class="ident" id="6107484">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107489">if</span>&nbsp;<span class="ident" id="6107492">n64</span>&nbsp;<span class="op" id="6107496">&gt;</span>&nbsp;<span class="ident" id="6107498">int64</span><span class="op" id="6107503">(</span><span class="builtinfunc" id="6107504">len</span><span class="op" id="6107507">(</span><span class="ident" id="6107508">b</span><span class="op" id="6107509">)</span><span class="op" id="6107510">)</span>&nbsp;<span class="op" id="6107512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107516">n64</span>&nbsp;<span class="op" id="6107520">=</span>&nbsp;<span class="ident" id="6107522">int64</span><span class="op" id="6107527">(</span><span class="builtinfunc" id="6107528">len</span><span class="op" id="6107531">(</span><span class="ident" id="6107532">b</span><span class="op" id="6107533">)</span><span class="op" id="6107534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107540">n</span>&nbsp;<span class="op" id="6107542">:=</span>&nbsp;<span class="builtintype" id="6107545">int</span><span class="op" id="6107548">(</span><span class="ident" id="6107549">n64</span><span class="op" id="6107552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107555">for</span>&nbsp;<span class="ident" id="6107559">i</span>&nbsp;<span class="op" id="6107561">:=</span>&nbsp;<span class="num" id="6107564">0</span><span class="op" id="6107565">;</span>&nbsp;<span class="ident" id="6107567">i</span>&nbsp;<span class="op" id="6107569">&lt;</span>&nbsp;<span class="ident" id="6107571">n</span><span class="op" id="6107572">;</span>&nbsp;<span class="ident" id="6107574">i</span><span class="op" id="6107575">++</span>&nbsp;<span class="op" id="6107578">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107582">b</span><span class="op" id="6107583">[</span><span class="ident" id="6107584">i</span><span class="op" id="6107585">]</span>&nbsp;<span class="op" id="6107587">=</span>&nbsp;<span class="num" id="6107589">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107595">sfr</span><span class="op" id="6107598">.</span><span class="ident" id="6107599">pos</span>&nbsp;<span class="op" id="6107603">+=</span>&nbsp;<span class="ident" id="6107606">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107611">return</span>&nbsp;<span class="ident" id="6107618">n</span><br>
<span class="lineno"></span><span class="op" id="6107620">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="6107623">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="6107676">func</span>&nbsp;<span class="op" id="6107681">(</span><span class="ident" id="6107682">sfr</span>&nbsp;<span class="op" id="6107686">*</span><span class="ident" id="6107687">sparseFileReader</span><span class="op" id="6107703">)</span>&nbsp;<span class="ident" id="6107705">Read</span><span class="op" id="6107709">(</span><span class="ident" id="6107710">b</span>&nbsp;<span class="op" id="6107712">[</span><span class="op" id="6107713">]</span><span class="builtintype" id="6107714">byte</span><span class="op" id="6107718">)</span>&nbsp;<span class="op" id="6107720">(</span><span class="ident" id="6107721">n</span>&nbsp;<span class="builtintype" id="6107723">int</span><span class="op" id="6107726">,</span>&nbsp;<span class="ident" id="6107728">err</span>&nbsp;<span class="builtintype" id="6107732">error</span><span class="op" id="6107737">)</span>&nbsp;<span class="op" id="6107739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107742">if</span>&nbsp;<span class="builtinfunc" id="6107745">len</span><span class="op" id="6107748">(</span><span class="ident" id="6107749">sfr</span><span class="op" id="6107752">.</span><span class="ident" id="6107753">sp</span><span class="op" id="6107755">)</span>&nbsp;<span class="op" id="6107757">==</span>&nbsp;<span class="num" id="6107760">0</span>&nbsp;<span class="op" id="6107762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6107766">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107808">if</span>&nbsp;<span class="ident" id="6107811">sfr</span><span class="op" id="6107814">.</span><span class="ident" id="6107815">pos</span>&nbsp;<span class="op" id="6107819">&lt;</span>&nbsp;<span class="ident" id="6107821">sfr</span><span class="op" id="6107824">.</span><span class="ident" id="6107825">tot</span>&nbsp;<span class="op" id="6107829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6107834">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6107863">n</span>&nbsp;<span class="op" id="6107865">=</span>&nbsp;<span class="ident" id="6107867">sfr</span><span class="op" id="6107870">.</span><span class="ident" id="6107871">readHole</span><span class="op" id="6107879">(</span><span class="ident" id="6107880">b</span><span class="op" id="6107881">,</span>&nbsp;<span class="ident" id="6107883">sfr</span><span class="op" id="6107886">.</span><span class="ident" id="6107887">tot</span><span class="op" id="6107890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107895">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107904">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6107908">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107953">return</span>&nbsp;<span class="num" id="6107960">0</span><span class="op" id="6107961">,</span>&nbsp;<span class="ident" id="6107963">io</span><span class="op" id="6107965">.</span><span class="ident" id="6107966">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6107971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6107974">if</span>&nbsp;<span class="ident" id="6107977">sfr</span><span class="op" id="6107980">.</span><span class="ident" id="6107981">pos</span>&nbsp;<span class="op" id="6107985">&lt;</span>&nbsp;<span class="ident" id="6107987">sfr</span><span class="op" id="6107990">.</span><span class="ident" id="6107991">sp</span><span class="op" id="6107993">[</span><span class="num" id="6107994">0</span><span class="op" id="6107995">]</span><span class="op" id="6107996">.</span><span class="ident" id="6107997">offset</span>&nbsp;<span class="op" id="6108004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108008">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108029">n</span>&nbsp;<span class="op" id="6108031">=</span>&nbsp;<span class="ident" id="6108033">sfr</span><span class="op" id="6108036">.</span><span class="ident" id="6108037">readHole</span><span class="op" id="6108045">(</span><span class="ident" id="6108046">b</span><span class="op" id="6108047">,</span>&nbsp;<span class="ident" id="6108049">sfr</span><span class="op" id="6108052">.</span><span class="ident" id="6108053">sp</span><span class="op" id="6108055">[</span><span class="num" id="6108056">0</span><span class="op" id="6108057">]</span><span class="op" id="6108058">.</span><span class="ident" id="6108059">offset</span><span class="op" id="6108065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6108069">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6108077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108081">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108148">posInFragment</span>&nbsp;<span class="op" id="6108162">:=</span>&nbsp;<span class="ident" id="6108165">sfr</span><span class="op" id="6108168">.</span><span class="ident" id="6108169">pos</span>&nbsp;<span class="op" id="6108173">-</span>&nbsp;<span class="ident" id="6108175">sfr</span><span class="op" id="6108178">.</span><span class="ident" id="6108179">sp</span><span class="op" id="6108181">[</span><span class="num" id="6108182">0</span><span class="op" id="6108183">]</span><span class="op" id="6108184">.</span><span class="ident" id="6108185">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108193">bytesLeft</span>&nbsp;<span class="op" id="6108203">:=</span>&nbsp;<span class="ident" id="6108206">sfr</span><span class="op" id="6108209">.</span><span class="ident" id="6108210">sp</span><span class="op" id="6108212">[</span><span class="num" id="6108213">0</span><span class="op" id="6108214">]</span><span class="op" id="6108215">.</span><span class="ident" id="6108216">numBytes</span>&nbsp;<span class="op" id="6108225">-</span>&nbsp;<span class="ident" id="6108227">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6108242">if</span>&nbsp;<span class="ident" id="6108245">int64</span><span class="op" id="6108250">(</span><span class="builtinfunc" id="6108251">len</span><span class="op" id="6108254">(</span><span class="ident" id="6108255">b</span><span class="op" id="6108256">)</span><span class="op" id="6108257">)</span>&nbsp;<span class="op" id="6108259">&gt;</span>&nbsp;<span class="ident" id="6108261">bytesLeft</span>&nbsp;<span class="op" id="6108271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108275">b</span>&nbsp;<span class="op" id="6108277">=</span>&nbsp;<span class="ident" id="6108279">b</span><span class="op" id="6108280">[</span><span class="num" id="6108281">0</span><span class="op" id="6108282">:</span><span class="ident" id="6108283">bytesLeft</span><span class="op" id="6108292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6108295">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108299">n</span><span class="op" id="6108300">,</span>&nbsp;<span class="ident" id="6108302">err</span>&nbsp;<span class="op" id="6108306">=</span>&nbsp;<span class="ident" id="6108308">sfr</span><span class="op" id="6108311">.</span><span class="ident" id="6108312">rfr</span><span class="op" id="6108315">.</span><span class="ident" id="6108316">Read</span><span class="op" id="6108320">(</span><span class="ident" id="6108321">b</span><span class="op" id="6108322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108325">sfr</span><span class="op" id="6108328">.</span><span class="ident" id="6108329">pos</span>&nbsp;<span class="op" id="6108333">+=</span>&nbsp;<span class="ident" id="6108336">int64</span><span class="op" id="6108341">(</span><span class="ident" id="6108342">n</span><span class="op" id="6108343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6108347">if</span>&nbsp;<span class="ident" id="6108350">int64</span><span class="op" id="6108355">(</span><span class="ident" id="6108356">n</span><span class="op" id="6108357">)</span>&nbsp;<span class="op" id="6108359">==</span>&nbsp;<span class="ident" id="6108362">bytesLeft</span>&nbsp;<span class="op" id="6108372">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108376">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108411">sfr</span><span class="op" id="6108414">.</span><span class="ident" id="6108415">sp</span>&nbsp;<span class="op" id="6108418">=</span>&nbsp;<span class="ident" id="6108420">sfr</span><span class="op" id="6108423">.</span><span class="ident" id="6108424">sp</span><span class="op" id="6108426">[</span><span class="num" id="6108427">1</span><span class="op" id="6108428">:</span><span class="op" id="6108429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6108432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6108436">if</span>&nbsp;<span class="ident" id="6108439">err</span>&nbsp;<span class="op" id="6108443">==</span>&nbsp;<span class="ident" id="6108446">io</span><span class="op" id="6108448">.</span><span class="ident" id="6108449">EOF</span>&nbsp;<span class="op" id="6108453">&amp;&amp;</span>&nbsp;<span class="ident" id="6108456">sfr</span><span class="op" id="6108459">.</span><span class="ident" id="6108460">pos</span>&nbsp;<span class="op" id="6108464">&lt;</span>&nbsp;<span class="ident" id="6108466">sfr</span><span class="op" id="6108469">.</span><span class="ident" id="6108470">tot</span>&nbsp;<span class="op" id="6108474">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6108478">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6108556">err</span>&nbsp;<span class="op" id="6108560">=</span>&nbsp;<span class="ident" id="6108562">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6108567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6108570">return</span><br>
<span class="lineno"></span><span class="op" id="6108577">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="6108580">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6108654">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6108697">func</span>&nbsp;<span class="op" id="6108702">(</span><span class="ident" id="6108703">sfr</span>&nbsp;<span class="op" id="6108707">*</span><span class="ident" id="6108708">sparseFileReader</span><span class="op" id="6108724">)</span>&nbsp;<span class="ident" id="6108726">numBytes</span><span class="op" id="6108734">(</span><span class="op" id="6108735">)</span>&nbsp;<span class="ident" id="6108737">int64</span>&nbsp;<span class="op" id="6108743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6108746">return</span>&nbsp;<span class="ident" id="6108753">sfr</span><span class="op" id="6108756">.</span><span class="ident" id="6108757">rfr</span><span class="op" id="6108760">.</span><span class="ident" id="6108761">nb</span><br>
<span class="lineno">820</span><span class="op" id="6108764">}</span>
</div>
</body>
</html>
