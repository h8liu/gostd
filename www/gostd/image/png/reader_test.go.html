<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8462718">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8462773">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8462827">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8462878">package</span>&nbsp;<span class="ident" id="8462886">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462891">import</span>&nbsp;<span class="op" id="8462898">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462901">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462910">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462917">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462926">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462941">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462947">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462960">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462966">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8462977">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8462987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462990">var</span>&nbsp;<span class="ident" id="8462994">filenames</span>&nbsp;<span class="op" id="8463004">=</span>&nbsp;<span class="op" id="8463006">[</span><span class="op" id="8463007">]</span><span class="builtintype" id="8463008">string</span><span class="op" id="8463014">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463017">&#34;basn0g01&#34;</span><span class="op" id="8463027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463030">&#34;basn0g01-30&#34;</span><span class="op" id="8463043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463046">&#34;basn0g02&#34;</span><span class="op" id="8463056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463059">&#34;basn0g02-29&#34;</span><span class="op" id="8463072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463075">&#34;basn0g04&#34;</span><span class="op" id="8463085">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463088">&#34;basn0g04-31&#34;</span><span class="op" id="8463101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463104">&#34;basn0g08&#34;</span><span class="op" id="8463114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463117">&#34;basn0g16&#34;</span><span class="op" id="8463127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463130">&#34;basn2c08&#34;</span><span class="op" id="8463140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463143">&#34;basn2c16&#34;</span><span class="op" id="8463153">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463156">&#34;basn3p01&#34;</span><span class="op" id="8463166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463169">&#34;basn3p02&#34;</span><span class="op" id="8463179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463182">&#34;basn3p04&#34;</span><span class="op" id="8463192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463195">&#34;basn3p04-31i&#34;</span><span class="op" id="8463209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463212">&#34;basn3p08&#34;</span><span class="op" id="8463222">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463225">&#34;basn3p08-trns&#34;</span><span class="op" id="8463240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463243">&#34;basn4a08&#34;</span><span class="op" id="8463253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463256">&#34;basn4a16&#34;</span><span class="op" id="8463266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463269">&#34;basn6a08&#34;</span><span class="op" id="8463279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463282">&#34;basn6a16&#34;</span><span class="op" id="8463292">,</span><br>
<span class="lineno">40</span><span class="op" id="8463294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8463297">var</span>&nbsp;<span class="ident" id="8463301">filenamesPaletted</span>&nbsp;<span class="op" id="8463319">=</span>&nbsp;<span class="op" id="8463321">[</span><span class="op" id="8463322">]</span><span class="builtintype" id="8463323">string</span><span class="op" id="8463329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463332">&#34;basn3p01&#34;</span><span class="op" id="8463342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463345">&#34;basn3p02&#34;</span><span class="op" id="8463355">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463358">&#34;basn3p04&#34;</span><span class="op" id="8463368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463371">&#34;basn3p08&#34;</span><span class="op" id="8463381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463384">&#34;basn3p08-trns&#34;</span><span class="op" id="8463399">,</span><br>
<span class="lineno"></span><span class="op" id="8463401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8463404">var</span>&nbsp;<span class="ident" id="8463408">filenamesShort</span>&nbsp;<span class="op" id="8463423">=</span>&nbsp;<span class="op" id="8463425">[</span><span class="op" id="8463426">]</span><span class="builtintype" id="8463427">string</span><span class="op" id="8463433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463436">&#34;basn0g01&#34;</span><span class="op" id="8463446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463449">&#34;basn0g04-31&#34;</span><span class="op" id="8463462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8463465">&#34;basn6a16&#34;</span><span class="op" id="8463475">,</span><br>
<span class="lineno"></span><span class="op" id="8463477">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8463480">func</span>&nbsp;<span class="ident" id="8463485">readPNG</span><span class="op" id="8463492">(</span><span class="ident" id="8463493">filename</span>&nbsp;<span class="builtintype" id="8463502">string</span><span class="op" id="8463508">)</span>&nbsp;<span class="op" id="8463510">(</span><span class="ident" id="8463511">image</span><span class="op" id="8463516">.</span><span class="ident" id="8463517">Image</span><span class="op" id="8463522">,</span>&nbsp;<span class="builtintype" id="8463524">error</span><span class="op" id="8463529">)</span>&nbsp;<span class="op" id="8463531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463534">f</span><span class="op" id="8463535">,</span>&nbsp;<span class="ident" id="8463537">err</span>&nbsp;<span class="op" id="8463541">:=</span>&nbsp;<span class="ident" id="8463544">os</span><span class="op" id="8463546">.</span><span class="ident" id="8463547">Open</span><span class="op" id="8463551">(</span><span class="ident" id="8463552">filename</span><span class="op" id="8463560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463563">if</span>&nbsp;<span class="ident" id="8463566">err</span>&nbsp;<span class="op" id="8463570">!=</span>&nbsp;<span class="ident" id="8463573">nil</span>&nbsp;<span class="op" id="8463577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463581">return</span>&nbsp;<span class="ident" id="8463588">nil</span><span class="op" id="8463591">,</span>&nbsp;<span class="ident" id="8463593">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463601">defer</span>&nbsp;<span class="ident" id="8463607">f</span><span class="op" id="8463608">.</span><span class="ident" id="8463609">Close</span><span class="op" id="8463614">(</span><span class="op" id="8463615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463618">return</span>&nbsp;<span class="ident" id="8463625">Decode</span><span class="op" id="8463631">(</span><span class="ident" id="8463632">f</span><span class="op" id="8463633">)</span><br>
<span class="lineno"></span><span class="op" id="8463635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="8463638">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="8463688">func</span>&nbsp;<span class="ident" id="8463693">sng</span><span class="op" id="8463696">(</span><span class="ident" id="8463697">w</span>&nbsp;<span class="ident" id="8463699">io</span><span class="op" id="8463701">.</span><span class="ident" id="8463702">WriteCloser</span><span class="op" id="8463713">,</span>&nbsp;<span class="ident" id="8463715">filename</span>&nbsp;<span class="builtintype" id="8463724">string</span><span class="op" id="8463730">,</span>&nbsp;<span class="ident" id="8463732">png</span>&nbsp;<span class="ident" id="8463736">image</span><span class="op" id="8463741">.</span><span class="ident" id="8463742">Image</span><span class="op" id="8463747">)</span>&nbsp;<span class="op" id="8463749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463752">defer</span>&nbsp;<span class="ident" id="8463758">w</span><span class="op" id="8463759">.</span><span class="ident" id="8463760">Close</span><span class="op" id="8463765">(</span><span class="op" id="8463766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463769">bounds</span>&nbsp;<span class="op" id="8463776">:=</span>&nbsp;<span class="ident" id="8463779">png</span><span class="op" id="8463782">.</span><span class="ident" id="8463783">Bounds</span><span class="op" id="8463789">(</span><span class="op" id="8463790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463793">cm</span>&nbsp;<span class="op" id="8463796">:=</span>&nbsp;<span class="ident" id="8463799">png</span><span class="op" id="8463802">.</span><span class="ident" id="8463803">ColorModel</span><span class="op" id="8463813">(</span><span class="op" id="8463814">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463817">var</span>&nbsp;<span class="ident" id="8463821">bitdepth</span>&nbsp;<span class="builtintype" id="8463830">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463835">switch</span>&nbsp;<span class="ident" id="8463842">cm</span>&nbsp;<span class="op" id="8463845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463848">case</span>&nbsp;<span class="ident" id="8463853">color</span><span class="op" id="8463858">.</span><span class="ident" id="8463859">RGBAModel</span><span class="op" id="8463868">,</span>&nbsp;<span class="ident" id="8463870">color</span><span class="op" id="8463875">.</span><span class="ident" id="8463876">NRGBAModel</span><span class="op" id="8463886">,</span>&nbsp;<span class="ident" id="8463888">color</span><span class="op" id="8463893">.</span><span class="ident" id="8463894">AlphaModel</span><span class="op" id="8463904">,</span>&nbsp;<span class="ident" id="8463906">color</span><span class="op" id="8463911">.</span><span class="ident" id="8463912">GrayModel</span><span class="op" id="8463921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463925">bitdepth</span>&nbsp;<span class="op" id="8463934">=</span>&nbsp;<span class="num" id="8463936">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463939">default</span><span class="op" id="8463946">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463950">bitdepth</span>&nbsp;<span class="op" id="8463959">=</span>&nbsp;<span class="num" id="8463961">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463968">cpm</span><span class="op" id="8463971">,</span>&nbsp;<span class="ident" id="8463973">_</span>&nbsp;<span class="op" id="8463975">:=</span>&nbsp;<span class="ident" id="8463978">cm</span><span class="op" id="8463980">.</span><span class="op" id="8463981">(</span><span class="ident" id="8463982">color</span><span class="op" id="8463987">.</span><span class="ident" id="8463988">Palette</span><span class="op" id="8463995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463998">var</span>&nbsp;<span class="ident" id="8464002">paletted</span>&nbsp;<span class="op" id="8464011">*</span><span class="ident" id="8464012">image</span><span class="op" id="8464017">.</span><span class="ident" id="8464018">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464028">if</span>&nbsp;<span class="ident" id="8464031">cpm</span>&nbsp;<span class="op" id="8464035">!=</span>&nbsp;<span class="ident" id="8464038">nil</span>&nbsp;<span class="op" id="8464042">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464046">switch</span>&nbsp;<span class="op" id="8464053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464057">case</span>&nbsp;<span class="builtinfunc" id="8464062">len</span><span class="op" id="8464065">(</span><span class="ident" id="8464066">cpm</span><span class="op" id="8464069">)</span>&nbsp;<span class="op" id="8464071">&lt;=</span>&nbsp;<span class="num" id="8464074">2</span><span class="op" id="8464075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464080">bitdepth</span>&nbsp;<span class="op" id="8464089">=</span>&nbsp;<span class="num" id="8464091">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464095">case</span>&nbsp;<span class="builtinfunc" id="8464100">len</span><span class="op" id="8464103">(</span><span class="ident" id="8464104">cpm</span><span class="op" id="8464107">)</span>&nbsp;<span class="op" id="8464109">&lt;=</span>&nbsp;<span class="num" id="8464112">4</span><span class="op" id="8464113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464118">bitdepth</span>&nbsp;<span class="op" id="8464127">=</span>&nbsp;<span class="num" id="8464129">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464133">case</span>&nbsp;<span class="builtinfunc" id="8464138">len</span><span class="op" id="8464141">(</span><span class="ident" id="8464142">cpm</span><span class="op" id="8464145">)</span>&nbsp;<span class="op" id="8464147">&lt;=</span>&nbsp;<span class="num" id="8464150">16</span><span class="op" id="8464152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464157">bitdepth</span>&nbsp;<span class="op" id="8464166">=</span>&nbsp;<span class="num" id="8464168">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464172">default</span><span class="op" id="8464179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464184">bitdepth</span>&nbsp;<span class="op" id="8464193">=</span>&nbsp;<span class="num" id="8464195">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464199">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464203">paletted</span>&nbsp;<span class="op" id="8464212">=</span>&nbsp;<span class="ident" id="8464214">png</span><span class="op" id="8464217">.</span><span class="op" id="8464218">(</span><span class="op" id="8464219">*</span><span class="ident" id="8464220">image</span><span class="op" id="8464225">.</span><span class="ident" id="8464226">Paletted</span><span class="op" id="8464234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8464241">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464274">io</span><span class="op" id="8464276">.</span><span class="ident" id="8464277">WriteString</span><span class="op" id="8464288">(</span><span class="ident" id="8464289">w</span><span class="op" id="8464290">,</span>&nbsp;<span class="string" id="8464292">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="8464305">+</span><span class="ident" id="8464306">filename</span><span class="op" id="8464314">+</span><span class="string" id="8464315">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="8464331">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464334">fmt</span><span class="op" id="8464337">.</span><span class="ident" id="8464338">Fprintf</span><span class="op" id="8464345">(</span><span class="ident" id="8464346">w</span><span class="op" id="8464347">,</span>&nbsp;<span class="string" id="8464349">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="8464393">,</span>&nbsp;<span class="ident" id="8464395">bounds</span><span class="op" id="8464401">.</span><span class="ident" id="8464402">Dx</span><span class="op" id="8464404">(</span><span class="op" id="8464405">)</span><span class="op" id="8464406">,</span>&nbsp;<span class="ident" id="8464408">bounds</span><span class="op" id="8464414">.</span><span class="ident" id="8464415">Dy</span><span class="op" id="8464417">(</span><span class="op" id="8464418">)</span><span class="op" id="8464419">,</span>&nbsp;<span class="ident" id="8464421">bitdepth</span><span class="op" id="8464429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464432">switch</span>&nbsp;<span class="op" id="8464439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464442">case</span>&nbsp;<span class="ident" id="8464447">cm</span>&nbsp;<span class="op" id="8464450">==</span>&nbsp;<span class="ident" id="8464453">color</span><span class="op" id="8464458">.</span><span class="ident" id="8464459">RGBAModel</span><span class="op" id="8464468">,</span>&nbsp;<span class="ident" id="8464470">cm</span>&nbsp;<span class="op" id="8464473">==</span>&nbsp;<span class="ident" id="8464476">color</span><span class="op" id="8464481">.</span><span class="ident" id="8464482">RGBA64Model</span><span class="op" id="8464493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464497">io</span><span class="op" id="8464499">.</span><span class="ident" id="8464500">WriteString</span><span class="op" id="8464511">(</span><span class="ident" id="8464512">w</span><span class="op" id="8464513">,</span>&nbsp;<span class="string" id="8464515">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="8464535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464538">case</span>&nbsp;<span class="ident" id="8464543">cm</span>&nbsp;<span class="op" id="8464546">==</span>&nbsp;<span class="ident" id="8464549">color</span><span class="op" id="8464554">.</span><span class="ident" id="8464555">NRGBAModel</span><span class="op" id="8464565">,</span>&nbsp;<span class="ident" id="8464567">cm</span>&nbsp;<span class="op" id="8464570">==</span>&nbsp;<span class="ident" id="8464573">color</span><span class="op" id="8464578">.</span><span class="ident" id="8464579">NRGBA64Model</span><span class="op" id="8464591">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464595">io</span><span class="op" id="8464597">.</span><span class="ident" id="8464598">WriteString</span><span class="op" id="8464609">(</span><span class="ident" id="8464610">w</span><span class="op" id="8464611">,</span>&nbsp;<span class="string" id="8464613">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="8464639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464642">case</span>&nbsp;<span class="ident" id="8464647">cm</span>&nbsp;<span class="op" id="8464650">==</span>&nbsp;<span class="ident" id="8464653">color</span><span class="op" id="8464658">.</span><span class="ident" id="8464659">GrayModel</span><span class="op" id="8464668">,</span>&nbsp;<span class="ident" id="8464670">cm</span>&nbsp;<span class="op" id="8464673">==</span>&nbsp;<span class="ident" id="8464676">color</span><span class="op" id="8464681">.</span><span class="ident" id="8464682">Gray16Model</span><span class="op" id="8464693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464697">io</span><span class="op" id="8464699">.</span><span class="ident" id="8464700">WriteString</span><span class="op" id="8464711">(</span><span class="ident" id="8464712">w</span><span class="op" id="8464713">,</span>&nbsp;<span class="string" id="8464715">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="8464739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464742">case</span>&nbsp;<span class="ident" id="8464747">cpm</span>&nbsp;<span class="op" id="8464751">!=</span>&nbsp;<span class="ident" id="8464754">nil</span><span class="op" id="8464757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464761">io</span><span class="op" id="8464763">.</span><span class="ident" id="8464764">WriteString</span><span class="op" id="8464775">(</span><span class="ident" id="8464776">w</span><span class="op" id="8464777">,</span>&nbsp;<span class="string" id="8464779">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="8464807">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464810">default</span><span class="op" id="8464817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464821">io</span><span class="op" id="8464823">.</span><span class="ident" id="8464824">WriteString</span><span class="op" id="8464835">(</span><span class="ident" id="8464836">w</span><span class="op" id="8464837">,</span>&nbsp;<span class="string" id="8464839">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="8464874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464880">io</span><span class="op" id="8464882">.</span><span class="ident" id="8464883">WriteString</span><span class="op" id="8464894">(</span><span class="ident" id="8464895">w</span><span class="op" id="8464896">,</span>&nbsp;<span class="string" id="8464898">&#34;}\n&#34;</span><span class="op" id="8464903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8464907">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465000">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465085">io</span><span class="op" id="8465087">.</span><span class="ident" id="8465088">WriteString</span><span class="op" id="8465099">(</span><span class="ident" id="8465100">w</span><span class="op" id="8465101">,</span>&nbsp;<span class="string" id="8465103">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="8465120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465124">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465169">if</span>&nbsp;<span class="ident" id="8465172">cpm</span>&nbsp;<span class="op" id="8465176">!=</span>&nbsp;<span class="ident" id="8465179">nil</span>&nbsp;<span class="op" id="8465183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465187">lastAlpha</span>&nbsp;<span class="op" id="8465197">:=</span>&nbsp;<span class="op" id="8465200">-</span><span class="num" id="8465201">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465205">io</span><span class="op" id="8465207">.</span><span class="ident" id="8465208">WriteString</span><span class="op" id="8465219">(</span><span class="ident" id="8465220">w</span><span class="op" id="8465221">,</span>&nbsp;<span class="string" id="8465223">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="8465233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465237">for</span>&nbsp;<span class="ident" id="8465241">i</span><span class="op" id="8465242">,</span>&nbsp;<span class="ident" id="8465244">c</span>&nbsp;<span class="op" id="8465246">:=</span>&nbsp;<span class="keyword" id="8465249">range</span>&nbsp;<span class="ident" id="8465255">cpm</span>&nbsp;<span class="op" id="8465259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465264">var</span>&nbsp;<span class="ident" id="8465268">r</span><span class="op" id="8465269">,</span>&nbsp;<span class="ident" id="8465271">g</span><span class="op" id="8465272">,</span>&nbsp;<span class="ident" id="8465274">b</span><span class="op" id="8465275">,</span>&nbsp;<span class="ident" id="8465277">a</span>&nbsp;<span class="builtintype" id="8465279">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465288">switch</span>&nbsp;<span class="ident" id="8465295">c</span>&nbsp;<span class="op" id="8465297">:=</span>&nbsp;<span class="ident" id="8465300">c</span><span class="op" id="8465301">.</span><span class="op" id="8465302">(</span><span class="keyword" id="8465303">type</span><span class="op" id="8465307">)</span>&nbsp;<span class="op" id="8465309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465314">case</span>&nbsp;<span class="ident" id="8465319">color</span><span class="op" id="8465324">.</span><span class="ident" id="8465325">RGBA</span><span class="op" id="8465329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465335">r</span><span class="op" id="8465336">,</span>&nbsp;<span class="ident" id="8465338">g</span><span class="op" id="8465339">,</span>&nbsp;<span class="ident" id="8465341">b</span><span class="op" id="8465342">,</span>&nbsp;<span class="ident" id="8465344">a</span>&nbsp;<span class="op" id="8465346">=</span>&nbsp;<span class="ident" id="8465348">c</span><span class="op" id="8465349">.</span><span class="ident" id="8465350">R</span><span class="op" id="8465351">,</span>&nbsp;<span class="ident" id="8465353">c</span><span class="op" id="8465354">.</span><span class="ident" id="8465355">G</span><span class="op" id="8465356">,</span>&nbsp;<span class="ident" id="8465358">c</span><span class="op" id="8465359">.</span><span class="ident" id="8465360">B</span><span class="op" id="8465361">,</span>&nbsp;<span class="num" id="8465363">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465371">case</span>&nbsp;<span class="ident" id="8465376">color</span><span class="op" id="8465381">.</span><span class="ident" id="8465382">NRGBA</span><span class="op" id="8465387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465393">r</span><span class="op" id="8465394">,</span>&nbsp;<span class="ident" id="8465396">g</span><span class="op" id="8465397">,</span>&nbsp;<span class="ident" id="8465399">b</span><span class="op" id="8465400">,</span>&nbsp;<span class="ident" id="8465402">a</span>&nbsp;<span class="op" id="8465404">=</span>&nbsp;<span class="ident" id="8465406">c</span><span class="op" id="8465407">.</span><span class="ident" id="8465408">R</span><span class="op" id="8465409">,</span>&nbsp;<span class="ident" id="8465411">c</span><span class="op" id="8465412">.</span><span class="ident" id="8465413">G</span><span class="op" id="8465414">,</span>&nbsp;<span class="ident" id="8465416">c</span><span class="op" id="8465417">.</span><span class="ident" id="8465418">B</span><span class="op" id="8465419">,</span>&nbsp;<span class="ident" id="8465421">c</span><span class="op" id="8465422">.</span><span class="ident" id="8465423">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465428">default</span><span class="op" id="8465435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8465441">panic</span><span class="op" id="8465446">(</span><span class="string" id="8465447">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="8465475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465485">if</span>&nbsp;<span class="ident" id="8465488">a</span>&nbsp;<span class="op" id="8465490">!=</span>&nbsp;<span class="num" id="8465493">0xff</span>&nbsp;<span class="op" id="8465498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465504">lastAlpha</span>&nbsp;<span class="op" id="8465514">=</span>&nbsp;<span class="ident" id="8465516">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465526">fmt</span><span class="op" id="8465529">.</span><span class="ident" id="8465530">Fprintf</span><span class="op" id="8465537">(</span><span class="ident" id="8465538">w</span><span class="op" id="8465539">,</span>&nbsp;<span class="string" id="8465541">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="8465597">,</span>&nbsp;<span class="ident" id="8465599">r</span><span class="op" id="8465600">,</span>&nbsp;<span class="ident" id="8465602">g</span><span class="op" id="8465603">,</span>&nbsp;<span class="ident" id="8465605">b</span><span class="op" id="8465606">,</span>&nbsp;<span class="ident" id="8465608">r</span><span class="op" id="8465609">,</span>&nbsp;<span class="ident" id="8465611">g</span><span class="op" id="8465612">,</span>&nbsp;<span class="ident" id="8465614">b</span><span class="op" id="8465615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465623">io</span><span class="op" id="8465625">.</span><span class="ident" id="8465626">WriteString</span><span class="op" id="8465637">(</span><span class="ident" id="8465638">w</span><span class="op" id="8465639">,</span>&nbsp;<span class="string" id="8465641">&#34;}\n&#34;</span><span class="op" id="8465646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465650">if</span>&nbsp;<span class="ident" id="8465653">lastAlpha</span>&nbsp;<span class="op" id="8465663">!=</span>&nbsp;<span class="op" id="8465666">-</span><span class="num" id="8465667">1</span>&nbsp;<span class="op" id="8465669">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465674">io</span><span class="op" id="8465676">.</span><span class="ident" id="8465677">WriteString</span><span class="op" id="8465688">(</span><span class="ident" id="8465689">w</span><span class="op" id="8465690">,</span>&nbsp;<span class="string" id="8465692">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="8465702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465707">for</span>&nbsp;<span class="ident" id="8465711">i</span>&nbsp;<span class="op" id="8465713">:=</span>&nbsp;<span class="num" id="8465716">0</span><span class="op" id="8465717">;</span>&nbsp;<span class="ident" id="8465719">i</span>&nbsp;<span class="op" id="8465721">&lt;=</span>&nbsp;<span class="ident" id="8465724">lastAlpha</span><span class="op" id="8465733">;</span>&nbsp;<span class="ident" id="8465735">i</span><span class="op" id="8465736">++</span>&nbsp;<span class="op" id="8465739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465745">_</span><span class="op" id="8465746">,</span>&nbsp;<span class="ident" id="8465748">_</span><span class="op" id="8465749">,</span>&nbsp;<span class="ident" id="8465751">_</span><span class="op" id="8465752">,</span>&nbsp;<span class="ident" id="8465754">a</span>&nbsp;<span class="op" id="8465756">:=</span>&nbsp;<span class="ident" id="8465759">cpm</span><span class="op" id="8465762">[</span><span class="ident" id="8465763">i</span><span class="op" id="8465764">]</span><span class="op" id="8465765">.</span><span class="ident" id="8465766">RGBA</span><span class="op" id="8465770">(</span><span class="op" id="8465771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465777">a</span>&nbsp;<span class="op" id="8465779">&gt;&gt;=</span>&nbsp;<span class="num" id="8465783">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465789">fmt</span><span class="op" id="8465792">.</span><span class="ident" id="8465793">Fprintf</span><span class="op" id="8465800">(</span><span class="ident" id="8465801">w</span><span class="op" id="8465802">,</span>&nbsp;<span class="string" id="8465804">&#34;&nbsp;%d&#34;</span><span class="op" id="8465809">,</span>&nbsp;<span class="ident" id="8465811">a</span><span class="op" id="8465812">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465822">io</span><span class="op" id="8465824">.</span><span class="ident" id="8465825">WriteString</span><span class="op" id="8465836">(</span><span class="ident" id="8465837">w</span><span class="op" id="8465838">,</span>&nbsp;<span class="string" id="8465840">&#34;}\n&#34;</span><span class="op" id="8465845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465856">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465877">io</span><span class="op" id="8465879">.</span><span class="ident" id="8465880">WriteString</span><span class="op" id="8465891">(</span><span class="ident" id="8465892">w</span><span class="op" id="8465893">,</span>&nbsp;<span class="string" id="8465895">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="8465922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465925">for</span>&nbsp;<span class="ident" id="8465929">y</span>&nbsp;<span class="op" id="8465931">:=</span>&nbsp;<span class="ident" id="8465934">bounds</span><span class="op" id="8465940">.</span><span class="ident" id="8465941">Min</span><span class="op" id="8465944">.</span><span class="ident" id="8465945">Y</span><span class="op" id="8465946">;</span>&nbsp;<span class="ident" id="8465948">y</span>&nbsp;<span class="op" id="8465950">&lt;</span>&nbsp;<span class="ident" id="8465952">bounds</span><span class="op" id="8465958">.</span><span class="ident" id="8465959">Max</span><span class="op" id="8465962">.</span><span class="ident" id="8465963">Y</span><span class="op" id="8465964">;</span>&nbsp;<span class="ident" id="8465966">y</span><span class="op" id="8465967">++</span>&nbsp;<span class="op" id="8465970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465974">switch</span>&nbsp;<span class="op" id="8465981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465985">case</span>&nbsp;<span class="ident" id="8465990">cm</span>&nbsp;<span class="op" id="8465993">==</span>&nbsp;<span class="ident" id="8465996">color</span><span class="op" id="8466001">.</span><span class="ident" id="8466002">GrayModel</span><span class="op" id="8466011">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466016">for</span>&nbsp;<span class="ident" id="8466020">x</span>&nbsp;<span class="op" id="8466022">:=</span>&nbsp;<span class="ident" id="8466025">bounds</span><span class="op" id="8466031">.</span><span class="ident" id="8466032">Min</span><span class="op" id="8466035">.</span><span class="ident" id="8466036">X</span><span class="op" id="8466037">;</span>&nbsp;<span class="ident" id="8466039">x</span>&nbsp;<span class="op" id="8466041">&lt;</span>&nbsp;<span class="ident" id="8466043">bounds</span><span class="op" id="8466049">.</span><span class="ident" id="8466050">Max</span><span class="op" id="8466053">.</span><span class="ident" id="8466054">X</span><span class="op" id="8466055">;</span>&nbsp;<span class="ident" id="8466057">x</span><span class="op" id="8466058">++</span>&nbsp;<span class="op" id="8466061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466067">gray</span>&nbsp;<span class="op" id="8466072">:=</span>&nbsp;<span class="ident" id="8466075">png</span><span class="op" id="8466078">.</span><span class="ident" id="8466079">At</span><span class="op" id="8466081">(</span><span class="ident" id="8466082">x</span><span class="op" id="8466083">,</span>&nbsp;<span class="ident" id="8466085">y</span><span class="op" id="8466086">)</span><span class="op" id="8466087">.</span><span class="op" id="8466088">(</span><span class="ident" id="8466089">color</span><span class="op" id="8466094">.</span><span class="ident" id="8466095">Gray</span><span class="op" id="8466099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466105">fmt</span><span class="op" id="8466108">.</span><span class="ident" id="8466109">Fprintf</span><span class="op" id="8466116">(</span><span class="ident" id="8466117">w</span><span class="op" id="8466118">,</span>&nbsp;<span class="string" id="8466120">&#34;%02x&#34;</span><span class="op" id="8466126">,</span>&nbsp;<span class="ident" id="8466128">gray</span><span class="op" id="8466132">.</span><span class="ident" id="8466133">Y</span><span class="op" id="8466134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466143">case</span>&nbsp;<span class="ident" id="8466148">cm</span>&nbsp;<span class="op" id="8466151">==</span>&nbsp;<span class="ident" id="8466154">color</span><span class="op" id="8466159">.</span><span class="ident" id="8466160">Gray16Model</span><span class="op" id="8466171">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466176">for</span>&nbsp;<span class="ident" id="8466180">x</span>&nbsp;<span class="op" id="8466182">:=</span>&nbsp;<span class="ident" id="8466185">bounds</span><span class="op" id="8466191">.</span><span class="ident" id="8466192">Min</span><span class="op" id="8466195">.</span><span class="ident" id="8466196">X</span><span class="op" id="8466197">;</span>&nbsp;<span class="ident" id="8466199">x</span>&nbsp;<span class="op" id="8466201">&lt;</span>&nbsp;<span class="ident" id="8466203">bounds</span><span class="op" id="8466209">.</span><span class="ident" id="8466210">Max</span><span class="op" id="8466213">.</span><span class="ident" id="8466214">X</span><span class="op" id="8466215">;</span>&nbsp;<span class="ident" id="8466217">x</span><span class="op" id="8466218">++</span>&nbsp;<span class="op" id="8466221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466227">gray16</span>&nbsp;<span class="op" id="8466234">:=</span>&nbsp;<span class="ident" id="8466237">png</span><span class="op" id="8466240">.</span><span class="ident" id="8466241">At</span><span class="op" id="8466243">(</span><span class="ident" id="8466244">x</span><span class="op" id="8466245">,</span>&nbsp;<span class="ident" id="8466247">y</span><span class="op" id="8466248">)</span><span class="op" id="8466249">.</span><span class="op" id="8466250">(</span><span class="ident" id="8466251">color</span><span class="op" id="8466256">.</span><span class="ident" id="8466257">Gray16</span><span class="op" id="8466263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466269">fmt</span><span class="op" id="8466272">.</span><span class="ident" id="8466273">Fprintf</span><span class="op" id="8466280">(</span><span class="ident" id="8466281">w</span><span class="op" id="8466282">,</span>&nbsp;<span class="string" id="8466284">&#34;%04x&nbsp;&#34;</span><span class="op" id="8466291">,</span>&nbsp;<span class="ident" id="8466293">gray16</span><span class="op" id="8466299">.</span><span class="ident" id="8466300">Y</span><span class="op" id="8466301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466310">case</span>&nbsp;<span class="ident" id="8466315">cm</span>&nbsp;<span class="op" id="8466318">==</span>&nbsp;<span class="ident" id="8466321">color</span><span class="op" id="8466326">.</span><span class="ident" id="8466327">RGBAModel</span><span class="op" id="8466336">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466341">for</span>&nbsp;<span class="ident" id="8466345">x</span>&nbsp;<span class="op" id="8466347">:=</span>&nbsp;<span class="ident" id="8466350">bounds</span><span class="op" id="8466356">.</span><span class="ident" id="8466357">Min</span><span class="op" id="8466360">.</span><span class="ident" id="8466361">X</span><span class="op" id="8466362">;</span>&nbsp;<span class="ident" id="8466364">x</span>&nbsp;<span class="op" id="8466366">&lt;</span>&nbsp;<span class="ident" id="8466368">bounds</span><span class="op" id="8466374">.</span><span class="ident" id="8466375">Max</span><span class="op" id="8466378">.</span><span class="ident" id="8466379">X</span><span class="op" id="8466380">;</span>&nbsp;<span class="ident" id="8466382">x</span><span class="op" id="8466383">++</span>&nbsp;<span class="op" id="8466386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466392">rgba</span>&nbsp;<span class="op" id="8466397">:=</span>&nbsp;<span class="ident" id="8466400">png</span><span class="op" id="8466403">.</span><span class="ident" id="8466404">At</span><span class="op" id="8466406">(</span><span class="ident" id="8466407">x</span><span class="op" id="8466408">,</span>&nbsp;<span class="ident" id="8466410">y</span><span class="op" id="8466411">)</span><span class="op" id="8466412">.</span><span class="op" id="8466413">(</span><span class="ident" id="8466414">color</span><span class="op" id="8466419">.</span><span class="ident" id="8466420">RGBA</span><span class="op" id="8466424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466430">fmt</span><span class="op" id="8466433">.</span><span class="ident" id="8466434">Fprintf</span><span class="op" id="8466441">(</span><span class="ident" id="8466442">w</span><span class="op" id="8466443">,</span>&nbsp;<span class="string" id="8466445">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8466460">,</span>&nbsp;<span class="ident" id="8466462">rgba</span><span class="op" id="8466466">.</span><span class="ident" id="8466467">R</span><span class="op" id="8466468">,</span>&nbsp;<span class="ident" id="8466470">rgba</span><span class="op" id="8466474">.</span><span class="ident" id="8466475">G</span><span class="op" id="8466476">,</span>&nbsp;<span class="ident" id="8466478">rgba</span><span class="op" id="8466482">.</span><span class="ident" id="8466483">B</span><span class="op" id="8466484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466493">case</span>&nbsp;<span class="ident" id="8466498">cm</span>&nbsp;<span class="op" id="8466501">==</span>&nbsp;<span class="ident" id="8466504">color</span><span class="op" id="8466509">.</span><span class="ident" id="8466510">RGBA64Model</span><span class="op" id="8466521">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466526">for</span>&nbsp;<span class="ident" id="8466530">x</span>&nbsp;<span class="op" id="8466532">:=</span>&nbsp;<span class="ident" id="8466535">bounds</span><span class="op" id="8466541">.</span><span class="ident" id="8466542">Min</span><span class="op" id="8466545">.</span><span class="ident" id="8466546">X</span><span class="op" id="8466547">;</span>&nbsp;<span class="ident" id="8466549">x</span>&nbsp;<span class="op" id="8466551">&lt;</span>&nbsp;<span class="ident" id="8466553">bounds</span><span class="op" id="8466559">.</span><span class="ident" id="8466560">Max</span><span class="op" id="8466563">.</span><span class="ident" id="8466564">X</span><span class="op" id="8466565">;</span>&nbsp;<span class="ident" id="8466567">x</span><span class="op" id="8466568">++</span>&nbsp;<span class="op" id="8466571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466577">rgba64</span>&nbsp;<span class="op" id="8466584">:=</span>&nbsp;<span class="ident" id="8466587">png</span><span class="op" id="8466590">.</span><span class="ident" id="8466591">At</span><span class="op" id="8466593">(</span><span class="ident" id="8466594">x</span><span class="op" id="8466595">,</span>&nbsp;<span class="ident" id="8466597">y</span><span class="op" id="8466598">)</span><span class="op" id="8466599">.</span><span class="op" id="8466600">(</span><span class="ident" id="8466601">color</span><span class="op" id="8466606">.</span><span class="ident" id="8466607">RGBA64</span><span class="op" id="8466613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466619">fmt</span><span class="op" id="8466622">.</span><span class="ident" id="8466623">Fprintf</span><span class="op" id="8466630">(</span><span class="ident" id="8466631">w</span><span class="op" id="8466632">,</span>&nbsp;<span class="string" id="8466634">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8466649">,</span>&nbsp;<span class="ident" id="8466651">rgba64</span><span class="op" id="8466657">.</span><span class="ident" id="8466658">R</span><span class="op" id="8466659">,</span>&nbsp;<span class="ident" id="8466661">rgba64</span><span class="op" id="8466667">.</span><span class="ident" id="8466668">G</span><span class="op" id="8466669">,</span>&nbsp;<span class="ident" id="8466671">rgba64</span><span class="op" id="8466677">.</span><span class="ident" id="8466678">B</span><span class="op" id="8466679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466688">case</span>&nbsp;<span class="ident" id="8466693">cm</span>&nbsp;<span class="op" id="8466696">==</span>&nbsp;<span class="ident" id="8466699">color</span><span class="op" id="8466704">.</span><span class="ident" id="8466705">NRGBAModel</span><span class="op" id="8466715">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466720">for</span>&nbsp;<span class="ident" id="8466724">x</span>&nbsp;<span class="op" id="8466726">:=</span>&nbsp;<span class="ident" id="8466729">bounds</span><span class="op" id="8466735">.</span><span class="ident" id="8466736">Min</span><span class="op" id="8466739">.</span><span class="ident" id="8466740">X</span><span class="op" id="8466741">;</span>&nbsp;<span class="ident" id="8466743">x</span>&nbsp;<span class="op" id="8466745">&lt;</span>&nbsp;<span class="ident" id="8466747">bounds</span><span class="op" id="8466753">.</span><span class="ident" id="8466754">Max</span><span class="op" id="8466757">.</span><span class="ident" id="8466758">X</span><span class="op" id="8466759">;</span>&nbsp;<span class="ident" id="8466761">x</span><span class="op" id="8466762">++</span>&nbsp;<span class="op" id="8466765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466771">nrgba</span>&nbsp;<span class="op" id="8466777">:=</span>&nbsp;<span class="ident" id="8466780">png</span><span class="op" id="8466783">.</span><span class="ident" id="8466784">At</span><span class="op" id="8466786">(</span><span class="ident" id="8466787">x</span><span class="op" id="8466788">,</span>&nbsp;<span class="ident" id="8466790">y</span><span class="op" id="8466791">)</span><span class="op" id="8466792">.</span><span class="op" id="8466793">(</span><span class="ident" id="8466794">color</span><span class="op" id="8466799">.</span><span class="ident" id="8466800">NRGBA</span><span class="op" id="8466805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466811">fmt</span><span class="op" id="8466814">.</span><span class="ident" id="8466815">Fprintf</span><span class="op" id="8466822">(</span><span class="ident" id="8466823">w</span><span class="op" id="8466824">,</span>&nbsp;<span class="string" id="8466826">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8466845">,</span>&nbsp;<span class="ident" id="8466847">nrgba</span><span class="op" id="8466852">.</span><span class="ident" id="8466853">R</span><span class="op" id="8466854">,</span>&nbsp;<span class="ident" id="8466856">nrgba</span><span class="op" id="8466861">.</span><span class="ident" id="8466862">G</span><span class="op" id="8466863">,</span>&nbsp;<span class="ident" id="8466865">nrgba</span><span class="op" id="8466870">.</span><span class="ident" id="8466871">B</span><span class="op" id="8466872">,</span>&nbsp;<span class="ident" id="8466874">nrgba</span><span class="op" id="8466879">.</span><span class="ident" id="8466880">A</span><span class="op" id="8466881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466890">case</span>&nbsp;<span class="ident" id="8466895">cm</span>&nbsp;<span class="op" id="8466898">==</span>&nbsp;<span class="ident" id="8466901">color</span><span class="op" id="8466906">.</span><span class="ident" id="8466907">NRGBA64Model</span><span class="op" id="8466919">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466924">for</span>&nbsp;<span class="ident" id="8466928">x</span>&nbsp;<span class="op" id="8466930">:=</span>&nbsp;<span class="ident" id="8466933">bounds</span><span class="op" id="8466939">.</span><span class="ident" id="8466940">Min</span><span class="op" id="8466943">.</span><span class="ident" id="8466944">X</span><span class="op" id="8466945">;</span>&nbsp;<span class="ident" id="8466947">x</span>&nbsp;<span class="op" id="8466949">&lt;</span>&nbsp;<span class="ident" id="8466951">bounds</span><span class="op" id="8466957">.</span><span class="ident" id="8466958">Max</span><span class="op" id="8466961">.</span><span class="ident" id="8466962">X</span><span class="op" id="8466963">;</span>&nbsp;<span class="ident" id="8466965">x</span><span class="op" id="8466966">++</span>&nbsp;<span class="op" id="8466969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466975">nrgba64</span>&nbsp;<span class="op" id="8466983">:=</span>&nbsp;<span class="ident" id="8466986">png</span><span class="op" id="8466989">.</span><span class="ident" id="8466990">At</span><span class="op" id="8466992">(</span><span class="ident" id="8466993">x</span><span class="op" id="8466994">,</span>&nbsp;<span class="ident" id="8466996">y</span><span class="op" id="8466997">)</span><span class="op" id="8466998">.</span><span class="op" id="8466999">(</span><span class="ident" id="8467000">color</span><span class="op" id="8467005">.</span><span class="ident" id="8467006">NRGBA64</span><span class="op" id="8467013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467019">fmt</span><span class="op" id="8467022">.</span><span class="ident" id="8467023">Fprintf</span><span class="op" id="8467030">(</span><span class="ident" id="8467031">w</span><span class="op" id="8467032">,</span>&nbsp;<span class="string" id="8467034">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8467053">,</span>&nbsp;<span class="ident" id="8467055">nrgba64</span><span class="op" id="8467062">.</span><span class="ident" id="8467063">R</span><span class="op" id="8467064">,</span>&nbsp;<span class="ident" id="8467066">nrgba64</span><span class="op" id="8467073">.</span><span class="ident" id="8467074">G</span><span class="op" id="8467075">,</span>&nbsp;<span class="ident" id="8467077">nrgba64</span><span class="op" id="8467084">.</span><span class="ident" id="8467085">B</span><span class="op" id="8467086">,</span>&nbsp;<span class="ident" id="8467088">nrgba64</span><span class="op" id="8467095">.</span><span class="ident" id="8467096">A</span><span class="op" id="8467097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467106">case</span>&nbsp;<span class="ident" id="8467111">cpm</span>&nbsp;<span class="op" id="8467115">!=</span>&nbsp;<span class="ident" id="8467118">nil</span><span class="op" id="8467121">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467126">var</span>&nbsp;<span class="ident" id="8467130">b</span><span class="op" id="8467131">,</span>&nbsp;<span class="ident" id="8467133">c</span>&nbsp;<span class="builtintype" id="8467135">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467142">for</span>&nbsp;<span class="ident" id="8467146">x</span>&nbsp;<span class="op" id="8467148">:=</span>&nbsp;<span class="ident" id="8467151">bounds</span><span class="op" id="8467157">.</span><span class="ident" id="8467158">Min</span><span class="op" id="8467161">.</span><span class="ident" id="8467162">X</span><span class="op" id="8467163">;</span>&nbsp;<span class="ident" id="8467165">x</span>&nbsp;<span class="op" id="8467167">&lt;</span>&nbsp;<span class="ident" id="8467169">bounds</span><span class="op" id="8467175">.</span><span class="ident" id="8467176">Max</span><span class="op" id="8467179">.</span><span class="ident" id="8467180">X</span><span class="op" id="8467181">;</span>&nbsp;<span class="ident" id="8467183">x</span><span class="op" id="8467184">++</span>&nbsp;<span class="op" id="8467187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467193">b</span>&nbsp;<span class="op" id="8467195">=</span>&nbsp;<span class="ident" id="8467197">b</span><span class="op" id="8467198">&lt;&lt;</span><span class="builtintype" id="8467200">uint</span><span class="op" id="8467204">(</span><span class="ident" id="8467205">bitdepth</span><span class="op" id="8467213">)</span>&nbsp;<span class="op" id="8467215">|</span>&nbsp;<span class="builtintype" id="8467217">int</span><span class="op" id="8467220">(</span><span class="ident" id="8467221">paletted</span><span class="op" id="8467229">.</span><span class="ident" id="8467230">ColorIndexAt</span><span class="op" id="8467242">(</span><span class="ident" id="8467243">x</span><span class="op" id="8467244">,</span>&nbsp;<span class="ident" id="8467246">y</span><span class="op" id="8467247">)</span><span class="op" id="8467248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467254">c</span><span class="op" id="8467255">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467262">if</span>&nbsp;<span class="ident" id="8467265">c</span>&nbsp;<span class="op" id="8467267">==</span>&nbsp;<span class="num" id="8467270">8</span><span class="op" id="8467271">/</span><span class="ident" id="8467272">bitdepth</span>&nbsp;<span class="op" id="8467281">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467288">fmt</span><span class="op" id="8467291">.</span><span class="ident" id="8467292">Fprintf</span><span class="op" id="8467299">(</span><span class="ident" id="8467300">w</span><span class="op" id="8467301">,</span>&nbsp;<span class="string" id="8467303">&#34;%02x&#34;</span><span class="op" id="8467309">,</span>&nbsp;<span class="ident" id="8467311">b</span><span class="op" id="8467312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467319">b</span>&nbsp;<span class="op" id="8467321">=</span>&nbsp;<span class="num" id="8467323">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467330">c</span>&nbsp;<span class="op" id="8467332">=</span>&nbsp;<span class="num" id="8467334">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467345">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467350">if</span>&nbsp;<span class="ident" id="8467353">c</span>&nbsp;<span class="op" id="8467355">!=</span>&nbsp;<span class="num" id="8467358">0</span>&nbsp;<span class="op" id="8467360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467366">for</span>&nbsp;<span class="ident" id="8467370">c</span>&nbsp;<span class="op" id="8467372">!=</span>&nbsp;<span class="num" id="8467375">8</span><span class="op" id="8467376">/</span><span class="ident" id="8467377">bitdepth</span>&nbsp;<span class="op" id="8467386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467393">b</span>&nbsp;<span class="op" id="8467395">=</span>&nbsp;<span class="ident" id="8467397">b</span>&nbsp;<span class="op" id="8467399">&lt;&lt;</span>&nbsp;<span class="builtintype" id="8467402">uint</span><span class="op" id="8467406">(</span><span class="ident" id="8467407">bitdepth</span><span class="op" id="8467415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467422">c</span><span class="op" id="8467423">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467430">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467436">fmt</span><span class="op" id="8467439">.</span><span class="ident" id="8467440">Fprintf</span><span class="op" id="8467447">(</span><span class="ident" id="8467448">w</span><span class="op" id="8467449">,</span>&nbsp;<span class="string" id="8467451">&#34;%02x&#34;</span><span class="op" id="8467457">,</span>&nbsp;<span class="ident" id="8467459">b</span><span class="op" id="8467460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467473">io</span><span class="op" id="8467475">.</span><span class="ident" id="8467476">WriteString</span><span class="op" id="8467487">(</span><span class="ident" id="8467488">w</span><span class="op" id="8467489">,</span>&nbsp;<span class="string" id="8467491">&#34;\n&#34;</span><span class="op" id="8467495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467498">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467501">io</span><span class="op" id="8467503">.</span><span class="ident" id="8467504">WriteString</span><span class="op" id="8467515">(</span><span class="ident" id="8467516">w</span><span class="op" id="8467517">,</span>&nbsp;<span class="string" id="8467519">&#34;}\n&#34;</span><span class="op" id="8467524">)</span><br>
<span class="lineno"></span><span class="op" id="8467526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8467529">func</span>&nbsp;<span class="ident" id="8467534">TestReader</span><span class="op" id="8467544">(</span><span class="ident" id="8467545">t</span>&nbsp;<span class="op" id="8467547">*</span><span class="ident" id="8467548">testing</span><span class="op" id="8467555">.</span><span class="ident" id="8467556">T</span><span class="op" id="8467557">)</span>&nbsp;<span class="op" id="8467559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467562">names</span>&nbsp;<span class="op" id="8467568">:=</span>&nbsp;<span class="ident" id="8467571">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467582">if</span>&nbsp;<span class="ident" id="8467585">testing</span><span class="op" id="8467592">.</span><span class="ident" id="8467593">Short</span><span class="op" id="8467598">(</span><span class="op" id="8467599">)</span>&nbsp;<span class="op" id="8467601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467605">names</span>&nbsp;<span class="op" id="8467611">=</span>&nbsp;<span class="ident" id="8467613">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467632">for</span>&nbsp;<span class="ident" id="8467636">_</span><span class="op" id="8467637">,</span>&nbsp;<span class="ident" id="8467639">fn</span>&nbsp;<span class="op" id="8467642">:=</span>&nbsp;<span class="keyword" id="8467645">range</span>&nbsp;<span class="ident" id="8467651">names</span>&nbsp;<span class="op" id="8467657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467661">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467686">img</span><span class="op" id="8467689">,</span>&nbsp;<span class="ident" id="8467691">err</span>&nbsp;<span class="op" id="8467695">:=</span>&nbsp;<span class="ident" id="8467698">readPNG</span><span class="op" id="8467705">(</span><span class="string" id="8467706">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8467727">+</span>&nbsp;<span class="ident" id="8467729">fn</span>&nbsp;<span class="op" id="8467732">+</span>&nbsp;<span class="string" id="8467734">&#34;.png&#34;</span><span class="op" id="8467740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467744">if</span>&nbsp;<span class="ident" id="8467747">err</span>&nbsp;<span class="op" id="8467751">!=</span>&nbsp;<span class="ident" id="8467754">nil</span>&nbsp;<span class="op" id="8467758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467763">t</span><span class="op" id="8467764">.</span><span class="ident" id="8467765">Error</span><span class="op" id="8467770">(</span><span class="ident" id="8467771">fn</span><span class="op" id="8467773">,</span>&nbsp;<span class="ident" id="8467775">err</span><span class="op" id="8467778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467783">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467794">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467799">if</span>&nbsp;<span class="ident" id="8467802">fn</span>&nbsp;<span class="op" id="8467805">==</span>&nbsp;<span class="string" id="8467808">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="8467819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467824">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467901">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467947">c</span>&nbsp;<span class="op" id="8467949">:=</span>&nbsp;<span class="ident" id="8467952">img</span><span class="op" id="8467955">.</span><span class="ident" id="8467956">At</span><span class="op" id="8467958">(</span><span class="num" id="8467959">2</span><span class="op" id="8467960">,</span>&nbsp;<span class="num" id="8467962">1</span><span class="op" id="8467963">)</span><span class="op" id="8467964">.</span><span class="op" id="8467965">(</span><span class="ident" id="8467966">color</span><span class="op" id="8467971">.</span><span class="ident" id="8467972">NRGBA64</span><span class="op" id="8467979">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467984">if</span>&nbsp;<span class="ident" id="8467987">c</span><span class="op" id="8467988">.</span><span class="ident" id="8467989">R</span>&nbsp;<span class="op" id="8467991">!=</span>&nbsp;<span class="num" id="8467994">0x11a7</span>&nbsp;<span class="op" id="8468001">||</span>&nbsp;<span class="ident" id="8468004">c</span><span class="op" id="8468005">.</span><span class="ident" id="8468006">G</span>&nbsp;<span class="op" id="8468008">!=</span>&nbsp;<span class="num" id="8468011">0x11a7</span>&nbsp;<span class="op" id="8468018">||</span>&nbsp;<span class="ident" id="8468021">c</span><span class="op" id="8468022">.</span><span class="ident" id="8468023">B</span>&nbsp;<span class="op" id="8468025">!=</span>&nbsp;<span class="num" id="8468028">0x11a7</span>&nbsp;<span class="op" id="8468035">||</span>&nbsp;<span class="ident" id="8468038">c</span><span class="op" id="8468039">.</span><span class="ident" id="8468040">A</span>&nbsp;<span class="op" id="8468042">!=</span>&nbsp;<span class="num" id="8468045">0x1085</span>&nbsp;<span class="op" id="8468052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468058">t</span><span class="op" id="8468059">.</span><span class="ident" id="8468060">Error</span><span class="op" id="8468065">(</span><span class="ident" id="8468066">fn</span><span class="op" id="8468068">,</span>&nbsp;<span class="ident" id="8468070">fmt</span><span class="op" id="8468073">.</span><span class="ident" id="8468074">Errorf</span><span class="op" id="8468080">(</span><span class="string" id="8468081">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="8468114">,</span>&nbsp;<span class="ident" id="8468116">c</span><span class="op" id="8468117">)</span><span class="op" id="8468118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468128">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468139">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468144">piper</span><span class="op" id="8468149">,</span>&nbsp;<span class="ident" id="8468151">pipew</span>&nbsp;<span class="op" id="8468157">:=</span>&nbsp;<span class="ident" id="8468160">io</span><span class="op" id="8468162">.</span><span class="ident" id="8468163">Pipe</span><span class="op" id="8468167">(</span><span class="op" id="8468168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468172">pb</span>&nbsp;<span class="op" id="8468175">:=</span>&nbsp;<span class="ident" id="8468178">bufio</span><span class="op" id="8468183">.</span><span class="ident" id="8468184">NewScanner</span><span class="op" id="8468194">(</span><span class="ident" id="8468195">piper</span><span class="op" id="8468200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468204">go</span>&nbsp;<span class="ident" id="8468207">sng</span><span class="op" id="8468210">(</span><span class="ident" id="8468211">pipew</span><span class="op" id="8468216">,</span>&nbsp;<span class="ident" id="8468218">fn</span><span class="op" id="8468220">,</span>&nbsp;<span class="ident" id="8468222">img</span><span class="op" id="8468225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468229">defer</span>&nbsp;<span class="ident" id="8468235">piper</span><span class="op" id="8468240">.</span><span class="ident" id="8468241">Close</span><span class="op" id="8468246">(</span><span class="op" id="8468247">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8468252">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468277">sf</span><span class="op" id="8468279">,</span>&nbsp;<span class="ident" id="8468281">err</span>&nbsp;<span class="op" id="8468285">:=</span>&nbsp;<span class="ident" id="8468288">os</span><span class="op" id="8468290">.</span><span class="ident" id="8468291">Open</span><span class="op" id="8468295">(</span><span class="string" id="8468296">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8468317">+</span>&nbsp;<span class="ident" id="8468319">fn</span>&nbsp;<span class="op" id="8468322">+</span>&nbsp;<span class="string" id="8468324">&#34;.sng&#34;</span><span class="op" id="8468330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468334">if</span>&nbsp;<span class="ident" id="8468337">err</span>&nbsp;<span class="op" id="8468341">!=</span>&nbsp;<span class="ident" id="8468344">nil</span>&nbsp;<span class="op" id="8468348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468353">t</span><span class="op" id="8468354">.</span><span class="ident" id="8468355">Error</span><span class="op" id="8468360">(</span><span class="ident" id="8468361">fn</span><span class="op" id="8468363">,</span>&nbsp;<span class="ident" id="8468365">err</span><span class="op" id="8468368">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468373">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468388">defer</span>&nbsp;<span class="ident" id="8468394">sf</span><span class="op" id="8468396">.</span><span class="ident" id="8468397">Close</span><span class="op" id="8468402">(</span><span class="op" id="8468403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468407">sb</span>&nbsp;<span class="op" id="8468410">:=</span>&nbsp;<span class="ident" id="8468413">bufio</span><span class="op" id="8468418">.</span><span class="ident" id="8468419">NewScanner</span><span class="op" id="8468429">(</span><span class="ident" id="8468430">sf</span><span class="op" id="8468432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468436">if</span>&nbsp;<span class="ident" id="8468439">err</span>&nbsp;<span class="op" id="8468443">!=</span>&nbsp;<span class="ident" id="8468446">nil</span>&nbsp;<span class="op" id="8468450">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468455">t</span><span class="op" id="8468456">.</span><span class="ident" id="8468457">Error</span><span class="op" id="8468462">(</span><span class="ident" id="8468463">fn</span><span class="op" id="8468465">,</span>&nbsp;<span class="ident" id="8468467">err</span><span class="op" id="8468470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468475">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8468491">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468542">for</span>&nbsp;<span class="op" id="8468546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468551">pdone</span>&nbsp;<span class="op" id="8468557">:=</span>&nbsp;<span class="op" id="8468560">!</span><span class="ident" id="8468561">pb</span><span class="op" id="8468563">.</span><span class="ident" id="8468564">Scan</span><span class="op" id="8468568">(</span><span class="op" id="8468569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468574">sdone</span>&nbsp;<span class="op" id="8468580">:=</span>&nbsp;<span class="op" id="8468583">!</span><span class="ident" id="8468584">sb</span><span class="op" id="8468586">.</span><span class="ident" id="8468587">Scan</span><span class="op" id="8468591">(</span><span class="op" id="8468592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468597">if</span>&nbsp;<span class="ident" id="8468600">pdone</span>&nbsp;<span class="op" id="8468606">&amp;&amp;</span>&nbsp;<span class="ident" id="8468609">sdone</span>&nbsp;<span class="op" id="8468615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468621">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468635">if</span>&nbsp;<span class="ident" id="8468638">pdone</span>&nbsp;<span class="op" id="8468644">||</span>&nbsp;<span class="ident" id="8468647">sdone</span>&nbsp;<span class="op" id="8468653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468659">t</span><span class="op" id="8468660">.</span><span class="ident" id="8468661">Errorf</span><span class="op" id="8468667">(</span><span class="string" id="8468668">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="8468689">,</span>&nbsp;<span class="ident" id="8468691">fn</span><span class="op" id="8468693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468699">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468708">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468713">ps</span>&nbsp;<span class="op" id="8468716">:=</span>&nbsp;<span class="ident" id="8468719">pb</span><span class="op" id="8468721">.</span><span class="ident" id="8468722">Text</span><span class="op" id="8468726">(</span><span class="op" id="8468727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468732">ss</span>&nbsp;<span class="op" id="8468735">:=</span>&nbsp;<span class="ident" id="8468738">sb</span><span class="op" id="8468740">.</span><span class="ident" id="8468741">Text</span><span class="op" id="8468745">(</span><span class="op" id="8468746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468751">if</span>&nbsp;<span class="ident" id="8468754">ps</span>&nbsp;<span class="op" id="8468757">!=</span>&nbsp;<span class="ident" id="8468760">ss</span>&nbsp;<span class="op" id="8468763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468769">t</span><span class="op" id="8468770">.</span><span class="ident" id="8468771">Errorf</span><span class="op" id="8468777">(</span><span class="string" id="8468778">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="8468808">,</span>&nbsp;<span class="ident" id="8468810">fn</span><span class="op" id="8468812">,</span>&nbsp;<span class="ident" id="8468814">ps</span><span class="op" id="8468816">,</span>&nbsp;<span class="ident" id="8468818">ss</span><span class="op" id="8468820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468826">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468843">if</span>&nbsp;<span class="ident" id="8468846">pb</span><span class="op" id="8468848">.</span><span class="ident" id="8468849">Err</span><span class="op" id="8468852">(</span><span class="op" id="8468853">)</span>&nbsp;<span class="op" id="8468855">!=</span>&nbsp;<span class="ident" id="8468858">nil</span>&nbsp;<span class="op" id="8468862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468867">t</span><span class="op" id="8468868">.</span><span class="ident" id="8468869">Error</span><span class="op" id="8468874">(</span><span class="ident" id="8468875">fn</span><span class="op" id="8468877">,</span>&nbsp;<span class="ident" id="8468879">pb</span><span class="op" id="8468881">.</span><span class="ident" id="8468882">Err</span><span class="op" id="8468885">(</span><span class="op" id="8468886">)</span><span class="op" id="8468887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468891">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468895">if</span>&nbsp;<span class="ident" id="8468898">sb</span><span class="op" id="8468900">.</span><span class="ident" id="8468901">Err</span><span class="op" id="8468904">(</span><span class="op" id="8468905">)</span>&nbsp;<span class="op" id="8468907">!=</span>&nbsp;<span class="ident" id="8468910">nil</span>&nbsp;<span class="op" id="8468914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468919">t</span><span class="op" id="8468920">.</span><span class="ident" id="8468921">Error</span><span class="op" id="8468926">(</span><span class="ident" id="8468927">fn</span><span class="op" id="8468929">,</span>&nbsp;<span class="ident" id="8468931">sb</span><span class="op" id="8468933">.</span><span class="ident" id="8468934">Err</span><span class="op" id="8468937">(</span><span class="op" id="8468938">)</span><span class="op" id="8468939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468946">}</span><br>
<span class="lineno"></span><span class="op" id="8468948">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8468951">var</span>&nbsp;<span class="ident" id="8468955">readerErrors</span>&nbsp;<span class="op" id="8468968">=</span>&nbsp;<span class="op" id="8468970">[</span><span class="op" id="8468971">]</span><span class="keyword" id="8468972">struct</span>&nbsp;<span class="op" id="8468979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468982">file</span>&nbsp;<span class="builtintype" id="8468987">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468995">err</span>&nbsp;&nbsp;<span class="builtintype" id="8469000">string</span><br>
<span class="lineno"></span><span class="op" id="8469007">}</span><span class="op" id="8469008">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469011">{</span><span class="string" id="8469012">&#34;invalid-zlib.png&#34;</span><span class="op" id="8469030">,</span>&nbsp;<span class="string" id="8469032">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="8469056">}</span><span class="op" id="8469057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469060">{</span><span class="string" id="8469061">&#34;invalid-crc32.png&#34;</span><span class="op" id="8469080">,</span>&nbsp;<span class="string" id="8469082">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="8469100">}</span><span class="op" id="8469101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469104">{</span><span class="string" id="8469105">&#34;invalid-noend.png&#34;</span><span class="op" id="8469124">,</span>&nbsp;<span class="string" id="8469126">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8469142">}</span><span class="op" id="8469143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469146">{</span><span class="string" id="8469147">&#34;invalid-trunc.png&#34;</span><span class="op" id="8469166">,</span>&nbsp;<span class="string" id="8469168">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8469184">}</span><span class="op" id="8469185">,</span><br>
<span class="lineno"></span><span class="op" id="8469187">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8469190">func</span>&nbsp;<span class="ident" id="8469195">TestReaderError</span><span class="op" id="8469210">(</span><span class="ident" id="8469211">t</span>&nbsp;<span class="op" id="8469213">*</span><span class="ident" id="8469214">testing</span><span class="op" id="8469221">.</span><span class="ident" id="8469222">T</span><span class="op" id="8469223">)</span>&nbsp;<span class="op" id="8469225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469228">for</span>&nbsp;<span class="ident" id="8469232">_</span><span class="op" id="8469233">,</span>&nbsp;<span class="ident" id="8469235">tt</span>&nbsp;<span class="op" id="8469238">:=</span>&nbsp;<span class="keyword" id="8469241">range</span>&nbsp;<span class="ident" id="8469247">readerErrors</span>&nbsp;<span class="op" id="8469260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469264">img</span><span class="op" id="8469267">,</span>&nbsp;<span class="ident" id="8469269">err</span>&nbsp;<span class="op" id="8469273">:=</span>&nbsp;<span class="ident" id="8469276">readPNG</span><span class="op" id="8469283">(</span><span class="string" id="8469284">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="8469296">+</span>&nbsp;<span class="ident" id="8469298">tt</span><span class="op" id="8469300">.</span><span class="ident" id="8469301">file</span><span class="op" id="8469305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469309">if</span>&nbsp;<span class="ident" id="8469312">err</span>&nbsp;<span class="op" id="8469316">==</span>&nbsp;<span class="ident" id="8469319">nil</span>&nbsp;<span class="op" id="8469323">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469328">t</span><span class="op" id="8469329">.</span><span class="ident" id="8469330">Errorf</span><span class="op" id="8469336">(</span><span class="string" id="8469337">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="8469365">,</span>&nbsp;<span class="ident" id="8469367">tt</span><span class="op" id="8469369">.</span><span class="ident" id="8469370">file</span><span class="op" id="8469374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469394">if</span>&nbsp;<span class="op" id="8469397">!</span><span class="ident" id="8469398">strings</span><span class="op" id="8469405">.</span><span class="ident" id="8469406">Contains</span><span class="op" id="8469414">(</span><span class="ident" id="8469415">err</span><span class="op" id="8469418">.</span><span class="ident" id="8469419">Error</span><span class="op" id="8469424">(</span><span class="op" id="8469425">)</span><span class="op" id="8469426">,</span>&nbsp;<span class="ident" id="8469428">tt</span><span class="op" id="8469430">.</span><span class="ident" id="8469431">err</span><span class="op" id="8469434">)</span>&nbsp;<span class="op" id="8469436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469441">t</span><span class="op" id="8469442">.</span><span class="ident" id="8469443">Errorf</span><span class="op" id="8469449">(</span><span class="string" id="8469450">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8469476">,</span>&nbsp;<span class="ident" id="8469478">tt</span><span class="op" id="8469480">.</span><span class="ident" id="8469481">file</span><span class="op" id="8469485">,</span>&nbsp;<span class="ident" id="8469487">err</span><span class="op" id="8469490">,</span>&nbsp;<span class="ident" id="8469492">tt</span><span class="op" id="8469494">.</span><span class="ident" id="8469495">err</span><span class="op" id="8469498">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469506">if</span>&nbsp;<span class="ident" id="8469509">img</span>&nbsp;<span class="op" id="8469513">!=</span>&nbsp;<span class="ident" id="8469516">nil</span>&nbsp;<span class="op" id="8469520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469525">t</span><span class="op" id="8469526">.</span><span class="ident" id="8469527">Errorf</span><span class="op" id="8469533">(</span><span class="string" id="8469534">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="8469567">,</span>&nbsp;<span class="ident" id="8469569">tt</span><span class="op" id="8469571">.</span><span class="ident" id="8469572">file</span><span class="op" id="8469576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469583">}</span><br>
<span class="lineno">295</span><span class="op" id="8469585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8469588">func</span>&nbsp;<span class="ident" id="8469593">TestPalettedDecodeConfig</span><span class="op" id="8469617">(</span><span class="ident" id="8469618">t</span>&nbsp;<span class="op" id="8469620">*</span><span class="ident" id="8469621">testing</span><span class="op" id="8469628">.</span><span class="ident" id="8469629">T</span><span class="op" id="8469630">)</span>&nbsp;<span class="op" id="8469632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469635">for</span>&nbsp;<span class="ident" id="8469639">_</span><span class="op" id="8469640">,</span>&nbsp;<span class="ident" id="8469642">fn</span>&nbsp;<span class="op" id="8469645">:=</span>&nbsp;<span class="keyword" id="8469648">range</span>&nbsp;<span class="ident" id="8469654">filenamesPaletted</span>&nbsp;<span class="op" id="8469672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469676">f</span><span class="op" id="8469677">,</span>&nbsp;<span class="ident" id="8469679">err</span>&nbsp;<span class="op" id="8469683">:=</span>&nbsp;<span class="ident" id="8469686">os</span><span class="op" id="8469688">.</span><span class="ident" id="8469689">Open</span><span class="op" id="8469693">(</span><span class="string" id="8469694">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8469715">+</span>&nbsp;<span class="ident" id="8469717">fn</span>&nbsp;<span class="op" id="8469720">+</span>&nbsp;<span class="string" id="8469722">&#34;.png&#34;</span><span class="op" id="8469728">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469732">if</span>&nbsp;<span class="ident" id="8469735">err</span>&nbsp;<span class="op" id="8469739">!=</span>&nbsp;<span class="ident" id="8469742">nil</span>&nbsp;<span class="op" id="8469746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469751">t</span><span class="op" id="8469752">.</span><span class="ident" id="8469753">Errorf</span><span class="op" id="8469759">(</span><span class="string" id="8469760">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8469781">,</span>&nbsp;<span class="ident" id="8469783">fn</span><span class="op" id="8469785">,</span>&nbsp;<span class="ident" id="8469787">err</span><span class="op" id="8469790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469795">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469810">defer</span>&nbsp;<span class="ident" id="8469816">f</span><span class="op" id="8469817">.</span><span class="ident" id="8469818">Close</span><span class="op" id="8469823">(</span><span class="op" id="8469824">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469828">cfg</span><span class="op" id="8469831">,</span>&nbsp;<span class="ident" id="8469833">err</span>&nbsp;<span class="op" id="8469837">:=</span>&nbsp;<span class="ident" id="8469840">DecodeConfig</span><span class="op" id="8469852">(</span><span class="ident" id="8469853">f</span><span class="op" id="8469854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469858">if</span>&nbsp;<span class="ident" id="8469861">err</span>&nbsp;<span class="op" id="8469865">!=</span>&nbsp;<span class="ident" id="8469868">nil</span>&nbsp;<span class="op" id="8469872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469877">t</span><span class="op" id="8469878">.</span><span class="ident" id="8469879">Errorf</span><span class="op" id="8469885">(</span><span class="string" id="8469886">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8469894">,</span>&nbsp;<span class="ident" id="8469896">fn</span><span class="op" id="8469898">,</span>&nbsp;<span class="ident" id="8469900">err</span><span class="op" id="8469903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469908">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469919">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469923">pal</span><span class="op" id="8469926">,</span>&nbsp;<span class="ident" id="8469928">ok</span>&nbsp;<span class="op" id="8469931">:=</span>&nbsp;<span class="ident" id="8469934">cfg</span><span class="op" id="8469937">.</span><span class="ident" id="8469938">ColorModel</span><span class="op" id="8469948">.</span><span class="op" id="8469949">(</span><span class="ident" id="8469950">color</span><span class="op" id="8469955">.</span><span class="ident" id="8469956">Palette</span><span class="op" id="8469963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469967">if</span>&nbsp;<span class="op" id="8469970">!</span><span class="ident" id="8469971">ok</span>&nbsp;<span class="op" id="8469974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469979">t</span><span class="op" id="8469980">.</span><span class="ident" id="8469981">Errorf</span><span class="op" id="8469987">(</span><span class="string" id="8469988">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="8470023">,</span>&nbsp;<span class="ident" id="8470025">fn</span><span class="op" id="8470027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470032">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470043">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470047">if</span>&nbsp;<span class="ident" id="8470050">pal</span>&nbsp;<span class="op" id="8470054">==</span>&nbsp;<span class="ident" id="8470057">nil</span>&nbsp;<span class="op" id="8470061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470066">t</span><span class="op" id="8470067">.</span><span class="ident" id="8470068">Errorf</span><span class="op" id="8470074">(</span><span class="string" id="8470075">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="8470104">,</span>&nbsp;<span class="ident" id="8470106">fn</span><span class="op" id="8470108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470113">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470127">}</span><br>
<span class="lineno">320</span><span class="op" id="8470129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8470132">func</span>&nbsp;<span class="ident" id="8470137">benchmarkDecode</span><span class="op" id="8470152">(</span><span class="ident" id="8470153">b</span>&nbsp;<span class="op" id="8470155">*</span><span class="ident" id="8470156">testing</span><span class="op" id="8470163">.</span><span class="ident" id="8470164">B</span><span class="op" id="8470165">,</span>&nbsp;<span class="ident" id="8470167">filename</span>&nbsp;<span class="builtintype" id="8470176">string</span><span class="op" id="8470182">,</span>&nbsp;<span class="ident" id="8470184">bytesPerPixel</span>&nbsp;<span class="builtintype" id="8470198">int</span><span class="op" id="8470201">)</span>&nbsp;<span class="op" id="8470203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470206">b</span><span class="op" id="8470207">.</span><span class="ident" id="8470208">StopTimer</span><span class="op" id="8470217">(</span><span class="op" id="8470218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470221">data</span><span class="op" id="8470225">,</span>&nbsp;<span class="ident" id="8470227">err</span>&nbsp;<span class="op" id="8470231">:=</span>&nbsp;<span class="ident" id="8470234">ioutil</span><span class="op" id="8470240">.</span><span class="ident" id="8470241">ReadFile</span><span class="op" id="8470249">(</span><span class="ident" id="8470250">filename</span><span class="op" id="8470258">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470261">if</span>&nbsp;<span class="ident" id="8470264">err</span>&nbsp;<span class="op" id="8470268">!=</span>&nbsp;<span class="ident" id="8470271">nil</span>&nbsp;<span class="op" id="8470275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470279">b</span><span class="op" id="8470280">.</span><span class="ident" id="8470281">Fatal</span><span class="op" id="8470286">(</span><span class="ident" id="8470287">err</span><span class="op" id="8470290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470296">s</span>&nbsp;<span class="op" id="8470298">:=</span>&nbsp;<span class="builtintype" id="8470301">string</span><span class="op" id="8470307">(</span><span class="ident" id="8470308">data</span><span class="op" id="8470312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470315">cfg</span><span class="op" id="8470318">,</span>&nbsp;<span class="ident" id="8470320">err</span>&nbsp;<span class="op" id="8470324">:=</span>&nbsp;<span class="ident" id="8470327">DecodeConfig</span><span class="op" id="8470339">(</span><span class="ident" id="8470340">strings</span><span class="op" id="8470347">.</span><span class="ident" id="8470348">NewReader</span><span class="op" id="8470357">(</span><span class="ident" id="8470358">s</span><span class="op" id="8470359">)</span><span class="op" id="8470360">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470363">if</span>&nbsp;<span class="ident" id="8470366">err</span>&nbsp;<span class="op" id="8470370">!=</span>&nbsp;<span class="ident" id="8470373">nil</span>&nbsp;<span class="op" id="8470377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470381">b</span><span class="op" id="8470382">.</span><span class="ident" id="8470383">Fatal</span><span class="op" id="8470388">(</span><span class="ident" id="8470389">err</span><span class="op" id="8470392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470398">b</span><span class="op" id="8470399">.</span><span class="ident" id="8470400">SetBytes</span><span class="op" id="8470408">(</span><span class="ident" id="8470409">int64</span><span class="op" id="8470414">(</span><span class="ident" id="8470415">cfg</span><span class="op" id="8470418">.</span><span class="ident" id="8470419">Width</span>&nbsp;<span class="op" id="8470425">*</span>&nbsp;<span class="ident" id="8470427">cfg</span><span class="op" id="8470430">.</span><span class="ident" id="8470431">Height</span>&nbsp;<span class="op" id="8470438">*</span>&nbsp;<span class="ident" id="8470440">bytesPerPixel</span><span class="op" id="8470453">)</span><span class="op" id="8470454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470457">b</span><span class="op" id="8470458">.</span><span class="ident" id="8470459">StartTimer</span><span class="op" id="8470469">(</span><span class="op" id="8470470">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470473">for</span>&nbsp;<span class="ident" id="8470477">i</span>&nbsp;<span class="op" id="8470479">:=</span>&nbsp;<span class="num" id="8470482">0</span><span class="op" id="8470483">;</span>&nbsp;<span class="ident" id="8470485">i</span>&nbsp;<span class="op" id="8470487">&lt;</span>&nbsp;<span class="ident" id="8470489">b</span><span class="op" id="8470490">.</span><span class="ident" id="8470491">N</span><span class="op" id="8470492">;</span>&nbsp;<span class="ident" id="8470494">i</span><span class="op" id="8470495">++</span>&nbsp;<span class="op" id="8470498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470502">Decode</span><span class="op" id="8470508">(</span><span class="ident" id="8470509">strings</span><span class="op" id="8470516">.</span><span class="ident" id="8470517">NewReader</span><span class="op" id="8470526">(</span><span class="ident" id="8470527">s</span><span class="op" id="8470528">)</span><span class="op" id="8470529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470532">}</span><br>
<span class="lineno"></span><span class="op" id="8470534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8470537">func</span>&nbsp;<span class="ident" id="8470542">BenchmarkDecodeGray</span><span class="op" id="8470561">(</span><span class="ident" id="8470562">b</span>&nbsp;<span class="op" id="8470564">*</span><span class="ident" id="8470565">testing</span><span class="op" id="8470572">.</span><span class="ident" id="8470573">B</span><span class="op" id="8470574">)</span>&nbsp;<span class="op" id="8470576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470579">benchmarkDecode</span><span class="op" id="8470594">(</span><span class="ident" id="8470595">b</span><span class="op" id="8470596">,</span>&nbsp;<span class="string" id="8470598">&#34;testdata/benchGray.png&#34;</span><span class="op" id="8470622">,</span>&nbsp;<span class="num" id="8470624">1</span><span class="op" id="8470625">)</span><br>
<span class="lineno"></span><span class="op" id="8470627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8470630">func</span>&nbsp;<span class="ident" id="8470635">BenchmarkDecodeNRGBAGradient</span><span class="op" id="8470663">(</span><span class="ident" id="8470664">b</span>&nbsp;<span class="op" id="8470666">*</span><span class="ident" id="8470667">testing</span><span class="op" id="8470674">.</span><span class="ident" id="8470675">B</span><span class="op" id="8470676">)</span>&nbsp;<span class="op" id="8470678">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470681">benchmarkDecode</span><span class="op" id="8470696">(</span><span class="ident" id="8470697">b</span><span class="op" id="8470698">,</span>&nbsp;<span class="string" id="8470700">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="8470734">,</span>&nbsp;<span class="num" id="8470736">4</span><span class="op" id="8470737">)</span><br>
<span class="lineno"></span><span class="op" id="8470739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8470742">func</span>&nbsp;<span class="ident" id="8470747">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="8470773">(</span><span class="ident" id="8470774">b</span>&nbsp;<span class="op" id="8470776">*</span><span class="ident" id="8470777">testing</span><span class="op" id="8470784">.</span><span class="ident" id="8470785">B</span><span class="op" id="8470786">)</span>&nbsp;<span class="op" id="8470788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470791">benchmarkDecode</span><span class="op" id="8470806">(</span><span class="ident" id="8470807">b</span><span class="op" id="8470808">,</span>&nbsp;<span class="string" id="8470810">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="8470842">,</span>&nbsp;<span class="num" id="8470844">4</span><span class="op" id="8470845">)</span><br>
<span class="lineno">350</span><span class="op" id="8470847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8470850">func</span>&nbsp;<span class="ident" id="8470855">BenchmarkDecodePaletted</span><span class="op" id="8470878">(</span><span class="ident" id="8470879">b</span>&nbsp;<span class="op" id="8470881">*</span><span class="ident" id="8470882">testing</span><span class="op" id="8470889">.</span><span class="ident" id="8470890">B</span><span class="op" id="8470891">)</span>&nbsp;<span class="op" id="8470893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470896">benchmarkDecode</span><span class="op" id="8470911">(</span><span class="ident" id="8470912">b</span><span class="op" id="8470913">,</span>&nbsp;<span class="string" id="8470915">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="8470943">,</span>&nbsp;<span class="num" id="8470945">1</span><span class="op" id="8470946">)</span><br>
<span class="lineno"></span><span class="op" id="8470948">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8470951">func</span>&nbsp;<span class="ident" id="8470956">BenchmarkDecodeRGB</span><span class="op" id="8470974">(</span><span class="ident" id="8470975">b</span>&nbsp;<span class="op" id="8470977">*</span><span class="ident" id="8470978">testing</span><span class="op" id="8470985">.</span><span class="ident" id="8470986">B</span><span class="op" id="8470987">)</span>&nbsp;<span class="op" id="8470989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470992">benchmarkDecode</span><span class="op" id="8471007">(</span><span class="ident" id="8471008">b</span><span class="op" id="8471009">,</span>&nbsp;<span class="string" id="8471011">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="8471034">,</span>&nbsp;<span class="num" id="8471036">4</span><span class="op" id="8471037">)</span><br>
<span class="lineno"></span><span class="op" id="8471039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="8471042">func</span>&nbsp;<span class="ident" id="8471047">BenchmarkDecodeInterlacing</span><span class="op" id="8471073">(</span><span class="ident" id="8471074">b</span>&nbsp;<span class="op" id="8471076">*</span><span class="ident" id="8471077">testing</span><span class="op" id="8471084">.</span><span class="ident" id="8471085">B</span><span class="op" id="8471086">)</span>&nbsp;<span class="op" id="8471088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471091">benchmarkDecode</span><span class="op" id="8471106">(</span><span class="ident" id="8471107">b</span><span class="op" id="8471108">,</span>&nbsp;<span class="string" id="8471110">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="8471143">,</span>&nbsp;<span class="num" id="8471145">4</span><span class="op" id="8471146">)</span><br>
<span class="lineno"></span><span class="op" id="8471148">}</span>
</div>
</body>
</html>
