<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="6026971">package</span>&nbsp;<span class="ident" id="6026979">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6026985">import</span>&nbsp;<span class="op" id="6026992">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6026995">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6027018">&#34;lonnie.io/e8vm/link8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6027041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6027044">//&nbsp;buildFunc&nbsp;builds&nbsp;a&nbsp;function&nbsp;object&nbsp;from&nbsp;a&nbsp;function&nbsp;AST&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="6027108">func</span>&nbsp;<span class="ident" id="6027113">buildFunc</span><span class="op" id="6027122">(</span><span class="ident" id="6027123">b</span>&nbsp;<span class="op" id="6027125">*</span><span class="ident" id="6027126"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6027133">,</span>&nbsp;<span class="ident" id="6027135">f</span>&nbsp;<span class="op" id="6027137">*</span><span class="ident" id="6027138"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#6036889">funcDecl</a></span><span class="op" id="6027146">)</span>&nbsp;<span class="op" id="6027148">*</span><span class="ident" id="6027149"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6027154">.</span><span class="ident" id="6027155">Func</span>&nbsp;<span class="op" id="6027160">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027163"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027164">.</span><span class="ident" id="6027165">scope</span><span class="op" id="6027170">.</span><span class="ident" id="6027171">Push</span><span class="op" id="6027175">(</span><span class="op" id="6027176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027179">defer</span>&nbsp;<span class="ident" id="6027185"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027186">.</span><span class="ident" id="6027187">scope</span><span class="op" id="6027192">.</span><span class="ident" id="6027193">Pop</span><span class="op" id="6027196">(</span><span class="op" id="6027197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027201"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027202">.</span><span class="ident" id="6027203">clearErr</span><span class="op" id="6027211">(</span><span class="op" id="6027212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027215"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027428">declareLabels</a></span><span class="op" id="6027228">(</span><span class="ident" id="6027229"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027230">,</span>&nbsp;<span class="ident" id="6027232"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027135">f</a></span><span class="op" id="6027233">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027236">if</span>&nbsp;<span class="op" id="6027239">!</span><span class="ident" id="6027240"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027241">.</span><span class="ident" id="6027242">hasError</span>&nbsp;<span class="op" id="6027251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027255"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027917">setOffsets</a></span><span class="op" id="6027265">(</span><span class="ident" id="6027266"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027267">,</span>&nbsp;<span class="ident" id="6027269"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027135">f</a></span><span class="op" id="6027270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027274"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028619">fillLabels</a></span><span class="op" id="6027284">(</span><span class="ident" id="6027285"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027286">,</span>&nbsp;<span class="ident" id="6027288"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027135">f</a></span><span class="op" id="6027289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027296">return</span>&nbsp;<span class="ident" id="6027303"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031480">makeFuncObj</a></span><span class="op" id="6027314">(</span><span class="ident" id="6027315"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027123">b</a></span><span class="op" id="6027316">,</span>&nbsp;<span class="ident" id="6027318"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027135">f</a></span><span class="op" id="6027319">)</span><br>
<span class="lineno"></span><span class="op" id="6027321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6027324">//&nbsp;declareLabels&nbsp;adds&nbsp;the&nbsp;labels&nbsp;into&nbsp;the&nbsp;scope,</span><br>
<span class="lineno"></span><span class="comment" id="6027373">//&nbsp;so&nbsp;that&nbsp;later&nbsp;they&nbsp;can&nbsp;be&nbsp;queried&nbsp;for&nbsp;filling.</span><br>
<span class="lineno">25</span><span class="keyword" id="6027423">func</span>&nbsp;<span class="ident" id="6027428">declareLabels</span><span class="op" id="6027441">(</span><span class="ident" id="6027442">b</span>&nbsp;<span class="op" id="6027444">*</span><span class="ident" id="6027445"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6027452">,</span>&nbsp;<span class="ident" id="6027454">f</span>&nbsp;<span class="op" id="6027456">*</span><span class="ident" id="6027457"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#6036889">funcDecl</a></span><span class="op" id="6027465">)</span>&nbsp;<span class="op" id="6027467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027470">for</span>&nbsp;<span class="ident" id="6027474">_</span><span class="op" id="6027475">,</span>&nbsp;<span class="ident" id="6027477">stmt</span>&nbsp;<span class="op" id="6027482">:=</span>&nbsp;<span class="keyword" id="6027485">range</span>&nbsp;<span class="ident" id="6027491"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027454">f</a></span><span class="op" id="6027492">.</span><span class="ident" id="6027493">stmts</span>&nbsp;<span class="op" id="6027499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027503">if</span>&nbsp;<span class="op" id="6027506">!</span><span class="ident" id="6027507"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027477">stmt</a></span><span class="op" id="6027511">.</span><span class="ident" id="6027512">isLabel</span><span class="op" id="6027519">(</span><span class="op" id="6027520">)</span>&nbsp;<span class="op" id="6027522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027527">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027538">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027543">lab</span>&nbsp;<span class="op" id="6027547">:=</span>&nbsp;<span class="ident" id="6027550"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027477">stmt</a></span><span class="op" id="6027554">.</span><span class="ident" id="6027555">label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027563">op</span>&nbsp;<span class="op" id="6027566">:=</span>&nbsp;<span class="ident" id="6027569"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027477">stmt</a></span><span class="op" id="6027573">.</span><span class="ident" id="6027574">ops</span><span class="op" id="6027577">[</span><span class="num" id="6027578">0</span><span class="op" id="6027579">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027583">sym</span>&nbsp;<span class="op" id="6027587">:=</span>&nbsp;<span class="op" id="6027590">&amp;</span><span class="ident" id="6027591"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6065903">symbol</a></span><span class="op" id="6027597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027602">Name</span><span class="op" id="6027606">:</span>&nbsp;<span class="ident" id="6027608"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027543">lab</a></span><span class="op" id="6027611">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027616">Type</span><span class="op" id="6027620">:</span>&nbsp;<span class="ident" id="6027622"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066311">SymLabel</a></span><span class="op" id="6027630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027635">Item</span><span class="op" id="6027639">:</span>&nbsp;<span class="ident" id="6027641"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027477">stmt</a></span><span class="op" id="6027645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027650">Pos</span><span class="op" id="6027653">:</span>&nbsp;&nbsp;<span class="ident" id="6027656"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027563">op</a></span><span class="op" id="6027658">.</span><span class="ident" id="6027659">Pos</span><span class="op" id="6027662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027671">decl</span>&nbsp;<span class="op" id="6027676">:=</span>&nbsp;<span class="ident" id="6027679"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027442">b</a></span><span class="op" id="6027680">.</span><span class="ident" id="6027681">scope</span><span class="op" id="6027686">.</span><span class="ident" id="6027687">Declare</span><span class="op" id="6027694">(</span><span class="ident" id="6027695"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027583">sym</a></span><span class="op" id="6027698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027702">if</span>&nbsp;<span class="ident" id="6027705"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027671">decl</a></span>&nbsp;<span class="op" id="6027710">!=</span>&nbsp;<span class="ident" id="6027713">nil</span>&nbsp;<span class="op" id="6027717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027722"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027442">b</a></span><span class="op" id="6027723">.</span><span class="ident" id="6027724">err</span><span class="op" id="6027727">(</span><span class="ident" id="6027728"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027563">op</a></span><span class="op" id="6027730">.</span><span class="ident" id="6027731">Pos</span><span class="op" id="6027734">,</span>&nbsp;<span class="string" id="6027736">&#34;%q&nbsp;already&nbsp;declared&#34;</span><span class="op" id="6027757">,</span>&nbsp;<span class="ident" id="6027759"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027543">lab</a></span><span class="op" id="6027762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027767"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027442">b</a></span><span class="op" id="6027768">.</span><span class="ident" id="6027769">err</span><span class="op" id="6027772">(</span><span class="ident" id="6027773"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027671">decl</a></span><span class="op" id="6027777">.</span><span class="ident" id="6027778">Pos</span><span class="op" id="6027781">,</span>&nbsp;<span class="string" id="6027783">&#34;&nbsp;&nbsp;here&nbsp;as&nbsp;a&nbsp;%s&#34;</span><span class="op" id="6027799">,</span>&nbsp;<span class="ident" id="6027801"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066358">symStr</a></span><span class="op" id="6027807">(</span><span class="ident" id="6027808"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027671">decl</a></span><span class="op" id="6027812">.</span><span class="ident" id="6027813">Type</span><span class="op" id="6027817">)</span><span class="op" id="6027818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027823">continue</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027837">}</span><br>
<span class="lineno"></span><span class="op" id="6027839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6027842">//&nbsp;setOffsets&nbsp;calculates&nbsp;the&nbsp;offset&nbsp;in&nbsp;function&nbsp;for&nbsp;each&nbsp;instruction.</span><br>
<span class="lineno">50</span><span class="keyword" id="6027912">func</span>&nbsp;<span class="ident" id="6027917">setOffsets</span><span class="op" id="6027927">(</span><span class="ident" id="6027928">b</span>&nbsp;<span class="op" id="6027930">*</span><span class="ident" id="6027931"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6027938">,</span>&nbsp;<span class="ident" id="6027940">f</span>&nbsp;<span class="op" id="6027942">*</span><span class="ident" id="6027943"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#6036889">funcDecl</a></span><span class="op" id="6027951">)</span>&nbsp;<span class="op" id="6027953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027956">offset</span>&nbsp;<span class="op" id="6027963">:=</span>&nbsp;<span class="builtintype" id="6027966">uint32</span><span class="op" id="6027972">(</span><span class="num" id="6027973">0</span><span class="op" id="6027974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027978">for</span>&nbsp;<span class="ident" id="6027982">_</span><span class="op" id="6027983">,</span>&nbsp;<span class="ident" id="6027985">s</span>&nbsp;<span class="op" id="6027987">:=</span>&nbsp;<span class="keyword" id="6027990">range</span>&nbsp;<span class="ident" id="6027996"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027940">f</a></span><span class="op" id="6027997">.</span><span class="ident" id="6027998">stmts</span>&nbsp;<span class="op" id="6028004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028008"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027985">s</a></span><span class="op" id="6028009">.</span><span class="ident" id="6028010">offset</span>&nbsp;<span class="op" id="6028017">=</span>&nbsp;<span class="ident" id="6028019"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027956">offset</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028028">if</span>&nbsp;<span class="ident" id="6028031"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027985">s</a></span><span class="op" id="6028032">.</span><span class="ident" id="6028033">isLabel</span><span class="op" id="6028040">(</span><span class="op" id="6028041">)</span>&nbsp;<span class="op" id="6028043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028048">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028064"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027956">offset</a></span>&nbsp;<span class="op" id="6028071">+=</span>&nbsp;<span class="num" id="6028074">4</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028077">}</span><br>
<span class="lineno"></span><span class="op" id="6028079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6028082">//&nbsp;fillDelta&nbsp;will&nbsp;fill&nbsp;the&nbsp;particular&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="6028132">//&nbsp;with&nbsp;a&nbsp;jumping/branching&nbsp;offset&nbsp;d.</span><br>
<span class="lineno">65</span><span class="keyword" id="6028170">func</span>&nbsp;<span class="ident" id="6028175">fillDelta</span><span class="op" id="6028184">(</span><span class="ident" id="6028185">b</span>&nbsp;<span class="op" id="6028187">*</span><span class="ident" id="6028188"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6028195">,</span>&nbsp;<span class="ident" id="6028197">t</span>&nbsp;<span class="op" id="6028199">*</span><span class="ident" id="6028200"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6026995">lex8</a></span><span class="op" id="6028204">.</span><span class="ident" id="6028205">Token</span><span class="op" id="6028210">,</span>&nbsp;<span class="ident" id="6028212">inst</span>&nbsp;<span class="op" id="6028217">*</span><span class="builtintype" id="6028218">uint32</span><span class="op" id="6028224">,</span>&nbsp;<span class="ident" id="6028226">d</span>&nbsp;<span class="builtintype" id="6028228">uint32</span><span class="op" id="6028234">)</span>&nbsp;<span class="op" id="6028236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028239">if</span>&nbsp;<span class="ident" id="6028242"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037521">isJump</a></span><span class="op" id="6028248">(</span><span class="op" id="6028249">*</span><span class="ident" id="6028250"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028212">inst</a></span><span class="op" id="6028254">)</span>&nbsp;<span class="op" id="6028256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028260">*</span><span class="ident" id="6028261"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028212">inst</a></span>&nbsp;<span class="op" id="6028266">|=</span>&nbsp;<span class="ident" id="6028269"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028226">d</a></span>&nbsp;<span class="op" id="6028271">&amp;</span>&nbsp;<span class="num" id="6028273">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028285">}</span>&nbsp;<span class="keyword" id="6028287">else</span>&nbsp;<span class="op" id="6028292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028296">//&nbsp;it&nbsp;is&nbsp;a&nbsp;branch</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028316">if</span>&nbsp;<span class="op" id="6028319">!</span><span class="ident" id="6028320"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037581">inBrRange</a></span><span class="op" id="6028329">(</span><span class="ident" id="6028330"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028226">d</a></span><span class="op" id="6028331">)</span>&nbsp;<span class="op" id="6028333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028338"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028185">b</a></span><span class="op" id="6028339">.</span><span class="ident" id="6028340">err</span><span class="op" id="6028343">(</span><span class="ident" id="6028344"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028197">t</a></span><span class="op" id="6028345">.</span><span class="ident" id="6028346">Pos</span><span class="op" id="6028349">,</span>&nbsp;<span class="string" id="6028351">&#34;%q&nbsp;is&nbsp;out&nbsp;of&nbsp;branch&nbsp;range&#34;</span><span class="op" id="6028378">,</span>&nbsp;<span class="ident" id="6028380"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028197">t</a></span><span class="op" id="6028381">.</span><span class="ident" id="6028382">Lit</span><span class="op" id="6028385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028393">*</span><span class="ident" id="6028394"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028212">inst</a></span>&nbsp;<span class="op" id="6028399">|=</span>&nbsp;<span class="ident" id="6028402"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028226">d</a></span>&nbsp;<span class="op" id="6028404">&amp;</span>&nbsp;<span class="num" id="6028406">0x3ffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028415">}</span><br>
<span class="lineno">75</span><span class="op" id="6028417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6028420">//&nbsp;fillLabels&nbsp;fills&nbsp;all&nbsp;the&nbsp;labels&nbsp;in&nbsp;the&nbsp;function.&nbsp;After&nbsp;the&nbsp;filling,&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6028499">//&nbsp;symbols&nbsp;left&nbsp;will&nbsp;be&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;and&nbsp;all&nbsp;branches&nbsp;(which</span><br>
<span class="lineno"></span><span class="comment" id="6028578">//&nbsp;must&nbsp;use&nbsp;labels)&nbsp;will&nbsp;be&nbsp;filled.</span><br>
<span class="lineno">80</span><span class="keyword" id="6028614">func</span>&nbsp;<span class="ident" id="6028619">fillLabels</span><span class="op" id="6028629">(</span><span class="ident" id="6028630">b</span>&nbsp;<span class="op" id="6028632">*</span><span class="ident" id="6028633"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6028640">,</span>&nbsp;<span class="ident" id="6028642">f</span>&nbsp;<span class="op" id="6028644">*</span><span class="ident" id="6028645"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#6036889">funcDecl</a></span><span class="op" id="6028653">)</span>&nbsp;<span class="op" id="6028655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028658">for</span>&nbsp;<span class="ident" id="6028662">_</span><span class="op" id="6028663">,</span>&nbsp;<span class="ident" id="6028665">s</span>&nbsp;<span class="op" id="6028667">:=</span>&nbsp;<span class="keyword" id="6028670">range</span>&nbsp;<span class="ident" id="6028676"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028642">f</a></span><span class="op" id="6028677">.</span><span class="ident" id="6028678">stmts</span>&nbsp;<span class="op" id="6028684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028688">if</span>&nbsp;<span class="ident" id="6028691"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6028692">.</span><span class="ident" id="6028693">isLabel</span><span class="op" id="6028700">(</span><span class="op" id="6028701">)</span>&nbsp;<span class="op" id="6028703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028719">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028723">if</span>&nbsp;<span class="ident" id="6028726"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6028727">.</span><span class="ident" id="6028728">fill</span>&nbsp;<span class="op" id="6028733">!=</span>&nbsp;<span class="ident" id="6028736"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037503">fillLabel</a></span>&nbsp;<span class="op" id="6028746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028751">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028766">if</span>&nbsp;<span class="ident" id="6028769"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6028770">.</span><span class="ident" id="6028771">pack</span>&nbsp;<span class="op" id="6028776">!=</span>&nbsp;<span class="string" id="6028779">&#34;&#34;</span>&nbsp;<span class="op" id="6028782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6028787">panic</span><span class="op" id="6028792">(</span><span class="string" id="6028793">&#34;fill&nbsp;label&nbsp;with&nbsp;pack&nbsp;symbol&#34;</span><span class="op" id="6028822">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028831">t</span>&nbsp;<span class="op" id="6028833">:=</span>&nbsp;<span class="ident" id="6028836"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6028837">.</span><span class="ident" id="6028838">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028848">sym</span>&nbsp;<span class="op" id="6028852">:=</span>&nbsp;<span class="ident" id="6028855"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028630">b</a></span><span class="op" id="6028856">.</span><span class="ident" id="6028857">scope</span><span class="op" id="6028862">.</span><span class="ident" id="6028863">Query</span><span class="op" id="6028868">(</span><span class="ident" id="6028869"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6028870">.</span><span class="ident" id="6028871">symbol</span><span class="op" id="6028877">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028881">if</span>&nbsp;<span class="ident" id="6028884"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028848">sym</a></span>&nbsp;<span class="op" id="6028888">==</span>&nbsp;<span class="ident" id="6028891">nil</span>&nbsp;<span class="op" id="6028895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028900"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028630">b</a></span><span class="op" id="6028901">.</span><span class="ident" id="6028902">err</span><span class="op" id="6028905">(</span><span class="ident" id="6028906"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028831">t</a></span><span class="op" id="6028907">.</span><span class="ident" id="6028908">Pos</span><span class="op" id="6028911">,</span>&nbsp;<span class="string" id="6028913">&#34;label&nbsp;%q&nbsp;not&nbsp;declared&#34;</span><span class="op" id="6028936">,</span>&nbsp;<span class="ident" id="6028938"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028831">t</a></span><span class="op" id="6028939">.</span><span class="ident" id="6028940">Lit</span><span class="op" id="6028943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028948">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028964">if</span>&nbsp;<span class="ident" id="6028967"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028848">sym</a></span><span class="op" id="6028970">.</span><span class="ident" id="6028971">Type</span>&nbsp;<span class="op" id="6028976">!=</span>&nbsp;<span class="ident" id="6028979"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066311">SymLabel</a></span>&nbsp;<span class="op" id="6028988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6028993">panic</span><span class="op" id="6028998">(</span><span class="string" id="6028999">&#34;not&nbsp;a&nbsp;label&#34;</span><span class="op" id="6029012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029021">lab</span>&nbsp;<span class="op" id="6029025">:=</span>&nbsp;<span class="ident" id="6029028"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028848">sym</a></span><span class="op" id="6029031">.</span><span class="ident" id="6029032">Item</span><span class="op" id="6029036">.</span><span class="op" id="6029037">(</span><span class="op" id="6029038">*</span><span class="ident" id="6029039"><a href="/lonnie.io/e8vm/asm8/func_stmt.go.html#6037088">funcStmt</a></span><span class="op" id="6029047">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029051">delta</span>&nbsp;<span class="op" id="6029057">:=</span>&nbsp;<span class="builtintype" id="6029060">uint32</span><span class="op" id="6029066">(</span><span class="builtintype" id="6029067">int32</span><span class="op" id="6029072">(</span><span class="ident" id="6029073"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029021">lab</a></span><span class="op" id="6029076">.</span><span class="ident" id="6029077">offset</span><span class="op" id="6029083">-</span><span class="ident" id="6029084"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6029085">.</span><span class="ident" id="6029086">offset</span><span class="op" id="6029092">-</span><span class="num" id="6029093">4</span><span class="op" id="6029094">)</span>&nbsp;<span class="op" id="6029096">&gt;&gt;</span>&nbsp;<span class="num" id="6029099">2</span><span class="op" id="6029100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029104"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028175">fillDelta</a></span><span class="op" id="6029113">(</span><span class="ident" id="6029114"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028630">b</a></span><span class="op" id="6029115">,</span>&nbsp;<span class="ident" id="6029117"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028831">t</a></span><span class="op" id="6029118">,</span>&nbsp;<span class="op" id="6029120">&amp;</span><span class="ident" id="6029121"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6028665">s</a></span><span class="op" id="6029122">.</span><span class="ident" id="6029123">inst</span><span class="op" id="6029127">.</span><span class="ident" id="6029128">inst</span><span class="op" id="6029132">,</span>&nbsp;<span class="ident" id="6029134"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029051">delta</a></span><span class="op" id="6029139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029142">}</span><br>
<span class="lineno"></span><span class="op" id="6029144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6029147">func</span>&nbsp;<span class="ident" id="6029152">queryPkg</span><span class="op" id="6029160">(</span><span class="ident" id="6029161">b</span>&nbsp;<span class="op" id="6029163">*</span><span class="ident" id="6029164"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6029171">,</span>&nbsp;<span class="ident" id="6029173">t</span>&nbsp;<span class="op" id="6029175">*</span><span class="ident" id="6029176"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6026995">lex8</a></span><span class="op" id="6029180">.</span><span class="ident" id="6029181">Token</span><span class="op" id="6029186">,</span>&nbsp;<span class="ident" id="6029188">pack</span>&nbsp;<span class="builtintype" id="6029193">string</span><span class="op" id="6029199">)</span>&nbsp;<span class="op" id="6029201">*</span><span class="ident" id="6029202"><a href="/lonnie.io/e8vm/asm8/lib.go.html#6050106">lib</a></span>&nbsp;<span class="op" id="6029206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029209">sym</span>&nbsp;<span class="op" id="6029213">:=</span>&nbsp;<span class="ident" id="6029216"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029161">b</a></span><span class="op" id="6029217">.</span><span class="ident" id="6029218">scope</span><span class="op" id="6029223">.</span><span class="ident" id="6029224">Query</span><span class="op" id="6029229">(</span><span class="ident" id="6029230"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029188">pack</a></span><span class="op" id="6029234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029237">if</span>&nbsp;<span class="ident" id="6029240"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029209">sym</a></span>&nbsp;<span class="op" id="6029244">==</span>&nbsp;<span class="ident" id="6029247">nil</span>&nbsp;<span class="op" id="6029251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029255"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029161">b</a></span><span class="op" id="6029256">.</span><span class="ident" id="6029257">err</span><span class="op" id="6029260">(</span><span class="ident" id="6029261"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029173">t</a></span><span class="op" id="6029262">.</span><span class="ident" id="6029263">Pos</span><span class="op" id="6029266">,</span>&nbsp;<span class="string" id="6029268">&#34;package&nbsp;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="6029290">,</span>&nbsp;<span class="ident" id="6029292"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029188">pack</a></span><span class="op" id="6029296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029300">return</span>&nbsp;<span class="ident" id="6029307">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029312">}</span>&nbsp;<span class="keyword" id="6029314">else</span>&nbsp;<span class="keyword" id="6029319">if</span>&nbsp;<span class="ident" id="6029322"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029209">sym</a></span><span class="op" id="6029325">.</span><span class="ident" id="6029326">Type</span>&nbsp;<span class="op" id="6029331">!=</span>&nbsp;<span class="ident" id="6029334"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066149">SymImport</a></span>&nbsp;<span class="op" id="6029344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029348"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029161">b</a></span><span class="op" id="6029349">.</span><span class="ident" id="6029350">err</span><span class="op" id="6029353">(</span><span class="ident" id="6029354"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029173">t</a></span><span class="op" id="6029355">.</span><span class="ident" id="6029356">Pos</span><span class="op" id="6029359">,</span>&nbsp;<span class="string" id="6029361">&#34;%q&nbsp;is&nbsp;a&nbsp;%s,&nbsp;not&nbsp;a&nbsp;package&#34;</span><span class="op" id="6029388">,</span>&nbsp;<span class="ident" id="6029390"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029173">t</a></span><span class="op" id="6029391">.</span><span class="ident" id="6029392">Lit</span><span class="op" id="6029395">,</span>&nbsp;<span class="ident" id="6029397"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066358">symStr</a></span><span class="op" id="6029403">(</span><span class="ident" id="6029404"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029209">sym</a></span><span class="op" id="6029407">.</span><span class="ident" id="6029408">Type</span><span class="op" id="6029412">)</span><span class="op" id="6029413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029417">return</span>&nbsp;<span class="ident" id="6029424">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029432">return</span>&nbsp;<span class="ident" id="6029439"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029209">sym</a></span><span class="op" id="6029442">.</span><span class="ident" id="6029443">Item</span><span class="op" id="6029447">.</span><span class="op" id="6029448">(</span><span class="op" id="6029449">*</span><span class="ident" id="6029450"><a href="/lonnie.io/e8vm/asm8/lib.go.html#6050106">lib</a></span><span class="op" id="6029453">)</span><br>
<span class="lineno">120</span><span class="op" id="6029455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029458">func</span>&nbsp;<span class="ident" id="6029463">init</span><span class="op" id="6029467">(</span><span class="op" id="6029468">)</span>&nbsp;<span class="op" id="6029470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029473">as</span>&nbsp;<span class="op" id="6029476">:=</span>&nbsp;<span class="keyword" id="6029479">func</span><span class="op" id="6029483">(</span><span class="ident" id="6029484">b</span>&nbsp;<span class="builtintype" id="6029486">bool</span><span class="op" id="6029490">)</span>&nbsp;<span class="op" id="6029492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029496">if</span>&nbsp;<span class="op" id="6029499">!</span><span class="ident" id="6029500"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029484">b</a></span>&nbsp;<span class="op" id="6029502">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6029507">panic</span><span class="op" id="6029512">(</span><span class="string" id="6029513">&#34;bug&#34;</span><span class="op" id="6029518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029528"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029473">as</a></span><span class="op" id="6029530">(</span><span class="ident" id="6029531"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037402">fillNone</a></span>&nbsp;<span class="op" id="6029540">==</span>&nbsp;<span class="num" id="6029543">0</span>&nbsp;<span class="op" id="6029545">&amp;&amp;</span>&nbsp;<span class="ident" id="6029548"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037503">fillLabel</a></span>&nbsp;<span class="op" id="6029558">==</span>&nbsp;<span class="num" id="6029561">4</span><span class="op" id="6029562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029565"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029473">as</a></span><span class="op" id="6029567">(</span><span class="ident" id="6029568"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037419">fillLink</a></span>&nbsp;<span class="op" id="6029577">==</span>&nbsp;<span class="ident" id="6029580"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6029585">.</span><span class="ident" id="6029586">FillLink</span><span class="op" id="6029594">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029597"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029473">as</a></span><span class="op" id="6029599">(</span><span class="ident" id="6029600"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037482">fillHigh</a></span>&nbsp;<span class="op" id="6029609">==</span>&nbsp;<span class="ident" id="6029612"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6029617">.</span><span class="ident" id="6029618">FillHigh</span><span class="op" id="6029626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029629"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029473">as</a></span><span class="op" id="6029631">(</span><span class="ident" id="6029632"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037442">fillLow</a></span>&nbsp;<span class="op" id="6029640">==</span>&nbsp;<span class="ident" id="6029643"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6029648">.</span><span class="ident" id="6029649">FillLow</span><span class="op" id="6029656">)</span><br>
<span class="lineno"></span><span class="op" id="6029658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6029661">//&nbsp;resolveSymbol&nbsp;resolves&nbsp;the&nbsp;symbol&nbsp;in&nbsp;the&nbsp;statement,</span><br>
<span class="lineno">135</span><span class="comment" id="6029716">//&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;linking&nbsp;object&nbsp;and&nbsp;its&nbsp;&lt;sym,&nbsp;pkg&gt;&nbsp;index&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="6029783">//&nbsp;in&nbsp;the&nbsp;current&nbsp;package&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="6029818">func</span>&nbsp;<span class="ident" id="6029823">resolveSymbol</span><span class="op" id="6029836">(</span><span class="ident" id="6029837">b</span>&nbsp;<span class="op" id="6029839">*</span><span class="ident" id="6029840"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6029847">,</span>&nbsp;<span class="ident" id="6029849">s</span>&nbsp;<span class="op" id="6029851">*</span><span class="ident" id="6029852"><a href="/lonnie.io/e8vm/asm8/func_stmt.go.html#6037088">funcStmt</a></span><span class="op" id="6029860">)</span>&nbsp;<span class="op" id="6029862">(</span><span class="ident" id="6029863">ret</span>&nbsp;<span class="op" id="6029867">*</span><span class="ident" id="6029868"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6065903">symbol</a></span><span class="op" id="6029874">,</span>&nbsp;<span class="ident" id="6029876">pkg</span><span class="op" id="6029879">,</span>&nbsp;<span class="ident" id="6029881">index</span>&nbsp;<span class="builtintype" id="6029887">uint32</span><span class="op" id="6029893">)</span>&nbsp;<span class="op" id="6029895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029898">t</span>&nbsp;<span class="op" id="6029900">:=</span>&nbsp;<span class="ident" id="6029903"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029849">s</a></span><span class="op" id="6029904">.</span><span class="ident" id="6029905">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029914">if</span>&nbsp;<span class="ident" id="6029917"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029849">s</a></span><span class="op" id="6029918">.</span><span class="ident" id="6029919">pack</span>&nbsp;<span class="op" id="6029924">==</span>&nbsp;<span class="string" id="6029927">&#34;&#34;</span>&nbsp;<span class="op" id="6029930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029934"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span>&nbsp;<span class="op" id="6029938">=</span>&nbsp;<span class="ident" id="6029940"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029837">b</a></span><span class="op" id="6029941">.</span><span class="ident" id="6029942">scope</span><span class="op" id="6029947">.</span><span class="ident" id="6029948">Query</span><span class="op" id="6029953">(</span><span class="ident" id="6029954"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029849">s</a></span><span class="op" id="6029955">.</span><span class="ident" id="6029956">symbol</span><span class="op" id="6029962">)</span>&nbsp;<span class="comment" id="6029964">//&nbsp;find&nbsp;the&nbsp;symbol&nbsp;in&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029994">if</span>&nbsp;<span class="ident" id="6029997"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span>&nbsp;<span class="op" id="6030001">!=</span>&nbsp;<span class="ident" id="6030004">nil</span>&nbsp;<span class="op" id="6030008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030013">var</span>&nbsp;<span class="ident" id="6030017">p</span>&nbsp;<span class="op" id="6030019">*</span><span class="ident" id="6030020"><a href="/lonnie.io/e8vm/asm8/lib.go.html#6050106">lib</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030027"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030017">p</a></span><span class="op" id="6030028">,</span>&nbsp;<span class="ident" id="6030030"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029876">pkg</a></span>&nbsp;<span class="op" id="6030034">=</span>&nbsp;<span class="ident" id="6030036"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029837">b</a></span><span class="op" id="6030037">.</span><span class="ident" id="6030038">curPkg</span><span class="op" id="6030044">.</span><span class="ident" id="6030045">LibIndex</span><span class="op" id="6030053">(</span><span class="ident" id="6030054"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030057">.</span><span class="ident" id="6030058">Package</span><span class="op" id="6030065">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030070"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029881">index</a></span>&nbsp;<span class="op" id="6030076">=</span>&nbsp;<span class="ident" id="6030078"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030017">p</a></span><span class="op" id="6030079">.</span><span class="ident" id="6030080">SymIndex</span><span class="op" id="6030088">(</span><span class="ident" id="6030089"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030092">.</span><span class="ident" id="6030093">Name</span><span class="op" id="6030097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030104">}</span>&nbsp;<span class="keyword" id="6030106">else</span>&nbsp;<span class="op" id="6030111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030115">p</span>&nbsp;<span class="op" id="6030117">:=</span>&nbsp;<span class="ident" id="6030120"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029152">queryPkg</a></span><span class="op" id="6030128">(</span><span class="ident" id="6030129"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029837">b</a></span><span class="op" id="6030130">,</span>&nbsp;<span class="ident" id="6030132"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029898">t</a></span><span class="op" id="6030133">,</span>&nbsp;<span class="ident" id="6030135"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029849">s</a></span><span class="op" id="6030136">.</span><span class="ident" id="6030137">pack</span><span class="op" id="6030141">)</span>&nbsp;<span class="comment" id="6030143">//&nbsp;find&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030165">if</span>&nbsp;<span class="ident" id="6030168"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030115">p</a></span>&nbsp;<span class="op" id="6030170">==</span>&nbsp;<span class="ident" id="6030173">nil</span>&nbsp;<span class="op" id="6030177">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030182">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030196">path</span>&nbsp;<span class="op" id="6030201">:=</span>&nbsp;<span class="ident" id="6030204"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030115">p</a></span><span class="op" id="6030205">.</span><span class="ident" id="6030206">Path</span><span class="op" id="6030210">(</span><span class="op" id="6030211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030215">_</span><span class="op" id="6030216">,</span>&nbsp;<span class="ident" id="6030218"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029876">pkg</a></span>&nbsp;<span class="op" id="6030222">=</span>&nbsp;<span class="ident" id="6030224"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029837">b</a></span><span class="op" id="6030225">.</span><span class="ident" id="6030226">curPkg</span><span class="op" id="6030232">.</span><span class="ident" id="6030233">LibIndex</span><span class="op" id="6030241">(</span><span class="ident" id="6030242"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030196">path</a></span><span class="op" id="6030246">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030250"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030253">,</span>&nbsp;<span class="ident" id="6030255"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029881">index</a></span>&nbsp;<span class="op" id="6030261">=</span>&nbsp;<span class="ident" id="6030263"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030115">p</a></span><span class="op" id="6030264">.</span><span class="ident" id="6030265">Query</span><span class="op" id="6030270">(</span><span class="ident" id="6030271"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029849">s</a></span><span class="op" id="6030272">.</span><span class="ident" id="6030273">symbol</span><span class="op" id="6030279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030283">if</span>&nbsp;<span class="ident" id="6030286"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span>&nbsp;<span class="op" id="6030290">!=</span>&nbsp;<span class="ident" id="6030293">nil</span>&nbsp;<span class="op" id="6030297">&amp;&amp;</span>&nbsp;<span class="ident" id="6030300"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030303">.</span><span class="ident" id="6030304">Package</span>&nbsp;<span class="op" id="6030312">!=</span>&nbsp;<span class="ident" id="6030315"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030196">path</a></span>&nbsp;<span class="op" id="6030320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6030325">panic</span><span class="op" id="6030330">(</span><span class="string" id="6030331">&#34;bug&#34;</span><span class="op" id="6030336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030343">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030347">if</span>&nbsp;<span class="ident" id="6030350"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span>&nbsp;<span class="op" id="6030354">==</span>&nbsp;<span class="ident" id="6030357">nil</span>&nbsp;<span class="op" id="6030361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030365"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029837">b</a></span><span class="op" id="6030366">.</span><span class="ident" id="6030367">err</span><span class="op" id="6030370">(</span><span class="ident" id="6030371"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029898">t</a></span><span class="op" id="6030372">.</span><span class="ident" id="6030373">Pos</span><span class="op" id="6030376">,</span>&nbsp;<span class="string" id="6030378">&#34;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="6030392">,</span>&nbsp;<span class="ident" id="6030394"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029898">t</a></span><span class="op" id="6030395">.</span><span class="ident" id="6030396">Lit</span><span class="op" id="6030399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030403">return</span>&nbsp;<span class="ident" id="6030410">nil</span><span class="op" id="6030413">,</span>&nbsp;<span class="num" id="6030415">0</span><span class="op" id="6030416">,</span>&nbsp;<span class="num" id="6030418">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030421">}</span>&nbsp;<span class="keyword" id="6030423">else</span>&nbsp;<span class="keyword" id="6030428">if</span>&nbsp;<span class="ident" id="6030431"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030434">.</span><span class="ident" id="6030435">Type</span>&nbsp;<span class="op" id="6030440">==</span>&nbsp;<span class="ident" id="6030443"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066231">SymConst</a></span>&nbsp;<span class="op" id="6030452">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030456">return</span>&nbsp;<span class="ident" id="6030463">nil</span><span class="op" id="6030466">,</span>&nbsp;<span class="num" id="6030468">0</span><span class="op" id="6030469">,</span>&nbsp;<span class="num" id="6030471">0</span>&nbsp;<span class="comment" id="6030473">//&nbsp;not&nbsp;my&nbsp;job&nbsp;to&nbsp;fill&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030501">}</span>&nbsp;<span class="keyword" id="6030503">else</span>&nbsp;<span class="keyword" id="6030508">if</span>&nbsp;<span class="ident" id="6030511"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030514">.</span><span class="ident" id="6030515">Type</span>&nbsp;<span class="op" id="6030520">==</span>&nbsp;<span class="ident" id="6030523"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066149">SymImport</a></span>&nbsp;<span class="op" id="6030533">||</span>&nbsp;<span class="ident" id="6030536"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030539">.</span><span class="ident" id="6030540">Type</span>&nbsp;<span class="op" id="6030545">==</span>&nbsp;<span class="ident" id="6030548"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066311">SymLabel</a></span>&nbsp;<span class="op" id="6030557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030561"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029837">b</a></span><span class="op" id="6030562">.</span><span class="ident" id="6030563">err</span><span class="op" id="6030566">(</span><span class="ident" id="6030567"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029898">t</a></span><span class="op" id="6030568">.</span><span class="ident" id="6030569">Pos</span><span class="op" id="6030572">,</span>&nbsp;<span class="string" id="6030574">&#34;%s&nbsp;%q&nbsp;not&nbsp;a&nbsp;symbol&#34;</span><span class="op" id="6030594">,</span>&nbsp;<span class="ident" id="6030596"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066358">symStr</a></span><span class="op" id="6030602">(</span><span class="ident" id="6030603"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029863">ret</a></span><span class="op" id="6030606">.</span><span class="ident" id="6030607">Type</span><span class="op" id="6030611">)</span><span class="op" id="6030612">,</span>&nbsp;<span class="ident" id="6030614"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029898">t</a></span><span class="op" id="6030615">.</span><span class="ident" id="6030616">Lit</span><span class="op" id="6030619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030623">return</span>&nbsp;<span class="ident" id="6030630">nil</span><span class="op" id="6030633">,</span>&nbsp;<span class="num" id="6030635">0</span><span class="op" id="6030636">,</span>&nbsp;<span class="num" id="6030638">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030641">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030645">return</span><br>
<span class="lineno"></span><span class="op" id="6030652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6030655">func</span>&nbsp;<span class="ident" id="6030660">linkSymbol</span><span class="op" id="6030670">(</span><span class="ident" id="6030671">b</span>&nbsp;<span class="op" id="6030673">*</span><span class="ident" id="6030674"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6030681">,</span>&nbsp;<span class="ident" id="6030683">s</span>&nbsp;<span class="op" id="6030685">*</span><span class="ident" id="6030686"><a href="/lonnie.io/e8vm/asm8/func_stmt.go.html#6037088">funcStmt</a></span><span class="op" id="6030694">,</span>&nbsp;<span class="ident" id="6030696">f</span>&nbsp;<span class="op" id="6030698">*</span><span class="ident" id="6030699"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6030704">.</span><span class="ident" id="6030705">Func</span><span class="op" id="6030709">)</span>&nbsp;<span class="op" id="6030711">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030714">t</span>&nbsp;<span class="op" id="6030716">:=</span>&nbsp;<span class="ident" id="6030719"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030683">s</a></span><span class="op" id="6030720">.</span><span class="ident" id="6030721">symTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030729">if</span>&nbsp;<span class="ident" id="6030732"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030671">b</a></span><span class="op" id="6030733">.</span><span class="ident" id="6030734">curPkg</span>&nbsp;<span class="op" id="6030741">==</span>&nbsp;<span class="ident" id="6030744">nil</span>&nbsp;<span class="op" id="6030748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030752"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030671">b</a></span><span class="op" id="6030753">.</span><span class="ident" id="6030754">err</span><span class="op" id="6030757">(</span><span class="ident" id="6030758"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030714">t</a></span><span class="op" id="6030759">.</span><span class="ident" id="6030760">Pos</span><span class="op" id="6030763">,</span>&nbsp;<span class="string" id="6030765">&#34;no&nbsp;context&nbsp;for&nbsp;resolving&nbsp;%q&#34;</span><span class="op" id="6030794">,</span>&nbsp;<span class="ident" id="6030796"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030714">t</a></span><span class="op" id="6030797">.</span><span class="ident" id="6030798">Lit</span><span class="op" id="6030801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030805">return</span>&nbsp;<span class="comment" id="6030812">//&nbsp;this&nbsp;may&nbsp;happen&nbsp;for&nbsp;bare&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030850">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030854">sym</span><span class="op" id="6030857">,</span>&nbsp;<span class="ident" id="6030859">pkg</span><span class="op" id="6030862">,</span>&nbsp;<span class="ident" id="6030864">index</span>&nbsp;<span class="op" id="6030870">:=</span>&nbsp;<span class="ident" id="6030873"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6029823">resolveSymbol</a></span><span class="op" id="6030886">(</span><span class="ident" id="6030887"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030671">b</a></span><span class="op" id="6030888">,</span>&nbsp;<span class="ident" id="6030890"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030683">s</a></span><span class="op" id="6030891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030894">if</span>&nbsp;<span class="ident" id="6030897"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030854">sym</a></span>&nbsp;<span class="op" id="6030901">==</span>&nbsp;<span class="ident" id="6030904">nil</span>&nbsp;<span class="op" id="6030908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030912">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030920">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030924">if</span>&nbsp;<span class="ident" id="6030927"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030683">s</a></span><span class="op" id="6030928">.</span><span class="ident" id="6030929">fill</span>&nbsp;<span class="op" id="6030934">==</span>&nbsp;<span class="ident" id="6030937"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037419">fillLink</a></span>&nbsp;<span class="op" id="6030946">&amp;&amp;</span>&nbsp;<span class="ident" id="6030949"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030854">sym</a></span><span class="op" id="6030952">.</span><span class="ident" id="6030953">Type</span>&nbsp;<span class="op" id="6030958">!=</span>&nbsp;<span class="ident" id="6030961"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066191">SymFunc</a></span>&nbsp;<span class="op" id="6030969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030973"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030671">b</a></span><span class="op" id="6030974">.</span><span class="ident" id="6030975">err</span><span class="op" id="6030978">(</span><span class="ident" id="6030979"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030714">t</a></span><span class="op" id="6030980">.</span><span class="ident" id="6030981">Pos</span><span class="op" id="6030984">,</span>&nbsp;<span class="string" id="6030986">&#34;%s&nbsp;%q&nbsp;is&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="6031011">,</span>&nbsp;<span class="ident" id="6031013"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066358">symStr</a></span><span class="op" id="6031019">(</span><span class="ident" id="6031020"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030854">sym</a></span><span class="op" id="6031023">.</span><span class="ident" id="6031024">Type</span><span class="op" id="6031028">)</span><span class="op" id="6031029">,</span>&nbsp;<span class="ident" id="6031031"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030714">t</a></span><span class="op" id="6031032">.</span><span class="ident" id="6031033">Lit</span><span class="op" id="6031036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031040">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031048">}</span>&nbsp;<span class="keyword" id="6031050">else</span>&nbsp;<span class="keyword" id="6031055">if</span>&nbsp;<span class="ident" id="6031058"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030859">pkg</a></span>&nbsp;<span class="op" id="6031062">&gt;</span>&nbsp;<span class="num" id="6031064">0</span>&nbsp;<span class="op" id="6031066">&amp;&amp;</span>&nbsp;<span class="op" id="6031069">!</span><span class="ident" id="6031070"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#6066642">isPublic</a></span><span class="op" id="6031078">(</span><span class="ident" id="6031079"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030854">sym</a></span><span class="op" id="6031082">.</span><span class="ident" id="6031083">Name</span><span class="op" id="6031087">)</span>&nbsp;<span class="op" id="6031089">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031093">//&nbsp;for&nbsp;imported&nbsp;package,&nbsp;check&nbsp;if&nbsp;it&nbsp;is&nbsp;public</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031142"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030671">b</a></span><span class="op" id="6031143">.</span><span class="ident" id="6031144">err</span><span class="op" id="6031147">(</span><span class="ident" id="6031148"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030714">t</a></span><span class="op" id="6031149">.</span><span class="ident" id="6031150">Pos</span><span class="op" id="6031153">,</span>&nbsp;<span class="string" id="6031155">&#34;%q&nbsp;is&nbsp;not&nbsp;public&#34;</span><span class="op" id="6031173">,</span>&nbsp;<span class="ident" id="6031175"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030714">t</a></span><span class="op" id="6031176">.</span><span class="ident" id="6031177">Lit</span><span class="op" id="6031180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031184">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031196">//&nbsp;save&nbsp;the&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031214"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030696">f</a></span><span class="op" id="6031215">.</span><span class="ident" id="6031216">AddLink</span><span class="op" id="6031223">(</span><span class="ident" id="6031224"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030683">s</a></span><span class="op" id="6031225">.</span><span class="ident" id="6031226">fill</span><span class="op" id="6031230">,</span>&nbsp;<span class="ident" id="6031232"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030859">pkg</a></span><span class="op" id="6031235">,</span>&nbsp;<span class="ident" id="6031237"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030864">index</a></span><span class="op" id="6031242">)</span><br>
<span class="lineno"></span><span class="op" id="6031244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6031247">//&nbsp;makeFuncObj&nbsp;converts&nbsp;a&nbsp;function&nbsp;AST&nbsp;node&nbsp;f&nbsp;into&nbsp;a&nbsp;function&nbsp;object.&nbsp;It</span><br>
<span class="lineno">200</span><span class="comment" id="6031320">//&nbsp;resolves&nbsp;the&nbsp;symbols&nbsp;of&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;into&nbsp;&lt;pack,&nbsp;sym&gt;</span><br>
<span class="lineno"></span><span class="comment" id="6031395">//&nbsp;index&nbsp;pairs,&nbsp;using&nbsp;the&nbsp;symbol&nbsp;scope&nbsp;and&nbsp;the&nbsp;curPkg&nbsp;context&nbsp;in&nbsp;the&nbsp;Builder&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="6031475">func</span>&nbsp;<span class="ident" id="6031480">makeFuncObj</span><span class="op" id="6031491">(</span><span class="ident" id="6031492">b</span>&nbsp;<span class="op" id="6031494">*</span><span class="ident" id="6031495"><a href="/lonnie.io/e8vm/asm8/builder.go.html#6033886">builder</a></span><span class="op" id="6031502">,</span>&nbsp;<span class="ident" id="6031504">f</span>&nbsp;<span class="op" id="6031506">*</span><span class="ident" id="6031507"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#6036889">funcDecl</a></span><span class="op" id="6031515">)</span>&nbsp;<span class="op" id="6031517">*</span><span class="ident" id="6031518"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6031523">.</span><span class="ident" id="6031524">Func</span>&nbsp;<span class="op" id="6031529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031532">ret</span>&nbsp;<span class="op" id="6031536">:=</span>&nbsp;<span class="ident" id="6031539"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6027018">link8</a></span><span class="op" id="6031544">.</span><span class="ident" id="6031545">NewFunc</span><span class="op" id="6031552">(</span><span class="op" id="6031553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031556">for</span>&nbsp;<span class="ident" id="6031560">_</span><span class="op" id="6031561">,</span>&nbsp;<span class="ident" id="6031563">s</span>&nbsp;<span class="op" id="6031565">:=</span>&nbsp;<span class="keyword" id="6031568">range</span>&nbsp;<span class="ident" id="6031574"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031504">f</a></span><span class="op" id="6031575">.</span><span class="ident" id="6031576">stmts</span>&nbsp;<span class="op" id="6031582">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031586">if</span>&nbsp;<span class="ident" id="6031589"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031563">s</a></span><span class="op" id="6031590">.</span><span class="ident" id="6031591">isLabel</span><span class="op" id="6031598">(</span><span class="op" id="6031599">)</span>&nbsp;<span class="op" id="6031601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031606">continue</span>&nbsp;<span class="comment" id="6031615">//&nbsp;skip&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031636"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031532">ret</a></span><span class="op" id="6031639">.</span><span class="ident" id="6031640">AddInst</span><span class="op" id="6031647">(</span><span class="ident" id="6031648"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031563">s</a></span><span class="op" id="6031649">.</span><span class="ident" id="6031650">inst</span><span class="op" id="6031654">.</span><span class="ident" id="6031655">inst</span><span class="op" id="6031659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031664">if</span>&nbsp;<span class="op" id="6031667">!</span><span class="op" id="6031668">(</span><span class="ident" id="6031669"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031563">s</a></span><span class="op" id="6031670">.</span><span class="ident" id="6031671">fill</span>&nbsp;<span class="op" id="6031676">&gt;</span>&nbsp;<span class="ident" id="6031678"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037402">fillNone</a></span>&nbsp;<span class="op" id="6031687">&amp;&amp;</span>&nbsp;<span class="ident" id="6031690"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031563">s</a></span><span class="op" id="6031691">.</span><span class="ident" id="6031692">fill</span>&nbsp;<span class="op" id="6031697">&lt;</span>&nbsp;<span class="ident" id="6031699"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037503">fillLabel</a></span><span class="op" id="6031708">)</span>&nbsp;<span class="op" id="6031710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031715">continue</span>&nbsp;<span class="comment" id="6031724">//&nbsp;only&nbsp;care&nbsp;about&nbsp;fillHigh,&nbsp;fillLow&nbsp;and&nbsp;fillLink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031781"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6030660">linkSymbol</a></span><span class="op" id="6031791">(</span><span class="ident" id="6031792"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031492">b</a></span><span class="op" id="6031793">,</span>&nbsp;<span class="ident" id="6031795"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031563">s</a></span><span class="op" id="6031796">,</span>&nbsp;<span class="ident" id="6031798"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031532">ret</a></span><span class="op" id="6031801">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031808">if</span>&nbsp;<span class="ident" id="6031811"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031532">ret</a></span><span class="op" id="6031814">.</span><span class="ident" id="6031815">TooLarge</span><span class="op" id="6031823">(</span><span class="op" id="6031824">)</span>&nbsp;<span class="op" id="6031826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031830"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031492">b</a></span><span class="op" id="6031831">.</span><span class="ident" id="6031832">err</span><span class="op" id="6031835">(</span><span class="ident" id="6031836"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031504">f</a></span><span class="op" id="6031837">.</span><span class="ident" id="6031838">name</span><span class="op" id="6031842">.</span><span class="ident" id="6031843">Pos</span><span class="op" id="6031846">,</span>&nbsp;<span class="string" id="6031848">&#34;too&nbsp;many&nbsp;instructions&nbsp;in&nbsp;func&#34;</span><span class="op" id="6031879">,</span>&nbsp;<span class="ident" id="6031881"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031504">f</a></span><span class="op" id="6031882">.</span><span class="ident" id="6031883">name</span><span class="op" id="6031887">.</span><span class="ident" id="6031888">Lit</span><span class="op" id="6031891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031894">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031898">return</span>&nbsp;<span class="ident" id="6031905"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#6031532">ret</a></span><br>
<span class="lineno"></span><span class="op" id="6031909">}</span>
</div>
</body>
</html>
