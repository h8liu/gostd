<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1372669">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1372724">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1372778">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1372829">package</span>&nbsp;<span class="ident" id="1372837">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1372844">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1372888">import</span>&nbsp;<span class="op" id="1372895">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1372898">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1372908">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1372914">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1372929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1372932">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1373009">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1373071">type</span>&nbsp;<span class="ident" id="1373076">Buffer</span>&nbsp;<span class="keyword" id="1373083">struct</span>&nbsp;<span class="op" id="1373090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373093">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1373103">[</span><span class="op" id="1373104">]</span><span class="builtintype" id="1373105">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1373121">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373168">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1373178">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1373196">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373243">runeBytes</span>&nbsp;<span class="op" id="1373253">[</span><span class="ident" id="1373254">utf8</span><span class="op" id="1373258">.</span><span class="ident" id="1373259">UTFMax</span><span class="op" id="1373265">]</span><span class="builtintype" id="1373266">byte</span>&nbsp;<span class="comment" id="1373271">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373327">bootstrap</span>&nbsp;<span class="op" id="1373337">[</span><span class="num" id="1373338">64</span><span class="op" id="1373340">]</span><span class="builtintype" id="1373341">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1373355">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373434">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1373444">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1373462">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1373522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1373525">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1373587">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1373640">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1373668">type</span>&nbsp;<span class="ident" id="1373673">readOp</span>&nbsp;<span class="builtintype" id="1373680">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1373685">const</span>&nbsp;<span class="op" id="1373691">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373694">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1373705">readOp</span>&nbsp;<span class="op" id="1373712">=</span>&nbsp;<span class="ident" id="1373714">iota</span>&nbsp;<span class="comment" id="1373719">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373743">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1373768">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373783">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1373808">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1373837">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1373840">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1373931">var</span>&nbsp;<span class="ident" id="1373935">ErrTooLarge</span>&nbsp;<span class="op" id="1373947">=</span>&nbsp;<span class="ident" id="1373949">errors</span><span class="op" id="1373955">.</span><span class="ident" id="1373956">New</span><span class="op" id="1373959">(</span><span class="string" id="1373960">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1373985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1373988">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1374066">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1374139">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1374212">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1374262">func</span>&nbsp;<span class="op" id="1374267">(</span><span class="ident" id="1374268">b</span>&nbsp;<span class="op" id="1374270">*</span><span class="ident" id="1374271">Buffer</span><span class="op" id="1374277">)</span>&nbsp;<span class="ident" id="1374279">Bytes</span><span class="op" id="1374284">(</span><span class="op" id="1374285">)</span>&nbsp;<span class="op" id="1374287">[</span><span class="op" id="1374288">]</span><span class="builtintype" id="1374289">byte</span>&nbsp;<span class="op" id="1374294">{</span>&nbsp;<span class="keyword" id="1374296">return</span>&nbsp;<span class="ident" id="1374303">b</span><span class="op" id="1374304">.</span><span class="ident" id="1374305">buf</span><span class="op" id="1374308">[</span><span class="ident" id="1374309">b</span><span class="op" id="1374310">.</span><span class="ident" id="1374311">off</span><span class="op" id="1374314">:</span><span class="op" id="1374315">]</span>&nbsp;<span class="op" id="1374317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1374320">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1374387">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1374456">func</span>&nbsp;<span class="op" id="1374461">(</span><span class="ident" id="1374462">b</span>&nbsp;<span class="op" id="1374464">*</span><span class="ident" id="1374465">Buffer</span><span class="op" id="1374471">)</span>&nbsp;<span class="ident" id="1374473">String</span><span class="op" id="1374479">(</span><span class="op" id="1374480">)</span>&nbsp;<span class="builtintype" id="1374482">string</span>&nbsp;<span class="op" id="1374489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374492">if</span>&nbsp;<span class="ident" id="1374495">b</span>&nbsp;<span class="op" id="1374497">==</span>&nbsp;<span class="ident" id="1374500">nil</span>&nbsp;<span class="op" id="1374504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1374508">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374548">return</span>&nbsp;<span class="string" id="1374555">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374567">return</span>&nbsp;<span class="builtintype" id="1374574">string</span><span class="op" id="1374580">(</span><span class="ident" id="1374581">b</span><span class="op" id="1374582">.</span><span class="ident" id="1374583">buf</span><span class="op" id="1374586">[</span><span class="ident" id="1374587">b</span><span class="op" id="1374588">.</span><span class="ident" id="1374589">off</span><span class="op" id="1374592">:</span><span class="op" id="1374593">]</span><span class="op" id="1374594">)</span><br>
<span class="lineno"></span><span class="op" id="1374596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1374599">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1374671">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1374701">func</span>&nbsp;<span class="op" id="1374706">(</span><span class="ident" id="1374707">b</span>&nbsp;<span class="op" id="1374709">*</span><span class="ident" id="1374710">Buffer</span><span class="op" id="1374716">)</span>&nbsp;<span class="ident" id="1374718">Len</span><span class="op" id="1374721">(</span><span class="op" id="1374722">)</span>&nbsp;<span class="builtintype" id="1374724">int</span>&nbsp;<span class="op" id="1374728">{</span>&nbsp;<span class="keyword" id="1374730">return</span>&nbsp;<span class="builtinfunc" id="1374737">len</span><span class="op" id="1374740">(</span><span class="ident" id="1374741">b</span><span class="op" id="1374742">.</span><span class="ident" id="1374743">buf</span><span class="op" id="1374746">)</span>&nbsp;<span class="op" id="1374748">-</span>&nbsp;<span class="ident" id="1374750">b</span><span class="op" id="1374751">.</span><span class="ident" id="1374752">off</span>&nbsp;<span class="op" id="1374756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1374759">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1374830">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1374902">func</span>&nbsp;<span class="op" id="1374907">(</span><span class="ident" id="1374908">b</span>&nbsp;<span class="op" id="1374910">*</span><span class="ident" id="1374911">Buffer</span><span class="op" id="1374917">)</span>&nbsp;<span class="ident" id="1374919">Truncate</span><span class="op" id="1374927">(</span><span class="ident" id="1374928">n</span>&nbsp;<span class="builtintype" id="1374930">int</span><span class="op" id="1374933">)</span>&nbsp;<span class="op" id="1374935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374938">b</span><span class="op" id="1374939">.</span><span class="ident" id="1374940">lastRead</span>&nbsp;<span class="op" id="1374949">=</span>&nbsp;<span class="ident" id="1374951">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374962">switch</span>&nbsp;<span class="op" id="1374969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374972">case</span>&nbsp;<span class="ident" id="1374977">n</span>&nbsp;<span class="op" id="1374979">&lt;</span>&nbsp;<span class="num" id="1374981">0</span>&nbsp;<span class="op" id="1374983">||</span>&nbsp;<span class="ident" id="1374986">n</span>&nbsp;<span class="op" id="1374988">&gt;</span>&nbsp;<span class="ident" id="1374990">b</span><span class="op" id="1374991">.</span><span class="ident" id="1374992">Len</span><span class="op" id="1374995">(</span><span class="op" id="1374996">)</span><span class="op" id="1374997">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1375001">panic</span><span class="op" id="1375006">(</span><span class="string" id="1375007">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1375046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375049">case</span>&nbsp;<span class="ident" id="1375054">n</span>&nbsp;<span class="op" id="1375056">==</span>&nbsp;<span class="num" id="1375059">0</span><span class="op" id="1375060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375064">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375089">b</span><span class="op" id="1375090">.</span><span class="ident" id="1375091">off</span>&nbsp;<span class="op" id="1375095">=</span>&nbsp;<span class="num" id="1375097">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375100">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375103">b</span><span class="op" id="1375104">.</span><span class="ident" id="1375105">buf</span>&nbsp;<span class="op" id="1375109">=</span>&nbsp;<span class="ident" id="1375111">b</span><span class="op" id="1375112">.</span><span class="ident" id="1375113">buf</span><span class="op" id="1375116">[</span><span class="num" id="1375117">0</span>&nbsp;<span class="op" id="1375119">:</span>&nbsp;<span class="ident" id="1375121">b</span><span class="op" id="1375122">.</span><span class="ident" id="1375123">off</span><span class="op" id="1375126">+</span><span class="ident" id="1375127">n</span><span class="op" id="1375128">]</span><br>
<span class="lineno"></span><span class="op" id="1375130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1375133">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1375182">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1375225">func</span>&nbsp;<span class="op" id="1375230">(</span><span class="ident" id="1375231">b</span>&nbsp;<span class="op" id="1375233">*</span><span class="ident" id="1375234">Buffer</span><span class="op" id="1375240">)</span>&nbsp;<span class="ident" id="1375242">Reset</span><span class="op" id="1375247">(</span><span class="op" id="1375248">)</span>&nbsp;<span class="op" id="1375250">{</span>&nbsp;<span class="ident" id="1375252">b</span><span class="op" id="1375253">.</span><span class="ident" id="1375254">Truncate</span><span class="op" id="1375262">(</span><span class="num" id="1375263">0</span><span class="op" id="1375264">)</span>&nbsp;<span class="op" id="1375266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1375269">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1375331">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1375386">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1375446">func</span>&nbsp;<span class="op" id="1375451">(</span><span class="ident" id="1375452">b</span>&nbsp;<span class="op" id="1375454">*</span><span class="ident" id="1375455">Buffer</span><span class="op" id="1375461">)</span>&nbsp;<span class="ident" id="1375463">grow</span><span class="op" id="1375467">(</span><span class="ident" id="1375468">n</span>&nbsp;<span class="builtintype" id="1375470">int</span><span class="op" id="1375473">)</span>&nbsp;<span class="builtintype" id="1375475">int</span>&nbsp;<span class="op" id="1375479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375482">m</span>&nbsp;<span class="op" id="1375484">:=</span>&nbsp;<span class="ident" id="1375487">b</span><span class="op" id="1375488">.</span><span class="ident" id="1375489">Len</span><span class="op" id="1375492">(</span><span class="op" id="1375493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375496">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375544">if</span>&nbsp;<span class="ident" id="1375547">m</span>&nbsp;<span class="op" id="1375549">==</span>&nbsp;<span class="num" id="1375552">0</span>&nbsp;<span class="op" id="1375554">&amp;&amp;</span>&nbsp;<span class="ident" id="1375557">b</span><span class="op" id="1375558">.</span><span class="ident" id="1375559">off</span>&nbsp;<span class="op" id="1375563">!=</span>&nbsp;<span class="num" id="1375566">0</span>&nbsp;<span class="op" id="1375568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375572">b</span><span class="op" id="1375573">.</span><span class="ident" id="1375574">Truncate</span><span class="op" id="1375582">(</span><span class="num" id="1375583">0</span><span class="op" id="1375584">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375590">if</span>&nbsp;<span class="builtinfunc" id="1375593">len</span><span class="op" id="1375596">(</span><span class="ident" id="1375597">b</span><span class="op" id="1375598">.</span><span class="ident" id="1375599">buf</span><span class="op" id="1375602">)</span><span class="op" id="1375603">+</span><span class="ident" id="1375604">n</span>&nbsp;<span class="op" id="1375606">&gt;</span>&nbsp;<span class="builtinfunc" id="1375608">cap</span><span class="op" id="1375611">(</span><span class="ident" id="1375612">b</span><span class="op" id="1375613">.</span><span class="ident" id="1375614">buf</span><span class="op" id="1375617">)</span>&nbsp;<span class="op" id="1375619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375623">var</span>&nbsp;<span class="ident" id="1375627">buf</span>&nbsp;<span class="op" id="1375631">[</span><span class="op" id="1375632">]</span><span class="builtintype" id="1375633">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375640">if</span>&nbsp;<span class="ident" id="1375643">b</span><span class="op" id="1375644">.</span><span class="ident" id="1375645">buf</span>&nbsp;<span class="op" id="1375649">==</span>&nbsp;<span class="ident" id="1375652">nil</span>&nbsp;<span class="op" id="1375656">&amp;&amp;</span>&nbsp;<span class="ident" id="1375659">n</span>&nbsp;<span class="op" id="1375661">&lt;=</span>&nbsp;<span class="builtinfunc" id="1375664">len</span><span class="op" id="1375667">(</span><span class="ident" id="1375668">b</span><span class="op" id="1375669">.</span><span class="ident" id="1375670">bootstrap</span><span class="op" id="1375679">)</span>&nbsp;<span class="op" id="1375681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375686">buf</span>&nbsp;<span class="op" id="1375690">=</span>&nbsp;<span class="ident" id="1375692">b</span><span class="op" id="1375693">.</span><span class="ident" id="1375694">bootstrap</span><span class="op" id="1375703">[</span><span class="num" id="1375704">0</span><span class="op" id="1375705">:</span><span class="op" id="1375706">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375710">}</span>&nbsp;<span class="keyword" id="1375712">else</span>&nbsp;<span class="keyword" id="1375717">if</span>&nbsp;<span class="ident" id="1375720">m</span><span class="op" id="1375721">+</span><span class="ident" id="1375722">n</span>&nbsp;<span class="op" id="1375724">&lt;=</span>&nbsp;<span class="builtinfunc" id="1375727">cap</span><span class="op" id="1375730">(</span><span class="ident" id="1375731">b</span><span class="op" id="1375732">.</span><span class="ident" id="1375733">buf</span><span class="op" id="1375736">)</span><span class="op" id="1375737">/</span><span class="num" id="1375738">2</span>&nbsp;<span class="op" id="1375740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375745">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375804">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375862">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375917">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1375957">copy</span><span class="op" id="1375961">(</span><span class="ident" id="1375962">b</span><span class="op" id="1375963">.</span><span class="ident" id="1375964">buf</span><span class="op" id="1375967">[</span><span class="op" id="1375968">:</span><span class="op" id="1375969">]</span><span class="op" id="1375970">,</span>&nbsp;<span class="ident" id="1375972">b</span><span class="op" id="1375973">.</span><span class="ident" id="1375974">buf</span><span class="op" id="1375977">[</span><span class="ident" id="1375978">b</span><span class="op" id="1375979">.</span><span class="ident" id="1375980">off</span><span class="op" id="1375983">:</span><span class="op" id="1375984">]</span><span class="op" id="1375985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375990">buf</span>&nbsp;<span class="op" id="1375994">=</span>&nbsp;<span class="ident" id="1375996">b</span><span class="op" id="1375997">.</span><span class="ident" id="1375998">buf</span><span class="op" id="1376001">[</span><span class="op" id="1376002">:</span><span class="ident" id="1376003">m</span><span class="op" id="1376004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376008">}</span>&nbsp;<span class="keyword" id="1376010">else</span>&nbsp;<span class="op" id="1376015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1376020">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376052">buf</span>&nbsp;<span class="op" id="1376056">=</span>&nbsp;<span class="ident" id="1376058">makeSlice</span><span class="op" id="1376067">(</span><span class="num" id="1376068">2</span><span class="op" id="1376069">*</span><span class="builtinfunc" id="1376070">cap</span><span class="op" id="1376073">(</span><span class="ident" id="1376074">b</span><span class="op" id="1376075">.</span><span class="ident" id="1376076">buf</span><span class="op" id="1376079">)</span>&nbsp;<span class="op" id="1376081">+</span>&nbsp;<span class="ident" id="1376083">n</span><span class="op" id="1376084">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1376089">copy</span><span class="op" id="1376093">(</span><span class="ident" id="1376094">buf</span><span class="op" id="1376097">,</span>&nbsp;<span class="ident" id="1376099">b</span><span class="op" id="1376100">.</span><span class="ident" id="1376101">buf</span><span class="op" id="1376104">[</span><span class="ident" id="1376105">b</span><span class="op" id="1376106">.</span><span class="ident" id="1376107">off</span><span class="op" id="1376110">:</span><span class="op" id="1376111">]</span><span class="op" id="1376112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376120">b</span><span class="op" id="1376121">.</span><span class="ident" id="1376122">buf</span>&nbsp;<span class="op" id="1376126">=</span>&nbsp;<span class="ident" id="1376128">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376134">b</span><span class="op" id="1376135">.</span><span class="ident" id="1376136">off</span>&nbsp;<span class="op" id="1376140">=</span>&nbsp;<span class="num" id="1376142">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376145">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376148">b</span><span class="op" id="1376149">.</span><span class="ident" id="1376150">buf</span>&nbsp;<span class="op" id="1376154">=</span>&nbsp;<span class="ident" id="1376156">b</span><span class="op" id="1376157">.</span><span class="ident" id="1376158">buf</span><span class="op" id="1376161">[</span><span class="num" id="1376162">0</span>&nbsp;<span class="op" id="1376164">:</span>&nbsp;<span class="ident" id="1376166">b</span><span class="op" id="1376167">.</span><span class="ident" id="1376168">off</span><span class="op" id="1376171">+</span><span class="ident" id="1376172">m</span><span class="op" id="1376173">+</span><span class="ident" id="1376174">n</span><span class="op" id="1376175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376178">return</span>&nbsp;<span class="ident" id="1376185">b</span><span class="op" id="1376186">.</span><span class="ident" id="1376187">off</span>&nbsp;<span class="op" id="1376191">+</span>&nbsp;<span class="ident" id="1376193">m</span><br>
<span class="lineno"></span><span class="op" id="1376195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1376198">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1376272">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1376346">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1376384">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1376422">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1376482">func</span>&nbsp;<span class="op" id="1376487">(</span><span class="ident" id="1376488">b</span>&nbsp;<span class="op" id="1376490">*</span><span class="ident" id="1376491">Buffer</span><span class="op" id="1376497">)</span>&nbsp;<span class="ident" id="1376499">Grow</span><span class="op" id="1376503">(</span><span class="ident" id="1376504">n</span>&nbsp;<span class="builtintype" id="1376506">int</span><span class="op" id="1376509">)</span>&nbsp;<span class="op" id="1376511">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376514">if</span>&nbsp;<span class="ident" id="1376517">n</span>&nbsp;<span class="op" id="1376519">&lt;</span>&nbsp;<span class="num" id="1376521">0</span>&nbsp;<span class="op" id="1376523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1376527">panic</span><span class="op" id="1376532">(</span><span class="string" id="1376533">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1376568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376574">m</span>&nbsp;<span class="op" id="1376576">:=</span>&nbsp;<span class="ident" id="1376579">b</span><span class="op" id="1376580">.</span><span class="ident" id="1376581">grow</span><span class="op" id="1376585">(</span><span class="ident" id="1376586">n</span><span class="op" id="1376587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376590">b</span><span class="op" id="1376591">.</span><span class="ident" id="1376592">buf</span>&nbsp;<span class="op" id="1376596">=</span>&nbsp;<span class="ident" id="1376598">b</span><span class="op" id="1376599">.</span><span class="ident" id="1376600">buf</span><span class="op" id="1376603">[</span><span class="num" id="1376604">0</span><span class="op" id="1376605">:</span><span class="ident" id="1376606">m</span><span class="op" id="1376607">]</span><br>
<span class="lineno">120</span><span class="op" id="1376609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1376612">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1376684">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1376760">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1376824">func</span>&nbsp;<span class="op" id="1376829">(</span><span class="ident" id="1376830">b</span>&nbsp;<span class="op" id="1376832">*</span><span class="ident" id="1376833">Buffer</span><span class="op" id="1376839">)</span>&nbsp;<span class="ident" id="1376841">Write</span><span class="op" id="1376846">(</span><span class="ident" id="1376847">p</span>&nbsp;<span class="op" id="1376849">[</span><span class="op" id="1376850">]</span><span class="builtintype" id="1376851">byte</span><span class="op" id="1376855">)</span>&nbsp;<span class="op" id="1376857">(</span><span class="ident" id="1376858">n</span>&nbsp;<span class="builtintype" id="1376860">int</span><span class="op" id="1376863">,</span>&nbsp;<span class="ident" id="1376865">err</span>&nbsp;<span class="builtintype" id="1376869">error</span><span class="op" id="1376874">)</span>&nbsp;<span class="op" id="1376876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376879">b</span><span class="op" id="1376880">.</span><span class="ident" id="1376881">lastRead</span>&nbsp;<span class="op" id="1376890">=</span>&nbsp;<span class="ident" id="1376892">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376903">m</span>&nbsp;<span class="op" id="1376905">:=</span>&nbsp;<span class="ident" id="1376908">b</span><span class="op" id="1376909">.</span><span class="ident" id="1376910">grow</span><span class="op" id="1376914">(</span><span class="builtinfunc" id="1376915">len</span><span class="op" id="1376918">(</span><span class="ident" id="1376919">p</span><span class="op" id="1376920">)</span><span class="op" id="1376921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376924">return</span>&nbsp;<span class="builtinfunc" id="1376931">copy</span><span class="op" id="1376935">(</span><span class="ident" id="1376936">b</span><span class="op" id="1376937">.</span><span class="ident" id="1376938">buf</span><span class="op" id="1376941">[</span><span class="ident" id="1376942">m</span><span class="op" id="1376943">:</span><span class="op" id="1376944">]</span><span class="op" id="1376945">,</span>&nbsp;<span class="ident" id="1376947">p</span><span class="op" id="1376948">)</span><span class="op" id="1376949">,</span>&nbsp;<span class="ident" id="1376951">nil</span><br>
<span class="lineno"></span><span class="op" id="1376955">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1376958">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1377036">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1377112">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1377182">func</span>&nbsp;<span class="op" id="1377187">(</span><span class="ident" id="1377188">b</span>&nbsp;<span class="op" id="1377190">*</span><span class="ident" id="1377191">Buffer</span><span class="op" id="1377197">)</span>&nbsp;<span class="ident" id="1377199">WriteString</span><span class="op" id="1377210">(</span><span class="ident" id="1377211">s</span>&nbsp;<span class="builtintype" id="1377213">string</span><span class="op" id="1377219">)</span>&nbsp;<span class="op" id="1377221">(</span><span class="ident" id="1377222">n</span>&nbsp;<span class="builtintype" id="1377224">int</span><span class="op" id="1377227">,</span>&nbsp;<span class="ident" id="1377229">err</span>&nbsp;<span class="builtintype" id="1377233">error</span><span class="op" id="1377238">)</span>&nbsp;<span class="op" id="1377240">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377243">b</span><span class="op" id="1377244">.</span><span class="ident" id="1377245">lastRead</span>&nbsp;<span class="op" id="1377254">=</span>&nbsp;<span class="ident" id="1377256">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377267">m</span>&nbsp;<span class="op" id="1377269">:=</span>&nbsp;<span class="ident" id="1377272">b</span><span class="op" id="1377273">.</span><span class="ident" id="1377274">grow</span><span class="op" id="1377278">(</span><span class="builtinfunc" id="1377279">len</span><span class="op" id="1377282">(</span><span class="ident" id="1377283">s</span><span class="op" id="1377284">)</span><span class="op" id="1377285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1377288">return</span>&nbsp;<span class="builtinfunc" id="1377295">copy</span><span class="op" id="1377299">(</span><span class="ident" id="1377300">b</span><span class="op" id="1377301">.</span><span class="ident" id="1377302">buf</span><span class="op" id="1377305">[</span><span class="ident" id="1377306">m</span><span class="op" id="1377307">:</span><span class="op" id="1377308">]</span><span class="op" id="1377309">,</span>&nbsp;<span class="ident" id="1377311">s</span><span class="op" id="1377312">)</span><span class="op" id="1377313">,</span>&nbsp;<span class="ident" id="1377315">nil</span><br>
<span class="lineno"></span><span class="op" id="1377319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1377322">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1377384">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1377461">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1377535">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1377557">const</span>&nbsp;<span class="ident" id="1377563">MinRead</span>&nbsp;<span class="op" id="1377571">=</span>&nbsp;<span class="num" id="1377573">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1377578">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1377656">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1377733">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1377809">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1377876">func</span>&nbsp;<span class="op" id="1377881">(</span><span class="ident" id="1377882">b</span>&nbsp;<span class="op" id="1377884">*</span><span class="ident" id="1377885">Buffer</span><span class="op" id="1377891">)</span>&nbsp;<span class="ident" id="1377893">ReadFrom</span><span class="op" id="1377901">(</span><span class="ident" id="1377902">r</span>&nbsp;<span class="ident" id="1377904">io</span><span class="op" id="1377906">.</span><span class="ident" id="1377907">Reader</span><span class="op" id="1377913">)</span>&nbsp;<span class="op" id="1377915">(</span><span class="ident" id="1377916">n</span>&nbsp;<span class="ident" id="1377918">int64</span><span class="op" id="1377923">,</span>&nbsp;<span class="ident" id="1377925">err</span>&nbsp;<span class="builtintype" id="1377929">error</span><span class="op" id="1377934">)</span>&nbsp;<span class="op" id="1377936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377939">b</span><span class="op" id="1377940">.</span><span class="ident" id="1377941">lastRead</span>&nbsp;<span class="op" id="1377950">=</span>&nbsp;<span class="ident" id="1377952">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1377963">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378011">if</span>&nbsp;<span class="ident" id="1378014">b</span><span class="op" id="1378015">.</span><span class="ident" id="1378016">off</span>&nbsp;<span class="op" id="1378020">&gt;=</span>&nbsp;<span class="builtinfunc" id="1378023">len</span><span class="op" id="1378026">(</span><span class="ident" id="1378027">b</span><span class="op" id="1378028">.</span><span class="ident" id="1378029">buf</span><span class="op" id="1378032">)</span>&nbsp;<span class="op" id="1378034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378038">b</span><span class="op" id="1378039">.</span><span class="ident" id="1378040">Truncate</span><span class="op" id="1378048">(</span><span class="num" id="1378049">0</span><span class="op" id="1378050">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378056">for</span>&nbsp;<span class="op" id="1378060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378064">if</span>&nbsp;<span class="ident" id="1378067">free</span>&nbsp;<span class="op" id="1378072">:=</span>&nbsp;<span class="builtinfunc" id="1378075">cap</span><span class="op" id="1378078">(</span><span class="ident" id="1378079">b</span><span class="op" id="1378080">.</span><span class="ident" id="1378081">buf</span><span class="op" id="1378084">)</span>&nbsp;<span class="op" id="1378086">-</span>&nbsp;<span class="builtinfunc" id="1378088">len</span><span class="op" id="1378091">(</span><span class="ident" id="1378092">b</span><span class="op" id="1378093">.</span><span class="ident" id="1378094">buf</span><span class="op" id="1378097">)</span><span class="op" id="1378098">;</span>&nbsp;<span class="ident" id="1378100">free</span>&nbsp;<span class="op" id="1378105">&lt;</span>&nbsp;<span class="ident" id="1378107">MinRead</span>&nbsp;<span class="op" id="1378115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378120">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378150">newBuf</span>&nbsp;<span class="op" id="1378157">:=</span>&nbsp;<span class="ident" id="1378160">b</span><span class="op" id="1378161">.</span><span class="ident" id="1378162">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378169">if</span>&nbsp;<span class="ident" id="1378172">b</span><span class="op" id="1378173">.</span><span class="ident" id="1378174">off</span><span class="op" id="1378177">+</span><span class="ident" id="1378178">free</span>&nbsp;<span class="op" id="1378183">&lt;</span>&nbsp;<span class="ident" id="1378185">MinRead</span>&nbsp;<span class="op" id="1378193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378199">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378250">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378280">newBuf</span>&nbsp;<span class="op" id="1378287">=</span>&nbsp;<span class="ident" id="1378289">makeSlice</span><span class="op" id="1378298">(</span><span class="num" id="1378299">2</span><span class="op" id="1378300">*</span><span class="builtinfunc" id="1378301">cap</span><span class="op" id="1378304">(</span><span class="ident" id="1378305">b</span><span class="op" id="1378306">.</span><span class="ident" id="1378307">buf</span><span class="op" id="1378310">)</span>&nbsp;<span class="op" id="1378312">+</span>&nbsp;<span class="ident" id="1378314">MinRead</span><span class="op" id="1378321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378326">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1378331">copy</span><span class="op" id="1378335">(</span><span class="ident" id="1378336">newBuf</span><span class="op" id="1378342">,</span>&nbsp;<span class="ident" id="1378344">b</span><span class="op" id="1378345">.</span><span class="ident" id="1378346">buf</span><span class="op" id="1378349">[</span><span class="ident" id="1378350">b</span><span class="op" id="1378351">.</span><span class="ident" id="1378352">off</span><span class="op" id="1378355">:</span><span class="op" id="1378356">]</span><span class="op" id="1378357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378362">b</span><span class="op" id="1378363">.</span><span class="ident" id="1378364">buf</span>&nbsp;<span class="op" id="1378368">=</span>&nbsp;<span class="ident" id="1378370">newBuf</span><span class="op" id="1378376">[</span><span class="op" id="1378377">:</span><span class="builtinfunc" id="1378378">len</span><span class="op" id="1378381">(</span><span class="ident" id="1378382">b</span><span class="op" id="1378383">.</span><span class="ident" id="1378384">buf</span><span class="op" id="1378387">)</span><span class="op" id="1378388">-</span><span class="ident" id="1378389">b</span><span class="op" id="1378390">.</span><span class="ident" id="1378391">off</span><span class="op" id="1378394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378399">b</span><span class="op" id="1378400">.</span><span class="ident" id="1378401">off</span>&nbsp;<span class="op" id="1378405">=</span>&nbsp;<span class="num" id="1378407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378415">m</span><span class="op" id="1378416">,</span>&nbsp;<span class="ident" id="1378418">e</span>&nbsp;<span class="op" id="1378420">:=</span>&nbsp;<span class="ident" id="1378423">r</span><span class="op" id="1378424">.</span><span class="ident" id="1378425">Read</span><span class="op" id="1378429">(</span><span class="ident" id="1378430">b</span><span class="op" id="1378431">.</span><span class="ident" id="1378432">buf</span><span class="op" id="1378435">[</span><span class="builtinfunc" id="1378436">len</span><span class="op" id="1378439">(</span><span class="ident" id="1378440">b</span><span class="op" id="1378441">.</span><span class="ident" id="1378442">buf</span><span class="op" id="1378445">)</span><span class="op" id="1378446">:</span><span class="builtinfunc" id="1378447">cap</span><span class="op" id="1378450">(</span><span class="ident" id="1378451">b</span><span class="op" id="1378452">.</span><span class="ident" id="1378453">buf</span><span class="op" id="1378456">)</span><span class="op" id="1378457">]</span><span class="op" id="1378458">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378462">b</span><span class="op" id="1378463">.</span><span class="ident" id="1378464">buf</span>&nbsp;<span class="op" id="1378468">=</span>&nbsp;<span class="ident" id="1378470">b</span><span class="op" id="1378471">.</span><span class="ident" id="1378472">buf</span><span class="op" id="1378475">[</span><span class="num" id="1378476">0</span>&nbsp;<span class="op" id="1378478">:</span>&nbsp;<span class="builtinfunc" id="1378480">len</span><span class="op" id="1378483">(</span><span class="ident" id="1378484">b</span><span class="op" id="1378485">.</span><span class="ident" id="1378486">buf</span><span class="op" id="1378489">)</span><span class="op" id="1378490">+</span><span class="ident" id="1378491">m</span><span class="op" id="1378492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378496">n</span>&nbsp;<span class="op" id="1378498">+=</span>&nbsp;<span class="ident" id="1378501">int64</span><span class="op" id="1378506">(</span><span class="ident" id="1378507">m</span><span class="op" id="1378508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378512">if</span>&nbsp;<span class="ident" id="1378515">e</span>&nbsp;<span class="op" id="1378517">==</span>&nbsp;<span class="ident" id="1378520">io</span><span class="op" id="1378522">.</span><span class="ident" id="1378523">EOF</span>&nbsp;<span class="op" id="1378527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378532">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378540">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378544">if</span>&nbsp;<span class="ident" id="1378547">e</span>&nbsp;<span class="op" id="1378549">!=</span>&nbsp;<span class="ident" id="1378552">nil</span>&nbsp;<span class="op" id="1378556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378561">return</span>&nbsp;<span class="ident" id="1378568">n</span><span class="op" id="1378569">,</span>&nbsp;<span class="ident" id="1378571">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378581">return</span>&nbsp;<span class="ident" id="1378588">n</span><span class="op" id="1378589">,</span>&nbsp;<span class="ident" id="1378591">nil</span>&nbsp;<span class="comment" id="1378595">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1378635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378638">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1378715">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1378736">func</span>&nbsp;<span class="ident" id="1378741">makeSlice</span><span class="op" id="1378750">(</span><span class="ident" id="1378751">n</span>&nbsp;<span class="builtintype" id="1378753">int</span><span class="op" id="1378756">)</span>&nbsp;<span class="op" id="1378758">[</span><span class="op" id="1378759">]</span><span class="builtintype" id="1378760">byte</span>&nbsp;<span class="op" id="1378765">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378768">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378811">defer</span>&nbsp;<span class="keyword" id="1378817">func</span><span class="op" id="1378821">(</span><span class="op" id="1378822">)</span>&nbsp;<span class="op" id="1378824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378828">if</span>&nbsp;<span class="builtinfunc" id="1378831">recover</span><span class="op" id="1378838">(</span><span class="op" id="1378839">)</span>&nbsp;<span class="op" id="1378841">!=</span>&nbsp;<span class="ident" id="1378844">nil</span>&nbsp;<span class="op" id="1378848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1378853">panic</span><span class="op" id="1378858">(</span><span class="ident" id="1378859">ErrTooLarge</span><span class="op" id="1378870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378874">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378877">}</span><span class="op" id="1378878">(</span><span class="op" id="1378879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378882">return</span>&nbsp;<span class="builtinfunc" id="1378889">make</span><span class="op" id="1378893">(</span><span class="op" id="1378894">[</span><span class="op" id="1378895">]</span><span class="builtintype" id="1378896">byte</span><span class="op" id="1378900">,</span>&nbsp;<span class="ident" id="1378902">n</span><span class="op" id="1378903">)</span><br>
<span class="lineno"></span><span class="op" id="1378905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378908">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1378984">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1379061">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1379131">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1379181">func</span>&nbsp;<span class="op" id="1379186">(</span><span class="ident" id="1379187">b</span>&nbsp;<span class="op" id="1379189">*</span><span class="ident" id="1379190">Buffer</span><span class="op" id="1379196">)</span>&nbsp;<span class="ident" id="1379198">WriteTo</span><span class="op" id="1379205">(</span><span class="ident" id="1379206">w</span>&nbsp;<span class="ident" id="1379208">io</span><span class="op" id="1379210">.</span><span class="ident" id="1379211">Writer</span><span class="op" id="1379217">)</span>&nbsp;<span class="op" id="1379219">(</span><span class="ident" id="1379220">n</span>&nbsp;<span class="ident" id="1379222">int64</span><span class="op" id="1379227">,</span>&nbsp;<span class="ident" id="1379229">err</span>&nbsp;<span class="builtintype" id="1379233">error</span><span class="op" id="1379238">)</span>&nbsp;<span class="op" id="1379240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379243">b</span><span class="op" id="1379244">.</span><span class="ident" id="1379245">lastRead</span>&nbsp;<span class="op" id="1379254">=</span>&nbsp;<span class="ident" id="1379256">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379267">if</span>&nbsp;<span class="ident" id="1379270">b</span><span class="op" id="1379271">.</span><span class="ident" id="1379272">off</span>&nbsp;<span class="op" id="1379276">&lt;</span>&nbsp;<span class="builtinfunc" id="1379278">len</span><span class="op" id="1379281">(</span><span class="ident" id="1379282">b</span><span class="op" id="1379283">.</span><span class="ident" id="1379284">buf</span><span class="op" id="1379287">)</span>&nbsp;<span class="op" id="1379289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379293">nBytes</span>&nbsp;<span class="op" id="1379300">:=</span>&nbsp;<span class="ident" id="1379303">b</span><span class="op" id="1379304">.</span><span class="ident" id="1379305">Len</span><span class="op" id="1379308">(</span><span class="op" id="1379309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379313">m</span><span class="op" id="1379314">,</span>&nbsp;<span class="ident" id="1379316">e</span>&nbsp;<span class="op" id="1379318">:=</span>&nbsp;<span class="ident" id="1379321">w</span><span class="op" id="1379322">.</span><span class="ident" id="1379323">Write</span><span class="op" id="1379328">(</span><span class="ident" id="1379329">b</span><span class="op" id="1379330">.</span><span class="ident" id="1379331">buf</span><span class="op" id="1379334">[</span><span class="ident" id="1379335">b</span><span class="op" id="1379336">.</span><span class="ident" id="1379337">off</span><span class="op" id="1379340">:</span><span class="op" id="1379341">]</span><span class="op" id="1379342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379346">if</span>&nbsp;<span class="ident" id="1379349">m</span>&nbsp;<span class="op" id="1379351">&gt;</span>&nbsp;<span class="ident" id="1379353">nBytes</span>&nbsp;<span class="op" id="1379360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1379365">panic</span><span class="op" id="1379370">(</span><span class="string" id="1379371">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1379414">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379422">b</span><span class="op" id="1379423">.</span><span class="ident" id="1379424">off</span>&nbsp;<span class="op" id="1379428">+=</span>&nbsp;<span class="ident" id="1379431">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379435">n</span>&nbsp;<span class="op" id="1379437">=</span>&nbsp;<span class="ident" id="1379439">int64</span><span class="op" id="1379444">(</span><span class="ident" id="1379445">m</span><span class="op" id="1379446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379450">if</span>&nbsp;<span class="ident" id="1379453">e</span>&nbsp;<span class="op" id="1379455">!=</span>&nbsp;<span class="ident" id="1379458">nil</span>&nbsp;<span class="op" id="1379462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379467">return</span>&nbsp;<span class="ident" id="1379474">n</span><span class="op" id="1379475">,</span>&nbsp;<span class="ident" id="1379477">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379485">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379543">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379574">if</span>&nbsp;<span class="ident" id="1379577">m</span>&nbsp;<span class="op" id="1379579">!=</span>&nbsp;<span class="ident" id="1379582">nBytes</span>&nbsp;<span class="op" id="1379589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379594">return</span>&nbsp;<span class="ident" id="1379601">n</span><span class="op" id="1379602">,</span>&nbsp;<span class="ident" id="1379604">io</span><span class="op" id="1379606">.</span><span class="ident" id="1379607">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379629">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379661">b</span><span class="op" id="1379662">.</span><span class="ident" id="1379663">Truncate</span><span class="op" id="1379671">(</span><span class="num" id="1379672">0</span><span class="op" id="1379673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379676">return</span><br>
<span class="lineno">220</span><span class="op" id="1379683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379686">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1379763">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1379840">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1379913">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1379929">func</span>&nbsp;<span class="op" id="1379934">(</span><span class="ident" id="1379935">b</span>&nbsp;<span class="op" id="1379937">*</span><span class="ident" id="1379938">Buffer</span><span class="op" id="1379944">)</span>&nbsp;<span class="ident" id="1379946">WriteByte</span><span class="op" id="1379955">(</span><span class="ident" id="1379956">c</span>&nbsp;<span class="builtintype" id="1379958">byte</span><span class="op" id="1379962">)</span>&nbsp;<span class="builtintype" id="1379964">error</span>&nbsp;<span class="op" id="1379970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379973">b</span><span class="op" id="1379974">.</span><span class="ident" id="1379975">lastRead</span>&nbsp;<span class="op" id="1379984">=</span>&nbsp;<span class="ident" id="1379986">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379997">m</span>&nbsp;<span class="op" id="1379999">:=</span>&nbsp;<span class="ident" id="1380002">b</span><span class="op" id="1380003">.</span><span class="ident" id="1380004">grow</span><span class="op" id="1380008">(</span><span class="num" id="1380009">1</span><span class="op" id="1380010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380013">b</span><span class="op" id="1380014">.</span><span class="ident" id="1380015">buf</span><span class="op" id="1380018">[</span><span class="ident" id="1380019">m</span><span class="op" id="1380020">]</span>&nbsp;<span class="op" id="1380022">=</span>&nbsp;<span class="ident" id="1380024">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380027">return</span>&nbsp;<span class="ident" id="1380034">nil</span><br>
<span class="lineno"></span><span class="op" id="1380038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380041">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1380112">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1380185">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1380263">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1380330">func</span>&nbsp;<span class="op" id="1380335">(</span><span class="ident" id="1380336">b</span>&nbsp;<span class="op" id="1380338">*</span><span class="ident" id="1380339">Buffer</span><span class="op" id="1380345">)</span>&nbsp;<span class="ident" id="1380347">WriteRune</span><span class="op" id="1380356">(</span><span class="ident" id="1380357">r</span>&nbsp;<span class="builtintype" id="1380359">rune</span><span class="op" id="1380363">)</span>&nbsp;<span class="op" id="1380365">(</span><span class="ident" id="1380366">n</span>&nbsp;<span class="builtintype" id="1380368">int</span><span class="op" id="1380371">,</span>&nbsp;<span class="ident" id="1380373">err</span>&nbsp;<span class="builtintype" id="1380377">error</span><span class="op" id="1380382">)</span>&nbsp;<span class="op" id="1380384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380387">if</span>&nbsp;<span class="ident" id="1380390">r</span>&nbsp;<span class="op" id="1380392">&lt;</span>&nbsp;<span class="ident" id="1380394">utf8</span><span class="op" id="1380398">.</span><span class="ident" id="1380399">RuneSelf</span>&nbsp;<span class="op" id="1380408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380412">b</span><span class="op" id="1380413">.</span><span class="ident" id="1380414">WriteByte</span><span class="op" id="1380423">(</span><span class="builtintype" id="1380424">byte</span><span class="op" id="1380428">(</span><span class="ident" id="1380429">r</span><span class="op" id="1380430">)</span><span class="op" id="1380431">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380435">return</span>&nbsp;<span class="num" id="1380442">1</span><span class="op" id="1380443">,</span>&nbsp;<span class="ident" id="1380445">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1380450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380453">n</span>&nbsp;<span class="op" id="1380455">=</span>&nbsp;<span class="ident" id="1380457">utf8</span><span class="op" id="1380461">.</span><span class="ident" id="1380462">EncodeRune</span><span class="op" id="1380472">(</span><span class="ident" id="1380473">b</span><span class="op" id="1380474">.</span><span class="ident" id="1380475">runeBytes</span><span class="op" id="1380484">[</span><span class="num" id="1380485">0</span><span class="op" id="1380486">:</span><span class="op" id="1380487">]</span><span class="op" id="1380488">,</span>&nbsp;<span class="ident" id="1380490">r</span><span class="op" id="1380491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380494">b</span><span class="op" id="1380495">.</span><span class="ident" id="1380496">Write</span><span class="op" id="1380501">(</span><span class="ident" id="1380502">b</span><span class="op" id="1380503">.</span><span class="ident" id="1380504">runeBytes</span><span class="op" id="1380513">[</span><span class="num" id="1380514">0</span><span class="op" id="1380515">:</span><span class="ident" id="1380516">n</span><span class="op" id="1380517">]</span><span class="op" id="1380518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380521">return</span>&nbsp;<span class="ident" id="1380528">n</span><span class="op" id="1380529">,</span>&nbsp;<span class="ident" id="1380531">nil</span><br>
<span class="lineno">245</span><span class="op" id="1380535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380538">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1380610">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1380682">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1380754">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1380778">func</span>&nbsp;<span class="op" id="1380783">(</span><span class="ident" id="1380784">b</span>&nbsp;<span class="op" id="1380786">*</span><span class="ident" id="1380787">Buffer</span><span class="op" id="1380793">)</span>&nbsp;<span class="ident" id="1380795">Read</span><span class="op" id="1380799">(</span><span class="ident" id="1380800">p</span>&nbsp;<span class="op" id="1380802">[</span><span class="op" id="1380803">]</span><span class="builtintype" id="1380804">byte</span><span class="op" id="1380808">)</span>&nbsp;<span class="op" id="1380810">(</span><span class="ident" id="1380811">n</span>&nbsp;<span class="builtintype" id="1380813">int</span><span class="op" id="1380816">,</span>&nbsp;<span class="ident" id="1380818">err</span>&nbsp;<span class="builtintype" id="1380822">error</span><span class="op" id="1380827">)</span>&nbsp;<span class="op" id="1380829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380832">b</span><span class="op" id="1380833">.</span><span class="ident" id="1380834">lastRead</span>&nbsp;<span class="op" id="1380843">=</span>&nbsp;<span class="ident" id="1380845">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380856">if</span>&nbsp;<span class="ident" id="1380859">b</span><span class="op" id="1380860">.</span><span class="ident" id="1380861">off</span>&nbsp;<span class="op" id="1380865">&gt;=</span>&nbsp;<span class="builtinfunc" id="1380868">len</span><span class="op" id="1380871">(</span><span class="ident" id="1380872">b</span><span class="op" id="1380873">.</span><span class="ident" id="1380874">buf</span><span class="op" id="1380877">)</span>&nbsp;<span class="op" id="1380879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380883">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380929">b</span><span class="op" id="1380930">.</span><span class="ident" id="1380931">Truncate</span><span class="op" id="1380939">(</span><span class="num" id="1380940">0</span><span class="op" id="1380941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380945">if</span>&nbsp;<span class="builtinfunc" id="1380948">len</span><span class="op" id="1380951">(</span><span class="ident" id="1380952">p</span><span class="op" id="1380953">)</span>&nbsp;<span class="op" id="1380955">==</span>&nbsp;<span class="num" id="1380958">0</span>&nbsp;<span class="op" id="1380960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380965">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1380974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380978">return</span>&nbsp;<span class="num" id="1380985">0</span><span class="op" id="1380986">,</span>&nbsp;<span class="ident" id="1380988">io</span><span class="op" id="1380990">.</span><span class="ident" id="1380991">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1380996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380999">n</span>&nbsp;<span class="op" id="1381001">=</span>&nbsp;<span class="builtinfunc" id="1381003">copy</span><span class="op" id="1381007">(</span><span class="ident" id="1381008">p</span><span class="op" id="1381009">,</span>&nbsp;<span class="ident" id="1381011">b</span><span class="op" id="1381012">.</span><span class="ident" id="1381013">buf</span><span class="op" id="1381016">[</span><span class="ident" id="1381017">b</span><span class="op" id="1381018">.</span><span class="ident" id="1381019">off</span><span class="op" id="1381022">:</span><span class="op" id="1381023">]</span><span class="op" id="1381024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381027">b</span><span class="op" id="1381028">.</span><span class="ident" id="1381029">off</span>&nbsp;<span class="op" id="1381033">+=</span>&nbsp;<span class="ident" id="1381036">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381039">if</span>&nbsp;<span class="ident" id="1381042">n</span>&nbsp;<span class="op" id="1381044">&gt;</span>&nbsp;<span class="num" id="1381046">0</span>&nbsp;<span class="op" id="1381048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381052">b</span><span class="op" id="1381053">.</span><span class="ident" id="1381054">lastRead</span>&nbsp;<span class="op" id="1381063">=</span>&nbsp;<span class="ident" id="1381065">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381076">return</span><br>
<span class="lineno"></span><span class="op" id="1381083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381086">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1381155">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1381222">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1381304">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1381378">func</span>&nbsp;<span class="op" id="1381383">(</span><span class="ident" id="1381384">b</span>&nbsp;<span class="op" id="1381386">*</span><span class="ident" id="1381387">Buffer</span><span class="op" id="1381393">)</span>&nbsp;<span class="ident" id="1381395">Next</span><span class="op" id="1381399">(</span><span class="ident" id="1381400">n</span>&nbsp;<span class="builtintype" id="1381402">int</span><span class="op" id="1381405">)</span>&nbsp;<span class="op" id="1381407">[</span><span class="op" id="1381408">]</span><span class="builtintype" id="1381409">byte</span>&nbsp;<span class="op" id="1381414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381417">b</span><span class="op" id="1381418">.</span><span class="ident" id="1381419">lastRead</span>&nbsp;<span class="op" id="1381428">=</span>&nbsp;<span class="ident" id="1381430">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381441">m</span>&nbsp;<span class="op" id="1381443">:=</span>&nbsp;<span class="ident" id="1381446">b</span><span class="op" id="1381447">.</span><span class="ident" id="1381448">Len</span><span class="op" id="1381451">(</span><span class="op" id="1381452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381455">if</span>&nbsp;<span class="ident" id="1381458">n</span>&nbsp;<span class="op" id="1381460">&gt;</span>&nbsp;<span class="ident" id="1381462">m</span>&nbsp;<span class="op" id="1381464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381468">n</span>&nbsp;<span class="op" id="1381470">=</span>&nbsp;<span class="ident" id="1381472">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381478">data</span>&nbsp;<span class="op" id="1381483">:=</span>&nbsp;<span class="ident" id="1381486">b</span><span class="op" id="1381487">.</span><span class="ident" id="1381488">buf</span><span class="op" id="1381491">[</span><span class="ident" id="1381492">b</span><span class="op" id="1381493">.</span><span class="ident" id="1381494">off</span>&nbsp;<span class="op" id="1381498">:</span>&nbsp;<span class="ident" id="1381500">b</span><span class="op" id="1381501">.</span><span class="ident" id="1381502">off</span><span class="op" id="1381505">+</span><span class="ident" id="1381506">n</span><span class="op" id="1381507">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381510">b</span><span class="op" id="1381511">.</span><span class="ident" id="1381512">off</span>&nbsp;<span class="op" id="1381516">+=</span>&nbsp;<span class="ident" id="1381519">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381522">if</span>&nbsp;<span class="ident" id="1381525">n</span>&nbsp;<span class="op" id="1381527">&gt;</span>&nbsp;<span class="num" id="1381529">0</span>&nbsp;<span class="op" id="1381531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381535">b</span><span class="op" id="1381536">.</span><span class="ident" id="1381537">lastRead</span>&nbsp;<span class="op" id="1381546">=</span>&nbsp;<span class="ident" id="1381548">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381559">return</span>&nbsp;<span class="ident" id="1381566">data</span><br>
<span class="lineno">285</span><span class="op" id="1381571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381574">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1381635">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1381688">func</span>&nbsp;<span class="op" id="1381693">(</span><span class="ident" id="1381694">b</span>&nbsp;<span class="op" id="1381696">*</span><span class="ident" id="1381697">Buffer</span><span class="op" id="1381703">)</span>&nbsp;<span class="ident" id="1381705">ReadByte</span><span class="op" id="1381713">(</span><span class="op" id="1381714">)</span>&nbsp;<span class="op" id="1381716">(</span><span class="ident" id="1381717">c</span>&nbsp;<span class="builtintype" id="1381719">byte</span><span class="op" id="1381723">,</span>&nbsp;<span class="ident" id="1381725">err</span>&nbsp;<span class="builtintype" id="1381729">error</span><span class="op" id="1381734">)</span>&nbsp;<span class="op" id="1381736">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381739">b</span><span class="op" id="1381740">.</span><span class="ident" id="1381741">lastRead</span>&nbsp;<span class="op" id="1381750">=</span>&nbsp;<span class="ident" id="1381752">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381763">if</span>&nbsp;<span class="ident" id="1381766">b</span><span class="op" id="1381767">.</span><span class="ident" id="1381768">off</span>&nbsp;<span class="op" id="1381772">&gt;=</span>&nbsp;<span class="builtinfunc" id="1381775">len</span><span class="op" id="1381778">(</span><span class="ident" id="1381779">b</span><span class="op" id="1381780">.</span><span class="ident" id="1381781">buf</span><span class="op" id="1381784">)</span>&nbsp;<span class="op" id="1381786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381790">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381836">b</span><span class="op" id="1381837">.</span><span class="ident" id="1381838">Truncate</span><span class="op" id="1381846">(</span><span class="num" id="1381847">0</span><span class="op" id="1381848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381852">return</span>&nbsp;<span class="num" id="1381859">0</span><span class="op" id="1381860">,</span>&nbsp;<span class="ident" id="1381862">io</span><span class="op" id="1381864">.</span><span class="ident" id="1381865">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381873">c</span>&nbsp;<span class="op" id="1381875">=</span>&nbsp;<span class="ident" id="1381877">b</span><span class="op" id="1381878">.</span><span class="ident" id="1381879">buf</span><span class="op" id="1381882">[</span><span class="ident" id="1381883">b</span><span class="op" id="1381884">.</span><span class="ident" id="1381885">off</span><span class="op" id="1381888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381891">b</span><span class="op" id="1381892">.</span><span class="ident" id="1381893">off</span><span class="op" id="1381896">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381900">b</span><span class="op" id="1381901">.</span><span class="ident" id="1381902">lastRead</span>&nbsp;<span class="op" id="1381911">=</span>&nbsp;<span class="ident" id="1381913">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381921">return</span>&nbsp;<span class="ident" id="1381928">c</span><span class="op" id="1381929">,</span>&nbsp;<span class="ident" id="1381931">nil</span><br>
<span class="lineno">300</span><span class="op" id="1381935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381938">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1381991">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1382030">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1382090">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1382142">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1382186">func</span>&nbsp;<span class="op" id="1382191">(</span><span class="ident" id="1382192">b</span>&nbsp;<span class="op" id="1382194">*</span><span class="ident" id="1382195">Buffer</span><span class="op" id="1382201">)</span>&nbsp;<span class="ident" id="1382203">ReadRune</span><span class="op" id="1382211">(</span><span class="op" id="1382212">)</span>&nbsp;<span class="op" id="1382214">(</span><span class="ident" id="1382215">r</span>&nbsp;<span class="builtintype" id="1382217">rune</span><span class="op" id="1382221">,</span>&nbsp;<span class="ident" id="1382223">size</span>&nbsp;<span class="builtintype" id="1382228">int</span><span class="op" id="1382231">,</span>&nbsp;<span class="ident" id="1382233">err</span>&nbsp;<span class="builtintype" id="1382237">error</span><span class="op" id="1382242">)</span>&nbsp;<span class="op" id="1382244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382247">b</span><span class="op" id="1382248">.</span><span class="ident" id="1382249">lastRead</span>&nbsp;<span class="op" id="1382258">=</span>&nbsp;<span class="ident" id="1382260">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382271">if</span>&nbsp;<span class="ident" id="1382274">b</span><span class="op" id="1382275">.</span><span class="ident" id="1382276">off</span>&nbsp;<span class="op" id="1382280">&gt;=</span>&nbsp;<span class="builtinfunc" id="1382283">len</span><span class="op" id="1382286">(</span><span class="ident" id="1382287">b</span><span class="op" id="1382288">.</span><span class="ident" id="1382289">buf</span><span class="op" id="1382292">)</span>&nbsp;<span class="op" id="1382294">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382298">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382344">b</span><span class="op" id="1382345">.</span><span class="ident" id="1382346">Truncate</span><span class="op" id="1382354">(</span><span class="num" id="1382355">0</span><span class="op" id="1382356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382360">return</span>&nbsp;<span class="num" id="1382367">0</span><span class="op" id="1382368">,</span>&nbsp;<span class="num" id="1382370">0</span><span class="op" id="1382371">,</span>&nbsp;<span class="ident" id="1382373">io</span><span class="op" id="1382375">.</span><span class="ident" id="1382376">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382384">b</span><span class="op" id="1382385">.</span><span class="ident" id="1382386">lastRead</span>&nbsp;<span class="op" id="1382395">=</span>&nbsp;<span class="ident" id="1382397">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382409">c</span>&nbsp;<span class="op" id="1382411">:=</span>&nbsp;<span class="ident" id="1382414">b</span><span class="op" id="1382415">.</span><span class="ident" id="1382416">buf</span><span class="op" id="1382419">[</span><span class="ident" id="1382420">b</span><span class="op" id="1382421">.</span><span class="ident" id="1382422">off</span><span class="op" id="1382425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382428">if</span>&nbsp;<span class="ident" id="1382431">c</span>&nbsp;<span class="op" id="1382433">&lt;</span>&nbsp;<span class="ident" id="1382435">utf8</span><span class="op" id="1382439">.</span><span class="ident" id="1382440">RuneSelf</span>&nbsp;<span class="op" id="1382449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382453">b</span><span class="op" id="1382454">.</span><span class="ident" id="1382455">off</span><span class="op" id="1382458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382463">return</span>&nbsp;<span class="builtintype" id="1382470">rune</span><span class="op" id="1382474">(</span><span class="ident" id="1382475">c</span><span class="op" id="1382476">)</span><span class="op" id="1382477">,</span>&nbsp;<span class="num" id="1382479">1</span><span class="op" id="1382480">,</span>&nbsp;<span class="ident" id="1382482">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382487">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382490">r</span><span class="op" id="1382491">,</span>&nbsp;<span class="ident" id="1382493">n</span>&nbsp;<span class="op" id="1382495">:=</span>&nbsp;<span class="ident" id="1382498">utf8</span><span class="op" id="1382502">.</span><span class="ident" id="1382503">DecodeRune</span><span class="op" id="1382513">(</span><span class="ident" id="1382514">b</span><span class="op" id="1382515">.</span><span class="ident" id="1382516">buf</span><span class="op" id="1382519">[</span><span class="ident" id="1382520">b</span><span class="op" id="1382521">.</span><span class="ident" id="1382522">off</span><span class="op" id="1382525">:</span><span class="op" id="1382526">]</span><span class="op" id="1382527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382530">b</span><span class="op" id="1382531">.</span><span class="ident" id="1382532">off</span>&nbsp;<span class="op" id="1382536">+=</span>&nbsp;<span class="ident" id="1382539">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382542">return</span>&nbsp;<span class="ident" id="1382549">r</span><span class="op" id="1382550">,</span>&nbsp;<span class="ident" id="1382552">n</span><span class="op" id="1382553">,</span>&nbsp;<span class="ident" id="1382555">nil</span><br>
<span class="lineno"></span><span class="op" id="1382559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1382562">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1382620">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1382684">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1382749">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1382816">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1382845">func</span>&nbsp;<span class="op" id="1382850">(</span><span class="ident" id="1382851">b</span>&nbsp;<span class="op" id="1382853">*</span><span class="ident" id="1382854">Buffer</span><span class="op" id="1382860">)</span>&nbsp;<span class="ident" id="1382862">UnreadRune</span><span class="op" id="1382872">(</span><span class="op" id="1382873">)</span>&nbsp;<span class="builtintype" id="1382875">error</span>&nbsp;<span class="op" id="1382881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382884">if</span>&nbsp;<span class="ident" id="1382887">b</span><span class="op" id="1382888">.</span><span class="ident" id="1382889">lastRead</span>&nbsp;<span class="op" id="1382898">!=</span>&nbsp;<span class="ident" id="1382901">opReadRune</span>&nbsp;<span class="op" id="1382912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382916">return</span>&nbsp;<span class="ident" id="1382923">errors</span><span class="op" id="1382929">.</span><span class="ident" id="1382930">New</span><span class="op" id="1382933">(</span><span class="string" id="1382934">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1382997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383003">b</span><span class="op" id="1383004">.</span><span class="ident" id="1383005">lastRead</span>&nbsp;<span class="op" id="1383014">=</span>&nbsp;<span class="ident" id="1383016">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383027">if</span>&nbsp;<span class="ident" id="1383030">b</span><span class="op" id="1383031">.</span><span class="ident" id="1383032">off</span>&nbsp;<span class="op" id="1383036">&gt;</span>&nbsp;<span class="num" id="1383038">0</span>&nbsp;<span class="op" id="1383040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383044">_</span><span class="op" id="1383045">,</span>&nbsp;<span class="ident" id="1383047">n</span>&nbsp;<span class="op" id="1383049">:=</span>&nbsp;<span class="ident" id="1383052">utf8</span><span class="op" id="1383056">.</span><span class="ident" id="1383057">DecodeLastRune</span><span class="op" id="1383071">(</span><span class="ident" id="1383072">b</span><span class="op" id="1383073">.</span><span class="ident" id="1383074">buf</span><span class="op" id="1383077">[</span><span class="num" id="1383078">0</span><span class="op" id="1383079">:</span><span class="ident" id="1383080">b</span><span class="op" id="1383081">.</span><span class="ident" id="1383082">off</span><span class="op" id="1383085">]</span><span class="op" id="1383086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383090">b</span><span class="op" id="1383091">.</span><span class="ident" id="1383092">off</span>&nbsp;<span class="op" id="1383096">-=</span>&nbsp;<span class="ident" id="1383099">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383105">return</span>&nbsp;<span class="ident" id="1383112">nil</span><br>
<span class="lineno">340</span><span class="op" id="1383116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1383119">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1383183">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1383257">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1383278">func</span>&nbsp;<span class="op" id="1383283">(</span><span class="ident" id="1383284">b</span>&nbsp;<span class="op" id="1383286">*</span><span class="ident" id="1383287">Buffer</span><span class="op" id="1383293">)</span>&nbsp;<span class="ident" id="1383295">UnreadByte</span><span class="op" id="1383305">(</span><span class="op" id="1383306">)</span>&nbsp;<span class="builtintype" id="1383308">error</span>&nbsp;<span class="op" id="1383314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383317">if</span>&nbsp;<span class="ident" id="1383320">b</span><span class="op" id="1383321">.</span><span class="ident" id="1383322">lastRead</span>&nbsp;<span class="op" id="1383331">!=</span>&nbsp;<span class="ident" id="1383334">opReadRune</span>&nbsp;<span class="op" id="1383345">&amp;&amp;</span>&nbsp;<span class="ident" id="1383348">b</span><span class="op" id="1383349">.</span><span class="ident" id="1383350">lastRead</span>&nbsp;<span class="op" id="1383359">!=</span>&nbsp;<span class="ident" id="1383362">opRead</span>&nbsp;<span class="op" id="1383369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383373">return</span>&nbsp;<span class="ident" id="1383380">errors</span><span class="op" id="1383386">.</span><span class="ident" id="1383387">New</span><span class="op" id="1383390">(</span><span class="string" id="1383391">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1383452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383458">b</span><span class="op" id="1383459">.</span><span class="ident" id="1383460">lastRead</span>&nbsp;<span class="op" id="1383469">=</span>&nbsp;<span class="ident" id="1383471">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383482">if</span>&nbsp;<span class="ident" id="1383485">b</span><span class="op" id="1383486">.</span><span class="ident" id="1383487">off</span>&nbsp;<span class="op" id="1383491">&gt;</span>&nbsp;<span class="num" id="1383493">0</span>&nbsp;<span class="op" id="1383495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383499">b</span><span class="op" id="1383500">.</span><span class="ident" id="1383501">off</span><span class="op" id="1383504">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383511">return</span>&nbsp;<span class="ident" id="1383518">nil</span><br>
<span class="lineno"></span><span class="op" id="1383522">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1383525">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1383594">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1383670">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1383734">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1383816">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1383897">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1383907">func</span>&nbsp;<span class="op" id="1383912">(</span><span class="ident" id="1383913">b</span>&nbsp;<span class="op" id="1383915">*</span><span class="ident" id="1383916">Buffer</span><span class="op" id="1383922">)</span>&nbsp;<span class="ident" id="1383924">ReadBytes</span><span class="op" id="1383933">(</span><span class="ident" id="1383934">delim</span>&nbsp;<span class="builtintype" id="1383940">byte</span><span class="op" id="1383944">)</span>&nbsp;<span class="op" id="1383946">(</span><span class="ident" id="1383947">line</span>&nbsp;<span class="op" id="1383952">[</span><span class="op" id="1383953">]</span><span class="builtintype" id="1383954">byte</span><span class="op" id="1383958">,</span>&nbsp;<span class="ident" id="1383960">err</span>&nbsp;<span class="builtintype" id="1383964">error</span><span class="op" id="1383969">)</span>&nbsp;<span class="op" id="1383971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383974">slice</span><span class="op" id="1383979">,</span>&nbsp;<span class="ident" id="1383981">err</span>&nbsp;<span class="op" id="1383985">:=</span>&nbsp;<span class="ident" id="1383988">b</span><span class="op" id="1383989">.</span><span class="ident" id="1383990">readSlice</span><span class="op" id="1383999">(</span><span class="ident" id="1384000">delim</span><span class="op" id="1384005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1384008">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1384067">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384102">line</span>&nbsp;<span class="op" id="1384107">=</span>&nbsp;<span class="builtinfunc" id="1384109">append</span><span class="op" id="1384115">(</span><span class="ident" id="1384116">line</span><span class="op" id="1384120">,</span>&nbsp;<span class="ident" id="1384122">slice</span><span class="op" id="1384127">...</span><span class="op" id="1384130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384133">return</span><br>
<span class="lineno"></span><span class="op" id="1384140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1384143">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1384223">func</span>&nbsp;<span class="op" id="1384228">(</span><span class="ident" id="1384229">b</span>&nbsp;<span class="op" id="1384231">*</span><span class="ident" id="1384232">Buffer</span><span class="op" id="1384238">)</span>&nbsp;<span class="ident" id="1384240">readSlice</span><span class="op" id="1384249">(</span><span class="ident" id="1384250">delim</span>&nbsp;<span class="builtintype" id="1384256">byte</span><span class="op" id="1384260">)</span>&nbsp;<span class="op" id="1384262">(</span><span class="ident" id="1384263">line</span>&nbsp;<span class="op" id="1384268">[</span><span class="op" id="1384269">]</span><span class="builtintype" id="1384270">byte</span><span class="op" id="1384274">,</span>&nbsp;<span class="ident" id="1384276">err</span>&nbsp;<span class="builtintype" id="1384280">error</span><span class="op" id="1384285">)</span>&nbsp;<span class="op" id="1384287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384290">i</span>&nbsp;<span class="op" id="1384292">:=</span>&nbsp;<span class="ident" id="1384295">IndexByte</span><span class="op" id="1384304">(</span><span class="ident" id="1384305">b</span><span class="op" id="1384306">.</span><span class="ident" id="1384307">buf</span><span class="op" id="1384310">[</span><span class="ident" id="1384311">b</span><span class="op" id="1384312">.</span><span class="ident" id="1384313">off</span><span class="op" id="1384316">:</span><span class="op" id="1384317">]</span><span class="op" id="1384318">,</span>&nbsp;<span class="ident" id="1384320">delim</span><span class="op" id="1384325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384328">end</span>&nbsp;<span class="op" id="1384332">:=</span>&nbsp;<span class="ident" id="1384335">b</span><span class="op" id="1384336">.</span><span class="ident" id="1384337">off</span>&nbsp;<span class="op" id="1384341">+</span>&nbsp;<span class="ident" id="1384343">i</span>&nbsp;<span class="op" id="1384345">+</span>&nbsp;<span class="num" id="1384347">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384350">if</span>&nbsp;<span class="ident" id="1384353">i</span>&nbsp;<span class="op" id="1384355">&lt;</span>&nbsp;<span class="num" id="1384357">0</span>&nbsp;<span class="op" id="1384359">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384363">end</span>&nbsp;<span class="op" id="1384367">=</span>&nbsp;<span class="builtinfunc" id="1384369">len</span><span class="op" id="1384372">(</span><span class="ident" id="1384373">b</span><span class="op" id="1384374">.</span><span class="ident" id="1384375">buf</span><span class="op" id="1384378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384382">err</span>&nbsp;<span class="op" id="1384386">=</span>&nbsp;<span class="ident" id="1384388">io</span><span class="op" id="1384390">.</span><span class="ident" id="1384391">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1384396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384399">line</span>&nbsp;<span class="op" id="1384404">=</span>&nbsp;<span class="ident" id="1384406">b</span><span class="op" id="1384407">.</span><span class="ident" id="1384408">buf</span><span class="op" id="1384411">[</span><span class="ident" id="1384412">b</span><span class="op" id="1384413">.</span><span class="ident" id="1384414">off</span><span class="op" id="1384417">:</span><span class="ident" id="1384418">end</span><span class="op" id="1384421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384424">b</span><span class="op" id="1384425">.</span><span class="ident" id="1384426">off</span>&nbsp;<span class="op" id="1384430">=</span>&nbsp;<span class="ident" id="1384432">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384437">b</span><span class="op" id="1384438">.</span><span class="ident" id="1384439">lastRead</span>&nbsp;<span class="op" id="1384448">=</span>&nbsp;<span class="ident" id="1384450">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384458">return</span>&nbsp;<span class="ident" id="1384465">line</span><span class="op" id="1384469">,</span>&nbsp;<span class="ident" id="1384471">err</span><br>
<span class="lineno"></span><span class="op" id="1384475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1384478">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1384548">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1384625">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1384690">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1384772">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1384851">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1384864">func</span>&nbsp;<span class="op" id="1384869">(</span><span class="ident" id="1384870">b</span>&nbsp;<span class="op" id="1384872">*</span><span class="ident" id="1384873">Buffer</span><span class="op" id="1384879">)</span>&nbsp;<span class="ident" id="1384881">ReadString</span><span class="op" id="1384891">(</span><span class="ident" id="1384892">delim</span>&nbsp;<span class="builtintype" id="1384898">byte</span><span class="op" id="1384902">)</span>&nbsp;<span class="op" id="1384904">(</span><span class="ident" id="1384905">line</span>&nbsp;<span class="builtintype" id="1384910">string</span><span class="op" id="1384916">,</span>&nbsp;<span class="ident" id="1384918">err</span>&nbsp;<span class="builtintype" id="1384922">error</span><span class="op" id="1384927">)</span>&nbsp;<span class="op" id="1384929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384932">slice</span><span class="op" id="1384937">,</span>&nbsp;<span class="ident" id="1384939">err</span>&nbsp;<span class="op" id="1384943">:=</span>&nbsp;<span class="ident" id="1384946">b</span><span class="op" id="1384947">.</span><span class="ident" id="1384948">readSlice</span><span class="op" id="1384957">(</span><span class="ident" id="1384958">delim</span><span class="op" id="1384963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384966">return</span>&nbsp;<span class="builtintype" id="1384973">string</span><span class="op" id="1384979">(</span><span class="ident" id="1384980">slice</span><span class="op" id="1384985">)</span><span class="op" id="1384986">,</span>&nbsp;<span class="ident" id="1384988">err</span><br>
<span class="lineno"></span><span class="op" id="1384992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1384995">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1385070">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1385146">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1385219">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1385281">//</span><br>
<span class="lineno">400</span><span class="comment" id="1385284">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1385355">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1385393">func</span>&nbsp;<span class="ident" id="1385398">NewBuffer</span><span class="op" id="1385407">(</span><span class="ident" id="1385408">buf</span>&nbsp;<span class="op" id="1385412">[</span><span class="op" id="1385413">]</span><span class="builtintype" id="1385414">byte</span><span class="op" id="1385418">)</span>&nbsp;<span class="op" id="1385420">*</span><span class="ident" id="1385421">Buffer</span>&nbsp;<span class="op" id="1385428">{</span>&nbsp;<span class="keyword" id="1385430">return</span>&nbsp;<span class="op" id="1385437">&amp;</span><span class="ident" id="1385438">Buffer</span><span class="op" id="1385444">{</span><span class="ident" id="1385445">buf</span><span class="op" id="1385448">:</span>&nbsp;<span class="ident" id="1385450">buf</span><span class="op" id="1385453">}</span>&nbsp;<span class="op" id="1385455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1385458">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1385536">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1385612">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1385623">//</span><br>
<span class="lineno"></span><span class="comment" id="1385626">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1385697">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1385735">func</span>&nbsp;<span class="ident" id="1385740">NewBufferString</span><span class="op" id="1385755">(</span><span class="ident" id="1385756">s</span>&nbsp;<span class="builtintype" id="1385758">string</span><span class="op" id="1385764">)</span>&nbsp;<span class="op" id="1385766">*</span><span class="ident" id="1385767">Buffer</span>&nbsp;<span class="op" id="1385774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1385777">return</span>&nbsp;<span class="op" id="1385784">&amp;</span><span class="ident" id="1385785">Buffer</span><span class="op" id="1385791">{</span><span class="ident" id="1385792">buf</span><span class="op" id="1385795">:</span>&nbsp;<span class="op" id="1385797">[</span><span class="op" id="1385798">]</span><span class="builtintype" id="1385799">byte</span><span class="op" id="1385803">(</span><span class="ident" id="1385804">s</span><span class="op" id="1385805">)</span><span class="op" id="1385806">}</span><br>
<span class="lineno"></span><span class="op" id="1385808">}</span>
</div>
</body>
</html>
