<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6820175">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6820230">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6820284">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6820335">package</span>&nbsp;<span class="ident" id="6820343">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6820348">import</span>&nbsp;<span class="op" id="6820355">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820358">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820367">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820383">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820392">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820407">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820418">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6820428">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6820431">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6820498">const</span>&nbsp;<span class="op" id="6820504">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820507">headerStr</span>&nbsp;<span class="op" id="6820517">=</span>&nbsp;<span class="string" id="6820519">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6820528">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820532">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="6820551">+</span>&nbsp;<span class="comment" id="6820553">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820576">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="6820591">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820659">paletteStr</span>&nbsp;<span class="op" id="6820670">=</span>&nbsp;<span class="string" id="6820672">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="6820699">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820742">trailerStr</span>&nbsp;<span class="op" id="6820753">=</span>&nbsp;<span class="string" id="6820755">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="6820762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6820765">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="6820837">func</span>&nbsp;<span class="ident" id="6820842">lzwEncode</span><span class="op" id="6820851">(</span><span class="ident" id="6820852">n</span>&nbsp;<span class="builtintype" id="6820854">int</span><span class="op" id="6820857">)</span>&nbsp;<span class="op" id="6820859">[</span><span class="op" id="6820860">]</span><span class="builtintype" id="6820861">byte</span>&nbsp;<span class="op" id="6820866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820869">b</span>&nbsp;<span class="op" id="6820871">:=</span>&nbsp;<span class="op" id="6820874">&amp;</span><span class="ident" id="6820875">bytes</span><span class="op" id="6820880">.</span><span class="ident" id="6820881">Buffer</span><span class="op" id="6820887">{</span><span class="op" id="6820888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820891">w</span>&nbsp;<span class="op" id="6820893">:=</span>&nbsp;<span class="ident" id="6820896">lzw</span><span class="op" id="6820899">.</span><span class="ident" id="6820900">NewWriter</span><span class="op" id="6820909">(</span><span class="ident" id="6820910">b</span><span class="op" id="6820911">,</span>&nbsp;<span class="ident" id="6820913">lzw</span><span class="op" id="6820916">.</span><span class="ident" id="6820917">LSB</span><span class="op" id="6820920">,</span>&nbsp;<span class="num" id="6820922">2</span><span class="op" id="6820923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820926">w</span><span class="op" id="6820927">.</span><span class="ident" id="6820928">Write</span><span class="op" id="6820933">(</span><span class="builtinfunc" id="6820934">make</span><span class="op" id="6820938">(</span><span class="op" id="6820939">[</span><span class="op" id="6820940">]</span><span class="builtintype" id="6820941">byte</span><span class="op" id="6820945">,</span>&nbsp;<span class="ident" id="6820947">n</span><span class="op" id="6820948">)</span><span class="op" id="6820949">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820952">w</span><span class="op" id="6820953">.</span><span class="ident" id="6820954">Close</span><span class="op" id="6820959">(</span><span class="op" id="6820960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6820963">return</span>&nbsp;<span class="ident" id="6820970">b</span><span class="op" id="6820971">.</span><span class="ident" id="6820972">Bytes</span><span class="op" id="6820977">(</span><span class="op" id="6820978">)</span><br>
<span class="lineno"></span><span class="op" id="6820980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6820983">func</span>&nbsp;<span class="ident" id="6820988">TestDecode</span><span class="op" id="6820998">(</span><span class="ident" id="6820999">t</span>&nbsp;<span class="op" id="6821001">*</span><span class="ident" id="6821002">testing</span><span class="op" id="6821009">.</span><span class="ident" id="6821010">T</span><span class="op" id="6821011">)</span>&nbsp;<span class="op" id="6821013">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821016">testCases</span>&nbsp;<span class="op" id="6821026">:=</span>&nbsp;<span class="op" id="6821029">[</span><span class="op" id="6821030">]</span><span class="keyword" id="6821031">struct</span>&nbsp;<span class="op" id="6821038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821042">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6821050">int</span>&nbsp;&nbsp;<span class="comment" id="6821055">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821100">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6821108">bool</span>&nbsp;<span class="comment" id="6821113">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821178">wantErr</span>&nbsp;<span class="builtintype" id="6821186">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821193">}</span><span class="op" id="6821194">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821198">{</span><span class="num" id="6821199">0</span><span class="op" id="6821200">,</span>&nbsp;<span class="ident" id="6821202">false</span><span class="op" id="6821207">,</span>&nbsp;<span class="ident" id="6821209">errNotEnough</span><span class="op" id="6821221">}</span><span class="op" id="6821222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821226">{</span><span class="num" id="6821227">1</span><span class="op" id="6821228">,</span>&nbsp;<span class="ident" id="6821230">false</span><span class="op" id="6821235">,</span>&nbsp;<span class="ident" id="6821237">errNotEnough</span><span class="op" id="6821249">}</span><span class="op" id="6821250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821254">{</span><span class="num" id="6821255">2</span><span class="op" id="6821256">,</span>&nbsp;<span class="ident" id="6821258">false</span><span class="op" id="6821263">,</span>&nbsp;<span class="ident" id="6821265">nil</span><span class="op" id="6821268">}</span><span class="op" id="6821269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821273">{</span><span class="num" id="6821274">2</span><span class="op" id="6821275">,</span>&nbsp;<span class="ident" id="6821277">true</span><span class="op" id="6821281">,</span>&nbsp;<span class="ident" id="6821283">errTooMuch</span><span class="op" id="6821293">}</span><span class="op" id="6821294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821298">{</span><span class="num" id="6821299">3</span><span class="op" id="6821300">,</span>&nbsp;<span class="ident" id="6821302">false</span><span class="op" id="6821307">,</span>&nbsp;<span class="ident" id="6821309">errTooMuch</span><span class="op" id="6821319">}</span><span class="op" id="6821320">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6821326">for</span>&nbsp;<span class="ident" id="6821330">_</span><span class="op" id="6821331">,</span>&nbsp;<span class="ident" id="6821333">tc</span>&nbsp;<span class="op" id="6821336">:=</span>&nbsp;<span class="keyword" id="6821339">range</span>&nbsp;<span class="ident" id="6821345">testCases</span>&nbsp;<span class="op" id="6821355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821359">b</span>&nbsp;<span class="op" id="6821361">:=</span>&nbsp;<span class="op" id="6821364">&amp;</span><span class="ident" id="6821365">bytes</span><span class="op" id="6821370">.</span><span class="ident" id="6821371">Buffer</span><span class="op" id="6821377">{</span><span class="op" id="6821378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821382">b</span><span class="op" id="6821383">.</span><span class="ident" id="6821384">WriteString</span><span class="op" id="6821395">(</span><span class="ident" id="6821396">headerStr</span><span class="op" id="6821405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821409">b</span><span class="op" id="6821410">.</span><span class="ident" id="6821411">WriteString</span><span class="op" id="6821422">(</span><span class="ident" id="6821423">paletteStr</span><span class="op" id="6821433">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6821437">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6821509">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6821578">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6821647">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821682">b</span><span class="op" id="6821683">.</span><span class="ident" id="6821684">WriteString</span><span class="op" id="6821695">(</span><span class="string" id="6821696">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6821742">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6821746">if</span>&nbsp;<span class="ident" id="6821749">tc</span><span class="op" id="6821751">.</span><span class="ident" id="6821752">nPix</span>&nbsp;<span class="op" id="6821757">&gt;</span>&nbsp;<span class="num" id="6821759">0</span>&nbsp;<span class="op" id="6821761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821766">enc</span>&nbsp;<span class="op" id="6821770">:=</span>&nbsp;<span class="ident" id="6821773">lzwEncode</span><span class="op" id="6821782">(</span><span class="ident" id="6821783">tc</span><span class="op" id="6821785">.</span><span class="ident" id="6821786">nPix</span><span class="op" id="6821790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6821795">if</span>&nbsp;<span class="builtinfunc" id="6821798">len</span><span class="op" id="6821801">(</span><span class="ident" id="6821802">enc</span><span class="op" id="6821805">)</span>&nbsp;<span class="op" id="6821807">&gt;</span>&nbsp;<span class="num" id="6821809">0xff</span>&nbsp;<span class="op" id="6821814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821820">t</span><span class="op" id="6821821">.</span><span class="ident" id="6821822">Errorf</span><span class="op" id="6821828">(</span><span class="string" id="6821829">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="6821883">,</span>&nbsp;<span class="ident" id="6821885">tc</span><span class="op" id="6821887">.</span><span class="ident" id="6821888">nPix</span><span class="op" id="6821892">,</span>&nbsp;<span class="ident" id="6821894">tc</span><span class="op" id="6821896">.</span><span class="ident" id="6821897">extra</span><span class="op" id="6821902">,</span>&nbsp;<span class="builtinfunc" id="6821904">len</span><span class="op" id="6821907">(</span><span class="ident" id="6821908">enc</span><span class="op" id="6821911">)</span><span class="op" id="6821912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6821918">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821935">b</span><span class="op" id="6821936">.</span><span class="ident" id="6821937">WriteByte</span><span class="op" id="6821946">(</span><span class="builtintype" id="6821947">byte</span><span class="op" id="6821951">(</span><span class="builtinfunc" id="6821952">len</span><span class="op" id="6821955">(</span><span class="ident" id="6821956">enc</span><span class="op" id="6821959">)</span><span class="op" id="6821960">)</span><span class="op" id="6821961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6821966">b</span><span class="op" id="6821967">.</span><span class="ident" id="6821968">Write</span><span class="op" id="6821973">(</span><span class="ident" id="6821974">enc</span><span class="op" id="6821977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6821981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6821985">if</span>&nbsp;<span class="ident" id="6821988">tc</span><span class="op" id="6821990">.</span><span class="ident" id="6821991">extra</span>&nbsp;<span class="op" id="6821997">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822002">b</span><span class="op" id="6822003">.</span><span class="ident" id="6822004">WriteString</span><span class="op" id="6822015">(</span><span class="string" id="6822016">&#34;\x01\x02&#34;</span><span class="op" id="6822026">)</span>&nbsp;<span class="comment" id="6822028">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822073">b</span><span class="op" id="6822074">.</span><span class="ident" id="6822075">WriteByte</span><span class="op" id="6822084">(</span><span class="num" id="6822085">0x00</span><span class="op" id="6822089">)</span>&nbsp;<span class="comment" id="6822091">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822148">b</span><span class="op" id="6822149">.</span><span class="ident" id="6822150">WriteString</span><span class="op" id="6822161">(</span><span class="ident" id="6822162">trailerStr</span><span class="op" id="6822172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822177">got</span><span class="op" id="6822180">,</span>&nbsp;<span class="ident" id="6822182">err</span>&nbsp;<span class="op" id="6822186">:=</span>&nbsp;<span class="ident" id="6822189">Decode</span><span class="op" id="6822195">(</span><span class="ident" id="6822196">b</span><span class="op" id="6822197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6822201">if</span>&nbsp;<span class="ident" id="6822204">err</span>&nbsp;<span class="op" id="6822208">!=</span>&nbsp;<span class="ident" id="6822211">tc</span><span class="op" id="6822213">.</span><span class="ident" id="6822214">wantErr</span>&nbsp;<span class="op" id="6822222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822227">t</span><span class="op" id="6822228">.</span><span class="ident" id="6822229">Errorf</span><span class="op" id="6822235">(</span><span class="string" id="6822236">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="6822273">,</span>&nbsp;<span class="ident" id="6822275">tc</span><span class="op" id="6822277">.</span><span class="ident" id="6822278">nPix</span><span class="op" id="6822282">,</span>&nbsp;<span class="ident" id="6822284">tc</span><span class="op" id="6822286">.</span><span class="ident" id="6822287">extra</span><span class="op" id="6822292">,</span>&nbsp;<span class="ident" id="6822294">err</span><span class="op" id="6822297">,</span>&nbsp;<span class="ident" id="6822299">tc</span><span class="op" id="6822301">.</span><span class="ident" id="6822302">wantErr</span><span class="op" id="6822309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6822318">if</span>&nbsp;<span class="ident" id="6822321">tc</span><span class="op" id="6822323">.</span><span class="ident" id="6822324">wantErr</span>&nbsp;<span class="op" id="6822332">!=</span>&nbsp;<span class="ident" id="6822335">nil</span>&nbsp;<span class="op" id="6822339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6822344">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822359">want</span>&nbsp;<span class="op" id="6822364">:=</span>&nbsp;<span class="op" id="6822367">&amp;</span><span class="ident" id="6822368">image</span><span class="op" id="6822373">.</span><span class="ident" id="6822374">Paletted</span><span class="op" id="6822382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822387">Pix</span><span class="op" id="6822390">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822395">[</span><span class="op" id="6822396">]</span><span class="builtintype" id="6822397">uint8</span><span class="op" id="6822402">{</span><span class="num" id="6822403">0</span><span class="op" id="6822404">,</span>&nbsp;<span class="num" id="6822406">0</span><span class="op" id="6822407">}</span><span class="op" id="6822408">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822413">Stride</span><span class="op" id="6822419">:</span>&nbsp;<span class="num" id="6822421">2</span><span class="op" id="6822422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822427">Rect</span><span class="op" id="6822431">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6822435">image</span><span class="op" id="6822440">.</span><span class="ident" id="6822441">Rect</span><span class="op" id="6822445">(</span><span class="num" id="6822446">0</span><span class="op" id="6822447">,</span>&nbsp;<span class="num" id="6822449">0</span><span class="op" id="6822450">,</span>&nbsp;<span class="num" id="6822452">2</span><span class="op" id="6822453">,</span>&nbsp;<span class="num" id="6822455">1</span><span class="op" id="6822456">)</span><span class="op" id="6822457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822462">Palette</span><span class="op" id="6822469">:</span>&nbsp;<span class="ident" id="6822471">color</span><span class="op" id="6822476">.</span><span class="ident" id="6822477">Palette</span><span class="op" id="6822484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822490">color</span><span class="op" id="6822495">.</span><span class="ident" id="6822496">RGBA</span><span class="op" id="6822500">{</span><span class="num" id="6822501">0x10</span><span class="op" id="6822505">,</span>&nbsp;<span class="num" id="6822507">0x20</span><span class="op" id="6822511">,</span>&nbsp;<span class="num" id="6822513">0x30</span><span class="op" id="6822517">,</span>&nbsp;<span class="num" id="6822519">0xff</span><span class="op" id="6822523">}</span><span class="op" id="6822524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822530">color</span><span class="op" id="6822535">.</span><span class="ident" id="6822536">RGBA</span><span class="op" id="6822540">{</span><span class="num" id="6822541">0x40</span><span class="op" id="6822545">,</span>&nbsp;<span class="num" id="6822547">0x50</span><span class="op" id="6822551">,</span>&nbsp;<span class="num" id="6822553">0x60</span><span class="op" id="6822557">,</span>&nbsp;<span class="num" id="6822559">0xff</span><span class="op" id="6822563">}</span><span class="op" id="6822564">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822569">}</span><span class="op" id="6822570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6822578">if</span>&nbsp;<span class="op" id="6822581">!</span><span class="ident" id="6822582">reflect</span><span class="op" id="6822589">.</span><span class="ident" id="6822590">DeepEqual</span><span class="op" id="6822599">(</span><span class="ident" id="6822600">got</span><span class="op" id="6822603">,</span>&nbsp;<span class="ident" id="6822605">want</span><span class="op" id="6822609">)</span>&nbsp;<span class="op" id="6822611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822616">t</span><span class="op" id="6822617">.</span><span class="ident" id="6822618">Errorf</span><span class="op" id="6822624">(</span><span class="string" id="6822625">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="6822662">,</span>&nbsp;<span class="ident" id="6822664">tc</span><span class="op" id="6822666">.</span><span class="ident" id="6822667">nPix</span><span class="op" id="6822671">,</span>&nbsp;<span class="ident" id="6822673">tc</span><span class="op" id="6822675">.</span><span class="ident" id="6822676">extra</span><span class="op" id="6822681">,</span>&nbsp;<span class="ident" id="6822683">got</span><span class="op" id="6822686">,</span>&nbsp;<span class="ident" id="6822688">want</span><span class="op" id="6822692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822696">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822699">}</span><br>
<span class="lineno"></span><span class="op" id="6822701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6822704">func</span>&nbsp;<span class="ident" id="6822709">TestTransparentIndex</span><span class="op" id="6822729">(</span><span class="ident" id="6822730">t</span>&nbsp;<span class="op" id="6822732">*</span><span class="ident" id="6822733">testing</span><span class="op" id="6822740">.</span><span class="ident" id="6822741">T</span><span class="op" id="6822742">)</span>&nbsp;<span class="op" id="6822744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822747">b</span>&nbsp;<span class="op" id="6822749">:=</span>&nbsp;<span class="op" id="6822752">&amp;</span><span class="ident" id="6822753">bytes</span><span class="op" id="6822758">.</span><span class="ident" id="6822759">Buffer</span><span class="op" id="6822765">{</span><span class="op" id="6822766">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822769">b</span><span class="op" id="6822770">.</span><span class="ident" id="6822771">WriteString</span><span class="op" id="6822782">(</span><span class="ident" id="6822783">headerStr</span><span class="op" id="6822792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822795">b</span><span class="op" id="6822796">.</span><span class="ident" id="6822797">WriteString</span><span class="op" id="6822808">(</span><span class="ident" id="6822809">paletteStr</span><span class="op" id="6822819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6822822">for</span>&nbsp;<span class="ident" id="6822826">transparentIndex</span>&nbsp;<span class="op" id="6822843">:=</span>&nbsp;<span class="num" id="6822846">0</span><span class="op" id="6822847">;</span>&nbsp;<span class="ident" id="6822849">transparentIndex</span>&nbsp;<span class="op" id="6822866">&lt;</span>&nbsp;<span class="num" id="6822868">3</span><span class="op" id="6822869">;</span>&nbsp;<span class="ident" id="6822871">transparentIndex</span><span class="op" id="6822887">++</span>&nbsp;<span class="op" id="6822890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6822894">if</span>&nbsp;<span class="ident" id="6822897">transparentIndex</span>&nbsp;<span class="op" id="6822914">&lt;</span>&nbsp;<span class="num" id="6822916">2</span>&nbsp;<span class="op" id="6822918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6822923">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822982">b</span><span class="op" id="6822983">.</span><span class="ident" id="6822984">WriteString</span><span class="op" id="6822995">(</span><span class="string" id="6822996">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="6823022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823027">b</span><span class="op" id="6823028">.</span><span class="ident" id="6823029">WriteByte</span><span class="op" id="6823038">(</span><span class="builtintype" id="6823039">byte</span><span class="op" id="6823043">(</span><span class="ident" id="6823044">transparentIndex</span><span class="op" id="6823060">)</span><span class="op" id="6823061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823066">b</span><span class="op" id="6823067">.</span><span class="ident" id="6823068">WriteByte</span><span class="op" id="6823077">(</span><span class="num" id="6823078">0</span><span class="op" id="6823079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6823087">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823143">b</span><span class="op" id="6823144">.</span><span class="ident" id="6823145">WriteString</span><span class="op" id="6823156">(</span><span class="string" id="6823157">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6823203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823207">enc</span>&nbsp;<span class="op" id="6823211">:=</span>&nbsp;<span class="ident" id="6823214">lzwEncode</span><span class="op" id="6823223">(</span><span class="num" id="6823224">2</span><span class="op" id="6823225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823229">if</span>&nbsp;<span class="builtinfunc" id="6823232">len</span><span class="op" id="6823235">(</span><span class="ident" id="6823236">enc</span><span class="op" id="6823239">)</span>&nbsp;<span class="op" id="6823241">&gt;</span>&nbsp;<span class="num" id="6823243">0xff</span>&nbsp;<span class="op" id="6823248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823253">t</span><span class="op" id="6823254">.</span><span class="ident" id="6823255">Fatalf</span><span class="op" id="6823261">(</span><span class="string" id="6823262">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="6823297">,</span>&nbsp;<span class="builtinfunc" id="6823299">len</span><span class="op" id="6823302">(</span><span class="ident" id="6823303">enc</span><span class="op" id="6823306">)</span><span class="op" id="6823307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823311">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823315">b</span><span class="op" id="6823316">.</span><span class="ident" id="6823317">WriteByte</span><span class="op" id="6823326">(</span><span class="builtintype" id="6823327">byte</span><span class="op" id="6823331">(</span><span class="builtinfunc" id="6823332">len</span><span class="op" id="6823335">(</span><span class="ident" id="6823336">enc</span><span class="op" id="6823339">)</span><span class="op" id="6823340">)</span><span class="op" id="6823341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823345">b</span><span class="op" id="6823346">.</span><span class="ident" id="6823347">Write</span><span class="op" id="6823352">(</span><span class="ident" id="6823353">enc</span><span class="op" id="6823356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823360">b</span><span class="op" id="6823361">.</span><span class="ident" id="6823362">WriteByte</span><span class="op" id="6823371">(</span><span class="num" id="6823372">0x00</span><span class="op" id="6823376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823382">b</span><span class="op" id="6823383">.</span><span class="ident" id="6823384">WriteString</span><span class="op" id="6823395">(</span><span class="ident" id="6823396">trailerStr</span><span class="op" id="6823406">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823410">g</span><span class="op" id="6823411">,</span>&nbsp;<span class="ident" id="6823413">err</span>&nbsp;<span class="op" id="6823417">:=</span>&nbsp;<span class="ident" id="6823420">DecodeAll</span><span class="op" id="6823429">(</span><span class="ident" id="6823430">b</span><span class="op" id="6823431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823434">if</span>&nbsp;<span class="ident" id="6823437">err</span>&nbsp;<span class="op" id="6823441">!=</span>&nbsp;<span class="ident" id="6823444">nil</span>&nbsp;<span class="op" id="6823448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823452">t</span><span class="op" id="6823453">.</span><span class="ident" id="6823454">Fatalf</span><span class="op" id="6823460">(</span><span class="string" id="6823461">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="6823476">,</span>&nbsp;<span class="ident" id="6823478">err</span><span class="op" id="6823481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823484">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823487">c0</span>&nbsp;<span class="op" id="6823490">:=</span>&nbsp;<span class="ident" id="6823493">color</span><span class="op" id="6823498">.</span><span class="ident" id="6823499">RGBA</span><span class="op" id="6823503">{</span><span class="ident" id="6823504">paletteStr</span><span class="op" id="6823514">[</span><span class="num" id="6823515">0</span><span class="op" id="6823516">]</span><span class="op" id="6823517">,</span>&nbsp;<span class="ident" id="6823519">paletteStr</span><span class="op" id="6823529">[</span><span class="num" id="6823530">1</span><span class="op" id="6823531">]</span><span class="op" id="6823532">,</span>&nbsp;<span class="ident" id="6823534">paletteStr</span><span class="op" id="6823544">[</span><span class="num" id="6823545">2</span><span class="op" id="6823546">]</span><span class="op" id="6823547">,</span>&nbsp;<span class="num" id="6823549">0xff</span><span class="op" id="6823553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823556">c1</span>&nbsp;<span class="op" id="6823559">:=</span>&nbsp;<span class="ident" id="6823562">color</span><span class="op" id="6823567">.</span><span class="ident" id="6823568">RGBA</span><span class="op" id="6823572">{</span><span class="ident" id="6823573">paletteStr</span><span class="op" id="6823583">[</span><span class="num" id="6823584">3</span><span class="op" id="6823585">]</span><span class="op" id="6823586">,</span>&nbsp;<span class="ident" id="6823588">paletteStr</span><span class="op" id="6823598">[</span><span class="num" id="6823599">4</span><span class="op" id="6823600">]</span><span class="op" id="6823601">,</span>&nbsp;<span class="ident" id="6823603">paletteStr</span><span class="op" id="6823613">[</span><span class="num" id="6823614">5</span><span class="op" id="6823615">]</span><span class="op" id="6823616">,</span>&nbsp;<span class="num" id="6823618">0xff</span><span class="op" id="6823622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823625">cz</span>&nbsp;<span class="op" id="6823628">:=</span>&nbsp;<span class="ident" id="6823631">color</span><span class="op" id="6823636">.</span><span class="ident" id="6823637">RGBA</span><span class="op" id="6823641">{</span><span class="op" id="6823642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823645">wants</span>&nbsp;<span class="op" id="6823651">:=</span>&nbsp;<span class="op" id="6823654">[</span><span class="op" id="6823655">]</span><span class="ident" id="6823656">color</span><span class="op" id="6823661">.</span><span class="ident" id="6823662">Palette</span><span class="op" id="6823669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823673">{</span><span class="ident" id="6823674">cz</span><span class="op" id="6823676">,</span>&nbsp;<span class="ident" id="6823678">c1</span><span class="op" id="6823680">}</span><span class="op" id="6823681">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823685">{</span><span class="ident" id="6823686">c0</span><span class="op" id="6823688">,</span>&nbsp;<span class="ident" id="6823690">cz</span><span class="op" id="6823692">}</span><span class="op" id="6823693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823697">{</span><span class="ident" id="6823698">c0</span><span class="op" id="6823700">,</span>&nbsp;<span class="ident" id="6823702">c1</span><span class="op" id="6823704">}</span><span class="op" id="6823705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823711">if</span>&nbsp;<span class="builtinfunc" id="6823714">len</span><span class="op" id="6823717">(</span><span class="ident" id="6823718">g</span><span class="op" id="6823719">.</span><span class="ident" id="6823720">Image</span><span class="op" id="6823725">)</span>&nbsp;<span class="op" id="6823727">!=</span>&nbsp;<span class="builtinfunc" id="6823730">len</span><span class="op" id="6823733">(</span><span class="ident" id="6823734">wants</span><span class="op" id="6823739">)</span>&nbsp;<span class="op" id="6823741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823745">t</span><span class="op" id="6823746">.</span><span class="ident" id="6823747">Fatalf</span><span class="op" id="6823753">(</span><span class="string" id="6823754">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6823778">,</span>&nbsp;<span class="builtinfunc" id="6823780">len</span><span class="op" id="6823783">(</span><span class="ident" id="6823784">g</span><span class="op" id="6823785">.</span><span class="ident" id="6823786">Image</span><span class="op" id="6823791">)</span><span class="op" id="6823792">,</span>&nbsp;<span class="builtinfunc" id="6823794">len</span><span class="op" id="6823797">(</span><span class="ident" id="6823798">wants</span><span class="op" id="6823803">)</span><span class="op" id="6823804">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823810">for</span>&nbsp;<span class="ident" id="6823814">i</span><span class="op" id="6823815">,</span>&nbsp;<span class="ident" id="6823817">want</span>&nbsp;<span class="op" id="6823822">:=</span>&nbsp;<span class="keyword" id="6823825">range</span>&nbsp;<span class="ident" id="6823831">wants</span>&nbsp;<span class="op" id="6823837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823841">got</span>&nbsp;<span class="op" id="6823845">:=</span>&nbsp;<span class="ident" id="6823848">g</span><span class="op" id="6823849">.</span><span class="ident" id="6823850">Image</span><span class="op" id="6823855">[</span><span class="ident" id="6823856">i</span><span class="op" id="6823857">]</span><span class="op" id="6823858">.</span><span class="ident" id="6823859">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823869">if</span>&nbsp;<span class="op" id="6823872">!</span><span class="ident" id="6823873">reflect</span><span class="op" id="6823880">.</span><span class="ident" id="6823881">DeepEqual</span><span class="op" id="6823890">(</span><span class="ident" id="6823891">got</span><span class="op" id="6823894">,</span>&nbsp;<span class="ident" id="6823896">want</span><span class="op" id="6823900">)</span>&nbsp;<span class="op" id="6823902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823907">t</span><span class="op" id="6823908">.</span><span class="ident" id="6823909">Errorf</span><span class="op" id="6823915">(</span><span class="string" id="6823916">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="6823948">,</span>&nbsp;<span class="ident" id="6823950">i</span><span class="op" id="6823951">,</span>&nbsp;<span class="ident" id="6823953">got</span><span class="op" id="6823956">,</span>&nbsp;<span class="ident" id="6823958">want</span><span class="op" id="6823962">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823969">}</span><br>
<span class="lineno"></span><span class="op" id="6823971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6823974">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="6824049">var</span>&nbsp;<span class="ident" id="6824053">testGIF</span>&nbsp;<span class="op" id="6824061">=</span>&nbsp;<span class="op" id="6824063">[</span><span class="op" id="6824064">]</span><span class="builtintype" id="6824065">byte</span><span class="op" id="6824069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6824072">&#39;G&#39;</span><span class="op" id="6824075">,</span>&nbsp;<span class="string" id="6824077">&#39;I&#39;</span><span class="op" id="6824080">,</span>&nbsp;<span class="string" id="6824082">&#39;F&#39;</span><span class="op" id="6824085">,</span>&nbsp;<span class="string" id="6824087">&#39;8&#39;</span><span class="op" id="6824090">,</span>&nbsp;<span class="string" id="6824092">&#39;9&#39;</span><span class="op" id="6824095">,</span>&nbsp;<span class="string" id="6824097">&#39;a&#39;</span><span class="op" id="6824100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824103">1</span><span class="op" id="6824104">,</span>&nbsp;<span class="num" id="6824106">0</span><span class="op" id="6824107">,</span>&nbsp;<span class="num" id="6824109">1</span><span class="op" id="6824110">,</span>&nbsp;<span class="num" id="6824112">0</span><span class="op" id="6824113">,</span>&nbsp;<span class="comment" id="6824115">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824132">128</span><span class="op" id="6824135">,</span>&nbsp;<span class="num" id="6824137">0</span><span class="op" id="6824138">,</span>&nbsp;<span class="num" id="6824140">0</span><span class="op" id="6824141">,</span>&nbsp;<span class="comment" id="6824143">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824177">0</span><span class="op" id="6824178">,</span>&nbsp;<span class="num" id="6824180">0</span><span class="op" id="6824181">,</span>&nbsp;<span class="num" id="6824183">0</span><span class="op" id="6824184">,</span>&nbsp;<span class="num" id="6824186">1</span><span class="op" id="6824187">,</span>&nbsp;<span class="num" id="6824189">1</span><span class="op" id="6824190">,</span>&nbsp;<span class="num" id="6824192">1</span><span class="op" id="6824193">,</span>&nbsp;<span class="comment" id="6824195">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824235">0x21</span><span class="op" id="6824239">,</span>&nbsp;<span class="num" id="6824241">0xf9</span><span class="op" id="6824245">,</span>&nbsp;<span class="num" id="6824247">0x04</span><span class="op" id="6824251">,</span>&nbsp;<span class="num" id="6824253">0x00</span><span class="op" id="6824257">,</span>&nbsp;<span class="num" id="6824259">0x00</span><span class="op" id="6824263">,</span>&nbsp;<span class="num" id="6824265">0x00</span><span class="op" id="6824269">,</span>&nbsp;<span class="num" id="6824271">0xff</span><span class="op" id="6824275">,</span>&nbsp;<span class="num" id="6824277">0x00</span><span class="op" id="6824281">,</span>&nbsp;<span class="comment" id="6824283">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6824292">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824316">0x2c</span><span class="op" id="6824320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824323">0x00</span><span class="op" id="6824327">,</span>&nbsp;<span class="num" id="6824329">0x00</span><span class="op" id="6824333">,</span>&nbsp;<span class="num" id="6824335">0x00</span><span class="op" id="6824339">,</span>&nbsp;<span class="num" id="6824341">0x00</span><span class="op" id="6824345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824348">0x01</span><span class="op" id="6824352">,</span>&nbsp;<span class="num" id="6824354">0x00</span><span class="op" id="6824358">,</span>&nbsp;<span class="num" id="6824360">0x01</span><span class="op" id="6824364">,</span>&nbsp;<span class="num" id="6824366">0x00</span><span class="op" id="6824370">,</span>&nbsp;<span class="comment" id="6824372">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824381">0x00</span><span class="op" id="6824385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824388">0x02</span><span class="op" id="6824392">,</span>&nbsp;<span class="num" id="6824394">0x02</span><span class="op" id="6824398">,</span>&nbsp;<span class="num" id="6824400">0x4c</span><span class="op" id="6824404">,</span>&nbsp;<span class="num" id="6824406">0x01</span><span class="op" id="6824410">,</span>&nbsp;<span class="num" id="6824412">0x00</span><span class="op" id="6824416">,</span>&nbsp;<span class="comment" id="6824418">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6824433">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6824445">0x3b</span><span class="op" id="6824449">,</span><br>
<span class="lineno"></span><span class="op" id="6824451">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6824454">func</span>&nbsp;<span class="ident" id="6824459">try</span><span class="op" id="6824462">(</span><span class="ident" id="6824463">t</span>&nbsp;<span class="op" id="6824465">*</span><span class="ident" id="6824466">testing</span><span class="op" id="6824473">.</span><span class="ident" id="6824474">T</span><span class="op" id="6824475">,</span>&nbsp;<span class="ident" id="6824477">b</span>&nbsp;<span class="op" id="6824479">[</span><span class="op" id="6824480">]</span><span class="builtintype" id="6824481">byte</span><span class="op" id="6824485">,</span>&nbsp;<span class="ident" id="6824487">want</span>&nbsp;<span class="builtintype" id="6824492">string</span><span class="op" id="6824498">)</span>&nbsp;<span class="op" id="6824500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824503">_</span><span class="op" id="6824504">,</span>&nbsp;<span class="ident" id="6824506">err</span>&nbsp;<span class="op" id="6824510">:=</span>&nbsp;<span class="ident" id="6824513">DecodeAll</span><span class="op" id="6824522">(</span><span class="ident" id="6824523">bytes</span><span class="op" id="6824528">.</span><span class="ident" id="6824529">NewReader</span><span class="op" id="6824538">(</span><span class="ident" id="6824539">b</span><span class="op" id="6824540">)</span><span class="op" id="6824541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824544">var</span>&nbsp;<span class="ident" id="6824548">got</span>&nbsp;<span class="builtintype" id="6824552">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824560">if</span>&nbsp;<span class="ident" id="6824563">err</span>&nbsp;<span class="op" id="6824567">!=</span>&nbsp;<span class="ident" id="6824570">nil</span>&nbsp;<span class="op" id="6824574">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824578">got</span>&nbsp;<span class="op" id="6824582">=</span>&nbsp;<span class="ident" id="6824584">err</span><span class="op" id="6824587">.</span><span class="ident" id="6824588">Error</span><span class="op" id="6824593">(</span><span class="op" id="6824594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824600">if</span>&nbsp;<span class="ident" id="6824603">got</span>&nbsp;<span class="op" id="6824607">!=</span>&nbsp;<span class="ident" id="6824610">want</span>&nbsp;<span class="op" id="6824615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824619">t</span><span class="op" id="6824620">.</span><span class="ident" id="6824621">Fatalf</span><span class="op" id="6824627">(</span><span class="string" id="6824628">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6824645">,</span>&nbsp;<span class="ident" id="6824647">got</span><span class="op" id="6824650">,</span>&nbsp;<span class="ident" id="6824652">want</span><span class="op" id="6824656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824659">}</span><br>
<span class="lineno">165</span><span class="op" id="6824661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824664">func</span>&nbsp;<span class="ident" id="6824669">TestBounds</span><span class="op" id="6824679">(</span><span class="ident" id="6824680">t</span>&nbsp;<span class="op" id="6824682">*</span><span class="ident" id="6824683">testing</span><span class="op" id="6824690">.</span><span class="ident" id="6824691">T</span><span class="op" id="6824692">)</span>&nbsp;<span class="op" id="6824694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6824697">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824731">gif</span>&nbsp;<span class="op" id="6824735">:=</span>&nbsp;<span class="builtinfunc" id="6824738">make</span><span class="op" id="6824742">(</span><span class="op" id="6824743">[</span><span class="op" id="6824744">]</span><span class="builtintype" id="6824745">byte</span><span class="op" id="6824749">,</span>&nbsp;<span class="builtinfunc" id="6824751">len</span><span class="op" id="6824754">(</span><span class="ident" id="6824755">testGIF</span><span class="op" id="6824762">)</span><span class="op" id="6824763">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6824766">copy</span><span class="op" id="6824770">(</span><span class="ident" id="6824771">gif</span><span class="op" id="6824774">,</span>&nbsp;<span class="ident" id="6824776">testGIF</span><span class="op" id="6824783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6824786">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824828">gif</span><span class="op" id="6824831">[</span><span class="num" id="6824832">32</span><span class="op" id="6824834">]</span>&nbsp;<span class="op" id="6824836">=</span>&nbsp;<span class="num" id="6824838">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824841">want</span>&nbsp;<span class="op" id="6824846">:=</span>&nbsp;<span class="string" id="6824849">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824895">try</span><span class="op" id="6824898">(</span><span class="ident" id="6824899">t</span><span class="op" id="6824900">,</span>&nbsp;<span class="ident" id="6824902">gif</span><span class="op" id="6824905">,</span>&nbsp;<span class="ident" id="6824907">want</span><span class="op" id="6824911">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6824915">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6824970">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825012">gif</span><span class="op" id="6825015">[</span><span class="num" id="6825016">32</span><span class="op" id="6825018">]</span>&nbsp;<span class="op" id="6825020">=</span>&nbsp;<span class="num" id="6825022">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825025">want</span>&nbsp;<span class="op" id="6825030">=</span>&nbsp;<span class="string" id="6825032">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825060">try</span><span class="op" id="6825063">(</span><span class="ident" id="6825064">t</span><span class="op" id="6825065">,</span>&nbsp;<span class="ident" id="6825067">gif</span><span class="op" id="6825070">,</span>&nbsp;<span class="ident" id="6825072">want</span><span class="op" id="6825076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825079">gif</span><span class="op" id="6825082">[</span><span class="num" id="6825083">32</span><span class="op" id="6825085">]</span>&nbsp;<span class="op" id="6825087">=</span>&nbsp;<span class="num" id="6825089">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6825093">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825142">want</span>&nbsp;<span class="op" id="6825147">=</span>&nbsp;<span class="string" id="6825149">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6825195">for</span>&nbsp;<span class="ident" id="6825199">i</span>&nbsp;<span class="op" id="6825201">:=</span>&nbsp;<span class="num" id="6825204">0</span><span class="op" id="6825205">;</span>&nbsp;<span class="ident" id="6825207">i</span>&nbsp;<span class="op" id="6825209">&lt;</span>&nbsp;<span class="num" id="6825211">4</span><span class="op" id="6825212">;</span>&nbsp;<span class="ident" id="6825214">i</span><span class="op" id="6825215">++</span>&nbsp;<span class="op" id="6825218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825222">gif</span><span class="op" id="6825225">[</span><span class="num" id="6825226">32</span><span class="op" id="6825228">+</span><span class="ident" id="6825229">i</span><span class="op" id="6825230">]</span>&nbsp;<span class="op" id="6825232">=</span>&nbsp;<span class="num" id="6825234">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6825240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825243">try</span><span class="op" id="6825246">(</span><span class="ident" id="6825247">t</span><span class="op" id="6825248">,</span>&nbsp;<span class="ident" id="6825250">gif</span><span class="op" id="6825253">,</span>&nbsp;<span class="ident" id="6825255">want</span><span class="op" id="6825259">)</span><br>
<span class="lineno"></span><span class="op" id="6825261">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="6825264">func</span>&nbsp;<span class="ident" id="6825269">TestNoPalette</span><span class="op" id="6825282">(</span><span class="ident" id="6825283">t</span>&nbsp;<span class="op" id="6825285">*</span><span class="ident" id="6825286">testing</span><span class="op" id="6825293">.</span><span class="ident" id="6825294">T</span><span class="op" id="6825295">)</span>&nbsp;<span class="op" id="6825297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825300">b</span>&nbsp;<span class="op" id="6825302">:=</span>&nbsp;<span class="op" id="6825305">&amp;</span><span class="ident" id="6825306">bytes</span><span class="op" id="6825311">.</span><span class="ident" id="6825312">Buffer</span><span class="op" id="6825318">{</span><span class="op" id="6825319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6825323">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6825382">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825403">b</span><span class="op" id="6825404">.</span><span class="ident" id="6825405">WriteString</span><span class="op" id="6825416">(</span><span class="ident" id="6825417">headerStr</span><span class="op" id="6825426">[</span><span class="op" id="6825427">:</span><span class="builtinfunc" id="6825428">len</span><span class="op" id="6825431">(</span><span class="ident" id="6825432">headerStr</span><span class="op" id="6825441">)</span><span class="op" id="6825442">-</span><span class="num" id="6825443">3</span><span class="op" id="6825444">]</span><span class="op" id="6825445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825448">b</span><span class="op" id="6825449">.</span><span class="ident" id="6825450">WriteString</span><span class="op" id="6825461">(</span><span class="string" id="6825462">&#34;\x00\x00\x00&#34;</span><span class="op" id="6825476">)</span>&nbsp;<span class="comment" id="6825478">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6825502">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825547">b</span><span class="op" id="6825548">.</span><span class="ident" id="6825549">WriteString</span><span class="op" id="6825560">(</span><span class="string" id="6825561">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6825607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6825611">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825684">pix</span>&nbsp;<span class="op" id="6825688">:=</span>&nbsp;<span class="op" id="6825691">[</span><span class="op" id="6825692">]</span><span class="builtintype" id="6825693">byte</span><span class="op" id="6825697">{</span><span class="num" id="6825698">0</span><span class="op" id="6825699">,</span>&nbsp;<span class="num" id="6825701">128</span><span class="op" id="6825704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825707">enc</span>&nbsp;<span class="op" id="6825711">:=</span>&nbsp;<span class="op" id="6825714">&amp;</span><span class="ident" id="6825715">bytes</span><span class="op" id="6825720">.</span><span class="ident" id="6825721">Buffer</span><span class="op" id="6825727">{</span><span class="op" id="6825728">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825731">w</span>&nbsp;<span class="op" id="6825733">:=</span>&nbsp;<span class="ident" id="6825736">lzw</span><span class="op" id="6825739">.</span><span class="ident" id="6825740">NewWriter</span><span class="op" id="6825749">(</span><span class="ident" id="6825750">enc</span><span class="op" id="6825753">,</span>&nbsp;<span class="ident" id="6825755">lzw</span><span class="op" id="6825758">.</span><span class="ident" id="6825759">LSB</span><span class="op" id="6825762">,</span>&nbsp;<span class="num" id="6825764">2</span><span class="op" id="6825765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825768">w</span><span class="op" id="6825769">.</span><span class="ident" id="6825770">Write</span><span class="op" id="6825775">(</span><span class="ident" id="6825776">pix</span><span class="op" id="6825779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825782">w</span><span class="op" id="6825783">.</span><span class="ident" id="6825784">Close</span><span class="op" id="6825789">(</span><span class="op" id="6825790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825793">b</span><span class="op" id="6825794">.</span><span class="ident" id="6825795">WriteByte</span><span class="op" id="6825804">(</span><span class="builtintype" id="6825805">byte</span><span class="op" id="6825809">(</span><span class="builtinfunc" id="6825810">len</span><span class="op" id="6825813">(</span><span class="ident" id="6825814">enc</span><span class="op" id="6825817">.</span><span class="ident" id="6825818">Bytes</span><span class="op" id="6825823">(</span><span class="op" id="6825824">)</span><span class="op" id="6825825">)</span><span class="op" id="6825826">)</span><span class="op" id="6825827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825830">b</span><span class="op" id="6825831">.</span><span class="ident" id="6825832">Write</span><span class="op" id="6825837">(</span><span class="ident" id="6825838">enc</span><span class="op" id="6825841">.</span><span class="ident" id="6825842">Bytes</span><span class="op" id="6825847">(</span><span class="op" id="6825848">)</span><span class="op" id="6825849">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825852">b</span><span class="op" id="6825853">.</span><span class="ident" id="6825854">WriteByte</span><span class="op" id="6825863">(</span><span class="num" id="6825864">0x00</span><span class="op" id="6825868">)</span>&nbsp;<span class="comment" id="6825870">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825927">b</span><span class="op" id="6825928">.</span><span class="ident" id="6825929">WriteString</span><span class="op" id="6825940">(</span><span class="ident" id="6825941">trailerStr</span><span class="op" id="6825951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825955">try</span><span class="op" id="6825958">(</span><span class="ident" id="6825959">t</span><span class="op" id="6825960">,</span>&nbsp;<span class="ident" id="6825962">b</span><span class="op" id="6825963">.</span><span class="ident" id="6825964">Bytes</span><span class="op" id="6825969">(</span><span class="op" id="6825970">)</span><span class="op" id="6825971">,</span>&nbsp;<span class="string" id="6825973">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6825999">)</span><br>
<span class="lineno">215</span><span class="op" id="6826001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6826004">func</span>&nbsp;<span class="ident" id="6826009">TestPixelOutsidePaletteRange</span><span class="op" id="6826037">(</span><span class="ident" id="6826038">t</span>&nbsp;<span class="op" id="6826040">*</span><span class="ident" id="6826041">testing</span><span class="op" id="6826048">.</span><span class="ident" id="6826049">T</span><span class="op" id="6826050">)</span>&nbsp;<span class="op" id="6826052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826055">for</span>&nbsp;<span class="ident" id="6826059">_</span><span class="op" id="6826060">,</span>&nbsp;<span class="ident" id="6826062">pval</span>&nbsp;<span class="op" id="6826067">:=</span>&nbsp;<span class="keyword" id="6826070">range</span>&nbsp;<span class="op" id="6826076">[</span><span class="op" id="6826077">]</span><span class="builtintype" id="6826078">byte</span><span class="op" id="6826082">{</span><span class="num" id="6826083">0</span><span class="op" id="6826084">,</span>&nbsp;<span class="num" id="6826086">1</span><span class="op" id="6826087">,</span>&nbsp;<span class="num" id="6826089">2</span><span class="op" id="6826090">,</span>&nbsp;<span class="num" id="6826092">3</span><span class="op" id="6826093">,</span>&nbsp;<span class="num" id="6826095">255</span><span class="op" id="6826098">}</span>&nbsp;<span class="op" id="6826100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826104">b</span>&nbsp;<span class="op" id="6826106">:=</span>&nbsp;<span class="op" id="6826109">&amp;</span><span class="ident" id="6826110">bytes</span><span class="op" id="6826115">.</span><span class="ident" id="6826116">Buffer</span><span class="op" id="6826122">{</span><span class="op" id="6826123">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6826128">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826175">b</span><span class="op" id="6826176">.</span><span class="ident" id="6826177">WriteString</span><span class="op" id="6826188">(</span><span class="ident" id="6826189">headerStr</span><span class="op" id="6826198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826202">b</span><span class="op" id="6826203">.</span><span class="ident" id="6826204">WriteString</span><span class="op" id="6826215">(</span><span class="ident" id="6826216">paletteStr</span><span class="op" id="6826226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6826231">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826277">b</span><span class="op" id="6826278">.</span><span class="ident" id="6826279">WriteString</span><span class="op" id="6826290">(</span><span class="string" id="6826291">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6826337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6826342">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826405">pix</span>&nbsp;<span class="op" id="6826409">:=</span>&nbsp;<span class="op" id="6826412">[</span><span class="op" id="6826413">]</span><span class="builtintype" id="6826414">byte</span><span class="op" id="6826418">{</span><span class="ident" id="6826419">pval</span><span class="op" id="6826423">,</span>&nbsp;<span class="ident" id="6826425">pval</span><span class="op" id="6826429">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826433">enc</span>&nbsp;<span class="op" id="6826437">:=</span>&nbsp;<span class="op" id="6826440">&amp;</span><span class="ident" id="6826441">bytes</span><span class="op" id="6826446">.</span><span class="ident" id="6826447">Buffer</span><span class="op" id="6826453">{</span><span class="op" id="6826454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826458">w</span>&nbsp;<span class="op" id="6826460">:=</span>&nbsp;<span class="ident" id="6826463">lzw</span><span class="op" id="6826466">.</span><span class="ident" id="6826467">NewWriter</span><span class="op" id="6826476">(</span><span class="ident" id="6826477">enc</span><span class="op" id="6826480">,</span>&nbsp;<span class="ident" id="6826482">lzw</span><span class="op" id="6826485">.</span><span class="ident" id="6826486">LSB</span><span class="op" id="6826489">,</span>&nbsp;<span class="num" id="6826491">2</span><span class="op" id="6826492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826496">w</span><span class="op" id="6826497">.</span><span class="ident" id="6826498">Write</span><span class="op" id="6826503">(</span><span class="ident" id="6826504">pix</span><span class="op" id="6826507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826511">w</span><span class="op" id="6826512">.</span><span class="ident" id="6826513">Close</span><span class="op" id="6826518">(</span><span class="op" id="6826519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826523">b</span><span class="op" id="6826524">.</span><span class="ident" id="6826525">WriteByte</span><span class="op" id="6826534">(</span><span class="builtintype" id="6826535">byte</span><span class="op" id="6826539">(</span><span class="builtinfunc" id="6826540">len</span><span class="op" id="6826543">(</span><span class="ident" id="6826544">enc</span><span class="op" id="6826547">.</span><span class="ident" id="6826548">Bytes</span><span class="op" id="6826553">(</span><span class="op" id="6826554">)</span><span class="op" id="6826555">)</span><span class="op" id="6826556">)</span><span class="op" id="6826557">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826561">b</span><span class="op" id="6826562">.</span><span class="ident" id="6826563">Write</span><span class="op" id="6826568">(</span><span class="ident" id="6826569">enc</span><span class="op" id="6826572">.</span><span class="ident" id="6826573">Bytes</span><span class="op" id="6826578">(</span><span class="op" id="6826579">)</span><span class="op" id="6826580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826584">b</span><span class="op" id="6826585">.</span><span class="ident" id="6826586">WriteByte</span><span class="op" id="6826595">(</span><span class="num" id="6826596">0x00</span><span class="op" id="6826600">)</span>&nbsp;<span class="comment" id="6826602">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826660">b</span><span class="op" id="6826661">.</span><span class="ident" id="6826662">WriteString</span><span class="op" id="6826673">(</span><span class="ident" id="6826674">trailerStr</span><span class="op" id="6826684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6826689">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826763">want</span>&nbsp;<span class="op" id="6826768">:=</span>&nbsp;<span class="string" id="6826771">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826776">if</span>&nbsp;<span class="ident" id="6826779">pval</span>&nbsp;<span class="op" id="6826784">&gt;=</span>&nbsp;<span class="num" id="6826787">2</span>&nbsp;<span class="op" id="6826789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826794">want</span>&nbsp;<span class="op" id="6826799">=</span>&nbsp;<span class="string" id="6826801">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826830">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826834">try</span><span class="op" id="6826837">(</span><span class="ident" id="6826838">t</span><span class="op" id="6826839">,</span>&nbsp;<span class="ident" id="6826841">b</span><span class="op" id="6826842">.</span><span class="ident" id="6826843">Bytes</span><span class="op" id="6826848">(</span><span class="op" id="6826849">)</span><span class="op" id="6826850">,</span>&nbsp;<span class="ident" id="6826852">want</span><span class="op" id="6826856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826859">}</span><br>
<span class="lineno"></span><span class="op" id="6826861">}</span>
</div>
</body>
</html>
