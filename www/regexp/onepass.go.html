<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5385938">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5385994">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5386048">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5386099">package</span>&nbsp;<span class="ident" id="5386107">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5386115">import</span>&nbsp;<span class="op" id="5386122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5386125">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5386134">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5386151">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5386159">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5386169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5386172">//&nbsp;&#34;One-pass&#34;&nbsp;regexp&nbsp;execution.</span><br>
<span class="lineno">15</span><span class="comment" id="5386204">//&nbsp;Some&nbsp;regexps&nbsp;can&nbsp;be&nbsp;analyzed&nbsp;to&nbsp;determine&nbsp;that&nbsp;they&nbsp;never&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5386270">//&nbsp;backtracking:&nbsp;they&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;one&nbsp;pass&nbsp;over&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5386342">//&nbsp;without&nbsp;bothering&nbsp;to&nbsp;save&nbsp;all&nbsp;the&nbsp;usual&nbsp;NFA&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5386396">//&nbsp;Detect&nbsp;those&nbsp;and&nbsp;execute&nbsp;them&nbsp;more&nbsp;quickly.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5386444">//&nbsp;A&nbsp;onePassProg&nbsp;is&nbsp;a&nbsp;compiled&nbsp;one-pass&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="5386512">//&nbsp;It&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;syntax.Prog&nbsp;except&nbsp;for&nbsp;the&nbsp;use&nbsp;of&nbsp;onePassInst.</span><br>
<span class="lineno"></span><span class="keyword" id="5386580">type</span>&nbsp;<span class="ident" id="5386585">onePassProg</span>&nbsp;<span class="keyword" id="5386597">struct</span>&nbsp;<span class="op" id="5386604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5386607">Inst</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5386614">[</span><span class="op" id="5386615">]</span><span class="ident" id="5386616"><a href="/regexp/onepass.go.html#5386876">onePassInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5386629">Start</span>&nbsp;&nbsp;<span class="builtintype" id="5386636">int</span>&nbsp;<span class="comment" id="5386640">//&nbsp;index&nbsp;of&nbsp;start&nbsp;instruction</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5386671">NumCap</span>&nbsp;<span class="builtintype" id="5386678">int</span>&nbsp;<span class="comment" id="5386682">//&nbsp;number&nbsp;of&nbsp;InstCapture&nbsp;insts&nbsp;in&nbsp;re</span><br>
<span class="lineno"></span><span class="op" id="5386719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5386722">//&nbsp;A&nbsp;onePassInst&nbsp;is&nbsp;a&nbsp;single&nbsp;instruction&nbsp;in&nbsp;a&nbsp;one-pass&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="5386805">//&nbsp;It&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;syntax.Inst&nbsp;except&nbsp;for&nbsp;the&nbsp;new&nbsp;&#39;Next&#39;&nbsp;field.</span><br>
<span class="lineno">30</span><span class="keyword" id="5386871">type</span>&nbsp;<span class="ident" id="5386876">onePassInst</span>&nbsp;<span class="keyword" id="5386888">struct</span>&nbsp;<span class="op" id="5386895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5386898"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5386904">.</span><span class="ident" id="5386905">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5386911">Next</span>&nbsp;<span class="op" id="5386916">[</span><span class="op" id="5386917">]</span><span class="builtintype" id="5386918">uint32</span><br>
<span class="lineno"></span><span class="op" id="5386925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5386928">//&nbsp;OnePassPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;all&nbsp;matches&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5386995">//&nbsp;regexp&nbsp;must&nbsp;start&nbsp;with.&nbsp;&nbsp;Complete&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="5387054">//&nbsp;is&nbsp;the&nbsp;entire&nbsp;match.&nbsp;Pc&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;rune&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="5387123">//&nbsp;in&nbsp;the&nbsp;string.&nbsp;The&nbsp;OnePassPrefix&nbsp;skips&nbsp;over&nbsp;the&nbsp;mandatory</span><br>
<span class="lineno"></span><span class="comment" id="5387184">//&nbsp;EmptyBeginText</span><br>
<span class="lineno">40</span><span class="keyword" id="5387202">func</span>&nbsp;<span class="ident" id="5387207">onePassPrefix</span><span class="op" id="5387220">(</span><span class="ident" id="5387221">p</span>&nbsp;<span class="op" id="5387223">*</span><span class="ident" id="5387224"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387230">.</span><span class="ident" id="5387231">Prog</span><span class="op" id="5387235">)</span>&nbsp;<span class="op" id="5387237">(</span><span class="ident" id="5387238">prefix</span>&nbsp;<span class="builtintype" id="5387245">string</span><span class="op" id="5387251">,</span>&nbsp;<span class="ident" id="5387253">complete</span>&nbsp;<span class="builtintype" id="5387262">bool</span><span class="op" id="5387266">,</span>&nbsp;<span class="ident" id="5387268">pc</span>&nbsp;<span class="builtintype" id="5387271">uint32</span><span class="op" id="5387277">)</span>&nbsp;<span class="op" id="5387279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387282">i</span>&nbsp;<span class="op" id="5387284">:=</span>&nbsp;<span class="op" id="5387287">&amp;</span><span class="ident" id="5387288"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387289">.</span><span class="ident" id="5387290">Inst</span><span class="op" id="5387294">[</span><span class="ident" id="5387295"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387296">.</span><span class="ident" id="5387297">Start</span><span class="op" id="5387302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387305">if</span>&nbsp;<span class="ident" id="5387308"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387309">.</span><span class="ident" id="5387310">Op</span>&nbsp;<span class="op" id="5387313">!=</span>&nbsp;<span class="ident" id="5387316"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387322">.</span><span class="ident" id="5387323">InstEmptyWidth</span>&nbsp;<span class="op" id="5387338">||</span>&nbsp;<span class="op" id="5387341">(</span><span class="ident" id="5387342"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387348">.</span><span class="ident" id="5387349">EmptyOp</span><span class="op" id="5387356">(</span><span class="ident" id="5387357"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387358">.</span><span class="ident" id="5387359">Arg</span><span class="op" id="5387362">)</span><span class="op" id="5387363">)</span><span class="op" id="5387364">&amp;</span><span class="ident" id="5387365"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387371">.</span><span class="ident" id="5387372">EmptyBeginText</span>&nbsp;<span class="op" id="5387387">==</span>&nbsp;<span class="num" id="5387390">0</span>&nbsp;<span class="op" id="5387392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387396">return</span>&nbsp;<span class="string" id="5387403">&#34;&#34;</span><span class="op" id="5387405">,</span>&nbsp;<span class="ident" id="5387407"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387408">.</span><span class="ident" id="5387409">Op</span>&nbsp;<span class="op" id="5387412">==</span>&nbsp;<span class="ident" id="5387415"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387421">.</span><span class="ident" id="5387422">InstMatch</span><span class="op" id="5387431">,</span>&nbsp;<span class="builtintype" id="5387433">uint32</span><span class="op" id="5387439">(</span><span class="ident" id="5387440"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387441">.</span><span class="ident" id="5387442">Start</span><span class="op" id="5387447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5387450">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387453"><a href="/regexp/onepass.go.html#5387268">pc</a></span>&nbsp;<span class="op" id="5387456">=</span>&nbsp;<span class="ident" id="5387458"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387459">.</span><span class="ident" id="5387460">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387465"><a href="/regexp/onepass.go.html#5387282">i</a></span>&nbsp;<span class="op" id="5387467">=</span>&nbsp;<span class="op" id="5387469">&amp;</span><span class="ident" id="5387470"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387471">.</span><span class="ident" id="5387472">Inst</span><span class="op" id="5387476">[</span><span class="ident" id="5387477"><a href="/regexp/onepass.go.html#5387268">pc</a></span><span class="op" id="5387479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387482">for</span>&nbsp;<span class="ident" id="5387486"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387487">.</span><span class="ident" id="5387488">Op</span>&nbsp;<span class="op" id="5387491">==</span>&nbsp;<span class="ident" id="5387494"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387500">.</span><span class="ident" id="5387501">InstNop</span>&nbsp;<span class="op" id="5387509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387513"><a href="/regexp/onepass.go.html#5387268">pc</a></span>&nbsp;<span class="op" id="5387516">=</span>&nbsp;<span class="ident" id="5387518"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387519">.</span><span class="ident" id="5387520">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387526"><a href="/regexp/onepass.go.html#5387282">i</a></span>&nbsp;<span class="op" id="5387528">=</span>&nbsp;<span class="op" id="5387530">&amp;</span><span class="ident" id="5387531"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387532">.</span><span class="ident" id="5387533">Inst</span><span class="op" id="5387537">[</span><span class="ident" id="5387538"><a href="/regexp/onepass.go.html#5387268">pc</a></span><span class="op" id="5387540">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5387543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5387546">//&nbsp;Avoid&nbsp;allocation&nbsp;of&nbsp;buffer&nbsp;if&nbsp;prefix&nbsp;is&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387597">if</span>&nbsp;<span class="ident" id="5387600"><a href="/regexp/onepass.go.html#5388593">iop</a></span><span class="op" id="5387603">(</span><span class="ident" id="5387604"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387605">)</span>&nbsp;<span class="op" id="5387607">!=</span>&nbsp;<span class="ident" id="5387610"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387616">.</span><span class="ident" id="5387617">InstRune</span>&nbsp;<span class="op" id="5387626">||</span>&nbsp;<span class="builtinfunc" id="5387629">len</span><span class="op" id="5387632">(</span><span class="ident" id="5387633"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387634">.</span><span class="ident" id="5387635">Rune</span><span class="op" id="5387639">)</span>&nbsp;<span class="op" id="5387641">!=</span>&nbsp;<span class="num" id="5387644">1</span>&nbsp;<span class="op" id="5387646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387650">return</span>&nbsp;<span class="string" id="5387657">&#34;&#34;</span><span class="op" id="5387659">,</span>&nbsp;<span class="ident" id="5387661"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387662">.</span><span class="ident" id="5387663">Op</span>&nbsp;<span class="op" id="5387666">==</span>&nbsp;<span class="ident" id="5387669"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387675">.</span><span class="ident" id="5387676">InstMatch</span><span class="op" id="5387685">,</span>&nbsp;<span class="builtintype" id="5387687">uint32</span><span class="op" id="5387693">(</span><span class="ident" id="5387694"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387695">.</span><span class="ident" id="5387696">Start</span><span class="op" id="5387701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5387704">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5387708">//&nbsp;Have&nbsp;prefix;&nbsp;gather&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387744">var</span>&nbsp;<span class="ident" id="5387748">buf</span>&nbsp;<span class="ident" id="5387752"><a href="/regexp/onepass.go.html#5386125">bytes</a></span><span class="op" id="5387757">.</span><span class="ident" id="5387758">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387766">for</span>&nbsp;<span class="ident" id="5387770"><a href="/regexp/onepass.go.html#5388593">iop</a></span><span class="op" id="5387773">(</span><span class="ident" id="5387774"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387775">)</span>&nbsp;<span class="op" id="5387777">==</span>&nbsp;<span class="ident" id="5387780"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387786">.</span><span class="ident" id="5387787">InstRune</span>&nbsp;<span class="op" id="5387796">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5387799">len</span><span class="op" id="5387802">(</span><span class="ident" id="5387803"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387804">.</span><span class="ident" id="5387805">Rune</span><span class="op" id="5387809">)</span>&nbsp;<span class="op" id="5387811">==</span>&nbsp;<span class="num" id="5387814">1</span>&nbsp;<span class="op" id="5387816">&amp;&amp;</span>&nbsp;<span class="ident" id="5387819"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387825">.</span><span class="ident" id="5387826">Flags</span><span class="op" id="5387831">(</span><span class="ident" id="5387832"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387833">.</span><span class="ident" id="5387834">Arg</span><span class="op" id="5387837">)</span><span class="op" id="5387838">&amp;</span><span class="ident" id="5387839"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387845">.</span><span class="ident" id="5387846">FoldCase</span>&nbsp;<span class="op" id="5387855">==</span>&nbsp;<span class="num" id="5387858">0</span>&nbsp;<span class="op" id="5387860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387864"><a href="/regexp/onepass.go.html#5387748">buf</a></span><span class="op" id="5387867">.</span><span class="ident" id="5387868">WriteRune</span><span class="op" id="5387877">(</span><span class="ident" id="5387878"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387879">.</span><span class="ident" id="5387880">Rune</span><span class="op" id="5387884">[</span><span class="num" id="5387885">0</span><span class="op" id="5387886">]</span><span class="op" id="5387887">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5387891"><a href="/regexp/onepass.go.html#5387268">pc</a></span><span class="op" id="5387893">,</span>&nbsp;<span class="ident" id="5387895"><a href="/regexp/onepass.go.html#5387282">i</a></span>&nbsp;<span class="op" id="5387897">=</span>&nbsp;<span class="ident" id="5387899"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387900">.</span><span class="ident" id="5387901">Out</span><span class="op" id="5387904">,</span>&nbsp;<span class="op" id="5387906">&amp;</span><span class="ident" id="5387907"><a href="/regexp/onepass.go.html#5387221">p</a></span><span class="op" id="5387908">.</span><span class="ident" id="5387909">Inst</span><span class="op" id="5387913">[</span><span class="ident" id="5387914"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387915">.</span><span class="ident" id="5387916">Out</span><span class="op" id="5387919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5387922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5387925">return</span>&nbsp;<span class="ident" id="5387932"><a href="/regexp/onepass.go.html#5387748">buf</a></span><span class="op" id="5387935">.</span><span class="ident" id="5387936">String</span><span class="op" id="5387942">(</span><span class="op" id="5387943">)</span><span class="op" id="5387944">,</span>&nbsp;<span class="ident" id="5387946"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387947">.</span><span class="ident" id="5387948">Op</span>&nbsp;<span class="op" id="5387951">==</span>&nbsp;<span class="ident" id="5387954"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387960">.</span><span class="ident" id="5387961">InstEmptyWidth</span>&nbsp;<span class="op" id="5387976">&amp;&amp;</span>&nbsp;<span class="op" id="5387979">(</span><span class="ident" id="5387980"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5387986">.</span><span class="ident" id="5387987">EmptyOp</span><span class="op" id="5387994">(</span><span class="ident" id="5387995"><a href="/regexp/onepass.go.html#5387282">i</a></span><span class="op" id="5387996">.</span><span class="ident" id="5387997">Arg</span><span class="op" id="5388000">)</span><span class="op" id="5388001">)</span><span class="op" id="5388002">&amp;</span><span class="ident" id="5388003"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388009">.</span><span class="ident" id="5388010">EmptyBeginText</span>&nbsp;<span class="op" id="5388025">!=</span>&nbsp;<span class="num" id="5388028">0</span><span class="op" id="5388029">,</span>&nbsp;<span class="ident" id="5388031"><a href="/regexp/onepass.go.html#5387268">pc</a></span><br>
<span class="lineno"></span><span class="op" id="5388034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5388037">//&nbsp;OnePassNext&nbsp;selects&nbsp;the&nbsp;next&nbsp;actionable&nbsp;state&nbsp;of&nbsp;the&nbsp;prog,&nbsp;based&nbsp;on&nbsp;the&nbsp;input&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5388129">//&nbsp;It&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstAlt&nbsp;or&nbsp;InstAltMatch,&nbsp;and&nbsp;from&nbsp;the&nbsp;one-pass&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5388226">//&nbsp;One&nbsp;of&nbsp;the&nbsp;alternates&nbsp;may&nbsp;ultimately&nbsp;lead&nbsp;without&nbsp;input&nbsp;to&nbsp;end&nbsp;of&nbsp;line.&nbsp;If&nbsp;the&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="5388320">//&nbsp;is&nbsp;InstAltMatch&nbsp;the&nbsp;path&nbsp;to&nbsp;the&nbsp;InstMatch&nbsp;is&nbsp;in&nbsp;i.Out,&nbsp;the&nbsp;normal&nbsp;node&nbsp;in&nbsp;i.Next.</span><br>
<span class="lineno"></span><span class="keyword" id="5388405">func</span>&nbsp;<span class="ident" id="5388410">onePassNext</span><span class="op" id="5388421">(</span><span class="ident" id="5388422">i</span>&nbsp;<span class="op" id="5388424">*</span><span class="ident" id="5388425"><a href="/regexp/onepass.go.html#5386876">onePassInst</a></span><span class="op" id="5388436">,</span>&nbsp;<span class="ident" id="5388438">r</span>&nbsp;<span class="builtintype" id="5388440">rune</span><span class="op" id="5388444">)</span>&nbsp;<span class="builtintype" id="5388446">uint32</span>&nbsp;<span class="op" id="5388453">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5388456">next</span>&nbsp;<span class="op" id="5388461">:=</span>&nbsp;<span class="ident" id="5388464"><a href="/regexp/onepass.go.html#5388422">i</a></span><span class="op" id="5388465">.</span><span class="ident" id="5388466">MatchRunePos</span><span class="op" id="5388478">(</span><span class="ident" id="5388479"><a href="/regexp/onepass.go.html#5388438">r</a></span><span class="op" id="5388480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388483">if</span>&nbsp;<span class="ident" id="5388486"><a href="/regexp/onepass.go.html#5388456">next</a></span>&nbsp;<span class="op" id="5388491">&gt;=</span>&nbsp;<span class="num" id="5388494">0</span>&nbsp;<span class="op" id="5388496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388500">return</span>&nbsp;<span class="ident" id="5388507"><a href="/regexp/onepass.go.html#5388422">i</a></span><span class="op" id="5388508">.</span><span class="ident" id="5388509">Next</span><span class="op" id="5388513">[</span><span class="ident" id="5388514"><a href="/regexp/onepass.go.html#5388456">next</a></span><span class="op" id="5388518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5388521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388524">if</span>&nbsp;<span class="ident" id="5388527"><a href="/regexp/onepass.go.html#5388422">i</a></span><span class="op" id="5388528">.</span><span class="ident" id="5388529">Op</span>&nbsp;<span class="op" id="5388532">==</span>&nbsp;<span class="ident" id="5388535"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388541">.</span><span class="ident" id="5388542">InstAltMatch</span>&nbsp;<span class="op" id="5388555">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388559">return</span>&nbsp;<span class="ident" id="5388566"><a href="/regexp/onepass.go.html#5388422">i</a></span><span class="op" id="5388567">.</span><span class="ident" id="5388568">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5388573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388576">return</span>&nbsp;<span class="num" id="5388583">0</span><br>
<span class="lineno"></span><span class="op" id="5388585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5388588">func</span>&nbsp;<span class="ident" id="5388593">iop</span><span class="op" id="5388596">(</span><span class="ident" id="5388597">i</span>&nbsp;<span class="op" id="5388599">*</span><span class="ident" id="5388600"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388606">.</span><span class="ident" id="5388607">Inst</span><span class="op" id="5388611">)</span>&nbsp;<span class="ident" id="5388613"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388619">.</span><span class="ident" id="5388620">InstOp</span>&nbsp;<span class="op" id="5388627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5388630">op</span>&nbsp;<span class="op" id="5388633">:=</span>&nbsp;<span class="ident" id="5388636"><a href="/regexp/onepass.go.html#5388597">i</a></span><span class="op" id="5388637">.</span><span class="ident" id="5388638">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388642">switch</span>&nbsp;<span class="ident" id="5388649"><a href="/regexp/onepass.go.html#5388630">op</a></span>&nbsp;<span class="op" id="5388652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388655">case</span>&nbsp;<span class="ident" id="5388660"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388666">.</span><span class="ident" id="5388667">InstRune1</span><span class="op" id="5388676">,</span>&nbsp;<span class="ident" id="5388678"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388684">.</span><span class="ident" id="5388685">InstRuneAny</span><span class="op" id="5388696">,</span>&nbsp;<span class="ident" id="5388698"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388704">.</span><span class="ident" id="5388705">InstRuneAnyNotNL</span><span class="op" id="5388721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5388725"><a href="/regexp/onepass.go.html#5388630">op</a></span>&nbsp;<span class="op" id="5388728">=</span>&nbsp;<span class="ident" id="5388730"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5388736">.</span><span class="ident" id="5388737">InstRune</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5388747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388750">return</span>&nbsp;<span class="ident" id="5388757"><a href="/regexp/onepass.go.html#5388630">op</a></span><br>
<span class="lineno"></span><span class="op" id="5388760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5388763">//&nbsp;Sparse&nbsp;Array&nbsp;implementation&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;queueOnePass.</span><br>
<span class="lineno">90</span><span class="keyword" id="5388821">type</span>&nbsp;<span class="ident" id="5388826">queueOnePass</span>&nbsp;<span class="keyword" id="5388839">struct</span>&nbsp;<span class="op" id="5388846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5388849">sparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5388865">[</span><span class="op" id="5388866">]</span><span class="builtintype" id="5388867">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5388875">dense</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5388891">[</span><span class="op" id="5388892">]</span><span class="builtintype" id="5388893">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5388901">size</span><span class="op" id="5388905">,</span>&nbsp;<span class="ident" id="5388907">nextIndex</span>&nbsp;<span class="builtintype" id="5388917">uint32</span><br>
<span class="lineno"></span><span class="op" id="5388924">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="5388927">func</span>&nbsp;<span class="op" id="5388932">(</span><span class="ident" id="5388933">q</span>&nbsp;<span class="op" id="5388935">*</span><span class="ident" id="5388936"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5388948">)</span>&nbsp;<span class="ident" id="5388950">empty</span><span class="op" id="5388955">(</span><span class="op" id="5388956">)</span>&nbsp;<span class="builtintype" id="5388958">bool</span>&nbsp;<span class="op" id="5388963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5388966">return</span>&nbsp;<span class="ident" id="5388973"><a href="/regexp/onepass.go.html#5388933">q</a></span><span class="op" id="5388974">.</span><span class="ident" id="5388975">nextIndex</span>&nbsp;<span class="op" id="5388985">&gt;=</span>&nbsp;<span class="ident" id="5388988"><a href="/regexp/onepass.go.html#5388933">q</a></span><span class="op" id="5388989">.</span><span class="ident" id="5388990">size</span><br>
<span class="lineno"></span><span class="op" id="5388995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5388998">func</span>&nbsp;<span class="op" id="5389003">(</span><span class="ident" id="5389004">q</span>&nbsp;<span class="op" id="5389006">*</span><span class="ident" id="5389007"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389019">)</span>&nbsp;<span class="ident" id="5389021">next</span><span class="op" id="5389025">(</span><span class="op" id="5389026">)</span>&nbsp;<span class="op" id="5389028">(</span><span class="ident" id="5389029">n</span>&nbsp;<span class="builtintype" id="5389031">uint32</span><span class="op" id="5389037">)</span>&nbsp;<span class="op" id="5389039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389042"><a href="/regexp/onepass.go.html#5389029">n</a></span>&nbsp;<span class="op" id="5389044">=</span>&nbsp;<span class="ident" id="5389046"><a href="/regexp/onepass.go.html#5389004">q</a></span><span class="op" id="5389047">.</span><span class="ident" id="5389048">dense</span><span class="op" id="5389053">[</span><span class="ident" id="5389054"><a href="/regexp/onepass.go.html#5389004">q</a></span><span class="op" id="5389055">.</span><span class="ident" id="5389056">nextIndex</span><span class="op" id="5389065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389068"><a href="/regexp/onepass.go.html#5389004">q</a></span><span class="op" id="5389069">.</span><span class="ident" id="5389070">nextIndex</span><span class="op" id="5389079">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389083">return</span><br>
<span class="lineno"></span><span class="op" id="5389090">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5389093">func</span>&nbsp;<span class="op" id="5389098">(</span><span class="ident" id="5389099">q</span>&nbsp;<span class="op" id="5389101">*</span><span class="ident" id="5389102"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389114">)</span>&nbsp;<span class="ident" id="5389116">clear</span><span class="op" id="5389121">(</span><span class="op" id="5389122">)</span>&nbsp;<span class="op" id="5389124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389127"><a href="/regexp/onepass.go.html#5389099">q</a></span><span class="op" id="5389128">.</span><span class="ident" id="5389129">size</span>&nbsp;<span class="op" id="5389134">=</span>&nbsp;<span class="num" id="5389136">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389139"><a href="/regexp/onepass.go.html#5389099">q</a></span><span class="op" id="5389140">.</span><span class="ident" id="5389141">nextIndex</span>&nbsp;<span class="op" id="5389151">=</span>&nbsp;<span class="num" id="5389153">0</span><br>
<span class="lineno"></span><span class="op" id="5389155">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="5389158">func</span>&nbsp;<span class="op" id="5389163">(</span><span class="ident" id="5389164">q</span>&nbsp;<span class="op" id="5389166">*</span><span class="ident" id="5389167"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389179">)</span>&nbsp;<span class="ident" id="5389181">reset</span><span class="op" id="5389186">(</span><span class="op" id="5389187">)</span>&nbsp;<span class="op" id="5389189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389192"><a href="/regexp/onepass.go.html#5389164">q</a></span><span class="op" id="5389193">.</span><span class="ident" id="5389194">nextIndex</span>&nbsp;<span class="op" id="5389204">=</span>&nbsp;<span class="num" id="5389206">0</span><br>
<span class="lineno"></span><span class="op" id="5389208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5389211">func</span>&nbsp;<span class="op" id="5389216">(</span><span class="ident" id="5389217">q</span>&nbsp;<span class="op" id="5389219">*</span><span class="ident" id="5389220"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389232">)</span>&nbsp;<span class="ident" id="5389234">contains</span><span class="op" id="5389242">(</span><span class="ident" id="5389243">u</span>&nbsp;<span class="builtintype" id="5389245">uint32</span><span class="op" id="5389251">)</span>&nbsp;<span class="builtintype" id="5389253">bool</span>&nbsp;<span class="op" id="5389258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389261">if</span>&nbsp;<span class="ident" id="5389264"><a href="/regexp/onepass.go.html#5389243">u</a></span>&nbsp;<span class="op" id="5389266">&gt;=</span>&nbsp;<span class="builtintype" id="5389269">uint32</span><span class="op" id="5389275">(</span><span class="builtinfunc" id="5389276">len</span><span class="op" id="5389279">(</span><span class="ident" id="5389280"><a href="/regexp/onepass.go.html#5389217">q</a></span><span class="op" id="5389281">.</span><span class="ident" id="5389282">sparse</span><span class="op" id="5389288">)</span><span class="op" id="5389289">)</span>&nbsp;<span class="op" id="5389291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389295">return</span>&nbsp;<span class="builtintype" id="5389302">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5389309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389312">return</span>&nbsp;<span class="ident" id="5389319"><a href="/regexp/onepass.go.html#5389217">q</a></span><span class="op" id="5389320">.</span><span class="ident" id="5389321">sparse</span><span class="op" id="5389327">[</span><span class="ident" id="5389328"><a href="/regexp/onepass.go.html#5389243">u</a></span><span class="op" id="5389329">]</span>&nbsp;<span class="op" id="5389331">&lt;</span>&nbsp;<span class="ident" id="5389333"><a href="/regexp/onepass.go.html#5389217">q</a></span><span class="op" id="5389334">.</span><span class="ident" id="5389335">size</span>&nbsp;<span class="op" id="5389340">&amp;&amp;</span>&nbsp;<span class="ident" id="5389343"><a href="/regexp/onepass.go.html#5389217">q</a></span><span class="op" id="5389344">.</span><span class="ident" id="5389345">dense</span><span class="op" id="5389350">[</span><span class="ident" id="5389351"><a href="/regexp/onepass.go.html#5389217">q</a></span><span class="op" id="5389352">.</span><span class="ident" id="5389353">sparse</span><span class="op" id="5389359">[</span><span class="ident" id="5389360"><a href="/regexp/onepass.go.html#5389243">u</a></span><span class="op" id="5389361">]</span><span class="op" id="5389362">]</span>&nbsp;<span class="op" id="5389364">==</span>&nbsp;<span class="ident" id="5389367"><a href="/regexp/onepass.go.html#5389243">u</a></span><br>
<span class="lineno">120</span><span class="op" id="5389369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5389372">func</span>&nbsp;<span class="op" id="5389377">(</span><span class="ident" id="5389378">q</span>&nbsp;<span class="op" id="5389380">*</span><span class="ident" id="5389381"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389393">)</span>&nbsp;<span class="ident" id="5389395">insert</span><span class="op" id="5389401">(</span><span class="ident" id="5389402">u</span>&nbsp;<span class="builtintype" id="5389404">uint32</span><span class="op" id="5389410">)</span>&nbsp;<span class="op" id="5389412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389415">if</span>&nbsp;<span class="op" id="5389418">!</span><span class="ident" id="5389419"><a href="/regexp/onepass.go.html#5389378">q</a></span><span class="op" id="5389420">.</span><span class="ident" id="5389421">contains</span><span class="op" id="5389429">(</span><span class="ident" id="5389430"><a href="/regexp/onepass.go.html#5389402">u</a></span><span class="op" id="5389431">)</span>&nbsp;<span class="op" id="5389433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389437"><a href="/regexp/onepass.go.html#5389378">q</a></span><span class="op" id="5389438">.</span><span class="ident" id="5389439">insertNew</span><span class="op" id="5389448">(</span><span class="ident" id="5389449"><a href="/regexp/onepass.go.html#5389402">u</a></span><span class="op" id="5389450">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5389453">}</span><br>
<span class="lineno"></span><span class="op" id="5389455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5389458">func</span>&nbsp;<span class="op" id="5389463">(</span><span class="ident" id="5389464">q</span>&nbsp;<span class="op" id="5389466">*</span><span class="ident" id="5389467"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389479">)</span>&nbsp;<span class="ident" id="5389481">insertNew</span><span class="op" id="5389490">(</span><span class="ident" id="5389491">u</span>&nbsp;<span class="builtintype" id="5389493">uint32</span><span class="op" id="5389499">)</span>&nbsp;<span class="op" id="5389501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389504">if</span>&nbsp;<span class="ident" id="5389507"><a href="/regexp/onepass.go.html#5389491">u</a></span>&nbsp;<span class="op" id="5389509">&gt;=</span>&nbsp;<span class="builtintype" id="5389512">uint32</span><span class="op" id="5389518">(</span><span class="builtinfunc" id="5389519">len</span><span class="op" id="5389522">(</span><span class="ident" id="5389523"><a href="/regexp/onepass.go.html#5389464">q</a></span><span class="op" id="5389524">.</span><span class="ident" id="5389525">sparse</span><span class="op" id="5389531">)</span><span class="op" id="5389532">)</span>&nbsp;<span class="op" id="5389534">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389538">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5389546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389549"><a href="/regexp/onepass.go.html#5389464">q</a></span><span class="op" id="5389550">.</span><span class="ident" id="5389551">sparse</span><span class="op" id="5389557">[</span><span class="ident" id="5389558"><a href="/regexp/onepass.go.html#5389491">u</a></span><span class="op" id="5389559">]</span>&nbsp;<span class="op" id="5389561">=</span>&nbsp;<span class="ident" id="5389563"><a href="/regexp/onepass.go.html#5389464">q</a></span><span class="op" id="5389564">.</span><span class="ident" id="5389565">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389571"><a href="/regexp/onepass.go.html#5389464">q</a></span><span class="op" id="5389572">.</span><span class="ident" id="5389573">dense</span><span class="op" id="5389578">[</span><span class="ident" id="5389579"><a href="/regexp/onepass.go.html#5389464">q</a></span><span class="op" id="5389580">.</span><span class="ident" id="5389581">size</span><span class="op" id="5389585">]</span>&nbsp;<span class="op" id="5389587">=</span>&nbsp;<span class="ident" id="5389589"><a href="/regexp/onepass.go.html#5389491">u</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389592"><a href="/regexp/onepass.go.html#5389464">q</a></span><span class="op" id="5389593">.</span><span class="ident" id="5389594">size</span><span class="op" id="5389598">++</span><br>
<span class="lineno">135</span><span class="op" id="5389601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5389604">func</span>&nbsp;<span class="ident" id="5389609">newQueue</span><span class="op" id="5389617">(</span><span class="ident" id="5389618">size</span>&nbsp;<span class="builtintype" id="5389623">int</span><span class="op" id="5389626">)</span>&nbsp;<span class="op" id="5389628">(</span><span class="ident" id="5389629">q</span>&nbsp;<span class="op" id="5389631">*</span><span class="ident" id="5389632"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389644">)</span>&nbsp;<span class="op" id="5389646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5389649">return</span>&nbsp;<span class="op" id="5389656">&amp;</span><span class="ident" id="5389657"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5389669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389673">sparse</span><span class="op" id="5389679">:</span>&nbsp;<span class="builtinfunc" id="5389681">make</span><span class="op" id="5389685">(</span><span class="op" id="5389686">[</span><span class="op" id="5389687">]</span><span class="builtintype" id="5389688">uint32</span><span class="op" id="5389694">,</span>&nbsp;<span class="ident" id="5389696"><a href="/regexp/onepass.go.html#5389618">size</a></span><span class="op" id="5389700">)</span><span class="op" id="5389701">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5389705">dense</span><span class="op" id="5389710">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="5389713">make</span><span class="op" id="5389717">(</span><span class="op" id="5389718">[</span><span class="op" id="5389719">]</span><span class="builtintype" id="5389720">uint32</span><span class="op" id="5389726">,</span>&nbsp;<span class="ident" id="5389728"><a href="/regexp/onepass.go.html#5389618">size</a></span><span class="op" id="5389732">)</span><span class="op" id="5389733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5389736">}</span><br>
<span class="lineno"></span><span class="op" id="5389738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5389741">//&nbsp;mergeRuneSets&nbsp;merges&nbsp;two&nbsp;non-intersecting&nbsp;runesets,&nbsp;and&nbsp;returns&nbsp;the&nbsp;merged&nbsp;result,</span><br>
<span class="lineno">145</span><span class="comment" id="5389827">//&nbsp;and&nbsp;a&nbsp;NextIp&nbsp;array.&nbsp;The&nbsp;idea&nbsp;is&nbsp;that&nbsp;if&nbsp;a&nbsp;rune&nbsp;matches&nbsp;the&nbsp;OnePassRunes&nbsp;at&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="5389911">//&nbsp;i,&nbsp;NextIp[i/2]&nbsp;is&nbsp;the&nbsp;target.&nbsp;If&nbsp;the&nbsp;input&nbsp;sets&nbsp;intersect,&nbsp;an&nbsp;empty&nbsp;runeset&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5389996">//&nbsp;NextIp&nbsp;array&nbsp;with&nbsp;the&nbsp;single&nbsp;element&nbsp;mergeFailed&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5390061">//&nbsp;The&nbsp;code&nbsp;assumes&nbsp;that&nbsp;both&nbsp;inputs&nbsp;contain&nbsp;ordered&nbsp;and&nbsp;non-intersecting&nbsp;rune&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="keyword" id="5390147">const</span>&nbsp;<span class="ident" id="5390153">mergeFailed</span>&nbsp;<span class="op" id="5390165">=</span>&nbsp;<span class="builtintype" id="5390167">uint32</span><span class="op" id="5390173">(</span><span class="num" id="5390174">0xffffffff</span><span class="op" id="5390184">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5390187">var</span>&nbsp;<span class="op" id="5390191">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390194">noRune</span>&nbsp;<span class="op" id="5390201">=</span>&nbsp;<span class="op" id="5390203">[</span><span class="op" id="5390204">]</span><span class="builtintype" id="5390205">rune</span><span class="op" id="5390209">{</span><span class="op" id="5390210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390213">noNext</span>&nbsp;<span class="op" id="5390220">=</span>&nbsp;<span class="op" id="5390222">[</span><span class="op" id="5390223">]</span><span class="builtintype" id="5390224">uint32</span><span class="op" id="5390230">{</span><span class="ident" id="5390231"><a href="/regexp/onepass.go.html#5390153">mergeFailed</a></span><span class="op" id="5390242">}</span><br>
<span class="lineno"></span><span class="op" id="5390244">)</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5390247">func</span>&nbsp;<span class="ident" id="5390252">mergeRuneSets</span><span class="op" id="5390265">(</span><span class="ident" id="5390266">leftRunes</span><span class="op" id="5390275">,</span>&nbsp;<span class="ident" id="5390277">rightRunes</span>&nbsp;<span class="op" id="5390288">*</span><span class="op" id="5390289">[</span><span class="op" id="5390290">]</span><span class="builtintype" id="5390291">rune</span><span class="op" id="5390295">,</span>&nbsp;<span class="ident" id="5390297">leftPC</span><span class="op" id="5390303">,</span>&nbsp;<span class="ident" id="5390305">rightPC</span>&nbsp;<span class="builtintype" id="5390313">uint32</span><span class="op" id="5390319">)</span>&nbsp;<span class="op" id="5390321">(</span><span class="op" id="5390322">[</span><span class="op" id="5390323">]</span><span class="builtintype" id="5390324">rune</span><span class="op" id="5390328">,</span>&nbsp;<span class="op" id="5390330">[</span><span class="op" id="5390331">]</span><span class="builtintype" id="5390332">uint32</span><span class="op" id="5390338">)</span>&nbsp;<span class="op" id="5390340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390343">leftLen</span>&nbsp;<span class="op" id="5390351">:=</span>&nbsp;<span class="builtinfunc" id="5390354">len</span><span class="op" id="5390357">(</span><span class="op" id="5390358">*</span><span class="ident" id="5390359"><a href="/regexp/onepass.go.html#5390266">leftRunes</a></span><span class="op" id="5390368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390371">rightLen</span>&nbsp;<span class="op" id="5390380">:=</span>&nbsp;<span class="builtinfunc" id="5390383">len</span><span class="op" id="5390386">(</span><span class="op" id="5390387">*</span><span class="ident" id="5390388"><a href="/regexp/onepass.go.html#5390277">rightRunes</a></span><span class="op" id="5390398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390401">if</span>&nbsp;<span class="ident" id="5390404"><a href="/regexp/onepass.go.html#5390343">leftLen</a></span><span class="op" id="5390411">&amp;</span><span class="num" id="5390412">0x1</span>&nbsp;<span class="op" id="5390416">!=</span>&nbsp;<span class="num" id="5390419">0</span>&nbsp;<span class="op" id="5390421">||</span>&nbsp;<span class="ident" id="5390424"><a href="/regexp/onepass.go.html#5390371">rightLen</a></span><span class="op" id="5390432">&amp;</span><span class="num" id="5390433">0x1</span>&nbsp;<span class="op" id="5390437">!=</span>&nbsp;<span class="num" id="5390440">0</span>&nbsp;<span class="op" id="5390442">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5390446">panic</span><span class="op" id="5390451">(</span><span class="string" id="5390452">&#34;mergeRuneSets&nbsp;odd&nbsp;length&nbsp;[]rune&#34;</span><span class="op" id="5390485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390491">var</span>&nbsp;<span class="op" id="5390495">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390499">lx</span><span class="op" id="5390501">,</span>&nbsp;<span class="ident" id="5390503">rx</span>&nbsp;<span class="builtintype" id="5390506">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390511">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390514">merged</span>&nbsp;<span class="op" id="5390521">:=</span>&nbsp;<span class="builtinfunc" id="5390524">make</span><span class="op" id="5390528">(</span><span class="op" id="5390529">[</span><span class="op" id="5390530">]</span><span class="builtintype" id="5390531">rune</span><span class="op" id="5390535">,</span>&nbsp;<span class="num" id="5390537">0</span><span class="op" id="5390538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390541">next</span>&nbsp;<span class="op" id="5390546">:=</span>&nbsp;<span class="builtinfunc" id="5390549">make</span><span class="op" id="5390553">(</span><span class="op" id="5390554">[</span><span class="op" id="5390555">]</span><span class="builtintype" id="5390556">uint32</span><span class="op" id="5390562">,</span>&nbsp;<span class="num" id="5390564">0</span><span class="op" id="5390565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390568">ok</span>&nbsp;<span class="op" id="5390571">:=</span>&nbsp;<span class="builtintype" id="5390574">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390580">defer</span>&nbsp;<span class="keyword" id="5390586">func</span><span class="op" id="5390590">(</span><span class="op" id="5390591">)</span>&nbsp;<span class="op" id="5390593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390597">if</span>&nbsp;<span class="op" id="5390600">!</span><span class="ident" id="5390601"><a href="/regexp/onepass.go.html#5390568">ok</a></span>&nbsp;<span class="op" id="5390604">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390609"><a href="/regexp/onepass.go.html#5390514">merged</a></span>&nbsp;<span class="op" id="5390616">=</span>&nbsp;<span class="ident" id="5390618">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390625"><a href="/regexp/onepass.go.html#5390541">next</a></span>&nbsp;<span class="op" id="5390630">=</span>&nbsp;<span class="ident" id="5390632">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390641">}</span><span class="op" id="5390642">(</span><span class="op" id="5390643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390647">ix</span>&nbsp;<span class="op" id="5390650">:=</span>&nbsp;<span class="op" id="5390653">-</span><span class="num" id="5390654">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390657">extend</span>&nbsp;<span class="op" id="5390664">:=</span>&nbsp;<span class="keyword" id="5390667">func</span><span class="op" id="5390671">(</span><span class="ident" id="5390672">newLow</span>&nbsp;<span class="op" id="5390679">*</span><span class="builtintype" id="5390680">int</span><span class="op" id="5390683">,</span>&nbsp;<span class="ident" id="5390685">newArray</span>&nbsp;<span class="op" id="5390694">*</span><span class="op" id="5390695">[</span><span class="op" id="5390696">]</span><span class="builtintype" id="5390697">rune</span><span class="op" id="5390701">,</span>&nbsp;<span class="ident" id="5390703">pc</span>&nbsp;<span class="builtintype" id="5390706">uint32</span><span class="op" id="5390712">)</span>&nbsp;<span class="builtintype" id="5390714">bool</span>&nbsp;<span class="op" id="5390719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390723">if</span>&nbsp;<span class="ident" id="5390726"><a href="/regexp/onepass.go.html#5390647">ix</a></span>&nbsp;<span class="op" id="5390729">&gt;</span>&nbsp;<span class="num" id="5390731">0</span>&nbsp;<span class="op" id="5390733">&amp;&amp;</span>&nbsp;<span class="op" id="5390736">(</span><span class="op" id="5390737">*</span><span class="ident" id="5390738"><a href="/regexp/onepass.go.html#5390685">newArray</a></span><span class="op" id="5390746">)</span><span class="op" id="5390747">[</span><span class="op" id="5390748">*</span><span class="ident" id="5390749"><a href="/regexp/onepass.go.html#5390672">newLow</a></span><span class="op" id="5390755">]</span>&nbsp;<span class="op" id="5390757">&lt;=</span>&nbsp;<span class="ident" id="5390760"><a href="/regexp/onepass.go.html#5390514">merged</a></span><span class="op" id="5390766">[</span><span class="ident" id="5390767"><a href="/regexp/onepass.go.html#5390647">ix</a></span><span class="op" id="5390769">]</span>&nbsp;<span class="op" id="5390771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390776">return</span>&nbsp;<span class="builtintype" id="5390783">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390791">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390795"><a href="/regexp/onepass.go.html#5390514">merged</a></span>&nbsp;<span class="op" id="5390802">=</span>&nbsp;<span class="builtinfunc" id="5390804">append</span><span class="op" id="5390810">(</span><span class="ident" id="5390811"><a href="/regexp/onepass.go.html#5390514">merged</a></span><span class="op" id="5390817">,</span>&nbsp;<span class="op" id="5390819">(</span><span class="op" id="5390820">*</span><span class="ident" id="5390821"><a href="/regexp/onepass.go.html#5390685">newArray</a></span><span class="op" id="5390829">)</span><span class="op" id="5390830">[</span><span class="op" id="5390831">*</span><span class="ident" id="5390832"><a href="/regexp/onepass.go.html#5390672">newLow</a></span><span class="op" id="5390838">]</span><span class="op" id="5390839">,</span>&nbsp;<span class="op" id="5390841">(</span><span class="op" id="5390842">*</span><span class="ident" id="5390843"><a href="/regexp/onepass.go.html#5390685">newArray</a></span><span class="op" id="5390851">)</span><span class="op" id="5390852">[</span><span class="op" id="5390853">*</span><span class="ident" id="5390854"><a href="/regexp/onepass.go.html#5390672">newLow</a></span><span class="op" id="5390860">+</span><span class="num" id="5390861">1</span><span class="op" id="5390862">]</span><span class="op" id="5390863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390867">*</span><span class="ident" id="5390868"><a href="/regexp/onepass.go.html#5390672">newLow</a></span>&nbsp;<span class="op" id="5390875">+=</span>&nbsp;<span class="num" id="5390878">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390882"><a href="/regexp/onepass.go.html#5390647">ix</a></span>&nbsp;<span class="op" id="5390885">+=</span>&nbsp;<span class="num" id="5390888">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5390892"><a href="/regexp/onepass.go.html#5390541">next</a></span>&nbsp;<span class="op" id="5390897">=</span>&nbsp;<span class="builtinfunc" id="5390899">append</span><span class="op" id="5390905">(</span><span class="ident" id="5390906"><a href="/regexp/onepass.go.html#5390541">next</a></span><span class="op" id="5390910">,</span>&nbsp;<span class="ident" id="5390912"><a href="/regexp/onepass.go.html#5390703">pc</a></span><span class="op" id="5390914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390918">return</span>&nbsp;<span class="builtintype" id="5390925">true</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5390931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390935">for</span>&nbsp;<span class="ident" id="5390939"><a href="/regexp/onepass.go.html#5390499">lx</a></span>&nbsp;<span class="op" id="5390942">&lt;</span>&nbsp;<span class="ident" id="5390944"><a href="/regexp/onepass.go.html#5390343">leftLen</a></span>&nbsp;<span class="op" id="5390952">||</span>&nbsp;<span class="ident" id="5390955"><a href="/regexp/onepass.go.html#5390503">rx</a></span>&nbsp;<span class="op" id="5390958">&lt;</span>&nbsp;<span class="ident" id="5390960"><a href="/regexp/onepass.go.html#5390371">rightLen</a></span>&nbsp;<span class="op" id="5390969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390973">switch</span>&nbsp;<span class="op" id="5390980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5390984">case</span>&nbsp;<span class="ident" id="5390989"><a href="/regexp/onepass.go.html#5390503">rx</a></span>&nbsp;<span class="op" id="5390992">&gt;=</span>&nbsp;<span class="ident" id="5390995"><a href="/regexp/onepass.go.html#5390371">rightLen</a></span><span class="op" id="5391003">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391008"><a href="/regexp/onepass.go.html#5390568">ok</a></span>&nbsp;<span class="op" id="5391011">=</span>&nbsp;<span class="ident" id="5391013"><a href="/regexp/onepass.go.html#5390657">extend</a></span><span class="op" id="5391019">(</span><span class="op" id="5391020">&amp;</span><span class="ident" id="5391021"><a href="/regexp/onepass.go.html#5390499">lx</a></span><span class="op" id="5391023">,</span>&nbsp;<span class="ident" id="5391025"><a href="/regexp/onepass.go.html#5390266">leftRunes</a></span><span class="op" id="5391034">,</span>&nbsp;<span class="ident" id="5391036"><a href="/regexp/onepass.go.html#5390297">leftPC</a></span><span class="op" id="5391042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391046">case</span>&nbsp;<span class="ident" id="5391051"><a href="/regexp/onepass.go.html#5390499">lx</a></span>&nbsp;<span class="op" id="5391054">&gt;=</span>&nbsp;<span class="ident" id="5391057"><a href="/regexp/onepass.go.html#5390343">leftLen</a></span><span class="op" id="5391064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391069"><a href="/regexp/onepass.go.html#5390568">ok</a></span>&nbsp;<span class="op" id="5391072">=</span>&nbsp;<span class="ident" id="5391074"><a href="/regexp/onepass.go.html#5390657">extend</a></span><span class="op" id="5391080">(</span><span class="op" id="5391081">&amp;</span><span class="ident" id="5391082"><a href="/regexp/onepass.go.html#5390503">rx</a></span><span class="op" id="5391084">,</span>&nbsp;<span class="ident" id="5391086"><a href="/regexp/onepass.go.html#5390277">rightRunes</a></span><span class="op" id="5391096">,</span>&nbsp;<span class="ident" id="5391098"><a href="/regexp/onepass.go.html#5390305">rightPC</a></span><span class="op" id="5391105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391109">case</span>&nbsp;<span class="op" id="5391114">(</span><span class="op" id="5391115">*</span><span class="ident" id="5391116"><a href="/regexp/onepass.go.html#5390277">rightRunes</a></span><span class="op" id="5391126">)</span><span class="op" id="5391127">[</span><span class="ident" id="5391128"><a href="/regexp/onepass.go.html#5390503">rx</a></span><span class="op" id="5391130">]</span>&nbsp;<span class="op" id="5391132">&lt;</span>&nbsp;<span class="op" id="5391134">(</span><span class="op" id="5391135">*</span><span class="ident" id="5391136"><a href="/regexp/onepass.go.html#5390266">leftRunes</a></span><span class="op" id="5391145">)</span><span class="op" id="5391146">[</span><span class="ident" id="5391147"><a href="/regexp/onepass.go.html#5390499">lx</a></span><span class="op" id="5391149">]</span><span class="op" id="5391150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391155"><a href="/regexp/onepass.go.html#5390568">ok</a></span>&nbsp;<span class="op" id="5391158">=</span>&nbsp;<span class="ident" id="5391160"><a href="/regexp/onepass.go.html#5390657">extend</a></span><span class="op" id="5391166">(</span><span class="op" id="5391167">&amp;</span><span class="ident" id="5391168"><a href="/regexp/onepass.go.html#5390503">rx</a></span><span class="op" id="5391170">,</span>&nbsp;<span class="ident" id="5391172"><a href="/regexp/onepass.go.html#5390277">rightRunes</a></span><span class="op" id="5391182">,</span>&nbsp;<span class="ident" id="5391184"><a href="/regexp/onepass.go.html#5390305">rightPC</a></span><span class="op" id="5391191">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391195">default</span><span class="op" id="5391202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391207"><a href="/regexp/onepass.go.html#5390568">ok</a></span>&nbsp;<span class="op" id="5391210">=</span>&nbsp;<span class="ident" id="5391212"><a href="/regexp/onepass.go.html#5390657">extend</a></span><span class="op" id="5391218">(</span><span class="op" id="5391219">&amp;</span><span class="ident" id="5391220"><a href="/regexp/onepass.go.html#5390499">lx</a></span><span class="op" id="5391222">,</span>&nbsp;<span class="ident" id="5391224"><a href="/regexp/onepass.go.html#5390266">leftRunes</a></span><span class="op" id="5391233">,</span>&nbsp;<span class="ident" id="5391235"><a href="/regexp/onepass.go.html#5390297">leftPC</a></span><span class="op" id="5391241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5391245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391249">if</span>&nbsp;<span class="op" id="5391252">!</span><span class="ident" id="5391253"><a href="/regexp/onepass.go.html#5390568">ok</a></span>&nbsp;<span class="op" id="5391256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391261">return</span>&nbsp;<span class="ident" id="5391268"><a href="/regexp/onepass.go.html#5390194">noRune</a></span><span class="op" id="5391274">,</span>&nbsp;<span class="ident" id="5391276"><a href="/regexp/onepass.go.html#5390213">noNext</a></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5391285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5391288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391291">return</span>&nbsp;<span class="ident" id="5391298"><a href="/regexp/onepass.go.html#5390514">merged</a></span><span class="op" id="5391304">,</span>&nbsp;<span class="ident" id="5391306"><a href="/regexp/onepass.go.html#5390541">next</a></span><br>
<span class="lineno"></span><span class="op" id="5391311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5391314">//&nbsp;cleanupOnePass&nbsp;drops&nbsp;working&nbsp;memory,&nbsp;and&nbsp;restores&nbsp;certain&nbsp;shortcut&nbsp;instructions.</span><br>
<span class="lineno"></span><span class="keyword" id="5391398">func</span>&nbsp;<span class="ident" id="5391403">cleanupOnePass</span><span class="op" id="5391417">(</span><span class="ident" id="5391418">prog</span>&nbsp;<span class="op" id="5391423">*</span><span class="ident" id="5391424"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span><span class="op" id="5391435">,</span>&nbsp;<span class="ident" id="5391437">original</span>&nbsp;<span class="op" id="5391446">*</span><span class="ident" id="5391447"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391453">.</span><span class="ident" id="5391454">Prog</span><span class="op" id="5391458">)</span>&nbsp;<span class="op" id="5391460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391463">for</span>&nbsp;<span class="ident" id="5391467">ix</span><span class="op" id="5391469">,</span>&nbsp;<span class="ident" id="5391471">instOriginal</span>&nbsp;<span class="op" id="5391484">:=</span>&nbsp;<span class="keyword" id="5391487">range</span>&nbsp;<span class="ident" id="5391493"><a href="/regexp/onepass.go.html#5391437">original</a></span><span class="op" id="5391501">.</span><span class="ident" id="5391502">Inst</span>&nbsp;<span class="op" id="5391507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391511">switch</span>&nbsp;<span class="ident" id="5391518"><a href="/regexp/onepass.go.html#5391471">instOriginal</a></span><span class="op" id="5391530">.</span><span class="ident" id="5391531">Op</span>&nbsp;<span class="op" id="5391534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391538">case</span>&nbsp;<span class="ident" id="5391543"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391549">.</span><span class="ident" id="5391550">InstAlt</span><span class="op" id="5391557">,</span>&nbsp;<span class="ident" id="5391559"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391565">.</span><span class="ident" id="5391566">InstAltMatch</span><span class="op" id="5391578">,</span>&nbsp;<span class="ident" id="5391580"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391586">.</span><span class="ident" id="5391587">InstRune</span><span class="op" id="5391595">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391599">case</span>&nbsp;<span class="ident" id="5391604"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391610">.</span><span class="ident" id="5391611">InstCapture</span><span class="op" id="5391622">,</span>&nbsp;<span class="ident" id="5391624"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391630">.</span><span class="ident" id="5391631">InstEmptyWidth</span><span class="op" id="5391645">,</span>&nbsp;<span class="ident" id="5391647"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391653">.</span><span class="ident" id="5391654">InstNop</span><span class="op" id="5391661">,</span>&nbsp;<span class="ident" id="5391663"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391669">.</span><span class="ident" id="5391670">InstMatch</span><span class="op" id="5391679">,</span>&nbsp;<span class="ident" id="5391681"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391687">.</span><span class="ident" id="5391688">InstFail</span><span class="op" id="5391696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391701"><a href="/regexp/onepass.go.html#5391418">prog</a></span><span class="op" id="5391705">.</span><span class="ident" id="5391706">Inst</span><span class="op" id="5391710">[</span><span class="ident" id="5391711"><a href="/regexp/onepass.go.html#5391467">ix</a></span><span class="op" id="5391713">]</span><span class="op" id="5391714">.</span><span class="ident" id="5391715">Next</span>&nbsp;<span class="op" id="5391720">=</span>&nbsp;<span class="ident" id="5391722">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5391728">case</span>&nbsp;<span class="ident" id="5391733"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391739">.</span><span class="ident" id="5391740">InstRune1</span><span class="op" id="5391749">,</span>&nbsp;<span class="ident" id="5391751"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391757">.</span><span class="ident" id="5391758">InstRuneAny</span><span class="op" id="5391769">,</span>&nbsp;<span class="ident" id="5391771"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391777">.</span><span class="ident" id="5391778">InstRuneAnyNotNL</span><span class="op" id="5391794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391799"><a href="/regexp/onepass.go.html#5391418">prog</a></span><span class="op" id="5391803">.</span><span class="ident" id="5391804">Inst</span><span class="op" id="5391808">[</span><span class="ident" id="5391809"><a href="/regexp/onepass.go.html#5391467">ix</a></span><span class="op" id="5391811">]</span><span class="op" id="5391812">.</span><span class="ident" id="5391813">Next</span>&nbsp;<span class="op" id="5391818">=</span>&nbsp;<span class="ident" id="5391820">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391827"><a href="/regexp/onepass.go.html#5391418">prog</a></span><span class="op" id="5391831">.</span><span class="ident" id="5391832">Inst</span><span class="op" id="5391836">[</span><span class="ident" id="5391837"><a href="/regexp/onepass.go.html#5391467">ix</a></span><span class="op" id="5391839">]</span>&nbsp;<span class="op" id="5391841">=</span>&nbsp;<span class="ident" id="5391843"><a href="/regexp/onepass.go.html#5386876">onePassInst</a></span><span class="op" id="5391854">{</span><span class="ident" id="5391855">Inst</span><span class="op" id="5391859">:</span>&nbsp;<span class="ident" id="5391861"><a href="/regexp/onepass.go.html#5391471">instOriginal</a></span><span class="op" id="5391873">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5391877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5391880">}</span><br>
<span class="lineno"></span><span class="op" id="5391882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5391885">//&nbsp;onePassCopy&nbsp;creates&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;original&nbsp;Prog,&nbsp;as&nbsp;we&#39;ll&nbsp;be&nbsp;modifying&nbsp;it</span><br>
<span class="lineno">220</span><span class="keyword" id="5391962">func</span>&nbsp;<span class="ident" id="5391967">onePassCopy</span><span class="op" id="5391978">(</span><span class="ident" id="5391979">prog</span>&nbsp;<span class="op" id="5391984">*</span><span class="ident" id="5391985"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5391991">.</span><span class="ident" id="5391992">Prog</span><span class="op" id="5391996">)</span>&nbsp;<span class="op" id="5391998">*</span><span class="ident" id="5391999"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span>&nbsp;<span class="op" id="5392011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392014">p</span>&nbsp;<span class="op" id="5392016">:=</span>&nbsp;<span class="op" id="5392019">&amp;</span><span class="ident" id="5392020"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span><span class="op" id="5392031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392035">Start</span><span class="op" id="5392040">:</span>&nbsp;&nbsp;<span class="ident" id="5392043"><a href="/regexp/onepass.go.html#5391979">prog</a></span><span class="op" id="5392047">.</span><span class="ident" id="5392048">Start</span><span class="op" id="5392053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392057">NumCap</span><span class="op" id="5392063">:</span>&nbsp;<span class="ident" id="5392065"><a href="/regexp/onepass.go.html#5391979">prog</a></span><span class="op" id="5392069">.</span><span class="ident" id="5392070">NumCap</span><span class="op" id="5392076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392079">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392082">for</span>&nbsp;<span class="ident" id="5392086">_</span><span class="op" id="5392087">,</span>&nbsp;<span class="ident" id="5392089">inst</span>&nbsp;<span class="op" id="5392094">:=</span>&nbsp;<span class="keyword" id="5392097">range</span>&nbsp;<span class="ident" id="5392103"><a href="/regexp/onepass.go.html#5391979">prog</a></span><span class="op" id="5392107">.</span><span class="ident" id="5392108">Inst</span>&nbsp;<span class="op" id="5392113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392117"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392118">.</span><span class="ident" id="5392119">Inst</span>&nbsp;<span class="op" id="5392124">=</span>&nbsp;<span class="builtinfunc" id="5392126">append</span><span class="op" id="5392132">(</span><span class="ident" id="5392133"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392134">.</span><span class="ident" id="5392135">Inst</span><span class="op" id="5392139">,</span>&nbsp;<span class="ident" id="5392141"><a href="/regexp/onepass.go.html#5386876">onePassInst</a></span><span class="op" id="5392152">{</span><span class="ident" id="5392153">Inst</span><span class="op" id="5392157">:</span>&nbsp;<span class="ident" id="5392159"><a href="/regexp/onepass.go.html#5392089">inst</a></span><span class="op" id="5392163">}</span><span class="op" id="5392164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392171">//&nbsp;rewrites&nbsp;one&nbsp;or&nbsp;more&nbsp;common&nbsp;Prog&nbsp;constructs&nbsp;that&nbsp;enable&nbsp;some&nbsp;otherwise</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392246">//&nbsp;non-onepass&nbsp;Progs&nbsp;to&nbsp;be&nbsp;onepass.&nbsp;A:BD&nbsp;(for&nbsp;example)&nbsp;means&nbsp;an&nbsp;InstAlt&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392322">//&nbsp;ip&nbsp;A,&nbsp;that&nbsp;points&nbsp;to&nbsp;ips&nbsp;B&nbsp;&amp;&nbsp;C.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392358">//&nbsp;A:BC&nbsp;+&nbsp;B:DA&nbsp;=&gt;&nbsp;A:BC&nbsp;+&nbsp;B:CD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392389">//&nbsp;A:BC&nbsp;+&nbsp;B:DC&nbsp;=&gt;&nbsp;A:DC&nbsp;+&nbsp;B:DC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392420">for</span>&nbsp;<span class="ident" id="5392424">pc</span>&nbsp;<span class="op" id="5392427">:=</span>&nbsp;<span class="keyword" id="5392430">range</span>&nbsp;<span class="ident" id="5392436"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392437">.</span><span class="ident" id="5392438">Inst</span>&nbsp;<span class="op" id="5392443">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392447">switch</span>&nbsp;<span class="ident" id="5392454"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392455">.</span><span class="ident" id="5392456">Inst</span><span class="op" id="5392460">[</span><span class="ident" id="5392461"><a href="/regexp/onepass.go.html#5392424">pc</a></span><span class="op" id="5392463">]</span><span class="op" id="5392464">.</span><span class="ident" id="5392465">Op</span>&nbsp;<span class="op" id="5392468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392472">default</span><span class="op" id="5392479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392484">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392495">case</span>&nbsp;<span class="ident" id="5392500"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5392506">.</span><span class="ident" id="5392507">InstAlt</span><span class="op" id="5392514">,</span>&nbsp;<span class="ident" id="5392516"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5392522">.</span><span class="ident" id="5392523">InstAltMatch</span><span class="op" id="5392535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392540">//&nbsp;A:Bx&nbsp;+&nbsp;B:Ay</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392558">p_A_Other</span>&nbsp;<span class="op" id="5392568">:=</span>&nbsp;<span class="op" id="5392571">&amp;</span><span class="ident" id="5392572"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392573">.</span><span class="ident" id="5392574">Inst</span><span class="op" id="5392578">[</span><span class="ident" id="5392579"><a href="/regexp/onepass.go.html#5392424">pc</a></span><span class="op" id="5392581">]</span><span class="op" id="5392582">.</span><span class="ident" id="5392583">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392590">p_A_Alt</span>&nbsp;<span class="op" id="5392598">:=</span>&nbsp;<span class="op" id="5392601">&amp;</span><span class="ident" id="5392602"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392603">.</span><span class="ident" id="5392604">Inst</span><span class="op" id="5392608">[</span><span class="ident" id="5392609"><a href="/regexp/onepass.go.html#5392424">pc</a></span><span class="op" id="5392611">]</span><span class="op" id="5392612">.</span><span class="ident" id="5392613">Arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392620">//&nbsp;make&nbsp;sure&nbsp;a&nbsp;target&nbsp;is&nbsp;another&nbsp;Alt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392660">instAlt</span>&nbsp;<span class="op" id="5392668">:=</span>&nbsp;<span class="ident" id="5392671"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392672">.</span><span class="ident" id="5392673">Inst</span><span class="op" id="5392677">[</span><span class="op" id="5392678">*</span><span class="ident" id="5392679"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span><span class="op" id="5392686">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392691">if</span>&nbsp;<span class="op" id="5392694">!</span><span class="op" id="5392695">(</span><span class="ident" id="5392696"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span><span class="op" id="5392703">.</span><span class="ident" id="5392704">Op</span>&nbsp;<span class="op" id="5392707">==</span>&nbsp;<span class="ident" id="5392710"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5392716">.</span><span class="ident" id="5392717">InstAlt</span>&nbsp;<span class="op" id="5392725">||</span>&nbsp;<span class="ident" id="5392728"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span><span class="op" id="5392735">.</span><span class="ident" id="5392736">Op</span>&nbsp;<span class="op" id="5392739">==</span>&nbsp;<span class="ident" id="5392742"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5392748">.</span><span class="ident" id="5392749">InstAltMatch</span><span class="op" id="5392761">)</span>&nbsp;<span class="op" id="5392763">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392769"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span><span class="op" id="5392776">,</span>&nbsp;<span class="ident" id="5392778"><a href="/regexp/onepass.go.html#5392558">p_A_Other</a></span>&nbsp;<span class="op" id="5392788">=</span>&nbsp;<span class="ident" id="5392790"><a href="/regexp/onepass.go.html#5392558">p_A_Other</a></span><span class="op" id="5392799">,</span>&nbsp;<span class="ident" id="5392801"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392813"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span>&nbsp;<span class="op" id="5392821">=</span>&nbsp;<span class="ident" id="5392823"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392824">.</span><span class="ident" id="5392825">Inst</span><span class="op" id="5392829">[</span><span class="op" id="5392830">*</span><span class="ident" id="5392831"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span><span class="op" id="5392838">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392844">if</span>&nbsp;<span class="op" id="5392847">!</span><span class="op" id="5392848">(</span><span class="ident" id="5392849"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span><span class="op" id="5392856">.</span><span class="ident" id="5392857">Op</span>&nbsp;<span class="op" id="5392860">==</span>&nbsp;<span class="ident" id="5392863"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5392869">.</span><span class="ident" id="5392870">InstAlt</span>&nbsp;<span class="op" id="5392878">||</span>&nbsp;<span class="ident" id="5392881"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span><span class="op" id="5392888">.</span><span class="ident" id="5392889">Op</span>&nbsp;<span class="op" id="5392892">==</span>&nbsp;<span class="ident" id="5392895"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5392901">.</span><span class="ident" id="5392902">InstAltMatch</span><span class="op" id="5392914">)</span>&nbsp;<span class="op" id="5392916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392923">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392936">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392946">instOther</span>&nbsp;<span class="op" id="5392956">:=</span>&nbsp;<span class="ident" id="5392959"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5392960">.</span><span class="ident" id="5392961">Inst</span><span class="op" id="5392965">[</span><span class="op" id="5392966">*</span><span class="ident" id="5392967"><a href="/regexp/onepass.go.html#5392558">p_A_Other</a></span><span class="op" id="5392976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392981">//&nbsp;Analyzing&nbsp;both&nbsp;legs&nbsp;pointing&nbsp;to&nbsp;Alts&nbsp;is&nbsp;for&nbsp;another&nbsp;day</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393043">if</span>&nbsp;<span class="ident" id="5393046"><a href="/regexp/onepass.go.html#5392946">instOther</a></span><span class="op" id="5393055">.</span><span class="ident" id="5393056">Op</span>&nbsp;<span class="op" id="5393059">==</span>&nbsp;<span class="ident" id="5393062"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5393068">.</span><span class="ident" id="5393069">InstAlt</span>&nbsp;<span class="op" id="5393077">||</span>&nbsp;<span class="ident" id="5393080"><a href="/regexp/onepass.go.html#5392946">instOther</a></span><span class="op" id="5393089">.</span><span class="ident" id="5393090">Op</span>&nbsp;<span class="op" id="5393093">==</span>&nbsp;<span class="ident" id="5393096"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5393102">.</span><span class="ident" id="5393103">InstAltMatch</span>&nbsp;<span class="op" id="5393116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393122">//&nbsp;too&nbsp;complicated</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393145">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393162">//&nbsp;simple&nbsp;empty&nbsp;transition&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393197">//&nbsp;A:BC&nbsp;+&nbsp;B:DA&nbsp;=&gt;&nbsp;A:BC&nbsp;+&nbsp;B:DC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393230">p_B_Alt</span>&nbsp;<span class="op" id="5393238">:=</span>&nbsp;<span class="op" id="5393241">&amp;</span><span class="ident" id="5393242"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5393243">.</span><span class="ident" id="5393244">Inst</span><span class="op" id="5393248">[</span><span class="op" id="5393249">*</span><span class="ident" id="5393250"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span><span class="op" id="5393257">]</span><span class="op" id="5393258">.</span><span class="ident" id="5393259">Out</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393266">p_B_Other</span>&nbsp;<span class="op" id="5393276">:=</span>&nbsp;<span class="op" id="5393279">&amp;</span><span class="ident" id="5393280"><a href="/regexp/onepass.go.html#5392014">p</a></span><span class="op" id="5393281">.</span><span class="ident" id="5393282">Inst</span><span class="op" id="5393286">[</span><span class="op" id="5393287">*</span><span class="ident" id="5393288"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span><span class="op" id="5393295">]</span><span class="op" id="5393296">.</span><span class="ident" id="5393297">Arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393304">patch</span>&nbsp;<span class="op" id="5393310">:=</span>&nbsp;<span class="builtintype" id="5393313">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393322">if</span>&nbsp;<span class="ident" id="5393325"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span><span class="op" id="5393332">.</span><span class="ident" id="5393333">Out</span>&nbsp;<span class="op" id="5393337">==</span>&nbsp;<span class="builtintype" id="5393340">uint32</span><span class="op" id="5393346">(</span><span class="ident" id="5393347"><a href="/regexp/onepass.go.html#5392424">pc</a></span><span class="op" id="5393349">)</span>&nbsp;<span class="op" id="5393351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393357"><a href="/regexp/onepass.go.html#5393304">patch</a></span>&nbsp;<span class="op" id="5393363">=</span>&nbsp;<span class="builtintype" id="5393365">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393373">}</span>&nbsp;<span class="keyword" id="5393375">else</span>&nbsp;<span class="keyword" id="5393380">if</span>&nbsp;<span class="ident" id="5393383"><a href="/regexp/onepass.go.html#5392660">instAlt</a></span><span class="op" id="5393390">.</span><span class="ident" id="5393391">Arg</span>&nbsp;<span class="op" id="5393395">==</span>&nbsp;<span class="builtintype" id="5393398">uint32</span><span class="op" id="5393404">(</span><span class="ident" id="5393405"><a href="/regexp/onepass.go.html#5392424">pc</a></span><span class="op" id="5393407">)</span>&nbsp;<span class="op" id="5393409">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393415"><a href="/regexp/onepass.go.html#5393304">patch</a></span>&nbsp;<span class="op" id="5393421">=</span>&nbsp;<span class="builtintype" id="5393423">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393432"><a href="/regexp/onepass.go.html#5393230">p_B_Alt</a></span><span class="op" id="5393439">,</span>&nbsp;<span class="ident" id="5393441"><a href="/regexp/onepass.go.html#5393266">p_B_Other</a></span>&nbsp;<span class="op" id="5393451">=</span>&nbsp;<span class="ident" id="5393453"><a href="/regexp/onepass.go.html#5393266">p_B_Other</a></span><span class="op" id="5393462">,</span>&nbsp;<span class="ident" id="5393464"><a href="/regexp/onepass.go.html#5393230">p_B_Alt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393480">if</span>&nbsp;<span class="ident" id="5393483"><a href="/regexp/onepass.go.html#5393304">patch</a></span>&nbsp;<span class="op" id="5393489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393495">*</span><span class="ident" id="5393496"><a href="/regexp/onepass.go.html#5393230">p_B_Alt</a></span>&nbsp;<span class="op" id="5393504">=</span>&nbsp;<span class="op" id="5393506">*</span><span class="ident" id="5393507"><a href="/regexp/onepass.go.html#5392558">p_A_Other</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393526">//&nbsp;empty&nbsp;transition&nbsp;to&nbsp;common&nbsp;target</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393566">//&nbsp;A:BC&nbsp;+&nbsp;B:DC&nbsp;=&gt;&nbsp;A:DC&nbsp;+&nbsp;B:DC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393599">if</span>&nbsp;<span class="op" id="5393602">*</span><span class="ident" id="5393603"><a href="/regexp/onepass.go.html#5392558">p_A_Other</a></span>&nbsp;<span class="op" id="5393613">==</span>&nbsp;<span class="op" id="5393616">*</span><span class="ident" id="5393617"><a href="/regexp/onepass.go.html#5393230">p_B_Alt</a></span>&nbsp;<span class="op" id="5393625">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393631">*</span><span class="ident" id="5393632"><a href="/regexp/onepass.go.html#5392590">p_A_Alt</a></span>&nbsp;<span class="op" id="5393640">=</span>&nbsp;<span class="op" id="5393642">*</span><span class="ident" id="5393643"><a href="/regexp/onepass.go.html#5393266">p_B_Other</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393666">return</span>&nbsp;<span class="ident" id="5393673"><a href="/regexp/onepass.go.html#5392014">p</a></span><br>
<span class="lineno">280</span><span class="op" id="5393675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5393678">//&nbsp;runeSlice&nbsp;exists&nbsp;to&nbsp;permit&nbsp;sorting&nbsp;the&nbsp;case-folded&nbsp;rune&nbsp;sets.</span><br>
<span class="lineno"></span><span class="keyword" id="5393743">type</span>&nbsp;<span class="ident" id="5393748">runeSlice</span>&nbsp;<span class="op" id="5393758">[</span><span class="op" id="5393759">]</span><span class="builtintype" id="5393760">rune</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5393766">func</span>&nbsp;<span class="op" id="5393771">(</span><span class="ident" id="5393772">p</span>&nbsp;<span class="ident" id="5393774"><a href="/regexp/onepass.go.html#5393748">runeSlice</a></span><span class="op" id="5393783">)</span>&nbsp;<span class="ident" id="5393785">Len</span><span class="op" id="5393788">(</span><span class="op" id="5393789">)</span>&nbsp;<span class="builtintype" id="5393791">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5393805">{</span>&nbsp;<span class="keyword" id="5393807">return</span>&nbsp;<span class="builtinfunc" id="5393814">len</span><span class="op" id="5393817">(</span><span class="ident" id="5393818"><a href="/regexp/onepass.go.html#5393772">p</a></span><span class="op" id="5393819">)</span>&nbsp;<span class="op" id="5393821">}</span><br>
<span class="lineno"></span><span class="keyword" id="5393823">func</span>&nbsp;<span class="op" id="5393828">(</span><span class="ident" id="5393829">p</span>&nbsp;<span class="ident" id="5393831"><a href="/regexp/onepass.go.html#5393748">runeSlice</a></span><span class="op" id="5393840">)</span>&nbsp;<span class="ident" id="5393842">Less</span><span class="op" id="5393846">(</span><span class="ident" id="5393847">i</span><span class="op" id="5393848">,</span>&nbsp;<span class="ident" id="5393850">j</span>&nbsp;<span class="builtintype" id="5393852">int</span><span class="op" id="5393855">)</span>&nbsp;<span class="builtintype" id="5393857">bool</span>&nbsp;<span class="op" id="5393862">{</span>&nbsp;<span class="keyword" id="5393864">return</span>&nbsp;<span class="ident" id="5393871"><a href="/regexp/onepass.go.html#5393829">p</a></span><span class="op" id="5393872">[</span><span class="ident" id="5393873"><a href="/regexp/onepass.go.html#5393847">i</a></span><span class="op" id="5393874">]</span>&nbsp;<span class="op" id="5393876">&lt;</span>&nbsp;<span class="ident" id="5393878"><a href="/regexp/onepass.go.html#5393829">p</a></span><span class="op" id="5393879">[</span><span class="ident" id="5393880"><a href="/regexp/onepass.go.html#5393850">j</a></span><span class="op" id="5393881">]</span>&nbsp;<span class="op" id="5393883">}</span><br>
<span class="lineno"></span><span class="keyword" id="5393885">func</span>&nbsp;<span class="op" id="5393890">(</span><span class="ident" id="5393891">p</span>&nbsp;<span class="ident" id="5393893"><a href="/regexp/onepass.go.html#5393748">runeSlice</a></span><span class="op" id="5393902">)</span>&nbsp;<span class="ident" id="5393904">Swap</span><span class="op" id="5393908">(</span><span class="ident" id="5393909">i</span><span class="op" id="5393910">,</span>&nbsp;<span class="ident" id="5393912">j</span>&nbsp;<span class="builtintype" id="5393914">int</span><span class="op" id="5393917">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5393924">{</span>&nbsp;<span class="ident" id="5393926"><a href="/regexp/onepass.go.html#5393891">p</a></span><span class="op" id="5393927">[</span><span class="ident" id="5393928"><a href="/regexp/onepass.go.html#5393909">i</a></span><span class="op" id="5393929">]</span><span class="op" id="5393930">,</span>&nbsp;<span class="ident" id="5393932"><a href="/regexp/onepass.go.html#5393891">p</a></span><span class="op" id="5393933">[</span><span class="ident" id="5393934"><a href="/regexp/onepass.go.html#5393912">j</a></span><span class="op" id="5393935">]</span>&nbsp;<span class="op" id="5393937">=</span>&nbsp;<span class="ident" id="5393939"><a href="/regexp/onepass.go.html#5393891">p</a></span><span class="op" id="5393940">[</span><span class="ident" id="5393941"><a href="/regexp/onepass.go.html#5393912">j</a></span><span class="op" id="5393942">]</span><span class="op" id="5393943">,</span>&nbsp;<span class="ident" id="5393945"><a href="/regexp/onepass.go.html#5393891">p</a></span><span class="op" id="5393946">[</span><span class="ident" id="5393947"><a href="/regexp/onepass.go.html#5393909">i</a></span><span class="op" id="5393948">]</span>&nbsp;<span class="op" id="5393950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5393953">//&nbsp;Sort&nbsp;is&nbsp;a&nbsp;convenience&nbsp;method.</span><br>
<span class="lineno">290</span><span class="keyword" id="5393986">func</span>&nbsp;<span class="op" id="5393991">(</span><span class="ident" id="5393992">p</span>&nbsp;<span class="ident" id="5393994"><a href="/regexp/onepass.go.html#5393748">runeSlice</a></span><span class="op" id="5394003">)</span>&nbsp;<span class="ident" id="5394005">Sort</span><span class="op" id="5394009">(</span><span class="op" id="5394010">)</span>&nbsp;<span class="op" id="5394012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394015"><a href="/regexp/onepass.go.html#5386151">sort</a></span><span class="op" id="5394019">.</span><span class="ident" id="5394020">Sort</span><span class="op" id="5394024">(</span><span class="ident" id="5394025"><a href="/regexp/onepass.go.html#5393992">p</a></span><span class="op" id="5394026">)</span><br>
<span class="lineno"></span><span class="op" id="5394028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5394031">var</span>&nbsp;<span class="ident" id="5394035">anyRuneNotNL</span>&nbsp;<span class="op" id="5394048">=</span>&nbsp;<span class="op" id="5394050">[</span><span class="op" id="5394051">]</span><span class="builtintype" id="5394052">rune</span><span class="op" id="5394056">{</span><span class="num" id="5394057">0</span><span class="op" id="5394058">,</span>&nbsp;<span class="string" id="5394060">&#39;\n&#39;</span>&nbsp;<span class="op" id="5394065">-</span>&nbsp;<span class="num" id="5394067">1</span><span class="op" id="5394068">,</span>&nbsp;<span class="string" id="5394070">&#39;\n&#39;</span>&nbsp;<span class="op" id="5394075">+</span>&nbsp;<span class="num" id="5394077">1</span><span class="op" id="5394078">,</span>&nbsp;<span class="ident" id="5394080"><a href="/regexp/onepass.go.html#5386159">unicode</a></span><span class="op" id="5394087">.</span><span class="ident" id="5394088">MaxRune</span><span class="op" id="5394095">}</span><br>
<span class="lineno">295</span><span class="keyword" id="5394097">var</span>&nbsp;<span class="ident" id="5394101">anyRune</span>&nbsp;<span class="op" id="5394109">=</span>&nbsp;<span class="op" id="5394111">[</span><span class="op" id="5394112">]</span><span class="builtintype" id="5394113">rune</span><span class="op" id="5394117">{</span><span class="num" id="5394118">0</span><span class="op" id="5394119">,</span>&nbsp;<span class="ident" id="5394121"><a href="/regexp/onepass.go.html#5386159">unicode</a></span><span class="op" id="5394128">.</span><span class="ident" id="5394129">MaxRune</span><span class="op" id="5394136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5394139">//&nbsp;makeOnePass&nbsp;creates&nbsp;a&nbsp;onepass&nbsp;Prog,&nbsp;if&nbsp;possible.&nbsp;It&nbsp;is&nbsp;possible&nbsp;if&nbsp;at&nbsp;any&nbsp;alt,</span><br>
<span class="lineno"></span><span class="comment" id="5394221">//&nbsp;the&nbsp;match&nbsp;engine&nbsp;can&nbsp;always&nbsp;tell&nbsp;which&nbsp;branch&nbsp;to&nbsp;take.&nbsp;The&nbsp;routine&nbsp;may&nbsp;modify</span><br>
<span class="lineno"></span><span class="comment" id="5394302">//&nbsp;p&nbsp;if&nbsp;it&nbsp;is&nbsp;turned&nbsp;into&nbsp;a&nbsp;onepass&nbsp;Prog.&nbsp;If&nbsp;it&nbsp;isn&#39;t&nbsp;possible&nbsp;for&nbsp;this&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno">300</span><span class="comment" id="5394382">//&nbsp;onepass&nbsp;Prog,&nbsp;the&nbsp;Prog&nbsp;notOnePass&nbsp;is&nbsp;returned.&nbsp;makeOnePass&nbsp;is&nbsp;recursive</span><br>
<span class="lineno"></span><span class="comment" id="5394457">//&nbsp;to&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;Prog.</span><br>
<span class="lineno"></span><span class="keyword" id="5394485">func</span>&nbsp;<span class="ident" id="5394490">makeOnePass</span><span class="op" id="5394501">(</span><span class="ident" id="5394502">p</span>&nbsp;<span class="op" id="5394504">*</span><span class="ident" id="5394505"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span><span class="op" id="5394516">)</span>&nbsp;<span class="op" id="5394518">*</span><span class="ident" id="5394519"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span>&nbsp;<span class="op" id="5394531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394534">//&nbsp;If&nbsp;the&nbsp;machine&nbsp;is&nbsp;very&nbsp;long,&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;the&nbsp;time&nbsp;to&nbsp;check&nbsp;if&nbsp;we&nbsp;can&nbsp;use&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394624">if</span>&nbsp;<span class="builtinfunc" id="5394627">len</span><span class="op" id="5394630">(</span><span class="ident" id="5394631"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5394632">.</span><span class="ident" id="5394633">Inst</span><span class="op" id="5394637">)</span>&nbsp;<span class="op" id="5394639">&gt;=</span>&nbsp;<span class="num" id="5394642">1000</span>&nbsp;<span class="op" id="5394647">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394651">return</span>&nbsp;<span class="ident" id="5394658"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394674">var</span>&nbsp;<span class="op" id="5394678">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394682">instQueue</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5394695">=</span>&nbsp;<span class="ident" id="5394697"><a href="/regexp/onepass.go.html#5389609">newQueue</a></span><span class="op" id="5394705">(</span><span class="builtinfunc" id="5394706">len</span><span class="op" id="5394709">(</span><span class="ident" id="5394710"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5394711">.</span><span class="ident" id="5394712">Inst</span><span class="op" id="5394716">)</span><span class="op" id="5394717">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394721">visitQueue</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5394734">=</span>&nbsp;<span class="ident" id="5394736"><a href="/regexp/onepass.go.html#5389609">newQueue</a></span><span class="op" id="5394744">(</span><span class="builtinfunc" id="5394745">len</span><span class="op" id="5394748">(</span><span class="ident" id="5394749"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5394750">.</span><span class="ident" id="5394751">Inst</span><span class="op" id="5394755">)</span><span class="op" id="5394756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394760">build</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5394773">func</span><span class="op" id="5394777">(</span><span class="builtintype" id="5394778">uint32</span><span class="op" id="5394784">,</span>&nbsp;<span class="op" id="5394786">*</span><span class="ident" id="5394787"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5394799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394803">check</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5394816">func</span><span class="op" id="5394820">(</span><span class="builtintype" id="5394821">uint32</span><span class="op" id="5394827">,</span>&nbsp;<span class="keyword" id="5394829">map</span><span class="op" id="5394832">[</span><span class="builtintype" id="5394833">uint32</span><span class="op" id="5394839">]</span><span class="builtintype" id="5394840">bool</span><span class="op" id="5394844">)</span>&nbsp;<span class="builtintype" id="5394846">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394853">onePassRunes</span>&nbsp;<span class="op" id="5394866">=</span>&nbsp;<span class="builtinfunc" id="5394868">make</span><span class="op" id="5394872">(</span><span class="op" id="5394873">[</span><span class="op" id="5394874">]</span><span class="op" id="5394875">[</span><span class="op" id="5394876">]</span><span class="builtintype" id="5394877">rune</span><span class="op" id="5394881">,</span>&nbsp;<span class="builtinfunc" id="5394883">len</span><span class="op" id="5394886">(</span><span class="ident" id="5394887"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5394888">.</span><span class="ident" id="5394889">Inst</span><span class="op" id="5394893">)</span><span class="op" id="5394894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394897">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394900"><a href="/regexp/onepass.go.html#5394760">build</a></span>&nbsp;<span class="op" id="5394906">=</span>&nbsp;<span class="keyword" id="5394908">func</span><span class="op" id="5394912">(</span><span class="ident" id="5394913">pc</span>&nbsp;<span class="builtintype" id="5394916">uint32</span><span class="op" id="5394922">,</span>&nbsp;<span class="ident" id="5394924">q</span>&nbsp;<span class="op" id="5394926">*</span><span class="ident" id="5394927"><a href="/regexp/onepass.go.html#5388826">queueOnePass</a></span><span class="op" id="5394939">)</span>&nbsp;<span class="op" id="5394941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394945">if</span>&nbsp;<span class="ident" id="5394948"><a href="/regexp/onepass.go.html#5394924">q</a></span><span class="op" id="5394949">.</span><span class="ident" id="5394950">contains</span><span class="op" id="5394958">(</span><span class="ident" id="5394959"><a href="/regexp/onepass.go.html#5394913">pc</a></span><span class="op" id="5394961">)</span>&nbsp;<span class="op" id="5394963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394968">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394981">inst</span>&nbsp;<span class="op" id="5394986">:=</span>&nbsp;<span class="ident" id="5394989"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5394990">.</span><span class="ident" id="5394991">Inst</span><span class="op" id="5394995">[</span><span class="ident" id="5394996"><a href="/regexp/onepass.go.html#5394913">pc</a></span><span class="op" id="5394998">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395002">switch</span>&nbsp;<span class="ident" id="5395009"><a href="/regexp/onepass.go.html#5394981">inst</a></span><span class="op" id="5395013">.</span><span class="ident" id="5395014">Op</span>&nbsp;<span class="op" id="5395017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395021">case</span>&nbsp;<span class="ident" id="5395026"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395032">.</span><span class="ident" id="5395033">InstAlt</span><span class="op" id="5395040">,</span>&nbsp;<span class="ident" id="5395042"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395048">.</span><span class="ident" id="5395049">InstAltMatch</span><span class="op" id="5395061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395066"><a href="/regexp/onepass.go.html#5394924">q</a></span><span class="op" id="5395067">.</span><span class="ident" id="5395068">insert</span><span class="op" id="5395074">(</span><span class="ident" id="5395075"><a href="/regexp/onepass.go.html#5394981">inst</a></span><span class="op" id="5395079">.</span><span class="ident" id="5395080">Out</span><span class="op" id="5395083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395088"><a href="/regexp/onepass.go.html#5394760">build</a></span><span class="op" id="5395093">(</span><span class="ident" id="5395094"><a href="/regexp/onepass.go.html#5394981">inst</a></span><span class="op" id="5395098">.</span><span class="ident" id="5395099">Out</span><span class="op" id="5395102">,</span>&nbsp;<span class="ident" id="5395104"><a href="/regexp/onepass.go.html#5394924">q</a></span><span class="op" id="5395105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395110"><a href="/regexp/onepass.go.html#5394924">q</a></span><span class="op" id="5395111">.</span><span class="ident" id="5395112">insert</span><span class="op" id="5395118">(</span><span class="ident" id="5395119"><a href="/regexp/onepass.go.html#5394981">inst</a></span><span class="op" id="5395123">.</span><span class="ident" id="5395124">Arg</span><span class="op" id="5395127">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395131">case</span>&nbsp;<span class="ident" id="5395136"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395142">.</span><span class="ident" id="5395143">InstMatch</span><span class="op" id="5395152">,</span>&nbsp;<span class="ident" id="5395154"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395160">.</span><span class="ident" id="5395161">InstFail</span><span class="op" id="5395169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395173">default</span><span class="op" id="5395180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395185"><a href="/regexp/onepass.go.html#5394924">q</a></span><span class="op" id="5395186">.</span><span class="ident" id="5395187">insert</span><span class="op" id="5395193">(</span><span class="ident" id="5395194"><a href="/regexp/onepass.go.html#5394981">inst</a></span><span class="op" id="5395198">.</span><span class="ident" id="5395199">Out</span><span class="op" id="5395202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395209">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395213">//&nbsp;check&nbsp;that&nbsp;paths&nbsp;from&nbsp;Alt&nbsp;instructions&nbsp;are&nbsp;unambiguous,&nbsp;and&nbsp;rebuild&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395293">//&nbsp;program&nbsp;as&nbsp;a&nbsp;onepass&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395326"><a href="/regexp/onepass.go.html#5394803">check</a></span>&nbsp;<span class="op" id="5395332">=</span>&nbsp;<span class="keyword" id="5395334">func</span><span class="op" id="5395338">(</span><span class="ident" id="5395339">pc</span>&nbsp;<span class="builtintype" id="5395342">uint32</span><span class="op" id="5395348">,</span>&nbsp;<span class="ident" id="5395350">m</span>&nbsp;<span class="keyword" id="5395352">map</span><span class="op" id="5395355">[</span><span class="builtintype" id="5395356">uint32</span><span class="op" id="5395362">]</span><span class="builtintype" id="5395363">bool</span><span class="op" id="5395367">)</span>&nbsp;<span class="op" id="5395369">(</span><span class="ident" id="5395370">ok</span>&nbsp;<span class="builtintype" id="5395373">bool</span><span class="op" id="5395377">)</span>&nbsp;<span class="op" id="5395379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395383"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5395386">=</span>&nbsp;<span class="builtintype" id="5395388">true</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395395">inst</span>&nbsp;<span class="op" id="5395400">:=</span>&nbsp;<span class="op" id="5395403">&amp;</span><span class="ident" id="5395404"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5395405">.</span><span class="ident" id="5395406">Inst</span><span class="op" id="5395410">[</span><span class="ident" id="5395411"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5395413">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395417">if</span>&nbsp;<span class="ident" id="5395420"><a href="/regexp/onepass.go.html#5394721">visitQueue</a></span><span class="op" id="5395430">.</span><span class="ident" id="5395431">contains</span><span class="op" id="5395439">(</span><span class="ident" id="5395440"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5395442">)</span>&nbsp;<span class="op" id="5395444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395449">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395462"><a href="/regexp/onepass.go.html#5394721">visitQueue</a></span><span class="op" id="5395472">.</span><span class="ident" id="5395473">insert</span><span class="op" id="5395479">(</span><span class="ident" id="5395480"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5395482">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395486">switch</span>&nbsp;<span class="ident" id="5395493"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395497">.</span><span class="ident" id="5395498">Op</span>&nbsp;<span class="op" id="5395501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395505">case</span>&nbsp;<span class="ident" id="5395510"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395516">.</span><span class="ident" id="5395517">InstAlt</span><span class="op" id="5395524">,</span>&nbsp;<span class="ident" id="5395526"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395532">.</span><span class="ident" id="5395533">InstAltMatch</span><span class="op" id="5395545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395550"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5395553">=</span>&nbsp;<span class="ident" id="5395555"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5395560">(</span><span class="ident" id="5395561"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395565">.</span><span class="ident" id="5395566">Out</span><span class="op" id="5395569">,</span>&nbsp;<span class="ident" id="5395571"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5395572">)</span>&nbsp;<span class="op" id="5395574">&amp;&amp;</span>&nbsp;<span class="ident" id="5395577"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5395582">(</span><span class="ident" id="5395583"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395587">.</span><span class="ident" id="5395588">Arg</span><span class="op" id="5395591">,</span>&nbsp;<span class="ident" id="5395593"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5395594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395599">//&nbsp;check&nbsp;no-input&nbsp;paths&nbsp;to&nbsp;InstMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395639">matchOut</span>&nbsp;<span class="op" id="5395648">:=</span>&nbsp;<span class="ident" id="5395651"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5395652">[</span><span class="ident" id="5395653"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395657">.</span><span class="ident" id="5395658">Out</span><span class="op" id="5395661">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395666">matchArg</span>&nbsp;<span class="op" id="5395675">:=</span>&nbsp;<span class="ident" id="5395678"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5395679">[</span><span class="ident" id="5395680"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395684">.</span><span class="ident" id="5395685">Arg</span><span class="op" id="5395688">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395693">if</span>&nbsp;<span class="ident" id="5395696"><a href="/regexp/onepass.go.html#5395639">matchOut</a></span>&nbsp;<span class="op" id="5395705">&amp;&amp;</span>&nbsp;<span class="ident" id="5395708"><a href="/regexp/onepass.go.html#5395666">matchArg</a></span>&nbsp;<span class="op" id="5395717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395723"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5395726">=</span>&nbsp;<span class="builtintype" id="5395728">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395738">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395747">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395752">//&nbsp;Match&nbsp;on&nbsp;empty&nbsp;goes&nbsp;in&nbsp;inst.Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395790">if</span>&nbsp;<span class="ident" id="5395793"><a href="/regexp/onepass.go.html#5395666">matchArg</a></span>&nbsp;<span class="op" id="5395802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395808"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395812">.</span><span class="ident" id="5395813">Out</span><span class="op" id="5395816">,</span>&nbsp;<span class="ident" id="5395818"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395822">.</span><span class="ident" id="5395823">Arg</span>&nbsp;<span class="op" id="5395827">=</span>&nbsp;<span class="ident" id="5395829"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395833">.</span><span class="ident" id="5395834">Arg</span><span class="op" id="5395837">,</span>&nbsp;<span class="ident" id="5395839"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395843">.</span><span class="ident" id="5395844">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395852"><a href="/regexp/onepass.go.html#5395639">matchOut</a></span><span class="op" id="5395860">,</span>&nbsp;<span class="ident" id="5395862"><a href="/regexp/onepass.go.html#5395666">matchArg</a></span>&nbsp;<span class="op" id="5395871">=</span>&nbsp;<span class="ident" id="5395873"><a href="/regexp/onepass.go.html#5395666">matchArg</a></span><span class="op" id="5395881">,</span>&nbsp;<span class="ident" id="5395883"><a href="/regexp/onepass.go.html#5395639">matchOut</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395895">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395900">if</span>&nbsp;<span class="ident" id="5395903"><a href="/regexp/onepass.go.html#5395639">matchOut</a></span>&nbsp;<span class="op" id="5395912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395918"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5395919">[</span><span class="ident" id="5395920"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5395922">]</span>&nbsp;<span class="op" id="5395924">=</span>&nbsp;<span class="builtintype" id="5395926">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395935"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5395939">.</span><span class="ident" id="5395940">Op</span>&nbsp;<span class="op" id="5395943">=</span>&nbsp;<span class="ident" id="5395945"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5395951">.</span><span class="ident" id="5395952">InstAltMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395974">//&nbsp;build&nbsp;a&nbsp;dispatch&nbsp;operator&nbsp;from&nbsp;the&nbsp;two&nbsp;legs&nbsp;of&nbsp;the&nbsp;alt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396036"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396048">[</span><span class="ident" id="5396049"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396051">]</span><span class="op" id="5396052">,</span>&nbsp;<span class="ident" id="5396054"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396058">.</span><span class="ident" id="5396059">Next</span>&nbsp;<span class="op" id="5396064">=</span>&nbsp;<span class="ident" id="5396066"><a href="/regexp/onepass.go.html#5390252">mergeRuneSets</a></span><span class="op" id="5396079">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396085">&amp;</span><span class="ident" id="5396086"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396098">[</span><span class="ident" id="5396099"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396103">.</span><span class="ident" id="5396104">Out</span><span class="op" id="5396107">]</span><span class="op" id="5396108">,</span>&nbsp;<span class="op" id="5396110">&amp;</span><span class="ident" id="5396111"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396123">[</span><span class="ident" id="5396124"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396128">.</span><span class="ident" id="5396129">Arg</span><span class="op" id="5396132">]</span><span class="op" id="5396133">,</span>&nbsp;<span class="ident" id="5396135"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396139">.</span><span class="ident" id="5396140">Out</span><span class="op" id="5396143">,</span>&nbsp;<span class="ident" id="5396145"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396149">.</span><span class="ident" id="5396150">Arg</span><span class="op" id="5396153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396158">if</span>&nbsp;<span class="builtinfunc" id="5396161">len</span><span class="op" id="5396164">(</span><span class="ident" id="5396165"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396169">.</span><span class="ident" id="5396170">Next</span><span class="op" id="5396174">)</span>&nbsp;<span class="op" id="5396176">&gt;</span>&nbsp;<span class="num" id="5396178">0</span>&nbsp;<span class="op" id="5396180">&amp;&amp;</span>&nbsp;<span class="ident" id="5396183"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396187">.</span><span class="ident" id="5396188">Next</span><span class="op" id="5396192">[</span><span class="num" id="5396193">0</span><span class="op" id="5396194">]</span>&nbsp;<span class="op" id="5396196">==</span>&nbsp;<span class="ident" id="5396199"><a href="/regexp/onepass.go.html#5390153">mergeFailed</a></span>&nbsp;<span class="op" id="5396211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396217"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5396220">=</span>&nbsp;<span class="builtintype" id="5396222">false</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396232">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396245">case</span>&nbsp;<span class="ident" id="5396250"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396256">.</span><span class="ident" id="5396257">InstCapture</span><span class="op" id="5396268">,</span>&nbsp;<span class="ident" id="5396270"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396276">.</span><span class="ident" id="5396277">InstNop</span><span class="op" id="5396284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396289"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5396292">=</span>&nbsp;<span class="ident" id="5396294"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5396299">(</span><span class="ident" id="5396300"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396304">.</span><span class="ident" id="5396305">Out</span><span class="op" id="5396308">,</span>&nbsp;<span class="ident" id="5396310"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396316"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396317">[</span><span class="ident" id="5396318"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396320">]</span>&nbsp;<span class="op" id="5396322">=</span>&nbsp;<span class="ident" id="5396324"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396325">[</span><span class="ident" id="5396326"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396330">.</span><span class="ident" id="5396331">Out</span><span class="op" id="5396334">]</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396339">//&nbsp;pass&nbsp;matching&nbsp;runes&nbsp;back&nbsp;through&nbsp;these&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396392"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396404">[</span><span class="ident" id="5396405"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396407">]</span>&nbsp;<span class="op" id="5396409">=</span>&nbsp;<span class="builtinfunc" id="5396411">append</span><span class="op" id="5396417">(</span><span class="op" id="5396418">[</span><span class="op" id="5396419">]</span><span class="builtintype" id="5396420">rune</span><span class="op" id="5396424">{</span><span class="op" id="5396425">}</span><span class="op" id="5396426">,</span>&nbsp;<span class="ident" id="5396428"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396440">[</span><span class="ident" id="5396441"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396445">.</span><span class="ident" id="5396446">Out</span><span class="op" id="5396449">]</span><span class="op" id="5396450">...</span><span class="op" id="5396453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396458"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396462">.</span><span class="ident" id="5396463">Next</span>&nbsp;<span class="op" id="5396468">=</span>&nbsp;<span class="op" id="5396470">[</span><span class="op" id="5396471">]</span><span class="builtintype" id="5396472">uint32</span><span class="op" id="5396478">{</span><span class="op" id="5396479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396484">for</span>&nbsp;<span class="ident" id="5396488">i</span>&nbsp;<span class="op" id="5396490">:=</span>&nbsp;<span class="builtinfunc" id="5396493">len</span><span class="op" id="5396496">(</span><span class="ident" id="5396497"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396509">[</span><span class="ident" id="5396510"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396512">]</span><span class="op" id="5396513">)</span>&nbsp;<span class="op" id="5396515">/</span>&nbsp;<span class="num" id="5396517">2</span><span class="op" id="5396518">;</span>&nbsp;<span class="ident" id="5396520"><a href="/regexp/onepass.go.html#5396488">i</a></span>&nbsp;<span class="op" id="5396522">&gt;=</span>&nbsp;<span class="num" id="5396525">0</span><span class="op" id="5396526">;</span>&nbsp;<span class="ident" id="5396528"><a href="/regexp/onepass.go.html#5396488">i</a></span><span class="op" id="5396529">--</span>&nbsp;<span class="op" id="5396532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396538"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396542">.</span><span class="ident" id="5396543">Next</span>&nbsp;<span class="op" id="5396548">=</span>&nbsp;<span class="builtinfunc" id="5396550">append</span><span class="op" id="5396556">(</span><span class="ident" id="5396557"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396561">.</span><span class="ident" id="5396562">Next</span><span class="op" id="5396566">,</span>&nbsp;<span class="ident" id="5396568"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396572">.</span><span class="ident" id="5396573">Out</span><span class="op" id="5396576">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396585">case</span>&nbsp;<span class="ident" id="5396590"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396596">.</span><span class="ident" id="5396597">InstEmptyWidth</span><span class="op" id="5396611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396616"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5396619">=</span>&nbsp;<span class="ident" id="5396621"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5396626">(</span><span class="ident" id="5396627"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396631">.</span><span class="ident" id="5396632">Out</span><span class="op" id="5396635">,</span>&nbsp;<span class="ident" id="5396637"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396643"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396644">[</span><span class="ident" id="5396645"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396647">]</span>&nbsp;<span class="op" id="5396649">=</span>&nbsp;<span class="ident" id="5396651"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396652">[</span><span class="ident" id="5396653"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396657">.</span><span class="ident" id="5396658">Out</span><span class="op" id="5396661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396666"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396678">[</span><span class="ident" id="5396679"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396681">]</span>&nbsp;<span class="op" id="5396683">=</span>&nbsp;<span class="builtinfunc" id="5396685">append</span><span class="op" id="5396691">(</span><span class="op" id="5396692">[</span><span class="op" id="5396693">]</span><span class="builtintype" id="5396694">rune</span><span class="op" id="5396698">{</span><span class="op" id="5396699">}</span><span class="op" id="5396700">,</span>&nbsp;<span class="ident" id="5396702"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396714">[</span><span class="ident" id="5396715"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396719">.</span><span class="ident" id="5396720">Out</span><span class="op" id="5396723">]</span><span class="op" id="5396724">...</span><span class="op" id="5396727">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396732"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396736">.</span><span class="ident" id="5396737">Next</span>&nbsp;<span class="op" id="5396742">=</span>&nbsp;<span class="op" id="5396744">[</span><span class="op" id="5396745">]</span><span class="builtintype" id="5396746">uint32</span><span class="op" id="5396752">{</span><span class="op" id="5396753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396758">for</span>&nbsp;<span class="ident" id="5396762">i</span>&nbsp;<span class="op" id="5396764">:=</span>&nbsp;<span class="builtinfunc" id="5396767">len</span><span class="op" id="5396770">(</span><span class="ident" id="5396771"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5396783">[</span><span class="ident" id="5396784"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396786">]</span><span class="op" id="5396787">)</span>&nbsp;<span class="op" id="5396789">/</span>&nbsp;<span class="num" id="5396791">2</span><span class="op" id="5396792">;</span>&nbsp;<span class="ident" id="5396794"><a href="/regexp/onepass.go.html#5396762">i</a></span>&nbsp;<span class="op" id="5396796">&gt;=</span>&nbsp;<span class="num" id="5396799">0</span><span class="op" id="5396800">;</span>&nbsp;<span class="ident" id="5396802"><a href="/regexp/onepass.go.html#5396762">i</a></span><span class="op" id="5396803">--</span>&nbsp;<span class="op" id="5396806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396812"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396816">.</span><span class="ident" id="5396817">Next</span>&nbsp;<span class="op" id="5396822">=</span>&nbsp;<span class="builtinfunc" id="5396824">append</span><span class="op" id="5396830">(</span><span class="ident" id="5396831"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396835">.</span><span class="ident" id="5396836">Next</span><span class="op" id="5396840">,</span>&nbsp;<span class="ident" id="5396842"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396846">.</span><span class="ident" id="5396847">Out</span><span class="op" id="5396850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396859">case</span>&nbsp;<span class="ident" id="5396864"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396870">.</span><span class="ident" id="5396871">InstMatch</span><span class="op" id="5396880">,</span>&nbsp;<span class="ident" id="5396882"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396888">.</span><span class="ident" id="5396889">InstFail</span><span class="op" id="5396897">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396902"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396903">[</span><span class="ident" id="5396904"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5396906">]</span>&nbsp;<span class="op" id="5396908">=</span>&nbsp;<span class="ident" id="5396910"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396914">.</span><span class="ident" id="5396915">Op</span>&nbsp;<span class="op" id="5396918">==</span>&nbsp;<span class="ident" id="5396921"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396927">.</span><span class="ident" id="5396928">InstMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396941">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396949">case</span>&nbsp;<span class="ident" id="5396954"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5396960">.</span><span class="ident" id="5396961">InstRune</span><span class="op" id="5396969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396974"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5396977">=</span>&nbsp;<span class="ident" id="5396979"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5396984">(</span><span class="ident" id="5396985"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5396989">.</span><span class="ident" id="5396990">Out</span><span class="op" id="5396993">,</span>&nbsp;<span class="ident" id="5396995"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5396996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397001"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5397002">[</span><span class="ident" id="5397003"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5397005">]</span>&nbsp;<span class="op" id="5397007">=</span>&nbsp;<span class="builtintype" id="5397009">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397018">if</span>&nbsp;<span class="builtinfunc" id="5397021">len</span><span class="op" id="5397024">(</span><span class="ident" id="5397025"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397029">.</span><span class="ident" id="5397030">Next</span><span class="op" id="5397034">)</span>&nbsp;<span class="op" id="5397036">&gt;</span>&nbsp;<span class="num" id="5397038">0</span>&nbsp;<span class="op" id="5397040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397046">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397060">if</span>&nbsp;<span class="builtinfunc" id="5397063">len</span><span class="op" id="5397066">(</span><span class="ident" id="5397067"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397071">.</span><span class="ident" id="5397072">Rune</span><span class="op" id="5397076">)</span>&nbsp;<span class="op" id="5397078">==</span>&nbsp;<span class="num" id="5397081">0</span>&nbsp;<span class="op" id="5397083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397089"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5397101">[</span><span class="ident" id="5397102"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5397104">]</span>&nbsp;<span class="op" id="5397106">=</span>&nbsp;<span class="op" id="5397108">[</span><span class="op" id="5397109">]</span><span class="builtintype" id="5397110">rune</span><span class="op" id="5397114">{</span><span class="op" id="5397115">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397121"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397125">.</span><span class="ident" id="5397126">Next</span>&nbsp;<span class="op" id="5397131">=</span>&nbsp;<span class="op" id="5397133">[</span><span class="op" id="5397134">]</span><span class="builtintype" id="5397135">uint32</span><span class="op" id="5397141">{</span><span class="ident" id="5397142"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397146">.</span><span class="ident" id="5397147">Out</span><span class="op" id="5397150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397156">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397170">runes</span>&nbsp;<span class="op" id="5397176">:=</span>&nbsp;<span class="builtinfunc" id="5397179">make</span><span class="op" id="5397183">(</span><span class="op" id="5397184">[</span><span class="op" id="5397185">]</span><span class="builtintype" id="5397186">rune</span><span class="op" id="5397190">,</span>&nbsp;<span class="num" id="5397192">0</span><span class="op" id="5397193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397198">if</span>&nbsp;<span class="builtinfunc" id="5397201">len</span><span class="op" id="5397204">(</span><span class="ident" id="5397205"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397209">.</span><span class="ident" id="5397210">Rune</span><span class="op" id="5397214">)</span>&nbsp;<span class="op" id="5397216">==</span>&nbsp;<span class="num" id="5397219">1</span>&nbsp;<span class="op" id="5397221">&amp;&amp;</span>&nbsp;<span class="ident" id="5397224"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5397230">.</span><span class="ident" id="5397231">Flags</span><span class="op" id="5397236">(</span><span class="ident" id="5397237"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397241">.</span><span class="ident" id="5397242">Arg</span><span class="op" id="5397245">)</span><span class="op" id="5397246">&amp;</span><span class="ident" id="5397247"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5397253">.</span><span class="ident" id="5397254">FoldCase</span>&nbsp;<span class="op" id="5397263">!=</span>&nbsp;<span class="num" id="5397266">0</span>&nbsp;<span class="op" id="5397268">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397274">r0</span>&nbsp;<span class="op" id="5397277">:=</span>&nbsp;<span class="ident" id="5397280"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397284">.</span><span class="ident" id="5397285">Rune</span><span class="op" id="5397289">[</span><span class="num" id="5397290">0</span><span class="op" id="5397291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397297"><a href="/regexp/onepass.go.html#5397170">runes</a></span>&nbsp;<span class="op" id="5397303">=</span>&nbsp;<span class="builtinfunc" id="5397305">append</span><span class="op" id="5397311">(</span><span class="ident" id="5397312"><a href="/regexp/onepass.go.html#5397170">runes</a></span><span class="op" id="5397317">,</span>&nbsp;<span class="ident" id="5397319"><a href="/regexp/onepass.go.html#5397274">r0</a></span><span class="op" id="5397321">,</span>&nbsp;<span class="ident" id="5397323"><a href="/regexp/onepass.go.html#5397274">r0</a></span><span class="op" id="5397325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397331">for</span>&nbsp;<span class="ident" id="5397335">r1</span>&nbsp;<span class="op" id="5397338">:=</span>&nbsp;<span class="ident" id="5397341"><a href="/regexp/onepass.go.html#5386159">unicode</a></span><span class="op" id="5397348">.</span><span class="ident" id="5397349">SimpleFold</span><span class="op" id="5397359">(</span><span class="ident" id="5397360"><a href="/regexp/onepass.go.html#5397274">r0</a></span><span class="op" id="5397362">)</span><span class="op" id="5397363">;</span>&nbsp;<span class="ident" id="5397365"><a href="/regexp/onepass.go.html#5397335">r1</a></span>&nbsp;<span class="op" id="5397368">!=</span>&nbsp;<span class="ident" id="5397371"><a href="/regexp/onepass.go.html#5397274">r0</a></span><span class="op" id="5397373">;</span>&nbsp;<span class="ident" id="5397375"><a href="/regexp/onepass.go.html#5397335">r1</a></span>&nbsp;<span class="op" id="5397378">=</span>&nbsp;<span class="ident" id="5397380"><a href="/regexp/onepass.go.html#5386159">unicode</a></span><span class="op" id="5397387">.</span><span class="ident" id="5397388">SimpleFold</span><span class="op" id="5397398">(</span><span class="ident" id="5397399"><a href="/regexp/onepass.go.html#5397335">r1</a></span><span class="op" id="5397401">)</span>&nbsp;<span class="op" id="5397403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397410"><a href="/regexp/onepass.go.html#5397170">runes</a></span>&nbsp;<span class="op" id="5397416">=</span>&nbsp;<span class="builtinfunc" id="5397418">append</span><span class="op" id="5397424">(</span><span class="ident" id="5397425"><a href="/regexp/onepass.go.html#5397170">runes</a></span><span class="op" id="5397430">,</span>&nbsp;<span class="ident" id="5397432"><a href="/regexp/onepass.go.html#5397335">r1</a></span><span class="op" id="5397434">,</span>&nbsp;<span class="ident" id="5397436"><a href="/regexp/onepass.go.html#5397335">r1</a></span><span class="op" id="5397438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397444">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397450"><a href="/regexp/onepass.go.html#5386151">sort</a></span><span class="op" id="5397454">.</span><span class="ident" id="5397455">Sort</span><span class="op" id="5397459">(</span><span class="ident" id="5397460"><a href="/regexp/onepass.go.html#5393748">runeSlice</a></span><span class="op" id="5397469">(</span><span class="ident" id="5397470"><a href="/regexp/onepass.go.html#5397170">runes</a></span><span class="op" id="5397475">)</span><span class="op" id="5397476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397481">}</span>&nbsp;<span class="keyword" id="5397483">else</span>&nbsp;<span class="op" id="5397488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397494"><a href="/regexp/onepass.go.html#5397170">runes</a></span>&nbsp;<span class="op" id="5397500">=</span>&nbsp;<span class="builtinfunc" id="5397502">append</span><span class="op" id="5397508">(</span><span class="ident" id="5397509"><a href="/regexp/onepass.go.html#5397170">runes</a></span><span class="op" id="5397514">,</span>&nbsp;<span class="ident" id="5397516"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397520">.</span><span class="ident" id="5397521">Rune</span><span class="op" id="5397525">...</span><span class="op" id="5397528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397538"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5397550">[</span><span class="ident" id="5397551"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5397553">]</span>&nbsp;<span class="op" id="5397555">=</span>&nbsp;<span class="ident" id="5397557"><a href="/regexp/onepass.go.html#5397170">runes</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397566"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397570">.</span><span class="ident" id="5397571">Next</span>&nbsp;<span class="op" id="5397576">=</span>&nbsp;<span class="op" id="5397578">[</span><span class="op" id="5397579">]</span><span class="builtintype" id="5397580">uint32</span><span class="op" id="5397586">{</span><span class="op" id="5397587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397592">for</span>&nbsp;<span class="ident" id="5397596">i</span>&nbsp;<span class="op" id="5397598">:=</span>&nbsp;<span class="builtinfunc" id="5397601">len</span><span class="op" id="5397604">(</span><span class="ident" id="5397605"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5397617">[</span><span class="ident" id="5397618"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5397620">]</span><span class="op" id="5397621">)</span>&nbsp;<span class="op" id="5397623">/</span>&nbsp;<span class="num" id="5397625">2</span><span class="op" id="5397626">;</span>&nbsp;<span class="ident" id="5397628"><a href="/regexp/onepass.go.html#5397596">i</a></span>&nbsp;<span class="op" id="5397630">&gt;=</span>&nbsp;<span class="num" id="5397633">0</span><span class="op" id="5397634">;</span>&nbsp;<span class="ident" id="5397636"><a href="/regexp/onepass.go.html#5397596">i</a></span><span class="op" id="5397637">--</span>&nbsp;<span class="op" id="5397640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397646"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397650">.</span><span class="ident" id="5397651">Next</span>&nbsp;<span class="op" id="5397656">=</span>&nbsp;<span class="builtinfunc" id="5397658">append</span><span class="op" id="5397664">(</span><span class="ident" id="5397665"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397669">.</span><span class="ident" id="5397670">Next</span><span class="op" id="5397674">,</span>&nbsp;<span class="ident" id="5397676"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397680">.</span><span class="ident" id="5397681">Out</span><span class="op" id="5397684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397694"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397698">.</span><span class="ident" id="5397699">Op</span>&nbsp;<span class="op" id="5397702">=</span>&nbsp;<span class="ident" id="5397704"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5397710">.</span><span class="ident" id="5397711">InstRune</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397722">case</span>&nbsp;<span class="ident" id="5397727"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5397733">.</span><span class="ident" id="5397734">InstRune1</span><span class="op" id="5397743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397748"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5397751">=</span>&nbsp;<span class="ident" id="5397753"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5397758">(</span><span class="ident" id="5397759"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397763">.</span><span class="ident" id="5397764">Out</span><span class="op" id="5397767">,</span>&nbsp;<span class="ident" id="5397769"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5397770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397775"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5397776">[</span><span class="ident" id="5397777"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5397779">]</span>&nbsp;<span class="op" id="5397781">=</span>&nbsp;<span class="builtintype" id="5397783">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397792">if</span>&nbsp;<span class="builtinfunc" id="5397795">len</span><span class="op" id="5397798">(</span><span class="ident" id="5397799"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397803">.</span><span class="ident" id="5397804">Next</span><span class="op" id="5397808">)</span>&nbsp;<span class="op" id="5397810">&gt;</span>&nbsp;<span class="num" id="5397812">0</span>&nbsp;<span class="op" id="5397814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397820">break</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397834">runes</span>&nbsp;<span class="op" id="5397840">:=</span>&nbsp;<span class="op" id="5397843">[</span><span class="op" id="5397844">]</span><span class="builtintype" id="5397845">rune</span><span class="op" id="5397849">{</span><span class="op" id="5397850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397855">//&nbsp;expand&nbsp;case-folded&nbsp;runes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397886">if</span>&nbsp;<span class="ident" id="5397889"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5397895">.</span><span class="ident" id="5397896">Flags</span><span class="op" id="5397901">(</span><span class="ident" id="5397902"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397906">.</span><span class="ident" id="5397907">Arg</span><span class="op" id="5397910">)</span><span class="op" id="5397911">&amp;</span><span class="ident" id="5397912"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5397918">.</span><span class="ident" id="5397919">FoldCase</span>&nbsp;<span class="op" id="5397928">!=</span>&nbsp;<span class="num" id="5397931">0</span>&nbsp;<span class="op" id="5397933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397939">r0</span>&nbsp;<span class="op" id="5397942">:=</span>&nbsp;<span class="ident" id="5397945"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5397949">.</span><span class="ident" id="5397950">Rune</span><span class="op" id="5397954">[</span><span class="num" id="5397955">0</span><span class="op" id="5397956">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397962"><a href="/regexp/onepass.go.html#5397834">runes</a></span>&nbsp;<span class="op" id="5397968">=</span>&nbsp;<span class="builtinfunc" id="5397970">append</span><span class="op" id="5397976">(</span><span class="ident" id="5397977"><a href="/regexp/onepass.go.html#5397834">runes</a></span><span class="op" id="5397982">,</span>&nbsp;<span class="ident" id="5397984"><a href="/regexp/onepass.go.html#5397939">r0</a></span><span class="op" id="5397986">,</span>&nbsp;<span class="ident" id="5397988"><a href="/regexp/onepass.go.html#5397939">r0</a></span><span class="op" id="5397990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397996">for</span>&nbsp;<span class="ident" id="5398000">r1</span>&nbsp;<span class="op" id="5398003">:=</span>&nbsp;<span class="ident" id="5398006"><a href="/regexp/onepass.go.html#5386159">unicode</a></span><span class="op" id="5398013">.</span><span class="ident" id="5398014">SimpleFold</span><span class="op" id="5398024">(</span><span class="ident" id="5398025"><a href="/regexp/onepass.go.html#5397939">r0</a></span><span class="op" id="5398027">)</span><span class="op" id="5398028">;</span>&nbsp;<span class="ident" id="5398030"><a href="/regexp/onepass.go.html#5398000">r1</a></span>&nbsp;<span class="op" id="5398033">!=</span>&nbsp;<span class="ident" id="5398036"><a href="/regexp/onepass.go.html#5397939">r0</a></span><span class="op" id="5398038">;</span>&nbsp;<span class="ident" id="5398040"><a href="/regexp/onepass.go.html#5398000">r1</a></span>&nbsp;<span class="op" id="5398043">=</span>&nbsp;<span class="ident" id="5398045"><a href="/regexp/onepass.go.html#5386159">unicode</a></span><span class="op" id="5398052">.</span><span class="ident" id="5398053">SimpleFold</span><span class="op" id="5398063">(</span><span class="ident" id="5398064"><a href="/regexp/onepass.go.html#5398000">r1</a></span><span class="op" id="5398066">)</span>&nbsp;<span class="op" id="5398068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398075"><a href="/regexp/onepass.go.html#5397834">runes</a></span>&nbsp;<span class="op" id="5398081">=</span>&nbsp;<span class="builtinfunc" id="5398083">append</span><span class="op" id="5398089">(</span><span class="ident" id="5398090"><a href="/regexp/onepass.go.html#5397834">runes</a></span><span class="op" id="5398095">,</span>&nbsp;<span class="ident" id="5398097"><a href="/regexp/onepass.go.html#5398000">r1</a></span><span class="op" id="5398099">,</span>&nbsp;<span class="ident" id="5398101"><a href="/regexp/onepass.go.html#5398000">r1</a></span><span class="op" id="5398103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398115"><a href="/regexp/onepass.go.html#5386151">sort</a></span><span class="op" id="5398119">.</span><span class="ident" id="5398120">Sort</span><span class="op" id="5398124">(</span><span class="ident" id="5398125"><a href="/regexp/onepass.go.html#5393748">runeSlice</a></span><span class="op" id="5398134">(</span><span class="ident" id="5398135"><a href="/regexp/onepass.go.html#5397834">runes</a></span><span class="op" id="5398140">)</span><span class="op" id="5398141">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398146">}</span>&nbsp;<span class="keyword" id="5398148">else</span>&nbsp;<span class="op" id="5398153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398159"><a href="/regexp/onepass.go.html#5397834">runes</a></span>&nbsp;<span class="op" id="5398165">=</span>&nbsp;<span class="builtinfunc" id="5398167">append</span><span class="op" id="5398173">(</span><span class="ident" id="5398174"><a href="/regexp/onepass.go.html#5397834">runes</a></span><span class="op" id="5398179">,</span>&nbsp;<span class="ident" id="5398181"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398185">.</span><span class="ident" id="5398186">Rune</span><span class="op" id="5398190">[</span><span class="num" id="5398191">0</span><span class="op" id="5398192">]</span><span class="op" id="5398193">,</span>&nbsp;<span class="ident" id="5398195"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398199">.</span><span class="ident" id="5398200">Rune</span><span class="op" id="5398204">[</span><span class="num" id="5398205">0</span><span class="op" id="5398206">]</span><span class="op" id="5398207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398217"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5398229">[</span><span class="ident" id="5398230"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398232">]</span>&nbsp;<span class="op" id="5398234">=</span>&nbsp;<span class="ident" id="5398236"><a href="/regexp/onepass.go.html#5397834">runes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398245"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398249">.</span><span class="ident" id="5398250">Next</span>&nbsp;<span class="op" id="5398255">=</span>&nbsp;<span class="op" id="5398257">[</span><span class="op" id="5398258">]</span><span class="builtintype" id="5398259">uint32</span><span class="op" id="5398265">{</span><span class="op" id="5398266">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398271">for</span>&nbsp;<span class="ident" id="5398275">i</span>&nbsp;<span class="op" id="5398277">:=</span>&nbsp;<span class="builtinfunc" id="5398280">len</span><span class="op" id="5398283">(</span><span class="ident" id="5398284"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5398296">[</span><span class="ident" id="5398297"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398299">]</span><span class="op" id="5398300">)</span>&nbsp;<span class="op" id="5398302">/</span>&nbsp;<span class="num" id="5398304">2</span><span class="op" id="5398305">;</span>&nbsp;<span class="ident" id="5398307"><a href="/regexp/onepass.go.html#5398275">i</a></span>&nbsp;<span class="op" id="5398309">&gt;=</span>&nbsp;<span class="num" id="5398312">0</span><span class="op" id="5398313">;</span>&nbsp;<span class="ident" id="5398315"><a href="/regexp/onepass.go.html#5398275">i</a></span><span class="op" id="5398316">--</span>&nbsp;<span class="op" id="5398319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398325"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398329">.</span><span class="ident" id="5398330">Next</span>&nbsp;<span class="op" id="5398335">=</span>&nbsp;<span class="builtinfunc" id="5398337">append</span><span class="op" id="5398343">(</span><span class="ident" id="5398344"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398348">.</span><span class="ident" id="5398349">Next</span><span class="op" id="5398353">,</span>&nbsp;<span class="ident" id="5398355"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398359">.</span><span class="ident" id="5398360">Out</span><span class="op" id="5398363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398373"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398377">.</span><span class="ident" id="5398378">Op</span>&nbsp;<span class="op" id="5398381">=</span>&nbsp;<span class="ident" id="5398383"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5398389">.</span><span class="ident" id="5398390">InstRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398401">case</span>&nbsp;<span class="ident" id="5398406"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5398412">.</span><span class="ident" id="5398413">InstRuneAny</span><span class="op" id="5398424">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398429"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5398432">=</span>&nbsp;<span class="ident" id="5398434"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5398439">(</span><span class="ident" id="5398440"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398444">.</span><span class="ident" id="5398445">Out</span><span class="op" id="5398448">,</span>&nbsp;<span class="ident" id="5398450"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5398451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398456"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5398457">[</span><span class="ident" id="5398458"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398460">]</span>&nbsp;<span class="op" id="5398462">=</span>&nbsp;<span class="builtintype" id="5398464">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398473">if</span>&nbsp;<span class="builtinfunc" id="5398476">len</span><span class="op" id="5398479">(</span><span class="ident" id="5398480"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398484">.</span><span class="ident" id="5398485">Next</span><span class="op" id="5398489">)</span>&nbsp;<span class="op" id="5398491">&gt;</span>&nbsp;<span class="num" id="5398493">0</span>&nbsp;<span class="op" id="5398495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398501">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398510">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398515"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5398527">[</span><span class="ident" id="5398528"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398530">]</span>&nbsp;<span class="op" id="5398532">=</span>&nbsp;<span class="builtinfunc" id="5398534">append</span><span class="op" id="5398540">(</span><span class="op" id="5398541">[</span><span class="op" id="5398542">]</span><span class="builtintype" id="5398543">rune</span><span class="op" id="5398547">{</span><span class="op" id="5398548">}</span><span class="op" id="5398549">,</span>&nbsp;<span class="ident" id="5398551"><a href="/regexp/onepass.go.html#5394101">anyRune</a></span><span class="op" id="5398558">...</span><span class="op" id="5398561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398566"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398570">.</span><span class="ident" id="5398571">Next</span>&nbsp;<span class="op" id="5398576">=</span>&nbsp;<span class="op" id="5398578">[</span><span class="op" id="5398579">]</span><span class="builtintype" id="5398580">uint32</span><span class="op" id="5398586">{</span><span class="ident" id="5398587"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398591">.</span><span class="ident" id="5398592">Out</span><span class="op" id="5398595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398599">case</span>&nbsp;<span class="ident" id="5398604"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5398610">.</span><span class="ident" id="5398611">InstRuneAnyNotNL</span><span class="op" id="5398627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398632"><a href="/regexp/onepass.go.html#5395370">ok</a></span>&nbsp;<span class="op" id="5398635">=</span>&nbsp;<span class="ident" id="5398637"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5398642">(</span><span class="ident" id="5398643"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398647">.</span><span class="ident" id="5398648">Out</span><span class="op" id="5398651">,</span>&nbsp;<span class="ident" id="5398653"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5398654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398659"><a href="/regexp/onepass.go.html#5395350">m</a></span><span class="op" id="5398660">[</span><span class="ident" id="5398661"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398663">]</span>&nbsp;<span class="op" id="5398665">=</span>&nbsp;<span class="builtintype" id="5398667">false</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398676">if</span>&nbsp;<span class="builtinfunc" id="5398679">len</span><span class="op" id="5398682">(</span><span class="ident" id="5398683"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398687">.</span><span class="ident" id="5398688">Next</span><span class="op" id="5398692">)</span>&nbsp;<span class="op" id="5398694">&gt;</span>&nbsp;<span class="num" id="5398696">0</span>&nbsp;<span class="op" id="5398698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398704">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398718"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5398730">[</span><span class="ident" id="5398731"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398733">]</span>&nbsp;<span class="op" id="5398735">=</span>&nbsp;<span class="builtinfunc" id="5398737">append</span><span class="op" id="5398743">(</span><span class="op" id="5398744">[</span><span class="op" id="5398745">]</span><span class="builtintype" id="5398746">rune</span><span class="op" id="5398750">{</span><span class="op" id="5398751">}</span><span class="op" id="5398752">,</span>&nbsp;<span class="ident" id="5398754"><a href="/regexp/onepass.go.html#5394035">anyRuneNotNL</a></span><span class="op" id="5398766">...</span><span class="op" id="5398769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398774"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398778">.</span><span class="ident" id="5398779">Next</span>&nbsp;<span class="op" id="5398784">=</span>&nbsp;<span class="op" id="5398786">[</span><span class="op" id="5398787">]</span><span class="builtintype" id="5398788">uint32</span><span class="op" id="5398794">{</span><span class="op" id="5398795">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398800">for</span>&nbsp;<span class="ident" id="5398804">i</span>&nbsp;<span class="op" id="5398806">:=</span>&nbsp;<span class="builtinfunc" id="5398809">len</span><span class="op" id="5398812">(</span><span class="ident" id="5398813"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5398825">[</span><span class="ident" id="5398826"><a href="/regexp/onepass.go.html#5395339">pc</a></span><span class="op" id="5398828">]</span><span class="op" id="5398829">)</span>&nbsp;<span class="op" id="5398831">/</span>&nbsp;<span class="num" id="5398833">2</span><span class="op" id="5398834">;</span>&nbsp;<span class="ident" id="5398836"><a href="/regexp/onepass.go.html#5398804">i</a></span>&nbsp;<span class="op" id="5398838">&gt;=</span>&nbsp;<span class="num" id="5398841">0</span><span class="op" id="5398842">;</span>&nbsp;<span class="ident" id="5398844"><a href="/regexp/onepass.go.html#5398804">i</a></span><span class="op" id="5398845">--</span>&nbsp;<span class="op" id="5398848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398854"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398858">.</span><span class="ident" id="5398859">Next</span>&nbsp;<span class="op" id="5398864">=</span>&nbsp;<span class="builtinfunc" id="5398866">append</span><span class="op" id="5398872">(</span><span class="ident" id="5398873"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398877">.</span><span class="ident" id="5398878">Next</span><span class="op" id="5398882">,</span>&nbsp;<span class="ident" id="5398884"><a href="/regexp/onepass.go.html#5395395">inst</a></span><span class="op" id="5398888">.</span><span class="ident" id="5398889">Out</span><span class="op" id="5398892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398905">return</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398917"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5398926">.</span><span class="ident" id="5398927">clear</span><span class="op" id="5398932">(</span><span class="op" id="5398933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398936"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5398945">.</span><span class="ident" id="5398946">insert</span><span class="op" id="5398952">(</span><span class="builtintype" id="5398953">uint32</span><span class="op" id="5398959">(</span><span class="ident" id="5398960"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5398961">.</span><span class="ident" id="5398962">Start</span><span class="op" id="5398967">)</span><span class="op" id="5398968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398971">m</span>&nbsp;<span class="op" id="5398973">:=</span>&nbsp;<span class="builtinfunc" id="5398976">make</span><span class="op" id="5398980">(</span><span class="keyword" id="5398981">map</span><span class="op" id="5398984">[</span><span class="builtintype" id="5398985">uint32</span><span class="op" id="5398991">]</span><span class="builtintype" id="5398992">bool</span><span class="op" id="5398996">,</span>&nbsp;<span class="builtinfunc" id="5398998">len</span><span class="op" id="5399001">(</span><span class="ident" id="5399002"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5399003">.</span><span class="ident" id="5399004">Inst</span><span class="op" id="5399008">)</span><span class="op" id="5399009">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399012">for</span>&nbsp;<span class="op" id="5399016">!</span><span class="ident" id="5399017"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5399026">.</span><span class="ident" id="5399027">empty</span><span class="op" id="5399032">(</span><span class="op" id="5399033">)</span>&nbsp;<span class="op" id="5399035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399039">pc</span>&nbsp;<span class="op" id="5399042">:=</span>&nbsp;<span class="ident" id="5399045"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5399054">.</span><span class="ident" id="5399055">next</span><span class="op" id="5399059">(</span><span class="op" id="5399060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399064">inst</span>&nbsp;<span class="op" id="5399069">:=</span>&nbsp;<span class="ident" id="5399072"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5399073">.</span><span class="ident" id="5399074">Inst</span><span class="op" id="5399078">[</span><span class="ident" id="5399079"><a href="/regexp/onepass.go.html#5399039">pc</a></span><span class="op" id="5399081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399085"><a href="/regexp/onepass.go.html#5394721">visitQueue</a></span><span class="op" id="5399095">.</span><span class="ident" id="5399096">clear</span><span class="op" id="5399101">(</span><span class="op" id="5399102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399106">if</span>&nbsp;<span class="op" id="5399109">!</span><span class="ident" id="5399110"><a href="/regexp/onepass.go.html#5394803">check</a></span><span class="op" id="5399115">(</span><span class="builtintype" id="5399116">uint32</span><span class="op" id="5399122">(</span><span class="ident" id="5399123"><a href="/regexp/onepass.go.html#5399039">pc</a></span><span class="op" id="5399125">)</span><span class="op" id="5399126">,</span>&nbsp;<span class="ident" id="5399128"><a href="/regexp/onepass.go.html#5398971">m</a></span><span class="op" id="5399129">)</span>&nbsp;<span class="op" id="5399131">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399136"><a href="/regexp/onepass.go.html#5394502">p</a></span>&nbsp;<span class="op" id="5399138">=</span>&nbsp;<span class="ident" id="5399140"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399154">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399166">switch</span>&nbsp;<span class="ident" id="5399173"><a href="/regexp/onepass.go.html#5399064">inst</a></span><span class="op" id="5399177">.</span><span class="ident" id="5399178">Op</span>&nbsp;<span class="op" id="5399181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399185">case</span>&nbsp;<span class="ident" id="5399190"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399196">.</span><span class="ident" id="5399197">InstAlt</span><span class="op" id="5399204">,</span>&nbsp;<span class="ident" id="5399206"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399212">.</span><span class="ident" id="5399213">InstAltMatch</span><span class="op" id="5399225">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399230"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5399239">.</span><span class="ident" id="5399240">insert</span><span class="op" id="5399246">(</span><span class="ident" id="5399247"><a href="/regexp/onepass.go.html#5399064">inst</a></span><span class="op" id="5399251">.</span><span class="ident" id="5399252">Out</span><span class="op" id="5399255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399260"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5399269">.</span><span class="ident" id="5399270">insert</span><span class="op" id="5399276">(</span><span class="ident" id="5399277"><a href="/regexp/onepass.go.html#5399064">inst</a></span><span class="op" id="5399281">.</span><span class="ident" id="5399282">Arg</span><span class="op" id="5399285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399289">case</span>&nbsp;<span class="ident" id="5399294"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399300">.</span><span class="ident" id="5399301">InstCapture</span><span class="op" id="5399312">,</span>&nbsp;<span class="ident" id="5399314"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399320">.</span><span class="ident" id="5399321">InstEmptyWidth</span><span class="op" id="5399335">,</span>&nbsp;<span class="ident" id="5399337"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399343">.</span><span class="ident" id="5399344">InstNop</span><span class="op" id="5399351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399356"><a href="/regexp/onepass.go.html#5394682">instQueue</a></span><span class="op" id="5399365">.</span><span class="ident" id="5399366">insert</span><span class="op" id="5399372">(</span><span class="ident" id="5399373"><a href="/regexp/onepass.go.html#5399064">inst</a></span><span class="op" id="5399377">.</span><span class="ident" id="5399378">Out</span><span class="op" id="5399381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399385">case</span>&nbsp;<span class="ident" id="5399390"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399396">.</span><span class="ident" id="5399397">InstMatch</span><span class="op" id="5399406">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399410">case</span>&nbsp;<span class="ident" id="5399415"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399421">.</span><span class="ident" id="5399422">InstFail</span><span class="op" id="5399430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399434">case</span>&nbsp;<span class="ident" id="5399439"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399445">.</span><span class="ident" id="5399446">InstRune</span><span class="op" id="5399454">,</span>&nbsp;<span class="ident" id="5399456"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399462">.</span><span class="ident" id="5399463">InstRune1</span><span class="op" id="5399472">,</span>&nbsp;<span class="ident" id="5399474"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399480">.</span><span class="ident" id="5399481">InstRuneAny</span><span class="op" id="5399492">,</span>&nbsp;<span class="ident" id="5399494"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399500">.</span><span class="ident" id="5399501">InstRuneAnyNotNL</span><span class="op" id="5399517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399521">default</span><span class="op" id="5399528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399535">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399538">if</span>&nbsp;<span class="ident" id="5399541"><a href="/regexp/onepass.go.html#5394502">p</a></span>&nbsp;<span class="op" id="5399543">!=</span>&nbsp;<span class="ident" id="5399546"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span>&nbsp;<span class="op" id="5399557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399561">for</span>&nbsp;<span class="ident" id="5399565">i</span>&nbsp;<span class="op" id="5399567">:=</span>&nbsp;<span class="keyword" id="5399570">range</span>&nbsp;<span class="ident" id="5399576"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5399577">.</span><span class="ident" id="5399578">Inst</span>&nbsp;<span class="op" id="5399583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399588"><a href="/regexp/onepass.go.html#5394502">p</a></span><span class="op" id="5399589">.</span><span class="ident" id="5399590">Inst</span><span class="op" id="5399594">[</span><span class="ident" id="5399595"><a href="/regexp/onepass.go.html#5399565">i</a></span><span class="op" id="5399596">]</span><span class="op" id="5399597">.</span><span class="ident" id="5399598">Rune</span>&nbsp;<span class="op" id="5399603">=</span>&nbsp;<span class="ident" id="5399605"><a href="/regexp/onepass.go.html#5394853">onePassRunes</a></span><span class="op" id="5399617">[</span><span class="ident" id="5399618"><a href="/regexp/onepass.go.html#5399565">i</a></span><span class="op" id="5399619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399626">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399629">return</span>&nbsp;<span class="ident" id="5399636"><a href="/regexp/onepass.go.html#5394502">p</a></span><br>
<span class="lineno"></span><span class="op" id="5399638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5399641">//&nbsp;walk&nbsp;visits&nbsp;each&nbsp;Inst&nbsp;in&nbsp;the&nbsp;prog&nbsp;once,&nbsp;and&nbsp;applies&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="5399709">//&nbsp;function(ip,&nbsp;next),&nbsp;in&nbsp;pre-order.</span><br>
<span class="lineno">495</span><span class="keyword" id="5399746">func</span>&nbsp;<span class="ident" id="5399751">walk</span><span class="op" id="5399755">(</span><span class="ident" id="5399756">prog</span>&nbsp;<span class="op" id="5399761">*</span><span class="ident" id="5399762"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5399768">.</span><span class="ident" id="5399769">Prog</span><span class="op" id="5399773">,</span>&nbsp;<span class="ident" id="5399775">funcs</span>&nbsp;<span class="op" id="5399781">...</span><span class="keyword" id="5399784">func</span><span class="op" id="5399788">(</span><span class="ident" id="5399789">ip</span><span class="op" id="5399791">,</span>&nbsp;<span class="ident" id="5399793">next</span>&nbsp;<span class="builtintype" id="5399798">uint32</span><span class="op" id="5399804">)</span><span class="op" id="5399805">)</span>&nbsp;<span class="op" id="5399807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399810">var</span>&nbsp;<span class="ident" id="5399814">walk1</span>&nbsp;<span class="keyword" id="5399820">func</span><span class="op" id="5399824">(</span><span class="builtintype" id="5399825">uint32</span><span class="op" id="5399831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399834">progQueue</span>&nbsp;<span class="op" id="5399844">:=</span>&nbsp;<span class="ident" id="5399847"><a href="/regexp/onepass.go.html#5389609">newQueue</a></span><span class="op" id="5399855">(</span><span class="builtinfunc" id="5399856">len</span><span class="op" id="5399859">(</span><span class="ident" id="5399860"><a href="/regexp/onepass.go.html#5399756">prog</a></span><span class="op" id="5399864">.</span><span class="ident" id="5399865">Inst</span><span class="op" id="5399869">)</span><span class="op" id="5399870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399873"><a href="/regexp/onepass.go.html#5399814">walk1</a></span>&nbsp;<span class="op" id="5399879">=</span>&nbsp;<span class="keyword" id="5399881">func</span><span class="op" id="5399885">(</span><span class="ident" id="5399886">ip</span>&nbsp;<span class="builtintype" id="5399889">uint32</span><span class="op" id="5399895">)</span>&nbsp;<span class="op" id="5399897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399901">if</span>&nbsp;<span class="ident" id="5399904"><a href="/regexp/onepass.go.html#5399834">progQueue</a></span><span class="op" id="5399913">.</span><span class="ident" id="5399914">contains</span><span class="op" id="5399922">(</span><span class="ident" id="5399923"><a href="/regexp/onepass.go.html#5399886">ip</a></span><span class="op" id="5399925">)</span>&nbsp;<span class="op" id="5399927">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399932">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399945"><a href="/regexp/onepass.go.html#5399834">progQueue</a></span><span class="op" id="5399954">.</span><span class="ident" id="5399955">insert</span><span class="op" id="5399961">(</span><span class="ident" id="5399962"><a href="/regexp/onepass.go.html#5399886">ip</a></span><span class="op" id="5399964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399968">inst</span>&nbsp;<span class="op" id="5399973">:=</span>&nbsp;<span class="ident" id="5399976"><a href="/regexp/onepass.go.html#5399756">prog</a></span><span class="op" id="5399980">.</span><span class="ident" id="5399981">Inst</span><span class="op" id="5399985">[</span><span class="ident" id="5399986"><a href="/regexp/onepass.go.html#5399886">ip</a></span><span class="op" id="5399988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399992">switch</span>&nbsp;<span class="ident" id="5399999"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400003">.</span><span class="ident" id="5400004">Op</span>&nbsp;<span class="op" id="5400007">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400011">case</span>&nbsp;<span class="ident" id="5400016"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5400022">.</span><span class="ident" id="5400023">InstAlt</span><span class="op" id="5400030">,</span>&nbsp;<span class="ident" id="5400032"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5400038">.</span><span class="ident" id="5400039">InstAltMatch</span><span class="op" id="5400051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400056">for</span>&nbsp;<span class="ident" id="5400060">_</span><span class="op" id="5400061">,</span>&nbsp;<span class="ident" id="5400063">f</span>&nbsp;<span class="op" id="5400065">:=</span>&nbsp;<span class="keyword" id="5400068">range</span>&nbsp;<span class="ident" id="5400074"><a href="/regexp/onepass.go.html#5399775">funcs</a></span>&nbsp;<span class="op" id="5400080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400086"><a href="/regexp/onepass.go.html#5400063">f</a></span><span class="op" id="5400087">(</span><span class="ident" id="5400088"><a href="/regexp/onepass.go.html#5399886">ip</a></span><span class="op" id="5400090">,</span>&nbsp;<span class="ident" id="5400092"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400096">.</span><span class="ident" id="5400097">Out</span><span class="op" id="5400100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400106"><a href="/regexp/onepass.go.html#5400063">f</a></span><span class="op" id="5400107">(</span><span class="ident" id="5400108"><a href="/regexp/onepass.go.html#5399886">ip</a></span><span class="op" id="5400110">,</span>&nbsp;<span class="ident" id="5400112"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400116">.</span><span class="ident" id="5400117">Arg</span><span class="op" id="5400120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400125">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400130"><a href="/regexp/onepass.go.html#5399814">walk1</a></span><span class="op" id="5400135">(</span><span class="ident" id="5400136"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400140">.</span><span class="ident" id="5400141">Out</span><span class="op" id="5400144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400149"><a href="/regexp/onepass.go.html#5399814">walk1</a></span><span class="op" id="5400154">(</span><span class="ident" id="5400155"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400159">.</span><span class="ident" id="5400160">Arg</span><span class="op" id="5400163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400167">default</span><span class="op" id="5400174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400179">for</span>&nbsp;<span class="ident" id="5400183">_</span><span class="op" id="5400184">,</span>&nbsp;<span class="ident" id="5400186">f</span>&nbsp;<span class="op" id="5400188">:=</span>&nbsp;<span class="keyword" id="5400191">range</span>&nbsp;<span class="ident" id="5400197"><a href="/regexp/onepass.go.html#5399775">funcs</a></span>&nbsp;<span class="op" id="5400203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400209"><a href="/regexp/onepass.go.html#5400186">f</a></span><span class="op" id="5400210">(</span><span class="ident" id="5400211"><a href="/regexp/onepass.go.html#5399886">ip</a></span><span class="op" id="5400213">,</span>&nbsp;<span class="ident" id="5400215"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400219">.</span><span class="ident" id="5400220">Out</span><span class="op" id="5400223">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400233"><a href="/regexp/onepass.go.html#5399814">walk1</a></span><span class="op" id="5400238">(</span><span class="ident" id="5400239"><a href="/regexp/onepass.go.html#5399968">inst</a></span><span class="op" id="5400243">.</span><span class="ident" id="5400244">Out</span><span class="op" id="5400247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400257"><a href="/regexp/onepass.go.html#5399814">walk1</a></span><span class="op" id="5400262">(</span><span class="builtintype" id="5400263">uint32</span><span class="op" id="5400269">(</span><span class="ident" id="5400270"><a href="/regexp/onepass.go.html#5399756">prog</a></span><span class="op" id="5400274">.</span><span class="ident" id="5400275">Start</span><span class="op" id="5400280">)</span><span class="op" id="5400281">)</span><br>
<span class="lineno">520</span><span class="op" id="5400283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5400286">//&nbsp;find&nbsp;returns&nbsp;the&nbsp;Insts&nbsp;that&nbsp;match&nbsp;the&nbsp;argument&nbsp;predicate&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="5400355">func</span>&nbsp;<span class="ident" id="5400360">find</span><span class="op" id="5400364">(</span><span class="ident" id="5400365">prog</span>&nbsp;<span class="op" id="5400370">*</span><span class="ident" id="5400371"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5400377">.</span><span class="ident" id="5400378">Prog</span><span class="op" id="5400382">,</span>&nbsp;<span class="ident" id="5400384">f</span>&nbsp;<span class="keyword" id="5400386">func</span><span class="op" id="5400390">(</span><span class="op" id="5400391">*</span><span class="ident" id="5400392"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5400398">.</span><span class="ident" id="5400399">Prog</span><span class="op" id="5400403">,</span>&nbsp;<span class="builtintype" id="5400405">int</span><span class="op" id="5400408">)</span>&nbsp;<span class="builtintype" id="5400410">bool</span><span class="op" id="5400414">)</span>&nbsp;<span class="op" id="5400416">(</span><span class="ident" id="5400417">matches</span>&nbsp;<span class="op" id="5400425">[</span><span class="op" id="5400426">]</span><span class="builtintype" id="5400427">uint32</span><span class="op" id="5400433">)</span>&nbsp;<span class="op" id="5400435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400438"><a href="/regexp/onepass.go.html#5400417">matches</a></span>&nbsp;<span class="op" id="5400446">=</span>&nbsp;<span class="op" id="5400448">[</span><span class="op" id="5400449">]</span><span class="builtintype" id="5400450">uint32</span><span class="op" id="5400456">{</span><span class="op" id="5400457">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400461">for</span>&nbsp;<span class="ident" id="5400465">ip</span>&nbsp;<span class="op" id="5400468">:=</span>&nbsp;<span class="keyword" id="5400471">range</span>&nbsp;<span class="ident" id="5400477"><a href="/regexp/onepass.go.html#5400365">prog</a></span><span class="op" id="5400481">.</span><span class="ident" id="5400482">Inst</span>&nbsp;<span class="op" id="5400487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400491">if</span>&nbsp;<span class="ident" id="5400494"><a href="/regexp/onepass.go.html#5400384">f</a></span><span class="op" id="5400495">(</span><span class="ident" id="5400496"><a href="/regexp/onepass.go.html#5400365">prog</a></span><span class="op" id="5400500">,</span>&nbsp;<span class="ident" id="5400502"><a href="/regexp/onepass.go.html#5400465">ip</a></span><span class="op" id="5400504">)</span>&nbsp;<span class="op" id="5400506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400511"><a href="/regexp/onepass.go.html#5400417">matches</a></span>&nbsp;<span class="op" id="5400519">=</span>&nbsp;<span class="builtinfunc" id="5400521">append</span><span class="op" id="5400527">(</span><span class="ident" id="5400528"><a href="/regexp/onepass.go.html#5400417">matches</a></span><span class="op" id="5400535">,</span>&nbsp;<span class="builtintype" id="5400537">uint32</span><span class="op" id="5400543">(</span><span class="ident" id="5400544"><a href="/regexp/onepass.go.html#5400465">ip</a></span><span class="op" id="5400546">)</span><span class="op" id="5400547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400551">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400557">return</span><br>
<span class="lineno"></span><span class="op" id="5400564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5400567">var</span>&nbsp;<span class="ident" id="5400571">notOnePass</span>&nbsp;<span class="op" id="5400582">*</span><span class="ident" id="5400583"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span>&nbsp;<span class="op" id="5400595">=</span>&nbsp;<span class="ident" id="5400597">nil</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="5400602">//&nbsp;compileOnePass&nbsp;returns&nbsp;a&nbsp;new&nbsp;*syntax.Prog&nbsp;suitable&nbsp;for&nbsp;onePass&nbsp;execution&nbsp;if&nbsp;the&nbsp;original&nbsp;Prog</span><br>
<span class="lineno"></span><span class="comment" id="5400699">//&nbsp;can&nbsp;be&nbsp;recharacterized&nbsp;as&nbsp;a&nbsp;one-pass&nbsp;regexp&nbsp;program,&nbsp;or&nbsp;syntax.notOnePass&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5400783">//&nbsp;Prog&nbsp;cannot&nbsp;be&nbsp;converted.&nbsp;For&nbsp;a&nbsp;one&nbsp;pass&nbsp;prog,&nbsp;the&nbsp;fundamental&nbsp;condition&nbsp;that&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5400869">//&nbsp;be&nbsp;true&nbsp;is:&nbsp;at&nbsp;any&nbsp;InstAlt,&nbsp;there&nbsp;must&nbsp;be&nbsp;no&nbsp;ambiguity&nbsp;about&nbsp;what&nbsp;branch&nbsp;to&nbsp;&nbsp;take.</span><br>
<span class="lineno">540</span><span class="keyword" id="5400955">func</span>&nbsp;<span class="ident" id="5400960">compileOnePass</span><span class="op" id="5400974">(</span><span class="ident" id="5400975">prog</span>&nbsp;<span class="op" id="5400980">*</span><span class="ident" id="5400981"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5400987">.</span><span class="ident" id="5400988">Prog</span><span class="op" id="5400992">)</span>&nbsp;<span class="op" id="5400994">(</span><span class="ident" id="5400995">p</span>&nbsp;<span class="op" id="5400997">*</span><span class="ident" id="5400998"><a href="/regexp/onepass.go.html#5386585">onePassProg</a></span><span class="op" id="5401009">)</span>&nbsp;<span class="op" id="5401011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401014">if</span>&nbsp;<span class="ident" id="5401017"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401021">.</span><span class="ident" id="5401022">Start</span>&nbsp;<span class="op" id="5401028">==</span>&nbsp;<span class="num" id="5401031">0</span>&nbsp;<span class="op" id="5401033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401037">return</span>&nbsp;<span class="ident" id="5401044"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401059">//&nbsp;onepass&nbsp;regexp&nbsp;is&nbsp;anchored</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401090">if</span>&nbsp;<span class="ident" id="5401093"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401097">.</span><span class="ident" id="5401098">Inst</span><span class="op" id="5401102">[</span><span class="ident" id="5401103"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401107">.</span><span class="ident" id="5401108">Start</span><span class="op" id="5401113">]</span><span class="op" id="5401114">.</span><span class="ident" id="5401115">Op</span>&nbsp;<span class="op" id="5401118">!=</span>&nbsp;<span class="ident" id="5401121"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401127">.</span><span class="ident" id="5401128">InstEmptyWidth</span>&nbsp;<span class="op" id="5401143">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401148"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401154">.</span><span class="ident" id="5401155">EmptyOp</span><span class="op" id="5401162">(</span><span class="ident" id="5401163"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401167">.</span><span class="ident" id="5401168">Inst</span><span class="op" id="5401172">[</span><span class="ident" id="5401173"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401177">.</span><span class="ident" id="5401178">Start</span><span class="op" id="5401183">]</span><span class="op" id="5401184">.</span><span class="ident" id="5401185">Arg</span><span class="op" id="5401188">)</span><span class="op" id="5401189">&amp;</span><span class="ident" id="5401190"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401196">.</span><span class="ident" id="5401197">EmptyBeginText</span>&nbsp;<span class="op" id="5401212">!=</span>&nbsp;<span class="ident" id="5401215"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401221">.</span><span class="ident" id="5401222">EmptyBeginText</span>&nbsp;<span class="op" id="5401237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401241">return</span>&nbsp;<span class="ident" id="5401248"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401263">//&nbsp;every&nbsp;instruction&nbsp;leading&nbsp;to&nbsp;InstMatch&nbsp;must&nbsp;be&nbsp;EmptyEndText</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401327">for</span>&nbsp;<span class="ident" id="5401331">_</span><span class="op" id="5401332">,</span>&nbsp;<span class="ident" id="5401334">inst</span>&nbsp;<span class="op" id="5401339">:=</span>&nbsp;<span class="keyword" id="5401342">range</span>&nbsp;<span class="ident" id="5401348"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401352">.</span><span class="ident" id="5401353">Inst</span>&nbsp;<span class="op" id="5401358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401362">opOut</span>&nbsp;<span class="op" id="5401368">:=</span>&nbsp;<span class="ident" id="5401371"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401375">.</span><span class="ident" id="5401376">Inst</span><span class="op" id="5401380">[</span><span class="ident" id="5401381"><a href="/regexp/onepass.go.html#5401334">inst</a></span><span class="op" id="5401385">.</span><span class="ident" id="5401386">Out</span><span class="op" id="5401389">]</span><span class="op" id="5401390">.</span><span class="ident" id="5401391">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401396">switch</span>&nbsp;<span class="ident" id="5401403"><a href="/regexp/onepass.go.html#5401334">inst</a></span><span class="op" id="5401407">.</span><span class="ident" id="5401408">Op</span>&nbsp;<span class="op" id="5401411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401415">default</span><span class="op" id="5401422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401427">if</span>&nbsp;<span class="ident" id="5401430"><a href="/regexp/onepass.go.html#5401362">opOut</a></span>&nbsp;<span class="op" id="5401436">==</span>&nbsp;<span class="ident" id="5401439"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401445">.</span><span class="ident" id="5401446">InstMatch</span>&nbsp;<span class="op" id="5401456">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401462">return</span>&nbsp;<span class="ident" id="5401469"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401487">case</span>&nbsp;<span class="ident" id="5401492"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401498">.</span><span class="ident" id="5401499">InstAlt</span><span class="op" id="5401506">,</span>&nbsp;<span class="ident" id="5401508"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401514">.</span><span class="ident" id="5401515">InstAltMatch</span><span class="op" id="5401527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401532">if</span>&nbsp;<span class="ident" id="5401535"><a href="/regexp/onepass.go.html#5401362">opOut</a></span>&nbsp;<span class="op" id="5401541">==</span>&nbsp;<span class="ident" id="5401544"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401550">.</span><span class="ident" id="5401551">InstMatch</span>&nbsp;<span class="op" id="5401561">||</span>&nbsp;<span class="ident" id="5401564"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401568">.</span><span class="ident" id="5401569">Inst</span><span class="op" id="5401573">[</span><span class="ident" id="5401574"><a href="/regexp/onepass.go.html#5401334">inst</a></span><span class="op" id="5401578">.</span><span class="ident" id="5401579">Arg</span><span class="op" id="5401582">]</span><span class="op" id="5401583">.</span><span class="ident" id="5401584">Op</span>&nbsp;<span class="op" id="5401587">==</span>&nbsp;<span class="ident" id="5401590"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401596">.</span><span class="ident" id="5401597">InstMatch</span>&nbsp;<span class="op" id="5401607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401613">return</span>&nbsp;<span class="ident" id="5401620"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401638">case</span>&nbsp;<span class="ident" id="5401643"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401649">.</span><span class="ident" id="5401650">InstEmptyWidth</span><span class="op" id="5401664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401669">if</span>&nbsp;<span class="ident" id="5401672"><a href="/regexp/onepass.go.html#5401362">opOut</a></span>&nbsp;<span class="op" id="5401678">==</span>&nbsp;<span class="ident" id="5401681"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401687">.</span><span class="ident" id="5401688">InstMatch</span>&nbsp;<span class="op" id="5401698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401704">if</span>&nbsp;<span class="ident" id="5401707"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401713">.</span><span class="ident" id="5401714">EmptyOp</span><span class="op" id="5401721">(</span><span class="ident" id="5401722"><a href="/regexp/onepass.go.html#5401334">inst</a></span><span class="op" id="5401726">.</span><span class="ident" id="5401727">Arg</span><span class="op" id="5401730">)</span><span class="op" id="5401731">&amp;</span><span class="ident" id="5401732"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401738">.</span><span class="ident" id="5401739">EmptyEndText</span>&nbsp;<span class="op" id="5401752">==</span>&nbsp;<span class="ident" id="5401755"><a href="/regexp/onepass.go.html#5386134">syntax</a></span><span class="op" id="5401761">.</span><span class="ident" id="5401762">EmptyEndText</span>&nbsp;<span class="op" id="5401775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401782">continue</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401801">return</span>&nbsp;<span class="ident" id="5401808"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401829">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401832">//&nbsp;Creates&nbsp;a&nbsp;slightly&nbsp;optimized&nbsp;copy&nbsp;of&nbsp;the&nbsp;original&nbsp;Prog</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401891">//&nbsp;that&nbsp;cleans&nbsp;up&nbsp;some&nbsp;Prog&nbsp;idioms&nbsp;that&nbsp;block&nbsp;valid&nbsp;onepass&nbsp;programs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401961"><a href="/regexp/onepass.go.html#5400995">p</a></span>&nbsp;<span class="op" id="5401963">=</span>&nbsp;<span class="ident" id="5401965"><a href="/regexp/onepass.go.html#5391967">onePassCopy</a></span><span class="op" id="5401976">(</span><span class="ident" id="5401977"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5401981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401985">//&nbsp;checkAmbiguity&nbsp;on&nbsp;InstAlts,&nbsp;build&nbsp;onepass&nbsp;Prog&nbsp;if&nbsp;possible</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402048"><a href="/regexp/onepass.go.html#5400995">p</a></span>&nbsp;<span class="op" id="5402050">=</span>&nbsp;<span class="ident" id="5402052"><a href="/regexp/onepass.go.html#5394490">makeOnePass</a></span><span class="op" id="5402063">(</span><span class="ident" id="5402064"><a href="/regexp/onepass.go.html#5400995">p</a></span><span class="op" id="5402065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402069">if</span>&nbsp;<span class="ident" id="5402072"><a href="/regexp/onepass.go.html#5400995">p</a></span>&nbsp;<span class="op" id="5402074">!=</span>&nbsp;<span class="ident" id="5402077"><a href="/regexp/onepass.go.html#5400571">notOnePass</a></span>&nbsp;<span class="op" id="5402088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402092"><a href="/regexp/onepass.go.html#5391403">cleanupOnePass</a></span><span class="op" id="5402106">(</span><span class="ident" id="5402107"><a href="/regexp/onepass.go.html#5400995">p</a></span><span class="op" id="5402108">,</span>&nbsp;<span class="ident" id="5402110"><a href="/regexp/onepass.go.html#5400975">prog</a></span><span class="op" id="5402114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402117">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402120">return</span>&nbsp;<span class="ident" id="5402127"><a href="/regexp/onepass.go.html#5400995">p</a></span><br>
<span class="lineno"></span><span class="op" id="5402129">}</span>
</div>
</body>
</html>
