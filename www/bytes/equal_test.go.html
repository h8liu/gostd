<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="104770">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="104825">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="104879">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="104929">//</span><br>
<span class="lineno">5</span><span class="comment" id="104932">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="104949">package</span>&nbsp;<span class="ident" id="104957">bytes_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="104969">import</span>&nbsp;<span class="op" id="104976">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="104979">.</span>&nbsp;<span class="string" id="104981">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="104990">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="105001">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="105012">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="105021">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="105024">//&nbsp;This&nbsp;file&nbsp;tests&nbsp;the&nbsp;situation&nbsp;where&nbsp;memeq&nbsp;is&nbsp;checking</span><br>
<span class="lineno"></span><span class="comment" id="105081">//&nbsp;data&nbsp;very&nbsp;near&nbsp;to&nbsp;a&nbsp;page&nbsp;boundary.&nbsp;&nbsp;We&nbsp;want&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span><span class="comment" id="105141">//&nbsp;equal&nbsp;does&nbsp;not&nbsp;read&nbsp;across&nbsp;the&nbsp;boundary&nbsp;and&nbsp;cause&nbsp;a&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="105201">//&nbsp;fault&nbsp;where&nbsp;it&nbsp;shouldn&#39;t.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="105231">//&nbsp;This&nbsp;test&nbsp;runs&nbsp;only&nbsp;on&nbsp;linux.&nbsp;&nbsp;The&nbsp;code&nbsp;being&nbsp;tested&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="105290">//&nbsp;not&nbsp;OS-specific,&nbsp;so&nbsp;it&nbsp;does&nbsp;not&nbsp;need&nbsp;to&nbsp;be&nbsp;tested&nbsp;on&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="105350">//&nbsp;operating&nbsp;systems.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="105373">func</span>&nbsp;<span class="ident" id="105378">TestEqualNearPageBoundary</span><span class="op" id="105403">(</span><span class="ident" id="105404">t</span>&nbsp;<span class="op" id="105406">*</span><span class="ident" id="105407"><a href="/bytes/equal_test.go.html#105001">testing</a></span><span class="op" id="105414">.</span><span class="ident" id="105415">T</span><span class="op" id="105416">)</span>&nbsp;<span class="op" id="105418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="105421">pagesize</span>&nbsp;<span class="op" id="105430">:=</span>&nbsp;<span class="ident" id="105433"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105440">.</span><span class="ident" id="105441">Getpagesize</span><span class="op" id="105452">(</span><span class="op" id="105453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="105456">b</span>&nbsp;<span class="op" id="105458">:=</span>&nbsp;<span class="builtinfunc" id="105461">make</span><span class="op" id="105465">(</span><span class="op" id="105466">[</span><span class="op" id="105467">]</span><span class="builtintype" id="105468">byte</span><span class="op" id="105472">,</span>&nbsp;<span class="num" id="105474">4</span><span class="op" id="105475">*</span><span class="ident" id="105476"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="105487">i</span>&nbsp;<span class="op" id="105489">:=</span>&nbsp;<span class="ident" id="105492"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="105502">for</span>&nbsp;<span class="op" id="105506">;</span>&nbsp;<span class="builtintype" id="105508">uintptr</span><span class="op" id="105515">(</span><span class="ident" id="105516"><a href="/bytes/equal_test.go.html#105012">unsafe</a></span><span class="op" id="105522">.</span><span class="ident" id="105523">Pointer</span><span class="op" id="105530">(</span><span class="op" id="105531">&amp;</span><span class="ident" id="105532"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="105533">[</span><span class="ident" id="105534"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105535">]</span><span class="op" id="105536">)</span><span class="op" id="105537">)</span><span class="op" id="105538">%</span><span class="builtintype" id="105539">uintptr</span><span class="op" id="105546">(</span><span class="ident" id="105547"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105555">)</span>&nbsp;<span class="op" id="105557">!=</span>&nbsp;<span class="num" id="105560">0</span><span class="op" id="105561">;</span>&nbsp;<span class="ident" id="105563"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105564">++</span>&nbsp;<span class="op" id="105567">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="105570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="105573"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105580">.</span><span class="ident" id="105581">Mprotect</span><span class="op" id="105589">(</span><span class="ident" id="105590"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="105591">[</span><span class="ident" id="105592"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105593">-</span><span class="ident" id="105594"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105602">:</span><span class="ident" id="105603"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105604">]</span><span class="op" id="105605">,</span>&nbsp;<span class="num" id="105607">0</span><span class="op" id="105608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="105611"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105618">.</span><span class="ident" id="105619">Mprotect</span><span class="op" id="105627">(</span><span class="ident" id="105628"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="105629">[</span><span class="ident" id="105630"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105631">+</span><span class="ident" id="105632"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105640">:</span><span class="ident" id="105641"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105642">+</span><span class="num" id="105643">2</span><span class="op" id="105644">*</span><span class="ident" id="105645"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105653">]</span><span class="op" id="105654">,</span>&nbsp;<span class="num" id="105656">0</span><span class="op" id="105657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="105660">defer</span>&nbsp;<span class="ident" id="105666"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105673">.</span><span class="ident" id="105674">Mprotect</span><span class="op" id="105682">(</span><span class="ident" id="105683"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="105684">[</span><span class="ident" id="105685"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105686">-</span><span class="ident" id="105687"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105695">:</span><span class="ident" id="105696"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105697">]</span><span class="op" id="105698">,</span>&nbsp;<span class="ident" id="105700"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105707">.</span><span class="ident" id="105708">PROT_READ</span><span class="op" id="105717">|</span><span class="ident" id="105718"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105725">.</span><span class="ident" id="105726">PROT_WRITE</span><span class="op" id="105736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="105739">defer</span>&nbsp;<span class="ident" id="105745"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105752">.</span><span class="ident" id="105753">Mprotect</span><span class="op" id="105761">(</span><span class="ident" id="105762"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="105763">[</span><span class="ident" id="105764"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105765">+</span><span class="ident" id="105766"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105774">:</span><span class="ident" id="105775"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105776">+</span><span class="num" id="105777">2</span><span class="op" id="105778">*</span><span class="ident" id="105779"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105787">]</span><span class="op" id="105788">,</span>&nbsp;<span class="ident" id="105790"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105797">.</span><span class="ident" id="105798">PROT_READ</span><span class="op" id="105807">|</span><span class="ident" id="105808"><a href="/bytes/equal_test.go.html#104990">syscall</a></span><span class="op" id="105815">.</span><span class="ident" id="105816">PROT_WRITE</span><span class="op" id="105826">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="105830">//&nbsp;both&nbsp;of&nbsp;these&nbsp;should&nbsp;fault</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="105861">//pagesize&nbsp;+=&nbsp;int(b[i-1])</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="105888">//pagesize&nbsp;+=&nbsp;int(b[i+pagesize])</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="105923">for</span>&nbsp;<span class="ident" id="105927">j</span>&nbsp;<span class="op" id="105929">:=</span>&nbsp;<span class="num" id="105932">0</span><span class="op" id="105933">;</span>&nbsp;<span class="ident" id="105935"><a href="/bytes/equal_test.go.html#105927">j</a></span>&nbsp;<span class="op" id="105937">&lt;</span>&nbsp;<span class="ident" id="105939"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105947">;</span>&nbsp;<span class="ident" id="105949"><a href="/bytes/equal_test.go.html#105927">j</a></span><span class="op" id="105950">++</span>&nbsp;<span class="op" id="105953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="105957"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="105958">[</span><span class="ident" id="105959"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="105960">+</span><span class="ident" id="105961"><a href="/bytes/equal_test.go.html#105927">j</a></span><span class="op" id="105962">]</span>&nbsp;<span class="op" id="105964">=</span>&nbsp;<span class="string" id="105966">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="105971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="105974">for</span>&nbsp;<span class="ident" id="105978">j</span>&nbsp;<span class="op" id="105980">:=</span>&nbsp;<span class="num" id="105983">0</span><span class="op" id="105984">;</span>&nbsp;<span class="ident" id="105986"><a href="/bytes/equal_test.go.html#105978">j</a></span>&nbsp;<span class="op" id="105988">&lt;=</span>&nbsp;<span class="ident" id="105991"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="105999">;</span>&nbsp;<span class="ident" id="106001"><a href="/bytes/equal_test.go.html#105978">j</a></span><span class="op" id="106002">++</span>&nbsp;<span class="op" id="106005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="106009"><a href="/bytes/bytes_decl.go.html#3207918">Equal</a></span><span class="op" id="106014">(</span><span class="ident" id="106015"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="106016">[</span><span class="ident" id="106017"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106018">:</span><span class="ident" id="106019"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106020">+</span><span class="ident" id="106021"><a href="/bytes/equal_test.go.html#105978">j</a></span><span class="op" id="106022">]</span><span class="op" id="106023">,</span>&nbsp;<span class="ident" id="106025"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="106026">[</span><span class="ident" id="106027"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106028">+</span><span class="ident" id="106029"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="106037">-</span><span class="ident" id="106038"><a href="/bytes/equal_test.go.html#105978">j</a></span><span class="op" id="106039">:</span><span class="ident" id="106040"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106041">+</span><span class="ident" id="106042"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="106050">]</span><span class="op" id="106051">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="106055"><a href="/bytes/bytes_decl.go.html#3207918">Equal</a></span><span class="op" id="106060">(</span><span class="ident" id="106061"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="106062">[</span><span class="ident" id="106063"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106064">+</span><span class="ident" id="106065"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="106073">-</span><span class="ident" id="106074"><a href="/bytes/equal_test.go.html#105978">j</a></span><span class="op" id="106075">:</span><span class="ident" id="106076"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106077">+</span><span class="ident" id="106078"><a href="/bytes/equal_test.go.html#105421">pagesize</a></span><span class="op" id="106086">]</span><span class="op" id="106087">,</span>&nbsp;<span class="ident" id="106089"><a href="/bytes/equal_test.go.html#105456">b</a></span><span class="op" id="106090">[</span><span class="ident" id="106091"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106092">:</span><span class="ident" id="106093"><a href="/bytes/equal_test.go.html#105487">i</a></span><span class="op" id="106094">+</span><span class="ident" id="106095"><a href="/bytes/equal_test.go.html#105978">j</a></span><span class="op" id="106096">]</span><span class="op" id="106097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="106100">}</span><br>
<span class="lineno"></span><span class="op" id="106102">}</span>
</div>
</body>
</html>
