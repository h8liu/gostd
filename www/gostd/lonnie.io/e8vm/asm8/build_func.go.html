<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/asm8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/asm8/bare_func.go.html">bare_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_file.go.html">build_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_func.go.html">build_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_lib.go.html">build_lib.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_var.go.html">build_var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/builder.go.html">builder.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/check_type.go.html">check_type.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_hex.go.html">data_hex.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_nums.go.html">data_nums.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_str.go.html">data_str.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/file.go.html">file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/func_decl.go.html">func_decl.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/func_stmt.go.html">func_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst.go.html">inst.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_all.go.html">lex_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_all_test.go.html">lex_all_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_comment.go.html">lex_comment.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_operand.go.html">lex_operand.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_string.go.html">lex_string.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lib.go.html">lib.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_arg.go.html">parse_arg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_file.go.html">parse_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func.go.html">parse_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func_stmt.go.html">parse_func_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func_test.go.html">parse_func_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_inst.go.html">parse_inst.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_label.go.html">parse_label.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_reg.go.html">parse_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_sym.go.html">parse_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_var.go.html">parse_var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_var_stmt.go.html">parse_var_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parser.go.html">parser.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/single_file.go.html">single_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/stmt_lexer.go.html">stmt_lexer.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/sym_scope.go.html">sym_scope.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/sym_table.go.html">sym_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/token.go.html">token.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/var_decl.go.html">var_decl.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/var_stmt.go.html">var_stmt.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3625778">package</span>&nbsp;<span class="ident" id="3625786">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3625792">import</span>&nbsp;<span class="op" id="3625799">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3625802">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3625825">&#34;lonnie.io/e8vm/link8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3625848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3625851">//&nbsp;buildFunc&nbsp;builds&nbsp;a&nbsp;function&nbsp;object&nbsp;from&nbsp;a&nbsp;function&nbsp;AST&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3625915">func</span>&nbsp;<span class="ident" id="3625920">buildFunc</span><span class="op" id="3625929">(</span><span class="ident" id="3625930">b</span>&nbsp;<span class="op" id="3625932">*</span><span class="ident" id="3625933">builder</span><span class="op" id="3625940">,</span>&nbsp;<span class="ident" id="3625942">f</span>&nbsp;<span class="op" id="3625944">*</span><span class="ident" id="3625945">funcDecl</span><span class="op" id="3625953">)</span>&nbsp;<span class="op" id="3625955">*</span><span class="ident" id="3625956">link8</span><span class="op" id="3625961">.</span><span class="ident" id="3625962">Func</span>&nbsp;<span class="op" id="3625967">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625970">b</span><span class="op" id="3625971">.</span><span class="ident" id="3625972">scope</span><span class="op" id="3625977">.</span><span class="ident" id="3625978">Push</span><span class="op" id="3625982">(</span><span class="op" id="3625983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625986">defer</span>&nbsp;<span class="ident" id="3625992">b</span><span class="op" id="3625993">.</span><span class="ident" id="3625994">scope</span><span class="op" id="3625999">.</span><span class="ident" id="3626000">Pop</span><span class="op" id="3626003">(</span><span class="op" id="3626004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626008">b</span><span class="op" id="3626009">.</span><span class="ident" id="3626010">clearErr</span><span class="op" id="3626018">(</span><span class="op" id="3626019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626022">declareLabels</span><span class="op" id="3626035">(</span><span class="ident" id="3626036">b</span><span class="op" id="3626037">,</span>&nbsp;<span class="ident" id="3626039">f</span><span class="op" id="3626040">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626043">if</span>&nbsp;<span class="op" id="3626046">!</span><span class="ident" id="3626047">b</span><span class="op" id="3626048">.</span><span class="ident" id="3626049">hasError</span>&nbsp;<span class="op" id="3626058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626062">setOffsets</span><span class="op" id="3626072">(</span><span class="ident" id="3626073">b</span><span class="op" id="3626074">,</span>&nbsp;<span class="ident" id="3626076">f</span><span class="op" id="3626077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626081">fillLabels</span><span class="op" id="3626091">(</span><span class="ident" id="3626092">b</span><span class="op" id="3626093">,</span>&nbsp;<span class="ident" id="3626095">f</span><span class="op" id="3626096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626103">return</span>&nbsp;<span class="ident" id="3626110">makeFuncObj</span><span class="op" id="3626121">(</span><span class="ident" id="3626122">b</span><span class="op" id="3626123">,</span>&nbsp;<span class="ident" id="3626125">f</span><span class="op" id="3626126">)</span><br>
<span class="lineno"></span><span class="op" id="3626128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3626131">//&nbsp;declareLabels&nbsp;adds&nbsp;the&nbsp;labels&nbsp;into&nbsp;the&nbsp;scope,</span><br>
<span class="lineno"></span><span class="comment" id="3626180">//&nbsp;so&nbsp;that&nbsp;later&nbsp;they&nbsp;can&nbsp;be&nbsp;queried&nbsp;for&nbsp;filling.</span><br>
<span class="lineno">25</span><span class="keyword" id="3626230">func</span>&nbsp;<span class="ident" id="3626235">declareLabels</span><span class="op" id="3626248">(</span><span class="ident" id="3626249">b</span>&nbsp;<span class="op" id="3626251">*</span><span class="ident" id="3626252">builder</span><span class="op" id="3626259">,</span>&nbsp;<span class="ident" id="3626261">f</span>&nbsp;<span class="op" id="3626263">*</span><span class="ident" id="3626264">funcDecl</span><span class="op" id="3626272">)</span>&nbsp;<span class="op" id="3626274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626277">for</span>&nbsp;<span class="ident" id="3626281">_</span><span class="op" id="3626282">,</span>&nbsp;<span class="ident" id="3626284">stmt</span>&nbsp;<span class="op" id="3626289">:=</span>&nbsp;<span class="keyword" id="3626292">range</span>&nbsp;<span class="ident" id="3626298">f</span><span class="op" id="3626299">.</span><span class="ident" id="3626300">stmts</span>&nbsp;<span class="op" id="3626306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626310">if</span>&nbsp;<span class="op" id="3626313">!</span><span class="ident" id="3626314">stmt</span><span class="op" id="3626318">.</span><span class="ident" id="3626319">isLabel</span><span class="op" id="3626326">(</span><span class="op" id="3626327">)</span>&nbsp;<span class="op" id="3626329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626334">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626345">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626350">lab</span>&nbsp;<span class="op" id="3626354">:=</span>&nbsp;<span class="ident" id="3626357">stmt</span><span class="op" id="3626361">.</span><span class="ident" id="3626362">label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626370">op</span>&nbsp;<span class="op" id="3626373">:=</span>&nbsp;<span class="ident" id="3626376">stmt</span><span class="op" id="3626380">.</span><span class="ident" id="3626381">ops</span><span class="op" id="3626384">[</span><span class="num" id="3626385">0</span><span class="op" id="3626386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626390">sym</span>&nbsp;<span class="op" id="3626394">:=</span>&nbsp;<span class="op" id="3626397">&amp;</span><span class="ident" id="3626398">symbol</span><span class="op" id="3626404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626409">Name</span><span class="op" id="3626413">:</span>&nbsp;<span class="ident" id="3626415">lab</span><span class="op" id="3626418">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626423">Type</span><span class="op" id="3626427">:</span>&nbsp;<span class="ident" id="3626429">SymLabel</span><span class="op" id="3626437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626442">Item</span><span class="op" id="3626446">:</span>&nbsp;<span class="ident" id="3626448">stmt</span><span class="op" id="3626452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626457">Pos</span><span class="op" id="3626460">:</span>&nbsp;&nbsp;<span class="ident" id="3626463">op</span><span class="op" id="3626465">.</span><span class="ident" id="3626466">Pos</span><span class="op" id="3626469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626478">decl</span>&nbsp;<span class="op" id="3626483">:=</span>&nbsp;<span class="ident" id="3626486">b</span><span class="op" id="3626487">.</span><span class="ident" id="3626488">scope</span><span class="op" id="3626493">.</span><span class="ident" id="3626494">Declare</span><span class="op" id="3626501">(</span><span class="ident" id="3626502">sym</span><span class="op" id="3626505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626509">if</span>&nbsp;<span class="ident" id="3626512">decl</span>&nbsp;<span class="op" id="3626517">!=</span>&nbsp;<span class="ident" id="3626520">nil</span>&nbsp;<span class="op" id="3626524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626529">b</span><span class="op" id="3626530">.</span><span class="ident" id="3626531">err</span><span class="op" id="3626534">(</span><span class="ident" id="3626535">op</span><span class="op" id="3626537">.</span><span class="ident" id="3626538">Pos</span><span class="op" id="3626541">,</span>&nbsp;<span class="string" id="3626543">&#34;%q&nbsp;already&nbsp;declared&#34;</span><span class="op" id="3626564">,</span>&nbsp;<span class="ident" id="3626566">lab</span><span class="op" id="3626569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626574">b</span><span class="op" id="3626575">.</span><span class="ident" id="3626576">err</span><span class="op" id="3626579">(</span><span class="ident" id="3626580">decl</span><span class="op" id="3626584">.</span><span class="ident" id="3626585">Pos</span><span class="op" id="3626588">,</span>&nbsp;<span class="string" id="3626590">&#34;&nbsp;&nbsp;here&nbsp;as&nbsp;a&nbsp;%s&#34;</span><span class="op" id="3626606">,</span>&nbsp;<span class="ident" id="3626608">symStr</span><span class="op" id="3626614">(</span><span class="ident" id="3626615">decl</span><span class="op" id="3626619">.</span><span class="ident" id="3626620">Type</span><span class="op" id="3626624">)</span><span class="op" id="3626625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626630">continue</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626644">}</span><br>
<span class="lineno"></span><span class="op" id="3626646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3626649">//&nbsp;setOffsets&nbsp;calculates&nbsp;the&nbsp;offset&nbsp;in&nbsp;function&nbsp;for&nbsp;each&nbsp;instruction.</span><br>
<span class="lineno">50</span><span class="keyword" id="3626719">func</span>&nbsp;<span class="ident" id="3626724">setOffsets</span><span class="op" id="3626734">(</span><span class="ident" id="3626735">b</span>&nbsp;<span class="op" id="3626737">*</span><span class="ident" id="3626738">builder</span><span class="op" id="3626745">,</span>&nbsp;<span class="ident" id="3626747">f</span>&nbsp;<span class="op" id="3626749">*</span><span class="ident" id="3626750">funcDecl</span><span class="op" id="3626758">)</span>&nbsp;<span class="op" id="3626760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626763">offset</span>&nbsp;<span class="op" id="3626770">:=</span>&nbsp;<span class="builtintype" id="3626773">uint32</span><span class="op" id="3626779">(</span><span class="num" id="3626780">0</span><span class="op" id="3626781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626785">for</span>&nbsp;<span class="ident" id="3626789">_</span><span class="op" id="3626790">,</span>&nbsp;<span class="ident" id="3626792">s</span>&nbsp;<span class="op" id="3626794">:=</span>&nbsp;<span class="keyword" id="3626797">range</span>&nbsp;<span class="ident" id="3626803">f</span><span class="op" id="3626804">.</span><span class="ident" id="3626805">stmts</span>&nbsp;<span class="op" id="3626811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626815">s</span><span class="op" id="3626816">.</span><span class="ident" id="3626817">offset</span>&nbsp;<span class="op" id="3626824">=</span>&nbsp;<span class="ident" id="3626826">offset</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626835">if</span>&nbsp;<span class="ident" id="3626838">s</span><span class="op" id="3626839">.</span><span class="ident" id="3626840">isLabel</span><span class="op" id="3626847">(</span><span class="op" id="3626848">)</span>&nbsp;<span class="op" id="3626850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626855">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626871">offset</span>&nbsp;<span class="op" id="3626878">+=</span>&nbsp;<span class="num" id="3626881">4</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626884">}</span><br>
<span class="lineno"></span><span class="op" id="3626886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3626889">//&nbsp;fillDelta&nbsp;will&nbsp;fill&nbsp;the&nbsp;particular&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="3626939">//&nbsp;with&nbsp;a&nbsp;jumping/branching&nbsp;offset&nbsp;d.</span><br>
<span class="lineno">65</span><span class="keyword" id="3626977">func</span>&nbsp;<span class="ident" id="3626982">fillDelta</span><span class="op" id="3626991">(</span><span class="ident" id="3626992">b</span>&nbsp;<span class="op" id="3626994">*</span><span class="ident" id="3626995">builder</span><span class="op" id="3627002">,</span>&nbsp;<span class="ident" id="3627004">t</span>&nbsp;<span class="op" id="3627006">*</span><span class="ident" id="3627007">lex8</span><span class="op" id="3627011">.</span><span class="ident" id="3627012">Token</span><span class="op" id="3627017">,</span>&nbsp;<span class="ident" id="3627019">inst</span>&nbsp;<span class="op" id="3627024">*</span><span class="builtintype" id="3627025">uint32</span><span class="op" id="3627031">,</span>&nbsp;<span class="ident" id="3627033">d</span>&nbsp;<span class="builtintype" id="3627035">uint32</span><span class="op" id="3627041">)</span>&nbsp;<span class="op" id="3627043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627046">if</span>&nbsp;<span class="ident" id="3627049">isJump</span><span class="op" id="3627055">(</span><span class="op" id="3627056">*</span><span class="ident" id="3627057">inst</span><span class="op" id="3627061">)</span>&nbsp;<span class="op" id="3627063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627067">*</span><span class="ident" id="3627068">inst</span>&nbsp;<span class="op" id="3627073">|=</span>&nbsp;<span class="ident" id="3627076">d</span>&nbsp;<span class="op" id="3627078">&amp;</span>&nbsp;<span class="num" id="3627080">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627092">}</span>&nbsp;<span class="keyword" id="3627094">else</span>&nbsp;<span class="op" id="3627099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627103">//&nbsp;it&nbsp;is&nbsp;a&nbsp;branch</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627123">if</span>&nbsp;<span class="op" id="3627126">!</span><span class="ident" id="3627127">inBrRange</span><span class="op" id="3627136">(</span><span class="ident" id="3627137">d</span><span class="op" id="3627138">)</span>&nbsp;<span class="op" id="3627140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627145">b</span><span class="op" id="3627146">.</span><span class="ident" id="3627147">err</span><span class="op" id="3627150">(</span><span class="ident" id="3627151">t</span><span class="op" id="3627152">.</span><span class="ident" id="3627153">Pos</span><span class="op" id="3627156">,</span>&nbsp;<span class="string" id="3627158">&#34;%q&nbsp;is&nbsp;out&nbsp;of&nbsp;branch&nbsp;range&#34;</span><span class="op" id="3627185">,</span>&nbsp;<span class="ident" id="3627187">t</span><span class="op" id="3627188">.</span><span class="ident" id="3627189">Lit</span><span class="op" id="3627192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627200">*</span><span class="ident" id="3627201">inst</span>&nbsp;<span class="op" id="3627206">|=</span>&nbsp;<span class="ident" id="3627209">d</span>&nbsp;<span class="op" id="3627211">&amp;</span>&nbsp;<span class="num" id="3627213">0x3ffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627222">}</span><br>
<span class="lineno">75</span><span class="op" id="3627224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3627227">//&nbsp;fillLabels&nbsp;fills&nbsp;all&nbsp;the&nbsp;labels&nbsp;in&nbsp;the&nbsp;function.&nbsp;After&nbsp;the&nbsp;filling,&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3627306">//&nbsp;symbols&nbsp;left&nbsp;will&nbsp;be&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;and&nbsp;all&nbsp;branches&nbsp;(which</span><br>
<span class="lineno"></span><span class="comment" id="3627385">//&nbsp;must&nbsp;use&nbsp;labels)&nbsp;will&nbsp;be&nbsp;filled.</span><br>
<span class="lineno">80</span><span class="keyword" id="3627421">func</span>&nbsp;<span class="ident" id="3627426">fillLabels</span><span class="op" id="3627436">(</span><span class="ident" id="3627437">b</span>&nbsp;<span class="op" id="3627439">*</span><span class="ident" id="3627440">builder</span><span class="op" id="3627447">,</span>&nbsp;<span class="ident" id="3627449">f</span>&nbsp;<span class="op" id="3627451">*</span><span class="ident" id="3627452">funcDecl</span><span class="op" id="3627460">)</span>&nbsp;<span class="op" id="3627462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627465">for</span>&nbsp;<span class="ident" id="3627469">_</span><span class="op" id="3627470">,</span>&nbsp;<span class="ident" id="3627472">s</span>&nbsp;<span class="op" id="3627474">:=</span>&nbsp;<span class="keyword" id="3627477">range</span>&nbsp;<span class="ident" id="3627483">f</span><span class="op" id="3627484">.</span><span class="ident" id="3627485">stmts</span>&nbsp;<span class="op" id="3627491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627495">if</span>&nbsp;<span class="ident" id="3627498">s</span><span class="op" id="3627499">.</span><span class="ident" id="3627500">isLabel</span><span class="op" id="3627507">(</span><span class="op" id="3627508">)</span>&nbsp;<span class="op" id="3627510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627515">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627526">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627530">if</span>&nbsp;<span class="ident" id="3627533">s</span><span class="op" id="3627534">.</span><span class="ident" id="3627535">fill</span>&nbsp;<span class="op" id="3627540">!=</span>&nbsp;<span class="ident" id="3627543">fillLabel</span>&nbsp;<span class="op" id="3627553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627558">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627573">if</span>&nbsp;<span class="ident" id="3627576">s</span><span class="op" id="3627577">.</span><span class="ident" id="3627578">pack</span>&nbsp;<span class="op" id="3627583">!=</span>&nbsp;<span class="string" id="3627586">&#34;&#34;</span>&nbsp;<span class="op" id="3627589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3627594">panic</span><span class="op" id="3627599">(</span><span class="string" id="3627600">&#34;fill&nbsp;label&nbsp;with&nbsp;pack&nbsp;symbol&#34;</span><span class="op" id="3627629">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627638">t</span>&nbsp;<span class="op" id="3627640">:=</span>&nbsp;<span class="ident" id="3627643">s</span><span class="op" id="3627644">.</span><span class="ident" id="3627645">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627655">sym</span>&nbsp;<span class="op" id="3627659">:=</span>&nbsp;<span class="ident" id="3627662">b</span><span class="op" id="3627663">.</span><span class="ident" id="3627664">scope</span><span class="op" id="3627669">.</span><span class="ident" id="3627670">Query</span><span class="op" id="3627675">(</span><span class="ident" id="3627676">s</span><span class="op" id="3627677">.</span><span class="ident" id="3627678">symbol</span><span class="op" id="3627684">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627688">if</span>&nbsp;<span class="ident" id="3627691">sym</span>&nbsp;<span class="op" id="3627695">==</span>&nbsp;<span class="ident" id="3627698">nil</span>&nbsp;<span class="op" id="3627702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627707">b</span><span class="op" id="3627708">.</span><span class="ident" id="3627709">err</span><span class="op" id="3627712">(</span><span class="ident" id="3627713">t</span><span class="op" id="3627714">.</span><span class="ident" id="3627715">Pos</span><span class="op" id="3627718">,</span>&nbsp;<span class="string" id="3627720">&#34;label&nbsp;%q&nbsp;not&nbsp;declared&#34;</span><span class="op" id="3627743">,</span>&nbsp;<span class="ident" id="3627745">t</span><span class="op" id="3627746">.</span><span class="ident" id="3627747">Lit</span><span class="op" id="3627750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627755">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627771">if</span>&nbsp;<span class="ident" id="3627774">sym</span><span class="op" id="3627777">.</span><span class="ident" id="3627778">Type</span>&nbsp;<span class="op" id="3627783">!=</span>&nbsp;<span class="ident" id="3627786">SymLabel</span>&nbsp;<span class="op" id="3627795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3627800">panic</span><span class="op" id="3627805">(</span><span class="string" id="3627806">&#34;not&nbsp;a&nbsp;label&#34;</span><span class="op" id="3627819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627828">lab</span>&nbsp;<span class="op" id="3627832">:=</span>&nbsp;<span class="ident" id="3627835">sym</span><span class="op" id="3627838">.</span><span class="ident" id="3627839">Item</span><span class="op" id="3627843">.</span><span class="op" id="3627844">(</span><span class="op" id="3627845">*</span><span class="ident" id="3627846">funcStmt</span><span class="op" id="3627854">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627858">delta</span>&nbsp;<span class="op" id="3627864">:=</span>&nbsp;<span class="builtintype" id="3627867">uint32</span><span class="op" id="3627873">(</span><span class="builtintype" id="3627874">int32</span><span class="op" id="3627879">(</span><span class="ident" id="3627880">lab</span><span class="op" id="3627883">.</span><span class="ident" id="3627884">offset</span><span class="op" id="3627890">-</span><span class="ident" id="3627891">s</span><span class="op" id="3627892">.</span><span class="ident" id="3627893">offset</span><span class="op" id="3627899">-</span><span class="num" id="3627900">4</span><span class="op" id="3627901">)</span>&nbsp;<span class="op" id="3627903">&gt;&gt;</span>&nbsp;<span class="num" id="3627906">2</span><span class="op" id="3627907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627911">fillDelta</span><span class="op" id="3627920">(</span><span class="ident" id="3627921">b</span><span class="op" id="3627922">,</span>&nbsp;<span class="ident" id="3627924">t</span><span class="op" id="3627925">,</span>&nbsp;<span class="op" id="3627927">&amp;</span><span class="ident" id="3627928">s</span><span class="op" id="3627929">.</span><span class="ident" id="3627930">inst</span><span class="op" id="3627934">.</span><span class="ident" id="3627935">inst</span><span class="op" id="3627939">,</span>&nbsp;<span class="ident" id="3627941">delta</span><span class="op" id="3627946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627949">}</span><br>
<span class="lineno"></span><span class="op" id="3627951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3627954">func</span>&nbsp;<span class="ident" id="3627959">queryPkg</span><span class="op" id="3627967">(</span><span class="ident" id="3627968">b</span>&nbsp;<span class="op" id="3627970">*</span><span class="ident" id="3627971">builder</span><span class="op" id="3627978">,</span>&nbsp;<span class="ident" id="3627980">t</span>&nbsp;<span class="op" id="3627982">*</span><span class="ident" id="3627983">lex8</span><span class="op" id="3627987">.</span><span class="ident" id="3627988">Token</span><span class="op" id="3627993">,</span>&nbsp;<span class="ident" id="3627995">pack</span>&nbsp;<span class="builtintype" id="3628000">string</span><span class="op" id="3628006">)</span>&nbsp;<span class="op" id="3628008">*</span><span class="ident" id="3628009">lib</span>&nbsp;<span class="op" id="3628013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628016">sym</span>&nbsp;<span class="op" id="3628020">:=</span>&nbsp;<span class="ident" id="3628023">b</span><span class="op" id="3628024">.</span><span class="ident" id="3628025">scope</span><span class="op" id="3628030">.</span><span class="ident" id="3628031">Query</span><span class="op" id="3628036">(</span><span class="ident" id="3628037">pack</span><span class="op" id="3628041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628044">if</span>&nbsp;<span class="ident" id="3628047">sym</span>&nbsp;<span class="op" id="3628051">==</span>&nbsp;<span class="ident" id="3628054">nil</span>&nbsp;<span class="op" id="3628058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628062">b</span><span class="op" id="3628063">.</span><span class="ident" id="3628064">err</span><span class="op" id="3628067">(</span><span class="ident" id="3628068">t</span><span class="op" id="3628069">.</span><span class="ident" id="3628070">Pos</span><span class="op" id="3628073">,</span>&nbsp;<span class="string" id="3628075">&#34;package&nbsp;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="3628097">,</span>&nbsp;<span class="ident" id="3628099">pack</span><span class="op" id="3628103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628107">return</span>&nbsp;<span class="ident" id="3628114">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628119">}</span>&nbsp;<span class="keyword" id="3628121">else</span>&nbsp;<span class="keyword" id="3628126">if</span>&nbsp;<span class="ident" id="3628129">sym</span><span class="op" id="3628132">.</span><span class="ident" id="3628133">Type</span>&nbsp;<span class="op" id="3628138">!=</span>&nbsp;<span class="ident" id="3628141">SymImport</span>&nbsp;<span class="op" id="3628151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628155">b</span><span class="op" id="3628156">.</span><span class="ident" id="3628157">err</span><span class="op" id="3628160">(</span><span class="ident" id="3628161">t</span><span class="op" id="3628162">.</span><span class="ident" id="3628163">Pos</span><span class="op" id="3628166">,</span>&nbsp;<span class="string" id="3628168">&#34;%q&nbsp;is&nbsp;a&nbsp;%s,&nbsp;not&nbsp;a&nbsp;package&#34;</span><span class="op" id="3628195">,</span>&nbsp;<span class="ident" id="3628197">t</span><span class="op" id="3628198">.</span><span class="ident" id="3628199">Lit</span><span class="op" id="3628202">,</span>&nbsp;<span class="ident" id="3628204">symStr</span><span class="op" id="3628210">(</span><span class="ident" id="3628211">sym</span><span class="op" id="3628214">.</span><span class="ident" id="3628215">Type</span><span class="op" id="3628219">)</span><span class="op" id="3628220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628224">return</span>&nbsp;<span class="ident" id="3628231">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628239">return</span>&nbsp;<span class="ident" id="3628246">sym</span><span class="op" id="3628249">.</span><span class="ident" id="3628250">Item</span><span class="op" id="3628254">.</span><span class="op" id="3628255">(</span><span class="op" id="3628256">*</span><span class="ident" id="3628257">lib</span><span class="op" id="3628260">)</span><br>
<span class="lineno">120</span><span class="op" id="3628262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3628265">func</span>&nbsp;<span class="ident" id="3628270">init</span><span class="op" id="3628274">(</span><span class="op" id="3628275">)</span>&nbsp;<span class="op" id="3628277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628280">as</span>&nbsp;<span class="op" id="3628283">:=</span>&nbsp;<span class="keyword" id="3628286">func</span><span class="op" id="3628290">(</span><span class="ident" id="3628291">b</span>&nbsp;<span class="builtintype" id="3628293">bool</span><span class="op" id="3628297">)</span>&nbsp;<span class="op" id="3628299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628303">if</span>&nbsp;<span class="op" id="3628306">!</span><span class="ident" id="3628307">b</span>&nbsp;<span class="op" id="3628309">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3628314">panic</span><span class="op" id="3628319">(</span><span class="string" id="3628320">&#34;bug&#34;</span><span class="op" id="3628325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628335">as</span><span class="op" id="3628337">(</span><span class="ident" id="3628338">fillNone</span>&nbsp;<span class="op" id="3628347">==</span>&nbsp;<span class="num" id="3628350">0</span>&nbsp;<span class="op" id="3628352">&amp;&amp;</span>&nbsp;<span class="ident" id="3628355">fillLabel</span>&nbsp;<span class="op" id="3628365">==</span>&nbsp;<span class="num" id="3628368">4</span><span class="op" id="3628369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628372">as</span><span class="op" id="3628374">(</span><span class="ident" id="3628375">fillLink</span>&nbsp;<span class="op" id="3628384">==</span>&nbsp;<span class="ident" id="3628387">link8</span><span class="op" id="3628392">.</span><span class="ident" id="3628393">FillLink</span><span class="op" id="3628401">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628404">as</span><span class="op" id="3628406">(</span><span class="ident" id="3628407">fillHigh</span>&nbsp;<span class="op" id="3628416">==</span>&nbsp;<span class="ident" id="3628419">link8</span><span class="op" id="3628424">.</span><span class="ident" id="3628425">FillHigh</span><span class="op" id="3628433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628436">as</span><span class="op" id="3628438">(</span><span class="ident" id="3628439">fillLow</span>&nbsp;<span class="op" id="3628447">==</span>&nbsp;<span class="ident" id="3628450">link8</span><span class="op" id="3628455">.</span><span class="ident" id="3628456">FillLow</span><span class="op" id="3628463">)</span><br>
<span class="lineno"></span><span class="op" id="3628465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3628468">//&nbsp;resolveSymbol&nbsp;resolves&nbsp;the&nbsp;symbol&nbsp;in&nbsp;the&nbsp;statement,</span><br>
<span class="lineno">135</span><span class="comment" id="3628523">//&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;linking&nbsp;object&nbsp;and&nbsp;its&nbsp;&lt;sym,&nbsp;pkg&gt;&nbsp;index&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="3628590">//&nbsp;in&nbsp;the&nbsp;current&nbsp;package&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="3628625">func</span>&nbsp;<span class="ident" id="3628630">resolveSymbol</span><span class="op" id="3628643">(</span><span class="ident" id="3628644">b</span>&nbsp;<span class="op" id="3628646">*</span><span class="ident" id="3628647">builder</span><span class="op" id="3628654">,</span>&nbsp;<span class="ident" id="3628656">s</span>&nbsp;<span class="op" id="3628658">*</span><span class="ident" id="3628659">funcStmt</span><span class="op" id="3628667">)</span>&nbsp;<span class="op" id="3628669">(</span><span class="ident" id="3628670">ret</span>&nbsp;<span class="op" id="3628674">*</span><span class="ident" id="3628675">symbol</span><span class="op" id="3628681">,</span>&nbsp;<span class="ident" id="3628683">pkg</span><span class="op" id="3628686">,</span>&nbsp;<span class="ident" id="3628688">index</span>&nbsp;<span class="builtintype" id="3628694">uint32</span><span class="op" id="3628700">)</span>&nbsp;<span class="op" id="3628702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628705">t</span>&nbsp;<span class="op" id="3628707">:=</span>&nbsp;<span class="ident" id="3628710">s</span><span class="op" id="3628711">.</span><span class="ident" id="3628712">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628721">if</span>&nbsp;<span class="ident" id="3628724">s</span><span class="op" id="3628725">.</span><span class="ident" id="3628726">pack</span>&nbsp;<span class="op" id="3628731">==</span>&nbsp;<span class="string" id="3628734">&#34;&#34;</span>&nbsp;<span class="op" id="3628737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628741">ret</span>&nbsp;<span class="op" id="3628745">=</span>&nbsp;<span class="ident" id="3628747">b</span><span class="op" id="3628748">.</span><span class="ident" id="3628749">scope</span><span class="op" id="3628754">.</span><span class="ident" id="3628755">Query</span><span class="op" id="3628760">(</span><span class="ident" id="3628761">s</span><span class="op" id="3628762">.</span><span class="ident" id="3628763">symbol</span><span class="op" id="3628769">)</span>&nbsp;<span class="comment" id="3628771">//&nbsp;find&nbsp;the&nbsp;symbol&nbsp;in&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628801">if</span>&nbsp;<span class="ident" id="3628804">ret</span>&nbsp;<span class="op" id="3628808">!=</span>&nbsp;<span class="ident" id="3628811">nil</span>&nbsp;<span class="op" id="3628815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628820">var</span>&nbsp;<span class="ident" id="3628824">p</span>&nbsp;<span class="op" id="3628826">*</span><span class="ident" id="3628827">lib</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628834">p</span><span class="op" id="3628835">,</span>&nbsp;<span class="ident" id="3628837">pkg</span>&nbsp;<span class="op" id="3628841">=</span>&nbsp;<span class="ident" id="3628843">b</span><span class="op" id="3628844">.</span><span class="ident" id="3628845">curPkg</span><span class="op" id="3628851">.</span><span class="ident" id="3628852">LibIndex</span><span class="op" id="3628860">(</span><span class="ident" id="3628861">ret</span><span class="op" id="3628864">.</span><span class="ident" id="3628865">Package</span><span class="op" id="3628872">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628877">index</span>&nbsp;<span class="op" id="3628883">=</span>&nbsp;<span class="ident" id="3628885">p</span><span class="op" id="3628886">.</span><span class="ident" id="3628887">SymIndex</span><span class="op" id="3628895">(</span><span class="ident" id="3628896">ret</span><span class="op" id="3628899">.</span><span class="ident" id="3628900">Name</span><span class="op" id="3628904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628911">}</span>&nbsp;<span class="keyword" id="3628913">else</span>&nbsp;<span class="op" id="3628918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628922">p</span>&nbsp;<span class="op" id="3628924">:=</span>&nbsp;<span class="ident" id="3628927">queryPkg</span><span class="op" id="3628935">(</span><span class="ident" id="3628936">b</span><span class="op" id="3628937">,</span>&nbsp;<span class="ident" id="3628939">t</span><span class="op" id="3628940">,</span>&nbsp;<span class="ident" id="3628942">s</span><span class="op" id="3628943">.</span><span class="ident" id="3628944">pack</span><span class="op" id="3628948">)</span>&nbsp;<span class="comment" id="3628950">//&nbsp;find&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628972">if</span>&nbsp;<span class="ident" id="3628975">p</span>&nbsp;<span class="op" id="3628977">==</span>&nbsp;<span class="ident" id="3628980">nil</span>&nbsp;<span class="op" id="3628984">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629003">path</span>&nbsp;<span class="op" id="3629008">:=</span>&nbsp;<span class="ident" id="3629011">p</span><span class="op" id="3629012">.</span><span class="ident" id="3629013">Path</span><span class="op" id="3629017">(</span><span class="op" id="3629018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629022">_</span><span class="op" id="3629023">,</span>&nbsp;<span class="ident" id="3629025">pkg</span>&nbsp;<span class="op" id="3629029">=</span>&nbsp;<span class="ident" id="3629031">b</span><span class="op" id="3629032">.</span><span class="ident" id="3629033">curPkg</span><span class="op" id="3629039">.</span><span class="ident" id="3629040">LibIndex</span><span class="op" id="3629048">(</span><span class="ident" id="3629049">path</span><span class="op" id="3629053">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629057">ret</span><span class="op" id="3629060">,</span>&nbsp;<span class="ident" id="3629062">index</span>&nbsp;<span class="op" id="3629068">=</span>&nbsp;<span class="ident" id="3629070">p</span><span class="op" id="3629071">.</span><span class="ident" id="3629072">Query</span><span class="op" id="3629077">(</span><span class="ident" id="3629078">s</span><span class="op" id="3629079">.</span><span class="ident" id="3629080">symbol</span><span class="op" id="3629086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629090">if</span>&nbsp;<span class="ident" id="3629093">ret</span>&nbsp;<span class="op" id="3629097">!=</span>&nbsp;<span class="ident" id="3629100">nil</span>&nbsp;<span class="op" id="3629104">&amp;&amp;</span>&nbsp;<span class="ident" id="3629107">ret</span><span class="op" id="3629110">.</span><span class="ident" id="3629111">Package</span>&nbsp;<span class="op" id="3629119">!=</span>&nbsp;<span class="ident" id="3629122">path</span>&nbsp;<span class="op" id="3629127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3629132">panic</span><span class="op" id="3629137">(</span><span class="string" id="3629138">&#34;bug&#34;</span><span class="op" id="3629143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629150">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629154">if</span>&nbsp;<span class="ident" id="3629157">ret</span>&nbsp;<span class="op" id="3629161">==</span>&nbsp;<span class="ident" id="3629164">nil</span>&nbsp;<span class="op" id="3629168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629172">b</span><span class="op" id="3629173">.</span><span class="ident" id="3629174">err</span><span class="op" id="3629177">(</span><span class="ident" id="3629178">t</span><span class="op" id="3629179">.</span><span class="ident" id="3629180">Pos</span><span class="op" id="3629183">,</span>&nbsp;<span class="string" id="3629185">&#34;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="3629199">,</span>&nbsp;<span class="ident" id="3629201">t</span><span class="op" id="3629202">.</span><span class="ident" id="3629203">Lit</span><span class="op" id="3629206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629210">return</span>&nbsp;<span class="ident" id="3629217">nil</span><span class="op" id="3629220">,</span>&nbsp;<span class="num" id="3629222">0</span><span class="op" id="3629223">,</span>&nbsp;<span class="num" id="3629225">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629228">}</span>&nbsp;<span class="keyword" id="3629230">else</span>&nbsp;<span class="keyword" id="3629235">if</span>&nbsp;<span class="ident" id="3629238">ret</span><span class="op" id="3629241">.</span><span class="ident" id="3629242">Type</span>&nbsp;<span class="op" id="3629247">==</span>&nbsp;<span class="ident" id="3629250">SymConst</span>&nbsp;<span class="op" id="3629259">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629263">return</span>&nbsp;<span class="ident" id="3629270">nil</span><span class="op" id="3629273">,</span>&nbsp;<span class="num" id="3629275">0</span><span class="op" id="3629276">,</span>&nbsp;<span class="num" id="3629278">0</span>&nbsp;<span class="comment" id="3629280">//&nbsp;not&nbsp;my&nbsp;job&nbsp;to&nbsp;fill&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629308">}</span>&nbsp;<span class="keyword" id="3629310">else</span>&nbsp;<span class="keyword" id="3629315">if</span>&nbsp;<span class="ident" id="3629318">ret</span><span class="op" id="3629321">.</span><span class="ident" id="3629322">Type</span>&nbsp;<span class="op" id="3629327">==</span>&nbsp;<span class="ident" id="3629330">SymImport</span>&nbsp;<span class="op" id="3629340">||</span>&nbsp;<span class="ident" id="3629343">ret</span><span class="op" id="3629346">.</span><span class="ident" id="3629347">Type</span>&nbsp;<span class="op" id="3629352">==</span>&nbsp;<span class="ident" id="3629355">SymLabel</span>&nbsp;<span class="op" id="3629364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629368">b</span><span class="op" id="3629369">.</span><span class="ident" id="3629370">err</span><span class="op" id="3629373">(</span><span class="ident" id="3629374">t</span><span class="op" id="3629375">.</span><span class="ident" id="3629376">Pos</span><span class="op" id="3629379">,</span>&nbsp;<span class="string" id="3629381">&#34;%s&nbsp;%q&nbsp;not&nbsp;a&nbsp;symbol&#34;</span><span class="op" id="3629401">,</span>&nbsp;<span class="ident" id="3629403">symStr</span><span class="op" id="3629409">(</span><span class="ident" id="3629410">ret</span><span class="op" id="3629413">.</span><span class="ident" id="3629414">Type</span><span class="op" id="3629418">)</span><span class="op" id="3629419">,</span>&nbsp;<span class="ident" id="3629421">t</span><span class="op" id="3629422">.</span><span class="ident" id="3629423">Lit</span><span class="op" id="3629426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629430">return</span>&nbsp;<span class="ident" id="3629437">nil</span><span class="op" id="3629440">,</span>&nbsp;<span class="num" id="3629442">0</span><span class="op" id="3629443">,</span>&nbsp;<span class="num" id="3629445">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629448">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629452">return</span><br>
<span class="lineno"></span><span class="op" id="3629459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3629462">func</span>&nbsp;<span class="ident" id="3629467">linkSymbol</span><span class="op" id="3629477">(</span><span class="ident" id="3629478">b</span>&nbsp;<span class="op" id="3629480">*</span><span class="ident" id="3629481">builder</span><span class="op" id="3629488">,</span>&nbsp;<span class="ident" id="3629490">s</span>&nbsp;<span class="op" id="3629492">*</span><span class="ident" id="3629493">funcStmt</span><span class="op" id="3629501">,</span>&nbsp;<span class="ident" id="3629503">f</span>&nbsp;<span class="op" id="3629505">*</span><span class="ident" id="3629506">link8</span><span class="op" id="3629511">.</span><span class="ident" id="3629512">Func</span><span class="op" id="3629516">)</span>&nbsp;<span class="op" id="3629518">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629521">t</span>&nbsp;<span class="op" id="3629523">:=</span>&nbsp;<span class="ident" id="3629526">s</span><span class="op" id="3629527">.</span><span class="ident" id="3629528">symTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629536">if</span>&nbsp;<span class="ident" id="3629539">b</span><span class="op" id="3629540">.</span><span class="ident" id="3629541">curPkg</span>&nbsp;<span class="op" id="3629548">==</span>&nbsp;<span class="ident" id="3629551">nil</span>&nbsp;<span class="op" id="3629555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629559">b</span><span class="op" id="3629560">.</span><span class="ident" id="3629561">err</span><span class="op" id="3629564">(</span><span class="ident" id="3629565">t</span><span class="op" id="3629566">.</span><span class="ident" id="3629567">Pos</span><span class="op" id="3629570">,</span>&nbsp;<span class="string" id="3629572">&#34;no&nbsp;context&nbsp;for&nbsp;resolving&nbsp;%q&#34;</span><span class="op" id="3629601">,</span>&nbsp;<span class="ident" id="3629603">t</span><span class="op" id="3629604">.</span><span class="ident" id="3629605">Lit</span><span class="op" id="3629608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629612">return</span>&nbsp;<span class="comment" id="3629619">//&nbsp;this&nbsp;may&nbsp;happen&nbsp;for&nbsp;bare&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629657">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629661">sym</span><span class="op" id="3629664">,</span>&nbsp;<span class="ident" id="3629666">pkg</span><span class="op" id="3629669">,</span>&nbsp;<span class="ident" id="3629671">index</span>&nbsp;<span class="op" id="3629677">:=</span>&nbsp;<span class="ident" id="3629680">resolveSymbol</span><span class="op" id="3629693">(</span><span class="ident" id="3629694">b</span><span class="op" id="3629695">,</span>&nbsp;<span class="ident" id="3629697">s</span><span class="op" id="3629698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629701">if</span>&nbsp;<span class="ident" id="3629704">sym</span>&nbsp;<span class="op" id="3629708">==</span>&nbsp;<span class="ident" id="3629711">nil</span>&nbsp;<span class="op" id="3629715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629719">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629727">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629731">if</span>&nbsp;<span class="ident" id="3629734">s</span><span class="op" id="3629735">.</span><span class="ident" id="3629736">fill</span>&nbsp;<span class="op" id="3629741">==</span>&nbsp;<span class="ident" id="3629744">fillLink</span>&nbsp;<span class="op" id="3629753">&amp;&amp;</span>&nbsp;<span class="ident" id="3629756">sym</span><span class="op" id="3629759">.</span><span class="ident" id="3629760">Type</span>&nbsp;<span class="op" id="3629765">!=</span>&nbsp;<span class="ident" id="3629768">SymFunc</span>&nbsp;<span class="op" id="3629776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629780">b</span><span class="op" id="3629781">.</span><span class="ident" id="3629782">err</span><span class="op" id="3629785">(</span><span class="ident" id="3629786">t</span><span class="op" id="3629787">.</span><span class="ident" id="3629788">Pos</span><span class="op" id="3629791">,</span>&nbsp;<span class="string" id="3629793">&#34;%s&nbsp;%q&nbsp;is&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="3629818">,</span>&nbsp;<span class="ident" id="3629820">symStr</span><span class="op" id="3629826">(</span><span class="ident" id="3629827">sym</span><span class="op" id="3629830">.</span><span class="ident" id="3629831">Type</span><span class="op" id="3629835">)</span><span class="op" id="3629836">,</span>&nbsp;<span class="ident" id="3629838">t</span><span class="op" id="3629839">.</span><span class="ident" id="3629840">Lit</span><span class="op" id="3629843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629847">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629855">}</span>&nbsp;<span class="keyword" id="3629857">else</span>&nbsp;<span class="keyword" id="3629862">if</span>&nbsp;<span class="ident" id="3629865">pkg</span>&nbsp;<span class="op" id="3629869">&gt;</span>&nbsp;<span class="num" id="3629871">0</span>&nbsp;<span class="op" id="3629873">&amp;&amp;</span>&nbsp;<span class="op" id="3629876">!</span><span class="ident" id="3629877">isPublic</span><span class="op" id="3629885">(</span><span class="ident" id="3629886">sym</span><span class="op" id="3629889">.</span><span class="ident" id="3629890">Name</span><span class="op" id="3629894">)</span>&nbsp;<span class="op" id="3629896">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629900">//&nbsp;for&nbsp;imported&nbsp;package,&nbsp;check&nbsp;if&nbsp;it&nbsp;is&nbsp;public</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629949">b</span><span class="op" id="3629950">.</span><span class="ident" id="3629951">err</span><span class="op" id="3629954">(</span><span class="ident" id="3629955">t</span><span class="op" id="3629956">.</span><span class="ident" id="3629957">Pos</span><span class="op" id="3629960">,</span>&nbsp;<span class="string" id="3629962">&#34;%q&nbsp;is&nbsp;not&nbsp;public&#34;</span><span class="op" id="3629980">,</span>&nbsp;<span class="ident" id="3629982">t</span><span class="op" id="3629983">.</span><span class="ident" id="3629984">Lit</span><span class="op" id="3629987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630003">//&nbsp;save&nbsp;the&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630021">f</span><span class="op" id="3630022">.</span><span class="ident" id="3630023">AddLink</span><span class="op" id="3630030">(</span><span class="ident" id="3630031">s</span><span class="op" id="3630032">.</span><span class="ident" id="3630033">fill</span><span class="op" id="3630037">,</span>&nbsp;<span class="ident" id="3630039">pkg</span><span class="op" id="3630042">,</span>&nbsp;<span class="ident" id="3630044">index</span><span class="op" id="3630049">)</span><br>
<span class="lineno"></span><span class="op" id="3630051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3630054">//&nbsp;makeFuncObj&nbsp;converts&nbsp;a&nbsp;function&nbsp;AST&nbsp;node&nbsp;f&nbsp;into&nbsp;a&nbsp;function&nbsp;object.&nbsp;It</span><br>
<span class="lineno">200</span><span class="comment" id="3630127">//&nbsp;resolves&nbsp;the&nbsp;symbols&nbsp;of&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;into&nbsp;&lt;pack,&nbsp;sym&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3630202">//&nbsp;index&nbsp;pairs,&nbsp;using&nbsp;the&nbsp;symbol&nbsp;scope&nbsp;and&nbsp;the&nbsp;curPkg&nbsp;context&nbsp;in&nbsp;the&nbsp;Builder&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3630282">func</span>&nbsp;<span class="ident" id="3630287">makeFuncObj</span><span class="op" id="3630298">(</span><span class="ident" id="3630299">b</span>&nbsp;<span class="op" id="3630301">*</span><span class="ident" id="3630302">builder</span><span class="op" id="3630309">,</span>&nbsp;<span class="ident" id="3630311">f</span>&nbsp;<span class="op" id="3630313">*</span><span class="ident" id="3630314">funcDecl</span><span class="op" id="3630322">)</span>&nbsp;<span class="op" id="3630324">*</span><span class="ident" id="3630325">link8</span><span class="op" id="3630330">.</span><span class="ident" id="3630331">Func</span>&nbsp;<span class="op" id="3630336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630339">ret</span>&nbsp;<span class="op" id="3630343">:=</span>&nbsp;<span class="ident" id="3630346">link8</span><span class="op" id="3630351">.</span><span class="ident" id="3630352">NewFunc</span><span class="op" id="3630359">(</span><span class="op" id="3630360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630363">for</span>&nbsp;<span class="ident" id="3630367">_</span><span class="op" id="3630368">,</span>&nbsp;<span class="ident" id="3630370">s</span>&nbsp;<span class="op" id="3630372">:=</span>&nbsp;<span class="keyword" id="3630375">range</span>&nbsp;<span class="ident" id="3630381">f</span><span class="op" id="3630382">.</span><span class="ident" id="3630383">stmts</span>&nbsp;<span class="op" id="3630389">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630393">if</span>&nbsp;<span class="ident" id="3630396">s</span><span class="op" id="3630397">.</span><span class="ident" id="3630398">isLabel</span><span class="op" id="3630405">(</span><span class="op" id="3630406">)</span>&nbsp;<span class="op" id="3630408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630413">continue</span>&nbsp;<span class="comment" id="3630422">//&nbsp;skip&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630443">ret</span><span class="op" id="3630446">.</span><span class="ident" id="3630447">AddInst</span><span class="op" id="3630454">(</span><span class="ident" id="3630455">s</span><span class="op" id="3630456">.</span><span class="ident" id="3630457">inst</span><span class="op" id="3630461">.</span><span class="ident" id="3630462">inst</span><span class="op" id="3630466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630471">if</span>&nbsp;<span class="op" id="3630474">!</span><span class="op" id="3630475">(</span><span class="ident" id="3630476">s</span><span class="op" id="3630477">.</span><span class="ident" id="3630478">fill</span>&nbsp;<span class="op" id="3630483">&gt;</span>&nbsp;<span class="ident" id="3630485">fillNone</span>&nbsp;<span class="op" id="3630494">&amp;&amp;</span>&nbsp;<span class="ident" id="3630497">s</span><span class="op" id="3630498">.</span><span class="ident" id="3630499">fill</span>&nbsp;<span class="op" id="3630504">&lt;</span>&nbsp;<span class="ident" id="3630506">fillLabel</span><span class="op" id="3630515">)</span>&nbsp;<span class="op" id="3630517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630522">continue</span>&nbsp;<span class="comment" id="3630531">//&nbsp;only&nbsp;care&nbsp;about&nbsp;fillHigh,&nbsp;fillLow&nbsp;and&nbsp;fillLink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630588">linkSymbol</span><span class="op" id="3630598">(</span><span class="ident" id="3630599">b</span><span class="op" id="3630600">,</span>&nbsp;<span class="ident" id="3630602">s</span><span class="op" id="3630603">,</span>&nbsp;<span class="ident" id="3630605">ret</span><span class="op" id="3630608">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630615">if</span>&nbsp;<span class="ident" id="3630618">ret</span><span class="op" id="3630621">.</span><span class="ident" id="3630622">TooLarge</span><span class="op" id="3630630">(</span><span class="op" id="3630631">)</span>&nbsp;<span class="op" id="3630633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630637">b</span><span class="op" id="3630638">.</span><span class="ident" id="3630639">err</span><span class="op" id="3630642">(</span><span class="ident" id="3630643">f</span><span class="op" id="3630644">.</span><span class="ident" id="3630645">name</span><span class="op" id="3630649">.</span><span class="ident" id="3630650">Pos</span><span class="op" id="3630653">,</span>&nbsp;<span class="string" id="3630655">&#34;too&nbsp;many&nbsp;instructions&nbsp;in&nbsp;func&#34;</span><span class="op" id="3630686">,</span>&nbsp;<span class="ident" id="3630688">f</span><span class="op" id="3630689">.</span><span class="ident" id="3630690">name</span><span class="op" id="3630694">.</span><span class="ident" id="3630695">Lit</span><span class="op" id="3630698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630701">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630705">return</span>&nbsp;<span class="ident" id="3630712">ret</span><br>
<span class="lineno"></span><span class="op" id="3630716">}</span>
</div>
</body>
</html>
