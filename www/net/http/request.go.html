<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3536598">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3536653">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3536707">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3536758">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3536796">package</span>&nbsp;<span class="ident" id="3536804">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3536810">import</span>&nbsp;<span class="op" id="3536817">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536820">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536829">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536838">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536852">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536871">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536881">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536888">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536894">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536907">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536915">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536933">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536950">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536961">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536972">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536983">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3536990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3536993">const</span>&nbsp;<span class="op" id="3536999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537002">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3537019">=</span>&nbsp;<span class="num" id="3537021">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537027">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3537044">=</span>&nbsp;<span class="num" id="3537046">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537052">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537069">=</span>&nbsp;<span class="num" id="3537071">4</span>&nbsp;<span class="op" id="3537073">&lt;&lt;</span>&nbsp;<span class="num" id="3537076">10</span>&nbsp;&nbsp;<span class="comment" id="3537080">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537096">defaultMaxMemory</span>&nbsp;<span class="op" id="3537113">=</span>&nbsp;<span class="num" id="3537115">32</span>&nbsp;<span class="op" id="3537118">&lt;&lt;</span>&nbsp;<span class="num" id="3537121">20</span>&nbsp;<span class="comment" id="3537124">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="3537133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3537136">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3537212">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3537273">var</span>&nbsp;<span class="ident" id="3537277">ErrMissingFile</span>&nbsp;<span class="op" id="3537292">=</span>&nbsp;<span class="ident" id="3537294">errors</span><span class="op" id="3537300">.</span><span class="ident" id="3537301">New</span><span class="op" id="3537304">(</span><span class="string" id="3537305">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="3537325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3537328">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3537360">type</span>&nbsp;<span class="ident" id="3537365">ProtocolError</span>&nbsp;<span class="keyword" id="3537379">struct</span>&nbsp;<span class="op" id="3537386">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537389">ErrorString</span>&nbsp;<span class="builtintype" id="3537401">string</span><br>
<span class="lineno"></span><span class="op" id="3537408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3537411">func</span>&nbsp;<span class="op" id="3537416">(</span><span class="ident" id="3537417">err</span>&nbsp;<span class="op" id="3537421">*</span><span class="ident" id="3537422">ProtocolError</span><span class="op" id="3537435">)</span>&nbsp;<span class="ident" id="3537437">Error</span><span class="op" id="3537442">(</span><span class="op" id="3537443">)</span>&nbsp;<span class="builtintype" id="3537445">string</span>&nbsp;<span class="op" id="3537452">{</span>&nbsp;<span class="keyword" id="3537454">return</span>&nbsp;<span class="ident" id="3537461">err</span><span class="op" id="3537464">.</span><span class="ident" id="3537465">ErrorString</span>&nbsp;<span class="op" id="3537477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3537480">var</span>&nbsp;<span class="op" id="3537484">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537487">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537511">=</span>&nbsp;<span class="op" id="3537513">&amp;</span><span class="ident" id="3537514">ProtocolError</span><span class="op" id="3537527">{</span><span class="string" id="3537528">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="3537545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537548">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537572">=</span>&nbsp;<span class="op" id="3537574">&amp;</span><span class="ident" id="3537575">ProtocolError</span><span class="op" id="3537588">{</span><span class="string" id="3537589">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="3537612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537615">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537639">=</span>&nbsp;<span class="op" id="3537641">&amp;</span><span class="ident" id="3537642">ProtocolError</span><span class="op" id="3537655">{</span><span class="string" id="3537656">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3537679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537682">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537706">=</span>&nbsp;<span class="op" id="3537708">&amp;</span><span class="ident" id="3537709">ProtocolError</span><span class="op" id="3537722">{</span><span class="string" id="3537723">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3537773">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537776">ErrMissingContentLength</span>&nbsp;<span class="op" id="3537800">=</span>&nbsp;<span class="op" id="3537802">&amp;</span><span class="ident" id="3537803">ProtocolError</span><span class="op" id="3537816">{</span><span class="string" id="3537817">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="3537857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537860">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537884">=</span>&nbsp;<span class="op" id="3537886">&amp;</span><span class="ident" id="3537887">ProtocolError</span><span class="op" id="3537900">{</span><span class="string" id="3537901">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="3537949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537952">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537976">=</span>&nbsp;<span class="op" id="3537978">&amp;</span><span class="ident" id="3537979">ProtocolError</span><span class="op" id="3537992">{</span><span class="string" id="3537993">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="3538038">}</span><br>
<span class="lineno"></span><span class="op" id="3538040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3538043">type</span>&nbsp;<span class="ident" id="3538048">badStringError</span>&nbsp;<span class="keyword" id="3538063">struct</span>&nbsp;<span class="op" id="3538070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538073">what</span>&nbsp;<span class="builtintype" id="3538078">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538086">str</span>&nbsp;&nbsp;<span class="builtintype" id="3538091">string</span><br>
<span class="lineno"></span><span class="op" id="3538098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3538101">func</span>&nbsp;<span class="op" id="3538106">(</span><span class="ident" id="3538107">e</span>&nbsp;<span class="op" id="3538109">*</span><span class="ident" id="3538110">badStringError</span><span class="op" id="3538124">)</span>&nbsp;<span class="ident" id="3538126">Error</span><span class="op" id="3538131">(</span><span class="op" id="3538132">)</span>&nbsp;<span class="builtintype" id="3538134">string</span>&nbsp;<span class="op" id="3538141">{</span>&nbsp;<span class="keyword" id="3538143">return</span>&nbsp;<span class="ident" id="3538150">fmt</span><span class="op" id="3538153">.</span><span class="ident" id="3538154">Sprintf</span><span class="op" id="3538161">(</span><span class="string" id="3538162">&#34;%s&nbsp;%q&#34;</span><span class="op" id="3538169">,</span>&nbsp;<span class="ident" id="3538171">e</span><span class="op" id="3538172">.</span><span class="ident" id="3538173">what</span><span class="op" id="3538177">,</span>&nbsp;<span class="ident" id="3538179">e</span><span class="op" id="3538180">.</span><span class="ident" id="3538181">str</span><span class="op" id="3538184">)</span>&nbsp;<span class="op" id="3538186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3538189">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3538257">var</span>&nbsp;<span class="ident" id="3538261">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="3538283">=</span>&nbsp;<span class="keyword" id="3538285">map</span><span class="op" id="3538288">[</span><span class="builtintype" id="3538289">string</span><span class="op" id="3538295">]</span><span class="builtintype" id="3538296">bool</span><span class="op" id="3538300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538303">&#34;Host&#34;</span><span class="op" id="3538309">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538324">true</span><span class="op" id="3538328">,</span>&nbsp;<span class="comment" id="3538330">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538359">&#34;User-Agent&#34;</span><span class="op" id="3538371">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538380">true</span><span class="op" id="3538384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538387">&#34;Content-Length&#34;</span><span class="op" id="3538403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538408">true</span><span class="op" id="3538412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538415">&#34;Transfer-Encoding&#34;</span><span class="op" id="3538434">:</span>&nbsp;<span class="ident" id="3538436">true</span><span class="op" id="3538440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538443">&#34;Trailer&#34;</span><span class="op" id="3538452">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538464">true</span><span class="op" id="3538468">,</span><br>
<span class="lineno"></span><span class="op" id="3538470">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3538473">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3538534">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3538564">//</span><br>
<span class="lineno"></span><span class="comment" id="3538567">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="3538632">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3538696">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="3538749">type</span>&nbsp;<span class="ident" id="3538754">Request</span>&nbsp;<span class="keyword" id="3538762">struct</span>&nbsp;<span class="op" id="3538769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538772">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538833">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538884">Method</span>&nbsp;<span class="builtintype" id="3538891">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538900">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538961">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539019">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539023">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539078">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539141">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539204">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539245">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539249">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539313">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539371">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539427">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539440">URL</span>&nbsp;<span class="op" id="3539444">*</span><span class="ident" id="3539445">url</span><span class="op" id="3539448">.</span><span class="ident" id="3539449">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539455">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539503">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539544">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3539555">string</span>&nbsp;<span class="comment" id="3539562">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539577">ProtoMajor</span>&nbsp;<span class="builtintype" id="3539588">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3539595">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539601">ProtoMinor</span>&nbsp;<span class="builtintype" id="3539612">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3539619">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539626">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539675">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539698">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539702">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539737">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539764">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539791">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539795">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539804">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539808">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539842">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539885">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539920">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539955">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539961">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539965">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540022">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540083">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540139">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540196">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540200">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540258">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540303">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540307">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540363">Header</span>&nbsp;<span class="ident" id="3540370">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540379">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540411">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540415">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540475">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540536">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540585">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540589">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540648">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540709">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540767">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540797">Body</span>&nbsp;<span class="ident" id="3540802">io</span><span class="op" id="3540804">.</span><span class="ident" id="3540805">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540818">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540882">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540937">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540997">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541020">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541092">ContentLength</span>&nbsp;<span class="ident" id="3541106">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541114">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541182">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541244">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541309">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541375">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541399">TransferEncoding</span>&nbsp;<span class="op" id="3541416">[</span><span class="op" id="3541417">]</span><span class="builtintype" id="3541418">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541427">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541485">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541545">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541576">Close</span>&nbsp;<span class="builtintype" id="3541582">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541589">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541650">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541711">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541775">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541814">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541818">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541877">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541937">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541964">Host</span>&nbsp;<span class="builtintype" id="3541969">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541978">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542041">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542101">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542161">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542217">Form</span>&nbsp;<span class="ident" id="3542222">url</span><span class="op" id="3542225">.</span><span class="ident" id="3542226">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542235">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542295">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542316">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542376">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542436">PostForm</span>&nbsp;<span class="ident" id="3542445">url</span><span class="op" id="3542448">.</span><span class="ident" id="3542449">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542458">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542530">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542599">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542664">MultipartForm</span>&nbsp;<span class="op" id="3542678">*</span><span class="ident" id="3542679">multipart</span><span class="op" id="3542688">.</span><span class="ident" id="3542689">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542696">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542769">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542779">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542783">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542851">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542925">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542996">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543068">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543141">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543160">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543164">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543236">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543309">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543383">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543454">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543527">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543551">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543555">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543620">Trailer</span>&nbsp;<span class="ident" id="3543628">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543637">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543701">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543760">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543820">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543879">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543941">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543954">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544000">RemoteAddr</span>&nbsp;<span class="builtintype" id="3544011">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544020">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544072">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544135">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544198">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544262">RequestURI</span>&nbsp;<span class="builtintype" id="3544273">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544282">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544339">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544401">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544463">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544518">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544573">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544612">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544658">TLS</span>&nbsp;<span class="op" id="3544662">*</span><span class="ident" id="3544663">tls</span><span class="op" id="3544666">.</span><span class="ident" id="3544667">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3544683">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3544686">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3544741">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3544784">func</span>&nbsp;<span class="op" id="3544789">(</span><span class="ident" id="3544790">r</span>&nbsp;<span class="op" id="3544792">*</span><span class="ident" id="3544793">Request</span><span class="op" id="3544800">)</span>&nbsp;<span class="ident" id="3544802">ProtoAtLeast</span><span class="op" id="3544814">(</span><span class="ident" id="3544815">major</span><span class="op" id="3544820">,</span>&nbsp;<span class="ident" id="3544822">minor</span>&nbsp;<span class="builtintype" id="3544828">int</span><span class="op" id="3544831">)</span>&nbsp;<span class="builtintype" id="3544833">bool</span>&nbsp;<span class="op" id="3544838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544841">return</span>&nbsp;<span class="ident" id="3544848">r</span><span class="op" id="3544849">.</span><span class="ident" id="3544850">ProtoMajor</span>&nbsp;<span class="op" id="3544861">&gt;</span>&nbsp;<span class="ident" id="3544863">major</span>&nbsp;<span class="op" id="3544869">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544874">r</span><span class="op" id="3544875">.</span><span class="ident" id="3544876">ProtoMajor</span>&nbsp;<span class="op" id="3544887">==</span>&nbsp;<span class="ident" id="3544890">major</span>&nbsp;<span class="op" id="3544896">&amp;&amp;</span>&nbsp;<span class="ident" id="3544899">r</span><span class="op" id="3544900">.</span><span class="ident" id="3544901">ProtoMinor</span>&nbsp;<span class="op" id="3544912">&gt;=</span>&nbsp;<span class="ident" id="3544915">minor</span><br>
<span class="lineno"></span><span class="op" id="3544921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3544924">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3544994">func</span>&nbsp;<span class="op" id="3544999">(</span><span class="ident" id="3545000">r</span>&nbsp;<span class="op" id="3545002">*</span><span class="ident" id="3545003">Request</span><span class="op" id="3545010">)</span>&nbsp;<span class="ident" id="3545012">UserAgent</span><span class="op" id="3545021">(</span><span class="op" id="3545022">)</span>&nbsp;<span class="builtintype" id="3545024">string</span>&nbsp;<span class="op" id="3545031">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545034">return</span>&nbsp;<span class="ident" id="3545041">r</span><span class="op" id="3545042">.</span><span class="ident" id="3545043">Header</span><span class="op" id="3545049">.</span><span class="ident" id="3545050">Get</span><span class="op" id="3545053">(</span><span class="string" id="3545054">&#34;User-Agent&#34;</span><span class="op" id="3545066">)</span><br>
<span class="lineno"></span><span class="op" id="3545068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3545071">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3545141">func</span>&nbsp;<span class="op" id="3545146">(</span><span class="ident" id="3545147">r</span>&nbsp;<span class="op" id="3545149">*</span><span class="ident" id="3545150">Request</span><span class="op" id="3545157">)</span>&nbsp;<span class="ident" id="3545159">Cookies</span><span class="op" id="3545166">(</span><span class="op" id="3545167">)</span>&nbsp;<span class="op" id="3545169">[</span><span class="op" id="3545170">]</span><span class="op" id="3545171">*</span><span class="ident" id="3545172">Cookie</span>&nbsp;<span class="op" id="3545179">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545182">return</span>&nbsp;<span class="ident" id="3545189">readCookies</span><span class="op" id="3545200">(</span><span class="ident" id="3545201">r</span><span class="op" id="3545202">.</span><span class="ident" id="3545203">Header</span><span class="op" id="3545209">,</span>&nbsp;<span class="string" id="3545211">&#34;&#34;</span><span class="op" id="3545213">)</span><br>
<span class="lineno"></span><span class="op" id="3545215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3545218">var</span>&nbsp;<span class="ident" id="3545222">ErrNoCookie</span>&nbsp;<span class="op" id="3545234">=</span>&nbsp;<span class="ident" id="3545236">errors</span><span class="op" id="3545242">.</span><span class="ident" id="3545243">New</span><span class="op" id="3545246">(</span><span class="string" id="3545247">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="3545279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3545282">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3545344">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3545373">func</span>&nbsp;<span class="op" id="3545378">(</span><span class="ident" id="3545379">r</span>&nbsp;<span class="op" id="3545381">*</span><span class="ident" id="3545382">Request</span><span class="op" id="3545389">)</span>&nbsp;<span class="ident" id="3545391">Cookie</span><span class="op" id="3545397">(</span><span class="ident" id="3545398">name</span>&nbsp;<span class="builtintype" id="3545403">string</span><span class="op" id="3545409">)</span>&nbsp;<span class="op" id="3545411">(</span><span class="op" id="3545412">*</span><span class="ident" id="3545413">Cookie</span><span class="op" id="3545419">,</span>&nbsp;<span class="builtintype" id="3545421">error</span><span class="op" id="3545426">)</span>&nbsp;<span class="op" id="3545428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545431">for</span>&nbsp;<span class="ident" id="3545435">_</span><span class="op" id="3545436">,</span>&nbsp;<span class="ident" id="3545438">c</span>&nbsp;<span class="op" id="3545440">:=</span>&nbsp;<span class="keyword" id="3545443">range</span>&nbsp;<span class="ident" id="3545449">readCookies</span><span class="op" id="3545460">(</span><span class="ident" id="3545461">r</span><span class="op" id="3545462">.</span><span class="ident" id="3545463">Header</span><span class="op" id="3545469">,</span>&nbsp;<span class="ident" id="3545471">name</span><span class="op" id="3545475">)</span>&nbsp;<span class="op" id="3545477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545481">return</span>&nbsp;<span class="ident" id="3545488">c</span><span class="op" id="3545489">,</span>&nbsp;<span class="ident" id="3545491">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545499">return</span>&nbsp;<span class="ident" id="3545506">nil</span><span class="op" id="3545509">,</span>&nbsp;<span class="ident" id="3545511">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="3545523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3545526">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="3545596">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="3545666">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="3545728">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="3545755">func</span>&nbsp;<span class="op" id="3545760">(</span><span class="ident" id="3545761">r</span>&nbsp;<span class="op" id="3545763">*</span><span class="ident" id="3545764">Request</span><span class="op" id="3545771">)</span>&nbsp;<span class="ident" id="3545773">AddCookie</span><span class="op" id="3545782">(</span><span class="ident" id="3545783">c</span>&nbsp;<span class="op" id="3545785">*</span><span class="ident" id="3545786">Cookie</span><span class="op" id="3545792">)</span>&nbsp;<span class="op" id="3545794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545797">s</span>&nbsp;<span class="op" id="3545799">:=</span>&nbsp;<span class="ident" id="3545802">fmt</span><span class="op" id="3545805">.</span><span class="ident" id="3545806">Sprintf</span><span class="op" id="3545813">(</span><span class="string" id="3545814">&#34;%s=%s&#34;</span><span class="op" id="3545821">,</span>&nbsp;<span class="ident" id="3545823">sanitizeCookieName</span><span class="op" id="3545841">(</span><span class="ident" id="3545842">c</span><span class="op" id="3545843">.</span><span class="ident" id="3545844">Name</span><span class="op" id="3545848">)</span><span class="op" id="3545849">,</span>&nbsp;<span class="ident" id="3545851">sanitizeCookieValue</span><span class="op" id="3545870">(</span><span class="ident" id="3545871">c</span><span class="op" id="3545872">.</span><span class="ident" id="3545873">Value</span><span class="op" id="3545878">)</span><span class="op" id="3545879">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545882">if</span>&nbsp;<span class="ident" id="3545885">c</span>&nbsp;<span class="op" id="3545887">:=</span>&nbsp;<span class="ident" id="3545890">r</span><span class="op" id="3545891">.</span><span class="ident" id="3545892">Header</span><span class="op" id="3545898">.</span><span class="ident" id="3545899">Get</span><span class="op" id="3545902">(</span><span class="string" id="3545903">&#34;Cookie&#34;</span><span class="op" id="3545911">)</span><span class="op" id="3545912">;</span>&nbsp;<span class="ident" id="3545914">c</span>&nbsp;<span class="op" id="3545916">!=</span>&nbsp;<span class="string" id="3545919">&#34;&#34;</span>&nbsp;<span class="op" id="3545922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545926">r</span><span class="op" id="3545927">.</span><span class="ident" id="3545928">Header</span><span class="op" id="3545934">.</span><span class="ident" id="3545935">Set</span><span class="op" id="3545938">(</span><span class="string" id="3545939">&#34;Cookie&#34;</span><span class="op" id="3545947">,</span>&nbsp;<span class="ident" id="3545949">c</span><span class="op" id="3545950">+</span><span class="string" id="3545951">&#34;;&nbsp;&#34;</span><span class="op" id="3545955">+</span><span class="ident" id="3545956">s</span><span class="op" id="3545957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545960">}</span>&nbsp;<span class="keyword" id="3545962">else</span>&nbsp;<span class="op" id="3545967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545971">r</span><span class="op" id="3545972">.</span><span class="ident" id="3545973">Header</span><span class="op" id="3545979">.</span><span class="ident" id="3545980">Set</span><span class="op" id="3545983">(</span><span class="string" id="3545984">&#34;Cookie&#34;</span><span class="op" id="3545992">,</span>&nbsp;<span class="ident" id="3545994">s</span><span class="op" id="3545995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545998">}</span><br>
<span class="lineno">270</span><span class="op" id="3546000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3546003">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3546065">//</span><br>
<span class="lineno"></span><span class="comment" id="3546068">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="3546138">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3546205">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3546276">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3546347">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="3546413">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="3546463">func</span>&nbsp;<span class="op" id="3546468">(</span><span class="ident" id="3546469">r</span>&nbsp;<span class="op" id="3546471">*</span><span class="ident" id="3546472">Request</span><span class="op" id="3546479">)</span>&nbsp;<span class="ident" id="3546481">Referer</span><span class="op" id="3546488">(</span><span class="op" id="3546489">)</span>&nbsp;<span class="builtintype" id="3546491">string</span>&nbsp;<span class="op" id="3546498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546501">return</span>&nbsp;<span class="ident" id="3546508">r</span><span class="op" id="3546509">.</span><span class="ident" id="3546510">Header</span><span class="op" id="3546516">.</span><span class="ident" id="3546517">Get</span><span class="op" id="3546520">(</span><span class="string" id="3546521">&#34;Referer&#34;</span><span class="op" id="3546530">)</span><br>
<span class="lineno"></span><span class="op" id="3546532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3546535">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="3546577">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3546656">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="3546736">var</span>&nbsp;<span class="ident" id="3546740">multipartByReader</span>&nbsp;<span class="op" id="3546758">=</span>&nbsp;<span class="op" id="3546760">&amp;</span><span class="ident" id="3546761">multipart</span><span class="op" id="3546770">.</span><span class="ident" id="3546771">Form</span><span class="op" id="3546775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546778">Value</span><span class="op" id="3546783">:</span>&nbsp;<span class="builtinfunc" id="3546785">make</span><span class="op" id="3546789">(</span><span class="keyword" id="3546790">map</span><span class="op" id="3546793">[</span><span class="builtintype" id="3546794">string</span><span class="op" id="3546800">]</span><span class="op" id="3546801">[</span><span class="op" id="3546802">]</span><span class="builtintype" id="3546803">string</span><span class="op" id="3546809">)</span><span class="op" id="3546810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546813">File</span><span class="op" id="3546817">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3546820">make</span><span class="op" id="3546824">(</span><span class="keyword" id="3546825">map</span><span class="op" id="3546828">[</span><span class="builtintype" id="3546829">string</span><span class="op" id="3546835">]</span><span class="op" id="3546836">[</span><span class="op" id="3546837">]</span><span class="op" id="3546838">*</span><span class="ident" id="3546839">multipart</span><span class="op" id="3546848">.</span><span class="ident" id="3546849">FileHeader</span><span class="op" id="3546859">)</span><span class="op" id="3546860">,</span><br>
<span class="lineno">290</span><span class="op" id="3546862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3546865">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3546929">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3546997">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="3547051">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3547092">func</span>&nbsp;<span class="op" id="3547097">(</span><span class="ident" id="3547098">r</span>&nbsp;<span class="op" id="3547100">*</span><span class="ident" id="3547101">Request</span><span class="op" id="3547108">)</span>&nbsp;<span class="ident" id="3547110">MultipartReader</span><span class="op" id="3547125">(</span><span class="op" id="3547126">)</span>&nbsp;<span class="op" id="3547128">(</span><span class="op" id="3547129">*</span><span class="ident" id="3547130">multipart</span><span class="op" id="3547139">.</span><span class="ident" id="3547140">Reader</span><span class="op" id="3547146">,</span>&nbsp;<span class="builtintype" id="3547148">error</span><span class="op" id="3547153">)</span>&nbsp;<span class="op" id="3547155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547158">if</span>&nbsp;<span class="ident" id="3547161">r</span><span class="op" id="3547162">.</span><span class="ident" id="3547163">MultipartForm</span>&nbsp;<span class="op" id="3547177">==</span>&nbsp;<span class="ident" id="3547180">multipartByReader</span>&nbsp;<span class="op" id="3547198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547202">return</span>&nbsp;<span class="ident" id="3547209">nil</span><span class="op" id="3547212">,</span>&nbsp;<span class="ident" id="3547214">errors</span><span class="op" id="3547220">.</span><span class="ident" id="3547221">New</span><span class="op" id="3547224">(</span><span class="string" id="3547225">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="3547261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547264">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547267">if</span>&nbsp;<span class="ident" id="3547270">r</span><span class="op" id="3547271">.</span><span class="ident" id="3547272">MultipartForm</span>&nbsp;<span class="op" id="3547286">!=</span>&nbsp;<span class="ident" id="3547289">nil</span>&nbsp;<span class="op" id="3547293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547297">return</span>&nbsp;<span class="ident" id="3547304">nil</span><span class="op" id="3547307">,</span>&nbsp;<span class="ident" id="3547309">errors</span><span class="op" id="3547315">.</span><span class="ident" id="3547316">New</span><span class="op" id="3547319">(</span><span class="string" id="3547320">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="3547367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547373">r</span><span class="op" id="3547374">.</span><span class="ident" id="3547375">MultipartForm</span>&nbsp;<span class="op" id="3547389">=</span>&nbsp;<span class="ident" id="3547391">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547410">return</span>&nbsp;<span class="ident" id="3547417">r</span><span class="op" id="3547418">.</span><span class="ident" id="3547419">multipartReader</span><span class="op" id="3547434">(</span><span class="op" id="3547435">)</span><br>
<span class="lineno">305</span><span class="op" id="3547437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3547440">func</span>&nbsp;<span class="op" id="3547445">(</span><span class="ident" id="3547446">r</span>&nbsp;<span class="op" id="3547448">*</span><span class="ident" id="3547449">Request</span><span class="op" id="3547456">)</span>&nbsp;<span class="ident" id="3547458">multipartReader</span><span class="op" id="3547473">(</span><span class="op" id="3547474">)</span>&nbsp;<span class="op" id="3547476">(</span><span class="op" id="3547477">*</span><span class="ident" id="3547478">multipart</span><span class="op" id="3547487">.</span><span class="ident" id="3547488">Reader</span><span class="op" id="3547494">,</span>&nbsp;<span class="builtintype" id="3547496">error</span><span class="op" id="3547501">)</span>&nbsp;<span class="op" id="3547503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547506">v</span>&nbsp;<span class="op" id="3547508">:=</span>&nbsp;<span class="ident" id="3547511">r</span><span class="op" id="3547512">.</span><span class="ident" id="3547513">Header</span><span class="op" id="3547519">.</span><span class="ident" id="3547520">Get</span><span class="op" id="3547523">(</span><span class="string" id="3547524">&#34;Content-Type&#34;</span><span class="op" id="3547538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547541">if</span>&nbsp;<span class="ident" id="3547544">v</span>&nbsp;<span class="op" id="3547546">==</span>&nbsp;<span class="string" id="3547549">&#34;&#34;</span>&nbsp;<span class="op" id="3547552">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547556">return</span>&nbsp;<span class="ident" id="3547563">nil</span><span class="op" id="3547566">,</span>&nbsp;<span class="ident" id="3547568">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547588">d</span><span class="op" id="3547589">,</span>&nbsp;<span class="ident" id="3547591">params</span><span class="op" id="3547597">,</span>&nbsp;<span class="ident" id="3547599">err</span>&nbsp;<span class="op" id="3547603">:=</span>&nbsp;<span class="ident" id="3547606">mime</span><span class="op" id="3547610">.</span><span class="ident" id="3547611">ParseMediaType</span><span class="op" id="3547625">(</span><span class="ident" id="3547626">v</span><span class="op" id="3547627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547630">if</span>&nbsp;<span class="ident" id="3547633">err</span>&nbsp;<span class="op" id="3547637">!=</span>&nbsp;<span class="ident" id="3547640">nil</span>&nbsp;<span class="op" id="3547644">||</span>&nbsp;<span class="ident" id="3547647">d</span>&nbsp;<span class="op" id="3547649">!=</span>&nbsp;<span class="string" id="3547652">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="3547674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547678">return</span>&nbsp;<span class="ident" id="3547685">nil</span><span class="op" id="3547688">,</span>&nbsp;<span class="ident" id="3547690">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547710">boundary</span><span class="op" id="3547718">,</span>&nbsp;<span class="ident" id="3547720">ok</span>&nbsp;<span class="op" id="3547723">:=</span>&nbsp;<span class="ident" id="3547726">params</span><span class="op" id="3547732">[</span><span class="string" id="3547733">&#34;boundary&#34;</span><span class="op" id="3547743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547746">if</span>&nbsp;<span class="op" id="3547749">!</span><span class="ident" id="3547750">ok</span>&nbsp;<span class="op" id="3547753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547757">return</span>&nbsp;<span class="ident" id="3547764">nil</span><span class="op" id="3547767">,</span>&nbsp;<span class="ident" id="3547769">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547789">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547792">return</span>&nbsp;<span class="ident" id="3547799">multipart</span><span class="op" id="3547808">.</span><span class="ident" id="3547809">NewReader</span><span class="op" id="3547818">(</span><span class="ident" id="3547819">r</span><span class="op" id="3547820">.</span><span class="ident" id="3547821">Body</span><span class="op" id="3547825">,</span>&nbsp;<span class="ident" id="3547827">boundary</span><span class="op" id="3547835">)</span><span class="op" id="3547836">,</span>&nbsp;<span class="ident" id="3547838">nil</span><br>
<span class="lineno"></span><span class="op" id="3547842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3547845">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3547889">func</span>&nbsp;<span class="ident" id="3547894">valueOrDefault</span><span class="op" id="3547908">(</span><span class="ident" id="3547909">value</span><span class="op" id="3547914">,</span>&nbsp;<span class="ident" id="3547916">def</span>&nbsp;<span class="builtintype" id="3547920">string</span><span class="op" id="3547926">)</span>&nbsp;<span class="builtintype" id="3547928">string</span>&nbsp;<span class="op" id="3547935">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547938">if</span>&nbsp;<span class="ident" id="3547941">value</span>&nbsp;<span class="op" id="3547947">!=</span>&nbsp;<span class="string" id="3547950">&#34;&#34;</span>&nbsp;<span class="op" id="3547953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547957">return</span>&nbsp;<span class="ident" id="3547964">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547974">return</span>&nbsp;<span class="ident" id="3547981">def</span><br>
<span class="lineno"></span><span class="op" id="3547985">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3547988">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3548063">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3548136">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3548209">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="3548265">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="3548312">const</span>&nbsp;<span class="ident" id="3548318">defaultUserAgent</span>&nbsp;<span class="op" id="3548335">=</span>&nbsp;<span class="string" id="3548337">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3548360">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3548434">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="3548495">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="3548503">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="3548510">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3548540">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="3548550">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="3548567">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3548587">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="3548595">//</span><br>
<span class="lineno"></span><span class="comment" id="3548598">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3548665">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="3548730">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3548790">func</span>&nbsp;<span class="op" id="3548795">(</span><span class="ident" id="3548796">r</span>&nbsp;<span class="op" id="3548798">*</span><span class="ident" id="3548799">Request</span><span class="op" id="3548806">)</span>&nbsp;<span class="ident" id="3548808">Write</span><span class="op" id="3548813">(</span><span class="ident" id="3548814">w</span>&nbsp;<span class="ident" id="3548816">io</span><span class="op" id="3548818">.</span><span class="ident" id="3548819">Writer</span><span class="op" id="3548825">)</span>&nbsp;<span class="builtintype" id="3548827">error</span>&nbsp;<span class="op" id="3548833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548836">return</span>&nbsp;<span class="ident" id="3548843">r</span><span class="op" id="3548844">.</span><span class="ident" id="3548845">write</span><span class="op" id="3548850">(</span><span class="ident" id="3548851">w</span><span class="op" id="3548852">,</span>&nbsp;<span class="ident" id="3548854">false</span><span class="op" id="3548859">,</span>&nbsp;<span class="ident" id="3548861">nil</span><span class="op" id="3548864">)</span><br>
<span class="lineno"></span><span class="op" id="3548866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3548869">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3548932">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3549000">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3549069">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3549130">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="3549193">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="3549225">func</span>&nbsp;<span class="op" id="3549230">(</span><span class="ident" id="3549231">r</span>&nbsp;<span class="op" id="3549233">*</span><span class="ident" id="3549234">Request</span><span class="op" id="3549241">)</span>&nbsp;<span class="ident" id="3549243">WriteProxy</span><span class="op" id="3549253">(</span><span class="ident" id="3549254">w</span>&nbsp;<span class="ident" id="3549256">io</span><span class="op" id="3549258">.</span><span class="ident" id="3549259">Writer</span><span class="op" id="3549265">)</span>&nbsp;<span class="builtintype" id="3549267">error</span>&nbsp;<span class="op" id="3549273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549276">return</span>&nbsp;<span class="ident" id="3549283">r</span><span class="op" id="3549284">.</span><span class="ident" id="3549285">write</span><span class="op" id="3549290">(</span><span class="ident" id="3549291">w</span><span class="op" id="3549292">,</span>&nbsp;<span class="ident" id="3549294">true</span><span class="op" id="3549298">,</span>&nbsp;<span class="ident" id="3549300">nil</span><span class="op" id="3549303">)</span><br>
<span class="lineno"></span><span class="op" id="3549305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3549308">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="3549335">func</span>&nbsp;<span class="op" id="3549340">(</span><span class="ident" id="3549341">req</span>&nbsp;<span class="op" id="3549345">*</span><span class="ident" id="3549346">Request</span><span class="op" id="3549353">)</span>&nbsp;<span class="ident" id="3549355">write</span><span class="op" id="3549360">(</span><span class="ident" id="3549361">w</span>&nbsp;<span class="ident" id="3549363">io</span><span class="op" id="3549365">.</span><span class="ident" id="3549366">Writer</span><span class="op" id="3549372">,</span>&nbsp;<span class="ident" id="3549374">usingProxy</span>&nbsp;<span class="builtintype" id="3549385">bool</span><span class="op" id="3549389">,</span>&nbsp;<span class="ident" id="3549391">extraHeaders</span>&nbsp;<span class="ident" id="3549404">Header</span><span class="op" id="3549410">)</span>&nbsp;<span class="builtintype" id="3549412">error</span>&nbsp;<span class="op" id="3549418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549421">host</span>&nbsp;<span class="op" id="3549426">:=</span>&nbsp;<span class="ident" id="3549429">req</span><span class="op" id="3549432">.</span><span class="ident" id="3549433">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549439">if</span>&nbsp;<span class="ident" id="3549442">host</span>&nbsp;<span class="op" id="3549447">==</span>&nbsp;<span class="string" id="3549450">&#34;&#34;</span>&nbsp;<span class="op" id="3549453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549457">if</span>&nbsp;<span class="ident" id="3549460">req</span><span class="op" id="3549463">.</span><span class="ident" id="3549464">URL</span>&nbsp;<span class="op" id="3549468">==</span>&nbsp;<span class="ident" id="3549471">nil</span>&nbsp;<span class="op" id="3549475">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549480">return</span>&nbsp;<span class="ident" id="3549487">errors</span><span class="op" id="3549493">.</span><span class="ident" id="3549494">New</span><span class="op" id="3549497">(</span><span class="string" id="3549498">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="3549554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549562">host</span>&nbsp;<span class="op" id="3549567">=</span>&nbsp;<span class="ident" id="3549569">req</span><span class="op" id="3549572">.</span><span class="ident" id="3549573">URL</span><span class="op" id="3549576">.</span><span class="ident" id="3549577">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549587">ruri</span>&nbsp;<span class="op" id="3549592">:=</span>&nbsp;<span class="ident" id="3549595">req</span><span class="op" id="3549598">.</span><span class="ident" id="3549599">URL</span><span class="op" id="3549602">.</span><span class="ident" id="3549603">RequestURI</span><span class="op" id="3549613">(</span><span class="op" id="3549614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549617">if</span>&nbsp;<span class="ident" id="3549620">usingProxy</span>&nbsp;<span class="op" id="3549631">&amp;&amp;</span>&nbsp;<span class="ident" id="3549634">req</span><span class="op" id="3549637">.</span><span class="ident" id="3549638">URL</span><span class="op" id="3549641">.</span><span class="ident" id="3549642">Scheme</span>&nbsp;<span class="op" id="3549649">!=</span>&nbsp;<span class="string" id="3549652">&#34;&#34;</span>&nbsp;<span class="op" id="3549655">&amp;&amp;</span>&nbsp;<span class="ident" id="3549658">req</span><span class="op" id="3549661">.</span><span class="ident" id="3549662">URL</span><span class="op" id="3549665">.</span><span class="ident" id="3549666">Opaque</span>&nbsp;<span class="op" id="3549673">==</span>&nbsp;<span class="string" id="3549676">&#34;&#34;</span>&nbsp;<span class="op" id="3549679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549683">ruri</span>&nbsp;<span class="op" id="3549688">=</span>&nbsp;<span class="ident" id="3549690">req</span><span class="op" id="3549693">.</span><span class="ident" id="3549694">URL</span><span class="op" id="3549697">.</span><span class="ident" id="3549698">Scheme</span>&nbsp;<span class="op" id="3549705">+</span>&nbsp;<span class="string" id="3549707">&#34;://&#34;</span>&nbsp;<span class="op" id="3549713">+</span>&nbsp;<span class="ident" id="3549715">host</span>&nbsp;<span class="op" id="3549720">+</span>&nbsp;<span class="ident" id="3549722">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549728">}</span>&nbsp;<span class="keyword" id="3549730">else</span>&nbsp;<span class="keyword" id="3549735">if</span>&nbsp;<span class="ident" id="3549738">req</span><span class="op" id="3549741">.</span><span class="ident" id="3549742">Method</span>&nbsp;<span class="op" id="3549749">==</span>&nbsp;<span class="string" id="3549752">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3549762">&amp;&amp;</span>&nbsp;<span class="ident" id="3549765">req</span><span class="op" id="3549768">.</span><span class="ident" id="3549769">URL</span><span class="op" id="3549772">.</span><span class="ident" id="3549773">Path</span>&nbsp;<span class="op" id="3549778">==</span>&nbsp;<span class="string" id="3549781">&#34;&#34;</span>&nbsp;<span class="op" id="3549784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549788">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549864">ruri</span>&nbsp;<span class="op" id="3549869">=</span>&nbsp;<span class="ident" id="3549871">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549880">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549935">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550003">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550066">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550128">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550138">var</span>&nbsp;<span class="ident" id="3550142">bw</span>&nbsp;<span class="op" id="3550145">*</span><span class="ident" id="3550146">bufio</span><span class="op" id="3550151">.</span><span class="ident" id="3550152">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550160">if</span>&nbsp;<span class="ident" id="3550163">_</span><span class="op" id="3550164">,</span>&nbsp;<span class="ident" id="3550166">ok</span>&nbsp;<span class="op" id="3550169">:=</span>&nbsp;<span class="ident" id="3550172">w</span><span class="op" id="3550173">.</span><span class="op" id="3550174">(</span><span class="ident" id="3550175">io</span><span class="op" id="3550177">.</span><span class="ident" id="3550178">ByteWriter</span><span class="op" id="3550188">)</span><span class="op" id="3550189">;</span>&nbsp;<span class="op" id="3550191">!</span><span class="ident" id="3550192">ok</span>&nbsp;<span class="op" id="3550195">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550199">bw</span>&nbsp;<span class="op" id="3550202">=</span>&nbsp;<span class="ident" id="3550204">bufio</span><span class="op" id="3550209">.</span><span class="ident" id="3550210">NewWriter</span><span class="op" id="3550219">(</span><span class="ident" id="3550220">w</span><span class="op" id="3550221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550225">w</span>&nbsp;<span class="op" id="3550227">=</span>&nbsp;<span class="ident" id="3550229">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550237">_</span><span class="op" id="3550238">,</span>&nbsp;<span class="ident" id="3550240">err</span>&nbsp;<span class="op" id="3550244">:=</span>&nbsp;<span class="ident" id="3550247">fmt</span><span class="op" id="3550250">.</span><span class="ident" id="3550251">Fprintf</span><span class="op" id="3550258">(</span><span class="ident" id="3550259">w</span><span class="op" id="3550260">,</span>&nbsp;<span class="string" id="3550262">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="3550282">,</span>&nbsp;<span class="ident" id="3550284">valueOrDefault</span><span class="op" id="3550298">(</span><span class="ident" id="3550299">req</span><span class="op" id="3550302">.</span><span class="ident" id="3550303">Method</span><span class="op" id="3550309">,</span>&nbsp;<span class="string" id="3550311">&#34;GET&#34;</span><span class="op" id="3550316">)</span><span class="op" id="3550317">,</span>&nbsp;<span class="ident" id="3550319">ruri</span><span class="op" id="3550323">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550326">if</span>&nbsp;<span class="ident" id="3550329">err</span>&nbsp;<span class="op" id="3550333">!=</span>&nbsp;<span class="ident" id="3550336">nil</span>&nbsp;<span class="op" id="3550340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550344">return</span>&nbsp;<span class="ident" id="3550351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550360">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550377">_</span><span class="op" id="3550378">,</span>&nbsp;<span class="ident" id="3550380">err</span>&nbsp;<span class="op" id="3550384">=</span>&nbsp;<span class="ident" id="3550386">fmt</span><span class="op" id="3550389">.</span><span class="ident" id="3550390">Fprintf</span><span class="op" id="3550397">(</span><span class="ident" id="3550398">w</span><span class="op" id="3550399">,</span>&nbsp;<span class="string" id="3550401">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="3550415">,</span>&nbsp;<span class="ident" id="3550417">host</span><span class="op" id="3550421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550424">if</span>&nbsp;<span class="ident" id="3550427">err</span>&nbsp;<span class="op" id="3550431">!=</span>&nbsp;<span class="ident" id="3550434">nil</span>&nbsp;<span class="op" id="3550438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550442">return</span>&nbsp;<span class="ident" id="3550449">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550458">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550525">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550566">userAgent</span>&nbsp;<span class="op" id="3550576">:=</span>&nbsp;<span class="ident" id="3550579">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550597">if</span>&nbsp;<span class="ident" id="3550600">req</span><span class="op" id="3550603">.</span><span class="ident" id="3550604">Header</span>&nbsp;<span class="op" id="3550611">!=</span>&nbsp;<span class="ident" id="3550614">nil</span>&nbsp;<span class="op" id="3550618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550622">if</span>&nbsp;<span class="ident" id="3550625">ua</span>&nbsp;<span class="op" id="3550628">:=</span>&nbsp;<span class="ident" id="3550631">req</span><span class="op" id="3550634">.</span><span class="ident" id="3550635">Header</span><span class="op" id="3550641">[</span><span class="string" id="3550642">&#34;User-Agent&#34;</span><span class="op" id="3550654">]</span><span class="op" id="3550655">;</span>&nbsp;<span class="builtinfunc" id="3550657">len</span><span class="op" id="3550660">(</span><span class="ident" id="3550661">ua</span><span class="op" id="3550663">)</span>&nbsp;<span class="op" id="3550665">&gt;</span>&nbsp;<span class="num" id="3550667">0</span>&nbsp;<span class="op" id="3550669">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550674">userAgent</span>&nbsp;<span class="op" id="3550684">=</span>&nbsp;<span class="ident" id="3550686">ua</span><span class="op" id="3550688">[</span><span class="num" id="3550689">0</span><span class="op" id="3550690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550700">if</span>&nbsp;<span class="ident" id="3550703">userAgent</span>&nbsp;<span class="op" id="3550713">!=</span>&nbsp;<span class="string" id="3550716">&#34;&#34;</span>&nbsp;<span class="op" id="3550719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550723">_</span><span class="op" id="3550724">,</span>&nbsp;<span class="ident" id="3550726">err</span>&nbsp;<span class="op" id="3550730">=</span>&nbsp;<span class="ident" id="3550732">fmt</span><span class="op" id="3550735">.</span><span class="ident" id="3550736">Fprintf</span><span class="op" id="3550743">(</span><span class="ident" id="3550744">w</span><span class="op" id="3550745">,</span>&nbsp;<span class="string" id="3550747">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="3550767">,</span>&nbsp;<span class="ident" id="3550769">userAgent</span><span class="op" id="3550778">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550782">if</span>&nbsp;<span class="ident" id="3550785">err</span>&nbsp;<span class="op" id="3550789">!=</span>&nbsp;<span class="ident" id="3550792">nil</span>&nbsp;<span class="op" id="3550796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550801">return</span>&nbsp;<span class="ident" id="3550808">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550821">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550866">tw</span><span class="op" id="3550868">,</span>&nbsp;<span class="ident" id="3550870">err</span>&nbsp;<span class="op" id="3550874">:=</span>&nbsp;<span class="ident" id="3550877">newTransferWriter</span><span class="op" id="3550894">(</span><span class="ident" id="3550895">req</span><span class="op" id="3550898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550901">if</span>&nbsp;<span class="ident" id="3550904">err</span>&nbsp;<span class="op" id="3550908">!=</span>&nbsp;<span class="ident" id="3550911">nil</span>&nbsp;<span class="op" id="3550915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550919">return</span>&nbsp;<span class="ident" id="3550926">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550931">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550934">err</span>&nbsp;<span class="op" id="3550938">=</span>&nbsp;<span class="ident" id="3550940">tw</span><span class="op" id="3550942">.</span><span class="ident" id="3550943">WriteHeader</span><span class="op" id="3550954">(</span><span class="ident" id="3550955">w</span><span class="op" id="3550956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550959">if</span>&nbsp;<span class="ident" id="3550962">err</span>&nbsp;<span class="op" id="3550966">!=</span>&nbsp;<span class="ident" id="3550969">nil</span>&nbsp;<span class="op" id="3550973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550977">return</span>&nbsp;<span class="ident" id="3550984">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550993">err</span>&nbsp;<span class="op" id="3550997">=</span>&nbsp;<span class="ident" id="3550999">req</span><span class="op" id="3551002">.</span><span class="ident" id="3551003">Header</span><span class="op" id="3551009">.</span><span class="ident" id="3551010">WriteSubset</span><span class="op" id="3551021">(</span><span class="ident" id="3551022">w</span><span class="op" id="3551023">,</span>&nbsp;<span class="ident" id="3551025">reqWriteExcludeHeader</span><span class="op" id="3551046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551049">if</span>&nbsp;<span class="ident" id="3551052">err</span>&nbsp;<span class="op" id="3551056">!=</span>&nbsp;<span class="ident" id="3551059">nil</span>&nbsp;<span class="op" id="3551063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551067">return</span>&nbsp;<span class="ident" id="3551074">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551083">if</span>&nbsp;<span class="ident" id="3551086">extraHeaders</span>&nbsp;<span class="op" id="3551099">!=</span>&nbsp;<span class="ident" id="3551102">nil</span>&nbsp;<span class="op" id="3551106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551110">err</span>&nbsp;<span class="op" id="3551114">=</span>&nbsp;<span class="ident" id="3551116">extraHeaders</span><span class="op" id="3551128">.</span><span class="ident" id="3551129">Write</span><span class="op" id="3551134">(</span><span class="ident" id="3551135">w</span><span class="op" id="3551136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551140">if</span>&nbsp;<span class="ident" id="3551143">err</span>&nbsp;<span class="op" id="3551147">!=</span>&nbsp;<span class="ident" id="3551150">nil</span>&nbsp;<span class="op" id="3551154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551159">return</span>&nbsp;<span class="ident" id="3551166">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551172">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551179">_</span><span class="op" id="3551180">,</span>&nbsp;<span class="ident" id="3551182">err</span>&nbsp;<span class="op" id="3551186">=</span>&nbsp;<span class="ident" id="3551188">io</span><span class="op" id="3551190">.</span><span class="ident" id="3551191">WriteString</span><span class="op" id="3551202">(</span><span class="ident" id="3551203">w</span><span class="op" id="3551204">,</span>&nbsp;<span class="string" id="3551206">&#34;\r\n&#34;</span><span class="op" id="3551212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551215">if</span>&nbsp;<span class="ident" id="3551218">err</span>&nbsp;<span class="op" id="3551222">!=</span>&nbsp;<span class="ident" id="3551225">nil</span>&nbsp;<span class="op" id="3551229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551233">return</span>&nbsp;<span class="ident" id="3551240">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551249">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551276">err</span>&nbsp;<span class="op" id="3551280">=</span>&nbsp;<span class="ident" id="3551282">tw</span><span class="op" id="3551284">.</span><span class="ident" id="3551285">WriteBody</span><span class="op" id="3551294">(</span><span class="ident" id="3551295">w</span><span class="op" id="3551296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551299">if</span>&nbsp;<span class="ident" id="3551302">err</span>&nbsp;<span class="op" id="3551306">!=</span>&nbsp;<span class="ident" id="3551309">nil</span>&nbsp;<span class="op" id="3551313">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551317">return</span>&nbsp;<span class="ident" id="3551324">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551333">if</span>&nbsp;<span class="ident" id="3551336">bw</span>&nbsp;<span class="op" id="3551339">!=</span>&nbsp;<span class="ident" id="3551342">nil</span>&nbsp;<span class="op" id="3551346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551350">return</span>&nbsp;<span class="ident" id="3551357">bw</span><span class="op" id="3551359">.</span><span class="ident" id="3551360">Flush</span><span class="op" id="3551365">(</span><span class="op" id="3551366">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551372">return</span>&nbsp;<span class="ident" id="3551379">nil</span><br>
<span class="lineno"></span><span class="op" id="3551383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3551386">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="3551436">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3551472">func</span>&nbsp;<span class="ident" id="3551477">ParseHTTPVersion</span><span class="op" id="3551493">(</span><span class="ident" id="3551494">vers</span>&nbsp;<span class="builtintype" id="3551499">string</span><span class="op" id="3551505">)</span>&nbsp;<span class="op" id="3551507">(</span><span class="ident" id="3551508">major</span><span class="op" id="3551513">,</span>&nbsp;<span class="ident" id="3551515">minor</span>&nbsp;<span class="builtintype" id="3551521">int</span><span class="op" id="3551524">,</span>&nbsp;<span class="ident" id="3551526">ok</span>&nbsp;<span class="builtintype" id="3551529">bool</span><span class="op" id="3551533">)</span>&nbsp;<span class="op" id="3551535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551538">const</span>&nbsp;<span class="ident" id="3551544">Big</span>&nbsp;<span class="op" id="3551548">=</span>&nbsp;<span class="num" id="3551550">1000000</span>&nbsp;<span class="comment" id="3551558">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551584">switch</span>&nbsp;<span class="ident" id="3551591">vers</span>&nbsp;<span class="op" id="3551596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551599">case</span>&nbsp;<span class="string" id="3551604">&#34;HTTP/1.1&#34;</span><span class="op" id="3551614">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551618">return</span>&nbsp;<span class="num" id="3551625">1</span><span class="op" id="3551626">,</span>&nbsp;<span class="num" id="3551628">1</span><span class="op" id="3551629">,</span>&nbsp;<span class="ident" id="3551631">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551637">case</span>&nbsp;<span class="string" id="3551642">&#34;HTTP/1.0&#34;</span><span class="op" id="3551652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551656">return</span>&nbsp;<span class="num" id="3551663">1</span><span class="op" id="3551664">,</span>&nbsp;<span class="num" id="3551666">0</span><span class="op" id="3551667">,</span>&nbsp;<span class="ident" id="3551669">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551678">if</span>&nbsp;<span class="op" id="3551681">!</span><span class="ident" id="3551682">strings</span><span class="op" id="3551689">.</span><span class="ident" id="3551690">HasPrefix</span><span class="op" id="3551699">(</span><span class="ident" id="3551700">vers</span><span class="op" id="3551704">,</span>&nbsp;<span class="string" id="3551706">&#34;HTTP/&#34;</span><span class="op" id="3551713">)</span>&nbsp;<span class="op" id="3551715">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551719">return</span>&nbsp;<span class="num" id="3551726">0</span><span class="op" id="3551727">,</span>&nbsp;<span class="num" id="3551729">0</span><span class="op" id="3551730">,</span>&nbsp;<span class="ident" id="3551732">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551742">dot</span>&nbsp;<span class="op" id="3551746">:=</span>&nbsp;<span class="ident" id="3551749">strings</span><span class="op" id="3551756">.</span><span class="ident" id="3551757">Index</span><span class="op" id="3551762">(</span><span class="ident" id="3551763">vers</span><span class="op" id="3551767">,</span>&nbsp;<span class="string" id="3551769">&#34;.&#34;</span><span class="op" id="3551772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551775">if</span>&nbsp;<span class="ident" id="3551778">dot</span>&nbsp;<span class="op" id="3551782">&lt;</span>&nbsp;<span class="num" id="3551784">0</span>&nbsp;<span class="op" id="3551786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551790">return</span>&nbsp;<span class="num" id="3551797">0</span><span class="op" id="3551798">,</span>&nbsp;<span class="num" id="3551800">0</span><span class="op" id="3551801">,</span>&nbsp;<span class="ident" id="3551803">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551813">major</span><span class="op" id="3551818">,</span>&nbsp;<span class="ident" id="3551820">err</span>&nbsp;<span class="op" id="3551824">:=</span>&nbsp;<span class="ident" id="3551827">strconv</span><span class="op" id="3551834">.</span><span class="ident" id="3551835">Atoi</span><span class="op" id="3551839">(</span><span class="ident" id="3551840">vers</span><span class="op" id="3551844">[</span><span class="num" id="3551845">5</span><span class="op" id="3551846">:</span><span class="ident" id="3551847">dot</span><span class="op" id="3551850">]</span><span class="op" id="3551851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551854">if</span>&nbsp;<span class="ident" id="3551857">err</span>&nbsp;<span class="op" id="3551861">!=</span>&nbsp;<span class="ident" id="3551864">nil</span>&nbsp;<span class="op" id="3551868">||</span>&nbsp;<span class="ident" id="3551871">major</span>&nbsp;<span class="op" id="3551877">&lt;</span>&nbsp;<span class="num" id="3551879">0</span>&nbsp;<span class="op" id="3551881">||</span>&nbsp;<span class="ident" id="3551884">major</span>&nbsp;<span class="op" id="3551890">&gt;</span>&nbsp;<span class="ident" id="3551892">Big</span>&nbsp;<span class="op" id="3551896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551900">return</span>&nbsp;<span class="num" id="3551907">0</span><span class="op" id="3551908">,</span>&nbsp;<span class="num" id="3551910">0</span><span class="op" id="3551911">,</span>&nbsp;<span class="ident" id="3551913">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551920">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551923">minor</span><span class="op" id="3551928">,</span>&nbsp;<span class="ident" id="3551930">err</span>&nbsp;<span class="op" id="3551934">=</span>&nbsp;<span class="ident" id="3551936">strconv</span><span class="op" id="3551943">.</span><span class="ident" id="3551944">Atoi</span><span class="op" id="3551948">(</span><span class="ident" id="3551949">vers</span><span class="op" id="3551953">[</span><span class="ident" id="3551954">dot</span><span class="op" id="3551957">+</span><span class="num" id="3551958">1</span><span class="op" id="3551959">:</span><span class="op" id="3551960">]</span><span class="op" id="3551961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551964">if</span>&nbsp;<span class="ident" id="3551967">err</span>&nbsp;<span class="op" id="3551971">!=</span>&nbsp;<span class="ident" id="3551974">nil</span>&nbsp;<span class="op" id="3551978">||</span>&nbsp;<span class="ident" id="3551981">minor</span>&nbsp;<span class="op" id="3551987">&lt;</span>&nbsp;<span class="num" id="3551989">0</span>&nbsp;<span class="op" id="3551991">||</span>&nbsp;<span class="ident" id="3551994">minor</span>&nbsp;<span class="op" id="3552000">&gt;</span>&nbsp;<span class="ident" id="3552002">Big</span>&nbsp;<span class="op" id="3552006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552010">return</span>&nbsp;<span class="num" id="3552017">0</span><span class="op" id="3552018">,</span>&nbsp;<span class="num" id="3552020">0</span><span class="op" id="3552021">,</span>&nbsp;<span class="ident" id="3552023">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552033">return</span>&nbsp;<span class="ident" id="3552040">major</span><span class="op" id="3552045">,</span>&nbsp;<span class="ident" id="3552047">minor</span><span class="op" id="3552052">,</span>&nbsp;<span class="ident" id="3552054">true</span><br>
<span class="lineno">485</span><span class="op" id="3552059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3552062">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3552138">//</span><br>
<span class="lineno"></span><span class="comment" id="3552141">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="3552200">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="3552264">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="3552324">func</span>&nbsp;<span class="ident" id="3552329">NewRequest</span><span class="op" id="3552339">(</span><span class="ident" id="3552340">method</span><span class="op" id="3552346">,</span>&nbsp;<span class="ident" id="3552348">urlStr</span>&nbsp;<span class="builtintype" id="3552355">string</span><span class="op" id="3552361">,</span>&nbsp;<span class="ident" id="3552363">body</span>&nbsp;<span class="ident" id="3552368">io</span><span class="op" id="3552370">.</span><span class="ident" id="3552371">Reader</span><span class="op" id="3552377">)</span>&nbsp;<span class="op" id="3552379">(</span><span class="op" id="3552380">*</span><span class="ident" id="3552381">Request</span><span class="op" id="3552388">,</span>&nbsp;<span class="builtintype" id="3552390">error</span><span class="op" id="3552395">)</span>&nbsp;<span class="op" id="3552397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552400">u</span><span class="op" id="3552401">,</span>&nbsp;<span class="ident" id="3552403">err</span>&nbsp;<span class="op" id="3552407">:=</span>&nbsp;<span class="ident" id="3552410">url</span><span class="op" id="3552413">.</span><span class="ident" id="3552414">Parse</span><span class="op" id="3552419">(</span><span class="ident" id="3552420">urlStr</span><span class="op" id="3552426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552429">if</span>&nbsp;<span class="ident" id="3552432">err</span>&nbsp;<span class="op" id="3552436">!=</span>&nbsp;<span class="ident" id="3552439">nil</span>&nbsp;<span class="op" id="3552443">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552447">return</span>&nbsp;<span class="ident" id="3552454">nil</span><span class="op" id="3552457">,</span>&nbsp;<span class="ident" id="3552459">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552467">rc</span><span class="op" id="3552469">,</span>&nbsp;<span class="ident" id="3552471">ok</span>&nbsp;<span class="op" id="3552474">:=</span>&nbsp;<span class="ident" id="3552477">body</span><span class="op" id="3552481">.</span><span class="op" id="3552482">(</span><span class="ident" id="3552483">io</span><span class="op" id="3552485">.</span><span class="ident" id="3552486">ReadCloser</span><span class="op" id="3552496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552499">if</span>&nbsp;<span class="op" id="3552502">!</span><span class="ident" id="3552503">ok</span>&nbsp;<span class="op" id="3552506">&amp;&amp;</span>&nbsp;<span class="ident" id="3552509">body</span>&nbsp;<span class="op" id="3552514">!=</span>&nbsp;<span class="ident" id="3552517">nil</span>&nbsp;<span class="op" id="3552521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552525">rc</span>&nbsp;<span class="op" id="3552528">=</span>&nbsp;<span class="ident" id="3552530">ioutil</span><span class="op" id="3552536">.</span><span class="ident" id="3552537">NopCloser</span><span class="op" id="3552546">(</span><span class="ident" id="3552547">body</span><span class="op" id="3552551">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552557">req</span>&nbsp;<span class="op" id="3552561">:=</span>&nbsp;<span class="op" id="3552564">&amp;</span><span class="ident" id="3552565">Request</span><span class="op" id="3552572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552576">Method</span><span class="op" id="3552582">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3552588">method</span><span class="op" id="3552594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552598">URL</span><span class="op" id="3552601">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3552610">u</span><span class="op" id="3552611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552615">Proto</span><span class="op" id="3552620">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3552627">&#34;HTTP/1.1&#34;</span><span class="op" id="3552637">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552641">ProtoMajor</span><span class="op" id="3552651">:</span>&nbsp;<span class="num" id="3552653">1</span><span class="op" id="3552654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552658">ProtoMinor</span><span class="op" id="3552668">:</span>&nbsp;<span class="num" id="3552670">1</span><span class="op" id="3552671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552675">Header</span><span class="op" id="3552681">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3552687">make</span><span class="op" id="3552691">(</span><span class="ident" id="3552692">Header</span><span class="op" id="3552698">)</span><span class="op" id="3552699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552703">Body</span><span class="op" id="3552707">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3552715">rc</span><span class="op" id="3552717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552721">Host</span><span class="op" id="3552725">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3552733">u</span><span class="op" id="3552734">.</span><span class="ident" id="3552735">Host</span><span class="op" id="3552739">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552745">if</span>&nbsp;<span class="ident" id="3552748">body</span>&nbsp;<span class="op" id="3552753">!=</span>&nbsp;<span class="ident" id="3552756">nil</span>&nbsp;<span class="op" id="3552760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552764">switch</span>&nbsp;<span class="ident" id="3552771">v</span>&nbsp;<span class="op" id="3552773">:=</span>&nbsp;<span class="ident" id="3552776">body</span><span class="op" id="3552780">.</span><span class="op" id="3552781">(</span><span class="keyword" id="3552782">type</span><span class="op" id="3552786">)</span>&nbsp;<span class="op" id="3552788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552792">case</span>&nbsp;<span class="op" id="3552797">*</span><span class="ident" id="3552798">bytes</span><span class="op" id="3552803">.</span><span class="ident" id="3552804">Buffer</span><span class="op" id="3552810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552815">req</span><span class="op" id="3552818">.</span><span class="ident" id="3552819">ContentLength</span>&nbsp;<span class="op" id="3552833">=</span>&nbsp;<span class="ident" id="3552835">int64</span><span class="op" id="3552840">(</span><span class="ident" id="3552841">v</span><span class="op" id="3552842">.</span><span class="ident" id="3552843">Len</span><span class="op" id="3552846">(</span><span class="op" id="3552847">)</span><span class="op" id="3552848">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552852">case</span>&nbsp;<span class="op" id="3552857">*</span><span class="ident" id="3552858">bytes</span><span class="op" id="3552863">.</span><span class="ident" id="3552864">Reader</span><span class="op" id="3552870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552875">req</span><span class="op" id="3552878">.</span><span class="ident" id="3552879">ContentLength</span>&nbsp;<span class="op" id="3552893">=</span>&nbsp;<span class="ident" id="3552895">int64</span><span class="op" id="3552900">(</span><span class="ident" id="3552901">v</span><span class="op" id="3552902">.</span><span class="ident" id="3552903">Len</span><span class="op" id="3552906">(</span><span class="op" id="3552907">)</span><span class="op" id="3552908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552912">case</span>&nbsp;<span class="op" id="3552917">*</span><span class="ident" id="3552918">strings</span><span class="op" id="3552925">.</span><span class="ident" id="3552926">Reader</span><span class="op" id="3552932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552937">req</span><span class="op" id="3552940">.</span><span class="ident" id="3552941">ContentLength</span>&nbsp;<span class="op" id="3552955">=</span>&nbsp;<span class="ident" id="3552957">int64</span><span class="op" id="3552962">(</span><span class="ident" id="3552963">v</span><span class="op" id="3552964">.</span><span class="ident" id="3552965">Len</span><span class="op" id="3552968">(</span><span class="op" id="3552969">)</span><span class="op" id="3552970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552974">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552981">return</span>&nbsp;<span class="ident" id="3552988">req</span><span class="op" id="3552991">,</span>&nbsp;<span class="ident" id="3552993">nil</span><br>
<span class="lineno"></span><span class="op" id="3552997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="3553000">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3553073">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="3553145">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3553173">func</span>&nbsp;<span class="op" id="3553178">(</span><span class="ident" id="3553179">r</span>&nbsp;<span class="op" id="3553181">*</span><span class="ident" id="3553182">Request</span><span class="op" id="3553189">)</span>&nbsp;<span class="ident" id="3553191">BasicAuth</span><span class="op" id="3553200">(</span><span class="op" id="3553201">)</span>&nbsp;<span class="op" id="3553203">(</span><span class="ident" id="3553204">username</span><span class="op" id="3553212">,</span>&nbsp;<span class="ident" id="3553214">password</span>&nbsp;<span class="builtintype" id="3553223">string</span><span class="op" id="3553229">,</span>&nbsp;<span class="ident" id="3553231">ok</span>&nbsp;<span class="builtintype" id="3553234">bool</span><span class="op" id="3553238">)</span>&nbsp;<span class="op" id="3553240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553243">auth</span>&nbsp;<span class="op" id="3553248">:=</span>&nbsp;<span class="ident" id="3553251">r</span><span class="op" id="3553252">.</span><span class="ident" id="3553253">Header</span><span class="op" id="3553259">.</span><span class="ident" id="3553260">Get</span><span class="op" id="3553263">(</span><span class="string" id="3553264">&#34;Authorization&#34;</span><span class="op" id="3553279">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553282">if</span>&nbsp;<span class="ident" id="3553285">auth</span>&nbsp;<span class="op" id="3553290">==</span>&nbsp;<span class="string" id="3553293">&#34;&#34;</span>&nbsp;<span class="op" id="3553296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553311">return</span>&nbsp;<span class="ident" id="3553318">parseBasicAuth</span><span class="op" id="3553332">(</span><span class="ident" id="3553333">auth</span><span class="op" id="3553337">)</span><br>
<span class="lineno"></span><span class="op" id="3553339">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="3553342">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3553404">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3553486">func</span>&nbsp;<span class="ident" id="3553491">parseBasicAuth</span><span class="op" id="3553505">(</span><span class="ident" id="3553506">auth</span>&nbsp;<span class="builtintype" id="3553511">string</span><span class="op" id="3553517">)</span>&nbsp;<span class="op" id="3553519">(</span><span class="ident" id="3553520">username</span><span class="op" id="3553528">,</span>&nbsp;<span class="ident" id="3553530">password</span>&nbsp;<span class="builtintype" id="3553539">string</span><span class="op" id="3553545">,</span>&nbsp;<span class="ident" id="3553547">ok</span>&nbsp;<span class="builtintype" id="3553550">bool</span><span class="op" id="3553554">)</span>&nbsp;<span class="op" id="3553556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553559">if</span>&nbsp;<span class="op" id="3553562">!</span><span class="ident" id="3553563">strings</span><span class="op" id="3553570">.</span><span class="ident" id="3553571">HasPrefix</span><span class="op" id="3553580">(</span><span class="ident" id="3553581">auth</span><span class="op" id="3553585">,</span>&nbsp;<span class="string" id="3553587">&#34;Basic&nbsp;&#34;</span><span class="op" id="3553595">)</span>&nbsp;<span class="op" id="3553597">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553601">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553612">c</span><span class="op" id="3553613">,</span>&nbsp;<span class="ident" id="3553615">err</span>&nbsp;<span class="op" id="3553619">:=</span>&nbsp;<span class="ident" id="3553622">base64</span><span class="op" id="3553628">.</span><span class="ident" id="3553629">StdEncoding</span><span class="op" id="3553640">.</span><span class="ident" id="3553641">DecodeString</span><span class="op" id="3553653">(</span><span class="ident" id="3553654">strings</span><span class="op" id="3553661">.</span><span class="ident" id="3553662">TrimPrefix</span><span class="op" id="3553672">(</span><span class="ident" id="3553673">auth</span><span class="op" id="3553677">,</span>&nbsp;<span class="string" id="3553679">&#34;Basic&nbsp;&#34;</span><span class="op" id="3553687">)</span><span class="op" id="3553688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553691">if</span>&nbsp;<span class="ident" id="3553694">err</span>&nbsp;<span class="op" id="3553698">!=</span>&nbsp;<span class="ident" id="3553701">nil</span>&nbsp;<span class="op" id="3553705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553709">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553720">cs</span>&nbsp;<span class="op" id="3553723">:=</span>&nbsp;<span class="builtintype" id="3553726">string</span><span class="op" id="3553732">(</span><span class="ident" id="3553733">c</span><span class="op" id="3553734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553737">s</span>&nbsp;<span class="op" id="3553739">:=</span>&nbsp;<span class="ident" id="3553742">strings</span><span class="op" id="3553749">.</span><span class="ident" id="3553750">IndexByte</span><span class="op" id="3553759">(</span><span class="ident" id="3553760">cs</span><span class="op" id="3553762">,</span>&nbsp;<span class="string" id="3553764">&#39;:&#39;</span><span class="op" id="3553767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553770">if</span>&nbsp;<span class="ident" id="3553773">s</span>&nbsp;<span class="op" id="3553775">&lt;</span>&nbsp;<span class="num" id="3553777">0</span>&nbsp;<span class="op" id="3553779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553783">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553794">return</span>&nbsp;<span class="ident" id="3553801">cs</span><span class="op" id="3553803">[</span><span class="op" id="3553804">:</span><span class="ident" id="3553805">s</span><span class="op" id="3553806">]</span><span class="op" id="3553807">,</span>&nbsp;<span class="ident" id="3553809">cs</span><span class="op" id="3553811">[</span><span class="ident" id="3553812">s</span><span class="op" id="3553813">+</span><span class="num" id="3553814">1</span><span class="op" id="3553815">:</span><span class="op" id="3553816">]</span><span class="op" id="3553817">,</span>&nbsp;<span class="ident" id="3553819">true</span><br>
<span class="lineno"></span><span class="op" id="3553824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3553827">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="3553895">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3553960">//</span><br>
<span class="lineno"></span><span class="comment" id="3553963">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3554032">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3554054">func</span>&nbsp;<span class="op" id="3554059">(</span><span class="ident" id="3554060">r</span>&nbsp;<span class="op" id="3554062">*</span><span class="ident" id="3554063">Request</span><span class="op" id="3554070">)</span>&nbsp;<span class="ident" id="3554072">SetBasicAuth</span><span class="op" id="3554084">(</span><span class="ident" id="3554085">username</span><span class="op" id="3554093">,</span>&nbsp;<span class="ident" id="3554095">password</span>&nbsp;<span class="builtintype" id="3554104">string</span><span class="op" id="3554110">)</span>&nbsp;<span class="op" id="3554112">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554115">r</span><span class="op" id="3554116">.</span><span class="ident" id="3554117">Header</span><span class="op" id="3554123">.</span><span class="ident" id="3554124">Set</span><span class="op" id="3554127">(</span><span class="string" id="3554128">&#34;Authorization&#34;</span><span class="op" id="3554143">,</span>&nbsp;<span class="string" id="3554145">&#34;Basic&nbsp;&#34;</span><span class="op" id="3554153">+</span><span class="ident" id="3554154">basicAuth</span><span class="op" id="3554163">(</span><span class="ident" id="3554164">username</span><span class="op" id="3554172">,</span>&nbsp;<span class="ident" id="3554174">password</span><span class="op" id="3554182">)</span><span class="op" id="3554183">)</span><br>
<span class="lineno"></span><span class="op" id="3554185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3554188">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="3554257">func</span>&nbsp;<span class="ident" id="3554262">parseRequestLine</span><span class="op" id="3554278">(</span><span class="ident" id="3554279">line</span>&nbsp;<span class="builtintype" id="3554284">string</span><span class="op" id="3554290">)</span>&nbsp;<span class="op" id="3554292">(</span><span class="ident" id="3554293">method</span><span class="op" id="3554299">,</span>&nbsp;<span class="ident" id="3554301">requestURI</span><span class="op" id="3554311">,</span>&nbsp;<span class="ident" id="3554313">proto</span>&nbsp;<span class="builtintype" id="3554319">string</span><span class="op" id="3554325">,</span>&nbsp;<span class="ident" id="3554327">ok</span>&nbsp;<span class="builtintype" id="3554330">bool</span><span class="op" id="3554334">)</span>&nbsp;<span class="op" id="3554336">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554339">s1</span>&nbsp;<span class="op" id="3554342">:=</span>&nbsp;<span class="ident" id="3554345">strings</span><span class="op" id="3554352">.</span><span class="ident" id="3554353">Index</span><span class="op" id="3554358">(</span><span class="ident" id="3554359">line</span><span class="op" id="3554363">,</span>&nbsp;<span class="string" id="3554365">&#34;&nbsp;&#34;</span><span class="op" id="3554368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554371">s2</span>&nbsp;<span class="op" id="3554374">:=</span>&nbsp;<span class="ident" id="3554377">strings</span><span class="op" id="3554384">.</span><span class="ident" id="3554385">Index</span><span class="op" id="3554390">(</span><span class="ident" id="3554391">line</span><span class="op" id="3554395">[</span><span class="ident" id="3554396">s1</span><span class="op" id="3554398">+</span><span class="num" id="3554399">1</span><span class="op" id="3554400">:</span><span class="op" id="3554401">]</span><span class="op" id="3554402">,</span>&nbsp;<span class="string" id="3554404">&#34;&nbsp;&#34;</span><span class="op" id="3554407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554410">if</span>&nbsp;<span class="ident" id="3554413">s1</span>&nbsp;<span class="op" id="3554416">&lt;</span>&nbsp;<span class="num" id="3554418">0</span>&nbsp;<span class="op" id="3554420">||</span>&nbsp;<span class="ident" id="3554423">s2</span>&nbsp;<span class="op" id="3554426">&lt;</span>&nbsp;<span class="num" id="3554428">0</span>&nbsp;<span class="op" id="3554430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554434">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554442">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554445">s2</span>&nbsp;<span class="op" id="3554448">+=</span>&nbsp;<span class="ident" id="3554451">s1</span>&nbsp;<span class="op" id="3554454">+</span>&nbsp;<span class="num" id="3554456">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554459">return</span>&nbsp;<span class="ident" id="3554466">line</span><span class="op" id="3554470">[</span><span class="op" id="3554471">:</span><span class="ident" id="3554472">s1</span><span class="op" id="3554474">]</span><span class="op" id="3554475">,</span>&nbsp;<span class="ident" id="3554477">line</span><span class="op" id="3554481">[</span><span class="ident" id="3554482">s1</span><span class="op" id="3554484">+</span><span class="num" id="3554485">1</span>&nbsp;<span class="op" id="3554487">:</span>&nbsp;<span class="ident" id="3554489">s2</span><span class="op" id="3554491">]</span><span class="op" id="3554492">,</span>&nbsp;<span class="ident" id="3554494">line</span><span class="op" id="3554498">[</span><span class="ident" id="3554499">s2</span><span class="op" id="3554501">+</span><span class="num" id="3554502">1</span><span class="op" id="3554503">:</span><span class="op" id="3554504">]</span><span class="op" id="3554505">,</span>&nbsp;<span class="ident" id="3554507">true</span><br>
<span class="lineno"></span><span class="op" id="3554512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3554515">var</span>&nbsp;<span class="ident" id="3554519">textprotoReaderPool</span>&nbsp;<span class="ident" id="3554539">sync</span><span class="op" id="3554543">.</span><span class="ident" id="3554544">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="3554550">func</span>&nbsp;<span class="ident" id="3554555">newTextprotoReader</span><span class="op" id="3554573">(</span><span class="ident" id="3554574">br</span>&nbsp;<span class="op" id="3554577">*</span><span class="ident" id="3554578">bufio</span><span class="op" id="3554583">.</span><span class="ident" id="3554584">Reader</span><span class="op" id="3554590">)</span>&nbsp;<span class="op" id="3554592">*</span><span class="ident" id="3554593">textproto</span><span class="op" id="3554602">.</span><span class="ident" id="3554603">Reader</span>&nbsp;<span class="op" id="3554610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554613">if</span>&nbsp;<span class="ident" id="3554616">v</span>&nbsp;<span class="op" id="3554618">:=</span>&nbsp;<span class="ident" id="3554621">textprotoReaderPool</span><span class="op" id="3554640">.</span><span class="ident" id="3554641">Get</span><span class="op" id="3554644">(</span><span class="op" id="3554645">)</span><span class="op" id="3554646">;</span>&nbsp;<span class="ident" id="3554648">v</span>&nbsp;<span class="op" id="3554650">!=</span>&nbsp;<span class="ident" id="3554653">nil</span>&nbsp;<span class="op" id="3554657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554661">tr</span>&nbsp;<span class="op" id="3554664">:=</span>&nbsp;<span class="ident" id="3554667">v</span><span class="op" id="3554668">.</span><span class="op" id="3554669">(</span><span class="op" id="3554670">*</span><span class="ident" id="3554671">textproto</span><span class="op" id="3554680">.</span><span class="ident" id="3554681">Reader</span><span class="op" id="3554687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554691">tr</span><span class="op" id="3554693">.</span><span class="ident" id="3554694">R</span>&nbsp;<span class="op" id="3554696">=</span>&nbsp;<span class="ident" id="3554698">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554703">return</span>&nbsp;<span class="ident" id="3554710">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554717">return</span>&nbsp;<span class="ident" id="3554724">textproto</span><span class="op" id="3554733">.</span><span class="ident" id="3554734">NewReader</span><span class="op" id="3554743">(</span><span class="ident" id="3554744">br</span><span class="op" id="3554746">)</span><br>
<span class="lineno"></span><span class="op" id="3554748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="3554751">func</span>&nbsp;<span class="ident" id="3554756">putTextprotoReader</span><span class="op" id="3554774">(</span><span class="ident" id="3554775">r</span>&nbsp;<span class="op" id="3554777">*</span><span class="ident" id="3554778">textproto</span><span class="op" id="3554787">.</span><span class="ident" id="3554788">Reader</span><span class="op" id="3554794">)</span>&nbsp;<span class="op" id="3554796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554799">r</span><span class="op" id="3554800">.</span><span class="ident" id="3554801">R</span>&nbsp;<span class="op" id="3554803">=</span>&nbsp;<span class="ident" id="3554805">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554810">textprotoReaderPool</span><span class="op" id="3554829">.</span><span class="ident" id="3554830">Put</span><span class="op" id="3554833">(</span><span class="ident" id="3554834">r</span><span class="op" id="3554835">)</span><br>
<span class="lineno"></span><span class="op" id="3554837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3554840">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3554890">func</span>&nbsp;<span class="ident" id="3554895">ReadRequest</span><span class="op" id="3554906">(</span><span class="ident" id="3554907">b</span>&nbsp;<span class="op" id="3554909">*</span><span class="ident" id="3554910">bufio</span><span class="op" id="3554915">.</span><span class="ident" id="3554916">Reader</span><span class="op" id="3554922">)</span>&nbsp;<span class="op" id="3554924">(</span><span class="ident" id="3554925">req</span>&nbsp;<span class="op" id="3554929">*</span><span class="ident" id="3554930">Request</span><span class="op" id="3554937">,</span>&nbsp;<span class="ident" id="3554939">err</span>&nbsp;<span class="builtintype" id="3554943">error</span><span class="op" id="3554948">)</span>&nbsp;<span class="op" id="3554950">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554954">tp</span>&nbsp;<span class="op" id="3554957">:=</span>&nbsp;<span class="ident" id="3554960">newTextprotoReader</span><span class="op" id="3554978">(</span><span class="ident" id="3554979">b</span><span class="op" id="3554980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554983">req</span>&nbsp;<span class="op" id="3554987">=</span>&nbsp;<span class="builtinfunc" id="3554989">new</span><span class="op" id="3554992">(</span><span class="ident" id="3554993">Request</span><span class="op" id="3555000">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555004">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555045">var</span>&nbsp;<span class="ident" id="3555049">s</span>&nbsp;<span class="builtintype" id="3555051">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555059">if</span>&nbsp;<span class="ident" id="3555062">s</span><span class="op" id="3555063">,</span>&nbsp;<span class="ident" id="3555065">err</span>&nbsp;<span class="op" id="3555069">=</span>&nbsp;<span class="ident" id="3555071">tp</span><span class="op" id="3555073">.</span><span class="ident" id="3555074">ReadLine</span><span class="op" id="3555082">(</span><span class="op" id="3555083">)</span><span class="op" id="3555084">;</span>&nbsp;<span class="ident" id="3555086">err</span>&nbsp;<span class="op" id="3555090">!=</span>&nbsp;<span class="ident" id="3555093">nil</span>&nbsp;<span class="op" id="3555097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555101">return</span>&nbsp;<span class="ident" id="3555108">nil</span><span class="op" id="3555111">,</span>&nbsp;<span class="ident" id="3555113">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555121">defer</span>&nbsp;<span class="keyword" id="3555127">func</span><span class="op" id="3555131">(</span><span class="op" id="3555132">)</span>&nbsp;<span class="op" id="3555134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555138">putTextprotoReader</span><span class="op" id="3555156">(</span><span class="ident" id="3555157">tp</span><span class="op" id="3555159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555163">if</span>&nbsp;<span class="ident" id="3555166">err</span>&nbsp;<span class="op" id="3555170">==</span>&nbsp;<span class="ident" id="3555173">io</span><span class="op" id="3555175">.</span><span class="ident" id="3555176">EOF</span>&nbsp;<span class="op" id="3555180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555185">err</span>&nbsp;<span class="op" id="3555189">=</span>&nbsp;<span class="ident" id="3555191">io</span><span class="op" id="3555193">.</span><span class="ident" id="3555194">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555216">}</span><span class="op" id="3555217">(</span><span class="op" id="3555218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555222">var</span>&nbsp;<span class="ident" id="3555226">ok</span>&nbsp;<span class="builtintype" id="3555229">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555235">req</span><span class="op" id="3555238">.</span><span class="ident" id="3555239">Method</span><span class="op" id="3555245">,</span>&nbsp;<span class="ident" id="3555247">req</span><span class="op" id="3555250">.</span><span class="ident" id="3555251">RequestURI</span><span class="op" id="3555261">,</span>&nbsp;<span class="ident" id="3555263">req</span><span class="op" id="3555266">.</span><span class="ident" id="3555267">Proto</span><span class="op" id="3555272">,</span>&nbsp;<span class="ident" id="3555274">ok</span>&nbsp;<span class="op" id="3555277">=</span>&nbsp;<span class="ident" id="3555279">parseRequestLine</span><span class="op" id="3555295">(</span><span class="ident" id="3555296">s</span><span class="op" id="3555297">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555300">if</span>&nbsp;<span class="op" id="3555303">!</span><span class="ident" id="3555304">ok</span>&nbsp;<span class="op" id="3555307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555311">return</span>&nbsp;<span class="ident" id="3555318">nil</span><span class="op" id="3555321">,</span>&nbsp;<span class="op" id="3555323">&amp;</span><span class="ident" id="3555324">badStringError</span><span class="op" id="3555338">{</span><span class="string" id="3555339">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="3555363">,</span>&nbsp;<span class="ident" id="3555365">s</span><span class="op" id="3555366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555372">rawurl</span>&nbsp;<span class="op" id="3555379">:=</span>&nbsp;<span class="ident" id="3555382">req</span><span class="op" id="3555385">.</span><span class="ident" id="3555386">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555398">if</span>&nbsp;<span class="ident" id="3555401">req</span><span class="op" id="3555404">.</span><span class="ident" id="3555405">ProtoMajor</span><span class="op" id="3555415">,</span>&nbsp;<span class="ident" id="3555417">req</span><span class="op" id="3555420">.</span><span class="ident" id="3555421">ProtoMinor</span><span class="op" id="3555431">,</span>&nbsp;<span class="ident" id="3555433">ok</span>&nbsp;<span class="op" id="3555436">=</span>&nbsp;<span class="ident" id="3555438">ParseHTTPVersion</span><span class="op" id="3555454">(</span><span class="ident" id="3555455">req</span><span class="op" id="3555458">.</span><span class="ident" id="3555459">Proto</span><span class="op" id="3555464">)</span><span class="op" id="3555465">;</span>&nbsp;<span class="op" id="3555467">!</span><span class="ident" id="3555468">ok</span>&nbsp;<span class="op" id="3555471">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555475">return</span>&nbsp;<span class="ident" id="3555482">nil</span><span class="op" id="3555485">,</span>&nbsp;<span class="op" id="3555487">&amp;</span><span class="ident" id="3555488">badStringError</span><span class="op" id="3555502">{</span><span class="string" id="3555503">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3555527">,</span>&nbsp;<span class="ident" id="3555529">req</span><span class="op" id="3555532">.</span><span class="ident" id="3555533">Proto</span><span class="op" id="3555538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555545">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555624">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555687">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555765">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555850">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555854">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555931">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556007">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556087">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556104">justAuthority</span>&nbsp;<span class="op" id="3556118">:=</span>&nbsp;<span class="ident" id="3556121">req</span><span class="op" id="3556124">.</span><span class="ident" id="3556125">Method</span>&nbsp;<span class="op" id="3556132">==</span>&nbsp;<span class="string" id="3556135">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3556145">&amp;&amp;</span>&nbsp;<span class="op" id="3556148">!</span><span class="ident" id="3556149">strings</span><span class="op" id="3556156">.</span><span class="ident" id="3556157">HasPrefix</span><span class="op" id="3556166">(</span><span class="ident" id="3556167">rawurl</span><span class="op" id="3556173">,</span>&nbsp;<span class="string" id="3556175">&#34;/&#34;</span><span class="op" id="3556178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556181">if</span>&nbsp;<span class="ident" id="3556184">justAuthority</span>&nbsp;<span class="op" id="3556198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556202">rawurl</span>&nbsp;<span class="op" id="3556209">=</span>&nbsp;<span class="string" id="3556211">&#34;http://&#34;</span>&nbsp;<span class="op" id="3556221">+</span>&nbsp;<span class="ident" id="3556223">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556235">if</span>&nbsp;<span class="ident" id="3556238">req</span><span class="op" id="3556241">.</span><span class="ident" id="3556242">URL</span><span class="op" id="3556245">,</span>&nbsp;<span class="ident" id="3556247">err</span>&nbsp;<span class="op" id="3556251">=</span>&nbsp;<span class="ident" id="3556253">url</span><span class="op" id="3556256">.</span><span class="ident" id="3556257">ParseRequestURI</span><span class="op" id="3556272">(</span><span class="ident" id="3556273">rawurl</span><span class="op" id="3556279">)</span><span class="op" id="3556280">;</span>&nbsp;<span class="ident" id="3556282">err</span>&nbsp;<span class="op" id="3556286">!=</span>&nbsp;<span class="ident" id="3556289">nil</span>&nbsp;<span class="op" id="3556293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556297">return</span>&nbsp;<span class="ident" id="3556304">nil</span><span class="op" id="3556307">,</span>&nbsp;<span class="ident" id="3556309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556314">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556318">if</span>&nbsp;<span class="ident" id="3556321">justAuthority</span>&nbsp;<span class="op" id="3556335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556339">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556380">req</span><span class="op" id="3556383">.</span><span class="ident" id="3556384">URL</span><span class="op" id="3556387">.</span><span class="ident" id="3556388">Scheme</span>&nbsp;<span class="op" id="3556395">=</span>&nbsp;<span class="string" id="3556397">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556401">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556405">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556439">mimeHeader</span><span class="op" id="3556449">,</span>&nbsp;<span class="ident" id="3556451">err</span>&nbsp;<span class="op" id="3556455">:=</span>&nbsp;<span class="ident" id="3556458">tp</span><span class="op" id="3556460">.</span><span class="ident" id="3556461">ReadMIMEHeader</span><span class="op" id="3556475">(</span><span class="op" id="3556476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556479">if</span>&nbsp;<span class="ident" id="3556482">err</span>&nbsp;<span class="op" id="3556486">!=</span>&nbsp;<span class="ident" id="3556489">nil</span>&nbsp;<span class="op" id="3556493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556497">return</span>&nbsp;<span class="ident" id="3556504">nil</span><span class="op" id="3556507">,</span>&nbsp;<span class="ident" id="3556509">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556517">req</span><span class="op" id="3556520">.</span><span class="ident" id="3556521">Header</span>&nbsp;<span class="op" id="3556528">=</span>&nbsp;<span class="ident" id="3556530">Header</span><span class="op" id="3556536">(</span><span class="ident" id="3556537">mimeHeader</span><span class="op" id="3556547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556551">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556575">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556604">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556629">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556637">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556687">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556710">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556771">req</span><span class="op" id="3556774">.</span><span class="ident" id="3556775">Host</span>&nbsp;<span class="op" id="3556780">=</span>&nbsp;<span class="ident" id="3556782">req</span><span class="op" id="3556785">.</span><span class="ident" id="3556786">URL</span><span class="op" id="3556789">.</span><span class="ident" id="3556790">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556796">if</span>&nbsp;<span class="ident" id="3556799">req</span><span class="op" id="3556802">.</span><span class="ident" id="3556803">Host</span>&nbsp;<span class="op" id="3556808">==</span>&nbsp;<span class="string" id="3556811">&#34;&#34;</span>&nbsp;<span class="op" id="3556814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556818">req</span><span class="op" id="3556821">.</span><span class="ident" id="3556822">Host</span>&nbsp;<span class="op" id="3556827">=</span>&nbsp;<span class="ident" id="3556829">req</span><span class="op" id="3556832">.</span><span class="ident" id="3556833">Header</span><span class="op" id="3556839">.</span><span class="ident" id="3556840">get</span><span class="op" id="3556843">(</span><span class="string" id="3556844">&#34;Host&#34;</span><span class="op" id="3556850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3556856">delete</span><span class="op" id="3556862">(</span><span class="ident" id="3556863">req</span><span class="op" id="3556866">.</span><span class="ident" id="3556867">Header</span><span class="op" id="3556873">,</span>&nbsp;<span class="string" id="3556875">&#34;Host&#34;</span><span class="op" id="3556881">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556885">fixPragmaCacheControl</span><span class="op" id="3556906">(</span><span class="ident" id="3556907">req</span><span class="op" id="3556910">.</span><span class="ident" id="3556911">Header</span><span class="op" id="3556917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556921">err</span>&nbsp;<span class="op" id="3556925">=</span>&nbsp;<span class="ident" id="3556927">readTransfer</span><span class="op" id="3556939">(</span><span class="ident" id="3556940">req</span><span class="op" id="3556943">,</span>&nbsp;<span class="ident" id="3556945">b</span><span class="op" id="3556946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556949">if</span>&nbsp;<span class="ident" id="3556952">err</span>&nbsp;<span class="op" id="3556956">!=</span>&nbsp;<span class="ident" id="3556959">nil</span>&nbsp;<span class="op" id="3556963">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556967">return</span>&nbsp;<span class="ident" id="3556974">nil</span><span class="op" id="3556977">,</span>&nbsp;<span class="ident" id="3556979">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556988">req</span><span class="op" id="3556991">.</span><span class="ident" id="3556992">Close</span>&nbsp;<span class="op" id="3556998">=</span>&nbsp;<span class="ident" id="3557000">shouldClose</span><span class="op" id="3557011">(</span><span class="ident" id="3557012">req</span><span class="op" id="3557015">.</span><span class="ident" id="3557016">ProtoMajor</span><span class="op" id="3557026">,</span>&nbsp;<span class="ident" id="3557028">req</span><span class="op" id="3557031">.</span><span class="ident" id="3557032">ProtoMinor</span><span class="op" id="3557042">,</span>&nbsp;<span class="ident" id="3557044">req</span><span class="op" id="3557047">.</span><span class="ident" id="3557048">Header</span><span class="op" id="3557054">,</span>&nbsp;<span class="ident" id="3557056">false</span><span class="op" id="3557061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557064">return</span>&nbsp;<span class="ident" id="3557071">req</span><span class="op" id="3557074">,</span>&nbsp;<span class="ident" id="3557076">nil</span><br>
<span class="lineno">670</span><span class="op" id="3557080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3557083">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3557150">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3557214">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="3557284">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3557345">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="3557399">//</span><br>
<span class="lineno"></span><span class="comment" id="3557402">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="3557470">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="3557527">func</span>&nbsp;<span class="ident" id="3557532">MaxBytesReader</span><span class="op" id="3557546">(</span><span class="ident" id="3557547">w</span>&nbsp;<span class="ident" id="3557549">ResponseWriter</span><span class="op" id="3557563">,</span>&nbsp;<span class="ident" id="3557565">r</span>&nbsp;<span class="ident" id="3557567">io</span><span class="op" id="3557569">.</span><span class="ident" id="3557570">ReadCloser</span><span class="op" id="3557580">,</span>&nbsp;<span class="ident" id="3557582">n</span>&nbsp;<span class="ident" id="3557584">int64</span><span class="op" id="3557589">)</span>&nbsp;<span class="ident" id="3557591">io</span><span class="op" id="3557593">.</span><span class="ident" id="3557594">ReadCloser</span>&nbsp;<span class="op" id="3557605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557608">return</span>&nbsp;<span class="op" id="3557615">&amp;</span><span class="ident" id="3557616">maxBytesReader</span><span class="op" id="3557630">{</span><span class="ident" id="3557631">w</span><span class="op" id="3557632">:</span>&nbsp;<span class="ident" id="3557634">w</span><span class="op" id="3557635">,</span>&nbsp;<span class="ident" id="3557637">r</span><span class="op" id="3557638">:</span>&nbsp;<span class="ident" id="3557640">r</span><span class="op" id="3557641">,</span>&nbsp;<span class="ident" id="3557643">n</span><span class="op" id="3557644">:</span>&nbsp;<span class="ident" id="3557646">n</span><span class="op" id="3557647">}</span><br>
<span class="lineno"></span><span class="op" id="3557649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3557652">type</span>&nbsp;<span class="ident" id="3557657">maxBytesReader</span>&nbsp;<span class="keyword" id="3557672">struct</span>&nbsp;<span class="op" id="3557679">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557682">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3557690">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557706">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3557714">io</span><span class="op" id="3557716">.</span><span class="ident" id="3557717">ReadCloser</span>&nbsp;<span class="comment" id="3557728">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557750">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3557758">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3557772">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557796">stopped</span>&nbsp;<span class="builtintype" id="3557804">bool</span><br>
<span class="lineno"></span><span class="op" id="3557809">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3557812">func</span>&nbsp;<span class="op" id="3557817">(</span><span class="ident" id="3557818">l</span>&nbsp;<span class="op" id="3557820">*</span><span class="ident" id="3557821">maxBytesReader</span><span class="op" id="3557835">)</span>&nbsp;<span class="ident" id="3557837">Read</span><span class="op" id="3557841">(</span><span class="ident" id="3557842">p</span>&nbsp;<span class="op" id="3557844">[</span><span class="op" id="3557845">]</span><span class="builtintype" id="3557846">byte</span><span class="op" id="3557850">)</span>&nbsp;<span class="op" id="3557852">(</span><span class="ident" id="3557853">n</span>&nbsp;<span class="builtintype" id="3557855">int</span><span class="op" id="3557858">,</span>&nbsp;<span class="ident" id="3557860">err</span>&nbsp;<span class="builtintype" id="3557864">error</span><span class="op" id="3557869">)</span>&nbsp;<span class="op" id="3557871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557874">if</span>&nbsp;<span class="ident" id="3557877">l</span><span class="op" id="3557878">.</span><span class="ident" id="3557879">n</span>&nbsp;<span class="op" id="3557881">&lt;=</span>&nbsp;<span class="num" id="3557884">0</span>&nbsp;<span class="op" id="3557886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557890">if</span>&nbsp;<span class="op" id="3557893">!</span><span class="ident" id="3557894">l</span><span class="op" id="3557895">.</span><span class="ident" id="3557896">stopped</span>&nbsp;<span class="op" id="3557904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557909">l</span><span class="op" id="3557910">.</span><span class="ident" id="3557911">stopped</span>&nbsp;<span class="op" id="3557919">=</span>&nbsp;<span class="ident" id="3557921">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557929">if</span>&nbsp;<span class="ident" id="3557932">res</span><span class="op" id="3557935">,</span>&nbsp;<span class="ident" id="3557937">ok</span>&nbsp;<span class="op" id="3557940">:=</span>&nbsp;<span class="ident" id="3557943">l</span><span class="op" id="3557944">.</span><span class="ident" id="3557945">w</span><span class="op" id="3557946">.</span><span class="op" id="3557947">(</span><span class="op" id="3557948">*</span><span class="ident" id="3557949">response</span><span class="op" id="3557957">)</span><span class="op" id="3557958">;</span>&nbsp;<span class="ident" id="3557960">ok</span>&nbsp;<span class="op" id="3557963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557969">res</span><span class="op" id="3557972">.</span><span class="ident" id="3557973">requestTooLarge</span><span class="op" id="3557988">(</span><span class="op" id="3557989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558002">return</span>&nbsp;<span class="num" id="3558009">0</span><span class="op" id="3558010">,</span>&nbsp;<span class="ident" id="3558012">errors</span><span class="op" id="3558018">.</span><span class="ident" id="3558019">New</span><span class="op" id="3558022">(</span><span class="string" id="3558023">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="3558053">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558059">if</span>&nbsp;<span class="ident" id="3558062">int64</span><span class="op" id="3558067">(</span><span class="builtinfunc" id="3558068">len</span><span class="op" id="3558071">(</span><span class="ident" id="3558072">p</span><span class="op" id="3558073">)</span><span class="op" id="3558074">)</span>&nbsp;<span class="op" id="3558076">&gt;</span>&nbsp;<span class="ident" id="3558078">l</span><span class="op" id="3558079">.</span><span class="ident" id="3558080">n</span>&nbsp;<span class="op" id="3558082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558086">p</span>&nbsp;<span class="op" id="3558088">=</span>&nbsp;<span class="ident" id="3558090">p</span><span class="op" id="3558091">[</span><span class="op" id="3558092">:</span><span class="ident" id="3558093">l</span><span class="op" id="3558094">.</span><span class="ident" id="3558095">n</span><span class="op" id="3558096">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558102">n</span><span class="op" id="3558103">,</span>&nbsp;<span class="ident" id="3558105">err</span>&nbsp;<span class="op" id="3558109">=</span>&nbsp;<span class="ident" id="3558111">l</span><span class="op" id="3558112">.</span><span class="ident" id="3558113">r</span><span class="op" id="3558114">.</span><span class="ident" id="3558115">Read</span><span class="op" id="3558119">(</span><span class="ident" id="3558120">p</span><span class="op" id="3558121">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558124">l</span><span class="op" id="3558125">.</span><span class="ident" id="3558126">n</span>&nbsp;<span class="op" id="3558128">-=</span>&nbsp;<span class="ident" id="3558131">int64</span><span class="op" id="3558136">(</span><span class="ident" id="3558137">n</span><span class="op" id="3558138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558141">return</span><br>
<span class="lineno"></span><span class="op" id="3558148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3558151">func</span>&nbsp;<span class="op" id="3558156">(</span><span class="ident" id="3558157">l</span>&nbsp;<span class="op" id="3558159">*</span><span class="ident" id="3558160">maxBytesReader</span><span class="op" id="3558174">)</span>&nbsp;<span class="ident" id="3558176">Close</span><span class="op" id="3558181">(</span><span class="op" id="3558182">)</span>&nbsp;<span class="builtintype" id="3558184">error</span>&nbsp;<span class="op" id="3558190">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558193">return</span>&nbsp;<span class="ident" id="3558200">l</span><span class="op" id="3558201">.</span><span class="ident" id="3558202">r</span><span class="op" id="3558203">.</span><span class="ident" id="3558204">Close</span><span class="op" id="3558209">(</span><span class="op" id="3558210">)</span><br>
<span class="lineno"></span><span class="op" id="3558212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3558215">func</span>&nbsp;<span class="ident" id="3558220">copyValues</span><span class="op" id="3558230">(</span><span class="ident" id="3558231">dst</span><span class="op" id="3558234">,</span>&nbsp;<span class="ident" id="3558236">src</span>&nbsp;<span class="ident" id="3558240">url</span><span class="op" id="3558243">.</span><span class="ident" id="3558244">Values</span><span class="op" id="3558250">)</span>&nbsp;<span class="op" id="3558252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558255">for</span>&nbsp;<span class="ident" id="3558259">k</span><span class="op" id="3558260">,</span>&nbsp;<span class="ident" id="3558262">vs</span>&nbsp;<span class="op" id="3558265">:=</span>&nbsp;<span class="keyword" id="3558268">range</span>&nbsp;<span class="ident" id="3558274">src</span>&nbsp;<span class="op" id="3558278">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558282">for</span>&nbsp;<span class="ident" id="3558286">_</span><span class="op" id="3558287">,</span>&nbsp;<span class="ident" id="3558289">value</span>&nbsp;<span class="op" id="3558295">:=</span>&nbsp;<span class="keyword" id="3558298">range</span>&nbsp;<span class="ident" id="3558304">vs</span>&nbsp;<span class="op" id="3558307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558312">dst</span><span class="op" id="3558315">.</span><span class="ident" id="3558316">Add</span><span class="op" id="3558319">(</span><span class="ident" id="3558320">k</span><span class="op" id="3558321">,</span>&nbsp;<span class="ident" id="3558323">value</span><span class="op" id="3558328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558335">}</span><br>
<span class="lineno"></span><span class="op" id="3558337">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="3558340">func</span>&nbsp;<span class="ident" id="3558345">parsePostForm</span><span class="op" id="3558358">(</span><span class="ident" id="3558359">r</span>&nbsp;<span class="op" id="3558361">*</span><span class="ident" id="3558362">Request</span><span class="op" id="3558369">)</span>&nbsp;<span class="op" id="3558371">(</span><span class="ident" id="3558372">vs</span>&nbsp;<span class="ident" id="3558375">url</span><span class="op" id="3558378">.</span><span class="ident" id="3558379">Values</span><span class="op" id="3558385">,</span>&nbsp;<span class="ident" id="3558387">err</span>&nbsp;<span class="builtintype" id="3558391">error</span><span class="op" id="3558396">)</span>&nbsp;<span class="op" id="3558398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558401">if</span>&nbsp;<span class="ident" id="3558404">r</span><span class="op" id="3558405">.</span><span class="ident" id="3558406">Body</span>&nbsp;<span class="op" id="3558411">==</span>&nbsp;<span class="ident" id="3558414">nil</span>&nbsp;<span class="op" id="3558418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558422">err</span>&nbsp;<span class="op" id="3558426">=</span>&nbsp;<span class="ident" id="3558428">errors</span><span class="op" id="3558434">.</span><span class="ident" id="3558435">New</span><span class="op" id="3558438">(</span><span class="string" id="3558439">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="3558458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558462">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558473">ct</span>&nbsp;<span class="op" id="3558476">:=</span>&nbsp;<span class="ident" id="3558479">r</span><span class="op" id="3558480">.</span><span class="ident" id="3558481">Header</span><span class="op" id="3558487">.</span><span class="ident" id="3558488">Get</span><span class="op" id="3558491">(</span><span class="string" id="3558492">&#34;Content-Type&#34;</span><span class="op" id="3558506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558509">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558550">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558602">if</span>&nbsp;<span class="ident" id="3558605">ct</span>&nbsp;<span class="op" id="3558608">==</span>&nbsp;<span class="string" id="3558611">&#34;&#34;</span>&nbsp;<span class="op" id="3558614">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558618">ct</span>&nbsp;<span class="op" id="3558621">=</span>&nbsp;<span class="string" id="3558623">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558654">ct</span><span class="op" id="3558656">,</span>&nbsp;<span class="ident" id="3558658">_</span><span class="op" id="3558659">,</span>&nbsp;<span class="ident" id="3558661">err</span>&nbsp;<span class="op" id="3558665">=</span>&nbsp;<span class="ident" id="3558667">mime</span><span class="op" id="3558671">.</span><span class="ident" id="3558672">ParseMediaType</span><span class="op" id="3558686">(</span><span class="ident" id="3558687">ct</span><span class="op" id="3558689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558692">switch</span>&nbsp;<span class="op" id="3558699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558702">case</span>&nbsp;<span class="ident" id="3558707">ct</span>&nbsp;<span class="op" id="3558710">==</span>&nbsp;<span class="string" id="3558713">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3558748">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558752">var</span>&nbsp;<span class="ident" id="3558756">reader</span>&nbsp;<span class="ident" id="3558763">io</span><span class="op" id="3558765">.</span><span class="ident" id="3558766">Reader</span>&nbsp;<span class="op" id="3558773">=</span>&nbsp;<span class="ident" id="3558775">r</span><span class="op" id="3558776">.</span><span class="ident" id="3558777">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558784">maxFormSize</span>&nbsp;<span class="op" id="3558796">:=</span>&nbsp;<span class="ident" id="3558799">int64</span><span class="op" id="3558804">(</span><span class="num" id="3558805">1</span><span class="op" id="3558806">&lt;&lt;</span><span class="num" id="3558808">63</span>&nbsp;<span class="op" id="3558811">-</span>&nbsp;<span class="num" id="3558813">1</span><span class="op" id="3558814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558818">if</span>&nbsp;<span class="ident" id="3558821">_</span><span class="op" id="3558822">,</span>&nbsp;<span class="ident" id="3558824">ok</span>&nbsp;<span class="op" id="3558827">:=</span>&nbsp;<span class="ident" id="3558830">r</span><span class="op" id="3558831">.</span><span class="ident" id="3558832">Body</span><span class="op" id="3558836">.</span><span class="op" id="3558837">(</span><span class="op" id="3558838">*</span><span class="ident" id="3558839">maxBytesReader</span><span class="op" id="3558853">)</span><span class="op" id="3558854">;</span>&nbsp;<span class="op" id="3558856">!</span><span class="ident" id="3558857">ok</span>&nbsp;<span class="op" id="3558860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558865">maxFormSize</span>&nbsp;<span class="op" id="3558877">=</span>&nbsp;<span class="ident" id="3558879">int64</span><span class="op" id="3558884">(</span><span class="num" id="3558885">10</span>&nbsp;<span class="op" id="3558888">&lt;&lt;</span>&nbsp;<span class="num" id="3558891">20</span><span class="op" id="3558893">)</span>&nbsp;<span class="comment" id="3558895">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558925">reader</span>&nbsp;<span class="op" id="3558932">=</span>&nbsp;<span class="ident" id="3558934">io</span><span class="op" id="3558936">.</span><span class="ident" id="3558937">LimitReader</span><span class="op" id="3558948">(</span><span class="ident" id="3558949">r</span><span class="op" id="3558950">.</span><span class="ident" id="3558951">Body</span><span class="op" id="3558955">,</span>&nbsp;<span class="ident" id="3558957">maxFormSize</span><span class="op" id="3558968">+</span><span class="num" id="3558969">1</span><span class="op" id="3558970">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558978">b</span><span class="op" id="3558979">,</span>&nbsp;<span class="ident" id="3558981">e</span>&nbsp;<span class="op" id="3558983">:=</span>&nbsp;<span class="ident" id="3558986">ioutil</span><span class="op" id="3558992">.</span><span class="ident" id="3558993">ReadAll</span><span class="op" id="3559000">(</span><span class="ident" id="3559001">reader</span><span class="op" id="3559007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559011">if</span>&nbsp;<span class="ident" id="3559014">e</span>&nbsp;<span class="op" id="3559016">!=</span>&nbsp;<span class="ident" id="3559019">nil</span>&nbsp;<span class="op" id="3559023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559028">if</span>&nbsp;<span class="ident" id="3559031">err</span>&nbsp;<span class="op" id="3559035">==</span>&nbsp;<span class="ident" id="3559038">nil</span>&nbsp;<span class="op" id="3559042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559048">err</span>&nbsp;<span class="op" id="3559052">=</span>&nbsp;<span class="ident" id="3559054">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559064">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559076">if</span>&nbsp;<span class="ident" id="3559079">int64</span><span class="op" id="3559084">(</span><span class="builtinfunc" id="3559085">len</span><span class="op" id="3559088">(</span><span class="ident" id="3559089">b</span><span class="op" id="3559090">)</span><span class="op" id="3559091">)</span>&nbsp;<span class="op" id="3559093">&gt;</span>&nbsp;<span class="ident" id="3559095">maxFormSize</span>&nbsp;<span class="op" id="3559107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559112">err</span>&nbsp;<span class="op" id="3559116">=</span>&nbsp;<span class="ident" id="3559118">errors</span><span class="op" id="3559124">.</span><span class="ident" id="3559125">New</span><span class="op" id="3559128">(</span><span class="string" id="3559129">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3559151">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559169">vs</span><span class="op" id="3559171">,</span>&nbsp;<span class="ident" id="3559173">e</span>&nbsp;<span class="op" id="3559175">=</span>&nbsp;<span class="ident" id="3559177">url</span><span class="op" id="3559180">.</span><span class="ident" id="3559181">ParseQuery</span><span class="op" id="3559191">(</span><span class="builtintype" id="3559192">string</span><span class="op" id="3559198">(</span><span class="ident" id="3559199">b</span><span class="op" id="3559200">)</span><span class="op" id="3559201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559205">if</span>&nbsp;<span class="ident" id="3559208">err</span>&nbsp;<span class="op" id="3559212">==</span>&nbsp;<span class="ident" id="3559215">nil</span>&nbsp;<span class="op" id="3559219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559224">err</span>&nbsp;<span class="op" id="3559228">=</span>&nbsp;<span class="ident" id="3559230">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559237">case</span>&nbsp;<span class="ident" id="3559242">ct</span>&nbsp;<span class="op" id="3559245">==</span>&nbsp;<span class="string" id="3559248">&#34;multipart/form-data&#34;</span><span class="op" id="3559269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559273">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559344">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559393">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559438">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559479">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559528">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559578">return</span><br>
<span class="lineno">765</span><span class="op" id="3559585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3559588">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3559655">//</span><br>
<span class="lineno"></span><span class="comment" id="3559658">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3559733">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3559785">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3559862">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3559876">//</span><br>
<span class="lineno"></span><span class="comment" id="3559879">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3559957">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3559988">//</span><br>
<span class="lineno"></span><span class="comment" id="3559991">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3560044">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3560065">func</span>&nbsp;<span class="op" id="3560070">(</span><span class="ident" id="3560071">r</span>&nbsp;<span class="op" id="3560073">*</span><span class="ident" id="3560074">Request</span><span class="op" id="3560081">)</span>&nbsp;<span class="ident" id="3560083">ParseForm</span><span class="op" id="3560092">(</span><span class="op" id="3560093">)</span>&nbsp;<span class="builtintype" id="3560095">error</span>&nbsp;<span class="op" id="3560101">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560104">var</span>&nbsp;<span class="ident" id="3560108">err</span>&nbsp;<span class="builtintype" id="3560112">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560119">if</span>&nbsp;<span class="ident" id="3560122">r</span><span class="op" id="3560123">.</span><span class="ident" id="3560124">PostForm</span>&nbsp;<span class="op" id="3560133">==</span>&nbsp;<span class="ident" id="3560136">nil</span>&nbsp;<span class="op" id="3560140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560144">if</span>&nbsp;<span class="ident" id="3560147">r</span><span class="op" id="3560148">.</span><span class="ident" id="3560149">Method</span>&nbsp;<span class="op" id="3560156">==</span>&nbsp;<span class="string" id="3560159">&#34;POST&#34;</span>&nbsp;<span class="op" id="3560166">||</span>&nbsp;<span class="ident" id="3560169">r</span><span class="op" id="3560170">.</span><span class="ident" id="3560171">Method</span>&nbsp;<span class="op" id="3560178">==</span>&nbsp;<span class="string" id="3560181">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3560187">||</span>&nbsp;<span class="ident" id="3560190">r</span><span class="op" id="3560191">.</span><span class="ident" id="3560192">Method</span>&nbsp;<span class="op" id="3560199">==</span>&nbsp;<span class="string" id="3560202">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3560210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560215">r</span><span class="op" id="3560216">.</span><span class="ident" id="3560217">PostForm</span><span class="op" id="3560225">,</span>&nbsp;<span class="ident" id="3560227">err</span>&nbsp;<span class="op" id="3560231">=</span>&nbsp;<span class="ident" id="3560233">parsePostForm</span><span class="op" id="3560246">(</span><span class="ident" id="3560247">r</span><span class="op" id="3560248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560252">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560256">if</span>&nbsp;<span class="ident" id="3560259">r</span><span class="op" id="3560260">.</span><span class="ident" id="3560261">PostForm</span>&nbsp;<span class="op" id="3560270">==</span>&nbsp;<span class="ident" id="3560273">nil</span>&nbsp;<span class="op" id="3560277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560282">r</span><span class="op" id="3560283">.</span><span class="ident" id="3560284">PostForm</span>&nbsp;<span class="op" id="3560293">=</span>&nbsp;<span class="builtinfunc" id="3560295">make</span><span class="op" id="3560299">(</span><span class="ident" id="3560300">url</span><span class="op" id="3560303">.</span><span class="ident" id="3560304">Values</span><span class="op" id="3560310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560320">if</span>&nbsp;<span class="ident" id="3560323">r</span><span class="op" id="3560324">.</span><span class="ident" id="3560325">Form</span>&nbsp;<span class="op" id="3560330">==</span>&nbsp;<span class="ident" id="3560333">nil</span>&nbsp;<span class="op" id="3560337">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560341">if</span>&nbsp;<span class="builtinfunc" id="3560344">len</span><span class="op" id="3560347">(</span><span class="ident" id="3560348">r</span><span class="op" id="3560349">.</span><span class="ident" id="3560350">PostForm</span><span class="op" id="3560358">)</span>&nbsp;<span class="op" id="3560360">&gt;</span>&nbsp;<span class="num" id="3560362">0</span>&nbsp;<span class="op" id="3560364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560369">r</span><span class="op" id="3560370">.</span><span class="ident" id="3560371">Form</span>&nbsp;<span class="op" id="3560376">=</span>&nbsp;<span class="builtinfunc" id="3560378">make</span><span class="op" id="3560382">(</span><span class="ident" id="3560383">url</span><span class="op" id="3560386">.</span><span class="ident" id="3560387">Values</span><span class="op" id="3560393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560398">copyValues</span><span class="op" id="3560408">(</span><span class="ident" id="3560409">r</span><span class="op" id="3560410">.</span><span class="ident" id="3560411">Form</span><span class="op" id="3560415">,</span>&nbsp;<span class="ident" id="3560417">r</span><span class="op" id="3560418">.</span><span class="ident" id="3560419">PostForm</span><span class="op" id="3560427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560435">var</span>&nbsp;<span class="ident" id="3560439">newValues</span>&nbsp;<span class="ident" id="3560449">url</span><span class="op" id="3560452">.</span><span class="ident" id="3560453">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560462">if</span>&nbsp;<span class="ident" id="3560465">r</span><span class="op" id="3560466">.</span><span class="ident" id="3560467">URL</span>&nbsp;<span class="op" id="3560471">!=</span>&nbsp;<span class="ident" id="3560474">nil</span>&nbsp;<span class="op" id="3560478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560483">var</span>&nbsp;<span class="ident" id="3560487">e</span>&nbsp;<span class="builtintype" id="3560489">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560498">newValues</span><span class="op" id="3560507">,</span>&nbsp;<span class="ident" id="3560509">e</span>&nbsp;<span class="op" id="3560511">=</span>&nbsp;<span class="ident" id="3560513">url</span><span class="op" id="3560516">.</span><span class="ident" id="3560517">ParseQuery</span><span class="op" id="3560527">(</span><span class="ident" id="3560528">r</span><span class="op" id="3560529">.</span><span class="ident" id="3560530">URL</span><span class="op" id="3560533">.</span><span class="ident" id="3560534">RawQuery</span><span class="op" id="3560542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560547">if</span>&nbsp;<span class="ident" id="3560550">err</span>&nbsp;<span class="op" id="3560554">==</span>&nbsp;<span class="ident" id="3560557">nil</span>&nbsp;<span class="op" id="3560561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560567">err</span>&nbsp;<span class="op" id="3560571">=</span>&nbsp;<span class="ident" id="3560573">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560586">if</span>&nbsp;<span class="ident" id="3560589">newValues</span>&nbsp;<span class="op" id="3560599">==</span>&nbsp;<span class="ident" id="3560602">nil</span>&nbsp;<span class="op" id="3560606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560611">newValues</span>&nbsp;<span class="op" id="3560621">=</span>&nbsp;<span class="builtinfunc" id="3560623">make</span><span class="op" id="3560627">(</span><span class="ident" id="3560628">url</span><span class="op" id="3560631">.</span><span class="ident" id="3560632">Values</span><span class="op" id="3560638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560642">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560646">if</span>&nbsp;<span class="ident" id="3560649">r</span><span class="op" id="3560650">.</span><span class="ident" id="3560651">Form</span>&nbsp;<span class="op" id="3560656">==</span>&nbsp;<span class="ident" id="3560659">nil</span>&nbsp;<span class="op" id="3560663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560668">r</span><span class="op" id="3560669">.</span><span class="ident" id="3560670">Form</span>&nbsp;<span class="op" id="3560675">=</span>&nbsp;<span class="ident" id="3560677">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560689">}</span>&nbsp;<span class="keyword" id="3560691">else</span>&nbsp;<span class="op" id="3560696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560701">copyValues</span><span class="op" id="3560711">(</span><span class="ident" id="3560712">r</span><span class="op" id="3560713">.</span><span class="ident" id="3560714">Form</span><span class="op" id="3560718">,</span>&nbsp;<span class="ident" id="3560720">newValues</span><span class="op" id="3560729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560733">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560739">return</span>&nbsp;<span class="ident" id="3560746">err</span><br>
<span class="lineno"></span><span class="op" id="3560750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3560753">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3560821">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3560897">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3560966">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3560994">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3561046">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3561120">func</span>&nbsp;<span class="op" id="3561125">(</span><span class="ident" id="3561126">r</span>&nbsp;<span class="op" id="3561128">*</span><span class="ident" id="3561129">Request</span><span class="op" id="3561136">)</span>&nbsp;<span class="ident" id="3561138">ParseMultipartForm</span><span class="op" id="3561156">(</span><span class="ident" id="3561157">maxMemory</span>&nbsp;<span class="ident" id="3561167">int64</span><span class="op" id="3561172">)</span>&nbsp;<span class="builtintype" id="3561174">error</span>&nbsp;<span class="op" id="3561180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561183">if</span>&nbsp;<span class="ident" id="3561186">r</span><span class="op" id="3561187">.</span><span class="ident" id="3561188">MultipartForm</span>&nbsp;<span class="op" id="3561202">==</span>&nbsp;<span class="ident" id="3561205">multipartByReader</span>&nbsp;<span class="op" id="3561223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561227">return</span>&nbsp;<span class="ident" id="3561234">errors</span><span class="op" id="3561240">.</span><span class="ident" id="3561241">New</span><span class="op" id="3561244">(</span><span class="string" id="3561245">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3561289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561295">if</span>&nbsp;<span class="ident" id="3561298">r</span><span class="op" id="3561299">.</span><span class="ident" id="3561300">Form</span>&nbsp;<span class="op" id="3561305">==</span>&nbsp;<span class="ident" id="3561308">nil</span>&nbsp;<span class="op" id="3561312">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561316">err</span>&nbsp;<span class="op" id="3561320">:=</span>&nbsp;<span class="ident" id="3561323">r</span><span class="op" id="3561324">.</span><span class="ident" id="3561325">ParseForm</span><span class="op" id="3561334">(</span><span class="op" id="3561335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561339">if</span>&nbsp;<span class="ident" id="3561342">err</span>&nbsp;<span class="op" id="3561346">!=</span>&nbsp;<span class="ident" id="3561349">nil</span>&nbsp;<span class="op" id="3561353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561358">return</span>&nbsp;<span class="ident" id="3561365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561374">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561377">if</span>&nbsp;<span class="ident" id="3561380">r</span><span class="op" id="3561381">.</span><span class="ident" id="3561382">MultipartForm</span>&nbsp;<span class="op" id="3561396">!=</span>&nbsp;<span class="ident" id="3561399">nil</span>&nbsp;<span class="op" id="3561403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561407">return</span>&nbsp;<span class="ident" id="3561414">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561423">mr</span><span class="op" id="3561425">,</span>&nbsp;<span class="ident" id="3561427">err</span>&nbsp;<span class="op" id="3561431">:=</span>&nbsp;<span class="ident" id="3561434">r</span><span class="op" id="3561435">.</span><span class="ident" id="3561436">multipartReader</span><span class="op" id="3561451">(</span><span class="op" id="3561452">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561455">if</span>&nbsp;<span class="ident" id="3561458">err</span>&nbsp;<span class="op" id="3561462">!=</span>&nbsp;<span class="ident" id="3561465">nil</span>&nbsp;<span class="op" id="3561469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561473">return</span>&nbsp;<span class="ident" id="3561480">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561489">f</span><span class="op" id="3561490">,</span>&nbsp;<span class="ident" id="3561492">err</span>&nbsp;<span class="op" id="3561496">:=</span>&nbsp;<span class="ident" id="3561499">mr</span><span class="op" id="3561501">.</span><span class="ident" id="3561502">ReadForm</span><span class="op" id="3561510">(</span><span class="ident" id="3561511">maxMemory</span><span class="op" id="3561520">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561523">if</span>&nbsp;<span class="ident" id="3561526">err</span>&nbsp;<span class="op" id="3561530">!=</span>&nbsp;<span class="ident" id="3561533">nil</span>&nbsp;<span class="op" id="3561537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561541">return</span>&nbsp;<span class="ident" id="3561548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561556">for</span>&nbsp;<span class="ident" id="3561560">k</span><span class="op" id="3561561">,</span>&nbsp;<span class="ident" id="3561563">v</span>&nbsp;<span class="op" id="3561565">:=</span>&nbsp;<span class="keyword" id="3561568">range</span>&nbsp;<span class="ident" id="3561574">f</span><span class="op" id="3561575">.</span><span class="ident" id="3561576">Value</span>&nbsp;<span class="op" id="3561582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561586">r</span><span class="op" id="3561587">.</span><span class="ident" id="3561588">Form</span><span class="op" id="3561592">[</span><span class="ident" id="3561593">k</span><span class="op" id="3561594">]</span>&nbsp;<span class="op" id="3561596">=</span>&nbsp;<span class="builtinfunc" id="3561598">append</span><span class="op" id="3561604">(</span><span class="ident" id="3561605">r</span><span class="op" id="3561606">.</span><span class="ident" id="3561607">Form</span><span class="op" id="3561611">[</span><span class="ident" id="3561612">k</span><span class="op" id="3561613">]</span><span class="op" id="3561614">,</span>&nbsp;<span class="ident" id="3561616">v</span><span class="op" id="3561617">...</span><span class="op" id="3561620">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561626">r</span><span class="op" id="3561627">.</span><span class="ident" id="3561628">MultipartForm</span>&nbsp;<span class="op" id="3561642">=</span>&nbsp;<span class="ident" id="3561644">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561648">return</span>&nbsp;<span class="ident" id="3561655">nil</span><br>
<span class="lineno"></span><span class="op" id="3561659">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3561662">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3561737">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3561815">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3561892">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3561935">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3562000">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3562039">func</span>&nbsp;<span class="op" id="3562044">(</span><span class="ident" id="3562045">r</span>&nbsp;<span class="op" id="3562047">*</span><span class="ident" id="3562048">Request</span><span class="op" id="3562055">)</span>&nbsp;<span class="ident" id="3562057">FormValue</span><span class="op" id="3562066">(</span><span class="ident" id="3562067">key</span>&nbsp;<span class="builtintype" id="3562071">string</span><span class="op" id="3562077">)</span>&nbsp;<span class="builtintype" id="3562079">string</span>&nbsp;<span class="op" id="3562086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562089">if</span>&nbsp;<span class="ident" id="3562092">r</span><span class="op" id="3562093">.</span><span class="ident" id="3562094">Form</span>&nbsp;<span class="op" id="3562099">==</span>&nbsp;<span class="ident" id="3562102">nil</span>&nbsp;<span class="op" id="3562106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562110">r</span><span class="op" id="3562111">.</span><span class="ident" id="3562112">ParseMultipartForm</span><span class="op" id="3562130">(</span><span class="ident" id="3562131">defaultMaxMemory</span><span class="op" id="3562147">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562153">if</span>&nbsp;<span class="ident" id="3562156">vs</span>&nbsp;<span class="op" id="3562159">:=</span>&nbsp;<span class="ident" id="3562162">r</span><span class="op" id="3562163">.</span><span class="ident" id="3562164">Form</span><span class="op" id="3562168">[</span><span class="ident" id="3562169">key</span><span class="op" id="3562172">]</span><span class="op" id="3562173">;</span>&nbsp;<span class="builtinfunc" id="3562175">len</span><span class="op" id="3562178">(</span><span class="ident" id="3562179">vs</span><span class="op" id="3562181">)</span>&nbsp;<span class="op" id="3562183">&gt;</span>&nbsp;<span class="num" id="3562185">0</span>&nbsp;<span class="op" id="3562187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562191">return</span>&nbsp;<span class="ident" id="3562198">vs</span><span class="op" id="3562200">[</span><span class="num" id="3562201">0</span><span class="op" id="3562202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562208">return</span>&nbsp;<span class="string" id="3562215">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3562218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3562221">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3562298">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3562356">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3562437">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3562480">func</span>&nbsp;<span class="op" id="3562485">(</span><span class="ident" id="3562486">r</span>&nbsp;<span class="op" id="3562488">*</span><span class="ident" id="3562489">Request</span><span class="op" id="3562496">)</span>&nbsp;<span class="ident" id="3562498">PostFormValue</span><span class="op" id="3562511">(</span><span class="ident" id="3562512">key</span>&nbsp;<span class="builtintype" id="3562516">string</span><span class="op" id="3562522">)</span>&nbsp;<span class="builtintype" id="3562524">string</span>&nbsp;<span class="op" id="3562531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562534">if</span>&nbsp;<span class="ident" id="3562537">r</span><span class="op" id="3562538">.</span><span class="ident" id="3562539">PostForm</span>&nbsp;<span class="op" id="3562548">==</span>&nbsp;<span class="ident" id="3562551">nil</span>&nbsp;<span class="op" id="3562555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562559">r</span><span class="op" id="3562560">.</span><span class="ident" id="3562561">ParseMultipartForm</span><span class="op" id="3562579">(</span><span class="ident" id="3562580">defaultMaxMemory</span><span class="op" id="3562596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562599">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562602">if</span>&nbsp;<span class="ident" id="3562605">vs</span>&nbsp;<span class="op" id="3562608">:=</span>&nbsp;<span class="ident" id="3562611">r</span><span class="op" id="3562612">.</span><span class="ident" id="3562613">PostForm</span><span class="op" id="3562621">[</span><span class="ident" id="3562622">key</span><span class="op" id="3562625">]</span><span class="op" id="3562626">;</span>&nbsp;<span class="builtinfunc" id="3562628">len</span><span class="op" id="3562631">(</span><span class="ident" id="3562632">vs</span><span class="op" id="3562634">)</span>&nbsp;<span class="op" id="3562636">&gt;</span>&nbsp;<span class="num" id="3562638">0</span>&nbsp;<span class="op" id="3562640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562644">return</span>&nbsp;<span class="ident" id="3562651">vs</span><span class="op" id="3562653">[</span><span class="num" id="3562654">0</span><span class="op" id="3562655">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562661">return</span>&nbsp;<span class="string" id="3562668">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3562671">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3562674">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3562736">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3562801">func</span>&nbsp;<span class="op" id="3562806">(</span><span class="ident" id="3562807">r</span>&nbsp;<span class="op" id="3562809">*</span><span class="ident" id="3562810">Request</span><span class="op" id="3562817">)</span>&nbsp;<span class="ident" id="3562819">FormFile</span><span class="op" id="3562827">(</span><span class="ident" id="3562828">key</span>&nbsp;<span class="builtintype" id="3562832">string</span><span class="op" id="3562838">)</span>&nbsp;<span class="op" id="3562840">(</span><span class="ident" id="3562841">multipart</span><span class="op" id="3562850">.</span><span class="ident" id="3562851">File</span><span class="op" id="3562855">,</span>&nbsp;<span class="op" id="3562857">*</span><span class="ident" id="3562858">multipart</span><span class="op" id="3562867">.</span><span class="ident" id="3562868">FileHeader</span><span class="op" id="3562878">,</span>&nbsp;<span class="builtintype" id="3562880">error</span><span class="op" id="3562885">)</span>&nbsp;<span class="op" id="3562887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562890">if</span>&nbsp;<span class="ident" id="3562893">r</span><span class="op" id="3562894">.</span><span class="ident" id="3562895">MultipartForm</span>&nbsp;<span class="op" id="3562909">==</span>&nbsp;<span class="ident" id="3562912">multipartByReader</span>&nbsp;<span class="op" id="3562930">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562934">return</span>&nbsp;<span class="ident" id="3562941">nil</span><span class="op" id="3562944">,</span>&nbsp;<span class="ident" id="3562946">nil</span><span class="op" id="3562949">,</span>&nbsp;<span class="ident" id="3562951">errors</span><span class="op" id="3562957">.</span><span class="ident" id="3562958">New</span><span class="op" id="3562961">(</span><span class="string" id="3562962">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3563006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563012">if</span>&nbsp;<span class="ident" id="3563015">r</span><span class="op" id="3563016">.</span><span class="ident" id="3563017">MultipartForm</span>&nbsp;<span class="op" id="3563031">==</span>&nbsp;<span class="ident" id="3563034">nil</span>&nbsp;<span class="op" id="3563038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563042">err</span>&nbsp;<span class="op" id="3563046">:=</span>&nbsp;<span class="ident" id="3563049">r</span><span class="op" id="3563050">.</span><span class="ident" id="3563051">ParseMultipartForm</span><span class="op" id="3563069">(</span><span class="ident" id="3563070">defaultMaxMemory</span><span class="op" id="3563086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563090">if</span>&nbsp;<span class="ident" id="3563093">err</span>&nbsp;<span class="op" id="3563097">!=</span>&nbsp;<span class="ident" id="3563100">nil</span>&nbsp;<span class="op" id="3563104">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563109">return</span>&nbsp;<span class="ident" id="3563116">nil</span><span class="op" id="3563119">,</span>&nbsp;<span class="ident" id="3563121">nil</span><span class="op" id="3563124">,</span>&nbsp;<span class="ident" id="3563126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563138">if</span>&nbsp;<span class="ident" id="3563141">r</span><span class="op" id="3563142">.</span><span class="ident" id="3563143">MultipartForm</span>&nbsp;<span class="op" id="3563157">!=</span>&nbsp;<span class="ident" id="3563160">nil</span>&nbsp;<span class="op" id="3563164">&amp;&amp;</span>&nbsp;<span class="ident" id="3563167">r</span><span class="op" id="3563168">.</span><span class="ident" id="3563169">MultipartForm</span><span class="op" id="3563182">.</span><span class="ident" id="3563183">File</span>&nbsp;<span class="op" id="3563188">!=</span>&nbsp;<span class="ident" id="3563191">nil</span>&nbsp;<span class="op" id="3563195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563199">if</span>&nbsp;<span class="ident" id="3563202">fhs</span>&nbsp;<span class="op" id="3563206">:=</span>&nbsp;<span class="ident" id="3563209">r</span><span class="op" id="3563210">.</span><span class="ident" id="3563211">MultipartForm</span><span class="op" id="3563224">.</span><span class="ident" id="3563225">File</span><span class="op" id="3563229">[</span><span class="ident" id="3563230">key</span><span class="op" id="3563233">]</span><span class="op" id="3563234">;</span>&nbsp;<span class="builtinfunc" id="3563236">len</span><span class="op" id="3563239">(</span><span class="ident" id="3563240">fhs</span><span class="op" id="3563243">)</span>&nbsp;<span class="op" id="3563245">&gt;</span>&nbsp;<span class="num" id="3563247">0</span>&nbsp;<span class="op" id="3563249">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563254">f</span><span class="op" id="3563255">,</span>&nbsp;<span class="ident" id="3563257">err</span>&nbsp;<span class="op" id="3563261">:=</span>&nbsp;<span class="ident" id="3563264">fhs</span><span class="op" id="3563267">[</span><span class="num" id="3563268">0</span><span class="op" id="3563269">]</span><span class="op" id="3563270">.</span><span class="ident" id="3563271">Open</span><span class="op" id="3563275">(</span><span class="op" id="3563276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563281">return</span>&nbsp;<span class="ident" id="3563288">f</span><span class="op" id="3563289">,</span>&nbsp;<span class="ident" id="3563291">fhs</span><span class="op" id="3563294">[</span><span class="num" id="3563295">0</span><span class="op" id="3563296">]</span><span class="op" id="3563297">,</span>&nbsp;<span class="ident" id="3563299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563311">return</span>&nbsp;<span class="ident" id="3563318">nil</span><span class="op" id="3563321">,</span>&nbsp;<span class="ident" id="3563323">nil</span><span class="op" id="3563326">,</span>&nbsp;<span class="ident" id="3563328">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3563343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3563346">func</span>&nbsp;<span class="op" id="3563351">(</span><span class="ident" id="3563352">r</span>&nbsp;<span class="op" id="3563354">*</span><span class="ident" id="3563355">Request</span><span class="op" id="3563362">)</span>&nbsp;<span class="ident" id="3563364">expectsContinue</span><span class="op" id="3563379">(</span><span class="op" id="3563380">)</span>&nbsp;<span class="builtintype" id="3563382">bool</span>&nbsp;<span class="op" id="3563387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563390">return</span>&nbsp;<span class="ident" id="3563397">hasToken</span><span class="op" id="3563405">(</span><span class="ident" id="3563406">r</span><span class="op" id="3563407">.</span><span class="ident" id="3563408">Header</span><span class="op" id="3563414">.</span><span class="ident" id="3563415">get</span><span class="op" id="3563418">(</span><span class="string" id="3563419">&#34;Expect&#34;</span><span class="op" id="3563427">)</span><span class="op" id="3563428">,</span>&nbsp;<span class="string" id="3563430">&#34;100-continue&#34;</span><span class="op" id="3563444">)</span><br>
<span class="lineno"></span><span class="op" id="3563446">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3563449">func</span>&nbsp;<span class="op" id="3563454">(</span><span class="ident" id="3563455">r</span>&nbsp;<span class="op" id="3563457">*</span><span class="ident" id="3563458">Request</span><span class="op" id="3563465">)</span>&nbsp;<span class="ident" id="3563467">wantsHttp10KeepAlive</span><span class="op" id="3563487">(</span><span class="op" id="3563488">)</span>&nbsp;<span class="builtintype" id="3563490">bool</span>&nbsp;<span class="op" id="3563495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563498">if</span>&nbsp;<span class="ident" id="3563501">r</span><span class="op" id="3563502">.</span><span class="ident" id="3563503">ProtoMajor</span>&nbsp;<span class="op" id="3563514">!=</span>&nbsp;<span class="num" id="3563517">1</span>&nbsp;<span class="op" id="3563519">||</span>&nbsp;<span class="ident" id="3563522">r</span><span class="op" id="3563523">.</span><span class="ident" id="3563524">ProtoMinor</span>&nbsp;<span class="op" id="3563535">!=</span>&nbsp;<span class="num" id="3563538">0</span>&nbsp;<span class="op" id="3563540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563544">return</span>&nbsp;<span class="ident" id="3563551">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563558">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563561">return</span>&nbsp;<span class="ident" id="3563568">hasToken</span><span class="op" id="3563576">(</span><span class="ident" id="3563577">r</span><span class="op" id="3563578">.</span><span class="ident" id="3563579">Header</span><span class="op" id="3563585">.</span><span class="ident" id="3563586">get</span><span class="op" id="3563589">(</span><span class="string" id="3563590">&#34;Connection&#34;</span><span class="op" id="3563602">)</span><span class="op" id="3563603">,</span>&nbsp;<span class="string" id="3563605">&#34;keep-alive&#34;</span><span class="op" id="3563617">)</span><br>
<span class="lineno"></span><span class="op" id="3563619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3563622">func</span>&nbsp;<span class="op" id="3563627">(</span><span class="ident" id="3563628">r</span>&nbsp;<span class="op" id="3563630">*</span><span class="ident" id="3563631">Request</span><span class="op" id="3563638">)</span>&nbsp;<span class="ident" id="3563640">wantsClose</span><span class="op" id="3563650">(</span><span class="op" id="3563651">)</span>&nbsp;<span class="builtintype" id="3563653">bool</span>&nbsp;<span class="op" id="3563658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563661">return</span>&nbsp;<span class="ident" id="3563668">hasToken</span><span class="op" id="3563676">(</span><span class="ident" id="3563677">r</span><span class="op" id="3563678">.</span><span class="ident" id="3563679">Header</span><span class="op" id="3563685">.</span><span class="ident" id="3563686">get</span><span class="op" id="3563689">(</span><span class="string" id="3563690">&#34;Connection&#34;</span><span class="op" id="3563702">)</span><span class="op" id="3563703">,</span>&nbsp;<span class="string" id="3563705">&#34;close&#34;</span><span class="op" id="3563712">)</span><br>
<span class="lineno">915</span><span class="op" id="3563714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3563717">func</span>&nbsp;<span class="op" id="3563722">(</span><span class="ident" id="3563723">r</span>&nbsp;<span class="op" id="3563725">*</span><span class="ident" id="3563726">Request</span><span class="op" id="3563733">)</span>&nbsp;<span class="ident" id="3563735">closeBody</span><span class="op" id="3563744">(</span><span class="op" id="3563745">)</span>&nbsp;<span class="op" id="3563747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563750">if</span>&nbsp;<span class="ident" id="3563753">r</span><span class="op" id="3563754">.</span><span class="ident" id="3563755">Body</span>&nbsp;<span class="op" id="3563760">!=</span>&nbsp;<span class="ident" id="3563763">nil</span>&nbsp;<span class="op" id="3563767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563771">r</span><span class="op" id="3563772">.</span><span class="ident" id="3563773">Body</span><span class="op" id="3563777">.</span><span class="ident" id="3563778">Close</span><span class="op" id="3563783">(</span><span class="op" id="3563784">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563787">}</span><br>
<span class="lineno"></span><span class="op" id="3563789">}</span>
</div>
</body>
</html>
