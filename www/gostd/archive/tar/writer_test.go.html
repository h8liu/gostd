<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6461120">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6461175">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6461229">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6461280">package</span>&nbsp;<span class="ident" id="6461288">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6461293">import</span>&nbsp;<span class="op" id="6461300">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461303">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461312">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461319">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461325">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461338">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461344">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461355">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461366">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461377">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461395">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6461402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6461405">type</span>&nbsp;<span class="ident" id="6461410">writerTestEntry</span>&nbsp;<span class="keyword" id="6461426">struct</span>&nbsp;<span class="op" id="6461433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461436">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6461445">*</span><span class="ident" id="6461446">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461454">contents</span>&nbsp;<span class="builtintype" id="6461463">string</span><br>
<span class="lineno"></span><span class="op" id="6461470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6461473">type</span>&nbsp;<span class="ident" id="6461478">writerTest</span>&nbsp;<span class="keyword" id="6461489">struct</span>&nbsp;<span class="op" id="6461496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461499">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6461507">string</span>&nbsp;<span class="comment" id="6461514">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461546">entries</span>&nbsp;<span class="op" id="6461554">[</span><span class="op" id="6461555">]</span><span class="op" id="6461556">*</span><span class="ident" id="6461557">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="6461573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6461576">var</span>&nbsp;<span class="ident" id="6461580">writerTests</span>&nbsp;<span class="op" id="6461592">=</span>&nbsp;<span class="op" id="6461594">[</span><span class="op" id="6461595">]</span><span class="op" id="6461596">*</span><span class="ident" id="6461597">writerTest</span><span class="op" id="6461607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6461610">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6461667">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6461690">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6461721">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461802">file</span><span class="op" id="6461806">:</span>&nbsp;<span class="string" id="6461808">&#34;testdata/writer.tar&#34;</span><span class="op" id="6461829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461833">entries</span><span class="op" id="6461840">:</span>&nbsp;<span class="op" id="6461842">[</span><span class="op" id="6461843">]</span><span class="op" id="6461844">*</span><span class="ident" id="6461845">writerTestEntry</span><span class="op" id="6461860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461871">header</span><span class="op" id="6461877">:</span>&nbsp;<span class="op" id="6461879">&amp;</span><span class="ident" id="6461880">Header</span><span class="op" id="6461886">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461893">Name</span><span class="op" id="6461897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461903">&#34;small.txt&#34;</span><span class="op" id="6461914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461921">Mode</span><span class="op" id="6461925">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461931">0640</span><span class="op" id="6461935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461942">Uid</span><span class="op" id="6461945">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461952">73025</span><span class="op" id="6461957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461964">Gid</span><span class="op" id="6461967">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461974">5000</span><span class="op" id="6461978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461985">Size</span><span class="op" id="6461989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461995">5</span><span class="op" id="6461996">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462003">ModTime</span><span class="op" id="6462010">:</span>&nbsp;&nbsp;<span class="ident" id="6462013">time</span><span class="op" id="6462017">.</span><span class="ident" id="6462018">Unix</span><span class="op" id="6462022">(</span><span class="num" id="6462023">1246508266</span><span class="op" id="6462033">,</span>&nbsp;<span class="num" id="6462035">0</span><span class="op" id="6462036">)</span><span class="op" id="6462037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462044">Typeflag</span><span class="op" id="6462052">:</span>&nbsp;<span class="string" id="6462054">&#39;0&#39;</span><span class="op" id="6462057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462064">Uname</span><span class="op" id="6462069">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462074">&#34;dsymonds&#34;</span><span class="op" id="6462084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462091">Gname</span><span class="op" id="6462096">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462101">&#34;eng&#34;</span><span class="op" id="6462106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462112">}</span><span class="op" id="6462113">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462119">contents</span><span class="op" id="6462127">:</span>&nbsp;<span class="string" id="6462129">&#34;Kilts&#34;</span><span class="op" id="6462136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462141">}</span><span class="op" id="6462142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462153">header</span><span class="op" id="6462159">:</span>&nbsp;<span class="op" id="6462161">&amp;</span><span class="ident" id="6462162">Header</span><span class="op" id="6462168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462175">Name</span><span class="op" id="6462179">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462185">&#34;small2.txt&#34;</span><span class="op" id="6462197">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462204">Mode</span><span class="op" id="6462208">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462214">0640</span><span class="op" id="6462218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462225">Uid</span><span class="op" id="6462228">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462235">73025</span><span class="op" id="6462240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462247">Gid</span><span class="op" id="6462250">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462257">5000</span><span class="op" id="6462261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462268">Size</span><span class="op" id="6462272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462278">11</span><span class="op" id="6462280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462287">ModTime</span><span class="op" id="6462294">:</span>&nbsp;&nbsp;<span class="ident" id="6462297">time</span><span class="op" id="6462301">.</span><span class="ident" id="6462302">Unix</span><span class="op" id="6462306">(</span><span class="num" id="6462307">1245217492</span><span class="op" id="6462317">,</span>&nbsp;<span class="num" id="6462319">0</span><span class="op" id="6462320">)</span><span class="op" id="6462321">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462328">Typeflag</span><span class="op" id="6462336">:</span>&nbsp;<span class="string" id="6462338">&#39;0&#39;</span><span class="op" id="6462341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462348">Uname</span><span class="op" id="6462353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462358">&#34;dsymonds&#34;</span><span class="op" id="6462368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462375">Gname</span><span class="op" id="6462380">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462385">&#34;eng&#34;</span><span class="op" id="6462390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462396">}</span><span class="op" id="6462397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462403">contents</span><span class="op" id="6462411">:</span>&nbsp;<span class="string" id="6462413">&#34;Google.com\n&#34;</span><span class="op" id="6462427">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462432">}</span><span class="op" id="6462433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462444">header</span><span class="op" id="6462450">:</span>&nbsp;<span class="op" id="6462452">&amp;</span><span class="ident" id="6462453">Header</span><span class="op" id="6462459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462466">Name</span><span class="op" id="6462470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462476">&#34;link.txt&#34;</span><span class="op" id="6462486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462493">Mode</span><span class="op" id="6462497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462503">0777</span><span class="op" id="6462507">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462514">Uid</span><span class="op" id="6462517">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462524">1000</span><span class="op" id="6462528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462535">Gid</span><span class="op" id="6462538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462545">1000</span><span class="op" id="6462549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462556">Size</span><span class="op" id="6462560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6462566">0</span><span class="op" id="6462567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462574">ModTime</span><span class="op" id="6462581">:</span>&nbsp;&nbsp;<span class="ident" id="6462584">time</span><span class="op" id="6462588">.</span><span class="ident" id="6462589">Unix</span><span class="op" id="6462593">(</span><span class="num" id="6462594">1314603082</span><span class="op" id="6462604">,</span>&nbsp;<span class="num" id="6462606">0</span><span class="op" id="6462607">)</span><span class="op" id="6462608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462615">Typeflag</span><span class="op" id="6462623">:</span>&nbsp;<span class="string" id="6462625">&#39;2&#39;</span><span class="op" id="6462628">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462635">Linkname</span><span class="op" id="6462643">:</span>&nbsp;<span class="string" id="6462645">&#34;small.txt&#34;</span><span class="op" id="6462656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462663">Uname</span><span class="op" id="6462668">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462673">&#34;strings&#34;</span><span class="op" id="6462682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462689">Gname</span><span class="op" id="6462694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6462699">&#34;strings&#34;</span><span class="op" id="6462708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462714">}</span><span class="op" id="6462715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6462721">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462739">}</span><span class="op" id="6462740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462744">}</span><span class="op" id="6462745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462748">}</span><span class="op" id="6462749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6462752">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6462815">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6462877">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462955">file</span><span class="op" id="6462959">:</span>&nbsp;<span class="string" id="6462961">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="6462986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462990">entries</span><span class="op" id="6462997">:</span>&nbsp;<span class="op" id="6462999">[</span><span class="op" id="6463000">]</span><span class="op" id="6463001">*</span><span class="ident" id="6463002">writerTestEntry</span><span class="op" id="6463017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463022">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463028">header</span><span class="op" id="6463034">:</span>&nbsp;<span class="op" id="6463036">&amp;</span><span class="ident" id="6463037">Header</span><span class="op" id="6463043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463050">Name</span><span class="op" id="6463054">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6463060">&#34;tmp/16gig.txt&#34;</span><span class="op" id="6463075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463082">Mode</span><span class="op" id="6463086">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463092">0640</span><span class="op" id="6463096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463103">Uid</span><span class="op" id="6463106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463113">73025</span><span class="op" id="6463118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463125">Gid</span><span class="op" id="6463128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463135">5000</span><span class="op" id="6463139">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463146">Size</span><span class="op" id="6463150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463156">16</span>&nbsp;<span class="op" id="6463159">&lt;&lt;</span>&nbsp;<span class="num" id="6463162">30</span><span class="op" id="6463164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463171">ModTime</span><span class="op" id="6463178">:</span>&nbsp;&nbsp;<span class="ident" id="6463181">time</span><span class="op" id="6463185">.</span><span class="ident" id="6463186">Unix</span><span class="op" id="6463190">(</span><span class="num" id="6463191">1254699560</span><span class="op" id="6463201">,</span>&nbsp;<span class="num" id="6463203">0</span><span class="op" id="6463204">)</span><span class="op" id="6463205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463212">Typeflag</span><span class="op" id="6463220">:</span>&nbsp;<span class="string" id="6463222">&#39;0&#39;</span><span class="op" id="6463225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463232">Uname</span><span class="op" id="6463237">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6463242">&#34;dsymonds&#34;</span><span class="op" id="6463252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463259">Gname</span><span class="op" id="6463264">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6463269">&#34;eng&#34;</span><span class="op" id="6463274">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463280">}</span><span class="op" id="6463281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6463287">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463308">contents</span><span class="op" id="6463316">:</span>&nbsp;<span class="ident" id="6463318">strings</span><span class="op" id="6463325">.</span><span class="ident" id="6463326">Repeat</span><span class="op" id="6463332">(</span><span class="string" id="6463333">&#34;\x00&#34;</span><span class="op" id="6463339">,</span>&nbsp;<span class="num" id="6463341">4</span><span class="op" id="6463342">&lt;&lt;</span><span class="num" id="6463344">10</span><span class="op" id="6463346">)</span><span class="op" id="6463347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463352">}</span><span class="op" id="6463353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463357">}</span><span class="op" id="6463358">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463361">}</span><span class="op" id="6463362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6463365">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6463428">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6463501">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463591">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463595">file</span><span class="op" id="6463599">:</span>&nbsp;<span class="string" id="6463601">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="6463631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463635">entries</span><span class="op" id="6463642">:</span>&nbsp;<span class="op" id="6463644">[</span><span class="op" id="6463645">]</span><span class="op" id="6463646">*</span><span class="ident" id="6463647">writerTestEntry</span><span class="op" id="6463662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463673">header</span><span class="op" id="6463679">:</span>&nbsp;<span class="op" id="6463681">&amp;</span><span class="ident" id="6463682">Header</span><span class="op" id="6463688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463695">Name</span><span class="op" id="6463699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463705">strings</span><span class="op" id="6463712">.</span><span class="ident" id="6463713">Repeat</span><span class="op" id="6463719">(</span><span class="string" id="6463720">&#34;longname/&#34;</span><span class="op" id="6463731">,</span>&nbsp;<span class="num" id="6463733">15</span><span class="op" id="6463735">)</span>&nbsp;<span class="op" id="6463737">+</span>&nbsp;<span class="string" id="6463739">&#34;16gig.txt&#34;</span><span class="op" id="6463750">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463757">Mode</span><span class="op" id="6463761">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463767">0644</span><span class="op" id="6463771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463778">Uid</span><span class="op" id="6463781">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463788">1000</span><span class="op" id="6463792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463799">Gid</span><span class="op" id="6463802">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463809">1000</span><span class="op" id="6463813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463820">Size</span><span class="op" id="6463824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6463830">16</span>&nbsp;<span class="op" id="6463833">&lt;&lt;</span>&nbsp;<span class="num" id="6463836">30</span><span class="op" id="6463838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463845">ModTime</span><span class="op" id="6463852">:</span>&nbsp;&nbsp;<span class="ident" id="6463855">time</span><span class="op" id="6463859">.</span><span class="ident" id="6463860">Unix</span><span class="op" id="6463864">(</span><span class="num" id="6463865">1399583047</span><span class="op" id="6463875">,</span>&nbsp;<span class="num" id="6463877">0</span><span class="op" id="6463878">)</span><span class="op" id="6463879">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463886">Typeflag</span><span class="op" id="6463894">:</span>&nbsp;<span class="string" id="6463896">&#39;0&#39;</span><span class="op" id="6463899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463906">Uname</span><span class="op" id="6463911">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6463916">&#34;guillaume&#34;</span><span class="op" id="6463927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463934">Gname</span><span class="op" id="6463939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6463944">&#34;guillaume&#34;</span><span class="op" id="6463955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463961">}</span><span class="op" id="6463962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6463968">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463989">contents</span><span class="op" id="6463997">:</span>&nbsp;<span class="ident" id="6463999">strings</span><span class="op" id="6464006">.</span><span class="ident" id="6464007">Repeat</span><span class="op" id="6464013">(</span><span class="string" id="6464014">&#34;\x00&#34;</span><span class="op" id="6464020">,</span>&nbsp;<span class="num" id="6464022">4</span><span class="op" id="6464023">&lt;&lt;</span><span class="num" id="6464025">10</span><span class="op" id="6464027">)</span><span class="op" id="6464028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464033">}</span><span class="op" id="6464034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464038">}</span><span class="op" id="6464039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464042">}</span><span class="op" id="6464043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6464046">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6464092">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464154">file</span><span class="op" id="6464158">:</span>&nbsp;<span class="string" id="6464160">&#34;testdata/ustar.tar&#34;</span><span class="op" id="6464180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464184">entries</span><span class="op" id="6464191">:</span>&nbsp;<span class="op" id="6464193">[</span><span class="op" id="6464194">]</span><span class="op" id="6464195">*</span><span class="ident" id="6464196">writerTestEntry</span><span class="op" id="6464211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464216">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464222">header</span><span class="op" id="6464228">:</span>&nbsp;<span class="op" id="6464230">&amp;</span><span class="ident" id="6464231">Header</span><span class="op" id="6464237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464244">Name</span><span class="op" id="6464248">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464254">strings</span><span class="op" id="6464261">.</span><span class="ident" id="6464262">Repeat</span><span class="op" id="6464268">(</span><span class="string" id="6464269">&#34;longname/&#34;</span><span class="op" id="6464280">,</span>&nbsp;<span class="num" id="6464282">15</span><span class="op" id="6464284">)</span>&nbsp;<span class="op" id="6464286">+</span>&nbsp;<span class="string" id="6464288">&#34;file.txt&#34;</span><span class="op" id="6464298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464305">Mode</span><span class="op" id="6464309">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6464315">0644</span><span class="op" id="6464319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464326">Uid</span><span class="op" id="6464329">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6464336">0765</span><span class="op" id="6464340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464347">Gid</span><span class="op" id="6464350">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6464357">024</span><span class="op" id="6464360">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464367">Size</span><span class="op" id="6464371">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6464377">06</span><span class="op" id="6464379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464386">ModTime</span><span class="op" id="6464393">:</span>&nbsp;&nbsp;<span class="ident" id="6464396">time</span><span class="op" id="6464400">.</span><span class="ident" id="6464401">Unix</span><span class="op" id="6464405">(</span><span class="num" id="6464406">1360135598</span><span class="op" id="6464416">,</span>&nbsp;<span class="num" id="6464418">0</span><span class="op" id="6464419">)</span><span class="op" id="6464420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464427">Typeflag</span><span class="op" id="6464435">:</span>&nbsp;<span class="string" id="6464437">&#39;0&#39;</span><span class="op" id="6464440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464447">Uname</span><span class="op" id="6464452">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6464457">&#34;shane&#34;</span><span class="op" id="6464464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464471">Gname</span><span class="op" id="6464476">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6464481">&#34;staff&#34;</span><span class="op" id="6464488">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464494">}</span><span class="op" id="6464495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464501">contents</span><span class="op" id="6464509">:</span>&nbsp;<span class="string" id="6464511">&#34;hello\n&#34;</span><span class="op" id="6464520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464525">}</span><span class="op" id="6464526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464530">}</span><span class="op" id="6464531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464534">}</span><span class="op" id="6464535">,</span><br>
<span class="lineno">150</span><span class="op" id="6464537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6464540">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="6464635">func</span>&nbsp;<span class="ident" id="6464640">bytestr</span><span class="op" id="6464647">(</span><span class="ident" id="6464648">offset</span>&nbsp;<span class="builtintype" id="6464655">int</span><span class="op" id="6464658">,</span>&nbsp;<span class="ident" id="6464660">b</span>&nbsp;<span class="op" id="6464662">[</span><span class="op" id="6464663">]</span><span class="builtintype" id="6464664">byte</span><span class="op" id="6464668">)</span>&nbsp;<span class="builtintype" id="6464670">string</span>&nbsp;<span class="op" id="6464677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464680">const</span>&nbsp;<span class="ident" id="6464686">rowLen</span>&nbsp;<span class="op" id="6464693">=</span>&nbsp;<span class="num" id="6464695">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464699">s</span>&nbsp;<span class="op" id="6464701">:=</span>&nbsp;<span class="ident" id="6464704">fmt</span><span class="op" id="6464707">.</span><span class="ident" id="6464708">Sprintf</span><span class="op" id="6464715">(</span><span class="string" id="6464716">&#34;%04x&nbsp;&#34;</span><span class="op" id="6464723">,</span>&nbsp;<span class="ident" id="6464725">offset</span><span class="op" id="6464731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464734">for</span>&nbsp;<span class="ident" id="6464738">_</span><span class="op" id="6464739">,</span>&nbsp;<span class="ident" id="6464741">ch</span>&nbsp;<span class="op" id="6464744">:=</span>&nbsp;<span class="keyword" id="6464747">range</span>&nbsp;<span class="ident" id="6464753">b</span>&nbsp;<span class="op" id="6464755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464759">switch</span>&nbsp;<span class="op" id="6464766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464770">case</span>&nbsp;<span class="string" id="6464775">&#39;0&#39;</span>&nbsp;<span class="op" id="6464779">&lt;=</span>&nbsp;<span class="ident" id="6464782">ch</span>&nbsp;<span class="op" id="6464785">&amp;&amp;</span>&nbsp;<span class="ident" id="6464788">ch</span>&nbsp;<span class="op" id="6464791">&lt;=</span>&nbsp;<span class="string" id="6464794">&#39;9&#39;</span><span class="op" id="6464797">,</span>&nbsp;<span class="string" id="6464799">&#39;A&#39;</span>&nbsp;<span class="op" id="6464803">&lt;=</span>&nbsp;<span class="ident" id="6464806">ch</span>&nbsp;<span class="op" id="6464809">&amp;&amp;</span>&nbsp;<span class="ident" id="6464812">ch</span>&nbsp;<span class="op" id="6464815">&lt;=</span>&nbsp;<span class="string" id="6464818">&#39;Z&#39;</span><span class="op" id="6464821">,</span>&nbsp;<span class="string" id="6464823">&#39;a&#39;</span>&nbsp;<span class="op" id="6464827">&lt;=</span>&nbsp;<span class="ident" id="6464830">ch</span>&nbsp;<span class="op" id="6464833">&amp;&amp;</span>&nbsp;<span class="ident" id="6464836">ch</span>&nbsp;<span class="op" id="6464839">&lt;=</span>&nbsp;<span class="string" id="6464842">&#39;z&#39;</span><span class="op" id="6464845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464850">s</span>&nbsp;<span class="op" id="6464852">+=</span>&nbsp;<span class="ident" id="6464855">fmt</span><span class="op" id="6464858">.</span><span class="ident" id="6464859">Sprintf</span><span class="op" id="6464866">(</span><span class="string" id="6464867">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="6464873">,</span>&nbsp;<span class="ident" id="6464875">ch</span><span class="op" id="6464877">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464881">default</span><span class="op" id="6464888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464893">s</span>&nbsp;<span class="op" id="6464895">+=</span>&nbsp;<span class="ident" id="6464898">fmt</span><span class="op" id="6464901">.</span><span class="ident" id="6464902">Sprintf</span><span class="op" id="6464909">(</span><span class="string" id="6464910">&#34;&nbsp;%02x&#34;</span><span class="op" id="6464917">,</span>&nbsp;<span class="ident" id="6464919">ch</span><span class="op" id="6464921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464931">return</span>&nbsp;<span class="ident" id="6464938">s</span><br>
<span class="lineno">165</span><span class="op" id="6464940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6464943">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6464996">func</span>&nbsp;<span class="ident" id="6465001">bytediff</span><span class="op" id="6465009">(</span><span class="ident" id="6465010">a</span>&nbsp;<span class="op" id="6465012">[</span><span class="op" id="6465013">]</span><span class="builtintype" id="6465014">byte</span><span class="op" id="6465018">,</span>&nbsp;<span class="ident" id="6465020">b</span>&nbsp;<span class="op" id="6465022">[</span><span class="op" id="6465023">]</span><span class="builtintype" id="6465024">byte</span><span class="op" id="6465028">)</span>&nbsp;<span class="builtintype" id="6465030">string</span>&nbsp;<span class="op" id="6465037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465040">const</span>&nbsp;<span class="ident" id="6465046">rowLen</span>&nbsp;<span class="op" id="6465053">=</span>&nbsp;<span class="num" id="6465055">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465059">s</span>&nbsp;<span class="op" id="6465061">:=</span>&nbsp;<span class="ident" id="6465064">fmt</span><span class="op" id="6465067">.</span><span class="ident" id="6465068">Sprintf</span><span class="op" id="6465075">(</span><span class="string" id="6465076">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="6465103">,</span>&nbsp;<span class="builtinfunc" id="6465105">len</span><span class="op" id="6465108">(</span><span class="ident" id="6465109">a</span><span class="op" id="6465110">)</span><span class="op" id="6465111">,</span>&nbsp;<span class="builtinfunc" id="6465113">len</span><span class="op" id="6465116">(</span><span class="ident" id="6465117">b</span><span class="op" id="6465118">)</span><span class="op" id="6465119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465122">for</span>&nbsp;<span class="ident" id="6465126">offset</span>&nbsp;<span class="op" id="6465133">:=</span>&nbsp;<span class="num" id="6465136">0</span><span class="op" id="6465137">;</span>&nbsp;<span class="builtinfunc" id="6465139">len</span><span class="op" id="6465142">(</span><span class="ident" id="6465143">a</span><span class="op" id="6465144">)</span><span class="op" id="6465145">+</span><span class="builtinfunc" id="6465146">len</span><span class="op" id="6465149">(</span><span class="ident" id="6465150">b</span><span class="op" id="6465151">)</span>&nbsp;<span class="op" id="6465153">&gt;</span>&nbsp;<span class="num" id="6465155">0</span><span class="op" id="6465156">;</span>&nbsp;<span class="ident" id="6465158">offset</span>&nbsp;<span class="op" id="6465165">+=</span>&nbsp;<span class="ident" id="6465168">rowLen</span>&nbsp;<span class="op" id="6465175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465179">na</span><span class="op" id="6465181">,</span>&nbsp;<span class="ident" id="6465183">nb</span>&nbsp;<span class="op" id="6465186">:=</span>&nbsp;<span class="ident" id="6465189">rowLen</span><span class="op" id="6465195">,</span>&nbsp;<span class="ident" id="6465197">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465206">if</span>&nbsp;<span class="ident" id="6465209">na</span>&nbsp;<span class="op" id="6465212">&gt;</span>&nbsp;<span class="builtinfunc" id="6465214">len</span><span class="op" id="6465217">(</span><span class="ident" id="6465218">a</span><span class="op" id="6465219">)</span>&nbsp;<span class="op" id="6465221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465226">na</span>&nbsp;<span class="op" id="6465229">=</span>&nbsp;<span class="builtinfunc" id="6465231">len</span><span class="op" id="6465234">(</span><span class="ident" id="6465235">a</span><span class="op" id="6465236">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465244">if</span>&nbsp;<span class="ident" id="6465247">nb</span>&nbsp;<span class="op" id="6465250">&gt;</span>&nbsp;<span class="builtinfunc" id="6465252">len</span><span class="op" id="6465255">(</span><span class="ident" id="6465256">b</span><span class="op" id="6465257">)</span>&nbsp;<span class="op" id="6465259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465264">nb</span>&nbsp;<span class="op" id="6465267">=</span>&nbsp;<span class="builtinfunc" id="6465269">len</span><span class="op" id="6465272">(</span><span class="ident" id="6465273">b</span><span class="op" id="6465274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465282">sa</span>&nbsp;<span class="op" id="6465285">:=</span>&nbsp;<span class="ident" id="6465288">bytestr</span><span class="op" id="6465295">(</span><span class="ident" id="6465296">offset</span><span class="op" id="6465302">,</span>&nbsp;<span class="ident" id="6465304">a</span><span class="op" id="6465305">[</span><span class="num" id="6465306">0</span><span class="op" id="6465307">:</span><span class="ident" id="6465308">na</span><span class="op" id="6465310">]</span><span class="op" id="6465311">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465315">sb</span>&nbsp;<span class="op" id="6465318">:=</span>&nbsp;<span class="ident" id="6465321">bytestr</span><span class="op" id="6465328">(</span><span class="ident" id="6465329">offset</span><span class="op" id="6465335">,</span>&nbsp;<span class="ident" id="6465337">b</span><span class="op" id="6465338">[</span><span class="num" id="6465339">0</span><span class="op" id="6465340">:</span><span class="ident" id="6465341">nb</span><span class="op" id="6465343">]</span><span class="op" id="6465344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465348">if</span>&nbsp;<span class="ident" id="6465351">sa</span>&nbsp;<span class="op" id="6465354">!=</span>&nbsp;<span class="ident" id="6465357">sb</span>&nbsp;<span class="op" id="6465360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465365">s</span>&nbsp;<span class="op" id="6465367">+=</span>&nbsp;<span class="ident" id="6465370">fmt</span><span class="op" id="6465373">.</span><span class="ident" id="6465374">Sprintf</span><span class="op" id="6465381">(</span><span class="string" id="6465382">&#34;-%v\n+%v\n&#34;</span><span class="op" id="6465394">,</span>&nbsp;<span class="ident" id="6465396">sa</span><span class="op" id="6465398">,</span>&nbsp;<span class="ident" id="6465400">sb</span><span class="op" id="6465402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465410">a</span>&nbsp;<span class="op" id="6465412">=</span>&nbsp;<span class="ident" id="6465414">a</span><span class="op" id="6465415">[</span><span class="ident" id="6465416">na</span><span class="op" id="6465418">:</span><span class="op" id="6465419">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465423">b</span>&nbsp;<span class="op" id="6465425">=</span>&nbsp;<span class="ident" id="6465427">b</span><span class="op" id="6465428">[</span><span class="ident" id="6465429">nb</span><span class="op" id="6465431">:</span><span class="op" id="6465432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465438">return</span>&nbsp;<span class="ident" id="6465445">s</span><br>
<span class="lineno"></span><span class="op" id="6465447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6465450">func</span>&nbsp;<span class="ident" id="6465455">TestWriter</span><span class="op" id="6465465">(</span><span class="ident" id="6465466">t</span>&nbsp;<span class="op" id="6465468">*</span><span class="ident" id="6465469">testing</span><span class="op" id="6465476">.</span><span class="ident" id="6465477">T</span><span class="op" id="6465478">)</span>&nbsp;<span class="op" id="6465480">{</span><br>
<span class="lineno"></span><span class="ident" id="6465482">testLoop</span><span class="op" id="6465490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465493">for</span>&nbsp;<span class="ident" id="6465497">i</span><span class="op" id="6465498">,</span>&nbsp;<span class="ident" id="6465500">test</span>&nbsp;<span class="op" id="6465505">:=</span>&nbsp;<span class="keyword" id="6465508">range</span>&nbsp;<span class="ident" id="6465514">writerTests</span>&nbsp;<span class="op" id="6465526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465530">expected</span><span class="op" id="6465538">,</span>&nbsp;<span class="ident" id="6465540">err</span>&nbsp;<span class="op" id="6465544">:=</span>&nbsp;<span class="ident" id="6465547">ioutil</span><span class="op" id="6465553">.</span><span class="ident" id="6465554">ReadFile</span><span class="op" id="6465562">(</span><span class="ident" id="6465563">test</span><span class="op" id="6465567">.</span><span class="ident" id="6465568">file</span><span class="op" id="6465572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465576">if</span>&nbsp;<span class="ident" id="6465579">err</span>&nbsp;<span class="op" id="6465583">!=</span>&nbsp;<span class="ident" id="6465586">nil</span>&nbsp;<span class="op" id="6465590">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465595">t</span><span class="op" id="6465596">.</span><span class="ident" id="6465597">Errorf</span><span class="op" id="6465603">(</span><span class="string" id="6465604">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6465635">,</span>&nbsp;<span class="ident" id="6465637">i</span><span class="op" id="6465638">,</span>&nbsp;<span class="ident" id="6465640">err</span><span class="op" id="6465643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465648">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465664">buf</span>&nbsp;<span class="op" id="6465668">:=</span>&nbsp;<span class="builtinfunc" id="6465671">new</span><span class="op" id="6465674">(</span><span class="ident" id="6465675">bytes</span><span class="op" id="6465680">.</span><span class="ident" id="6465681">Buffer</span><span class="op" id="6465687">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465691">tw</span>&nbsp;<span class="op" id="6465694">:=</span>&nbsp;<span class="ident" id="6465697">NewWriter</span><span class="op" id="6465706">(</span><span class="ident" id="6465707">iotest</span><span class="op" id="6465713">.</span><span class="ident" id="6465714">TruncateWriter</span><span class="op" id="6465728">(</span><span class="ident" id="6465729">buf</span><span class="op" id="6465732">,</span>&nbsp;<span class="num" id="6465734">4</span><span class="op" id="6465735">&lt;&lt;</span><span class="num" id="6465737">10</span><span class="op" id="6465739">)</span><span class="op" id="6465740">)</span>&nbsp;<span class="comment" id="6465742">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465773">big</span>&nbsp;<span class="op" id="6465777">:=</span>&nbsp;<span class="builtintype" id="6465780">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465788">for</span>&nbsp;<span class="ident" id="6465792">j</span><span class="op" id="6465793">,</span>&nbsp;<span class="ident" id="6465795">entry</span>&nbsp;<span class="op" id="6465801">:=</span>&nbsp;<span class="keyword" id="6465804">range</span>&nbsp;<span class="ident" id="6465810">test</span><span class="op" id="6465814">.</span><span class="ident" id="6465815">entries</span>&nbsp;<span class="op" id="6465823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465828">big</span>&nbsp;<span class="op" id="6465832">=</span>&nbsp;<span class="ident" id="6465834">big</span>&nbsp;<span class="op" id="6465838">||</span>&nbsp;<span class="ident" id="6465841">entry</span><span class="op" id="6465846">.</span><span class="ident" id="6465847">header</span><span class="op" id="6465853">.</span><span class="ident" id="6465854">Size</span>&nbsp;<span class="op" id="6465859">&gt;</span>&nbsp;<span class="num" id="6465861">1</span><span class="op" id="6465862">&lt;&lt;</span><span class="num" id="6465864">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465870">if</span>&nbsp;<span class="ident" id="6465873">err</span>&nbsp;<span class="op" id="6465877">:=</span>&nbsp;<span class="ident" id="6465880">tw</span><span class="op" id="6465882">.</span><span class="ident" id="6465883">WriteHeader</span><span class="op" id="6465894">(</span><span class="ident" id="6465895">entry</span><span class="op" id="6465900">.</span><span class="ident" id="6465901">header</span><span class="op" id="6465907">)</span><span class="op" id="6465908">;</span>&nbsp;<span class="ident" id="6465910">err</span>&nbsp;<span class="op" id="6465914">!=</span>&nbsp;<span class="ident" id="6465917">nil</span>&nbsp;<span class="op" id="6465921">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465927">t</span><span class="op" id="6465928">.</span><span class="ident" id="6465929">Errorf</span><span class="op" id="6465935">(</span><span class="string" id="6465936">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6465982">,</span>&nbsp;<span class="ident" id="6465984">i</span><span class="op" id="6465985">,</span>&nbsp;<span class="ident" id="6465987">j</span><span class="op" id="6465988">,</span>&nbsp;<span class="ident" id="6465990">err</span><span class="op" id="6465993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465999">continue</span>&nbsp;<span class="ident" id="6466008">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466025">if</span>&nbsp;<span class="ident" id="6466028">_</span><span class="op" id="6466029">,</span>&nbsp;<span class="ident" id="6466031">err</span>&nbsp;<span class="op" id="6466035">:=</span>&nbsp;<span class="ident" id="6466038">io</span><span class="op" id="6466040">.</span><span class="ident" id="6466041">WriteString</span><span class="op" id="6466052">(</span><span class="ident" id="6466053">tw</span><span class="op" id="6466055">,</span>&nbsp;<span class="ident" id="6466057">entry</span><span class="op" id="6466062">.</span><span class="ident" id="6466063">contents</span><span class="op" id="6466071">)</span><span class="op" id="6466072">;</span>&nbsp;<span class="ident" id="6466074">err</span>&nbsp;<span class="op" id="6466078">!=</span>&nbsp;<span class="ident" id="6466081">nil</span>&nbsp;<span class="op" id="6466085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466091">t</span><span class="op" id="6466092">.</span><span class="ident" id="6466093">Errorf</span><span class="op" id="6466099">(</span><span class="string" id="6466100">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="6466148">,</span>&nbsp;<span class="ident" id="6466150">i</span><span class="op" id="6466151">,</span>&nbsp;<span class="ident" id="6466153">j</span><span class="op" id="6466154">,</span>&nbsp;<span class="ident" id="6466156">err</span><span class="op" id="6466159">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466165">continue</span>&nbsp;<span class="ident" id="6466174">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6466194">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466254">if</span>&nbsp;<span class="ident" id="6466257">err</span>&nbsp;<span class="op" id="6466261">:=</span>&nbsp;<span class="ident" id="6466264">tw</span><span class="op" id="6466266">.</span><span class="ident" id="6466267">Close</span><span class="op" id="6466272">(</span><span class="op" id="6466273">)</span><span class="op" id="6466274">;</span>&nbsp;<span class="ident" id="6466276">err</span>&nbsp;<span class="op" id="6466280">!=</span>&nbsp;<span class="ident" id="6466283">nil</span>&nbsp;<span class="op" id="6466287">&amp;&amp;</span>&nbsp;<span class="op" id="6466290">!</span><span class="ident" id="6466291">big</span>&nbsp;<span class="op" id="6466295">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466300">t</span><span class="op" id="6466301">.</span><span class="ident" id="6466302">Errorf</span><span class="op" id="6466308">(</span><span class="string" id="6466309">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="6466346">,</span>&nbsp;<span class="ident" id="6466348">i</span><span class="op" id="6466349">,</span>&nbsp;<span class="ident" id="6466351">err</span><span class="op" id="6466354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466359">continue</span>&nbsp;<span class="ident" id="6466368">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466384">actual</span>&nbsp;<span class="op" id="6466391">:=</span>&nbsp;<span class="ident" id="6466394">buf</span><span class="op" id="6466397">.</span><span class="ident" id="6466398">Bytes</span><span class="op" id="6466403">(</span><span class="op" id="6466404">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466408">if</span>&nbsp;<span class="op" id="6466411">!</span><span class="ident" id="6466412">bytes</span><span class="op" id="6466417">.</span><span class="ident" id="6466418">Equal</span><span class="op" id="6466423">(</span><span class="ident" id="6466424">expected</span><span class="op" id="6466432">,</span>&nbsp;<span class="ident" id="6466434">actual</span><span class="op" id="6466440">)</span>&nbsp;<span class="op" id="6466442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466447">t</span><span class="op" id="6466448">.</span><span class="ident" id="6466449">Errorf</span><span class="op" id="6466455">(</span><span class="string" id="6466456">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="6466511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466517">i</span><span class="op" id="6466518">,</span>&nbsp;<span class="ident" id="6466520">bytediff</span><span class="op" id="6466528">(</span><span class="ident" id="6466529">expected</span><span class="op" id="6466537">,</span>&nbsp;<span class="ident" id="6466539">actual</span><span class="op" id="6466545">)</span><span class="op" id="6466546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466554">if</span>&nbsp;<span class="ident" id="6466557">testing</span><span class="op" id="6466564">.</span><span class="ident" id="6466565">Short</span><span class="op" id="6466570">(</span><span class="op" id="6466571">)</span>&nbsp;<span class="op" id="6466573">{</span>&nbsp;<span class="comment" id="6466575">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466611">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466622">}</span><br>
<span class="lineno"></span><span class="op" id="6466624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6466627">func</span>&nbsp;<span class="ident" id="6466632">TestPax</span><span class="op" id="6466639">(</span><span class="ident" id="6466640">t</span>&nbsp;<span class="op" id="6466642">*</span><span class="ident" id="6466643">testing</span><span class="op" id="6466650">.</span><span class="ident" id="6466651">T</span><span class="op" id="6466652">)</span>&nbsp;<span class="op" id="6466654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6466657">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466697">fileinfo</span><span class="op" id="6466705">,</span>&nbsp;<span class="ident" id="6466707">err</span>&nbsp;<span class="op" id="6466711">:=</span>&nbsp;<span class="ident" id="6466714">os</span><span class="op" id="6466716">.</span><span class="ident" id="6466717">Stat</span><span class="op" id="6466721">(</span><span class="string" id="6466722">&#34;testdata/small.txt&#34;</span><span class="op" id="6466742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466745">if</span>&nbsp;<span class="ident" id="6466748">err</span>&nbsp;<span class="op" id="6466752">!=</span>&nbsp;<span class="ident" id="6466755">nil</span>&nbsp;<span class="op" id="6466759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466763">t</span><span class="op" id="6466764">.</span><span class="ident" id="6466765">Fatal</span><span class="op" id="6466770">(</span><span class="ident" id="6466771">err</span><span class="op" id="6466774">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466780">hdr</span><span class="op" id="6466783">,</span>&nbsp;<span class="ident" id="6466785">err</span>&nbsp;<span class="op" id="6466789">:=</span>&nbsp;<span class="ident" id="6466792">FileInfoHeader</span><span class="op" id="6466806">(</span><span class="ident" id="6466807">fileinfo</span><span class="op" id="6466815">,</span>&nbsp;<span class="string" id="6466817">&#34;&#34;</span><span class="op" id="6466819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466822">if</span>&nbsp;<span class="ident" id="6466825">err</span>&nbsp;<span class="op" id="6466829">!=</span>&nbsp;<span class="ident" id="6466832">nil</span>&nbsp;<span class="op" id="6466836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466840">t</span><span class="op" id="6466841">.</span><span class="ident" id="6466842">Fatalf</span><span class="op" id="6466848">(</span><span class="string" id="6466849">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6466862">,</span>&nbsp;<span class="ident" id="6466864">err</span><span class="op" id="6466867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466870">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6466873">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466913">longName</span>&nbsp;<span class="op" id="6466922">:=</span>&nbsp;<span class="ident" id="6466925">strings</span><span class="op" id="6466932">.</span><span class="ident" id="6466933">Repeat</span><span class="op" id="6466939">(</span><span class="string" id="6466940">&#34;ab&#34;</span><span class="op" id="6466944">,</span>&nbsp;<span class="num" id="6466946">100</span><span class="op" id="6466949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466952">contents</span>&nbsp;<span class="op" id="6466961">:=</span>&nbsp;<span class="ident" id="6466964">strings</span><span class="op" id="6466971">.</span><span class="ident" id="6466972">Repeat</span><span class="op" id="6466978">(</span><span class="string" id="6466979">&#34;&nbsp;&#34;</span><span class="op" id="6466982">,</span>&nbsp;<span class="builtintype" id="6466984">int</span><span class="op" id="6466987">(</span><span class="ident" id="6466988">hdr</span><span class="op" id="6466991">.</span><span class="ident" id="6466992">Size</span><span class="op" id="6466996">)</span><span class="op" id="6466997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467000">hdr</span><span class="op" id="6467003">.</span><span class="ident" id="6467004">Name</span>&nbsp;<span class="op" id="6467009">=</span>&nbsp;<span class="ident" id="6467011">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467021">var</span>&nbsp;<span class="ident" id="6467025">buf</span>&nbsp;<span class="ident" id="6467029">bytes</span><span class="op" id="6467034">.</span><span class="ident" id="6467035">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467043">writer</span>&nbsp;<span class="op" id="6467050">:=</span>&nbsp;<span class="ident" id="6467053">NewWriter</span><span class="op" id="6467062">(</span><span class="op" id="6467063">&amp;</span><span class="ident" id="6467064">buf</span><span class="op" id="6467067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467070">if</span>&nbsp;<span class="ident" id="6467073">err</span>&nbsp;<span class="op" id="6467077">:=</span>&nbsp;<span class="ident" id="6467080">writer</span><span class="op" id="6467086">.</span><span class="ident" id="6467087">WriteHeader</span><span class="op" id="6467098">(</span><span class="ident" id="6467099">hdr</span><span class="op" id="6467102">)</span><span class="op" id="6467103">;</span>&nbsp;<span class="ident" id="6467105">err</span>&nbsp;<span class="op" id="6467109">!=</span>&nbsp;<span class="ident" id="6467112">nil</span>&nbsp;<span class="op" id="6467116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467120">t</span><span class="op" id="6467121">.</span><span class="ident" id="6467122">Fatal</span><span class="op" id="6467127">(</span><span class="ident" id="6467128">err</span><span class="op" id="6467131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467137">if</span>&nbsp;<span class="ident" id="6467140">_</span><span class="op" id="6467141">,</span>&nbsp;<span class="ident" id="6467143">err</span>&nbsp;<span class="op" id="6467147">=</span>&nbsp;<span class="ident" id="6467149">writer</span><span class="op" id="6467155">.</span><span class="ident" id="6467156">Write</span><span class="op" id="6467161">(</span><span class="op" id="6467162">[</span><span class="op" id="6467163">]</span><span class="builtintype" id="6467164">byte</span><span class="op" id="6467168">(</span><span class="ident" id="6467169">contents</span><span class="op" id="6467177">)</span><span class="op" id="6467178">)</span><span class="op" id="6467179">;</span>&nbsp;<span class="ident" id="6467181">err</span>&nbsp;<span class="op" id="6467185">!=</span>&nbsp;<span class="ident" id="6467188">nil</span>&nbsp;<span class="op" id="6467192">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467196">t</span><span class="op" id="6467197">.</span><span class="ident" id="6467198">Fatal</span><span class="op" id="6467203">(</span><span class="ident" id="6467204">err</span><span class="op" id="6467207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467213">if</span>&nbsp;<span class="ident" id="6467216">err</span>&nbsp;<span class="op" id="6467220">:=</span>&nbsp;<span class="ident" id="6467223">writer</span><span class="op" id="6467229">.</span><span class="ident" id="6467230">Close</span><span class="op" id="6467235">(</span><span class="op" id="6467236">)</span><span class="op" id="6467237">;</span>&nbsp;<span class="ident" id="6467239">err</span>&nbsp;<span class="op" id="6467243">!=</span>&nbsp;<span class="ident" id="6467246">nil</span>&nbsp;<span class="op" id="6467250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467254">t</span><span class="op" id="6467255">.</span><span class="ident" id="6467256">Fatal</span><span class="op" id="6467261">(</span><span class="ident" id="6467262">err</span><span class="op" id="6467265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467268">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6467271">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467329">if</span>&nbsp;<span class="op" id="6467332">!</span><span class="ident" id="6467333">bytes</span><span class="op" id="6467338">.</span><span class="ident" id="6467339">Contains</span><span class="op" id="6467347">(</span><span class="ident" id="6467348">buf</span><span class="op" id="6467351">.</span><span class="ident" id="6467352">Bytes</span><span class="op" id="6467357">(</span><span class="op" id="6467358">)</span><span class="op" id="6467359">,</span>&nbsp;<span class="op" id="6467361">[</span><span class="op" id="6467362">]</span><span class="builtintype" id="6467363">byte</span><span class="op" id="6467367">(</span><span class="string" id="6467368">&#34;PaxHeaders.&#34;</span><span class="op" id="6467381">)</span><span class="op" id="6467382">)</span>&nbsp;<span class="op" id="6467384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467388">t</span><span class="op" id="6467389">.</span><span class="ident" id="6467390">Fatal</span><span class="op" id="6467395">(</span><span class="string" id="6467396">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6467445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6467451">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467513">reader</span>&nbsp;<span class="op" id="6467520">:=</span>&nbsp;<span class="ident" id="6467523">NewReader</span><span class="op" id="6467532">(</span><span class="op" id="6467533">&amp;</span><span class="ident" id="6467534">buf</span><span class="op" id="6467537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467540">hdr</span><span class="op" id="6467543">,</span>&nbsp;<span class="ident" id="6467545">err</span>&nbsp;<span class="op" id="6467549">=</span>&nbsp;<span class="ident" id="6467551">reader</span><span class="op" id="6467557">.</span><span class="ident" id="6467558">Next</span><span class="op" id="6467562">(</span><span class="op" id="6467563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467566">if</span>&nbsp;<span class="ident" id="6467569">err</span>&nbsp;<span class="op" id="6467573">!=</span>&nbsp;<span class="ident" id="6467576">nil</span>&nbsp;<span class="op" id="6467580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467584">t</span><span class="op" id="6467585">.</span><span class="ident" id="6467586">Fatal</span><span class="op" id="6467591">(</span><span class="ident" id="6467592">err</span><span class="op" id="6467595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467598">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467601">if</span>&nbsp;<span class="ident" id="6467604">hdr</span><span class="op" id="6467607">.</span><span class="ident" id="6467608">Name</span>&nbsp;<span class="op" id="6467613">!=</span>&nbsp;<span class="ident" id="6467616">longName</span>&nbsp;<span class="op" id="6467625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467629">t</span><span class="op" id="6467630">.</span><span class="ident" id="6467631">Fatal</span><span class="op" id="6467636">(</span><span class="string" id="6467637">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="6467670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467673">}</span><br>
<span class="lineno"></span><span class="op" id="6467675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="6467678">func</span>&nbsp;<span class="ident" id="6467683">TestPaxSymlink</span><span class="op" id="6467697">(</span><span class="ident" id="6467698">t</span>&nbsp;<span class="op" id="6467700">*</span><span class="ident" id="6467701">testing</span><span class="op" id="6467708">.</span><span class="ident" id="6467709">T</span><span class="op" id="6467710">)</span>&nbsp;<span class="op" id="6467712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6467715">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467759">fileinfo</span><span class="op" id="6467767">,</span>&nbsp;<span class="ident" id="6467769">err</span>&nbsp;<span class="op" id="6467773">:=</span>&nbsp;<span class="ident" id="6467776">os</span><span class="op" id="6467778">.</span><span class="ident" id="6467779">Stat</span><span class="op" id="6467783">(</span><span class="string" id="6467784">&#34;testdata/small.txt&#34;</span><span class="op" id="6467804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467807">if</span>&nbsp;<span class="ident" id="6467810">err</span>&nbsp;<span class="op" id="6467814">!=</span>&nbsp;<span class="ident" id="6467817">nil</span>&nbsp;<span class="op" id="6467821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467825">t</span><span class="op" id="6467826">.</span><span class="ident" id="6467827">Fatal</span><span class="op" id="6467832">(</span><span class="ident" id="6467833">err</span><span class="op" id="6467836">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467842">hdr</span><span class="op" id="6467845">,</span>&nbsp;<span class="ident" id="6467847">err</span>&nbsp;<span class="op" id="6467851">:=</span>&nbsp;<span class="ident" id="6467854">FileInfoHeader</span><span class="op" id="6467868">(</span><span class="ident" id="6467869">fileinfo</span><span class="op" id="6467877">,</span>&nbsp;<span class="string" id="6467879">&#34;&#34;</span><span class="op" id="6467881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467884">hdr</span><span class="op" id="6467887">.</span><span class="ident" id="6467888">Typeflag</span>&nbsp;<span class="op" id="6467897">=</span>&nbsp;<span class="ident" id="6467899">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467912">if</span>&nbsp;<span class="ident" id="6467915">err</span>&nbsp;<span class="op" id="6467919">!=</span>&nbsp;<span class="ident" id="6467922">nil</span>&nbsp;<span class="op" id="6467926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467930">t</span><span class="op" id="6467931">.</span><span class="ident" id="6467932">Fatalf</span><span class="op" id="6467938">(</span><span class="string" id="6467939">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6467953">,</span>&nbsp;<span class="ident" id="6467955">err</span><span class="op" id="6467958">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6467964">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468008">longLinkname</span>&nbsp;<span class="op" id="6468021">:=</span>&nbsp;<span class="ident" id="6468024">strings</span><span class="op" id="6468031">.</span><span class="ident" id="6468032">Repeat</span><span class="op" id="6468038">(</span><span class="string" id="6468039">&#34;1234567890/1234567890&#34;</span><span class="op" id="6468062">,</span>&nbsp;<span class="num" id="6468064">10</span><span class="op" id="6468066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468069">hdr</span><span class="op" id="6468072">.</span><span class="ident" id="6468073">Linkname</span>&nbsp;<span class="op" id="6468082">=</span>&nbsp;<span class="ident" id="6468084">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468099">hdr</span><span class="op" id="6468102">.</span><span class="ident" id="6468103">Size</span>&nbsp;<span class="op" id="6468108">=</span>&nbsp;<span class="num" id="6468110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468113">var</span>&nbsp;<span class="ident" id="6468117">buf</span>&nbsp;<span class="ident" id="6468121">bytes</span><span class="op" id="6468126">.</span><span class="ident" id="6468127">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468135">writer</span>&nbsp;<span class="op" id="6468142">:=</span>&nbsp;<span class="ident" id="6468145">NewWriter</span><span class="op" id="6468154">(</span><span class="op" id="6468155">&amp;</span><span class="ident" id="6468156">buf</span><span class="op" id="6468159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468162">if</span>&nbsp;<span class="ident" id="6468165">err</span>&nbsp;<span class="op" id="6468169">:=</span>&nbsp;<span class="ident" id="6468172">writer</span><span class="op" id="6468178">.</span><span class="ident" id="6468179">WriteHeader</span><span class="op" id="6468190">(</span><span class="ident" id="6468191">hdr</span><span class="op" id="6468194">)</span><span class="op" id="6468195">;</span>&nbsp;<span class="ident" id="6468197">err</span>&nbsp;<span class="op" id="6468201">!=</span>&nbsp;<span class="ident" id="6468204">nil</span>&nbsp;<span class="op" id="6468208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468212">t</span><span class="op" id="6468213">.</span><span class="ident" id="6468214">Fatal</span><span class="op" id="6468219">(</span><span class="ident" id="6468220">err</span><span class="op" id="6468223">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468229">if</span>&nbsp;<span class="ident" id="6468232">err</span>&nbsp;<span class="op" id="6468236">:=</span>&nbsp;<span class="ident" id="6468239">writer</span><span class="op" id="6468245">.</span><span class="ident" id="6468246">Close</span><span class="op" id="6468251">(</span><span class="op" id="6468252">)</span><span class="op" id="6468253">;</span>&nbsp;<span class="ident" id="6468255">err</span>&nbsp;<span class="op" id="6468259">!=</span>&nbsp;<span class="ident" id="6468262">nil</span>&nbsp;<span class="op" id="6468266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468270">t</span><span class="op" id="6468271">.</span><span class="ident" id="6468272">Fatal</span><span class="op" id="6468277">(</span><span class="ident" id="6468278">err</span><span class="op" id="6468281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6468287">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468345">if</span>&nbsp;<span class="op" id="6468348">!</span><span class="ident" id="6468349">bytes</span><span class="op" id="6468354">.</span><span class="ident" id="6468355">Contains</span><span class="op" id="6468363">(</span><span class="ident" id="6468364">buf</span><span class="op" id="6468367">.</span><span class="ident" id="6468368">Bytes</span><span class="op" id="6468373">(</span><span class="op" id="6468374">)</span><span class="op" id="6468375">,</span>&nbsp;<span class="op" id="6468377">[</span><span class="op" id="6468378">]</span><span class="builtintype" id="6468379">byte</span><span class="op" id="6468383">(</span><span class="string" id="6468384">&#34;PaxHeaders.&#34;</span><span class="op" id="6468397">)</span><span class="op" id="6468398">)</span>&nbsp;<span class="op" id="6468400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468404">t</span><span class="op" id="6468405">.</span><span class="ident" id="6468406">Fatal</span><span class="op" id="6468411">(</span><span class="string" id="6468412">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6468461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6468467">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468529">reader</span>&nbsp;<span class="op" id="6468536">:=</span>&nbsp;<span class="ident" id="6468539">NewReader</span><span class="op" id="6468548">(</span><span class="op" id="6468549">&amp;</span><span class="ident" id="6468550">buf</span><span class="op" id="6468553">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468556">hdr</span><span class="op" id="6468559">,</span>&nbsp;<span class="ident" id="6468561">err</span>&nbsp;<span class="op" id="6468565">=</span>&nbsp;<span class="ident" id="6468567">reader</span><span class="op" id="6468573">.</span><span class="ident" id="6468574">Next</span><span class="op" id="6468578">(</span><span class="op" id="6468579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468582">if</span>&nbsp;<span class="ident" id="6468585">err</span>&nbsp;<span class="op" id="6468589">!=</span>&nbsp;<span class="ident" id="6468592">nil</span>&nbsp;<span class="op" id="6468596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468600">t</span><span class="op" id="6468601">.</span><span class="ident" id="6468602">Fatal</span><span class="op" id="6468607">(</span><span class="ident" id="6468608">err</span><span class="op" id="6468611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468617">if</span>&nbsp;<span class="ident" id="6468620">hdr</span><span class="op" id="6468623">.</span><span class="ident" id="6468624">Linkname</span>&nbsp;<span class="op" id="6468633">!=</span>&nbsp;<span class="ident" id="6468636">longLinkname</span>&nbsp;<span class="op" id="6468649">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468653">t</span><span class="op" id="6468654">.</span><span class="ident" id="6468655">Fatal</span><span class="op" id="6468660">(</span><span class="string" id="6468661">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="6468694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468697">}</span><br>
<span class="lineno"></span><span class="op" id="6468699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6468702">func</span>&nbsp;<span class="ident" id="6468707">TestPaxNonAscii</span><span class="op" id="6468722">(</span><span class="ident" id="6468723">t</span>&nbsp;<span class="op" id="6468725">*</span><span class="ident" id="6468726">testing</span><span class="op" id="6468733">.</span><span class="ident" id="6468734">T</span><span class="op" id="6468735">)</span>&nbsp;<span class="op" id="6468737">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6468740">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6468812">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468867">fileinfo</span><span class="op" id="6468875">,</span>&nbsp;<span class="ident" id="6468877">err</span>&nbsp;<span class="op" id="6468881">:=</span>&nbsp;<span class="ident" id="6468884">os</span><span class="op" id="6468886">.</span><span class="ident" id="6468887">Stat</span><span class="op" id="6468891">(</span><span class="string" id="6468892">&#34;testdata/small.txt&#34;</span><span class="op" id="6468912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468915">if</span>&nbsp;<span class="ident" id="6468918">err</span>&nbsp;<span class="op" id="6468922">!=</span>&nbsp;<span class="ident" id="6468925">nil</span>&nbsp;<span class="op" id="6468929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468933">t</span><span class="op" id="6468934">.</span><span class="ident" id="6468935">Fatal</span><span class="op" id="6468940">(</span><span class="ident" id="6468941">err</span><span class="op" id="6468944">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468951">hdr</span><span class="op" id="6468954">,</span>&nbsp;<span class="ident" id="6468956">err</span>&nbsp;<span class="op" id="6468960">:=</span>&nbsp;<span class="ident" id="6468963">FileInfoHeader</span><span class="op" id="6468977">(</span><span class="ident" id="6468978">fileinfo</span><span class="op" id="6468986">,</span>&nbsp;<span class="string" id="6468988">&#34;&#34;</span><span class="op" id="6468990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468993">if</span>&nbsp;<span class="ident" id="6468996">err</span>&nbsp;<span class="op" id="6469000">!=</span>&nbsp;<span class="ident" id="6469003">nil</span>&nbsp;<span class="op" id="6469007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469011">t</span><span class="op" id="6469012">.</span><span class="ident" id="6469013">Fatalf</span><span class="op" id="6469019">(</span><span class="string" id="6469020">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6469034">,</span>&nbsp;<span class="ident" id="6469036">err</span><span class="op" id="6469039">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6469046">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469067">chineseFilename</span>&nbsp;<span class="op" id="6469083">:=</span>&nbsp;<span class="string" id="6469086">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469099">chineseGroupname</span>&nbsp;<span class="op" id="6469116">:=</span>&nbsp;<span class="string" id="6469119">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469126">chineseUsername</span>&nbsp;<span class="op" id="6469142">:=</span>&nbsp;<span class="string" id="6469145">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469159">hdr</span><span class="op" id="6469162">.</span><span class="ident" id="6469163">Name</span>&nbsp;<span class="op" id="6469168">=</span>&nbsp;<span class="ident" id="6469170">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469187">hdr</span><span class="op" id="6469190">.</span><span class="ident" id="6469191">Gname</span>&nbsp;<span class="op" id="6469197">=</span>&nbsp;<span class="ident" id="6469199">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469217">hdr</span><span class="op" id="6469220">.</span><span class="ident" id="6469221">Uname</span>&nbsp;<span class="op" id="6469227">=</span>&nbsp;<span class="ident" id="6469229">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469247">contents</span>&nbsp;<span class="op" id="6469256">:=</span>&nbsp;<span class="ident" id="6469259">strings</span><span class="op" id="6469266">.</span><span class="ident" id="6469267">Repeat</span><span class="op" id="6469273">(</span><span class="string" id="6469274">&#34;&nbsp;&#34;</span><span class="op" id="6469277">,</span>&nbsp;<span class="builtintype" id="6469279">int</span><span class="op" id="6469282">(</span><span class="ident" id="6469283">hdr</span><span class="op" id="6469286">.</span><span class="ident" id="6469287">Size</span><span class="op" id="6469291">)</span><span class="op" id="6469292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469296">var</span>&nbsp;<span class="ident" id="6469300">buf</span>&nbsp;<span class="ident" id="6469304">bytes</span><span class="op" id="6469309">.</span><span class="ident" id="6469310">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469318">writer</span>&nbsp;<span class="op" id="6469325">:=</span>&nbsp;<span class="ident" id="6469328">NewWriter</span><span class="op" id="6469337">(</span><span class="op" id="6469338">&amp;</span><span class="ident" id="6469339">buf</span><span class="op" id="6469342">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469345">if</span>&nbsp;<span class="ident" id="6469348">err</span>&nbsp;<span class="op" id="6469352">:=</span>&nbsp;<span class="ident" id="6469355">writer</span><span class="op" id="6469361">.</span><span class="ident" id="6469362">WriteHeader</span><span class="op" id="6469373">(</span><span class="ident" id="6469374">hdr</span><span class="op" id="6469377">)</span><span class="op" id="6469378">;</span>&nbsp;<span class="ident" id="6469380">err</span>&nbsp;<span class="op" id="6469384">!=</span>&nbsp;<span class="ident" id="6469387">nil</span>&nbsp;<span class="op" id="6469391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469395">t</span><span class="op" id="6469396">.</span><span class="ident" id="6469397">Fatal</span><span class="op" id="6469402">(</span><span class="ident" id="6469403">err</span><span class="op" id="6469406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469412">if</span>&nbsp;<span class="ident" id="6469415">_</span><span class="op" id="6469416">,</span>&nbsp;<span class="ident" id="6469418">err</span>&nbsp;<span class="op" id="6469422">=</span>&nbsp;<span class="ident" id="6469424">writer</span><span class="op" id="6469430">.</span><span class="ident" id="6469431">Write</span><span class="op" id="6469436">(</span><span class="op" id="6469437">[</span><span class="op" id="6469438">]</span><span class="builtintype" id="6469439">byte</span><span class="op" id="6469443">(</span><span class="ident" id="6469444">contents</span><span class="op" id="6469452">)</span><span class="op" id="6469453">)</span><span class="op" id="6469454">;</span>&nbsp;<span class="ident" id="6469456">err</span>&nbsp;<span class="op" id="6469460">!=</span>&nbsp;<span class="ident" id="6469463">nil</span>&nbsp;<span class="op" id="6469467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469471">t</span><span class="op" id="6469472">.</span><span class="ident" id="6469473">Fatal</span><span class="op" id="6469478">(</span><span class="ident" id="6469479">err</span><span class="op" id="6469482">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469488">if</span>&nbsp;<span class="ident" id="6469491">err</span>&nbsp;<span class="op" id="6469495">:=</span>&nbsp;<span class="ident" id="6469498">writer</span><span class="op" id="6469504">.</span><span class="ident" id="6469505">Close</span><span class="op" id="6469510">(</span><span class="op" id="6469511">)</span><span class="op" id="6469512">;</span>&nbsp;<span class="ident" id="6469514">err</span>&nbsp;<span class="op" id="6469518">!=</span>&nbsp;<span class="ident" id="6469521">nil</span>&nbsp;<span class="op" id="6469525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469529">t</span><span class="op" id="6469530">.</span><span class="ident" id="6469531">Fatal</span><span class="op" id="6469536">(</span><span class="ident" id="6469537">err</span><span class="op" id="6469540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6469546">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469604">if</span>&nbsp;<span class="op" id="6469607">!</span><span class="ident" id="6469608">bytes</span><span class="op" id="6469613">.</span><span class="ident" id="6469614">Contains</span><span class="op" id="6469622">(</span><span class="ident" id="6469623">buf</span><span class="op" id="6469626">.</span><span class="ident" id="6469627">Bytes</span><span class="op" id="6469632">(</span><span class="op" id="6469633">)</span><span class="op" id="6469634">,</span>&nbsp;<span class="op" id="6469636">[</span><span class="op" id="6469637">]</span><span class="builtintype" id="6469638">byte</span><span class="op" id="6469642">(</span><span class="string" id="6469643">&#34;PaxHeaders.&#34;</span><span class="op" id="6469656">)</span><span class="op" id="6469657">)</span>&nbsp;<span class="op" id="6469659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469663">t</span><span class="op" id="6469664">.</span><span class="ident" id="6469665">Fatal</span><span class="op" id="6469670">(</span><span class="string" id="6469671">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6469720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6469726">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469788">reader</span>&nbsp;<span class="op" id="6469795">:=</span>&nbsp;<span class="ident" id="6469798">NewReader</span><span class="op" id="6469807">(</span><span class="op" id="6469808">&amp;</span><span class="ident" id="6469809">buf</span><span class="op" id="6469812">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469815">hdr</span><span class="op" id="6469818">,</span>&nbsp;<span class="ident" id="6469820">err</span>&nbsp;<span class="op" id="6469824">=</span>&nbsp;<span class="ident" id="6469826">reader</span><span class="op" id="6469832">.</span><span class="ident" id="6469833">Next</span><span class="op" id="6469837">(</span><span class="op" id="6469838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469841">if</span>&nbsp;<span class="ident" id="6469844">err</span>&nbsp;<span class="op" id="6469848">!=</span>&nbsp;<span class="ident" id="6469851">nil</span>&nbsp;<span class="op" id="6469855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469859">t</span><span class="op" id="6469860">.</span><span class="ident" id="6469861">Fatal</span><span class="op" id="6469866">(</span><span class="ident" id="6469867">err</span><span class="op" id="6469870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469876">if</span>&nbsp;<span class="ident" id="6469879">hdr</span><span class="op" id="6469882">.</span><span class="ident" id="6469883">Name</span>&nbsp;<span class="op" id="6469888">!=</span>&nbsp;<span class="ident" id="6469891">chineseFilename</span>&nbsp;<span class="op" id="6469907">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469911">t</span><span class="op" id="6469912">.</span><span class="ident" id="6469913">Fatal</span><span class="op" id="6469918">(</span><span class="string" id="6469919">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="6469950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6469953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6469956">if</span>&nbsp;<span class="ident" id="6469959">hdr</span><span class="op" id="6469962">.</span><span class="ident" id="6469963">Gname</span>&nbsp;<span class="op" id="6469969">!=</span>&nbsp;<span class="ident" id="6469972">chineseGroupname</span>&nbsp;<span class="op" id="6469989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469993">t</span><span class="op" id="6469994">.</span><span class="ident" id="6469995">Fatal</span><span class="op" id="6470000">(</span><span class="string" id="6470001">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="6470033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470036">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470039">if</span>&nbsp;<span class="ident" id="6470042">hdr</span><span class="op" id="6470045">.</span><span class="ident" id="6470046">Uname</span>&nbsp;<span class="op" id="6470052">!=</span>&nbsp;<span class="ident" id="6470055">chineseUsername</span>&nbsp;<span class="op" id="6470071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470075">t</span><span class="op" id="6470076">.</span><span class="ident" id="6470077">Fatal</span><span class="op" id="6470082">(</span><span class="string" id="6470083">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="6470114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470117">}</span><br>
<span class="lineno"></span><span class="op" id="6470119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="6470122">func</span>&nbsp;<span class="ident" id="6470127">TestPaxXattrs</span><span class="op" id="6470140">(</span><span class="ident" id="6470141">t</span>&nbsp;<span class="op" id="6470143">*</span><span class="ident" id="6470144">testing</span><span class="op" id="6470151">.</span><span class="ident" id="6470152">T</span><span class="op" id="6470153">)</span>&nbsp;<span class="op" id="6470155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470158">xattrs</span>&nbsp;<span class="op" id="6470165">:=</span>&nbsp;<span class="keyword" id="6470168">map</span><span class="op" id="6470171">[</span><span class="builtintype" id="6470172">string</span><span class="op" id="6470178">]</span><span class="builtintype" id="6470179">string</span><span class="op" id="6470185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6470189">&#34;user.key&#34;</span><span class="op" id="6470199">:</span>&nbsp;<span class="string" id="6470201">&#34;value&#34;</span><span class="op" id="6470208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6470215">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470251">fileinfo</span><span class="op" id="6470259">,</span>&nbsp;<span class="ident" id="6470261">err</span>&nbsp;<span class="op" id="6470265">:=</span>&nbsp;<span class="ident" id="6470268">os</span><span class="op" id="6470270">.</span><span class="ident" id="6470271">Stat</span><span class="op" id="6470275">(</span><span class="string" id="6470276">&#34;testdata/small.txt&#34;</span><span class="op" id="6470296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470299">if</span>&nbsp;<span class="ident" id="6470302">err</span>&nbsp;<span class="op" id="6470306">!=</span>&nbsp;<span class="ident" id="6470309">nil</span>&nbsp;<span class="op" id="6470313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470317">t</span><span class="op" id="6470318">.</span><span class="ident" id="6470319">Fatal</span><span class="op" id="6470324">(</span><span class="ident" id="6470325">err</span><span class="op" id="6470328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470331">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470334">hdr</span><span class="op" id="6470337">,</span>&nbsp;<span class="ident" id="6470339">err</span>&nbsp;<span class="op" id="6470343">:=</span>&nbsp;<span class="ident" id="6470346">FileInfoHeader</span><span class="op" id="6470360">(</span><span class="ident" id="6470361">fileinfo</span><span class="op" id="6470369">,</span>&nbsp;<span class="string" id="6470371">&#34;&#34;</span><span class="op" id="6470373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470376">if</span>&nbsp;<span class="ident" id="6470379">err</span>&nbsp;<span class="op" id="6470383">!=</span>&nbsp;<span class="ident" id="6470386">nil</span>&nbsp;<span class="op" id="6470390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470394">t</span><span class="op" id="6470395">.</span><span class="ident" id="6470396">Fatalf</span><span class="op" id="6470402">(</span><span class="string" id="6470403">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6470416">,</span>&nbsp;<span class="ident" id="6470418">err</span><span class="op" id="6470421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470427">contents</span>&nbsp;<span class="op" id="6470436">:=</span>&nbsp;<span class="string" id="6470439">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470448">hdr</span><span class="op" id="6470451">.</span><span class="ident" id="6470452">Xattrs</span>&nbsp;<span class="op" id="6470459">=</span>&nbsp;<span class="ident" id="6470461">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470469">var</span>&nbsp;<span class="ident" id="6470473">buf</span>&nbsp;<span class="ident" id="6470477">bytes</span><span class="op" id="6470482">.</span><span class="ident" id="6470483">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470491">writer</span>&nbsp;<span class="op" id="6470498">:=</span>&nbsp;<span class="ident" id="6470501">NewWriter</span><span class="op" id="6470510">(</span><span class="op" id="6470511">&amp;</span><span class="ident" id="6470512">buf</span><span class="op" id="6470515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470518">if</span>&nbsp;<span class="ident" id="6470521">err</span>&nbsp;<span class="op" id="6470525">:=</span>&nbsp;<span class="ident" id="6470528">writer</span><span class="op" id="6470534">.</span><span class="ident" id="6470535">WriteHeader</span><span class="op" id="6470546">(</span><span class="ident" id="6470547">hdr</span><span class="op" id="6470550">)</span><span class="op" id="6470551">;</span>&nbsp;<span class="ident" id="6470553">err</span>&nbsp;<span class="op" id="6470557">!=</span>&nbsp;<span class="ident" id="6470560">nil</span>&nbsp;<span class="op" id="6470564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470568">t</span><span class="op" id="6470569">.</span><span class="ident" id="6470570">Fatal</span><span class="op" id="6470575">(</span><span class="ident" id="6470576">err</span><span class="op" id="6470579">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470585">if</span>&nbsp;<span class="ident" id="6470588">_</span><span class="op" id="6470589">,</span>&nbsp;<span class="ident" id="6470591">err</span>&nbsp;<span class="op" id="6470595">=</span>&nbsp;<span class="ident" id="6470597">writer</span><span class="op" id="6470603">.</span><span class="ident" id="6470604">Write</span><span class="op" id="6470609">(</span><span class="op" id="6470610">[</span><span class="op" id="6470611">]</span><span class="builtintype" id="6470612">byte</span><span class="op" id="6470616">(</span><span class="ident" id="6470617">contents</span><span class="op" id="6470625">)</span><span class="op" id="6470626">)</span><span class="op" id="6470627">;</span>&nbsp;<span class="ident" id="6470629">err</span>&nbsp;<span class="op" id="6470633">!=</span>&nbsp;<span class="ident" id="6470636">nil</span>&nbsp;<span class="op" id="6470640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470644">t</span><span class="op" id="6470645">.</span><span class="ident" id="6470646">Fatal</span><span class="op" id="6470651">(</span><span class="ident" id="6470652">err</span><span class="op" id="6470655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470661">if</span>&nbsp;<span class="ident" id="6470664">err</span>&nbsp;<span class="op" id="6470668">:=</span>&nbsp;<span class="ident" id="6470671">writer</span><span class="op" id="6470677">.</span><span class="ident" id="6470678">Close</span><span class="op" id="6470683">(</span><span class="op" id="6470684">)</span><span class="op" id="6470685">;</span>&nbsp;<span class="ident" id="6470687">err</span>&nbsp;<span class="op" id="6470691">!=</span>&nbsp;<span class="ident" id="6470694">nil</span>&nbsp;<span class="op" id="6470698">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470702">t</span><span class="op" id="6470703">.</span><span class="ident" id="6470704">Fatal</span><span class="op" id="6470709">(</span><span class="ident" id="6470710">err</span><span class="op" id="6470713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6470719">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470780">reader</span>&nbsp;<span class="op" id="6470787">:=</span>&nbsp;<span class="ident" id="6470790">NewReader</span><span class="op" id="6470799">(</span><span class="op" id="6470800">&amp;</span><span class="ident" id="6470801">buf</span><span class="op" id="6470804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470807">hdr</span><span class="op" id="6470810">,</span>&nbsp;<span class="ident" id="6470812">err</span>&nbsp;<span class="op" id="6470816">=</span>&nbsp;<span class="ident" id="6470818">reader</span><span class="op" id="6470824">.</span><span class="ident" id="6470825">Next</span><span class="op" id="6470829">(</span><span class="op" id="6470830">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470833">if</span>&nbsp;<span class="ident" id="6470836">err</span>&nbsp;<span class="op" id="6470840">!=</span>&nbsp;<span class="ident" id="6470843">nil</span>&nbsp;<span class="op" id="6470847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470851">t</span><span class="op" id="6470852">.</span><span class="ident" id="6470853">Fatal</span><span class="op" id="6470858">(</span><span class="ident" id="6470859">err</span><span class="op" id="6470862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6470865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6470868">if</span>&nbsp;<span class="op" id="6470871">!</span><span class="ident" id="6470872">reflect</span><span class="op" id="6470879">.</span><span class="ident" id="6470880">DeepEqual</span><span class="op" id="6470889">(</span><span class="ident" id="6470890">hdr</span><span class="op" id="6470893">.</span><span class="ident" id="6470894">Xattrs</span><span class="op" id="6470900">,</span>&nbsp;<span class="ident" id="6470902">xattrs</span><span class="op" id="6470908">)</span>&nbsp;<span class="op" id="6470910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470914">t</span><span class="op" id="6470915">.</span><span class="ident" id="6470916">Fatalf</span><span class="op" id="6470922">(</span><span class="string" id="6470923">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="6470977">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6470982">hdr</span><span class="op" id="6470985">.</span><span class="ident" id="6470986">Xattrs</span><span class="op" id="6470992">,</span>&nbsp;<span class="ident" id="6470994">xattrs</span><span class="op" id="6471000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471003">}</span><br>
<span class="lineno"></span><span class="op" id="6471005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6471008">func</span>&nbsp;<span class="ident" id="6471013">TestPAXHeader</span><span class="op" id="6471026">(</span><span class="ident" id="6471027">t</span>&nbsp;<span class="op" id="6471029">*</span><span class="ident" id="6471030">testing</span><span class="op" id="6471037">.</span><span class="ident" id="6471038">T</span><span class="op" id="6471039">)</span>&nbsp;<span class="op" id="6471041">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471044">medName</span>&nbsp;<span class="op" id="6471052">:=</span>&nbsp;<span class="ident" id="6471055">strings</span><span class="op" id="6471062">.</span><span class="ident" id="6471063">Repeat</span><span class="op" id="6471069">(</span><span class="string" id="6471070">&#34;CD&#34;</span><span class="op" id="6471074">,</span>&nbsp;<span class="num" id="6471076">50</span><span class="op" id="6471078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471081">longName</span>&nbsp;<span class="op" id="6471090">:=</span>&nbsp;<span class="ident" id="6471093">strings</span><span class="op" id="6471100">.</span><span class="ident" id="6471101">Repeat</span><span class="op" id="6471107">(</span><span class="string" id="6471108">&#34;AB&#34;</span><span class="op" id="6471112">,</span>&nbsp;<span class="num" id="6471114">100</span><span class="op" id="6471117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471120">paxTests</span>&nbsp;<span class="op" id="6471129">:=</span>&nbsp;<span class="op" id="6471132">[</span><span class="op" id="6471133">]</span><span class="op" id="6471134">[</span><span class="num" id="6471135">2</span><span class="op" id="6471136">]</span><span class="builtintype" id="6471137">string</span><span class="op" id="6471143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471147">{</span><span class="ident" id="6471148">paxPath</span>&nbsp;<span class="op" id="6471156">+</span>&nbsp;<span class="string" id="6471158">&#34;=/etc/hosts&#34;</span><span class="op" id="6471171">,</span>&nbsp;<span class="string" id="6471173">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="6471195">}</span><span class="op" id="6471196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471200">{</span><span class="string" id="6471201">&#34;a=b&#34;</span><span class="op" id="6471206">,</span>&nbsp;<span class="string" id="6471208">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="6471217">}</span><span class="op" id="6471218">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6471229">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471254">{</span><span class="string" id="6471255">&#34;a=names&#34;</span><span class="op" id="6471264">,</span>&nbsp;<span class="string" id="6471266">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="6471280">}</span><span class="op" id="6471281">,</span>&nbsp;<span class="comment" id="6471283">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471316">{</span><span class="ident" id="6471317">paxPath</span>&nbsp;<span class="op" id="6471325">+</span>&nbsp;<span class="string" id="6471327">&#34;=&#34;</span>&nbsp;<span class="op" id="6471331">+</span>&nbsp;<span class="ident" id="6471333">longName</span><span class="op" id="6471341">,</span>&nbsp;<span class="ident" id="6471343">fmt</span><span class="op" id="6471346">.</span><span class="ident" id="6471347">Sprintf</span><span class="op" id="6471354">(</span><span class="string" id="6471355">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="6471370">,</span>&nbsp;<span class="ident" id="6471372">longName</span><span class="op" id="6471380">)</span><span class="op" id="6471381">}</span><span class="op" id="6471382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471386">{</span><span class="ident" id="6471387">paxPath</span>&nbsp;<span class="op" id="6471395">+</span>&nbsp;<span class="string" id="6471397">&#34;=&#34;</span>&nbsp;<span class="op" id="6471401">+</span>&nbsp;<span class="ident" id="6471403">medName</span><span class="op" id="6471410">,</span>&nbsp;<span class="ident" id="6471412">fmt</span><span class="op" id="6471415">.</span><span class="ident" id="6471416">Sprintf</span><span class="op" id="6471423">(</span><span class="string" id="6471424">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="6471439">,</span>&nbsp;<span class="ident" id="6471441">medName</span><span class="op" id="6471448">)</span><span class="op" id="6471449">}</span><span class="op" id="6471450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6471454">for</span>&nbsp;<span class="ident" id="6471458">_</span><span class="op" id="6471459">,</span>&nbsp;<span class="ident" id="6471461">test</span>&nbsp;<span class="op" id="6471466">:=</span>&nbsp;<span class="keyword" id="6471469">range</span>&nbsp;<span class="ident" id="6471475">paxTests</span>&nbsp;<span class="op" id="6471484">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471488">key</span><span class="op" id="6471491">,</span>&nbsp;<span class="ident" id="6471493">expected</span>&nbsp;<span class="op" id="6471502">:=</span>&nbsp;<span class="ident" id="6471505">test</span><span class="op" id="6471509">[</span><span class="num" id="6471510">0</span><span class="op" id="6471511">]</span><span class="op" id="6471512">,</span>&nbsp;<span class="ident" id="6471514">test</span><span class="op" id="6471518">[</span><span class="num" id="6471519">1</span><span class="op" id="6471520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6471524">if</span>&nbsp;<span class="ident" id="6471527">result</span>&nbsp;<span class="op" id="6471534">:=</span>&nbsp;<span class="ident" id="6471537">paxHeader</span><span class="op" id="6471546">(</span><span class="ident" id="6471547">key</span><span class="op" id="6471550">)</span><span class="op" id="6471551">;</span>&nbsp;<span class="ident" id="6471553">result</span>&nbsp;<span class="op" id="6471560">!=</span>&nbsp;<span class="ident" id="6471563">expected</span>&nbsp;<span class="op" id="6471572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471577">t</span><span class="op" id="6471578">.</span><span class="ident" id="6471579">Fatalf</span><span class="op" id="6471585">(</span><span class="string" id="6471586">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="6471618">,</span>&nbsp;<span class="ident" id="6471620">result</span><span class="op" id="6471626">,</span>&nbsp;<span class="ident" id="6471628">expected</span><span class="op" id="6471636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471643">}</span><br>
<span class="lineno">420</span><span class="op" id="6471645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6471648">func</span>&nbsp;<span class="ident" id="6471653">TestUSTARLongName</span><span class="op" id="6471670">(</span><span class="ident" id="6471671">t</span>&nbsp;<span class="op" id="6471673">*</span><span class="ident" id="6471674">testing</span><span class="op" id="6471681">.</span><span class="ident" id="6471682">T</span><span class="op" id="6471683">)</span>&nbsp;<span class="op" id="6471685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6471688">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471786">fileinfo</span><span class="op" id="6471794">,</span>&nbsp;<span class="ident" id="6471796">err</span>&nbsp;<span class="op" id="6471800">:=</span>&nbsp;<span class="ident" id="6471803">os</span><span class="op" id="6471805">.</span><span class="ident" id="6471806">Stat</span><span class="op" id="6471810">(</span><span class="string" id="6471811">&#34;testdata/small.txt&#34;</span><span class="op" id="6471831">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6471834">if</span>&nbsp;<span class="ident" id="6471837">err</span>&nbsp;<span class="op" id="6471841">!=</span>&nbsp;<span class="ident" id="6471844">nil</span>&nbsp;<span class="op" id="6471848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471852">t</span><span class="op" id="6471853">.</span><span class="ident" id="6471854">Fatal</span><span class="op" id="6471859">(</span><span class="ident" id="6471860">err</span><span class="op" id="6471863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471869">hdr</span><span class="op" id="6471872">,</span>&nbsp;<span class="ident" id="6471874">err</span>&nbsp;<span class="op" id="6471878">:=</span>&nbsp;<span class="ident" id="6471881">FileInfoHeader</span><span class="op" id="6471895">(</span><span class="ident" id="6471896">fileinfo</span><span class="op" id="6471904">,</span>&nbsp;<span class="string" id="6471906">&#34;&#34;</span><span class="op" id="6471908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471911">hdr</span><span class="op" id="6471914">.</span><span class="ident" id="6471915">Typeflag</span>&nbsp;<span class="op" id="6471924">=</span>&nbsp;<span class="ident" id="6471926">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6471935">if</span>&nbsp;<span class="ident" id="6471938">err</span>&nbsp;<span class="op" id="6471942">!=</span>&nbsp;<span class="ident" id="6471945">nil</span>&nbsp;<span class="op" id="6471949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471953">t</span><span class="op" id="6471954">.</span><span class="ident" id="6471955">Fatalf</span><span class="op" id="6471961">(</span><span class="string" id="6471962">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6471976">,</span>&nbsp;<span class="ident" id="6471978">err</span><span class="op" id="6471981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6471984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6471987">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6472072">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472151">longName</span>&nbsp;<span class="op" id="6472160">:=</span>&nbsp;<span class="string" id="6472163">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472422">hdr</span><span class="op" id="6472425">.</span><span class="ident" id="6472426">Name</span>&nbsp;<span class="op" id="6472431">=</span>&nbsp;<span class="ident" id="6472433">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472444">hdr</span><span class="op" id="6472447">.</span><span class="ident" id="6472448">Size</span>&nbsp;<span class="op" id="6472453">=</span>&nbsp;<span class="num" id="6472455">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6472458">var</span>&nbsp;<span class="ident" id="6472462">buf</span>&nbsp;<span class="ident" id="6472466">bytes</span><span class="op" id="6472471">.</span><span class="ident" id="6472472">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472480">writer</span>&nbsp;<span class="op" id="6472487">:=</span>&nbsp;<span class="ident" id="6472490">NewWriter</span><span class="op" id="6472499">(</span><span class="op" id="6472500">&amp;</span><span class="ident" id="6472501">buf</span><span class="op" id="6472504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6472507">if</span>&nbsp;<span class="ident" id="6472510">err</span>&nbsp;<span class="op" id="6472514">:=</span>&nbsp;<span class="ident" id="6472517">writer</span><span class="op" id="6472523">.</span><span class="ident" id="6472524">WriteHeader</span><span class="op" id="6472535">(</span><span class="ident" id="6472536">hdr</span><span class="op" id="6472539">)</span><span class="op" id="6472540">;</span>&nbsp;<span class="ident" id="6472542">err</span>&nbsp;<span class="op" id="6472546">!=</span>&nbsp;<span class="ident" id="6472549">nil</span>&nbsp;<span class="op" id="6472553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472557">t</span><span class="op" id="6472558">.</span><span class="ident" id="6472559">Fatal</span><span class="op" id="6472564">(</span><span class="ident" id="6472565">err</span><span class="op" id="6472568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6472571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6472574">if</span>&nbsp;<span class="ident" id="6472577">err</span>&nbsp;<span class="op" id="6472581">:=</span>&nbsp;<span class="ident" id="6472584">writer</span><span class="op" id="6472590">.</span><span class="ident" id="6472591">Close</span><span class="op" id="6472596">(</span><span class="op" id="6472597">)</span><span class="op" id="6472598">;</span>&nbsp;<span class="ident" id="6472600">err</span>&nbsp;<span class="op" id="6472604">!=</span>&nbsp;<span class="ident" id="6472607">nil</span>&nbsp;<span class="op" id="6472611">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472615">t</span><span class="op" id="6472616">.</span><span class="ident" id="6472617">Fatal</span><span class="op" id="6472622">(</span><span class="ident" id="6472623">err</span><span class="op" id="6472626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6472629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6472632">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472694">reader</span>&nbsp;<span class="op" id="6472701">:=</span>&nbsp;<span class="ident" id="6472704">NewReader</span><span class="op" id="6472713">(</span><span class="op" id="6472714">&amp;</span><span class="ident" id="6472715">buf</span><span class="op" id="6472718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472721">hdr</span><span class="op" id="6472724">,</span>&nbsp;<span class="ident" id="6472726">err</span>&nbsp;<span class="op" id="6472730">=</span>&nbsp;<span class="ident" id="6472732">reader</span><span class="op" id="6472738">.</span><span class="ident" id="6472739">Next</span><span class="op" id="6472743">(</span><span class="op" id="6472744">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6472747">if</span>&nbsp;<span class="ident" id="6472750">err</span>&nbsp;<span class="op" id="6472754">!=</span>&nbsp;<span class="ident" id="6472757">nil</span>&nbsp;<span class="op" id="6472761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472765">t</span><span class="op" id="6472766">.</span><span class="ident" id="6472767">Fatal</span><span class="op" id="6472772">(</span><span class="ident" id="6472773">err</span><span class="op" id="6472776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6472779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6472782">if</span>&nbsp;<span class="ident" id="6472785">hdr</span><span class="op" id="6472788">.</span><span class="ident" id="6472789">Name</span>&nbsp;<span class="op" id="6472794">!=</span>&nbsp;<span class="ident" id="6472797">longName</span>&nbsp;<span class="op" id="6472806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472810">t</span><span class="op" id="6472811">.</span><span class="ident" id="6472812">Fatal</span><span class="op" id="6472817">(</span><span class="string" id="6472818">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="6472846">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6472849">}</span><br>
<span class="lineno"></span><span class="op" id="6472851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6472854">func</span>&nbsp;<span class="ident" id="6472859">TestValidTypeflagWithPAXHeader</span><span class="op" id="6472889">(</span><span class="ident" id="6472890">t</span>&nbsp;<span class="op" id="6472892">*</span><span class="ident" id="6472893">testing</span><span class="op" id="6472900">.</span><span class="ident" id="6472901">T</span><span class="op" id="6472902">)</span>&nbsp;<span class="op" id="6472904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6472907">var</span>&nbsp;<span class="ident" id="6472911">buffer</span>&nbsp;<span class="ident" id="6472918">bytes</span><span class="op" id="6472923">.</span><span class="ident" id="6472924">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472932">tw</span>&nbsp;<span class="op" id="6472935">:=</span>&nbsp;<span class="ident" id="6472938">NewWriter</span><span class="op" id="6472947">(</span><span class="op" id="6472948">&amp;</span><span class="ident" id="6472949">buffer</span><span class="op" id="6472955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472959">fileName</span>&nbsp;<span class="op" id="6472968">:=</span>&nbsp;<span class="ident" id="6472971">strings</span><span class="op" id="6472978">.</span><span class="ident" id="6472979">Repeat</span><span class="op" id="6472985">(</span><span class="string" id="6472986">&#34;ab&#34;</span><span class="op" id="6472990">,</span>&nbsp;<span class="num" id="6472992">100</span><span class="op" id="6472995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6472999">hdr</span>&nbsp;<span class="op" id="6473003">:=</span>&nbsp;<span class="op" id="6473006">&amp;</span><span class="ident" id="6473007">Header</span><span class="op" id="6473013">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473017">Name</span><span class="op" id="6473021">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473027">fileName</span><span class="op" id="6473035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473039">Size</span><span class="op" id="6473043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6473049">4</span><span class="op" id="6473050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473054">Typeflag</span><span class="op" id="6473062">:</span>&nbsp;<span class="num" id="6473064">0</span><span class="op" id="6473065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473071">if</span>&nbsp;<span class="ident" id="6473074">err</span>&nbsp;<span class="op" id="6473078">:=</span>&nbsp;<span class="ident" id="6473081">tw</span><span class="op" id="6473083">.</span><span class="ident" id="6473084">WriteHeader</span><span class="op" id="6473095">(</span><span class="ident" id="6473096">hdr</span><span class="op" id="6473099">)</span><span class="op" id="6473100">;</span>&nbsp;<span class="ident" id="6473102">err</span>&nbsp;<span class="op" id="6473106">!=</span>&nbsp;<span class="ident" id="6473109">nil</span>&nbsp;<span class="op" id="6473113">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473117">t</span><span class="op" id="6473118">.</span><span class="ident" id="6473119">Fatalf</span><span class="op" id="6473125">(</span><span class="string" id="6473126">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6473154">,</span>&nbsp;<span class="ident" id="6473156">err</span><span class="op" id="6473159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473165">if</span>&nbsp;<span class="ident" id="6473168">_</span><span class="op" id="6473169">,</span>&nbsp;<span class="ident" id="6473171">err</span>&nbsp;<span class="op" id="6473175">:=</span>&nbsp;<span class="ident" id="6473178">tw</span><span class="op" id="6473180">.</span><span class="ident" id="6473181">Write</span><span class="op" id="6473186">(</span><span class="op" id="6473187">[</span><span class="op" id="6473188">]</span><span class="builtintype" id="6473189">byte</span><span class="op" id="6473193">(</span><span class="string" id="6473194">&#34;fooo&#34;</span><span class="op" id="6473200">)</span><span class="op" id="6473201">)</span><span class="op" id="6473202">;</span>&nbsp;<span class="ident" id="6473204">err</span>&nbsp;<span class="op" id="6473208">!=</span>&nbsp;<span class="ident" id="6473211">nil</span>&nbsp;<span class="op" id="6473215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473219">t</span><span class="op" id="6473220">.</span><span class="ident" id="6473221">Fatalf</span><span class="op" id="6473227">(</span><span class="string" id="6473228">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="6473265">,</span>&nbsp;<span class="ident" id="6473267">err</span><span class="op" id="6473270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473273">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473276">tw</span><span class="op" id="6473278">.</span><span class="ident" id="6473279">Close</span><span class="op" id="6473284">(</span><span class="op" id="6473285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473289">tr</span>&nbsp;<span class="op" id="6473292">:=</span>&nbsp;<span class="ident" id="6473295">NewReader</span><span class="op" id="6473304">(</span><span class="op" id="6473305">&amp;</span><span class="ident" id="6473306">buffer</span><span class="op" id="6473312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473316">for</span>&nbsp;<span class="op" id="6473320">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473324">header</span><span class="op" id="6473330">,</span>&nbsp;<span class="ident" id="6473332">err</span>&nbsp;<span class="op" id="6473336">:=</span>&nbsp;<span class="ident" id="6473339">tr</span><span class="op" id="6473341">.</span><span class="ident" id="6473342">Next</span><span class="op" id="6473346">(</span><span class="op" id="6473347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473351">if</span>&nbsp;<span class="ident" id="6473354">err</span>&nbsp;<span class="op" id="6473358">==</span>&nbsp;<span class="ident" id="6473361">io</span><span class="op" id="6473363">.</span><span class="ident" id="6473364">EOF</span>&nbsp;<span class="op" id="6473368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473373">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473385">if</span>&nbsp;<span class="ident" id="6473388">err</span>&nbsp;<span class="op" id="6473392">!=</span>&nbsp;<span class="ident" id="6473395">nil</span>&nbsp;<span class="op" id="6473399">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473404">t</span><span class="op" id="6473405">.</span><span class="ident" id="6473406">Fatalf</span><span class="op" id="6473412">(</span><span class="string" id="6473413">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6473440">,</span>&nbsp;<span class="ident" id="6473442">err</span><span class="op" id="6473445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6473453">if</span>&nbsp;<span class="ident" id="6473456">header</span><span class="op" id="6473462">.</span><span class="ident" id="6473463">Typeflag</span>&nbsp;<span class="op" id="6473472">!=</span>&nbsp;<span class="num" id="6473475">0</span>&nbsp;<span class="op" id="6473477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473482">t</span><span class="op" id="6473483">.</span><span class="ident" id="6473484">Fatalf</span><span class="op" id="6473490">(</span><span class="string" id="6473491">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="6473528">,</span>&nbsp;<span class="ident" id="6473530">header</span><span class="op" id="6473536">.</span><span class="ident" id="6473537">Typeflag</span><span class="op" id="6473545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473549">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473552">}</span><br>
<span class="lineno"></span><span class="op" id="6473554">}</span>
</div>
</body>
</html>
