<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6175159">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6175214">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6175268">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6175319">package</span>&nbsp;<span class="ident" id="6175327">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6175336">import</span>&nbsp;<span class="op" id="6175343">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175346">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175354">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175361">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175367">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175378">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175386">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6175401">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6175408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6175411">var</span>&nbsp;<span class="ident" id="6175415">matchBenchmarks</span>&nbsp;<span class="op" id="6175431">=</span>&nbsp;<span class="ident" id="6175433">flag</span><span class="op" id="6175437">.</span><span class="ident" id="6175438">String</span><span class="op" id="6175444">(</span><span class="string" id="6175445">&#34;test.bench&#34;</span><span class="op" id="6175457">,</span>&nbsp;<span class="string" id="6175459">&#34;&#34;</span><span class="op" id="6175461">,</span>&nbsp;<span class="string" id="6175463">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6175511">)</span><br>
<span class="lineno"></span><span class="keyword" id="6175513">var</span>&nbsp;<span class="ident" id="6175517">benchTime</span>&nbsp;<span class="op" id="6175527">=</span>&nbsp;<span class="ident" id="6175529">flag</span><span class="op" id="6175533">.</span><span class="ident" id="6175534">Duration</span><span class="op" id="6175542">(</span><span class="string" id="6175543">&#34;test.benchtime&#34;</span><span class="op" id="6175559">,</span>&nbsp;<span class="num" id="6175561">1</span><span class="op" id="6175562">*</span><span class="ident" id="6175563">time</span><span class="op" id="6175567">.</span><span class="ident" id="6175568">Second</span><span class="op" id="6175574">,</span>&nbsp;<span class="string" id="6175576">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6175617">)</span><br>
<span class="lineno"></span><span class="keyword" id="6175619">var</span>&nbsp;<span class="ident" id="6175623">benchmarkMemory</span>&nbsp;<span class="op" id="6175639">=</span>&nbsp;<span class="ident" id="6175641">flag</span><span class="op" id="6175645">.</span><span class="ident" id="6175646">Bool</span><span class="op" id="6175650">(</span><span class="string" id="6175651">&#34;test.benchmem&#34;</span><span class="op" id="6175666">,</span>&nbsp;<span class="builtintype" id="6175668">false</span><span class="op" id="6175673">,</span>&nbsp;<span class="string" id="6175675">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6175716">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6175719">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6175779">var</span>&nbsp;<span class="ident" id="6175783">benchmarkLock</span>&nbsp;<span class="ident" id="6175797">sync</span><span class="op" id="6175801">.</span><span class="ident" id="6175802">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6175809">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6175859">var</span>&nbsp;<span class="ident" id="6175863">memStats</span>&nbsp;<span class="ident" id="6175872">runtime</span><span class="op" id="6175879">.</span><span class="ident" id="6175880">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6175890">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6175979">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6176008">type</span>&nbsp;<span class="ident" id="6176013">InternalBenchmark</span>&nbsp;<span class="keyword" id="6176031">struct</span>&nbsp;<span class="op" id="6176038">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176041">Name</span>&nbsp;<span class="builtintype" id="6176046">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176054">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176059">func</span><span class="op" id="6176063">(</span><span class="ident" id="6176064">b</span>&nbsp;<span class="op" id="6176066">*</span><span class="ident" id="6176067">B</span><span class="op" id="6176068">)</span><br>
<span class="lineno"></span><span class="op" id="6176070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6176073">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6176138">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6176196">type</span>&nbsp;<span class="ident" id="6176201">B</span>&nbsp;<span class="keyword" id="6176203">struct</span>&nbsp;<span class="op" id="6176210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176213">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176221">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6176238">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176243">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6176260">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6176274">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176319">previousDuration</span>&nbsp;<span class="ident" id="6176336">time</span><span class="op" id="6176340">.</span><span class="ident" id="6176341">Duration</span>&nbsp;<span class="comment" id="6176350">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176389">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176406">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176425">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176442">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176449">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6176466">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176472">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6176489">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176495">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176512">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176529">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6176546">int</span>&nbsp;<span class="comment" id="6176550">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176608">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176676">startAllocs</span>&nbsp;<span class="ident" id="6176688">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176696">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6176708">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176716">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176764">netAllocs</span>&nbsp;<span class="ident" id="6176774">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176782">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6176792">uint64</span><br>
<span class="lineno"></span><span class="op" id="6176799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6176802">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6176877">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6176951">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6176975">func</span>&nbsp;<span class="op" id="6176980">(</span><span class="ident" id="6176981">b</span>&nbsp;<span class="op" id="6176983">*</span><span class="ident" id="6176984">B</span><span class="op" id="6176985">)</span>&nbsp;<span class="ident" id="6176987">StartTimer</span><span class="op" id="6176997">(</span><span class="op" id="6176998">)</span>&nbsp;<span class="op" id="6177000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6177003">if</span>&nbsp;<span class="op" id="6177006">!</span><span class="ident" id="6177007">b</span><span class="op" id="6177008">.</span><span class="ident" id="6177009">timerOn</span>&nbsp;<span class="op" id="6177017">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177021">runtime</span><span class="op" id="6177028">.</span><span class="ident" id="6177029">ReadMemStats</span><span class="op" id="6177041">(</span><span class="op" id="6177042">&amp;</span><span class="ident" id="6177043">memStats</span><span class="op" id="6177051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177055">b</span><span class="op" id="6177056">.</span><span class="ident" id="6177057">startAllocs</span>&nbsp;<span class="op" id="6177069">=</span>&nbsp;<span class="ident" id="6177071">memStats</span><span class="op" id="6177079">.</span><span class="ident" id="6177080">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177090">b</span><span class="op" id="6177091">.</span><span class="ident" id="6177092">startBytes</span>&nbsp;<span class="op" id="6177103">=</span>&nbsp;<span class="ident" id="6177105">memStats</span><span class="op" id="6177113">.</span><span class="ident" id="6177114">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177127">b</span><span class="op" id="6177128">.</span><span class="ident" id="6177129">start</span>&nbsp;<span class="op" id="6177135">=</span>&nbsp;<span class="ident" id="6177137">time</span><span class="op" id="6177141">.</span><span class="ident" id="6177142">Now</span><span class="op" id="6177145">(</span><span class="op" id="6177146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177150">b</span><span class="op" id="6177151">.</span><span class="ident" id="6177152">timerOn</span>&nbsp;<span class="op" id="6177160">=</span>&nbsp;<span class="builtintype" id="6177162">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6177168">}</span><br>
<span class="lineno"></span><span class="op" id="6177170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6177173">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6177244">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6177302">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6177322">func</span>&nbsp;<span class="op" id="6177327">(</span><span class="ident" id="6177328">b</span>&nbsp;<span class="op" id="6177330">*</span><span class="ident" id="6177331">B</span><span class="op" id="6177332">)</span>&nbsp;<span class="ident" id="6177334">StopTimer</span><span class="op" id="6177343">(</span><span class="op" id="6177344">)</span>&nbsp;<span class="op" id="6177346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6177349">if</span>&nbsp;<span class="ident" id="6177352">b</span><span class="op" id="6177353">.</span><span class="ident" id="6177354">timerOn</span>&nbsp;<span class="op" id="6177362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177366">b</span><span class="op" id="6177367">.</span><span class="ident" id="6177368">duration</span>&nbsp;<span class="op" id="6177377">+=</span>&nbsp;<span class="ident" id="6177380">time</span><span class="op" id="6177384">.</span><span class="ident" id="6177385">Now</span><span class="op" id="6177388">(</span><span class="op" id="6177389">)</span><span class="op" id="6177390">.</span><span class="ident" id="6177391">Sub</span><span class="op" id="6177394">(</span><span class="ident" id="6177395">b</span><span class="op" id="6177396">.</span><span class="ident" id="6177397">start</span><span class="op" id="6177402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177406">runtime</span><span class="op" id="6177413">.</span><span class="ident" id="6177414">ReadMemStats</span><span class="op" id="6177426">(</span><span class="op" id="6177427">&amp;</span><span class="ident" id="6177428">memStats</span><span class="op" id="6177436">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177440">b</span><span class="op" id="6177441">.</span><span class="ident" id="6177442">netAllocs</span>&nbsp;<span class="op" id="6177452">+=</span>&nbsp;<span class="ident" id="6177455">memStats</span><span class="op" id="6177463">.</span><span class="ident" id="6177464">Mallocs</span>&nbsp;<span class="op" id="6177472">-</span>&nbsp;<span class="ident" id="6177474">b</span><span class="op" id="6177475">.</span><span class="ident" id="6177476">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177490">b</span><span class="op" id="6177491">.</span><span class="ident" id="6177492">netBytes</span>&nbsp;<span class="op" id="6177501">+=</span>&nbsp;<span class="ident" id="6177504">memStats</span><span class="op" id="6177512">.</span><span class="ident" id="6177513">TotalAlloc</span>&nbsp;<span class="op" id="6177524">-</span>&nbsp;<span class="ident" id="6177526">b</span><span class="op" id="6177527">.</span><span class="ident" id="6177528">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177541">b</span><span class="op" id="6177542">.</span><span class="ident" id="6177543">timerOn</span>&nbsp;<span class="op" id="6177551">=</span>&nbsp;<span class="builtintype" id="6177553">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6177560">}</span><br>
<span class="lineno"></span><span class="op" id="6177562">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6177565">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6177644">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6177696">func</span>&nbsp;<span class="op" id="6177701">(</span><span class="ident" id="6177702">b</span>&nbsp;<span class="op" id="6177704">*</span><span class="ident" id="6177705">B</span><span class="op" id="6177706">)</span>&nbsp;<span class="ident" id="6177708">ResetTimer</span><span class="op" id="6177718">(</span><span class="op" id="6177719">)</span>&nbsp;<span class="op" id="6177721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6177724">if</span>&nbsp;<span class="ident" id="6177727">b</span><span class="op" id="6177728">.</span><span class="ident" id="6177729">timerOn</span>&nbsp;<span class="op" id="6177737">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177741">runtime</span><span class="op" id="6177748">.</span><span class="ident" id="6177749">ReadMemStats</span><span class="op" id="6177761">(</span><span class="op" id="6177762">&amp;</span><span class="ident" id="6177763">memStats</span><span class="op" id="6177771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177775">b</span><span class="op" id="6177776">.</span><span class="ident" id="6177777">startAllocs</span>&nbsp;<span class="op" id="6177789">=</span>&nbsp;<span class="ident" id="6177791">memStats</span><span class="op" id="6177799">.</span><span class="ident" id="6177800">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177810">b</span><span class="op" id="6177811">.</span><span class="ident" id="6177812">startBytes</span>&nbsp;<span class="op" id="6177823">=</span>&nbsp;<span class="ident" id="6177825">memStats</span><span class="op" id="6177833">.</span><span class="ident" id="6177834">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177847">b</span><span class="op" id="6177848">.</span><span class="ident" id="6177849">start</span>&nbsp;<span class="op" id="6177855">=</span>&nbsp;<span class="ident" id="6177857">time</span><span class="op" id="6177861">.</span><span class="ident" id="6177862">Now</span><span class="op" id="6177865">(</span><span class="op" id="6177866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6177869">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177872">b</span><span class="op" id="6177873">.</span><span class="ident" id="6177874">duration</span>&nbsp;<span class="op" id="6177883">=</span>&nbsp;<span class="num" id="6177885">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177888">b</span><span class="op" id="6177889">.</span><span class="ident" id="6177890">netAllocs</span>&nbsp;<span class="op" id="6177900">=</span>&nbsp;<span class="num" id="6177902">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177905">b</span><span class="op" id="6177906">.</span><span class="ident" id="6177907">netBytes</span>&nbsp;<span class="op" id="6177916">=</span>&nbsp;<span class="num" id="6177918">0</span><br>
<span class="lineno"></span><span class="op" id="6177920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6177923">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6177996">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6178060">func</span>&nbsp;<span class="op" id="6178065">(</span><span class="ident" id="6178066">b</span>&nbsp;<span class="op" id="6178068">*</span><span class="ident" id="6178069">B</span><span class="op" id="6178070">)</span>&nbsp;<span class="ident" id="6178072">SetBytes</span><span class="op" id="6178080">(</span><span class="ident" id="6178081">n</span>&nbsp;<span class="ident" id="6178083">int64</span><span class="op" id="6178088">)</span>&nbsp;<span class="op" id="6178090">{</span>&nbsp;<span class="ident" id="6178092">b</span><span class="op" id="6178093">.</span><span class="ident" id="6178094">bytes</span>&nbsp;<span class="op" id="6178100">=</span>&nbsp;<span class="ident" id="6178102">n</span>&nbsp;<span class="op" id="6178104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6178107">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6178169">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6178240">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6178287">func</span>&nbsp;<span class="op" id="6178292">(</span><span class="ident" id="6178293">b</span>&nbsp;<span class="op" id="6178295">*</span><span class="ident" id="6178296">B</span><span class="op" id="6178297">)</span>&nbsp;<span class="ident" id="6178299">ReportAllocs</span><span class="op" id="6178311">(</span><span class="op" id="6178312">)</span>&nbsp;<span class="op" id="6178314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178317">b</span><span class="op" id="6178318">.</span><span class="ident" id="6178319">showAllocResult</span>&nbsp;<span class="op" id="6178335">=</span>&nbsp;<span class="builtintype" id="6178337">true</span><br>
<span class="lineno"></span><span class="op" id="6178342">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6178345">func</span>&nbsp;<span class="op" id="6178350">(</span><span class="ident" id="6178351">b</span>&nbsp;<span class="op" id="6178353">*</span><span class="ident" id="6178354">B</span><span class="op" id="6178355">)</span>&nbsp;<span class="ident" id="6178357">nsPerOp</span><span class="op" id="6178364">(</span><span class="op" id="6178365">)</span>&nbsp;<span class="ident" id="6178367">int64</span>&nbsp;<span class="op" id="6178373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178376">if</span>&nbsp;<span class="ident" id="6178379">b</span><span class="op" id="6178380">.</span><span class="ident" id="6178381">N</span>&nbsp;<span class="op" id="6178383">&lt;=</span>&nbsp;<span class="num" id="6178386">0</span>&nbsp;<span class="op" id="6178388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178392">return</span>&nbsp;<span class="num" id="6178399">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178402">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178405">return</span>&nbsp;<span class="ident" id="6178412">b</span><span class="op" id="6178413">.</span><span class="ident" id="6178414">duration</span><span class="op" id="6178422">.</span><span class="ident" id="6178423">Nanoseconds</span><span class="op" id="6178434">(</span><span class="op" id="6178435">)</span>&nbsp;<span class="op" id="6178437">/</span>&nbsp;<span class="ident" id="6178439">int64</span><span class="op" id="6178444">(</span><span class="ident" id="6178445">b</span><span class="op" id="6178446">.</span><span class="ident" id="6178447">N</span><span class="op" id="6178448">)</span><br>
<span class="lineno"></span><span class="op" id="6178450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6178453">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6178525">func</span>&nbsp;<span class="op" id="6178530">(</span><span class="ident" id="6178531">b</span>&nbsp;<span class="op" id="6178533">*</span><span class="ident" id="6178534">B</span><span class="op" id="6178535">)</span>&nbsp;<span class="ident" id="6178537">runN</span><span class="op" id="6178541">(</span><span class="ident" id="6178542">n</span>&nbsp;<span class="builtintype" id="6178544">int</span><span class="op" id="6178547">)</span>&nbsp;<span class="op" id="6178549">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178552">benchmarkLock</span><span class="op" id="6178565">.</span><span class="ident" id="6178566">Lock</span><span class="op" id="6178570">(</span><span class="op" id="6178571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178574">defer</span>&nbsp;<span class="ident" id="6178580">benchmarkLock</span><span class="op" id="6178593">.</span><span class="ident" id="6178594">Unlock</span><span class="op" id="6178600">(</span><span class="op" id="6178601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6178604">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6178657">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178701">runtime</span><span class="op" id="6178708">.</span><span class="ident" id="6178709">GC</span><span class="op" id="6178711">(</span><span class="op" id="6178712">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178715">b</span><span class="op" id="6178716">.</span><span class="ident" id="6178717">N</span>&nbsp;<span class="op" id="6178719">=</span>&nbsp;<span class="ident" id="6178721">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178724">b</span><span class="op" id="6178725">.</span><span class="ident" id="6178726">parallelism</span>&nbsp;<span class="op" id="6178738">=</span>&nbsp;<span class="num" id="6178740">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178743">b</span><span class="op" id="6178744">.</span><span class="ident" id="6178745">ResetTimer</span><span class="op" id="6178755">(</span><span class="op" id="6178756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178759">b</span><span class="op" id="6178760">.</span><span class="ident" id="6178761">StartTimer</span><span class="op" id="6178771">(</span><span class="op" id="6178772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178775">b</span><span class="op" id="6178776">.</span><span class="ident" id="6178777">benchmark</span><span class="op" id="6178786">.</span><span class="ident" id="6178787">F</span><span class="op" id="6178788">(</span><span class="ident" id="6178789">b</span><span class="op" id="6178790">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178793">b</span><span class="op" id="6178794">.</span><span class="ident" id="6178795">StopTimer</span><span class="op" id="6178804">(</span><span class="op" id="6178805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178808">b</span><span class="op" id="6178809">.</span><span class="ident" id="6178810">previousN</span>&nbsp;<span class="op" id="6178820">=</span>&nbsp;<span class="ident" id="6178822">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6178825">b</span><span class="op" id="6178826">.</span><span class="ident" id="6178827">previousDuration</span>&nbsp;<span class="op" id="6178844">=</span>&nbsp;<span class="ident" id="6178846">b</span><span class="op" id="6178847">.</span><span class="ident" id="6178848">duration</span><br>
<span class="lineno"></span><span class="op" id="6178857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6178860">func</span>&nbsp;<span class="ident" id="6178865">min</span><span class="op" id="6178868">(</span><span class="ident" id="6178869">x</span><span class="op" id="6178870">,</span>&nbsp;<span class="ident" id="6178872">y</span>&nbsp;<span class="builtintype" id="6178874">int</span><span class="op" id="6178877">)</span>&nbsp;<span class="builtintype" id="6178879">int</span>&nbsp;<span class="op" id="6178883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178886">if</span>&nbsp;<span class="ident" id="6178889">x</span>&nbsp;<span class="op" id="6178891">&gt;</span>&nbsp;<span class="ident" id="6178893">y</span>&nbsp;<span class="op" id="6178895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178899">return</span>&nbsp;<span class="ident" id="6178906">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178912">return</span>&nbsp;<span class="ident" id="6178919">x</span><br>
<span class="lineno">135</span><span class="op" id="6178921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6178924">func</span>&nbsp;<span class="ident" id="6178929">max</span><span class="op" id="6178932">(</span><span class="ident" id="6178933">x</span><span class="op" id="6178934">,</span>&nbsp;<span class="ident" id="6178936">y</span>&nbsp;<span class="builtintype" id="6178938">int</span><span class="op" id="6178941">)</span>&nbsp;<span class="builtintype" id="6178943">int</span>&nbsp;<span class="op" id="6178947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178950">if</span>&nbsp;<span class="ident" id="6178953">x</span>&nbsp;<span class="op" id="6178955">&lt;</span>&nbsp;<span class="ident" id="6178957">y</span>&nbsp;<span class="op" id="6178959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178963">return</span>&nbsp;<span class="ident" id="6178970">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178976">return</span>&nbsp;<span class="ident" id="6178983">x</span><br>
<span class="lineno"></span><span class="op" id="6178985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6178988">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6179052">func</span>&nbsp;<span class="ident" id="6179057">roundDown10</span><span class="op" id="6179068">(</span><span class="ident" id="6179069">n</span>&nbsp;<span class="builtintype" id="6179071">int</span><span class="op" id="6179074">)</span>&nbsp;<span class="builtintype" id="6179076">int</span>&nbsp;<span class="op" id="6179080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179083">var</span>&nbsp;<span class="ident" id="6179087">tens</span>&nbsp;<span class="op" id="6179092">=</span>&nbsp;<span class="num" id="6179094">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6179097">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179125">for</span>&nbsp;<span class="ident" id="6179129">n</span>&nbsp;<span class="op" id="6179131">&gt;=</span>&nbsp;<span class="num" id="6179134">10</span>&nbsp;<span class="op" id="6179137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179141">n</span>&nbsp;<span class="op" id="6179143">=</span>&nbsp;<span class="ident" id="6179145">n</span>&nbsp;<span class="op" id="6179147">/</span>&nbsp;<span class="num" id="6179149">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179154">tens</span><span class="op" id="6179158">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6179165">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179186">result</span>&nbsp;<span class="op" id="6179193">:=</span>&nbsp;<span class="num" id="6179196">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179199">for</span>&nbsp;<span class="ident" id="6179203">i</span>&nbsp;<span class="op" id="6179205">:=</span>&nbsp;<span class="num" id="6179208">0</span><span class="op" id="6179209">;</span>&nbsp;<span class="ident" id="6179211">i</span>&nbsp;<span class="op" id="6179213">&lt;</span>&nbsp;<span class="ident" id="6179215">tens</span><span class="op" id="6179219">;</span>&nbsp;<span class="ident" id="6179221">i</span><span class="op" id="6179222">++</span>&nbsp;<span class="op" id="6179225">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179229">result</span>&nbsp;<span class="op" id="6179236">*=</span>&nbsp;<span class="num" id="6179239">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179246">return</span>&nbsp;<span class="ident" id="6179253">result</span><br>
<span class="lineno"></span><span class="op" id="6179260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6179263">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6179332">func</span>&nbsp;<span class="ident" id="6179337">roundUp</span><span class="op" id="6179344">(</span><span class="ident" id="6179345">n</span>&nbsp;<span class="builtintype" id="6179347">int</span><span class="op" id="6179350">)</span>&nbsp;<span class="builtintype" id="6179352">int</span>&nbsp;<span class="op" id="6179356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179359">base</span>&nbsp;<span class="op" id="6179364">:=</span>&nbsp;<span class="ident" id="6179367">roundDown10</span><span class="op" id="6179378">(</span><span class="ident" id="6179379">n</span><span class="op" id="6179380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179383">switch</span>&nbsp;<span class="op" id="6179390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179393">case</span>&nbsp;<span class="ident" id="6179398">n</span>&nbsp;<span class="op" id="6179400">&lt;=</span>&nbsp;<span class="ident" id="6179403">base</span><span class="op" id="6179407">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179411">return</span>&nbsp;<span class="ident" id="6179418">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179424">case</span>&nbsp;<span class="ident" id="6179429">n</span>&nbsp;<span class="op" id="6179431">&lt;=</span>&nbsp;<span class="op" id="6179434">(</span><span class="num" id="6179435">2</span>&nbsp;<span class="op" id="6179437">*</span>&nbsp;<span class="ident" id="6179439">base</span><span class="op" id="6179443">)</span><span class="op" id="6179444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179448">return</span>&nbsp;<span class="num" id="6179455">2</span>&nbsp;<span class="op" id="6179457">*</span>&nbsp;<span class="ident" id="6179459">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179465">case</span>&nbsp;<span class="ident" id="6179470">n</span>&nbsp;<span class="op" id="6179472">&lt;=</span>&nbsp;<span class="op" id="6179475">(</span><span class="num" id="6179476">3</span>&nbsp;<span class="op" id="6179478">*</span>&nbsp;<span class="ident" id="6179480">base</span><span class="op" id="6179484">)</span><span class="op" id="6179485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179489">return</span>&nbsp;<span class="num" id="6179496">3</span>&nbsp;<span class="op" id="6179498">*</span>&nbsp;<span class="ident" id="6179500">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179506">case</span>&nbsp;<span class="ident" id="6179511">n</span>&nbsp;<span class="op" id="6179513">&lt;=</span>&nbsp;<span class="op" id="6179516">(</span><span class="num" id="6179517">5</span>&nbsp;<span class="op" id="6179519">*</span>&nbsp;<span class="ident" id="6179521">base</span><span class="op" id="6179525">)</span><span class="op" id="6179526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179530">return</span>&nbsp;<span class="num" id="6179537">5</span>&nbsp;<span class="op" id="6179539">*</span>&nbsp;<span class="ident" id="6179541">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179547">default</span><span class="op" id="6179554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179558">return</span>&nbsp;<span class="num" id="6179565">10</span>&nbsp;<span class="op" id="6179568">*</span>&nbsp;<span class="ident" id="6179570">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179576">}</span><br>
<span class="lineno">175</span><span class="op" id="6179578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6179581">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6179642">func</span>&nbsp;<span class="op" id="6179647">(</span><span class="ident" id="6179648">b</span>&nbsp;<span class="op" id="6179650">*</span><span class="ident" id="6179651">B</span><span class="op" id="6179652">)</span>&nbsp;<span class="ident" id="6179654">run</span><span class="op" id="6179657">(</span><span class="op" id="6179658">)</span>&nbsp;<span class="ident" id="6179660">BenchmarkResult</span>&nbsp;<span class="op" id="6179676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179679">go</span>&nbsp;<span class="ident" id="6179682">b</span><span class="op" id="6179683">.</span><span class="ident" id="6179684">launch</span><span class="op" id="6179690">(</span><span class="op" id="6179691">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179694">&lt;-</span><span class="ident" id="6179696">b</span><span class="op" id="6179697">.</span><span class="ident" id="6179698">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179706">return</span>&nbsp;<span class="ident" id="6179713">b</span><span class="op" id="6179714">.</span><span class="ident" id="6179715">result</span><br>
<span class="lineno"></span><span class="op" id="6179722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6179725">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6179803">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6179884">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6179929">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6179973">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6180035">func</span>&nbsp;<span class="op" id="6180040">(</span><span class="ident" id="6180041">b</span>&nbsp;<span class="op" id="6180043">*</span><span class="ident" id="6180044">B</span><span class="op" id="6180045">)</span>&nbsp;<span class="ident" id="6180047">launch</span><span class="op" id="6180053">(</span><span class="op" id="6180054">)</span>&nbsp;<span class="op" id="6180056">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180059">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180128">n</span>&nbsp;<span class="op" id="6180130">:=</span>&nbsp;<span class="num" id="6180133">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180137">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180191">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180227">defer</span>&nbsp;<span class="keyword" id="6180233">func</span><span class="op" id="6180237">(</span><span class="op" id="6180238">)</span>&nbsp;<span class="op" id="6180240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180244">b</span><span class="op" id="6180245">.</span><span class="ident" id="6180246">signal</span>&nbsp;<span class="op" id="6180253">&lt;-</span>&nbsp;<span class="ident" id="6180256">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180259">}</span><span class="op" id="6180260">(</span><span class="op" id="6180261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180265">b</span><span class="op" id="6180266">.</span><span class="ident" id="6180267">runN</span><span class="op" id="6180271">(</span><span class="ident" id="6180272">n</span><span class="op" id="6180273">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180276">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180341">d</span>&nbsp;<span class="op" id="6180343">:=</span>&nbsp;<span class="op" id="6180346">*</span><span class="ident" id="6180347">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180358">for</span>&nbsp;<span class="op" id="6180362">!</span><span class="ident" id="6180363">b</span><span class="op" id="6180364">.</span><span class="ident" id="6180365">failed</span>&nbsp;<span class="op" id="6180372">&amp;&amp;</span>&nbsp;<span class="ident" id="6180375">b</span><span class="op" id="6180376">.</span><span class="ident" id="6180377">duration</span>&nbsp;<span class="op" id="6180386">&lt;</span>&nbsp;<span class="ident" id="6180388">d</span>&nbsp;<span class="op" id="6180390">&amp;&amp;</span>&nbsp;<span class="ident" id="6180393">n</span>&nbsp;<span class="op" id="6180395">&lt;</span>&nbsp;<span class="num" id="6180397">1e9</span>&nbsp;<span class="op" id="6180401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180405">last</span>&nbsp;<span class="op" id="6180410">:=</span>&nbsp;<span class="ident" id="6180413">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180417">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180451">if</span>&nbsp;<span class="ident" id="6180454">b</span><span class="op" id="6180455">.</span><span class="ident" id="6180456">nsPerOp</span><span class="op" id="6180463">(</span><span class="op" id="6180464">)</span>&nbsp;<span class="op" id="6180466">==</span>&nbsp;<span class="num" id="6180469">0</span>&nbsp;<span class="op" id="6180471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180476">n</span>&nbsp;<span class="op" id="6180478">=</span>&nbsp;<span class="num" id="6180480">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180486">}</span>&nbsp;<span class="keyword" id="6180488">else</span>&nbsp;<span class="op" id="6180493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180498">n</span>&nbsp;<span class="op" id="6180500">=</span>&nbsp;<span class="builtintype" id="6180502">int</span><span class="op" id="6180505">(</span><span class="ident" id="6180506">d</span><span class="op" id="6180507">.</span><span class="ident" id="6180508">Nanoseconds</span><span class="op" id="6180519">(</span><span class="op" id="6180520">)</span>&nbsp;<span class="op" id="6180522">/</span>&nbsp;<span class="ident" id="6180524">b</span><span class="op" id="6180525">.</span><span class="ident" id="6180526">nsPerOp</span><span class="op" id="6180533">(</span><span class="op" id="6180534">)</span><span class="op" id="6180535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180539">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180543">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180601">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180667">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180721">n</span>&nbsp;<span class="op" id="6180723">=</span>&nbsp;<span class="ident" id="6180725">max</span><span class="op" id="6180728">(</span><span class="ident" id="6180729">min</span><span class="op" id="6180732">(</span><span class="ident" id="6180733">n</span><span class="op" id="6180734">+</span><span class="ident" id="6180735">n</span><span class="op" id="6180736">/</span><span class="num" id="6180737">5</span><span class="op" id="6180738">,</span>&nbsp;<span class="num" id="6180740">100</span><span class="op" id="6180743">*</span><span class="ident" id="6180744">last</span><span class="op" id="6180748">)</span><span class="op" id="6180749">,</span>&nbsp;<span class="ident" id="6180751">last</span><span class="op" id="6180755">+</span><span class="num" id="6180756">1</span><span class="op" id="6180757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6180761">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180802">n</span>&nbsp;<span class="op" id="6180804">=</span>&nbsp;<span class="ident" id="6180806">roundUp</span><span class="op" id="6180813">(</span><span class="ident" id="6180814">n</span><span class="op" id="6180815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180819">b</span><span class="op" id="6180820">.</span><span class="ident" id="6180821">runN</span><span class="op" id="6180825">(</span><span class="ident" id="6180826">n</span><span class="op" id="6180827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180833">b</span><span class="op" id="6180834">.</span><span class="ident" id="6180835">result</span>&nbsp;<span class="op" id="6180842">=</span>&nbsp;<span class="ident" id="6180844">BenchmarkResult</span><span class="op" id="6180859">{</span><span class="ident" id="6180860">b</span><span class="op" id="6180861">.</span><span class="ident" id="6180862">N</span><span class="op" id="6180863">,</span>&nbsp;<span class="ident" id="6180865">b</span><span class="op" id="6180866">.</span><span class="ident" id="6180867">duration</span><span class="op" id="6180875">,</span>&nbsp;<span class="ident" id="6180877">b</span><span class="op" id="6180878">.</span><span class="ident" id="6180879">bytes</span><span class="op" id="6180884">,</span>&nbsp;<span class="ident" id="6180886">b</span><span class="op" id="6180887">.</span><span class="ident" id="6180888">netAllocs</span><span class="op" id="6180897">,</span>&nbsp;<span class="ident" id="6180899">b</span><span class="op" id="6180900">.</span><span class="ident" id="6180901">netBytes</span><span class="op" id="6180909">}</span><br>
<span class="lineno"></span><span class="op" id="6180911">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6180914">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6180949">type</span>&nbsp;<span class="ident" id="6180954">BenchmarkResult</span>&nbsp;<span class="keyword" id="6180970">struct</span>&nbsp;<span class="op" id="6180977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180980">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6180990">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6181004">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181034">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181044">time</span><span class="op" id="6181048">.</span><span class="ident" id="6181049">Duration</span>&nbsp;<span class="comment" id="6181058">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181084">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181094">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6181108">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181146">MemAllocs</span>&nbsp;<span class="ident" id="6181156">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6181170">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181214">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6181224">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6181238">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6181278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6181281">func</span>&nbsp;<span class="op" id="6181286">(</span><span class="ident" id="6181287">r</span>&nbsp;<span class="ident" id="6181289">BenchmarkResult</span><span class="op" id="6181304">)</span>&nbsp;<span class="ident" id="6181306">NsPerOp</span><span class="op" id="6181313">(</span><span class="op" id="6181314">)</span>&nbsp;<span class="ident" id="6181316">int64</span>&nbsp;<span class="op" id="6181322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181325">if</span>&nbsp;<span class="ident" id="6181328">r</span><span class="op" id="6181329">.</span><span class="ident" id="6181330">N</span>&nbsp;<span class="op" id="6181332">&lt;=</span>&nbsp;<span class="num" id="6181335">0</span>&nbsp;<span class="op" id="6181337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181341">return</span>&nbsp;<span class="num" id="6181348">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181354">return</span>&nbsp;<span class="ident" id="6181361">r</span><span class="op" id="6181362">.</span><span class="ident" id="6181363">T</span><span class="op" id="6181364">.</span><span class="ident" id="6181365">Nanoseconds</span><span class="op" id="6181376">(</span><span class="op" id="6181377">)</span>&nbsp;<span class="op" id="6181379">/</span>&nbsp;<span class="ident" id="6181381">int64</span><span class="op" id="6181386">(</span><span class="ident" id="6181387">r</span><span class="op" id="6181388">.</span><span class="ident" id="6181389">N</span><span class="op" id="6181390">)</span><br>
<span class="lineno">235</span><span class="op" id="6181392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6181395">func</span>&nbsp;<span class="op" id="6181400">(</span><span class="ident" id="6181401">r</span>&nbsp;<span class="ident" id="6181403">BenchmarkResult</span><span class="op" id="6181418">)</span>&nbsp;<span class="ident" id="6181420">mbPerSec</span><span class="op" id="6181428">(</span><span class="op" id="6181429">)</span>&nbsp;<span class="builtintype" id="6181431">float64</span>&nbsp;<span class="op" id="6181439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181442">if</span>&nbsp;<span class="ident" id="6181445">r</span><span class="op" id="6181446">.</span><span class="ident" id="6181447">Bytes</span>&nbsp;<span class="op" id="6181453">&lt;=</span>&nbsp;<span class="num" id="6181456">0</span>&nbsp;<span class="op" id="6181458">||</span>&nbsp;<span class="ident" id="6181461">r</span><span class="op" id="6181462">.</span><span class="ident" id="6181463">T</span>&nbsp;<span class="op" id="6181465">&lt;=</span>&nbsp;<span class="num" id="6181468">0</span>&nbsp;<span class="op" id="6181470">||</span>&nbsp;<span class="ident" id="6181473">r</span><span class="op" id="6181474">.</span><span class="ident" id="6181475">N</span>&nbsp;<span class="op" id="6181477">&lt;=</span>&nbsp;<span class="num" id="6181480">0</span>&nbsp;<span class="op" id="6181482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181486">return</span>&nbsp;<span class="num" id="6181493">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181499">return</span>&nbsp;<span class="op" id="6181506">(</span><span class="builtintype" id="6181507">float64</span><span class="op" id="6181514">(</span><span class="ident" id="6181515">r</span><span class="op" id="6181516">.</span><span class="ident" id="6181517">Bytes</span><span class="op" id="6181522">)</span>&nbsp;<span class="op" id="6181524">*</span>&nbsp;<span class="builtintype" id="6181526">float64</span><span class="op" id="6181533">(</span><span class="ident" id="6181534">r</span><span class="op" id="6181535">.</span><span class="ident" id="6181536">N</span><span class="op" id="6181537">)</span>&nbsp;<span class="op" id="6181539">/</span>&nbsp;<span class="num" id="6181541">1e6</span><span class="op" id="6181544">)</span>&nbsp;<span class="op" id="6181546">/</span>&nbsp;<span class="ident" id="6181548">r</span><span class="op" id="6181549">.</span><span class="ident" id="6181550">T</span><span class="op" id="6181551">.</span><span class="ident" id="6181552">Seconds</span><span class="op" id="6181559">(</span><span class="op" id="6181560">)</span><br>
<span class="lineno"></span><span class="op" id="6181562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6181565">func</span>&nbsp;<span class="op" id="6181570">(</span><span class="ident" id="6181571">r</span>&nbsp;<span class="ident" id="6181573">BenchmarkResult</span><span class="op" id="6181588">)</span>&nbsp;<span class="ident" id="6181590">AllocsPerOp</span><span class="op" id="6181601">(</span><span class="op" id="6181602">)</span>&nbsp;<span class="ident" id="6181604">int64</span>&nbsp;<span class="op" id="6181610">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181613">if</span>&nbsp;<span class="ident" id="6181616">r</span><span class="op" id="6181617">.</span><span class="ident" id="6181618">N</span>&nbsp;<span class="op" id="6181620">&lt;=</span>&nbsp;<span class="num" id="6181623">0</span>&nbsp;<span class="op" id="6181625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181629">return</span>&nbsp;<span class="num" id="6181636">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181642">return</span>&nbsp;<span class="ident" id="6181649">int64</span><span class="op" id="6181654">(</span><span class="ident" id="6181655">r</span><span class="op" id="6181656">.</span><span class="ident" id="6181657">MemAllocs</span><span class="op" id="6181666">)</span>&nbsp;<span class="op" id="6181668">/</span>&nbsp;<span class="ident" id="6181670">int64</span><span class="op" id="6181675">(</span><span class="ident" id="6181676">r</span><span class="op" id="6181677">.</span><span class="ident" id="6181678">N</span><span class="op" id="6181679">)</span><br>
<span class="lineno"></span><span class="op" id="6181681">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6181684">func</span>&nbsp;<span class="op" id="6181689">(</span><span class="ident" id="6181690">r</span>&nbsp;<span class="ident" id="6181692">BenchmarkResult</span><span class="op" id="6181707">)</span>&nbsp;<span class="ident" id="6181709">AllocedBytesPerOp</span><span class="op" id="6181726">(</span><span class="op" id="6181727">)</span>&nbsp;<span class="ident" id="6181729">int64</span>&nbsp;<span class="op" id="6181735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181738">if</span>&nbsp;<span class="ident" id="6181741">r</span><span class="op" id="6181742">.</span><span class="ident" id="6181743">N</span>&nbsp;<span class="op" id="6181745">&lt;=</span>&nbsp;<span class="num" id="6181748">0</span>&nbsp;<span class="op" id="6181750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181754">return</span>&nbsp;<span class="num" id="6181761">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181764">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181767">return</span>&nbsp;<span class="ident" id="6181774">int64</span><span class="op" id="6181779">(</span><span class="ident" id="6181780">r</span><span class="op" id="6181781">.</span><span class="ident" id="6181782">MemBytes</span><span class="op" id="6181790">)</span>&nbsp;<span class="op" id="6181792">/</span>&nbsp;<span class="ident" id="6181794">int64</span><span class="op" id="6181799">(</span><span class="ident" id="6181800">r</span><span class="op" id="6181801">.</span><span class="ident" id="6181802">N</span><span class="op" id="6181803">)</span><br>
<span class="lineno"></span><span class="op" id="6181805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6181808">func</span>&nbsp;<span class="op" id="6181813">(</span><span class="ident" id="6181814">r</span>&nbsp;<span class="ident" id="6181816">BenchmarkResult</span><span class="op" id="6181831">)</span>&nbsp;<span class="ident" id="6181833">String</span><span class="op" id="6181839">(</span><span class="op" id="6181840">)</span>&nbsp;<span class="builtintype" id="6181842">string</span>&nbsp;<span class="op" id="6181849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181852">mbs</span>&nbsp;<span class="op" id="6181856">:=</span>&nbsp;<span class="ident" id="6181859">r</span><span class="op" id="6181860">.</span><span class="ident" id="6181861">mbPerSec</span><span class="op" id="6181869">(</span><span class="op" id="6181870">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181873">mb</span>&nbsp;<span class="op" id="6181876">:=</span>&nbsp;<span class="string" id="6181879">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181883">if</span>&nbsp;<span class="ident" id="6181886">mbs</span>&nbsp;<span class="op" id="6181890">!=</span>&nbsp;<span class="num" id="6181893">0</span>&nbsp;<span class="op" id="6181895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181899">mb</span>&nbsp;<span class="op" id="6181902">=</span>&nbsp;<span class="ident" id="6181904">fmt</span><span class="op" id="6181907">.</span><span class="ident" id="6181908">Sprintf</span><span class="op" id="6181915">(</span><span class="string" id="6181916">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6181930">,</span>&nbsp;<span class="ident" id="6181932">mbs</span><span class="op" id="6181935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181941">nsop</span>&nbsp;<span class="op" id="6181946">:=</span>&nbsp;<span class="ident" id="6181949">r</span><span class="op" id="6181950">.</span><span class="ident" id="6181951">NsPerOp</span><span class="op" id="6181958">(</span><span class="op" id="6181959">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181962">ns</span>&nbsp;<span class="op" id="6181965">:=</span>&nbsp;<span class="ident" id="6181968">fmt</span><span class="op" id="6181971">.</span><span class="ident" id="6181972">Sprintf</span><span class="op" id="6181979">(</span><span class="string" id="6181980">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6181992">,</span>&nbsp;<span class="ident" id="6181994">nsop</span><span class="op" id="6181998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182001">if</span>&nbsp;<span class="ident" id="6182004">r</span><span class="op" id="6182005">.</span><span class="ident" id="6182006">N</span>&nbsp;<span class="op" id="6182008">&gt;</span>&nbsp;<span class="num" id="6182010">0</span>&nbsp;<span class="op" id="6182012">&amp;&amp;</span>&nbsp;<span class="ident" id="6182015">nsop</span>&nbsp;<span class="op" id="6182020">&lt;</span>&nbsp;<span class="num" id="6182022">100</span>&nbsp;<span class="op" id="6182026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6182030">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6182077">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182138">if</span>&nbsp;<span class="ident" id="6182141">nsop</span>&nbsp;<span class="op" id="6182146">&lt;</span>&nbsp;<span class="num" id="6182148">10</span>&nbsp;<span class="op" id="6182151">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182156">ns</span>&nbsp;<span class="op" id="6182159">=</span>&nbsp;<span class="ident" id="6182161">fmt</span><span class="op" id="6182164">.</span><span class="ident" id="6182165">Sprintf</span><span class="op" id="6182172">(</span><span class="string" id="6182173">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6182187">,</span>&nbsp;<span class="builtintype" id="6182189">float64</span><span class="op" id="6182196">(</span><span class="ident" id="6182197">r</span><span class="op" id="6182198">.</span><span class="ident" id="6182199">T</span><span class="op" id="6182200">.</span><span class="ident" id="6182201">Nanoseconds</span><span class="op" id="6182212">(</span><span class="op" id="6182213">)</span><span class="op" id="6182214">)</span><span class="op" id="6182215">/</span><span class="builtintype" id="6182216">float64</span><span class="op" id="6182223">(</span><span class="ident" id="6182224">r</span><span class="op" id="6182225">.</span><span class="ident" id="6182226">N</span><span class="op" id="6182227">)</span><span class="op" id="6182228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182232">}</span>&nbsp;<span class="keyword" id="6182234">else</span>&nbsp;<span class="op" id="6182239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182244">ns</span>&nbsp;<span class="op" id="6182247">=</span>&nbsp;<span class="ident" id="6182249">fmt</span><span class="op" id="6182252">.</span><span class="ident" id="6182253">Sprintf</span><span class="op" id="6182260">(</span><span class="string" id="6182261">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6182275">,</span>&nbsp;<span class="builtintype" id="6182277">float64</span><span class="op" id="6182284">(</span><span class="ident" id="6182285">r</span><span class="op" id="6182286">.</span><span class="ident" id="6182287">T</span><span class="op" id="6182288">.</span><span class="ident" id="6182289">Nanoseconds</span><span class="op" id="6182300">(</span><span class="op" id="6182301">)</span><span class="op" id="6182302">)</span><span class="op" id="6182303">/</span><span class="builtintype" id="6182304">float64</span><span class="op" id="6182311">(</span><span class="ident" id="6182312">r</span><span class="op" id="6182313">.</span><span class="ident" id="6182314">N</span><span class="op" id="6182315">)</span><span class="op" id="6182316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182323">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182326">return</span>&nbsp;<span class="ident" id="6182333">fmt</span><span class="op" id="6182336">.</span><span class="ident" id="6182337">Sprintf</span><span class="op" id="6182344">(</span><span class="string" id="6182345">&#34;%8d\t%s%s&#34;</span><span class="op" id="6182356">,</span>&nbsp;<span class="ident" id="6182358">r</span><span class="op" id="6182359">.</span><span class="ident" id="6182360">N</span><span class="op" id="6182361">,</span>&nbsp;<span class="ident" id="6182363">ns</span><span class="op" id="6182365">,</span>&nbsp;<span class="ident" id="6182367">mb</span><span class="op" id="6182369">)</span><br>
<span class="lineno"></span><span class="op" id="6182371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6182374">func</span>&nbsp;<span class="op" id="6182379">(</span><span class="ident" id="6182380">r</span>&nbsp;<span class="ident" id="6182382">BenchmarkResult</span><span class="op" id="6182397">)</span>&nbsp;<span class="ident" id="6182399">MemString</span><span class="op" id="6182408">(</span><span class="op" id="6182409">)</span>&nbsp;<span class="builtintype" id="6182411">string</span>&nbsp;<span class="op" id="6182418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182421">return</span>&nbsp;<span class="ident" id="6182428">fmt</span><span class="op" id="6182431">.</span><span class="ident" id="6182432">Sprintf</span><span class="op" id="6182439">(</span><span class="string" id="6182440">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6182465">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182469">r</span><span class="op" id="6182470">.</span><span class="ident" id="6182471">AllocedBytesPerOp</span><span class="op" id="6182488">(</span><span class="op" id="6182489">)</span><span class="op" id="6182490">,</span>&nbsp;<span class="ident" id="6182492">r</span><span class="op" id="6182493">.</span><span class="ident" id="6182494">AllocsPerOp</span><span class="op" id="6182505">(</span><span class="op" id="6182506">)</span><span class="op" id="6182507">)</span><br>
<span class="lineno"></span><span class="op" id="6182509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182512">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6182605">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6182634">func</span>&nbsp;<span class="ident" id="6182639">RunBenchmarks</span><span class="op" id="6182652">(</span><span class="ident" id="6182653">matchString</span>&nbsp;<span class="keyword" id="6182665">func</span><span class="op" id="6182669">(</span><span class="ident" id="6182670">pat</span><span class="op" id="6182673">,</span>&nbsp;<span class="ident" id="6182675">str</span>&nbsp;<span class="builtintype" id="6182679">string</span><span class="op" id="6182685">)</span>&nbsp;<span class="op" id="6182687">(</span><span class="builtintype" id="6182688">bool</span><span class="op" id="6182692">,</span>&nbsp;<span class="builtintype" id="6182694">error</span><span class="op" id="6182699">)</span><span class="op" id="6182700">,</span>&nbsp;<span class="ident" id="6182702">benchmarks</span>&nbsp;<span class="op" id="6182713">[</span><span class="op" id="6182714">]</span><span class="ident" id="6182715">InternalBenchmark</span><span class="op" id="6182732">)</span>&nbsp;<span class="op" id="6182734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6182737">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182789">if</span>&nbsp;<span class="builtinfunc" id="6182792">len</span><span class="op" id="6182795">(</span><span class="op" id="6182796">*</span><span class="ident" id="6182797">matchBenchmarks</span><span class="op" id="6182812">)</span>&nbsp;<span class="op" id="6182814">==</span>&nbsp;<span class="num" id="6182817">0</span>&nbsp;<span class="op" id="6182819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182823">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182831">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182834">for</span>&nbsp;<span class="ident" id="6182838">_</span><span class="op" id="6182839">,</span>&nbsp;<span class="ident" id="6182841">Benchmark</span>&nbsp;<span class="op" id="6182851">:=</span>&nbsp;<span class="keyword" id="6182854">range</span>&nbsp;<span class="ident" id="6182860">benchmarks</span>&nbsp;<span class="op" id="6182871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182875">matched</span><span class="op" id="6182882">,</span>&nbsp;<span class="ident" id="6182884">err</span>&nbsp;<span class="op" id="6182888">:=</span>&nbsp;<span class="ident" id="6182891">matchString</span><span class="op" id="6182902">(</span><span class="op" id="6182903">*</span><span class="ident" id="6182904">matchBenchmarks</span><span class="op" id="6182919">,</span>&nbsp;<span class="ident" id="6182921">Benchmark</span><span class="op" id="6182930">.</span><span class="ident" id="6182931">Name</span><span class="op" id="6182935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182939">if</span>&nbsp;<span class="ident" id="6182942">err</span>&nbsp;<span class="op" id="6182946">!=</span>&nbsp;<span class="ident" id="6182949">nil</span>&nbsp;<span class="op" id="6182953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182958">fmt</span><span class="op" id="6182961">.</span><span class="ident" id="6182962">Fprintf</span><span class="op" id="6182969">(</span><span class="ident" id="6182970">os</span><span class="op" id="6182972">.</span><span class="ident" id="6182973">Stderr</span><span class="op" id="6182979">,</span>&nbsp;<span class="string" id="6182981">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6183028">,</span>&nbsp;<span class="ident" id="6183030">err</span><span class="op" id="6183033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183038">os</span><span class="op" id="6183040">.</span><span class="ident" id="6183041">Exit</span><span class="op" id="6183045">(</span><span class="num" id="6183046">1</span><span class="op" id="6183047">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183055">if</span>&nbsp;<span class="op" id="6183058">!</span><span class="ident" id="6183059">matched</span>&nbsp;<span class="op" id="6183067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183072">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183087">for</span>&nbsp;<span class="ident" id="6183091">_</span><span class="op" id="6183092">,</span>&nbsp;<span class="ident" id="6183094">procs</span>&nbsp;<span class="op" id="6183100">:=</span>&nbsp;<span class="keyword" id="6183103">range</span>&nbsp;<span class="ident" id="6183109">cpuList</span>&nbsp;<span class="op" id="6183117">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183122">runtime</span><span class="op" id="6183129">.</span><span class="ident" id="6183130">GOMAXPROCS</span><span class="op" id="6183140">(</span><span class="ident" id="6183141">procs</span><span class="op" id="6183146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183151">b</span>&nbsp;<span class="op" id="6183153">:=</span>&nbsp;<span class="op" id="6183156">&amp;</span><span class="ident" id="6183157">B</span><span class="op" id="6183158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183164">common</span><span class="op" id="6183170">:</span>&nbsp;<span class="ident" id="6183172">common</span><span class="op" id="6183178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183185">signal</span><span class="op" id="6183191">:</span>&nbsp;<span class="builtinfunc" id="6183193">make</span><span class="op" id="6183197">(</span><span class="keyword" id="6183198">chan</span>&nbsp;<span class="keyword" id="6183203">interface</span><span class="op" id="6183212">{</span><span class="op" id="6183213">}</span><span class="op" id="6183214">)</span><span class="op" id="6183215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183221">}</span><span class="op" id="6183222">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183228">benchmark</span><span class="op" id="6183237">:</span>&nbsp;<span class="ident" id="6183239">Benchmark</span><span class="op" id="6183248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183258">benchName</span>&nbsp;<span class="op" id="6183268">:=</span>&nbsp;<span class="ident" id="6183271">Benchmark</span><span class="op" id="6183280">.</span><span class="ident" id="6183281">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183289">if</span>&nbsp;<span class="ident" id="6183292">procs</span>&nbsp;<span class="op" id="6183298">!=</span>&nbsp;<span class="num" id="6183301">1</span>&nbsp;<span class="op" id="6183303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183309">benchName</span>&nbsp;<span class="op" id="6183319">=</span>&nbsp;<span class="ident" id="6183321">fmt</span><span class="op" id="6183324">.</span><span class="ident" id="6183325">Sprintf</span><span class="op" id="6183332">(</span><span class="string" id="6183333">&#34;%s-%d&#34;</span><span class="op" id="6183340">,</span>&nbsp;<span class="ident" id="6183342">Benchmark</span><span class="op" id="6183351">.</span><span class="ident" id="6183352">Name</span><span class="op" id="6183356">,</span>&nbsp;<span class="ident" id="6183358">procs</span><span class="op" id="6183363">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183373">fmt</span><span class="op" id="6183376">.</span><span class="ident" id="6183377">Printf</span><span class="op" id="6183383">(</span><span class="string" id="6183384">&#34;%s\t&#34;</span><span class="op" id="6183390">,</span>&nbsp;<span class="ident" id="6183392">benchName</span><span class="op" id="6183401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183406">r</span>&nbsp;<span class="op" id="6183408">:=</span>&nbsp;<span class="ident" id="6183411">b</span><span class="op" id="6183412">.</span><span class="ident" id="6183413">run</span><span class="op" id="6183416">(</span><span class="op" id="6183417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183422">if</span>&nbsp;<span class="ident" id="6183425">b</span><span class="op" id="6183426">.</span><span class="ident" id="6183427">failed</span>&nbsp;<span class="op" id="6183434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183440">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183503">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183580">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183609">fmt</span><span class="op" id="6183612">.</span><span class="ident" id="6183613">Printf</span><span class="op" id="6183619">(</span><span class="string" id="6183620">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6183638">,</span>&nbsp;<span class="ident" id="6183640">benchName</span><span class="op" id="6183649">,</span>&nbsp;<span class="ident" id="6183651">b</span><span class="op" id="6183652">.</span><span class="ident" id="6183653">output</span><span class="op" id="6183659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183665">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183677">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183682">results</span>&nbsp;<span class="op" id="6183690">:=</span>&nbsp;<span class="ident" id="6183693">r</span><span class="op" id="6183694">.</span><span class="ident" id="6183695">String</span><span class="op" id="6183701">(</span><span class="op" id="6183702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183707">if</span>&nbsp;<span class="op" id="6183710">*</span><span class="ident" id="6183711">benchmarkMemory</span>&nbsp;<span class="op" id="6183727">||</span>&nbsp;<span class="ident" id="6183730">b</span><span class="op" id="6183731">.</span><span class="ident" id="6183732">showAllocResult</span>&nbsp;<span class="op" id="6183748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183754">results</span>&nbsp;<span class="op" id="6183762">+=</span>&nbsp;<span class="string" id="6183765">&#34;\t&#34;</span>&nbsp;<span class="op" id="6183770">+</span>&nbsp;<span class="ident" id="6183772">r</span><span class="op" id="6183773">.</span><span class="ident" id="6183774">MemString</span><span class="op" id="6183783">(</span><span class="op" id="6183784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183794">fmt</span><span class="op" id="6183797">.</span><span class="ident" id="6183798">Println</span><span class="op" id="6183805">(</span><span class="ident" id="6183806">results</span><span class="op" id="6183813">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183818">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183898">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183971">if</span>&nbsp;<span class="builtinfunc" id="6183974">len</span><span class="op" id="6183977">(</span><span class="ident" id="6183978">b</span><span class="op" id="6183979">.</span><span class="ident" id="6183980">output</span><span class="op" id="6183986">)</span>&nbsp;<span class="op" id="6183988">&gt;</span>&nbsp;<span class="num" id="6183990">0</span>&nbsp;<span class="op" id="6183992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183998">b</span><span class="op" id="6183999">.</span><span class="ident" id="6184000">trimOutput</span><span class="op" id="6184010">(</span><span class="op" id="6184011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184017">fmt</span><span class="op" id="6184020">.</span><span class="ident" id="6184021">Printf</span><span class="op" id="6184027">(</span><span class="string" id="6184028">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6184047">,</span>&nbsp;<span class="ident" id="6184049">benchName</span><span class="op" id="6184058">,</span>&nbsp;<span class="ident" id="6184060">b</span><span class="op" id="6184061">.</span><span class="ident" id="6184062">output</span><span class="op" id="6184068">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184078">if</span>&nbsp;<span class="ident" id="6184081">p</span>&nbsp;<span class="op" id="6184083">:=</span>&nbsp;<span class="ident" id="6184086">runtime</span><span class="op" id="6184093">.</span><span class="ident" id="6184094">GOMAXPROCS</span><span class="op" id="6184104">(</span><span class="op" id="6184105">-</span><span class="num" id="6184106">1</span><span class="op" id="6184107">)</span><span class="op" id="6184108">;</span>&nbsp;<span class="ident" id="6184110">p</span>&nbsp;<span class="op" id="6184112">!=</span>&nbsp;<span class="ident" id="6184115">procs</span>&nbsp;<span class="op" id="6184121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184127">fmt</span><span class="op" id="6184130">.</span><span class="ident" id="6184131">Fprintf</span><span class="op" id="6184138">(</span><span class="ident" id="6184139">os</span><span class="op" id="6184141">.</span><span class="ident" id="6184142">Stderr</span><span class="op" id="6184148">,</span>&nbsp;<span class="string" id="6184150">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6184191">,</span>&nbsp;<span class="ident" id="6184193">benchName</span><span class="op" id="6184202">,</span>&nbsp;<span class="ident" id="6184204">p</span><span class="op" id="6184205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184214">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184217">}</span><br>
<span class="lineno"></span><span class="op" id="6184219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6184222">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6184298">func</span>&nbsp;<span class="op" id="6184303">(</span><span class="ident" id="6184304">b</span>&nbsp;<span class="op" id="6184306">*</span><span class="ident" id="6184307">B</span><span class="op" id="6184308">)</span>&nbsp;<span class="ident" id="6184310">trimOutput</span><span class="op" id="6184320">(</span><span class="op" id="6184321">)</span>&nbsp;<span class="op" id="6184323">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184326">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184398">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184478">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184562">const</span>&nbsp;<span class="ident" id="6184568">maxNewlines</span>&nbsp;<span class="op" id="6184580">=</span>&nbsp;<span class="num" id="6184582">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184586">for</span>&nbsp;<span class="ident" id="6184590">nlCount</span><span class="op" id="6184597">,</span>&nbsp;<span class="ident" id="6184599">j</span>&nbsp;<span class="op" id="6184601">:=</span>&nbsp;<span class="num" id="6184604">0</span><span class="op" id="6184605">,</span>&nbsp;<span class="num" id="6184607">0</span><span class="op" id="6184608">;</span>&nbsp;<span class="ident" id="6184610">j</span>&nbsp;<span class="op" id="6184612">&lt;</span>&nbsp;<span class="builtinfunc" id="6184614">len</span><span class="op" id="6184617">(</span><span class="ident" id="6184618">b</span><span class="op" id="6184619">.</span><span class="ident" id="6184620">output</span><span class="op" id="6184626">)</span><span class="op" id="6184627">;</span>&nbsp;<span class="ident" id="6184629">j</span><span class="op" id="6184630">++</span>&nbsp;<span class="op" id="6184633">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184637">if</span>&nbsp;<span class="ident" id="6184640">b</span><span class="op" id="6184641">.</span><span class="ident" id="6184642">output</span><span class="op" id="6184648">[</span><span class="ident" id="6184649">j</span><span class="op" id="6184650">]</span>&nbsp;<span class="op" id="6184652">==</span>&nbsp;<span class="string" id="6184655">&#39;\n&#39;</span>&nbsp;<span class="op" id="6184660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184665">nlCount</span><span class="op" id="6184672">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184678">if</span>&nbsp;<span class="ident" id="6184681">nlCount</span>&nbsp;<span class="op" id="6184689">&gt;=</span>&nbsp;<span class="ident" id="6184692">maxNewlines</span>&nbsp;<span class="op" id="6184704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184710">b</span><span class="op" id="6184711">.</span><span class="ident" id="6184712">output</span>&nbsp;<span class="op" id="6184719">=</span>&nbsp;<span class="builtinfunc" id="6184721">append</span><span class="op" id="6184727">(</span><span class="ident" id="6184728">b</span><span class="op" id="6184729">.</span><span class="ident" id="6184730">output</span><span class="op" id="6184736">[</span><span class="op" id="6184737">:</span><span class="ident" id="6184738">j</span><span class="op" id="6184739">]</span><span class="op" id="6184740">,</span>&nbsp;<span class="string" id="6184742">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6184772">...</span><span class="op" id="6184775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184781">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184797">}</span><br>
<span class="lineno"></span><span class="op" id="6184799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6184802">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6184866">type</span>&nbsp;<span class="ident" id="6184871">PB</span>&nbsp;<span class="keyword" id="6184874">struct</span>&nbsp;<span class="op" id="6184881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184884">globalN</span>&nbsp;<span class="op" id="6184892">*</span><span class="ident" id="6184893">uint64</span>&nbsp;<span class="comment" id="6184900">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184959">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6184967">uint64</span>&nbsp;&nbsp;<span class="comment" id="6184975">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185029">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6185037">uint64</span>&nbsp;&nbsp;<span class="comment" id="6185045">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185084">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6185092">uint64</span>&nbsp;&nbsp;<span class="comment" id="6185100">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6185147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6185150">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6185212">func</span>&nbsp;<span class="op" id="6185217">(</span><span class="ident" id="6185218">pb</span>&nbsp;<span class="op" id="6185221">*</span><span class="ident" id="6185222">PB</span><span class="op" id="6185224">)</span>&nbsp;<span class="ident" id="6185226">Next</span><span class="op" id="6185230">(</span><span class="op" id="6185231">)</span>&nbsp;<span class="builtintype" id="6185233">bool</span>&nbsp;<span class="op" id="6185238">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185241">if</span>&nbsp;<span class="ident" id="6185244">pb</span><span class="op" id="6185246">.</span><span class="ident" id="6185247">cache</span>&nbsp;<span class="op" id="6185253">==</span>&nbsp;<span class="num" id="6185256">0</span>&nbsp;<span class="op" id="6185258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185262">n</span>&nbsp;<span class="op" id="6185264">:=</span>&nbsp;<span class="ident" id="6185267">atomic</span><span class="op" id="6185273">.</span><span class="ident" id="6185274">AddUint64</span><span class="op" id="6185283">(</span><span class="ident" id="6185284">pb</span><span class="op" id="6185286">.</span><span class="ident" id="6185287">globalN</span><span class="op" id="6185294">,</span>&nbsp;<span class="ident" id="6185296">pb</span><span class="op" id="6185298">.</span><span class="ident" id="6185299">grain</span><span class="op" id="6185304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185308">if</span>&nbsp;<span class="ident" id="6185311">n</span>&nbsp;<span class="op" id="6185313">&lt;=</span>&nbsp;<span class="ident" id="6185316">pb</span><span class="op" id="6185318">.</span><span class="ident" id="6185319">bN</span>&nbsp;<span class="op" id="6185322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185327">pb</span><span class="op" id="6185329">.</span><span class="ident" id="6185330">cache</span>&nbsp;<span class="op" id="6185336">=</span>&nbsp;<span class="ident" id="6185338">pb</span><span class="op" id="6185340">.</span><span class="ident" id="6185341">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185349">}</span>&nbsp;<span class="keyword" id="6185351">else</span>&nbsp;<span class="keyword" id="6185356">if</span>&nbsp;<span class="ident" id="6185359">n</span>&nbsp;<span class="op" id="6185361">&lt;</span>&nbsp;<span class="ident" id="6185363">pb</span><span class="op" id="6185365">.</span><span class="ident" id="6185366">bN</span><span class="op" id="6185368">+</span><span class="ident" id="6185369">pb</span><span class="op" id="6185371">.</span><span class="ident" id="6185372">grain</span>&nbsp;<span class="op" id="6185378">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185383">pb</span><span class="op" id="6185385">.</span><span class="ident" id="6185386">cache</span>&nbsp;<span class="op" id="6185392">=</span>&nbsp;<span class="ident" id="6185394">pb</span><span class="op" id="6185396">.</span><span class="ident" id="6185397">bN</span>&nbsp;<span class="op" id="6185400">+</span>&nbsp;<span class="ident" id="6185402">pb</span><span class="op" id="6185404">.</span><span class="ident" id="6185405">grain</span>&nbsp;<span class="op" id="6185411">-</span>&nbsp;<span class="ident" id="6185413">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185417">}</span>&nbsp;<span class="keyword" id="6185419">else</span>&nbsp;<span class="op" id="6185424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185429">return</span>&nbsp;<span class="builtintype" id="6185436">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185447">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185450">pb</span><span class="op" id="6185452">.</span><span class="ident" id="6185453">cache</span><span class="op" id="6185458">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185462">return</span>&nbsp;<span class="builtintype" id="6185469">true</span><br>
<span class="lineno"></span><span class="op" id="6185474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6185477">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6185522">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6185599">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6185679">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6185748">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6185807">//</span><br>
<span class="lineno">385</span><span class="comment" id="6185810">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6185883">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6185954">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6186027">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6186063">func</span>&nbsp;<span class="op" id="6186068">(</span><span class="ident" id="6186069">b</span>&nbsp;<span class="op" id="6186071">*</span><span class="ident" id="6186072">B</span><span class="op" id="6186073">)</span>&nbsp;<span class="ident" id="6186075">RunParallel</span><span class="op" id="6186086">(</span><span class="ident" id="6186087">body</span>&nbsp;<span class="keyword" id="6186092">func</span><span class="op" id="6186096">(</span><span class="op" id="6186097">*</span><span class="ident" id="6186098">PB</span><span class="op" id="6186100">)</span><span class="op" id="6186101">)</span>&nbsp;<span class="op" id="6186103">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186106">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186174">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186243">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186271">grain</span>&nbsp;<span class="op" id="6186277">:=</span>&nbsp;<span class="ident" id="6186280">uint64</span><span class="op" id="6186286">(</span><span class="num" id="6186287">0</span><span class="op" id="6186288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186291">if</span>&nbsp;<span class="ident" id="6186294">b</span><span class="op" id="6186295">.</span><span class="ident" id="6186296">previousN</span>&nbsp;<span class="op" id="6186306">&gt;</span>&nbsp;<span class="num" id="6186308">0</span>&nbsp;<span class="op" id="6186310">&amp;&amp;</span>&nbsp;<span class="ident" id="6186313">b</span><span class="op" id="6186314">.</span><span class="ident" id="6186315">previousDuration</span>&nbsp;<span class="op" id="6186332">&gt;</span>&nbsp;<span class="num" id="6186334">0</span>&nbsp;<span class="op" id="6186336">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186340">grain</span>&nbsp;<span class="op" id="6186346">=</span>&nbsp;<span class="num" id="6186348">1e5</span>&nbsp;<span class="op" id="6186352">*</span>&nbsp;<span class="ident" id="6186354">uint64</span><span class="op" id="6186360">(</span><span class="ident" id="6186361">b</span><span class="op" id="6186362">.</span><span class="ident" id="6186363">previousN</span><span class="op" id="6186372">)</span>&nbsp;<span class="op" id="6186374">/</span>&nbsp;<span class="ident" id="6186376">uint64</span><span class="op" id="6186382">(</span><span class="ident" id="6186383">b</span><span class="op" id="6186384">.</span><span class="ident" id="6186385">previousDuration</span><span class="op" id="6186401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186407">if</span>&nbsp;<span class="ident" id="6186410">grain</span>&nbsp;<span class="op" id="6186416">&lt;</span>&nbsp;<span class="num" id="6186418">1</span>&nbsp;<span class="op" id="6186420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186424">grain</span>&nbsp;<span class="op" id="6186430">=</span>&nbsp;<span class="num" id="6186432">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186435">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186438">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186508">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186563">if</span>&nbsp;<span class="ident" id="6186566">grain</span>&nbsp;<span class="op" id="6186572">&gt;</span>&nbsp;<span class="num" id="6186574">1e4</span>&nbsp;<span class="op" id="6186578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186582">grain</span>&nbsp;<span class="op" id="6186588">=</span>&nbsp;<span class="num" id="6186590">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186595">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186599">n</span>&nbsp;<span class="op" id="6186601">:=</span>&nbsp;<span class="ident" id="6186604">uint64</span><span class="op" id="6186610">(</span><span class="num" id="6186611">0</span><span class="op" id="6186612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186615">numProcs</span>&nbsp;<span class="op" id="6186624">:=</span>&nbsp;<span class="ident" id="6186627">b</span><span class="op" id="6186628">.</span><span class="ident" id="6186629">parallelism</span>&nbsp;<span class="op" id="6186641">*</span>&nbsp;<span class="ident" id="6186643">runtime</span><span class="op" id="6186650">.</span><span class="ident" id="6186651">GOMAXPROCS</span><span class="op" id="6186661">(</span><span class="num" id="6186662">0</span><span class="op" id="6186663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186666">var</span>&nbsp;<span class="ident" id="6186670">wg</span>&nbsp;<span class="ident" id="6186673">sync</span><span class="op" id="6186677">.</span><span class="ident" id="6186678">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186689">wg</span><span class="op" id="6186691">.</span><span class="ident" id="6186692">Add</span><span class="op" id="6186695">(</span><span class="ident" id="6186696">numProcs</span><span class="op" id="6186704">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186707">for</span>&nbsp;<span class="ident" id="6186711">p</span>&nbsp;<span class="op" id="6186713">:=</span>&nbsp;<span class="num" id="6186716">0</span><span class="op" id="6186717">;</span>&nbsp;<span class="ident" id="6186719">p</span>&nbsp;<span class="op" id="6186721">&lt;</span>&nbsp;<span class="ident" id="6186723">numProcs</span><span class="op" id="6186731">;</span>&nbsp;<span class="ident" id="6186733">p</span><span class="op" id="6186734">++</span>&nbsp;<span class="op" id="6186737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186741">go</span>&nbsp;<span class="keyword" id="6186744">func</span><span class="op" id="6186748">(</span><span class="op" id="6186749">)</span>&nbsp;<span class="op" id="6186751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186756">defer</span>&nbsp;<span class="ident" id="6186762">wg</span><span class="op" id="6186764">.</span><span class="ident" id="6186765">Done</span><span class="op" id="6186769">(</span><span class="op" id="6186770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186775">pb</span>&nbsp;<span class="op" id="6186778">:=</span>&nbsp;<span class="op" id="6186781">&amp;</span><span class="ident" id="6186782">PB</span><span class="op" id="6186784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186790">globalN</span><span class="op" id="6186797">:</span>&nbsp;<span class="op" id="6186799">&amp;</span><span class="ident" id="6186800">n</span><span class="op" id="6186801">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186807">grain</span><span class="op" id="6186812">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6186816">grain</span><span class="op" id="6186821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186827">bN</span><span class="op" id="6186829">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6186836">uint64</span><span class="op" id="6186842">(</span><span class="ident" id="6186843">b</span><span class="op" id="6186844">.</span><span class="ident" id="6186845">N</span><span class="op" id="6186846">)</span><span class="op" id="6186847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186857">body</span><span class="op" id="6186861">(</span><span class="ident" id="6186862">pb</span><span class="op" id="6186864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186868">}</span><span class="op" id="6186869">(</span><span class="op" id="6186870">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186876">wg</span><span class="op" id="6186878">.</span><span class="ident" id="6186879">Wait</span><span class="op" id="6186883">(</span><span class="op" id="6186884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186887">if</span>&nbsp;<span class="ident" id="6186890">n</span>&nbsp;<span class="op" id="6186892">&lt;=</span>&nbsp;<span class="ident" id="6186895">uint64</span><span class="op" id="6186901">(</span><span class="ident" id="6186902">b</span><span class="op" id="6186903">.</span><span class="ident" id="6186904">N</span><span class="op" id="6186905">)</span>&nbsp;<span class="op" id="6186907">&amp;&amp;</span>&nbsp;<span class="op" id="6186910">!</span><span class="ident" id="6186911">b</span><span class="op" id="6186912">.</span><span class="ident" id="6186913">Failed</span><span class="op" id="6186919">(</span><span class="op" id="6186920">)</span>&nbsp;<span class="op" id="6186922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186926">b</span><span class="op" id="6186927">.</span><span class="ident" id="6186928">Fatal</span><span class="op" id="6186933">(</span><span class="string" id="6186934">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6186987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186990">}</span><br>
<span class="lineno">425</span><span class="op" id="6186992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6186995">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6187080">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6187157">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6187212">func</span>&nbsp;<span class="op" id="6187217">(</span><span class="ident" id="6187218">b</span>&nbsp;<span class="op" id="6187220">*</span><span class="ident" id="6187221">B</span><span class="op" id="6187222">)</span>&nbsp;<span class="ident" id="6187224">SetParallelism</span><span class="op" id="6187238">(</span><span class="ident" id="6187239">p</span>&nbsp;<span class="builtintype" id="6187241">int</span><span class="op" id="6187244">)</span>&nbsp;<span class="op" id="6187246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187249">if</span>&nbsp;<span class="ident" id="6187252">p</span>&nbsp;<span class="op" id="6187254">&gt;=</span>&nbsp;<span class="num" id="6187257">1</span>&nbsp;<span class="op" id="6187259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187263">b</span><span class="op" id="6187264">.</span><span class="ident" id="6187265">parallelism</span>&nbsp;<span class="op" id="6187277">=</span>&nbsp;<span class="ident" id="6187279">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187282">}</span><br>
<span class="lineno"></span><span class="op" id="6187284">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6187287">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6187350">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6187410">func</span>&nbsp;<span class="ident" id="6187415">Benchmark</span><span class="op" id="6187424">(</span><span class="ident" id="6187425">f</span>&nbsp;<span class="keyword" id="6187427">func</span><span class="op" id="6187431">(</span><span class="ident" id="6187432">b</span>&nbsp;<span class="op" id="6187434">*</span><span class="ident" id="6187435">B</span><span class="op" id="6187436">)</span><span class="op" id="6187437">)</span>&nbsp;<span class="ident" id="6187439">BenchmarkResult</span>&nbsp;<span class="op" id="6187455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187458">b</span>&nbsp;<span class="op" id="6187460">:=</span>&nbsp;<span class="op" id="6187463">&amp;</span><span class="ident" id="6187464">B</span><span class="op" id="6187465">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187469">common</span><span class="op" id="6187475">:</span>&nbsp;<span class="ident" id="6187477">common</span><span class="op" id="6187483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187488">signal</span><span class="op" id="6187494">:</span>&nbsp;<span class="builtinfunc" id="6187496">make</span><span class="op" id="6187500">(</span><span class="keyword" id="6187501">chan</span>&nbsp;<span class="keyword" id="6187506">interface</span><span class="op" id="6187515">{</span><span class="op" id="6187516">}</span><span class="op" id="6187517">)</span><span class="op" id="6187518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187522">}</span><span class="op" id="6187523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187527">benchmark</span><span class="op" id="6187536">:</span>&nbsp;<span class="ident" id="6187538">InternalBenchmark</span><span class="op" id="6187555">{</span><span class="string" id="6187556">&#34;&#34;</span><span class="op" id="6187558">,</span>&nbsp;<span class="ident" id="6187560">f</span><span class="op" id="6187561">}</span><span class="op" id="6187562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187565">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187568">return</span>&nbsp;<span class="ident" id="6187575">b</span><span class="op" id="6187576">.</span><span class="ident" id="6187577">run</span><span class="op" id="6187580">(</span><span class="op" id="6187581">)</span><br>
<span class="lineno"></span><span class="op" id="6187583">}</span>
</div>
</body>
</html>
