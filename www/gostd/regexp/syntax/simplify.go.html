<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html" class="current">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5278804">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5278860">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5278914">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5278965">package</span>&nbsp;<span class="ident" id="5278973">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5278981">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5279059">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5279139">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5279216">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5279287">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5279361">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5279428">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5279496">func</span>&nbsp;<span class="op" id="5279501">(</span><span class="ident" id="5279502">re</span>&nbsp;<span class="op" id="5279505">*</span><span class="ident" id="5279506">Regexp</span><span class="op" id="5279512">)</span>&nbsp;<span class="ident" id="5279514">Simplify</span><span class="op" id="5279522">(</span><span class="op" id="5279523">)</span>&nbsp;<span class="op" id="5279525">*</span><span class="ident" id="5279526">Regexp</span>&nbsp;<span class="op" id="5279533">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279536">if</span>&nbsp;<span class="ident" id="5279539">re</span>&nbsp;<span class="op" id="5279542">==</span>&nbsp;<span class="builtintype" id="5279545">nil</span>&nbsp;<span class="op" id="5279549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279553">return</span>&nbsp;<span class="builtintype" id="5279560">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5279565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279568">switch</span>&nbsp;<span class="ident" id="5279575">re</span><span class="op" id="5279577">.</span><span class="ident" id="5279578">Op</span>&nbsp;<span class="op" id="5279581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279584">case</span>&nbsp;<span class="ident" id="5279589">OpCapture</span><span class="op" id="5279598">,</span>&nbsp;<span class="ident" id="5279600">OpConcat</span><span class="op" id="5279608">,</span>&nbsp;<span class="ident" id="5279610">OpAlternate</span><span class="op" id="5279621">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5279625">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279689">nre</span>&nbsp;<span class="op" id="5279693">:=</span>&nbsp;<span class="ident" id="5279696">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279701">for</span>&nbsp;<span class="ident" id="5279705">i</span><span class="op" id="5279706">,</span>&nbsp;<span class="ident" id="5279708">sub</span>&nbsp;<span class="op" id="5279712">:=</span>&nbsp;<span class="keyword" id="5279715">range</span>&nbsp;<span class="ident" id="5279721">re</span><span class="op" id="5279723">.</span><span class="ident" id="5279724">Sub</span>&nbsp;<span class="op" id="5279728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279733">nsub</span>&nbsp;<span class="op" id="5279738">:=</span>&nbsp;<span class="ident" id="5279741">sub</span><span class="op" id="5279744">.</span><span class="ident" id="5279745">Simplify</span><span class="op" id="5279753">(</span><span class="op" id="5279754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279759">if</span>&nbsp;<span class="ident" id="5279762">nre</span>&nbsp;<span class="op" id="5279766">==</span>&nbsp;<span class="ident" id="5279769">re</span>&nbsp;<span class="op" id="5279772">&amp;&amp;</span>&nbsp;<span class="ident" id="5279775">nsub</span>&nbsp;<span class="op" id="5279780">!=</span>&nbsp;<span class="ident" id="5279783">sub</span>&nbsp;<span class="op" id="5279787">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5279793">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279814">nre</span>&nbsp;<span class="op" id="5279818">=</span>&nbsp;<span class="builtinfunc" id="5279820">new</span><span class="op" id="5279823">(</span><span class="ident" id="5279824">Regexp</span><span class="op" id="5279830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5279836">*</span><span class="ident" id="5279837">nre</span>&nbsp;<span class="op" id="5279841">=</span>&nbsp;<span class="op" id="5279843">*</span><span class="ident" id="5279844">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279851">nre</span><span class="op" id="5279854">.</span><span class="ident" id="5279855">Rune</span>&nbsp;<span class="op" id="5279860">=</span>&nbsp;<span class="builtintype" id="5279862">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279870">nre</span><span class="op" id="5279873">.</span><span class="ident" id="5279874">Sub</span>&nbsp;<span class="op" id="5279878">=</span>&nbsp;<span class="builtinfunc" id="5279880">append</span><span class="op" id="5279886">(</span><span class="ident" id="5279887">nre</span><span class="op" id="5279890">.</span><span class="ident" id="5279891">Sub0</span><span class="op" id="5279895">[</span><span class="op" id="5279896">:</span><span class="num" id="5279897">0</span><span class="op" id="5279898">]</span><span class="op" id="5279899">,</span>&nbsp;<span class="ident" id="5279901">re</span><span class="op" id="5279903">.</span><span class="ident" id="5279904">Sub</span><span class="op" id="5279907">[</span><span class="op" id="5279908">:</span><span class="ident" id="5279909">i</span><span class="op" id="5279910">]</span><span class="op" id="5279911">...</span><span class="op" id="5279914">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5279919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279924">if</span>&nbsp;<span class="ident" id="5279927">nre</span>&nbsp;<span class="op" id="5279931">!=</span>&nbsp;<span class="ident" id="5279934">re</span>&nbsp;<span class="op" id="5279937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279943">nre</span><span class="op" id="5279946">.</span><span class="ident" id="5279947">Sub</span>&nbsp;<span class="op" id="5279951">=</span>&nbsp;<span class="builtinfunc" id="5279953">append</span><span class="op" id="5279959">(</span><span class="ident" id="5279960">nre</span><span class="op" id="5279963">.</span><span class="ident" id="5279964">Sub</span><span class="op" id="5279967">,</span>&nbsp;<span class="ident" id="5279969">nsub</span><span class="op" id="5279973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5279978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5279982">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279986">return</span>&nbsp;<span class="ident" id="5279993">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279999">case</span>&nbsp;<span class="ident" id="5280004">OpStar</span><span class="op" id="5280010">,</span>&nbsp;<span class="ident" id="5280012">OpPlus</span><span class="op" id="5280018">,</span>&nbsp;<span class="ident" id="5280020">OpQuest</span><span class="op" id="5280027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280031">sub</span>&nbsp;<span class="op" id="5280035">:=</span>&nbsp;<span class="ident" id="5280038">re</span><span class="op" id="5280040">.</span><span class="ident" id="5280041">Sub</span><span class="op" id="5280044">[</span><span class="num" id="5280045">0</span><span class="op" id="5280046">]</span><span class="op" id="5280047">.</span><span class="ident" id="5280048">Simplify</span><span class="op" id="5280056">(</span><span class="op" id="5280057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280061">return</span>&nbsp;<span class="ident" id="5280068">simplify1</span><span class="op" id="5280077">(</span><span class="ident" id="5280078">re</span><span class="op" id="5280080">.</span><span class="ident" id="5280081">Op</span><span class="op" id="5280083">,</span>&nbsp;<span class="ident" id="5280085">re</span><span class="op" id="5280087">.</span><span class="ident" id="5280088">Flags</span><span class="op" id="5280093">,</span>&nbsp;<span class="ident" id="5280095">sub</span><span class="op" id="5280098">,</span>&nbsp;<span class="ident" id="5280100">re</span><span class="op" id="5280102">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280106">case</span>&nbsp;<span class="ident" id="5280111">OpRepeat</span><span class="op" id="5280119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280123">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280180">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280222">if</span>&nbsp;<span class="ident" id="5280225">re</span><span class="op" id="5280227">.</span><span class="ident" id="5280228">Min</span>&nbsp;<span class="op" id="5280232">==</span>&nbsp;<span class="num" id="5280235">0</span>&nbsp;<span class="op" id="5280237">&amp;&amp;</span>&nbsp;<span class="ident" id="5280240">re</span><span class="op" id="5280242">.</span><span class="ident" id="5280243">Max</span>&nbsp;<span class="op" id="5280247">==</span>&nbsp;<span class="num" id="5280250">0</span>&nbsp;<span class="op" id="5280252">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280257">return</span>&nbsp;<span class="op" id="5280264">&amp;</span><span class="ident" id="5280265">Regexp</span><span class="op" id="5280271">{</span><span class="ident" id="5280272">Op</span><span class="op" id="5280274">:</span>&nbsp;<span class="ident" id="5280276">OpEmptyMatch</span><span class="op" id="5280288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280297">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280318">sub</span>&nbsp;<span class="op" id="5280322">:=</span>&nbsp;<span class="ident" id="5280325">re</span><span class="op" id="5280327">.</span><span class="ident" id="5280328">Sub</span><span class="op" id="5280331">[</span><span class="num" id="5280332">0</span><span class="op" id="5280333">]</span><span class="op" id="5280334">.</span><span class="ident" id="5280335">Simplify</span><span class="op" id="5280343">(</span><span class="op" id="5280344">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280349">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280391">if</span>&nbsp;<span class="ident" id="5280394">re</span><span class="op" id="5280396">.</span><span class="ident" id="5280397">Max</span>&nbsp;<span class="op" id="5280401">==</span>&nbsp;<span class="op" id="5280404">-</span><span class="num" id="5280405">1</span>&nbsp;<span class="op" id="5280407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280412">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280445">if</span>&nbsp;<span class="ident" id="5280448">re</span><span class="op" id="5280450">.</span><span class="ident" id="5280451">Min</span>&nbsp;<span class="op" id="5280455">==</span>&nbsp;<span class="num" id="5280458">0</span>&nbsp;<span class="op" id="5280460">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280466">return</span>&nbsp;<span class="ident" id="5280473">simplify1</span><span class="op" id="5280482">(</span><span class="ident" id="5280483">OpStar</span><span class="op" id="5280489">,</span>&nbsp;<span class="ident" id="5280491">re</span><span class="op" id="5280493">.</span><span class="ident" id="5280494">Flags</span><span class="op" id="5280499">,</span>&nbsp;<span class="ident" id="5280501">sub</span><span class="op" id="5280504">,</span>&nbsp;<span class="builtintype" id="5280506">nil</span><span class="op" id="5280509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280520">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280553">if</span>&nbsp;<span class="ident" id="5280556">re</span><span class="op" id="5280558">.</span><span class="ident" id="5280559">Min</span>&nbsp;<span class="op" id="5280563">==</span>&nbsp;<span class="num" id="5280566">1</span>&nbsp;<span class="op" id="5280568">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280574">return</span>&nbsp;<span class="ident" id="5280581">simplify1</span><span class="op" id="5280590">(</span><span class="ident" id="5280591">OpPlus</span><span class="op" id="5280597">,</span>&nbsp;<span class="ident" id="5280599">re</span><span class="op" id="5280601">.</span><span class="ident" id="5280602">Flags</span><span class="op" id="5280607">,</span>&nbsp;<span class="ident" id="5280609">sub</span><span class="op" id="5280612">,</span>&nbsp;<span class="builtintype" id="5280614">nil</span><span class="op" id="5280617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280628">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280664">nre</span>&nbsp;<span class="op" id="5280668">:=</span>&nbsp;<span class="op" id="5280671">&amp;</span><span class="ident" id="5280672">Regexp</span><span class="op" id="5280678">{</span><span class="ident" id="5280679">Op</span><span class="op" id="5280681">:</span>&nbsp;<span class="ident" id="5280683">OpConcat</span><span class="op" id="5280691">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280696">nre</span><span class="op" id="5280699">.</span><span class="ident" id="5280700">Sub</span>&nbsp;<span class="op" id="5280704">=</span>&nbsp;<span class="ident" id="5280706">nre</span><span class="op" id="5280709">.</span><span class="ident" id="5280710">Sub0</span><span class="op" id="5280714">[</span><span class="op" id="5280715">:</span><span class="num" id="5280716">0</span><span class="op" id="5280717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280722">for</span>&nbsp;<span class="ident" id="5280726">i</span>&nbsp;<span class="op" id="5280728">:=</span>&nbsp;<span class="num" id="5280731">0</span><span class="op" id="5280732">;</span>&nbsp;<span class="ident" id="5280734">i</span>&nbsp;<span class="op" id="5280736">&lt;</span>&nbsp;<span class="ident" id="5280738">re</span><span class="op" id="5280740">.</span><span class="ident" id="5280741">Min</span><span class="op" id="5280744">-</span><span class="num" id="5280745">1</span><span class="op" id="5280746">;</span>&nbsp;<span class="ident" id="5280748">i</span><span class="op" id="5280749">++</span>&nbsp;<span class="op" id="5280752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280758">nre</span><span class="op" id="5280761">.</span><span class="ident" id="5280762">Sub</span>&nbsp;<span class="op" id="5280766">=</span>&nbsp;<span class="builtinfunc" id="5280768">append</span><span class="op" id="5280774">(</span><span class="ident" id="5280775">nre</span><span class="op" id="5280778">.</span><span class="ident" id="5280779">Sub</span><span class="op" id="5280782">,</span>&nbsp;<span class="ident" id="5280784">sub</span><span class="op" id="5280787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280797">nre</span><span class="op" id="5280800">.</span><span class="ident" id="5280801">Sub</span>&nbsp;<span class="op" id="5280805">=</span>&nbsp;<span class="builtinfunc" id="5280807">append</span><span class="op" id="5280813">(</span><span class="ident" id="5280814">nre</span><span class="op" id="5280817">.</span><span class="ident" id="5280818">Sub</span><span class="op" id="5280821">,</span>&nbsp;<span class="ident" id="5280823">simplify1</span><span class="op" id="5280832">(</span><span class="ident" id="5280833">OpPlus</span><span class="op" id="5280839">,</span>&nbsp;<span class="ident" id="5280841">re</span><span class="op" id="5280843">.</span><span class="ident" id="5280844">Flags</span><span class="op" id="5280849">,</span>&nbsp;<span class="ident" id="5280851">sub</span><span class="op" id="5280854">,</span>&nbsp;<span class="builtintype" id="5280856">nil</span><span class="op" id="5280859">)</span><span class="op" id="5280860">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280865">return</span>&nbsp;<span class="ident" id="5280872">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280883">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280922">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280957">if</span>&nbsp;<span class="ident" id="5280960">re</span><span class="op" id="5280962">.</span><span class="ident" id="5280963">Min</span>&nbsp;<span class="op" id="5280967">==</span>&nbsp;<span class="num" id="5280970">1</span>&nbsp;<span class="op" id="5280972">&amp;&amp;</span>&nbsp;<span class="ident" id="5280975">re</span><span class="op" id="5280977">.</span><span class="ident" id="5280978">Max</span>&nbsp;<span class="op" id="5280982">==</span>&nbsp;<span class="num" id="5280985">1</span>&nbsp;<span class="op" id="5280987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280992">return</span>&nbsp;<span class="ident" id="5280999">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281010">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281075">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281141">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281179">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281210">var</span>&nbsp;<span class="ident" id="5281214">prefix</span>&nbsp;<span class="op" id="5281221">*</span><span class="ident" id="5281222">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281231">if</span>&nbsp;<span class="ident" id="5281234">re</span><span class="op" id="5281236">.</span><span class="ident" id="5281237">Min</span>&nbsp;<span class="op" id="5281241">&gt;</span>&nbsp;<span class="num" id="5281243">0</span>&nbsp;<span class="op" id="5281245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281250">prefix</span>&nbsp;<span class="op" id="5281257">=</span>&nbsp;<span class="op" id="5281259">&amp;</span><span class="ident" id="5281260">Regexp</span><span class="op" id="5281266">{</span><span class="ident" id="5281267">Op</span><span class="op" id="5281269">:</span>&nbsp;<span class="ident" id="5281271">OpConcat</span><span class="op" id="5281279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281284">prefix</span><span class="op" id="5281290">.</span><span class="ident" id="5281291">Sub</span>&nbsp;<span class="op" id="5281295">=</span>&nbsp;<span class="ident" id="5281297">prefix</span><span class="op" id="5281303">.</span><span class="ident" id="5281304">Sub0</span><span class="op" id="5281308">[</span><span class="op" id="5281309">:</span><span class="num" id="5281310">0</span><span class="op" id="5281311">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281316">for</span>&nbsp;<span class="ident" id="5281320">i</span>&nbsp;<span class="op" id="5281322">:=</span>&nbsp;<span class="num" id="5281325">0</span><span class="op" id="5281326">;</span>&nbsp;<span class="ident" id="5281328">i</span>&nbsp;<span class="op" id="5281330">&lt;</span>&nbsp;<span class="ident" id="5281332">re</span><span class="op" id="5281334">.</span><span class="ident" id="5281335">Min</span><span class="op" id="5281338">;</span>&nbsp;<span class="ident" id="5281340">i</span><span class="op" id="5281341">++</span>&nbsp;<span class="op" id="5281344">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281350">prefix</span><span class="op" id="5281356">.</span><span class="ident" id="5281357">Sub</span>&nbsp;<span class="op" id="5281361">=</span>&nbsp;<span class="builtinfunc" id="5281363">append</span><span class="op" id="5281369">(</span><span class="ident" id="5281370">prefix</span><span class="op" id="5281376">.</span><span class="ident" id="5281377">Sub</span><span class="op" id="5281380">,</span>&nbsp;<span class="ident" id="5281382">sub</span><span class="op" id="5281385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281399">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281442">if</span>&nbsp;<span class="ident" id="5281445">re</span><span class="op" id="5281447">.</span><span class="ident" id="5281448">Max</span>&nbsp;<span class="op" id="5281452">&gt;</span>&nbsp;<span class="ident" id="5281454">re</span><span class="op" id="5281456">.</span><span class="ident" id="5281457">Min</span>&nbsp;<span class="op" id="5281461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281466">suffix</span>&nbsp;<span class="op" id="5281473">:=</span>&nbsp;<span class="ident" id="5281476">simplify1</span><span class="op" id="5281485">(</span><span class="ident" id="5281486">OpQuest</span><span class="op" id="5281493">,</span>&nbsp;<span class="ident" id="5281495">re</span><span class="op" id="5281497">.</span><span class="ident" id="5281498">Flags</span><span class="op" id="5281503">,</span>&nbsp;<span class="ident" id="5281505">sub</span><span class="op" id="5281508">,</span>&nbsp;<span class="builtintype" id="5281510">nil</span><span class="op" id="5281513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281518">for</span>&nbsp;<span class="ident" id="5281522">i</span>&nbsp;<span class="op" id="5281524">:=</span>&nbsp;<span class="ident" id="5281527">re</span><span class="op" id="5281529">.</span><span class="ident" id="5281530">Min</span>&nbsp;<span class="op" id="5281534">+</span>&nbsp;<span class="num" id="5281536">1</span><span class="op" id="5281537">;</span>&nbsp;<span class="ident" id="5281539">i</span>&nbsp;<span class="op" id="5281541">&lt;</span>&nbsp;<span class="ident" id="5281543">re</span><span class="op" id="5281545">.</span><span class="ident" id="5281546">Max</span><span class="op" id="5281549">;</span>&nbsp;<span class="ident" id="5281551">i</span><span class="op" id="5281552">++</span>&nbsp;<span class="op" id="5281555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281561">nre2</span>&nbsp;<span class="op" id="5281566">:=</span>&nbsp;<span class="op" id="5281569">&amp;</span><span class="ident" id="5281570">Regexp</span><span class="op" id="5281576">{</span><span class="ident" id="5281577">Op</span><span class="op" id="5281579">:</span>&nbsp;<span class="ident" id="5281581">OpConcat</span><span class="op" id="5281589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281595">nre2</span><span class="op" id="5281599">.</span><span class="ident" id="5281600">Sub</span>&nbsp;<span class="op" id="5281604">=</span>&nbsp;<span class="builtinfunc" id="5281606">append</span><span class="op" id="5281612">(</span><span class="ident" id="5281613">nre2</span><span class="op" id="5281617">.</span><span class="ident" id="5281618">Sub0</span><span class="op" id="5281622">[</span><span class="op" id="5281623">:</span><span class="num" id="5281624">0</span><span class="op" id="5281625">]</span><span class="op" id="5281626">,</span>&nbsp;<span class="ident" id="5281628">sub</span><span class="op" id="5281631">,</span>&nbsp;<span class="ident" id="5281633">suffix</span><span class="op" id="5281639">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281645">suffix</span>&nbsp;<span class="op" id="5281652">=</span>&nbsp;<span class="ident" id="5281654">simplify1</span><span class="op" id="5281663">(</span><span class="ident" id="5281664">OpQuest</span><span class="op" id="5281671">,</span>&nbsp;<span class="ident" id="5281673">re</span><span class="op" id="5281675">.</span><span class="ident" id="5281676">Flags</span><span class="op" id="5281681">,</span>&nbsp;<span class="ident" id="5281683">nre2</span><span class="op" id="5281687">,</span>&nbsp;<span class="builtintype" id="5281689">nil</span><span class="op" id="5281692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281702">if</span>&nbsp;<span class="ident" id="5281705">prefix</span>&nbsp;<span class="op" id="5281712">==</span>&nbsp;<span class="builtintype" id="5281715">nil</span>&nbsp;<span class="op" id="5281719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281725">return</span>&nbsp;<span class="ident" id="5281732">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281742">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281747">prefix</span><span class="op" id="5281753">.</span><span class="ident" id="5281754">Sub</span>&nbsp;<span class="op" id="5281758">=</span>&nbsp;<span class="builtinfunc" id="5281760">append</span><span class="op" id="5281766">(</span><span class="ident" id="5281767">prefix</span><span class="op" id="5281773">.</span><span class="ident" id="5281774">Sub</span><span class="op" id="5281777">,</span>&nbsp;<span class="ident" id="5281779">suffix</span><span class="op" id="5281785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281793">if</span>&nbsp;<span class="ident" id="5281796">prefix</span>&nbsp;<span class="op" id="5281803">!=</span>&nbsp;<span class="builtintype" id="5281806">nil</span>&nbsp;<span class="op" id="5281810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281815">return</span>&nbsp;<span class="ident" id="5281822">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281831">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281836">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281895">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281928">return</span>&nbsp;<span class="op" id="5281935">&amp;</span><span class="ident" id="5281936">Regexp</span><span class="op" id="5281942">{</span><span class="ident" id="5281943">Op</span><span class="op" id="5281945">:</span>&nbsp;<span class="ident" id="5281947">OpNoMatch</span><span class="op" id="5281956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281959">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281963">return</span>&nbsp;<span class="ident" id="5281970">re</span><br>
<span class="lineno"></span><span class="op" id="5281973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5281976">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5282031">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5282095">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5282112">//</span><br>
<span class="lineno"></span><span class="comment" id="5282115">//&nbsp;&nbsp;&nbsp;&nbsp;Regexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5282159">//</span><br>
<span class="lineno">125</span><span class="comment" id="5282162">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5282218">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5282277">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5282339">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5282362">//</span><br>
<span class="lineno">130</span><span class="comment" id="5282365">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5282433">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5282491">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5282554">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5282578">func</span>&nbsp;<span class="ident" id="5282583">simplify1</span><span class="op" id="5282592">(</span><span class="ident" id="5282593">op</span>&nbsp;<span class="ident" id="5282596">Op</span><span class="op" id="5282598">,</span>&nbsp;<span class="ident" id="5282600">flags</span>&nbsp;<span class="ident" id="5282606">Flags</span><span class="op" id="5282611">,</span>&nbsp;<span class="ident" id="5282613">sub</span><span class="op" id="5282616">,</span>&nbsp;<span class="ident" id="5282618">re</span>&nbsp;<span class="op" id="5282621">*</span><span class="ident" id="5282622">Regexp</span><span class="op" id="5282628">)</span>&nbsp;<span class="op" id="5282630">*</span><span class="ident" id="5282631">Regexp</span>&nbsp;<span class="op" id="5282638">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282641">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282694">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282741">if</span>&nbsp;<span class="ident" id="5282744">sub</span><span class="op" id="5282747">.</span><span class="ident" id="5282748">Op</span>&nbsp;<span class="op" id="5282751">==</span>&nbsp;<span class="ident" id="5282754">OpEmptyMatch</span>&nbsp;<span class="op" id="5282767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282771">return</span>&nbsp;<span class="ident" id="5282778">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282783">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282786">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282839">if</span>&nbsp;<span class="ident" id="5282842">op</span>&nbsp;<span class="op" id="5282845">==</span>&nbsp;<span class="ident" id="5282848">sub</span><span class="op" id="5282851">.</span><span class="ident" id="5282852">Op</span>&nbsp;<span class="op" id="5282855">&amp;&amp;</span>&nbsp;<span class="ident" id="5282858">flags</span><span class="op" id="5282863">&amp;</span><span class="ident" id="5282864">NonGreedy</span>&nbsp;<span class="op" id="5282874">==</span>&nbsp;<span class="ident" id="5282877">sub</span><span class="op" id="5282880">.</span><span class="ident" id="5282881">Flags</span><span class="op" id="5282886">&amp;</span><span class="ident" id="5282887">NonGreedy</span>&nbsp;<span class="op" id="5282897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282901">return</span>&nbsp;<span class="ident" id="5282908">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282916">if</span>&nbsp;<span class="ident" id="5282919">re</span>&nbsp;<span class="op" id="5282922">!=</span>&nbsp;<span class="builtintype" id="5282925">nil</span>&nbsp;<span class="op" id="5282929">&amp;&amp;</span>&nbsp;<span class="ident" id="5282932">re</span><span class="op" id="5282934">.</span><span class="ident" id="5282935">Op</span>&nbsp;<span class="op" id="5282938">==</span>&nbsp;<span class="ident" id="5282941">op</span>&nbsp;<span class="op" id="5282944">&amp;&amp;</span>&nbsp;<span class="ident" id="5282947">re</span><span class="op" id="5282949">.</span><span class="ident" id="5282950">Flags</span><span class="op" id="5282955">&amp;</span><span class="ident" id="5282956">NonGreedy</span>&nbsp;<span class="op" id="5282966">==</span>&nbsp;<span class="ident" id="5282969">flags</span><span class="op" id="5282974">&amp;</span><span class="ident" id="5282975">NonGreedy</span>&nbsp;<span class="op" id="5282985">&amp;&amp;</span>&nbsp;<span class="ident" id="5282988">sub</span>&nbsp;<span class="op" id="5282992">==</span>&nbsp;<span class="ident" id="5282995">re</span><span class="op" id="5282997">.</span><span class="ident" id="5282998">Sub</span><span class="op" id="5283001">[</span><span class="num" id="5283002">0</span><span class="op" id="5283003">]</span>&nbsp;<span class="op" id="5283005">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283009">return</span>&nbsp;<span class="ident" id="5283016">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283024">re</span>&nbsp;<span class="op" id="5283027">=</span>&nbsp;<span class="op" id="5283029">&amp;</span><span class="ident" id="5283030">Regexp</span><span class="op" id="5283036">{</span><span class="ident" id="5283037">Op</span><span class="op" id="5283039">:</span>&nbsp;<span class="ident" id="5283041">op</span><span class="op" id="5283043">,</span>&nbsp;<span class="ident" id="5283045">Flags</span><span class="op" id="5283050">:</span>&nbsp;<span class="ident" id="5283052">flags</span><span class="op" id="5283057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283060">re</span><span class="op" id="5283062">.</span><span class="ident" id="5283063">Sub</span>&nbsp;<span class="op" id="5283067">=</span>&nbsp;<span class="builtinfunc" id="5283069">append</span><span class="op" id="5283075">(</span><span class="ident" id="5283076">re</span><span class="op" id="5283078">.</span><span class="ident" id="5283079">Sub0</span><span class="op" id="5283083">[</span><span class="op" id="5283084">:</span><span class="num" id="5283085">0</span><span class="op" id="5283086">]</span><span class="op" id="5283087">,</span>&nbsp;<span class="ident" id="5283089">sub</span><span class="op" id="5283092">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283095">return</span>&nbsp;<span class="ident" id="5283102">re</span><br>
<span class="lineno"></span><span class="op" id="5283105">}</span>
</div>
</body>
</html>
