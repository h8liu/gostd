<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8491697">package</span>&nbsp;<span class="ident" id="8491705">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8491712">import</span>&nbsp;<span class="op" id="8491719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8491722">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8491732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8491735">func</span>&nbsp;<span class="ident" id="8491740">TestInstBr</span><span class="op" id="8491750">(</span><span class="ident" id="8491751">t</span>&nbsp;<span class="op" id="8491753">*</span><span class="ident" id="8491754">testing</span><span class="op" id="8491761">.</span><span class="ident" id="8491762">T</span><span class="op" id="8491763">)</span>&nbsp;<span class="op" id="8491765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491768">m</span>&nbsp;<span class="op" id="8491770">:=</span>&nbsp;<span class="ident" id="8491773">newPhyMemory</span><span class="op" id="8491785">(</span><span class="ident" id="8491786">PageSize</span>&nbsp;<span class="op" id="8491795">*</span>&nbsp;<span class="num" id="8491797">16</span><span class="op" id="8491799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491802">cpu</span>&nbsp;<span class="op" id="8491806">:=</span>&nbsp;<span class="ident" id="8491809">newCPU</span><span class="op" id="8491815">(</span><span class="ident" id="8491816">m</span><span class="op" id="8491817">,</span>&nbsp;<span class="builtinfunc" id="8491819">new</span><span class="op" id="8491822">(</span><span class="ident" id="8491823">instBr</span><span class="op" id="8491829">)</span><span class="op" id="8491830">,</span>&nbsp;<span class="num" id="8491832">0</span><span class="op" id="8491833">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8491837">for</span>&nbsp;<span class="ident" id="8491841">i</span>&nbsp;<span class="op" id="8491843">:=</span>&nbsp;<span class="num" id="8491846">0</span><span class="op" id="8491847">;</span>&nbsp;<span class="ident" id="8491849">i</span>&nbsp;<span class="op" id="8491851">&lt;</span>&nbsp;<span class="num" id="8491853">4</span><span class="op" id="8491854">;</span>&nbsp;<span class="ident" id="8491856">i</span><span class="op" id="8491857">++</span>&nbsp;<span class="op" id="8491860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491864">cpu</span><span class="op" id="8491867">.</span><span class="ident" id="8491868">regs</span><span class="op" id="8491872">[</span><span class="ident" id="8491873">i</span><span class="op" id="8491874">]</span>&nbsp;<span class="op" id="8491876">=</span>&nbsp;<span class="builtintype" id="8491878">uint32</span><span class="op" id="8491884">(</span><span class="ident" id="8491885">i</span><span class="op" id="8491886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8491889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491893">bne</span>&nbsp;<span class="op" id="8491897">:=</span>&nbsp;<span class="keyword" id="8491900">func</span><span class="op" id="8491904">(</span><span class="ident" id="8491905">s1</span><span class="op" id="8491907">,</span>&nbsp;<span class="ident" id="8491909">s2</span>&nbsp;<span class="builtintype" id="8491912">uint32</span><span class="op" id="8491918">,</span>&nbsp;<span class="ident" id="8491920">off</span>&nbsp;<span class="builtintype" id="8491924">int32</span><span class="op" id="8491929">)</span>&nbsp;<span class="builtintype" id="8491931">uint32</span>&nbsp;<span class="op" id="8491938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491942">in</span>&nbsp;<span class="op" id="8491945">:=</span>&nbsp;<span class="builtintype" id="8491948">uint32</span><span class="op" id="8491954">(</span><span class="num" id="8491955">32</span><span class="op" id="8491957">)</span>&nbsp;<span class="op" id="8491959">&lt;&lt;</span>&nbsp;<span class="num" id="8491962">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491967">in</span>&nbsp;<span class="op" id="8491970">|=</span>&nbsp;<span class="op" id="8491973">(</span><span class="ident" id="8491974">s1</span>&nbsp;<span class="op" id="8491977">&amp;</span>&nbsp;<span class="num" id="8491979">0x7</span><span class="op" id="8491982">)</span>&nbsp;<span class="op" id="8491984">&lt;&lt;</span>&nbsp;<span class="num" id="8491987">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491992">in</span>&nbsp;<span class="op" id="8491995">|=</span>&nbsp;<span class="op" id="8491998">(</span><span class="ident" id="8491999">s2</span>&nbsp;<span class="op" id="8492002">&amp;</span>&nbsp;<span class="num" id="8492004">0x7</span><span class="op" id="8492007">)</span>&nbsp;<span class="op" id="8492009">&lt;&lt;</span>&nbsp;<span class="num" id="8492012">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492017">in</span>&nbsp;<span class="op" id="8492020">|=</span>&nbsp;<span class="builtintype" id="8492023">uint32</span><span class="op" id="8492029">(</span><span class="ident" id="8492030">off</span><span class="op" id="8492033">)</span>&nbsp;<span class="op" id="8492035">&amp;</span>&nbsp;<span class="num" id="8492037">0x3ffff</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8492047">return</span>&nbsp;<span class="ident" id="8492054">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492062">beq</span>&nbsp;<span class="op" id="8492066">:=</span>&nbsp;<span class="keyword" id="8492069">func</span><span class="op" id="8492073">(</span><span class="ident" id="8492074">s1</span><span class="op" id="8492076">,</span>&nbsp;<span class="ident" id="8492078">s2</span>&nbsp;<span class="builtintype" id="8492081">uint32</span><span class="op" id="8492087">,</span>&nbsp;<span class="ident" id="8492089">off</span>&nbsp;<span class="builtintype" id="8492093">int32</span><span class="op" id="8492098">)</span>&nbsp;<span class="builtintype" id="8492100">uint32</span>&nbsp;<span class="op" id="8492107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492111">in</span>&nbsp;<span class="op" id="8492114">:=</span>&nbsp;<span class="builtintype" id="8492117">uint32</span><span class="op" id="8492123">(</span><span class="num" id="8492124">33</span><span class="op" id="8492126">)</span>&nbsp;<span class="op" id="8492128">&lt;&lt;</span>&nbsp;<span class="num" id="8492131">24</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492136">in</span>&nbsp;<span class="op" id="8492139">|=</span>&nbsp;<span class="op" id="8492142">(</span><span class="ident" id="8492143">s1</span>&nbsp;<span class="op" id="8492146">&amp;</span>&nbsp;<span class="num" id="8492148">0x7</span><span class="op" id="8492151">)</span>&nbsp;<span class="op" id="8492153">&lt;&lt;</span>&nbsp;<span class="num" id="8492156">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492161">in</span>&nbsp;<span class="op" id="8492164">|=</span>&nbsp;<span class="op" id="8492167">(</span><span class="ident" id="8492168">s2</span>&nbsp;<span class="op" id="8492171">&amp;</span>&nbsp;<span class="num" id="8492173">0x7</span><span class="op" id="8492176">)</span>&nbsp;<span class="op" id="8492178">&lt;&lt;</span>&nbsp;<span class="num" id="8492181">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492186">in</span>&nbsp;<span class="op" id="8492189">|=</span>&nbsp;<span class="builtintype" id="8492192">uint32</span><span class="op" id="8492198">(</span><span class="ident" id="8492199">off</span><span class="op" id="8492202">)</span>&nbsp;<span class="op" id="8492204">&amp;</span>&nbsp;<span class="num" id="8492206">0x3ffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8492216">return</span>&nbsp;<span class="ident" id="8492223">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492227">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492231">wr</span>&nbsp;<span class="op" id="8492234">:=</span>&nbsp;<span class="keyword" id="8492237">func</span><span class="op" id="8492241">(</span><span class="ident" id="8492242">addr</span><span class="op" id="8492246">,</span>&nbsp;<span class="ident" id="8492248">w</span>&nbsp;<span class="builtintype" id="8492250">uint32</span><span class="op" id="8492256">)</span>&nbsp;<span class="op" id="8492258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492262">e</span>&nbsp;<span class="op" id="8492264">:=</span>&nbsp;<span class="ident" id="8492267">m</span><span class="op" id="8492268">.</span><span class="ident" id="8492269">WriteWord</span><span class="op" id="8492278">(</span><span class="ident" id="8492279">addr</span><span class="op" id="8492283">,</span>&nbsp;<span class="ident" id="8492285">w</span><span class="op" id="8492286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8492290">if</span>&nbsp;<span class="ident" id="8492293">e</span>&nbsp;<span class="op" id="8492295">!=</span>&nbsp;<span class="ident" id="8492298">nil</span>&nbsp;<span class="op" id="8492302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492307">t</span><span class="op" id="8492308">.</span><span class="ident" id="8492309">Fatal</span><span class="op" id="8492314">(</span><span class="ident" id="8492315">e</span><span class="op" id="8492316">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492327">wr</span><span class="op" id="8492329">(</span><span class="ident" id="8492330">InitPC</span><span class="op" id="8492336">,</span>&nbsp;<span class="ident" id="8492338">beq</span><span class="op" id="8492341">(</span><span class="num" id="8492342">0</span><span class="op" id="8492343">,</span>&nbsp;<span class="num" id="8492345">0</span><span class="op" id="8492346">,</span>&nbsp;<span class="num" id="8492348">1</span><span class="op" id="8492349">)</span><span class="op" id="8492350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492353">wr</span><span class="op" id="8492355">(</span><span class="ident" id="8492356">InitPC</span><span class="op" id="8492362">+</span><span class="num" id="8492363">4</span><span class="op" id="8492364">,</span>&nbsp;<span class="ident" id="8492366">beq</span><span class="op" id="8492369">(</span><span class="num" id="8492370">3</span><span class="op" id="8492371">,</span>&nbsp;<span class="num" id="8492373">3</span><span class="op" id="8492374">,</span>&nbsp;<span class="op" id="8492376">-</span><span class="num" id="8492377">1</span><span class="op" id="8492378">)</span><span class="op" id="8492379">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492382">wr</span><span class="op" id="8492384">(</span><span class="ident" id="8492385">InitPC</span><span class="op" id="8492391">+</span><span class="num" id="8492392">8</span><span class="op" id="8492393">,</span>&nbsp;<span class="ident" id="8492395">bne</span><span class="op" id="8492398">(</span><span class="num" id="8492399">1</span><span class="op" id="8492400">,</span>&nbsp;<span class="num" id="8492402">2</span><span class="op" id="8492403">,</span>&nbsp;<span class="op" id="8492405">-</span><span class="num" id="8492406">2</span><span class="op" id="8492407">)</span><span class="op" id="8492408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492412">tick</span>&nbsp;<span class="op" id="8492417">:=</span>&nbsp;<span class="keyword" id="8492420">func</span><span class="op" id="8492424">(</span><span class="ident" id="8492425">exp</span>&nbsp;<span class="builtintype" id="8492429">uint32</span><span class="op" id="8492435">)</span>&nbsp;<span class="op" id="8492437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492441">e</span>&nbsp;<span class="op" id="8492443">:=</span>&nbsp;<span class="ident" id="8492446">cpu</span><span class="op" id="8492449">.</span><span class="ident" id="8492450">Tick</span><span class="op" id="8492454">(</span><span class="op" id="8492455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8492459">if</span>&nbsp;<span class="ident" id="8492462">e</span>&nbsp;<span class="op" id="8492464">!=</span>&nbsp;<span class="ident" id="8492467">nil</span>&nbsp;<span class="op" id="8492471">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492476">t</span><span class="op" id="8492477">.</span><span class="ident" id="8492478">Fatal</span><span class="op" id="8492483">(</span><span class="string" id="8492484">&#34;unexpected&nbsp;exception&#34;</span><span class="op" id="8492506">,</span>&nbsp;<span class="ident" id="8492508">e</span><span class="op" id="8492509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492518">pc</span>&nbsp;<span class="op" id="8492521">:=</span>&nbsp;<span class="ident" id="8492524">cpu</span><span class="op" id="8492527">.</span><span class="ident" id="8492528">regs</span><span class="op" id="8492532">[</span><span class="ident" id="8492533">PC</span><span class="op" id="8492535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8492539">if</span>&nbsp;<span class="ident" id="8492542">pc</span>&nbsp;<span class="op" id="8492545">!=</span>&nbsp;<span class="ident" id="8492548">exp</span>&nbsp;<span class="op" id="8492552">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492557">t</span><span class="op" id="8492558">.</span><span class="ident" id="8492559">Fatalf</span><span class="op" id="8492565">(</span><span class="string" id="8492566">&#34;expect&nbsp;pc&nbsp;0x%08x,&nbsp;got&nbsp;0x%08x&#34;</span><span class="op" id="8492596">,</span>&nbsp;<span class="ident" id="8492598">exp</span><span class="op" id="8492601">,</span>&nbsp;<span class="ident" id="8492603">pc</span><span class="op" id="8492605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492616">tick</span><span class="op" id="8492620">(</span><span class="ident" id="8492621">InitPC</span>&nbsp;<span class="op" id="8492628">+</span>&nbsp;<span class="num" id="8492630">8</span><span class="op" id="8492631">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492634">tick</span><span class="op" id="8492638">(</span><span class="ident" id="8492639">InitPC</span>&nbsp;<span class="op" id="8492646">+</span>&nbsp;<span class="num" id="8492648">4</span><span class="op" id="8492649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492652">tick</span><span class="op" id="8492656">(</span><span class="ident" id="8492657">InitPC</span>&nbsp;<span class="op" id="8492664">+</span>&nbsp;<span class="num" id="8492666">4</span><span class="op" id="8492667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492670">tick</span><span class="op" id="8492674">(</span><span class="ident" id="8492675">InitPC</span>&nbsp;<span class="op" id="8492682">+</span>&nbsp;<span class="num" id="8492684">4</span><span class="op" id="8492685">)</span><br>
<span class="lineno"></span><span class="op" id="8492687">}</span>
</div>
</body>
</html>
