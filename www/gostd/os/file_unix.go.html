<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2336652">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2336707">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2336761">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2336812">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2336882">package</span>&nbsp;<span class="ident" id="2336890">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2336894">import</span>&nbsp;<span class="op" id="2336901">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2336904">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2336915">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2336930">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2336940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2336943">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2336987">type</span>&nbsp;<span class="ident" id="2336992">File</span>&nbsp;<span class="keyword" id="2336997">struct</span>&nbsp;<span class="op" id="2337004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337007">*</span><span class="ident" id="2337008">file</span><br>
<span class="lineno"></span><span class="op" id="2337013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2337016">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2337061">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2337125">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2337185">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2337224">type</span>&nbsp;<span class="ident" id="2337229">file</span>&nbsp;<span class="keyword" id="2337234">struct</span>&nbsp;<span class="op" id="2337241">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337244">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2337252">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337257">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2337265">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337273">dirinfo</span>&nbsp;<span class="op" id="2337281">*</span><span class="ident" id="2337282">dirInfo</span>&nbsp;<span class="comment" id="2337290">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337326">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2337334">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2337343">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2337383">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2337386">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2337460">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2337548">func</span>&nbsp;<span class="op" id="2337553">(</span><span class="ident" id="2337554">f</span>&nbsp;<span class="op" id="2337556">*</span><span class="ident" id="2337557">File</span><span class="op" id="2337561">)</span>&nbsp;<span class="ident" id="2337563">Fd</span><span class="op" id="2337565">(</span><span class="op" id="2337566">)</span>&nbsp;<span class="builtintype" id="2337568">uintptr</span>&nbsp;<span class="op" id="2337576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337579">if</span>&nbsp;<span class="ident" id="2337582">f</span>&nbsp;<span class="op" id="2337584">==</span>&nbsp;<span class="ident" id="2337587">nil</span>&nbsp;<span class="op" id="2337591">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337595">return</span>&nbsp;<span class="op" id="2337602">^</span><span class="op" id="2337603">(</span><span class="builtintype" id="2337604">uintptr</span><span class="op" id="2337611">(</span><span class="num" id="2337612">0</span><span class="op" id="2337613">)</span><span class="op" id="2337614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337620">return</span>&nbsp;<span class="builtintype" id="2337627">uintptr</span><span class="op" id="2337634">(</span><span class="ident" id="2337635">f</span><span class="op" id="2337636">.</span><span class="ident" id="2337637">fd</span><span class="op" id="2337639">)</span><br>
<span class="lineno"></span><span class="op" id="2337641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2337644">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2337715">func</span>&nbsp;<span class="ident" id="2337720">NewFile</span><span class="op" id="2337727">(</span><span class="ident" id="2337728">fd</span>&nbsp;<span class="builtintype" id="2337731">uintptr</span><span class="op" id="2337738">,</span>&nbsp;<span class="ident" id="2337740">name</span>&nbsp;<span class="builtintype" id="2337745">string</span><span class="op" id="2337751">)</span>&nbsp;<span class="op" id="2337753">*</span><span class="ident" id="2337754">File</span>&nbsp;<span class="op" id="2337759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337762">fdi</span>&nbsp;<span class="op" id="2337766">:=</span>&nbsp;<span class="builtintype" id="2337769">int</span><span class="op" id="2337772">(</span><span class="ident" id="2337773">fd</span><span class="op" id="2337775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337778">if</span>&nbsp;<span class="ident" id="2337781">fdi</span>&nbsp;<span class="op" id="2337785">&lt;</span>&nbsp;<span class="num" id="2337787">0</span>&nbsp;<span class="op" id="2337789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337793">return</span>&nbsp;<span class="ident" id="2337800">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337808">f</span>&nbsp;<span class="op" id="2337810">:=</span>&nbsp;<span class="op" id="2337813">&amp;</span><span class="ident" id="2337814">File</span><span class="op" id="2337818">{</span><span class="op" id="2337819">&amp;</span><span class="ident" id="2337820">file</span><span class="op" id="2337824">{</span><span class="ident" id="2337825">fd</span><span class="op" id="2337827">:</span>&nbsp;<span class="ident" id="2337829">fdi</span><span class="op" id="2337832">,</span>&nbsp;<span class="ident" id="2337834">name</span><span class="op" id="2337838">:</span>&nbsp;<span class="ident" id="2337840">name</span><span class="op" id="2337844">}</span><span class="op" id="2337845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337848">runtime</span><span class="op" id="2337855">.</span><span class="ident" id="2337856">SetFinalizer</span><span class="op" id="2337868">(</span><span class="ident" id="2337869">f</span><span class="op" id="2337870">.</span><span class="ident" id="2337871">file</span><span class="op" id="2337875">,</span>&nbsp;<span class="op" id="2337877">(</span><span class="op" id="2337878">*</span><span class="ident" id="2337879">file</span><span class="op" id="2337883">)</span><span class="op" id="2337884">.</span><span class="builtinfunc" id="2337885">close</span><span class="op" id="2337890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337893">return</span>&nbsp;<span class="ident" id="2337900">f</span><br>
<span class="lineno"></span><span class="op" id="2337902">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2337905">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2337964">type</span>&nbsp;<span class="ident" id="2337969">dirInfo</span>&nbsp;<span class="keyword" id="2337977">struct</span>&nbsp;<span class="op" id="2337984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337987">buf</span>&nbsp;&nbsp;<span class="op" id="2337992">[</span><span class="op" id="2337993">]</span><span class="builtintype" id="2337994">byte</span>&nbsp;<span class="comment" id="2337999">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338028">nbuf</span>&nbsp;<span class="builtintype" id="2338033">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2338040">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338091">bufp</span>&nbsp;<span class="builtintype" id="2338096">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2338103">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2338138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2338141">func</span>&nbsp;<span class="ident" id="2338146">epipecheck</span><span class="op" id="2338156">(</span><span class="ident" id="2338157">file</span>&nbsp;<span class="op" id="2338162">*</span><span class="ident" id="2338163">File</span><span class="op" id="2338167">,</span>&nbsp;<span class="ident" id="2338169">e</span>&nbsp;<span class="builtintype" id="2338171">error</span><span class="op" id="2338176">)</span>&nbsp;<span class="op" id="2338178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338181">if</span>&nbsp;<span class="ident" id="2338184">e</span>&nbsp;<span class="op" id="2338186">==</span>&nbsp;<span class="ident" id="2338189">syscall</span><span class="op" id="2338196">.</span><span class="ident" id="2338197">EPIPE</span>&nbsp;<span class="op" id="2338203">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338207">if</span>&nbsp;<span class="ident" id="2338210">atomic</span><span class="op" id="2338216">.</span><span class="ident" id="2338217">AddInt32</span><span class="op" id="2338225">(</span><span class="op" id="2338226">&amp;</span><span class="ident" id="2338227">file</span><span class="op" id="2338231">.</span><span class="ident" id="2338232">nepipe</span><span class="op" id="2338238">,</span>&nbsp;<span class="num" id="2338240">1</span><span class="op" id="2338241">)</span>&nbsp;<span class="op" id="2338243">&gt;=</span>&nbsp;<span class="num" id="2338246">10</span>&nbsp;<span class="op" id="2338249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338254">sigpipe</span><span class="op" id="2338261">(</span><span class="op" id="2338262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2338266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2338269">}</span>&nbsp;<span class="keyword" id="2338271">else</span>&nbsp;<span class="op" id="2338276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338280">atomic</span><span class="op" id="2338286">.</span><span class="ident" id="2338287">StoreInt32</span><span class="op" id="2338297">(</span><span class="op" id="2338298">&amp;</span><span class="ident" id="2338299">file</span><span class="op" id="2338303">.</span><span class="ident" id="2338304">nepipe</span><span class="op" id="2338310">,</span>&nbsp;<span class="num" id="2338312">0</span><span class="op" id="2338313">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2338316">}</span><br>
<span class="lineno"></span><span class="op" id="2338318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2338321">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2338387">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2338450">const</span>&nbsp;<span class="ident" id="2338456">DevNull</span>&nbsp;<span class="op" id="2338464">=</span>&nbsp;<span class="string" id="2338466">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2338479">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2338546">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2338613">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2338685">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2338738">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2338794">func</span>&nbsp;<span class="ident" id="2338799">OpenFile</span><span class="op" id="2338807">(</span><span class="ident" id="2338808">name</span>&nbsp;<span class="builtintype" id="2338813">string</span><span class="op" id="2338819">,</span>&nbsp;<span class="ident" id="2338821">flag</span>&nbsp;<span class="builtintype" id="2338826">int</span><span class="op" id="2338829">,</span>&nbsp;<span class="ident" id="2338831">perm</span>&nbsp;<span class="ident" id="2338836">FileMode</span><span class="op" id="2338844">)</span>&nbsp;<span class="op" id="2338846">(</span><span class="ident" id="2338847">file</span>&nbsp;<span class="op" id="2338852">*</span><span class="ident" id="2338853">File</span><span class="op" id="2338857">,</span>&nbsp;<span class="ident" id="2338859">err</span>&nbsp;<span class="builtintype" id="2338863">error</span><span class="op" id="2338868">)</span>&nbsp;<span class="op" id="2338870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338873">r</span><span class="op" id="2338874">,</span>&nbsp;<span class="ident" id="2338876">e</span>&nbsp;<span class="op" id="2338878">:=</span>&nbsp;<span class="ident" id="2338881">syscall</span><span class="op" id="2338888">.</span><span class="ident" id="2338889">Open</span><span class="op" id="2338893">(</span><span class="ident" id="2338894">name</span><span class="op" id="2338898">,</span>&nbsp;<span class="ident" id="2338900">flag</span><span class="op" id="2338904">|</span><span class="ident" id="2338905">syscall</span><span class="op" id="2338912">.</span><span class="ident" id="2338913">O_CLOEXEC</span><span class="op" id="2338922">,</span>&nbsp;<span class="ident" id="2338924">syscallMode</span><span class="op" id="2338935">(</span><span class="ident" id="2338936">perm</span><span class="op" id="2338940">)</span><span class="op" id="2338941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338944">if</span>&nbsp;<span class="ident" id="2338947">e</span>&nbsp;<span class="op" id="2338949">!=</span>&nbsp;<span class="ident" id="2338952">nil</span>&nbsp;<span class="op" id="2338956">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338960">return</span>&nbsp;<span class="ident" id="2338967">nil</span><span class="op" id="2338970">,</span>&nbsp;<span class="op" id="2338972">&amp;</span><span class="ident" id="2338973">PathError</span><span class="op" id="2338982">{</span><span class="string" id="2338983">&#34;open&#34;</span><span class="op" id="2338989">,</span>&nbsp;<span class="ident" id="2338991">name</span><span class="op" id="2338995">,</span>&nbsp;<span class="ident" id="2338997">e</span><span class="op" id="2338998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2339005">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2339058">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339114">if</span>&nbsp;<span class="op" id="2339117">!</span><span class="ident" id="2339118">supportsCloseOnExec</span>&nbsp;<span class="op" id="2339138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339142">syscall</span><span class="op" id="2339149">.</span><span class="ident" id="2339150">CloseOnExec</span><span class="op" id="2339161">(</span><span class="ident" id="2339162">r</span><span class="op" id="2339163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339170">return</span>&nbsp;<span class="ident" id="2339177">NewFile</span><span class="op" id="2339184">(</span><span class="builtintype" id="2339185">uintptr</span><span class="op" id="2339192">(</span><span class="ident" id="2339193">r</span><span class="op" id="2339194">)</span><span class="op" id="2339195">,</span>&nbsp;<span class="ident" id="2339197">name</span><span class="op" id="2339201">)</span><span class="op" id="2339202">,</span>&nbsp;<span class="ident" id="2339204">nil</span><br>
<span class="lineno">90</span><span class="op" id="2339208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2339211">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2339268">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2339300">func</span>&nbsp;<span class="op" id="2339305">(</span><span class="ident" id="2339306">f</span>&nbsp;<span class="op" id="2339308">*</span><span class="ident" id="2339309">File</span><span class="op" id="2339313">)</span>&nbsp;<span class="ident" id="2339315">Close</span><span class="op" id="2339320">(</span><span class="op" id="2339321">)</span>&nbsp;<span class="builtintype" id="2339323">error</span>&nbsp;<span class="op" id="2339329">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339332">if</span>&nbsp;<span class="ident" id="2339335">f</span>&nbsp;<span class="op" id="2339337">==</span>&nbsp;<span class="ident" id="2339340">nil</span>&nbsp;<span class="op" id="2339344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339348">return</span>&nbsp;<span class="ident" id="2339355">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339370">return</span>&nbsp;<span class="ident" id="2339377">f</span><span class="op" id="2339378">.</span><span class="ident" id="2339379">file</span><span class="op" id="2339383">.</span><span class="builtinfunc" id="2339384">close</span><span class="op" id="2339389">(</span><span class="op" id="2339390">)</span><br>
<span class="lineno"></span><span class="op" id="2339392">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2339395">func</span>&nbsp;<span class="op" id="2339400">(</span><span class="ident" id="2339401">file</span>&nbsp;<span class="op" id="2339406">*</span><span class="ident" id="2339407">file</span><span class="op" id="2339411">)</span>&nbsp;<span class="builtinfunc" id="2339413">close</span><span class="op" id="2339418">(</span><span class="op" id="2339419">)</span>&nbsp;<span class="builtintype" id="2339421">error</span>&nbsp;<span class="op" id="2339427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339430">if</span>&nbsp;<span class="ident" id="2339433">file</span>&nbsp;<span class="op" id="2339438">==</span>&nbsp;<span class="ident" id="2339441">nil</span>&nbsp;<span class="op" id="2339445">||</span>&nbsp;<span class="ident" id="2339448">file</span><span class="op" id="2339452">.</span><span class="ident" id="2339453">fd</span>&nbsp;<span class="op" id="2339456">&lt;</span>&nbsp;<span class="num" id="2339458">0</span>&nbsp;<span class="op" id="2339460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339464">return</span>&nbsp;<span class="ident" id="2339471">syscall</span><span class="op" id="2339478">.</span><span class="ident" id="2339479">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339487">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339490">var</span>&nbsp;<span class="ident" id="2339494">err</span>&nbsp;<span class="builtintype" id="2339498">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339505">if</span>&nbsp;<span class="ident" id="2339508">e</span>&nbsp;<span class="op" id="2339510">:=</span>&nbsp;<span class="ident" id="2339513">syscall</span><span class="op" id="2339520">.</span><span class="ident" id="2339521">Close</span><span class="op" id="2339526">(</span><span class="ident" id="2339527">file</span><span class="op" id="2339531">.</span><span class="ident" id="2339532">fd</span><span class="op" id="2339534">)</span><span class="op" id="2339535">;</span>&nbsp;<span class="ident" id="2339537">e</span>&nbsp;<span class="op" id="2339539">!=</span>&nbsp;<span class="ident" id="2339542">nil</span>&nbsp;<span class="op" id="2339546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339550">err</span>&nbsp;<span class="op" id="2339554">=</span>&nbsp;<span class="op" id="2339556">&amp;</span><span class="ident" id="2339557">PathError</span><span class="op" id="2339566">{</span><span class="string" id="2339567">&#34;close&#34;</span><span class="op" id="2339574">,</span>&nbsp;<span class="ident" id="2339576">file</span><span class="op" id="2339580">.</span><span class="ident" id="2339581">name</span><span class="op" id="2339585">,</span>&nbsp;<span class="ident" id="2339587">e</span><span class="op" id="2339588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339594">file</span><span class="op" id="2339598">.</span><span class="ident" id="2339599">fd</span>&nbsp;<span class="op" id="2339602">=</span>&nbsp;<span class="op" id="2339604">-</span><span class="num" id="2339605">1</span>&nbsp;<span class="comment" id="2339607">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2339640">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339676">runtime</span><span class="op" id="2339683">.</span><span class="ident" id="2339684">SetFinalizer</span><span class="op" id="2339696">(</span><span class="ident" id="2339697">file</span><span class="op" id="2339701">,</span>&nbsp;<span class="ident" id="2339703">nil</span><span class="op" id="2339706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339709">return</span>&nbsp;<span class="ident" id="2339716">err</span><br>
<span class="lineno"></span><span class="op" id="2339720">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2339723">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2339779">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2339835">func</span>&nbsp;<span class="op" id="2339840">(</span><span class="ident" id="2339841">f</span>&nbsp;<span class="op" id="2339843">*</span><span class="ident" id="2339844">File</span><span class="op" id="2339848">)</span>&nbsp;<span class="ident" id="2339850">Stat</span><span class="op" id="2339854">(</span><span class="op" id="2339855">)</span>&nbsp;<span class="op" id="2339857">(</span><span class="ident" id="2339858">fi</span>&nbsp;<span class="ident" id="2339861">FileInfo</span><span class="op" id="2339869">,</span>&nbsp;<span class="ident" id="2339871">err</span>&nbsp;<span class="builtintype" id="2339875">error</span><span class="op" id="2339880">)</span>&nbsp;<span class="op" id="2339882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339885">if</span>&nbsp;<span class="ident" id="2339888">f</span>&nbsp;<span class="op" id="2339890">==</span>&nbsp;<span class="ident" id="2339893">nil</span>&nbsp;<span class="op" id="2339897">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339901">return</span>&nbsp;<span class="ident" id="2339908">nil</span><span class="op" id="2339911">,</span>&nbsp;<span class="ident" id="2339913">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339928">var</span>&nbsp;<span class="ident" id="2339932">stat</span>&nbsp;<span class="ident" id="2339937">syscall</span><span class="op" id="2339944">.</span><span class="ident" id="2339945">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339953">err</span>&nbsp;<span class="op" id="2339957">=</span>&nbsp;<span class="ident" id="2339959">syscall</span><span class="op" id="2339966">.</span><span class="ident" id="2339967">Fstat</span><span class="op" id="2339972">(</span><span class="ident" id="2339973">f</span><span class="op" id="2339974">.</span><span class="ident" id="2339975">fd</span><span class="op" id="2339977">,</span>&nbsp;<span class="op" id="2339979">&amp;</span><span class="ident" id="2339980">stat</span><span class="op" id="2339984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339987">if</span>&nbsp;<span class="ident" id="2339990">err</span>&nbsp;<span class="op" id="2339994">!=</span>&nbsp;<span class="ident" id="2339997">nil</span>&nbsp;<span class="op" id="2340001">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340005">return</span>&nbsp;<span class="ident" id="2340012">nil</span><span class="op" id="2340015">,</span>&nbsp;<span class="op" id="2340017">&amp;</span><span class="ident" id="2340018">PathError</span><span class="op" id="2340027">{</span><span class="string" id="2340028">&#34;stat&#34;</span><span class="op" id="2340034">,</span>&nbsp;<span class="ident" id="2340036">f</span><span class="op" id="2340037">.</span><span class="ident" id="2340038">name</span><span class="op" id="2340042">,</span>&nbsp;<span class="ident" id="2340044">err</span><span class="op" id="2340047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2340050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340053">return</span>&nbsp;<span class="ident" id="2340060">fileInfoFromStat</span><span class="op" id="2340076">(</span><span class="op" id="2340077">&amp;</span><span class="ident" id="2340078">stat</span><span class="op" id="2340082">,</span>&nbsp;<span class="ident" id="2340084">f</span><span class="op" id="2340085">.</span><span class="ident" id="2340086">name</span><span class="op" id="2340090">)</span><span class="op" id="2340091">,</span>&nbsp;<span class="ident" id="2340093">nil</span><br>
<span class="lineno"></span><span class="op" id="2340097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2340100">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2340154">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2340210">func</span>&nbsp;<span class="ident" id="2340215">Stat</span><span class="op" id="2340219">(</span><span class="ident" id="2340220">name</span>&nbsp;<span class="builtintype" id="2340225">string</span><span class="op" id="2340231">)</span>&nbsp;<span class="op" id="2340233">(</span><span class="ident" id="2340234">fi</span>&nbsp;<span class="ident" id="2340237">FileInfo</span><span class="op" id="2340245">,</span>&nbsp;<span class="ident" id="2340247">err</span>&nbsp;<span class="builtintype" id="2340251">error</span><span class="op" id="2340256">)</span>&nbsp;<span class="op" id="2340258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340261">var</span>&nbsp;<span class="ident" id="2340265">stat</span>&nbsp;<span class="ident" id="2340270">syscall</span><span class="op" id="2340277">.</span><span class="ident" id="2340278">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340286">err</span>&nbsp;<span class="op" id="2340290">=</span>&nbsp;<span class="ident" id="2340292">syscall</span><span class="op" id="2340299">.</span><span class="ident" id="2340300">Stat</span><span class="op" id="2340304">(</span><span class="ident" id="2340305">name</span><span class="op" id="2340309">,</span>&nbsp;<span class="op" id="2340311">&amp;</span><span class="ident" id="2340312">stat</span><span class="op" id="2340316">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340319">if</span>&nbsp;<span class="ident" id="2340322">err</span>&nbsp;<span class="op" id="2340326">!=</span>&nbsp;<span class="ident" id="2340329">nil</span>&nbsp;<span class="op" id="2340333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340337">return</span>&nbsp;<span class="ident" id="2340344">nil</span><span class="op" id="2340347">,</span>&nbsp;<span class="op" id="2340349">&amp;</span><span class="ident" id="2340350">PathError</span><span class="op" id="2340359">{</span><span class="string" id="2340360">&#34;stat&#34;</span><span class="op" id="2340366">,</span>&nbsp;<span class="ident" id="2340368">name</span><span class="op" id="2340372">,</span>&nbsp;<span class="ident" id="2340374">err</span><span class="op" id="2340377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2340380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340383">return</span>&nbsp;<span class="ident" id="2340390">fileInfoFromStat</span><span class="op" id="2340406">(</span><span class="op" id="2340407">&amp;</span><span class="ident" id="2340408">stat</span><span class="op" id="2340412">,</span>&nbsp;<span class="ident" id="2340414">name</span><span class="op" id="2340418">)</span><span class="op" id="2340419">,</span>&nbsp;<span class="ident" id="2340421">nil</span><br>
<span class="lineno"></span><span class="op" id="2340425">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2340428">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2340483">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2340540">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2340616">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2340672">func</span>&nbsp;<span class="ident" id="2340677">Lstat</span><span class="op" id="2340682">(</span><span class="ident" id="2340683">name</span>&nbsp;<span class="builtintype" id="2340688">string</span><span class="op" id="2340694">)</span>&nbsp;<span class="op" id="2340696">(</span><span class="ident" id="2340697">fi</span>&nbsp;<span class="ident" id="2340700">FileInfo</span><span class="op" id="2340708">,</span>&nbsp;<span class="ident" id="2340710">err</span>&nbsp;<span class="builtintype" id="2340714">error</span><span class="op" id="2340719">)</span>&nbsp;<span class="op" id="2340721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340724">var</span>&nbsp;<span class="ident" id="2340728">stat</span>&nbsp;<span class="ident" id="2340733">syscall</span><span class="op" id="2340740">.</span><span class="ident" id="2340741">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340749">err</span>&nbsp;<span class="op" id="2340753">=</span>&nbsp;<span class="ident" id="2340755">syscall</span><span class="op" id="2340762">.</span><span class="ident" id="2340763">Lstat</span><span class="op" id="2340768">(</span><span class="ident" id="2340769">name</span><span class="op" id="2340773">,</span>&nbsp;<span class="op" id="2340775">&amp;</span><span class="ident" id="2340776">stat</span><span class="op" id="2340780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340783">if</span>&nbsp;<span class="ident" id="2340786">err</span>&nbsp;<span class="op" id="2340790">!=</span>&nbsp;<span class="ident" id="2340793">nil</span>&nbsp;<span class="op" id="2340797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340801">return</span>&nbsp;<span class="ident" id="2340808">nil</span><span class="op" id="2340811">,</span>&nbsp;<span class="op" id="2340813">&amp;</span><span class="ident" id="2340814">PathError</span><span class="op" id="2340823">{</span><span class="string" id="2340824">&#34;lstat&#34;</span><span class="op" id="2340831">,</span>&nbsp;<span class="ident" id="2340833">name</span><span class="op" id="2340837">,</span>&nbsp;<span class="ident" id="2340839">err</span><span class="op" id="2340842">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2340845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340848">return</span>&nbsp;<span class="ident" id="2340855">fileInfoFromStat</span><span class="op" id="2340871">(</span><span class="op" id="2340872">&amp;</span><span class="ident" id="2340873">stat</span><span class="op" id="2340877">,</span>&nbsp;<span class="ident" id="2340879">name</span><span class="op" id="2340883">)</span><span class="op" id="2340884">,</span>&nbsp;<span class="ident" id="2340886">nil</span><br>
<span class="lineno"></span><span class="op" id="2340890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2340893">func</span>&nbsp;<span class="op" id="2340898">(</span><span class="ident" id="2340899">f</span>&nbsp;<span class="op" id="2340901">*</span><span class="ident" id="2340902">File</span><span class="op" id="2340906">)</span>&nbsp;<span class="ident" id="2340908">readdir</span><span class="op" id="2340915">(</span><span class="ident" id="2340916">n</span>&nbsp;<span class="builtintype" id="2340918">int</span><span class="op" id="2340921">)</span>&nbsp;<span class="op" id="2340923">(</span><span class="ident" id="2340924">fi</span>&nbsp;<span class="op" id="2340927">[</span><span class="op" id="2340928">]</span><span class="ident" id="2340929">FileInfo</span><span class="op" id="2340937">,</span>&nbsp;<span class="ident" id="2340939">err</span>&nbsp;<span class="builtintype" id="2340943">error</span><span class="op" id="2340948">)</span>&nbsp;<span class="op" id="2340950">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340953">dirname</span>&nbsp;<span class="op" id="2340961">:=</span>&nbsp;<span class="ident" id="2340964">f</span><span class="op" id="2340965">.</span><span class="ident" id="2340966">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340972">if</span>&nbsp;<span class="ident" id="2340975">dirname</span>&nbsp;<span class="op" id="2340983">==</span>&nbsp;<span class="string" id="2340986">&#34;&#34;</span>&nbsp;<span class="op" id="2340989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340993">dirname</span>&nbsp;<span class="op" id="2341001">=</span>&nbsp;<span class="string" id="2341003">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341011">names</span><span class="op" id="2341016">,</span>&nbsp;<span class="ident" id="2341018">err</span>&nbsp;<span class="op" id="2341022">:=</span>&nbsp;<span class="ident" id="2341025">f</span><span class="op" id="2341026">.</span><span class="ident" id="2341027">Readdirnames</span><span class="op" id="2341039">(</span><span class="ident" id="2341040">n</span><span class="op" id="2341041">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341044">fi</span>&nbsp;<span class="op" id="2341047">=</span>&nbsp;<span class="builtinfunc" id="2341049">make</span><span class="op" id="2341053">(</span><span class="op" id="2341054">[</span><span class="op" id="2341055">]</span><span class="ident" id="2341056">FileInfo</span><span class="op" id="2341064">,</span>&nbsp;<span class="num" id="2341066">0</span><span class="op" id="2341067">,</span>&nbsp;<span class="builtinfunc" id="2341069">len</span><span class="op" id="2341072">(</span><span class="ident" id="2341073">names</span><span class="op" id="2341078">)</span><span class="op" id="2341079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341082">for</span>&nbsp;<span class="ident" id="2341086">_</span><span class="op" id="2341087">,</span>&nbsp;<span class="ident" id="2341089">filename</span>&nbsp;<span class="op" id="2341098">:=</span>&nbsp;<span class="keyword" id="2341101">range</span>&nbsp;<span class="ident" id="2341107">names</span>&nbsp;<span class="op" id="2341113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341117">fip</span><span class="op" id="2341120">,</span>&nbsp;<span class="ident" id="2341122">lerr</span>&nbsp;<span class="op" id="2341127">:=</span>&nbsp;<span class="ident" id="2341130">lstat</span><span class="op" id="2341135">(</span><span class="ident" id="2341136">dirname</span>&nbsp;<span class="op" id="2341144">+</span>&nbsp;<span class="string" id="2341146">&#34;/&#34;</span>&nbsp;<span class="op" id="2341150">+</span>&nbsp;<span class="ident" id="2341152">filename</span><span class="op" id="2341160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341164">if</span>&nbsp;<span class="ident" id="2341167">IsNotExist</span><span class="op" id="2341177">(</span><span class="ident" id="2341178">lerr</span><span class="op" id="2341182">)</span>&nbsp;<span class="op" id="2341184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2341189">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2341236">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341279">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341294">if</span>&nbsp;<span class="ident" id="2341297">lerr</span>&nbsp;<span class="op" id="2341302">!=</span>&nbsp;<span class="ident" id="2341305">nil</span>&nbsp;<span class="op" id="2341309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341314">return</span>&nbsp;<span class="ident" id="2341321">fi</span><span class="op" id="2341323">,</span>&nbsp;<span class="ident" id="2341325">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341336">fi</span>&nbsp;<span class="op" id="2341339">=</span>&nbsp;<span class="builtinfunc" id="2341341">append</span><span class="op" id="2341347">(</span><span class="ident" id="2341348">fi</span><span class="op" id="2341350">,</span>&nbsp;<span class="ident" id="2341352">fip</span><span class="op" id="2341355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341361">return</span>&nbsp;<span class="ident" id="2341368">fi</span><span class="op" id="2341370">,</span>&nbsp;<span class="ident" id="2341372">err</span><br>
<span class="lineno"></span><span class="op" id="2341376">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2341379">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2341437">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2341491">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2341545">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2341563">const</span>&nbsp;<span class="op" id="2341569">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341572">needsMaxRW</span>&nbsp;<span class="op" id="2341583">=</span>&nbsp;<span class="ident" id="2341585">runtime</span><span class="op" id="2341592">.</span><span class="ident" id="2341593">GOOS</span>&nbsp;<span class="op" id="2341598">==</span>&nbsp;<span class="string" id="2341601">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2341610">||</span>&nbsp;<span class="ident" id="2341613">runtime</span><span class="op" id="2341620">.</span><span class="ident" id="2341621">GOOS</span>&nbsp;<span class="op" id="2341626">==</span>&nbsp;<span class="string" id="2341629">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341640">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2341651">=</span>&nbsp;<span class="num" id="2341653">1</span>&nbsp;<span class="op" id="2341655">&lt;&lt;</span>&nbsp;<span class="num" id="2341658">30</span><br>
<span class="lineno"></span><span class="op" id="2341661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2341664">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2341712">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2341773">func</span>&nbsp;<span class="op" id="2341778">(</span><span class="ident" id="2341779">f</span>&nbsp;<span class="op" id="2341781">*</span><span class="ident" id="2341782">File</span><span class="op" id="2341786">)</span>&nbsp;<span class="ident" id="2341788">read</span><span class="op" id="2341792">(</span><span class="ident" id="2341793">b</span>&nbsp;<span class="op" id="2341795">[</span><span class="op" id="2341796">]</span><span class="builtintype" id="2341797">byte</span><span class="op" id="2341801">)</span>&nbsp;<span class="op" id="2341803">(</span><span class="ident" id="2341804">n</span>&nbsp;<span class="builtintype" id="2341806">int</span><span class="op" id="2341809">,</span>&nbsp;<span class="ident" id="2341811">err</span>&nbsp;<span class="builtintype" id="2341815">error</span><span class="op" id="2341820">)</span>&nbsp;<span class="op" id="2341822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341825">if</span>&nbsp;<span class="ident" id="2341828">needsMaxRW</span>&nbsp;<span class="op" id="2341839">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2341842">len</span><span class="op" id="2341845">(</span><span class="ident" id="2341846">b</span><span class="op" id="2341847">)</span>&nbsp;<span class="op" id="2341849">&gt;</span>&nbsp;<span class="ident" id="2341851">maxRW</span>&nbsp;<span class="op" id="2341857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341861">b</span>&nbsp;<span class="op" id="2341863">=</span>&nbsp;<span class="ident" id="2341865">b</span><span class="op" id="2341866">[</span><span class="op" id="2341867">:</span><span class="ident" id="2341868">maxRW</span><span class="op" id="2341873">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341879">return</span>&nbsp;<span class="ident" id="2341886">fixCount</span><span class="op" id="2341894">(</span><span class="ident" id="2341895">syscall</span><span class="op" id="2341902">.</span><span class="ident" id="2341903">Read</span><span class="op" id="2341907">(</span><span class="ident" id="2341908">f</span><span class="op" id="2341909">.</span><span class="ident" id="2341910">fd</span><span class="op" id="2341912">,</span>&nbsp;<span class="ident" id="2341914">b</span><span class="op" id="2341915">)</span><span class="op" id="2341916">)</span><br>
<span class="lineno"></span><span class="op" id="2341918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2341921">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2341992">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2342054">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2342110">func</span>&nbsp;<span class="op" id="2342115">(</span><span class="ident" id="2342116">f</span>&nbsp;<span class="op" id="2342118">*</span><span class="ident" id="2342119">File</span><span class="op" id="2342123">)</span>&nbsp;<span class="ident" id="2342125">pread</span><span class="op" id="2342130">(</span><span class="ident" id="2342131">b</span>&nbsp;<span class="op" id="2342133">[</span><span class="op" id="2342134">]</span><span class="builtintype" id="2342135">byte</span><span class="op" id="2342139">,</span>&nbsp;<span class="ident" id="2342141">off</span>&nbsp;<span class="ident" id="2342145">int64</span><span class="op" id="2342150">)</span>&nbsp;<span class="op" id="2342152">(</span><span class="ident" id="2342153">n</span>&nbsp;<span class="builtintype" id="2342155">int</span><span class="op" id="2342158">,</span>&nbsp;<span class="ident" id="2342160">err</span>&nbsp;<span class="builtintype" id="2342164">error</span><span class="op" id="2342169">)</span>&nbsp;<span class="op" id="2342171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342174">if</span>&nbsp;<span class="ident" id="2342177">needsMaxRW</span>&nbsp;<span class="op" id="2342188">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2342191">len</span><span class="op" id="2342194">(</span><span class="ident" id="2342195">b</span><span class="op" id="2342196">)</span>&nbsp;<span class="op" id="2342198">&gt;</span>&nbsp;<span class="ident" id="2342200">maxRW</span>&nbsp;<span class="op" id="2342206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342210">b</span>&nbsp;<span class="op" id="2342212">=</span>&nbsp;<span class="ident" id="2342214">b</span><span class="op" id="2342215">[</span><span class="op" id="2342216">:</span><span class="ident" id="2342217">maxRW</span><span class="op" id="2342222">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342228">return</span>&nbsp;<span class="ident" id="2342235">fixCount</span><span class="op" id="2342243">(</span><span class="ident" id="2342244">syscall</span><span class="op" id="2342251">.</span><span class="ident" id="2342252">Pread</span><span class="op" id="2342257">(</span><span class="ident" id="2342258">f</span><span class="op" id="2342259">.</span><span class="ident" id="2342260">fd</span><span class="op" id="2342262">,</span>&nbsp;<span class="ident" id="2342264">b</span><span class="op" id="2342265">,</span>&nbsp;<span class="ident" id="2342267">off</span><span class="op" id="2342270">)</span><span class="op" id="2342271">)</span><br>
<span class="lineno"></span><span class="op" id="2342273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2342276">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2342318">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2342382">func</span>&nbsp;<span class="op" id="2342387">(</span><span class="ident" id="2342388">f</span>&nbsp;<span class="op" id="2342390">*</span><span class="ident" id="2342391">File</span><span class="op" id="2342395">)</span>&nbsp;<span class="ident" id="2342397">write</span><span class="op" id="2342402">(</span><span class="ident" id="2342403">b</span>&nbsp;<span class="op" id="2342405">[</span><span class="op" id="2342406">]</span><span class="builtintype" id="2342407">byte</span><span class="op" id="2342411">)</span>&nbsp;<span class="op" id="2342413">(</span><span class="ident" id="2342414">n</span>&nbsp;<span class="builtintype" id="2342416">int</span><span class="op" id="2342419">,</span>&nbsp;<span class="ident" id="2342421">err</span>&nbsp;<span class="builtintype" id="2342425">error</span><span class="op" id="2342430">)</span>&nbsp;<span class="op" id="2342432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342435">for</span>&nbsp;<span class="op" id="2342439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342443">bcap</span>&nbsp;<span class="op" id="2342448">:=</span>&nbsp;<span class="ident" id="2342451">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342455">if</span>&nbsp;<span class="ident" id="2342458">needsMaxRW</span>&nbsp;<span class="op" id="2342469">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2342472">len</span><span class="op" id="2342475">(</span><span class="ident" id="2342476">bcap</span><span class="op" id="2342480">)</span>&nbsp;<span class="op" id="2342482">&gt;</span>&nbsp;<span class="ident" id="2342484">maxRW</span>&nbsp;<span class="op" id="2342490">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342495">bcap</span>&nbsp;<span class="op" id="2342500">=</span>&nbsp;<span class="ident" id="2342502">bcap</span><span class="op" id="2342506">[</span><span class="op" id="2342507">:</span><span class="ident" id="2342508">maxRW</span><span class="op" id="2342513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342521">m</span><span class="op" id="2342522">,</span>&nbsp;<span class="ident" id="2342524">err</span>&nbsp;<span class="op" id="2342528">:=</span>&nbsp;<span class="ident" id="2342531">fixCount</span><span class="op" id="2342539">(</span><span class="ident" id="2342540">syscall</span><span class="op" id="2342547">.</span><span class="ident" id="2342548">Write</span><span class="op" id="2342553">(</span><span class="ident" id="2342554">f</span><span class="op" id="2342555">.</span><span class="ident" id="2342556">fd</span><span class="op" id="2342558">,</span>&nbsp;<span class="ident" id="2342560">bcap</span><span class="op" id="2342564">)</span><span class="op" id="2342565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342569">n</span>&nbsp;<span class="op" id="2342571">+=</span>&nbsp;<span class="ident" id="2342574">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342579">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342641">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342701">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342767">if</span>&nbsp;<span class="num" id="2342770">0</span>&nbsp;<span class="op" id="2342772">&lt;</span>&nbsp;<span class="ident" id="2342774">m</span>&nbsp;<span class="op" id="2342776">&amp;&amp;</span>&nbsp;<span class="ident" id="2342779">m</span>&nbsp;<span class="op" id="2342781">&lt;</span>&nbsp;<span class="builtinfunc" id="2342783">len</span><span class="op" id="2342786">(</span><span class="ident" id="2342787">bcap</span><span class="op" id="2342791">)</span>&nbsp;<span class="op" id="2342793">||</span>&nbsp;<span class="ident" id="2342796">err</span>&nbsp;<span class="op" id="2342800">==</span>&nbsp;<span class="ident" id="2342803">syscall</span><span class="op" id="2342810">.</span><span class="ident" id="2342811">EINTR</span>&nbsp;<span class="op" id="2342817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342822">b</span>&nbsp;<span class="op" id="2342824">=</span>&nbsp;<span class="ident" id="2342826">b</span><span class="op" id="2342827">[</span><span class="ident" id="2342828">m</span><span class="op" id="2342829">:</span><span class="op" id="2342830">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342835">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342851">if</span>&nbsp;<span class="ident" id="2342854">needsMaxRW</span>&nbsp;<span class="op" id="2342865">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2342868">len</span><span class="op" id="2342871">(</span><span class="ident" id="2342872">bcap</span><span class="op" id="2342876">)</span>&nbsp;<span class="op" id="2342878">!=</span>&nbsp;<span class="builtinfunc" id="2342881">len</span><span class="op" id="2342884">(</span><span class="ident" id="2342885">b</span><span class="op" id="2342886">)</span>&nbsp;<span class="op" id="2342888">&amp;&amp;</span>&nbsp;<span class="ident" id="2342891">err</span>&nbsp;<span class="op" id="2342895">==</span>&nbsp;<span class="ident" id="2342898">nil</span>&nbsp;<span class="op" id="2342902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342907">b</span>&nbsp;<span class="op" id="2342909">=</span>&nbsp;<span class="ident" id="2342911">b</span><span class="op" id="2342912">[</span><span class="ident" id="2342913">m</span><span class="op" id="2342914">:</span><span class="op" id="2342915">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342920">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342936">return</span>&nbsp;<span class="ident" id="2342943">n</span><span class="op" id="2342944">,</span>&nbsp;<span class="ident" id="2342946">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342951">}</span><br>
<span class="lineno">230</span><span class="op" id="2342953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2342956">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2343027">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2343091">func</span>&nbsp;<span class="op" id="2343096">(</span><span class="ident" id="2343097">f</span>&nbsp;<span class="op" id="2343099">*</span><span class="ident" id="2343100">File</span><span class="op" id="2343104">)</span>&nbsp;<span class="ident" id="2343106">pwrite</span><span class="op" id="2343112">(</span><span class="ident" id="2343113">b</span>&nbsp;<span class="op" id="2343115">[</span><span class="op" id="2343116">]</span><span class="builtintype" id="2343117">byte</span><span class="op" id="2343121">,</span>&nbsp;<span class="ident" id="2343123">off</span>&nbsp;<span class="ident" id="2343127">int64</span><span class="op" id="2343132">)</span>&nbsp;<span class="op" id="2343134">(</span><span class="ident" id="2343135">n</span>&nbsp;<span class="builtintype" id="2343137">int</span><span class="op" id="2343140">,</span>&nbsp;<span class="ident" id="2343142">err</span>&nbsp;<span class="builtintype" id="2343146">error</span><span class="op" id="2343151">)</span>&nbsp;<span class="op" id="2343153">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343156">if</span>&nbsp;<span class="ident" id="2343159">needsMaxRW</span>&nbsp;<span class="op" id="2343170">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2343173">len</span><span class="op" id="2343176">(</span><span class="ident" id="2343177">b</span><span class="op" id="2343178">)</span>&nbsp;<span class="op" id="2343180">&gt;</span>&nbsp;<span class="ident" id="2343182">maxRW</span>&nbsp;<span class="op" id="2343188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343192">b</span>&nbsp;<span class="op" id="2343194">=</span>&nbsp;<span class="ident" id="2343196">b</span><span class="op" id="2343197">[</span><span class="op" id="2343198">:</span><span class="ident" id="2343199">maxRW</span><span class="op" id="2343204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343210">return</span>&nbsp;<span class="ident" id="2343217">fixCount</span><span class="op" id="2343225">(</span><span class="ident" id="2343226">syscall</span><span class="op" id="2343233">.</span><span class="ident" id="2343234">Pwrite</span><span class="op" id="2343240">(</span><span class="ident" id="2343241">f</span><span class="op" id="2343242">.</span><span class="ident" id="2343243">fd</span><span class="op" id="2343245">,</span>&nbsp;<span class="ident" id="2343247">b</span><span class="op" id="2343248">,</span>&nbsp;<span class="ident" id="2343250">off</span><span class="op" id="2343253">)</span><span class="op" id="2343254">)</span><br>
<span class="lineno"></span><span class="op" id="2343256">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2343259">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2343341">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2343417">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2343485">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2343536">func</span>&nbsp;<span class="op" id="2343541">(</span><span class="ident" id="2343542">f</span>&nbsp;<span class="op" id="2343544">*</span><span class="ident" id="2343545">File</span><span class="op" id="2343549">)</span>&nbsp;<span class="ident" id="2343551">seek</span><span class="op" id="2343555">(</span><span class="ident" id="2343556">offset</span>&nbsp;<span class="ident" id="2343563">int64</span><span class="op" id="2343568">,</span>&nbsp;<span class="ident" id="2343570">whence</span>&nbsp;<span class="builtintype" id="2343577">int</span><span class="op" id="2343580">)</span>&nbsp;<span class="op" id="2343582">(</span><span class="ident" id="2343583">ret</span>&nbsp;<span class="ident" id="2343587">int64</span><span class="op" id="2343592">,</span>&nbsp;<span class="ident" id="2343594">err</span>&nbsp;<span class="builtintype" id="2343598">error</span><span class="op" id="2343603">)</span>&nbsp;<span class="op" id="2343605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343608">return</span>&nbsp;<span class="ident" id="2343615">syscall</span><span class="op" id="2343622">.</span><span class="ident" id="2343623">Seek</span><span class="op" id="2343627">(</span><span class="ident" id="2343628">f</span><span class="op" id="2343629">.</span><span class="ident" id="2343630">fd</span><span class="op" id="2343632">,</span>&nbsp;<span class="ident" id="2343634">offset</span><span class="op" id="2343640">,</span>&nbsp;<span class="ident" id="2343642">whence</span><span class="op" id="2343648">)</span><br>
<span class="lineno"></span><span class="op" id="2343650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2343653">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2343701">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2343778">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2343834">func</span>&nbsp;<span class="ident" id="2343839">Truncate</span><span class="op" id="2343847">(</span><span class="ident" id="2343848">name</span>&nbsp;<span class="builtintype" id="2343853">string</span><span class="op" id="2343859">,</span>&nbsp;<span class="ident" id="2343861">size</span>&nbsp;<span class="ident" id="2343866">int64</span><span class="op" id="2343871">)</span>&nbsp;<span class="builtintype" id="2343873">error</span>&nbsp;<span class="op" id="2343879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343882">if</span>&nbsp;<span class="ident" id="2343885">e</span>&nbsp;<span class="op" id="2343887">:=</span>&nbsp;<span class="ident" id="2343890">syscall</span><span class="op" id="2343897">.</span><span class="ident" id="2343898">Truncate</span><span class="op" id="2343906">(</span><span class="ident" id="2343907">name</span><span class="op" id="2343911">,</span>&nbsp;<span class="ident" id="2343913">size</span><span class="op" id="2343917">)</span><span class="op" id="2343918">;</span>&nbsp;<span class="ident" id="2343920">e</span>&nbsp;<span class="op" id="2343922">!=</span>&nbsp;<span class="ident" id="2343925">nil</span>&nbsp;<span class="op" id="2343929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343933">return</span>&nbsp;<span class="op" id="2343940">&amp;</span><span class="ident" id="2343941">PathError</span><span class="op" id="2343950">{</span><span class="string" id="2343951">&#34;truncate&#34;</span><span class="op" id="2343961">,</span>&nbsp;<span class="ident" id="2343963">name</span><span class="op" id="2343967">,</span>&nbsp;<span class="ident" id="2343969">e</span><span class="op" id="2343970">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343976">return</span>&nbsp;<span class="ident" id="2343983">nil</span><br>
<span class="lineno"></span><span class="op" id="2343987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2343990">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2344037">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2344093">func</span>&nbsp;<span class="ident" id="2344098">Remove</span><span class="op" id="2344104">(</span><span class="ident" id="2344105">name</span>&nbsp;<span class="builtintype" id="2344110">string</span><span class="op" id="2344116">)</span>&nbsp;<span class="builtintype" id="2344118">error</span>&nbsp;<span class="op" id="2344124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344127">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344171">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344212">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344256">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344293">e</span>&nbsp;<span class="op" id="2344295">:=</span>&nbsp;<span class="ident" id="2344298">syscall</span><span class="op" id="2344305">.</span><span class="ident" id="2344306">Unlink</span><span class="op" id="2344312">(</span><span class="ident" id="2344313">name</span><span class="op" id="2344317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344320">if</span>&nbsp;<span class="ident" id="2344323">e</span>&nbsp;<span class="op" id="2344325">==</span>&nbsp;<span class="ident" id="2344328">nil</span>&nbsp;<span class="op" id="2344332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344336">return</span>&nbsp;<span class="ident" id="2344343">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344348">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344351">e1</span>&nbsp;<span class="op" id="2344354">:=</span>&nbsp;<span class="ident" id="2344357">syscall</span><span class="op" id="2344364">.</span><span class="ident" id="2344365">Rmdir</span><span class="op" id="2344370">(</span><span class="ident" id="2344371">name</span><span class="op" id="2344375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344378">if</span>&nbsp;<span class="ident" id="2344381">e1</span>&nbsp;<span class="op" id="2344384">==</span>&nbsp;<span class="ident" id="2344387">nil</span>&nbsp;<span class="op" id="2344391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344395">return</span>&nbsp;<span class="ident" id="2344402">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344411">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344462">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344511">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344560">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344609">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344663">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344714">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344769">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344818">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344849">if</span>&nbsp;<span class="ident" id="2344852">e1</span>&nbsp;<span class="op" id="2344855">!=</span>&nbsp;<span class="ident" id="2344858">syscall</span><span class="op" id="2344865">.</span><span class="ident" id="2344866">ENOTDIR</span>&nbsp;<span class="op" id="2344874">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344878">e</span>&nbsp;<span class="op" id="2344880">=</span>&nbsp;<span class="ident" id="2344882">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344889">return</span>&nbsp;<span class="op" id="2344896">&amp;</span><span class="ident" id="2344897">PathError</span><span class="op" id="2344906">{</span><span class="string" id="2344907">&#34;remove&#34;</span><span class="op" id="2344915">,</span>&nbsp;<span class="ident" id="2344917">name</span><span class="op" id="2344921">,</span>&nbsp;<span class="ident" id="2344923">e</span><span class="op" id="2344924">}</span><br>
<span class="lineno"></span><span class="op" id="2344926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2344929">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2345012">func</span>&nbsp;<span class="ident" id="2345017">basename</span><span class="op" id="2345025">(</span><span class="ident" id="2345026">name</span>&nbsp;<span class="builtintype" id="2345031">string</span><span class="op" id="2345037">)</span>&nbsp;<span class="builtintype" id="2345039">string</span>&nbsp;<span class="op" id="2345046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345049">i</span>&nbsp;<span class="op" id="2345051">:=</span>&nbsp;<span class="builtinfunc" id="2345054">len</span><span class="op" id="2345057">(</span><span class="ident" id="2345058">name</span><span class="op" id="2345062">)</span>&nbsp;<span class="op" id="2345064">-</span>&nbsp;<span class="num" id="2345066">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2345069">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345097">for</span>&nbsp;<span class="op" id="2345101">;</span>&nbsp;<span class="ident" id="2345103">i</span>&nbsp;<span class="op" id="2345105">&gt;</span>&nbsp;<span class="num" id="2345107">0</span>&nbsp;<span class="op" id="2345109">&amp;&amp;</span>&nbsp;<span class="ident" id="2345112">name</span><span class="op" id="2345116">[</span><span class="ident" id="2345117">i</span><span class="op" id="2345118">]</span>&nbsp;<span class="op" id="2345120">==</span>&nbsp;<span class="string" id="2345123">&#39;/&#39;</span><span class="op" id="2345126">;</span>&nbsp;<span class="ident" id="2345128">i</span><span class="op" id="2345129">--</span>&nbsp;<span class="op" id="2345132">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345136">name</span>&nbsp;<span class="op" id="2345141">=</span>&nbsp;<span class="ident" id="2345143">name</span><span class="op" id="2345147">[</span><span class="op" id="2345148">:</span><span class="ident" id="2345149">i</span><span class="op" id="2345150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2345156">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345190">for</span>&nbsp;<span class="ident" id="2345194">i</span><span class="op" id="2345195">--</span><span class="op" id="2345197">;</span>&nbsp;<span class="ident" id="2345199">i</span>&nbsp;<span class="op" id="2345201">&gt;=</span>&nbsp;<span class="num" id="2345204">0</span><span class="op" id="2345205">;</span>&nbsp;<span class="ident" id="2345207">i</span><span class="op" id="2345208">--</span>&nbsp;<span class="op" id="2345211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345215">if</span>&nbsp;<span class="ident" id="2345218">name</span><span class="op" id="2345222">[</span><span class="ident" id="2345223">i</span><span class="op" id="2345224">]</span>&nbsp;<span class="op" id="2345226">==</span>&nbsp;<span class="string" id="2345229">&#39;/&#39;</span>&nbsp;<span class="op" id="2345233">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345238">name</span>&nbsp;<span class="op" id="2345243">=</span>&nbsp;<span class="ident" id="2345245">name</span><span class="op" id="2345249">[</span><span class="ident" id="2345250">i</span><span class="op" id="2345251">+</span><span class="num" id="2345252">1</span><span class="op" id="2345253">:</span><span class="op" id="2345254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345259">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345274">return</span>&nbsp;<span class="ident" id="2345281">name</span><br>
<span class="lineno"></span><span class="op" id="2345286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2345289">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2345358">func</span>&nbsp;<span class="ident" id="2345363">TempDir</span><span class="op" id="2345370">(</span><span class="op" id="2345371">)</span>&nbsp;<span class="builtintype" id="2345373">string</span>&nbsp;<span class="op" id="2345380">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345383">dir</span>&nbsp;<span class="op" id="2345387">:=</span>&nbsp;<span class="ident" id="2345390">Getenv</span><span class="op" id="2345396">(</span><span class="string" id="2345397">&#34;TMPDIR&#34;</span><span class="op" id="2345405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345408">if</span>&nbsp;<span class="ident" id="2345411">dir</span>&nbsp;<span class="op" id="2345415">==</span>&nbsp;<span class="string" id="2345418">&#34;&#34;</span>&nbsp;<span class="op" id="2345421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345425">if</span>&nbsp;<span class="ident" id="2345428">runtime</span><span class="op" id="2345435">.</span><span class="ident" id="2345436">GOOS</span>&nbsp;<span class="op" id="2345441">==</span>&nbsp;<span class="string" id="2345444">&#34;android&#34;</span>&nbsp;<span class="op" id="2345454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345459">dir</span>&nbsp;<span class="op" id="2345463">=</span>&nbsp;<span class="string" id="2345465">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345485">}</span>&nbsp;<span class="keyword" id="2345487">else</span>&nbsp;<span class="op" id="2345492">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345497">dir</span>&nbsp;<span class="op" id="2345501">=</span>&nbsp;<span class="string" id="2345503">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345518">return</span>&nbsp;<span class="ident" id="2345525">dir</span><br>
<span class="lineno"></span><span class="op" id="2345529">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2345532">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2345592">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2345648">func</span>&nbsp;<span class="ident" id="2345653">Link</span><span class="op" id="2345657">(</span><span class="ident" id="2345658">oldname</span><span class="op" id="2345665">,</span>&nbsp;<span class="ident" id="2345667">newname</span>&nbsp;<span class="builtintype" id="2345675">string</span><span class="op" id="2345681">)</span>&nbsp;<span class="builtintype" id="2345683">error</span>&nbsp;<span class="op" id="2345689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345692">e</span>&nbsp;<span class="op" id="2345694">:=</span>&nbsp;<span class="ident" id="2345697">syscall</span><span class="op" id="2345704">.</span><span class="ident" id="2345705">Link</span><span class="op" id="2345709">(</span><span class="ident" id="2345710">oldname</span><span class="op" id="2345717">,</span>&nbsp;<span class="ident" id="2345719">newname</span><span class="op" id="2345726">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345729">if</span>&nbsp;<span class="ident" id="2345732">e</span>&nbsp;<span class="op" id="2345734">!=</span>&nbsp;<span class="ident" id="2345737">nil</span>&nbsp;<span class="op" id="2345741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345745">return</span>&nbsp;<span class="op" id="2345752">&amp;</span><span class="ident" id="2345753">LinkError</span><span class="op" id="2345762">{</span><span class="string" id="2345763">&#34;link&#34;</span><span class="op" id="2345769">,</span>&nbsp;<span class="ident" id="2345771">oldname</span><span class="op" id="2345778">,</span>&nbsp;<span class="ident" id="2345780">newname</span><span class="op" id="2345787">,</span>&nbsp;<span class="ident" id="2345789">e</span><span class="op" id="2345790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345796">return</span>&nbsp;<span class="ident" id="2345803">nil</span><br>
<span class="lineno"></span><span class="op" id="2345807">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2345810">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2345868">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2345924">func</span>&nbsp;<span class="ident" id="2345929">Symlink</span><span class="op" id="2345936">(</span><span class="ident" id="2345937">oldname</span><span class="op" id="2345944">,</span>&nbsp;<span class="ident" id="2345946">newname</span>&nbsp;<span class="builtintype" id="2345954">string</span><span class="op" id="2345960">)</span>&nbsp;<span class="builtintype" id="2345962">error</span>&nbsp;<span class="op" id="2345968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345971">e</span>&nbsp;<span class="op" id="2345973">:=</span>&nbsp;<span class="ident" id="2345976">syscall</span><span class="op" id="2345983">.</span><span class="ident" id="2345984">Symlink</span><span class="op" id="2345991">(</span><span class="ident" id="2345992">oldname</span><span class="op" id="2345999">,</span>&nbsp;<span class="ident" id="2346001">newname</span><span class="op" id="2346008">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346011">if</span>&nbsp;<span class="ident" id="2346014">e</span>&nbsp;<span class="op" id="2346016">!=</span>&nbsp;<span class="ident" id="2346019">nil</span>&nbsp;<span class="op" id="2346023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346027">return</span>&nbsp;<span class="op" id="2346034">&amp;</span><span class="ident" id="2346035">LinkError</span><span class="op" id="2346044">{</span><span class="string" id="2346045">&#34;symlink&#34;</span><span class="op" id="2346054">,</span>&nbsp;<span class="ident" id="2346056">oldname</span><span class="op" id="2346063">,</span>&nbsp;<span class="ident" id="2346065">newname</span><span class="op" id="2346072">,</span>&nbsp;<span class="ident" id="2346074">e</span><span class="op" id="2346075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2346078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346081">return</span>&nbsp;<span class="ident" id="2346088">nil</span><br>
<span class="lineno"></span><span class="op" id="2346092">}</span>
</div>
</body>
</html>
