<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html" class="current">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3990704">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3990759">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3990813">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3990864">package</span>&nbsp;<span class="ident" id="3990872">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3990877">import</span>&nbsp;<span class="op" id="3990884">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3990887">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3990897">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3990912">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3990926">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3990941">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3990958">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3990965">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3990968">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3991040">func</span>&nbsp;<span class="ident" id="3991045">splitPreMasterSecret</span><span class="op" id="3991065">(</span><span class="ident" id="3991066">secret</span>&nbsp;<span class="op" id="3991073">[</span><span class="op" id="3991074">]</span><span class="builtintype" id="3991075">byte</span><span class="op" id="3991079">)</span>&nbsp;<span class="op" id="3991081">(</span><span class="ident" id="3991082">s1</span><span class="op" id="3991084">,</span>&nbsp;<span class="ident" id="3991086">s2</span>&nbsp;<span class="op" id="3991089">[</span><span class="op" id="3991090">]</span><span class="builtintype" id="3991091">byte</span><span class="op" id="3991095">)</span>&nbsp;<span class="op" id="3991097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991100">s1</span>&nbsp;<span class="op" id="3991103">=</span>&nbsp;<span class="ident" id="3991105">secret</span><span class="op" id="3991111">[</span><span class="num" id="3991112">0</span>&nbsp;<span class="op" id="3991114">:</span>&nbsp;<span class="op" id="3991116">(</span><span class="builtinfunc" id="3991117">len</span><span class="op" id="3991120">(</span><span class="ident" id="3991121">secret</span><span class="op" id="3991127">)</span><span class="op" id="3991128">+</span><span class="num" id="3991129">1</span><span class="op" id="3991130">)</span><span class="op" id="3991131">/</span><span class="num" id="3991132">2</span><span class="op" id="3991133">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991136">s2</span>&nbsp;<span class="op" id="3991139">=</span>&nbsp;<span class="ident" id="3991141">secret</span><span class="op" id="3991147">[</span><span class="builtinfunc" id="3991148">len</span><span class="op" id="3991151">(</span><span class="ident" id="3991152">secret</span><span class="op" id="3991158">)</span><span class="op" id="3991159">/</span><span class="num" id="3991160">2</span><span class="op" id="3991161">:</span><span class="op" id="3991162">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3991165">return</span><br>
<span class="lineno"></span><span class="op" id="3991172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3991175">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3991251">func</span>&nbsp;<span class="ident" id="3991256">pHash</span><span class="op" id="3991261">(</span><span class="ident" id="3991262">result</span><span class="op" id="3991268">,</span>&nbsp;<span class="ident" id="3991270">secret</span><span class="op" id="3991276">,</span>&nbsp;<span class="ident" id="3991278">seed</span>&nbsp;<span class="op" id="3991283">[</span><span class="op" id="3991284">]</span><span class="builtintype" id="3991285">byte</span><span class="op" id="3991289">,</span>&nbsp;<span class="ident" id="3991291">hash</span>&nbsp;<span class="keyword" id="3991296">func</span><span class="op" id="3991300">(</span><span class="op" id="3991301">)</span>&nbsp;<span class="ident" id="3991303">hash</span><span class="op" id="3991307">.</span><span class="ident" id="3991308">Hash</span><span class="op" id="3991312">)</span>&nbsp;<span class="op" id="3991314">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991317">h</span>&nbsp;<span class="op" id="3991319">:=</span>&nbsp;<span class="ident" id="3991322">hmac</span><span class="op" id="3991326">.</span><span class="ident" id="3991327">New</span><span class="op" id="3991330">(</span><span class="ident" id="3991331">hash</span><span class="op" id="3991335">,</span>&nbsp;<span class="ident" id="3991337">secret</span><span class="op" id="3991343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991346">h</span><span class="op" id="3991347">.</span><span class="ident" id="3991348">Write</span><span class="op" id="3991353">(</span><span class="ident" id="3991354">seed</span><span class="op" id="3991358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991361">a</span>&nbsp;<span class="op" id="3991363">:=</span>&nbsp;<span class="ident" id="3991366">h</span><span class="op" id="3991367">.</span><span class="ident" id="3991368">Sum</span><span class="op" id="3991371">(</span><span class="ident" id="3991372">nil</span><span class="op" id="3991375">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991379">j</span>&nbsp;<span class="op" id="3991381">:=</span>&nbsp;<span class="num" id="3991384">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3991387">for</span>&nbsp;<span class="ident" id="3991391">j</span>&nbsp;<span class="op" id="3991393">&lt;</span>&nbsp;<span class="builtinfunc" id="3991395">len</span><span class="op" id="3991398">(</span><span class="ident" id="3991399">result</span><span class="op" id="3991405">)</span>&nbsp;<span class="op" id="3991407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991411">h</span><span class="op" id="3991412">.</span><span class="ident" id="3991413">Reset</span><span class="op" id="3991418">(</span><span class="op" id="3991419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991423">h</span><span class="op" id="3991424">.</span><span class="ident" id="3991425">Write</span><span class="op" id="3991430">(</span><span class="ident" id="3991431">a</span><span class="op" id="3991432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991436">h</span><span class="op" id="3991437">.</span><span class="ident" id="3991438">Write</span><span class="op" id="3991443">(</span><span class="ident" id="3991444">seed</span><span class="op" id="3991448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991452">b</span>&nbsp;<span class="op" id="3991454">:=</span>&nbsp;<span class="ident" id="3991457">h</span><span class="op" id="3991458">.</span><span class="ident" id="3991459">Sum</span><span class="op" id="3991462">(</span><span class="ident" id="3991463">nil</span><span class="op" id="3991466">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991470">todo</span>&nbsp;<span class="op" id="3991475">:=</span>&nbsp;<span class="builtinfunc" id="3991478">len</span><span class="op" id="3991481">(</span><span class="ident" id="3991482">b</span><span class="op" id="3991483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3991487">if</span>&nbsp;<span class="ident" id="3991490">j</span><span class="op" id="3991491">+</span><span class="ident" id="3991492">todo</span>&nbsp;<span class="op" id="3991497">&gt;</span>&nbsp;<span class="builtinfunc" id="3991499">len</span><span class="op" id="3991502">(</span><span class="ident" id="3991503">result</span><span class="op" id="3991509">)</span>&nbsp;<span class="op" id="3991511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991516">todo</span>&nbsp;<span class="op" id="3991521">=</span>&nbsp;<span class="builtinfunc" id="3991523">len</span><span class="op" id="3991526">(</span><span class="ident" id="3991527">result</span><span class="op" id="3991533">)</span>&nbsp;<span class="op" id="3991535">-</span>&nbsp;<span class="ident" id="3991537">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3991541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3991545">copy</span><span class="op" id="3991549">(</span><span class="ident" id="3991550">result</span><span class="op" id="3991556">[</span><span class="ident" id="3991557">j</span><span class="op" id="3991558">:</span><span class="ident" id="3991559">j</span><span class="op" id="3991560">+</span><span class="ident" id="3991561">todo</span><span class="op" id="3991565">]</span><span class="op" id="3991566">,</span>&nbsp;<span class="ident" id="3991568">b</span><span class="op" id="3991569">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991573">j</span>&nbsp;<span class="op" id="3991575">+=</span>&nbsp;<span class="ident" id="3991578">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991586">h</span><span class="op" id="3991587">.</span><span class="ident" id="3991588">Reset</span><span class="op" id="3991593">(</span><span class="op" id="3991594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991598">h</span><span class="op" id="3991599">.</span><span class="ident" id="3991600">Write</span><span class="op" id="3991605">(</span><span class="ident" id="3991606">a</span><span class="op" id="3991607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991611">a</span>&nbsp;<span class="op" id="3991613">=</span>&nbsp;<span class="ident" id="3991615">h</span><span class="op" id="3991616">.</span><span class="ident" id="3991617">Sum</span><span class="op" id="3991620">(</span><span class="ident" id="3991621">nil</span><span class="op" id="3991624">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3991627">}</span><br>
<span class="lineno"></span><span class="op" id="3991629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3991632">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3991723">func</span>&nbsp;<span class="ident" id="3991728">prf10</span><span class="op" id="3991733">(</span><span class="ident" id="3991734">result</span><span class="op" id="3991740">,</span>&nbsp;<span class="ident" id="3991742">secret</span><span class="op" id="3991748">,</span>&nbsp;<span class="ident" id="3991750">label</span><span class="op" id="3991755">,</span>&nbsp;<span class="ident" id="3991757">seed</span>&nbsp;<span class="op" id="3991762">[</span><span class="op" id="3991763">]</span><span class="builtintype" id="3991764">byte</span><span class="op" id="3991768">)</span>&nbsp;<span class="op" id="3991770">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991773">hashSHA1</span>&nbsp;<span class="op" id="3991782">:=</span>&nbsp;<span class="ident" id="3991785">sha1</span><span class="op" id="3991789">.</span><span class="ident" id="3991790">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991795">hashMD5</span>&nbsp;<span class="op" id="3991803">:=</span>&nbsp;<span class="ident" id="3991806">md5</span><span class="op" id="3991809">.</span><span class="ident" id="3991810">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991816">labelAndSeed</span>&nbsp;<span class="op" id="3991829">:=</span>&nbsp;<span class="builtinfunc" id="3991832">make</span><span class="op" id="3991836">(</span><span class="op" id="3991837">[</span><span class="op" id="3991838">]</span><span class="builtintype" id="3991839">byte</span><span class="op" id="3991843">,</span>&nbsp;<span class="builtinfunc" id="3991845">len</span><span class="op" id="3991848">(</span><span class="ident" id="3991849">label</span><span class="op" id="3991854">)</span><span class="op" id="3991855">+</span><span class="builtinfunc" id="3991856">len</span><span class="op" id="3991859">(</span><span class="ident" id="3991860">seed</span><span class="op" id="3991864">)</span><span class="op" id="3991865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3991868">copy</span><span class="op" id="3991872">(</span><span class="ident" id="3991873">labelAndSeed</span><span class="op" id="3991885">,</span>&nbsp;<span class="ident" id="3991887">label</span><span class="op" id="3991892">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3991895">copy</span><span class="op" id="3991899">(</span><span class="ident" id="3991900">labelAndSeed</span><span class="op" id="3991912">[</span><span class="builtinfunc" id="3991913">len</span><span class="op" id="3991916">(</span><span class="ident" id="3991917">label</span><span class="op" id="3991922">)</span><span class="op" id="3991923">:</span><span class="op" id="3991924">]</span><span class="op" id="3991925">,</span>&nbsp;<span class="ident" id="3991927">seed</span><span class="op" id="3991931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991935">s1</span><span class="op" id="3991937">,</span>&nbsp;<span class="ident" id="3991939">s2</span>&nbsp;<span class="op" id="3991942">:=</span>&nbsp;<span class="ident" id="3991945">splitPreMasterSecret</span><span class="op" id="3991965">(</span><span class="ident" id="3991966">secret</span><span class="op" id="3991972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3991975">pHash</span><span class="op" id="3991980">(</span><span class="ident" id="3991981">result</span><span class="op" id="3991987">,</span>&nbsp;<span class="ident" id="3991989">s1</span><span class="op" id="3991991">,</span>&nbsp;<span class="ident" id="3991993">labelAndSeed</span><span class="op" id="3992005">,</span>&nbsp;<span class="ident" id="3992007">hashMD5</span><span class="op" id="3992014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992017">result2</span>&nbsp;<span class="op" id="3992025">:=</span>&nbsp;<span class="builtinfunc" id="3992028">make</span><span class="op" id="3992032">(</span><span class="op" id="3992033">[</span><span class="op" id="3992034">]</span><span class="builtintype" id="3992035">byte</span><span class="op" id="3992039">,</span>&nbsp;<span class="builtinfunc" id="3992041">len</span><span class="op" id="3992044">(</span><span class="ident" id="3992045">result</span><span class="op" id="3992051">)</span><span class="op" id="3992052">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992055">pHash</span><span class="op" id="3992060">(</span><span class="ident" id="3992061">result2</span><span class="op" id="3992068">,</span>&nbsp;<span class="ident" id="3992070">s2</span><span class="op" id="3992072">,</span>&nbsp;<span class="ident" id="3992074">labelAndSeed</span><span class="op" id="3992086">,</span>&nbsp;<span class="ident" id="3992088">hashSHA1</span><span class="op" id="3992096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3992100">for</span>&nbsp;<span class="ident" id="3992104">i</span><span class="op" id="3992105">,</span>&nbsp;<span class="ident" id="3992107">b</span>&nbsp;<span class="op" id="3992109">:=</span>&nbsp;<span class="keyword" id="3992112">range</span>&nbsp;<span class="ident" id="3992118">result2</span>&nbsp;<span class="op" id="3992126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992130">result</span><span class="op" id="3992136">[</span><span class="ident" id="3992137">i</span><span class="op" id="3992138">]</span>&nbsp;<span class="op" id="3992140">^=</span>&nbsp;<span class="ident" id="3992143">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3992146">}</span><br>
<span class="lineno">65</span><span class="op" id="3992148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3992151">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3992242">func</span>&nbsp;<span class="ident" id="3992247">prf12</span><span class="op" id="3992252">(</span><span class="ident" id="3992253">result</span><span class="op" id="3992259">,</span>&nbsp;<span class="ident" id="3992261">secret</span><span class="op" id="3992267">,</span>&nbsp;<span class="ident" id="3992269">label</span><span class="op" id="3992274">,</span>&nbsp;<span class="ident" id="3992276">seed</span>&nbsp;<span class="op" id="3992281">[</span><span class="op" id="3992282">]</span><span class="builtintype" id="3992283">byte</span><span class="op" id="3992287">)</span>&nbsp;<span class="op" id="3992289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992292">labelAndSeed</span>&nbsp;<span class="op" id="3992305">:=</span>&nbsp;<span class="builtinfunc" id="3992308">make</span><span class="op" id="3992312">(</span><span class="op" id="3992313">[</span><span class="op" id="3992314">]</span><span class="builtintype" id="3992315">byte</span><span class="op" id="3992319">,</span>&nbsp;<span class="builtinfunc" id="3992321">len</span><span class="op" id="3992324">(</span><span class="ident" id="3992325">label</span><span class="op" id="3992330">)</span><span class="op" id="3992331">+</span><span class="builtinfunc" id="3992332">len</span><span class="op" id="3992335">(</span><span class="ident" id="3992336">seed</span><span class="op" id="3992340">)</span><span class="op" id="3992341">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3992344">copy</span><span class="op" id="3992348">(</span><span class="ident" id="3992349">labelAndSeed</span><span class="op" id="3992361">,</span>&nbsp;<span class="ident" id="3992363">label</span><span class="op" id="3992368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3992371">copy</span><span class="op" id="3992375">(</span><span class="ident" id="3992376">labelAndSeed</span><span class="op" id="3992388">[</span><span class="builtinfunc" id="3992389">len</span><span class="op" id="3992392">(</span><span class="ident" id="3992393">label</span><span class="op" id="3992398">)</span><span class="op" id="3992399">:</span><span class="op" id="3992400">]</span><span class="op" id="3992401">,</span>&nbsp;<span class="ident" id="3992403">seed</span><span class="op" id="3992407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992411">pHash</span><span class="op" id="3992416">(</span><span class="ident" id="3992417">result</span><span class="op" id="3992423">,</span>&nbsp;<span class="ident" id="3992425">secret</span><span class="op" id="3992431">,</span>&nbsp;<span class="ident" id="3992433">labelAndSeed</span><span class="op" id="3992445">,</span>&nbsp;<span class="ident" id="3992447">sha256</span><span class="op" id="3992453">.</span><span class="ident" id="3992454">New</span><span class="op" id="3992457">)</span><br>
<span class="lineno"></span><span class="op" id="3992459">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3992462">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3992532">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="3992605">func</span>&nbsp;<span class="ident" id="3992610">prf30</span><span class="op" id="3992615">(</span><span class="ident" id="3992616">result</span><span class="op" id="3992622">,</span>&nbsp;<span class="ident" id="3992624">secret</span><span class="op" id="3992630">,</span>&nbsp;<span class="ident" id="3992632">label</span><span class="op" id="3992637">,</span>&nbsp;<span class="ident" id="3992639">seed</span>&nbsp;<span class="op" id="3992644">[</span><span class="op" id="3992645">]</span><span class="builtintype" id="3992646">byte</span><span class="op" id="3992650">)</span>&nbsp;<span class="op" id="3992652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992655">hashSHA1</span>&nbsp;<span class="op" id="3992664">:=</span>&nbsp;<span class="ident" id="3992667">sha1</span><span class="op" id="3992671">.</span><span class="ident" id="3992672">New</span><span class="op" id="3992675">(</span><span class="op" id="3992676">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992679">hashMD5</span>&nbsp;<span class="op" id="3992687">:=</span>&nbsp;<span class="ident" id="3992690">md5</span><span class="op" id="3992693">.</span><span class="ident" id="3992694">New</span><span class="op" id="3992697">(</span><span class="op" id="3992698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992702">done</span>&nbsp;<span class="op" id="3992707">:=</span>&nbsp;<span class="num" id="3992710">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992713">i</span>&nbsp;<span class="op" id="3992715">:=</span>&nbsp;<span class="num" id="3992718">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3992721">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3992792">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3992864">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3992936">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3992955">var</span>&nbsp;<span class="ident" id="3992959">b</span>&nbsp;<span class="op" id="3992961">[</span><span class="num" id="3992962">11</span><span class="op" id="3992964">]</span><span class="builtintype" id="3992965">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3992971">for</span>&nbsp;<span class="ident" id="3992975">done</span>&nbsp;<span class="op" id="3992980">&lt;</span>&nbsp;<span class="builtinfunc" id="3992982">len</span><span class="op" id="3992985">(</span><span class="ident" id="3992986">result</span><span class="op" id="3992992">)</span>&nbsp;<span class="op" id="3992994">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3992998">for</span>&nbsp;<span class="ident" id="3993002">j</span>&nbsp;<span class="op" id="3993004">:=</span>&nbsp;<span class="num" id="3993007">0</span><span class="op" id="3993008">;</span>&nbsp;<span class="ident" id="3993010">j</span>&nbsp;<span class="op" id="3993012">&lt;=</span>&nbsp;<span class="ident" id="3993015">i</span><span class="op" id="3993016">;</span>&nbsp;<span class="ident" id="3993018">j</span><span class="op" id="3993019">++</span>&nbsp;<span class="op" id="3993022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993027">b</span><span class="op" id="3993028">[</span><span class="ident" id="3993029">j</span><span class="op" id="3993030">]</span>&nbsp;<span class="op" id="3993032">=</span>&nbsp;<span class="string" id="3993034">&#39;A&#39;</span>&nbsp;<span class="op" id="3993038">+</span>&nbsp;<span class="builtintype" id="3993040">byte</span><span class="op" id="3993044">(</span><span class="ident" id="3993045">i</span><span class="op" id="3993046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993055">hashSHA1</span><span class="op" id="3993063">.</span><span class="ident" id="3993064">Reset</span><span class="op" id="3993069">(</span><span class="op" id="3993070">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993074">hashSHA1</span><span class="op" id="3993082">.</span><span class="ident" id="3993083">Write</span><span class="op" id="3993088">(</span><span class="ident" id="3993089">b</span><span class="op" id="3993090">[</span><span class="op" id="3993091">:</span><span class="ident" id="3993092">i</span><span class="op" id="3993093">+</span><span class="num" id="3993094">1</span><span class="op" id="3993095">]</span><span class="op" id="3993096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993100">hashSHA1</span><span class="op" id="3993108">.</span><span class="ident" id="3993109">Write</span><span class="op" id="3993114">(</span><span class="ident" id="3993115">secret</span><span class="op" id="3993121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993125">hashSHA1</span><span class="op" id="3993133">.</span><span class="ident" id="3993134">Write</span><span class="op" id="3993139">(</span><span class="ident" id="3993140">seed</span><span class="op" id="3993144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993148">digest</span>&nbsp;<span class="op" id="3993155">:=</span>&nbsp;<span class="ident" id="3993158">hashSHA1</span><span class="op" id="3993166">.</span><span class="ident" id="3993167">Sum</span><span class="op" id="3993170">(</span><span class="ident" id="3993171">nil</span><span class="op" id="3993174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993179">hashMD5</span><span class="op" id="3993186">.</span><span class="ident" id="3993187">Reset</span><span class="op" id="3993192">(</span><span class="op" id="3993193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993197">hashMD5</span><span class="op" id="3993204">.</span><span class="ident" id="3993205">Write</span><span class="op" id="3993210">(</span><span class="ident" id="3993211">secret</span><span class="op" id="3993217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993221">hashMD5</span><span class="op" id="3993228">.</span><span class="ident" id="3993229">Write</span><span class="op" id="3993234">(</span><span class="ident" id="3993235">digest</span><span class="op" id="3993241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993246">done</span>&nbsp;<span class="op" id="3993251">+=</span>&nbsp;<span class="builtinfunc" id="3993254">copy</span><span class="op" id="3993258">(</span><span class="ident" id="3993259">result</span><span class="op" id="3993265">[</span><span class="ident" id="3993266">done</span><span class="op" id="3993270">:</span><span class="op" id="3993271">]</span><span class="op" id="3993272">,</span>&nbsp;<span class="ident" id="3993274">hashMD5</span><span class="op" id="3993281">.</span><span class="ident" id="3993282">Sum</span><span class="op" id="3993285">(</span><span class="ident" id="3993286">nil</span><span class="op" id="3993289">)</span><span class="op" id="3993290">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993294">i</span><span class="op" id="3993295">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993299">}</span><br>
<span class="lineno"></span><span class="op" id="3993301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3993304">const</span>&nbsp;<span class="op" id="3993310">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993313">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993334">=</span>&nbsp;<span class="num" id="3993336">32</span>&nbsp;<span class="comment" id="3993339">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993380">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3993401">=</span>&nbsp;<span class="num" id="3993403">48</span>&nbsp;<span class="comment" id="3993406">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993448">finishedVerifyLength</span>&nbsp;<span class="op" id="3993469">=</span>&nbsp;<span class="num" id="3993471">12</span>&nbsp;<span class="comment" id="3993474">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="3993522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3993525">var</span>&nbsp;<span class="ident" id="3993529">masterSecretLabel</span>&nbsp;<span class="op" id="3993547">=</span>&nbsp;<span class="op" id="3993549">[</span><span class="op" id="3993550">]</span><span class="builtintype" id="3993551">byte</span><span class="op" id="3993555">(</span><span class="string" id="3993556">&#34;master&nbsp;secret&#34;</span><span class="op" id="3993571">)</span><br>
<span class="lineno"></span><span class="keyword" id="3993573">var</span>&nbsp;<span class="ident" id="3993577">keyExpansionLabel</span>&nbsp;<span class="op" id="3993595">=</span>&nbsp;<span class="op" id="3993597">[</span><span class="op" id="3993598">]</span><span class="builtintype" id="3993599">byte</span><span class="op" id="3993603">(</span><span class="string" id="3993604">&#34;key&nbsp;expansion&#34;</span><span class="op" id="3993619">)</span><br>
<span class="lineno"></span><span class="keyword" id="3993621">var</span>&nbsp;<span class="ident" id="3993625">clientFinishedLabel</span>&nbsp;<span class="op" id="3993645">=</span>&nbsp;<span class="op" id="3993647">[</span><span class="op" id="3993648">]</span><span class="builtintype" id="3993649">byte</span><span class="op" id="3993653">(</span><span class="string" id="3993654">&#34;client&nbsp;finished&#34;</span><span class="op" id="3993671">)</span><br>
<span class="lineno"></span><span class="keyword" id="3993673">var</span>&nbsp;<span class="ident" id="3993677">serverFinishedLabel</span>&nbsp;<span class="op" id="3993697">=</span>&nbsp;<span class="op" id="3993699">[</span><span class="op" id="3993700">]</span><span class="builtintype" id="3993701">byte</span><span class="op" id="3993705">(</span><span class="string" id="3993706">&#34;server&nbsp;finished&#34;</span><span class="op" id="3993723">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="3993726">func</span>&nbsp;<span class="ident" id="3993731">prfForVersion</span><span class="op" id="3993744">(</span><span class="ident" id="3993745">version</span>&nbsp;<span class="builtintype" id="3993753">uint16</span><span class="op" id="3993759">)</span>&nbsp;<span class="keyword" id="3993761">func</span><span class="op" id="3993765">(</span><span class="ident" id="3993766">result</span><span class="op" id="3993772">,</span>&nbsp;<span class="ident" id="3993774">secret</span><span class="op" id="3993780">,</span>&nbsp;<span class="ident" id="3993782">label</span><span class="op" id="3993787">,</span>&nbsp;<span class="ident" id="3993789">seed</span>&nbsp;<span class="op" id="3993794">[</span><span class="op" id="3993795">]</span><span class="builtintype" id="3993796">byte</span><span class="op" id="3993800">)</span>&nbsp;<span class="op" id="3993802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993805">switch</span>&nbsp;<span class="ident" id="3993812">version</span>&nbsp;<span class="op" id="3993820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993823">case</span>&nbsp;<span class="ident" id="3993828">VersionSSL30</span><span class="op" id="3993840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993844">return</span>&nbsp;<span class="ident" id="3993851">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993858">case</span>&nbsp;<span class="ident" id="3993863">VersionTLS10</span><span class="op" id="3993875">,</span>&nbsp;<span class="ident" id="3993877">VersionTLS11</span><span class="op" id="3993889">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993893">return</span>&nbsp;<span class="ident" id="3993900">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993907">case</span>&nbsp;<span class="ident" id="3993912">VersionTLS12</span><span class="op" id="3993924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993928">return</span>&nbsp;<span class="ident" id="3993935">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993942">default</span><span class="op" id="3993949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3993953">panic</span><span class="op" id="3993958">(</span><span class="string" id="3993959">&#34;unknown&nbsp;version&#34;</span><span class="op" id="3993976">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993979">}</span><br>
<span class="lineno"></span><span class="op" id="3993981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993984">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="3994061">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="3994123">func</span>&nbsp;<span class="ident" id="3994128">masterFromPreMasterSecret</span><span class="op" id="3994153">(</span><span class="ident" id="3994154">version</span>&nbsp;<span class="builtintype" id="3994162">uint16</span><span class="op" id="3994168">,</span>&nbsp;<span class="ident" id="3994170">preMasterSecret</span><span class="op" id="3994185">,</span>&nbsp;<span class="ident" id="3994187">clientRandom</span><span class="op" id="3994199">,</span>&nbsp;<span class="ident" id="3994201">serverRandom</span>&nbsp;<span class="op" id="3994214">[</span><span class="op" id="3994215">]</span><span class="builtintype" id="3994216">byte</span><span class="op" id="3994220">)</span>&nbsp;<span class="op" id="3994222">[</span><span class="op" id="3994223">]</span><span class="builtintype" id="3994224">byte</span>&nbsp;<span class="op" id="3994229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994232">var</span>&nbsp;<span class="ident" id="3994236">seed</span>&nbsp;<span class="op" id="3994241">[</span><span class="ident" id="3994242">tlsRandomLength</span>&nbsp;<span class="op" id="3994258">*</span>&nbsp;<span class="num" id="3994260">2</span><span class="op" id="3994261">]</span><span class="builtintype" id="3994262">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3994268">copy</span><span class="op" id="3994272">(</span><span class="ident" id="3994273">seed</span><span class="op" id="3994277">[</span><span class="num" id="3994278">0</span><span class="op" id="3994279">:</span><span class="builtinfunc" id="3994280">len</span><span class="op" id="3994283">(</span><span class="ident" id="3994284">clientRandom</span><span class="op" id="3994296">)</span><span class="op" id="3994297">]</span><span class="op" id="3994298">,</span>&nbsp;<span class="ident" id="3994300">clientRandom</span><span class="op" id="3994312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3994315">copy</span><span class="op" id="3994319">(</span><span class="ident" id="3994320">seed</span><span class="op" id="3994324">[</span><span class="builtinfunc" id="3994325">len</span><span class="op" id="3994328">(</span><span class="ident" id="3994329">clientRandom</span><span class="op" id="3994341">)</span><span class="op" id="3994342">:</span><span class="op" id="3994343">]</span><span class="op" id="3994344">,</span>&nbsp;<span class="ident" id="3994346">serverRandom</span><span class="op" id="3994358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994361">masterSecret</span>&nbsp;<span class="op" id="3994374">:=</span>&nbsp;<span class="builtinfunc" id="3994377">make</span><span class="op" id="3994381">(</span><span class="op" id="3994382">[</span><span class="op" id="3994383">]</span><span class="builtintype" id="3994384">byte</span><span class="op" id="3994388">,</span>&nbsp;<span class="ident" id="3994390">masterSecretLength</span><span class="op" id="3994408">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994411">prfForVersion</span><span class="op" id="3994424">(</span><span class="ident" id="3994425">version</span><span class="op" id="3994432">)</span><span class="op" id="3994433">(</span><span class="ident" id="3994434">masterSecret</span><span class="op" id="3994446">,</span>&nbsp;<span class="ident" id="3994448">preMasterSecret</span><span class="op" id="3994463">,</span>&nbsp;<span class="ident" id="3994465">masterSecretLabel</span><span class="op" id="3994482">,</span>&nbsp;<span class="ident" id="3994484">seed</span><span class="op" id="3994488">[</span><span class="num" id="3994489">0</span><span class="op" id="3994490">:</span><span class="op" id="3994491">]</span><span class="op" id="3994492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994495">return</span>&nbsp;<span class="ident" id="3994502">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="3994515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3994518">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="3994588">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3994666">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="3994692">func</span>&nbsp;<span class="ident" id="3994697">keysFromMasterSecret</span><span class="op" id="3994717">(</span><span class="ident" id="3994718">version</span>&nbsp;<span class="builtintype" id="3994726">uint16</span><span class="op" id="3994732">,</span>&nbsp;<span class="ident" id="3994734">masterSecret</span><span class="op" id="3994746">,</span>&nbsp;<span class="ident" id="3994748">clientRandom</span><span class="op" id="3994760">,</span>&nbsp;<span class="ident" id="3994762">serverRandom</span>&nbsp;<span class="op" id="3994775">[</span><span class="op" id="3994776">]</span><span class="builtintype" id="3994777">byte</span><span class="op" id="3994781">,</span>&nbsp;<span class="ident" id="3994783">macLen</span><span class="op" id="3994789">,</span>&nbsp;<span class="ident" id="3994791">keyLen</span><span class="op" id="3994797">,</span>&nbsp;<span class="ident" id="3994799">ivLen</span>&nbsp;<span class="builtintype" id="3994805">int</span><span class="op" id="3994808">)</span>&nbsp;<span class="op" id="3994810">(</span><span class="ident" id="3994811">clientMAC</span><span class="op" id="3994820">,</span>&nbsp;<span class="ident" id="3994822">serverMAC</span><span class="op" id="3994831">,</span>&nbsp;<span class="ident" id="3994833">clientKey</span><span class="op" id="3994842">,</span>&nbsp;<span class="ident" id="3994844">serverKey</span><span class="op" id="3994853">,</span>&nbsp;<span class="ident" id="3994855">clientIV</span><span class="op" id="3994863">,</span>&nbsp;<span class="ident" id="3994865">serverIV</span>&nbsp;<span class="op" id="3994874">[</span><span class="op" id="3994875">]</span><span class="builtintype" id="3994876">byte</span><span class="op" id="3994880">)</span>&nbsp;<span class="op" id="3994882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994885">var</span>&nbsp;<span class="ident" id="3994889">seed</span>&nbsp;<span class="op" id="3994894">[</span><span class="ident" id="3994895">tlsRandomLength</span>&nbsp;<span class="op" id="3994911">*</span>&nbsp;<span class="num" id="3994913">2</span><span class="op" id="3994914">]</span><span class="builtintype" id="3994915">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3994921">copy</span><span class="op" id="3994925">(</span><span class="ident" id="3994926">seed</span><span class="op" id="3994930">[</span><span class="num" id="3994931">0</span><span class="op" id="3994932">:</span><span class="builtinfunc" id="3994933">len</span><span class="op" id="3994936">(</span><span class="ident" id="3994937">clientRandom</span><span class="op" id="3994949">)</span><span class="op" id="3994950">]</span><span class="op" id="3994951">,</span>&nbsp;<span class="ident" id="3994953">serverRandom</span><span class="op" id="3994965">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3994968">copy</span><span class="op" id="3994972">(</span><span class="ident" id="3994973">seed</span><span class="op" id="3994977">[</span><span class="builtinfunc" id="3994978">len</span><span class="op" id="3994981">(</span><span class="ident" id="3994982">serverRandom</span><span class="op" id="3994994">)</span><span class="op" id="3994995">:</span><span class="op" id="3994996">]</span><span class="op" id="3994997">,</span>&nbsp;<span class="ident" id="3994999">clientRandom</span><span class="op" id="3995011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995015">n</span>&nbsp;<span class="op" id="3995017">:=</span>&nbsp;<span class="num" id="3995020">2</span><span class="op" id="3995021">*</span><span class="ident" id="3995022">macLen</span>&nbsp;<span class="op" id="3995029">+</span>&nbsp;<span class="num" id="3995031">2</span><span class="op" id="3995032">*</span><span class="ident" id="3995033">keyLen</span>&nbsp;<span class="op" id="3995040">+</span>&nbsp;<span class="num" id="3995042">2</span><span class="op" id="3995043">*</span><span class="ident" id="3995044">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995051">keyMaterial</span>&nbsp;<span class="op" id="3995063">:=</span>&nbsp;<span class="builtinfunc" id="3995066">make</span><span class="op" id="3995070">(</span><span class="op" id="3995071">[</span><span class="op" id="3995072">]</span><span class="builtintype" id="3995073">byte</span><span class="op" id="3995077">,</span>&nbsp;<span class="ident" id="3995079">n</span><span class="op" id="3995080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995083">prfForVersion</span><span class="op" id="3995096">(</span><span class="ident" id="3995097">version</span><span class="op" id="3995104">)</span><span class="op" id="3995105">(</span><span class="ident" id="3995106">keyMaterial</span><span class="op" id="3995117">,</span>&nbsp;<span class="ident" id="3995119">masterSecret</span><span class="op" id="3995131">,</span>&nbsp;<span class="ident" id="3995133">keyExpansionLabel</span><span class="op" id="3995150">,</span>&nbsp;<span class="ident" id="3995152">seed</span><span class="op" id="3995156">[</span><span class="num" id="3995157">0</span><span class="op" id="3995158">:</span><span class="op" id="3995159">]</span><span class="op" id="3995160">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995163">clientMAC</span>&nbsp;<span class="op" id="3995173">=</span>&nbsp;<span class="ident" id="3995175">keyMaterial</span><span class="op" id="3995186">[</span><span class="op" id="3995187">:</span><span class="ident" id="3995188">macLen</span><span class="op" id="3995194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995197">keyMaterial</span>&nbsp;<span class="op" id="3995209">=</span>&nbsp;<span class="ident" id="3995211">keyMaterial</span><span class="op" id="3995222">[</span><span class="ident" id="3995223">macLen</span><span class="op" id="3995229">:</span><span class="op" id="3995230">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995233">serverMAC</span>&nbsp;<span class="op" id="3995243">=</span>&nbsp;<span class="ident" id="3995245">keyMaterial</span><span class="op" id="3995256">[</span><span class="op" id="3995257">:</span><span class="ident" id="3995258">macLen</span><span class="op" id="3995264">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995267">keyMaterial</span>&nbsp;<span class="op" id="3995279">=</span>&nbsp;<span class="ident" id="3995281">keyMaterial</span><span class="op" id="3995292">[</span><span class="ident" id="3995293">macLen</span><span class="op" id="3995299">:</span><span class="op" id="3995300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995303">clientKey</span>&nbsp;<span class="op" id="3995313">=</span>&nbsp;<span class="ident" id="3995315">keyMaterial</span><span class="op" id="3995326">[</span><span class="op" id="3995327">:</span><span class="ident" id="3995328">keyLen</span><span class="op" id="3995334">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995337">keyMaterial</span>&nbsp;<span class="op" id="3995349">=</span>&nbsp;<span class="ident" id="3995351">keyMaterial</span><span class="op" id="3995362">[</span><span class="ident" id="3995363">keyLen</span><span class="op" id="3995369">:</span><span class="op" id="3995370">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995373">serverKey</span>&nbsp;<span class="op" id="3995383">=</span>&nbsp;<span class="ident" id="3995385">keyMaterial</span><span class="op" id="3995396">[</span><span class="op" id="3995397">:</span><span class="ident" id="3995398">keyLen</span><span class="op" id="3995404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995407">keyMaterial</span>&nbsp;<span class="op" id="3995419">=</span>&nbsp;<span class="ident" id="3995421">keyMaterial</span><span class="op" id="3995432">[</span><span class="ident" id="3995433">keyLen</span><span class="op" id="3995439">:</span><span class="op" id="3995440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995443">clientIV</span>&nbsp;<span class="op" id="3995452">=</span>&nbsp;<span class="ident" id="3995454">keyMaterial</span><span class="op" id="3995465">[</span><span class="op" id="3995466">:</span><span class="ident" id="3995467">ivLen</span><span class="op" id="3995472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995475">keyMaterial</span>&nbsp;<span class="op" id="3995487">=</span>&nbsp;<span class="ident" id="3995489">keyMaterial</span><span class="op" id="3995500">[</span><span class="ident" id="3995501">ivLen</span><span class="op" id="3995506">:</span><span class="op" id="3995507">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995510">serverIV</span>&nbsp;<span class="op" id="3995519">=</span>&nbsp;<span class="ident" id="3995521">keyMaterial</span><span class="op" id="3995532">[</span><span class="op" id="3995533">:</span><span class="ident" id="3995534">ivLen</span><span class="op" id="3995539">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995542">return</span><br>
<span class="lineno"></span><span class="op" id="3995549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3995552">func</span>&nbsp;<span class="ident" id="3995557">newFinishedHash</span><span class="op" id="3995572">(</span><span class="ident" id="3995573">version</span>&nbsp;<span class="builtintype" id="3995581">uint16</span><span class="op" id="3995587">)</span>&nbsp;<span class="ident" id="3995589">finishedHash</span>&nbsp;<span class="op" id="3995602">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995605">if</span>&nbsp;<span class="ident" id="3995608">version</span>&nbsp;<span class="op" id="3995616">&gt;=</span>&nbsp;<span class="ident" id="3995619">VersionTLS12</span>&nbsp;<span class="op" id="3995632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995636">return</span>&nbsp;<span class="ident" id="3995643">finishedHash</span><span class="op" id="3995655">{</span><span class="ident" id="3995656">sha256</span><span class="op" id="3995662">.</span><span class="ident" id="3995663">New</span><span class="op" id="3995666">(</span><span class="op" id="3995667">)</span><span class="op" id="3995668">,</span>&nbsp;<span class="ident" id="3995670">sha256</span><span class="op" id="3995676">.</span><span class="ident" id="3995677">New</span><span class="op" id="3995680">(</span><span class="op" id="3995681">)</span><span class="op" id="3995682">,</span>&nbsp;<span class="ident" id="3995684">nil</span><span class="op" id="3995687">,</span>&nbsp;<span class="ident" id="3995689">nil</span><span class="op" id="3995692">,</span>&nbsp;<span class="ident" id="3995694">version</span><span class="op" id="3995701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3995704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995707">return</span>&nbsp;<span class="ident" id="3995714">finishedHash</span><span class="op" id="3995726">{</span><span class="ident" id="3995727">sha1</span><span class="op" id="3995731">.</span><span class="ident" id="3995732">New</span><span class="op" id="3995735">(</span><span class="op" id="3995736">)</span><span class="op" id="3995737">,</span>&nbsp;<span class="ident" id="3995739">sha1</span><span class="op" id="3995743">.</span><span class="ident" id="3995744">New</span><span class="op" id="3995747">(</span><span class="op" id="3995748">)</span><span class="op" id="3995749">,</span>&nbsp;<span class="ident" id="3995751">md5</span><span class="op" id="3995754">.</span><span class="ident" id="3995755">New</span><span class="op" id="3995758">(</span><span class="op" id="3995759">)</span><span class="op" id="3995760">,</span>&nbsp;<span class="ident" id="3995762">md5</span><span class="op" id="3995765">.</span><span class="ident" id="3995766">New</span><span class="op" id="3995769">(</span><span class="op" id="3995770">)</span><span class="op" id="3995771">,</span>&nbsp;<span class="ident" id="3995773">version</span><span class="op" id="3995780">}</span><br>
<span class="lineno"></span><span class="op" id="3995782">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3995785">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="3995863">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3995903">type</span>&nbsp;<span class="ident" id="3995908">finishedHash</span>&nbsp;<span class="keyword" id="3995921">struct</span>&nbsp;<span class="op" id="3995928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995931">client</span>&nbsp;<span class="ident" id="3995938">hash</span><span class="op" id="3995942">.</span><span class="ident" id="3995943">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995949">server</span>&nbsp;<span class="ident" id="3995956">hash</span><span class="op" id="3995960">.</span><span class="ident" id="3995961">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995968">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996026">clientMD5</span>&nbsp;<span class="ident" id="3996036">hash</span><span class="op" id="3996040">.</span><span class="ident" id="3996041">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996047">serverMD5</span>&nbsp;<span class="ident" id="3996057">hash</span><span class="op" id="3996061">.</span><span class="ident" id="3996062">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996069">version</span>&nbsp;<span class="builtintype" id="3996077">uint16</span><br>
<span class="lineno"></span><span class="op" id="3996084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3996087">func</span>&nbsp;<span class="op" id="3996092">(</span><span class="ident" id="3996093">h</span>&nbsp;<span class="ident" id="3996095">finishedHash</span><span class="op" id="3996107">)</span>&nbsp;<span class="ident" id="3996109">Write</span><span class="op" id="3996114">(</span><span class="ident" id="3996115">msg</span>&nbsp;<span class="op" id="3996119">[</span><span class="op" id="3996120">]</span><span class="builtintype" id="3996121">byte</span><span class="op" id="3996125">)</span>&nbsp;<span class="op" id="3996127">(</span><span class="ident" id="3996128">n</span>&nbsp;<span class="builtintype" id="3996130">int</span><span class="op" id="3996133">,</span>&nbsp;<span class="ident" id="3996135">err</span>&nbsp;<span class="builtintype" id="3996139">error</span><span class="op" id="3996144">)</span>&nbsp;<span class="op" id="3996146">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996149">h</span><span class="op" id="3996150">.</span><span class="ident" id="3996151">client</span><span class="op" id="3996157">.</span><span class="ident" id="3996158">Write</span><span class="op" id="3996163">(</span><span class="ident" id="3996164">msg</span><span class="op" id="3996167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996170">h</span><span class="op" id="3996171">.</span><span class="ident" id="3996172">server</span><span class="op" id="3996178">.</span><span class="ident" id="3996179">Write</span><span class="op" id="3996184">(</span><span class="ident" id="3996185">msg</span><span class="op" id="3996188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996192">if</span>&nbsp;<span class="ident" id="3996195">h</span><span class="op" id="3996196">.</span><span class="ident" id="3996197">version</span>&nbsp;<span class="op" id="3996205">&lt;</span>&nbsp;<span class="ident" id="3996207">VersionTLS12</span>&nbsp;<span class="op" id="3996220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996224">h</span><span class="op" id="3996225">.</span><span class="ident" id="3996226">clientMD5</span><span class="op" id="3996235">.</span><span class="ident" id="3996236">Write</span><span class="op" id="3996241">(</span><span class="ident" id="3996242">msg</span><span class="op" id="3996245">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996249">h</span><span class="op" id="3996250">.</span><span class="ident" id="3996251">serverMD5</span><span class="op" id="3996260">.</span><span class="ident" id="3996261">Write</span><span class="op" id="3996266">(</span><span class="ident" id="3996267">msg</span><span class="op" id="3996270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996276">return</span>&nbsp;<span class="builtinfunc" id="3996283">len</span><span class="op" id="3996286">(</span><span class="ident" id="3996287">msg</span><span class="op" id="3996290">)</span><span class="op" id="3996291">,</span>&nbsp;<span class="ident" id="3996293">nil</span><br>
<span class="lineno"></span><span class="op" id="3996297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3996300">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="3996378">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="3996450">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3996463">func</span>&nbsp;<span class="ident" id="3996468">finishedSum30</span><span class="op" id="3996481">(</span><span class="ident" id="3996482">md5</span><span class="op" id="3996485">,</span>&nbsp;<span class="ident" id="3996487">sha1</span>&nbsp;<span class="ident" id="3996492">hash</span><span class="op" id="3996496">.</span><span class="ident" id="3996497">Hash</span><span class="op" id="3996501">,</span>&nbsp;<span class="ident" id="3996503">masterSecret</span>&nbsp;<span class="op" id="3996516">[</span><span class="op" id="3996517">]</span><span class="builtintype" id="3996518">byte</span><span class="op" id="3996522">,</span>&nbsp;<span class="ident" id="3996524">magic</span>&nbsp;<span class="op" id="3996530">[</span><span class="num" id="3996531">4</span><span class="op" id="3996532">]</span><span class="builtintype" id="3996533">byte</span><span class="op" id="3996537">)</span>&nbsp;<span class="op" id="3996539">[</span><span class="op" id="3996540">]</span><span class="builtintype" id="3996541">byte</span>&nbsp;<span class="op" id="3996546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996549">md5</span><span class="op" id="3996552">.</span><span class="ident" id="3996553">Write</span><span class="op" id="3996558">(</span><span class="ident" id="3996559">magic</span><span class="op" id="3996564">[</span><span class="op" id="3996565">:</span><span class="op" id="3996566">]</span><span class="op" id="3996567">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996570">md5</span><span class="op" id="3996573">.</span><span class="ident" id="3996574">Write</span><span class="op" id="3996579">(</span><span class="ident" id="3996580">masterSecret</span><span class="op" id="3996592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996595">md5</span><span class="op" id="3996598">.</span><span class="ident" id="3996599">Write</span><span class="op" id="3996604">(</span><span class="ident" id="3996605">ssl30Pad1</span><span class="op" id="3996614">[</span><span class="op" id="3996615">:</span><span class="op" id="3996616">]</span><span class="op" id="3996617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996620">md5Digest</span>&nbsp;<span class="op" id="3996630">:=</span>&nbsp;<span class="ident" id="3996633">md5</span><span class="op" id="3996636">.</span><span class="ident" id="3996637">Sum</span><span class="op" id="3996640">(</span><span class="ident" id="3996641">nil</span><span class="op" id="3996644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996648">md5</span><span class="op" id="3996651">.</span><span class="ident" id="3996652">Reset</span><span class="op" id="3996657">(</span><span class="op" id="3996658">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996661">md5</span><span class="op" id="3996664">.</span><span class="ident" id="3996665">Write</span><span class="op" id="3996670">(</span><span class="ident" id="3996671">masterSecret</span><span class="op" id="3996683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996686">md5</span><span class="op" id="3996689">.</span><span class="ident" id="3996690">Write</span><span class="op" id="3996695">(</span><span class="ident" id="3996696">ssl30Pad2</span><span class="op" id="3996705">[</span><span class="op" id="3996706">:</span><span class="op" id="3996707">]</span><span class="op" id="3996708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996711">md5</span><span class="op" id="3996714">.</span><span class="ident" id="3996715">Write</span><span class="op" id="3996720">(</span><span class="ident" id="3996721">md5Digest</span><span class="op" id="3996730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996733">md5Digest</span>&nbsp;<span class="op" id="3996743">=</span>&nbsp;<span class="ident" id="3996745">md5</span><span class="op" id="3996748">.</span><span class="ident" id="3996749">Sum</span><span class="op" id="3996752">(</span><span class="ident" id="3996753">nil</span><span class="op" id="3996756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996760">sha1</span><span class="op" id="3996764">.</span><span class="ident" id="3996765">Write</span><span class="op" id="3996770">(</span><span class="ident" id="3996771">magic</span><span class="op" id="3996776">[</span><span class="op" id="3996777">:</span><span class="op" id="3996778">]</span><span class="op" id="3996779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996782">sha1</span><span class="op" id="3996786">.</span><span class="ident" id="3996787">Write</span><span class="op" id="3996792">(</span><span class="ident" id="3996793">masterSecret</span><span class="op" id="3996805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996808">sha1</span><span class="op" id="3996812">.</span><span class="ident" id="3996813">Write</span><span class="op" id="3996818">(</span><span class="ident" id="3996819">ssl30Pad1</span><span class="op" id="3996828">[</span><span class="op" id="3996829">:</span><span class="num" id="3996830">40</span><span class="op" id="3996832">]</span><span class="op" id="3996833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996836">sha1Digest</span>&nbsp;<span class="op" id="3996847">:=</span>&nbsp;<span class="ident" id="3996850">sha1</span><span class="op" id="3996854">.</span><span class="ident" id="3996855">Sum</span><span class="op" id="3996858">(</span><span class="ident" id="3996859">nil</span><span class="op" id="3996862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996866">sha1</span><span class="op" id="3996870">.</span><span class="ident" id="3996871">Reset</span><span class="op" id="3996876">(</span><span class="op" id="3996877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996880">sha1</span><span class="op" id="3996884">.</span><span class="ident" id="3996885">Write</span><span class="op" id="3996890">(</span><span class="ident" id="3996891">masterSecret</span><span class="op" id="3996903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996906">sha1</span><span class="op" id="3996910">.</span><span class="ident" id="3996911">Write</span><span class="op" id="3996916">(</span><span class="ident" id="3996917">ssl30Pad2</span><span class="op" id="3996926">[</span><span class="op" id="3996927">:</span><span class="num" id="3996928">40</span><span class="op" id="3996930">]</span><span class="op" id="3996931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996934">sha1</span><span class="op" id="3996938">.</span><span class="ident" id="3996939">Write</span><span class="op" id="3996944">(</span><span class="ident" id="3996945">sha1Digest</span><span class="op" id="3996955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996958">sha1Digest</span>&nbsp;<span class="op" id="3996969">=</span>&nbsp;<span class="ident" id="3996971">sha1</span><span class="op" id="3996975">.</span><span class="ident" id="3996976">Sum</span><span class="op" id="3996979">(</span><span class="ident" id="3996980">nil</span><span class="op" id="3996983">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996987">ret</span>&nbsp;<span class="op" id="3996991">:=</span>&nbsp;<span class="builtinfunc" id="3996994">make</span><span class="op" id="3996998">(</span><span class="op" id="3996999">[</span><span class="op" id="3997000">]</span><span class="builtintype" id="3997001">byte</span><span class="op" id="3997005">,</span>&nbsp;<span class="builtinfunc" id="3997007">len</span><span class="op" id="3997010">(</span><span class="ident" id="3997011">md5Digest</span><span class="op" id="3997020">)</span><span class="op" id="3997021">+</span><span class="builtinfunc" id="3997022">len</span><span class="op" id="3997025">(</span><span class="ident" id="3997026">sha1Digest</span><span class="op" id="3997036">)</span><span class="op" id="3997037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3997040">copy</span><span class="op" id="3997044">(</span><span class="ident" id="3997045">ret</span><span class="op" id="3997048">,</span>&nbsp;<span class="ident" id="3997050">md5Digest</span><span class="op" id="3997059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3997062">copy</span><span class="op" id="3997066">(</span><span class="ident" id="3997067">ret</span><span class="op" id="3997070">[</span><span class="builtinfunc" id="3997071">len</span><span class="op" id="3997074">(</span><span class="ident" id="3997075">md5Digest</span><span class="op" id="3997084">)</span><span class="op" id="3997085">:</span><span class="op" id="3997086">]</span><span class="op" id="3997087">,</span>&nbsp;<span class="ident" id="3997089">sha1Digest</span><span class="op" id="3997099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997102">return</span>&nbsp;<span class="ident" id="3997109">ret</span><br>
<span class="lineno">230</span><span class="op" id="3997113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3997116">var</span>&nbsp;<span class="ident" id="3997120">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="3997144">=</span>&nbsp;<span class="op" id="3997146">[</span><span class="num" id="3997147">4</span><span class="op" id="3997148">]</span><span class="builtintype" id="3997149">byte</span><span class="op" id="3997153">{</span><span class="num" id="3997154">0x43</span><span class="op" id="3997158">,</span>&nbsp;<span class="num" id="3997160">0x4c</span><span class="op" id="3997164">,</span>&nbsp;<span class="num" id="3997166">0x4e</span><span class="op" id="3997170">,</span>&nbsp;<span class="num" id="3997172">0x54</span><span class="op" id="3997176">}</span><br>
<span class="lineno"></span><span class="keyword" id="3997178">var</span>&nbsp;<span class="ident" id="3997182">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="3997206">=</span>&nbsp;<span class="op" id="3997208">[</span><span class="num" id="3997209">4</span><span class="op" id="3997210">]</span><span class="builtintype" id="3997211">byte</span><span class="op" id="3997215">{</span><span class="num" id="3997216">0x53</span><span class="op" id="3997220">,</span>&nbsp;<span class="num" id="3997222">0x52</span><span class="op" id="3997226">,</span>&nbsp;<span class="num" id="3997228">0x56</span><span class="op" id="3997232">,</span>&nbsp;<span class="num" id="3997234">0x52</span><span class="op" id="3997238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="3997241">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3997315">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3997336">func</span>&nbsp;<span class="op" id="3997341">(</span><span class="ident" id="3997342">h</span>&nbsp;<span class="ident" id="3997344">finishedHash</span><span class="op" id="3997356">)</span>&nbsp;<span class="ident" id="3997358">clientSum</span><span class="op" id="3997367">(</span><span class="ident" id="3997368">masterSecret</span>&nbsp;<span class="op" id="3997381">[</span><span class="op" id="3997382">]</span><span class="builtintype" id="3997383">byte</span><span class="op" id="3997387">)</span>&nbsp;<span class="op" id="3997389">[</span><span class="op" id="3997390">]</span><span class="builtintype" id="3997391">byte</span>&nbsp;<span class="op" id="3997396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997399">if</span>&nbsp;<span class="ident" id="3997402">h</span><span class="op" id="3997403">.</span><span class="ident" id="3997404">version</span>&nbsp;<span class="op" id="3997412">==</span>&nbsp;<span class="ident" id="3997415">VersionSSL30</span>&nbsp;<span class="op" id="3997428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997432">return</span>&nbsp;<span class="ident" id="3997439">finishedSum30</span><span class="op" id="3997452">(</span><span class="ident" id="3997453">h</span><span class="op" id="3997454">.</span><span class="ident" id="3997455">clientMD5</span><span class="op" id="3997464">,</span>&nbsp;<span class="ident" id="3997466">h</span><span class="op" id="3997467">.</span><span class="ident" id="3997468">client</span><span class="op" id="3997474">,</span>&nbsp;<span class="ident" id="3997476">masterSecret</span><span class="op" id="3997488">,</span>&nbsp;<span class="ident" id="3997490">ssl3ClientFinishedMagic</span><span class="op" id="3997513">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997520">out</span>&nbsp;<span class="op" id="3997524">:=</span>&nbsp;<span class="builtinfunc" id="3997527">make</span><span class="op" id="3997531">(</span><span class="op" id="3997532">[</span><span class="op" id="3997533">]</span><span class="builtintype" id="3997534">byte</span><span class="op" id="3997538">,</span>&nbsp;<span class="ident" id="3997540">finishedVerifyLength</span><span class="op" id="3997560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997563">if</span>&nbsp;<span class="ident" id="3997566">h</span><span class="op" id="3997567">.</span><span class="ident" id="3997568">version</span>&nbsp;<span class="op" id="3997576">&gt;=</span>&nbsp;<span class="ident" id="3997579">VersionTLS12</span>&nbsp;<span class="op" id="3997592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997596">seed</span>&nbsp;<span class="op" id="3997601">:=</span>&nbsp;<span class="ident" id="3997604">h</span><span class="op" id="3997605">.</span><span class="ident" id="3997606">client</span><span class="op" id="3997612">.</span><span class="ident" id="3997613">Sum</span><span class="op" id="3997616">(</span><span class="ident" id="3997617">nil</span><span class="op" id="3997620">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997624">prf12</span><span class="op" id="3997629">(</span><span class="ident" id="3997630">out</span><span class="op" id="3997633">,</span>&nbsp;<span class="ident" id="3997635">masterSecret</span><span class="op" id="3997647">,</span>&nbsp;<span class="ident" id="3997649">clientFinishedLabel</span><span class="op" id="3997668">,</span>&nbsp;<span class="ident" id="3997670">seed</span><span class="op" id="3997674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997677">}</span>&nbsp;<span class="keyword" id="3997679">else</span>&nbsp;<span class="op" id="3997684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997688">seed</span>&nbsp;<span class="op" id="3997693">:=</span>&nbsp;<span class="builtinfunc" id="3997696">make</span><span class="op" id="3997700">(</span><span class="op" id="3997701">[</span><span class="op" id="3997702">]</span><span class="builtintype" id="3997703">byte</span><span class="op" id="3997707">,</span>&nbsp;<span class="num" id="3997709">0</span><span class="op" id="3997710">,</span>&nbsp;<span class="ident" id="3997712">md5</span><span class="op" id="3997715">.</span><span class="ident" id="3997716">Size</span><span class="op" id="3997720">+</span><span class="ident" id="3997721">sha1</span><span class="op" id="3997725">.</span><span class="ident" id="3997726">Size</span><span class="op" id="3997730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997734">seed</span>&nbsp;<span class="op" id="3997739">=</span>&nbsp;<span class="ident" id="3997741">h</span><span class="op" id="3997742">.</span><span class="ident" id="3997743">clientMD5</span><span class="op" id="3997752">.</span><span class="ident" id="3997753">Sum</span><span class="op" id="3997756">(</span><span class="ident" id="3997757">seed</span><span class="op" id="3997761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997765">seed</span>&nbsp;<span class="op" id="3997770">=</span>&nbsp;<span class="ident" id="3997772">h</span><span class="op" id="3997773">.</span><span class="ident" id="3997774">client</span><span class="op" id="3997780">.</span><span class="ident" id="3997781">Sum</span><span class="op" id="3997784">(</span><span class="ident" id="3997785">seed</span><span class="op" id="3997789">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997793">prf10</span><span class="op" id="3997798">(</span><span class="ident" id="3997799">out</span><span class="op" id="3997802">,</span>&nbsp;<span class="ident" id="3997804">masterSecret</span><span class="op" id="3997816">,</span>&nbsp;<span class="ident" id="3997818">clientFinishedLabel</span><span class="op" id="3997837">,</span>&nbsp;<span class="ident" id="3997839">seed</span><span class="op" id="3997843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997849">return</span>&nbsp;<span class="ident" id="3997856">out</span><br>
<span class="lineno"></span><span class="op" id="3997860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3997863">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3997937">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3997958">func</span>&nbsp;<span class="op" id="3997963">(</span><span class="ident" id="3997964">h</span>&nbsp;<span class="ident" id="3997966">finishedHash</span><span class="op" id="3997978">)</span>&nbsp;<span class="ident" id="3997980">serverSum</span><span class="op" id="3997989">(</span><span class="ident" id="3997990">masterSecret</span>&nbsp;<span class="op" id="3998003">[</span><span class="op" id="3998004">]</span><span class="builtintype" id="3998005">byte</span><span class="op" id="3998009">)</span>&nbsp;<span class="op" id="3998011">[</span><span class="op" id="3998012">]</span><span class="builtintype" id="3998013">byte</span>&nbsp;<span class="op" id="3998018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998021">if</span>&nbsp;<span class="ident" id="3998024">h</span><span class="op" id="3998025">.</span><span class="ident" id="3998026">version</span>&nbsp;<span class="op" id="3998034">==</span>&nbsp;<span class="ident" id="3998037">VersionSSL30</span>&nbsp;<span class="op" id="3998050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998054">return</span>&nbsp;<span class="ident" id="3998061">finishedSum30</span><span class="op" id="3998074">(</span><span class="ident" id="3998075">h</span><span class="op" id="3998076">.</span><span class="ident" id="3998077">serverMD5</span><span class="op" id="3998086">,</span>&nbsp;<span class="ident" id="3998088">h</span><span class="op" id="3998089">.</span><span class="ident" id="3998090">server</span><span class="op" id="3998096">,</span>&nbsp;<span class="ident" id="3998098">masterSecret</span><span class="op" id="3998110">,</span>&nbsp;<span class="ident" id="3998112">ssl3ServerFinishedMagic</span><span class="op" id="3998135">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998142">out</span>&nbsp;<span class="op" id="3998146">:=</span>&nbsp;<span class="builtinfunc" id="3998149">make</span><span class="op" id="3998153">(</span><span class="op" id="3998154">[</span><span class="op" id="3998155">]</span><span class="builtintype" id="3998156">byte</span><span class="op" id="3998160">,</span>&nbsp;<span class="ident" id="3998162">finishedVerifyLength</span><span class="op" id="3998182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998185">if</span>&nbsp;<span class="ident" id="3998188">h</span><span class="op" id="3998189">.</span><span class="ident" id="3998190">version</span>&nbsp;<span class="op" id="3998198">&gt;=</span>&nbsp;<span class="ident" id="3998201">VersionTLS12</span>&nbsp;<span class="op" id="3998214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998218">seed</span>&nbsp;<span class="op" id="3998223">:=</span>&nbsp;<span class="ident" id="3998226">h</span><span class="op" id="3998227">.</span><span class="ident" id="3998228">server</span><span class="op" id="3998234">.</span><span class="ident" id="3998235">Sum</span><span class="op" id="3998238">(</span><span class="ident" id="3998239">nil</span><span class="op" id="3998242">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998246">prf12</span><span class="op" id="3998251">(</span><span class="ident" id="3998252">out</span><span class="op" id="3998255">,</span>&nbsp;<span class="ident" id="3998257">masterSecret</span><span class="op" id="3998269">,</span>&nbsp;<span class="ident" id="3998271">serverFinishedLabel</span><span class="op" id="3998290">,</span>&nbsp;<span class="ident" id="3998292">seed</span><span class="op" id="3998296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998299">}</span>&nbsp;<span class="keyword" id="3998301">else</span>&nbsp;<span class="op" id="3998306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998310">seed</span>&nbsp;<span class="op" id="3998315">:=</span>&nbsp;<span class="builtinfunc" id="3998318">make</span><span class="op" id="3998322">(</span><span class="op" id="3998323">[</span><span class="op" id="3998324">]</span><span class="builtintype" id="3998325">byte</span><span class="op" id="3998329">,</span>&nbsp;<span class="num" id="3998331">0</span><span class="op" id="3998332">,</span>&nbsp;<span class="ident" id="3998334">md5</span><span class="op" id="3998337">.</span><span class="ident" id="3998338">Size</span><span class="op" id="3998342">+</span><span class="ident" id="3998343">sha1</span><span class="op" id="3998347">.</span><span class="ident" id="3998348">Size</span><span class="op" id="3998352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998356">seed</span>&nbsp;<span class="op" id="3998361">=</span>&nbsp;<span class="ident" id="3998363">h</span><span class="op" id="3998364">.</span><span class="ident" id="3998365">serverMD5</span><span class="op" id="3998374">.</span><span class="ident" id="3998375">Sum</span><span class="op" id="3998378">(</span><span class="ident" id="3998379">seed</span><span class="op" id="3998383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998387">seed</span>&nbsp;<span class="op" id="3998392">=</span>&nbsp;<span class="ident" id="3998394">h</span><span class="op" id="3998395">.</span><span class="ident" id="3998396">server</span><span class="op" id="3998402">.</span><span class="ident" id="3998403">Sum</span><span class="op" id="3998406">(</span><span class="ident" id="3998407">seed</span><span class="op" id="3998411">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998415">prf10</span><span class="op" id="3998420">(</span><span class="ident" id="3998421">out</span><span class="op" id="3998424">,</span>&nbsp;<span class="ident" id="3998426">masterSecret</span><span class="op" id="3998438">,</span>&nbsp;<span class="ident" id="3998440">serverFinishedLabel</span><span class="op" id="3998459">,</span>&nbsp;<span class="ident" id="3998461">seed</span><span class="op" id="3998465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998471">return</span>&nbsp;<span class="ident" id="3998478">out</span><br>
<span class="lineno"></span><span class="op" id="3998482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="3998485">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3998563">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3998619">func</span>&nbsp;<span class="op" id="3998624">(</span><span class="ident" id="3998625">h</span>&nbsp;<span class="ident" id="3998627">finishedHash</span><span class="op" id="3998639">)</span>&nbsp;<span class="ident" id="3998641">hashForClientCertificate</span><span class="op" id="3998665">(</span><span class="ident" id="3998666">sigType</span>&nbsp;<span class="builtintype" id="3998674">uint8</span><span class="op" id="3998679">)</span>&nbsp;<span class="op" id="3998681">(</span><span class="op" id="3998682">[</span><span class="op" id="3998683">]</span><span class="builtintype" id="3998684">byte</span><span class="op" id="3998688">,</span>&nbsp;<span class="ident" id="3998690">crypto</span><span class="op" id="3998696">.</span><span class="ident" id="3998697">Hash</span><span class="op" id="3998701">,</span>&nbsp;<span class="builtintype" id="3998703">uint8</span><span class="op" id="3998708">)</span>&nbsp;<span class="op" id="3998710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998713">if</span>&nbsp;<span class="ident" id="3998716">h</span><span class="op" id="3998717">.</span><span class="ident" id="3998718">version</span>&nbsp;<span class="op" id="3998726">&gt;=</span>&nbsp;<span class="ident" id="3998729">VersionTLS12</span>&nbsp;<span class="op" id="3998742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998746">digest</span>&nbsp;<span class="op" id="3998753">:=</span>&nbsp;<span class="ident" id="3998756">h</span><span class="op" id="3998757">.</span><span class="ident" id="3998758">server</span><span class="op" id="3998764">.</span><span class="ident" id="3998765">Sum</span><span class="op" id="3998768">(</span><span class="ident" id="3998769">nil</span><span class="op" id="3998772">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998776">return</span>&nbsp;<span class="ident" id="3998783">digest</span><span class="op" id="3998789">,</span>&nbsp;<span class="ident" id="3998791">crypto</span><span class="op" id="3998797">.</span><span class="ident" id="3998798">SHA256</span><span class="op" id="3998804">,</span>&nbsp;<span class="ident" id="3998806">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998821">if</span>&nbsp;<span class="ident" id="3998824">sigType</span>&nbsp;<span class="op" id="3998832">==</span>&nbsp;<span class="ident" id="3998835">signatureECDSA</span>&nbsp;<span class="op" id="3998850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998854">digest</span>&nbsp;<span class="op" id="3998861">:=</span>&nbsp;<span class="ident" id="3998864">h</span><span class="op" id="3998865">.</span><span class="ident" id="3998866">server</span><span class="op" id="3998872">.</span><span class="ident" id="3998873">Sum</span><span class="op" id="3998876">(</span><span class="ident" id="3998877">nil</span><span class="op" id="3998880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998884">return</span>&nbsp;<span class="ident" id="3998891">digest</span><span class="op" id="3998897">,</span>&nbsp;<span class="ident" id="3998899">crypto</span><span class="op" id="3998905">.</span><span class="ident" id="3998906">SHA1</span><span class="op" id="3998910">,</span>&nbsp;<span class="ident" id="3998912">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998926">digest</span>&nbsp;<span class="op" id="3998933">:=</span>&nbsp;<span class="builtinfunc" id="3998936">make</span><span class="op" id="3998940">(</span><span class="op" id="3998941">[</span><span class="op" id="3998942">]</span><span class="builtintype" id="3998943">byte</span><span class="op" id="3998947">,</span>&nbsp;<span class="num" id="3998949">0</span><span class="op" id="3998950">,</span>&nbsp;<span class="num" id="3998952">36</span><span class="op" id="3998954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998957">digest</span>&nbsp;<span class="op" id="3998964">=</span>&nbsp;<span class="ident" id="3998966">h</span><span class="op" id="3998967">.</span><span class="ident" id="3998968">serverMD5</span><span class="op" id="3998977">.</span><span class="ident" id="3998978">Sum</span><span class="op" id="3998981">(</span><span class="ident" id="3998982">digest</span><span class="op" id="3998988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998991">digest</span>&nbsp;<span class="op" id="3998998">=</span>&nbsp;<span class="ident" id="3999000">h</span><span class="op" id="3999001">.</span><span class="ident" id="3999002">server</span><span class="op" id="3999008">.</span><span class="ident" id="3999009">Sum</span><span class="op" id="3999012">(</span><span class="ident" id="3999013">digest</span><span class="op" id="3999019">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999022">return</span>&nbsp;<span class="ident" id="3999029">digest</span><span class="op" id="3999035">,</span>&nbsp;<span class="ident" id="3999037">crypto</span><span class="op" id="3999043">.</span><span class="ident" id="3999044">MD5SHA1</span><span class="op" id="3999051">,</span>&nbsp;<span class="num" id="3999053">0</span>&nbsp;<span class="comment" id="3999055">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="3999087">}</span>
</div>
</body>
</html>
