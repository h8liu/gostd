<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2487260">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2487315">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2487369">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2487420">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2487490">package</span>&nbsp;<span class="ident" id="2487498">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2487502">import</span>&nbsp;<span class="op" id="2487509">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2487512">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2487523">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2487538">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2487548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2487551">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2487595">type</span>&nbsp;<span class="ident" id="2487600">File</span>&nbsp;<span class="keyword" id="2487605">struct</span>&nbsp;<span class="op" id="2487612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2487615">*</span><span class="ident" id="2487616">file</span><br>
<span class="lineno"></span><span class="op" id="2487621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2487624">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2487669">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2487733">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2487793">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2487832">type</span>&nbsp;<span class="ident" id="2487837">file</span>&nbsp;<span class="keyword" id="2487842">struct</span>&nbsp;<span class="op" id="2487849">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2487852">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2487860">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2487865">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2487873">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2487881">dirinfo</span>&nbsp;<span class="op" id="2487889">*</span><span class="ident" id="2487890">dirInfo</span>&nbsp;<span class="comment" id="2487898">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2487934">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2487942">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2487951">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2487991">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2487994">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2488068">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2488156">func</span>&nbsp;<span class="op" id="2488161">(</span><span class="ident" id="2488162">f</span>&nbsp;<span class="op" id="2488164">*</span><span class="ident" id="2488165">File</span><span class="op" id="2488169">)</span>&nbsp;<span class="ident" id="2488171">Fd</span><span class="op" id="2488173">(</span><span class="op" id="2488174">)</span>&nbsp;<span class="builtintype" id="2488176">uintptr</span>&nbsp;<span class="op" id="2488184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488187">if</span>&nbsp;<span class="ident" id="2488190">f</span>&nbsp;<span class="op" id="2488192">==</span>&nbsp;<span class="builtintype" id="2488195">nil</span>&nbsp;<span class="op" id="2488199">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488203">return</span>&nbsp;<span class="op" id="2488210">^</span><span class="op" id="2488211">(</span><span class="builtintype" id="2488212">uintptr</span><span class="op" id="2488219">(</span><span class="num" id="2488220">0</span><span class="op" id="2488221">)</span><span class="op" id="2488222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2488225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488228">return</span>&nbsp;<span class="builtintype" id="2488235">uintptr</span><span class="op" id="2488242">(</span><span class="ident" id="2488243">f</span><span class="op" id="2488244">.</span><span class="ident" id="2488245">fd</span><span class="op" id="2488247">)</span><br>
<span class="lineno"></span><span class="op" id="2488249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2488252">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2488323">func</span>&nbsp;<span class="ident" id="2488328">NewFile</span><span class="op" id="2488335">(</span><span class="ident" id="2488336">fd</span>&nbsp;<span class="builtintype" id="2488339">uintptr</span><span class="op" id="2488346">,</span>&nbsp;<span class="ident" id="2488348">name</span>&nbsp;<span class="builtintype" id="2488353">string</span><span class="op" id="2488359">)</span>&nbsp;<span class="op" id="2488361">*</span><span class="ident" id="2488362">File</span>&nbsp;<span class="op" id="2488367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488370">fdi</span>&nbsp;<span class="op" id="2488374">:=</span>&nbsp;<span class="builtintype" id="2488377">int</span><span class="op" id="2488380">(</span><span class="ident" id="2488381">fd</span><span class="op" id="2488383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488386">if</span>&nbsp;<span class="ident" id="2488389">fdi</span>&nbsp;<span class="op" id="2488393">&lt;</span>&nbsp;<span class="num" id="2488395">0</span>&nbsp;<span class="op" id="2488397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488401">return</span>&nbsp;<span class="builtintype" id="2488408">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2488413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488416">f</span>&nbsp;<span class="op" id="2488418">:=</span>&nbsp;<span class="op" id="2488421">&amp;</span><span class="ident" id="2488422">File</span><span class="op" id="2488426">{</span><span class="op" id="2488427">&amp;</span><span class="ident" id="2488428">file</span><span class="op" id="2488432">{</span><span class="ident" id="2488433">fd</span><span class="op" id="2488435">:</span>&nbsp;<span class="ident" id="2488437">fdi</span><span class="op" id="2488440">,</span>&nbsp;<span class="ident" id="2488442">name</span><span class="op" id="2488446">:</span>&nbsp;<span class="ident" id="2488448">name</span><span class="op" id="2488452">}</span><span class="op" id="2488453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488456">runtime</span><span class="op" id="2488463">.</span><span class="ident" id="2488464">SetFinalizer</span><span class="op" id="2488476">(</span><span class="ident" id="2488477">f</span><span class="op" id="2488478">.</span><span class="ident" id="2488479">file</span><span class="op" id="2488483">,</span>&nbsp;<span class="op" id="2488485">(</span><span class="op" id="2488486">*</span><span class="ident" id="2488487">file</span><span class="op" id="2488491">)</span><span class="op" id="2488492">.</span><span class="builtinfunc" id="2488493">close</span><span class="op" id="2488498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488501">return</span>&nbsp;<span class="ident" id="2488508">f</span><br>
<span class="lineno"></span><span class="op" id="2488510">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2488513">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2488572">type</span>&nbsp;<span class="ident" id="2488577">dirInfo</span>&nbsp;<span class="keyword" id="2488585">struct</span>&nbsp;<span class="op" id="2488592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488595">buf</span>&nbsp;&nbsp;<span class="op" id="2488600">[</span><span class="op" id="2488601">]</span><span class="builtintype" id="2488602">byte</span>&nbsp;<span class="comment" id="2488607">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488636">nbuf</span>&nbsp;<span class="builtintype" id="2488641">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2488648">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488699">bufp</span>&nbsp;<span class="builtintype" id="2488704">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2488711">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2488746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2488749">func</span>&nbsp;<span class="ident" id="2488754">epipecheck</span><span class="op" id="2488764">(</span><span class="ident" id="2488765">file</span>&nbsp;<span class="op" id="2488770">*</span><span class="ident" id="2488771">File</span><span class="op" id="2488775">,</span>&nbsp;<span class="ident" id="2488777">e</span>&nbsp;<span class="builtintype" id="2488779">error</span><span class="op" id="2488784">)</span>&nbsp;<span class="op" id="2488786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488789">if</span>&nbsp;<span class="ident" id="2488792">e</span>&nbsp;<span class="op" id="2488794">==</span>&nbsp;<span class="ident" id="2488797">syscall</span><span class="op" id="2488804">.</span><span class="ident" id="2488805">EPIPE</span>&nbsp;<span class="op" id="2488811">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2488815">if</span>&nbsp;<span class="ident" id="2488818">atomic</span><span class="op" id="2488824">.</span><span class="ident" id="2488825">AddInt32</span><span class="op" id="2488833">(</span><span class="op" id="2488834">&amp;</span><span class="ident" id="2488835">file</span><span class="op" id="2488839">.</span><span class="ident" id="2488840">nepipe</span><span class="op" id="2488846">,</span>&nbsp;<span class="num" id="2488848">1</span><span class="op" id="2488849">)</span>&nbsp;<span class="op" id="2488851">&gt;=</span>&nbsp;<span class="num" id="2488854">10</span>&nbsp;<span class="op" id="2488857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488862">sigpipe</span><span class="op" id="2488869">(</span><span class="op" id="2488870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2488874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2488877">}</span>&nbsp;<span class="keyword" id="2488879">else</span>&nbsp;<span class="op" id="2488884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2488888">atomic</span><span class="op" id="2488894">.</span><span class="ident" id="2488895">StoreInt32</span><span class="op" id="2488905">(</span><span class="op" id="2488906">&amp;</span><span class="ident" id="2488907">file</span><span class="op" id="2488911">.</span><span class="ident" id="2488912">nepipe</span><span class="op" id="2488918">,</span>&nbsp;<span class="num" id="2488920">0</span><span class="op" id="2488921">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2488924">}</span><br>
<span class="lineno"></span><span class="op" id="2488926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2488929">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2488995">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2489058">const</span>&nbsp;<span class="ident" id="2489064">DevNull</span>&nbsp;<span class="op" id="2489072">=</span>&nbsp;<span class="string" id="2489074">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489087">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2489154">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2489221">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2489293">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2489346">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2489402">func</span>&nbsp;<span class="ident" id="2489407">OpenFile</span><span class="op" id="2489415">(</span><span class="ident" id="2489416">name</span>&nbsp;<span class="builtintype" id="2489421">string</span><span class="op" id="2489427">,</span>&nbsp;<span class="ident" id="2489429">flag</span>&nbsp;<span class="builtintype" id="2489434">int</span><span class="op" id="2489437">,</span>&nbsp;<span class="ident" id="2489439">perm</span>&nbsp;<span class="ident" id="2489444">FileMode</span><span class="op" id="2489452">)</span>&nbsp;<span class="op" id="2489454">(</span><span class="ident" id="2489455">file</span>&nbsp;<span class="op" id="2489460">*</span><span class="ident" id="2489461">File</span><span class="op" id="2489465">,</span>&nbsp;<span class="ident" id="2489467">err</span>&nbsp;<span class="builtintype" id="2489471">error</span><span class="op" id="2489476">)</span>&nbsp;<span class="op" id="2489478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2489481">r</span><span class="op" id="2489482">,</span>&nbsp;<span class="ident" id="2489484">e</span>&nbsp;<span class="op" id="2489486">:=</span>&nbsp;<span class="ident" id="2489489">syscall</span><span class="op" id="2489496">.</span><span class="ident" id="2489497">Open</span><span class="op" id="2489501">(</span><span class="ident" id="2489502">name</span><span class="op" id="2489506">,</span>&nbsp;<span class="ident" id="2489508">flag</span><span class="op" id="2489512">|</span><span class="ident" id="2489513">syscall</span><span class="op" id="2489520">.</span><span class="ident" id="2489521">O_CLOEXEC</span><span class="op" id="2489530">,</span>&nbsp;<span class="ident" id="2489532">syscallMode</span><span class="op" id="2489543">(</span><span class="ident" id="2489544">perm</span><span class="op" id="2489548">)</span><span class="op" id="2489549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489552">if</span>&nbsp;<span class="ident" id="2489555">e</span>&nbsp;<span class="op" id="2489557">!=</span>&nbsp;<span class="builtintype" id="2489560">nil</span>&nbsp;<span class="op" id="2489564">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489568">return</span>&nbsp;<span class="builtintype" id="2489575">nil</span><span class="op" id="2489578">,</span>&nbsp;<span class="op" id="2489580">&amp;</span><span class="ident" id="2489581">PathError</span><span class="op" id="2489590">{</span><span class="string" id="2489591">&#34;open&#34;</span><span class="op" id="2489597">,</span>&nbsp;<span class="ident" id="2489599">name</span><span class="op" id="2489603">,</span>&nbsp;<span class="ident" id="2489605">e</span><span class="op" id="2489606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2489609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2489613">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2489666">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489722">if</span>&nbsp;<span class="op" id="2489725">!</span><span class="ident" id="2489726">supportsCloseOnExec</span>&nbsp;<span class="op" id="2489746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2489750">syscall</span><span class="op" id="2489757">.</span><span class="ident" id="2489758">CloseOnExec</span><span class="op" id="2489769">(</span><span class="ident" id="2489770">r</span><span class="op" id="2489771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2489774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489778">return</span>&nbsp;<span class="ident" id="2489785">NewFile</span><span class="op" id="2489792">(</span><span class="builtintype" id="2489793">uintptr</span><span class="op" id="2489800">(</span><span class="ident" id="2489801">r</span><span class="op" id="2489802">)</span><span class="op" id="2489803">,</span>&nbsp;<span class="ident" id="2489805">name</span><span class="op" id="2489809">)</span><span class="op" id="2489810">,</span>&nbsp;<span class="builtintype" id="2489812">nil</span><br>
<span class="lineno">90</span><span class="op" id="2489816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489819">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2489876">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2489908">func</span>&nbsp;<span class="op" id="2489913">(</span><span class="ident" id="2489914">f</span>&nbsp;<span class="op" id="2489916">*</span><span class="ident" id="2489917">File</span><span class="op" id="2489921">)</span>&nbsp;<span class="ident" id="2489923">Close</span><span class="op" id="2489928">(</span><span class="op" id="2489929">)</span>&nbsp;<span class="builtintype" id="2489931">error</span>&nbsp;<span class="op" id="2489937">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489940">if</span>&nbsp;<span class="ident" id="2489943">f</span>&nbsp;<span class="op" id="2489945">==</span>&nbsp;<span class="builtintype" id="2489948">nil</span>&nbsp;<span class="op" id="2489952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489956">return</span>&nbsp;<span class="ident" id="2489963">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2489975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2489978">return</span>&nbsp;<span class="ident" id="2489985">f</span><span class="op" id="2489986">.</span><span class="ident" id="2489987">file</span><span class="op" id="2489991">.</span><span class="builtinfunc" id="2489992">close</span><span class="op" id="2489997">(</span><span class="op" id="2489998">)</span><br>
<span class="lineno"></span><span class="op" id="2490000">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2490003">func</span>&nbsp;<span class="op" id="2490008">(</span><span class="ident" id="2490009">file</span>&nbsp;<span class="op" id="2490014">*</span><span class="ident" id="2490015">file</span><span class="op" id="2490019">)</span>&nbsp;<span class="builtinfunc" id="2490021">close</span><span class="op" id="2490026">(</span><span class="op" id="2490027">)</span>&nbsp;<span class="builtintype" id="2490029">error</span>&nbsp;<span class="op" id="2490035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490038">if</span>&nbsp;<span class="ident" id="2490041">file</span>&nbsp;<span class="op" id="2490046">==</span>&nbsp;<span class="builtintype" id="2490049">nil</span>&nbsp;<span class="op" id="2490053">||</span>&nbsp;<span class="ident" id="2490056">file</span><span class="op" id="2490060">.</span><span class="ident" id="2490061">fd</span>&nbsp;<span class="op" id="2490064">&lt;</span>&nbsp;<span class="num" id="2490066">0</span>&nbsp;<span class="op" id="2490068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490072">return</span>&nbsp;<span class="ident" id="2490079">syscall</span><span class="op" id="2490086">.</span><span class="ident" id="2490087">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490095">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490098">var</span>&nbsp;<span class="ident" id="2490102">err</span>&nbsp;<span class="builtintype" id="2490106">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490113">if</span>&nbsp;<span class="ident" id="2490116">e</span>&nbsp;<span class="op" id="2490118">:=</span>&nbsp;<span class="ident" id="2490121">syscall</span><span class="op" id="2490128">.</span><span class="ident" id="2490129">Close</span><span class="op" id="2490134">(</span><span class="ident" id="2490135">file</span><span class="op" id="2490139">.</span><span class="ident" id="2490140">fd</span><span class="op" id="2490142">)</span><span class="op" id="2490143">;</span>&nbsp;<span class="ident" id="2490145">e</span>&nbsp;<span class="op" id="2490147">!=</span>&nbsp;<span class="builtintype" id="2490150">nil</span>&nbsp;<span class="op" id="2490154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490158">err</span>&nbsp;<span class="op" id="2490162">=</span>&nbsp;<span class="op" id="2490164">&amp;</span><span class="ident" id="2490165">PathError</span><span class="op" id="2490174">{</span><span class="string" id="2490175">&#34;close&#34;</span><span class="op" id="2490182">,</span>&nbsp;<span class="ident" id="2490184">file</span><span class="op" id="2490188">.</span><span class="ident" id="2490189">name</span><span class="op" id="2490193">,</span>&nbsp;<span class="ident" id="2490195">e</span><span class="op" id="2490196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490202">file</span><span class="op" id="2490206">.</span><span class="ident" id="2490207">fd</span>&nbsp;<span class="op" id="2490210">=</span>&nbsp;<span class="op" id="2490212">-</span><span class="num" id="2490213">1</span>&nbsp;<span class="comment" id="2490215">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2490248">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490284">runtime</span><span class="op" id="2490291">.</span><span class="ident" id="2490292">SetFinalizer</span><span class="op" id="2490304">(</span><span class="ident" id="2490305">file</span><span class="op" id="2490309">,</span>&nbsp;<span class="builtintype" id="2490311">nil</span><span class="op" id="2490314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490317">return</span>&nbsp;<span class="ident" id="2490324">err</span><br>
<span class="lineno"></span><span class="op" id="2490328">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2490331">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2490387">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2490443">func</span>&nbsp;<span class="op" id="2490448">(</span><span class="ident" id="2490449">f</span>&nbsp;<span class="op" id="2490451">*</span><span class="ident" id="2490452">File</span><span class="op" id="2490456">)</span>&nbsp;<span class="ident" id="2490458">Stat</span><span class="op" id="2490462">(</span><span class="op" id="2490463">)</span>&nbsp;<span class="op" id="2490465">(</span><span class="ident" id="2490466">fi</span>&nbsp;<span class="ident" id="2490469">FileInfo</span><span class="op" id="2490477">,</span>&nbsp;<span class="ident" id="2490479">err</span>&nbsp;<span class="builtintype" id="2490483">error</span><span class="op" id="2490488">)</span>&nbsp;<span class="op" id="2490490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490493">if</span>&nbsp;<span class="ident" id="2490496">f</span>&nbsp;<span class="op" id="2490498">==</span>&nbsp;<span class="builtintype" id="2490501">nil</span>&nbsp;<span class="op" id="2490505">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490509">return</span>&nbsp;<span class="builtintype" id="2490516">nil</span><span class="op" id="2490519">,</span>&nbsp;<span class="ident" id="2490521">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490536">var</span>&nbsp;<span class="ident" id="2490540">stat</span>&nbsp;<span class="ident" id="2490545">syscall</span><span class="op" id="2490552">.</span><span class="ident" id="2490553">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490561">err</span>&nbsp;<span class="op" id="2490565">=</span>&nbsp;<span class="ident" id="2490567">syscall</span><span class="op" id="2490574">.</span><span class="ident" id="2490575">Fstat</span><span class="op" id="2490580">(</span><span class="ident" id="2490581">f</span><span class="op" id="2490582">.</span><span class="ident" id="2490583">fd</span><span class="op" id="2490585">,</span>&nbsp;<span class="op" id="2490587">&amp;</span><span class="ident" id="2490588">stat</span><span class="op" id="2490592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490595">if</span>&nbsp;<span class="ident" id="2490598">err</span>&nbsp;<span class="op" id="2490602">!=</span>&nbsp;<span class="builtintype" id="2490605">nil</span>&nbsp;<span class="op" id="2490609">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490613">return</span>&nbsp;<span class="builtintype" id="2490620">nil</span><span class="op" id="2490623">,</span>&nbsp;<span class="op" id="2490625">&amp;</span><span class="ident" id="2490626">PathError</span><span class="op" id="2490635">{</span><span class="string" id="2490636">&#34;stat&#34;</span><span class="op" id="2490642">,</span>&nbsp;<span class="ident" id="2490644">f</span><span class="op" id="2490645">.</span><span class="ident" id="2490646">name</span><span class="op" id="2490650">,</span>&nbsp;<span class="ident" id="2490652">err</span><span class="op" id="2490655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490661">return</span>&nbsp;<span class="ident" id="2490668">fileInfoFromStat</span><span class="op" id="2490684">(</span><span class="op" id="2490685">&amp;</span><span class="ident" id="2490686">stat</span><span class="op" id="2490690">,</span>&nbsp;<span class="ident" id="2490692">f</span><span class="op" id="2490693">.</span><span class="ident" id="2490694">name</span><span class="op" id="2490698">)</span><span class="op" id="2490699">,</span>&nbsp;<span class="builtintype" id="2490701">nil</span><br>
<span class="lineno"></span><span class="op" id="2490705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2490708">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2490762">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2490818">func</span>&nbsp;<span class="ident" id="2490823">Stat</span><span class="op" id="2490827">(</span><span class="ident" id="2490828">name</span>&nbsp;<span class="builtintype" id="2490833">string</span><span class="op" id="2490839">)</span>&nbsp;<span class="op" id="2490841">(</span><span class="ident" id="2490842">fi</span>&nbsp;<span class="ident" id="2490845">FileInfo</span><span class="op" id="2490853">,</span>&nbsp;<span class="ident" id="2490855">err</span>&nbsp;<span class="builtintype" id="2490859">error</span><span class="op" id="2490864">)</span>&nbsp;<span class="op" id="2490866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490869">var</span>&nbsp;<span class="ident" id="2490873">stat</span>&nbsp;<span class="ident" id="2490878">syscall</span><span class="op" id="2490885">.</span><span class="ident" id="2490886">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490894">err</span>&nbsp;<span class="op" id="2490898">=</span>&nbsp;<span class="ident" id="2490900">syscall</span><span class="op" id="2490907">.</span><span class="ident" id="2490908">Stat</span><span class="op" id="2490912">(</span><span class="ident" id="2490913">name</span><span class="op" id="2490917">,</span>&nbsp;<span class="op" id="2490919">&amp;</span><span class="ident" id="2490920">stat</span><span class="op" id="2490924">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490927">if</span>&nbsp;<span class="ident" id="2490930">err</span>&nbsp;<span class="op" id="2490934">!=</span>&nbsp;<span class="builtintype" id="2490937">nil</span>&nbsp;<span class="op" id="2490941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490945">return</span>&nbsp;<span class="builtintype" id="2490952">nil</span><span class="op" id="2490955">,</span>&nbsp;<span class="op" id="2490957">&amp;</span><span class="ident" id="2490958">PathError</span><span class="op" id="2490967">{</span><span class="string" id="2490968">&#34;stat&#34;</span><span class="op" id="2490974">,</span>&nbsp;<span class="ident" id="2490976">name</span><span class="op" id="2490980">,</span>&nbsp;<span class="ident" id="2490982">err</span><span class="op" id="2490985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490991">return</span>&nbsp;<span class="ident" id="2490998">fileInfoFromStat</span><span class="op" id="2491014">(</span><span class="op" id="2491015">&amp;</span><span class="ident" id="2491016">stat</span><span class="op" id="2491020">,</span>&nbsp;<span class="ident" id="2491022">name</span><span class="op" id="2491026">)</span><span class="op" id="2491027">,</span>&nbsp;<span class="builtintype" id="2491029">nil</span><br>
<span class="lineno"></span><span class="op" id="2491033">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2491036">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2491091">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2491148">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2491224">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2491280">func</span>&nbsp;<span class="ident" id="2491285">Lstat</span><span class="op" id="2491290">(</span><span class="ident" id="2491291">name</span>&nbsp;<span class="builtintype" id="2491296">string</span><span class="op" id="2491302">)</span>&nbsp;<span class="op" id="2491304">(</span><span class="ident" id="2491305">fi</span>&nbsp;<span class="ident" id="2491308">FileInfo</span><span class="op" id="2491316">,</span>&nbsp;<span class="ident" id="2491318">err</span>&nbsp;<span class="builtintype" id="2491322">error</span><span class="op" id="2491327">)</span>&nbsp;<span class="op" id="2491329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491332">var</span>&nbsp;<span class="ident" id="2491336">stat</span>&nbsp;<span class="ident" id="2491341">syscall</span><span class="op" id="2491348">.</span><span class="ident" id="2491349">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491357">err</span>&nbsp;<span class="op" id="2491361">=</span>&nbsp;<span class="ident" id="2491363">syscall</span><span class="op" id="2491370">.</span><span class="ident" id="2491371">Lstat</span><span class="op" id="2491376">(</span><span class="ident" id="2491377">name</span><span class="op" id="2491381">,</span>&nbsp;<span class="op" id="2491383">&amp;</span><span class="ident" id="2491384">stat</span><span class="op" id="2491388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491391">if</span>&nbsp;<span class="ident" id="2491394">err</span>&nbsp;<span class="op" id="2491398">!=</span>&nbsp;<span class="builtintype" id="2491401">nil</span>&nbsp;<span class="op" id="2491405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491409">return</span>&nbsp;<span class="builtintype" id="2491416">nil</span><span class="op" id="2491419">,</span>&nbsp;<span class="op" id="2491421">&amp;</span><span class="ident" id="2491422">PathError</span><span class="op" id="2491431">{</span><span class="string" id="2491432">&#34;lstat&#34;</span><span class="op" id="2491439">,</span>&nbsp;<span class="ident" id="2491441">name</span><span class="op" id="2491445">,</span>&nbsp;<span class="ident" id="2491447">err</span><span class="op" id="2491450">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491456">return</span>&nbsp;<span class="ident" id="2491463">fileInfoFromStat</span><span class="op" id="2491479">(</span><span class="op" id="2491480">&amp;</span><span class="ident" id="2491481">stat</span><span class="op" id="2491485">,</span>&nbsp;<span class="ident" id="2491487">name</span><span class="op" id="2491491">)</span><span class="op" id="2491492">,</span>&nbsp;<span class="builtintype" id="2491494">nil</span><br>
<span class="lineno"></span><span class="op" id="2491498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2491501">func</span>&nbsp;<span class="op" id="2491506">(</span><span class="ident" id="2491507">f</span>&nbsp;<span class="op" id="2491509">*</span><span class="ident" id="2491510">File</span><span class="op" id="2491514">)</span>&nbsp;<span class="ident" id="2491516">readdir</span><span class="op" id="2491523">(</span><span class="ident" id="2491524">n</span>&nbsp;<span class="builtintype" id="2491526">int</span><span class="op" id="2491529">)</span>&nbsp;<span class="op" id="2491531">(</span><span class="ident" id="2491532">fi</span>&nbsp;<span class="op" id="2491535">[</span><span class="op" id="2491536">]</span><span class="ident" id="2491537">FileInfo</span><span class="op" id="2491545">,</span>&nbsp;<span class="ident" id="2491547">err</span>&nbsp;<span class="builtintype" id="2491551">error</span><span class="op" id="2491556">)</span>&nbsp;<span class="op" id="2491558">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491561">dirname</span>&nbsp;<span class="op" id="2491569">:=</span>&nbsp;<span class="ident" id="2491572">f</span><span class="op" id="2491573">.</span><span class="ident" id="2491574">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491580">if</span>&nbsp;<span class="ident" id="2491583">dirname</span>&nbsp;<span class="op" id="2491591">==</span>&nbsp;<span class="string" id="2491594">&#34;&#34;</span>&nbsp;<span class="op" id="2491597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491601">dirname</span>&nbsp;<span class="op" id="2491609">=</span>&nbsp;<span class="string" id="2491611">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491619">names</span><span class="op" id="2491624">,</span>&nbsp;<span class="ident" id="2491626">err</span>&nbsp;<span class="op" id="2491630">:=</span>&nbsp;<span class="ident" id="2491633">f</span><span class="op" id="2491634">.</span><span class="ident" id="2491635">Readdirnames</span><span class="op" id="2491647">(</span><span class="ident" id="2491648">n</span><span class="op" id="2491649">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491652">fi</span>&nbsp;<span class="op" id="2491655">=</span>&nbsp;<span class="builtinfunc" id="2491657">make</span><span class="op" id="2491661">(</span><span class="op" id="2491662">[</span><span class="op" id="2491663">]</span><span class="ident" id="2491664">FileInfo</span><span class="op" id="2491672">,</span>&nbsp;<span class="num" id="2491674">0</span><span class="op" id="2491675">,</span>&nbsp;<span class="builtinfunc" id="2491677">len</span><span class="op" id="2491680">(</span><span class="ident" id="2491681">names</span><span class="op" id="2491686">)</span><span class="op" id="2491687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491690">for</span>&nbsp;<span class="ident" id="2491694">_</span><span class="op" id="2491695">,</span>&nbsp;<span class="ident" id="2491697">filename</span>&nbsp;<span class="op" id="2491706">:=</span>&nbsp;<span class="keyword" id="2491709">range</span>&nbsp;<span class="ident" id="2491715">names</span>&nbsp;<span class="op" id="2491721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491725">fip</span><span class="op" id="2491728">,</span>&nbsp;<span class="ident" id="2491730">lerr</span>&nbsp;<span class="op" id="2491735">:=</span>&nbsp;<span class="ident" id="2491738">lstat</span><span class="op" id="2491743">(</span><span class="ident" id="2491744">dirname</span>&nbsp;<span class="op" id="2491752">+</span>&nbsp;<span class="string" id="2491754">&#34;/&#34;</span>&nbsp;<span class="op" id="2491758">+</span>&nbsp;<span class="ident" id="2491760">filename</span><span class="op" id="2491768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491772">if</span>&nbsp;<span class="ident" id="2491775">IsNotExist</span><span class="op" id="2491785">(</span><span class="ident" id="2491786">lerr</span><span class="op" id="2491790">)</span>&nbsp;<span class="op" id="2491792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2491797">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2491844">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491887">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491902">if</span>&nbsp;<span class="ident" id="2491905">lerr</span>&nbsp;<span class="op" id="2491910">!=</span>&nbsp;<span class="builtintype" id="2491913">nil</span>&nbsp;<span class="op" id="2491917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491922">return</span>&nbsp;<span class="ident" id="2491929">fi</span><span class="op" id="2491931">,</span>&nbsp;<span class="ident" id="2491933">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491944">fi</span>&nbsp;<span class="op" id="2491947">=</span>&nbsp;<span class="builtinfunc" id="2491949">append</span><span class="op" id="2491955">(</span><span class="ident" id="2491956">fi</span><span class="op" id="2491958">,</span>&nbsp;<span class="ident" id="2491960">fip</span><span class="op" id="2491963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491969">return</span>&nbsp;<span class="ident" id="2491976">fi</span><span class="op" id="2491978">,</span>&nbsp;<span class="ident" id="2491980">err</span><br>
<span class="lineno"></span><span class="op" id="2491984">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2491987">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2492045">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2492099">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2492153">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2492171">const</span>&nbsp;<span class="op" id="2492177">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492180">needsMaxRW</span>&nbsp;<span class="op" id="2492191">=</span>&nbsp;<span class="ident" id="2492193">runtime</span><span class="op" id="2492200">.</span><span class="ident" id="2492201">GOOS</span>&nbsp;<span class="op" id="2492206">==</span>&nbsp;<span class="string" id="2492209">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2492218">||</span>&nbsp;<span class="ident" id="2492221">runtime</span><span class="op" id="2492228">.</span><span class="ident" id="2492229">GOOS</span>&nbsp;<span class="op" id="2492234">==</span>&nbsp;<span class="string" id="2492237">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492248">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492259">=</span>&nbsp;<span class="num" id="2492261">1</span>&nbsp;<span class="op" id="2492263">&lt;&lt;</span>&nbsp;<span class="num" id="2492266">30</span><br>
<span class="lineno"></span><span class="op" id="2492269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2492272">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2492320">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2492381">func</span>&nbsp;<span class="op" id="2492386">(</span><span class="ident" id="2492387">f</span>&nbsp;<span class="op" id="2492389">*</span><span class="ident" id="2492390">File</span><span class="op" id="2492394">)</span>&nbsp;<span class="ident" id="2492396">read</span><span class="op" id="2492400">(</span><span class="ident" id="2492401">b</span>&nbsp;<span class="op" id="2492403">[</span><span class="op" id="2492404">]</span><span class="builtintype" id="2492405">byte</span><span class="op" id="2492409">)</span>&nbsp;<span class="op" id="2492411">(</span><span class="ident" id="2492412">n</span>&nbsp;<span class="builtintype" id="2492414">int</span><span class="op" id="2492417">,</span>&nbsp;<span class="ident" id="2492419">err</span>&nbsp;<span class="builtintype" id="2492423">error</span><span class="op" id="2492428">)</span>&nbsp;<span class="op" id="2492430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492433">if</span>&nbsp;<span class="ident" id="2492436">needsMaxRW</span>&nbsp;<span class="op" id="2492447">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2492450">len</span><span class="op" id="2492453">(</span><span class="ident" id="2492454">b</span><span class="op" id="2492455">)</span>&nbsp;<span class="op" id="2492457">&gt;</span>&nbsp;<span class="ident" id="2492459">maxRW</span>&nbsp;<span class="op" id="2492465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492469">b</span>&nbsp;<span class="op" id="2492471">=</span>&nbsp;<span class="ident" id="2492473">b</span><span class="op" id="2492474">[</span><span class="op" id="2492475">:</span><span class="ident" id="2492476">maxRW</span><span class="op" id="2492481">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492487">return</span>&nbsp;<span class="ident" id="2492494">fixCount</span><span class="op" id="2492502">(</span><span class="ident" id="2492503">syscall</span><span class="op" id="2492510">.</span><span class="ident" id="2492511">Read</span><span class="op" id="2492515">(</span><span class="ident" id="2492516">f</span><span class="op" id="2492517">.</span><span class="ident" id="2492518">fd</span><span class="op" id="2492520">,</span>&nbsp;<span class="ident" id="2492522">b</span><span class="op" id="2492523">)</span><span class="op" id="2492524">)</span><br>
<span class="lineno"></span><span class="op" id="2492526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2492529">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2492600">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2492662">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2492718">func</span>&nbsp;<span class="op" id="2492723">(</span><span class="ident" id="2492724">f</span>&nbsp;<span class="op" id="2492726">*</span><span class="ident" id="2492727">File</span><span class="op" id="2492731">)</span>&nbsp;<span class="ident" id="2492733">pread</span><span class="op" id="2492738">(</span><span class="ident" id="2492739">b</span>&nbsp;<span class="op" id="2492741">[</span><span class="op" id="2492742">]</span><span class="builtintype" id="2492743">byte</span><span class="op" id="2492747">,</span>&nbsp;<span class="ident" id="2492749">off</span>&nbsp;<span class="builtintype" id="2492753">int64</span><span class="op" id="2492758">)</span>&nbsp;<span class="op" id="2492760">(</span><span class="ident" id="2492761">n</span>&nbsp;<span class="builtintype" id="2492763">int</span><span class="op" id="2492766">,</span>&nbsp;<span class="ident" id="2492768">err</span>&nbsp;<span class="builtintype" id="2492772">error</span><span class="op" id="2492777">)</span>&nbsp;<span class="op" id="2492779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492782">if</span>&nbsp;<span class="ident" id="2492785">needsMaxRW</span>&nbsp;<span class="op" id="2492796">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2492799">len</span><span class="op" id="2492802">(</span><span class="ident" id="2492803">b</span><span class="op" id="2492804">)</span>&nbsp;<span class="op" id="2492806">&gt;</span>&nbsp;<span class="ident" id="2492808">maxRW</span>&nbsp;<span class="op" id="2492814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492818">b</span>&nbsp;<span class="op" id="2492820">=</span>&nbsp;<span class="ident" id="2492822">b</span><span class="op" id="2492823">[</span><span class="op" id="2492824">:</span><span class="ident" id="2492825">maxRW</span><span class="op" id="2492830">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492836">return</span>&nbsp;<span class="ident" id="2492843">fixCount</span><span class="op" id="2492851">(</span><span class="ident" id="2492852">syscall</span><span class="op" id="2492859">.</span><span class="ident" id="2492860">Pread</span><span class="op" id="2492865">(</span><span class="ident" id="2492866">f</span><span class="op" id="2492867">.</span><span class="ident" id="2492868">fd</span><span class="op" id="2492870">,</span>&nbsp;<span class="ident" id="2492872">b</span><span class="op" id="2492873">,</span>&nbsp;<span class="ident" id="2492875">off</span><span class="op" id="2492878">)</span><span class="op" id="2492879">)</span><br>
<span class="lineno"></span><span class="op" id="2492881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2492884">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2492926">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2492990">func</span>&nbsp;<span class="op" id="2492995">(</span><span class="ident" id="2492996">f</span>&nbsp;<span class="op" id="2492998">*</span><span class="ident" id="2492999">File</span><span class="op" id="2493003">)</span>&nbsp;<span class="ident" id="2493005">write</span><span class="op" id="2493010">(</span><span class="ident" id="2493011">b</span>&nbsp;<span class="op" id="2493013">[</span><span class="op" id="2493014">]</span><span class="builtintype" id="2493015">byte</span><span class="op" id="2493019">)</span>&nbsp;<span class="op" id="2493021">(</span><span class="ident" id="2493022">n</span>&nbsp;<span class="builtintype" id="2493024">int</span><span class="op" id="2493027">,</span>&nbsp;<span class="ident" id="2493029">err</span>&nbsp;<span class="builtintype" id="2493033">error</span><span class="op" id="2493038">)</span>&nbsp;<span class="op" id="2493040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493043">for</span>&nbsp;<span class="op" id="2493047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493051">bcap</span>&nbsp;<span class="op" id="2493056">:=</span>&nbsp;<span class="ident" id="2493059">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493063">if</span>&nbsp;<span class="ident" id="2493066">needsMaxRW</span>&nbsp;<span class="op" id="2493077">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2493080">len</span><span class="op" id="2493083">(</span><span class="ident" id="2493084">bcap</span><span class="op" id="2493088">)</span>&nbsp;<span class="op" id="2493090">&gt;</span>&nbsp;<span class="ident" id="2493092">maxRW</span>&nbsp;<span class="op" id="2493098">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493103">bcap</span>&nbsp;<span class="op" id="2493108">=</span>&nbsp;<span class="ident" id="2493110">bcap</span><span class="op" id="2493114">[</span><span class="op" id="2493115">:</span><span class="ident" id="2493116">maxRW</span><span class="op" id="2493121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493129">m</span><span class="op" id="2493130">,</span>&nbsp;<span class="ident" id="2493132">err</span>&nbsp;<span class="op" id="2493136">:=</span>&nbsp;<span class="ident" id="2493139">fixCount</span><span class="op" id="2493147">(</span><span class="ident" id="2493148">syscall</span><span class="op" id="2493155">.</span><span class="ident" id="2493156">Write</span><span class="op" id="2493161">(</span><span class="ident" id="2493162">f</span><span class="op" id="2493163">.</span><span class="ident" id="2493164">fd</span><span class="op" id="2493166">,</span>&nbsp;<span class="ident" id="2493168">bcap</span><span class="op" id="2493172">)</span><span class="op" id="2493173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493177">n</span>&nbsp;<span class="op" id="2493179">+=</span>&nbsp;<span class="ident" id="2493182">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2493187">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2493249">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2493309">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493375">if</span>&nbsp;<span class="num" id="2493378">0</span>&nbsp;<span class="op" id="2493380">&lt;</span>&nbsp;<span class="ident" id="2493382">m</span>&nbsp;<span class="op" id="2493384">&amp;&amp;</span>&nbsp;<span class="ident" id="2493387">m</span>&nbsp;<span class="op" id="2493389">&lt;</span>&nbsp;<span class="builtinfunc" id="2493391">len</span><span class="op" id="2493394">(</span><span class="ident" id="2493395">bcap</span><span class="op" id="2493399">)</span>&nbsp;<span class="op" id="2493401">||</span>&nbsp;<span class="ident" id="2493404">err</span>&nbsp;<span class="op" id="2493408">==</span>&nbsp;<span class="ident" id="2493411">syscall</span><span class="op" id="2493418">.</span><span class="ident" id="2493419">EINTR</span>&nbsp;<span class="op" id="2493425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493430">b</span>&nbsp;<span class="op" id="2493432">=</span>&nbsp;<span class="ident" id="2493434">b</span><span class="op" id="2493435">[</span><span class="ident" id="2493436">m</span><span class="op" id="2493437">:</span><span class="op" id="2493438">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493443">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493459">if</span>&nbsp;<span class="ident" id="2493462">needsMaxRW</span>&nbsp;<span class="op" id="2493473">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2493476">len</span><span class="op" id="2493479">(</span><span class="ident" id="2493480">bcap</span><span class="op" id="2493484">)</span>&nbsp;<span class="op" id="2493486">!=</span>&nbsp;<span class="builtinfunc" id="2493489">len</span><span class="op" id="2493492">(</span><span class="ident" id="2493493">b</span><span class="op" id="2493494">)</span>&nbsp;<span class="op" id="2493496">&amp;&amp;</span>&nbsp;<span class="ident" id="2493499">err</span>&nbsp;<span class="op" id="2493503">==</span>&nbsp;<span class="builtintype" id="2493506">nil</span>&nbsp;<span class="op" id="2493510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493515">b</span>&nbsp;<span class="op" id="2493517">=</span>&nbsp;<span class="ident" id="2493519">b</span><span class="op" id="2493520">[</span><span class="ident" id="2493521">m</span><span class="op" id="2493522">:</span><span class="op" id="2493523">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493528">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493544">return</span>&nbsp;<span class="ident" id="2493551">n</span><span class="op" id="2493552">,</span>&nbsp;<span class="ident" id="2493554">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493559">}</span><br>
<span class="lineno">230</span><span class="op" id="2493561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2493564">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2493635">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2493699">func</span>&nbsp;<span class="op" id="2493704">(</span><span class="ident" id="2493705">f</span>&nbsp;<span class="op" id="2493707">*</span><span class="ident" id="2493708">File</span><span class="op" id="2493712">)</span>&nbsp;<span class="ident" id="2493714">pwrite</span><span class="op" id="2493720">(</span><span class="ident" id="2493721">b</span>&nbsp;<span class="op" id="2493723">[</span><span class="op" id="2493724">]</span><span class="builtintype" id="2493725">byte</span><span class="op" id="2493729">,</span>&nbsp;<span class="ident" id="2493731">off</span>&nbsp;<span class="builtintype" id="2493735">int64</span><span class="op" id="2493740">)</span>&nbsp;<span class="op" id="2493742">(</span><span class="ident" id="2493743">n</span>&nbsp;<span class="builtintype" id="2493745">int</span><span class="op" id="2493748">,</span>&nbsp;<span class="ident" id="2493750">err</span>&nbsp;<span class="builtintype" id="2493754">error</span><span class="op" id="2493759">)</span>&nbsp;<span class="op" id="2493761">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493764">if</span>&nbsp;<span class="ident" id="2493767">needsMaxRW</span>&nbsp;<span class="op" id="2493778">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2493781">len</span><span class="op" id="2493784">(</span><span class="ident" id="2493785">b</span><span class="op" id="2493786">)</span>&nbsp;<span class="op" id="2493788">&gt;</span>&nbsp;<span class="ident" id="2493790">maxRW</span>&nbsp;<span class="op" id="2493796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493800">b</span>&nbsp;<span class="op" id="2493802">=</span>&nbsp;<span class="ident" id="2493804">b</span><span class="op" id="2493805">[</span><span class="op" id="2493806">:</span><span class="ident" id="2493807">maxRW</span><span class="op" id="2493812">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493818">return</span>&nbsp;<span class="ident" id="2493825">fixCount</span><span class="op" id="2493833">(</span><span class="ident" id="2493834">syscall</span><span class="op" id="2493841">.</span><span class="ident" id="2493842">Pwrite</span><span class="op" id="2493848">(</span><span class="ident" id="2493849">f</span><span class="op" id="2493850">.</span><span class="ident" id="2493851">fd</span><span class="op" id="2493853">,</span>&nbsp;<span class="ident" id="2493855">b</span><span class="op" id="2493856">,</span>&nbsp;<span class="ident" id="2493858">off</span><span class="op" id="2493861">)</span><span class="op" id="2493862">)</span><br>
<span class="lineno"></span><span class="op" id="2493864">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2493867">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2493949">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2494025">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2494093">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2494144">func</span>&nbsp;<span class="op" id="2494149">(</span><span class="ident" id="2494150">f</span>&nbsp;<span class="op" id="2494152">*</span><span class="ident" id="2494153">File</span><span class="op" id="2494157">)</span>&nbsp;<span class="ident" id="2494159">seek</span><span class="op" id="2494163">(</span><span class="ident" id="2494164">offset</span>&nbsp;<span class="builtintype" id="2494171">int64</span><span class="op" id="2494176">,</span>&nbsp;<span class="ident" id="2494178">whence</span>&nbsp;<span class="builtintype" id="2494185">int</span><span class="op" id="2494188">)</span>&nbsp;<span class="op" id="2494190">(</span><span class="ident" id="2494191">ret</span>&nbsp;<span class="builtintype" id="2494195">int64</span><span class="op" id="2494200">,</span>&nbsp;<span class="ident" id="2494202">err</span>&nbsp;<span class="builtintype" id="2494206">error</span><span class="op" id="2494211">)</span>&nbsp;<span class="op" id="2494213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494216">return</span>&nbsp;<span class="ident" id="2494223">syscall</span><span class="op" id="2494230">.</span><span class="ident" id="2494231">Seek</span><span class="op" id="2494235">(</span><span class="ident" id="2494236">f</span><span class="op" id="2494237">.</span><span class="ident" id="2494238">fd</span><span class="op" id="2494240">,</span>&nbsp;<span class="ident" id="2494242">offset</span><span class="op" id="2494248">,</span>&nbsp;<span class="ident" id="2494250">whence</span><span class="op" id="2494256">)</span><br>
<span class="lineno"></span><span class="op" id="2494258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2494261">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2494309">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2494386">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2494442">func</span>&nbsp;<span class="ident" id="2494447">Truncate</span><span class="op" id="2494455">(</span><span class="ident" id="2494456">name</span>&nbsp;<span class="builtintype" id="2494461">string</span><span class="op" id="2494467">,</span>&nbsp;<span class="ident" id="2494469">size</span>&nbsp;<span class="builtintype" id="2494474">int64</span><span class="op" id="2494479">)</span>&nbsp;<span class="builtintype" id="2494481">error</span>&nbsp;<span class="op" id="2494487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494490">if</span>&nbsp;<span class="ident" id="2494493">e</span>&nbsp;<span class="op" id="2494495">:=</span>&nbsp;<span class="ident" id="2494498">syscall</span><span class="op" id="2494505">.</span><span class="ident" id="2494506">Truncate</span><span class="op" id="2494514">(</span><span class="ident" id="2494515">name</span><span class="op" id="2494519">,</span>&nbsp;<span class="ident" id="2494521">size</span><span class="op" id="2494525">)</span><span class="op" id="2494526">;</span>&nbsp;<span class="ident" id="2494528">e</span>&nbsp;<span class="op" id="2494530">!=</span>&nbsp;<span class="builtintype" id="2494533">nil</span>&nbsp;<span class="op" id="2494537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494541">return</span>&nbsp;<span class="op" id="2494548">&amp;</span><span class="ident" id="2494549">PathError</span><span class="op" id="2494558">{</span><span class="string" id="2494559">&#34;truncate&#34;</span><span class="op" id="2494569">,</span>&nbsp;<span class="ident" id="2494571">name</span><span class="op" id="2494575">,</span>&nbsp;<span class="ident" id="2494577">e</span><span class="op" id="2494578">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2494581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494584">return</span>&nbsp;<span class="builtintype" id="2494591">nil</span><br>
<span class="lineno"></span><span class="op" id="2494595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2494598">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2494645">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2494701">func</span>&nbsp;<span class="ident" id="2494706">Remove</span><span class="op" id="2494712">(</span><span class="ident" id="2494713">name</span>&nbsp;<span class="builtintype" id="2494718">string</span><span class="op" id="2494724">)</span>&nbsp;<span class="builtintype" id="2494726">error</span>&nbsp;<span class="op" id="2494732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2494735">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2494779">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2494820">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2494864">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2494901">e</span>&nbsp;<span class="op" id="2494903">:=</span>&nbsp;<span class="ident" id="2494906">syscall</span><span class="op" id="2494913">.</span><span class="ident" id="2494914">Unlink</span><span class="op" id="2494920">(</span><span class="ident" id="2494921">name</span><span class="op" id="2494925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494928">if</span>&nbsp;<span class="ident" id="2494931">e</span>&nbsp;<span class="op" id="2494933">==</span>&nbsp;<span class="builtintype" id="2494936">nil</span>&nbsp;<span class="op" id="2494940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494944">return</span>&nbsp;<span class="builtintype" id="2494951">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2494956">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2494959">e1</span>&nbsp;<span class="op" id="2494962">:=</span>&nbsp;<span class="ident" id="2494965">syscall</span><span class="op" id="2494972">.</span><span class="ident" id="2494973">Rmdir</span><span class="op" id="2494978">(</span><span class="ident" id="2494979">name</span><span class="op" id="2494983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494986">if</span>&nbsp;<span class="ident" id="2494989">e1</span>&nbsp;<span class="op" id="2494992">==</span>&nbsp;<span class="builtintype" id="2494995">nil</span>&nbsp;<span class="op" id="2494999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495003">return</span>&nbsp;<span class="builtintype" id="2495010">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495019">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495070">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495119">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495168">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495217">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495271">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495322">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495377">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495426">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495457">if</span>&nbsp;<span class="ident" id="2495460">e1</span>&nbsp;<span class="op" id="2495463">!=</span>&nbsp;<span class="ident" id="2495466">syscall</span><span class="op" id="2495473">.</span><span class="ident" id="2495474">ENOTDIR</span>&nbsp;<span class="op" id="2495482">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495486">e</span>&nbsp;<span class="op" id="2495488">=</span>&nbsp;<span class="ident" id="2495490">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495497">return</span>&nbsp;<span class="op" id="2495504">&amp;</span><span class="ident" id="2495505">PathError</span><span class="op" id="2495514">{</span><span class="string" id="2495515">&#34;remove&#34;</span><span class="op" id="2495523">,</span>&nbsp;<span class="ident" id="2495525">name</span><span class="op" id="2495529">,</span>&nbsp;<span class="ident" id="2495531">e</span><span class="op" id="2495532">}</span><br>
<span class="lineno"></span><span class="op" id="2495534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2495537">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2495620">func</span>&nbsp;<span class="ident" id="2495625">basename</span><span class="op" id="2495633">(</span><span class="ident" id="2495634">name</span>&nbsp;<span class="builtintype" id="2495639">string</span><span class="op" id="2495645">)</span>&nbsp;<span class="builtintype" id="2495647">string</span>&nbsp;<span class="op" id="2495654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495657">i</span>&nbsp;<span class="op" id="2495659">:=</span>&nbsp;<span class="builtinfunc" id="2495662">len</span><span class="op" id="2495665">(</span><span class="ident" id="2495666">name</span><span class="op" id="2495670">)</span>&nbsp;<span class="op" id="2495672">-</span>&nbsp;<span class="num" id="2495674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495677">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495705">for</span>&nbsp;<span class="op" id="2495709">;</span>&nbsp;<span class="ident" id="2495711">i</span>&nbsp;<span class="op" id="2495713">&gt;</span>&nbsp;<span class="num" id="2495715">0</span>&nbsp;<span class="op" id="2495717">&amp;&amp;</span>&nbsp;<span class="ident" id="2495720">name</span><span class="op" id="2495724">[</span><span class="ident" id="2495725">i</span><span class="op" id="2495726">]</span>&nbsp;<span class="op" id="2495728">==</span>&nbsp;<span class="string" id="2495731">&#39;/&#39;</span><span class="op" id="2495734">;</span>&nbsp;<span class="ident" id="2495736">i</span><span class="op" id="2495737">--</span>&nbsp;<span class="op" id="2495740">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495744">name</span>&nbsp;<span class="op" id="2495749">=</span>&nbsp;<span class="ident" id="2495751">name</span><span class="op" id="2495755">[</span><span class="op" id="2495756">:</span><span class="ident" id="2495757">i</span><span class="op" id="2495758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2495764">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495798">for</span>&nbsp;<span class="ident" id="2495802">i</span><span class="op" id="2495803">--</span><span class="op" id="2495805">;</span>&nbsp;<span class="ident" id="2495807">i</span>&nbsp;<span class="op" id="2495809">&gt;=</span>&nbsp;<span class="num" id="2495812">0</span><span class="op" id="2495813">;</span>&nbsp;<span class="ident" id="2495815">i</span><span class="op" id="2495816">--</span>&nbsp;<span class="op" id="2495819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495823">if</span>&nbsp;<span class="ident" id="2495826">name</span><span class="op" id="2495830">[</span><span class="ident" id="2495831">i</span><span class="op" id="2495832">]</span>&nbsp;<span class="op" id="2495834">==</span>&nbsp;<span class="string" id="2495837">&#39;/&#39;</span>&nbsp;<span class="op" id="2495841">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495846">name</span>&nbsp;<span class="op" id="2495851">=</span>&nbsp;<span class="ident" id="2495853">name</span><span class="op" id="2495857">[</span><span class="ident" id="2495858">i</span><span class="op" id="2495859">+</span><span class="num" id="2495860">1</span><span class="op" id="2495861">:</span><span class="op" id="2495862">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495867">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495882">return</span>&nbsp;<span class="ident" id="2495889">name</span><br>
<span class="lineno"></span><span class="op" id="2495894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2495897">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2495966">func</span>&nbsp;<span class="ident" id="2495971">TempDir</span><span class="op" id="2495978">(</span><span class="op" id="2495979">)</span>&nbsp;<span class="builtintype" id="2495981">string</span>&nbsp;<span class="op" id="2495988">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495991">dir</span>&nbsp;<span class="op" id="2495995">:=</span>&nbsp;<span class="ident" id="2495998">Getenv</span><span class="op" id="2496004">(</span><span class="string" id="2496005">&#34;TMPDIR&#34;</span><span class="op" id="2496013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496016">if</span>&nbsp;<span class="ident" id="2496019">dir</span>&nbsp;<span class="op" id="2496023">==</span>&nbsp;<span class="string" id="2496026">&#34;&#34;</span>&nbsp;<span class="op" id="2496029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496033">if</span>&nbsp;<span class="ident" id="2496036">runtime</span><span class="op" id="2496043">.</span><span class="ident" id="2496044">GOOS</span>&nbsp;<span class="op" id="2496049">==</span>&nbsp;<span class="string" id="2496052">&#34;android&#34;</span>&nbsp;<span class="op" id="2496062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496067">dir</span>&nbsp;<span class="op" id="2496071">=</span>&nbsp;<span class="string" id="2496073">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2496093">}</span>&nbsp;<span class="keyword" id="2496095">else</span>&nbsp;<span class="op" id="2496100">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496105">dir</span>&nbsp;<span class="op" id="2496109">=</span>&nbsp;<span class="string" id="2496111">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2496120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2496123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496126">return</span>&nbsp;<span class="ident" id="2496133">dir</span><br>
<span class="lineno"></span><span class="op" id="2496137">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2496140">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2496200">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2496256">func</span>&nbsp;<span class="ident" id="2496261">Link</span><span class="op" id="2496265">(</span><span class="ident" id="2496266">oldname</span><span class="op" id="2496273">,</span>&nbsp;<span class="ident" id="2496275">newname</span>&nbsp;<span class="builtintype" id="2496283">string</span><span class="op" id="2496289">)</span>&nbsp;<span class="builtintype" id="2496291">error</span>&nbsp;<span class="op" id="2496297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496300">e</span>&nbsp;<span class="op" id="2496302">:=</span>&nbsp;<span class="ident" id="2496305">syscall</span><span class="op" id="2496312">.</span><span class="ident" id="2496313">Link</span><span class="op" id="2496317">(</span><span class="ident" id="2496318">oldname</span><span class="op" id="2496325">,</span>&nbsp;<span class="ident" id="2496327">newname</span><span class="op" id="2496334">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496337">if</span>&nbsp;<span class="ident" id="2496340">e</span>&nbsp;<span class="op" id="2496342">!=</span>&nbsp;<span class="builtintype" id="2496345">nil</span>&nbsp;<span class="op" id="2496349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496353">return</span>&nbsp;<span class="op" id="2496360">&amp;</span><span class="ident" id="2496361">LinkError</span><span class="op" id="2496370">{</span><span class="string" id="2496371">&#34;link&#34;</span><span class="op" id="2496377">,</span>&nbsp;<span class="ident" id="2496379">oldname</span><span class="op" id="2496386">,</span>&nbsp;<span class="ident" id="2496388">newname</span><span class="op" id="2496395">,</span>&nbsp;<span class="ident" id="2496397">e</span><span class="op" id="2496398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2496401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496404">return</span>&nbsp;<span class="builtintype" id="2496411">nil</span><br>
<span class="lineno"></span><span class="op" id="2496415">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2496418">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2496476">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2496532">func</span>&nbsp;<span class="ident" id="2496537">Symlink</span><span class="op" id="2496544">(</span><span class="ident" id="2496545">oldname</span><span class="op" id="2496552">,</span>&nbsp;<span class="ident" id="2496554">newname</span>&nbsp;<span class="builtintype" id="2496562">string</span><span class="op" id="2496568">)</span>&nbsp;<span class="builtintype" id="2496570">error</span>&nbsp;<span class="op" id="2496576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496579">e</span>&nbsp;<span class="op" id="2496581">:=</span>&nbsp;<span class="ident" id="2496584">syscall</span><span class="op" id="2496591">.</span><span class="ident" id="2496592">Symlink</span><span class="op" id="2496599">(</span><span class="ident" id="2496600">oldname</span><span class="op" id="2496607">,</span>&nbsp;<span class="ident" id="2496609">newname</span><span class="op" id="2496616">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496619">if</span>&nbsp;<span class="ident" id="2496622">e</span>&nbsp;<span class="op" id="2496624">!=</span>&nbsp;<span class="builtintype" id="2496627">nil</span>&nbsp;<span class="op" id="2496631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496635">return</span>&nbsp;<span class="op" id="2496642">&amp;</span><span class="ident" id="2496643">LinkError</span><span class="op" id="2496652">{</span><span class="string" id="2496653">&#34;symlink&#34;</span><span class="op" id="2496662">,</span>&nbsp;<span class="ident" id="2496664">oldname</span><span class="op" id="2496671">,</span>&nbsp;<span class="ident" id="2496673">newname</span><span class="op" id="2496680">,</span>&nbsp;<span class="ident" id="2496682">e</span><span class="op" id="2496683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2496686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2496689">return</span>&nbsp;<span class="builtintype" id="2496696">nil</span><br>
<span class="lineno"></span><span class="op" id="2496700">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
