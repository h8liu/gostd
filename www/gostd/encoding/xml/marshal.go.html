<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html" class="current">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5671161">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5671216">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5671270">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5671321">package</span>&nbsp;<span class="ident" id="5671329">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671334">import</span>&nbsp;<span class="op" id="5671341">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671344">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671353">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671362">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671374">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671381">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671387">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671398">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5671409">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5671419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671422">const</span>&nbsp;<span class="op" id="5671428">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671431">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671501">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671568">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671605">Header</span>&nbsp;<span class="op" id="5671612">=</span>&nbsp;<span class="string" id="5671614">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="5671655">+</span>&nbsp;<span class="string" id="5671657">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="5671662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5671665">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5671707">//</span><br>
<span class="lineno"></span><span class="comment" id="5671710">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="5671784">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5671862">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="5671940">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5672015">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="5672094">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5672127">//</span><br>
<span class="lineno"></span><span class="comment" id="5672130">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="5672202">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="5672265">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="5672322">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5672383">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5672445">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="5672486">//</span><br>
<span class="lineno"></span><span class="comment" id="5672489">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5672566">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="5672623">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="5672680">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="5672722">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5672786">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5672830">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5672894">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5672934">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="5673002">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5673034">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="5673105">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="5673150">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5673221">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="5673294">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5673330">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="5673402">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5673475">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5673546">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="5673578">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5673648">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="5673694">//</span><br>
<span class="lineno"></span><span class="comment" id="5673697">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="5673772">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="5673849">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5673905">//</span><br>
<span class="lineno"></span><span class="comment" id="5673908">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="5673945">//</span><br>
<span class="lineno"></span><span class="comment" id="5673948">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="5674029">func</span>&nbsp;<span class="ident" id="5674034">Marshal</span><span class="op" id="5674041">(</span><span class="ident" id="5674042">v</span>&nbsp;<span class="keyword" id="5674044">interface</span><span class="op" id="5674053">{</span><span class="op" id="5674054">}</span><span class="op" id="5674055">)</span>&nbsp;<span class="op" id="5674057">(</span><span class="op" id="5674058">[</span><span class="op" id="5674059">]</span><span class="builtintype" id="5674060">byte</span><span class="op" id="5674064">,</span>&nbsp;<span class="builtintype" id="5674066">error</span><span class="op" id="5674071">)</span>&nbsp;<span class="op" id="5674073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674076">var</span>&nbsp;<span class="ident" id="5674080">b</span>&nbsp;<span class="ident" id="5674082">bytes</span><span class="op" id="5674087">.</span><span class="ident" id="5674088">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674096">if</span>&nbsp;<span class="ident" id="5674099">err</span>&nbsp;<span class="op" id="5674103">:=</span>&nbsp;<span class="ident" id="5674106">NewEncoder</span><span class="op" id="5674116">(</span><span class="op" id="5674117">&amp;</span><span class="ident" id="5674118">b</span><span class="op" id="5674119">)</span><span class="op" id="5674120">.</span><span class="ident" id="5674121">Encode</span><span class="op" id="5674127">(</span><span class="ident" id="5674128">v</span><span class="op" id="5674129">)</span><span class="op" id="5674130">;</span>&nbsp;<span class="ident" id="5674132">err</span>&nbsp;<span class="op" id="5674136">!=</span>&nbsp;<span class="ident" id="5674139">nil</span>&nbsp;<span class="op" id="5674143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674147">return</span>&nbsp;<span class="ident" id="5674154">nil</span><span class="op" id="5674157">,</span>&nbsp;<span class="ident" id="5674159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674164">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674167">return</span>&nbsp;<span class="ident" id="5674174">b</span><span class="op" id="5674175">.</span><span class="ident" id="5674176">Bytes</span><span class="op" id="5674181">(</span><span class="op" id="5674182">)</span><span class="op" id="5674183">,</span>&nbsp;<span class="ident" id="5674185">nil</span><br>
<span class="lineno"></span><span class="op" id="5674189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5674192">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="5674262">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="5674301">//</span><br>
<span class="lineno"></span><span class="comment" id="5674304">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="5674369">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5674440">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5674471">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="5674535">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="5674601">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="5674618">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="5674683">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5674748">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="5674787">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="5674856">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5674907">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="5674973">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5674990">type</span>&nbsp;<span class="ident" id="5674995">Marshaler</span>&nbsp;<span class="keyword" id="5675005">interface</span>&nbsp;<span class="op" id="5675015">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675018">MarshalXML</span><span class="op" id="5675028">(</span><span class="ident" id="5675029">e</span>&nbsp;<span class="op" id="5675031">*</span><span class="ident" id="5675032">Encoder</span><span class="op" id="5675039">,</span>&nbsp;<span class="ident" id="5675041">start</span>&nbsp;<span class="ident" id="5675047">StartElement</span><span class="op" id="5675059">)</span>&nbsp;<span class="builtintype" id="5675061">error</span><br>
<span class="lineno"></span><span class="op" id="5675067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5675070">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="5675144">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="5675185">//</span><br>
<span class="lineno"></span><span class="comment" id="5675188">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="5675271">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5675337">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="5675400">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="5675417">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="5675486">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5675522">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5675580">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="5675615">type</span>&nbsp;<span class="ident" id="5675620">MarshalerAttr</span>&nbsp;<span class="keyword" id="5675634">interface</span>&nbsp;<span class="op" id="5675644">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675647">MarshalXMLAttr</span><span class="op" id="5675661">(</span><span class="ident" id="5675662">name</span>&nbsp;<span class="ident" id="5675667">Name</span><span class="op" id="5675671">)</span>&nbsp;<span class="op" id="5675673">(</span><span class="ident" id="5675674">Attr</span><span class="op" id="5675678">,</span>&nbsp;<span class="builtintype" id="5675680">error</span><span class="op" id="5675685">)</span><br>
<span class="lineno"></span><span class="op" id="5675687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5675690">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="5675764">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="5675836">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5675888">func</span>&nbsp;<span class="ident" id="5675893">MarshalIndent</span><span class="op" id="5675906">(</span><span class="ident" id="5675907">v</span>&nbsp;<span class="keyword" id="5675909">interface</span><span class="op" id="5675918">{</span><span class="op" id="5675919">}</span><span class="op" id="5675920">,</span>&nbsp;<span class="ident" id="5675922">prefix</span><span class="op" id="5675928">,</span>&nbsp;<span class="ident" id="5675930">indent</span>&nbsp;<span class="builtintype" id="5675937">string</span><span class="op" id="5675943">)</span>&nbsp;<span class="op" id="5675945">(</span><span class="op" id="5675946">[</span><span class="op" id="5675947">]</span><span class="builtintype" id="5675948">byte</span><span class="op" id="5675952">,</span>&nbsp;<span class="builtintype" id="5675954">error</span><span class="op" id="5675959">)</span>&nbsp;<span class="op" id="5675961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675964">var</span>&nbsp;<span class="ident" id="5675968">b</span>&nbsp;<span class="ident" id="5675970">bytes</span><span class="op" id="5675975">.</span><span class="ident" id="5675976">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675984">enc</span>&nbsp;<span class="op" id="5675988">:=</span>&nbsp;<span class="ident" id="5675991">NewEncoder</span><span class="op" id="5676001">(</span><span class="op" id="5676002">&amp;</span><span class="ident" id="5676003">b</span><span class="op" id="5676004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676007">enc</span><span class="op" id="5676010">.</span><span class="ident" id="5676011">Indent</span><span class="op" id="5676017">(</span><span class="ident" id="5676018">prefix</span><span class="op" id="5676024">,</span>&nbsp;<span class="ident" id="5676026">indent</span><span class="op" id="5676032">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676035">if</span>&nbsp;<span class="ident" id="5676038">err</span>&nbsp;<span class="op" id="5676042">:=</span>&nbsp;<span class="ident" id="5676045">enc</span><span class="op" id="5676048">.</span><span class="ident" id="5676049">Encode</span><span class="op" id="5676055">(</span><span class="ident" id="5676056">v</span><span class="op" id="5676057">)</span><span class="op" id="5676058">;</span>&nbsp;<span class="ident" id="5676060">err</span>&nbsp;<span class="op" id="5676064">!=</span>&nbsp;<span class="ident" id="5676067">nil</span>&nbsp;<span class="op" id="5676071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676075">return</span>&nbsp;<span class="ident" id="5676082">nil</span><span class="op" id="5676085">,</span>&nbsp;<span class="ident" id="5676087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676095">return</span>&nbsp;<span class="ident" id="5676102">b</span><span class="op" id="5676103">.</span><span class="ident" id="5676104">Bytes</span><span class="op" id="5676109">(</span><span class="op" id="5676110">)</span><span class="op" id="5676111">,</span>&nbsp;<span class="ident" id="5676113">nil</span><br>
<span class="lineno"></span><span class="op" id="5676117">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="5676120">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5676171">type</span>&nbsp;<span class="ident" id="5676176">Encoder</span>&nbsp;<span class="keyword" id="5676184">struct</span>&nbsp;<span class="op" id="5676191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676194">p</span>&nbsp;<span class="ident" id="5676196">printer</span><br>
<span class="lineno"></span><span class="op" id="5676204">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5676207">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5676261">func</span>&nbsp;<span class="ident" id="5676266">NewEncoder</span><span class="op" id="5676276">(</span><span class="ident" id="5676277">w</span>&nbsp;<span class="ident" id="5676279">io</span><span class="op" id="5676281">.</span><span class="ident" id="5676282">Writer</span><span class="op" id="5676288">)</span>&nbsp;<span class="op" id="5676290">*</span><span class="ident" id="5676291">Encoder</span>&nbsp;<span class="op" id="5676299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676302">e</span>&nbsp;<span class="op" id="5676304">:=</span>&nbsp;<span class="op" id="5676307">&amp;</span><span class="ident" id="5676308">Encoder</span><span class="op" id="5676315">{</span><span class="ident" id="5676316">printer</span><span class="op" id="5676323">{</span><span class="ident" id="5676324">Writer</span><span class="op" id="5676330">:</span>&nbsp;<span class="ident" id="5676332">bufio</span><span class="op" id="5676337">.</span><span class="ident" id="5676338">NewWriter</span><span class="op" id="5676347">(</span><span class="ident" id="5676348">w</span><span class="op" id="5676349">)</span><span class="op" id="5676350">}</span><span class="op" id="5676351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676354">e</span><span class="op" id="5676355">.</span><span class="ident" id="5676356">p</span><span class="op" id="5676357">.</span><span class="ident" id="5676358">encoder</span>&nbsp;<span class="op" id="5676366">=</span>&nbsp;<span class="ident" id="5676368">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676371">return</span>&nbsp;<span class="ident" id="5676378">e</span><br>
<span class="lineno"></span><span class="op" id="5676380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5676383">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="5676448">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="5676524">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5676588">func</span>&nbsp;<span class="op" id="5676593">(</span><span class="ident" id="5676594">enc</span>&nbsp;<span class="op" id="5676598">*</span><span class="ident" id="5676599">Encoder</span><span class="op" id="5676606">)</span>&nbsp;<span class="ident" id="5676608">Indent</span><span class="op" id="5676614">(</span><span class="ident" id="5676615">prefix</span><span class="op" id="5676621">,</span>&nbsp;<span class="ident" id="5676623">indent</span>&nbsp;<span class="builtintype" id="5676630">string</span><span class="op" id="5676636">)</span>&nbsp;<span class="op" id="5676638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676641">enc</span><span class="op" id="5676644">.</span><span class="ident" id="5676645">p</span><span class="op" id="5676646">.</span><span class="ident" id="5676647">prefix</span>&nbsp;<span class="op" id="5676654">=</span>&nbsp;<span class="ident" id="5676656">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676664">enc</span><span class="op" id="5676667">.</span><span class="ident" id="5676668">p</span><span class="op" id="5676669">.</span><span class="ident" id="5676670">indent</span>&nbsp;<span class="op" id="5676677">=</span>&nbsp;<span class="ident" id="5676679">indent</span><br>
<span class="lineno"></span><span class="op" id="5676686">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="5676689">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5676743">//</span><br>
<span class="lineno"></span><span class="comment" id="5676746">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="5676816">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="5676840">//</span><br>
<span class="lineno"></span><span class="comment" id="5676843">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="5676883">func</span>&nbsp;<span class="op" id="5676888">(</span><span class="ident" id="5676889">enc</span>&nbsp;<span class="op" id="5676893">*</span><span class="ident" id="5676894">Encoder</span><span class="op" id="5676901">)</span>&nbsp;<span class="ident" id="5676903">Encode</span><span class="op" id="5676909">(</span><span class="ident" id="5676910">v</span>&nbsp;<span class="keyword" id="5676912">interface</span><span class="op" id="5676921">{</span><span class="op" id="5676922">}</span><span class="op" id="5676923">)</span>&nbsp;<span class="builtintype" id="5676925">error</span>&nbsp;<span class="op" id="5676931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676934">err</span>&nbsp;<span class="op" id="5676938">:=</span>&nbsp;<span class="ident" id="5676941">enc</span><span class="op" id="5676944">.</span><span class="ident" id="5676945">p</span><span class="op" id="5676946">.</span><span class="ident" id="5676947">marshalValue</span><span class="op" id="5676959">(</span><span class="ident" id="5676960">reflect</span><span class="op" id="5676967">.</span><span class="ident" id="5676968">ValueOf</span><span class="op" id="5676975">(</span><span class="ident" id="5676976">v</span><span class="op" id="5676977">)</span><span class="op" id="5676978">,</span>&nbsp;<span class="ident" id="5676980">nil</span><span class="op" id="5676983">,</span>&nbsp;<span class="ident" id="5676985">nil</span><span class="op" id="5676988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676991">if</span>&nbsp;<span class="ident" id="5676994">err</span>&nbsp;<span class="op" id="5676998">!=</span>&nbsp;<span class="ident" id="5677001">nil</span>&nbsp;<span class="op" id="5677005">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677009">return</span>&nbsp;<span class="ident" id="5677016">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677024">return</span>&nbsp;<span class="ident" id="5677031">enc</span><span class="op" id="5677034">.</span><span class="ident" id="5677035">p</span><span class="op" id="5677036">.</span><span class="ident" id="5677037">Flush</span><span class="op" id="5677042">(</span><span class="op" id="5677043">)</span><br>
<span class="lineno"></span><span class="op" id="5677045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5677048">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5677109">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="5677162">//</span><br>
<span class="lineno"></span><span class="comment" id="5677165">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="5677235">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="5677259">//</span><br>
<span class="lineno"></span><span class="comment" id="5677262">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="5677309">func</span>&nbsp;<span class="op" id="5677314">(</span><span class="ident" id="5677315">enc</span>&nbsp;<span class="op" id="5677319">*</span><span class="ident" id="5677320">Encoder</span><span class="op" id="5677327">)</span>&nbsp;<span class="ident" id="5677329">EncodeElement</span><span class="op" id="5677342">(</span><span class="ident" id="5677343">v</span>&nbsp;<span class="keyword" id="5677345">interface</span><span class="op" id="5677354">{</span><span class="op" id="5677355">}</span><span class="op" id="5677356">,</span>&nbsp;<span class="ident" id="5677358">start</span>&nbsp;<span class="ident" id="5677364">StartElement</span><span class="op" id="5677376">)</span>&nbsp;<span class="builtintype" id="5677378">error</span>&nbsp;<span class="op" id="5677384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677387">err</span>&nbsp;<span class="op" id="5677391">:=</span>&nbsp;<span class="ident" id="5677394">enc</span><span class="op" id="5677397">.</span><span class="ident" id="5677398">p</span><span class="op" id="5677399">.</span><span class="ident" id="5677400">marshalValue</span><span class="op" id="5677412">(</span><span class="ident" id="5677413">reflect</span><span class="op" id="5677420">.</span><span class="ident" id="5677421">ValueOf</span><span class="op" id="5677428">(</span><span class="ident" id="5677429">v</span><span class="op" id="5677430">)</span><span class="op" id="5677431">,</span>&nbsp;<span class="ident" id="5677433">nil</span><span class="op" id="5677436">,</span>&nbsp;<span class="op" id="5677438">&amp;</span><span class="ident" id="5677439">start</span><span class="op" id="5677444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677447">if</span>&nbsp;<span class="ident" id="5677450">err</span>&nbsp;<span class="op" id="5677454">!=</span>&nbsp;<span class="ident" id="5677457">nil</span>&nbsp;<span class="op" id="5677461">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677465">return</span>&nbsp;<span class="ident" id="5677472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677480">return</span>&nbsp;<span class="ident" id="5677487">enc</span><span class="op" id="5677490">.</span><span class="ident" id="5677491">p</span><span class="op" id="5677492">.</span><span class="ident" id="5677493">Flush</span><span class="op" id="5677498">(</span><span class="op" id="5677499">)</span><br>
<span class="lineno"></span><span class="op" id="5677501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="5677504">var</span>&nbsp;<span class="op" id="5677508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677511">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5677524">=</span>&nbsp;<span class="op" id="5677526">[</span><span class="op" id="5677527">]</span><span class="builtintype" id="5677528">byte</span><span class="op" id="5677532">(</span><span class="string" id="5677533">&#34;--&gt;&#34;</span><span class="op" id="5677538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677541">endProcInst</span>&nbsp;&nbsp;<span class="op" id="5677554">=</span>&nbsp;<span class="op" id="5677556">[</span><span class="op" id="5677557">]</span><span class="builtintype" id="5677558">byte</span><span class="op" id="5677562">(</span><span class="string" id="5677563">&#34;?&gt;&#34;</span><span class="op" id="5677567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677570">endDirective</span>&nbsp;<span class="op" id="5677583">=</span>&nbsp;<span class="op" id="5677585">[</span><span class="op" id="5677586">]</span><span class="builtintype" id="5677587">byte</span><span class="op" id="5677591">(</span><span class="string" id="5677592">&#34;&gt;&#34;</span><span class="op" id="5677595">)</span><br>
<span class="lineno"></span><span class="op" id="5677597">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="5677600">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5677657">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="5677744">//</span><br>
<span class="lineno"></span><span class="comment" id="5677747">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="5677832">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="5677911">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="5677970">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5678050">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5678127">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="5678180">//</span><br>
<span class="lineno"></span><span class="comment" id="5678183">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5678273">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5678291">func</span>&nbsp;<span class="op" id="5678296">(</span><span class="ident" id="5678297">enc</span>&nbsp;<span class="op" id="5678301">*</span><span class="ident" id="5678302">Encoder</span><span class="op" id="5678309">)</span>&nbsp;<span class="ident" id="5678311">EncodeToken</span><span class="op" id="5678322">(</span><span class="ident" id="5678323">t</span>&nbsp;<span class="ident" id="5678325">Token</span><span class="op" id="5678330">)</span>&nbsp;<span class="builtintype" id="5678332">error</span>&nbsp;<span class="op" id="5678338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678341">p</span>&nbsp;<span class="op" id="5678343">:=</span>&nbsp;<span class="op" id="5678346">&amp;</span><span class="ident" id="5678347">enc</span><span class="op" id="5678350">.</span><span class="ident" id="5678351">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678354">switch</span>&nbsp;<span class="ident" id="5678361">t</span>&nbsp;<span class="op" id="5678363">:=</span>&nbsp;<span class="ident" id="5678366">t</span><span class="op" id="5678367">.</span><span class="op" id="5678368">(</span><span class="keyword" id="5678369">type</span><span class="op" id="5678373">)</span>&nbsp;<span class="op" id="5678375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678378">case</span>&nbsp;<span class="ident" id="5678383">StartElement</span><span class="op" id="5678395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678399">if</span>&nbsp;<span class="ident" id="5678402">err</span>&nbsp;<span class="op" id="5678406">:=</span>&nbsp;<span class="ident" id="5678409">p</span><span class="op" id="5678410">.</span><span class="ident" id="5678411">writeStart</span><span class="op" id="5678421">(</span><span class="op" id="5678422">&amp;</span><span class="ident" id="5678423">t</span><span class="op" id="5678424">)</span><span class="op" id="5678425">;</span>&nbsp;<span class="ident" id="5678427">err</span>&nbsp;<span class="op" id="5678431">!=</span>&nbsp;<span class="ident" id="5678434">nil</span>&nbsp;<span class="op" id="5678438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678443">return</span>&nbsp;<span class="ident" id="5678450">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678456">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678459">case</span>&nbsp;<span class="ident" id="5678464">EndElement</span><span class="op" id="5678474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678478">if</span>&nbsp;<span class="ident" id="5678481">err</span>&nbsp;<span class="op" id="5678485">:=</span>&nbsp;<span class="ident" id="5678488">p</span><span class="op" id="5678489">.</span><span class="ident" id="5678490">writeEnd</span><span class="op" id="5678498">(</span><span class="ident" id="5678499">t</span><span class="op" id="5678500">.</span><span class="ident" id="5678501">Name</span><span class="op" id="5678505">)</span><span class="op" id="5678506">;</span>&nbsp;<span class="ident" id="5678508">err</span>&nbsp;<span class="op" id="5678512">!=</span>&nbsp;<span class="ident" id="5678515">nil</span>&nbsp;<span class="op" id="5678519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678524">return</span>&nbsp;<span class="ident" id="5678531">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678540">case</span>&nbsp;<span class="ident" id="5678545">CharData</span><span class="op" id="5678553">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678557">EscapeText</span><span class="op" id="5678567">(</span><span class="ident" id="5678568">p</span><span class="op" id="5678569">,</span>&nbsp;<span class="ident" id="5678571">t</span><span class="op" id="5678572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678575">case</span>&nbsp;<span class="ident" id="5678580">Comment</span><span class="op" id="5678587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678591">if</span>&nbsp;<span class="ident" id="5678594">bytes</span><span class="op" id="5678599">.</span><span class="ident" id="5678600">Contains</span><span class="op" id="5678608">(</span><span class="ident" id="5678609">t</span><span class="op" id="5678610">,</span>&nbsp;<span class="ident" id="5678612">endComment</span><span class="op" id="5678622">)</span>&nbsp;<span class="op" id="5678624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678629">return</span>&nbsp;<span class="ident" id="5678636">fmt</span><span class="op" id="5678639">.</span><span class="ident" id="5678640">Errorf</span><span class="op" id="5678646">(</span><span class="string" id="5678647">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="5678698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678702">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678706">p</span><span class="op" id="5678707">.</span><span class="ident" id="5678708">WriteString</span><span class="op" id="5678719">(</span><span class="string" id="5678720">&#34;&lt;!--&#34;</span><span class="op" id="5678726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678730">p</span><span class="op" id="5678731">.</span><span class="ident" id="5678732">Write</span><span class="op" id="5678737">(</span><span class="ident" id="5678738">t</span><span class="op" id="5678739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678743">p</span><span class="op" id="5678744">.</span><span class="ident" id="5678745">WriteString</span><span class="op" id="5678756">(</span><span class="string" id="5678757">&#34;--&gt;&#34;</span><span class="op" id="5678762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678766">return</span>&nbsp;<span class="ident" id="5678773">p</span><span class="op" id="5678774">.</span><span class="ident" id="5678775">cachedWriteError</span><span class="op" id="5678791">(</span><span class="op" id="5678792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678795">case</span>&nbsp;<span class="ident" id="5678800">ProcInst</span><span class="op" id="5678808">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678812">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5678887">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678967">if</span>&nbsp;<span class="ident" id="5678970">t</span><span class="op" id="5678971">.</span><span class="ident" id="5678972">Target</span>&nbsp;<span class="op" id="5678979">==</span>&nbsp;<span class="string" id="5678982">&#34;xml&#34;</span>&nbsp;<span class="op" id="5678988">&amp;&amp;</span>&nbsp;<span class="ident" id="5678991">p</span><span class="op" id="5678992">.</span><span class="ident" id="5678993">Buffered</span><span class="op" id="5679001">(</span><span class="op" id="5679002">)</span>&nbsp;<span class="op" id="5679004">!=</span>&nbsp;<span class="num" id="5679007">0</span>&nbsp;<span class="op" id="5679009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679014">return</span>&nbsp;<span class="ident" id="5679021">fmt</span><span class="op" id="5679024">.</span><span class="ident" id="5679025">Errorf</span><span class="op" id="5679031">(</span><span class="string" id="5679032">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="5679125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679129">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679133">if</span>&nbsp;<span class="op" id="5679136">!</span><span class="ident" id="5679137">isNameString</span><span class="op" id="5679149">(</span><span class="ident" id="5679150">t</span><span class="op" id="5679151">.</span><span class="ident" id="5679152">Target</span><span class="op" id="5679158">)</span>&nbsp;<span class="op" id="5679160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679165">return</span>&nbsp;<span class="ident" id="5679172">fmt</span><span class="op" id="5679175">.</span><span class="ident" id="5679176">Errorf</span><span class="op" id="5679182">(</span><span class="string" id="5679183">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="5679233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679241">if</span>&nbsp;<span class="ident" id="5679244">bytes</span><span class="op" id="5679249">.</span><span class="ident" id="5679250">Contains</span><span class="op" id="5679258">(</span><span class="ident" id="5679259">t</span><span class="op" id="5679260">.</span><span class="ident" id="5679261">Inst</span><span class="op" id="5679265">,</span>&nbsp;<span class="ident" id="5679267">endProcInst</span><span class="op" id="5679278">)</span>&nbsp;<span class="op" id="5679280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679285">return</span>&nbsp;<span class="ident" id="5679292">fmt</span><span class="op" id="5679295">.</span><span class="ident" id="5679296">Errorf</span><span class="op" id="5679302">(</span><span class="string" id="5679303">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="5679354">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679362">p</span><span class="op" id="5679363">.</span><span class="ident" id="5679364">WriteString</span><span class="op" id="5679375">(</span><span class="string" id="5679376">&#34;&lt;?&#34;</span><span class="op" id="5679380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679384">p</span><span class="op" id="5679385">.</span><span class="ident" id="5679386">WriteString</span><span class="op" id="5679397">(</span><span class="ident" id="5679398">t</span><span class="op" id="5679399">.</span><span class="ident" id="5679400">Target</span><span class="op" id="5679406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679410">if</span>&nbsp;<span class="builtinfunc" id="5679413">len</span><span class="op" id="5679416">(</span><span class="ident" id="5679417">t</span><span class="op" id="5679418">.</span><span class="ident" id="5679419">Inst</span><span class="op" id="5679423">)</span>&nbsp;<span class="op" id="5679425">&gt;</span>&nbsp;<span class="num" id="5679427">0</span>&nbsp;<span class="op" id="5679429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679434">p</span><span class="op" id="5679435">.</span><span class="ident" id="5679436">WriteByte</span><span class="op" id="5679445">(</span><span class="string" id="5679446">&#39;&nbsp;&#39;</span><span class="op" id="5679449">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679454">p</span><span class="op" id="5679455">.</span><span class="ident" id="5679456">Write</span><span class="op" id="5679461">(</span><span class="ident" id="5679462">t</span><span class="op" id="5679463">.</span><span class="ident" id="5679464">Inst</span><span class="op" id="5679468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679476">p</span><span class="op" id="5679477">.</span><span class="ident" id="5679478">WriteString</span><span class="op" id="5679489">(</span><span class="string" id="5679490">&#34;?&gt;&#34;</span><span class="op" id="5679494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679497">case</span>&nbsp;<span class="ident" id="5679502">Directive</span><span class="op" id="5679511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679515">if</span>&nbsp;<span class="ident" id="5679518">bytes</span><span class="op" id="5679523">.</span><span class="ident" id="5679524">Contains</span><span class="op" id="5679532">(</span><span class="ident" id="5679533">t</span><span class="op" id="5679534">,</span>&nbsp;<span class="ident" id="5679536">endDirective</span><span class="op" id="5679548">)</span>&nbsp;<span class="op" id="5679550">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679555">return</span>&nbsp;<span class="ident" id="5679562">fmt</span><span class="op" id="5679565">.</span><span class="ident" id="5679566">Errorf</span><span class="op" id="5679572">(</span><span class="string" id="5679573">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="5679624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679632">p</span><span class="op" id="5679633">.</span><span class="ident" id="5679634">WriteString</span><span class="op" id="5679645">(</span><span class="string" id="5679646">&#34;&lt;!&#34;</span><span class="op" id="5679650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679654">p</span><span class="op" id="5679655">.</span><span class="ident" id="5679656">Write</span><span class="op" id="5679661">(</span><span class="ident" id="5679662">t</span><span class="op" id="5679663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679667">p</span><span class="op" id="5679668">.</span><span class="ident" id="5679669">WriteString</span><span class="op" id="5679680">(</span><span class="string" id="5679681">&#34;&gt;&#34;</span><span class="op" id="5679684">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679690">return</span>&nbsp;<span class="ident" id="5679697">p</span><span class="op" id="5679698">.</span><span class="ident" id="5679699">cachedWriteError</span><span class="op" id="5679715">(</span><span class="op" id="5679716">)</span><br>
<span class="lineno"></span><span class="op" id="5679718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5679721">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="5679781">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5679858">func</span>&nbsp;<span class="op" id="5679863">(</span><span class="ident" id="5679864">enc</span>&nbsp;<span class="op" id="5679868">*</span><span class="ident" id="5679869">Encoder</span><span class="op" id="5679876">)</span>&nbsp;<span class="ident" id="5679878">Flush</span><span class="op" id="5679883">(</span><span class="op" id="5679884">)</span>&nbsp;<span class="builtintype" id="5679886">error</span>&nbsp;<span class="op" id="5679892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679895">return</span>&nbsp;<span class="ident" id="5679902">enc</span><span class="op" id="5679905">.</span><span class="ident" id="5679906">p</span><span class="op" id="5679907">.</span><span class="ident" id="5679908">Flush</span><span class="op" id="5679913">(</span><span class="op" id="5679914">)</span><br>
<span class="lineno"></span><span class="op" id="5679916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="5679919">type</span>&nbsp;<span class="ident" id="5679924">printer</span>&nbsp;<span class="keyword" id="5679932">struct</span>&nbsp;<span class="op" id="5679939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679942">*</span><span class="ident" id="5679943">bufio</span><span class="op" id="5679948">.</span><span class="ident" id="5679949">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679957">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679968">*</span><span class="ident" id="5679969">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679978">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5679989">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679994">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5680005">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680013">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5680024">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680032">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5680043">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680048">indentedIn</span>&nbsp;<span class="builtintype" id="5680059">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680065">putNewline</span>&nbsp;<span class="builtintype" id="5680076">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680082">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5680093">map</span><span class="op" id="5680096">[</span><span class="builtintype" id="5680097">string</span><span class="op" id="5680103">]</span><span class="builtintype" id="5680104">string</span>&nbsp;<span class="comment" id="5680111">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680140">attrPrefix</span>&nbsp;<span class="keyword" id="5680151">map</span><span class="op" id="5680154">[</span><span class="builtintype" id="5680155">string</span><span class="op" id="5680161">]</span><span class="builtintype" id="5680162">string</span>&nbsp;<span class="comment" id="5680169">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680198">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5680209">[</span><span class="op" id="5680210">]</span><span class="builtintype" id="5680211">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680219">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680230">[</span><span class="op" id="5680231">]</span><span class="ident" id="5680232">Name</span><br>
<span class="lineno"></span><span class="op" id="5680237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="5680240">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="5680331">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5680393">func</span>&nbsp;<span class="op" id="5680398">(</span><span class="ident" id="5680399">p</span>&nbsp;<span class="op" id="5680401">*</span><span class="ident" id="5680402">printer</span><span class="op" id="5680409">)</span>&nbsp;<span class="ident" id="5680411">createAttrPrefix</span><span class="op" id="5680427">(</span><span class="ident" id="5680428">url</span>&nbsp;<span class="builtintype" id="5680432">string</span><span class="op" id="5680438">)</span>&nbsp;<span class="builtintype" id="5680440">string</span>&nbsp;<span class="op" id="5680447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680450">if</span>&nbsp;<span class="ident" id="5680453">prefix</span>&nbsp;<span class="op" id="5680460">:=</span>&nbsp;<span class="ident" id="5680463">p</span><span class="op" id="5680464">.</span><span class="ident" id="5680465">attrPrefix</span><span class="op" id="5680475">[</span><span class="ident" id="5680476">url</span><span class="op" id="5680479">]</span><span class="op" id="5680480">;</span>&nbsp;<span class="ident" id="5680482">prefix</span>&nbsp;<span class="op" id="5680489">!=</span>&nbsp;<span class="string" id="5680492">&#34;&#34;</span>&nbsp;<span class="op" id="5680495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680499">return</span>&nbsp;<span class="ident" id="5680506">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680518">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680599">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680637">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680720">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680799">if</span>&nbsp;<span class="ident" id="5680802">url</span>&nbsp;<span class="op" id="5680806">==</span>&nbsp;<span class="ident" id="5680809">xmlURL</span>&nbsp;<span class="op" id="5680816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680820">return</span>&nbsp;<span class="string" id="5680827">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680838">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680875">if</span>&nbsp;<span class="ident" id="5680878">p</span><span class="op" id="5680879">.</span><span class="ident" id="5680880">attrPrefix</span>&nbsp;<span class="op" id="5680891">==</span>&nbsp;<span class="ident" id="5680894">nil</span>&nbsp;<span class="op" id="5680898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680902">p</span><span class="op" id="5680903">.</span><span class="ident" id="5680904">attrPrefix</span>&nbsp;<span class="op" id="5680915">=</span>&nbsp;<span class="builtinfunc" id="5680917">make</span><span class="op" id="5680921">(</span><span class="keyword" id="5680922">map</span><span class="op" id="5680925">[</span><span class="builtintype" id="5680926">string</span><span class="op" id="5680932">]</span><span class="builtintype" id="5680933">string</span><span class="op" id="5680939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680943">p</span><span class="op" id="5680944">.</span><span class="ident" id="5680945">attrNS</span>&nbsp;<span class="op" id="5680952">=</span>&nbsp;<span class="builtinfunc" id="5680954">make</span><span class="op" id="5680958">(</span><span class="keyword" id="5680959">map</span><span class="op" id="5680962">[</span><span class="builtintype" id="5680963">string</span><span class="op" id="5680969">]</span><span class="builtintype" id="5680970">string</span><span class="op" id="5680976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680979">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680983">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681044">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681068">prefix</span>&nbsp;<span class="op" id="5681075">:=</span>&nbsp;<span class="ident" id="5681078">strings</span><span class="op" id="5681085">.</span><span class="ident" id="5681086">TrimRight</span><span class="op" id="5681095">(</span><span class="ident" id="5681096">url</span><span class="op" id="5681099">,</span>&nbsp;<span class="string" id="5681101">&#34;/&#34;</span><span class="op" id="5681104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681107">if</span>&nbsp;<span class="ident" id="5681110">i</span>&nbsp;<span class="op" id="5681112">:=</span>&nbsp;<span class="ident" id="5681115">strings</span><span class="op" id="5681122">.</span><span class="ident" id="5681123">LastIndex</span><span class="op" id="5681132">(</span><span class="ident" id="5681133">prefix</span><span class="op" id="5681139">,</span>&nbsp;<span class="string" id="5681141">&#34;/&#34;</span><span class="op" id="5681144">)</span><span class="op" id="5681145">;</span>&nbsp;<span class="ident" id="5681147">i</span>&nbsp;<span class="op" id="5681149">&gt;=</span>&nbsp;<span class="num" id="5681152">0</span>&nbsp;<span class="op" id="5681154">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681158">prefix</span>&nbsp;<span class="op" id="5681165">=</span>&nbsp;<span class="ident" id="5681167">prefix</span><span class="op" id="5681173">[</span><span class="ident" id="5681174">i</span><span class="op" id="5681175">+</span><span class="num" id="5681176">1</span><span class="op" id="5681177">:</span><span class="op" id="5681178">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681184">if</span>&nbsp;<span class="ident" id="5681187">prefix</span>&nbsp;<span class="op" id="5681194">==</span>&nbsp;<span class="string" id="5681197">&#34;&#34;</span>&nbsp;<span class="op" id="5681200">||</span>&nbsp;<span class="op" id="5681203">!</span><span class="ident" id="5681204">isName</span><span class="op" id="5681210">(</span><span class="op" id="5681211">[</span><span class="op" id="5681212">]</span><span class="builtintype" id="5681213">byte</span><span class="op" id="5681217">(</span><span class="ident" id="5681218">prefix</span><span class="op" id="5681224">)</span><span class="op" id="5681225">)</span>&nbsp;<span class="op" id="5681227">||</span>&nbsp;<span class="ident" id="5681230">strings</span><span class="op" id="5681237">.</span><span class="ident" id="5681238">Contains</span><span class="op" id="5681246">(</span><span class="ident" id="5681247">prefix</span><span class="op" id="5681253">,</span>&nbsp;<span class="string" id="5681255">&#34;:&#34;</span><span class="op" id="5681258">)</span>&nbsp;<span class="op" id="5681260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681264">prefix</span>&nbsp;<span class="op" id="5681271">=</span>&nbsp;<span class="string" id="5681273">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681278">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681281">if</span>&nbsp;<span class="ident" id="5681284">strings</span><span class="op" id="5681291">.</span><span class="ident" id="5681292">HasPrefix</span><span class="op" id="5681301">(</span><span class="ident" id="5681302">prefix</span><span class="op" id="5681308">,</span>&nbsp;<span class="string" id="5681310">&#34;xml&#34;</span><span class="op" id="5681315">)</span>&nbsp;<span class="op" id="5681317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681321">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681351">prefix</span>&nbsp;<span class="op" id="5681358">=</span>&nbsp;<span class="string" id="5681360">&#34;_&#34;</span>&nbsp;<span class="op" id="5681364">+</span>&nbsp;<span class="ident" id="5681366">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681377">if</span>&nbsp;<span class="ident" id="5681380">p</span><span class="op" id="5681381">.</span><span class="ident" id="5681382">attrNS</span><span class="op" id="5681388">[</span><span class="ident" id="5681389">prefix</span><span class="op" id="5681395">]</span>&nbsp;<span class="op" id="5681397">!=</span>&nbsp;<span class="string" id="5681400">&#34;&#34;</span>&nbsp;<span class="op" id="5681403">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681407">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681446">for</span>&nbsp;<span class="ident" id="5681450">p</span><span class="op" id="5681451">.</span><span class="ident" id="5681452">seq</span><span class="op" id="5681455">++</span><span class="op" id="5681457">;</span>&nbsp;<span class="op" id="5681459">;</span>&nbsp;<span class="ident" id="5681461">p</span><span class="op" id="5681462">.</span><span class="ident" id="5681463">seq</span><span class="op" id="5681466">++</span>&nbsp;<span class="op" id="5681469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681474">if</span>&nbsp;<span class="ident" id="5681477">id</span>&nbsp;<span class="op" id="5681480">:=</span>&nbsp;<span class="ident" id="5681483">prefix</span>&nbsp;<span class="op" id="5681490">+</span>&nbsp;<span class="string" id="5681492">&#34;_&#34;</span>&nbsp;<span class="op" id="5681496">+</span>&nbsp;<span class="ident" id="5681498">strconv</span><span class="op" id="5681505">.</span><span class="ident" id="5681506">Itoa</span><span class="op" id="5681510">(</span><span class="ident" id="5681511">p</span><span class="op" id="5681512">.</span><span class="ident" id="5681513">seq</span><span class="op" id="5681516">)</span><span class="op" id="5681517">;</span>&nbsp;<span class="ident" id="5681519">p</span><span class="op" id="5681520">.</span><span class="ident" id="5681521">attrNS</span><span class="op" id="5681527">[</span><span class="ident" id="5681528">id</span><span class="op" id="5681530">]</span>&nbsp;<span class="op" id="5681532">==</span>&nbsp;<span class="string" id="5681535">&#34;&#34;</span>&nbsp;<span class="op" id="5681538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681544">prefix</span>&nbsp;<span class="op" id="5681551">=</span>&nbsp;<span class="ident" id="5681553">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681560">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681580">p</span><span class="op" id="5681581">.</span><span class="ident" id="5681582">attrPrefix</span><span class="op" id="5681592">[</span><span class="ident" id="5681593">url</span><span class="op" id="5681596">]</span>&nbsp;<span class="op" id="5681598">=</span>&nbsp;<span class="ident" id="5681600">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681608">p</span><span class="op" id="5681609">.</span><span class="ident" id="5681610">attrNS</span><span class="op" id="5681616">[</span><span class="ident" id="5681617">prefix</span><span class="op" id="5681623">]</span>&nbsp;<span class="op" id="5681625">=</span>&nbsp;<span class="ident" id="5681627">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681633">p</span><span class="op" id="5681634">.</span><span class="ident" id="5681635">WriteString</span><span class="op" id="5681646">(</span><span class="string" id="5681647">`xmlns:`</span><span class="op" id="5681655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681658">p</span><span class="op" id="5681659">.</span><span class="ident" id="5681660">WriteString</span><span class="op" id="5681671">(</span><span class="ident" id="5681672">prefix</span><span class="op" id="5681678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681681">p</span><span class="op" id="5681682">.</span><span class="ident" id="5681683">WriteString</span><span class="op" id="5681694">(</span><span class="string" id="5681695">`=&#34;`</span><span class="op" id="5681699">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681702">EscapeText</span><span class="op" id="5681712">(</span><span class="ident" id="5681713">p</span><span class="op" id="5681714">,</span>&nbsp;<span class="op" id="5681716">[</span><span class="op" id="5681717">]</span><span class="builtintype" id="5681718">byte</span><span class="op" id="5681722">(</span><span class="ident" id="5681723">url</span><span class="op" id="5681726">)</span><span class="op" id="5681727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681730">p</span><span class="op" id="5681731">.</span><span class="ident" id="5681732">WriteString</span><span class="op" id="5681743">(</span><span class="string" id="5681744">`&#34;&nbsp;`</span><span class="op" id="5681748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681752">p</span><span class="op" id="5681753">.</span><span class="ident" id="5681754">prefixes</span>&nbsp;<span class="op" id="5681763">=</span>&nbsp;<span class="builtinfunc" id="5681765">append</span><span class="op" id="5681771">(</span><span class="ident" id="5681772">p</span><span class="op" id="5681773">.</span><span class="ident" id="5681774">prefixes</span><span class="op" id="5681782">,</span>&nbsp;<span class="ident" id="5681784">prefix</span><span class="op" id="5681790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681794">return</span>&nbsp;<span class="ident" id="5681801">prefix</span><br>
<span class="lineno"></span><span class="op" id="5681808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5681811">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5681871">func</span>&nbsp;<span class="op" id="5681876">(</span><span class="ident" id="5681877">p</span>&nbsp;<span class="op" id="5681879">*</span><span class="ident" id="5681880">printer</span><span class="op" id="5681887">)</span>&nbsp;<span class="ident" id="5681889">deleteAttrPrefix</span><span class="op" id="5681905">(</span><span class="ident" id="5681906">prefix</span>&nbsp;<span class="builtintype" id="5681913">string</span><span class="op" id="5681919">)</span>&nbsp;<span class="op" id="5681921">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5681924">delete</span><span class="op" id="5681930">(</span><span class="ident" id="5681931">p</span><span class="op" id="5681932">.</span><span class="ident" id="5681933">attrPrefix</span><span class="op" id="5681943">,</span>&nbsp;<span class="ident" id="5681945">p</span><span class="op" id="5681946">.</span><span class="ident" id="5681947">attrNS</span><span class="op" id="5681953">[</span><span class="ident" id="5681954">prefix</span><span class="op" id="5681960">]</span><span class="op" id="5681961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5681964">delete</span><span class="op" id="5681970">(</span><span class="ident" id="5681971">p</span><span class="op" id="5681972">.</span><span class="ident" id="5681973">attrNS</span><span class="op" id="5681979">,</span>&nbsp;<span class="ident" id="5681981">prefix</span><span class="op" id="5681987">)</span><br>
<span class="lineno"></span><span class="op" id="5681989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681992">func</span>&nbsp;<span class="op" id="5681997">(</span><span class="ident" id="5681998">p</span>&nbsp;<span class="op" id="5682000">*</span><span class="ident" id="5682001">printer</span><span class="op" id="5682008">)</span>&nbsp;<span class="ident" id="5682010">markPrefix</span><span class="op" id="5682020">(</span><span class="op" id="5682021">)</span>&nbsp;<span class="op" id="5682023">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682026">p</span><span class="op" id="5682027">.</span><span class="ident" id="5682028">prefixes</span>&nbsp;<span class="op" id="5682037">=</span>&nbsp;<span class="builtinfunc" id="5682039">append</span><span class="op" id="5682045">(</span><span class="ident" id="5682046">p</span><span class="op" id="5682047">.</span><span class="ident" id="5682048">prefixes</span><span class="op" id="5682056">,</span>&nbsp;<span class="string" id="5682058">&#34;&#34;</span><span class="op" id="5682060">)</span><br>
<span class="lineno"></span><span class="op" id="5682062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5682065">func</span>&nbsp;<span class="op" id="5682070">(</span><span class="ident" id="5682071">p</span>&nbsp;<span class="op" id="5682073">*</span><span class="ident" id="5682074">printer</span><span class="op" id="5682081">)</span>&nbsp;<span class="ident" id="5682083">popPrefix</span><span class="op" id="5682092">(</span><span class="op" id="5682093">)</span>&nbsp;<span class="op" id="5682095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682098">for</span>&nbsp;<span class="builtinfunc" id="5682102">len</span><span class="op" id="5682105">(</span><span class="ident" id="5682106">p</span><span class="op" id="5682107">.</span><span class="ident" id="5682108">prefixes</span><span class="op" id="5682116">)</span>&nbsp;<span class="op" id="5682118">&gt;</span>&nbsp;<span class="num" id="5682120">0</span>&nbsp;<span class="op" id="5682122">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682126">prefix</span>&nbsp;<span class="op" id="5682133">:=</span>&nbsp;<span class="ident" id="5682136">p</span><span class="op" id="5682137">.</span><span class="ident" id="5682138">prefixes</span><span class="op" id="5682146">[</span><span class="builtinfunc" id="5682147">len</span><span class="op" id="5682150">(</span><span class="ident" id="5682151">p</span><span class="op" id="5682152">.</span><span class="ident" id="5682153">prefixes</span><span class="op" id="5682161">)</span><span class="op" id="5682162">-</span><span class="num" id="5682163">1</span><span class="op" id="5682164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682168">p</span><span class="op" id="5682169">.</span><span class="ident" id="5682170">prefixes</span>&nbsp;<span class="op" id="5682179">=</span>&nbsp;<span class="ident" id="5682181">p</span><span class="op" id="5682182">.</span><span class="ident" id="5682183">prefixes</span><span class="op" id="5682191">[</span><span class="op" id="5682192">:</span><span class="builtinfunc" id="5682193">len</span><span class="op" id="5682196">(</span><span class="ident" id="5682197">p</span><span class="op" id="5682198">.</span><span class="ident" id="5682199">prefixes</span><span class="op" id="5682207">)</span><span class="op" id="5682208">-</span><span class="num" id="5682209">1</span><span class="op" id="5682210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682214">if</span>&nbsp;<span class="ident" id="5682217">prefix</span>&nbsp;<span class="op" id="5682224">==</span>&nbsp;<span class="string" id="5682227">&#34;&#34;</span>&nbsp;<span class="op" id="5682230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682235">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682243">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682247">p</span><span class="op" id="5682248">.</span><span class="ident" id="5682249">deleteAttrPrefix</span><span class="op" id="5682265">(</span><span class="ident" id="5682266">prefix</span><span class="op" id="5682272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682275">}</span><br>
<span class="lineno"></span><span class="op" id="5682277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5682280">var</span>&nbsp;<span class="op" id="5682284">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682287">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5682305">=</span>&nbsp;<span class="ident" id="5682307">reflect</span><span class="op" id="5682314">.</span><span class="ident" id="5682315">TypeOf</span><span class="op" id="5682321">(</span><span class="op" id="5682322">(</span><span class="op" id="5682323">*</span><span class="ident" id="5682324">Marshaler</span><span class="op" id="5682333">)</span><span class="op" id="5682334">(</span><span class="ident" id="5682335">nil</span><span class="op" id="5682338">)</span><span class="op" id="5682339">)</span><span class="op" id="5682340">.</span><span class="ident" id="5682341">Elem</span><span class="op" id="5682345">(</span><span class="op" id="5682346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682349">marshalerAttrType</span>&nbsp;<span class="op" id="5682367">=</span>&nbsp;<span class="ident" id="5682369">reflect</span><span class="op" id="5682376">.</span><span class="ident" id="5682377">TypeOf</span><span class="op" id="5682383">(</span><span class="op" id="5682384">(</span><span class="op" id="5682385">*</span><span class="ident" id="5682386">MarshalerAttr</span><span class="op" id="5682399">)</span><span class="op" id="5682400">(</span><span class="ident" id="5682401">nil</span><span class="op" id="5682404">)</span><span class="op" id="5682405">)</span><span class="op" id="5682406">.</span><span class="ident" id="5682407">Elem</span><span class="op" id="5682411">(</span><span class="op" id="5682412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682415">textMarshalerType</span>&nbsp;<span class="op" id="5682433">=</span>&nbsp;<span class="ident" id="5682435">reflect</span><span class="op" id="5682442">.</span><span class="ident" id="5682443">TypeOf</span><span class="op" id="5682449">(</span><span class="op" id="5682450">(</span><span class="op" id="5682451">*</span><span class="ident" id="5682452">encoding</span><span class="op" id="5682460">.</span><span class="ident" id="5682461">TextMarshaler</span><span class="op" id="5682474">)</span><span class="op" id="5682475">(</span><span class="ident" id="5682476">nil</span><span class="op" id="5682479">)</span><span class="op" id="5682480">)</span><span class="op" id="5682481">.</span><span class="ident" id="5682482">Elem</span><span class="op" id="5682486">(</span><span class="op" id="5682487">)</span><br>
<span class="lineno"></span><span class="op" id="5682489">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="5682492">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="5682558">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="5682631">func</span>&nbsp;<span class="op" id="5682636">(</span><span class="ident" id="5682637">p</span>&nbsp;<span class="op" id="5682639">*</span><span class="ident" id="5682640">printer</span><span class="op" id="5682647">)</span>&nbsp;<span class="ident" id="5682649">marshalValue</span><span class="op" id="5682661">(</span><span class="ident" id="5682662">val</span>&nbsp;<span class="ident" id="5682666">reflect</span><span class="op" id="5682673">.</span><span class="ident" id="5682674">Value</span><span class="op" id="5682679">,</span>&nbsp;<span class="ident" id="5682681">finfo</span>&nbsp;<span class="op" id="5682687">*</span><span class="ident" id="5682688">fieldInfo</span><span class="op" id="5682697">,</span>&nbsp;<span class="ident" id="5682699">startTemplate</span>&nbsp;<span class="op" id="5682713">*</span><span class="ident" id="5682714">StartElement</span><span class="op" id="5682726">)</span>&nbsp;<span class="builtintype" id="5682728">error</span>&nbsp;<span class="op" id="5682734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682737">if</span>&nbsp;<span class="ident" id="5682740">startTemplate</span>&nbsp;<span class="op" id="5682754">!=</span>&nbsp;<span class="ident" id="5682757">nil</span>&nbsp;<span class="op" id="5682761">&amp;&amp;</span>&nbsp;<span class="ident" id="5682764">startTemplate</span><span class="op" id="5682777">.</span><span class="ident" id="5682778">Name</span><span class="op" id="5682782">.</span><span class="ident" id="5682783">Local</span>&nbsp;<span class="op" id="5682789">==</span>&nbsp;<span class="string" id="5682792">&#34;&#34;</span>&nbsp;<span class="op" id="5682795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682799">return</span>&nbsp;<span class="ident" id="5682806">fmt</span><span class="op" id="5682809">.</span><span class="ident" id="5682810">Errorf</span><span class="op" id="5682816">(</span><span class="string" id="5682817">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="5682871">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682878">if</span>&nbsp;<span class="op" id="5682881">!</span><span class="ident" id="5682882">val</span><span class="op" id="5682885">.</span><span class="ident" id="5682886">IsValid</span><span class="op" id="5682893">(</span><span class="op" id="5682894">)</span>&nbsp;<span class="op" id="5682896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682900">return</span>&nbsp;<span class="ident" id="5682907">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682912">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682915">if</span>&nbsp;<span class="ident" id="5682918">finfo</span>&nbsp;<span class="op" id="5682924">!=</span>&nbsp;<span class="ident" id="5682927">nil</span>&nbsp;<span class="op" id="5682931">&amp;&amp;</span>&nbsp;<span class="ident" id="5682934">finfo</span><span class="op" id="5682939">.</span><span class="ident" id="5682940">flags</span><span class="op" id="5682945">&amp;</span><span class="ident" id="5682946">fOmitEmpty</span>&nbsp;<span class="op" id="5682957">!=</span>&nbsp;<span class="num" id="5682960">0</span>&nbsp;<span class="op" id="5682962">&amp;&amp;</span>&nbsp;<span class="ident" id="5682965">isEmptyValue</span><span class="op" id="5682977">(</span><span class="ident" id="5682978">val</span><span class="op" id="5682981">)</span>&nbsp;<span class="op" id="5682983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682987">return</span>&nbsp;<span class="ident" id="5682994">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683003">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683043">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683105">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683143">for</span>&nbsp;<span class="ident" id="5683147">val</span><span class="op" id="5683150">.</span><span class="ident" id="5683151">Kind</span><span class="op" id="5683155">(</span><span class="op" id="5683156">)</span>&nbsp;<span class="op" id="5683158">==</span>&nbsp;<span class="ident" id="5683161">reflect</span><span class="op" id="5683168">.</span><span class="ident" id="5683169">Interface</span>&nbsp;<span class="op" id="5683179">||</span>&nbsp;<span class="ident" id="5683182">val</span><span class="op" id="5683185">.</span><span class="ident" id="5683186">Kind</span><span class="op" id="5683190">(</span><span class="op" id="5683191">)</span>&nbsp;<span class="op" id="5683193">==</span>&nbsp;<span class="ident" id="5683196">reflect</span><span class="op" id="5683203">.</span><span class="ident" id="5683204">Ptr</span>&nbsp;<span class="op" id="5683208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683212">if</span>&nbsp;<span class="ident" id="5683215">val</span><span class="op" id="5683218">.</span><span class="ident" id="5683219">IsNil</span><span class="op" id="5683224">(</span><span class="op" id="5683225">)</span>&nbsp;<span class="op" id="5683227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683232">return</span>&nbsp;<span class="ident" id="5683239">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683249">val</span>&nbsp;<span class="op" id="5683253">=</span>&nbsp;<span class="ident" id="5683255">val</span><span class="op" id="5683258">.</span><span class="ident" id="5683259">Elem</span><span class="op" id="5683263">(</span><span class="op" id="5683264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683271">kind</span>&nbsp;<span class="op" id="5683276">:=</span>&nbsp;<span class="ident" id="5683279">val</span><span class="op" id="5683282">.</span><span class="ident" id="5683283">Kind</span><span class="op" id="5683287">(</span><span class="op" id="5683288">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683291">typ</span>&nbsp;<span class="op" id="5683295">:=</span>&nbsp;<span class="ident" id="5683298">val</span><span class="op" id="5683301">.</span><span class="ident" id="5683302">Type</span><span class="op" id="5683306">(</span><span class="op" id="5683307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683311">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683336">if</span>&nbsp;<span class="ident" id="5683339">val</span><span class="op" id="5683342">.</span><span class="ident" id="5683343">CanInterface</span><span class="op" id="5683355">(</span><span class="op" id="5683356">)</span>&nbsp;<span class="op" id="5683358">&amp;&amp;</span>&nbsp;<span class="ident" id="5683361">typ</span><span class="op" id="5683364">.</span><span class="ident" id="5683365">Implements</span><span class="op" id="5683375">(</span><span class="ident" id="5683376">marshalerType</span><span class="op" id="5683389">)</span>&nbsp;<span class="op" id="5683391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683395">return</span>&nbsp;<span class="ident" id="5683402">p</span><span class="op" id="5683403">.</span><span class="ident" id="5683404">marshalInterface</span><span class="op" id="5683420">(</span><span class="ident" id="5683421">val</span><span class="op" id="5683424">.</span><span class="ident" id="5683425">Interface</span><span class="op" id="5683434">(</span><span class="op" id="5683435">)</span><span class="op" id="5683436">.</span><span class="op" id="5683437">(</span><span class="ident" id="5683438">Marshaler</span><span class="op" id="5683447">)</span><span class="op" id="5683448">,</span>&nbsp;<span class="ident" id="5683450">defaultStart</span><span class="op" id="5683462">(</span><span class="ident" id="5683463">typ</span><span class="op" id="5683466">,</span>&nbsp;<span class="ident" id="5683468">finfo</span><span class="op" id="5683473">,</span>&nbsp;<span class="ident" id="5683475">startTemplate</span><span class="op" id="5683488">)</span><span class="op" id="5683489">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683495">if</span>&nbsp;<span class="ident" id="5683498">val</span><span class="op" id="5683501">.</span><span class="ident" id="5683502">CanAddr</span><span class="op" id="5683509">(</span><span class="op" id="5683510">)</span>&nbsp;<span class="op" id="5683512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683516">pv</span>&nbsp;<span class="op" id="5683519">:=</span>&nbsp;<span class="ident" id="5683522">val</span><span class="op" id="5683525">.</span><span class="ident" id="5683526">Addr</span><span class="op" id="5683530">(</span><span class="op" id="5683531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683535">if</span>&nbsp;<span class="ident" id="5683538">pv</span><span class="op" id="5683540">.</span><span class="ident" id="5683541">CanInterface</span><span class="op" id="5683553">(</span><span class="op" id="5683554">)</span>&nbsp;<span class="op" id="5683556">&amp;&amp;</span>&nbsp;<span class="ident" id="5683559">pv</span><span class="op" id="5683561">.</span><span class="ident" id="5683562">Type</span><span class="op" id="5683566">(</span><span class="op" id="5683567">)</span><span class="op" id="5683568">.</span><span class="ident" id="5683569">Implements</span><span class="op" id="5683579">(</span><span class="ident" id="5683580">marshalerType</span><span class="op" id="5683593">)</span>&nbsp;<span class="op" id="5683595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683600">return</span>&nbsp;<span class="ident" id="5683607">p</span><span class="op" id="5683608">.</span><span class="ident" id="5683609">marshalInterface</span><span class="op" id="5683625">(</span><span class="ident" id="5683626">pv</span><span class="op" id="5683628">.</span><span class="ident" id="5683629">Interface</span><span class="op" id="5683638">(</span><span class="op" id="5683639">)</span><span class="op" id="5683640">.</span><span class="op" id="5683641">(</span><span class="ident" id="5683642">Marshaler</span><span class="op" id="5683651">)</span><span class="op" id="5683652">,</span>&nbsp;<span class="ident" id="5683654">defaultStart</span><span class="op" id="5683666">(</span><span class="ident" id="5683667">pv</span><span class="op" id="5683669">.</span><span class="ident" id="5683670">Type</span><span class="op" id="5683674">(</span><span class="op" id="5683675">)</span><span class="op" id="5683676">,</span>&nbsp;<span class="ident" id="5683678">finfo</span><span class="op" id="5683683">,</span>&nbsp;<span class="ident" id="5683685">startTemplate</span><span class="op" id="5683698">)</span><span class="op" id="5683699">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683710">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683740">if</span>&nbsp;<span class="ident" id="5683743">val</span><span class="op" id="5683746">.</span><span class="ident" id="5683747">CanInterface</span><span class="op" id="5683759">(</span><span class="op" id="5683760">)</span>&nbsp;<span class="op" id="5683762">&amp;&amp;</span>&nbsp;<span class="ident" id="5683765">typ</span><span class="op" id="5683768">.</span><span class="ident" id="5683769">Implements</span><span class="op" id="5683779">(</span><span class="ident" id="5683780">textMarshalerType</span><span class="op" id="5683797">)</span>&nbsp;<span class="op" id="5683799">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683803">return</span>&nbsp;<span class="ident" id="5683810">p</span><span class="op" id="5683811">.</span><span class="ident" id="5683812">marshalTextInterface</span><span class="op" id="5683832">(</span><span class="ident" id="5683833">val</span><span class="op" id="5683836">.</span><span class="ident" id="5683837">Interface</span><span class="op" id="5683846">(</span><span class="op" id="5683847">)</span><span class="op" id="5683848">.</span><span class="op" id="5683849">(</span><span class="ident" id="5683850">encoding</span><span class="op" id="5683858">.</span><span class="ident" id="5683859">TextMarshaler</span><span class="op" id="5683872">)</span><span class="op" id="5683873">,</span>&nbsp;<span class="ident" id="5683875">defaultStart</span><span class="op" id="5683887">(</span><span class="ident" id="5683888">typ</span><span class="op" id="5683891">,</span>&nbsp;<span class="ident" id="5683893">finfo</span><span class="op" id="5683898">,</span>&nbsp;<span class="ident" id="5683900">startTemplate</span><span class="op" id="5683913">)</span><span class="op" id="5683914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683920">if</span>&nbsp;<span class="ident" id="5683923">val</span><span class="op" id="5683926">.</span><span class="ident" id="5683927">CanAddr</span><span class="op" id="5683934">(</span><span class="op" id="5683935">)</span>&nbsp;<span class="op" id="5683937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683941">pv</span>&nbsp;<span class="op" id="5683944">:=</span>&nbsp;<span class="ident" id="5683947">val</span><span class="op" id="5683950">.</span><span class="ident" id="5683951">Addr</span><span class="op" id="5683955">(</span><span class="op" id="5683956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683960">if</span>&nbsp;<span class="ident" id="5683963">pv</span><span class="op" id="5683965">.</span><span class="ident" id="5683966">CanInterface</span><span class="op" id="5683978">(</span><span class="op" id="5683979">)</span>&nbsp;<span class="op" id="5683981">&amp;&amp;</span>&nbsp;<span class="ident" id="5683984">pv</span><span class="op" id="5683986">.</span><span class="ident" id="5683987">Type</span><span class="op" id="5683991">(</span><span class="op" id="5683992">)</span><span class="op" id="5683993">.</span><span class="ident" id="5683994">Implements</span><span class="op" id="5684004">(</span><span class="ident" id="5684005">textMarshalerType</span><span class="op" id="5684022">)</span>&nbsp;<span class="op" id="5684024">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684029">return</span>&nbsp;<span class="ident" id="5684036">p</span><span class="op" id="5684037">.</span><span class="ident" id="5684038">marshalTextInterface</span><span class="op" id="5684058">(</span><span class="ident" id="5684059">pv</span><span class="op" id="5684061">.</span><span class="ident" id="5684062">Interface</span><span class="op" id="5684071">(</span><span class="op" id="5684072">)</span><span class="op" id="5684073">.</span><span class="op" id="5684074">(</span><span class="ident" id="5684075">encoding</span><span class="op" id="5684083">.</span><span class="ident" id="5684084">TextMarshaler</span><span class="op" id="5684097">)</span><span class="op" id="5684098">,</span>&nbsp;<span class="ident" id="5684100">defaultStart</span><span class="op" id="5684112">(</span><span class="ident" id="5684113">pv</span><span class="op" id="5684115">.</span><span class="ident" id="5684116">Type</span><span class="op" id="5684120">(</span><span class="op" id="5684121">)</span><span class="op" id="5684122">,</span>&nbsp;<span class="ident" id="5684124">finfo</span><span class="op" id="5684129">,</span>&nbsp;<span class="ident" id="5684131">startTemplate</span><span class="op" id="5684144">)</span><span class="op" id="5684145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684156">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684240">if</span>&nbsp;<span class="op" id="5684243">(</span><span class="ident" id="5684244">kind</span>&nbsp;<span class="op" id="5684249">==</span>&nbsp;<span class="ident" id="5684252">reflect</span><span class="op" id="5684259">.</span><span class="ident" id="5684260">Slice</span>&nbsp;<span class="op" id="5684266">||</span>&nbsp;<span class="ident" id="5684269">kind</span>&nbsp;<span class="op" id="5684274">==</span>&nbsp;<span class="ident" id="5684277">reflect</span><span class="op" id="5684284">.</span><span class="ident" id="5684285">Array</span><span class="op" id="5684290">)</span>&nbsp;<span class="op" id="5684292">&amp;&amp;</span>&nbsp;<span class="ident" id="5684295">typ</span><span class="op" id="5684298">.</span><span class="ident" id="5684299">Elem</span><span class="op" id="5684303">(</span><span class="op" id="5684304">)</span><span class="op" id="5684305">.</span><span class="ident" id="5684306">Kind</span><span class="op" id="5684310">(</span><span class="op" id="5684311">)</span>&nbsp;<span class="op" id="5684313">!=</span>&nbsp;<span class="ident" id="5684316">reflect</span><span class="op" id="5684323">.</span><span class="ident" id="5684324">Uint8</span>&nbsp;<span class="op" id="5684330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684334">for</span>&nbsp;<span class="ident" id="5684338">i</span><span class="op" id="5684339">,</span>&nbsp;<span class="ident" id="5684341">n</span>&nbsp;<span class="op" id="5684343">:=</span>&nbsp;<span class="num" id="5684346">0</span><span class="op" id="5684347">,</span>&nbsp;<span class="ident" id="5684349">val</span><span class="op" id="5684352">.</span><span class="ident" id="5684353">Len</span><span class="op" id="5684356">(</span><span class="op" id="5684357">)</span><span class="op" id="5684358">;</span>&nbsp;<span class="ident" id="5684360">i</span>&nbsp;<span class="op" id="5684362">&lt;</span>&nbsp;<span class="ident" id="5684364">n</span><span class="op" id="5684365">;</span>&nbsp;<span class="ident" id="5684367">i</span><span class="op" id="5684368">++</span>&nbsp;<span class="op" id="5684371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684376">if</span>&nbsp;<span class="ident" id="5684379">err</span>&nbsp;<span class="op" id="5684383">:=</span>&nbsp;<span class="ident" id="5684386">p</span><span class="op" id="5684387">.</span><span class="ident" id="5684388">marshalValue</span><span class="op" id="5684400">(</span><span class="ident" id="5684401">val</span><span class="op" id="5684404">.</span><span class="ident" id="5684405">Index</span><span class="op" id="5684410">(</span><span class="ident" id="5684411">i</span><span class="op" id="5684412">)</span><span class="op" id="5684413">,</span>&nbsp;<span class="ident" id="5684415">finfo</span><span class="op" id="5684420">,</span>&nbsp;<span class="ident" id="5684422">startTemplate</span><span class="op" id="5684435">)</span><span class="op" id="5684436">;</span>&nbsp;<span class="ident" id="5684438">err</span>&nbsp;<span class="op" id="5684442">!=</span>&nbsp;<span class="ident" id="5684445">nil</span>&nbsp;<span class="op" id="5684449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684455">return</span>&nbsp;<span class="ident" id="5684462">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684469">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684477">return</span>&nbsp;<span class="ident" id="5684484">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684493">tinfo</span><span class="op" id="5684498">,</span>&nbsp;<span class="ident" id="5684500">err</span>&nbsp;<span class="op" id="5684504">:=</span>&nbsp;<span class="ident" id="5684507">getTypeInfo</span><span class="op" id="5684518">(</span><span class="ident" id="5684519">typ</span><span class="op" id="5684522">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684525">if</span>&nbsp;<span class="ident" id="5684528">err</span>&nbsp;<span class="op" id="5684532">!=</span>&nbsp;<span class="ident" id="5684535">nil</span>&nbsp;<span class="op" id="5684539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684543">return</span>&nbsp;<span class="ident" id="5684550">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684559">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684585">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684629">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684650">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684693">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684740">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684757">var</span>&nbsp;<span class="ident" id="5684761">start</span>&nbsp;<span class="ident" id="5684767">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684782">if</span>&nbsp;<span class="ident" id="5684785">startTemplate</span>&nbsp;<span class="op" id="5684799">!=</span>&nbsp;<span class="ident" id="5684802">nil</span>&nbsp;<span class="op" id="5684806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684810">start</span><span class="op" id="5684815">.</span><span class="ident" id="5684816">Name</span>&nbsp;<span class="op" id="5684821">=</span>&nbsp;<span class="ident" id="5684823">startTemplate</span><span class="op" id="5684836">.</span><span class="ident" id="5684837">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684844">start</span><span class="op" id="5684849">.</span><span class="ident" id="5684850">Attr</span>&nbsp;<span class="op" id="5684855">=</span>&nbsp;<span class="builtinfunc" id="5684857">append</span><span class="op" id="5684863">(</span><span class="ident" id="5684864">start</span><span class="op" id="5684869">.</span><span class="ident" id="5684870">Attr</span><span class="op" id="5684874">,</span>&nbsp;<span class="ident" id="5684876">startTemplate</span><span class="op" id="5684889">.</span><span class="ident" id="5684890">Attr</span><span class="op" id="5684894">...</span><span class="op" id="5684897">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684900">}</span>&nbsp;<span class="keyword" id="5684902">else</span>&nbsp;<span class="keyword" id="5684907">if</span>&nbsp;<span class="ident" id="5684910">tinfo</span><span class="op" id="5684915">.</span><span class="ident" id="5684916">xmlname</span>&nbsp;<span class="op" id="5684924">!=</span>&nbsp;<span class="ident" id="5684927">nil</span>&nbsp;<span class="op" id="5684931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684935">xmlname</span>&nbsp;<span class="op" id="5684943">:=</span>&nbsp;<span class="ident" id="5684946">tinfo</span><span class="op" id="5684951">.</span><span class="ident" id="5684952">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684962">if</span>&nbsp;<span class="ident" id="5684965">xmlname</span><span class="op" id="5684972">.</span><span class="ident" id="5684973">name</span>&nbsp;<span class="op" id="5684978">!=</span>&nbsp;<span class="string" id="5684981">&#34;&#34;</span>&nbsp;<span class="op" id="5684984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684989">start</span><span class="op" id="5684994">.</span><span class="ident" id="5684995">Name</span><span class="op" id="5684999">.</span><span class="ident" id="5685000">Space</span><span class="op" id="5685005">,</span>&nbsp;<span class="ident" id="5685007">start</span><span class="op" id="5685012">.</span><span class="ident" id="5685013">Name</span><span class="op" id="5685017">.</span><span class="ident" id="5685018">Local</span>&nbsp;<span class="op" id="5685024">=</span>&nbsp;<span class="ident" id="5685026">xmlname</span><span class="op" id="5685033">.</span><span class="ident" id="5685034">xmlns</span><span class="op" id="5685039">,</span>&nbsp;<span class="ident" id="5685041">xmlname</span><span class="op" id="5685048">.</span><span class="ident" id="5685049">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685056">}</span>&nbsp;<span class="keyword" id="5685058">else</span>&nbsp;<span class="keyword" id="5685063">if</span>&nbsp;<span class="ident" id="5685066">v</span><span class="op" id="5685067">,</span>&nbsp;<span class="ident" id="5685069">ok</span>&nbsp;<span class="op" id="5685072">:=</span>&nbsp;<span class="ident" id="5685075">xmlname</span><span class="op" id="5685082">.</span><span class="ident" id="5685083">value</span><span class="op" id="5685088">(</span><span class="ident" id="5685089">val</span><span class="op" id="5685092">)</span><span class="op" id="5685093">.</span><span class="ident" id="5685094">Interface</span><span class="op" id="5685103">(</span><span class="op" id="5685104">)</span><span class="op" id="5685105">.</span><span class="op" id="5685106">(</span><span class="ident" id="5685107">Name</span><span class="op" id="5685111">)</span><span class="op" id="5685112">;</span>&nbsp;<span class="ident" id="5685114">ok</span>&nbsp;<span class="op" id="5685117">&amp;&amp;</span>&nbsp;<span class="ident" id="5685120">v</span><span class="op" id="5685121">.</span><span class="ident" id="5685122">Local</span>&nbsp;<span class="op" id="5685128">!=</span>&nbsp;<span class="string" id="5685131">&#34;&#34;</span>&nbsp;<span class="op" id="5685134">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685139">start</span><span class="op" id="5685144">.</span><span class="ident" id="5685145">Name</span>&nbsp;<span class="op" id="5685150">=</span>&nbsp;<span class="ident" id="5685152">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685162">if</span>&nbsp;<span class="ident" id="5685165">start</span><span class="op" id="5685170">.</span><span class="ident" id="5685171">Name</span><span class="op" id="5685175">.</span><span class="ident" id="5685176">Local</span>&nbsp;<span class="op" id="5685182">==</span>&nbsp;<span class="string" id="5685185">&#34;&#34;</span>&nbsp;<span class="op" id="5685188">&amp;&amp;</span>&nbsp;<span class="ident" id="5685191">finfo</span>&nbsp;<span class="op" id="5685197">!=</span>&nbsp;<span class="ident" id="5685200">nil</span>&nbsp;<span class="op" id="5685204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685208">start</span><span class="op" id="5685213">.</span><span class="ident" id="5685214">Name</span><span class="op" id="5685218">.</span><span class="ident" id="5685219">Space</span><span class="op" id="5685224">,</span>&nbsp;<span class="ident" id="5685226">start</span><span class="op" id="5685231">.</span><span class="ident" id="5685232">Name</span><span class="op" id="5685236">.</span><span class="ident" id="5685237">Local</span>&nbsp;<span class="op" id="5685243">=</span>&nbsp;<span class="ident" id="5685245">finfo</span><span class="op" id="5685250">.</span><span class="ident" id="5685251">xmlns</span><span class="op" id="5685256">,</span>&nbsp;<span class="ident" id="5685258">finfo</span><span class="op" id="5685263">.</span><span class="ident" id="5685264">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685273">if</span>&nbsp;<span class="ident" id="5685276">start</span><span class="op" id="5685281">.</span><span class="ident" id="5685282">Name</span><span class="op" id="5685286">.</span><span class="ident" id="5685287">Local</span>&nbsp;<span class="op" id="5685293">==</span>&nbsp;<span class="string" id="5685296">&#34;&#34;</span>&nbsp;<span class="op" id="5685299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685303">name</span>&nbsp;<span class="op" id="5685308">:=</span>&nbsp;<span class="ident" id="5685311">typ</span><span class="op" id="5685314">.</span><span class="ident" id="5685315">Name</span><span class="op" id="5685319">(</span><span class="op" id="5685320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685324">if</span>&nbsp;<span class="ident" id="5685327">name</span>&nbsp;<span class="op" id="5685332">==</span>&nbsp;<span class="string" id="5685335">&#34;&#34;</span>&nbsp;<span class="op" id="5685338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685343">return</span>&nbsp;<span class="op" id="5685350">&amp;</span><span class="ident" id="5685351">UnsupportedTypeError</span><span class="op" id="5685371">{</span><span class="ident" id="5685372">typ</span><span class="op" id="5685375">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685383">start</span><span class="op" id="5685388">.</span><span class="ident" id="5685389">Name</span><span class="op" id="5685393">.</span><span class="ident" id="5685394">Local</span>&nbsp;<span class="op" id="5685400">=</span>&nbsp;<span class="ident" id="5685402">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685412">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685427">for</span>&nbsp;<span class="ident" id="5685431">i</span>&nbsp;<span class="op" id="5685433">:=</span>&nbsp;<span class="keyword" id="5685436">range</span>&nbsp;<span class="ident" id="5685442">tinfo</span><span class="op" id="5685447">.</span><span class="ident" id="5685448">fields</span>&nbsp;<span class="op" id="5685455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685459">finfo</span>&nbsp;<span class="op" id="5685465">:=</span>&nbsp;<span class="op" id="5685468">&amp;</span><span class="ident" id="5685469">tinfo</span><span class="op" id="5685474">.</span><span class="ident" id="5685475">fields</span><span class="op" id="5685481">[</span><span class="ident" id="5685482">i</span><span class="op" id="5685483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685487">if</span>&nbsp;<span class="ident" id="5685490">finfo</span><span class="op" id="5685495">.</span><span class="ident" id="5685496">flags</span><span class="op" id="5685501">&amp;</span><span class="ident" id="5685502">fAttr</span>&nbsp;<span class="op" id="5685508">==</span>&nbsp;<span class="num" id="5685511">0</span>&nbsp;<span class="op" id="5685513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685518">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685529">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685533">fv</span>&nbsp;<span class="op" id="5685536">:=</span>&nbsp;<span class="ident" id="5685539">finfo</span><span class="op" id="5685544">.</span><span class="ident" id="5685545">value</span><span class="op" id="5685550">(</span><span class="ident" id="5685551">val</span><span class="op" id="5685554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685558">name</span>&nbsp;<span class="op" id="5685563">:=</span>&nbsp;<span class="ident" id="5685566">Name</span><span class="op" id="5685570">{</span><span class="ident" id="5685571">Space</span><span class="op" id="5685576">:</span>&nbsp;<span class="ident" id="5685578">finfo</span><span class="op" id="5685583">.</span><span class="ident" id="5685584">xmlns</span><span class="op" id="5685589">,</span>&nbsp;<span class="ident" id="5685591">Local</span><span class="op" id="5685596">:</span>&nbsp;<span class="ident" id="5685598">finfo</span><span class="op" id="5685603">.</span><span class="ident" id="5685604">name</span><span class="op" id="5685608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685613">if</span>&nbsp;<span class="ident" id="5685616">finfo</span><span class="op" id="5685621">.</span><span class="ident" id="5685622">flags</span><span class="op" id="5685627">&amp;</span><span class="ident" id="5685628">fOmitEmpty</span>&nbsp;<span class="op" id="5685639">!=</span>&nbsp;<span class="num" id="5685642">0</span>&nbsp;<span class="op" id="5685644">&amp;&amp;</span>&nbsp;<span class="ident" id="5685647">isEmptyValue</span><span class="op" id="5685659">(</span><span class="ident" id="5685660">fv</span><span class="op" id="5685662">)</span>&nbsp;<span class="op" id="5685664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685669">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685685">if</span>&nbsp;<span class="ident" id="5685688">fv</span><span class="op" id="5685690">.</span><span class="ident" id="5685691">Kind</span><span class="op" id="5685695">(</span><span class="op" id="5685696">)</span>&nbsp;<span class="op" id="5685698">==</span>&nbsp;<span class="ident" id="5685701">reflect</span><span class="op" id="5685708">.</span><span class="ident" id="5685709">Interface</span>&nbsp;<span class="op" id="5685719">&amp;&amp;</span>&nbsp;<span class="ident" id="5685722">fv</span><span class="op" id="5685724">.</span><span class="ident" id="5685725">IsNil</span><span class="op" id="5685730">(</span><span class="op" id="5685731">)</span>&nbsp;<span class="op" id="5685733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685738">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685749">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685754">if</span>&nbsp;<span class="ident" id="5685757">fv</span><span class="op" id="5685759">.</span><span class="ident" id="5685760">CanInterface</span><span class="op" id="5685772">(</span><span class="op" id="5685773">)</span>&nbsp;<span class="op" id="5685775">&amp;&amp;</span>&nbsp;<span class="ident" id="5685778">fv</span><span class="op" id="5685780">.</span><span class="ident" id="5685781">Type</span><span class="op" id="5685785">(</span><span class="op" id="5685786">)</span><span class="op" id="5685787">.</span><span class="ident" id="5685788">Implements</span><span class="op" id="5685798">(</span><span class="ident" id="5685799">marshalerAttrType</span><span class="op" id="5685816">)</span>&nbsp;<span class="op" id="5685818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685823">attr</span><span class="op" id="5685827">,</span>&nbsp;<span class="ident" id="5685829">err</span>&nbsp;<span class="op" id="5685833">:=</span>&nbsp;<span class="ident" id="5685836">fv</span><span class="op" id="5685838">.</span><span class="ident" id="5685839">Interface</span><span class="op" id="5685848">(</span><span class="op" id="5685849">)</span><span class="op" id="5685850">.</span><span class="op" id="5685851">(</span><span class="ident" id="5685852">MarshalerAttr</span><span class="op" id="5685865">)</span><span class="op" id="5685866">.</span><span class="ident" id="5685867">MarshalXMLAttr</span><span class="op" id="5685881">(</span><span class="ident" id="5685882">name</span><span class="op" id="5685886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685891">if</span>&nbsp;<span class="ident" id="5685894">err</span>&nbsp;<span class="op" id="5685898">!=</span>&nbsp;<span class="ident" id="5685901">nil</span>&nbsp;<span class="op" id="5685905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685911">return</span>&nbsp;<span class="ident" id="5685918">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685930">if</span>&nbsp;<span class="ident" id="5685933">attr</span><span class="op" id="5685937">.</span><span class="ident" id="5685938">Name</span><span class="op" id="5685942">.</span><span class="ident" id="5685943">Local</span>&nbsp;<span class="op" id="5685949">!=</span>&nbsp;<span class="string" id="5685952">&#34;&#34;</span>&nbsp;<span class="op" id="5685955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685961">start</span><span class="op" id="5685966">.</span><span class="ident" id="5685967">Attr</span>&nbsp;<span class="op" id="5685972">=</span>&nbsp;<span class="builtinfunc" id="5685974">append</span><span class="op" id="5685980">(</span><span class="ident" id="5685981">start</span><span class="op" id="5685986">.</span><span class="ident" id="5685987">Attr</span><span class="op" id="5685991">,</span>&nbsp;<span class="ident" id="5685993">attr</span><span class="op" id="5685997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686007">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686023">if</span>&nbsp;<span class="ident" id="5686026">fv</span><span class="op" id="5686028">.</span><span class="ident" id="5686029">CanAddr</span><span class="op" id="5686036">(</span><span class="op" id="5686037">)</span>&nbsp;<span class="op" id="5686039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686044">pv</span>&nbsp;<span class="op" id="5686047">:=</span>&nbsp;<span class="ident" id="5686050">fv</span><span class="op" id="5686052">.</span><span class="ident" id="5686053">Addr</span><span class="op" id="5686057">(</span><span class="op" id="5686058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686063">if</span>&nbsp;<span class="ident" id="5686066">pv</span><span class="op" id="5686068">.</span><span class="ident" id="5686069">CanInterface</span><span class="op" id="5686081">(</span><span class="op" id="5686082">)</span>&nbsp;<span class="op" id="5686084">&amp;&amp;</span>&nbsp;<span class="ident" id="5686087">pv</span><span class="op" id="5686089">.</span><span class="ident" id="5686090">Type</span><span class="op" id="5686094">(</span><span class="op" id="5686095">)</span><span class="op" id="5686096">.</span><span class="ident" id="5686097">Implements</span><span class="op" id="5686107">(</span><span class="ident" id="5686108">marshalerAttrType</span><span class="op" id="5686125">)</span>&nbsp;<span class="op" id="5686127">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686133">attr</span><span class="op" id="5686137">,</span>&nbsp;<span class="ident" id="5686139">err</span>&nbsp;<span class="op" id="5686143">:=</span>&nbsp;<span class="ident" id="5686146">pv</span><span class="op" id="5686148">.</span><span class="ident" id="5686149">Interface</span><span class="op" id="5686158">(</span><span class="op" id="5686159">)</span><span class="op" id="5686160">.</span><span class="op" id="5686161">(</span><span class="ident" id="5686162">MarshalerAttr</span><span class="op" id="5686175">)</span><span class="op" id="5686176">.</span><span class="ident" id="5686177">MarshalXMLAttr</span><span class="op" id="5686191">(</span><span class="ident" id="5686192">name</span><span class="op" id="5686196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686202">if</span>&nbsp;<span class="ident" id="5686205">err</span>&nbsp;<span class="op" id="5686209">!=</span>&nbsp;<span class="ident" id="5686212">nil</span>&nbsp;<span class="op" id="5686216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686223">return</span>&nbsp;<span class="ident" id="5686230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686244">if</span>&nbsp;<span class="ident" id="5686247">attr</span><span class="op" id="5686251">.</span><span class="ident" id="5686252">Name</span><span class="op" id="5686256">.</span><span class="ident" id="5686257">Local</span>&nbsp;<span class="op" id="5686263">!=</span>&nbsp;<span class="string" id="5686266">&#34;&#34;</span>&nbsp;<span class="op" id="5686269">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686276">start</span><span class="op" id="5686281">.</span><span class="ident" id="5686282">Attr</span>&nbsp;<span class="op" id="5686287">=</span>&nbsp;<span class="builtinfunc" id="5686289">append</span><span class="op" id="5686295">(</span><span class="ident" id="5686296">start</span><span class="op" id="5686301">.</span><span class="ident" id="5686302">Attr</span><span class="op" id="5686306">,</span>&nbsp;<span class="ident" id="5686308">attr</span><span class="op" id="5686312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686324">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686340">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686345">if</span>&nbsp;<span class="ident" id="5686348">fv</span><span class="op" id="5686350">.</span><span class="ident" id="5686351">CanInterface</span><span class="op" id="5686363">(</span><span class="op" id="5686364">)</span>&nbsp;<span class="op" id="5686366">&amp;&amp;</span>&nbsp;<span class="ident" id="5686369">fv</span><span class="op" id="5686371">.</span><span class="ident" id="5686372">Type</span><span class="op" id="5686376">(</span><span class="op" id="5686377">)</span><span class="op" id="5686378">.</span><span class="ident" id="5686379">Implements</span><span class="op" id="5686389">(</span><span class="ident" id="5686390">textMarshalerType</span><span class="op" id="5686407">)</span>&nbsp;<span class="op" id="5686409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686414">text</span><span class="op" id="5686418">,</span>&nbsp;<span class="ident" id="5686420">err</span>&nbsp;<span class="op" id="5686424">:=</span>&nbsp;<span class="ident" id="5686427">fv</span><span class="op" id="5686429">.</span><span class="ident" id="5686430">Interface</span><span class="op" id="5686439">(</span><span class="op" id="5686440">)</span><span class="op" id="5686441">.</span><span class="op" id="5686442">(</span><span class="ident" id="5686443">encoding</span><span class="op" id="5686451">.</span><span class="ident" id="5686452">TextMarshaler</span><span class="op" id="5686465">)</span><span class="op" id="5686466">.</span><span class="ident" id="5686467">MarshalText</span><span class="op" id="5686478">(</span><span class="op" id="5686479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686484">if</span>&nbsp;<span class="ident" id="5686487">err</span>&nbsp;<span class="op" id="5686491">!=</span>&nbsp;<span class="ident" id="5686494">nil</span>&nbsp;<span class="op" id="5686498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686504">return</span>&nbsp;<span class="ident" id="5686511">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686523">start</span><span class="op" id="5686528">.</span><span class="ident" id="5686529">Attr</span>&nbsp;<span class="op" id="5686534">=</span>&nbsp;<span class="builtinfunc" id="5686536">append</span><span class="op" id="5686542">(</span><span class="ident" id="5686543">start</span><span class="op" id="5686548">.</span><span class="ident" id="5686549">Attr</span><span class="op" id="5686553">,</span>&nbsp;<span class="ident" id="5686555">Attr</span><span class="op" id="5686559">{</span><span class="ident" id="5686560">name</span><span class="op" id="5686564">,</span>&nbsp;<span class="builtintype" id="5686566">string</span><span class="op" id="5686572">(</span><span class="ident" id="5686573">text</span><span class="op" id="5686577">)</span><span class="op" id="5686578">}</span><span class="op" id="5686579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686584">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686600">if</span>&nbsp;<span class="ident" id="5686603">fv</span><span class="op" id="5686605">.</span><span class="ident" id="5686606">CanAddr</span><span class="op" id="5686613">(</span><span class="op" id="5686614">)</span>&nbsp;<span class="op" id="5686616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686621">pv</span>&nbsp;<span class="op" id="5686624">:=</span>&nbsp;<span class="ident" id="5686627">fv</span><span class="op" id="5686629">.</span><span class="ident" id="5686630">Addr</span><span class="op" id="5686634">(</span><span class="op" id="5686635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686640">if</span>&nbsp;<span class="ident" id="5686643">pv</span><span class="op" id="5686645">.</span><span class="ident" id="5686646">CanInterface</span><span class="op" id="5686658">(</span><span class="op" id="5686659">)</span>&nbsp;<span class="op" id="5686661">&amp;&amp;</span>&nbsp;<span class="ident" id="5686664">pv</span><span class="op" id="5686666">.</span><span class="ident" id="5686667">Type</span><span class="op" id="5686671">(</span><span class="op" id="5686672">)</span><span class="op" id="5686673">.</span><span class="ident" id="5686674">Implements</span><span class="op" id="5686684">(</span><span class="ident" id="5686685">textMarshalerType</span><span class="op" id="5686702">)</span>&nbsp;<span class="op" id="5686704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686710">text</span><span class="op" id="5686714">,</span>&nbsp;<span class="ident" id="5686716">err</span>&nbsp;<span class="op" id="5686720">:=</span>&nbsp;<span class="ident" id="5686723">pv</span><span class="op" id="5686725">.</span><span class="ident" id="5686726">Interface</span><span class="op" id="5686735">(</span><span class="op" id="5686736">)</span><span class="op" id="5686737">.</span><span class="op" id="5686738">(</span><span class="ident" id="5686739">encoding</span><span class="op" id="5686747">.</span><span class="ident" id="5686748">TextMarshaler</span><span class="op" id="5686761">)</span><span class="op" id="5686762">.</span><span class="ident" id="5686763">MarshalText</span><span class="op" id="5686774">(</span><span class="op" id="5686775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686781">if</span>&nbsp;<span class="ident" id="5686784">err</span>&nbsp;<span class="op" id="5686788">!=</span>&nbsp;<span class="ident" id="5686791">nil</span>&nbsp;<span class="op" id="5686795">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686802">return</span>&nbsp;<span class="ident" id="5686809">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686823">start</span><span class="op" id="5686828">.</span><span class="ident" id="5686829">Attr</span>&nbsp;<span class="op" id="5686834">=</span>&nbsp;<span class="builtinfunc" id="5686836">append</span><span class="op" id="5686842">(</span><span class="ident" id="5686843">start</span><span class="op" id="5686848">.</span><span class="ident" id="5686849">Attr</span><span class="op" id="5686853">,</span>&nbsp;<span class="ident" id="5686855">Attr</span><span class="op" id="5686859">{</span><span class="ident" id="5686860">name</span><span class="op" id="5686864">,</span>&nbsp;<span class="builtintype" id="5686866">string</span><span class="op" id="5686872">(</span><span class="ident" id="5686873">text</span><span class="op" id="5686877">)</span><span class="op" id="5686878">}</span><span class="op" id="5686879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686885">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686897">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686906">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686962">switch</span>&nbsp;<span class="ident" id="5686969">fv</span><span class="op" id="5686971">.</span><span class="ident" id="5686972">Kind</span><span class="op" id="5686976">(</span><span class="op" id="5686977">)</span>&nbsp;<span class="op" id="5686979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686983">case</span>&nbsp;<span class="ident" id="5686988">reflect</span><span class="op" id="5686995">.</span><span class="ident" id="5686996">Ptr</span><span class="op" id="5686999">,</span>&nbsp;<span class="ident" id="5687001">reflect</span><span class="op" id="5687008">.</span><span class="ident" id="5687009">Interface</span><span class="op" id="5687018">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687023">if</span>&nbsp;<span class="ident" id="5687026">fv</span><span class="op" id="5687028">.</span><span class="ident" id="5687029">IsNil</span><span class="op" id="5687034">(</span><span class="op" id="5687035">)</span>&nbsp;<span class="op" id="5687037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687043">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687060">fv</span>&nbsp;<span class="op" id="5687063">=</span>&nbsp;<span class="ident" id="5687065">fv</span><span class="op" id="5687067">.</span><span class="ident" id="5687068">Elem</span><span class="op" id="5687072">(</span><span class="op" id="5687073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687077">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687082">s</span><span class="op" id="5687083">,</span>&nbsp;<span class="ident" id="5687085">b</span><span class="op" id="5687086">,</span>&nbsp;<span class="ident" id="5687088">err</span>&nbsp;<span class="op" id="5687092">:=</span>&nbsp;<span class="ident" id="5687095">p</span><span class="op" id="5687096">.</span><span class="ident" id="5687097">marshalSimple</span><span class="op" id="5687110">(</span><span class="ident" id="5687111">fv</span><span class="op" id="5687113">.</span><span class="ident" id="5687114">Type</span><span class="op" id="5687118">(</span><span class="op" id="5687119">)</span><span class="op" id="5687120">,</span>&nbsp;<span class="ident" id="5687122">fv</span><span class="op" id="5687124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687128">if</span>&nbsp;<span class="ident" id="5687131">err</span>&nbsp;<span class="op" id="5687135">!=</span>&nbsp;<span class="ident" id="5687138">nil</span>&nbsp;<span class="op" id="5687142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687147">return</span>&nbsp;<span class="ident" id="5687154">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687160">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687164">if</span>&nbsp;<span class="ident" id="5687167">b</span>&nbsp;<span class="op" id="5687169">!=</span>&nbsp;<span class="ident" id="5687172">nil</span>&nbsp;<span class="op" id="5687176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687181">s</span>&nbsp;<span class="op" id="5687183">=</span>&nbsp;<span class="builtintype" id="5687185">string</span><span class="op" id="5687191">(</span><span class="ident" id="5687192">b</span><span class="op" id="5687193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687201">start</span><span class="op" id="5687206">.</span><span class="ident" id="5687207">Attr</span>&nbsp;<span class="op" id="5687212">=</span>&nbsp;<span class="builtinfunc" id="5687214">append</span><span class="op" id="5687220">(</span><span class="ident" id="5687221">start</span><span class="op" id="5687226">.</span><span class="ident" id="5687227">Attr</span><span class="op" id="5687231">,</span>&nbsp;<span class="ident" id="5687233">Attr</span><span class="op" id="5687237">{</span><span class="ident" id="5687238">name</span><span class="op" id="5687242">,</span>&nbsp;<span class="ident" id="5687244">s</span><span class="op" id="5687245">}</span><span class="op" id="5687246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687249">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687253">if</span>&nbsp;<span class="ident" id="5687256">err</span>&nbsp;<span class="op" id="5687260">:=</span>&nbsp;<span class="ident" id="5687263">p</span><span class="op" id="5687264">.</span><span class="ident" id="5687265">writeStart</span><span class="op" id="5687275">(</span><span class="op" id="5687276">&amp;</span><span class="ident" id="5687277">start</span><span class="op" id="5687282">)</span><span class="op" id="5687283">;</span>&nbsp;<span class="ident" id="5687285">err</span>&nbsp;<span class="op" id="5687289">!=</span>&nbsp;<span class="ident" id="5687292">nil</span>&nbsp;<span class="op" id="5687296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687300">return</span>&nbsp;<span class="ident" id="5687307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687316">if</span>&nbsp;<span class="ident" id="5687319">val</span><span class="op" id="5687322">.</span><span class="ident" id="5687323">Kind</span><span class="op" id="5687327">(</span><span class="op" id="5687328">)</span>&nbsp;<span class="op" id="5687330">==</span>&nbsp;<span class="ident" id="5687333">reflect</span><span class="op" id="5687340">.</span><span class="ident" id="5687341">Struct</span>&nbsp;<span class="op" id="5687348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687352">err</span>&nbsp;<span class="op" id="5687356">=</span>&nbsp;<span class="ident" id="5687358">p</span><span class="op" id="5687359">.</span><span class="ident" id="5687360">marshalStruct</span><span class="op" id="5687373">(</span><span class="ident" id="5687374">tinfo</span><span class="op" id="5687379">,</span>&nbsp;<span class="ident" id="5687381">val</span><span class="op" id="5687384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687387">}</span>&nbsp;<span class="keyword" id="5687389">else</span>&nbsp;<span class="op" id="5687394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687398">s</span><span class="op" id="5687399">,</span>&nbsp;<span class="ident" id="5687401">b</span><span class="op" id="5687402">,</span>&nbsp;<span class="ident" id="5687404">err1</span>&nbsp;<span class="op" id="5687409">:=</span>&nbsp;<span class="ident" id="5687412">p</span><span class="op" id="5687413">.</span><span class="ident" id="5687414">marshalSimple</span><span class="op" id="5687427">(</span><span class="ident" id="5687428">typ</span><span class="op" id="5687431">,</span>&nbsp;<span class="ident" id="5687433">val</span><span class="op" id="5687436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687440">if</span>&nbsp;<span class="ident" id="5687443">err1</span>&nbsp;<span class="op" id="5687448">!=</span>&nbsp;<span class="ident" id="5687451">nil</span>&nbsp;<span class="op" id="5687455">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687460">err</span>&nbsp;<span class="op" id="5687464">=</span>&nbsp;<span class="ident" id="5687466">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687473">}</span>&nbsp;<span class="keyword" id="5687475">else</span>&nbsp;<span class="keyword" id="5687480">if</span>&nbsp;<span class="ident" id="5687483">b</span>&nbsp;<span class="op" id="5687485">!=</span>&nbsp;<span class="ident" id="5687488">nil</span>&nbsp;<span class="op" id="5687492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687497">EscapeText</span><span class="op" id="5687507">(</span><span class="ident" id="5687508">p</span><span class="op" id="5687509">,</span>&nbsp;<span class="ident" id="5687511">b</span><span class="op" id="5687512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687516">}</span>&nbsp;<span class="keyword" id="5687518">else</span>&nbsp;<span class="op" id="5687523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687528">p</span><span class="op" id="5687529">.</span><span class="ident" id="5687530">EscapeString</span><span class="op" id="5687542">(</span><span class="ident" id="5687543">s</span><span class="op" id="5687544">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687554">if</span>&nbsp;<span class="ident" id="5687557">err</span>&nbsp;<span class="op" id="5687561">!=</span>&nbsp;<span class="ident" id="5687564">nil</span>&nbsp;<span class="op" id="5687568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687572">return</span>&nbsp;<span class="ident" id="5687579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687584">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687588">if</span>&nbsp;<span class="ident" id="5687591">err</span>&nbsp;<span class="op" id="5687595">:=</span>&nbsp;<span class="ident" id="5687598">p</span><span class="op" id="5687599">.</span><span class="ident" id="5687600">writeEnd</span><span class="op" id="5687608">(</span><span class="ident" id="5687609">start</span><span class="op" id="5687614">.</span><span class="ident" id="5687615">Name</span><span class="op" id="5687619">)</span><span class="op" id="5687620">;</span>&nbsp;<span class="ident" id="5687622">err</span>&nbsp;<span class="op" id="5687626">!=</span>&nbsp;<span class="ident" id="5687629">nil</span>&nbsp;<span class="op" id="5687633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687637">return</span>&nbsp;<span class="ident" id="5687644">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687653">return</span>&nbsp;<span class="ident" id="5687660">p</span><span class="op" id="5687661">.</span><span class="ident" id="5687662">cachedWriteError</span><span class="op" id="5687678">(</span><span class="op" id="5687679">)</span><br>
<span class="lineno"></span><span class="op" id="5687681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5687684">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="5687742">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="5687801">func</span>&nbsp;<span class="ident" id="5687806">defaultStart</span><span class="op" id="5687818">(</span><span class="ident" id="5687819">typ</span>&nbsp;<span class="ident" id="5687823">reflect</span><span class="op" id="5687830">.</span><span class="ident" id="5687831">Type</span><span class="op" id="5687835">,</span>&nbsp;<span class="ident" id="5687837">finfo</span>&nbsp;<span class="op" id="5687843">*</span><span class="ident" id="5687844">fieldInfo</span><span class="op" id="5687853">,</span>&nbsp;<span class="ident" id="5687855">startTemplate</span>&nbsp;<span class="op" id="5687869">*</span><span class="ident" id="5687870">StartElement</span><span class="op" id="5687882">)</span>&nbsp;<span class="ident" id="5687884">StartElement</span>&nbsp;<span class="op" id="5687897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687900">var</span>&nbsp;<span class="ident" id="5687904">start</span>&nbsp;<span class="ident" id="5687910">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687924">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687977">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688044">if</span>&nbsp;<span class="ident" id="5688047">startTemplate</span>&nbsp;<span class="op" id="5688061">!=</span>&nbsp;<span class="ident" id="5688064">nil</span>&nbsp;<span class="op" id="5688068">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688072">start</span><span class="op" id="5688077">.</span><span class="ident" id="5688078">Name</span>&nbsp;<span class="op" id="5688083">=</span>&nbsp;<span class="ident" id="5688085">startTemplate</span><span class="op" id="5688098">.</span><span class="ident" id="5688099">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688106">start</span><span class="op" id="5688111">.</span><span class="ident" id="5688112">Attr</span>&nbsp;<span class="op" id="5688117">=</span>&nbsp;<span class="builtinfunc" id="5688119">append</span><span class="op" id="5688125">(</span><span class="ident" id="5688126">start</span><span class="op" id="5688131">.</span><span class="ident" id="5688132">Attr</span><span class="op" id="5688136">,</span>&nbsp;<span class="ident" id="5688138">startTemplate</span><span class="op" id="5688151">.</span><span class="ident" id="5688152">Attr</span><span class="op" id="5688156">...</span><span class="op" id="5688159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688162">}</span>&nbsp;<span class="keyword" id="5688164">else</span>&nbsp;<span class="keyword" id="5688169">if</span>&nbsp;<span class="ident" id="5688172">finfo</span>&nbsp;<span class="op" id="5688178">!=</span>&nbsp;<span class="ident" id="5688181">nil</span>&nbsp;<span class="op" id="5688185">&amp;&amp;</span>&nbsp;<span class="ident" id="5688188">finfo</span><span class="op" id="5688193">.</span><span class="ident" id="5688194">name</span>&nbsp;<span class="op" id="5688199">!=</span>&nbsp;<span class="string" id="5688202">&#34;&#34;</span>&nbsp;<span class="op" id="5688205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688209">start</span><span class="op" id="5688214">.</span><span class="ident" id="5688215">Name</span><span class="op" id="5688219">.</span><span class="ident" id="5688220">Local</span>&nbsp;<span class="op" id="5688226">=</span>&nbsp;<span class="ident" id="5688228">finfo</span><span class="op" id="5688233">.</span><span class="ident" id="5688234">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688241">start</span><span class="op" id="5688246">.</span><span class="ident" id="5688247">Name</span><span class="op" id="5688251">.</span><span class="ident" id="5688252">Space</span>&nbsp;<span class="op" id="5688258">=</span>&nbsp;<span class="ident" id="5688260">finfo</span><span class="op" id="5688265">.</span><span class="ident" id="5688266">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688273">}</span>&nbsp;<span class="keyword" id="5688275">else</span>&nbsp;<span class="keyword" id="5688280">if</span>&nbsp;<span class="ident" id="5688283">typ</span><span class="op" id="5688286">.</span><span class="ident" id="5688287">Name</span><span class="op" id="5688291">(</span><span class="op" id="5688292">)</span>&nbsp;<span class="op" id="5688294">!=</span>&nbsp;<span class="string" id="5688297">&#34;&#34;</span>&nbsp;<span class="op" id="5688300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688304">start</span><span class="op" id="5688309">.</span><span class="ident" id="5688310">Name</span><span class="op" id="5688314">.</span><span class="ident" id="5688315">Local</span>&nbsp;<span class="op" id="5688321">=</span>&nbsp;<span class="ident" id="5688323">typ</span><span class="op" id="5688326">.</span><span class="ident" id="5688327">Name</span><span class="op" id="5688331">(</span><span class="op" id="5688332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688335">}</span>&nbsp;<span class="keyword" id="5688337">else</span>&nbsp;<span class="op" id="5688342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688346">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688386">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688427">start</span><span class="op" id="5688432">.</span><span class="ident" id="5688433">Name</span><span class="op" id="5688437">.</span><span class="ident" id="5688438">Local</span>&nbsp;<span class="op" id="5688444">=</span>&nbsp;<span class="ident" id="5688446">typ</span><span class="op" id="5688449">.</span><span class="ident" id="5688450">Elem</span><span class="op" id="5688454">(</span><span class="op" id="5688455">)</span><span class="op" id="5688456">.</span><span class="ident" id="5688457">Name</span><span class="op" id="5688461">(</span><span class="op" id="5688462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688468">return</span>&nbsp;<span class="ident" id="5688475">start</span><br>
<span class="lineno"></span><span class="op" id="5688481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="5688484">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5688542">func</span>&nbsp;<span class="op" id="5688547">(</span><span class="ident" id="5688548">p</span>&nbsp;<span class="op" id="5688550">*</span><span class="ident" id="5688551">printer</span><span class="op" id="5688558">)</span>&nbsp;<span class="ident" id="5688560">marshalInterface</span><span class="op" id="5688576">(</span><span class="ident" id="5688577">val</span>&nbsp;<span class="ident" id="5688581">Marshaler</span><span class="op" id="5688590">,</span>&nbsp;<span class="ident" id="5688592">start</span>&nbsp;<span class="ident" id="5688598">StartElement</span><span class="op" id="5688610">)</span>&nbsp;<span class="builtintype" id="5688612">error</span>&nbsp;<span class="op" id="5688618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688621">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688677">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688729">p</span><span class="op" id="5688730">.</span><span class="ident" id="5688731">tags</span>&nbsp;<span class="op" id="5688736">=</span>&nbsp;<span class="builtinfunc" id="5688738">append</span><span class="op" id="5688744">(</span><span class="ident" id="5688745">p</span><span class="op" id="5688746">.</span><span class="ident" id="5688747">tags</span><span class="op" id="5688751">,</span>&nbsp;<span class="ident" id="5688753">Name</span><span class="op" id="5688757">{</span><span class="op" id="5688758">}</span><span class="op" id="5688759">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688762">n</span>&nbsp;<span class="op" id="5688764">:=</span>&nbsp;<span class="builtinfunc" id="5688767">len</span><span class="op" id="5688770">(</span><span class="ident" id="5688771">p</span><span class="op" id="5688772">.</span><span class="ident" id="5688773">tags</span><span class="op" id="5688777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688781">err</span>&nbsp;<span class="op" id="5688785">:=</span>&nbsp;<span class="ident" id="5688788">val</span><span class="op" id="5688791">.</span><span class="ident" id="5688792">MarshalXML</span><span class="op" id="5688802">(</span><span class="ident" id="5688803">p</span><span class="op" id="5688804">.</span><span class="ident" id="5688805">encoder</span><span class="op" id="5688812">,</span>&nbsp;<span class="ident" id="5688814">start</span><span class="op" id="5688819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688822">if</span>&nbsp;<span class="ident" id="5688825">err</span>&nbsp;<span class="op" id="5688829">!=</span>&nbsp;<span class="ident" id="5688832">nil</span>&nbsp;<span class="op" id="5688836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688840">return</span>&nbsp;<span class="ident" id="5688847">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688856">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688927">if</span>&nbsp;<span class="builtinfunc" id="5688930">len</span><span class="op" id="5688933">(</span><span class="ident" id="5688934">p</span><span class="op" id="5688935">.</span><span class="ident" id="5688936">tags</span><span class="op" id="5688940">)</span>&nbsp;<span class="op" id="5688942">&gt;</span>&nbsp;<span class="ident" id="5688944">n</span>&nbsp;<span class="op" id="5688946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688950">return</span>&nbsp;<span class="ident" id="5688957">fmt</span><span class="op" id="5688960">.</span><span class="ident" id="5688961">Errorf</span><span class="op" id="5688967">(</span><span class="string" id="5688968">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="5689023">,</span>&nbsp;<span class="ident" id="5689025">receiverType</span><span class="op" id="5689037">(</span><span class="ident" id="5689038">val</span><span class="op" id="5689041">)</span><span class="op" id="5689042">,</span>&nbsp;<span class="ident" id="5689044">p</span><span class="op" id="5689045">.</span><span class="ident" id="5689046">tags</span><span class="op" id="5689050">[</span><span class="builtinfunc" id="5689051">len</span><span class="op" id="5689054">(</span><span class="ident" id="5689055">p</span><span class="op" id="5689056">.</span><span class="ident" id="5689057">tags</span><span class="op" id="5689061">)</span><span class="op" id="5689062">-</span><span class="num" id="5689063">1</span><span class="op" id="5689064">]</span><span class="op" id="5689065">.</span><span class="ident" id="5689066">Local</span><span class="op" id="5689071">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689077">p</span><span class="op" id="5689078">.</span><span class="ident" id="5689079">tags</span>&nbsp;<span class="op" id="5689084">=</span>&nbsp;<span class="ident" id="5689086">p</span><span class="op" id="5689087">.</span><span class="ident" id="5689088">tags</span><span class="op" id="5689092">[</span><span class="op" id="5689093">:</span><span class="ident" id="5689094">n</span><span class="op" id="5689095">-</span><span class="num" id="5689096">1</span><span class="op" id="5689097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689100">return</span>&nbsp;<span class="ident" id="5689107">nil</span><br>
<span class="lineno"></span><span class="op" id="5689111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5689114">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5689180">func</span>&nbsp;<span class="op" id="5689185">(</span><span class="ident" id="5689186">p</span>&nbsp;<span class="op" id="5689188">*</span><span class="ident" id="5689189">printer</span><span class="op" id="5689196">)</span>&nbsp;<span class="ident" id="5689198">marshalTextInterface</span><span class="op" id="5689218">(</span><span class="ident" id="5689219">val</span>&nbsp;<span class="ident" id="5689223">encoding</span><span class="op" id="5689231">.</span><span class="ident" id="5689232">TextMarshaler</span><span class="op" id="5689245">,</span>&nbsp;<span class="ident" id="5689247">start</span>&nbsp;<span class="ident" id="5689253">StartElement</span><span class="op" id="5689265">)</span>&nbsp;<span class="builtintype" id="5689267">error</span>&nbsp;<span class="op" id="5689273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689276">if</span>&nbsp;<span class="ident" id="5689279">err</span>&nbsp;<span class="op" id="5689283">:=</span>&nbsp;<span class="ident" id="5689286">p</span><span class="op" id="5689287">.</span><span class="ident" id="5689288">writeStart</span><span class="op" id="5689298">(</span><span class="op" id="5689299">&amp;</span><span class="ident" id="5689300">start</span><span class="op" id="5689305">)</span><span class="op" id="5689306">;</span>&nbsp;<span class="ident" id="5689308">err</span>&nbsp;<span class="op" id="5689312">!=</span>&nbsp;<span class="ident" id="5689315">nil</span>&nbsp;<span class="op" id="5689319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689323">return</span>&nbsp;<span class="ident" id="5689330">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689335">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689338">text</span><span class="op" id="5689342">,</span>&nbsp;<span class="ident" id="5689344">err</span>&nbsp;<span class="op" id="5689348">:=</span>&nbsp;<span class="ident" id="5689351">val</span><span class="op" id="5689354">.</span><span class="ident" id="5689355">MarshalText</span><span class="op" id="5689366">(</span><span class="op" id="5689367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689370">if</span>&nbsp;<span class="ident" id="5689373">err</span>&nbsp;<span class="op" id="5689377">!=</span>&nbsp;<span class="ident" id="5689380">nil</span>&nbsp;<span class="op" id="5689384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689388">return</span>&nbsp;<span class="ident" id="5689395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689403">EscapeText</span><span class="op" id="5689413">(</span><span class="ident" id="5689414">p</span><span class="op" id="5689415">,</span>&nbsp;<span class="ident" id="5689417">text</span><span class="op" id="5689421">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689424">return</span>&nbsp;<span class="ident" id="5689431">p</span><span class="op" id="5689432">.</span><span class="ident" id="5689433">writeEnd</span><span class="op" id="5689441">(</span><span class="ident" id="5689442">start</span><span class="op" id="5689447">.</span><span class="ident" id="5689448">Name</span><span class="op" id="5689452">)</span><br>
<span class="lineno"></span><span class="op" id="5689454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5689457">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="5689503">func</span>&nbsp;<span class="op" id="5689508">(</span><span class="ident" id="5689509">p</span>&nbsp;<span class="op" id="5689511">*</span><span class="ident" id="5689512">printer</span><span class="op" id="5689519">)</span>&nbsp;<span class="ident" id="5689521">writeStart</span><span class="op" id="5689531">(</span><span class="ident" id="5689532">start</span>&nbsp;<span class="op" id="5689538">*</span><span class="ident" id="5689539">StartElement</span><span class="op" id="5689551">)</span>&nbsp;<span class="builtintype" id="5689553">error</span>&nbsp;<span class="op" id="5689559">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689562">if</span>&nbsp;<span class="ident" id="5689565">start</span><span class="op" id="5689570">.</span><span class="ident" id="5689571">Name</span><span class="op" id="5689575">.</span><span class="ident" id="5689576">Local</span>&nbsp;<span class="op" id="5689582">==</span>&nbsp;<span class="string" id="5689585">&#34;&#34;</span>&nbsp;<span class="op" id="5689588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689592">return</span>&nbsp;<span class="ident" id="5689599">fmt</span><span class="op" id="5689602">.</span><span class="ident" id="5689603">Errorf</span><span class="op" id="5689609">(</span><span class="string" id="5689610">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="5689639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689646">p</span><span class="op" id="5689647">.</span><span class="ident" id="5689648">tags</span>&nbsp;<span class="op" id="5689653">=</span>&nbsp;<span class="builtinfunc" id="5689655">append</span><span class="op" id="5689661">(</span><span class="ident" id="5689662">p</span><span class="op" id="5689663">.</span><span class="ident" id="5689664">tags</span><span class="op" id="5689668">,</span>&nbsp;<span class="ident" id="5689670">start</span><span class="op" id="5689675">.</span><span class="ident" id="5689676">Name</span><span class="op" id="5689680">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689683">p</span><span class="op" id="5689684">.</span><span class="ident" id="5689685">markPrefix</span><span class="op" id="5689695">(</span><span class="op" id="5689696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689700">p</span><span class="op" id="5689701">.</span><span class="ident" id="5689702">writeIndent</span><span class="op" id="5689713">(</span><span class="num" id="5689714">1</span><span class="op" id="5689715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689718">p</span><span class="op" id="5689719">.</span><span class="ident" id="5689720">WriteByte</span><span class="op" id="5689729">(</span><span class="string" id="5689730">&#39;&lt;&#39;</span><span class="op" id="5689733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689736">p</span><span class="op" id="5689737">.</span><span class="ident" id="5689738">WriteString</span><span class="op" id="5689749">(</span><span class="ident" id="5689750">start</span><span class="op" id="5689755">.</span><span class="ident" id="5689756">Name</span><span class="op" id="5689760">.</span><span class="ident" id="5689761">Local</span><span class="op" id="5689766">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689770">if</span>&nbsp;<span class="ident" id="5689773">start</span><span class="op" id="5689778">.</span><span class="ident" id="5689779">Name</span><span class="op" id="5689783">.</span><span class="ident" id="5689784">Space</span>&nbsp;<span class="op" id="5689790">!=</span>&nbsp;<span class="string" id="5689793">&#34;&#34;</span>&nbsp;<span class="op" id="5689796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689800">p</span><span class="op" id="5689801">.</span><span class="ident" id="5689802">WriteString</span><span class="op" id="5689813">(</span><span class="string" id="5689814">`&nbsp;xmlns=&#34;`</span><span class="op" id="5689824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689828">p</span><span class="op" id="5689829">.</span><span class="ident" id="5689830">EscapeString</span><span class="op" id="5689842">(</span><span class="ident" id="5689843">start</span><span class="op" id="5689848">.</span><span class="ident" id="5689849">Name</span><span class="op" id="5689853">.</span><span class="ident" id="5689854">Space</span><span class="op" id="5689859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689863">p</span><span class="op" id="5689864">.</span><span class="ident" id="5689865">WriteByte</span><span class="op" id="5689874">(</span><span class="string" id="5689875">&#39;&#34;&#39;</span><span class="op" id="5689878">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689885">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689900">for</span>&nbsp;<span class="ident" id="5689904">_</span><span class="op" id="5689905">,</span>&nbsp;<span class="ident" id="5689907">attr</span>&nbsp;<span class="op" id="5689912">:=</span>&nbsp;<span class="keyword" id="5689915">range</span>&nbsp;<span class="ident" id="5689921">start</span><span class="op" id="5689926">.</span><span class="ident" id="5689927">Attr</span>&nbsp;<span class="op" id="5689932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689936">name</span>&nbsp;<span class="op" id="5689941">:=</span>&nbsp;<span class="ident" id="5689944">attr</span><span class="op" id="5689948">.</span><span class="ident" id="5689949">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689956">if</span>&nbsp;<span class="ident" id="5689959">name</span><span class="op" id="5689963">.</span><span class="ident" id="5689964">Local</span>&nbsp;<span class="op" id="5689970">==</span>&nbsp;<span class="string" id="5689973">&#34;&#34;</span>&nbsp;<span class="op" id="5689976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689981">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689996">p</span><span class="op" id="5689997">.</span><span class="ident" id="5689998">WriteByte</span><span class="op" id="5690007">(</span><span class="string" id="5690008">&#39;&nbsp;&#39;</span><span class="op" id="5690011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690015">if</span>&nbsp;<span class="ident" id="5690018">name</span><span class="op" id="5690022">.</span><span class="ident" id="5690023">Space</span>&nbsp;<span class="op" id="5690029">!=</span>&nbsp;<span class="string" id="5690032">&#34;&#34;</span>&nbsp;<span class="op" id="5690035">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690040">p</span><span class="op" id="5690041">.</span><span class="ident" id="5690042">WriteString</span><span class="op" id="5690053">(</span><span class="ident" id="5690054">p</span><span class="op" id="5690055">.</span><span class="ident" id="5690056">createAttrPrefix</span><span class="op" id="5690072">(</span><span class="ident" id="5690073">name</span><span class="op" id="5690077">.</span><span class="ident" id="5690078">Space</span><span class="op" id="5690083">)</span><span class="op" id="5690084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690089">p</span><span class="op" id="5690090">.</span><span class="ident" id="5690091">WriteByte</span><span class="op" id="5690100">(</span><span class="string" id="5690101">&#39;:&#39;</span><span class="op" id="5690104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690112">p</span><span class="op" id="5690113">.</span><span class="ident" id="5690114">WriteString</span><span class="op" id="5690125">(</span><span class="ident" id="5690126">name</span><span class="op" id="5690130">.</span><span class="ident" id="5690131">Local</span><span class="op" id="5690136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690140">p</span><span class="op" id="5690141">.</span><span class="ident" id="5690142">WriteString</span><span class="op" id="5690153">(</span><span class="string" id="5690154">`=&#34;`</span><span class="op" id="5690158">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690162">p</span><span class="op" id="5690163">.</span><span class="ident" id="5690164">EscapeString</span><span class="op" id="5690176">(</span><span class="ident" id="5690177">attr</span><span class="op" id="5690181">.</span><span class="ident" id="5690182">Value</span><span class="op" id="5690187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690191">p</span><span class="op" id="5690192">.</span><span class="ident" id="5690193">WriteByte</span><span class="op" id="5690202">(</span><span class="string" id="5690203">&#39;&#34;&#39;</span><span class="op" id="5690206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690212">p</span><span class="op" id="5690213">.</span><span class="ident" id="5690214">WriteByte</span><span class="op" id="5690223">(</span><span class="string" id="5690224">&#39;&gt;&#39;</span><span class="op" id="5690227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690230">return</span>&nbsp;<span class="ident" id="5690237">nil</span><br>
<span class="lineno">645</span><span class="op" id="5690241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5690244">func</span>&nbsp;<span class="op" id="5690249">(</span><span class="ident" id="5690250">p</span>&nbsp;<span class="op" id="5690252">*</span><span class="ident" id="5690253">printer</span><span class="op" id="5690260">)</span>&nbsp;<span class="ident" id="5690262">writeEnd</span><span class="op" id="5690270">(</span><span class="ident" id="5690271">name</span>&nbsp;<span class="ident" id="5690276">Name</span><span class="op" id="5690280">)</span>&nbsp;<span class="builtintype" id="5690282">error</span>&nbsp;<span class="op" id="5690288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690291">if</span>&nbsp;<span class="ident" id="5690294">name</span><span class="op" id="5690298">.</span><span class="ident" id="5690299">Local</span>&nbsp;<span class="op" id="5690305">==</span>&nbsp;<span class="string" id="5690308">&#34;&#34;</span>&nbsp;<span class="op" id="5690311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690315">return</span>&nbsp;<span class="ident" id="5690322">fmt</span><span class="op" id="5690325">.</span><span class="ident" id="5690326">Errorf</span><span class="op" id="5690332">(</span><span class="string" id="5690333">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="5690360">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690366">if</span>&nbsp;<span class="builtinfunc" id="5690369">len</span><span class="op" id="5690372">(</span><span class="ident" id="5690373">p</span><span class="op" id="5690374">.</span><span class="ident" id="5690375">tags</span><span class="op" id="5690379">)</span>&nbsp;<span class="op" id="5690381">==</span>&nbsp;<span class="num" id="5690384">0</span>&nbsp;<span class="op" id="5690386">||</span>&nbsp;<span class="ident" id="5690389">p</span><span class="op" id="5690390">.</span><span class="ident" id="5690391">tags</span><span class="op" id="5690395">[</span><span class="builtinfunc" id="5690396">len</span><span class="op" id="5690399">(</span><span class="ident" id="5690400">p</span><span class="op" id="5690401">.</span><span class="ident" id="5690402">tags</span><span class="op" id="5690406">)</span><span class="op" id="5690407">-</span><span class="num" id="5690408">1</span><span class="op" id="5690409">]</span><span class="op" id="5690410">.</span><span class="ident" id="5690411">Local</span>&nbsp;<span class="op" id="5690417">==</span>&nbsp;<span class="string" id="5690420">&#34;&#34;</span>&nbsp;<span class="op" id="5690423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690427">return</span>&nbsp;<span class="ident" id="5690434">fmt</span><span class="op" id="5690437">.</span><span class="ident" id="5690438">Errorf</span><span class="op" id="5690444">(</span><span class="string" id="5690445">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="5690483">,</span>&nbsp;<span class="ident" id="5690485">name</span><span class="op" id="5690489">.</span><span class="ident" id="5690490">Local</span><span class="op" id="5690495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690501">if</span>&nbsp;<span class="ident" id="5690504">top</span>&nbsp;<span class="op" id="5690508">:=</span>&nbsp;<span class="ident" id="5690511">p</span><span class="op" id="5690512">.</span><span class="ident" id="5690513">tags</span><span class="op" id="5690517">[</span><span class="builtinfunc" id="5690518">len</span><span class="op" id="5690521">(</span><span class="ident" id="5690522">p</span><span class="op" id="5690523">.</span><span class="ident" id="5690524">tags</span><span class="op" id="5690528">)</span><span class="op" id="5690529">-</span><span class="num" id="5690530">1</span><span class="op" id="5690531">]</span><span class="op" id="5690532">;</span>&nbsp;<span class="ident" id="5690534">top</span>&nbsp;<span class="op" id="5690538">!=</span>&nbsp;<span class="ident" id="5690541">name</span>&nbsp;<span class="op" id="5690546">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690550">if</span>&nbsp;<span class="ident" id="5690553">top</span><span class="op" id="5690556">.</span><span class="ident" id="5690557">Local</span>&nbsp;<span class="op" id="5690563">!=</span>&nbsp;<span class="ident" id="5690566">name</span><span class="op" id="5690570">.</span><span class="ident" id="5690571">Local</span>&nbsp;<span class="op" id="5690577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690582">return</span>&nbsp;<span class="ident" id="5690589">fmt</span><span class="op" id="5690592">.</span><span class="ident" id="5690593">Errorf</span><span class="op" id="5690599">(</span><span class="string" id="5690600">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="5690650">,</span>&nbsp;<span class="ident" id="5690652">name</span><span class="op" id="5690656">.</span><span class="ident" id="5690657">Local</span><span class="op" id="5690662">,</span>&nbsp;<span class="ident" id="5690664">top</span><span class="op" id="5690667">.</span><span class="ident" id="5690668">Local</span><span class="op" id="5690673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690681">return</span>&nbsp;<span class="ident" id="5690688">fmt</span><span class="op" id="5690691">.</span><span class="ident" id="5690692">Errorf</span><span class="op" id="5690698">(</span><span class="string" id="5690699">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="5690781">,</span>&nbsp;<span class="ident" id="5690783">name</span><span class="op" id="5690787">.</span><span class="ident" id="5690788">Local</span><span class="op" id="5690793">,</span>&nbsp;<span class="ident" id="5690795">name</span><span class="op" id="5690799">.</span><span class="ident" id="5690800">Space</span><span class="op" id="5690805">,</span>&nbsp;<span class="ident" id="5690807">top</span><span class="op" id="5690810">.</span><span class="ident" id="5690811">Local</span><span class="op" id="5690816">,</span>&nbsp;<span class="ident" id="5690818">top</span><span class="op" id="5690821">.</span><span class="ident" id="5690822">Space</span><span class="op" id="5690827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690830">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690833">p</span><span class="op" id="5690834">.</span><span class="ident" id="5690835">tags</span>&nbsp;<span class="op" id="5690840">=</span>&nbsp;<span class="ident" id="5690842">p</span><span class="op" id="5690843">.</span><span class="ident" id="5690844">tags</span><span class="op" id="5690848">[</span><span class="op" id="5690849">:</span><span class="builtinfunc" id="5690850">len</span><span class="op" id="5690853">(</span><span class="ident" id="5690854">p</span><span class="op" id="5690855">.</span><span class="ident" id="5690856">tags</span><span class="op" id="5690860">)</span><span class="op" id="5690861">-</span><span class="num" id="5690862">1</span><span class="op" id="5690863">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690867">p</span><span class="op" id="5690868">.</span><span class="ident" id="5690869">writeIndent</span><span class="op" id="5690880">(</span><span class="op" id="5690881">-</span><span class="num" id="5690882">1</span><span class="op" id="5690883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690886">p</span><span class="op" id="5690887">.</span><span class="ident" id="5690888">WriteByte</span><span class="op" id="5690897">(</span><span class="string" id="5690898">&#39;&lt;&#39;</span><span class="op" id="5690901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690904">p</span><span class="op" id="5690905">.</span><span class="ident" id="5690906">WriteByte</span><span class="op" id="5690915">(</span><span class="string" id="5690916">&#39;/&#39;</span><span class="op" id="5690919">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690922">p</span><span class="op" id="5690923">.</span><span class="ident" id="5690924">WriteString</span><span class="op" id="5690935">(</span><span class="ident" id="5690936">name</span><span class="op" id="5690940">.</span><span class="ident" id="5690941">Local</span><span class="op" id="5690946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690949">p</span><span class="op" id="5690950">.</span><span class="ident" id="5690951">WriteByte</span><span class="op" id="5690960">(</span><span class="string" id="5690961">&#39;&gt;&#39;</span><span class="op" id="5690964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690967">p</span><span class="op" id="5690968">.</span><span class="ident" id="5690969">popPrefix</span><span class="op" id="5690978">(</span><span class="op" id="5690979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690982">return</span>&nbsp;<span class="ident" id="5690989">nil</span><br>
<span class="lineno"></span><span class="op" id="5690993">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="5690996">func</span>&nbsp;<span class="op" id="5691001">(</span><span class="ident" id="5691002">p</span>&nbsp;<span class="op" id="5691004">*</span><span class="ident" id="5691005">printer</span><span class="op" id="5691012">)</span>&nbsp;<span class="ident" id="5691014">marshalSimple</span><span class="op" id="5691027">(</span><span class="ident" id="5691028">typ</span>&nbsp;<span class="ident" id="5691032">reflect</span><span class="op" id="5691039">.</span><span class="ident" id="5691040">Type</span><span class="op" id="5691044">,</span>&nbsp;<span class="ident" id="5691046">val</span>&nbsp;<span class="ident" id="5691050">reflect</span><span class="op" id="5691057">.</span><span class="ident" id="5691058">Value</span><span class="op" id="5691063">)</span>&nbsp;<span class="op" id="5691065">(</span><span class="builtintype" id="5691066">string</span><span class="op" id="5691072">,</span>&nbsp;<span class="op" id="5691074">[</span><span class="op" id="5691075">]</span><span class="builtintype" id="5691076">byte</span><span class="op" id="5691080">,</span>&nbsp;<span class="builtintype" id="5691082">error</span><span class="op" id="5691087">)</span>&nbsp;<span class="op" id="5691089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691092">switch</span>&nbsp;<span class="ident" id="5691099">val</span><span class="op" id="5691102">.</span><span class="ident" id="5691103">Kind</span><span class="op" id="5691107">(</span><span class="op" id="5691108">)</span>&nbsp;<span class="op" id="5691110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691113">case</span>&nbsp;<span class="ident" id="5691118">reflect</span><span class="op" id="5691125">.</span><span class="ident" id="5691126">Int</span><span class="op" id="5691129">,</span>&nbsp;<span class="ident" id="5691131">reflect</span><span class="op" id="5691138">.</span><span class="ident" id="5691139">Int8</span><span class="op" id="5691143">,</span>&nbsp;<span class="ident" id="5691145">reflect</span><span class="op" id="5691152">.</span><span class="ident" id="5691153">Int16</span><span class="op" id="5691158">,</span>&nbsp;<span class="ident" id="5691160">reflect</span><span class="op" id="5691167">.</span><span class="ident" id="5691168">Int32</span><span class="op" id="5691173">,</span>&nbsp;<span class="ident" id="5691175">reflect</span><span class="op" id="5691182">.</span><span class="ident" id="5691183">Int64</span><span class="op" id="5691188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691192">return</span>&nbsp;<span class="ident" id="5691199">strconv</span><span class="op" id="5691206">.</span><span class="ident" id="5691207">FormatInt</span><span class="op" id="5691216">(</span><span class="ident" id="5691217">val</span><span class="op" id="5691220">.</span><span class="ident" id="5691221">Int</span><span class="op" id="5691224">(</span><span class="op" id="5691225">)</span><span class="op" id="5691226">,</span>&nbsp;<span class="num" id="5691228">10</span><span class="op" id="5691230">)</span><span class="op" id="5691231">,</span>&nbsp;<span class="ident" id="5691233">nil</span><span class="op" id="5691236">,</span>&nbsp;<span class="ident" id="5691238">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691243">case</span>&nbsp;<span class="ident" id="5691248">reflect</span><span class="op" id="5691255">.</span><span class="ident" id="5691256">Uint</span><span class="op" id="5691260">,</span>&nbsp;<span class="ident" id="5691262">reflect</span><span class="op" id="5691269">.</span><span class="ident" id="5691270">Uint8</span><span class="op" id="5691275">,</span>&nbsp;<span class="ident" id="5691277">reflect</span><span class="op" id="5691284">.</span><span class="ident" id="5691285">Uint16</span><span class="op" id="5691291">,</span>&nbsp;<span class="ident" id="5691293">reflect</span><span class="op" id="5691300">.</span><span class="ident" id="5691301">Uint32</span><span class="op" id="5691307">,</span>&nbsp;<span class="ident" id="5691309">reflect</span><span class="op" id="5691316">.</span><span class="ident" id="5691317">Uint64</span><span class="op" id="5691323">,</span>&nbsp;<span class="ident" id="5691325">reflect</span><span class="op" id="5691332">.</span><span class="ident" id="5691333">Uintptr</span><span class="op" id="5691340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691344">return</span>&nbsp;<span class="ident" id="5691351">strconv</span><span class="op" id="5691358">.</span><span class="ident" id="5691359">FormatUint</span><span class="op" id="5691369">(</span><span class="ident" id="5691370">val</span><span class="op" id="5691373">.</span><span class="ident" id="5691374">Uint</span><span class="op" id="5691378">(</span><span class="op" id="5691379">)</span><span class="op" id="5691380">,</span>&nbsp;<span class="num" id="5691382">10</span><span class="op" id="5691384">)</span><span class="op" id="5691385">,</span>&nbsp;<span class="ident" id="5691387">nil</span><span class="op" id="5691390">,</span>&nbsp;<span class="ident" id="5691392">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691397">case</span>&nbsp;<span class="ident" id="5691402">reflect</span><span class="op" id="5691409">.</span><span class="ident" id="5691410">Float32</span><span class="op" id="5691417">,</span>&nbsp;<span class="ident" id="5691419">reflect</span><span class="op" id="5691426">.</span><span class="ident" id="5691427">Float64</span><span class="op" id="5691434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691438">return</span>&nbsp;<span class="ident" id="5691445">strconv</span><span class="op" id="5691452">.</span><span class="ident" id="5691453">FormatFloat</span><span class="op" id="5691464">(</span><span class="ident" id="5691465">val</span><span class="op" id="5691468">.</span><span class="ident" id="5691469">Float</span><span class="op" id="5691474">(</span><span class="op" id="5691475">)</span><span class="op" id="5691476">,</span>&nbsp;<span class="string" id="5691478">&#39;g&#39;</span><span class="op" id="5691481">,</span>&nbsp;<span class="op" id="5691483">-</span><span class="num" id="5691484">1</span><span class="op" id="5691485">,</span>&nbsp;<span class="ident" id="5691487">val</span><span class="op" id="5691490">.</span><span class="ident" id="5691491">Type</span><span class="op" id="5691495">(</span><span class="op" id="5691496">)</span><span class="op" id="5691497">.</span><span class="ident" id="5691498">Bits</span><span class="op" id="5691502">(</span><span class="op" id="5691503">)</span><span class="op" id="5691504">)</span><span class="op" id="5691505">,</span>&nbsp;<span class="ident" id="5691507">nil</span><span class="op" id="5691510">,</span>&nbsp;<span class="ident" id="5691512">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691517">case</span>&nbsp;<span class="ident" id="5691522">reflect</span><span class="op" id="5691529">.</span><span class="ident" id="5691530">String</span><span class="op" id="5691536">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691540">return</span>&nbsp;<span class="ident" id="5691547">val</span><span class="op" id="5691550">.</span><span class="ident" id="5691551">String</span><span class="op" id="5691557">(</span><span class="op" id="5691558">)</span><span class="op" id="5691559">,</span>&nbsp;<span class="ident" id="5691561">nil</span><span class="op" id="5691564">,</span>&nbsp;<span class="ident" id="5691566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691571">case</span>&nbsp;<span class="ident" id="5691576">reflect</span><span class="op" id="5691583">.</span><span class="ident" id="5691584">Bool</span><span class="op" id="5691588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691592">return</span>&nbsp;<span class="ident" id="5691599">strconv</span><span class="op" id="5691606">.</span><span class="ident" id="5691607">FormatBool</span><span class="op" id="5691617">(</span><span class="ident" id="5691618">val</span><span class="op" id="5691621">.</span><span class="ident" id="5691622">Bool</span><span class="op" id="5691626">(</span><span class="op" id="5691627">)</span><span class="op" id="5691628">)</span><span class="op" id="5691629">,</span>&nbsp;<span class="ident" id="5691631">nil</span><span class="op" id="5691634">,</span>&nbsp;<span class="ident" id="5691636">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691641">case</span>&nbsp;<span class="ident" id="5691646">reflect</span><span class="op" id="5691653">.</span><span class="ident" id="5691654">Array</span><span class="op" id="5691659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691663">if</span>&nbsp;<span class="ident" id="5691666">typ</span><span class="op" id="5691669">.</span><span class="ident" id="5691670">Elem</span><span class="op" id="5691674">(</span><span class="op" id="5691675">)</span><span class="op" id="5691676">.</span><span class="ident" id="5691677">Kind</span><span class="op" id="5691681">(</span><span class="op" id="5691682">)</span>&nbsp;<span class="op" id="5691684">!=</span>&nbsp;<span class="ident" id="5691687">reflect</span><span class="op" id="5691694">.</span><span class="ident" id="5691695">Uint8</span>&nbsp;<span class="op" id="5691701">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691706">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5691718">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691733">var</span>&nbsp;<span class="ident" id="5691737">bytes</span>&nbsp;<span class="op" id="5691743">[</span><span class="op" id="5691744">]</span><span class="builtintype" id="5691745">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691752">if</span>&nbsp;<span class="ident" id="5691755">val</span><span class="op" id="5691758">.</span><span class="ident" id="5691759">CanAddr</span><span class="op" id="5691766">(</span><span class="op" id="5691767">)</span>&nbsp;<span class="op" id="5691769">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691774">bytes</span>&nbsp;<span class="op" id="5691780">=</span>&nbsp;<span class="ident" id="5691782">val</span><span class="op" id="5691785">.</span><span class="ident" id="5691786">Slice</span><span class="op" id="5691791">(</span><span class="num" id="5691792">0</span><span class="op" id="5691793">,</span>&nbsp;<span class="ident" id="5691795">val</span><span class="op" id="5691798">.</span><span class="ident" id="5691799">Len</span><span class="op" id="5691802">(</span><span class="op" id="5691803">)</span><span class="op" id="5691804">)</span><span class="op" id="5691805">.</span><span class="ident" id="5691806">Bytes</span><span class="op" id="5691811">(</span><span class="op" id="5691812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691816">}</span>&nbsp;<span class="keyword" id="5691818">else</span>&nbsp;<span class="op" id="5691823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691828">bytes</span>&nbsp;<span class="op" id="5691834">=</span>&nbsp;<span class="builtinfunc" id="5691836">make</span><span class="op" id="5691840">(</span><span class="op" id="5691841">[</span><span class="op" id="5691842">]</span><span class="builtintype" id="5691843">byte</span><span class="op" id="5691847">,</span>&nbsp;<span class="ident" id="5691849">val</span><span class="op" id="5691852">.</span><span class="ident" id="5691853">Len</span><span class="op" id="5691856">(</span><span class="op" id="5691857">)</span><span class="op" id="5691858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691863">reflect</span><span class="op" id="5691870">.</span><span class="ident" id="5691871">Copy</span><span class="op" id="5691875">(</span><span class="ident" id="5691876">reflect</span><span class="op" id="5691883">.</span><span class="ident" id="5691884">ValueOf</span><span class="op" id="5691891">(</span><span class="ident" id="5691892">bytes</span><span class="op" id="5691897">)</span><span class="op" id="5691898">,</span>&nbsp;<span class="ident" id="5691900">val</span><span class="op" id="5691903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691907">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691911">return</span>&nbsp;<span class="string" id="5691918">&#34;&#34;</span><span class="op" id="5691920">,</span>&nbsp;<span class="ident" id="5691922">bytes</span><span class="op" id="5691927">,</span>&nbsp;<span class="ident" id="5691929">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691934">case</span>&nbsp;<span class="ident" id="5691939">reflect</span><span class="op" id="5691946">.</span><span class="ident" id="5691947">Slice</span><span class="op" id="5691952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691956">if</span>&nbsp;<span class="ident" id="5691959">typ</span><span class="op" id="5691962">.</span><span class="ident" id="5691963">Elem</span><span class="op" id="5691967">(</span><span class="op" id="5691968">)</span><span class="op" id="5691969">.</span><span class="ident" id="5691970">Kind</span><span class="op" id="5691974">(</span><span class="op" id="5691975">)</span>&nbsp;<span class="op" id="5691977">!=</span>&nbsp;<span class="ident" id="5691980">reflect</span><span class="op" id="5691987">.</span><span class="ident" id="5691988">Uint8</span>&nbsp;<span class="op" id="5691994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691999">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692007">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5692011">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692023">return</span>&nbsp;<span class="string" id="5692030">&#34;&#34;</span><span class="op" id="5692032">,</span>&nbsp;<span class="ident" id="5692034">val</span><span class="op" id="5692037">.</span><span class="ident" id="5692038">Bytes</span><span class="op" id="5692043">(</span><span class="op" id="5692044">)</span><span class="op" id="5692045">,</span>&nbsp;<span class="ident" id="5692047">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692055">return</span>&nbsp;<span class="string" id="5692062">&#34;&#34;</span><span class="op" id="5692064">,</span>&nbsp;<span class="ident" id="5692066">nil</span><span class="op" id="5692069">,</span>&nbsp;<span class="op" id="5692071">&amp;</span><span class="ident" id="5692072">UnsupportedTypeError</span><span class="op" id="5692092">{</span><span class="ident" id="5692093">typ</span><span class="op" id="5692096">}</span><br>
<span class="lineno"></span><span class="op" id="5692098">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="5692101">var</span>&nbsp;<span class="ident" id="5692105">ddBytes</span>&nbsp;<span class="op" id="5692113">=</span>&nbsp;<span class="op" id="5692115">[</span><span class="op" id="5692116">]</span><span class="builtintype" id="5692117">byte</span><span class="op" id="5692121">(</span><span class="string" id="5692122">&#34;--&#34;</span><span class="op" id="5692126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5692129">func</span>&nbsp;<span class="op" id="5692134">(</span><span class="ident" id="5692135">p</span>&nbsp;<span class="op" id="5692137">*</span><span class="ident" id="5692138">printer</span><span class="op" id="5692145">)</span>&nbsp;<span class="ident" id="5692147">marshalStruct</span><span class="op" id="5692160">(</span><span class="ident" id="5692161">tinfo</span>&nbsp;<span class="op" id="5692167">*</span><span class="ident" id="5692168">typeInfo</span><span class="op" id="5692176">,</span>&nbsp;<span class="ident" id="5692178">val</span>&nbsp;<span class="ident" id="5692182">reflect</span><span class="op" id="5692189">.</span><span class="ident" id="5692190">Value</span><span class="op" id="5692195">)</span>&nbsp;<span class="builtintype" id="5692197">error</span>&nbsp;<span class="op" id="5692203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692206">s</span>&nbsp;<span class="op" id="5692208">:=</span>&nbsp;<span class="ident" id="5692211">parentStack</span><span class="op" id="5692222">{</span><span class="ident" id="5692223">p</span><span class="op" id="5692224">:</span>&nbsp;<span class="ident" id="5692226">p</span><span class="op" id="5692227">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692230">for</span>&nbsp;<span class="ident" id="5692234">i</span>&nbsp;<span class="op" id="5692236">:=</span>&nbsp;<span class="keyword" id="5692239">range</span>&nbsp;<span class="ident" id="5692245">tinfo</span><span class="op" id="5692250">.</span><span class="ident" id="5692251">fields</span>&nbsp;<span class="op" id="5692258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692262">finfo</span>&nbsp;<span class="op" id="5692268">:=</span>&nbsp;<span class="op" id="5692271">&amp;</span><span class="ident" id="5692272">tinfo</span><span class="op" id="5692277">.</span><span class="ident" id="5692278">fields</span><span class="op" id="5692284">[</span><span class="ident" id="5692285">i</span><span class="op" id="5692286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692290">if</span>&nbsp;<span class="ident" id="5692293">finfo</span><span class="op" id="5692298">.</span><span class="ident" id="5692299">flags</span><span class="op" id="5692304">&amp;</span><span class="ident" id="5692305">fAttr</span>&nbsp;<span class="op" id="5692311">!=</span>&nbsp;<span class="num" id="5692314">0</span>&nbsp;<span class="op" id="5692316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692321">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692332">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692336">vf</span>&nbsp;<span class="op" id="5692339">:=</span>&nbsp;<span class="ident" id="5692342">finfo</span><span class="op" id="5692347">.</span><span class="ident" id="5692348">value</span><span class="op" id="5692353">(</span><span class="ident" id="5692354">val</span><span class="op" id="5692357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5692362">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692418">switch</span>&nbsp;<span class="ident" id="5692425">vf</span><span class="op" id="5692427">.</span><span class="ident" id="5692428">Kind</span><span class="op" id="5692432">(</span><span class="op" id="5692433">)</span>&nbsp;<span class="op" id="5692435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692439">case</span>&nbsp;<span class="ident" id="5692444">reflect</span><span class="op" id="5692451">.</span><span class="ident" id="5692452">Ptr</span><span class="op" id="5692455">,</span>&nbsp;<span class="ident" id="5692457">reflect</span><span class="op" id="5692464">.</span><span class="ident" id="5692465">Interface</span><span class="op" id="5692474">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692479">if</span>&nbsp;<span class="op" id="5692482">!</span><span class="ident" id="5692483">vf</span><span class="op" id="5692485">.</span><span class="ident" id="5692486">IsNil</span><span class="op" id="5692491">(</span><span class="op" id="5692492">)</span>&nbsp;<span class="op" id="5692494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692500">vf</span>&nbsp;<span class="op" id="5692503">=</span>&nbsp;<span class="ident" id="5692505">vf</span><span class="op" id="5692507">.</span><span class="ident" id="5692508">Elem</span><span class="op" id="5692512">(</span><span class="op" id="5692513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692527">switch</span>&nbsp;<span class="ident" id="5692534">finfo</span><span class="op" id="5692539">.</span><span class="ident" id="5692540">flags</span>&nbsp;<span class="op" id="5692546">&amp;</span>&nbsp;<span class="ident" id="5692548">fMode</span>&nbsp;<span class="op" id="5692554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692558">case</span>&nbsp;<span class="ident" id="5692563">fCharData</span><span class="op" id="5692572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692577">if</span>&nbsp;<span class="ident" id="5692580">vf</span><span class="op" id="5692582">.</span><span class="ident" id="5692583">CanInterface</span><span class="op" id="5692595">(</span><span class="op" id="5692596">)</span>&nbsp;<span class="op" id="5692598">&amp;&amp;</span>&nbsp;<span class="ident" id="5692601">vf</span><span class="op" id="5692603">.</span><span class="ident" id="5692604">Type</span><span class="op" id="5692608">(</span><span class="op" id="5692609">)</span><span class="op" id="5692610">.</span><span class="ident" id="5692611">Implements</span><span class="op" id="5692621">(</span><span class="ident" id="5692622">textMarshalerType</span><span class="op" id="5692639">)</span>&nbsp;<span class="op" id="5692641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692647">data</span><span class="op" id="5692651">,</span>&nbsp;<span class="ident" id="5692653">err</span>&nbsp;<span class="op" id="5692657">:=</span>&nbsp;<span class="ident" id="5692660">vf</span><span class="op" id="5692662">.</span><span class="ident" id="5692663">Interface</span><span class="op" id="5692672">(</span><span class="op" id="5692673">)</span><span class="op" id="5692674">.</span><span class="op" id="5692675">(</span><span class="ident" id="5692676">encoding</span><span class="op" id="5692684">.</span><span class="ident" id="5692685">TextMarshaler</span><span class="op" id="5692698">)</span><span class="op" id="5692699">.</span><span class="ident" id="5692700">MarshalText</span><span class="op" id="5692711">(</span><span class="op" id="5692712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692718">if</span>&nbsp;<span class="ident" id="5692721">err</span>&nbsp;<span class="op" id="5692725">!=</span>&nbsp;<span class="ident" id="5692728">nil</span>&nbsp;<span class="op" id="5692732">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692739">return</span>&nbsp;<span class="ident" id="5692746">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692760">Escape</span><span class="op" id="5692766">(</span><span class="ident" id="5692767">p</span><span class="op" id="5692768">,</span>&nbsp;<span class="ident" id="5692770">data</span><span class="op" id="5692774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692780">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692792">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692797">if</span>&nbsp;<span class="ident" id="5692800">vf</span><span class="op" id="5692802">.</span><span class="ident" id="5692803">CanAddr</span><span class="op" id="5692810">(</span><span class="op" id="5692811">)</span>&nbsp;<span class="op" id="5692813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692819">pv</span>&nbsp;<span class="op" id="5692822">:=</span>&nbsp;<span class="ident" id="5692825">vf</span><span class="op" id="5692827">.</span><span class="ident" id="5692828">Addr</span><span class="op" id="5692832">(</span><span class="op" id="5692833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692839">if</span>&nbsp;<span class="ident" id="5692842">pv</span><span class="op" id="5692844">.</span><span class="ident" id="5692845">CanInterface</span><span class="op" id="5692857">(</span><span class="op" id="5692858">)</span>&nbsp;<span class="op" id="5692860">&amp;&amp;</span>&nbsp;<span class="ident" id="5692863">pv</span><span class="op" id="5692865">.</span><span class="ident" id="5692866">Type</span><span class="op" id="5692870">(</span><span class="op" id="5692871">)</span><span class="op" id="5692872">.</span><span class="ident" id="5692873">Implements</span><span class="op" id="5692883">(</span><span class="ident" id="5692884">textMarshalerType</span><span class="op" id="5692901">)</span>&nbsp;<span class="op" id="5692903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692910">data</span><span class="op" id="5692914">,</span>&nbsp;<span class="ident" id="5692916">err</span>&nbsp;<span class="op" id="5692920">:=</span>&nbsp;<span class="ident" id="5692923">pv</span><span class="op" id="5692925">.</span><span class="ident" id="5692926">Interface</span><span class="op" id="5692935">(</span><span class="op" id="5692936">)</span><span class="op" id="5692937">.</span><span class="op" id="5692938">(</span><span class="ident" id="5692939">encoding</span><span class="op" id="5692947">.</span><span class="ident" id="5692948">TextMarshaler</span><span class="op" id="5692961">)</span><span class="op" id="5692962">.</span><span class="ident" id="5692963">MarshalText</span><span class="op" id="5692974">(</span><span class="op" id="5692975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692982">if</span>&nbsp;<span class="ident" id="5692985">err</span>&nbsp;<span class="op" id="5692989">!=</span>&nbsp;<span class="ident" id="5692992">nil</span>&nbsp;<span class="op" id="5692996">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693004">return</span>&nbsp;<span class="ident" id="5693011">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693027">Escape</span><span class="op" id="5693033">(</span><span class="ident" id="5693034">p</span><span class="op" id="5693035">,</span>&nbsp;<span class="ident" id="5693037">data</span><span class="op" id="5693041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693048">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693061">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693071">var</span>&nbsp;<span class="ident" id="5693075">scratch</span>&nbsp;<span class="op" id="5693083">[</span><span class="num" id="5693084">64</span><span class="op" id="5693086">]</span><span class="builtintype" id="5693087">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693095">switch</span>&nbsp;<span class="ident" id="5693102">vf</span><span class="op" id="5693104">.</span><span class="ident" id="5693105">Kind</span><span class="op" id="5693109">(</span><span class="op" id="5693110">)</span>&nbsp;<span class="op" id="5693112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693117">case</span>&nbsp;<span class="ident" id="5693122">reflect</span><span class="op" id="5693129">.</span><span class="ident" id="5693130">Int</span><span class="op" id="5693133">,</span>&nbsp;<span class="ident" id="5693135">reflect</span><span class="op" id="5693142">.</span><span class="ident" id="5693143">Int8</span><span class="op" id="5693147">,</span>&nbsp;<span class="ident" id="5693149">reflect</span><span class="op" id="5693156">.</span><span class="ident" id="5693157">Int16</span><span class="op" id="5693162">,</span>&nbsp;<span class="ident" id="5693164">reflect</span><span class="op" id="5693171">.</span><span class="ident" id="5693172">Int32</span><span class="op" id="5693177">,</span>&nbsp;<span class="ident" id="5693179">reflect</span><span class="op" id="5693186">.</span><span class="ident" id="5693187">Int64</span><span class="op" id="5693192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693198">Escape</span><span class="op" id="5693204">(</span><span class="ident" id="5693205">p</span><span class="op" id="5693206">,</span>&nbsp;<span class="ident" id="5693208">strconv</span><span class="op" id="5693215">.</span><span class="ident" id="5693216">AppendInt</span><span class="op" id="5693225">(</span><span class="ident" id="5693226">scratch</span><span class="op" id="5693233">[</span><span class="op" id="5693234">:</span><span class="num" id="5693235">0</span><span class="op" id="5693236">]</span><span class="op" id="5693237">,</span>&nbsp;<span class="ident" id="5693239">vf</span><span class="op" id="5693241">.</span><span class="ident" id="5693242">Int</span><span class="op" id="5693245">(</span><span class="op" id="5693246">)</span><span class="op" id="5693247">,</span>&nbsp;<span class="num" id="5693249">10</span><span class="op" id="5693251">)</span><span class="op" id="5693252">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693257">case</span>&nbsp;<span class="ident" id="5693262">reflect</span><span class="op" id="5693269">.</span><span class="ident" id="5693270">Uint</span><span class="op" id="5693274">,</span>&nbsp;<span class="ident" id="5693276">reflect</span><span class="op" id="5693283">.</span><span class="ident" id="5693284">Uint8</span><span class="op" id="5693289">,</span>&nbsp;<span class="ident" id="5693291">reflect</span><span class="op" id="5693298">.</span><span class="ident" id="5693299">Uint16</span><span class="op" id="5693305">,</span>&nbsp;<span class="ident" id="5693307">reflect</span><span class="op" id="5693314">.</span><span class="ident" id="5693315">Uint32</span><span class="op" id="5693321">,</span>&nbsp;<span class="ident" id="5693323">reflect</span><span class="op" id="5693330">.</span><span class="ident" id="5693331">Uint64</span><span class="op" id="5693337">,</span>&nbsp;<span class="ident" id="5693339">reflect</span><span class="op" id="5693346">.</span><span class="ident" id="5693347">Uintptr</span><span class="op" id="5693354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693360">Escape</span><span class="op" id="5693366">(</span><span class="ident" id="5693367">p</span><span class="op" id="5693368">,</span>&nbsp;<span class="ident" id="5693370">strconv</span><span class="op" id="5693377">.</span><span class="ident" id="5693378">AppendUint</span><span class="op" id="5693388">(</span><span class="ident" id="5693389">scratch</span><span class="op" id="5693396">[</span><span class="op" id="5693397">:</span><span class="num" id="5693398">0</span><span class="op" id="5693399">]</span><span class="op" id="5693400">,</span>&nbsp;<span class="ident" id="5693402">vf</span><span class="op" id="5693404">.</span><span class="ident" id="5693405">Uint</span><span class="op" id="5693409">(</span><span class="op" id="5693410">)</span><span class="op" id="5693411">,</span>&nbsp;<span class="num" id="5693413">10</span><span class="op" id="5693415">)</span><span class="op" id="5693416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693421">case</span>&nbsp;<span class="ident" id="5693426">reflect</span><span class="op" id="5693433">.</span><span class="ident" id="5693434">Float32</span><span class="op" id="5693441">,</span>&nbsp;<span class="ident" id="5693443">reflect</span><span class="op" id="5693450">.</span><span class="ident" id="5693451">Float64</span><span class="op" id="5693458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693464">Escape</span><span class="op" id="5693470">(</span><span class="ident" id="5693471">p</span><span class="op" id="5693472">,</span>&nbsp;<span class="ident" id="5693474">strconv</span><span class="op" id="5693481">.</span><span class="ident" id="5693482">AppendFloat</span><span class="op" id="5693493">(</span><span class="ident" id="5693494">scratch</span><span class="op" id="5693501">[</span><span class="op" id="5693502">:</span><span class="num" id="5693503">0</span><span class="op" id="5693504">]</span><span class="op" id="5693505">,</span>&nbsp;<span class="ident" id="5693507">vf</span><span class="op" id="5693509">.</span><span class="ident" id="5693510">Float</span><span class="op" id="5693515">(</span><span class="op" id="5693516">)</span><span class="op" id="5693517">,</span>&nbsp;<span class="string" id="5693519">&#39;g&#39;</span><span class="op" id="5693522">,</span>&nbsp;<span class="op" id="5693524">-</span><span class="num" id="5693525">1</span><span class="op" id="5693526">,</span>&nbsp;<span class="ident" id="5693528">vf</span><span class="op" id="5693530">.</span><span class="ident" id="5693531">Type</span><span class="op" id="5693535">(</span><span class="op" id="5693536">)</span><span class="op" id="5693537">.</span><span class="ident" id="5693538">Bits</span><span class="op" id="5693542">(</span><span class="op" id="5693543">)</span><span class="op" id="5693544">)</span><span class="op" id="5693545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693550">case</span>&nbsp;<span class="ident" id="5693555">reflect</span><span class="op" id="5693562">.</span><span class="ident" id="5693563">Bool</span><span class="op" id="5693567">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693573">Escape</span><span class="op" id="5693579">(</span><span class="ident" id="5693580">p</span><span class="op" id="5693581">,</span>&nbsp;<span class="ident" id="5693583">strconv</span><span class="op" id="5693590">.</span><span class="ident" id="5693591">AppendBool</span><span class="op" id="5693601">(</span><span class="ident" id="5693602">scratch</span><span class="op" id="5693609">[</span><span class="op" id="5693610">:</span><span class="num" id="5693611">0</span><span class="op" id="5693612">]</span><span class="op" id="5693613">,</span>&nbsp;<span class="ident" id="5693615">vf</span><span class="op" id="5693617">.</span><span class="ident" id="5693618">Bool</span><span class="op" id="5693622">(</span><span class="op" id="5693623">)</span><span class="op" id="5693624">)</span><span class="op" id="5693625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693630">case</span>&nbsp;<span class="ident" id="5693635">reflect</span><span class="op" id="5693642">.</span><span class="ident" id="5693643">String</span><span class="op" id="5693649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693655">if</span>&nbsp;<span class="ident" id="5693658">err</span>&nbsp;<span class="op" id="5693662">:=</span>&nbsp;<span class="ident" id="5693665">EscapeText</span><span class="op" id="5693675">(</span><span class="ident" id="5693676">p</span><span class="op" id="5693677">,</span>&nbsp;<span class="op" id="5693679">[</span><span class="op" id="5693680">]</span><span class="builtintype" id="5693681">byte</span><span class="op" id="5693685">(</span><span class="ident" id="5693686">vf</span><span class="op" id="5693688">.</span><span class="ident" id="5693689">String</span><span class="op" id="5693695">(</span><span class="op" id="5693696">)</span><span class="op" id="5693697">)</span><span class="op" id="5693698">)</span><span class="op" id="5693699">;</span>&nbsp;<span class="ident" id="5693701">err</span>&nbsp;<span class="op" id="5693705">!=</span>&nbsp;<span class="ident" id="5693708">nil</span>&nbsp;<span class="op" id="5693712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693719">return</span>&nbsp;<span class="ident" id="5693726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693734">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693739">case</span>&nbsp;<span class="ident" id="5693744">reflect</span><span class="op" id="5693751">.</span><span class="ident" id="5693752">Slice</span><span class="op" id="5693757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693763">if</span>&nbsp;<span class="ident" id="5693766">elem</span><span class="op" id="5693770">,</span>&nbsp;<span class="ident" id="5693772">ok</span>&nbsp;<span class="op" id="5693775">:=</span>&nbsp;<span class="ident" id="5693778">vf</span><span class="op" id="5693780">.</span><span class="ident" id="5693781">Interface</span><span class="op" id="5693790">(</span><span class="op" id="5693791">)</span><span class="op" id="5693792">.</span><span class="op" id="5693793">(</span><span class="op" id="5693794">[</span><span class="op" id="5693795">]</span><span class="builtintype" id="5693796">byte</span><span class="op" id="5693800">)</span><span class="op" id="5693801">;</span>&nbsp;<span class="ident" id="5693803">ok</span>&nbsp;<span class="op" id="5693806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693813">if</span>&nbsp;<span class="ident" id="5693816">err</span>&nbsp;<span class="op" id="5693820">:=</span>&nbsp;<span class="ident" id="5693823">EscapeText</span><span class="op" id="5693833">(</span><span class="ident" id="5693834">p</span><span class="op" id="5693835">,</span>&nbsp;<span class="ident" id="5693837">elem</span><span class="op" id="5693841">)</span><span class="op" id="5693842">;</span>&nbsp;<span class="ident" id="5693844">err</span>&nbsp;<span class="op" id="5693848">!=</span>&nbsp;<span class="ident" id="5693851">nil</span>&nbsp;<span class="op" id="5693855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693863">return</span>&nbsp;<span class="ident" id="5693870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693879">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693895">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693907">case</span>&nbsp;<span class="ident" id="5693912">fComment</span><span class="op" id="5693920">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693925">k</span>&nbsp;<span class="op" id="5693927">:=</span>&nbsp;<span class="ident" id="5693930">vf</span><span class="op" id="5693932">.</span><span class="ident" id="5693933">Kind</span><span class="op" id="5693937">(</span><span class="op" id="5693938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693943">if</span>&nbsp;<span class="op" id="5693946">!</span><span class="op" id="5693947">(</span><span class="ident" id="5693948">k</span>&nbsp;<span class="op" id="5693950">==</span>&nbsp;<span class="ident" id="5693953">reflect</span><span class="op" id="5693960">.</span><span class="ident" id="5693961">String</span>&nbsp;<span class="op" id="5693968">||</span>&nbsp;<span class="ident" id="5693971">k</span>&nbsp;<span class="op" id="5693973">==</span>&nbsp;<span class="ident" id="5693976">reflect</span><span class="op" id="5693983">.</span><span class="ident" id="5693984">Slice</span>&nbsp;<span class="op" id="5693990">&amp;&amp;</span>&nbsp;<span class="ident" id="5693993">vf</span><span class="op" id="5693995">.</span><span class="ident" id="5693996">Type</span><span class="op" id="5694000">(</span><span class="op" id="5694001">)</span><span class="op" id="5694002">.</span><span class="ident" id="5694003">Elem</span><span class="op" id="5694007">(</span><span class="op" id="5694008">)</span><span class="op" id="5694009">.</span><span class="ident" id="5694010">Kind</span><span class="op" id="5694014">(</span><span class="op" id="5694015">)</span>&nbsp;<span class="op" id="5694017">==</span>&nbsp;<span class="ident" id="5694020">reflect</span><span class="op" id="5694027">.</span><span class="ident" id="5694028">Uint8</span><span class="op" id="5694033">)</span>&nbsp;<span class="op" id="5694035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694041">return</span>&nbsp;<span class="ident" id="5694048">fmt</span><span class="op" id="5694051">.</span><span class="ident" id="5694052">Errorf</span><span class="op" id="5694058">(</span><span class="string" id="5694059">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="5694098">,</span>&nbsp;<span class="ident" id="5694100">val</span><span class="op" id="5694103">.</span><span class="ident" id="5694104">Type</span><span class="op" id="5694108">(</span><span class="op" id="5694109">)</span><span class="op" id="5694110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694120">if</span>&nbsp;<span class="ident" id="5694123">vf</span><span class="op" id="5694125">.</span><span class="ident" id="5694126">Len</span><span class="op" id="5694129">(</span><span class="op" id="5694130">)</span>&nbsp;<span class="op" id="5694132">==</span>&nbsp;<span class="num" id="5694135">0</span>&nbsp;<span class="op" id="5694137">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694143">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694160">p</span><span class="op" id="5694161">.</span><span class="ident" id="5694162">writeIndent</span><span class="op" id="5694173">(</span><span class="num" id="5694174">0</span><span class="op" id="5694175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694180">p</span><span class="op" id="5694181">.</span><span class="ident" id="5694182">WriteString</span><span class="op" id="5694193">(</span><span class="string" id="5694194">&#34;&lt;!--&#34;</span><span class="op" id="5694200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694205">dashDash</span>&nbsp;<span class="op" id="5694214">:=</span>&nbsp;<span class="builtintype" id="5694217">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694226">dashLast</span>&nbsp;<span class="op" id="5694235">:=</span>&nbsp;<span class="builtintype" id="5694238">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694247">switch</span>&nbsp;<span class="ident" id="5694254">k</span>&nbsp;<span class="op" id="5694256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694261">case</span>&nbsp;<span class="ident" id="5694266">reflect</span><span class="op" id="5694273">.</span><span class="ident" id="5694274">String</span><span class="op" id="5694280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694286">s</span>&nbsp;<span class="op" id="5694288">:=</span>&nbsp;<span class="ident" id="5694291">vf</span><span class="op" id="5694293">.</span><span class="ident" id="5694294">String</span><span class="op" id="5694300">(</span><span class="op" id="5694301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694307">dashDash</span>&nbsp;<span class="op" id="5694316">=</span>&nbsp;<span class="ident" id="5694318">strings</span><span class="op" id="5694325">.</span><span class="ident" id="5694326">Index</span><span class="op" id="5694331">(</span><span class="ident" id="5694332">s</span><span class="op" id="5694333">,</span>&nbsp;<span class="string" id="5694335">&#34;--&#34;</span><span class="op" id="5694339">)</span>&nbsp;<span class="op" id="5694341">&gt;=</span>&nbsp;<span class="num" id="5694344">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694350">dashLast</span>&nbsp;<span class="op" id="5694359">=</span>&nbsp;<span class="ident" id="5694361">s</span><span class="op" id="5694362">[</span><span class="builtinfunc" id="5694363">len</span><span class="op" id="5694366">(</span><span class="ident" id="5694367">s</span><span class="op" id="5694368">)</span><span class="op" id="5694369">-</span><span class="num" id="5694370">1</span><span class="op" id="5694371">]</span>&nbsp;<span class="op" id="5694373">==</span>&nbsp;<span class="string" id="5694376">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694384">if</span>&nbsp;<span class="op" id="5694387">!</span><span class="ident" id="5694388">dashDash</span>&nbsp;<span class="op" id="5694397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694404">p</span><span class="op" id="5694405">.</span><span class="ident" id="5694406">WriteString</span><span class="op" id="5694417">(</span><span class="ident" id="5694418">s</span><span class="op" id="5694419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694430">case</span>&nbsp;<span class="ident" id="5694435">reflect</span><span class="op" id="5694442">.</span><span class="ident" id="5694443">Slice</span><span class="op" id="5694448">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694454">b</span>&nbsp;<span class="op" id="5694456">:=</span>&nbsp;<span class="ident" id="5694459">vf</span><span class="op" id="5694461">.</span><span class="ident" id="5694462">Bytes</span><span class="op" id="5694467">(</span><span class="op" id="5694468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694474">dashDash</span>&nbsp;<span class="op" id="5694483">=</span>&nbsp;<span class="ident" id="5694485">bytes</span><span class="op" id="5694490">.</span><span class="ident" id="5694491">Index</span><span class="op" id="5694496">(</span><span class="ident" id="5694497">b</span><span class="op" id="5694498">,</span>&nbsp;<span class="ident" id="5694500">ddBytes</span><span class="op" id="5694507">)</span>&nbsp;<span class="op" id="5694509">&gt;=</span>&nbsp;<span class="num" id="5694512">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694518">dashLast</span>&nbsp;<span class="op" id="5694527">=</span>&nbsp;<span class="ident" id="5694529">b</span><span class="op" id="5694530">[</span><span class="builtinfunc" id="5694531">len</span><span class="op" id="5694534">(</span><span class="ident" id="5694535">b</span><span class="op" id="5694536">)</span><span class="op" id="5694537">-</span><span class="num" id="5694538">1</span><span class="op" id="5694539">]</span>&nbsp;<span class="op" id="5694541">==</span>&nbsp;<span class="string" id="5694544">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694552">if</span>&nbsp;<span class="op" id="5694555">!</span><span class="ident" id="5694556">dashDash</span>&nbsp;<span class="op" id="5694565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694572">p</span><span class="op" id="5694573">.</span><span class="ident" id="5694574">Write</span><span class="op" id="5694579">(</span><span class="ident" id="5694580">b</span><span class="op" id="5694581">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694592">default</span><span class="op" id="5694599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5694605">panic</span><span class="op" id="5694610">(</span><span class="string" id="5694611">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="5694625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694635">if</span>&nbsp;<span class="ident" id="5694638">dashDash</span>&nbsp;<span class="op" id="5694647">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694653">return</span>&nbsp;<span class="ident" id="5694660">fmt</span><span class="op" id="5694663">.</span><span class="ident" id="5694664">Errorf</span><span class="op" id="5694670">(</span><span class="string" id="5694671">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="5694708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694718">if</span>&nbsp;<span class="ident" id="5694721">dashLast</span>&nbsp;<span class="op" id="5694730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5694736">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694786">p</span><span class="op" id="5694787">.</span><span class="ident" id="5694788">WriteByte</span><span class="op" id="5694797">(</span><span class="string" id="5694798">&#39;&nbsp;&#39;</span><span class="op" id="5694801">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694811">p</span><span class="op" id="5694812">.</span><span class="ident" id="5694813">WriteString</span><span class="op" id="5694824">(</span><span class="string" id="5694825">&#34;--&gt;&#34;</span><span class="op" id="5694830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694835">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694847">case</span>&nbsp;<span class="ident" id="5694852">fInnerXml</span><span class="op" id="5694861">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694866">iface</span>&nbsp;<span class="op" id="5694872">:=</span>&nbsp;<span class="ident" id="5694875">vf</span><span class="op" id="5694877">.</span><span class="ident" id="5694878">Interface</span><span class="op" id="5694887">(</span><span class="op" id="5694888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694893">switch</span>&nbsp;<span class="ident" id="5694900">raw</span>&nbsp;<span class="op" id="5694904">:=</span>&nbsp;<span class="ident" id="5694907">iface</span><span class="op" id="5694912">.</span><span class="op" id="5694913">(</span><span class="keyword" id="5694914">type</span><span class="op" id="5694918">)</span>&nbsp;<span class="op" id="5694920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694925">case</span>&nbsp;<span class="op" id="5694930">[</span><span class="op" id="5694931">]</span><span class="builtintype" id="5694932">byte</span><span class="op" id="5694936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694942">p</span><span class="op" id="5694943">.</span><span class="ident" id="5694944">Write</span><span class="op" id="5694949">(</span><span class="ident" id="5694950">raw</span><span class="op" id="5694953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694959">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694971">case</span>&nbsp;<span class="builtintype" id="5694976">string</span><span class="op" id="5694982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694988">p</span><span class="op" id="5694989">.</span><span class="ident" id="5694990">WriteString</span><span class="op" id="5695001">(</span><span class="ident" id="5695002">raw</span><span class="op" id="5695005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695011">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695028">case</span>&nbsp;<span class="ident" id="5695033">fElement</span><span class="op" id="5695041">,</span>&nbsp;<span class="ident" id="5695043">fElement</span>&nbsp;<span class="op" id="5695052">|</span>&nbsp;<span class="ident" id="5695054">fAny</span><span class="op" id="5695058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695063">if</span>&nbsp;<span class="ident" id="5695066">err</span>&nbsp;<span class="op" id="5695070">:=</span>&nbsp;<span class="ident" id="5695073">s</span><span class="op" id="5695074">.</span><span class="ident" id="5695075">trim</span><span class="op" id="5695079">(</span><span class="ident" id="5695080">finfo</span><span class="op" id="5695085">.</span><span class="ident" id="5695086">parents</span><span class="op" id="5695093">)</span><span class="op" id="5695094">;</span>&nbsp;<span class="ident" id="5695096">err</span>&nbsp;<span class="op" id="5695100">!=</span>&nbsp;<span class="ident" id="5695103">nil</span>&nbsp;<span class="op" id="5695107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695113">return</span>&nbsp;<span class="ident" id="5695120">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695132">if</span>&nbsp;<span class="builtinfunc" id="5695135">len</span><span class="op" id="5695138">(</span><span class="ident" id="5695139">finfo</span><span class="op" id="5695144">.</span><span class="ident" id="5695145">parents</span><span class="op" id="5695152">)</span>&nbsp;<span class="op" id="5695154">&gt;</span>&nbsp;<span class="builtinfunc" id="5695156">len</span><span class="op" id="5695159">(</span><span class="ident" id="5695160">s</span><span class="op" id="5695161">.</span><span class="ident" id="5695162">stack</span><span class="op" id="5695167">)</span>&nbsp;<span class="op" id="5695169">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695175">if</span>&nbsp;<span class="ident" id="5695178">vf</span><span class="op" id="5695180">.</span><span class="ident" id="5695181">Kind</span><span class="op" id="5695185">(</span><span class="op" id="5695186">)</span>&nbsp;<span class="op" id="5695188">!=</span>&nbsp;<span class="ident" id="5695191">reflect</span><span class="op" id="5695198">.</span><span class="ident" id="5695199">Ptr</span>&nbsp;<span class="op" id="5695203">&amp;&amp;</span>&nbsp;<span class="ident" id="5695206">vf</span><span class="op" id="5695208">.</span><span class="ident" id="5695209">Kind</span><span class="op" id="5695213">(</span><span class="op" id="5695214">)</span>&nbsp;<span class="op" id="5695216">!=</span>&nbsp;<span class="ident" id="5695219">reflect</span><span class="op" id="5695226">.</span><span class="ident" id="5695227">Interface</span>&nbsp;<span class="op" id="5695237">||</span>&nbsp;<span class="op" id="5695240">!</span><span class="ident" id="5695241">vf</span><span class="op" id="5695243">.</span><span class="ident" id="5695244">IsNil</span><span class="op" id="5695249">(</span><span class="op" id="5695250">)</span>&nbsp;<span class="op" id="5695252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695259">if</span>&nbsp;<span class="ident" id="5695262">err</span>&nbsp;<span class="op" id="5695266">:=</span>&nbsp;<span class="ident" id="5695269">s</span><span class="op" id="5695270">.</span><span class="ident" id="5695271">push</span><span class="op" id="5695275">(</span><span class="ident" id="5695276">finfo</span><span class="op" id="5695281">.</span><span class="ident" id="5695282">parents</span><span class="op" id="5695289">[</span><span class="builtinfunc" id="5695290">len</span><span class="op" id="5695293">(</span><span class="ident" id="5695294">s</span><span class="op" id="5695295">.</span><span class="ident" id="5695296">stack</span><span class="op" id="5695301">)</span><span class="op" id="5695302">:</span><span class="op" id="5695303">]</span><span class="op" id="5695304">)</span><span class="op" id="5695305">;</span>&nbsp;<span class="ident" id="5695307">err</span>&nbsp;<span class="op" id="5695311">!=</span>&nbsp;<span class="ident" id="5695314">nil</span>&nbsp;<span class="op" id="5695318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695326">return</span>&nbsp;<span class="ident" id="5695333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695348">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695361">if</span>&nbsp;<span class="ident" id="5695364">err</span>&nbsp;<span class="op" id="5695368">:=</span>&nbsp;<span class="ident" id="5695371">p</span><span class="op" id="5695372">.</span><span class="ident" id="5695373">marshalValue</span><span class="op" id="5695385">(</span><span class="ident" id="5695386">vf</span><span class="op" id="5695388">,</span>&nbsp;<span class="ident" id="5695390">finfo</span><span class="op" id="5695395">,</span>&nbsp;<span class="ident" id="5695397">nil</span><span class="op" id="5695400">)</span><span class="op" id="5695401">;</span>&nbsp;<span class="ident" id="5695403">err</span>&nbsp;<span class="op" id="5695407">!=</span>&nbsp;<span class="ident" id="5695410">nil</span>&nbsp;<span class="op" id="5695414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695419">return</span>&nbsp;<span class="ident" id="5695426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695432">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695438">s</span><span class="op" id="5695439">.</span><span class="ident" id="5695440">trim</span><span class="op" id="5695444">(</span><span class="ident" id="5695445">nil</span><span class="op" id="5695448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695451">return</span>&nbsp;<span class="ident" id="5695458">p</span><span class="op" id="5695459">.</span><span class="ident" id="5695460">cachedWriteError</span><span class="op" id="5695476">(</span><span class="op" id="5695477">)</span><br>
<span class="lineno"></span><span class="op" id="5695479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5695482">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="5695530">func</span>&nbsp;<span class="op" id="5695535">(</span><span class="ident" id="5695536">p</span>&nbsp;<span class="op" id="5695538">*</span><span class="ident" id="5695539">printer</span><span class="op" id="5695546">)</span>&nbsp;<span class="ident" id="5695548">cachedWriteError</span><span class="op" id="5695564">(</span><span class="op" id="5695565">)</span>&nbsp;<span class="builtintype" id="5695567">error</span>&nbsp;<span class="op" id="5695573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695576">_</span><span class="op" id="5695577">,</span>&nbsp;<span class="ident" id="5695579">err</span>&nbsp;<span class="op" id="5695583">:=</span>&nbsp;<span class="ident" id="5695586">p</span><span class="op" id="5695587">.</span><span class="ident" id="5695588">Write</span><span class="op" id="5695593">(</span><span class="ident" id="5695594">nil</span><span class="op" id="5695597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695600">return</span>&nbsp;<span class="ident" id="5695607">err</span><br>
<span class="lineno"></span><span class="op" id="5695611">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5695614">func</span>&nbsp;<span class="op" id="5695619">(</span><span class="ident" id="5695620">p</span>&nbsp;<span class="op" id="5695622">*</span><span class="ident" id="5695623">printer</span><span class="op" id="5695630">)</span>&nbsp;<span class="ident" id="5695632">writeIndent</span><span class="op" id="5695643">(</span><span class="ident" id="5695644">depthDelta</span>&nbsp;<span class="builtintype" id="5695655">int</span><span class="op" id="5695658">)</span>&nbsp;<span class="op" id="5695660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695663">if</span>&nbsp;<span class="builtinfunc" id="5695666">len</span><span class="op" id="5695669">(</span><span class="ident" id="5695670">p</span><span class="op" id="5695671">.</span><span class="ident" id="5695672">prefix</span><span class="op" id="5695678">)</span>&nbsp;<span class="op" id="5695680">==</span>&nbsp;<span class="num" id="5695683">0</span>&nbsp;<span class="op" id="5695685">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5695688">len</span><span class="op" id="5695691">(</span><span class="ident" id="5695692">p</span><span class="op" id="5695693">.</span><span class="ident" id="5695694">indent</span><span class="op" id="5695700">)</span>&nbsp;<span class="op" id="5695702">==</span>&nbsp;<span class="num" id="5695705">0</span>&nbsp;<span class="op" id="5695707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695719">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695722">if</span>&nbsp;<span class="ident" id="5695725">depthDelta</span>&nbsp;<span class="op" id="5695736">&lt;</span>&nbsp;<span class="num" id="5695738">0</span>&nbsp;<span class="op" id="5695740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695744">p</span><span class="op" id="5695745">.</span><span class="ident" id="5695746">depth</span><span class="op" id="5695751">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695756">if</span>&nbsp;<span class="ident" id="5695759">p</span><span class="op" id="5695760">.</span><span class="ident" id="5695761">indentedIn</span>&nbsp;<span class="op" id="5695772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695777">p</span><span class="op" id="5695778">.</span><span class="ident" id="5695779">indentedIn</span>&nbsp;<span class="op" id="5695790">=</span>&nbsp;<span class="builtintype" id="5695792">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695801">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695814">p</span><span class="op" id="5695815">.</span><span class="ident" id="5695816">indentedIn</span>&nbsp;<span class="op" id="5695827">=</span>&nbsp;<span class="builtintype" id="5695829">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695839">if</span>&nbsp;<span class="ident" id="5695842">p</span><span class="op" id="5695843">.</span><span class="ident" id="5695844">putNewline</span>&nbsp;<span class="op" id="5695855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695859">p</span><span class="op" id="5695860">.</span><span class="ident" id="5695861">WriteByte</span><span class="op" id="5695870">(</span><span class="string" id="5695871">&#39;\n&#39;</span><span class="op" id="5695875">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695878">}</span>&nbsp;<span class="keyword" id="5695880">else</span>&nbsp;<span class="op" id="5695885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695889">p</span><span class="op" id="5695890">.</span><span class="ident" id="5695891">putNewline</span>&nbsp;<span class="op" id="5695902">=</span>&nbsp;<span class="builtintype" id="5695904">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695913">if</span>&nbsp;<span class="builtinfunc" id="5695916">len</span><span class="op" id="5695919">(</span><span class="ident" id="5695920">p</span><span class="op" id="5695921">.</span><span class="ident" id="5695922">prefix</span><span class="op" id="5695928">)</span>&nbsp;<span class="op" id="5695930">&gt;</span>&nbsp;<span class="num" id="5695932">0</span>&nbsp;<span class="op" id="5695934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695938">p</span><span class="op" id="5695939">.</span><span class="ident" id="5695940">WriteString</span><span class="op" id="5695951">(</span><span class="ident" id="5695952">p</span><span class="op" id="5695953">.</span><span class="ident" id="5695954">prefix</span><span class="op" id="5695960">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695966">if</span>&nbsp;<span class="builtinfunc" id="5695969">len</span><span class="op" id="5695972">(</span><span class="ident" id="5695973">p</span><span class="op" id="5695974">.</span><span class="ident" id="5695975">indent</span><span class="op" id="5695981">)</span>&nbsp;<span class="op" id="5695983">&gt;</span>&nbsp;<span class="num" id="5695985">0</span>&nbsp;<span class="op" id="5695987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695991">for</span>&nbsp;<span class="ident" id="5695995">i</span>&nbsp;<span class="op" id="5695997">:=</span>&nbsp;<span class="num" id="5696000">0</span><span class="op" id="5696001">;</span>&nbsp;<span class="ident" id="5696003">i</span>&nbsp;<span class="op" id="5696005">&lt;</span>&nbsp;<span class="ident" id="5696007">p</span><span class="op" id="5696008">.</span><span class="ident" id="5696009">depth</span><span class="op" id="5696014">;</span>&nbsp;<span class="ident" id="5696016">i</span><span class="op" id="5696017">++</span>&nbsp;<span class="op" id="5696020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696025">p</span><span class="op" id="5696026">.</span><span class="ident" id="5696027">WriteString</span><span class="op" id="5696038">(</span><span class="ident" id="5696039">p</span><span class="op" id="5696040">.</span><span class="ident" id="5696041">indent</span><span class="op" id="5696047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696051">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696057">if</span>&nbsp;<span class="ident" id="5696060">depthDelta</span>&nbsp;<span class="op" id="5696071">&gt;</span>&nbsp;<span class="num" id="5696073">0</span>&nbsp;<span class="op" id="5696075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696079">p</span><span class="op" id="5696080">.</span><span class="ident" id="5696081">depth</span><span class="op" id="5696086">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696091">p</span><span class="op" id="5696092">.</span><span class="ident" id="5696093">indentedIn</span>&nbsp;<span class="op" id="5696104">=</span>&nbsp;<span class="builtintype" id="5696106">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696112">}</span><br>
<span class="lineno">875</span><span class="op" id="5696114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5696117">type</span>&nbsp;<span class="ident" id="5696122">parentStack</span>&nbsp;<span class="keyword" id="5696134">struct</span>&nbsp;<span class="op" id="5696141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696144">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5696150">*</span><span class="ident" id="5696151">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696160">stack</span>&nbsp;<span class="op" id="5696166">[</span><span class="op" id="5696167">]</span><span class="builtintype" id="5696168">string</span><br>
<span class="lineno">880</span><span class="op" id="5696175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5696178">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5696258">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="5696332">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="5696401">func</span>&nbsp;<span class="op" id="5696406">(</span><span class="ident" id="5696407">s</span>&nbsp;<span class="op" id="5696409">*</span><span class="ident" id="5696410">parentStack</span><span class="op" id="5696421">)</span>&nbsp;<span class="ident" id="5696423">trim</span><span class="op" id="5696427">(</span><span class="ident" id="5696428">parents</span>&nbsp;<span class="op" id="5696436">[</span><span class="op" id="5696437">]</span><span class="builtintype" id="5696438">string</span><span class="op" id="5696444">)</span>&nbsp;<span class="builtintype" id="5696446">error</span>&nbsp;<span class="op" id="5696452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696455">split</span>&nbsp;<span class="op" id="5696461">:=</span>&nbsp;<span class="num" id="5696464">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696467">for</span>&nbsp;<span class="op" id="5696471">;</span>&nbsp;<span class="ident" id="5696473">split</span>&nbsp;<span class="op" id="5696479">&lt;</span>&nbsp;<span class="builtinfunc" id="5696481">len</span><span class="op" id="5696484">(</span><span class="ident" id="5696485">parents</span><span class="op" id="5696492">)</span>&nbsp;<span class="op" id="5696494">&amp;&amp;</span>&nbsp;<span class="ident" id="5696497">split</span>&nbsp;<span class="op" id="5696503">&lt;</span>&nbsp;<span class="builtinfunc" id="5696505">len</span><span class="op" id="5696508">(</span><span class="ident" id="5696509">s</span><span class="op" id="5696510">.</span><span class="ident" id="5696511">stack</span><span class="op" id="5696516">)</span><span class="op" id="5696517">;</span>&nbsp;<span class="ident" id="5696519">split</span><span class="op" id="5696524">++</span>&nbsp;<span class="op" id="5696527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696531">if</span>&nbsp;<span class="ident" id="5696534">parents</span><span class="op" id="5696541">[</span><span class="ident" id="5696542">split</span><span class="op" id="5696547">]</span>&nbsp;<span class="op" id="5696549">!=</span>&nbsp;<span class="ident" id="5696552">s</span><span class="op" id="5696553">.</span><span class="ident" id="5696554">stack</span><span class="op" id="5696559">[</span><span class="ident" id="5696560">split</span><span class="op" id="5696565">]</span>&nbsp;<span class="op" id="5696567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696572">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696586">for</span>&nbsp;<span class="ident" id="5696590">i</span>&nbsp;<span class="op" id="5696592">:=</span>&nbsp;<span class="builtinfunc" id="5696595">len</span><span class="op" id="5696598">(</span><span class="ident" id="5696599">s</span><span class="op" id="5696600">.</span><span class="ident" id="5696601">stack</span><span class="op" id="5696606">)</span>&nbsp;<span class="op" id="5696608">-</span>&nbsp;<span class="num" id="5696610">1</span><span class="op" id="5696611">;</span>&nbsp;<span class="ident" id="5696613">i</span>&nbsp;<span class="op" id="5696615">&gt;=</span>&nbsp;<span class="ident" id="5696618">split</span><span class="op" id="5696623">;</span>&nbsp;<span class="ident" id="5696625">i</span><span class="op" id="5696626">--</span>&nbsp;<span class="op" id="5696629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696633">if</span>&nbsp;<span class="ident" id="5696636">err</span>&nbsp;<span class="op" id="5696640">:=</span>&nbsp;<span class="ident" id="5696643">s</span><span class="op" id="5696644">.</span><span class="ident" id="5696645">p</span><span class="op" id="5696646">.</span><span class="ident" id="5696647">writeEnd</span><span class="op" id="5696655">(</span><span class="ident" id="5696656">Name</span><span class="op" id="5696660">{</span><span class="ident" id="5696661">Local</span><span class="op" id="5696666">:</span>&nbsp;<span class="ident" id="5696668">s</span><span class="op" id="5696669">.</span><span class="ident" id="5696670">stack</span><span class="op" id="5696675">[</span><span class="ident" id="5696676">i</span><span class="op" id="5696677">]</span><span class="op" id="5696678">}</span><span class="op" id="5696679">)</span><span class="op" id="5696680">;</span>&nbsp;<span class="ident" id="5696682">err</span>&nbsp;<span class="op" id="5696686">!=</span>&nbsp;<span class="ident" id="5696689">nil</span>&nbsp;<span class="op" id="5696693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696698">return</span>&nbsp;<span class="ident" id="5696705">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696717">s</span><span class="op" id="5696718">.</span><span class="ident" id="5696719">stack</span>&nbsp;<span class="op" id="5696725">=</span>&nbsp;<span class="ident" id="5696727">parents</span><span class="op" id="5696734">[</span><span class="op" id="5696735">:</span><span class="ident" id="5696736">split</span><span class="op" id="5696741">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696744">return</span>&nbsp;<span class="ident" id="5696751">nil</span><br>
<span class="lineno"></span><span class="op" id="5696755">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="5696758">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="5696822">func</span>&nbsp;<span class="op" id="5696827">(</span><span class="ident" id="5696828">s</span>&nbsp;<span class="op" id="5696830">*</span><span class="ident" id="5696831">parentStack</span><span class="op" id="5696842">)</span>&nbsp;<span class="ident" id="5696844">push</span><span class="op" id="5696848">(</span><span class="ident" id="5696849">parents</span>&nbsp;<span class="op" id="5696857">[</span><span class="op" id="5696858">]</span><span class="builtintype" id="5696859">string</span><span class="op" id="5696865">)</span>&nbsp;<span class="builtintype" id="5696867">error</span>&nbsp;<span class="op" id="5696873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696876">for</span>&nbsp;<span class="ident" id="5696880">i</span>&nbsp;<span class="op" id="5696882">:=</span>&nbsp;<span class="num" id="5696885">0</span><span class="op" id="5696886">;</span>&nbsp;<span class="ident" id="5696888">i</span>&nbsp;<span class="op" id="5696890">&lt;</span>&nbsp;<span class="builtinfunc" id="5696892">len</span><span class="op" id="5696895">(</span><span class="ident" id="5696896">parents</span><span class="op" id="5696903">)</span><span class="op" id="5696904">;</span>&nbsp;<span class="ident" id="5696906">i</span><span class="op" id="5696907">++</span>&nbsp;<span class="op" id="5696910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696914">if</span>&nbsp;<span class="ident" id="5696917">err</span>&nbsp;<span class="op" id="5696921">:=</span>&nbsp;<span class="ident" id="5696924">s</span><span class="op" id="5696925">.</span><span class="ident" id="5696926">p</span><span class="op" id="5696927">.</span><span class="ident" id="5696928">writeStart</span><span class="op" id="5696938">(</span><span class="op" id="5696939">&amp;</span><span class="ident" id="5696940">StartElement</span><span class="op" id="5696952">{</span><span class="ident" id="5696953">Name</span><span class="op" id="5696957">:</span>&nbsp;<span class="ident" id="5696959">Name</span><span class="op" id="5696963">{</span><span class="ident" id="5696964">Local</span><span class="op" id="5696969">:</span>&nbsp;<span class="ident" id="5696971">parents</span><span class="op" id="5696978">[</span><span class="ident" id="5696979">i</span><span class="op" id="5696980">]</span><span class="op" id="5696981">}</span><span class="op" id="5696982">}</span><span class="op" id="5696983">)</span><span class="op" id="5696984">;</span>&nbsp;<span class="ident" id="5696986">err</span>&nbsp;<span class="op" id="5696990">!=</span>&nbsp;<span class="ident" id="5696993">nil</span>&nbsp;<span class="op" id="5696997">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697002">return</span>&nbsp;<span class="ident" id="5697009">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697021">s</span><span class="op" id="5697022">.</span><span class="ident" id="5697023">stack</span>&nbsp;<span class="op" id="5697029">=</span>&nbsp;<span class="builtinfunc" id="5697031">append</span><span class="op" id="5697037">(</span><span class="ident" id="5697038">s</span><span class="op" id="5697039">.</span><span class="ident" id="5697040">stack</span><span class="op" id="5697045">,</span>&nbsp;<span class="ident" id="5697047">parents</span><span class="op" id="5697054">...</span><span class="op" id="5697057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697060">return</span>&nbsp;<span class="ident" id="5697067">nil</span><br>
<span class="lineno">910</span><span class="op" id="5697071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5697074">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5697138">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="5697176">type</span>&nbsp;<span class="ident" id="5697181">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="5697202">struct</span>&nbsp;<span class="op" id="5697209">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697212">Type</span>&nbsp;<span class="ident" id="5697217">reflect</span><span class="op" id="5697224">.</span><span class="ident" id="5697225">Type</span><br>
<span class="lineno"></span><span class="op" id="5697230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5697233">func</span>&nbsp;<span class="op" id="5697238">(</span><span class="ident" id="5697239">e</span>&nbsp;<span class="op" id="5697241">*</span><span class="ident" id="5697242">UnsupportedTypeError</span><span class="op" id="5697262">)</span>&nbsp;<span class="ident" id="5697264">Error</span><span class="op" id="5697269">(</span><span class="op" id="5697270">)</span>&nbsp;<span class="builtintype" id="5697272">string</span>&nbsp;<span class="op" id="5697279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697282">return</span>&nbsp;<span class="string" id="5697289">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5697315">+</span>&nbsp;<span class="ident" id="5697317">e</span><span class="op" id="5697318">.</span><span class="ident" id="5697319">Type</span><span class="op" id="5697323">.</span><span class="ident" id="5697324">String</span><span class="op" id="5697330">(</span><span class="op" id="5697331">)</span><br>
<span class="lineno">920</span><span class="op" id="5697333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5697336">func</span>&nbsp;<span class="ident" id="5697341">isEmptyValue</span><span class="op" id="5697353">(</span><span class="ident" id="5697354">v</span>&nbsp;<span class="ident" id="5697356">reflect</span><span class="op" id="5697363">.</span><span class="ident" id="5697364">Value</span><span class="op" id="5697369">)</span>&nbsp;<span class="builtintype" id="5697371">bool</span>&nbsp;<span class="op" id="5697376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697379">switch</span>&nbsp;<span class="ident" id="5697386">v</span><span class="op" id="5697387">.</span><span class="ident" id="5697388">Kind</span><span class="op" id="5697392">(</span><span class="op" id="5697393">)</span>&nbsp;<span class="op" id="5697395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697398">case</span>&nbsp;<span class="ident" id="5697403">reflect</span><span class="op" id="5697410">.</span><span class="ident" id="5697411">Array</span><span class="op" id="5697416">,</span>&nbsp;<span class="ident" id="5697418">reflect</span><span class="op" id="5697425">.</span><span class="ident" id="5697426">Map</span><span class="op" id="5697429">,</span>&nbsp;<span class="ident" id="5697431">reflect</span><span class="op" id="5697438">.</span><span class="ident" id="5697439">Slice</span><span class="op" id="5697444">,</span>&nbsp;<span class="ident" id="5697446">reflect</span><span class="op" id="5697453">.</span><span class="ident" id="5697454">String</span><span class="op" id="5697460">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697464">return</span>&nbsp;<span class="ident" id="5697471">v</span><span class="op" id="5697472">.</span><span class="ident" id="5697473">Len</span><span class="op" id="5697476">(</span><span class="op" id="5697477">)</span>&nbsp;<span class="op" id="5697479">==</span>&nbsp;<span class="num" id="5697482">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697485">case</span>&nbsp;<span class="ident" id="5697490">reflect</span><span class="op" id="5697497">.</span><span class="ident" id="5697498">Bool</span><span class="op" id="5697502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697506">return</span>&nbsp;<span class="op" id="5697513">!</span><span class="ident" id="5697514">v</span><span class="op" id="5697515">.</span><span class="ident" id="5697516">Bool</span><span class="op" id="5697520">(</span><span class="op" id="5697521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697524">case</span>&nbsp;<span class="ident" id="5697529">reflect</span><span class="op" id="5697536">.</span><span class="ident" id="5697537">Int</span><span class="op" id="5697540">,</span>&nbsp;<span class="ident" id="5697542">reflect</span><span class="op" id="5697549">.</span><span class="ident" id="5697550">Int8</span><span class="op" id="5697554">,</span>&nbsp;<span class="ident" id="5697556">reflect</span><span class="op" id="5697563">.</span><span class="ident" id="5697564">Int16</span><span class="op" id="5697569">,</span>&nbsp;<span class="ident" id="5697571">reflect</span><span class="op" id="5697578">.</span><span class="ident" id="5697579">Int32</span><span class="op" id="5697584">,</span>&nbsp;<span class="ident" id="5697586">reflect</span><span class="op" id="5697593">.</span><span class="ident" id="5697594">Int64</span><span class="op" id="5697599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697603">return</span>&nbsp;<span class="ident" id="5697610">v</span><span class="op" id="5697611">.</span><span class="ident" id="5697612">Int</span><span class="op" id="5697615">(</span><span class="op" id="5697616">)</span>&nbsp;<span class="op" id="5697618">==</span>&nbsp;<span class="num" id="5697621">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697624">case</span>&nbsp;<span class="ident" id="5697629">reflect</span><span class="op" id="5697636">.</span><span class="ident" id="5697637">Uint</span><span class="op" id="5697641">,</span>&nbsp;<span class="ident" id="5697643">reflect</span><span class="op" id="5697650">.</span><span class="ident" id="5697651">Uint8</span><span class="op" id="5697656">,</span>&nbsp;<span class="ident" id="5697658">reflect</span><span class="op" id="5697665">.</span><span class="ident" id="5697666">Uint16</span><span class="op" id="5697672">,</span>&nbsp;<span class="ident" id="5697674">reflect</span><span class="op" id="5697681">.</span><span class="ident" id="5697682">Uint32</span><span class="op" id="5697688">,</span>&nbsp;<span class="ident" id="5697690">reflect</span><span class="op" id="5697697">.</span><span class="ident" id="5697698">Uint64</span><span class="op" id="5697704">,</span>&nbsp;<span class="ident" id="5697706">reflect</span><span class="op" id="5697713">.</span><span class="ident" id="5697714">Uintptr</span><span class="op" id="5697721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697725">return</span>&nbsp;<span class="ident" id="5697732">v</span><span class="op" id="5697733">.</span><span class="ident" id="5697734">Uint</span><span class="op" id="5697738">(</span><span class="op" id="5697739">)</span>&nbsp;<span class="op" id="5697741">==</span>&nbsp;<span class="num" id="5697744">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697747">case</span>&nbsp;<span class="ident" id="5697752">reflect</span><span class="op" id="5697759">.</span><span class="ident" id="5697760">Float32</span><span class="op" id="5697767">,</span>&nbsp;<span class="ident" id="5697769">reflect</span><span class="op" id="5697776">.</span><span class="ident" id="5697777">Float64</span><span class="op" id="5697784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697788">return</span>&nbsp;<span class="ident" id="5697795">v</span><span class="op" id="5697796">.</span><span class="ident" id="5697797">Float</span><span class="op" id="5697802">(</span><span class="op" id="5697803">)</span>&nbsp;<span class="op" id="5697805">==</span>&nbsp;<span class="num" id="5697808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697811">case</span>&nbsp;<span class="ident" id="5697816">reflect</span><span class="op" id="5697823">.</span><span class="ident" id="5697824">Interface</span><span class="op" id="5697833">,</span>&nbsp;<span class="ident" id="5697835">reflect</span><span class="op" id="5697842">.</span><span class="ident" id="5697843">Ptr</span><span class="op" id="5697846">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697850">return</span>&nbsp;<span class="ident" id="5697857">v</span><span class="op" id="5697858">.</span><span class="ident" id="5697859">IsNil</span><span class="op" id="5697864">(</span><span class="op" id="5697865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697871">return</span>&nbsp;<span class="builtintype" id="5697878">false</span><br>
<span class="lineno"></span><span class="op" id="5697884">}</span>
</div>
</body>
</html>
