<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5843877">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5843932">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5843986">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5844037">package</span>&nbsp;<span class="ident" id="5844045">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5844051">import</span>&nbsp;<span class="op" id="5844058">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844061">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844079">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844086">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844094">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844110">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5844115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5844118">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5844198">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5844264">const</span>&nbsp;<span class="op" id="5844270">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844273">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844292">=</span>&nbsp;<span class="ident" id="5844294">flate</span><span class="op" id="5844299">.</span><span class="ident" id="5844300">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844315">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844334">=</span>&nbsp;<span class="ident" id="5844336">flate</span><span class="op" id="5844341">.</span><span class="ident" id="5844342">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844353">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844372">=</span>&nbsp;<span class="ident" id="5844374">flate</span><span class="op" id="5844379">.</span><span class="ident" id="5844380">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844397">DefaultCompression</span>&nbsp;<span class="op" id="5844416">=</span>&nbsp;<span class="ident" id="5844418">flate</span><span class="op" id="5844423">.</span><span class="ident" id="5844424">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5844443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844446">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5844509">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5844571">type</span>&nbsp;<span class="ident" id="5844576">Writer</span>&nbsp;<span class="keyword" id="5844583">struct</span>&nbsp;<span class="op" id="5844590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844593">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844605">io</span><span class="op" id="5844607">.</span><span class="ident" id="5844608">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844616">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5844628">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844633">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844645">[</span><span class="op" id="5844646">]</span><span class="builtintype" id="5844647">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844653">compressor</span>&nbsp;&nbsp;<span class="op" id="5844665">*</span><span class="ident" id="5844666">flate</span><span class="op" id="5844671">.</span><span class="ident" id="5844672">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844680">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844692">hash</span><span class="op" id="5844696">.</span><span class="ident" id="5844697">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844705">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5844717">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844724">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844736">[</span><span class="num" id="5844737">4</span><span class="op" id="5844738">]</span><span class="builtintype" id="5844739">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844745">wroteHeader</span>&nbsp;<span class="builtintype" id="5844757">bool</span><br>
<span class="lineno">35</span><span class="op" id="5844762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844765">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5844800">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5844866">//</span><br>
<span class="lineno">40</span><span class="comment" id="5844869">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5844950">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5845005">func</span>&nbsp;<span class="ident" id="5845010">NewWriter</span><span class="op" id="5845019">(</span><span class="ident" id="5845020">w</span>&nbsp;<span class="ident" id="5845022">io</span><span class="op" id="5845024">.</span><span class="ident" id="5845025">Writer</span><span class="op" id="5845031">)</span>&nbsp;<span class="op" id="5845033">*</span><span class="ident" id="5845034">Writer</span>&nbsp;<span class="op" id="5845041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845044">z</span><span class="op" id="5845045">,</span>&nbsp;<span class="ident" id="5845047">_</span>&nbsp;<span class="op" id="5845049">:=</span>&nbsp;<span class="ident" id="5845052">NewWriterLevelDict</span><span class="op" id="5845070">(</span><span class="ident" id="5845071">w</span><span class="op" id="5845072">,</span>&nbsp;<span class="ident" id="5845074">DefaultCompression</span><span class="op" id="5845092">,</span>&nbsp;<span class="ident" id="5845094">nil</span><span class="op" id="5845097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845100">return</span>&nbsp;<span class="ident" id="5845107">z</span><br>
<span class="lineno">45</span><span class="op" id="5845109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5845112">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5845192">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5845227">//</span><br>
<span class="lineno">50</span><span class="comment" id="5845230">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5845304">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5845380">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5845427">func</span>&nbsp;<span class="ident" id="5845432">NewWriterLevel</span><span class="op" id="5845446">(</span><span class="ident" id="5845447">w</span>&nbsp;<span class="ident" id="5845449">io</span><span class="op" id="5845451">.</span><span class="ident" id="5845452">Writer</span><span class="op" id="5845458">,</span>&nbsp;<span class="ident" id="5845460">level</span>&nbsp;<span class="builtintype" id="5845466">int</span><span class="op" id="5845469">)</span>&nbsp;<span class="op" id="5845471">(</span><span class="op" id="5845472">*</span><span class="ident" id="5845473">Writer</span><span class="op" id="5845479">,</span>&nbsp;<span class="builtintype" id="5845481">error</span><span class="op" id="5845486">)</span>&nbsp;<span class="op" id="5845488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845491">return</span>&nbsp;<span class="ident" id="5845498">NewWriterLevelDict</span><span class="op" id="5845516">(</span><span class="ident" id="5845517">w</span><span class="op" id="5845518">,</span>&nbsp;<span class="ident" id="5845520">level</span><span class="op" id="5845525">,</span>&nbsp;<span class="ident" id="5845527">nil</span><span class="op" id="5845530">)</span><br>
<span class="lineno">55</span><span class="op" id="5845532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5845535">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5845610">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5845628">//</span><br>
<span class="lineno">60</span><span class="comment" id="5845631">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5845711">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5845736">func</span>&nbsp;<span class="ident" id="5845741">NewWriterLevelDict</span><span class="op" id="5845759">(</span><span class="ident" id="5845760">w</span>&nbsp;<span class="ident" id="5845762">io</span><span class="op" id="5845764">.</span><span class="ident" id="5845765">Writer</span><span class="op" id="5845771">,</span>&nbsp;<span class="ident" id="5845773">level</span>&nbsp;<span class="builtintype" id="5845779">int</span><span class="op" id="5845782">,</span>&nbsp;<span class="ident" id="5845784">dict</span>&nbsp;<span class="op" id="5845789">[</span><span class="op" id="5845790">]</span><span class="builtintype" id="5845791">byte</span><span class="op" id="5845795">)</span>&nbsp;<span class="op" id="5845797">(</span><span class="op" id="5845798">*</span><span class="ident" id="5845799">Writer</span><span class="op" id="5845805">,</span>&nbsp;<span class="builtintype" id="5845807">error</span><span class="op" id="5845812">)</span>&nbsp;<span class="op" id="5845814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845817">if</span>&nbsp;<span class="ident" id="5845820">level</span>&nbsp;<span class="op" id="5845826">&lt;</span>&nbsp;<span class="ident" id="5845828">DefaultCompression</span>&nbsp;<span class="op" id="5845847">||</span>&nbsp;<span class="ident" id="5845850">level</span>&nbsp;<span class="op" id="5845856">&gt;</span>&nbsp;<span class="ident" id="5845858">BestCompression</span>&nbsp;<span class="op" id="5845874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845878">return</span>&nbsp;<span class="ident" id="5845885">nil</span><span class="op" id="5845888">,</span>&nbsp;<span class="ident" id="5845890">fmt</span><span class="op" id="5845893">.</span><span class="ident" id="5845894">Errorf</span><span class="op" id="5845900">(</span><span class="string" id="5845901">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5845938">,</span>&nbsp;<span class="ident" id="5845940">level</span><span class="op" id="5845945">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5845948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845951">return</span>&nbsp;<span class="op" id="5845958">&amp;</span><span class="ident" id="5845959">Writer</span><span class="op" id="5845965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845969">w</span><span class="op" id="5845970">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5845976">w</span><span class="op" id="5845977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845981">level</span><span class="op" id="5845986">:</span>&nbsp;<span class="ident" id="5845988">level</span><span class="op" id="5845993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845997">dict</span><span class="op" id="5846001">:</span>&nbsp;&nbsp;<span class="ident" id="5846004">dict</span><span class="op" id="5846008">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5846011">}</span><span class="op" id="5846012">,</span>&nbsp;<span class="ident" id="5846014">nil</span><br>
<span class="lineno"></span><span class="op" id="5846018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5846021">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5846097">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5846177">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5846186">func</span>&nbsp;<span class="op" id="5846191">(</span><span class="ident" id="5846192">z</span>&nbsp;<span class="op" id="5846194">*</span><span class="ident" id="5846195">Writer</span><span class="op" id="5846201">)</span>&nbsp;<span class="ident" id="5846203">Reset</span><span class="op" id="5846208">(</span><span class="ident" id="5846209">w</span>&nbsp;<span class="ident" id="5846211">io</span><span class="op" id="5846213">.</span><span class="ident" id="5846214">Writer</span><span class="op" id="5846220">)</span>&nbsp;<span class="op" id="5846222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846225">z</span><span class="op" id="5846226">.</span><span class="ident" id="5846227">w</span>&nbsp;<span class="op" id="5846229">=</span>&nbsp;<span class="ident" id="5846231">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846234">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846273">if</span>&nbsp;<span class="ident" id="5846276">z</span><span class="op" id="5846277">.</span><span class="ident" id="5846278">compressor</span>&nbsp;<span class="op" id="5846289">!=</span>&nbsp;<span class="ident" id="5846292">nil</span>&nbsp;<span class="op" id="5846296">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846300">z</span><span class="op" id="5846301">.</span><span class="ident" id="5846302">compressor</span><span class="op" id="5846312">.</span><span class="ident" id="5846313">Reset</span><span class="op" id="5846318">(</span><span class="ident" id="5846319">w</span><span class="op" id="5846320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5846323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846326">if</span>&nbsp;<span class="ident" id="5846329">z</span><span class="op" id="5846330">.</span><span class="ident" id="5846331">digest</span>&nbsp;<span class="op" id="5846338">!=</span>&nbsp;<span class="ident" id="5846341">nil</span>&nbsp;<span class="op" id="5846345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846349">z</span><span class="op" id="5846350">.</span><span class="ident" id="5846351">digest</span><span class="op" id="5846357">.</span><span class="ident" id="5846358">Reset</span><span class="op" id="5846363">(</span><span class="op" id="5846364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5846367">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846370">z</span><span class="op" id="5846371">.</span><span class="ident" id="5846372">err</span>&nbsp;<span class="op" id="5846376">=</span>&nbsp;<span class="ident" id="5846378">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846383">z</span><span class="op" id="5846384">.</span><span class="ident" id="5846385">scratch</span>&nbsp;<span class="op" id="5846393">=</span>&nbsp;<span class="op" id="5846395">[</span><span class="num" id="5846396">4</span><span class="op" id="5846397">]</span><span class="builtintype" id="5846398">byte</span><span class="op" id="5846402">{</span><span class="op" id="5846403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846406">z</span><span class="op" id="5846407">.</span><span class="ident" id="5846408">wroteHeader</span>&nbsp;<span class="op" id="5846420">=</span>&nbsp;<span class="builtintype" id="5846422">false</span><br>
<span class="lineno"></span><span class="op" id="5846428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5846431">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5846470">func</span>&nbsp;<span class="op" id="5846475">(</span><span class="ident" id="5846476">z</span>&nbsp;<span class="op" id="5846478">*</span><span class="ident" id="5846479">Writer</span><span class="op" id="5846485">)</span>&nbsp;<span class="ident" id="5846487">writeHeader</span><span class="op" id="5846498">(</span><span class="op" id="5846499">)</span>&nbsp;<span class="op" id="5846501">(</span><span class="ident" id="5846502">err</span>&nbsp;<span class="builtintype" id="5846506">error</span><span class="op" id="5846511">)</span>&nbsp;<span class="op" id="5846513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846516">z</span><span class="op" id="5846517">.</span><span class="ident" id="5846518">wroteHeader</span>&nbsp;<span class="op" id="5846530">=</span>&nbsp;<span class="builtintype" id="5846532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846538">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846598">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846703">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846782">z</span><span class="op" id="5846783">.</span><span class="ident" id="5846784">scratch</span><span class="op" id="5846791">[</span><span class="num" id="5846792">0</span><span class="op" id="5846793">]</span>&nbsp;<span class="op" id="5846795">=</span>&nbsp;<span class="num" id="5846797">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846803">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846881">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846923">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846981">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847036">switch</span>&nbsp;<span class="ident" id="5847043">z</span><span class="op" id="5847044">.</span><span class="ident" id="5847045">level</span>&nbsp;<span class="op" id="5847051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847054">case</span>&nbsp;<span class="num" id="5847059">0</span><span class="op" id="5847060">,</span>&nbsp;<span class="num" id="5847062">1</span><span class="op" id="5847063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847067">z</span><span class="op" id="5847068">.</span><span class="ident" id="5847069">scratch</span><span class="op" id="5847076">[</span><span class="num" id="5847077">1</span><span class="op" id="5847078">]</span>&nbsp;<span class="op" id="5847080">=</span>&nbsp;<span class="num" id="5847082">0</span>&nbsp;<span class="op" id="5847084">&lt;&lt;</span>&nbsp;<span class="num" id="5847087">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847090">case</span>&nbsp;<span class="num" id="5847095">2</span><span class="op" id="5847096">,</span>&nbsp;<span class="num" id="5847098">3</span><span class="op" id="5847099">,</span>&nbsp;<span class="num" id="5847101">4</span><span class="op" id="5847102">,</span>&nbsp;<span class="num" id="5847104">5</span><span class="op" id="5847105">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847109">z</span><span class="op" id="5847110">.</span><span class="ident" id="5847111">scratch</span><span class="op" id="5847118">[</span><span class="num" id="5847119">1</span><span class="op" id="5847120">]</span>&nbsp;<span class="op" id="5847122">=</span>&nbsp;<span class="num" id="5847124">1</span>&nbsp;<span class="op" id="5847126">&lt;&lt;</span>&nbsp;<span class="num" id="5847129">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847132">case</span>&nbsp;<span class="num" id="5847137">6</span><span class="op" id="5847138">,</span>&nbsp;<span class="op" id="5847140">-</span><span class="num" id="5847141">1</span><span class="op" id="5847142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847146">z</span><span class="op" id="5847147">.</span><span class="ident" id="5847148">scratch</span><span class="op" id="5847155">[</span><span class="num" id="5847156">1</span><span class="op" id="5847157">]</span>&nbsp;<span class="op" id="5847159">=</span>&nbsp;<span class="num" id="5847161">2</span>&nbsp;<span class="op" id="5847163">&lt;&lt;</span>&nbsp;<span class="num" id="5847166">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847169">case</span>&nbsp;<span class="num" id="5847174">7</span><span class="op" id="5847175">,</span>&nbsp;<span class="num" id="5847177">8</span><span class="op" id="5847178">,</span>&nbsp;<span class="num" id="5847180">9</span><span class="op" id="5847181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847185">z</span><span class="op" id="5847186">.</span><span class="ident" id="5847187">scratch</span><span class="op" id="5847194">[</span><span class="num" id="5847195">1</span><span class="op" id="5847196">]</span>&nbsp;<span class="op" id="5847198">=</span>&nbsp;<span class="num" id="5847200">3</span>&nbsp;<span class="op" id="5847202">&lt;&lt;</span>&nbsp;<span class="num" id="5847205">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847208">default</span><span class="op" id="5847215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5847219">panic</span><span class="op" id="5847224">(</span><span class="string" id="5847225">&#34;unreachable&#34;</span><span class="op" id="5847238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847244">if</span>&nbsp;<span class="ident" id="5847247">z</span><span class="op" id="5847248">.</span><span class="ident" id="5847249">dict</span>&nbsp;<span class="op" id="5847254">!=</span>&nbsp;<span class="ident" id="5847257">nil</span>&nbsp;<span class="op" id="5847261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847265">z</span><span class="op" id="5847266">.</span><span class="ident" id="5847267">scratch</span><span class="op" id="5847274">[</span><span class="num" id="5847275">1</span><span class="op" id="5847276">]</span>&nbsp;<span class="op" id="5847278">|=</span>&nbsp;<span class="num" id="5847281">1</span>&nbsp;<span class="op" id="5847283">&lt;&lt;</span>&nbsp;<span class="num" id="5847286">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847292">z</span><span class="op" id="5847293">.</span><span class="ident" id="5847294">scratch</span><span class="op" id="5847301">[</span><span class="num" id="5847302">1</span><span class="op" id="5847303">]</span>&nbsp;<span class="op" id="5847305">+=</span>&nbsp;<span class="builtintype" id="5847308">uint8</span><span class="op" id="5847313">(</span><span class="num" id="5847314">31</span>&nbsp;<span class="op" id="5847317">-</span>&nbsp;<span class="op" id="5847319">(</span><span class="builtintype" id="5847320">uint16</span><span class="op" id="5847326">(</span><span class="ident" id="5847327">z</span><span class="op" id="5847328">.</span><span class="ident" id="5847329">scratch</span><span class="op" id="5847336">[</span><span class="num" id="5847337">0</span><span class="op" id="5847338">]</span><span class="op" id="5847339">)</span><span class="op" id="5847340">&lt;&lt;</span><span class="num" id="5847342">8</span><span class="op" id="5847343">+</span><span class="builtintype" id="5847344">uint16</span><span class="op" id="5847350">(</span><span class="ident" id="5847351">z</span><span class="op" id="5847352">.</span><span class="ident" id="5847353">scratch</span><span class="op" id="5847360">[</span><span class="num" id="5847361">1</span><span class="op" id="5847362">]</span><span class="op" id="5847363">)</span><span class="op" id="5847364">)</span><span class="op" id="5847365">%</span><span class="num" id="5847366">31</span><span class="op" id="5847368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847371">if</span>&nbsp;<span class="ident" id="5847374">_</span><span class="op" id="5847375">,</span>&nbsp;<span class="ident" id="5847377">err</span>&nbsp;<span class="op" id="5847381">=</span>&nbsp;<span class="ident" id="5847383">z</span><span class="op" id="5847384">.</span><span class="ident" id="5847385">w</span><span class="op" id="5847386">.</span><span class="ident" id="5847387">Write</span><span class="op" id="5847392">(</span><span class="ident" id="5847393">z</span><span class="op" id="5847394">.</span><span class="ident" id="5847395">scratch</span><span class="op" id="5847402">[</span><span class="num" id="5847403">0</span><span class="op" id="5847404">:</span><span class="num" id="5847405">2</span><span class="op" id="5847406">]</span><span class="op" id="5847407">)</span><span class="op" id="5847408">;</span>&nbsp;<span class="ident" id="5847410">err</span>&nbsp;<span class="op" id="5847414">!=</span>&nbsp;<span class="ident" id="5847417">nil</span>&nbsp;<span class="op" id="5847421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847425">return</span>&nbsp;<span class="ident" id="5847432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847437">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847440">if</span>&nbsp;<span class="ident" id="5847443">z</span><span class="op" id="5847444">.</span><span class="ident" id="5847445">dict</span>&nbsp;<span class="op" id="5847450">!=</span>&nbsp;<span class="ident" id="5847453">nil</span>&nbsp;<span class="op" id="5847457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5847461">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847531">checksum</span>&nbsp;<span class="op" id="5847540">:=</span>&nbsp;<span class="ident" id="5847543">adler32</span><span class="op" id="5847550">.</span><span class="ident" id="5847551">Checksum</span><span class="op" id="5847559">(</span><span class="ident" id="5847560">z</span><span class="op" id="5847561">.</span><span class="ident" id="5847562">dict</span><span class="op" id="5847566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847570">z</span><span class="op" id="5847571">.</span><span class="ident" id="5847572">scratch</span><span class="op" id="5847579">[</span><span class="num" id="5847580">0</span><span class="op" id="5847581">]</span>&nbsp;<span class="op" id="5847583">=</span>&nbsp;<span class="builtintype" id="5847585">uint8</span><span class="op" id="5847590">(</span><span class="ident" id="5847591">checksum</span>&nbsp;<span class="op" id="5847600">&gt;&gt;</span>&nbsp;<span class="num" id="5847603">24</span><span class="op" id="5847605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847609">z</span><span class="op" id="5847610">.</span><span class="ident" id="5847611">scratch</span><span class="op" id="5847618">[</span><span class="num" id="5847619">1</span><span class="op" id="5847620">]</span>&nbsp;<span class="op" id="5847622">=</span>&nbsp;<span class="builtintype" id="5847624">uint8</span><span class="op" id="5847629">(</span><span class="ident" id="5847630">checksum</span>&nbsp;<span class="op" id="5847639">&gt;&gt;</span>&nbsp;<span class="num" id="5847642">16</span><span class="op" id="5847644">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847648">z</span><span class="op" id="5847649">.</span><span class="ident" id="5847650">scratch</span><span class="op" id="5847657">[</span><span class="num" id="5847658">2</span><span class="op" id="5847659">]</span>&nbsp;<span class="op" id="5847661">=</span>&nbsp;<span class="builtintype" id="5847663">uint8</span><span class="op" id="5847668">(</span><span class="ident" id="5847669">checksum</span>&nbsp;<span class="op" id="5847678">&gt;&gt;</span>&nbsp;<span class="num" id="5847681">8</span><span class="op" id="5847682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847686">z</span><span class="op" id="5847687">.</span><span class="ident" id="5847688">scratch</span><span class="op" id="5847695">[</span><span class="num" id="5847696">3</span><span class="op" id="5847697">]</span>&nbsp;<span class="op" id="5847699">=</span>&nbsp;<span class="builtintype" id="5847701">uint8</span><span class="op" id="5847706">(</span><span class="ident" id="5847707">checksum</span>&nbsp;<span class="op" id="5847716">&gt;&gt;</span>&nbsp;<span class="num" id="5847719">0</span><span class="op" id="5847720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847724">if</span>&nbsp;<span class="ident" id="5847727">_</span><span class="op" id="5847728">,</span>&nbsp;<span class="ident" id="5847730">err</span>&nbsp;<span class="op" id="5847734">=</span>&nbsp;<span class="ident" id="5847736">z</span><span class="op" id="5847737">.</span><span class="ident" id="5847738">w</span><span class="op" id="5847739">.</span><span class="ident" id="5847740">Write</span><span class="op" id="5847745">(</span><span class="ident" id="5847746">z</span><span class="op" id="5847747">.</span><span class="ident" id="5847748">scratch</span><span class="op" id="5847755">[</span><span class="num" id="5847756">0</span><span class="op" id="5847757">:</span><span class="num" id="5847758">4</span><span class="op" id="5847759">]</span><span class="op" id="5847760">)</span><span class="op" id="5847761">;</span>&nbsp;<span class="ident" id="5847763">err</span>&nbsp;<span class="op" id="5847767">!=</span>&nbsp;<span class="ident" id="5847770">nil</span>&nbsp;<span class="op" id="5847774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847779">return</span>&nbsp;<span class="ident" id="5847786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847792">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847798">if</span>&nbsp;<span class="ident" id="5847801">z</span><span class="op" id="5847802">.</span><span class="ident" id="5847803">compressor</span>&nbsp;<span class="op" id="5847814">==</span>&nbsp;<span class="ident" id="5847817">nil</span>&nbsp;<span class="op" id="5847821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5847825">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5847884">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847909">z</span><span class="op" id="5847910">.</span><span class="ident" id="5847911">compressor</span><span class="op" id="5847921">,</span>&nbsp;<span class="ident" id="5847923">err</span>&nbsp;<span class="op" id="5847927">=</span>&nbsp;<span class="ident" id="5847929">flate</span><span class="op" id="5847934">.</span><span class="ident" id="5847935">NewWriterDict</span><span class="op" id="5847948">(</span><span class="ident" id="5847949">z</span><span class="op" id="5847950">.</span><span class="ident" id="5847951">w</span><span class="op" id="5847952">,</span>&nbsp;<span class="ident" id="5847954">z</span><span class="op" id="5847955">.</span><span class="ident" id="5847956">level</span><span class="op" id="5847961">,</span>&nbsp;<span class="ident" id="5847963">z</span><span class="op" id="5847964">.</span><span class="ident" id="5847965">dict</span><span class="op" id="5847969">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847973">if</span>&nbsp;<span class="ident" id="5847976">err</span>&nbsp;<span class="op" id="5847980">!=</span>&nbsp;<span class="ident" id="5847983">nil</span>&nbsp;<span class="op" id="5847987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847992">return</span>&nbsp;<span class="ident" id="5847999">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848009">z</span><span class="op" id="5848010">.</span><span class="ident" id="5848011">digest</span>&nbsp;<span class="op" id="5848018">=</span>&nbsp;<span class="ident" id="5848020">adler32</span><span class="op" id="5848027">.</span><span class="ident" id="5848028">New</span><span class="op" id="5848031">(</span><span class="op" id="5848032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848035">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848038">return</span>&nbsp;<span class="ident" id="5848045">nil</span><br>
<span class="lineno"></span><span class="op" id="5848049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5848052">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5848124">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5848202">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5848225">func</span>&nbsp;<span class="op" id="5848230">(</span><span class="ident" id="5848231">z</span>&nbsp;<span class="op" id="5848233">*</span><span class="ident" id="5848234">Writer</span><span class="op" id="5848240">)</span>&nbsp;<span class="ident" id="5848242">Write</span><span class="op" id="5848247">(</span><span class="ident" id="5848248">p</span>&nbsp;<span class="op" id="5848250">[</span><span class="op" id="5848251">]</span><span class="builtintype" id="5848252">byte</span><span class="op" id="5848256">)</span>&nbsp;<span class="op" id="5848258">(</span><span class="ident" id="5848259">n</span>&nbsp;<span class="builtintype" id="5848261">int</span><span class="op" id="5848264">,</span>&nbsp;<span class="ident" id="5848266">err</span>&nbsp;<span class="builtintype" id="5848270">error</span><span class="op" id="5848275">)</span>&nbsp;<span class="op" id="5848277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848280">if</span>&nbsp;<span class="op" id="5848283">!</span><span class="ident" id="5848284">z</span><span class="op" id="5848285">.</span><span class="ident" id="5848286">wroteHeader</span>&nbsp;<span class="op" id="5848298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848302">z</span><span class="op" id="5848303">.</span><span class="ident" id="5848304">err</span>&nbsp;<span class="op" id="5848308">=</span>&nbsp;<span class="ident" id="5848310">z</span><span class="op" id="5848311">.</span><span class="ident" id="5848312">writeHeader</span><span class="op" id="5848323">(</span><span class="op" id="5848324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848327">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848330">if</span>&nbsp;<span class="ident" id="5848333">z</span><span class="op" id="5848334">.</span><span class="ident" id="5848335">err</span>&nbsp;<span class="op" id="5848339">!=</span>&nbsp;<span class="ident" id="5848342">nil</span>&nbsp;<span class="op" id="5848346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848350">return</span>&nbsp;<span class="num" id="5848357">0</span><span class="op" id="5848358">,</span>&nbsp;<span class="ident" id="5848360">z</span><span class="op" id="5848361">.</span><span class="ident" id="5848362">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848370">if</span>&nbsp;<span class="builtinfunc" id="5848373">len</span><span class="op" id="5848376">(</span><span class="ident" id="5848377">p</span><span class="op" id="5848378">)</span>&nbsp;<span class="op" id="5848380">==</span>&nbsp;<span class="num" id="5848383">0</span>&nbsp;<span class="op" id="5848385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848389">return</span>&nbsp;<span class="num" id="5848396">0</span><span class="op" id="5848397">,</span>&nbsp;<span class="ident" id="5848399">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848407">n</span><span class="op" id="5848408">,</span>&nbsp;<span class="ident" id="5848410">err</span>&nbsp;<span class="op" id="5848414">=</span>&nbsp;<span class="ident" id="5848416">z</span><span class="op" id="5848417">.</span><span class="ident" id="5848418">compressor</span><span class="op" id="5848428">.</span><span class="ident" id="5848429">Write</span><span class="op" id="5848434">(</span><span class="ident" id="5848435">p</span><span class="op" id="5848436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848439">if</span>&nbsp;<span class="ident" id="5848442">err</span>&nbsp;<span class="op" id="5848446">!=</span>&nbsp;<span class="ident" id="5848449">nil</span>&nbsp;<span class="op" id="5848453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848457">z</span><span class="op" id="5848458">.</span><span class="ident" id="5848459">err</span>&nbsp;<span class="op" id="5848463">=</span>&nbsp;<span class="ident" id="5848465">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848471">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848482">z</span><span class="op" id="5848483">.</span><span class="ident" id="5848484">digest</span><span class="op" id="5848490">.</span><span class="ident" id="5848491">Write</span><span class="op" id="5848496">(</span><span class="ident" id="5848497">p</span><span class="op" id="5848498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848501">return</span><br>
<span class="lineno"></span><span class="op" id="5848508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5848511">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5848568">func</span>&nbsp;<span class="op" id="5848573">(</span><span class="ident" id="5848574">z</span>&nbsp;<span class="op" id="5848576">*</span><span class="ident" id="5848577">Writer</span><span class="op" id="5848583">)</span>&nbsp;<span class="ident" id="5848585">Flush</span><span class="op" id="5848590">(</span><span class="op" id="5848591">)</span>&nbsp;<span class="builtintype" id="5848593">error</span>&nbsp;<span class="op" id="5848599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848602">if</span>&nbsp;<span class="op" id="5848605">!</span><span class="ident" id="5848606">z</span><span class="op" id="5848607">.</span><span class="ident" id="5848608">wroteHeader</span>&nbsp;<span class="op" id="5848620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848624">z</span><span class="op" id="5848625">.</span><span class="ident" id="5848626">err</span>&nbsp;<span class="op" id="5848630">=</span>&nbsp;<span class="ident" id="5848632">z</span><span class="op" id="5848633">.</span><span class="ident" id="5848634">writeHeader</span><span class="op" id="5848645">(</span><span class="op" id="5848646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848649">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848652">if</span>&nbsp;<span class="ident" id="5848655">z</span><span class="op" id="5848656">.</span><span class="ident" id="5848657">err</span>&nbsp;<span class="op" id="5848661">!=</span>&nbsp;<span class="ident" id="5848664">nil</span>&nbsp;<span class="op" id="5848668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848672">return</span>&nbsp;<span class="ident" id="5848679">z</span><span class="op" id="5848680">.</span><span class="ident" id="5848681">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848689">z</span><span class="op" id="5848690">.</span><span class="ident" id="5848691">err</span>&nbsp;<span class="op" id="5848695">=</span>&nbsp;<span class="ident" id="5848697">z</span><span class="op" id="5848698">.</span><span class="ident" id="5848699">compressor</span><span class="op" id="5848709">.</span><span class="ident" id="5848710">Flush</span><span class="op" id="5848715">(</span><span class="op" id="5848716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848719">return</span>&nbsp;<span class="ident" id="5848726">z</span><span class="op" id="5848727">.</span><span class="ident" id="5848728">err</span><br>
<span class="lineno">175</span><span class="op" id="5848732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5848735">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5848809">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5848868">func</span>&nbsp;<span class="op" id="5848873">(</span><span class="ident" id="5848874">z</span>&nbsp;<span class="op" id="5848876">*</span><span class="ident" id="5848877">Writer</span><span class="op" id="5848883">)</span>&nbsp;<span class="ident" id="5848885">Close</span><span class="op" id="5848890">(</span><span class="op" id="5848891">)</span>&nbsp;<span class="builtintype" id="5848893">error</span>&nbsp;<span class="op" id="5848899">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848902">if</span>&nbsp;<span class="op" id="5848905">!</span><span class="ident" id="5848906">z</span><span class="op" id="5848907">.</span><span class="ident" id="5848908">wroteHeader</span>&nbsp;<span class="op" id="5848920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848924">z</span><span class="op" id="5848925">.</span><span class="ident" id="5848926">err</span>&nbsp;<span class="op" id="5848930">=</span>&nbsp;<span class="ident" id="5848932">z</span><span class="op" id="5848933">.</span><span class="ident" id="5848934">writeHeader</span><span class="op" id="5848945">(</span><span class="op" id="5848946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848952">if</span>&nbsp;<span class="ident" id="5848955">z</span><span class="op" id="5848956">.</span><span class="ident" id="5848957">err</span>&nbsp;<span class="op" id="5848961">!=</span>&nbsp;<span class="ident" id="5848964">nil</span>&nbsp;<span class="op" id="5848968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848972">return</span>&nbsp;<span class="ident" id="5848979">z</span><span class="op" id="5848980">.</span><span class="ident" id="5848981">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848989">z</span><span class="op" id="5848990">.</span><span class="ident" id="5848991">err</span>&nbsp;<span class="op" id="5848995">=</span>&nbsp;<span class="ident" id="5848997">z</span><span class="op" id="5848998">.</span><span class="ident" id="5848999">compressor</span><span class="op" id="5849009">.</span><span class="ident" id="5849010">Close</span><span class="op" id="5849015">(</span><span class="op" id="5849016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5849019">if</span>&nbsp;<span class="ident" id="5849022">z</span><span class="op" id="5849023">.</span><span class="ident" id="5849024">err</span>&nbsp;<span class="op" id="5849028">!=</span>&nbsp;<span class="ident" id="5849031">nil</span>&nbsp;<span class="op" id="5849035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5849039">return</span>&nbsp;<span class="ident" id="5849046">z</span><span class="op" id="5849047">.</span><span class="ident" id="5849048">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5849053">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5849056">checksum</span>&nbsp;<span class="op" id="5849065">:=</span>&nbsp;<span class="ident" id="5849068">z</span><span class="op" id="5849069">.</span><span class="ident" id="5849070">digest</span><span class="op" id="5849076">.</span><span class="ident" id="5849077">Sum32</span><span class="op" id="5849082">(</span><span class="op" id="5849083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5849086">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5849145">z</span><span class="op" id="5849146">.</span><span class="ident" id="5849147">scratch</span><span class="op" id="5849154">[</span><span class="num" id="5849155">0</span><span class="op" id="5849156">]</span>&nbsp;<span class="op" id="5849158">=</span>&nbsp;<span class="builtintype" id="5849160">uint8</span><span class="op" id="5849165">(</span><span class="ident" id="5849166">checksum</span>&nbsp;<span class="op" id="5849175">&gt;&gt;</span>&nbsp;<span class="num" id="5849178">24</span><span class="op" id="5849180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5849183">z</span><span class="op" id="5849184">.</span><span class="ident" id="5849185">scratch</span><span class="op" id="5849192">[</span><span class="num" id="5849193">1</span><span class="op" id="5849194">]</span>&nbsp;<span class="op" id="5849196">=</span>&nbsp;<span class="builtintype" id="5849198">uint8</span><span class="op" id="5849203">(</span><span class="ident" id="5849204">checksum</span>&nbsp;<span class="op" id="5849213">&gt;&gt;</span>&nbsp;<span class="num" id="5849216">16</span><span class="op" id="5849218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5849221">z</span><span class="op" id="5849222">.</span><span class="ident" id="5849223">scratch</span><span class="op" id="5849230">[</span><span class="num" id="5849231">2</span><span class="op" id="5849232">]</span>&nbsp;<span class="op" id="5849234">=</span>&nbsp;<span class="builtintype" id="5849236">uint8</span><span class="op" id="5849241">(</span><span class="ident" id="5849242">checksum</span>&nbsp;<span class="op" id="5849251">&gt;&gt;</span>&nbsp;<span class="num" id="5849254">8</span><span class="op" id="5849255">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5849258">z</span><span class="op" id="5849259">.</span><span class="ident" id="5849260">scratch</span><span class="op" id="5849267">[</span><span class="num" id="5849268">3</span><span class="op" id="5849269">]</span>&nbsp;<span class="op" id="5849271">=</span>&nbsp;<span class="builtintype" id="5849273">uint8</span><span class="op" id="5849278">(</span><span class="ident" id="5849279">checksum</span>&nbsp;<span class="op" id="5849288">&gt;&gt;</span>&nbsp;<span class="num" id="5849291">0</span><span class="op" id="5849292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5849295">_</span><span class="op" id="5849296">,</span>&nbsp;<span class="ident" id="5849298">z</span><span class="op" id="5849299">.</span><span class="ident" id="5849300">err</span>&nbsp;<span class="op" id="5849304">=</span>&nbsp;<span class="ident" id="5849306">z</span><span class="op" id="5849307">.</span><span class="ident" id="5849308">w</span><span class="op" id="5849309">.</span><span class="ident" id="5849310">Write</span><span class="op" id="5849315">(</span><span class="ident" id="5849316">z</span><span class="op" id="5849317">.</span><span class="ident" id="5849318">scratch</span><span class="op" id="5849325">[</span><span class="num" id="5849326">0</span><span class="op" id="5849327">:</span><span class="num" id="5849328">4</span><span class="op" id="5849329">]</span><span class="op" id="5849330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5849333">return</span>&nbsp;<span class="ident" id="5849340">z</span><span class="op" id="5849341">.</span><span class="ident" id="5849342">err</span><br>
<span class="lineno"></span><span class="op" id="5849346">}</span>
</div>
</body>
</html>
