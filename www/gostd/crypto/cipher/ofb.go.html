<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3829107">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3829162">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3829216">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3829267">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3829299">package</span>&nbsp;<span class="ident" id="3829307">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3829315">type</span>&nbsp;<span class="ident" id="3829320">ofb</span>&nbsp;<span class="keyword" id="3829324">struct</span>&nbsp;<span class="op" id="3829331">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829334">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829342">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829349">cipher</span>&nbsp;&nbsp;<span class="op" id="3829357">[</span><span class="op" id="3829358">]</span><span class="builtintype" id="3829359">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829365">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3829373">[</span><span class="op" id="3829374">]</span><span class="builtintype" id="3829375">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829381">outUsed</span>&nbsp;<span class="builtintype" id="3829389">int</span><br>
<span class="lineno"></span><span class="op" id="3829393">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3829396">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3829474">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3829554">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3829576">func</span>&nbsp;<span class="ident" id="3829581">NewOFB</span><span class="op" id="3829587">(</span><span class="ident" id="3829588">b</span>&nbsp;<span class="ident" id="3829590">Block</span><span class="op" id="3829595">,</span>&nbsp;<span class="ident" id="3829597">iv</span>&nbsp;<span class="op" id="3829600">[</span><span class="op" id="3829601">]</span><span class="builtintype" id="3829602">byte</span><span class="op" id="3829606">)</span>&nbsp;<span class="ident" id="3829608">Stream</span>&nbsp;<span class="op" id="3829615">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829618">blockSize</span>&nbsp;<span class="op" id="3829628">:=</span>&nbsp;<span class="ident" id="3829631">b</span><span class="op" id="3829632">.</span><span class="ident" id="3829633">BlockSize</span><span class="op" id="3829642">(</span><span class="op" id="3829643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829646">if</span>&nbsp;<span class="builtinfunc" id="3829649">len</span><span class="op" id="3829652">(</span><span class="ident" id="3829653">iv</span><span class="op" id="3829655">)</span>&nbsp;<span class="op" id="3829657">!=</span>&nbsp;<span class="ident" id="3829660">blockSize</span>&nbsp;<span class="op" id="3829670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829674">return</span>&nbsp;<span class="ident" id="3829681">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829689">bufSize</span>&nbsp;<span class="op" id="3829697">:=</span>&nbsp;<span class="ident" id="3829700">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829718">if</span>&nbsp;<span class="ident" id="3829721">bufSize</span>&nbsp;<span class="op" id="3829729">&lt;</span>&nbsp;<span class="ident" id="3829731">blockSize</span>&nbsp;<span class="op" id="3829741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829745">bufSize</span>&nbsp;<span class="op" id="3829753">=</span>&nbsp;<span class="ident" id="3829755">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829769">x</span>&nbsp;<span class="op" id="3829771">:=</span>&nbsp;<span class="op" id="3829774">&amp;</span><span class="ident" id="3829775">ofb</span><span class="op" id="3829778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829782">b</span><span class="op" id="3829783">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829791">b</span><span class="op" id="3829792">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829796">cipher</span><span class="op" id="3829802">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3829805">make</span><span class="op" id="3829809">(</span><span class="op" id="3829810">[</span><span class="op" id="3829811">]</span><span class="builtintype" id="3829812">byte</span><span class="op" id="3829816">,</span>&nbsp;<span class="ident" id="3829818">blockSize</span><span class="op" id="3829827">)</span><span class="op" id="3829828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829832">out</span><span class="op" id="3829835">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3829841">make</span><span class="op" id="3829845">(</span><span class="op" id="3829846">[</span><span class="op" id="3829847">]</span><span class="builtintype" id="3829848">byte</span><span class="op" id="3829852">,</span>&nbsp;<span class="num" id="3829854">0</span><span class="op" id="3829855">,</span>&nbsp;<span class="ident" id="3829857">bufSize</span><span class="op" id="3829864">)</span><span class="op" id="3829865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829869">outUsed</span><span class="op" id="3829876">:</span>&nbsp;<span class="num" id="3829878">0</span><span class="op" id="3829879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3829886">copy</span><span class="op" id="3829890">(</span><span class="ident" id="3829891">x</span><span class="op" id="3829892">.</span><span class="ident" id="3829893">cipher</span><span class="op" id="3829899">,</span>&nbsp;<span class="ident" id="3829901">iv</span><span class="op" id="3829903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829906">return</span>&nbsp;<span class="ident" id="3829913">x</span><br>
<span class="lineno"></span><span class="op" id="3829915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3829918">func</span>&nbsp;<span class="op" id="3829923">(</span><span class="ident" id="3829924">x</span>&nbsp;<span class="op" id="3829926">*</span><span class="ident" id="3829927">ofb</span><span class="op" id="3829930">)</span>&nbsp;<span class="ident" id="3829932">refill</span><span class="op" id="3829938">(</span><span class="op" id="3829939">)</span>&nbsp;<span class="op" id="3829941">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829944">bs</span>&nbsp;<span class="op" id="3829947">:=</span>&nbsp;<span class="ident" id="3829950">x</span><span class="op" id="3829951">.</span><span class="ident" id="3829952">b</span><span class="op" id="3829953">.</span><span class="ident" id="3829954">BlockSize</span><span class="op" id="3829963">(</span><span class="op" id="3829964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829967">remain</span>&nbsp;<span class="op" id="3829974">:=</span>&nbsp;<span class="builtinfunc" id="3829977">len</span><span class="op" id="3829980">(</span><span class="ident" id="3829981">x</span><span class="op" id="3829982">.</span><span class="ident" id="3829983">out</span><span class="op" id="3829986">)</span>&nbsp;<span class="op" id="3829988">-</span>&nbsp;<span class="ident" id="3829990">x</span><span class="op" id="3829991">.</span><span class="ident" id="3829992">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3830001">if</span>&nbsp;<span class="ident" id="3830004">remain</span>&nbsp;<span class="op" id="3830011">&gt;</span>&nbsp;<span class="ident" id="3830013">x</span><span class="op" id="3830014">.</span><span class="ident" id="3830015">outUsed</span>&nbsp;<span class="op" id="3830023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3830027">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3830035">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3830038">copy</span><span class="op" id="3830042">(</span><span class="ident" id="3830043">x</span><span class="op" id="3830044">.</span><span class="ident" id="3830045">out</span><span class="op" id="3830048">,</span>&nbsp;<span class="ident" id="3830050">x</span><span class="op" id="3830051">.</span><span class="ident" id="3830052">out</span><span class="op" id="3830055">[</span><span class="ident" id="3830056">x</span><span class="op" id="3830057">.</span><span class="ident" id="3830058">outUsed</span><span class="op" id="3830065">:</span><span class="op" id="3830066">]</span><span class="op" id="3830067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830070">x</span><span class="op" id="3830071">.</span><span class="ident" id="3830072">out</span>&nbsp;<span class="op" id="3830076">=</span>&nbsp;<span class="ident" id="3830078">x</span><span class="op" id="3830079">.</span><span class="ident" id="3830080">out</span><span class="op" id="3830083">[</span><span class="op" id="3830084">:</span><span class="builtinfunc" id="3830085">cap</span><span class="op" id="3830088">(</span><span class="ident" id="3830089">x</span><span class="op" id="3830090">.</span><span class="ident" id="3830091">out</span><span class="op" id="3830094">)</span><span class="op" id="3830095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3830098">for</span>&nbsp;<span class="ident" id="3830102">remain</span>&nbsp;<span class="op" id="3830109">&lt;</span>&nbsp;<span class="builtinfunc" id="3830111">len</span><span class="op" id="3830114">(</span><span class="ident" id="3830115">x</span><span class="op" id="3830116">.</span><span class="ident" id="3830117">out</span><span class="op" id="3830120">)</span><span class="op" id="3830121">-</span><span class="ident" id="3830122">bs</span>&nbsp;<span class="op" id="3830125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830129">x</span><span class="op" id="3830130">.</span><span class="ident" id="3830131">b</span><span class="op" id="3830132">.</span><span class="ident" id="3830133">Encrypt</span><span class="op" id="3830140">(</span><span class="ident" id="3830141">x</span><span class="op" id="3830142">.</span><span class="ident" id="3830143">cipher</span><span class="op" id="3830149">,</span>&nbsp;<span class="ident" id="3830151">x</span><span class="op" id="3830152">.</span><span class="ident" id="3830153">cipher</span><span class="op" id="3830159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3830163">copy</span><span class="op" id="3830167">(</span><span class="ident" id="3830168">x</span><span class="op" id="3830169">.</span><span class="ident" id="3830170">out</span><span class="op" id="3830173">[</span><span class="ident" id="3830174">remain</span><span class="op" id="3830180">:</span><span class="op" id="3830181">]</span><span class="op" id="3830182">,</span>&nbsp;<span class="ident" id="3830184">x</span><span class="op" id="3830185">.</span><span class="ident" id="3830186">cipher</span><span class="op" id="3830192">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830196">remain</span>&nbsp;<span class="op" id="3830203">+=</span>&nbsp;<span class="ident" id="3830206">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3830210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830213">x</span><span class="op" id="3830214">.</span><span class="ident" id="3830215">out</span>&nbsp;<span class="op" id="3830219">=</span>&nbsp;<span class="ident" id="3830221">x</span><span class="op" id="3830222">.</span><span class="ident" id="3830223">out</span><span class="op" id="3830226">[</span><span class="op" id="3830227">:</span><span class="ident" id="3830228">remain</span><span class="op" id="3830234">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830237">x</span><span class="op" id="3830238">.</span><span class="ident" id="3830239">outUsed</span>&nbsp;<span class="op" id="3830247">=</span>&nbsp;<span class="num" id="3830249">0</span><br>
<span class="lineno"></span><span class="op" id="3830251">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3830254">func</span>&nbsp;<span class="op" id="3830259">(</span><span class="ident" id="3830260">x</span>&nbsp;<span class="op" id="3830262">*</span><span class="ident" id="3830263">ofb</span><span class="op" id="3830266">)</span>&nbsp;<span class="ident" id="3830268">XORKeyStream</span><span class="op" id="3830280">(</span><span class="ident" id="3830281">dst</span><span class="op" id="3830284">,</span>&nbsp;<span class="ident" id="3830286">src</span>&nbsp;<span class="op" id="3830290">[</span><span class="op" id="3830291">]</span><span class="builtintype" id="3830292">byte</span><span class="op" id="3830296">)</span>&nbsp;<span class="op" id="3830298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3830301">for</span>&nbsp;<span class="builtinfunc" id="3830305">len</span><span class="op" id="3830308">(</span><span class="ident" id="3830309">src</span><span class="op" id="3830312">)</span>&nbsp;<span class="op" id="3830314">&gt;</span>&nbsp;<span class="num" id="3830316">0</span>&nbsp;<span class="op" id="3830318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3830322">if</span>&nbsp;<span class="ident" id="3830325">x</span><span class="op" id="3830326">.</span><span class="ident" id="3830327">outUsed</span>&nbsp;<span class="op" id="3830335">&gt;=</span>&nbsp;<span class="builtinfunc" id="3830338">len</span><span class="op" id="3830341">(</span><span class="ident" id="3830342">x</span><span class="op" id="3830343">.</span><span class="ident" id="3830344">out</span><span class="op" id="3830347">)</span><span class="op" id="3830348">-</span><span class="ident" id="3830349">x</span><span class="op" id="3830350">.</span><span class="ident" id="3830351">b</span><span class="op" id="3830352">.</span><span class="ident" id="3830353">BlockSize</span><span class="op" id="3830362">(</span><span class="op" id="3830363">)</span>&nbsp;<span class="op" id="3830365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830370">x</span><span class="op" id="3830371">.</span><span class="ident" id="3830372">refill</span><span class="op" id="3830378">(</span><span class="op" id="3830379">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3830383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830387">n</span>&nbsp;<span class="op" id="3830389">:=</span>&nbsp;<span class="ident" id="3830392">xorBytes</span><span class="op" id="3830400">(</span><span class="ident" id="3830401">dst</span><span class="op" id="3830404">,</span>&nbsp;<span class="ident" id="3830406">src</span><span class="op" id="3830409">,</span>&nbsp;<span class="ident" id="3830411">x</span><span class="op" id="3830412">.</span><span class="ident" id="3830413">out</span><span class="op" id="3830416">[</span><span class="ident" id="3830417">x</span><span class="op" id="3830418">.</span><span class="ident" id="3830419">outUsed</span><span class="op" id="3830426">:</span><span class="op" id="3830427">]</span><span class="op" id="3830428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830432">dst</span>&nbsp;<span class="op" id="3830436">=</span>&nbsp;<span class="ident" id="3830438">dst</span><span class="op" id="3830441">[</span><span class="ident" id="3830442">n</span><span class="op" id="3830443">:</span><span class="op" id="3830444">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830448">src</span>&nbsp;<span class="op" id="3830452">=</span>&nbsp;<span class="ident" id="3830454">src</span><span class="op" id="3830457">[</span><span class="ident" id="3830458">n</span><span class="op" id="3830459">:</span><span class="op" id="3830460">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3830464">x</span><span class="op" id="3830465">.</span><span class="ident" id="3830466">outUsed</span>&nbsp;<span class="op" id="3830474">+=</span>&nbsp;<span class="ident" id="3830477">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3830480">}</span><br>
<span class="lineno"></span><span class="op" id="3830482">}</span>
</div>
</body>
</html>
