<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8447690">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8447745">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8447799">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8447850">package</span>&nbsp;<span class="ident" id="8447858">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8447864">import</span>&nbsp;<span class="op" id="8447871">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447874">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447883">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447890">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447899">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447914">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447927">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447940">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447953">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8447959">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8447969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8447972">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="8448051">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="8448130">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="8448155">var</span>&nbsp;<span class="ident" id="8448159">zigzag</span>&nbsp;<span class="op" id="8448166">=</span>&nbsp;<span class="op" id="8448168">[</span><span class="ident" id="8448169">blockSize</span><span class="op" id="8448178">]</span><span class="builtintype" id="8448179">int</span><span class="op" id="8448182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448185">0</span><span class="op" id="8448186">,</span>&nbsp;<span class="num" id="8448188">1</span><span class="op" id="8448189">,</span>&nbsp;<span class="num" id="8448191">5</span><span class="op" id="8448192">,</span>&nbsp;<span class="num" id="8448194">6</span><span class="op" id="8448195">,</span>&nbsp;<span class="num" id="8448197">14</span><span class="op" id="8448199">,</span>&nbsp;<span class="num" id="8448201">15</span><span class="op" id="8448203">,</span>&nbsp;<span class="num" id="8448205">27</span><span class="op" id="8448207">,</span>&nbsp;<span class="num" id="8448209">28</span><span class="op" id="8448211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448214">2</span><span class="op" id="8448215">,</span>&nbsp;<span class="num" id="8448217">4</span><span class="op" id="8448218">,</span>&nbsp;<span class="num" id="8448220">7</span><span class="op" id="8448221">,</span>&nbsp;<span class="num" id="8448223">13</span><span class="op" id="8448225">,</span>&nbsp;<span class="num" id="8448227">16</span><span class="op" id="8448229">,</span>&nbsp;<span class="num" id="8448231">26</span><span class="op" id="8448233">,</span>&nbsp;<span class="num" id="8448235">29</span><span class="op" id="8448237">,</span>&nbsp;<span class="num" id="8448239">42</span><span class="op" id="8448241">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448244">3</span><span class="op" id="8448245">,</span>&nbsp;<span class="num" id="8448247">8</span><span class="op" id="8448248">,</span>&nbsp;<span class="num" id="8448250">12</span><span class="op" id="8448252">,</span>&nbsp;<span class="num" id="8448254">17</span><span class="op" id="8448256">,</span>&nbsp;<span class="num" id="8448258">25</span><span class="op" id="8448260">,</span>&nbsp;<span class="num" id="8448262">30</span><span class="op" id="8448264">,</span>&nbsp;<span class="num" id="8448266">41</span><span class="op" id="8448268">,</span>&nbsp;<span class="num" id="8448270">43</span><span class="op" id="8448272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448275">9</span><span class="op" id="8448276">,</span>&nbsp;<span class="num" id="8448278">11</span><span class="op" id="8448280">,</span>&nbsp;<span class="num" id="8448282">18</span><span class="op" id="8448284">,</span>&nbsp;<span class="num" id="8448286">24</span><span class="op" id="8448288">,</span>&nbsp;<span class="num" id="8448290">31</span><span class="op" id="8448292">,</span>&nbsp;<span class="num" id="8448294">40</span><span class="op" id="8448296">,</span>&nbsp;<span class="num" id="8448298">44</span><span class="op" id="8448300">,</span>&nbsp;<span class="num" id="8448302">53</span><span class="op" id="8448304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448307">10</span><span class="op" id="8448309">,</span>&nbsp;<span class="num" id="8448311">19</span><span class="op" id="8448313">,</span>&nbsp;<span class="num" id="8448315">23</span><span class="op" id="8448317">,</span>&nbsp;<span class="num" id="8448319">32</span><span class="op" id="8448321">,</span>&nbsp;<span class="num" id="8448323">39</span><span class="op" id="8448325">,</span>&nbsp;<span class="num" id="8448327">45</span><span class="op" id="8448329">,</span>&nbsp;<span class="num" id="8448331">52</span><span class="op" id="8448333">,</span>&nbsp;<span class="num" id="8448335">54</span><span class="op" id="8448337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448340">20</span><span class="op" id="8448342">,</span>&nbsp;<span class="num" id="8448344">22</span><span class="op" id="8448346">,</span>&nbsp;<span class="num" id="8448348">33</span><span class="op" id="8448350">,</span>&nbsp;<span class="num" id="8448352">38</span><span class="op" id="8448354">,</span>&nbsp;<span class="num" id="8448356">46</span><span class="op" id="8448358">,</span>&nbsp;<span class="num" id="8448360">51</span><span class="op" id="8448362">,</span>&nbsp;<span class="num" id="8448364">55</span><span class="op" id="8448366">,</span>&nbsp;<span class="num" id="8448368">60</span><span class="op" id="8448370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448373">21</span><span class="op" id="8448375">,</span>&nbsp;<span class="num" id="8448377">34</span><span class="op" id="8448379">,</span>&nbsp;<span class="num" id="8448381">37</span><span class="op" id="8448383">,</span>&nbsp;<span class="num" id="8448385">47</span><span class="op" id="8448387">,</span>&nbsp;<span class="num" id="8448389">50</span><span class="op" id="8448391">,</span>&nbsp;<span class="num" id="8448393">56</span><span class="op" id="8448395">,</span>&nbsp;<span class="num" id="8448397">59</span><span class="op" id="8448399">,</span>&nbsp;<span class="num" id="8448401">61</span><span class="op" id="8448403">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448406">35</span><span class="op" id="8448408">,</span>&nbsp;<span class="num" id="8448410">36</span><span class="op" id="8448412">,</span>&nbsp;<span class="num" id="8448414">48</span><span class="op" id="8448416">,</span>&nbsp;<span class="num" id="8448418">49</span><span class="op" id="8448420">,</span>&nbsp;<span class="num" id="8448422">57</span><span class="op" id="8448424">,</span>&nbsp;<span class="num" id="8448426">58</span><span class="op" id="8448428">,</span>&nbsp;<span class="num" id="8448430">62</span><span class="op" id="8448432">,</span>&nbsp;<span class="num" id="8448434">63</span><span class="op" id="8448436">,</span><br>
<span class="lineno"></span><span class="op" id="8448438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8448441">func</span>&nbsp;<span class="ident" id="8448446">TestZigUnzig</span><span class="op" id="8448458">(</span><span class="ident" id="8448459">t</span>&nbsp;<span class="op" id="8448461">*</span><span class="ident" id="8448462">testing</span><span class="op" id="8448469">.</span><span class="ident" id="8448470">T</span><span class="op" id="8448471">)</span>&nbsp;<span class="op" id="8448473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8448476">for</span>&nbsp;<span class="ident" id="8448480">i</span>&nbsp;<span class="op" id="8448482">:=</span>&nbsp;<span class="num" id="8448485">0</span><span class="op" id="8448486">;</span>&nbsp;<span class="ident" id="8448488">i</span>&nbsp;<span class="op" id="8448490">&lt;</span>&nbsp;<span class="ident" id="8448492">blockSize</span><span class="op" id="8448501">;</span>&nbsp;<span class="ident" id="8448503">i</span><span class="op" id="8448504">++</span>&nbsp;<span class="op" id="8448507">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8448511">if</span>&nbsp;<span class="ident" id="8448514">unzig</span><span class="op" id="8448519">[</span><span class="ident" id="8448520">zigzag</span><span class="op" id="8448526">[</span><span class="ident" id="8448527">i</span><span class="op" id="8448528">]</span><span class="op" id="8448529">]</span>&nbsp;<span class="op" id="8448531">!=</span>&nbsp;<span class="ident" id="8448534">i</span>&nbsp;<span class="op" id="8448536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8448541">t</span><span class="op" id="8448542">.</span><span class="ident" id="8448543">Errorf</span><span class="op" id="8448549">(</span><span class="string" id="8448550">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="8448575">,</span>&nbsp;<span class="ident" id="8448577">i</span><span class="op" id="8448578">,</span>&nbsp;<span class="ident" id="8448580">unzig</span><span class="op" id="8448585">[</span><span class="ident" id="8448586">zigzag</span><span class="op" id="8448592">[</span><span class="ident" id="8448593">i</span><span class="op" id="8448594">]</span><span class="op" id="8448595">]</span><span class="op" id="8448596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8448600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8448604">if</span>&nbsp;<span class="ident" id="8448607">zigzag</span><span class="op" id="8448613">[</span><span class="ident" id="8448614">unzig</span><span class="op" id="8448619">[</span><span class="ident" id="8448620">i</span><span class="op" id="8448621">]</span><span class="op" id="8448622">]</span>&nbsp;<span class="op" id="8448624">!=</span>&nbsp;<span class="ident" id="8448627">i</span>&nbsp;<span class="op" id="8448629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8448634">t</span><span class="op" id="8448635">.</span><span class="ident" id="8448636">Errorf</span><span class="op" id="8448642">(</span><span class="string" id="8448643">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="8448668">,</span>&nbsp;<span class="ident" id="8448670">i</span><span class="op" id="8448671">,</span>&nbsp;<span class="ident" id="8448673">zigzag</span><span class="op" id="8448679">[</span><span class="ident" id="8448680">unzig</span><span class="op" id="8448685">[</span><span class="ident" id="8448686">i</span><span class="op" id="8448687">]</span><span class="op" id="8448688">]</span><span class="op" id="8448689">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8448693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8448696">}</span><br>
<span class="lineno"></span><span class="op" id="8448698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8448701">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="8448772">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="8448833">var</span>&nbsp;<span class="ident" id="8448837">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="8448865">=</span>&nbsp;<span class="op" id="8448867">[</span><span class="ident" id="8448868">nQuantIndex</span><span class="op" id="8448879">]</span><span class="op" id="8448880">[</span><span class="ident" id="8448881">blockSize</span><span class="op" id="8448890">]</span><span class="builtintype" id="8448891">byte</span><span class="op" id="8448895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8448898">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8448913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448917">16</span><span class="op" id="8448919">,</span>&nbsp;<span class="num" id="8448921">11</span><span class="op" id="8448923">,</span>&nbsp;<span class="num" id="8448925">10</span><span class="op" id="8448927">,</span>&nbsp;<span class="num" id="8448929">16</span><span class="op" id="8448931">,</span>&nbsp;<span class="num" id="8448933">24</span><span class="op" id="8448935">,</span>&nbsp;<span class="num" id="8448937">40</span><span class="op" id="8448939">,</span>&nbsp;<span class="num" id="8448941">51</span><span class="op" id="8448943">,</span>&nbsp;<span class="num" id="8448945">61</span><span class="op" id="8448947">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448951">12</span><span class="op" id="8448953">,</span>&nbsp;<span class="num" id="8448955">12</span><span class="op" id="8448957">,</span>&nbsp;<span class="num" id="8448959">14</span><span class="op" id="8448961">,</span>&nbsp;<span class="num" id="8448963">19</span><span class="op" id="8448965">,</span>&nbsp;<span class="num" id="8448967">26</span><span class="op" id="8448969">,</span>&nbsp;<span class="num" id="8448971">58</span><span class="op" id="8448973">,</span>&nbsp;<span class="num" id="8448975">60</span><span class="op" id="8448977">,</span>&nbsp;<span class="num" id="8448979">55</span><span class="op" id="8448981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8448985">14</span><span class="op" id="8448987">,</span>&nbsp;<span class="num" id="8448989">13</span><span class="op" id="8448991">,</span>&nbsp;<span class="num" id="8448993">16</span><span class="op" id="8448995">,</span>&nbsp;<span class="num" id="8448997">24</span><span class="op" id="8448999">,</span>&nbsp;<span class="num" id="8449001">40</span><span class="op" id="8449003">,</span>&nbsp;<span class="num" id="8449005">57</span><span class="op" id="8449007">,</span>&nbsp;<span class="num" id="8449009">69</span><span class="op" id="8449011">,</span>&nbsp;<span class="num" id="8449013">56</span><span class="op" id="8449015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449019">14</span><span class="op" id="8449021">,</span>&nbsp;<span class="num" id="8449023">17</span><span class="op" id="8449025">,</span>&nbsp;<span class="num" id="8449027">22</span><span class="op" id="8449029">,</span>&nbsp;<span class="num" id="8449031">29</span><span class="op" id="8449033">,</span>&nbsp;<span class="num" id="8449035">51</span><span class="op" id="8449037">,</span>&nbsp;<span class="num" id="8449039">87</span><span class="op" id="8449041">,</span>&nbsp;<span class="num" id="8449043">80</span><span class="op" id="8449045">,</span>&nbsp;<span class="num" id="8449047">62</span><span class="op" id="8449049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449053">18</span><span class="op" id="8449055">,</span>&nbsp;<span class="num" id="8449057">22</span><span class="op" id="8449059">,</span>&nbsp;<span class="num" id="8449061">37</span><span class="op" id="8449063">,</span>&nbsp;<span class="num" id="8449065">56</span><span class="op" id="8449067">,</span>&nbsp;<span class="num" id="8449069">68</span><span class="op" id="8449071">,</span>&nbsp;<span class="num" id="8449073">109</span><span class="op" id="8449076">,</span>&nbsp;<span class="num" id="8449078">103</span><span class="op" id="8449081">,</span>&nbsp;<span class="num" id="8449083">77</span><span class="op" id="8449085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449089">24</span><span class="op" id="8449091">,</span>&nbsp;<span class="num" id="8449093">35</span><span class="op" id="8449095">,</span>&nbsp;<span class="num" id="8449097">55</span><span class="op" id="8449099">,</span>&nbsp;<span class="num" id="8449101">64</span><span class="op" id="8449103">,</span>&nbsp;<span class="num" id="8449105">81</span><span class="op" id="8449107">,</span>&nbsp;<span class="num" id="8449109">104</span><span class="op" id="8449112">,</span>&nbsp;<span class="num" id="8449114">113</span><span class="op" id="8449117">,</span>&nbsp;<span class="num" id="8449119">92</span><span class="op" id="8449121">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449125">49</span><span class="op" id="8449127">,</span>&nbsp;<span class="num" id="8449129">64</span><span class="op" id="8449131">,</span>&nbsp;<span class="num" id="8449133">78</span><span class="op" id="8449135">,</span>&nbsp;<span class="num" id="8449137">87</span><span class="op" id="8449139">,</span>&nbsp;<span class="num" id="8449141">103</span><span class="op" id="8449144">,</span>&nbsp;<span class="num" id="8449146">121</span><span class="op" id="8449149">,</span>&nbsp;<span class="num" id="8449151">120</span><span class="op" id="8449154">,</span>&nbsp;<span class="num" id="8449156">101</span><span class="op" id="8449159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449163">72</span><span class="op" id="8449165">,</span>&nbsp;<span class="num" id="8449167">92</span><span class="op" id="8449169">,</span>&nbsp;<span class="num" id="8449171">95</span><span class="op" id="8449173">,</span>&nbsp;<span class="num" id="8449175">98</span><span class="op" id="8449177">,</span>&nbsp;<span class="num" id="8449179">112</span><span class="op" id="8449182">,</span>&nbsp;<span class="num" id="8449184">100</span><span class="op" id="8449187">,</span>&nbsp;<span class="num" id="8449189">103</span><span class="op" id="8449192">,</span>&nbsp;<span class="num" id="8449194">99</span><span class="op" id="8449196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449199">}</span><span class="op" id="8449200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8449203">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449220">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449224">17</span><span class="op" id="8449226">,</span>&nbsp;<span class="num" id="8449228">18</span><span class="op" id="8449230">,</span>&nbsp;<span class="num" id="8449232">24</span><span class="op" id="8449234">,</span>&nbsp;<span class="num" id="8449236">47</span><span class="op" id="8449238">,</span>&nbsp;<span class="num" id="8449240">99</span><span class="op" id="8449242">,</span>&nbsp;<span class="num" id="8449244">99</span><span class="op" id="8449246">,</span>&nbsp;<span class="num" id="8449248">99</span><span class="op" id="8449250">,</span>&nbsp;<span class="num" id="8449252">99</span><span class="op" id="8449254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449258">18</span><span class="op" id="8449260">,</span>&nbsp;<span class="num" id="8449262">21</span><span class="op" id="8449264">,</span>&nbsp;<span class="num" id="8449266">26</span><span class="op" id="8449268">,</span>&nbsp;<span class="num" id="8449270">66</span><span class="op" id="8449272">,</span>&nbsp;<span class="num" id="8449274">99</span><span class="op" id="8449276">,</span>&nbsp;<span class="num" id="8449278">99</span><span class="op" id="8449280">,</span>&nbsp;<span class="num" id="8449282">99</span><span class="op" id="8449284">,</span>&nbsp;<span class="num" id="8449286">99</span><span class="op" id="8449288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449292">24</span><span class="op" id="8449294">,</span>&nbsp;<span class="num" id="8449296">26</span><span class="op" id="8449298">,</span>&nbsp;<span class="num" id="8449300">56</span><span class="op" id="8449302">,</span>&nbsp;<span class="num" id="8449304">99</span><span class="op" id="8449306">,</span>&nbsp;<span class="num" id="8449308">99</span><span class="op" id="8449310">,</span>&nbsp;<span class="num" id="8449312">99</span><span class="op" id="8449314">,</span>&nbsp;<span class="num" id="8449316">99</span><span class="op" id="8449318">,</span>&nbsp;<span class="num" id="8449320">99</span><span class="op" id="8449322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449326">47</span><span class="op" id="8449328">,</span>&nbsp;<span class="num" id="8449330">66</span><span class="op" id="8449332">,</span>&nbsp;<span class="num" id="8449334">99</span><span class="op" id="8449336">,</span>&nbsp;<span class="num" id="8449338">99</span><span class="op" id="8449340">,</span>&nbsp;<span class="num" id="8449342">99</span><span class="op" id="8449344">,</span>&nbsp;<span class="num" id="8449346">99</span><span class="op" id="8449348">,</span>&nbsp;<span class="num" id="8449350">99</span><span class="op" id="8449352">,</span>&nbsp;<span class="num" id="8449354">99</span><span class="op" id="8449356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449360">99</span><span class="op" id="8449362">,</span>&nbsp;<span class="num" id="8449364">99</span><span class="op" id="8449366">,</span>&nbsp;<span class="num" id="8449368">99</span><span class="op" id="8449370">,</span>&nbsp;<span class="num" id="8449372">99</span><span class="op" id="8449374">,</span>&nbsp;<span class="num" id="8449376">99</span><span class="op" id="8449378">,</span>&nbsp;<span class="num" id="8449380">99</span><span class="op" id="8449382">,</span>&nbsp;<span class="num" id="8449384">99</span><span class="op" id="8449386">,</span>&nbsp;<span class="num" id="8449388">99</span><span class="op" id="8449390">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449394">99</span><span class="op" id="8449396">,</span>&nbsp;<span class="num" id="8449398">99</span><span class="op" id="8449400">,</span>&nbsp;<span class="num" id="8449402">99</span><span class="op" id="8449404">,</span>&nbsp;<span class="num" id="8449406">99</span><span class="op" id="8449408">,</span>&nbsp;<span class="num" id="8449410">99</span><span class="op" id="8449412">,</span>&nbsp;<span class="num" id="8449414">99</span><span class="op" id="8449416">,</span>&nbsp;<span class="num" id="8449418">99</span><span class="op" id="8449420">,</span>&nbsp;<span class="num" id="8449422">99</span><span class="op" id="8449424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449428">99</span><span class="op" id="8449430">,</span>&nbsp;<span class="num" id="8449432">99</span><span class="op" id="8449434">,</span>&nbsp;<span class="num" id="8449436">99</span><span class="op" id="8449438">,</span>&nbsp;<span class="num" id="8449440">99</span><span class="op" id="8449442">,</span>&nbsp;<span class="num" id="8449444">99</span><span class="op" id="8449446">,</span>&nbsp;<span class="num" id="8449448">99</span><span class="op" id="8449450">,</span>&nbsp;<span class="num" id="8449452">99</span><span class="op" id="8449454">,</span>&nbsp;<span class="num" id="8449456">99</span><span class="op" id="8449458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8449462">99</span><span class="op" id="8449464">,</span>&nbsp;<span class="num" id="8449466">99</span><span class="op" id="8449468">,</span>&nbsp;<span class="num" id="8449470">99</span><span class="op" id="8449472">,</span>&nbsp;<span class="num" id="8449474">99</span><span class="op" id="8449476">,</span>&nbsp;<span class="num" id="8449478">99</span><span class="op" id="8449480">,</span>&nbsp;<span class="num" id="8449482">99</span><span class="op" id="8449484">,</span>&nbsp;<span class="num" id="8449486">99</span><span class="op" id="8449488">,</span>&nbsp;<span class="num" id="8449490">99</span><span class="op" id="8449492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449495">}</span><span class="op" id="8449496">,</span><br>
<span class="lineno"></span><span class="op" id="8449498">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8449501">func</span>&nbsp;<span class="ident" id="8449506">TestUnscaledQuant</span><span class="op" id="8449523">(</span><span class="ident" id="8449524">t</span>&nbsp;<span class="op" id="8449526">*</span><span class="ident" id="8449527">testing</span><span class="op" id="8449534">.</span><span class="ident" id="8449535">T</span><span class="op" id="8449536">)</span>&nbsp;<span class="op" id="8449538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449541">bad</span>&nbsp;<span class="op" id="8449545">:=</span>&nbsp;<span class="builtintype" id="8449548">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8449555">for</span>&nbsp;<span class="ident" id="8449559">i</span>&nbsp;<span class="op" id="8449561">:=</span>&nbsp;<span class="ident" id="8449564">quantIndex</span><span class="op" id="8449574">(</span><span class="num" id="8449575">0</span><span class="op" id="8449576">)</span><span class="op" id="8449577">;</span>&nbsp;<span class="ident" id="8449579">i</span>&nbsp;<span class="op" id="8449581">&lt;</span>&nbsp;<span class="ident" id="8449583">nQuantIndex</span><span class="op" id="8449594">;</span>&nbsp;<span class="ident" id="8449596">i</span><span class="op" id="8449597">++</span>&nbsp;<span class="op" id="8449600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8449604">for</span>&nbsp;<span class="ident" id="8449608">zig</span>&nbsp;<span class="op" id="8449612">:=</span>&nbsp;<span class="num" id="8449615">0</span><span class="op" id="8449616">;</span>&nbsp;<span class="ident" id="8449618">zig</span>&nbsp;<span class="op" id="8449622">&lt;</span>&nbsp;<span class="ident" id="8449624">blockSize</span><span class="op" id="8449633">;</span>&nbsp;<span class="ident" id="8449635">zig</span><span class="op" id="8449638">++</span>&nbsp;<span class="op" id="8449641">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449646">got</span>&nbsp;<span class="op" id="8449650">:=</span>&nbsp;<span class="ident" id="8449653">unscaledQuant</span><span class="op" id="8449666">[</span><span class="ident" id="8449667">i</span><span class="op" id="8449668">]</span><span class="op" id="8449669">[</span><span class="ident" id="8449670">zig</span><span class="op" id="8449673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449678">want</span>&nbsp;<span class="op" id="8449683">:=</span>&nbsp;<span class="ident" id="8449686">unscaledQuantInNaturalOrder</span><span class="op" id="8449713">[</span><span class="ident" id="8449714">i</span><span class="op" id="8449715">]</span><span class="op" id="8449716">[</span><span class="ident" id="8449717">unzig</span><span class="op" id="8449722">[</span><span class="ident" id="8449723">zig</span><span class="op" id="8449726">]</span><span class="op" id="8449727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8449732">if</span>&nbsp;<span class="ident" id="8449735">got</span>&nbsp;<span class="op" id="8449739">!=</span>&nbsp;<span class="ident" id="8449742">want</span>&nbsp;<span class="op" id="8449747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449753">t</span><span class="op" id="8449754">.</span><span class="ident" id="8449755">Errorf</span><span class="op" id="8449761">(</span><span class="string" id="8449762">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8449793">,</span>&nbsp;<span class="ident" id="8449795">i</span><span class="op" id="8449796">,</span>&nbsp;<span class="ident" id="8449798">zig</span><span class="op" id="8449801">,</span>&nbsp;<span class="ident" id="8449803">got</span><span class="op" id="8449806">,</span>&nbsp;<span class="ident" id="8449808">want</span><span class="op" id="8449812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449818">bad</span>&nbsp;<span class="op" id="8449822">=</span>&nbsp;<span class="builtintype" id="8449824">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8449842">if</span>&nbsp;<span class="ident" id="8449845">bad</span>&nbsp;<span class="op" id="8449849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449853">names</span>&nbsp;<span class="op" id="8449859">:=</span>&nbsp;<span class="op" id="8449862">[</span><span class="ident" id="8449863">nQuantIndex</span><span class="op" id="8449874">]</span><span class="builtintype" id="8449875">string</span><span class="op" id="8449881">{</span><span class="string" id="8449882">&#34;Luminance&#34;</span><span class="op" id="8449893">,</span>&nbsp;<span class="string" id="8449895">&#34;Chrominance&#34;</span><span class="op" id="8449908">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449912">buf</span>&nbsp;<span class="op" id="8449916">:=</span>&nbsp;<span class="op" id="8449919">&amp;</span><span class="ident" id="8449920">bytes</span><span class="op" id="8449925">.</span><span class="ident" id="8449926">Buffer</span><span class="op" id="8449932">{</span><span class="op" id="8449933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8449937">for</span>&nbsp;<span class="ident" id="8449941">i</span><span class="op" id="8449942">,</span>&nbsp;<span class="ident" id="8449944">name</span>&nbsp;<span class="op" id="8449949">:=</span>&nbsp;<span class="keyword" id="8449952">range</span>&nbsp;<span class="ident" id="8449958">names</span>&nbsp;<span class="op" id="8449964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449969">fmt</span><span class="op" id="8449972">.</span><span class="ident" id="8449973">Fprintf</span><span class="op" id="8449980">(</span><span class="ident" id="8449981">buf</span><span class="op" id="8449984">,</span>&nbsp;<span class="string" id="8449986">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="8449999">,</span>&nbsp;<span class="ident" id="8450001">name</span><span class="op" id="8450005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450010">for</span>&nbsp;<span class="ident" id="8450014">zig</span>&nbsp;<span class="op" id="8450018">:=</span>&nbsp;<span class="num" id="8450021">0</span><span class="op" id="8450022">;</span>&nbsp;<span class="ident" id="8450024">zig</span>&nbsp;<span class="op" id="8450028">&lt;</span>&nbsp;<span class="ident" id="8450030">blockSize</span><span class="op" id="8450039">;</span>&nbsp;<span class="ident" id="8450041">zig</span><span class="op" id="8450044">++</span>&nbsp;<span class="op" id="8450047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450053">fmt</span><span class="op" id="8450056">.</span><span class="ident" id="8450057">Fprintf</span><span class="op" id="8450064">(</span><span class="ident" id="8450065">buf</span><span class="op" id="8450068">,</span>&nbsp;<span class="string" id="8450070">&#34;%d,&nbsp;&#34;</span><span class="op" id="8450076">,</span>&nbsp;<span class="ident" id="8450078">unscaledQuantInNaturalOrder</span><span class="op" id="8450105">[</span><span class="ident" id="8450106">i</span><span class="op" id="8450107">]</span><span class="op" id="8450108">[</span><span class="ident" id="8450109">unzig</span><span class="op" id="8450114">[</span><span class="ident" id="8450115">zig</span><span class="op" id="8450118">]</span><span class="op" id="8450119">]</span><span class="op" id="8450120">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450126">if</span>&nbsp;<span class="ident" id="8450129">zig</span><span class="op" id="8450132">%</span><span class="num" id="8450133">8</span>&nbsp;<span class="op" id="8450135">==</span>&nbsp;<span class="num" id="8450138">7</span>&nbsp;<span class="op" id="8450140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450147">buf</span><span class="op" id="8450150">.</span><span class="ident" id="8450151">WriteString</span><span class="op" id="8450162">(</span><span class="string" id="8450163">&#34;\n&#34;</span><span class="op" id="8450167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450183">buf</span><span class="op" id="8450186">.</span><span class="ident" id="8450187">WriteString</span><span class="op" id="8450198">(</span><span class="string" id="8450199">&#34;},\n&#34;</span><span class="op" id="8450205">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450213">t</span><span class="op" id="8450214">.</span><span class="ident" id="8450215">Logf</span><span class="op" id="8450219">(</span><span class="string" id="8450220">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="8450256">,</span>&nbsp;<span class="ident" id="8450258">buf</span><span class="op" id="8450261">.</span><span class="ident" id="8450262">String</span><span class="op" id="8450268">(</span><span class="op" id="8450269">)</span><span class="op" id="8450270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450273">}</span><br>
<span class="lineno"></span><span class="op" id="8450275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="8450278">var</span>&nbsp;<span class="ident" id="8450282">testCase</span>&nbsp;<span class="op" id="8450291">=</span>&nbsp;<span class="op" id="8450293">[</span><span class="op" id="8450294">]</span><span class="keyword" id="8450295">struct</span>&nbsp;<span class="op" id="8450302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450305">filename</span>&nbsp;&nbsp;<span class="builtintype" id="8450315">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450323">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8450333">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450338">tolerance</span>&nbsp;<span class="builtintype" id="8450348">int64</span><br>
<span class="lineno"></span><span class="op" id="8450354">}</span><span class="op" id="8450355">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450358">{</span><span class="string" id="8450359">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8450386">,</span>&nbsp;<span class="num" id="8450388">1</span><span class="op" id="8450389">,</span>&nbsp;<span class="num" id="8450391">24</span>&nbsp;<span class="op" id="8450394">&lt;&lt;</span>&nbsp;<span class="num" id="8450397">8</span><span class="op" id="8450398">}</span><span class="op" id="8450399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450402">{</span><span class="string" id="8450403">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8450430">,</span>&nbsp;<span class="num" id="8450432">20</span><span class="op" id="8450434">,</span>&nbsp;<span class="num" id="8450436">12</span>&nbsp;<span class="op" id="8450439">&lt;&lt;</span>&nbsp;<span class="num" id="8450442">8</span><span class="op" id="8450443">}</span><span class="op" id="8450444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450447">{</span><span class="string" id="8450448">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8450475">,</span>&nbsp;<span class="num" id="8450477">60</span><span class="op" id="8450479">,</span>&nbsp;<span class="num" id="8450481">8</span>&nbsp;<span class="op" id="8450483">&lt;&lt;</span>&nbsp;<span class="num" id="8450486">8</span><span class="op" id="8450487">}</span><span class="op" id="8450488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450491">{</span><span class="string" id="8450492">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8450519">,</span>&nbsp;<span class="num" id="8450521">80</span><span class="op" id="8450523">,</span>&nbsp;<span class="num" id="8450525">6</span>&nbsp;<span class="op" id="8450527">&lt;&lt;</span>&nbsp;<span class="num" id="8450530">8</span><span class="op" id="8450531">}</span><span class="op" id="8450532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450535">{</span><span class="string" id="8450536">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8450563">,</span>&nbsp;<span class="num" id="8450565">90</span><span class="op" id="8450567">,</span>&nbsp;<span class="num" id="8450569">4</span>&nbsp;<span class="op" id="8450571">&lt;&lt;</span>&nbsp;<span class="num" id="8450574">8</span><span class="op" id="8450575">}</span><span class="op" id="8450576">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450579">{</span><span class="string" id="8450580">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8450607">,</span>&nbsp;<span class="num" id="8450609">100</span><span class="op" id="8450612">,</span>&nbsp;<span class="num" id="8450614">2</span>&nbsp;<span class="op" id="8450616">&lt;&lt;</span>&nbsp;<span class="num" id="8450619">8</span><span class="op" id="8450620">}</span><span class="op" id="8450621">,</span><br>
<span class="lineno"></span><span class="op" id="8450623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8450626">func</span>&nbsp;<span class="ident" id="8450631">delta</span><span class="op" id="8450636">(</span><span class="ident" id="8450637">u0</span><span class="op" id="8450639">,</span>&nbsp;<span class="ident" id="8450641">u1</span>&nbsp;<span class="builtintype" id="8450644">uint32</span><span class="op" id="8450650">)</span>&nbsp;<span class="builtintype" id="8450652">int64</span>&nbsp;<span class="op" id="8450658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450661">d</span>&nbsp;<span class="op" id="8450663">:=</span>&nbsp;<span class="builtintype" id="8450666">int64</span><span class="op" id="8450671">(</span><span class="ident" id="8450672">u0</span><span class="op" id="8450674">)</span>&nbsp;<span class="op" id="8450676">-</span>&nbsp;<span class="builtintype" id="8450678">int64</span><span class="op" id="8450683">(</span><span class="ident" id="8450684">u1</span><span class="op" id="8450686">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450689">if</span>&nbsp;<span class="ident" id="8450692">d</span>&nbsp;<span class="op" id="8450694">&lt;</span>&nbsp;<span class="num" id="8450696">0</span>&nbsp;<span class="op" id="8450698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450702">return</span>&nbsp;<span class="op" id="8450709">-</span><span class="ident" id="8450710">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450716">return</span>&nbsp;<span class="ident" id="8450723">d</span><br>
<span class="lineno"></span><span class="op" id="8450725">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="8450728">func</span>&nbsp;<span class="ident" id="8450733">readPng</span><span class="op" id="8450740">(</span><span class="ident" id="8450741">filename</span>&nbsp;<span class="builtintype" id="8450750">string</span><span class="op" id="8450756">)</span>&nbsp;<span class="op" id="8450758">(</span><span class="ident" id="8450759">image</span><span class="op" id="8450764">.</span><span class="ident" id="8450765">Image</span><span class="op" id="8450770">,</span>&nbsp;<span class="builtintype" id="8450772">error</span><span class="op" id="8450777">)</span>&nbsp;<span class="op" id="8450779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450782">f</span><span class="op" id="8450783">,</span>&nbsp;<span class="ident" id="8450785">err</span>&nbsp;<span class="op" id="8450789">:=</span>&nbsp;<span class="ident" id="8450792">os</span><span class="op" id="8450794">.</span><span class="ident" id="8450795">Open</span><span class="op" id="8450799">(</span><span class="ident" id="8450800">filename</span><span class="op" id="8450808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450811">if</span>&nbsp;<span class="ident" id="8450814">err</span>&nbsp;<span class="op" id="8450818">!=</span>&nbsp;<span class="builtintype" id="8450821">nil</span>&nbsp;<span class="op" id="8450825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450829">return</span>&nbsp;<span class="builtintype" id="8450836">nil</span><span class="op" id="8450839">,</span>&nbsp;<span class="ident" id="8450841">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450849">defer</span>&nbsp;<span class="ident" id="8450855">f</span><span class="op" id="8450856">.</span><span class="ident" id="8450857">Close</span><span class="op" id="8450862">(</span><span class="op" id="8450863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450866">return</span>&nbsp;<span class="ident" id="8450873">png</span><span class="op" id="8450876">.</span><span class="ident" id="8450877">Decode</span><span class="op" id="8450883">(</span><span class="ident" id="8450884">f</span><span class="op" id="8450885">)</span><br>
<span class="lineno"></span><span class="op" id="8450887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8450890">func</span>&nbsp;<span class="ident" id="8450895">TestWriter</span><span class="op" id="8450905">(</span><span class="ident" id="8450906">t</span>&nbsp;<span class="op" id="8450908">*</span><span class="ident" id="8450909">testing</span><span class="op" id="8450916">.</span><span class="ident" id="8450917">T</span><span class="op" id="8450918">)</span>&nbsp;<span class="op" id="8450920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450923">for</span>&nbsp;<span class="ident" id="8450927">_</span><span class="op" id="8450928">,</span>&nbsp;<span class="ident" id="8450930">tc</span>&nbsp;<span class="op" id="8450933">:=</span>&nbsp;<span class="keyword" id="8450936">range</span>&nbsp;<span class="ident" id="8450942">testCase</span>&nbsp;<span class="op" id="8450951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8450955">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450976">m0</span><span class="op" id="8450978">,</span>&nbsp;<span class="ident" id="8450980">err</span>&nbsp;<span class="op" id="8450984">:=</span>&nbsp;<span class="ident" id="8450987">readPng</span><span class="op" id="8450994">(</span><span class="ident" id="8450995">tc</span><span class="op" id="8450997">.</span><span class="ident" id="8450998">filename</span><span class="op" id="8451006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451010">if</span>&nbsp;<span class="ident" id="8451013">err</span>&nbsp;<span class="op" id="8451017">!=</span>&nbsp;<span class="builtintype" id="8451020">nil</span>&nbsp;<span class="op" id="8451024">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451029">t</span><span class="op" id="8451030">.</span><span class="ident" id="8451031">Error</span><span class="op" id="8451036">(</span><span class="ident" id="8451037">tc</span><span class="op" id="8451039">.</span><span class="ident" id="8451040">filename</span><span class="op" id="8451048">,</span>&nbsp;<span class="ident" id="8451050">err</span><span class="op" id="8451053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451058">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8451073">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451105">var</span>&nbsp;<span class="ident" id="8451109">buf</span>&nbsp;<span class="ident" id="8451113">bytes</span><span class="op" id="8451118">.</span><span class="ident" id="8451119">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451128">err</span>&nbsp;<span class="op" id="8451132">=</span>&nbsp;<span class="ident" id="8451134">Encode</span><span class="op" id="8451140">(</span><span class="op" id="8451141">&amp;</span><span class="ident" id="8451142">buf</span><span class="op" id="8451145">,</span>&nbsp;<span class="ident" id="8451147">m0</span><span class="op" id="8451149">,</span>&nbsp;<span class="op" id="8451151">&amp;</span><span class="ident" id="8451152">Options</span><span class="op" id="8451159">{</span><span class="ident" id="8451160">Quality</span><span class="op" id="8451167">:</span>&nbsp;<span class="ident" id="8451169">tc</span><span class="op" id="8451171">.</span><span class="ident" id="8451172">quality</span><span class="op" id="8451179">}</span><span class="op" id="8451180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451184">if</span>&nbsp;<span class="ident" id="8451187">err</span>&nbsp;<span class="op" id="8451191">!=</span>&nbsp;<span class="builtintype" id="8451194">nil</span>&nbsp;<span class="op" id="8451198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451203">t</span><span class="op" id="8451204">.</span><span class="ident" id="8451205">Error</span><span class="op" id="8451210">(</span><span class="ident" id="8451211">tc</span><span class="op" id="8451213">.</span><span class="ident" id="8451214">filename</span><span class="op" id="8451222">,</span>&nbsp;<span class="ident" id="8451224">err</span><span class="op" id="8451227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451232">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451243">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8451247">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451270">m1</span><span class="op" id="8451272">,</span>&nbsp;<span class="ident" id="8451274">err</span>&nbsp;<span class="op" id="8451278">:=</span>&nbsp;<span class="ident" id="8451281">Decode</span><span class="op" id="8451287">(</span><span class="op" id="8451288">&amp;</span><span class="ident" id="8451289">buf</span><span class="op" id="8451292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451296">if</span>&nbsp;<span class="ident" id="8451299">err</span>&nbsp;<span class="op" id="8451303">!=</span>&nbsp;<span class="builtintype" id="8451306">nil</span>&nbsp;<span class="op" id="8451310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451315">t</span><span class="op" id="8451316">.</span><span class="ident" id="8451317">Error</span><span class="op" id="8451322">(</span><span class="ident" id="8451323">tc</span><span class="op" id="8451325">.</span><span class="ident" id="8451326">filename</span><span class="op" id="8451334">,</span>&nbsp;<span class="ident" id="8451336">err</span><span class="op" id="8451339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451344">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451359">if</span>&nbsp;<span class="ident" id="8451362">m0</span><span class="op" id="8451364">.</span><span class="ident" id="8451365">Bounds</span><span class="op" id="8451371">(</span><span class="op" id="8451372">)</span>&nbsp;<span class="op" id="8451374">!=</span>&nbsp;<span class="ident" id="8451377">m1</span><span class="op" id="8451379">.</span><span class="ident" id="8451380">Bounds</span><span class="op" id="8451386">(</span><span class="op" id="8451387">)</span>&nbsp;<span class="op" id="8451389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451394">t</span><span class="op" id="8451395">.</span><span class="ident" id="8451396">Errorf</span><span class="op" id="8451402">(</span><span class="string" id="8451403">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8451433">,</span>&nbsp;<span class="ident" id="8451435">tc</span><span class="op" id="8451437">.</span><span class="ident" id="8451438">filename</span><span class="op" id="8451446">,</span>&nbsp;<span class="ident" id="8451448">m0</span><span class="op" id="8451450">.</span><span class="ident" id="8451451">Bounds</span><span class="op" id="8451457">(</span><span class="op" id="8451458">)</span><span class="op" id="8451459">,</span>&nbsp;<span class="ident" id="8451461">m1</span><span class="op" id="8451463">.</span><span class="ident" id="8451464">Bounds</span><span class="op" id="8451470">(</span><span class="op" id="8451471">)</span><span class="op" id="8451472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451477">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451488">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8451492">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451547">if</span>&nbsp;<span class="ident" id="8451550">averageDelta</span><span class="op" id="8451562">(</span><span class="ident" id="8451563">m0</span><span class="op" id="8451565">,</span>&nbsp;<span class="ident" id="8451567">m1</span><span class="op" id="8451569">)</span>&nbsp;<span class="op" id="8451571">&gt;</span>&nbsp;<span class="ident" id="8451573">tc</span><span class="op" id="8451575">.</span><span class="ident" id="8451576">tolerance</span>&nbsp;<span class="op" id="8451586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451591">t</span><span class="op" id="8451592">.</span><span class="ident" id="8451593">Errorf</span><span class="op" id="8451599">(</span><span class="string" id="8451600">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="8451643">,</span>&nbsp;<span class="ident" id="8451645">tc</span><span class="op" id="8451647">.</span><span class="ident" id="8451648">filename</span><span class="op" id="8451656">,</span>&nbsp;<span class="ident" id="8451658">tc</span><span class="op" id="8451660">.</span><span class="ident" id="8451661">quality</span><span class="op" id="8451668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451673">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451684">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451687">}</span><br>
<span class="lineno"></span><span class="op" id="8451689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8451692">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="8451766">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="8451798">func</span>&nbsp;<span class="ident" id="8451803">TestWriteGrayscale</span><span class="op" id="8451821">(</span><span class="ident" id="8451822">t</span>&nbsp;<span class="op" id="8451824">*</span><span class="ident" id="8451825">testing</span><span class="op" id="8451832">.</span><span class="ident" id="8451833">T</span><span class="op" id="8451834">)</span>&nbsp;<span class="op" id="8451836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451839">m0</span>&nbsp;<span class="op" id="8451842">:=</span>&nbsp;<span class="ident" id="8451845">image</span><span class="op" id="8451850">.</span><span class="ident" id="8451851">NewGray</span><span class="op" id="8451858">(</span><span class="ident" id="8451859">image</span><span class="op" id="8451864">.</span><span class="ident" id="8451865">Rect</span><span class="op" id="8451869">(</span><span class="num" id="8451870">0</span><span class="op" id="8451871">,</span>&nbsp;<span class="num" id="8451873">0</span><span class="op" id="8451874">,</span>&nbsp;<span class="num" id="8451876">32</span><span class="op" id="8451878">,</span>&nbsp;<span class="num" id="8451880">32</span><span class="op" id="8451882">)</span><span class="op" id="8451883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451886">for</span>&nbsp;<span class="ident" id="8451890">i</span>&nbsp;<span class="op" id="8451892">:=</span>&nbsp;<span class="keyword" id="8451895">range</span>&nbsp;<span class="ident" id="8451901">m0</span><span class="op" id="8451903">.</span><span class="ident" id="8451904">Pix</span>&nbsp;<span class="op" id="8451908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451912">m0</span><span class="op" id="8451914">.</span><span class="ident" id="8451915">Pix</span><span class="op" id="8451918">[</span><span class="ident" id="8451919">i</span><span class="op" id="8451920">]</span>&nbsp;<span class="op" id="8451922">=</span>&nbsp;<span class="builtintype" id="8451924">uint8</span><span class="op" id="8451929">(</span><span class="ident" id="8451930">i</span><span class="op" id="8451931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451934">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451937">var</span>&nbsp;<span class="ident" id="8451941">buf</span>&nbsp;<span class="ident" id="8451945">bytes</span><span class="op" id="8451950">.</span><span class="ident" id="8451951">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451959">if</span>&nbsp;<span class="ident" id="8451962">err</span>&nbsp;<span class="op" id="8451966">:=</span>&nbsp;<span class="ident" id="8451969">Encode</span><span class="op" id="8451975">(</span><span class="op" id="8451976">&amp;</span><span class="ident" id="8451977">buf</span><span class="op" id="8451980">,</span>&nbsp;<span class="ident" id="8451982">m0</span><span class="op" id="8451984">,</span>&nbsp;<span class="builtintype" id="8451986">nil</span><span class="op" id="8451989">)</span><span class="op" id="8451990">;</span>&nbsp;<span class="ident" id="8451992">err</span>&nbsp;<span class="op" id="8451996">!=</span>&nbsp;<span class="builtintype" id="8451999">nil</span>&nbsp;<span class="op" id="8452003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452007">t</span><span class="op" id="8452008">.</span><span class="ident" id="8452009">Fatal</span><span class="op" id="8452014">(</span><span class="ident" id="8452015">err</span><span class="op" id="8452018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452024">m1</span><span class="op" id="8452026">,</span>&nbsp;<span class="ident" id="8452028">err</span>&nbsp;<span class="op" id="8452032">:=</span>&nbsp;<span class="ident" id="8452035">Decode</span><span class="op" id="8452041">(</span><span class="op" id="8452042">&amp;</span><span class="ident" id="8452043">buf</span><span class="op" id="8452046">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452049">if</span>&nbsp;<span class="ident" id="8452052">err</span>&nbsp;<span class="op" id="8452056">!=</span>&nbsp;<span class="builtintype" id="8452059">nil</span>&nbsp;<span class="op" id="8452063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452067">t</span><span class="op" id="8452068">.</span><span class="ident" id="8452069">Fatal</span><span class="op" id="8452074">(</span><span class="ident" id="8452075">err</span><span class="op" id="8452078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452084">if</span>&nbsp;<span class="ident" id="8452087">m0</span><span class="op" id="8452089">.</span><span class="ident" id="8452090">Bounds</span><span class="op" id="8452096">(</span><span class="op" id="8452097">)</span>&nbsp;<span class="op" id="8452099">!=</span>&nbsp;<span class="ident" id="8452102">m1</span><span class="op" id="8452104">.</span><span class="ident" id="8452105">Bounds</span><span class="op" id="8452111">(</span><span class="op" id="8452112">)</span>&nbsp;<span class="op" id="8452114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452118">t</span><span class="op" id="8452119">.</span><span class="ident" id="8452120">Fatalf</span><span class="op" id="8452126">(</span><span class="string" id="8452127">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8452153">,</span>&nbsp;<span class="ident" id="8452155">m0</span><span class="op" id="8452157">.</span><span class="ident" id="8452158">Bounds</span><span class="op" id="8452164">(</span><span class="op" id="8452165">)</span><span class="op" id="8452166">,</span>&nbsp;<span class="ident" id="8452168">m1</span><span class="op" id="8452170">.</span><span class="ident" id="8452171">Bounds</span><span class="op" id="8452177">(</span><span class="op" id="8452178">)</span><span class="op" id="8452179">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452185">if</span>&nbsp;<span class="ident" id="8452188">_</span><span class="op" id="8452189">,</span>&nbsp;<span class="ident" id="8452191">ok</span>&nbsp;<span class="op" id="8452194">:=</span>&nbsp;<span class="ident" id="8452197">m1</span><span class="op" id="8452199">.</span><span class="op" id="8452200">(</span><span class="op" id="8452201">*</span><span class="ident" id="8452202">image</span><span class="op" id="8452207">.</span><span class="ident" id="8452208">Gray</span><span class="op" id="8452212">)</span><span class="op" id="8452213">;</span>&nbsp;<span class="op" id="8452215">!</span><span class="ident" id="8452216">ok</span>&nbsp;<span class="op" id="8452219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452223">t</span><span class="op" id="8452224">.</span><span class="ident" id="8452225">Errorf</span><span class="op" id="8452231">(</span><span class="string" id="8452232">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="8452258">,</span>&nbsp;<span class="ident" id="8452260">m1</span><span class="op" id="8452262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8452268">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452322">want</span>&nbsp;<span class="op" id="8452327">:=</span>&nbsp;<span class="builtintype" id="8452330">int64</span><span class="op" id="8452335">(</span><span class="num" id="8452336">2</span>&nbsp;<span class="op" id="8452338">&lt;&lt;</span>&nbsp;<span class="num" id="8452341">8</span><span class="op" id="8452342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452345">if</span>&nbsp;<span class="ident" id="8452348">got</span>&nbsp;<span class="op" id="8452352">:=</span>&nbsp;<span class="ident" id="8452355">averageDelta</span><span class="op" id="8452367">(</span><span class="ident" id="8452368">m0</span><span class="op" id="8452370">,</span>&nbsp;<span class="ident" id="8452372">m1</span><span class="op" id="8452374">)</span><span class="op" id="8452375">;</span>&nbsp;<span class="ident" id="8452377">got</span>&nbsp;<span class="op" id="8452381">&gt;</span>&nbsp;<span class="ident" id="8452383">want</span>&nbsp;<span class="op" id="8452388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452392">t</span><span class="op" id="8452393">.</span><span class="ident" id="8452394">Errorf</span><span class="op" id="8452400">(</span><span class="string" id="8452401">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="8452445">,</span>&nbsp;<span class="ident" id="8452447">got</span><span class="op" id="8452450">,</span>&nbsp;<span class="ident" id="8452452">want</span><span class="op" id="8452456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452459">}</span><br>
<span class="lineno"></span><span class="op" id="8452461">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="8452464">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="8452540">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8452565">func</span>&nbsp;<span class="ident" id="8452570">averageDelta</span><span class="op" id="8452582">(</span><span class="ident" id="8452583">m0</span><span class="op" id="8452585">,</span>&nbsp;<span class="ident" id="8452587">m1</span>&nbsp;<span class="ident" id="8452590">image</span><span class="op" id="8452595">.</span><span class="ident" id="8452596">Image</span><span class="op" id="8452601">)</span>&nbsp;<span class="builtintype" id="8452603">int64</span>&nbsp;<span class="op" id="8452609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452612">b</span>&nbsp;<span class="op" id="8452614">:=</span>&nbsp;<span class="ident" id="8452617">m0</span><span class="op" id="8452619">.</span><span class="ident" id="8452620">Bounds</span><span class="op" id="8452626">(</span><span class="op" id="8452627">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452630">var</span>&nbsp;<span class="ident" id="8452634">sum</span><span class="op" id="8452637">,</span>&nbsp;<span class="ident" id="8452639">n</span>&nbsp;<span class="builtintype" id="8452641">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452648">for</span>&nbsp;<span class="ident" id="8452652">y</span>&nbsp;<span class="op" id="8452654">:=</span>&nbsp;<span class="ident" id="8452657">b</span><span class="op" id="8452658">.</span><span class="ident" id="8452659">Min</span><span class="op" id="8452662">.</span><span class="ident" id="8452663">Y</span><span class="op" id="8452664">;</span>&nbsp;<span class="ident" id="8452666">y</span>&nbsp;<span class="op" id="8452668">&lt;</span>&nbsp;<span class="ident" id="8452670">b</span><span class="op" id="8452671">.</span><span class="ident" id="8452672">Max</span><span class="op" id="8452675">.</span><span class="ident" id="8452676">Y</span><span class="op" id="8452677">;</span>&nbsp;<span class="ident" id="8452679">y</span><span class="op" id="8452680">++</span>&nbsp;<span class="op" id="8452683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452687">for</span>&nbsp;<span class="ident" id="8452691">x</span>&nbsp;<span class="op" id="8452693">:=</span>&nbsp;<span class="ident" id="8452696">b</span><span class="op" id="8452697">.</span><span class="ident" id="8452698">Min</span><span class="op" id="8452701">.</span><span class="ident" id="8452702">X</span><span class="op" id="8452703">;</span>&nbsp;<span class="ident" id="8452705">x</span>&nbsp;<span class="op" id="8452707">&lt;</span>&nbsp;<span class="ident" id="8452709">b</span><span class="op" id="8452710">.</span><span class="ident" id="8452711">Max</span><span class="op" id="8452714">.</span><span class="ident" id="8452715">X</span><span class="op" id="8452716">;</span>&nbsp;<span class="ident" id="8452718">x</span><span class="op" id="8452719">++</span>&nbsp;<span class="op" id="8452722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452727">c0</span>&nbsp;<span class="op" id="8452730">:=</span>&nbsp;<span class="ident" id="8452733">m0</span><span class="op" id="8452735">.</span><span class="ident" id="8452736">At</span><span class="op" id="8452738">(</span><span class="ident" id="8452739">x</span><span class="op" id="8452740">,</span>&nbsp;<span class="ident" id="8452742">y</span><span class="op" id="8452743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452748">c1</span>&nbsp;<span class="op" id="8452751">:=</span>&nbsp;<span class="ident" id="8452754">m1</span><span class="op" id="8452756">.</span><span class="ident" id="8452757">At</span><span class="op" id="8452759">(</span><span class="ident" id="8452760">x</span><span class="op" id="8452761">,</span>&nbsp;<span class="ident" id="8452763">y</span><span class="op" id="8452764">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452769">r0</span><span class="op" id="8452771">,</span>&nbsp;<span class="ident" id="8452773">g0</span><span class="op" id="8452775">,</span>&nbsp;<span class="ident" id="8452777">b0</span><span class="op" id="8452779">,</span>&nbsp;<span class="ident" id="8452781">_</span>&nbsp;<span class="op" id="8452783">:=</span>&nbsp;<span class="ident" id="8452786">c0</span><span class="op" id="8452788">.</span><span class="ident" id="8452789">RGBA</span><span class="op" id="8452793">(</span><span class="op" id="8452794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452799">r1</span><span class="op" id="8452801">,</span>&nbsp;<span class="ident" id="8452803">g1</span><span class="op" id="8452805">,</span>&nbsp;<span class="ident" id="8452807">b1</span><span class="op" id="8452809">,</span>&nbsp;<span class="ident" id="8452811">_</span>&nbsp;<span class="op" id="8452813">:=</span>&nbsp;<span class="ident" id="8452816">c1</span><span class="op" id="8452818">.</span><span class="ident" id="8452819">RGBA</span><span class="op" id="8452823">(</span><span class="op" id="8452824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452829">sum</span>&nbsp;<span class="op" id="8452833">+=</span>&nbsp;<span class="ident" id="8452836">delta</span><span class="op" id="8452841">(</span><span class="ident" id="8452842">r0</span><span class="op" id="8452844">,</span>&nbsp;<span class="ident" id="8452846">r1</span><span class="op" id="8452848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452853">sum</span>&nbsp;<span class="op" id="8452857">+=</span>&nbsp;<span class="ident" id="8452860">delta</span><span class="op" id="8452865">(</span><span class="ident" id="8452866">g0</span><span class="op" id="8452868">,</span>&nbsp;<span class="ident" id="8452870">g1</span><span class="op" id="8452872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452877">sum</span>&nbsp;<span class="op" id="8452881">+=</span>&nbsp;<span class="ident" id="8452884">delta</span><span class="op" id="8452889">(</span><span class="ident" id="8452890">b0</span><span class="op" id="8452892">,</span>&nbsp;<span class="ident" id="8452894">b1</span><span class="op" id="8452896">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452901">n</span>&nbsp;<span class="op" id="8452903">+=</span>&nbsp;<span class="num" id="8452906">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452916">return</span>&nbsp;<span class="ident" id="8452923">sum</span>&nbsp;<span class="op" id="8452927">/</span>&nbsp;<span class="ident" id="8452929">n</span><br>
<span class="lineno"></span><span class="op" id="8452931">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="8452934">func</span>&nbsp;<span class="ident" id="8452939">BenchmarkEncode</span><span class="op" id="8452954">(</span><span class="ident" id="8452955">b</span>&nbsp;<span class="op" id="8452957">*</span><span class="ident" id="8452958">testing</span><span class="op" id="8452965">.</span><span class="ident" id="8452966">B</span><span class="op" id="8452967">)</span>&nbsp;<span class="op" id="8452969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452972">b</span><span class="op" id="8452973">.</span><span class="ident" id="8452974">StopTimer</span><span class="op" id="8452983">(</span><span class="op" id="8452984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452987">img</span>&nbsp;<span class="op" id="8452991">:=</span>&nbsp;<span class="ident" id="8452994">image</span><span class="op" id="8452999">.</span><span class="ident" id="8453000">NewRGBA</span><span class="op" id="8453007">(</span><span class="ident" id="8453008">image</span><span class="op" id="8453013">.</span><span class="ident" id="8453014">Rect</span><span class="op" id="8453018">(</span><span class="num" id="8453019">0</span><span class="op" id="8453020">,</span>&nbsp;<span class="num" id="8453022">0</span><span class="op" id="8453023">,</span>&nbsp;<span class="num" id="8453025">640</span><span class="op" id="8453028">,</span>&nbsp;<span class="num" id="8453030">480</span><span class="op" id="8453033">)</span><span class="op" id="8453034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453037">bo</span>&nbsp;<span class="op" id="8453040">:=</span>&nbsp;<span class="ident" id="8453043">img</span><span class="op" id="8453046">.</span><span class="ident" id="8453047">Bounds</span><span class="op" id="8453053">(</span><span class="op" id="8453054">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453057">rnd</span>&nbsp;<span class="op" id="8453061">:=</span>&nbsp;<span class="ident" id="8453064">rand</span><span class="op" id="8453068">.</span><span class="ident" id="8453069">New</span><span class="op" id="8453072">(</span><span class="ident" id="8453073">rand</span><span class="op" id="8453077">.</span><span class="ident" id="8453078">NewSource</span><span class="op" id="8453087">(</span><span class="num" id="8453088">123</span><span class="op" id="8453091">)</span><span class="op" id="8453092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453095">for</span>&nbsp;<span class="ident" id="8453099">y</span>&nbsp;<span class="op" id="8453101">:=</span>&nbsp;<span class="ident" id="8453104">bo</span><span class="op" id="8453106">.</span><span class="ident" id="8453107">Min</span><span class="op" id="8453110">.</span><span class="ident" id="8453111">Y</span><span class="op" id="8453112">;</span>&nbsp;<span class="ident" id="8453114">y</span>&nbsp;<span class="op" id="8453116">&lt;</span>&nbsp;<span class="ident" id="8453118">bo</span><span class="op" id="8453120">.</span><span class="ident" id="8453121">Max</span><span class="op" id="8453124">.</span><span class="ident" id="8453125">Y</span><span class="op" id="8453126">;</span>&nbsp;<span class="ident" id="8453128">y</span><span class="op" id="8453129">++</span>&nbsp;<span class="op" id="8453132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453136">for</span>&nbsp;<span class="ident" id="8453140">x</span>&nbsp;<span class="op" id="8453142">:=</span>&nbsp;<span class="ident" id="8453145">bo</span><span class="op" id="8453147">.</span><span class="ident" id="8453148">Min</span><span class="op" id="8453151">.</span><span class="ident" id="8453152">X</span><span class="op" id="8453153">;</span>&nbsp;<span class="ident" id="8453155">x</span>&nbsp;<span class="op" id="8453157">&lt;</span>&nbsp;<span class="ident" id="8453159">bo</span><span class="op" id="8453161">.</span><span class="ident" id="8453162">Max</span><span class="op" id="8453165">.</span><span class="ident" id="8453166">X</span><span class="op" id="8453167">;</span>&nbsp;<span class="ident" id="8453169">x</span><span class="op" id="8453170">++</span>&nbsp;<span class="op" id="8453173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453178">img</span><span class="op" id="8453181">.</span><span class="ident" id="8453182">SetRGBA</span><span class="op" id="8453189">(</span><span class="ident" id="8453190">x</span><span class="op" id="8453191">,</span>&nbsp;<span class="ident" id="8453193">y</span><span class="op" id="8453194">,</span>&nbsp;<span class="ident" id="8453196">color</span><span class="op" id="8453201">.</span><span class="ident" id="8453202">RGBA</span><span class="op" id="8453206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8453212">uint8</span><span class="op" id="8453217">(</span><span class="ident" id="8453218">rnd</span><span class="op" id="8453221">.</span><span class="ident" id="8453222">Intn</span><span class="op" id="8453226">(</span><span class="num" id="8453227">256</span><span class="op" id="8453230">)</span><span class="op" id="8453231">)</span><span class="op" id="8453232">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8453238">uint8</span><span class="op" id="8453243">(</span><span class="ident" id="8453244">rnd</span><span class="op" id="8453247">.</span><span class="ident" id="8453248">Intn</span><span class="op" id="8453252">(</span><span class="num" id="8453253">256</span><span class="op" id="8453256">)</span><span class="op" id="8453257">)</span><span class="op" id="8453258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8453264">uint8</span><span class="op" id="8453269">(</span><span class="ident" id="8453270">rnd</span><span class="op" id="8453273">.</span><span class="ident" id="8453274">Intn</span><span class="op" id="8453278">(</span><span class="num" id="8453279">256</span><span class="op" id="8453282">)</span><span class="op" id="8453283">)</span><span class="op" id="8453284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453290">255</span><span class="op" id="8453293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453298">}</span><span class="op" id="8453299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453303">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453309">b</span><span class="op" id="8453310">.</span><span class="ident" id="8453311">SetBytes</span><span class="op" id="8453319">(</span><span class="num" id="8453320">640</span>&nbsp;<span class="op" id="8453324">*</span>&nbsp;<span class="num" id="8453326">480</span>&nbsp;<span class="op" id="8453330">*</span>&nbsp;<span class="num" id="8453332">4</span><span class="op" id="8453333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453336">b</span><span class="op" id="8453337">.</span><span class="ident" id="8453338">StartTimer</span><span class="op" id="8453348">(</span><span class="op" id="8453349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453352">options</span>&nbsp;<span class="op" id="8453360">:=</span>&nbsp;<span class="op" id="8453363">&amp;</span><span class="ident" id="8453364">Options</span><span class="op" id="8453371">{</span><span class="ident" id="8453372">Quality</span><span class="op" id="8453379">:</span>&nbsp;<span class="num" id="8453381">90</span><span class="op" id="8453383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453386">for</span>&nbsp;<span class="ident" id="8453390">i</span>&nbsp;<span class="op" id="8453392">:=</span>&nbsp;<span class="num" id="8453395">0</span><span class="op" id="8453396">;</span>&nbsp;<span class="ident" id="8453398">i</span>&nbsp;<span class="op" id="8453400">&lt;</span>&nbsp;<span class="ident" id="8453402">b</span><span class="op" id="8453403">.</span><span class="ident" id="8453404">N</span><span class="op" id="8453405">;</span>&nbsp;<span class="ident" id="8453407">i</span><span class="op" id="8453408">++</span>&nbsp;<span class="op" id="8453411">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453415">Encode</span><span class="op" id="8453421">(</span><span class="ident" id="8453422">ioutil</span><span class="op" id="8453428">.</span><span class="ident" id="8453429">Discard</span><span class="op" id="8453436">,</span>&nbsp;<span class="ident" id="8453438">img</span><span class="op" id="8453441">,</span>&nbsp;<span class="ident" id="8453443">options</span><span class="op" id="8453450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453453">}</span><br>
<span class="lineno"></span><span class="op" id="8453455">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
