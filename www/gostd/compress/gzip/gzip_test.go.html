<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7649814">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7649869">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7649923">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7649974">package</span>&nbsp;<span class="ident" id="7649982">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7649988">import</span>&nbsp;<span class="op" id="7649995">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7649998">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7650007">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7650016">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7650029">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7650040">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7650047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="7650050">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7650124">func</span>&nbsp;<span class="ident" id="7650129">TestEmpty</span><span class="op" id="7650138">(</span><span class="ident" id="7650139">t</span>&nbsp;<span class="op" id="7650141">*</span><span class="ident" id="7650142">testing</span><span class="op" id="7650149">.</span><span class="ident" id="7650150">T</span><span class="op" id="7650151">)</span>&nbsp;<span class="op" id="7650153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650156">buf</span>&nbsp;<span class="op" id="7650160">:=</span>&nbsp;<span class="builtinfunc" id="7650163">new</span><span class="op" id="7650166">(</span><span class="ident" id="7650167">bytes</span><span class="op" id="7650172">.</span><span class="ident" id="7650173">Buffer</span><span class="op" id="7650179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650183">if</span>&nbsp;<span class="ident" id="7650186">err</span>&nbsp;<span class="op" id="7650190">:=</span>&nbsp;<span class="ident" id="7650193">NewWriter</span><span class="op" id="7650202">(</span><span class="ident" id="7650203">buf</span><span class="op" id="7650206">)</span><span class="op" id="7650207">.</span><span class="ident" id="7650208">Close</span><span class="op" id="7650213">(</span><span class="op" id="7650214">)</span><span class="op" id="7650215">;</span>&nbsp;<span class="ident" id="7650217">err</span>&nbsp;<span class="op" id="7650221">!=</span>&nbsp;<span class="ident" id="7650224">nil</span>&nbsp;<span class="op" id="7650228">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650232">t</span><span class="op" id="7650233">.</span><span class="ident" id="7650234">Fatalf</span><span class="op" id="7650240">(</span><span class="string" id="7650241">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7650259">,</span>&nbsp;<span class="ident" id="7650261">err</span><span class="op" id="7650264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650271">r</span><span class="op" id="7650272">,</span>&nbsp;<span class="ident" id="7650274">err</span>&nbsp;<span class="op" id="7650278">:=</span>&nbsp;<span class="ident" id="7650281">NewReader</span><span class="op" id="7650290">(</span><span class="ident" id="7650291">buf</span><span class="op" id="7650294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650297">if</span>&nbsp;<span class="ident" id="7650300">err</span>&nbsp;<span class="op" id="7650304">!=</span>&nbsp;<span class="ident" id="7650307">nil</span>&nbsp;<span class="op" id="7650311">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650315">t</span><span class="op" id="7650316">.</span><span class="ident" id="7650317">Fatalf</span><span class="op" id="7650323">(</span><span class="string" id="7650324">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7650339">,</span>&nbsp;<span class="ident" id="7650341">err</span><span class="op" id="7650344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650350">b</span><span class="op" id="7650351">,</span>&nbsp;<span class="ident" id="7650353">err</span>&nbsp;<span class="op" id="7650357">:=</span>&nbsp;<span class="ident" id="7650360">ioutil</span><span class="op" id="7650366">.</span><span class="ident" id="7650367">ReadAll</span><span class="op" id="7650374">(</span><span class="ident" id="7650375">r</span><span class="op" id="7650376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650379">if</span>&nbsp;<span class="ident" id="7650382">err</span>&nbsp;<span class="op" id="7650386">!=</span>&nbsp;<span class="ident" id="7650389">nil</span>&nbsp;<span class="op" id="7650393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650397">t</span><span class="op" id="7650398">.</span><span class="ident" id="7650399">Fatalf</span><span class="op" id="7650405">(</span><span class="string" id="7650406">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7650419">,</span>&nbsp;<span class="ident" id="7650421">err</span><span class="op" id="7650424">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650430">if</span>&nbsp;<span class="builtinfunc" id="7650433">len</span><span class="op" id="7650436">(</span><span class="ident" id="7650437">b</span><span class="op" id="7650438">)</span>&nbsp;<span class="op" id="7650440">!=</span>&nbsp;<span class="num" id="7650443">0</span>&nbsp;<span class="op" id="7650445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650449">t</span><span class="op" id="7650450">.</span><span class="ident" id="7650451">Fatalf</span><span class="op" id="7650457">(</span><span class="string" id="7650458">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7650480">,</span>&nbsp;<span class="builtinfunc" id="7650482">len</span><span class="op" id="7650485">(</span><span class="ident" id="7650486">b</span><span class="op" id="7650487">)</span><span class="op" id="7650488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650494">if</span>&nbsp;<span class="ident" id="7650497">err</span>&nbsp;<span class="op" id="7650501">:=</span>&nbsp;<span class="ident" id="7650504">r</span><span class="op" id="7650505">.</span><span class="ident" id="7650506">Close</span><span class="op" id="7650511">(</span><span class="op" id="7650512">)</span><span class="op" id="7650513">;</span>&nbsp;<span class="ident" id="7650515">err</span>&nbsp;<span class="op" id="7650519">!=</span>&nbsp;<span class="ident" id="7650522">nil</span>&nbsp;<span class="op" id="7650526">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650530">t</span><span class="op" id="7650531">.</span><span class="ident" id="7650532">Fatalf</span><span class="op" id="7650538">(</span><span class="string" id="7650539">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7650557">,</span>&nbsp;<span class="ident" id="7650559">err</span><span class="op" id="7650562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650565">}</span><br>
<span class="lineno"></span><span class="op" id="7650567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7650570">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="7650643">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="7650656">func</span>&nbsp;<span class="ident" id="7650661">TestRoundTrip</span><span class="op" id="7650674">(</span><span class="ident" id="7650675">t</span>&nbsp;<span class="op" id="7650677">*</span><span class="ident" id="7650678">testing</span><span class="op" id="7650685">.</span><span class="ident" id="7650686">T</span><span class="op" id="7650687">)</span>&nbsp;<span class="op" id="7650689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650692">buf</span>&nbsp;<span class="op" id="7650696">:=</span>&nbsp;<span class="builtinfunc" id="7650699">new</span><span class="op" id="7650702">(</span><span class="ident" id="7650703">bytes</span><span class="op" id="7650708">.</span><span class="ident" id="7650709">Buffer</span><span class="op" id="7650715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650719">w</span>&nbsp;<span class="op" id="7650721">:=</span>&nbsp;<span class="ident" id="7650724">NewWriter</span><span class="op" id="7650733">(</span><span class="ident" id="7650734">buf</span><span class="op" id="7650737">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650740">w</span><span class="op" id="7650741">.</span><span class="ident" id="7650742">Comment</span>&nbsp;<span class="op" id="7650750">=</span>&nbsp;<span class="string" id="7650752">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650763">w</span><span class="op" id="7650764">.</span><span class="ident" id="7650765">Extra</span>&nbsp;<span class="op" id="7650771">=</span>&nbsp;<span class="op" id="7650773">[</span><span class="op" id="7650774">]</span><span class="builtintype" id="7650775">byte</span><span class="op" id="7650779">(</span><span class="string" id="7650780">&#34;extra&#34;</span><span class="op" id="7650787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650790">w</span><span class="op" id="7650791">.</span><span class="ident" id="7650792">ModTime</span>&nbsp;<span class="op" id="7650800">=</span>&nbsp;<span class="ident" id="7650802">time</span><span class="op" id="7650806">.</span><span class="ident" id="7650807">Unix</span><span class="op" id="7650811">(</span><span class="num" id="7650812">1e8</span><span class="op" id="7650815">,</span>&nbsp;<span class="num" id="7650817">0</span><span class="op" id="7650818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650821">w</span><span class="op" id="7650822">.</span><span class="ident" id="7650823">Name</span>&nbsp;<span class="op" id="7650828">=</span>&nbsp;<span class="string" id="7650830">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650838">if</span>&nbsp;<span class="ident" id="7650841">_</span><span class="op" id="7650842">,</span>&nbsp;<span class="ident" id="7650844">err</span>&nbsp;<span class="op" id="7650848">:=</span>&nbsp;<span class="ident" id="7650851">w</span><span class="op" id="7650852">.</span><span class="ident" id="7650853">Write</span><span class="op" id="7650858">(</span><span class="op" id="7650859">[</span><span class="op" id="7650860">]</span><span class="builtintype" id="7650861">byte</span><span class="op" id="7650865">(</span><span class="string" id="7650866">&#34;payload&#34;</span><span class="op" id="7650875">)</span><span class="op" id="7650876">)</span><span class="op" id="7650877">;</span>&nbsp;<span class="ident" id="7650879">err</span>&nbsp;<span class="op" id="7650883">!=</span>&nbsp;<span class="ident" id="7650886">nil</span>&nbsp;<span class="op" id="7650890">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650894">t</span><span class="op" id="7650895">.</span><span class="ident" id="7650896">Fatalf</span><span class="op" id="7650902">(</span><span class="string" id="7650903">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7650914">,</span>&nbsp;<span class="ident" id="7650916">err</span><span class="op" id="7650919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650925">if</span>&nbsp;<span class="ident" id="7650928">err</span>&nbsp;<span class="op" id="7650932">:=</span>&nbsp;<span class="ident" id="7650935">w</span><span class="op" id="7650936">.</span><span class="ident" id="7650937">Close</span><span class="op" id="7650942">(</span><span class="op" id="7650943">)</span><span class="op" id="7650944">;</span>&nbsp;<span class="ident" id="7650946">err</span>&nbsp;<span class="op" id="7650950">!=</span>&nbsp;<span class="ident" id="7650953">nil</span>&nbsp;<span class="op" id="7650957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650961">t</span><span class="op" id="7650962">.</span><span class="ident" id="7650963">Fatalf</span><span class="op" id="7650969">(</span><span class="string" id="7650970">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7650988">,</span>&nbsp;<span class="ident" id="7650990">err</span><span class="op" id="7650993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650996">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651000">r</span><span class="op" id="7651001">,</span>&nbsp;<span class="ident" id="7651003">err</span>&nbsp;<span class="op" id="7651007">:=</span>&nbsp;<span class="ident" id="7651010">NewReader</span><span class="op" id="7651019">(</span><span class="ident" id="7651020">buf</span><span class="op" id="7651023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651026">if</span>&nbsp;<span class="ident" id="7651029">err</span>&nbsp;<span class="op" id="7651033">!=</span>&nbsp;<span class="ident" id="7651036">nil</span>&nbsp;<span class="op" id="7651040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651044">t</span><span class="op" id="7651045">.</span><span class="ident" id="7651046">Fatalf</span><span class="op" id="7651052">(</span><span class="string" id="7651053">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7651068">,</span>&nbsp;<span class="ident" id="7651070">err</span><span class="op" id="7651073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651076">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651079">b</span><span class="op" id="7651080">,</span>&nbsp;<span class="ident" id="7651082">err</span>&nbsp;<span class="op" id="7651086">:=</span>&nbsp;<span class="ident" id="7651089">ioutil</span><span class="op" id="7651095">.</span><span class="ident" id="7651096">ReadAll</span><span class="op" id="7651103">(</span><span class="ident" id="7651104">r</span><span class="op" id="7651105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651108">if</span>&nbsp;<span class="ident" id="7651111">err</span>&nbsp;<span class="op" id="7651115">!=</span>&nbsp;<span class="ident" id="7651118">nil</span>&nbsp;<span class="op" id="7651122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651126">t</span><span class="op" id="7651127">.</span><span class="ident" id="7651128">Fatalf</span><span class="op" id="7651134">(</span><span class="string" id="7651135">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7651148">,</span>&nbsp;<span class="ident" id="7651150">err</span><span class="op" id="7651153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651159">if</span>&nbsp;<span class="builtintype" id="7651162">string</span><span class="op" id="7651168">(</span><span class="ident" id="7651169">b</span><span class="op" id="7651170">)</span>&nbsp;<span class="op" id="7651172">!=</span>&nbsp;<span class="string" id="7651175">&#34;payload&#34;</span>&nbsp;<span class="op" id="7651185">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651189">t</span><span class="op" id="7651190">.</span><span class="ident" id="7651191">Fatalf</span><span class="op" id="7651197">(</span><span class="string" id="7651198">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7651222">,</span>&nbsp;<span class="builtintype" id="7651224">string</span><span class="op" id="7651230">(</span><span class="ident" id="7651231">b</span><span class="op" id="7651232">)</span><span class="op" id="7651233">,</span>&nbsp;<span class="string" id="7651235">&#34;payload&#34;</span><span class="op" id="7651244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651250">if</span>&nbsp;<span class="ident" id="7651253">r</span><span class="op" id="7651254">.</span><span class="ident" id="7651255">Comment</span>&nbsp;<span class="op" id="7651263">!=</span>&nbsp;<span class="string" id="7651266">&#34;comment&#34;</span>&nbsp;<span class="op" id="7651276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651280">t</span><span class="op" id="7651281">.</span><span class="ident" id="7651282">Fatalf</span><span class="op" id="7651288">(</span><span class="string" id="7651289">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7651313">,</span>&nbsp;<span class="ident" id="7651315">r</span><span class="op" id="7651316">.</span><span class="ident" id="7651317">Comment</span><span class="op" id="7651324">,</span>&nbsp;<span class="string" id="7651326">&#34;comment&#34;</span><span class="op" id="7651335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651338">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651341">if</span>&nbsp;<span class="builtintype" id="7651344">string</span><span class="op" id="7651350">(</span><span class="ident" id="7651351">r</span><span class="op" id="7651352">.</span><span class="ident" id="7651353">Extra</span><span class="op" id="7651358">)</span>&nbsp;<span class="op" id="7651360">!=</span>&nbsp;<span class="string" id="7651363">&#34;extra&#34;</span>&nbsp;<span class="op" id="7651371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651375">t</span><span class="op" id="7651376">.</span><span class="ident" id="7651377">Fatalf</span><span class="op" id="7651383">(</span><span class="string" id="7651384">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7651406">,</span>&nbsp;<span class="ident" id="7651408">r</span><span class="op" id="7651409">.</span><span class="ident" id="7651410">Extra</span><span class="op" id="7651415">,</span>&nbsp;<span class="string" id="7651417">&#34;extra&#34;</span><span class="op" id="7651424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651430">if</span>&nbsp;<span class="ident" id="7651433">r</span><span class="op" id="7651434">.</span><span class="ident" id="7651435">ModTime</span><span class="op" id="7651442">.</span><span class="ident" id="7651443">Unix</span><span class="op" id="7651447">(</span><span class="op" id="7651448">)</span>&nbsp;<span class="op" id="7651450">!=</span>&nbsp;<span class="num" id="7651453">1e8</span>&nbsp;<span class="op" id="7651457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651461">t</span><span class="op" id="7651462">.</span><span class="ident" id="7651463">Fatalf</span><span class="op" id="7651469">(</span><span class="string" id="7651470">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7651492">,</span>&nbsp;<span class="ident" id="7651494">r</span><span class="op" id="7651495">.</span><span class="ident" id="7651496">ModTime</span><span class="op" id="7651503">.</span><span class="ident" id="7651504">Unix</span><span class="op" id="7651508">(</span><span class="op" id="7651509">)</span><span class="op" id="7651510">,</span>&nbsp;<span class="builtintype" id="7651512">uint32</span><span class="op" id="7651518">(</span><span class="num" id="7651519">1e8</span><span class="op" id="7651522">)</span><span class="op" id="7651523">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651529">if</span>&nbsp;<span class="ident" id="7651532">r</span><span class="op" id="7651533">.</span><span class="ident" id="7651534">Name</span>&nbsp;<span class="op" id="7651539">!=</span>&nbsp;<span class="string" id="7651542">&#34;name&#34;</span>&nbsp;<span class="op" id="7651549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651553">t</span><span class="op" id="7651554">.</span><span class="ident" id="7651555">Fatalf</span><span class="op" id="7651561">(</span><span class="string" id="7651562">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7651583">,</span>&nbsp;<span class="ident" id="7651585">r</span><span class="op" id="7651586">.</span><span class="ident" id="7651587">Name</span><span class="op" id="7651591">,</span>&nbsp;<span class="string" id="7651593">&#34;name&#34;</span><span class="op" id="7651599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651605">if</span>&nbsp;<span class="ident" id="7651608">err</span>&nbsp;<span class="op" id="7651612">:=</span>&nbsp;<span class="ident" id="7651615">r</span><span class="op" id="7651616">.</span><span class="ident" id="7651617">Close</span><span class="op" id="7651622">(</span><span class="op" id="7651623">)</span><span class="op" id="7651624">;</span>&nbsp;<span class="ident" id="7651626">err</span>&nbsp;<span class="op" id="7651630">!=</span>&nbsp;<span class="ident" id="7651633">nil</span>&nbsp;<span class="op" id="7651637">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651641">t</span><span class="op" id="7651642">.</span><span class="ident" id="7651643">Fatalf</span><span class="op" id="7651649">(</span><span class="string" id="7651650">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7651668">,</span>&nbsp;<span class="ident" id="7651670">err</span><span class="op" id="7651673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651676">}</span><br>
<span class="lineno"></span><span class="op" id="7651678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7651681">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="7651760">func</span>&nbsp;<span class="ident" id="7651765">TestLatin1</span><span class="op" id="7651775">(</span><span class="ident" id="7651776">t</span>&nbsp;<span class="op" id="7651778">*</span><span class="ident" id="7651779">testing</span><span class="op" id="7651786">.</span><span class="ident" id="7651787">T</span><span class="op" id="7651788">)</span>&nbsp;<span class="op" id="7651790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651793">latin1</span>&nbsp;<span class="op" id="7651800">:=</span>&nbsp;<span class="op" id="7651803">[</span><span class="op" id="7651804">]</span><span class="builtintype" id="7651805">byte</span><span class="op" id="7651809">{</span><span class="num" id="7651810">0xc4</span><span class="op" id="7651814">,</span>&nbsp;<span class="string" id="7651816">&#39;u&#39;</span><span class="op" id="7651819">,</span>&nbsp;<span class="num" id="7651821">0xdf</span><span class="op" id="7651825">,</span>&nbsp;<span class="string" id="7651827">&#39;e&#39;</span><span class="op" id="7651830">,</span>&nbsp;<span class="string" id="7651832">&#39;r&#39;</span><span class="op" id="7651835">,</span>&nbsp;<span class="string" id="7651837">&#39;u&#39;</span><span class="op" id="7651840">,</span>&nbsp;<span class="string" id="7651842">&#39;n&#39;</span><span class="op" id="7651845">,</span>&nbsp;<span class="string" id="7651847">&#39;g&#39;</span><span class="op" id="7651850">,</span>&nbsp;<span class="num" id="7651852">0</span><span class="op" id="7651853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651856">utf8</span>&nbsp;<span class="op" id="7651861">:=</span>&nbsp;<span class="string" id="7651864">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651878">z</span>&nbsp;<span class="op" id="7651880">:=</span>&nbsp;<span class="ident" id="7651883">Reader</span><span class="op" id="7651889">{</span><span class="ident" id="7651890">r</span><span class="op" id="7651891">:</span>&nbsp;<span class="ident" id="7651893">bufio</span><span class="op" id="7651898">.</span><span class="ident" id="7651899">NewReader</span><span class="op" id="7651908">(</span><span class="ident" id="7651909">bytes</span><span class="op" id="7651914">.</span><span class="ident" id="7651915">NewReader</span><span class="op" id="7651924">(</span><span class="ident" id="7651925">latin1</span><span class="op" id="7651931">)</span><span class="op" id="7651932">)</span><span class="op" id="7651933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651936">s</span><span class="op" id="7651937">,</span>&nbsp;<span class="ident" id="7651939">err</span>&nbsp;<span class="op" id="7651943">:=</span>&nbsp;<span class="ident" id="7651946">z</span><span class="op" id="7651947">.</span><span class="ident" id="7651948">readString</span><span class="op" id="7651958">(</span><span class="op" id="7651959">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651962">if</span>&nbsp;<span class="ident" id="7651965">err</span>&nbsp;<span class="op" id="7651969">!=</span>&nbsp;<span class="ident" id="7651972">nil</span>&nbsp;<span class="op" id="7651976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651980">t</span><span class="op" id="7651981">.</span><span class="ident" id="7651982">Fatalf</span><span class="op" id="7651988">(</span><span class="string" id="7651989">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="7652005">,</span>&nbsp;<span class="ident" id="7652007">err</span><span class="op" id="7652010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652016">if</span>&nbsp;<span class="ident" id="7652019">s</span>&nbsp;<span class="op" id="7652021">!=</span>&nbsp;<span class="ident" id="7652024">utf8</span>&nbsp;<span class="op" id="7652029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652033">t</span><span class="op" id="7652034">.</span><span class="ident" id="7652035">Fatalf</span><span class="op" id="7652041">(</span><span class="string" id="7652042">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7652073">,</span>&nbsp;<span class="ident" id="7652075">s</span><span class="op" id="7652076">,</span>&nbsp;<span class="ident" id="7652078">utf8</span><span class="op" id="7652082">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652089">buf</span>&nbsp;<span class="op" id="7652093">:=</span>&nbsp;<span class="ident" id="7652096">bytes</span><span class="op" id="7652101">.</span><span class="ident" id="7652102">NewBuffer</span><span class="op" id="7652111">(</span><span class="builtinfunc" id="7652112">make</span><span class="op" id="7652116">(</span><span class="op" id="7652117">[</span><span class="op" id="7652118">]</span><span class="builtintype" id="7652119">byte</span><span class="op" id="7652123">,</span>&nbsp;<span class="num" id="7652125">0</span><span class="op" id="7652126">,</span>&nbsp;<span class="builtinfunc" id="7652128">len</span><span class="op" id="7652131">(</span><span class="ident" id="7652132">latin1</span><span class="op" id="7652138">)</span><span class="op" id="7652139">)</span><span class="op" id="7652140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652143">c</span>&nbsp;<span class="op" id="7652145">:=</span>&nbsp;<span class="ident" id="7652148">Writer</span><span class="op" id="7652154">{</span><span class="ident" id="7652155">w</span><span class="op" id="7652156">:</span>&nbsp;<span class="ident" id="7652158">buf</span><span class="op" id="7652161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652164">if</span>&nbsp;<span class="ident" id="7652167">err</span>&nbsp;<span class="op" id="7652171">=</span>&nbsp;<span class="ident" id="7652173">c</span><span class="op" id="7652174">.</span><span class="ident" id="7652175">writeString</span><span class="op" id="7652186">(</span><span class="ident" id="7652187">utf8</span><span class="op" id="7652191">)</span><span class="op" id="7652192">;</span>&nbsp;<span class="ident" id="7652194">err</span>&nbsp;<span class="op" id="7652198">!=</span>&nbsp;<span class="ident" id="7652201">nil</span>&nbsp;<span class="op" id="7652205">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652209">t</span><span class="op" id="7652210">.</span><span class="ident" id="7652211">Fatalf</span><span class="op" id="7652217">(</span><span class="string" id="7652218">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="7652235">,</span>&nbsp;<span class="ident" id="7652237">err</span><span class="op" id="7652240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652246">s</span>&nbsp;<span class="op" id="7652248">=</span>&nbsp;<span class="ident" id="7652250">buf</span><span class="op" id="7652253">.</span><span class="ident" id="7652254">String</span><span class="op" id="7652260">(</span><span class="op" id="7652261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652264">if</span>&nbsp;<span class="ident" id="7652267">s</span>&nbsp;<span class="op" id="7652269">!=</span>&nbsp;<span class="builtintype" id="7652272">string</span><span class="op" id="7652278">(</span><span class="ident" id="7652279">latin1</span><span class="op" id="7652285">)</span>&nbsp;<span class="op" id="7652287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652291">t</span><span class="op" id="7652292">.</span><span class="ident" id="7652293">Fatalf</span><span class="op" id="7652299">(</span><span class="string" id="7652300">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7652330">,</span>&nbsp;<span class="ident" id="7652332">s</span><span class="op" id="7652333">,</span>&nbsp;<span class="builtintype" id="7652335">string</span><span class="op" id="7652341">(</span><span class="ident" id="7652342">latin1</span><span class="op" id="7652348">)</span><span class="op" id="7652349">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652352">}</span><br>
<span class="lineno"></span><span class="op" id="7652354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7652357">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="7652433">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="7652459">func</span>&nbsp;<span class="ident" id="7652464">TestLatin1RoundTrip</span><span class="op" id="7652483">(</span><span class="ident" id="7652484">t</span>&nbsp;<span class="op" id="7652486">*</span><span class="ident" id="7652487">testing</span><span class="op" id="7652494">.</span><span class="ident" id="7652495">T</span><span class="op" id="7652496">)</span>&nbsp;<span class="op" id="7652498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652501">testCases</span>&nbsp;<span class="op" id="7652511">:=</span>&nbsp;<span class="op" id="7652514">[</span><span class="op" id="7652515">]</span><span class="keyword" id="7652516">struct</span>&nbsp;<span class="op" id="7652523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652527">name</span>&nbsp;<span class="builtintype" id="7652532">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652541">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7652546">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652552">}</span><span class="op" id="7652553">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652557">{</span><span class="string" id="7652558">&#34;&#34;</span><span class="op" id="7652560">,</span>&nbsp;<span class="builtintype" id="7652562">true</span><span class="op" id="7652566">}</span><span class="op" id="7652567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652571">{</span><span class="string" id="7652572">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="7652585">,</span>&nbsp;<span class="builtintype" id="7652587">true</span><span class="op" id="7652591">}</span><span class="op" id="7652592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652596">{</span><span class="string" id="7652597">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="7652627">,</span>&nbsp;<span class="builtintype" id="7652629">false</span><span class="op" id="7652634">}</span><span class="op" id="7652635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652639">{</span><span class="string" id="7652640">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="7652669">,</span>&nbsp;<span class="builtintype" id="7652671">false</span><span class="op" id="7652676">}</span><span class="op" id="7652677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652681">{</span><span class="string" id="7652682">&#34;\x00\x00\x00&#34;</span><span class="op" id="7652696">,</span>&nbsp;<span class="builtintype" id="7652698">false</span><span class="op" id="7652703">}</span><span class="op" id="7652704">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652708">{</span><span class="string" id="7652709">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="7652740">,</span>&nbsp;<span class="builtintype" id="7652742">true</span><span class="op" id="7652746">}</span><span class="op" id="7652747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652751">{</span><span class="string" id="7652752">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="7652793">,</span>&nbsp;<span class="builtintype" id="7652795">false</span><span class="op" id="7652800">}</span><span class="op" id="7652801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652805">{</span><span class="string" id="7652806">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="7652830">,</span>&nbsp;<span class="builtintype" id="7652832">false</span><span class="op" id="7652837">}</span><span class="op" id="7652838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652842">{</span><span class="string" id="7652843">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="7652872">,</span>&nbsp;<span class="builtintype" id="7652874">false</span><span class="op" id="7652879">}</span><span class="op" id="7652880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652884">{</span><span class="string" id="7652885">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="7652917">,</span>&nbsp;<span class="builtintype" id="7652919">false</span><span class="op" id="7652924">}</span><span class="op" id="7652925">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652931">for</span>&nbsp;<span class="ident" id="7652935">_</span><span class="op" id="7652936">,</span>&nbsp;<span class="ident" id="7652938">tc</span>&nbsp;<span class="op" id="7652941">:=</span>&nbsp;<span class="keyword" id="7652944">range</span>&nbsp;<span class="ident" id="7652950">testCases</span>&nbsp;<span class="op" id="7652960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652964">buf</span>&nbsp;<span class="op" id="7652968">:=</span>&nbsp;<span class="builtinfunc" id="7652971">new</span><span class="op" id="7652974">(</span><span class="ident" id="7652975">bytes</span><span class="op" id="7652980">.</span><span class="ident" id="7652981">Buffer</span><span class="op" id="7652987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652992">w</span>&nbsp;<span class="op" id="7652994">:=</span>&nbsp;<span class="ident" id="7652997">NewWriter</span><span class="op" id="7653006">(</span><span class="ident" id="7653007">buf</span><span class="op" id="7653010">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653014">w</span><span class="op" id="7653015">.</span><span class="ident" id="7653016">Name</span>&nbsp;<span class="op" id="7653021">=</span>&nbsp;<span class="ident" id="7653023">tc</span><span class="op" id="7653025">.</span><span class="ident" id="7653026">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653033">err</span>&nbsp;<span class="op" id="7653037">:=</span>&nbsp;<span class="ident" id="7653040">w</span><span class="op" id="7653041">.</span><span class="ident" id="7653042">Close</span><span class="op" id="7653047">(</span><span class="op" id="7653048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653052">if</span>&nbsp;<span class="op" id="7653055">(</span><span class="ident" id="7653056">err</span>&nbsp;<span class="op" id="7653060">==</span>&nbsp;<span class="ident" id="7653063">nil</span><span class="op" id="7653066">)</span>&nbsp;<span class="op" id="7653068">!=</span>&nbsp;<span class="ident" id="7653071">tc</span><span class="op" id="7653073">.</span><span class="ident" id="7653074">ok</span>&nbsp;<span class="op" id="7653077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653082">t</span><span class="op" id="7653083">.</span><span class="ident" id="7653084">Errorf</span><span class="op" id="7653090">(</span><span class="string" id="7653091">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7653126">,</span>&nbsp;<span class="ident" id="7653128">tc</span><span class="op" id="7653130">.</span><span class="ident" id="7653131">name</span><span class="op" id="7653135">,</span>&nbsp;<span class="ident" id="7653137">err</span><span class="op" id="7653140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653145">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653160">if</span>&nbsp;<span class="op" id="7653163">!</span><span class="ident" id="7653164">tc</span><span class="op" id="7653166">.</span><span class="ident" id="7653167">ok</span>&nbsp;<span class="op" id="7653170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653175">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653191">r</span><span class="op" id="7653192">,</span>&nbsp;<span class="ident" id="7653194">err</span>&nbsp;<span class="op" id="7653198">:=</span>&nbsp;<span class="ident" id="7653201">NewReader</span><span class="op" id="7653210">(</span><span class="ident" id="7653211">buf</span><span class="op" id="7653214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653218">if</span>&nbsp;<span class="ident" id="7653221">err</span>&nbsp;<span class="op" id="7653225">!=</span>&nbsp;<span class="ident" id="7653228">nil</span>&nbsp;<span class="op" id="7653232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653237">t</span><span class="op" id="7653238">.</span><span class="ident" id="7653239">Errorf</span><span class="op" id="7653245">(</span><span class="string" id="7653246">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7653261">,</span>&nbsp;<span class="ident" id="7653263">err</span><span class="op" id="7653266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653271">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653282">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653286">_</span><span class="op" id="7653287">,</span>&nbsp;<span class="ident" id="7653289">err</span>&nbsp;<span class="op" id="7653293">=</span>&nbsp;<span class="ident" id="7653295">ioutil</span><span class="op" id="7653301">.</span><span class="ident" id="7653302">ReadAll</span><span class="op" id="7653309">(</span><span class="ident" id="7653310">r</span><span class="op" id="7653311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653315">if</span>&nbsp;<span class="ident" id="7653318">err</span>&nbsp;<span class="op" id="7653322">!=</span>&nbsp;<span class="ident" id="7653325">nil</span>&nbsp;<span class="op" id="7653329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653334">t</span><span class="op" id="7653335">.</span><span class="ident" id="7653336">Errorf</span><span class="op" id="7653342">(</span><span class="string" id="7653343">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7653356">,</span>&nbsp;<span class="ident" id="7653358">err</span><span class="op" id="7653361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653366">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653377">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653381">if</span>&nbsp;<span class="ident" id="7653384">r</span><span class="op" id="7653385">.</span><span class="ident" id="7653386">Name</span>&nbsp;<span class="op" id="7653391">!=</span>&nbsp;<span class="ident" id="7653394">tc</span><span class="op" id="7653396">.</span><span class="ident" id="7653397">name</span>&nbsp;<span class="op" id="7653402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653407">t</span><span class="op" id="7653408">.</span><span class="ident" id="7653409">Errorf</span><span class="op" id="7653415">(</span><span class="string" id="7653416">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7653437">,</span>&nbsp;<span class="ident" id="7653439">r</span><span class="op" id="7653440">.</span><span class="ident" id="7653441">Name</span><span class="op" id="7653445">,</span>&nbsp;<span class="ident" id="7653447">tc</span><span class="op" id="7653449">.</span><span class="ident" id="7653450">name</span><span class="op" id="7653454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653459">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653474">if</span>&nbsp;<span class="ident" id="7653477">err</span>&nbsp;<span class="op" id="7653481">:=</span>&nbsp;<span class="ident" id="7653484">r</span><span class="op" id="7653485">.</span><span class="ident" id="7653486">Close</span><span class="op" id="7653491">(</span><span class="op" id="7653492">)</span><span class="op" id="7653493">;</span>&nbsp;<span class="ident" id="7653495">err</span>&nbsp;<span class="op" id="7653499">!=</span>&nbsp;<span class="ident" id="7653502">nil</span>&nbsp;<span class="op" id="7653506">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653511">t</span><span class="op" id="7653512">.</span><span class="ident" id="7653513">Errorf</span><span class="op" id="7653519">(</span><span class="string" id="7653520">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7653538">,</span>&nbsp;<span class="ident" id="7653540">err</span><span class="op" id="7653543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653548">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653562">}</span><br>
<span class="lineno"></span><span class="op" id="7653564">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7653567">func</span>&nbsp;<span class="ident" id="7653572">TestWriterFlush</span><span class="op" id="7653587">(</span><span class="ident" id="7653588">t</span>&nbsp;<span class="op" id="7653590">*</span><span class="ident" id="7653591">testing</span><span class="op" id="7653598">.</span><span class="ident" id="7653599">T</span><span class="op" id="7653600">)</span>&nbsp;<span class="op" id="7653602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653605">buf</span>&nbsp;<span class="op" id="7653609">:=</span>&nbsp;<span class="builtinfunc" id="7653612">new</span><span class="op" id="7653615">(</span><span class="ident" id="7653616">bytes</span><span class="op" id="7653621">.</span><span class="ident" id="7653622">Buffer</span><span class="op" id="7653628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653632">w</span>&nbsp;<span class="op" id="7653634">:=</span>&nbsp;<span class="ident" id="7653637">NewWriter</span><span class="op" id="7653646">(</span><span class="ident" id="7653647">buf</span><span class="op" id="7653650">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653653">w</span><span class="op" id="7653654">.</span><span class="ident" id="7653655">Comment</span>&nbsp;<span class="op" id="7653663">=</span>&nbsp;<span class="string" id="7653665">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653676">w</span><span class="op" id="7653677">.</span><span class="ident" id="7653678">Extra</span>&nbsp;<span class="op" id="7653684">=</span>&nbsp;<span class="op" id="7653686">[</span><span class="op" id="7653687">]</span><span class="builtintype" id="7653688">byte</span><span class="op" id="7653692">(</span><span class="string" id="7653693">&#34;extra&#34;</span><span class="op" id="7653700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653703">w</span><span class="op" id="7653704">.</span><span class="ident" id="7653705">ModTime</span>&nbsp;<span class="op" id="7653713">=</span>&nbsp;<span class="ident" id="7653715">time</span><span class="op" id="7653719">.</span><span class="ident" id="7653720">Unix</span><span class="op" id="7653724">(</span><span class="num" id="7653725">1e8</span><span class="op" id="7653728">,</span>&nbsp;<span class="num" id="7653730">0</span><span class="op" id="7653731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653734">w</span><span class="op" id="7653735">.</span><span class="ident" id="7653736">Name</span>&nbsp;<span class="op" id="7653741">=</span>&nbsp;<span class="string" id="7653743">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653752">n0</span>&nbsp;<span class="op" id="7653755">:=</span>&nbsp;<span class="ident" id="7653758">buf</span><span class="op" id="7653761">.</span><span class="ident" id="7653762">Len</span><span class="op" id="7653765">(</span><span class="op" id="7653766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653769">if</span>&nbsp;<span class="ident" id="7653772">n0</span>&nbsp;<span class="op" id="7653775">!=</span>&nbsp;<span class="num" id="7653778">0</span>&nbsp;<span class="op" id="7653780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653784">t</span><span class="op" id="7653785">.</span><span class="ident" id="7653786">Fatalf</span><span class="op" id="7653792">(</span><span class="string" id="7653793">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7653833">,</span>&nbsp;<span class="ident" id="7653835">n0</span><span class="op" id="7653837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653844">if</span>&nbsp;<span class="ident" id="7653847">err</span>&nbsp;<span class="op" id="7653851">:=</span>&nbsp;<span class="ident" id="7653854">w</span><span class="op" id="7653855">.</span><span class="ident" id="7653856">Flush</span><span class="op" id="7653861">(</span><span class="op" id="7653862">)</span><span class="op" id="7653863">;</span>&nbsp;<span class="ident" id="7653865">err</span>&nbsp;<span class="op" id="7653869">!=</span>&nbsp;<span class="ident" id="7653872">nil</span>&nbsp;<span class="op" id="7653876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653880">t</span><span class="op" id="7653881">.</span><span class="ident" id="7653882">Fatal</span><span class="op" id="7653887">(</span><span class="ident" id="7653888">err</span><span class="op" id="7653891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653898">n1</span>&nbsp;<span class="op" id="7653901">:=</span>&nbsp;<span class="ident" id="7653904">buf</span><span class="op" id="7653907">.</span><span class="ident" id="7653908">Len</span><span class="op" id="7653911">(</span><span class="op" id="7653912">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653915">if</span>&nbsp;<span class="ident" id="7653918">n1</span>&nbsp;<span class="op" id="7653921">==</span>&nbsp;<span class="num" id="7653924">0</span>&nbsp;<span class="op" id="7653926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653930">t</span><span class="op" id="7653931">.</span><span class="ident" id="7653932">Fatal</span><span class="op" id="7653937">(</span><span class="string" id="7653938">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="7653965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653972">w</span><span class="op" id="7653973">.</span><span class="ident" id="7653974">Write</span><span class="op" id="7653979">(</span><span class="op" id="7653980">[</span><span class="op" id="7653981">]</span><span class="builtintype" id="7653982">byte</span><span class="op" id="7653986">(</span><span class="string" id="7653987">&#34;x&#34;</span><span class="op" id="7653990">)</span><span class="op" id="7653991">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653995">n2</span>&nbsp;<span class="op" id="7653998">:=</span>&nbsp;<span class="ident" id="7654001">buf</span><span class="op" id="7654004">.</span><span class="ident" id="7654005">Len</span><span class="op" id="7654008">(</span><span class="op" id="7654009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654012">if</span>&nbsp;<span class="ident" id="7654015">n1</span>&nbsp;<span class="op" id="7654018">!=</span>&nbsp;<span class="ident" id="7654021">n2</span>&nbsp;<span class="op" id="7654024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654028">t</span><span class="op" id="7654029">.</span><span class="ident" id="7654030">Fatalf</span><span class="op" id="7654036">(</span><span class="string" id="7654037">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="7654110">,</span>&nbsp;<span class="ident" id="7654112">n1</span><span class="op" id="7654114">,</span>&nbsp;<span class="ident" id="7654116">n2</span><span class="op" id="7654118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654121">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654125">if</span>&nbsp;<span class="ident" id="7654128">err</span>&nbsp;<span class="op" id="7654132">:=</span>&nbsp;<span class="ident" id="7654135">w</span><span class="op" id="7654136">.</span><span class="ident" id="7654137">Flush</span><span class="op" id="7654142">(</span><span class="op" id="7654143">)</span><span class="op" id="7654144">;</span>&nbsp;<span class="ident" id="7654146">err</span>&nbsp;<span class="op" id="7654150">!=</span>&nbsp;<span class="ident" id="7654153">nil</span>&nbsp;<span class="op" id="7654157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654161">t</span><span class="op" id="7654162">.</span><span class="ident" id="7654163">Fatal</span><span class="op" id="7654168">(</span><span class="ident" id="7654169">err</span><span class="op" id="7654172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654179">n3</span>&nbsp;<span class="op" id="7654182">:=</span>&nbsp;<span class="ident" id="7654185">buf</span><span class="op" id="7654188">.</span><span class="ident" id="7654189">Len</span><span class="op" id="7654192">(</span><span class="op" id="7654193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654196">if</span>&nbsp;<span class="ident" id="7654199">n2</span>&nbsp;<span class="op" id="7654202">==</span>&nbsp;<span class="ident" id="7654205">n3</span>&nbsp;<span class="op" id="7654208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654212">t</span><span class="op" id="7654213">.</span><span class="ident" id="7654214">Fatal</span><span class="op" id="7654219">(</span><span class="string" id="7654220">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="7654249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654252">}</span><br>
<span class="lineno"></span><span class="op" id="7654254">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="7654257">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="7654317">func</span>&nbsp;<span class="ident" id="7654322">TestConcat</span><span class="op" id="7654332">(</span><span class="ident" id="7654333">t</span>&nbsp;<span class="op" id="7654335">*</span><span class="ident" id="7654336">testing</span><span class="op" id="7654343">.</span><span class="ident" id="7654344">T</span><span class="op" id="7654345">)</span>&nbsp;<span class="op" id="7654347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654350">var</span>&nbsp;<span class="ident" id="7654354">buf</span>&nbsp;<span class="ident" id="7654358">bytes</span><span class="op" id="7654363">.</span><span class="ident" id="7654364">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654372">w</span>&nbsp;<span class="op" id="7654374">:=</span>&nbsp;<span class="ident" id="7654377">NewWriter</span><span class="op" id="7654386">(</span><span class="op" id="7654387">&amp;</span><span class="ident" id="7654388">buf</span><span class="op" id="7654391">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654394">w</span><span class="op" id="7654395">.</span><span class="ident" id="7654396">Write</span><span class="op" id="7654401">(</span><span class="op" id="7654402">[</span><span class="op" id="7654403">]</span><span class="builtintype" id="7654404">byte</span><span class="op" id="7654408">(</span><span class="string" id="7654409">&#34;hello&nbsp;&#34;</span><span class="op" id="7654417">)</span><span class="op" id="7654418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654421">w</span><span class="op" id="7654422">.</span><span class="ident" id="7654423">Close</span><span class="op" id="7654428">(</span><span class="op" id="7654429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654432">w</span>&nbsp;<span class="op" id="7654434">=</span>&nbsp;<span class="ident" id="7654436">NewWriter</span><span class="op" id="7654445">(</span><span class="op" id="7654446">&amp;</span><span class="ident" id="7654447">buf</span><span class="op" id="7654450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654453">w</span><span class="op" id="7654454">.</span><span class="ident" id="7654455">Write</span><span class="op" id="7654460">(</span><span class="op" id="7654461">[</span><span class="op" id="7654462">]</span><span class="builtintype" id="7654463">byte</span><span class="op" id="7654467">(</span><span class="string" id="7654468">&#34;world\n&#34;</span><span class="op" id="7654477">)</span><span class="op" id="7654478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654481">w</span><span class="op" id="7654482">.</span><span class="ident" id="7654483">Close</span><span class="op" id="7654488">(</span><span class="op" id="7654489">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654493">r</span><span class="op" id="7654494">,</span>&nbsp;<span class="ident" id="7654496">err</span>&nbsp;<span class="op" id="7654500">:=</span>&nbsp;<span class="ident" id="7654503">NewReader</span><span class="op" id="7654512">(</span><span class="op" id="7654513">&amp;</span><span class="ident" id="7654514">buf</span><span class="op" id="7654517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654520">data</span><span class="op" id="7654524">,</span>&nbsp;<span class="ident" id="7654526">err</span>&nbsp;<span class="op" id="7654530">:=</span>&nbsp;<span class="ident" id="7654533">ioutil</span><span class="op" id="7654539">.</span><span class="ident" id="7654540">ReadAll</span><span class="op" id="7654547">(</span><span class="ident" id="7654548">r</span><span class="op" id="7654549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654552">if</span>&nbsp;<span class="builtintype" id="7654555">string</span><span class="op" id="7654561">(</span><span class="ident" id="7654562">data</span><span class="op" id="7654566">)</span>&nbsp;<span class="op" id="7654568">!=</span>&nbsp;<span class="string" id="7654571">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="7654587">||</span>&nbsp;<span class="ident" id="7654590">err</span>&nbsp;<span class="op" id="7654594">!=</span>&nbsp;<span class="ident" id="7654597">nil</span>&nbsp;<span class="op" id="7654601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654605">t</span><span class="op" id="7654606">.</span><span class="ident" id="7654607">Fatalf</span><span class="op" id="7654613">(</span><span class="string" id="7654614">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="7654646">,</span>&nbsp;<span class="ident" id="7654648">data</span><span class="op" id="7654652">,</span>&nbsp;<span class="ident" id="7654654">err</span><span class="op" id="7654657">,</span>&nbsp;<span class="string" id="7654659">&#34;hello&nbsp;world&#34;</span><span class="op" id="7654672">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654675">}</span><br>
<span class="lineno"></span><span class="op" id="7654677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7654680">func</span>&nbsp;<span class="ident" id="7654685">TestWriterReset</span><span class="op" id="7654700">(</span><span class="ident" id="7654701">t</span>&nbsp;<span class="op" id="7654703">*</span><span class="ident" id="7654704">testing</span><span class="op" id="7654711">.</span><span class="ident" id="7654712">T</span><span class="op" id="7654713">)</span>&nbsp;<span class="op" id="7654715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654718">buf</span>&nbsp;<span class="op" id="7654722">:=</span>&nbsp;<span class="builtinfunc" id="7654725">new</span><span class="op" id="7654728">(</span><span class="ident" id="7654729">bytes</span><span class="op" id="7654734">.</span><span class="ident" id="7654735">Buffer</span><span class="op" id="7654741">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654744">buf2</span>&nbsp;<span class="op" id="7654749">:=</span>&nbsp;<span class="builtinfunc" id="7654752">new</span><span class="op" id="7654755">(</span><span class="ident" id="7654756">bytes</span><span class="op" id="7654761">.</span><span class="ident" id="7654762">Buffer</span><span class="op" id="7654768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654771">z</span>&nbsp;<span class="op" id="7654773">:=</span>&nbsp;<span class="ident" id="7654776">NewWriter</span><span class="op" id="7654785">(</span><span class="ident" id="7654786">buf</span><span class="op" id="7654789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654792">msg</span>&nbsp;<span class="op" id="7654796">:=</span>&nbsp;<span class="op" id="7654799">[</span><span class="op" id="7654800">]</span><span class="builtintype" id="7654801">byte</span><span class="op" id="7654805">(</span><span class="string" id="7654806">&#34;hello&nbsp;world&#34;</span><span class="op" id="7654819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654822">z</span><span class="op" id="7654823">.</span><span class="ident" id="7654824">Write</span><span class="op" id="7654829">(</span><span class="ident" id="7654830">msg</span><span class="op" id="7654833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654836">z</span><span class="op" id="7654837">.</span><span class="ident" id="7654838">Close</span><span class="op" id="7654843">(</span><span class="op" id="7654844">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654847">z</span><span class="op" id="7654848">.</span><span class="ident" id="7654849">Reset</span><span class="op" id="7654854">(</span><span class="ident" id="7654855">buf2</span><span class="op" id="7654859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654862">z</span><span class="op" id="7654863">.</span><span class="ident" id="7654864">Write</span><span class="op" id="7654869">(</span><span class="ident" id="7654870">msg</span><span class="op" id="7654873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654876">z</span><span class="op" id="7654877">.</span><span class="ident" id="7654878">Close</span><span class="op" id="7654883">(</span><span class="op" id="7654884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654887">if</span>&nbsp;<span class="ident" id="7654890">buf</span><span class="op" id="7654893">.</span><span class="ident" id="7654894">String</span><span class="op" id="7654900">(</span><span class="op" id="7654901">)</span>&nbsp;<span class="op" id="7654903">!=</span>&nbsp;<span class="ident" id="7654906">buf2</span><span class="op" id="7654910">.</span><span class="ident" id="7654911">String</span><span class="op" id="7654917">(</span><span class="op" id="7654918">)</span>&nbsp;<span class="op" id="7654920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654924">t</span><span class="op" id="7654925">.</span><span class="ident" id="7654926">Errorf</span><span class="op" id="7654932">(</span><span class="string" id="7654933">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7654964">,</span>&nbsp;<span class="ident" id="7654966">buf2</span><span class="op" id="7654970">.</span><span class="ident" id="7654971">String</span><span class="op" id="7654977">(</span><span class="op" id="7654978">)</span><span class="op" id="7654979">,</span>&nbsp;<span class="ident" id="7654981">buf</span><span class="op" id="7654984">.</span><span class="ident" id="7654985">String</span><span class="op" id="7654991">(</span><span class="op" id="7654992">)</span><span class="op" id="7654993">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654996">}</span><br>
<span class="lineno"></span><span class="op" id="7654998">}</span>
</div>
</body>
</html>
