<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4652634">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4652689">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4652743">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4652794">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="4652851">package</span>&nbsp;<span class="ident" id="4652859">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4652869">import</span>&nbsp;<span class="op" id="4652876">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4652879">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4652888">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="4652899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4652902">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4652971">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="4653027">type</span>&nbsp;<span class="ident" id="4653032">ResponseRecorder</span>&nbsp;<span class="keyword" id="4653049">struct</span>&nbsp;<span class="op" id="4653056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653059">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4653069">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653083">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653127">HeaderMap</span>&nbsp;<span class="ident" id="4653137">http</span><span class="op" id="4653141">.</span><span class="ident" id="4653142">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4653151">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653181">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4653191">*</span><span class="ident" id="4653192">bytes</span><span class="op" id="4653197">.</span><span class="ident" id="4653198">Buffer</span>&nbsp;<span class="comment" id="4653205">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653264">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4653274">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653281">wroteHeader</span>&nbsp;<span class="builtintype" id="4653293">bool</span><br>
<span class="lineno"></span><span class="op" id="4653298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4653301">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="4653357">func</span>&nbsp;<span class="ident" id="4653362">NewRecorder</span><span class="op" id="4653373">(</span><span class="op" id="4653374">)</span>&nbsp;<span class="op" id="4653376">*</span><span class="ident" id="4653377">ResponseRecorder</span>&nbsp;<span class="op" id="4653394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653397">return</span>&nbsp;<span class="op" id="4653404">&amp;</span><span class="ident" id="4653405">ResponseRecorder</span><span class="op" id="4653421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653425">HeaderMap</span><span class="op" id="4653434">:</span>&nbsp;<span class="builtinfunc" id="4653436">make</span><span class="op" id="4653440">(</span><span class="ident" id="4653441">http</span><span class="op" id="4653445">.</span><span class="ident" id="4653446">Header</span><span class="op" id="4653452">)</span><span class="op" id="4653453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653457">Body</span><span class="op" id="4653461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4653468">new</span><span class="op" id="4653471">(</span><span class="ident" id="4653472">bytes</span><span class="op" id="4653477">.</span><span class="ident" id="4653478">Buffer</span><span class="op" id="4653484">)</span><span class="op" id="4653485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653489">Code</span><span class="op" id="4653493">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4653500">200</span><span class="op" id="4653503">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653506">}</span><br>
<span class="lineno"></span><span class="op" id="4653508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4653511">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4653589">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="4653653">const</span>&nbsp;<span class="ident" id="4653659">DefaultRemoteAddr</span>&nbsp;<span class="op" id="4653677">=</span>&nbsp;<span class="string" id="4653679">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4653690">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="4653730">func</span>&nbsp;<span class="op" id="4653735">(</span><span class="ident" id="4653736">rw</span>&nbsp;<span class="op" id="4653739">*</span><span class="ident" id="4653740">ResponseRecorder</span><span class="op" id="4653756">)</span>&nbsp;<span class="ident" id="4653758">Header</span><span class="op" id="4653764">(</span><span class="op" id="4653765">)</span>&nbsp;<span class="ident" id="4653767">http</span><span class="op" id="4653771">.</span><span class="ident" id="4653772">Header</span>&nbsp;<span class="op" id="4653779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653782">m</span>&nbsp;<span class="op" id="4653784">:=</span>&nbsp;<span class="ident" id="4653787">rw</span><span class="op" id="4653789">.</span><span class="ident" id="4653790">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653801">if</span>&nbsp;<span class="ident" id="4653804">m</span>&nbsp;<span class="op" id="4653806">==</span>&nbsp;<span class="ident" id="4653809">nil</span>&nbsp;<span class="op" id="4653813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653817">m</span>&nbsp;<span class="op" id="4653819">=</span>&nbsp;<span class="builtinfunc" id="4653821">make</span><span class="op" id="4653825">(</span><span class="ident" id="4653826">http</span><span class="op" id="4653830">.</span><span class="ident" id="4653831">Header</span><span class="op" id="4653837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653841">rw</span><span class="op" id="4653843">.</span><span class="ident" id="4653844">HeaderMap</span>&nbsp;<span class="op" id="4653854">=</span>&nbsp;<span class="ident" id="4653856">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653862">return</span>&nbsp;<span class="ident" id="4653869">m</span><br>
<span class="lineno">45</span><span class="op" id="4653871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4653874">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4653934">func</span>&nbsp;<span class="op" id="4653939">(</span><span class="ident" id="4653940">rw</span>&nbsp;<span class="op" id="4653943">*</span><span class="ident" id="4653944">ResponseRecorder</span><span class="op" id="4653960">)</span>&nbsp;<span class="ident" id="4653962">Write</span><span class="op" id="4653967">(</span><span class="ident" id="4653968">buf</span>&nbsp;<span class="op" id="4653972">[</span><span class="op" id="4653973">]</span><span class="builtintype" id="4653974">byte</span><span class="op" id="4653978">)</span>&nbsp;<span class="op" id="4653980">(</span><span class="builtintype" id="4653981">int</span><span class="op" id="4653984">,</span>&nbsp;<span class="builtintype" id="4653986">error</span><span class="op" id="4653991">)</span>&nbsp;<span class="op" id="4653993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653996">if</span>&nbsp;<span class="op" id="4653999">!</span><span class="ident" id="4654000">rw</span><span class="op" id="4654002">.</span><span class="ident" id="4654003">wroteHeader</span>&nbsp;<span class="op" id="4654015">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654019">rw</span><span class="op" id="4654021">.</span><span class="ident" id="4654022">WriteHeader</span><span class="op" id="4654033">(</span><span class="num" id="4654034">200</span><span class="op" id="4654037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654043">if</span>&nbsp;<span class="ident" id="4654046">rw</span><span class="op" id="4654048">.</span><span class="ident" id="4654049">Body</span>&nbsp;<span class="op" id="4654054">!=</span>&nbsp;<span class="ident" id="4654057">nil</span>&nbsp;<span class="op" id="4654061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654065">rw</span><span class="op" id="4654067">.</span><span class="ident" id="4654068">Body</span><span class="op" id="4654072">.</span><span class="ident" id="4654073">Write</span><span class="op" id="4654078">(</span><span class="ident" id="4654079">buf</span><span class="op" id="4654082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654085">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654088">return</span>&nbsp;<span class="builtinfunc" id="4654095">len</span><span class="op" id="4654098">(</span><span class="ident" id="4654099">buf</span><span class="op" id="4654102">)</span><span class="op" id="4654103">,</span>&nbsp;<span class="ident" id="4654105">nil</span><br>
<span class="lineno"></span><span class="op" id="4654109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4654112">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="4654141">func</span>&nbsp;<span class="op" id="4654146">(</span><span class="ident" id="4654147">rw</span>&nbsp;<span class="op" id="4654150">*</span><span class="ident" id="4654151">ResponseRecorder</span><span class="op" id="4654167">)</span>&nbsp;<span class="ident" id="4654169">WriteHeader</span><span class="op" id="4654180">(</span><span class="ident" id="4654181">code</span>&nbsp;<span class="builtintype" id="4654186">int</span><span class="op" id="4654189">)</span>&nbsp;<span class="op" id="4654191">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654194">if</span>&nbsp;<span class="op" id="4654197">!</span><span class="ident" id="4654198">rw</span><span class="op" id="4654200">.</span><span class="ident" id="4654201">wroteHeader</span>&nbsp;<span class="op" id="4654213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654217">rw</span><span class="op" id="4654219">.</span><span class="ident" id="4654220">Code</span>&nbsp;<span class="op" id="4654225">=</span>&nbsp;<span class="ident" id="4654227">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654236">rw</span><span class="op" id="4654238">.</span><span class="ident" id="4654239">wroteHeader</span>&nbsp;<span class="op" id="4654251">=</span>&nbsp;<span class="builtintype" id="4654253">true</span><br>
<span class="lineno"></span><span class="op" id="4654258">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4654261">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4654295">func</span>&nbsp;<span class="op" id="4654300">(</span><span class="ident" id="4654301">rw</span>&nbsp;<span class="op" id="4654304">*</span><span class="ident" id="4654305">ResponseRecorder</span><span class="op" id="4654321">)</span>&nbsp;<span class="ident" id="4654323">Flush</span><span class="op" id="4654328">(</span><span class="op" id="4654329">)</span>&nbsp;<span class="op" id="4654331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654334">if</span>&nbsp;<span class="op" id="4654337">!</span><span class="ident" id="4654338">rw</span><span class="op" id="4654340">.</span><span class="ident" id="4654341">wroteHeader</span>&nbsp;<span class="op" id="4654353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654357">rw</span><span class="op" id="4654359">.</span><span class="ident" id="4654360">WriteHeader</span><span class="op" id="4654371">(</span><span class="num" id="4654372">200</span><span class="op" id="4654375">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654381">rw</span><span class="op" id="4654383">.</span><span class="ident" id="4654384">Flushed</span>&nbsp;<span class="op" id="4654392">=</span>&nbsp;<span class="builtintype" id="4654394">true</span><br>
<span class="lineno"></span><span class="op" id="4654399">}</span>
</div>
</body>
</html>
