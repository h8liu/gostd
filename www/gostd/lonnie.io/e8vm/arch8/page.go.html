<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4796693">package</span>&nbsp;<span class="ident" id="4796701">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796708">import</span>&nbsp;<span class="op" id="4796715">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4796718">&#34;encoding/binary&#34;</span><br>
<span class="lineno">5</span><span class="op" id="4796736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4796739">//&nbsp;PageSize&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;a&nbsp;page&nbsp;contains.</span><br>
<span class="lineno"></span><span class="keyword" id="4796791">const</span>&nbsp;<span class="ident" id="4796797">PageSize</span>&nbsp;<span class="op" id="4796806">=</span>&nbsp;<span class="num" id="4796808">4096</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="4796814">//&nbsp;Page&nbsp;is&nbsp;a&nbsp;memory&nbsp;addressable&nbsp;area&nbsp;of&nbsp;PageSize&nbsp;bytes</span><br>
<span class="lineno"></span><span class="keyword" id="4796869">type</span>&nbsp;<span class="ident" id="4796874">page</span>&nbsp;<span class="keyword" id="4796879">struct</span>&nbsp;<span class="op" id="4796886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796889">Bytes</span>&nbsp;<span class="op" id="4796895">[</span><span class="op" id="4796896">]</span><span class="builtintype" id="4796897">byte</span><br>
<span class="lineno"></span><span class="op" id="4796902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4796905">//&nbsp;NewPage&nbsp;creates&nbsp;a&nbsp;new&nbsp;empty&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="4796942">func</span>&nbsp;<span class="ident" id="4796947">newPage</span><span class="op" id="4796954">(</span><span class="op" id="4796955">)</span>&nbsp;<span class="op" id="4796957">*</span><span class="ident" id="4796958">page</span>&nbsp;<span class="op" id="4796963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796966">return</span>&nbsp;<span class="op" id="4796973">&amp;</span><span class="ident" id="4796974">page</span><span class="op" id="4796978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796982">Bytes</span><span class="op" id="4796987">:</span>&nbsp;<span class="builtinfunc" id="4796989">make</span><span class="op" id="4796993">(</span><span class="op" id="4796994">[</span><span class="op" id="4796995">]</span><span class="builtintype" id="4796996">byte</span><span class="op" id="4797000">,</span>&nbsp;<span class="ident" id="4797002">PageSize</span><span class="op" id="4797010">)</span><span class="op" id="4797011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797014">}</span><br>
<span class="lineno">20</span><span class="op" id="4797016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797019">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4797070">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="keyword" id="4797129">func</span>&nbsp;<span class="op" id="4797134">(</span><span class="ident" id="4797135">p</span>&nbsp;<span class="op" id="4797137">*</span><span class="ident" id="4797138">page</span><span class="op" id="4797142">)</span>&nbsp;<span class="ident" id="4797144">ReadByte</span><span class="op" id="4797152">(</span><span class="ident" id="4797153">offset</span>&nbsp;<span class="builtintype" id="4797160">uint32</span><span class="op" id="4797166">)</span>&nbsp;<span class="builtintype" id="4797168">byte</span>&nbsp;<span class="op" id="4797173">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797176">return</span>&nbsp;<span class="ident" id="4797183">p</span><span class="op" id="4797184">.</span><span class="ident" id="4797185">Bytes</span><span class="op" id="4797190">[</span><span class="ident" id="4797191">offset</span><span class="op" id="4797197">%</span><span class="ident" id="4797198">PageSize</span><span class="op" id="4797206">]</span><br>
<span class="lineno"></span><span class="op" id="4797208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797211">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;page&nbsp;at&nbsp;a&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4797276">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno">30</span><span class="keyword" id="4797335">func</span>&nbsp;<span class="op" id="4797340">(</span><span class="ident" id="4797341">p</span>&nbsp;<span class="op" id="4797343">*</span><span class="ident" id="4797344">page</span><span class="op" id="4797348">)</span>&nbsp;<span class="ident" id="4797350">WriteByte</span><span class="op" id="4797359">(</span><span class="ident" id="4797360">offset</span>&nbsp;<span class="builtintype" id="4797367">uint32</span><span class="op" id="4797373">,</span>&nbsp;<span class="ident" id="4797375">b</span>&nbsp;<span class="builtintype" id="4797377">byte</span><span class="op" id="4797381">)</span>&nbsp;<span class="op" id="4797383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797386">p</span><span class="op" id="4797387">.</span><span class="ident" id="4797388">Bytes</span><span class="op" id="4797393">[</span><span class="ident" id="4797394">offset</span><span class="op" id="4797400">%</span><span class="ident" id="4797401">PageSize</span><span class="op" id="4797409">]</span>&nbsp;<span class="op" id="4797411">=</span>&nbsp;<span class="ident" id="4797413">b</span><br>
<span class="lineno"></span><span class="op" id="4797415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797418">//&nbsp;The&nbsp;machines&nbsp;endian.</span><br>
<span class="lineno">35</span><span class="keyword" id="4797442">var</span>&nbsp;<span class="ident" id="4797446">Endian</span>&nbsp;<span class="op" id="4797453">=</span>&nbsp;<span class="ident" id="4797455">binary</span><span class="op" id="4797461">.</span><span class="ident" id="4797462">LittleEndian</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4797476">func</span>&nbsp;<span class="ident" id="4797481">wordOff</span><span class="op" id="4797488">(</span><span class="ident" id="4797489">offset</span>&nbsp;<span class="builtintype" id="4797496">uint32</span><span class="op" id="4797502">)</span>&nbsp;<span class="builtintype" id="4797504">uint32</span>&nbsp;<span class="op" id="4797511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797514">return</span>&nbsp;<span class="op" id="4797521">(</span><span class="ident" id="4797522">offset</span>&nbsp;<span class="op" id="4797529">%</span>&nbsp;<span class="ident" id="4797531">PageSize</span><span class="op" id="4797539">)</span>&nbsp;<span class="op" id="4797541">&amp;</span>&nbsp;<span class="op" id="4797543">^</span><span class="builtintype" id="4797544">uint32</span><span class="op" id="4797550">(</span><span class="num" id="4797551">0x3</span><span class="op" id="4797554">)</span><br>
<span class="lineno"></span><span class="op" id="4797556">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4797559">//&nbsp;ReadWord&nbsp;reads&nbsp;the&nbsp;word&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4797612">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="comment" id="4797671">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;aligns&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="4797725">func</span>&nbsp;<span class="op" id="4797730">(</span><span class="ident" id="4797731">p</span>&nbsp;<span class="op" id="4797733">*</span><span class="ident" id="4797734">page</span><span class="op" id="4797738">)</span>&nbsp;<span class="ident" id="4797740">ReadWord</span><span class="op" id="4797748">(</span><span class="ident" id="4797749">offset</span>&nbsp;<span class="builtintype" id="4797756">uint32</span><span class="op" id="4797762">)</span>&nbsp;<span class="builtintype" id="4797764">uint32</span>&nbsp;<span class="op" id="4797771">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797774">offset</span>&nbsp;<span class="op" id="4797781">=</span>&nbsp;<span class="ident" id="4797783">wordOff</span><span class="op" id="4797790">(</span><span class="ident" id="4797791">offset</span><span class="op" id="4797797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797800">return</span>&nbsp;<span class="ident" id="4797807">Endian</span><span class="op" id="4797813">.</span><span class="ident" id="4797814">Uint32</span><span class="op" id="4797820">(</span><span class="ident" id="4797821">p</span><span class="op" id="4797822">.</span><span class="ident" id="4797823">Bytes</span><span class="op" id="4797828">[</span><span class="ident" id="4797829">offset</span>&nbsp;<span class="op" id="4797836">:</span>&nbsp;<span class="ident" id="4797838">offset</span><span class="op" id="4797844">+</span><span class="num" id="4797845">4</span><span class="op" id="4797846">]</span><span class="op" id="4797847">)</span><br>
<span class="lineno"></span><span class="op" id="4797849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797852">//&nbsp;WriteWord&nbsp;writes&nbsp;the&nbsp;word&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno">50</span><span class="comment" id="4797907">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="comment" id="4797966">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;aligns&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="4798020">func</span>&nbsp;<span class="op" id="4798025">(</span><span class="ident" id="4798026">p</span>&nbsp;<span class="op" id="4798028">*</span><span class="ident" id="4798029">page</span><span class="op" id="4798033">)</span>&nbsp;<span class="ident" id="4798035">WriteWord</span><span class="op" id="4798044">(</span><span class="ident" id="4798045">offset</span>&nbsp;<span class="builtintype" id="4798052">uint32</span><span class="op" id="4798058">,</span>&nbsp;<span class="ident" id="4798060">w</span>&nbsp;<span class="builtintype" id="4798062">uint32</span><span class="op" id="4798068">)</span>&nbsp;<span class="op" id="4798070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798073">offset</span>&nbsp;<span class="op" id="4798080">=</span>&nbsp;<span class="ident" id="4798082">wordOff</span><span class="op" id="4798089">(</span><span class="ident" id="4798090">offset</span><span class="op" id="4798096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798099">Endian</span><span class="op" id="4798105">.</span><span class="ident" id="4798106">PutUint32</span><span class="op" id="4798115">(</span><span class="ident" id="4798116">p</span><span class="op" id="4798117">.</span><span class="ident" id="4798118">Bytes</span><span class="op" id="4798123">[</span><span class="ident" id="4798124">offset</span><span class="op" id="4798130">:</span><span class="ident" id="4798131">offset</span><span class="op" id="4798137">+</span><span class="num" id="4798138">4</span><span class="op" id="4798139">]</span><span class="op" id="4798140">,</span>&nbsp;<span class="ident" id="4798142">w</span><span class="op" id="4798143">)</span><br>
<span class="lineno">55</span><span class="op" id="4798145">}</span>
</div>
</body>
</html>
