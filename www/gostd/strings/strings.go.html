<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2972594">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2972649">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2972703">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2972754">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2972824">package</span>&nbsp;<span class="ident" id="2972832">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2972841">import</span>&nbsp;<span class="op" id="2972848">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2972851">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2972862">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2972877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2972880">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2973021">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2973084">func</span>&nbsp;<span class="ident" id="2973089">explode</span><span class="op" id="2973096">(</span><span class="ident" id="2973097">s</span>&nbsp;<span class="builtintype" id="2973099">string</span><span class="op" id="2973105">,</span>&nbsp;<span class="ident" id="2973107">n</span>&nbsp;<span class="builtintype" id="2973109">int</span><span class="op" id="2973112">)</span>&nbsp;<span class="op" id="2973114">[</span><span class="op" id="2973115">]</span><span class="builtintype" id="2973116">string</span>&nbsp;<span class="op" id="2973123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973126">if</span>&nbsp;<span class="ident" id="2973129">n</span>&nbsp;<span class="op" id="2973131">==</span>&nbsp;<span class="num" id="2973134">0</span>&nbsp;<span class="op" id="2973136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973140">return</span>&nbsp;<span class="ident" id="2973147">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973155">l</span>&nbsp;<span class="op" id="2973157">:=</span>&nbsp;<span class="ident" id="2973160">utf8</span><span class="op" id="2973164">.</span><span class="ident" id="2973165">RuneCountInString</span><span class="op" id="2973182">(</span><span class="ident" id="2973183">s</span><span class="op" id="2973184">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973187">if</span>&nbsp;<span class="ident" id="2973190">n</span>&nbsp;<span class="op" id="2973192">&lt;=</span>&nbsp;<span class="num" id="2973195">0</span>&nbsp;<span class="op" id="2973197">||</span>&nbsp;<span class="ident" id="2973200">n</span>&nbsp;<span class="op" id="2973202">&gt;</span>&nbsp;<span class="ident" id="2973204">l</span>&nbsp;<span class="op" id="2973206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973210">n</span>&nbsp;<span class="op" id="2973212">=</span>&nbsp;<span class="ident" id="2973214">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973220">a</span>&nbsp;<span class="op" id="2973222">:=</span>&nbsp;<span class="builtinfunc" id="2973225">make</span><span class="op" id="2973229">(</span><span class="op" id="2973230">[</span><span class="op" id="2973231">]</span><span class="builtintype" id="2973232">string</span><span class="op" id="2973238">,</span>&nbsp;<span class="ident" id="2973240">n</span><span class="op" id="2973241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973244">var</span>&nbsp;<span class="ident" id="2973248">size</span>&nbsp;<span class="builtintype" id="2973253">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973258">var</span>&nbsp;<span class="ident" id="2973262">ch</span>&nbsp;<span class="builtintype" id="2973265">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973271">i</span><span class="op" id="2973272">,</span>&nbsp;<span class="ident" id="2973274">cur</span>&nbsp;<span class="op" id="2973278">:=</span>&nbsp;<span class="num" id="2973281">0</span><span class="op" id="2973282">,</span>&nbsp;<span class="num" id="2973284">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973287">for</span>&nbsp;<span class="op" id="2973291">;</span>&nbsp;<span class="ident" id="2973293">i</span><span class="op" id="2973294">+</span><span class="num" id="2973295">1</span>&nbsp;<span class="op" id="2973297">&lt;</span>&nbsp;<span class="ident" id="2973299">n</span><span class="op" id="2973300">;</span>&nbsp;<span class="ident" id="2973302">i</span><span class="op" id="2973303">++</span>&nbsp;<span class="op" id="2973306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973310">ch</span><span class="op" id="2973312">,</span>&nbsp;<span class="ident" id="2973314">size</span>&nbsp;<span class="op" id="2973319">=</span>&nbsp;<span class="ident" id="2973321">utf8</span><span class="op" id="2973325">.</span><span class="ident" id="2973326">DecodeRuneInString</span><span class="op" id="2973344">(</span><span class="ident" id="2973345">s</span><span class="op" id="2973346">[</span><span class="ident" id="2973347">cur</span><span class="op" id="2973350">:</span><span class="op" id="2973351">]</span><span class="op" id="2973352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973356">if</span>&nbsp;<span class="ident" id="2973359">ch</span>&nbsp;<span class="op" id="2973362">==</span>&nbsp;<span class="ident" id="2973365">utf8</span><span class="op" id="2973369">.</span><span class="ident" id="2973370">RuneError</span>&nbsp;<span class="op" id="2973380">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973385">a</span><span class="op" id="2973386">[</span><span class="ident" id="2973387">i</span><span class="op" id="2973388">]</span>&nbsp;<span class="op" id="2973390">=</span>&nbsp;<span class="builtintype" id="2973392">string</span><span class="op" id="2973398">(</span><span class="ident" id="2973399">utf8</span><span class="op" id="2973403">.</span><span class="ident" id="2973404">RuneError</span><span class="op" id="2973413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973417">}</span>&nbsp;<span class="keyword" id="2973419">else</span>&nbsp;<span class="op" id="2973424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973429">a</span><span class="op" id="2973430">[</span><span class="ident" id="2973431">i</span><span class="op" id="2973432">]</span>&nbsp;<span class="op" id="2973434">=</span>&nbsp;<span class="ident" id="2973436">s</span><span class="op" id="2973437">[</span><span class="ident" id="2973438">cur</span>&nbsp;<span class="op" id="2973442">:</span>&nbsp;<span class="ident" id="2973444">cur</span><span class="op" id="2973447">+</span><span class="ident" id="2973448">size</span><span class="op" id="2973452">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973460">cur</span>&nbsp;<span class="op" id="2973464">+=</span>&nbsp;<span class="ident" id="2973467">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2973476">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973510">if</span>&nbsp;<span class="ident" id="2973513">cur</span>&nbsp;<span class="op" id="2973517">&lt;</span>&nbsp;<span class="builtinfunc" id="2973519">len</span><span class="op" id="2973522">(</span><span class="ident" id="2973523">s</span><span class="op" id="2973524">)</span>&nbsp;<span class="op" id="2973526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973530">a</span><span class="op" id="2973531">[</span><span class="ident" id="2973532">i</span><span class="op" id="2973533">]</span>&nbsp;<span class="op" id="2973535">=</span>&nbsp;<span class="ident" id="2973537">s</span><span class="op" id="2973538">[</span><span class="ident" id="2973539">cur</span><span class="op" id="2973542">:</span><span class="op" id="2973543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973546">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973549">return</span>&nbsp;<span class="ident" id="2973556">a</span><br>
<span class="lineno"></span><span class="op" id="2973558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2973561">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2973620">const</span>&nbsp;<span class="ident" id="2973626">primeRK</span>&nbsp;<span class="op" id="2973634">=</span>&nbsp;<span class="num" id="2973636">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2973646">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2973709">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2973752">func</span>&nbsp;<span class="ident" id="2973757">hashStr</span><span class="op" id="2973764">(</span><span class="ident" id="2973765">sep</span>&nbsp;<span class="builtintype" id="2973769">string</span><span class="op" id="2973775">)</span>&nbsp;<span class="op" id="2973777">(</span><span class="builtintype" id="2973778">uint32</span><span class="op" id="2973784">,</span>&nbsp;<span class="builtintype" id="2973786">uint32</span><span class="op" id="2973792">)</span>&nbsp;<span class="op" id="2973794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973797">hash</span>&nbsp;<span class="op" id="2973802">:=</span>&nbsp;<span class="builtintype" id="2973805">uint32</span><span class="op" id="2973811">(</span><span class="num" id="2973812">0</span><span class="op" id="2973813">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973816">for</span>&nbsp;<span class="ident" id="2973820">i</span>&nbsp;<span class="op" id="2973822">:=</span>&nbsp;<span class="num" id="2973825">0</span><span class="op" id="2973826">;</span>&nbsp;<span class="ident" id="2973828">i</span>&nbsp;<span class="op" id="2973830">&lt;</span>&nbsp;<span class="builtinfunc" id="2973832">len</span><span class="op" id="2973835">(</span><span class="ident" id="2973836">sep</span><span class="op" id="2973839">)</span><span class="op" id="2973840">;</span>&nbsp;<span class="ident" id="2973842">i</span><span class="op" id="2973843">++</span>&nbsp;<span class="op" id="2973846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973850">hash</span>&nbsp;<span class="op" id="2973855">=</span>&nbsp;<span class="ident" id="2973857">hash</span><span class="op" id="2973861">*</span><span class="ident" id="2973862">primeRK</span>&nbsp;<span class="op" id="2973870">+</span>&nbsp;<span class="builtintype" id="2973872">uint32</span><span class="op" id="2973878">(</span><span class="ident" id="2973879">sep</span><span class="op" id="2973882">[</span><span class="ident" id="2973883">i</span><span class="op" id="2973884">]</span><span class="op" id="2973885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973891">var</span>&nbsp;<span class="ident" id="2973895">pow</span><span class="op" id="2973898">,</span>&nbsp;<span class="ident" id="2973900">sq</span>&nbsp;<span class="builtintype" id="2973903">uint32</span>&nbsp;<span class="op" id="2973910">=</span>&nbsp;<span class="num" id="2973912">1</span><span class="op" id="2973913">,</span>&nbsp;<span class="ident" id="2973915">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973924">for</span>&nbsp;<span class="ident" id="2973928">i</span>&nbsp;<span class="op" id="2973930">:=</span>&nbsp;<span class="builtinfunc" id="2973933">len</span><span class="op" id="2973936">(</span><span class="ident" id="2973937">sep</span><span class="op" id="2973940">)</span><span class="op" id="2973941">;</span>&nbsp;<span class="ident" id="2973943">i</span>&nbsp;<span class="op" id="2973945">&gt;</span>&nbsp;<span class="num" id="2973947">0</span><span class="op" id="2973948">;</span>&nbsp;<span class="ident" id="2973950">i</span>&nbsp;<span class="op" id="2973952">&gt;&gt;=</span>&nbsp;<span class="num" id="2973956">1</span>&nbsp;<span class="op" id="2973958">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973962">if</span>&nbsp;<span class="ident" id="2973965">i</span><span class="op" id="2973966">&amp;</span><span class="num" id="2973967">1</span>&nbsp;<span class="op" id="2973969">!=</span>&nbsp;<span class="num" id="2973972">0</span>&nbsp;<span class="op" id="2973974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973979">pow</span>&nbsp;<span class="op" id="2973983">*=</span>&nbsp;<span class="ident" id="2973986">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973995">sq</span>&nbsp;<span class="op" id="2973998">*=</span>&nbsp;<span class="ident" id="2974001">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974005">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974008">return</span>&nbsp;<span class="ident" id="2974015">hash</span><span class="op" id="2974019">,</span>&nbsp;<span class="ident" id="2974021">pow</span><br>
<span class="lineno"></span><span class="op" id="2974025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2974028">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2974089">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2974159">func</span>&nbsp;<span class="ident" id="2974164">hashStrRev</span><span class="op" id="2974174">(</span><span class="ident" id="2974175">sep</span>&nbsp;<span class="builtintype" id="2974179">string</span><span class="op" id="2974185">)</span>&nbsp;<span class="op" id="2974187">(</span><span class="builtintype" id="2974188">uint32</span><span class="op" id="2974194">,</span>&nbsp;<span class="builtintype" id="2974196">uint32</span><span class="op" id="2974202">)</span>&nbsp;<span class="op" id="2974204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974207">hash</span>&nbsp;<span class="op" id="2974212">:=</span>&nbsp;<span class="builtintype" id="2974215">uint32</span><span class="op" id="2974221">(</span><span class="num" id="2974222">0</span><span class="op" id="2974223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974226">for</span>&nbsp;<span class="ident" id="2974230">i</span>&nbsp;<span class="op" id="2974232">:=</span>&nbsp;<span class="builtinfunc" id="2974235">len</span><span class="op" id="2974238">(</span><span class="ident" id="2974239">sep</span><span class="op" id="2974242">)</span>&nbsp;<span class="op" id="2974244">-</span>&nbsp;<span class="num" id="2974246">1</span><span class="op" id="2974247">;</span>&nbsp;<span class="ident" id="2974249">i</span>&nbsp;<span class="op" id="2974251">&gt;=</span>&nbsp;<span class="num" id="2974254">0</span><span class="op" id="2974255">;</span>&nbsp;<span class="ident" id="2974257">i</span><span class="op" id="2974258">--</span>&nbsp;<span class="op" id="2974261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974265">hash</span>&nbsp;<span class="op" id="2974270">=</span>&nbsp;<span class="ident" id="2974272">hash</span><span class="op" id="2974276">*</span><span class="ident" id="2974277">primeRK</span>&nbsp;<span class="op" id="2974285">+</span>&nbsp;<span class="builtintype" id="2974287">uint32</span><span class="op" id="2974293">(</span><span class="ident" id="2974294">sep</span><span class="op" id="2974297">[</span><span class="ident" id="2974298">i</span><span class="op" id="2974299">]</span><span class="op" id="2974300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974303">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974306">var</span>&nbsp;<span class="ident" id="2974310">pow</span><span class="op" id="2974313">,</span>&nbsp;<span class="ident" id="2974315">sq</span>&nbsp;<span class="builtintype" id="2974318">uint32</span>&nbsp;<span class="op" id="2974325">=</span>&nbsp;<span class="num" id="2974327">1</span><span class="op" id="2974328">,</span>&nbsp;<span class="ident" id="2974330">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974339">for</span>&nbsp;<span class="ident" id="2974343">i</span>&nbsp;<span class="op" id="2974345">:=</span>&nbsp;<span class="builtinfunc" id="2974348">len</span><span class="op" id="2974351">(</span><span class="ident" id="2974352">sep</span><span class="op" id="2974355">)</span><span class="op" id="2974356">;</span>&nbsp;<span class="ident" id="2974358">i</span>&nbsp;<span class="op" id="2974360">&gt;</span>&nbsp;<span class="num" id="2974362">0</span><span class="op" id="2974363">;</span>&nbsp;<span class="ident" id="2974365">i</span>&nbsp;<span class="op" id="2974367">&gt;&gt;=</span>&nbsp;<span class="num" id="2974371">1</span>&nbsp;<span class="op" id="2974373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974377">if</span>&nbsp;<span class="ident" id="2974380">i</span><span class="op" id="2974381">&amp;</span><span class="num" id="2974382">1</span>&nbsp;<span class="op" id="2974384">!=</span>&nbsp;<span class="num" id="2974387">0</span>&nbsp;<span class="op" id="2974389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974394">pow</span>&nbsp;<span class="op" id="2974398">*=</span>&nbsp;<span class="ident" id="2974401">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974406">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974410">sq</span>&nbsp;<span class="op" id="2974413">*=</span>&nbsp;<span class="ident" id="2974416">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974423">return</span>&nbsp;<span class="ident" id="2974430">hash</span><span class="op" id="2974434">,</span>&nbsp;<span class="ident" id="2974436">pow</span><br>
<span class="lineno"></span><span class="op" id="2974440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2974443">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2974512">func</span>&nbsp;<span class="ident" id="2974517">Count</span><span class="op" id="2974522">(</span><span class="ident" id="2974523">s</span><span class="op" id="2974524">,</span>&nbsp;<span class="ident" id="2974526">sep</span>&nbsp;<span class="builtintype" id="2974530">string</span><span class="op" id="2974536">)</span>&nbsp;<span class="builtintype" id="2974538">int</span>&nbsp;<span class="op" id="2974542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974545">n</span>&nbsp;<span class="op" id="2974547">:=</span>&nbsp;<span class="num" id="2974550">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2974553">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974571">switch</span>&nbsp;<span class="op" id="2974578">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974581">case</span>&nbsp;<span class="builtinfunc" id="2974586">len</span><span class="op" id="2974589">(</span><span class="ident" id="2974590">sep</span><span class="op" id="2974593">)</span>&nbsp;<span class="op" id="2974595">==</span>&nbsp;<span class="num" id="2974598">0</span><span class="op" id="2974599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974603">return</span>&nbsp;<span class="ident" id="2974610">utf8</span><span class="op" id="2974614">.</span><span class="ident" id="2974615">RuneCountInString</span><span class="op" id="2974632">(</span><span class="ident" id="2974633">s</span><span class="op" id="2974634">)</span>&nbsp;<span class="op" id="2974636">+</span>&nbsp;<span class="num" id="2974638">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974641">case</span>&nbsp;<span class="builtinfunc" id="2974646">len</span><span class="op" id="2974649">(</span><span class="ident" id="2974650">sep</span><span class="op" id="2974653">)</span>&nbsp;<span class="op" id="2974655">==</span>&nbsp;<span class="num" id="2974658">1</span><span class="op" id="2974659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2974663">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974699">c</span>&nbsp;<span class="op" id="2974701">:=</span>&nbsp;<span class="ident" id="2974704">sep</span><span class="op" id="2974707">[</span><span class="num" id="2974708">0</span><span class="op" id="2974709">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974713">for</span>&nbsp;<span class="ident" id="2974717">i</span>&nbsp;<span class="op" id="2974719">:=</span>&nbsp;<span class="num" id="2974722">0</span><span class="op" id="2974723">;</span>&nbsp;<span class="ident" id="2974725">i</span>&nbsp;<span class="op" id="2974727">&lt;</span>&nbsp;<span class="builtinfunc" id="2974729">len</span><span class="op" id="2974732">(</span><span class="ident" id="2974733">s</span><span class="op" id="2974734">)</span><span class="op" id="2974735">;</span>&nbsp;<span class="ident" id="2974737">i</span><span class="op" id="2974738">++</span>&nbsp;<span class="op" id="2974741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974746">if</span>&nbsp;<span class="ident" id="2974749">s</span><span class="op" id="2974750">[</span><span class="ident" id="2974751">i</span><span class="op" id="2974752">]</span>&nbsp;<span class="op" id="2974754">==</span>&nbsp;<span class="ident" id="2974757">c</span>&nbsp;<span class="op" id="2974759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974765">n</span><span class="op" id="2974766">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974776">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974780">return</span>&nbsp;<span class="ident" id="2974787">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974790">case</span>&nbsp;<span class="builtinfunc" id="2974795">len</span><span class="op" id="2974798">(</span><span class="ident" id="2974799">sep</span><span class="op" id="2974802">)</span>&nbsp;<span class="op" id="2974804">&gt;</span>&nbsp;<span class="builtinfunc" id="2974806">len</span><span class="op" id="2974809">(</span><span class="ident" id="2974810">s</span><span class="op" id="2974811">)</span><span class="op" id="2974812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974816">return</span>&nbsp;<span class="num" id="2974823">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974826">case</span>&nbsp;<span class="builtinfunc" id="2974831">len</span><span class="op" id="2974834">(</span><span class="ident" id="2974835">sep</span><span class="op" id="2974838">)</span>&nbsp;<span class="op" id="2974840">==</span>&nbsp;<span class="builtinfunc" id="2974843">len</span><span class="op" id="2974846">(</span><span class="ident" id="2974847">s</span><span class="op" id="2974848">)</span><span class="op" id="2974849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974853">if</span>&nbsp;<span class="ident" id="2974856">sep</span>&nbsp;<span class="op" id="2974860">==</span>&nbsp;<span class="ident" id="2974863">s</span>&nbsp;<span class="op" id="2974865">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974870">return</span>&nbsp;<span class="num" id="2974877">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974885">return</span>&nbsp;<span class="num" id="2974892">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2974895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2974898">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974920">hashsep</span><span class="op" id="2974927">,</span>&nbsp;<span class="ident" id="2974929">pow</span>&nbsp;<span class="op" id="2974933">:=</span>&nbsp;<span class="ident" id="2974936">hashStr</span><span class="op" id="2974943">(</span><span class="ident" id="2974944">sep</span><span class="op" id="2974947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2974950">h</span>&nbsp;<span class="op" id="2974952">:=</span>&nbsp;<span class="builtintype" id="2974955">uint32</span><span class="op" id="2974961">(</span><span class="num" id="2974962">0</span><span class="op" id="2974963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974966">for</span>&nbsp;<span class="ident" id="2974970">i</span>&nbsp;<span class="op" id="2974972">:=</span>&nbsp;<span class="num" id="2974975">0</span><span class="op" id="2974976">;</span>&nbsp;<span class="ident" id="2974978">i</span>&nbsp;<span class="op" id="2974980">&lt;</span>&nbsp;<span class="builtinfunc" id="2974982">len</span><span class="op" id="2974985">(</span><span class="ident" id="2974986">sep</span><span class="op" id="2974989">)</span><span class="op" id="2974990">;</span>&nbsp;<span class="ident" id="2974992">i</span><span class="op" id="2974993">++</span>&nbsp;<span class="op" id="2974996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975000">h</span>&nbsp;<span class="op" id="2975002">=</span>&nbsp;<span class="ident" id="2975004">h</span><span class="op" id="2975005">*</span><span class="ident" id="2975006">primeRK</span>&nbsp;<span class="op" id="2975014">+</span>&nbsp;<span class="builtintype" id="2975016">uint32</span><span class="op" id="2975022">(</span><span class="ident" id="2975023">s</span><span class="op" id="2975024">[</span><span class="ident" id="2975025">i</span><span class="op" id="2975026">]</span><span class="op" id="2975027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975030">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975033">lastmatch</span>&nbsp;<span class="op" id="2975043">:=</span>&nbsp;<span class="num" id="2975046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975049">if</span>&nbsp;<span class="ident" id="2975052">h</span>&nbsp;<span class="op" id="2975054">==</span>&nbsp;<span class="ident" id="2975057">hashsep</span>&nbsp;<span class="op" id="2975065">&amp;&amp;</span>&nbsp;<span class="ident" id="2975068">s</span><span class="op" id="2975069">[</span><span class="op" id="2975070">:</span><span class="builtinfunc" id="2975071">len</span><span class="op" id="2975074">(</span><span class="ident" id="2975075">sep</span><span class="op" id="2975078">)</span><span class="op" id="2975079">]</span>&nbsp;<span class="op" id="2975081">==</span>&nbsp;<span class="ident" id="2975084">sep</span>&nbsp;<span class="op" id="2975088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975092">n</span><span class="op" id="2975093">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975098">lastmatch</span>&nbsp;<span class="op" id="2975108">=</span>&nbsp;<span class="builtinfunc" id="2975110">len</span><span class="op" id="2975113">(</span><span class="ident" id="2975114">sep</span><span class="op" id="2975117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975120">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975123">for</span>&nbsp;<span class="ident" id="2975127">i</span>&nbsp;<span class="op" id="2975129">:=</span>&nbsp;<span class="builtinfunc" id="2975132">len</span><span class="op" id="2975135">(</span><span class="ident" id="2975136">sep</span><span class="op" id="2975139">)</span><span class="op" id="2975140">;</span>&nbsp;<span class="ident" id="2975142">i</span>&nbsp;<span class="op" id="2975144">&lt;</span>&nbsp;<span class="builtinfunc" id="2975146">len</span><span class="op" id="2975149">(</span><span class="ident" id="2975150">s</span><span class="op" id="2975151">)</span><span class="op" id="2975152">;</span>&nbsp;<span class="op" id="2975154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975158">h</span>&nbsp;<span class="op" id="2975160">*=</span>&nbsp;<span class="ident" id="2975163">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975173">h</span>&nbsp;<span class="op" id="2975175">+=</span>&nbsp;<span class="builtintype" id="2975178">uint32</span><span class="op" id="2975184">(</span><span class="ident" id="2975185">s</span><span class="op" id="2975186">[</span><span class="ident" id="2975187">i</span><span class="op" id="2975188">]</span><span class="op" id="2975189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975193">h</span>&nbsp;<span class="op" id="2975195">-=</span>&nbsp;<span class="ident" id="2975198">pow</span>&nbsp;<span class="op" id="2975202">*</span>&nbsp;<span class="builtintype" id="2975204">uint32</span><span class="op" id="2975210">(</span><span class="ident" id="2975211">s</span><span class="op" id="2975212">[</span><span class="ident" id="2975213">i</span><span class="op" id="2975214">-</span><span class="builtinfunc" id="2975215">len</span><span class="op" id="2975218">(</span><span class="ident" id="2975219">sep</span><span class="op" id="2975222">)</span><span class="op" id="2975223">]</span><span class="op" id="2975224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975228">i</span><span class="op" id="2975229">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975234">if</span>&nbsp;<span class="ident" id="2975237">h</span>&nbsp;<span class="op" id="2975239">==</span>&nbsp;<span class="ident" id="2975242">hashsep</span>&nbsp;<span class="op" id="2975250">&amp;&amp;</span>&nbsp;<span class="ident" id="2975253">lastmatch</span>&nbsp;<span class="op" id="2975263">&lt;=</span>&nbsp;<span class="ident" id="2975266">i</span><span class="op" id="2975267">-</span><span class="builtinfunc" id="2975268">len</span><span class="op" id="2975271">(</span><span class="ident" id="2975272">sep</span><span class="op" id="2975275">)</span>&nbsp;<span class="op" id="2975277">&amp;&amp;</span>&nbsp;<span class="ident" id="2975280">s</span><span class="op" id="2975281">[</span><span class="ident" id="2975282">i</span><span class="op" id="2975283">-</span><span class="builtinfunc" id="2975284">len</span><span class="op" id="2975287">(</span><span class="ident" id="2975288">sep</span><span class="op" id="2975291">)</span><span class="op" id="2975292">:</span><span class="ident" id="2975293">i</span><span class="op" id="2975294">]</span>&nbsp;<span class="op" id="2975296">==</span>&nbsp;<span class="ident" id="2975299">sep</span>&nbsp;<span class="op" id="2975303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975308">n</span><span class="op" id="2975309">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975315">lastmatch</span>&nbsp;<span class="op" id="2975325">=</span>&nbsp;<span class="ident" id="2975327">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975334">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975337">return</span>&nbsp;<span class="ident" id="2975344">n</span><br>
<span class="lineno"></span><span class="op" id="2975346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2975349">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2975397">func</span>&nbsp;<span class="ident" id="2975402">Contains</span><span class="op" id="2975410">(</span><span class="ident" id="2975411">s</span><span class="op" id="2975412">,</span>&nbsp;<span class="ident" id="2975414">substr</span>&nbsp;<span class="builtintype" id="2975421">string</span><span class="op" id="2975427">)</span>&nbsp;<span class="builtintype" id="2975429">bool</span>&nbsp;<span class="op" id="2975434">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975437">return</span>&nbsp;<span class="ident" id="2975444">Index</span><span class="op" id="2975449">(</span><span class="ident" id="2975450">s</span><span class="op" id="2975451">,</span>&nbsp;<span class="ident" id="2975453">substr</span><span class="op" id="2975459">)</span>&nbsp;<span class="op" id="2975461">&gt;=</span>&nbsp;<span class="num" id="2975464">0</span><br>
<span class="lineno"></span><span class="op" id="2975466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2975469">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2975547">func</span>&nbsp;<span class="ident" id="2975552">ContainsAny</span><span class="op" id="2975563">(</span><span class="ident" id="2975564">s</span><span class="op" id="2975565">,</span>&nbsp;<span class="ident" id="2975567">chars</span>&nbsp;<span class="builtintype" id="2975573">string</span><span class="op" id="2975579">)</span>&nbsp;<span class="builtintype" id="2975581">bool</span>&nbsp;<span class="op" id="2975586">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975589">return</span>&nbsp;<span class="ident" id="2975596">IndexAny</span><span class="op" id="2975604">(</span><span class="ident" id="2975605">s</span><span class="op" id="2975606">,</span>&nbsp;<span class="ident" id="2975608">chars</span><span class="op" id="2975613">)</span>&nbsp;<span class="op" id="2975615">&gt;=</span>&nbsp;<span class="num" id="2975618">0</span><br>
<span class="lineno"></span><span class="op" id="2975620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2975623">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2975693">func</span>&nbsp;<span class="ident" id="2975698">ContainsRune</span><span class="op" id="2975710">(</span><span class="ident" id="2975711">s</span>&nbsp;<span class="builtintype" id="2975713">string</span><span class="op" id="2975719">,</span>&nbsp;<span class="ident" id="2975721">r</span>&nbsp;<span class="builtintype" id="2975723">rune</span><span class="op" id="2975727">)</span>&nbsp;<span class="builtintype" id="2975729">bool</span>&nbsp;<span class="op" id="2975734">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975737">return</span>&nbsp;<span class="ident" id="2975744">IndexRune</span><span class="op" id="2975753">(</span><span class="ident" id="2975754">s</span><span class="op" id="2975755">,</span>&nbsp;<span class="ident" id="2975757">r</span><span class="op" id="2975758">)</span>&nbsp;<span class="op" id="2975760">&gt;=</span>&nbsp;<span class="num" id="2975763">0</span><br>
<span class="lineno"></span><span class="op" id="2975765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2975768">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2975864">func</span>&nbsp;<span class="ident" id="2975869">Index</span><span class="op" id="2975874">(</span><span class="ident" id="2975875">s</span><span class="op" id="2975876">,</span>&nbsp;<span class="ident" id="2975878">sep</span>&nbsp;<span class="builtintype" id="2975882">string</span><span class="op" id="2975888">)</span>&nbsp;<span class="builtintype" id="2975890">int</span>&nbsp;<span class="op" id="2975894">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975897">n</span>&nbsp;<span class="op" id="2975899">:=</span>&nbsp;<span class="builtinfunc" id="2975902">len</span><span class="op" id="2975905">(</span><span class="ident" id="2975906">sep</span><span class="op" id="2975909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975912">switch</span>&nbsp;<span class="op" id="2975919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975922">case</span>&nbsp;<span class="ident" id="2975927">n</span>&nbsp;<span class="op" id="2975929">==</span>&nbsp;<span class="num" id="2975932">0</span><span class="op" id="2975933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975937">return</span>&nbsp;<span class="num" id="2975944">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975947">case</span>&nbsp;<span class="ident" id="2975952">n</span>&nbsp;<span class="op" id="2975954">==</span>&nbsp;<span class="num" id="2975957">1</span><span class="op" id="2975958">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975962">return</span>&nbsp;<span class="ident" id="2975969">IndexByte</span><span class="op" id="2975978">(</span><span class="ident" id="2975979">s</span><span class="op" id="2975980">,</span>&nbsp;<span class="ident" id="2975982">sep</span><span class="op" id="2975985">[</span><span class="num" id="2975986">0</span><span class="op" id="2975987">]</span><span class="op" id="2975988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975991">case</span>&nbsp;<span class="ident" id="2975996">n</span>&nbsp;<span class="op" id="2975998">==</span>&nbsp;<span class="builtinfunc" id="2976001">len</span><span class="op" id="2976004">(</span><span class="ident" id="2976005">s</span><span class="op" id="2976006">)</span><span class="op" id="2976007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976011">if</span>&nbsp;<span class="ident" id="2976014">sep</span>&nbsp;<span class="op" id="2976018">==</span>&nbsp;<span class="ident" id="2976021">s</span>&nbsp;<span class="op" id="2976023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976028">return</span>&nbsp;<span class="num" id="2976035">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976039">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976043">return</span>&nbsp;<span class="op" id="2976050">-</span><span class="num" id="2976051">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976054">case</span>&nbsp;<span class="ident" id="2976059">n</span>&nbsp;<span class="op" id="2976061">&gt;</span>&nbsp;<span class="builtinfunc" id="2976063">len</span><span class="op" id="2976066">(</span><span class="ident" id="2976067">s</span><span class="op" id="2976068">)</span><span class="op" id="2976069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976073">return</span>&nbsp;<span class="op" id="2976080">-</span><span class="num" id="2976081">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2976087">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976109">hashsep</span><span class="op" id="2976116">,</span>&nbsp;<span class="ident" id="2976118">pow</span>&nbsp;<span class="op" id="2976122">:=</span>&nbsp;<span class="ident" id="2976125">hashStr</span><span class="op" id="2976132">(</span><span class="ident" id="2976133">sep</span><span class="op" id="2976136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976139">var</span>&nbsp;<span class="ident" id="2976143">h</span>&nbsp;<span class="builtintype" id="2976145">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976153">for</span>&nbsp;<span class="ident" id="2976157">i</span>&nbsp;<span class="op" id="2976159">:=</span>&nbsp;<span class="num" id="2976162">0</span><span class="op" id="2976163">;</span>&nbsp;<span class="ident" id="2976165">i</span>&nbsp;<span class="op" id="2976167">&lt;</span>&nbsp;<span class="ident" id="2976169">n</span><span class="op" id="2976170">;</span>&nbsp;<span class="ident" id="2976172">i</span><span class="op" id="2976173">++</span>&nbsp;<span class="op" id="2976176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976180">h</span>&nbsp;<span class="op" id="2976182">=</span>&nbsp;<span class="ident" id="2976184">h</span><span class="op" id="2976185">*</span><span class="ident" id="2976186">primeRK</span>&nbsp;<span class="op" id="2976194">+</span>&nbsp;<span class="builtintype" id="2976196">uint32</span><span class="op" id="2976202">(</span><span class="ident" id="2976203">s</span><span class="op" id="2976204">[</span><span class="ident" id="2976205">i</span><span class="op" id="2976206">]</span><span class="op" id="2976207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976210">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976213">if</span>&nbsp;<span class="ident" id="2976216">h</span>&nbsp;<span class="op" id="2976218">==</span>&nbsp;<span class="ident" id="2976221">hashsep</span>&nbsp;<span class="op" id="2976229">&amp;&amp;</span>&nbsp;<span class="ident" id="2976232">s</span><span class="op" id="2976233">[</span><span class="op" id="2976234">:</span><span class="ident" id="2976235">n</span><span class="op" id="2976236">]</span>&nbsp;<span class="op" id="2976238">==</span>&nbsp;<span class="ident" id="2976241">sep</span>&nbsp;<span class="op" id="2976245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976249">return</span>&nbsp;<span class="num" id="2976256">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976262">for</span>&nbsp;<span class="ident" id="2976266">i</span>&nbsp;<span class="op" id="2976268">:=</span>&nbsp;<span class="ident" id="2976271">n</span><span class="op" id="2976272">;</span>&nbsp;<span class="ident" id="2976274">i</span>&nbsp;<span class="op" id="2976276">&lt;</span>&nbsp;<span class="builtinfunc" id="2976278">len</span><span class="op" id="2976281">(</span><span class="ident" id="2976282">s</span><span class="op" id="2976283">)</span><span class="op" id="2976284">;</span>&nbsp;<span class="op" id="2976286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976290">h</span>&nbsp;<span class="op" id="2976292">*=</span>&nbsp;<span class="ident" id="2976295">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976305">h</span>&nbsp;<span class="op" id="2976307">+=</span>&nbsp;<span class="builtintype" id="2976310">uint32</span><span class="op" id="2976316">(</span><span class="ident" id="2976317">s</span><span class="op" id="2976318">[</span><span class="ident" id="2976319">i</span><span class="op" id="2976320">]</span><span class="op" id="2976321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976325">h</span>&nbsp;<span class="op" id="2976327">-=</span>&nbsp;<span class="ident" id="2976330">pow</span>&nbsp;<span class="op" id="2976334">*</span>&nbsp;<span class="builtintype" id="2976336">uint32</span><span class="op" id="2976342">(</span><span class="ident" id="2976343">s</span><span class="op" id="2976344">[</span><span class="ident" id="2976345">i</span><span class="op" id="2976346">-</span><span class="ident" id="2976347">n</span><span class="op" id="2976348">]</span><span class="op" id="2976349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976353">i</span><span class="op" id="2976354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976359">if</span>&nbsp;<span class="ident" id="2976362">h</span>&nbsp;<span class="op" id="2976364">==</span>&nbsp;<span class="ident" id="2976367">hashsep</span>&nbsp;<span class="op" id="2976375">&amp;&amp;</span>&nbsp;<span class="ident" id="2976378">s</span><span class="op" id="2976379">[</span><span class="ident" id="2976380">i</span><span class="op" id="2976381">-</span><span class="ident" id="2976382">n</span><span class="op" id="2976383">:</span><span class="ident" id="2976384">i</span><span class="op" id="2976385">]</span>&nbsp;<span class="op" id="2976387">==</span>&nbsp;<span class="ident" id="2976390">sep</span>&nbsp;<span class="op" id="2976394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976399">return</span>&nbsp;<span class="ident" id="2976406">i</span>&nbsp;<span class="op" id="2976408">-</span>&nbsp;<span class="ident" id="2976410">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976420">return</span>&nbsp;<span class="op" id="2976427">-</span><span class="num" id="2976428">1</span><br>
<span class="lineno"></span><span class="op" id="2976430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2976433">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2976532">func</span>&nbsp;<span class="ident" id="2976537">LastIndex</span><span class="op" id="2976546">(</span><span class="ident" id="2976547">s</span><span class="op" id="2976548">,</span>&nbsp;<span class="ident" id="2976550">sep</span>&nbsp;<span class="builtintype" id="2976554">string</span><span class="op" id="2976560">)</span>&nbsp;<span class="builtintype" id="2976562">int</span>&nbsp;<span class="op" id="2976566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976569">n</span>&nbsp;<span class="op" id="2976571">:=</span>&nbsp;<span class="builtinfunc" id="2976574">len</span><span class="op" id="2976577">(</span><span class="ident" id="2976578">sep</span><span class="op" id="2976581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976584">switch</span>&nbsp;<span class="op" id="2976591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976594">case</span>&nbsp;<span class="ident" id="2976599">n</span>&nbsp;<span class="op" id="2976601">==</span>&nbsp;<span class="num" id="2976604">0</span><span class="op" id="2976605">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976609">return</span>&nbsp;<span class="builtinfunc" id="2976616">len</span><span class="op" id="2976619">(</span><span class="ident" id="2976620">s</span><span class="op" id="2976621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976624">case</span>&nbsp;<span class="ident" id="2976629">n</span>&nbsp;<span class="op" id="2976631">==</span>&nbsp;<span class="num" id="2976634">1</span><span class="op" id="2976635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2976639">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976675">c</span>&nbsp;<span class="op" id="2976677">:=</span>&nbsp;<span class="ident" id="2976680">sep</span><span class="op" id="2976683">[</span><span class="num" id="2976684">0</span><span class="op" id="2976685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976689">for</span>&nbsp;<span class="ident" id="2976693">i</span>&nbsp;<span class="op" id="2976695">:=</span>&nbsp;<span class="builtinfunc" id="2976698">len</span><span class="op" id="2976701">(</span><span class="ident" id="2976702">s</span><span class="op" id="2976703">)</span>&nbsp;<span class="op" id="2976705">-</span>&nbsp;<span class="num" id="2976707">1</span><span class="op" id="2976708">;</span>&nbsp;<span class="ident" id="2976710">i</span>&nbsp;<span class="op" id="2976712">&gt;=</span>&nbsp;<span class="num" id="2976715">0</span><span class="op" id="2976716">;</span>&nbsp;<span class="ident" id="2976718">i</span><span class="op" id="2976719">--</span>&nbsp;<span class="op" id="2976722">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976727">if</span>&nbsp;<span class="ident" id="2976730">s</span><span class="op" id="2976731">[</span><span class="ident" id="2976732">i</span><span class="op" id="2976733">]</span>&nbsp;<span class="op" id="2976735">==</span>&nbsp;<span class="ident" id="2976738">c</span>&nbsp;<span class="op" id="2976740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976746">return</span>&nbsp;<span class="ident" id="2976753">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976766">return</span>&nbsp;<span class="op" id="2976773">-</span><span class="num" id="2976774">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976777">case</span>&nbsp;<span class="ident" id="2976782">n</span>&nbsp;<span class="op" id="2976784">==</span>&nbsp;<span class="builtinfunc" id="2976787">len</span><span class="op" id="2976790">(</span><span class="ident" id="2976791">s</span><span class="op" id="2976792">)</span><span class="op" id="2976793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976797">if</span>&nbsp;<span class="ident" id="2976800">sep</span>&nbsp;<span class="op" id="2976804">==</span>&nbsp;<span class="ident" id="2976807">s</span>&nbsp;<span class="op" id="2976809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976814">return</span>&nbsp;<span class="num" id="2976821">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976829">return</span>&nbsp;<span class="op" id="2976836">-</span><span class="num" id="2976837">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976840">case</span>&nbsp;<span class="ident" id="2976845">n</span>&nbsp;<span class="op" id="2976847">&gt;</span>&nbsp;<span class="builtinfunc" id="2976849">len</span><span class="op" id="2976852">(</span><span class="ident" id="2976853">s</span><span class="op" id="2976854">)</span><span class="op" id="2976855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976859">return</span>&nbsp;<span class="op" id="2976866">-</span><span class="num" id="2976867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2976873">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976922">hashsep</span><span class="op" id="2976929">,</span>&nbsp;<span class="ident" id="2976931">pow</span>&nbsp;<span class="op" id="2976935">:=</span>&nbsp;<span class="ident" id="2976938">hashStrRev</span><span class="op" id="2976948">(</span><span class="ident" id="2976949">sep</span><span class="op" id="2976952">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976955">last</span>&nbsp;<span class="op" id="2976960">:=</span>&nbsp;<span class="builtinfunc" id="2976963">len</span><span class="op" id="2976966">(</span><span class="ident" id="2976967">s</span><span class="op" id="2976968">)</span>&nbsp;<span class="op" id="2976970">-</span>&nbsp;<span class="ident" id="2976972">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976975">var</span>&nbsp;<span class="ident" id="2976979">h</span>&nbsp;<span class="builtintype" id="2976981">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976989">for</span>&nbsp;<span class="ident" id="2976993">i</span>&nbsp;<span class="op" id="2976995">:=</span>&nbsp;<span class="builtinfunc" id="2976998">len</span><span class="op" id="2977001">(</span><span class="ident" id="2977002">s</span><span class="op" id="2977003">)</span>&nbsp;<span class="op" id="2977005">-</span>&nbsp;<span class="num" id="2977007">1</span><span class="op" id="2977008">;</span>&nbsp;<span class="ident" id="2977010">i</span>&nbsp;<span class="op" id="2977012">&gt;=</span>&nbsp;<span class="ident" id="2977015">last</span><span class="op" id="2977019">;</span>&nbsp;<span class="ident" id="2977021">i</span><span class="op" id="2977022">--</span>&nbsp;<span class="op" id="2977025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977029">h</span>&nbsp;<span class="op" id="2977031">=</span>&nbsp;<span class="ident" id="2977033">h</span><span class="op" id="2977034">*</span><span class="ident" id="2977035">primeRK</span>&nbsp;<span class="op" id="2977043">+</span>&nbsp;<span class="builtintype" id="2977045">uint32</span><span class="op" id="2977051">(</span><span class="ident" id="2977052">s</span><span class="op" id="2977053">[</span><span class="ident" id="2977054">i</span><span class="op" id="2977055">]</span><span class="op" id="2977056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977059">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977062">if</span>&nbsp;<span class="ident" id="2977065">h</span>&nbsp;<span class="op" id="2977067">==</span>&nbsp;<span class="ident" id="2977070">hashsep</span>&nbsp;<span class="op" id="2977078">&amp;&amp;</span>&nbsp;<span class="ident" id="2977081">s</span><span class="op" id="2977082">[</span><span class="ident" id="2977083">last</span><span class="op" id="2977087">:</span><span class="op" id="2977088">]</span>&nbsp;<span class="op" id="2977090">==</span>&nbsp;<span class="ident" id="2977093">sep</span>&nbsp;<span class="op" id="2977097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977101">return</span>&nbsp;<span class="ident" id="2977108">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977117">for</span>&nbsp;<span class="ident" id="2977121">i</span>&nbsp;<span class="op" id="2977123">:=</span>&nbsp;<span class="ident" id="2977126">last</span>&nbsp;<span class="op" id="2977131">-</span>&nbsp;<span class="num" id="2977133">1</span><span class="op" id="2977134">;</span>&nbsp;<span class="ident" id="2977136">i</span>&nbsp;<span class="op" id="2977138">&gt;=</span>&nbsp;<span class="num" id="2977141">0</span><span class="op" id="2977142">;</span>&nbsp;<span class="ident" id="2977144">i</span><span class="op" id="2977145">--</span>&nbsp;<span class="op" id="2977148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977152">h</span>&nbsp;<span class="op" id="2977154">*=</span>&nbsp;<span class="ident" id="2977157">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977167">h</span>&nbsp;<span class="op" id="2977169">+=</span>&nbsp;<span class="builtintype" id="2977172">uint32</span><span class="op" id="2977178">(</span><span class="ident" id="2977179">s</span><span class="op" id="2977180">[</span><span class="ident" id="2977181">i</span><span class="op" id="2977182">]</span><span class="op" id="2977183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977187">h</span>&nbsp;<span class="op" id="2977189">-=</span>&nbsp;<span class="ident" id="2977192">pow</span>&nbsp;<span class="op" id="2977196">*</span>&nbsp;<span class="builtintype" id="2977198">uint32</span><span class="op" id="2977204">(</span><span class="ident" id="2977205">s</span><span class="op" id="2977206">[</span><span class="ident" id="2977207">i</span><span class="op" id="2977208">+</span><span class="ident" id="2977209">n</span><span class="op" id="2977210">]</span><span class="op" id="2977211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977215">if</span>&nbsp;<span class="ident" id="2977218">h</span>&nbsp;<span class="op" id="2977220">==</span>&nbsp;<span class="ident" id="2977223">hashsep</span>&nbsp;<span class="op" id="2977231">&amp;&amp;</span>&nbsp;<span class="ident" id="2977234">s</span><span class="op" id="2977235">[</span><span class="ident" id="2977236">i</span><span class="op" id="2977237">:</span><span class="ident" id="2977238">i</span><span class="op" id="2977239">+</span><span class="ident" id="2977240">n</span><span class="op" id="2977241">]</span>&nbsp;<span class="op" id="2977243">==</span>&nbsp;<span class="ident" id="2977246">sep</span>&nbsp;<span class="op" id="2977250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977255">return</span>&nbsp;<span class="ident" id="2977262">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977266">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977272">return</span>&nbsp;<span class="op" id="2977279">-</span><span class="num" id="2977280">1</span><br>
<span class="lineno"></span><span class="op" id="2977282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2977285">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2977364">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2977405">func</span>&nbsp;<span class="ident" id="2977410">IndexRune</span><span class="op" id="2977419">(</span><span class="ident" id="2977420">s</span>&nbsp;<span class="builtintype" id="2977422">string</span><span class="op" id="2977428">,</span>&nbsp;<span class="ident" id="2977430">r</span>&nbsp;<span class="builtintype" id="2977432">rune</span><span class="op" id="2977436">)</span>&nbsp;<span class="builtintype" id="2977438">int</span>&nbsp;<span class="op" id="2977442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977445">switch</span>&nbsp;<span class="op" id="2977452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977455">case</span>&nbsp;<span class="ident" id="2977460">r</span>&nbsp;<span class="op" id="2977462">&lt;</span>&nbsp;<span class="ident" id="2977464">utf8</span><span class="op" id="2977468">.</span><span class="ident" id="2977469">RuneSelf</span><span class="op" id="2977477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977481">return</span>&nbsp;<span class="ident" id="2977488">IndexByte</span><span class="op" id="2977497">(</span><span class="ident" id="2977498">s</span><span class="op" id="2977499">,</span>&nbsp;<span class="builtintype" id="2977501">byte</span><span class="op" id="2977505">(</span><span class="ident" id="2977506">r</span><span class="op" id="2977507">)</span><span class="op" id="2977508">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977511">default</span><span class="op" id="2977518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977522">for</span>&nbsp;<span class="ident" id="2977526">i</span><span class="op" id="2977527">,</span>&nbsp;<span class="ident" id="2977529">c</span>&nbsp;<span class="op" id="2977531">:=</span>&nbsp;<span class="keyword" id="2977534">range</span>&nbsp;<span class="ident" id="2977540">s</span>&nbsp;<span class="op" id="2977542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977547">if</span>&nbsp;<span class="ident" id="2977550">c</span>&nbsp;<span class="op" id="2977552">==</span>&nbsp;<span class="ident" id="2977555">r</span>&nbsp;<span class="op" id="2977557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977563">return</span>&nbsp;<span class="ident" id="2977570">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977575">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977585">return</span>&nbsp;<span class="op" id="2977592">-</span><span class="num" id="2977593">1</span><br>
<span class="lineno"></span><span class="op" id="2977595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2977598">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2977676">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2977755">func</span>&nbsp;<span class="ident" id="2977760">IndexAny</span><span class="op" id="2977768">(</span><span class="ident" id="2977769">s</span><span class="op" id="2977770">,</span>&nbsp;<span class="ident" id="2977772">chars</span>&nbsp;<span class="builtintype" id="2977778">string</span><span class="op" id="2977784">)</span>&nbsp;<span class="builtintype" id="2977786">int</span>&nbsp;<span class="op" id="2977790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977793">if</span>&nbsp;<span class="builtinfunc" id="2977796">len</span><span class="op" id="2977799">(</span><span class="ident" id="2977800">chars</span><span class="op" id="2977805">)</span>&nbsp;<span class="op" id="2977807">&gt;</span>&nbsp;<span class="num" id="2977809">0</span>&nbsp;<span class="op" id="2977811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977815">for</span>&nbsp;<span class="ident" id="2977819">i</span><span class="op" id="2977820">,</span>&nbsp;<span class="ident" id="2977822">c</span>&nbsp;<span class="op" id="2977824">:=</span>&nbsp;<span class="keyword" id="2977827">range</span>&nbsp;<span class="ident" id="2977833">s</span>&nbsp;<span class="op" id="2977835">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977840">for</span>&nbsp;<span class="ident" id="2977844">_</span><span class="op" id="2977845">,</span>&nbsp;<span class="ident" id="2977847">m</span>&nbsp;<span class="op" id="2977849">:=</span>&nbsp;<span class="keyword" id="2977852">range</span>&nbsp;<span class="ident" id="2977858">chars</span>&nbsp;<span class="op" id="2977864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977870">if</span>&nbsp;<span class="ident" id="2977873">c</span>&nbsp;<span class="op" id="2977875">==</span>&nbsp;<span class="ident" id="2977878">m</span>&nbsp;<span class="op" id="2977880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977887">return</span>&nbsp;<span class="ident" id="2977894">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977905">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977915">return</span>&nbsp;<span class="op" id="2977922">-</span><span class="num" id="2977923">1</span><br>
<span class="lineno"></span><span class="op" id="2977925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2977928">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2978003">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2978074">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2978091">func</span>&nbsp;<span class="ident" id="2978096">LastIndexAny</span><span class="op" id="2978108">(</span><span class="ident" id="2978109">s</span><span class="op" id="2978110">,</span>&nbsp;<span class="ident" id="2978112">chars</span>&nbsp;<span class="builtintype" id="2978118">string</span><span class="op" id="2978124">)</span>&nbsp;<span class="builtintype" id="2978126">int</span>&nbsp;<span class="op" id="2978130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978133">if</span>&nbsp;<span class="builtinfunc" id="2978136">len</span><span class="op" id="2978139">(</span><span class="ident" id="2978140">chars</span><span class="op" id="2978145">)</span>&nbsp;<span class="op" id="2978147">&gt;</span>&nbsp;<span class="num" id="2978149">0</span>&nbsp;<span class="op" id="2978151">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978155">for</span>&nbsp;<span class="ident" id="2978159">i</span>&nbsp;<span class="op" id="2978161">:=</span>&nbsp;<span class="builtinfunc" id="2978164">len</span><span class="op" id="2978167">(</span><span class="ident" id="2978168">s</span><span class="op" id="2978169">)</span><span class="op" id="2978170">;</span>&nbsp;<span class="ident" id="2978172">i</span>&nbsp;<span class="op" id="2978174">&gt;</span>&nbsp;<span class="num" id="2978176">0</span><span class="op" id="2978177">;</span>&nbsp;<span class="op" id="2978179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2978184">rune</span><span class="op" id="2978188">,</span>&nbsp;<span class="ident" id="2978190">size</span>&nbsp;<span class="op" id="2978195">:=</span>&nbsp;<span class="ident" id="2978198">utf8</span><span class="op" id="2978202">.</span><span class="ident" id="2978203">DecodeLastRuneInString</span><span class="op" id="2978225">(</span><span class="ident" id="2978226">s</span><span class="op" id="2978227">[</span><span class="num" id="2978228">0</span><span class="op" id="2978229">:</span><span class="ident" id="2978230">i</span><span class="op" id="2978231">]</span><span class="op" id="2978232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978237">i</span>&nbsp;<span class="op" id="2978239">-=</span>&nbsp;<span class="ident" id="2978242">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978250">for</span>&nbsp;<span class="ident" id="2978254">_</span><span class="op" id="2978255">,</span>&nbsp;<span class="ident" id="2978257">m</span>&nbsp;<span class="op" id="2978259">:=</span>&nbsp;<span class="keyword" id="2978262">range</span>&nbsp;<span class="ident" id="2978268">chars</span>&nbsp;<span class="op" id="2978274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978280">if</span>&nbsp;<span class="builtintype" id="2978283">rune</span>&nbsp;<span class="op" id="2978288">==</span>&nbsp;<span class="ident" id="2978291">m</span>&nbsp;<span class="op" id="2978293">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978300">return</span>&nbsp;<span class="ident" id="2978307">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978325">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978328">return</span>&nbsp;<span class="op" id="2978335">-</span><span class="num" id="2978336">1</span><br>
<span class="lineno"></span><span class="op" id="2978338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2978341">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2978394">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2978446">func</span>&nbsp;<span class="ident" id="2978451">genSplit</span><span class="op" id="2978459">(</span><span class="ident" id="2978460">s</span><span class="op" id="2978461">,</span>&nbsp;<span class="ident" id="2978463">sep</span>&nbsp;<span class="builtintype" id="2978467">string</span><span class="op" id="2978473">,</span>&nbsp;<span class="ident" id="2978475">sepSave</span><span class="op" id="2978482">,</span>&nbsp;<span class="ident" id="2978484">n</span>&nbsp;<span class="builtintype" id="2978486">int</span><span class="op" id="2978489">)</span>&nbsp;<span class="op" id="2978491">[</span><span class="op" id="2978492">]</span><span class="builtintype" id="2978493">string</span>&nbsp;<span class="op" id="2978500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978503">if</span>&nbsp;<span class="ident" id="2978506">n</span>&nbsp;<span class="op" id="2978508">==</span>&nbsp;<span class="num" id="2978511">0</span>&nbsp;<span class="op" id="2978513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978517">return</span>&nbsp;<span class="ident" id="2978524">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978532">if</span>&nbsp;<span class="ident" id="2978535">sep</span>&nbsp;<span class="op" id="2978539">==</span>&nbsp;<span class="string" id="2978542">&#34;&#34;</span>&nbsp;<span class="op" id="2978545">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978549">return</span>&nbsp;<span class="ident" id="2978556">explode</span><span class="op" id="2978563">(</span><span class="ident" id="2978564">s</span><span class="op" id="2978565">,</span>&nbsp;<span class="ident" id="2978567">n</span><span class="op" id="2978568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978574">if</span>&nbsp;<span class="ident" id="2978577">n</span>&nbsp;<span class="op" id="2978579">&lt;</span>&nbsp;<span class="num" id="2978581">0</span>&nbsp;<span class="op" id="2978583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978587">n</span>&nbsp;<span class="op" id="2978589">=</span>&nbsp;<span class="ident" id="2978591">Count</span><span class="op" id="2978596">(</span><span class="ident" id="2978597">s</span><span class="op" id="2978598">,</span>&nbsp;<span class="ident" id="2978600">sep</span><span class="op" id="2978603">)</span>&nbsp;<span class="op" id="2978605">+</span>&nbsp;<span class="num" id="2978607">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978610">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978613">c</span>&nbsp;<span class="op" id="2978615">:=</span>&nbsp;<span class="ident" id="2978618">sep</span><span class="op" id="2978621">[</span><span class="num" id="2978622">0</span><span class="op" id="2978623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978626">start</span>&nbsp;<span class="op" id="2978632">:=</span>&nbsp;<span class="num" id="2978635">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978638">a</span>&nbsp;<span class="op" id="2978640">:=</span>&nbsp;<span class="builtinfunc" id="2978643">make</span><span class="op" id="2978647">(</span><span class="op" id="2978648">[</span><span class="op" id="2978649">]</span><span class="builtintype" id="2978650">string</span><span class="op" id="2978656">,</span>&nbsp;<span class="ident" id="2978658">n</span><span class="op" id="2978659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978662">na</span>&nbsp;<span class="op" id="2978665">:=</span>&nbsp;<span class="num" id="2978668">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978671">for</span>&nbsp;<span class="ident" id="2978675">i</span>&nbsp;<span class="op" id="2978677">:=</span>&nbsp;<span class="num" id="2978680">0</span><span class="op" id="2978681">;</span>&nbsp;<span class="ident" id="2978683">i</span><span class="op" id="2978684">+</span><span class="builtinfunc" id="2978685">len</span><span class="op" id="2978688">(</span><span class="ident" id="2978689">sep</span><span class="op" id="2978692">)</span>&nbsp;<span class="op" id="2978694">&lt;=</span>&nbsp;<span class="builtinfunc" id="2978697">len</span><span class="op" id="2978700">(</span><span class="ident" id="2978701">s</span><span class="op" id="2978702">)</span>&nbsp;<span class="op" id="2978704">&amp;&amp;</span>&nbsp;<span class="ident" id="2978707">na</span><span class="op" id="2978709">+</span><span class="num" id="2978710">1</span>&nbsp;<span class="op" id="2978712">&lt;</span>&nbsp;<span class="ident" id="2978714">n</span><span class="op" id="2978715">;</span>&nbsp;<span class="ident" id="2978717">i</span><span class="op" id="2978718">++</span>&nbsp;<span class="op" id="2978721">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978725">if</span>&nbsp;<span class="ident" id="2978728">s</span><span class="op" id="2978729">[</span><span class="ident" id="2978730">i</span><span class="op" id="2978731">]</span>&nbsp;<span class="op" id="2978733">==</span>&nbsp;<span class="ident" id="2978736">c</span>&nbsp;<span class="op" id="2978738">&amp;&amp;</span>&nbsp;<span class="op" id="2978741">(</span><span class="builtinfunc" id="2978742">len</span><span class="op" id="2978745">(</span><span class="ident" id="2978746">sep</span><span class="op" id="2978749">)</span>&nbsp;<span class="op" id="2978751">==</span>&nbsp;<span class="num" id="2978754">1</span>&nbsp;<span class="op" id="2978756">||</span>&nbsp;<span class="ident" id="2978759">s</span><span class="op" id="2978760">[</span><span class="ident" id="2978761">i</span><span class="op" id="2978762">:</span><span class="ident" id="2978763">i</span><span class="op" id="2978764">+</span><span class="builtinfunc" id="2978765">len</span><span class="op" id="2978768">(</span><span class="ident" id="2978769">sep</span><span class="op" id="2978772">)</span><span class="op" id="2978773">]</span>&nbsp;<span class="op" id="2978775">==</span>&nbsp;<span class="ident" id="2978778">sep</span><span class="op" id="2978781">)</span>&nbsp;<span class="op" id="2978783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978788">a</span><span class="op" id="2978789">[</span><span class="ident" id="2978790">na</span><span class="op" id="2978792">]</span>&nbsp;<span class="op" id="2978794">=</span>&nbsp;<span class="ident" id="2978796">s</span><span class="op" id="2978797">[</span><span class="ident" id="2978798">start</span>&nbsp;<span class="op" id="2978804">:</span>&nbsp;<span class="ident" id="2978806">i</span><span class="op" id="2978807">+</span><span class="ident" id="2978808">sepSave</span><span class="op" id="2978815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978820">na</span><span class="op" id="2978822">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978828">start</span>&nbsp;<span class="op" id="2978834">=</span>&nbsp;<span class="ident" id="2978836">i</span>&nbsp;<span class="op" id="2978838">+</span>&nbsp;<span class="builtinfunc" id="2978840">len</span><span class="op" id="2978843">(</span><span class="ident" id="2978844">sep</span><span class="op" id="2978847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978852">i</span>&nbsp;<span class="op" id="2978854">+=</span>&nbsp;<span class="builtinfunc" id="2978857">len</span><span class="op" id="2978860">(</span><span class="ident" id="2978861">sep</span><span class="op" id="2978864">)</span>&nbsp;<span class="op" id="2978866">-</span>&nbsp;<span class="num" id="2978868">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978878">a</span><span class="op" id="2978879">[</span><span class="ident" id="2978880">na</span><span class="op" id="2978882">]</span>&nbsp;<span class="op" id="2978884">=</span>&nbsp;<span class="ident" id="2978886">s</span><span class="op" id="2978887">[</span><span class="ident" id="2978888">start</span><span class="op" id="2978893">:</span><span class="op" id="2978894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978897">return</span>&nbsp;<span class="ident" id="2978904">a</span><span class="op" id="2978905">[</span><span class="num" id="2978906">0</span>&nbsp;<span class="op" id="2978908">:</span>&nbsp;<span class="ident" id="2978910">na</span><span class="op" id="2978912">+</span><span class="num" id="2978913">1</span><span class="op" id="2978914">]</span><br>
<span class="lineno"></span><span class="op" id="2978916">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2978919">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2978994">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2979038">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2979099">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2979159">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2979243">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2979292">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2979319">func</span>&nbsp;<span class="ident" id="2979324">SplitN</span><span class="op" id="2979330">(</span><span class="ident" id="2979331">s</span><span class="op" id="2979332">,</span>&nbsp;<span class="ident" id="2979334">sep</span>&nbsp;<span class="builtintype" id="2979338">string</span><span class="op" id="2979344">,</span>&nbsp;<span class="ident" id="2979346">n</span>&nbsp;<span class="builtintype" id="2979348">int</span><span class="op" id="2979351">)</span>&nbsp;<span class="op" id="2979353">[</span><span class="op" id="2979354">]</span><span class="builtintype" id="2979355">string</span>&nbsp;<span class="op" id="2979362">{</span>&nbsp;<span class="keyword" id="2979364">return</span>&nbsp;<span class="ident" id="2979371">genSplit</span><span class="op" id="2979379">(</span><span class="ident" id="2979380">s</span><span class="op" id="2979381">,</span>&nbsp;<span class="ident" id="2979383">sep</span><span class="op" id="2979386">,</span>&nbsp;<span class="num" id="2979388">0</span><span class="op" id="2979389">,</span>&nbsp;<span class="ident" id="2979391">n</span><span class="op" id="2979392">)</span>&nbsp;<span class="op" id="2979394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2979397">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2979468">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2979508">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2979574">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2979634">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2979718">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2979767">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2979794">func</span>&nbsp;<span class="ident" id="2979799">SplitAfterN</span><span class="op" id="2979810">(</span><span class="ident" id="2979811">s</span><span class="op" id="2979812">,</span>&nbsp;<span class="ident" id="2979814">sep</span>&nbsp;<span class="builtintype" id="2979818">string</span><span class="op" id="2979824">,</span>&nbsp;<span class="ident" id="2979826">n</span>&nbsp;<span class="builtintype" id="2979828">int</span><span class="op" id="2979831">)</span>&nbsp;<span class="op" id="2979833">[</span><span class="op" id="2979834">]</span><span class="builtintype" id="2979835">string</span>&nbsp;<span class="op" id="2979842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2979845">return</span>&nbsp;<span class="ident" id="2979852">genSplit</span><span class="op" id="2979860">(</span><span class="ident" id="2979861">s</span><span class="op" id="2979862">,</span>&nbsp;<span class="ident" id="2979864">sep</span><span class="op" id="2979867">,</span>&nbsp;<span class="builtinfunc" id="2979869">len</span><span class="op" id="2979872">(</span><span class="ident" id="2979873">sep</span><span class="op" id="2979876">)</span><span class="op" id="2979877">,</span>&nbsp;<span class="ident" id="2979879">n</span><span class="op" id="2979880">)</span><br>
<span class="lineno"></span><span class="op" id="2979882">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2979885">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2979963">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2980007">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2980067">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2980117">func</span>&nbsp;<span class="ident" id="2980122">Split</span><span class="op" id="2980127">(</span><span class="ident" id="2980128">s</span><span class="op" id="2980129">,</span>&nbsp;<span class="ident" id="2980131">sep</span>&nbsp;<span class="builtintype" id="2980135">string</span><span class="op" id="2980141">)</span>&nbsp;<span class="op" id="2980143">[</span><span class="op" id="2980144">]</span><span class="builtintype" id="2980145">string</span>&nbsp;<span class="op" id="2980152">{</span>&nbsp;<span class="keyword" id="2980154">return</span>&nbsp;<span class="ident" id="2980161">genSplit</span><span class="op" id="2980169">(</span><span class="ident" id="2980170">s</span><span class="op" id="2980171">,</span>&nbsp;<span class="ident" id="2980173">sep</span><span class="op" id="2980176">,</span>&nbsp;<span class="num" id="2980178">0</span><span class="op" id="2980179">,</span>&nbsp;<span class="op" id="2980181">-</span><span class="num" id="2980182">1</span><span class="op" id="2980183">)</span>&nbsp;<span class="op" id="2980185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2980188">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2980262">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2980302">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2980367">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2980422">func</span>&nbsp;<span class="ident" id="2980427">SplitAfter</span><span class="op" id="2980437">(</span><span class="ident" id="2980438">s</span><span class="op" id="2980439">,</span>&nbsp;<span class="ident" id="2980441">sep</span>&nbsp;<span class="builtintype" id="2980445">string</span><span class="op" id="2980451">)</span>&nbsp;<span class="op" id="2980453">[</span><span class="op" id="2980454">]</span><span class="builtintype" id="2980455">string</span>&nbsp;<span class="op" id="2980462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980465">return</span>&nbsp;<span class="ident" id="2980472">genSplit</span><span class="op" id="2980480">(</span><span class="ident" id="2980481">s</span><span class="op" id="2980482">,</span>&nbsp;<span class="ident" id="2980484">sep</span><span class="op" id="2980487">,</span>&nbsp;<span class="builtinfunc" id="2980489">len</span><span class="op" id="2980492">(</span><span class="ident" id="2980493">sep</span><span class="op" id="2980496">)</span><span class="op" id="2980497">,</span>&nbsp;<span class="op" id="2980499">-</span><span class="num" id="2980500">1</span><span class="op" id="2980501">)</span><br>
<span class="lineno"></span><span class="op" id="2980503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2980506">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2980596">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2980686">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2980732">func</span>&nbsp;<span class="ident" id="2980737">Fields</span><span class="op" id="2980743">(</span><span class="ident" id="2980744">s</span>&nbsp;<span class="builtintype" id="2980746">string</span><span class="op" id="2980752">)</span>&nbsp;<span class="op" id="2980754">[</span><span class="op" id="2980755">]</span><span class="builtintype" id="2980756">string</span>&nbsp;<span class="op" id="2980763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980766">return</span>&nbsp;<span class="ident" id="2980773">FieldsFunc</span><span class="op" id="2980783">(</span><span class="ident" id="2980784">s</span><span class="op" id="2980785">,</span>&nbsp;<span class="ident" id="2980787">unicode</span><span class="op" id="2980794">.</span><span class="ident" id="2980795">IsSpace</span><span class="op" id="2980802">)</span><br>
<span class="lineno">340</span><span class="op" id="2980804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2980807">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2980894">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2980978">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2981026">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2981100">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2981180">func</span>&nbsp;<span class="ident" id="2981185">FieldsFunc</span><span class="op" id="2981195">(</span><span class="ident" id="2981196">s</span>&nbsp;<span class="builtintype" id="2981198">string</span><span class="op" id="2981204">,</span>&nbsp;<span class="ident" id="2981206">f</span>&nbsp;<span class="keyword" id="2981208">func</span><span class="op" id="2981212">(</span><span class="builtintype" id="2981213">rune</span><span class="op" id="2981217">)</span>&nbsp;<span class="builtintype" id="2981219">bool</span><span class="op" id="2981223">)</span>&nbsp;<span class="op" id="2981225">[</span><span class="op" id="2981226">]</span><span class="builtintype" id="2981227">string</span>&nbsp;<span class="op" id="2981234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2981237">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981265">n</span>&nbsp;<span class="op" id="2981267">:=</span>&nbsp;<span class="num" id="2981270">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981273">inField</span>&nbsp;<span class="op" id="2981281">:=</span>&nbsp;<span class="builtintype" id="2981284">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981291">for</span>&nbsp;<span class="ident" id="2981295">_</span><span class="op" id="2981296">,</span>&nbsp;<span class="builtintype" id="2981298">rune</span>&nbsp;<span class="op" id="2981303">:=</span>&nbsp;<span class="keyword" id="2981306">range</span>&nbsp;<span class="ident" id="2981312">s</span>&nbsp;<span class="op" id="2981314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981318">wasInField</span>&nbsp;<span class="op" id="2981329">:=</span>&nbsp;<span class="ident" id="2981332">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981342">inField</span>&nbsp;<span class="op" id="2981350">=</span>&nbsp;<span class="op" id="2981352">!</span><span class="ident" id="2981353">f</span><span class="op" id="2981354">(</span><span class="builtintype" id="2981355">rune</span><span class="op" id="2981359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981363">if</span>&nbsp;<span class="ident" id="2981366">inField</span>&nbsp;<span class="op" id="2981374">&amp;&amp;</span>&nbsp;<span class="op" id="2981377">!</span><span class="ident" id="2981378">wasInField</span>&nbsp;<span class="op" id="2981389">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981394">n</span><span class="op" id="2981395">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2981407">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981428">a</span>&nbsp;<span class="op" id="2981430">:=</span>&nbsp;<span class="builtinfunc" id="2981433">make</span><span class="op" id="2981437">(</span><span class="op" id="2981438">[</span><span class="op" id="2981439">]</span><span class="builtintype" id="2981440">string</span><span class="op" id="2981446">,</span>&nbsp;<span class="ident" id="2981448">n</span><span class="op" id="2981449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981452">na</span>&nbsp;<span class="op" id="2981455">:=</span>&nbsp;<span class="num" id="2981458">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981461">fieldStart</span>&nbsp;<span class="op" id="2981472">:=</span>&nbsp;<span class="op" id="2981475">-</span><span class="num" id="2981476">1</span>&nbsp;<span class="comment" id="2981478">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981525">for</span>&nbsp;<span class="ident" id="2981529">i</span><span class="op" id="2981530">,</span>&nbsp;<span class="builtintype" id="2981532">rune</span>&nbsp;<span class="op" id="2981537">:=</span>&nbsp;<span class="keyword" id="2981540">range</span>&nbsp;<span class="ident" id="2981546">s</span>&nbsp;<span class="op" id="2981548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981552">if</span>&nbsp;<span class="ident" id="2981555">f</span><span class="op" id="2981556">(</span><span class="builtintype" id="2981557">rune</span><span class="op" id="2981561">)</span>&nbsp;<span class="op" id="2981563">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981568">if</span>&nbsp;<span class="ident" id="2981571">fieldStart</span>&nbsp;<span class="op" id="2981582">&gt;=</span>&nbsp;<span class="num" id="2981585">0</span>&nbsp;<span class="op" id="2981587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981593">a</span><span class="op" id="2981594">[</span><span class="ident" id="2981595">na</span><span class="op" id="2981597">]</span>&nbsp;<span class="op" id="2981599">=</span>&nbsp;<span class="ident" id="2981601">s</span><span class="op" id="2981602">[</span><span class="ident" id="2981603">fieldStart</span><span class="op" id="2981613">:</span><span class="ident" id="2981614">i</span><span class="op" id="2981615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981621">na</span><span class="op" id="2981623">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981630">fieldStart</span>&nbsp;<span class="op" id="2981641">=</span>&nbsp;<span class="op" id="2981643">-</span><span class="num" id="2981644">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981649">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981653">}</span>&nbsp;<span class="keyword" id="2981655">else</span>&nbsp;<span class="keyword" id="2981660">if</span>&nbsp;<span class="ident" id="2981663">fieldStart</span>&nbsp;<span class="op" id="2981674">==</span>&nbsp;<span class="op" id="2981677">-</span><span class="num" id="2981678">1</span>&nbsp;<span class="op" id="2981680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981685">fieldStart</span>&nbsp;<span class="op" id="2981696">=</span>&nbsp;<span class="ident" id="2981698">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981708">if</span>&nbsp;<span class="ident" id="2981711">fieldStart</span>&nbsp;<span class="op" id="2981722">&gt;=</span>&nbsp;<span class="num" id="2981725">0</span>&nbsp;<span class="op" id="2981727">{</span>&nbsp;<span class="comment" id="2981729">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981763">a</span><span class="op" id="2981764">[</span><span class="ident" id="2981765">na</span><span class="op" id="2981767">]</span>&nbsp;<span class="op" id="2981769">=</span>&nbsp;<span class="ident" id="2981771">s</span><span class="op" id="2981772">[</span><span class="ident" id="2981773">fieldStart</span><span class="op" id="2981783">:</span><span class="op" id="2981784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981790">return</span>&nbsp;<span class="ident" id="2981797">a</span><br>
<span class="lineno"></span><span class="op" id="2981799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2981802">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2981891">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2981950">func</span>&nbsp;<span class="ident" id="2981955">Join</span><span class="op" id="2981959">(</span><span class="ident" id="2981960">a</span>&nbsp;<span class="op" id="2981962">[</span><span class="op" id="2981963">]</span><span class="builtintype" id="2981964">string</span><span class="op" id="2981970">,</span>&nbsp;<span class="ident" id="2981972">sep</span>&nbsp;<span class="builtintype" id="2981976">string</span><span class="op" id="2981982">)</span>&nbsp;<span class="builtintype" id="2981984">string</span>&nbsp;<span class="op" id="2981991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981994">if</span>&nbsp;<span class="builtinfunc" id="2981997">len</span><span class="op" id="2982000">(</span><span class="ident" id="2982001">a</span><span class="op" id="2982002">)</span>&nbsp;<span class="op" id="2982004">==</span>&nbsp;<span class="num" id="2982007">0</span>&nbsp;<span class="op" id="2982009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982013">return</span>&nbsp;<span class="string" id="2982020">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982027">if</span>&nbsp;<span class="builtinfunc" id="2982030">len</span><span class="op" id="2982033">(</span><span class="ident" id="2982034">a</span><span class="op" id="2982035">)</span>&nbsp;<span class="op" id="2982037">==</span>&nbsp;<span class="num" id="2982040">1</span>&nbsp;<span class="op" id="2982042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982046">return</span>&nbsp;<span class="ident" id="2982053">a</span><span class="op" id="2982054">[</span><span class="num" id="2982055">0</span><span class="op" id="2982056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982062">n</span>&nbsp;<span class="op" id="2982064">:=</span>&nbsp;<span class="builtinfunc" id="2982067">len</span><span class="op" id="2982070">(</span><span class="ident" id="2982071">sep</span><span class="op" id="2982074">)</span>&nbsp;<span class="op" id="2982076">*</span>&nbsp;<span class="op" id="2982078">(</span><span class="builtinfunc" id="2982079">len</span><span class="op" id="2982082">(</span><span class="ident" id="2982083">a</span><span class="op" id="2982084">)</span>&nbsp;<span class="op" id="2982086">-</span>&nbsp;<span class="num" id="2982088">1</span><span class="op" id="2982089">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982092">for</span>&nbsp;<span class="ident" id="2982096">i</span>&nbsp;<span class="op" id="2982098">:=</span>&nbsp;<span class="num" id="2982101">0</span><span class="op" id="2982102">;</span>&nbsp;<span class="ident" id="2982104">i</span>&nbsp;<span class="op" id="2982106">&lt;</span>&nbsp;<span class="builtinfunc" id="2982108">len</span><span class="op" id="2982111">(</span><span class="ident" id="2982112">a</span><span class="op" id="2982113">)</span><span class="op" id="2982114">;</span>&nbsp;<span class="ident" id="2982116">i</span><span class="op" id="2982117">++</span>&nbsp;<span class="op" id="2982120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982124">n</span>&nbsp;<span class="op" id="2982126">+=</span>&nbsp;<span class="builtinfunc" id="2982129">len</span><span class="op" id="2982132">(</span><span class="ident" id="2982133">a</span><span class="op" id="2982134">[</span><span class="ident" id="2982135">i</span><span class="op" id="2982136">]</span><span class="op" id="2982137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982144">b</span>&nbsp;<span class="op" id="2982146">:=</span>&nbsp;<span class="builtinfunc" id="2982149">make</span><span class="op" id="2982153">(</span><span class="op" id="2982154">[</span><span class="op" id="2982155">]</span><span class="builtintype" id="2982156">byte</span><span class="op" id="2982160">,</span>&nbsp;<span class="ident" id="2982162">n</span><span class="op" id="2982163">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982166">bp</span>&nbsp;<span class="op" id="2982169">:=</span>&nbsp;<span class="builtinfunc" id="2982172">copy</span><span class="op" id="2982176">(</span><span class="ident" id="2982177">b</span><span class="op" id="2982178">,</span>&nbsp;<span class="ident" id="2982180">a</span><span class="op" id="2982181">[</span><span class="num" id="2982182">0</span><span class="op" id="2982183">]</span><span class="op" id="2982184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982187">for</span>&nbsp;<span class="ident" id="2982191">_</span><span class="op" id="2982192">,</span>&nbsp;<span class="ident" id="2982194">s</span>&nbsp;<span class="op" id="2982196">:=</span>&nbsp;<span class="keyword" id="2982199">range</span>&nbsp;<span class="ident" id="2982205">a</span><span class="op" id="2982206">[</span><span class="num" id="2982207">1</span><span class="op" id="2982208">:</span><span class="op" id="2982209">]</span>&nbsp;<span class="op" id="2982211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982215">bp</span>&nbsp;<span class="op" id="2982218">+=</span>&nbsp;<span class="builtinfunc" id="2982221">copy</span><span class="op" id="2982225">(</span><span class="ident" id="2982226">b</span><span class="op" id="2982227">[</span><span class="ident" id="2982228">bp</span><span class="op" id="2982230">:</span><span class="op" id="2982231">]</span><span class="op" id="2982232">,</span>&nbsp;<span class="ident" id="2982234">sep</span><span class="op" id="2982237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982241">bp</span>&nbsp;<span class="op" id="2982244">+=</span>&nbsp;<span class="builtinfunc" id="2982247">copy</span><span class="op" id="2982251">(</span><span class="ident" id="2982252">b</span><span class="op" id="2982253">[</span><span class="ident" id="2982254">bp</span><span class="op" id="2982256">:</span><span class="op" id="2982257">]</span><span class="op" id="2982258">,</span>&nbsp;<span class="ident" id="2982260">s</span><span class="op" id="2982261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982264">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982267">return</span>&nbsp;<span class="builtintype" id="2982274">string</span><span class="op" id="2982280">(</span><span class="ident" id="2982281">b</span><span class="op" id="2982282">)</span><br>
<span class="lineno"></span><span class="op" id="2982284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2982287">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2982347">func</span>&nbsp;<span class="ident" id="2982352">HasPrefix</span><span class="op" id="2982361">(</span><span class="ident" id="2982362">s</span><span class="op" id="2982363">,</span>&nbsp;<span class="ident" id="2982365">prefix</span>&nbsp;<span class="builtintype" id="2982372">string</span><span class="op" id="2982378">)</span>&nbsp;<span class="builtintype" id="2982380">bool</span>&nbsp;<span class="op" id="2982385">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982388">return</span>&nbsp;<span class="builtinfunc" id="2982395">len</span><span class="op" id="2982398">(</span><span class="ident" id="2982399">s</span><span class="op" id="2982400">)</span>&nbsp;<span class="op" id="2982402">&gt;=</span>&nbsp;<span class="builtinfunc" id="2982405">len</span><span class="op" id="2982408">(</span><span class="ident" id="2982409">prefix</span><span class="op" id="2982415">)</span>&nbsp;<span class="op" id="2982417">&amp;&amp;</span>&nbsp;<span class="ident" id="2982420">s</span><span class="op" id="2982421">[</span><span class="num" id="2982422">0</span><span class="op" id="2982423">:</span><span class="builtinfunc" id="2982424">len</span><span class="op" id="2982427">(</span><span class="ident" id="2982428">prefix</span><span class="op" id="2982434">)</span><span class="op" id="2982435">]</span>&nbsp;<span class="op" id="2982437">==</span>&nbsp;<span class="ident" id="2982440">prefix</span><br>
<span class="lineno"></span><span class="op" id="2982447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2982450">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2982508">func</span>&nbsp;<span class="ident" id="2982513">HasSuffix</span><span class="op" id="2982522">(</span><span class="ident" id="2982523">s</span><span class="op" id="2982524">,</span>&nbsp;<span class="ident" id="2982526">suffix</span>&nbsp;<span class="builtintype" id="2982533">string</span><span class="op" id="2982539">)</span>&nbsp;<span class="builtintype" id="2982541">bool</span>&nbsp;<span class="op" id="2982546">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982549">return</span>&nbsp;<span class="builtinfunc" id="2982556">len</span><span class="op" id="2982559">(</span><span class="ident" id="2982560">s</span><span class="op" id="2982561">)</span>&nbsp;<span class="op" id="2982563">&gt;=</span>&nbsp;<span class="builtinfunc" id="2982566">len</span><span class="op" id="2982569">(</span><span class="ident" id="2982570">suffix</span><span class="op" id="2982576">)</span>&nbsp;<span class="op" id="2982578">&amp;&amp;</span>&nbsp;<span class="ident" id="2982581">s</span><span class="op" id="2982582">[</span><span class="builtinfunc" id="2982583">len</span><span class="op" id="2982586">(</span><span class="ident" id="2982587">s</span><span class="op" id="2982588">)</span><span class="op" id="2982589">-</span><span class="builtinfunc" id="2982590">len</span><span class="op" id="2982593">(</span><span class="ident" id="2982594">suffix</span><span class="op" id="2982600">)</span><span class="op" id="2982601">:</span><span class="op" id="2982602">]</span>&nbsp;<span class="op" id="2982604">==</span>&nbsp;<span class="ident" id="2982607">suffix</span><br>
<span class="lineno"></span><span class="op" id="2982614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2982617">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2982688">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2982780">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2982828">func</span>&nbsp;<span class="ident" id="2982833">Map</span><span class="op" id="2982836">(</span><span class="ident" id="2982837">mapping</span>&nbsp;<span class="keyword" id="2982845">func</span><span class="op" id="2982849">(</span><span class="builtintype" id="2982850">rune</span><span class="op" id="2982854">)</span>&nbsp;<span class="builtintype" id="2982856">rune</span><span class="op" id="2982860">,</span>&nbsp;<span class="ident" id="2982862">s</span>&nbsp;<span class="builtintype" id="2982864">string</span><span class="op" id="2982870">)</span>&nbsp;<span class="builtintype" id="2982872">string</span>&nbsp;<span class="op" id="2982879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982882">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982945">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983012">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983074">maxbytes</span>&nbsp;<span class="op" id="2983083">:=</span>&nbsp;<span class="builtinfunc" id="2983086">len</span><span class="op" id="2983089">(</span><span class="ident" id="2983090">s</span><span class="op" id="2983091">)</span>&nbsp;<span class="comment" id="2983093">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983109">nbytes</span>&nbsp;<span class="op" id="2983116">:=</span>&nbsp;<span class="num" id="2983119">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983128">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983161">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983221">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983251">var</span>&nbsp;<span class="ident" id="2983255">b</span>&nbsp;<span class="op" id="2983257">[</span><span class="op" id="2983258">]</span><span class="builtintype" id="2983259">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983266">for</span>&nbsp;<span class="ident" id="2983270">i</span><span class="op" id="2983271">,</span>&nbsp;<span class="ident" id="2983273">c</span>&nbsp;<span class="op" id="2983275">:=</span>&nbsp;<span class="keyword" id="2983278">range</span>&nbsp;<span class="ident" id="2983284">s</span>&nbsp;<span class="op" id="2983286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983290">r</span>&nbsp;<span class="op" id="2983292">:=</span>&nbsp;<span class="ident" id="2983295">mapping</span><span class="op" id="2983302">(</span><span class="ident" id="2983303">c</span><span class="op" id="2983304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983308">if</span>&nbsp;<span class="ident" id="2983311">b</span>&nbsp;<span class="op" id="2983313">==</span>&nbsp;<span class="ident" id="2983316">nil</span>&nbsp;<span class="op" id="2983320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983325">if</span>&nbsp;<span class="ident" id="2983328">r</span>&nbsp;<span class="op" id="2983330">==</span>&nbsp;<span class="ident" id="2983333">c</span>&nbsp;<span class="op" id="2983335">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983341">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983358">b</span>&nbsp;<span class="op" id="2983360">=</span>&nbsp;<span class="builtinfunc" id="2983362">make</span><span class="op" id="2983366">(</span><span class="op" id="2983367">[</span><span class="op" id="2983368">]</span><span class="builtintype" id="2983369">byte</span><span class="op" id="2983373">,</span>&nbsp;<span class="ident" id="2983375">maxbytes</span><span class="op" id="2983383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983388">nbytes</span>&nbsp;<span class="op" id="2983395">=</span>&nbsp;<span class="builtinfunc" id="2983397">copy</span><span class="op" id="2983401">(</span><span class="ident" id="2983402">b</span><span class="op" id="2983403">,</span>&nbsp;<span class="ident" id="2983405">s</span><span class="op" id="2983406">[</span><span class="op" id="2983407">:</span><span class="ident" id="2983408">i</span><span class="op" id="2983409">]</span><span class="op" id="2983410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983414">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983418">if</span>&nbsp;<span class="ident" id="2983421">r</span>&nbsp;<span class="op" id="2983423">&gt;=</span>&nbsp;<span class="num" id="2983426">0</span>&nbsp;<span class="op" id="2983428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983433">wid</span>&nbsp;<span class="op" id="2983437">:=</span>&nbsp;<span class="num" id="2983440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983445">if</span>&nbsp;<span class="ident" id="2983448">r</span>&nbsp;<span class="op" id="2983450">&gt;=</span>&nbsp;<span class="ident" id="2983453">utf8</span><span class="op" id="2983457">.</span><span class="ident" id="2983458">RuneSelf</span>&nbsp;<span class="op" id="2983467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983473">wid</span>&nbsp;<span class="op" id="2983477">=</span>&nbsp;<span class="ident" id="2983479">utf8</span><span class="op" id="2983483">.</span><span class="ident" id="2983484">RuneLen</span><span class="op" id="2983491">(</span><span class="ident" id="2983492">r</span><span class="op" id="2983493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983498">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983503">if</span>&nbsp;<span class="ident" id="2983506">nbytes</span><span class="op" id="2983512">+</span><span class="ident" id="2983513">wid</span>&nbsp;<span class="op" id="2983517">&gt;</span>&nbsp;<span class="ident" id="2983519">maxbytes</span>&nbsp;<span class="op" id="2983528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983534">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983558">maxbytes</span>&nbsp;<span class="op" id="2983567">=</span>&nbsp;<span class="ident" id="2983569">maxbytes</span><span class="op" id="2983577">*</span><span class="num" id="2983578">2</span>&nbsp;<span class="op" id="2983580">+</span>&nbsp;<span class="ident" id="2983582">utf8</span><span class="op" id="2983586">.</span><span class="ident" id="2983587">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983598">nb</span>&nbsp;<span class="op" id="2983601">:=</span>&nbsp;<span class="builtinfunc" id="2983604">make</span><span class="op" id="2983608">(</span><span class="op" id="2983609">[</span><span class="op" id="2983610">]</span><span class="builtintype" id="2983611">byte</span><span class="op" id="2983615">,</span>&nbsp;<span class="ident" id="2983617">maxbytes</span><span class="op" id="2983625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2983631">copy</span><span class="op" id="2983635">(</span><span class="ident" id="2983636">nb</span><span class="op" id="2983638">,</span>&nbsp;<span class="ident" id="2983640">b</span><span class="op" id="2983641">[</span><span class="num" id="2983642">0</span><span class="op" id="2983643">:</span><span class="ident" id="2983644">nbytes</span><span class="op" id="2983650">]</span><span class="op" id="2983651">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983657">b</span>&nbsp;<span class="op" id="2983659">=</span>&nbsp;<span class="ident" id="2983661">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983672">nbytes</span>&nbsp;<span class="op" id="2983679">+=</span>&nbsp;<span class="ident" id="2983682">utf8</span><span class="op" id="2983686">.</span><span class="ident" id="2983687">EncodeRune</span><span class="op" id="2983697">(</span><span class="ident" id="2983698">b</span><span class="op" id="2983699">[</span><span class="ident" id="2983700">nbytes</span><span class="op" id="2983706">:</span><span class="ident" id="2983707">maxbytes</span><span class="op" id="2983715">]</span><span class="op" id="2983716">,</span>&nbsp;<span class="ident" id="2983718">r</span><span class="op" id="2983719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983726">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983729">if</span>&nbsp;<span class="ident" id="2983732">b</span>&nbsp;<span class="op" id="2983734">==</span>&nbsp;<span class="ident" id="2983737">nil</span>&nbsp;<span class="op" id="2983741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983745">return</span>&nbsp;<span class="ident" id="2983752">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983758">return</span>&nbsp;<span class="builtintype" id="2983765">string</span><span class="op" id="2983771">(</span><span class="ident" id="2983772">b</span><span class="op" id="2983773">[</span><span class="num" id="2983774">0</span><span class="op" id="2983775">:</span><span class="ident" id="2983776">nbytes</span><span class="op" id="2983782">]</span><span class="op" id="2983783">)</span><br>
<span class="lineno"></span><span class="op" id="2983785">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2983788">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2983863">func</span>&nbsp;<span class="ident" id="2983868">Repeat</span><span class="op" id="2983874">(</span><span class="ident" id="2983875">s</span>&nbsp;<span class="builtintype" id="2983877">string</span><span class="op" id="2983883">,</span>&nbsp;<span class="ident" id="2983885">count</span>&nbsp;<span class="builtintype" id="2983891">int</span><span class="op" id="2983894">)</span>&nbsp;<span class="builtintype" id="2983896">string</span>&nbsp;<span class="op" id="2983903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983906">b</span>&nbsp;<span class="op" id="2983908">:=</span>&nbsp;<span class="builtinfunc" id="2983911">make</span><span class="op" id="2983915">(</span><span class="op" id="2983916">[</span><span class="op" id="2983917">]</span><span class="builtintype" id="2983918">byte</span><span class="op" id="2983922">,</span>&nbsp;<span class="builtinfunc" id="2983924">len</span><span class="op" id="2983927">(</span><span class="ident" id="2983928">s</span><span class="op" id="2983929">)</span><span class="op" id="2983930">*</span><span class="ident" id="2983931">count</span><span class="op" id="2983936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983939">bp</span>&nbsp;<span class="op" id="2983942">:=</span>&nbsp;<span class="builtinfunc" id="2983945">copy</span><span class="op" id="2983949">(</span><span class="ident" id="2983950">b</span><span class="op" id="2983951">,</span>&nbsp;<span class="ident" id="2983953">s</span><span class="op" id="2983954">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983957">for</span>&nbsp;<span class="ident" id="2983961">bp</span>&nbsp;<span class="op" id="2983964">&lt;</span>&nbsp;<span class="builtinfunc" id="2983966">len</span><span class="op" id="2983969">(</span><span class="ident" id="2983970">b</span><span class="op" id="2983971">)</span>&nbsp;<span class="op" id="2983973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2983977">copy</span><span class="op" id="2983981">(</span><span class="ident" id="2983982">b</span><span class="op" id="2983983">[</span><span class="ident" id="2983984">bp</span><span class="op" id="2983986">:</span><span class="op" id="2983987">]</span><span class="op" id="2983988">,</span>&nbsp;<span class="ident" id="2983990">b</span><span class="op" id="2983991">[</span><span class="op" id="2983992">:</span><span class="ident" id="2983993">bp</span><span class="op" id="2983995">]</span><span class="op" id="2983996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984000">bp</span>&nbsp;<span class="op" id="2984003">*=</span>&nbsp;<span class="num" id="2984006">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984012">return</span>&nbsp;<span class="builtintype" id="2984019">string</span><span class="op" id="2984025">(</span><span class="ident" id="2984026">b</span><span class="op" id="2984027">)</span><br>
<span class="lineno">465</span><span class="op" id="2984029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2984032">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2984127">func</span>&nbsp;<span class="ident" id="2984132">ToUpper</span><span class="op" id="2984139">(</span><span class="ident" id="2984140">s</span>&nbsp;<span class="builtintype" id="2984142">string</span><span class="op" id="2984148">)</span>&nbsp;<span class="builtintype" id="2984150">string</span>&nbsp;<span class="op" id="2984157">{</span>&nbsp;<span class="keyword" id="2984159">return</span>&nbsp;<span class="ident" id="2984166">Map</span><span class="op" id="2984169">(</span><span class="ident" id="2984170">unicode</span><span class="op" id="2984177">.</span><span class="ident" id="2984178">ToUpper</span><span class="op" id="2984185">,</span>&nbsp;<span class="ident" id="2984187">s</span><span class="op" id="2984188">)</span>&nbsp;<span class="op" id="2984190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2984193">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2984288">func</span>&nbsp;<span class="ident" id="2984293">ToLower</span><span class="op" id="2984300">(</span><span class="ident" id="2984301">s</span>&nbsp;<span class="builtintype" id="2984303">string</span><span class="op" id="2984309">)</span>&nbsp;<span class="builtintype" id="2984311">string</span>&nbsp;<span class="op" id="2984318">{</span>&nbsp;<span class="keyword" id="2984320">return</span>&nbsp;<span class="ident" id="2984327">Map</span><span class="op" id="2984330">(</span><span class="ident" id="2984331">unicode</span><span class="op" id="2984338">.</span><span class="ident" id="2984339">ToLower</span><span class="op" id="2984346">,</span>&nbsp;<span class="ident" id="2984348">s</span><span class="op" id="2984349">)</span>&nbsp;<span class="op" id="2984351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2984354">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2984449">func</span>&nbsp;<span class="ident" id="2984454">ToTitle</span><span class="op" id="2984461">(</span><span class="ident" id="2984462">s</span>&nbsp;<span class="builtintype" id="2984464">string</span><span class="op" id="2984470">)</span>&nbsp;<span class="builtintype" id="2984472">string</span>&nbsp;<span class="op" id="2984479">{</span>&nbsp;<span class="keyword" id="2984481">return</span>&nbsp;<span class="ident" id="2984488">Map</span><span class="op" id="2984491">(</span><span class="ident" id="2984492">unicode</span><span class="op" id="2984499">.</span><span class="ident" id="2984500">ToTitle</span><span class="op" id="2984507">,</span>&nbsp;<span class="ident" id="2984509">s</span><span class="op" id="2984510">)</span>&nbsp;<span class="op" id="2984512">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2984515">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2984605">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2984665">func</span>&nbsp;<span class="ident" id="2984670">ToUpperSpecial</span><span class="op" id="2984684">(</span><span class="ident" id="2984685">_case</span>&nbsp;<span class="ident" id="2984691">unicode</span><span class="op" id="2984698">.</span><span class="ident" id="2984699">SpecialCase</span><span class="op" id="2984710">,</span>&nbsp;<span class="ident" id="2984712">s</span>&nbsp;<span class="builtintype" id="2984714">string</span><span class="op" id="2984720">)</span>&nbsp;<span class="builtintype" id="2984722">string</span>&nbsp;<span class="op" id="2984729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984732">return</span>&nbsp;<span class="ident" id="2984739">Map</span><span class="op" id="2984742">(</span><span class="keyword" id="2984743">func</span><span class="op" id="2984747">(</span><span class="ident" id="2984748">r</span>&nbsp;<span class="builtintype" id="2984750">rune</span><span class="op" id="2984754">)</span>&nbsp;<span class="builtintype" id="2984756">rune</span>&nbsp;<span class="op" id="2984761">{</span>&nbsp;<span class="keyword" id="2984763">return</span>&nbsp;<span class="ident" id="2984770">_case</span><span class="op" id="2984775">.</span><span class="ident" id="2984776">ToUpper</span><span class="op" id="2984783">(</span><span class="ident" id="2984784">r</span><span class="op" id="2984785">)</span>&nbsp;<span class="op" id="2984787">}</span><span class="op" id="2984788">,</span>&nbsp;<span class="ident" id="2984790">s</span><span class="op" id="2984791">)</span><br>
<span class="lineno">480</span><span class="op" id="2984793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2984796">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2984886">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2984946">func</span>&nbsp;<span class="ident" id="2984951">ToLowerSpecial</span><span class="op" id="2984965">(</span><span class="ident" id="2984966">_case</span>&nbsp;<span class="ident" id="2984972">unicode</span><span class="op" id="2984979">.</span><span class="ident" id="2984980">SpecialCase</span><span class="op" id="2984991">,</span>&nbsp;<span class="ident" id="2984993">s</span>&nbsp;<span class="builtintype" id="2984995">string</span><span class="op" id="2985001">)</span>&nbsp;<span class="builtintype" id="2985003">string</span>&nbsp;<span class="op" id="2985010">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985013">return</span>&nbsp;<span class="ident" id="2985020">Map</span><span class="op" id="2985023">(</span><span class="keyword" id="2985024">func</span><span class="op" id="2985028">(</span><span class="ident" id="2985029">r</span>&nbsp;<span class="builtintype" id="2985031">rune</span><span class="op" id="2985035">)</span>&nbsp;<span class="builtintype" id="2985037">rune</span>&nbsp;<span class="op" id="2985042">{</span>&nbsp;<span class="keyword" id="2985044">return</span>&nbsp;<span class="ident" id="2985051">_case</span><span class="op" id="2985056">.</span><span class="ident" id="2985057">ToLower</span><span class="op" id="2985064">(</span><span class="ident" id="2985065">r</span><span class="op" id="2985066">)</span>&nbsp;<span class="op" id="2985068">}</span><span class="op" id="2985069">,</span>&nbsp;<span class="ident" id="2985071">s</span><span class="op" id="2985072">)</span><br>
<span class="lineno"></span><span class="op" id="2985074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2985077">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2985167">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2985227">func</span>&nbsp;<span class="ident" id="2985232">ToTitleSpecial</span><span class="op" id="2985246">(</span><span class="ident" id="2985247">_case</span>&nbsp;<span class="ident" id="2985253">unicode</span><span class="op" id="2985260">.</span><span class="ident" id="2985261">SpecialCase</span><span class="op" id="2985272">,</span>&nbsp;<span class="ident" id="2985274">s</span>&nbsp;<span class="builtintype" id="2985276">string</span><span class="op" id="2985282">)</span>&nbsp;<span class="builtintype" id="2985284">string</span>&nbsp;<span class="op" id="2985291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985294">return</span>&nbsp;<span class="ident" id="2985301">Map</span><span class="op" id="2985304">(</span><span class="keyword" id="2985305">func</span><span class="op" id="2985309">(</span><span class="ident" id="2985310">r</span>&nbsp;<span class="builtintype" id="2985312">rune</span><span class="op" id="2985316">)</span>&nbsp;<span class="builtintype" id="2985318">rune</span>&nbsp;<span class="op" id="2985323">{</span>&nbsp;<span class="keyword" id="2985325">return</span>&nbsp;<span class="ident" id="2985332">_case</span><span class="op" id="2985337">.</span><span class="ident" id="2985338">ToTitle</span><span class="op" id="2985345">(</span><span class="ident" id="2985346">r</span><span class="op" id="2985347">)</span>&nbsp;<span class="op" id="2985349">}</span><span class="op" id="2985350">,</span>&nbsp;<span class="ident" id="2985352">s</span><span class="op" id="2985353">)</span><br>
<span class="lineno"></span><span class="op" id="2985355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2985358">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2985426">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2985496">func</span>&nbsp;<span class="ident" id="2985501">isSeparator</span><span class="op" id="2985512">(</span><span class="ident" id="2985513">r</span>&nbsp;<span class="builtintype" id="2985515">rune</span><span class="op" id="2985519">)</span>&nbsp;<span class="builtintype" id="2985521">bool</span>&nbsp;<span class="op" id="2985526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2985529">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985587">if</span>&nbsp;<span class="ident" id="2985590">r</span>&nbsp;<span class="op" id="2985592">&lt;=</span>&nbsp;<span class="num" id="2985595">0x7F</span>&nbsp;<span class="op" id="2985600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985604">switch</span>&nbsp;<span class="op" id="2985611">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985615">case</span>&nbsp;<span class="string" id="2985620">&#39;0&#39;</span>&nbsp;<span class="op" id="2985624">&lt;=</span>&nbsp;<span class="ident" id="2985627">r</span>&nbsp;<span class="op" id="2985629">&amp;&amp;</span>&nbsp;<span class="ident" id="2985632">r</span>&nbsp;<span class="op" id="2985634">&lt;=</span>&nbsp;<span class="string" id="2985637">&#39;9&#39;</span><span class="op" id="2985640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985645">return</span>&nbsp;<span class="builtintype" id="2985652">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985660">case</span>&nbsp;<span class="string" id="2985665">&#39;a&#39;</span>&nbsp;<span class="op" id="2985669">&lt;=</span>&nbsp;<span class="ident" id="2985672">r</span>&nbsp;<span class="op" id="2985674">&amp;&amp;</span>&nbsp;<span class="ident" id="2985677">r</span>&nbsp;<span class="op" id="2985679">&lt;=</span>&nbsp;<span class="string" id="2985682">&#39;z&#39;</span><span class="op" id="2985685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985690">return</span>&nbsp;<span class="builtintype" id="2985697">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985705">case</span>&nbsp;<span class="string" id="2985710">&#39;A&#39;</span>&nbsp;<span class="op" id="2985714">&lt;=</span>&nbsp;<span class="ident" id="2985717">r</span>&nbsp;<span class="op" id="2985719">&amp;&amp;</span>&nbsp;<span class="ident" id="2985722">r</span>&nbsp;<span class="op" id="2985724">&lt;=</span>&nbsp;<span class="string" id="2985727">&#39;Z&#39;</span><span class="op" id="2985730">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985735">return</span>&nbsp;<span class="builtintype" id="2985742">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985750">case</span>&nbsp;<span class="ident" id="2985755">r</span>&nbsp;<span class="op" id="2985757">==</span>&nbsp;<span class="string" id="2985760">&#39;_&#39;</span><span class="op" id="2985763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985768">return</span>&nbsp;<span class="builtintype" id="2985775">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985787">return</span>&nbsp;<span class="builtintype" id="2985794">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2985803">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985845">if</span>&nbsp;<span class="ident" id="2985848">unicode</span><span class="op" id="2985855">.</span><span class="ident" id="2985856">IsLetter</span><span class="op" id="2985864">(</span><span class="ident" id="2985865">r</span><span class="op" id="2985866">)</span>&nbsp;<span class="op" id="2985868">||</span>&nbsp;<span class="ident" id="2985871">unicode</span><span class="op" id="2985878">.</span><span class="ident" id="2985879">IsDigit</span><span class="op" id="2985886">(</span><span class="ident" id="2985887">r</span><span class="op" id="2985888">)</span>&nbsp;<span class="op" id="2985890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985894">return</span>&nbsp;<span class="builtintype" id="2985901">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985908">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2985911">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985979">return</span>&nbsp;<span class="ident" id="2985986">unicode</span><span class="op" id="2985993">.</span><span class="ident" id="2985994">IsSpace</span><span class="op" id="2986001">(</span><span class="ident" id="2986002">r</span><span class="op" id="2986003">)</span><br>
<span class="lineno"></span><span class="op" id="2986005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986008">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2986090">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2986121">//</span><br>
<span class="lineno"></span><span class="comment" id="2986124">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2986218">func</span>&nbsp;<span class="ident" id="2986223">Title</span><span class="op" id="2986228">(</span><span class="ident" id="2986229">s</span>&nbsp;<span class="builtintype" id="2986231">string</span><span class="op" id="2986237">)</span>&nbsp;<span class="builtintype" id="2986239">string</span>&nbsp;<span class="op" id="2986246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2986249">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2986291">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2986363">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986394">prev</span>&nbsp;<span class="op" id="2986399">:=</span>&nbsp;<span class="string" id="2986402">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986407">return</span>&nbsp;<span class="ident" id="2986414">Map</span><span class="op" id="2986417">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986421">func</span><span class="op" id="2986425">(</span><span class="ident" id="2986426">r</span>&nbsp;<span class="builtintype" id="2986428">rune</span><span class="op" id="2986432">)</span>&nbsp;<span class="builtintype" id="2986434">rune</span>&nbsp;<span class="op" id="2986439">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986444">if</span>&nbsp;<span class="ident" id="2986447">isSeparator</span><span class="op" id="2986458">(</span><span class="ident" id="2986459">prev</span><span class="op" id="2986463">)</span>&nbsp;<span class="op" id="2986465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986471">prev</span>&nbsp;<span class="op" id="2986476">=</span>&nbsp;<span class="ident" id="2986478">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986484">return</span>&nbsp;<span class="ident" id="2986491">unicode</span><span class="op" id="2986498">.</span><span class="ident" id="2986499">ToTitle</span><span class="op" id="2986506">(</span><span class="ident" id="2986507">r</span><span class="op" id="2986508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986518">prev</span>&nbsp;<span class="op" id="2986523">=</span>&nbsp;<span class="ident" id="2986525">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986530">return</span>&nbsp;<span class="ident" id="2986537">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986541">}</span><span class="op" id="2986542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986546">s</span><span class="op" id="2986547">)</span><br>
<span class="lineno"></span><span class="op" id="2986549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2986552">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2986617">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2986667">func</span>&nbsp;<span class="ident" id="2986672">TrimLeftFunc</span><span class="op" id="2986684">(</span><span class="ident" id="2986685">s</span>&nbsp;<span class="builtintype" id="2986687">string</span><span class="op" id="2986693">,</span>&nbsp;<span class="ident" id="2986695">f</span>&nbsp;<span class="keyword" id="2986697">func</span><span class="op" id="2986701">(</span><span class="builtintype" id="2986702">rune</span><span class="op" id="2986706">)</span>&nbsp;<span class="builtintype" id="2986708">bool</span><span class="op" id="2986712">)</span>&nbsp;<span class="builtintype" id="2986714">string</span>&nbsp;<span class="op" id="2986721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986724">i</span>&nbsp;<span class="op" id="2986726">:=</span>&nbsp;<span class="ident" id="2986729">indexFunc</span><span class="op" id="2986738">(</span><span class="ident" id="2986739">s</span><span class="op" id="2986740">,</span>&nbsp;<span class="ident" id="2986742">f</span><span class="op" id="2986743">,</span>&nbsp;<span class="builtintype" id="2986745">false</span><span class="op" id="2986750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986753">if</span>&nbsp;<span class="ident" id="2986756">i</span>&nbsp;<span class="op" id="2986758">==</span>&nbsp;<span class="op" id="2986761">-</span><span class="num" id="2986762">1</span>&nbsp;<span class="op" id="2986764">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986768">return</span>&nbsp;<span class="string" id="2986775">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986782">return</span>&nbsp;<span class="ident" id="2986789">s</span><span class="op" id="2986790">[</span><span class="ident" id="2986791">i</span><span class="op" id="2986792">:</span><span class="op" id="2986793">]</span><br>
<span class="lineno"></span><span class="op" id="2986795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2986798">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2986865">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2986915">func</span>&nbsp;<span class="ident" id="2986920">TrimRightFunc</span><span class="op" id="2986933">(</span><span class="ident" id="2986934">s</span>&nbsp;<span class="builtintype" id="2986936">string</span><span class="op" id="2986942">,</span>&nbsp;<span class="ident" id="2986944">f</span>&nbsp;<span class="keyword" id="2986946">func</span><span class="op" id="2986950">(</span><span class="builtintype" id="2986951">rune</span><span class="op" id="2986955">)</span>&nbsp;<span class="builtintype" id="2986957">bool</span><span class="op" id="2986961">)</span>&nbsp;<span class="builtintype" id="2986963">string</span>&nbsp;<span class="op" id="2986970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986973">i</span>&nbsp;<span class="op" id="2986975">:=</span>&nbsp;<span class="ident" id="2986978">lastIndexFunc</span><span class="op" id="2986991">(</span><span class="ident" id="2986992">s</span><span class="op" id="2986993">,</span>&nbsp;<span class="ident" id="2986995">f</span><span class="op" id="2986996">,</span>&nbsp;<span class="builtintype" id="2986998">false</span><span class="op" id="2987003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987006">if</span>&nbsp;<span class="ident" id="2987009">i</span>&nbsp;<span class="op" id="2987011">&gt;=</span>&nbsp;<span class="num" id="2987014">0</span>&nbsp;<span class="op" id="2987016">&amp;&amp;</span>&nbsp;<span class="ident" id="2987019">s</span><span class="op" id="2987020">[</span><span class="ident" id="2987021">i</span><span class="op" id="2987022">]</span>&nbsp;<span class="op" id="2987024">&gt;=</span>&nbsp;<span class="ident" id="2987027">utf8</span><span class="op" id="2987031">.</span><span class="ident" id="2987032">RuneSelf</span>&nbsp;<span class="op" id="2987041">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987045">_</span><span class="op" id="2987046">,</span>&nbsp;<span class="ident" id="2987048">wid</span>&nbsp;<span class="op" id="2987052">:=</span>&nbsp;<span class="ident" id="2987055">utf8</span><span class="op" id="2987059">.</span><span class="ident" id="2987060">DecodeRuneInString</span><span class="op" id="2987078">(</span><span class="ident" id="2987079">s</span><span class="op" id="2987080">[</span><span class="ident" id="2987081">i</span><span class="op" id="2987082">:</span><span class="op" id="2987083">]</span><span class="op" id="2987084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987088">i</span>&nbsp;<span class="op" id="2987090">+=</span>&nbsp;<span class="ident" id="2987093">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987098">}</span>&nbsp;<span class="keyword" id="2987100">else</span>&nbsp;<span class="op" id="2987105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987109">i</span><span class="op" id="2987110">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987114">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987117">return</span>&nbsp;<span class="ident" id="2987124">s</span><span class="op" id="2987125">[</span><span class="num" id="2987126">0</span><span class="op" id="2987127">:</span><span class="ident" id="2987128">i</span><span class="op" id="2987129">]</span><br>
<span class="lineno"></span><span class="op" id="2987131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2987134">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2987195">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2987258">func</span>&nbsp;<span class="ident" id="2987263">TrimFunc</span><span class="op" id="2987271">(</span><span class="ident" id="2987272">s</span>&nbsp;<span class="builtintype" id="2987274">string</span><span class="op" id="2987280">,</span>&nbsp;<span class="ident" id="2987282">f</span>&nbsp;<span class="keyword" id="2987284">func</span><span class="op" id="2987288">(</span><span class="builtintype" id="2987289">rune</span><span class="op" id="2987293">)</span>&nbsp;<span class="builtintype" id="2987295">bool</span><span class="op" id="2987299">)</span>&nbsp;<span class="builtintype" id="2987301">string</span>&nbsp;<span class="op" id="2987308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987311">return</span>&nbsp;<span class="ident" id="2987318">TrimRightFunc</span><span class="op" id="2987331">(</span><span class="ident" id="2987332">TrimLeftFunc</span><span class="op" id="2987344">(</span><span class="ident" id="2987345">s</span><span class="op" id="2987346">,</span>&nbsp;<span class="ident" id="2987348">f</span><span class="op" id="2987349">)</span><span class="op" id="2987350">,</span>&nbsp;<span class="ident" id="2987352">f</span><span class="op" id="2987353">)</span><br>
<span class="lineno"></span><span class="op" id="2987355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2987358">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2987417">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2987466">func</span>&nbsp;<span class="ident" id="2987471">IndexFunc</span><span class="op" id="2987480">(</span><span class="ident" id="2987481">s</span>&nbsp;<span class="builtintype" id="2987483">string</span><span class="op" id="2987489">,</span>&nbsp;<span class="ident" id="2987491">f</span>&nbsp;<span class="keyword" id="2987493">func</span><span class="op" id="2987497">(</span><span class="builtintype" id="2987498">rune</span><span class="op" id="2987502">)</span>&nbsp;<span class="builtintype" id="2987504">bool</span><span class="op" id="2987508">)</span>&nbsp;<span class="builtintype" id="2987510">int</span>&nbsp;<span class="op" id="2987514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987517">return</span>&nbsp;<span class="ident" id="2987524">indexFunc</span><span class="op" id="2987533">(</span><span class="ident" id="2987534">s</span><span class="op" id="2987535">,</span>&nbsp;<span class="ident" id="2987537">f</span><span class="op" id="2987538">,</span>&nbsp;<span class="builtintype" id="2987540">true</span><span class="op" id="2987544">)</span><br>
<span class="lineno"></span><span class="op" id="2987546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2987549">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2987603">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2987660">func</span>&nbsp;<span class="ident" id="2987665">LastIndexFunc</span><span class="op" id="2987678">(</span><span class="ident" id="2987679">s</span>&nbsp;<span class="builtintype" id="2987681">string</span><span class="op" id="2987687">,</span>&nbsp;<span class="ident" id="2987689">f</span>&nbsp;<span class="keyword" id="2987691">func</span><span class="op" id="2987695">(</span><span class="builtintype" id="2987696">rune</span><span class="op" id="2987700">)</span>&nbsp;<span class="builtintype" id="2987702">bool</span><span class="op" id="2987706">)</span>&nbsp;<span class="builtintype" id="2987708">int</span>&nbsp;<span class="op" id="2987712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987715">return</span>&nbsp;<span class="ident" id="2987722">lastIndexFunc</span><span class="op" id="2987735">(</span><span class="ident" id="2987736">s</span><span class="op" id="2987737">,</span>&nbsp;<span class="ident" id="2987739">f</span><span class="op" id="2987740">,</span>&nbsp;<span class="builtintype" id="2987742">true</span><span class="op" id="2987746">)</span><br>
<span class="lineno"></span><span class="op" id="2987748">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2987751">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2987804">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2987860">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2987873">func</span>&nbsp;<span class="ident" id="2987878">indexFunc</span><span class="op" id="2987887">(</span><span class="ident" id="2987888">s</span>&nbsp;<span class="builtintype" id="2987890">string</span><span class="op" id="2987896">,</span>&nbsp;<span class="ident" id="2987898">f</span>&nbsp;<span class="keyword" id="2987900">func</span><span class="op" id="2987904">(</span><span class="builtintype" id="2987905">rune</span><span class="op" id="2987909">)</span>&nbsp;<span class="builtintype" id="2987911">bool</span><span class="op" id="2987915">,</span>&nbsp;<span class="ident" id="2987917">truth</span>&nbsp;<span class="builtintype" id="2987923">bool</span><span class="op" id="2987927">)</span>&nbsp;<span class="builtintype" id="2987929">int</span>&nbsp;<span class="op" id="2987933">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987936">start</span>&nbsp;<span class="op" id="2987942">:=</span>&nbsp;<span class="num" id="2987945">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987948">for</span>&nbsp;<span class="ident" id="2987952">start</span>&nbsp;<span class="op" id="2987958">&lt;</span>&nbsp;<span class="builtinfunc" id="2987960">len</span><span class="op" id="2987963">(</span><span class="ident" id="2987964">s</span><span class="op" id="2987965">)</span>&nbsp;<span class="op" id="2987967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987971">wid</span>&nbsp;<span class="op" id="2987975">:=</span>&nbsp;<span class="num" id="2987978">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987982">r</span>&nbsp;<span class="op" id="2987984">:=</span>&nbsp;<span class="builtintype" id="2987987">rune</span><span class="op" id="2987991">(</span><span class="ident" id="2987992">s</span><span class="op" id="2987993">[</span><span class="ident" id="2987994">start</span><span class="op" id="2987999">]</span><span class="op" id="2988000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988004">if</span>&nbsp;<span class="ident" id="2988007">r</span>&nbsp;<span class="op" id="2988009">&gt;=</span>&nbsp;<span class="ident" id="2988012">utf8</span><span class="op" id="2988016">.</span><span class="ident" id="2988017">RuneSelf</span>&nbsp;<span class="op" id="2988026">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988031">r</span><span class="op" id="2988032">,</span>&nbsp;<span class="ident" id="2988034">wid</span>&nbsp;<span class="op" id="2988038">=</span>&nbsp;<span class="ident" id="2988040">utf8</span><span class="op" id="2988044">.</span><span class="ident" id="2988045">DecodeRuneInString</span><span class="op" id="2988063">(</span><span class="ident" id="2988064">s</span><span class="op" id="2988065">[</span><span class="ident" id="2988066">start</span><span class="op" id="2988071">:</span><span class="op" id="2988072">]</span><span class="op" id="2988073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988081">if</span>&nbsp;<span class="ident" id="2988084">f</span><span class="op" id="2988085">(</span><span class="ident" id="2988086">r</span><span class="op" id="2988087">)</span>&nbsp;<span class="op" id="2988089">==</span>&nbsp;<span class="ident" id="2988092">truth</span>&nbsp;<span class="op" id="2988098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988103">return</span>&nbsp;<span class="ident" id="2988110">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988118">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988122">start</span>&nbsp;<span class="op" id="2988128">+=</span>&nbsp;<span class="ident" id="2988131">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988139">return</span>&nbsp;<span class="op" id="2988146">-</span><span class="num" id="2988147">1</span><br>
<span class="lineno"></span><span class="op" id="2988149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2988152">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2988213">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2988269">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2988282">func</span>&nbsp;<span class="ident" id="2988287">lastIndexFunc</span><span class="op" id="2988300">(</span><span class="ident" id="2988301">s</span>&nbsp;<span class="builtintype" id="2988303">string</span><span class="op" id="2988309">,</span>&nbsp;<span class="ident" id="2988311">f</span>&nbsp;<span class="keyword" id="2988313">func</span><span class="op" id="2988317">(</span><span class="builtintype" id="2988318">rune</span><span class="op" id="2988322">)</span>&nbsp;<span class="builtintype" id="2988324">bool</span><span class="op" id="2988328">,</span>&nbsp;<span class="ident" id="2988330">truth</span>&nbsp;<span class="builtintype" id="2988336">bool</span><span class="op" id="2988340">)</span>&nbsp;<span class="builtintype" id="2988342">int</span>&nbsp;<span class="op" id="2988346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988349">for</span>&nbsp;<span class="ident" id="2988353">i</span>&nbsp;<span class="op" id="2988355">:=</span>&nbsp;<span class="builtinfunc" id="2988358">len</span><span class="op" id="2988361">(</span><span class="ident" id="2988362">s</span><span class="op" id="2988363">)</span><span class="op" id="2988364">;</span>&nbsp;<span class="ident" id="2988366">i</span>&nbsp;<span class="op" id="2988368">&gt;</span>&nbsp;<span class="num" id="2988370">0</span><span class="op" id="2988371">;</span>&nbsp;<span class="op" id="2988373">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988377">r</span><span class="op" id="2988378">,</span>&nbsp;<span class="ident" id="2988380">size</span>&nbsp;<span class="op" id="2988385">:=</span>&nbsp;<span class="ident" id="2988388">utf8</span><span class="op" id="2988392">.</span><span class="ident" id="2988393">DecodeLastRuneInString</span><span class="op" id="2988415">(</span><span class="ident" id="2988416">s</span><span class="op" id="2988417">[</span><span class="num" id="2988418">0</span><span class="op" id="2988419">:</span><span class="ident" id="2988420">i</span><span class="op" id="2988421">]</span><span class="op" id="2988422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988426">i</span>&nbsp;<span class="op" id="2988428">-=</span>&nbsp;<span class="ident" id="2988431">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988438">if</span>&nbsp;<span class="ident" id="2988441">f</span><span class="op" id="2988442">(</span><span class="ident" id="2988443">r</span><span class="op" id="2988444">)</span>&nbsp;<span class="op" id="2988446">==</span>&nbsp;<span class="ident" id="2988449">truth</span>&nbsp;<span class="op" id="2988455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988460">return</span>&nbsp;<span class="ident" id="2988467">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988471">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988477">return</span>&nbsp;<span class="op" id="2988484">-</span><span class="num" id="2988485">1</span><br>
<span class="lineno"></span><span class="op" id="2988487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2988490">func</span>&nbsp;<span class="ident" id="2988495">makeCutsetFunc</span><span class="op" id="2988509">(</span><span class="ident" id="2988510">cutset</span>&nbsp;<span class="builtintype" id="2988517">string</span><span class="op" id="2988523">)</span>&nbsp;<span class="keyword" id="2988525">func</span><span class="op" id="2988529">(</span><span class="builtintype" id="2988530">rune</span><span class="op" id="2988534">)</span>&nbsp;<span class="builtintype" id="2988536">bool</span>&nbsp;<span class="op" id="2988541">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988544">return</span>&nbsp;<span class="keyword" id="2988551">func</span><span class="op" id="2988555">(</span><span class="ident" id="2988556">r</span>&nbsp;<span class="builtintype" id="2988558">rune</span><span class="op" id="2988562">)</span>&nbsp;<span class="builtintype" id="2988564">bool</span>&nbsp;<span class="op" id="2988569">{</span>&nbsp;<span class="keyword" id="2988571">return</span>&nbsp;<span class="ident" id="2988578">IndexRune</span><span class="op" id="2988587">(</span><span class="ident" id="2988588">cutset</span><span class="op" id="2988594">,</span>&nbsp;<span class="ident" id="2988596">r</span><span class="op" id="2988597">)</span>&nbsp;<span class="op" id="2988599">&gt;=</span>&nbsp;<span class="num" id="2988602">0</span>&nbsp;<span class="op" id="2988604">}</span><br>
<span class="lineno"></span><span class="op" id="2988606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2988609">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2988670">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2988731">func</span>&nbsp;<span class="ident" id="2988736">Trim</span><span class="op" id="2988740">(</span><span class="ident" id="2988741">s</span>&nbsp;<span class="builtintype" id="2988743">string</span><span class="op" id="2988749">,</span>&nbsp;<span class="ident" id="2988751">cutset</span>&nbsp;<span class="builtintype" id="2988758">string</span><span class="op" id="2988764">)</span>&nbsp;<span class="builtintype" id="2988766">string</span>&nbsp;<span class="op" id="2988773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988776">if</span>&nbsp;<span class="ident" id="2988779">s</span>&nbsp;<span class="op" id="2988781">==</span>&nbsp;<span class="string" id="2988784">&#34;&#34;</span>&nbsp;<span class="op" id="2988787">||</span>&nbsp;<span class="ident" id="2988790">cutset</span>&nbsp;<span class="op" id="2988797">==</span>&nbsp;<span class="string" id="2988800">&#34;&#34;</span>&nbsp;<span class="op" id="2988803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988807">return</span>&nbsp;<span class="ident" id="2988814">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988820">return</span>&nbsp;<span class="ident" id="2988827">TrimFunc</span><span class="op" id="2988835">(</span><span class="ident" id="2988836">s</span><span class="op" id="2988837">,</span>&nbsp;<span class="ident" id="2988839">makeCutsetFunc</span><span class="op" id="2988853">(</span><span class="ident" id="2988854">cutset</span><span class="op" id="2988860">)</span><span class="op" id="2988861">)</span><br>
<span class="lineno">625</span><span class="op" id="2988863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2988866">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2988927">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2988979">func</span>&nbsp;<span class="ident" id="2988984">TrimLeft</span><span class="op" id="2988992">(</span><span class="ident" id="2988993">s</span>&nbsp;<span class="builtintype" id="2988995">string</span><span class="op" id="2989001">,</span>&nbsp;<span class="ident" id="2989003">cutset</span>&nbsp;<span class="builtintype" id="2989010">string</span><span class="op" id="2989016">)</span>&nbsp;<span class="builtintype" id="2989018">string</span>&nbsp;<span class="op" id="2989025">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989028">if</span>&nbsp;<span class="ident" id="2989031">s</span>&nbsp;<span class="op" id="2989033">==</span>&nbsp;<span class="string" id="2989036">&#34;&#34;</span>&nbsp;<span class="op" id="2989039">||</span>&nbsp;<span class="ident" id="2989042">cutset</span>&nbsp;<span class="op" id="2989049">==</span>&nbsp;<span class="string" id="2989052">&#34;&#34;</span>&nbsp;<span class="op" id="2989055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989059">return</span>&nbsp;<span class="ident" id="2989066">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989072">return</span>&nbsp;<span class="ident" id="2989079">TrimLeftFunc</span><span class="op" id="2989091">(</span><span class="ident" id="2989092">s</span><span class="op" id="2989093">,</span>&nbsp;<span class="ident" id="2989095">makeCutsetFunc</span><span class="op" id="2989109">(</span><span class="ident" id="2989110">cutset</span><span class="op" id="2989116">)</span><span class="op" id="2989117">)</span><br>
<span class="lineno"></span><span class="op" id="2989119">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2989122">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2989186">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2989238">func</span>&nbsp;<span class="ident" id="2989243">TrimRight</span><span class="op" id="2989252">(</span><span class="ident" id="2989253">s</span>&nbsp;<span class="builtintype" id="2989255">string</span><span class="op" id="2989261">,</span>&nbsp;<span class="ident" id="2989263">cutset</span>&nbsp;<span class="builtintype" id="2989270">string</span><span class="op" id="2989276">)</span>&nbsp;<span class="builtintype" id="2989278">string</span>&nbsp;<span class="op" id="2989285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989288">if</span>&nbsp;<span class="ident" id="2989291">s</span>&nbsp;<span class="op" id="2989293">==</span>&nbsp;<span class="string" id="2989296">&#34;&#34;</span>&nbsp;<span class="op" id="2989299">||</span>&nbsp;<span class="ident" id="2989302">cutset</span>&nbsp;<span class="op" id="2989309">==</span>&nbsp;<span class="string" id="2989312">&#34;&#34;</span>&nbsp;<span class="op" id="2989315">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989319">return</span>&nbsp;<span class="ident" id="2989326">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989332">return</span>&nbsp;<span class="ident" id="2989339">TrimRightFunc</span><span class="op" id="2989352">(</span><span class="ident" id="2989353">s</span><span class="op" id="2989354">,</span>&nbsp;<span class="ident" id="2989356">makeCutsetFunc</span><span class="op" id="2989370">(</span><span class="ident" id="2989371">cutset</span><span class="op" id="2989377">)</span><span class="op" id="2989378">)</span><br>
<span class="lineno"></span><span class="op" id="2989380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2989383">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2989446">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2989506">func</span>&nbsp;<span class="ident" id="2989511">TrimSpace</span><span class="op" id="2989520">(</span><span class="ident" id="2989521">s</span>&nbsp;<span class="builtintype" id="2989523">string</span><span class="op" id="2989529">)</span>&nbsp;<span class="builtintype" id="2989531">string</span>&nbsp;<span class="op" id="2989538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989541">return</span>&nbsp;<span class="ident" id="2989548">TrimFunc</span><span class="op" id="2989556">(</span><span class="ident" id="2989557">s</span><span class="op" id="2989558">,</span>&nbsp;<span class="ident" id="2989560">unicode</span><span class="op" id="2989567">.</span><span class="ident" id="2989568">IsSpace</span><span class="op" id="2989575">)</span><br>
<span class="lineno"></span><span class="op" id="2989577">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2989580">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2989648">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2989708">func</span>&nbsp;<span class="ident" id="2989713">TrimPrefix</span><span class="op" id="2989723">(</span><span class="ident" id="2989724">s</span><span class="op" id="2989725">,</span>&nbsp;<span class="ident" id="2989727">prefix</span>&nbsp;<span class="builtintype" id="2989734">string</span><span class="op" id="2989740">)</span>&nbsp;<span class="builtintype" id="2989742">string</span>&nbsp;<span class="op" id="2989749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989752">if</span>&nbsp;<span class="ident" id="2989755">HasPrefix</span><span class="op" id="2989764">(</span><span class="ident" id="2989765">s</span><span class="op" id="2989766">,</span>&nbsp;<span class="ident" id="2989768">prefix</span><span class="op" id="2989774">)</span>&nbsp;<span class="op" id="2989776">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989780">return</span>&nbsp;<span class="ident" id="2989787">s</span><span class="op" id="2989788">[</span><span class="builtinfunc" id="2989789">len</span><span class="op" id="2989792">(</span><span class="ident" id="2989793">prefix</span><span class="op" id="2989799">)</span><span class="op" id="2989800">:</span><span class="op" id="2989801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989807">return</span>&nbsp;<span class="ident" id="2989814">s</span><br>
<span class="lineno"></span><span class="op" id="2989816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2989819">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2989888">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2989946">func</span>&nbsp;<span class="ident" id="2989951">TrimSuffix</span><span class="op" id="2989961">(</span><span class="ident" id="2989962">s</span><span class="op" id="2989963">,</span>&nbsp;<span class="ident" id="2989965">suffix</span>&nbsp;<span class="builtintype" id="2989972">string</span><span class="op" id="2989978">)</span>&nbsp;<span class="builtintype" id="2989980">string</span>&nbsp;<span class="op" id="2989987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989990">if</span>&nbsp;<span class="ident" id="2989993">HasSuffix</span><span class="op" id="2990002">(</span><span class="ident" id="2990003">s</span><span class="op" id="2990004">,</span>&nbsp;<span class="ident" id="2990006">suffix</span><span class="op" id="2990012">)</span>&nbsp;<span class="op" id="2990014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990018">return</span>&nbsp;<span class="ident" id="2990025">s</span><span class="op" id="2990026">[</span><span class="op" id="2990027">:</span><span class="builtinfunc" id="2990028">len</span><span class="op" id="2990031">(</span><span class="ident" id="2990032">s</span><span class="op" id="2990033">)</span><span class="op" id="2990034">-</span><span class="builtinfunc" id="2990035">len</span><span class="op" id="2990038">(</span><span class="ident" id="2990039">suffix</span><span class="op" id="2990045">)</span><span class="op" id="2990046">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990052">return</span>&nbsp;<span class="ident" id="2990059">s</span><br>
<span class="lineno"></span><span class="op" id="2990061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2990064">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2990123">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2990176">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2990238">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2990304">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2990328">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2990390">func</span>&nbsp;<span class="ident" id="2990395">Replace</span><span class="op" id="2990402">(</span><span class="ident" id="2990403">s</span><span class="op" id="2990404">,</span>&nbsp;<span class="ident" id="2990406">old</span><span class="op" id="2990409">,</span>&nbsp;<span class="builtinfunc" id="2990411">new</span>&nbsp;<span class="builtintype" id="2990415">string</span><span class="op" id="2990421">,</span>&nbsp;<span class="ident" id="2990423">n</span>&nbsp;<span class="builtintype" id="2990425">int</span><span class="op" id="2990428">)</span>&nbsp;<span class="builtintype" id="2990430">string</span>&nbsp;<span class="op" id="2990437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990440">if</span>&nbsp;<span class="ident" id="2990443">old</span>&nbsp;<span class="op" id="2990447">==</span>&nbsp;<span class="builtinfunc" id="2990450">new</span>&nbsp;<span class="op" id="2990454">||</span>&nbsp;<span class="ident" id="2990457">n</span>&nbsp;<span class="op" id="2990459">==</span>&nbsp;<span class="num" id="2990462">0</span>&nbsp;<span class="op" id="2990464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990468">return</span>&nbsp;<span class="ident" id="2990475">s</span>&nbsp;<span class="comment" id="2990477">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2990502">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990538">if</span>&nbsp;<span class="ident" id="2990541">m</span>&nbsp;<span class="op" id="2990543">:=</span>&nbsp;<span class="ident" id="2990546">Count</span><span class="op" id="2990551">(</span><span class="ident" id="2990552">s</span><span class="op" id="2990553">,</span>&nbsp;<span class="ident" id="2990555">old</span><span class="op" id="2990558">)</span><span class="op" id="2990559">;</span>&nbsp;<span class="ident" id="2990561">m</span>&nbsp;<span class="op" id="2990563">==</span>&nbsp;<span class="num" id="2990566">0</span>&nbsp;<span class="op" id="2990568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990572">return</span>&nbsp;<span class="ident" id="2990579">s</span>&nbsp;<span class="comment" id="2990581">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990602">}</span>&nbsp;<span class="keyword" id="2990604">else</span>&nbsp;<span class="keyword" id="2990609">if</span>&nbsp;<span class="ident" id="2990612">n</span>&nbsp;<span class="op" id="2990614">&lt;</span>&nbsp;<span class="num" id="2990616">0</span>&nbsp;<span class="op" id="2990618">||</span>&nbsp;<span class="ident" id="2990621">m</span>&nbsp;<span class="op" id="2990623">&lt;</span>&nbsp;<span class="ident" id="2990625">n</span>&nbsp;<span class="op" id="2990627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990631">n</span>&nbsp;<span class="op" id="2990633">=</span>&nbsp;<span class="ident" id="2990635">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2990642">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990676">t</span>&nbsp;<span class="op" id="2990678">:=</span>&nbsp;<span class="builtinfunc" id="2990681">make</span><span class="op" id="2990685">(</span><span class="op" id="2990686">[</span><span class="op" id="2990687">]</span><span class="builtintype" id="2990688">byte</span><span class="op" id="2990692">,</span>&nbsp;<span class="builtinfunc" id="2990694">len</span><span class="op" id="2990697">(</span><span class="ident" id="2990698">s</span><span class="op" id="2990699">)</span><span class="op" id="2990700">+</span><span class="ident" id="2990701">n</span><span class="op" id="2990702">*</span><span class="op" id="2990703">(</span><span class="builtinfunc" id="2990704">len</span><span class="op" id="2990707">(</span><span class="builtinfunc" id="2990708">new</span><span class="op" id="2990711">)</span><span class="op" id="2990712">-</span><span class="builtinfunc" id="2990713">len</span><span class="op" id="2990716">(</span><span class="ident" id="2990717">old</span><span class="op" id="2990720">)</span><span class="op" id="2990721">)</span><span class="op" id="2990722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990725">w</span>&nbsp;<span class="op" id="2990727">:=</span>&nbsp;<span class="num" id="2990730">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990733">start</span>&nbsp;<span class="op" id="2990739">:=</span>&nbsp;<span class="num" id="2990742">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990745">for</span>&nbsp;<span class="ident" id="2990749">i</span>&nbsp;<span class="op" id="2990751">:=</span>&nbsp;<span class="num" id="2990754">0</span><span class="op" id="2990755">;</span>&nbsp;<span class="ident" id="2990757">i</span>&nbsp;<span class="op" id="2990759">&lt;</span>&nbsp;<span class="ident" id="2990761">n</span><span class="op" id="2990762">;</span>&nbsp;<span class="ident" id="2990764">i</span><span class="op" id="2990765">++</span>&nbsp;<span class="op" id="2990768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990772">j</span>&nbsp;<span class="op" id="2990774">:=</span>&nbsp;<span class="ident" id="2990777">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990785">if</span>&nbsp;<span class="builtinfunc" id="2990788">len</span><span class="op" id="2990791">(</span><span class="ident" id="2990792">old</span><span class="op" id="2990795">)</span>&nbsp;<span class="op" id="2990797">==</span>&nbsp;<span class="num" id="2990800">0</span>&nbsp;<span class="op" id="2990802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990807">if</span>&nbsp;<span class="ident" id="2990810">i</span>&nbsp;<span class="op" id="2990812">&gt;</span>&nbsp;<span class="num" id="2990814">0</span>&nbsp;<span class="op" id="2990816">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990822">_</span><span class="op" id="2990823">,</span>&nbsp;<span class="ident" id="2990825">wid</span>&nbsp;<span class="op" id="2990829">:=</span>&nbsp;<span class="ident" id="2990832">utf8</span><span class="op" id="2990836">.</span><span class="ident" id="2990837">DecodeRuneInString</span><span class="op" id="2990855">(</span><span class="ident" id="2990856">s</span><span class="op" id="2990857">[</span><span class="ident" id="2990858">start</span><span class="op" id="2990863">:</span><span class="op" id="2990864">]</span><span class="op" id="2990865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990871">j</span>&nbsp;<span class="op" id="2990873">+=</span>&nbsp;<span class="ident" id="2990876">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990887">}</span>&nbsp;<span class="keyword" id="2990889">else</span>&nbsp;<span class="op" id="2990894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990899">j</span>&nbsp;<span class="op" id="2990901">+=</span>&nbsp;<span class="ident" id="2990904">Index</span><span class="op" id="2990909">(</span><span class="ident" id="2990910">s</span><span class="op" id="2990911">[</span><span class="ident" id="2990912">start</span><span class="op" id="2990917">:</span><span class="op" id="2990918">]</span><span class="op" id="2990919">,</span>&nbsp;<span class="ident" id="2990921">old</span><span class="op" id="2990924">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990932">w</span>&nbsp;<span class="op" id="2990934">+=</span>&nbsp;<span class="builtinfunc" id="2990937">copy</span><span class="op" id="2990941">(</span><span class="ident" id="2990942">t</span><span class="op" id="2990943">[</span><span class="ident" id="2990944">w</span><span class="op" id="2990945">:</span><span class="op" id="2990946">]</span><span class="op" id="2990947">,</span>&nbsp;<span class="ident" id="2990949">s</span><span class="op" id="2990950">[</span><span class="ident" id="2990951">start</span><span class="op" id="2990956">:</span><span class="ident" id="2990957">j</span><span class="op" id="2990958">]</span><span class="op" id="2990959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990963">w</span>&nbsp;<span class="op" id="2990965">+=</span>&nbsp;<span class="builtinfunc" id="2990968">copy</span><span class="op" id="2990972">(</span><span class="ident" id="2990973">t</span><span class="op" id="2990974">[</span><span class="ident" id="2990975">w</span><span class="op" id="2990976">:</span><span class="op" id="2990977">]</span><span class="op" id="2990978">,</span>&nbsp;<span class="builtinfunc" id="2990980">new</span><span class="op" id="2990983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990987">start</span>&nbsp;<span class="op" id="2990993">=</span>&nbsp;<span class="ident" id="2990995">j</span>&nbsp;<span class="op" id="2990997">+</span>&nbsp;<span class="builtinfunc" id="2990999">len</span><span class="op" id="2991002">(</span><span class="ident" id="2991003">old</span><span class="op" id="2991006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991009">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991012">w</span>&nbsp;<span class="op" id="2991014">+=</span>&nbsp;<span class="builtinfunc" id="2991017">copy</span><span class="op" id="2991021">(</span><span class="ident" id="2991022">t</span><span class="op" id="2991023">[</span><span class="ident" id="2991024">w</span><span class="op" id="2991025">:</span><span class="op" id="2991026">]</span><span class="op" id="2991027">,</span>&nbsp;<span class="ident" id="2991029">s</span><span class="op" id="2991030">[</span><span class="ident" id="2991031">start</span><span class="op" id="2991036">:</span><span class="op" id="2991037">]</span><span class="op" id="2991038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991041">return</span>&nbsp;<span class="builtintype" id="2991048">string</span><span class="op" id="2991054">(</span><span class="ident" id="2991055">t</span><span class="op" id="2991056">[</span><span class="num" id="2991057">0</span><span class="op" id="2991058">:</span><span class="ident" id="2991059">w</span><span class="op" id="2991060">]</span><span class="op" id="2991061">)</span><br>
<span class="lineno"></span><span class="op" id="2991063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2991066">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2991134">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2991175">func</span>&nbsp;<span class="ident" id="2991180">EqualFold</span><span class="op" id="2991189">(</span><span class="ident" id="2991190">s</span><span class="op" id="2991191">,</span>&nbsp;<span class="ident" id="2991193">t</span>&nbsp;<span class="builtintype" id="2991195">string</span><span class="op" id="2991201">)</span>&nbsp;<span class="builtintype" id="2991203">bool</span>&nbsp;<span class="op" id="2991208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991211">for</span>&nbsp;<span class="ident" id="2991215">s</span>&nbsp;<span class="op" id="2991217">!=</span>&nbsp;<span class="string" id="2991220">&#34;&#34;</span>&nbsp;<span class="op" id="2991223">&amp;&amp;</span>&nbsp;<span class="ident" id="2991226">t</span>&nbsp;<span class="op" id="2991228">!=</span>&nbsp;<span class="string" id="2991231">&#34;&#34;</span>&nbsp;<span class="op" id="2991234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991238">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991280">var</span>&nbsp;<span class="ident" id="2991284">sr</span><span class="op" id="2991286">,</span>&nbsp;<span class="ident" id="2991288">tr</span>&nbsp;<span class="builtintype" id="2991291">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991298">if</span>&nbsp;<span class="ident" id="2991301">s</span><span class="op" id="2991302">[</span><span class="num" id="2991303">0</span><span class="op" id="2991304">]</span>&nbsp;<span class="op" id="2991306">&lt;</span>&nbsp;<span class="ident" id="2991308">utf8</span><span class="op" id="2991312">.</span><span class="ident" id="2991313">RuneSelf</span>&nbsp;<span class="op" id="2991322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991327">sr</span><span class="op" id="2991329">,</span>&nbsp;<span class="ident" id="2991331">s</span>&nbsp;<span class="op" id="2991333">=</span>&nbsp;<span class="builtintype" id="2991335">rune</span><span class="op" id="2991339">(</span><span class="ident" id="2991340">s</span><span class="op" id="2991341">[</span><span class="num" id="2991342">0</span><span class="op" id="2991343">]</span><span class="op" id="2991344">)</span><span class="op" id="2991345">,</span>&nbsp;<span class="ident" id="2991347">s</span><span class="op" id="2991348">[</span><span class="num" id="2991349">1</span><span class="op" id="2991350">:</span><span class="op" id="2991351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991355">}</span>&nbsp;<span class="keyword" id="2991357">else</span>&nbsp;<span class="op" id="2991362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991367">r</span><span class="op" id="2991368">,</span>&nbsp;<span class="ident" id="2991370">size</span>&nbsp;<span class="op" id="2991375">:=</span>&nbsp;<span class="ident" id="2991378">utf8</span><span class="op" id="2991382">.</span><span class="ident" id="2991383">DecodeRuneInString</span><span class="op" id="2991401">(</span><span class="ident" id="2991402">s</span><span class="op" id="2991403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991408">sr</span><span class="op" id="2991410">,</span>&nbsp;<span class="ident" id="2991412">s</span>&nbsp;<span class="op" id="2991414">=</span>&nbsp;<span class="ident" id="2991416">r</span><span class="op" id="2991417">,</span>&nbsp;<span class="ident" id="2991419">s</span><span class="op" id="2991420">[</span><span class="ident" id="2991421">size</span><span class="op" id="2991425">:</span><span class="op" id="2991426">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991434">if</span>&nbsp;<span class="ident" id="2991437">t</span><span class="op" id="2991438">[</span><span class="num" id="2991439">0</span><span class="op" id="2991440">]</span>&nbsp;<span class="op" id="2991442">&lt;</span>&nbsp;<span class="ident" id="2991444">utf8</span><span class="op" id="2991448">.</span><span class="ident" id="2991449">RuneSelf</span>&nbsp;<span class="op" id="2991458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991463">tr</span><span class="op" id="2991465">,</span>&nbsp;<span class="ident" id="2991467">t</span>&nbsp;<span class="op" id="2991469">=</span>&nbsp;<span class="builtintype" id="2991471">rune</span><span class="op" id="2991475">(</span><span class="ident" id="2991476">t</span><span class="op" id="2991477">[</span><span class="num" id="2991478">0</span><span class="op" id="2991479">]</span><span class="op" id="2991480">)</span><span class="op" id="2991481">,</span>&nbsp;<span class="ident" id="2991483">t</span><span class="op" id="2991484">[</span><span class="num" id="2991485">1</span><span class="op" id="2991486">:</span><span class="op" id="2991487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991491">}</span>&nbsp;<span class="keyword" id="2991493">else</span>&nbsp;<span class="op" id="2991498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991503">r</span><span class="op" id="2991504">,</span>&nbsp;<span class="ident" id="2991506">size</span>&nbsp;<span class="op" id="2991511">:=</span>&nbsp;<span class="ident" id="2991514">utf8</span><span class="op" id="2991518">.</span><span class="ident" id="2991519">DecodeRuneInString</span><span class="op" id="2991537">(</span><span class="ident" id="2991538">t</span><span class="op" id="2991539">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991544">tr</span><span class="op" id="2991546">,</span>&nbsp;<span class="ident" id="2991548">t</span>&nbsp;<span class="op" id="2991550">=</span>&nbsp;<span class="ident" id="2991552">r</span><span class="op" id="2991553">,</span>&nbsp;<span class="ident" id="2991555">t</span><span class="op" id="2991556">[</span><span class="ident" id="2991557">size</span><span class="op" id="2991561">:</span><span class="op" id="2991562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991571">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991626">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991642">if</span>&nbsp;<span class="ident" id="2991645">tr</span>&nbsp;<span class="op" id="2991648">==</span>&nbsp;<span class="ident" id="2991651">sr</span>&nbsp;<span class="op" id="2991654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991659">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991675">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991719">if</span>&nbsp;<span class="ident" id="2991722">tr</span>&nbsp;<span class="op" id="2991725">&lt;</span>&nbsp;<span class="ident" id="2991727">sr</span>&nbsp;<span class="op" id="2991730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991735">tr</span><span class="op" id="2991737">,</span>&nbsp;<span class="ident" id="2991739">sr</span>&nbsp;<span class="op" id="2991742">=</span>&nbsp;<span class="ident" id="2991744">sr</span><span class="op" id="2991746">,</span>&nbsp;<span class="ident" id="2991748">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991757">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991784">if</span>&nbsp;<span class="ident" id="2991787">tr</span>&nbsp;<span class="op" id="2991790">&lt;</span>&nbsp;<span class="ident" id="2991792">utf8</span><span class="op" id="2991796">.</span><span class="ident" id="2991797">RuneSelf</span>&nbsp;<span class="op" id="2991806">&amp;&amp;</span>&nbsp;<span class="string" id="2991809">&#39;A&#39;</span>&nbsp;<span class="op" id="2991813">&lt;=</span>&nbsp;<span class="ident" id="2991816">sr</span>&nbsp;<span class="op" id="2991819">&amp;&amp;</span>&nbsp;<span class="ident" id="2991822">sr</span>&nbsp;<span class="op" id="2991825">&lt;=</span>&nbsp;<span class="string" id="2991828">&#39;Z&#39;</span>&nbsp;<span class="op" id="2991832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991837">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991896">if</span>&nbsp;<span class="ident" id="2991899">tr</span>&nbsp;<span class="op" id="2991902">==</span>&nbsp;<span class="ident" id="2991905">sr</span><span class="op" id="2991907">+</span><span class="string" id="2991908">&#39;a&#39;</span><span class="op" id="2991911">-</span><span class="string" id="2991912">&#39;A&#39;</span>&nbsp;<span class="op" id="2991916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991934">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991939">return</span>&nbsp;<span class="builtintype" id="2991946">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991959">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992030">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992070">r</span>&nbsp;<span class="op" id="2992072">:=</span>&nbsp;<span class="ident" id="2992075">unicode</span><span class="op" id="2992082">.</span><span class="ident" id="2992083">SimpleFold</span><span class="op" id="2992093">(</span><span class="ident" id="2992094">sr</span><span class="op" id="2992096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992100">for</span>&nbsp;<span class="ident" id="2992104">r</span>&nbsp;<span class="op" id="2992106">!=</span>&nbsp;<span class="ident" id="2992109">sr</span>&nbsp;<span class="op" id="2992112">&amp;&amp;</span>&nbsp;<span class="ident" id="2992115">r</span>&nbsp;<span class="op" id="2992117">&lt;</span>&nbsp;<span class="ident" id="2992119">tr</span>&nbsp;<span class="op" id="2992122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992127">r</span>&nbsp;<span class="op" id="2992129">=</span>&nbsp;<span class="ident" id="2992131">unicode</span><span class="op" id="2992138">.</span><span class="ident" id="2992139">SimpleFold</span><span class="op" id="2992149">(</span><span class="ident" id="2992150">r</span><span class="op" id="2992151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992159">if</span>&nbsp;<span class="ident" id="2992162">r</span>&nbsp;<span class="op" id="2992164">==</span>&nbsp;<span class="ident" id="2992167">tr</span>&nbsp;<span class="op" id="2992170">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992175">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992190">return</span>&nbsp;<span class="builtintype" id="2992197">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992208">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992244">return</span>&nbsp;<span class="ident" id="2992251">s</span>&nbsp;<span class="op" id="2992253">==</span>&nbsp;<span class="ident" id="2992256">t</span><br>
<span class="lineno"></span><span class="op" id="2992258">}</span>
</div>
</body>
</html>
