<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html" class="current">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7911359">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7911415">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7911469">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7911520">package</span>&nbsp;<span class="ident" id="7911528">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911537">import</span>&nbsp;<span class="op" id="7911544">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911547">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911556">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911573">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911583">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911590">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911596">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911609">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911616">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911627">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911638">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7911648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7911651">type</span>&nbsp;<span class="ident" id="7911656">Args</span>&nbsp;<span class="keyword" id="7911661">struct</span>&nbsp;<span class="op" id="7911668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7911671">A</span><span class="op" id="7911672">,</span>&nbsp;<span class="ident" id="7911674">B</span>&nbsp;<span class="builtintype" id="7911676">int</span><br>
<span class="lineno"></span><span class="op" id="7911680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911683">type</span>&nbsp;<span class="ident" id="7911688">Reply</span>&nbsp;<span class="keyword" id="7911694">struct</span>&nbsp;<span class="op" id="7911701">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7911704">C</span>&nbsp;<span class="builtintype" id="7911706">int</span><br>
<span class="lineno"></span><span class="op" id="7911710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911713">type</span>&nbsp;<span class="ident" id="7911718">Arith</span>&nbsp;<span class="builtintype" id="7911724">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7911729">type</span>&nbsp;<span class="ident" id="7911734">ArithAddResp</span>&nbsp;<span class="keyword" id="7911747">struct</span>&nbsp;<span class="op" id="7911754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7911757">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7911764">interface</span><span class="op" id="7911773">{</span><span class="op" id="7911774">}</span>&nbsp;<span class="string" id="7911776">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7911789">Result</span>&nbsp;<span class="ident" id="7911796">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7911808">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7911825">Error</span>&nbsp;&nbsp;<span class="keyword" id="7911832">interface</span><span class="op" id="7911841">{</span><span class="op" id="7911842">}</span>&nbsp;<span class="string" id="7911844">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7911859">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7911862">func</span>&nbsp;<span class="op" id="7911867">(</span><span class="ident" id="7911868">t</span>&nbsp;<span class="op" id="7911870">*</span><span class="ident" id="7911871">Arith</span><span class="op" id="7911876">)</span>&nbsp;<span class="ident" id="7911878">Add</span><span class="op" id="7911881">(</span><span class="ident" id="7911882">args</span>&nbsp;<span class="op" id="7911887">*</span><span class="ident" id="7911888">Args</span><span class="op" id="7911892">,</span>&nbsp;<span class="ident" id="7911894">reply</span>&nbsp;<span class="op" id="7911900">*</span><span class="ident" id="7911901">Reply</span><span class="op" id="7911906">)</span>&nbsp;<span class="builtintype" id="7911908">error</span>&nbsp;<span class="op" id="7911914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7911917">reply</span><span class="op" id="7911922">.</span><span class="ident" id="7911923">C</span>&nbsp;<span class="op" id="7911925">=</span>&nbsp;<span class="ident" id="7911927">args</span><span class="op" id="7911931">.</span><span class="ident" id="7911932">A</span>&nbsp;<span class="op" id="7911934">+</span>&nbsp;<span class="ident" id="7911936">args</span><span class="op" id="7911940">.</span><span class="ident" id="7911941">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7911944">return</span>&nbsp;<span class="builtintype" id="7911951">nil</span><br>
<span class="lineno"></span><span class="op" id="7911955">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7911958">func</span>&nbsp;<span class="op" id="7911963">(</span><span class="ident" id="7911964">t</span>&nbsp;<span class="op" id="7911966">*</span><span class="ident" id="7911967">Arith</span><span class="op" id="7911972">)</span>&nbsp;<span class="ident" id="7911974">Mul</span><span class="op" id="7911977">(</span><span class="ident" id="7911978">args</span>&nbsp;<span class="op" id="7911983">*</span><span class="ident" id="7911984">Args</span><span class="op" id="7911988">,</span>&nbsp;<span class="ident" id="7911990">reply</span>&nbsp;<span class="op" id="7911996">*</span><span class="ident" id="7911997">Reply</span><span class="op" id="7912002">)</span>&nbsp;<span class="builtintype" id="7912004">error</span>&nbsp;<span class="op" id="7912010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912013">reply</span><span class="op" id="7912018">.</span><span class="ident" id="7912019">C</span>&nbsp;<span class="op" id="7912021">=</span>&nbsp;<span class="ident" id="7912023">args</span><span class="op" id="7912027">.</span><span class="ident" id="7912028">A</span>&nbsp;<span class="op" id="7912030">*</span>&nbsp;<span class="ident" id="7912032">args</span><span class="op" id="7912036">.</span><span class="ident" id="7912037">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912040">return</span>&nbsp;<span class="builtintype" id="7912047">nil</span><br>
<span class="lineno"></span><span class="op" id="7912051">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7912054">func</span>&nbsp;<span class="op" id="7912059">(</span><span class="ident" id="7912060">t</span>&nbsp;<span class="op" id="7912062">*</span><span class="ident" id="7912063">Arith</span><span class="op" id="7912068">)</span>&nbsp;<span class="ident" id="7912070">Div</span><span class="op" id="7912073">(</span><span class="ident" id="7912074">args</span>&nbsp;<span class="op" id="7912079">*</span><span class="ident" id="7912080">Args</span><span class="op" id="7912084">,</span>&nbsp;<span class="ident" id="7912086">reply</span>&nbsp;<span class="op" id="7912092">*</span><span class="ident" id="7912093">Reply</span><span class="op" id="7912098">)</span>&nbsp;<span class="builtintype" id="7912100">error</span>&nbsp;<span class="op" id="7912106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912109">if</span>&nbsp;<span class="ident" id="7912112">args</span><span class="op" id="7912116">.</span><span class="ident" id="7912117">B</span>&nbsp;<span class="op" id="7912119">==</span>&nbsp;<span class="num" id="7912122">0</span>&nbsp;<span class="op" id="7912124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912128">return</span>&nbsp;<span class="ident" id="7912135">errors</span><span class="op" id="7912141">.</span><span class="ident" id="7912142">New</span><span class="op" id="7912145">(</span><span class="string" id="7912146">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7912162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7912165">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912168">reply</span><span class="op" id="7912173">.</span><span class="ident" id="7912174">C</span>&nbsp;<span class="op" id="7912176">=</span>&nbsp;<span class="ident" id="7912178">args</span><span class="op" id="7912182">.</span><span class="ident" id="7912183">A</span>&nbsp;<span class="op" id="7912185">/</span>&nbsp;<span class="ident" id="7912187">args</span><span class="op" id="7912191">.</span><span class="ident" id="7912192">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912195">return</span>&nbsp;<span class="builtintype" id="7912202">nil</span><br>
<span class="lineno"></span><span class="op" id="7912206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912209">func</span>&nbsp;<span class="op" id="7912214">(</span><span class="ident" id="7912215">t</span>&nbsp;<span class="op" id="7912217">*</span><span class="ident" id="7912218">Arith</span><span class="op" id="7912223">)</span>&nbsp;<span class="ident" id="7912225">Error</span><span class="op" id="7912230">(</span><span class="ident" id="7912231">args</span>&nbsp;<span class="op" id="7912236">*</span><span class="ident" id="7912237">Args</span><span class="op" id="7912241">,</span>&nbsp;<span class="ident" id="7912243">reply</span>&nbsp;<span class="op" id="7912249">*</span><span class="ident" id="7912250">Reply</span><span class="op" id="7912255">)</span>&nbsp;<span class="builtintype" id="7912257">error</span>&nbsp;<span class="op" id="7912263">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7912266">panic</span><span class="op" id="7912271">(</span><span class="string" id="7912272">&#34;ERROR&#34;</span><span class="op" id="7912279">)</span><br>
<span class="lineno"></span><span class="op" id="7912281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912284">func</span>&nbsp;<span class="ident" id="7912289">init</span><span class="op" id="7912293">(</span><span class="op" id="7912294">)</span>&nbsp;<span class="op" id="7912296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912299">rpc</span><span class="op" id="7912302">.</span><span class="ident" id="7912303">Register</span><span class="op" id="7912311">(</span><span class="builtinfunc" id="7912312">new</span><span class="op" id="7912315">(</span><span class="ident" id="7912316">Arith</span><span class="op" id="7912321">)</span><span class="op" id="7912322">)</span><br>
<span class="lineno">60</span><span class="op" id="7912324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912327">func</span>&nbsp;<span class="ident" id="7912332">TestServerNoParams</span><span class="op" id="7912350">(</span><span class="ident" id="7912351">t</span>&nbsp;<span class="op" id="7912353">*</span><span class="ident" id="7912354">testing</span><span class="op" id="7912361">.</span><span class="ident" id="7912362">T</span><span class="op" id="7912363">)</span>&nbsp;<span class="op" id="7912365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912368">cli</span><span class="op" id="7912371">,</span>&nbsp;<span class="ident" id="7912373">srv</span>&nbsp;<span class="op" id="7912377">:=</span>&nbsp;<span class="ident" id="7912380">net</span><span class="op" id="7912383">.</span><span class="ident" id="7912384">Pipe</span><span class="op" id="7912388">(</span><span class="op" id="7912389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912392">defer</span>&nbsp;<span class="ident" id="7912398">cli</span><span class="op" id="7912401">.</span><span class="ident" id="7912402">Close</span><span class="op" id="7912407">(</span><span class="op" id="7912408">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912411">go</span>&nbsp;<span class="ident" id="7912414">ServeConn</span><span class="op" id="7912423">(</span><span class="ident" id="7912424">srv</span><span class="op" id="7912427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912430">dec</span>&nbsp;<span class="op" id="7912434">:=</span>&nbsp;<span class="ident" id="7912437">json</span><span class="op" id="7912441">.</span><span class="ident" id="7912442">NewDecoder</span><span class="op" id="7912452">(</span><span class="ident" id="7912453">cli</span><span class="op" id="7912456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912460">fmt</span><span class="op" id="7912463">.</span><span class="ident" id="7912464">Fprintf</span><span class="op" id="7912471">(</span><span class="ident" id="7912472">cli</span><span class="op" id="7912475">,</span>&nbsp;<span class="string" id="7912477">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="7912515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912518">var</span>&nbsp;<span class="ident" id="7912522">resp</span>&nbsp;<span class="ident" id="7912527">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912541">if</span>&nbsp;<span class="ident" id="7912544">err</span>&nbsp;<span class="op" id="7912548">:=</span>&nbsp;<span class="ident" id="7912551">dec</span><span class="op" id="7912554">.</span><span class="ident" id="7912555">Decode</span><span class="op" id="7912561">(</span><span class="op" id="7912562">&amp;</span><span class="ident" id="7912563">resp</span><span class="op" id="7912567">)</span><span class="op" id="7912568">;</span>&nbsp;<span class="ident" id="7912570">err</span>&nbsp;<span class="op" id="7912574">!=</span>&nbsp;<span class="builtintype" id="7912577">nil</span>&nbsp;<span class="op" id="7912581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912585">t</span><span class="op" id="7912586">.</span><span class="ident" id="7912587">Fatalf</span><span class="op" id="7912593">(</span><span class="string" id="7912594">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="7912622">,</span>&nbsp;<span class="ident" id="7912624">err</span><span class="op" id="7912627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7912630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912633">if</span>&nbsp;<span class="ident" id="7912636">resp</span><span class="op" id="7912640">.</span><span class="ident" id="7912641">Error</span>&nbsp;<span class="op" id="7912647">==</span>&nbsp;<span class="builtintype" id="7912650">nil</span>&nbsp;<span class="op" id="7912654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912658">t</span><span class="op" id="7912659">.</span><span class="ident" id="7912660">Fatalf</span><span class="op" id="7912666">(</span><span class="string" id="7912667">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7912692">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7912695">}</span><br>
<span class="lineno"></span><span class="op" id="7912697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912700">func</span>&nbsp;<span class="ident" id="7912705">TestServerEmptyMessage</span><span class="op" id="7912727">(</span><span class="ident" id="7912728">t</span>&nbsp;<span class="op" id="7912730">*</span><span class="ident" id="7912731">testing</span><span class="op" id="7912738">.</span><span class="ident" id="7912739">T</span><span class="op" id="7912740">)</span>&nbsp;<span class="op" id="7912742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912745">cli</span><span class="op" id="7912748">,</span>&nbsp;<span class="ident" id="7912750">srv</span>&nbsp;<span class="op" id="7912754">:=</span>&nbsp;<span class="ident" id="7912757">net</span><span class="op" id="7912760">.</span><span class="ident" id="7912761">Pipe</span><span class="op" id="7912765">(</span><span class="op" id="7912766">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912769">defer</span>&nbsp;<span class="ident" id="7912775">cli</span><span class="op" id="7912778">.</span><span class="ident" id="7912779">Close</span><span class="op" id="7912784">(</span><span class="op" id="7912785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912788">go</span>&nbsp;<span class="ident" id="7912791">ServeConn</span><span class="op" id="7912800">(</span><span class="ident" id="7912801">srv</span><span class="op" id="7912804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912807">dec</span>&nbsp;<span class="op" id="7912811">:=</span>&nbsp;<span class="ident" id="7912814">json</span><span class="op" id="7912818">.</span><span class="ident" id="7912819">NewDecoder</span><span class="op" id="7912829">(</span><span class="ident" id="7912830">cli</span><span class="op" id="7912833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912837">fmt</span><span class="op" id="7912840">.</span><span class="ident" id="7912841">Fprintf</span><span class="op" id="7912848">(</span><span class="ident" id="7912849">cli</span><span class="op" id="7912852">,</span>&nbsp;<span class="string" id="7912854">&#34;{}&#34;</span><span class="op" id="7912858">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912861">var</span>&nbsp;<span class="ident" id="7912865">resp</span>&nbsp;<span class="ident" id="7912870">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912884">if</span>&nbsp;<span class="ident" id="7912887">err</span>&nbsp;<span class="op" id="7912891">:=</span>&nbsp;<span class="ident" id="7912894">dec</span><span class="op" id="7912897">.</span><span class="ident" id="7912898">Decode</span><span class="op" id="7912904">(</span><span class="op" id="7912905">&amp;</span><span class="ident" id="7912906">resp</span><span class="op" id="7912910">)</span><span class="op" id="7912911">;</span>&nbsp;<span class="ident" id="7912913">err</span>&nbsp;<span class="op" id="7912917">!=</span>&nbsp;<span class="builtintype" id="7912920">nil</span>&nbsp;<span class="op" id="7912924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912928">t</span><span class="op" id="7912929">.</span><span class="ident" id="7912930">Fatalf</span><span class="op" id="7912936">(</span><span class="string" id="7912937">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="7912961">,</span>&nbsp;<span class="ident" id="7912963">err</span><span class="op" id="7912966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7912969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7912972">if</span>&nbsp;<span class="ident" id="7912975">resp</span><span class="op" id="7912979">.</span><span class="ident" id="7912980">Error</span>&nbsp;<span class="op" id="7912986">==</span>&nbsp;<span class="builtintype" id="7912989">nil</span>&nbsp;<span class="op" id="7912993">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912997">t</span><span class="op" id="7912998">.</span><span class="ident" id="7912999">Fatalf</span><span class="op" id="7913005">(</span><span class="string" id="7913006">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7913031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7913034">}</span><br>
<span class="lineno"></span><span class="op" id="7913036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913039">func</span>&nbsp;<span class="ident" id="7913044">TestServer</span><span class="op" id="7913054">(</span><span class="ident" id="7913055">t</span>&nbsp;<span class="op" id="7913057">*</span><span class="ident" id="7913058">testing</span><span class="op" id="7913065">.</span><span class="ident" id="7913066">T</span><span class="op" id="7913067">)</span>&nbsp;<span class="op" id="7913069">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913072">cli</span><span class="op" id="7913075">,</span>&nbsp;<span class="ident" id="7913077">srv</span>&nbsp;<span class="op" id="7913081">:=</span>&nbsp;<span class="ident" id="7913084">net</span><span class="op" id="7913087">.</span><span class="ident" id="7913088">Pipe</span><span class="op" id="7913092">(</span><span class="op" id="7913093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913096">defer</span>&nbsp;<span class="ident" id="7913102">cli</span><span class="op" id="7913105">.</span><span class="ident" id="7913106">Close</span><span class="op" id="7913111">(</span><span class="op" id="7913112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913115">go</span>&nbsp;<span class="ident" id="7913118">ServeConn</span><span class="op" id="7913127">(</span><span class="ident" id="7913128">srv</span><span class="op" id="7913131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913134">dec</span>&nbsp;<span class="op" id="7913138">:=</span>&nbsp;<span class="ident" id="7913141">json</span><span class="op" id="7913145">.</span><span class="ident" id="7913146">NewDecoder</span><span class="op" id="7913156">(</span><span class="ident" id="7913157">cli</span><span class="op" id="7913160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7913164">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913221">for</span>&nbsp;<span class="ident" id="7913225">i</span>&nbsp;<span class="op" id="7913227">:=</span>&nbsp;<span class="num" id="7913230">0</span><span class="op" id="7913231">;</span>&nbsp;<span class="ident" id="7913233">i</span>&nbsp;<span class="op" id="7913235">&lt;</span>&nbsp;<span class="num" id="7913237">10</span><span class="op" id="7913239">;</span>&nbsp;<span class="ident" id="7913241">i</span><span class="op" id="7913242">++</span>&nbsp;<span class="op" id="7913245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913249">fmt</span><span class="op" id="7913252">.</span><span class="ident" id="7913253">Fprintf</span><span class="op" id="7913260">(</span><span class="ident" id="7913261">cli</span><span class="op" id="7913264">,</span>&nbsp;<span class="string" id="7913266">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="7913339">,</span>&nbsp;<span class="ident" id="7913341">i</span><span class="op" id="7913342">,</span>&nbsp;<span class="ident" id="7913344">i</span><span class="op" id="7913345">,</span>&nbsp;<span class="ident" id="7913347">i</span><span class="op" id="7913348">+</span><span class="num" id="7913349">1</span><span class="op" id="7913350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913354">var</span>&nbsp;<span class="ident" id="7913358">resp</span>&nbsp;<span class="ident" id="7913363">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913378">err</span>&nbsp;<span class="op" id="7913382">:=</span>&nbsp;<span class="ident" id="7913385">dec</span><span class="op" id="7913388">.</span><span class="ident" id="7913389">Decode</span><span class="op" id="7913395">(</span><span class="op" id="7913396">&amp;</span><span class="ident" id="7913397">resp</span><span class="op" id="7913401">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913405">if</span>&nbsp;<span class="ident" id="7913408">err</span>&nbsp;<span class="op" id="7913412">!=</span>&nbsp;<span class="builtintype" id="7913415">nil</span>&nbsp;<span class="op" id="7913419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913424">t</span><span class="op" id="7913425">.</span><span class="ident" id="7913426">Fatalf</span><span class="op" id="7913432">(</span><span class="string" id="7913433">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="7913445">,</span>&nbsp;<span class="ident" id="7913447">err</span><span class="op" id="7913450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7913454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913458">if</span>&nbsp;<span class="ident" id="7913461">resp</span><span class="op" id="7913465">.</span><span class="ident" id="7913466">Error</span>&nbsp;<span class="op" id="7913472">!=</span>&nbsp;<span class="builtintype" id="7913475">nil</span>&nbsp;<span class="op" id="7913479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913484">t</span><span class="op" id="7913485">.</span><span class="ident" id="7913486">Fatalf</span><span class="op" id="7913492">(</span><span class="string" id="7913493">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="7913509">,</span>&nbsp;<span class="ident" id="7913511">resp</span><span class="op" id="7913515">.</span><span class="ident" id="7913516">Error</span><span class="op" id="7913521">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7913525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913529">if</span>&nbsp;<span class="ident" id="7913532">resp</span><span class="op" id="7913536">.</span><span class="ident" id="7913537">Id</span><span class="op" id="7913539">.</span><span class="op" id="7913540">(</span><span class="builtintype" id="7913541">string</span><span class="op" id="7913547">)</span>&nbsp;<span class="op" id="7913549">!=</span>&nbsp;<span class="builtintype" id="7913552">string</span><span class="op" id="7913558">(</span><span class="ident" id="7913559">i</span><span class="op" id="7913560">)</span>&nbsp;<span class="op" id="7913562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913567">t</span><span class="op" id="7913568">.</span><span class="ident" id="7913569">Fatalf</span><span class="op" id="7913575">(</span><span class="string" id="7913576">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7913601">,</span>&nbsp;<span class="ident" id="7913603">resp</span><span class="op" id="7913607">.</span><span class="ident" id="7913608">Id</span><span class="op" id="7913610">.</span><span class="op" id="7913611">(</span><span class="builtintype" id="7913612">string</span><span class="op" id="7913618">)</span><span class="op" id="7913619">,</span>&nbsp;<span class="builtintype" id="7913621">string</span><span class="op" id="7913627">(</span><span class="ident" id="7913628">i</span><span class="op" id="7913629">)</span><span class="op" id="7913630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7913634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913638">if</span>&nbsp;<span class="ident" id="7913641">resp</span><span class="op" id="7913645">.</span><span class="ident" id="7913646">Result</span><span class="op" id="7913652">.</span><span class="ident" id="7913653">C</span>&nbsp;<span class="op" id="7913655">!=</span>&nbsp;<span class="num" id="7913658">2</span><span class="op" id="7913659">*</span><span class="ident" id="7913660">i</span><span class="op" id="7913661">+</span><span class="num" id="7913662">1</span>&nbsp;<span class="op" id="7913664">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913669">t</span><span class="op" id="7913670">.</span><span class="ident" id="7913671">Fatalf</span><span class="op" id="7913677">(</span><span class="string" id="7913678">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="7913706">,</span>&nbsp;<span class="ident" id="7913708">i</span><span class="op" id="7913709">,</span>&nbsp;<span class="ident" id="7913711">i</span><span class="op" id="7913712">+</span><span class="num" id="7913713">1</span><span class="op" id="7913714">,</span>&nbsp;<span class="ident" id="7913716">resp</span><span class="op" id="7913720">.</span><span class="ident" id="7913721">Result</span><span class="op" id="7913727">.</span><span class="ident" id="7913728">C</span><span class="op" id="7913729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7913733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7913736">}</span><br>
<span class="lineno"></span><span class="op" id="7913738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7913741">func</span>&nbsp;<span class="ident" id="7913746">TestClient</span><span class="op" id="7913756">(</span><span class="ident" id="7913757">t</span>&nbsp;<span class="op" id="7913759">*</span><span class="ident" id="7913760">testing</span><span class="op" id="7913767">.</span><span class="ident" id="7913768">T</span><span class="op" id="7913769">)</span>&nbsp;<span class="op" id="7913771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7913774">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7913823">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913855">cli</span><span class="op" id="7913858">,</span>&nbsp;<span class="ident" id="7913860">srv</span>&nbsp;<span class="op" id="7913864">:=</span>&nbsp;<span class="ident" id="7913867">net</span><span class="op" id="7913870">.</span><span class="ident" id="7913871">Pipe</span><span class="op" id="7913875">(</span><span class="op" id="7913876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913879">go</span>&nbsp;<span class="ident" id="7913882">ServeConn</span><span class="op" id="7913891">(</span><span class="ident" id="7913892">srv</span><span class="op" id="7913895">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913899">client</span>&nbsp;<span class="op" id="7913906">:=</span>&nbsp;<span class="ident" id="7913909">NewClient</span><span class="op" id="7913918">(</span><span class="ident" id="7913919">cli</span><span class="op" id="7913922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7913925">defer</span>&nbsp;<span class="ident" id="7913931">client</span><span class="op" id="7913937">.</span><span class="ident" id="7913938">Close</span><span class="op" id="7913943">(</span><span class="op" id="7913944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7913948">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913970">args</span>&nbsp;<span class="op" id="7913975">:=</span>&nbsp;<span class="op" id="7913978">&amp;</span><span class="ident" id="7913979">Args</span><span class="op" id="7913983">{</span><span class="num" id="7913984">7</span><span class="op" id="7913985">,</span>&nbsp;<span class="num" id="7913987">8</span><span class="op" id="7913988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913991">reply</span>&nbsp;<span class="op" id="7913997">:=</span>&nbsp;<span class="builtinfunc" id="7914000">new</span><span class="op" id="7914003">(</span><span class="ident" id="7914004">Reply</span><span class="op" id="7914009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914012">err</span>&nbsp;<span class="op" id="7914016">:=</span>&nbsp;<span class="ident" id="7914019">client</span><span class="op" id="7914025">.</span><span class="ident" id="7914026">Call</span><span class="op" id="7914030">(</span><span class="string" id="7914031">&#34;Arith.Add&#34;</span><span class="op" id="7914042">,</span>&nbsp;<span class="ident" id="7914044">args</span><span class="op" id="7914048">,</span>&nbsp;<span class="ident" id="7914050">reply</span><span class="op" id="7914055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914058">if</span>&nbsp;<span class="ident" id="7914061">err</span>&nbsp;<span class="op" id="7914065">!=</span>&nbsp;<span class="builtintype" id="7914068">nil</span>&nbsp;<span class="op" id="7914072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914076">t</span><span class="op" id="7914077">.</span><span class="ident" id="7914078">Errorf</span><span class="op" id="7914084">(</span><span class="string" id="7914085">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7914127">,</span>&nbsp;<span class="ident" id="7914129">err</span><span class="op" id="7914132">.</span><span class="ident" id="7914133">Error</span><span class="op" id="7914138">(</span><span class="op" id="7914139">)</span><span class="op" id="7914140">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914146">if</span>&nbsp;<span class="ident" id="7914149">reply</span><span class="op" id="7914154">.</span><span class="ident" id="7914155">C</span>&nbsp;<span class="op" id="7914157">!=</span>&nbsp;<span class="ident" id="7914160">args</span><span class="op" id="7914164">.</span><span class="ident" id="7914165">A</span><span class="op" id="7914166">+</span><span class="ident" id="7914167">args</span><span class="op" id="7914171">.</span><span class="ident" id="7914172">B</span>&nbsp;<span class="op" id="7914174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914178">t</span><span class="op" id="7914179">.</span><span class="ident" id="7914180">Errorf</span><span class="op" id="7914186">(</span><span class="string" id="7914187">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7914212">,</span>&nbsp;<span class="ident" id="7914214">reply</span><span class="op" id="7914219">.</span><span class="ident" id="7914220">C</span><span class="op" id="7914221">,</span>&nbsp;<span class="ident" id="7914223">args</span><span class="op" id="7914227">.</span><span class="ident" id="7914228">A</span><span class="op" id="7914229">+</span><span class="ident" id="7914230">args</span><span class="op" id="7914234">.</span><span class="ident" id="7914235">B</span><span class="op" id="7914236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914243">args</span>&nbsp;<span class="op" id="7914248">=</span>&nbsp;<span class="op" id="7914250">&amp;</span><span class="ident" id="7914251">Args</span><span class="op" id="7914255">{</span><span class="num" id="7914256">7</span><span class="op" id="7914257">,</span>&nbsp;<span class="num" id="7914259">8</span><span class="op" id="7914260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914263">reply</span>&nbsp;<span class="op" id="7914269">=</span>&nbsp;<span class="builtinfunc" id="7914271">new</span><span class="op" id="7914274">(</span><span class="ident" id="7914275">Reply</span><span class="op" id="7914280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914283">err</span>&nbsp;<span class="op" id="7914287">=</span>&nbsp;<span class="ident" id="7914289">client</span><span class="op" id="7914295">.</span><span class="ident" id="7914296">Call</span><span class="op" id="7914300">(</span><span class="string" id="7914301">&#34;Arith.Mul&#34;</span><span class="op" id="7914312">,</span>&nbsp;<span class="ident" id="7914314">args</span><span class="op" id="7914318">,</span>&nbsp;<span class="ident" id="7914320">reply</span><span class="op" id="7914325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914328">if</span>&nbsp;<span class="ident" id="7914331">err</span>&nbsp;<span class="op" id="7914335">!=</span>&nbsp;<span class="builtintype" id="7914338">nil</span>&nbsp;<span class="op" id="7914342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914346">t</span><span class="op" id="7914347">.</span><span class="ident" id="7914348">Errorf</span><span class="op" id="7914354">(</span><span class="string" id="7914355">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7914397">,</span>&nbsp;<span class="ident" id="7914399">err</span><span class="op" id="7914402">.</span><span class="ident" id="7914403">Error</span><span class="op" id="7914408">(</span><span class="op" id="7914409">)</span><span class="op" id="7914410">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914416">if</span>&nbsp;<span class="ident" id="7914419">reply</span><span class="op" id="7914424">.</span><span class="ident" id="7914425">C</span>&nbsp;<span class="op" id="7914427">!=</span>&nbsp;<span class="ident" id="7914430">args</span><span class="op" id="7914434">.</span><span class="ident" id="7914435">A</span><span class="op" id="7914436">*</span><span class="ident" id="7914437">args</span><span class="op" id="7914441">.</span><span class="ident" id="7914442">B</span>&nbsp;<span class="op" id="7914444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914448">t</span><span class="op" id="7914449">.</span><span class="ident" id="7914450">Errorf</span><span class="op" id="7914456">(</span><span class="string" id="7914457">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7914482">,</span>&nbsp;<span class="ident" id="7914484">reply</span><span class="op" id="7914489">.</span><span class="ident" id="7914490">C</span><span class="op" id="7914491">,</span>&nbsp;<span class="ident" id="7914493">args</span><span class="op" id="7914497">.</span><span class="ident" id="7914498">A</span><span class="op" id="7914499">*</span><span class="ident" id="7914500">args</span><span class="op" id="7914504">.</span><span class="ident" id="7914505">B</span><span class="op" id="7914506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7914513">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914531">args</span>&nbsp;<span class="op" id="7914536">=</span>&nbsp;<span class="op" id="7914538">&amp;</span><span class="ident" id="7914539">Args</span><span class="op" id="7914543">{</span><span class="num" id="7914544">7</span><span class="op" id="7914545">,</span>&nbsp;<span class="num" id="7914547">8</span><span class="op" id="7914548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914551">mulReply</span>&nbsp;<span class="op" id="7914560">:=</span>&nbsp;<span class="builtinfunc" id="7914563">new</span><span class="op" id="7914566">(</span><span class="ident" id="7914567">Reply</span><span class="op" id="7914572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914575">mulCall</span>&nbsp;<span class="op" id="7914583">:=</span>&nbsp;<span class="ident" id="7914586">client</span><span class="op" id="7914592">.</span><span class="ident" id="7914593">Go</span><span class="op" id="7914595">(</span><span class="string" id="7914596">&#34;Arith.Mul&#34;</span><span class="op" id="7914607">,</span>&nbsp;<span class="ident" id="7914609">args</span><span class="op" id="7914613">,</span>&nbsp;<span class="ident" id="7914615">mulReply</span><span class="op" id="7914623">,</span>&nbsp;<span class="builtintype" id="7914625">nil</span><span class="op" id="7914628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914631">addReply</span>&nbsp;<span class="op" id="7914640">:=</span>&nbsp;<span class="builtinfunc" id="7914643">new</span><span class="op" id="7914646">(</span><span class="ident" id="7914647">Reply</span><span class="op" id="7914652">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914655">addCall</span>&nbsp;<span class="op" id="7914663">:=</span>&nbsp;<span class="ident" id="7914666">client</span><span class="op" id="7914672">.</span><span class="ident" id="7914673">Go</span><span class="op" id="7914675">(</span><span class="string" id="7914676">&#34;Arith.Add&#34;</span><span class="op" id="7914687">,</span>&nbsp;<span class="ident" id="7914689">args</span><span class="op" id="7914693">,</span>&nbsp;<span class="ident" id="7914695">addReply</span><span class="op" id="7914703">,</span>&nbsp;<span class="builtintype" id="7914705">nil</span><span class="op" id="7914708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914712">addCall</span>&nbsp;<span class="op" id="7914720">=</span>&nbsp;<span class="op" id="7914722">&lt;-</span><span class="ident" id="7914724">addCall</span><span class="op" id="7914731">.</span><span class="ident" id="7914732">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914738">if</span>&nbsp;<span class="ident" id="7914741">addCall</span><span class="op" id="7914748">.</span><span class="ident" id="7914749">Error</span>&nbsp;<span class="op" id="7914755">!=</span>&nbsp;<span class="builtintype" id="7914758">nil</span>&nbsp;<span class="op" id="7914762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914766">t</span><span class="op" id="7914767">.</span><span class="ident" id="7914768">Errorf</span><span class="op" id="7914774">(</span><span class="string" id="7914775">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7914817">,</span>&nbsp;<span class="ident" id="7914819">addCall</span><span class="op" id="7914826">.</span><span class="ident" id="7914827">Error</span><span class="op" id="7914832">.</span><span class="ident" id="7914833">Error</span><span class="op" id="7914838">(</span><span class="op" id="7914839">)</span><span class="op" id="7914840">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914846">if</span>&nbsp;<span class="ident" id="7914849">addReply</span><span class="op" id="7914857">.</span><span class="ident" id="7914858">C</span>&nbsp;<span class="op" id="7914860">!=</span>&nbsp;<span class="ident" id="7914863">args</span><span class="op" id="7914867">.</span><span class="ident" id="7914868">A</span><span class="op" id="7914869">+</span><span class="ident" id="7914870">args</span><span class="op" id="7914874">.</span><span class="ident" id="7914875">B</span>&nbsp;<span class="op" id="7914877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914881">t</span><span class="op" id="7914882">.</span><span class="ident" id="7914883">Errorf</span><span class="op" id="7914889">(</span><span class="string" id="7914890">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7914915">,</span>&nbsp;<span class="ident" id="7914917">addReply</span><span class="op" id="7914925">.</span><span class="ident" id="7914926">C</span><span class="op" id="7914927">,</span>&nbsp;<span class="ident" id="7914929">args</span><span class="op" id="7914933">.</span><span class="ident" id="7914934">A</span><span class="op" id="7914935">+</span><span class="ident" id="7914936">args</span><span class="op" id="7914940">.</span><span class="ident" id="7914941">B</span><span class="op" id="7914942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914949">mulCall</span>&nbsp;<span class="op" id="7914957">=</span>&nbsp;<span class="op" id="7914959">&lt;-</span><span class="ident" id="7914961">mulCall</span><span class="op" id="7914968">.</span><span class="ident" id="7914969">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914975">if</span>&nbsp;<span class="ident" id="7914978">mulCall</span><span class="op" id="7914985">.</span><span class="ident" id="7914986">Error</span>&nbsp;<span class="op" id="7914992">!=</span>&nbsp;<span class="builtintype" id="7914995">nil</span>&nbsp;<span class="op" id="7914999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915003">t</span><span class="op" id="7915004">.</span><span class="ident" id="7915005">Errorf</span><span class="op" id="7915011">(</span><span class="string" id="7915012">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7915054">,</span>&nbsp;<span class="ident" id="7915056">mulCall</span><span class="op" id="7915063">.</span><span class="ident" id="7915064">Error</span><span class="op" id="7915069">.</span><span class="ident" id="7915070">Error</span><span class="op" id="7915075">(</span><span class="op" id="7915076">)</span><span class="op" id="7915077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915083">if</span>&nbsp;<span class="ident" id="7915086">mulReply</span><span class="op" id="7915094">.</span><span class="ident" id="7915095">C</span>&nbsp;<span class="op" id="7915097">!=</span>&nbsp;<span class="ident" id="7915100">args</span><span class="op" id="7915104">.</span><span class="ident" id="7915105">A</span><span class="op" id="7915106">*</span><span class="ident" id="7915107">args</span><span class="op" id="7915111">.</span><span class="ident" id="7915112">B</span>&nbsp;<span class="op" id="7915114">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915118">t</span><span class="op" id="7915119">.</span><span class="ident" id="7915120">Errorf</span><span class="op" id="7915126">(</span><span class="string" id="7915127">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7915152">,</span>&nbsp;<span class="ident" id="7915154">mulReply</span><span class="op" id="7915162">.</span><span class="ident" id="7915163">C</span><span class="op" id="7915164">,</span>&nbsp;<span class="ident" id="7915166">args</span><span class="op" id="7915170">.</span><span class="ident" id="7915171">A</span><span class="op" id="7915172">*</span><span class="ident" id="7915173">args</span><span class="op" id="7915177">.</span><span class="ident" id="7915178">B</span><span class="op" id="7915179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7915186">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915201">args</span>&nbsp;<span class="op" id="7915206">=</span>&nbsp;<span class="op" id="7915208">&amp;</span><span class="ident" id="7915209">Args</span><span class="op" id="7915213">{</span><span class="num" id="7915214">7</span><span class="op" id="7915215">,</span>&nbsp;<span class="num" id="7915217">0</span><span class="op" id="7915218">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915221">reply</span>&nbsp;<span class="op" id="7915227">=</span>&nbsp;<span class="builtinfunc" id="7915229">new</span><span class="op" id="7915232">(</span><span class="ident" id="7915233">Reply</span><span class="op" id="7915238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915241">err</span>&nbsp;<span class="op" id="7915245">=</span>&nbsp;<span class="ident" id="7915247">client</span><span class="op" id="7915253">.</span><span class="ident" id="7915254">Call</span><span class="op" id="7915258">(</span><span class="string" id="7915259">&#34;Arith.Div&#34;</span><span class="op" id="7915270">,</span>&nbsp;<span class="ident" id="7915272">args</span><span class="op" id="7915276">,</span>&nbsp;<span class="ident" id="7915278">reply</span><span class="op" id="7915283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7915286">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915319">if</span>&nbsp;<span class="ident" id="7915322">err</span>&nbsp;<span class="op" id="7915326">==</span>&nbsp;<span class="builtintype" id="7915329">nil</span>&nbsp;<span class="op" id="7915333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915337">t</span><span class="op" id="7915338">.</span><span class="ident" id="7915339">Error</span><span class="op" id="7915344">(</span><span class="string" id="7915345">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7915366">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915369">}</span>&nbsp;<span class="keyword" id="7915371">else</span>&nbsp;<span class="keyword" id="7915376">if</span>&nbsp;<span class="ident" id="7915379">err</span><span class="op" id="7915382">.</span><span class="ident" id="7915383">Error</span><span class="op" id="7915388">(</span><span class="op" id="7915389">)</span>&nbsp;<span class="op" id="7915391">!=</span>&nbsp;<span class="string" id="7915394">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7915411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915415">t</span><span class="op" id="7915416">.</span><span class="ident" id="7915417">Error</span><span class="op" id="7915422">(</span><span class="string" id="7915423">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7915464">,</span>&nbsp;<span class="ident" id="7915466">err</span><span class="op" id="7915469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915472">}</span><br>
<span class="lineno"></span><span class="op" id="7915474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="7915477">func</span>&nbsp;<span class="ident" id="7915482">TestMalformedInput</span><span class="op" id="7915500">(</span><span class="ident" id="7915501">t</span>&nbsp;<span class="op" id="7915503">*</span><span class="ident" id="7915504">testing</span><span class="op" id="7915511">.</span><span class="ident" id="7915512">T</span><span class="op" id="7915513">)</span>&nbsp;<span class="op" id="7915515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915518">cli</span><span class="op" id="7915521">,</span>&nbsp;<span class="ident" id="7915523">srv</span>&nbsp;<span class="op" id="7915527">:=</span>&nbsp;<span class="ident" id="7915530">net</span><span class="op" id="7915533">.</span><span class="ident" id="7915534">Pipe</span><span class="op" id="7915538">(</span><span class="op" id="7915539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915542">go</span>&nbsp;<span class="ident" id="7915545">cli</span><span class="op" id="7915548">.</span><span class="ident" id="7915549">Write</span><span class="op" id="7915554">(</span><span class="op" id="7915555">[</span><span class="op" id="7915556">]</span><span class="builtintype" id="7915557">byte</span><span class="op" id="7915561">(</span><span class="string" id="7915562">`{id:1}`</span><span class="op" id="7915570">)</span><span class="op" id="7915571">)</span>&nbsp;<span class="comment" id="7915573">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915590">ServeConn</span><span class="op" id="7915599">(</span><span class="ident" id="7915600">srv</span><span class="op" id="7915603">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7915621">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7915646">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7915649">func</span>&nbsp;<span class="ident" id="7915654">TestMalformedOutput</span><span class="op" id="7915673">(</span><span class="ident" id="7915674">t</span>&nbsp;<span class="op" id="7915676">*</span><span class="ident" id="7915677">testing</span><span class="op" id="7915684">.</span><span class="ident" id="7915685">T</span><span class="op" id="7915686">)</span>&nbsp;<span class="op" id="7915688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915691">cli</span><span class="op" id="7915694">,</span>&nbsp;<span class="ident" id="7915696">srv</span>&nbsp;<span class="op" id="7915700">:=</span>&nbsp;<span class="ident" id="7915703">net</span><span class="op" id="7915706">.</span><span class="ident" id="7915707">Pipe</span><span class="op" id="7915711">(</span><span class="op" id="7915712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915715">go</span>&nbsp;<span class="ident" id="7915718">srv</span><span class="op" id="7915721">.</span><span class="ident" id="7915722">Write</span><span class="op" id="7915727">(</span><span class="op" id="7915728">[</span><span class="op" id="7915729">]</span><span class="builtintype" id="7915730">byte</span><span class="op" id="7915734">(</span><span class="string" id="7915735">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="7915772">)</span><span class="op" id="7915773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915776">go</span>&nbsp;<span class="ident" id="7915779">ioutil</span><span class="op" id="7915785">.</span><span class="ident" id="7915786">ReadAll</span><span class="op" id="7915793">(</span><span class="ident" id="7915794">srv</span><span class="op" id="7915797">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915801">client</span>&nbsp;<span class="op" id="7915808">:=</span>&nbsp;<span class="ident" id="7915811">NewClient</span><span class="op" id="7915820">(</span><span class="ident" id="7915821">cli</span><span class="op" id="7915824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915827">defer</span>&nbsp;<span class="ident" id="7915833">client</span><span class="op" id="7915839">.</span><span class="ident" id="7915840">Close</span><span class="op" id="7915845">(</span><span class="op" id="7915846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915850">args</span>&nbsp;<span class="op" id="7915855">:=</span>&nbsp;<span class="op" id="7915858">&amp;</span><span class="ident" id="7915859">Args</span><span class="op" id="7915863">{</span><span class="num" id="7915864">7</span><span class="op" id="7915865">,</span>&nbsp;<span class="num" id="7915867">8</span><span class="op" id="7915868">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915871">reply</span>&nbsp;<span class="op" id="7915877">:=</span>&nbsp;<span class="builtinfunc" id="7915880">new</span><span class="op" id="7915883">(</span><span class="ident" id="7915884">Reply</span><span class="op" id="7915889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915892">err</span>&nbsp;<span class="op" id="7915896">:=</span>&nbsp;<span class="ident" id="7915899">client</span><span class="op" id="7915905">.</span><span class="ident" id="7915906">Call</span><span class="op" id="7915910">(</span><span class="string" id="7915911">&#34;Arith.Add&#34;</span><span class="op" id="7915922">,</span>&nbsp;<span class="ident" id="7915924">args</span><span class="op" id="7915928">,</span>&nbsp;<span class="ident" id="7915930">reply</span><span class="op" id="7915935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915938">if</span>&nbsp;<span class="ident" id="7915941">err</span>&nbsp;<span class="op" id="7915945">==</span>&nbsp;<span class="builtintype" id="7915948">nil</span>&nbsp;<span class="op" id="7915952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915956">t</span><span class="op" id="7915957">.</span><span class="ident" id="7915958">Error</span><span class="op" id="7915963">(</span><span class="string" id="7915964">&#34;expected&nbsp;error&#34;</span><span class="op" id="7915980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915983">}</span><br>
<span class="lineno">205</span><span class="op" id="7915985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7915988">func</span>&nbsp;<span class="ident" id="7915993">TestServerErrorHasNullResult</span><span class="op" id="7916021">(</span><span class="ident" id="7916022">t</span>&nbsp;<span class="op" id="7916024">*</span><span class="ident" id="7916025">testing</span><span class="op" id="7916032">.</span><span class="ident" id="7916033">T</span><span class="op" id="7916034">)</span>&nbsp;<span class="op" id="7916036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916039">var</span>&nbsp;<span class="ident" id="7916043">out</span>&nbsp;<span class="ident" id="7916047">bytes</span><span class="op" id="7916052">.</span><span class="ident" id="7916053">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916061">sc</span>&nbsp;<span class="op" id="7916064">:=</span>&nbsp;<span class="ident" id="7916067">NewServerCodec</span><span class="op" id="7916081">(</span><span class="keyword" id="7916082">struct</span>&nbsp;<span class="op" id="7916089">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916093">io</span><span class="op" id="7916095">.</span><span class="ident" id="7916096">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916105">io</span><span class="op" id="7916107">.</span><span class="ident" id="7916108">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916117">io</span><span class="op" id="7916119">.</span><span class="ident" id="7916120">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916128">}</span><span class="op" id="7916129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916133">Reader</span><span class="op" id="7916139">:</span>&nbsp;<span class="ident" id="7916141">strings</span><span class="op" id="7916148">.</span><span class="ident" id="7916149">NewReader</span><span class="op" id="7916158">(</span><span class="string" id="7916159">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="7916211">)</span><span class="op" id="7916212">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916216">Writer</span><span class="op" id="7916222">:</span>&nbsp;<span class="op" id="7916224">&amp;</span><span class="ident" id="7916225">out</span><span class="op" id="7916228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916232">Closer</span><span class="op" id="7916238">:</span>&nbsp;<span class="ident" id="7916240">ioutil</span><span class="op" id="7916246">.</span><span class="ident" id="7916247">NopCloser</span><span class="op" id="7916256">(</span><span class="builtintype" id="7916257">nil</span><span class="op" id="7916260">)</span><span class="op" id="7916261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916264">}</span><span class="op" id="7916265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916268">r</span>&nbsp;<span class="op" id="7916270">:=</span>&nbsp;<span class="builtinfunc" id="7916273">new</span><span class="op" id="7916276">(</span><span class="ident" id="7916277">rpc</span><span class="op" id="7916280">.</span><span class="ident" id="7916281">Request</span><span class="op" id="7916288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916291">if</span>&nbsp;<span class="ident" id="7916294">err</span>&nbsp;<span class="op" id="7916298">:=</span>&nbsp;<span class="ident" id="7916301">sc</span><span class="op" id="7916303">.</span><span class="ident" id="7916304">ReadRequestHeader</span><span class="op" id="7916321">(</span><span class="ident" id="7916322">r</span><span class="op" id="7916323">)</span><span class="op" id="7916324">;</span>&nbsp;<span class="ident" id="7916326">err</span>&nbsp;<span class="op" id="7916330">!=</span>&nbsp;<span class="builtintype" id="7916333">nil</span>&nbsp;<span class="op" id="7916337">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916341">t</span><span class="op" id="7916342">.</span><span class="ident" id="7916343">Fatal</span><span class="op" id="7916348">(</span><span class="ident" id="7916349">err</span><span class="op" id="7916352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916358">const</span>&nbsp;<span class="ident" id="7916364">valueText</span>&nbsp;<span class="op" id="7916374">=</span>&nbsp;<span class="string" id="7916376">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916410">const</span>&nbsp;<span class="ident" id="7916416">errorText</span>&nbsp;<span class="op" id="7916426">=</span>&nbsp;<span class="string" id="7916428">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916442">err</span>&nbsp;<span class="op" id="7916446">:=</span>&nbsp;<span class="ident" id="7916449">sc</span><span class="op" id="7916451">.</span><span class="ident" id="7916452">WriteResponse</span><span class="op" id="7916465">(</span><span class="op" id="7916466">&amp;</span><span class="ident" id="7916467">rpc</span><span class="op" id="7916470">.</span><span class="ident" id="7916471">Response</span><span class="op" id="7916479">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916483">ServiceMethod</span><span class="op" id="7916496">:</span>&nbsp;<span class="string" id="7916498">&#34;Method&#34;</span><span class="op" id="7916506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916510">Seq</span><span class="op" id="7916513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7916525">1</span><span class="op" id="7916526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916530">Error</span><span class="op" id="7916535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916545">errorText</span><span class="op" id="7916554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916557">}</span><span class="op" id="7916558">,</span>&nbsp;<span class="ident" id="7916560">valueText</span><span class="op" id="7916569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916572">if</span>&nbsp;<span class="ident" id="7916575">err</span>&nbsp;<span class="op" id="7916579">!=</span>&nbsp;<span class="builtintype" id="7916582">nil</span>&nbsp;<span class="op" id="7916586">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916590">t</span><span class="op" id="7916591">.</span><span class="ident" id="7916592">Fatal</span><span class="op" id="7916597">(</span><span class="ident" id="7916598">err</span><span class="op" id="7916601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916607">if</span>&nbsp;<span class="op" id="7916610">!</span><span class="ident" id="7916611">strings</span><span class="op" id="7916618">.</span><span class="ident" id="7916619">Contains</span><span class="op" id="7916627">(</span><span class="ident" id="7916628">out</span><span class="op" id="7916631">.</span><span class="ident" id="7916632">String</span><span class="op" id="7916638">(</span><span class="op" id="7916639">)</span><span class="op" id="7916640">,</span>&nbsp;<span class="ident" id="7916642">errorText</span><span class="op" id="7916651">)</span>&nbsp;<span class="op" id="7916653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916657">t</span><span class="op" id="7916658">.</span><span class="ident" id="7916659">Fatalf</span><span class="op" id="7916665">(</span><span class="string" id="7916666">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="7916713">,</span>&nbsp;<span class="ident" id="7916715">errorText</span><span class="op" id="7916724">,</span>&nbsp;<span class="op" id="7916726">&amp;</span><span class="ident" id="7916727">out</span><span class="op" id="7916730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916733">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916736">if</span>&nbsp;<span class="ident" id="7916739">strings</span><span class="op" id="7916746">.</span><span class="ident" id="7916747">Contains</span><span class="op" id="7916755">(</span><span class="ident" id="7916756">out</span><span class="op" id="7916759">.</span><span class="ident" id="7916760">String</span><span class="op" id="7916766">(</span><span class="op" id="7916767">)</span><span class="op" id="7916768">,</span>&nbsp;<span class="ident" id="7916770">valueText</span><span class="op" id="7916779">)</span>&nbsp;<span class="op" id="7916781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916785">t</span><span class="op" id="7916786">.</span><span class="ident" id="7916787">Errorf</span><span class="op" id="7916793">(</span><span class="string" id="7916794">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="7916841">,</span>&nbsp;<span class="op" id="7916843">&amp;</span><span class="ident" id="7916844">out</span><span class="op" id="7916847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916850">}</span><br>
<span class="lineno"></span><span class="op" id="7916852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7916855">func</span>&nbsp;<span class="ident" id="7916860">TestUnexpectedError</span><span class="op" id="7916879">(</span><span class="ident" id="7916880">t</span>&nbsp;<span class="op" id="7916882">*</span><span class="ident" id="7916883">testing</span><span class="op" id="7916890">.</span><span class="ident" id="7916891">T</span><span class="op" id="7916892">)</span>&nbsp;<span class="op" id="7916894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916897">cli</span><span class="op" id="7916900">,</span>&nbsp;<span class="ident" id="7916902">srv</span>&nbsp;<span class="op" id="7916906">:=</span>&nbsp;<span class="ident" id="7916909">myPipe</span><span class="op" id="7916915">(</span><span class="op" id="7916916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916919">go</span>&nbsp;<span class="ident" id="7916922">cli</span><span class="op" id="7916925">.</span><span class="ident" id="7916926">PipeWriter</span><span class="op" id="7916936">.</span><span class="ident" id="7916937">CloseWithError</span><span class="op" id="7916951">(</span><span class="ident" id="7916952">errors</span><span class="op" id="7916958">.</span><span class="ident" id="7916959">New</span><span class="op" id="7916962">(</span><span class="string" id="7916963">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="7916982">)</span><span class="op" id="7916983">)</span>&nbsp;<span class="comment" id="7916985">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917016">ServeConn</span><span class="op" id="7917025">(</span><span class="ident" id="7917026">srv</span><span class="op" id="7917029">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7917082">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7917107">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7917110">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="7917138">func</span>&nbsp;<span class="ident" id="7917143">myPipe</span><span class="op" id="7917149">(</span><span class="op" id="7917150">)</span>&nbsp;<span class="op" id="7917152">(</span><span class="op" id="7917153">*</span><span class="ident" id="7917154">pipe</span><span class="op" id="7917158">,</span>&nbsp;<span class="op" id="7917160">*</span><span class="ident" id="7917161">pipe</span><span class="op" id="7917165">)</span>&nbsp;<span class="op" id="7917167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917170">r1</span><span class="op" id="7917172">,</span>&nbsp;<span class="ident" id="7917174">w1</span>&nbsp;<span class="op" id="7917177">:=</span>&nbsp;<span class="ident" id="7917180">io</span><span class="op" id="7917182">.</span><span class="ident" id="7917183">Pipe</span><span class="op" id="7917187">(</span><span class="op" id="7917188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917191">r2</span><span class="op" id="7917193">,</span>&nbsp;<span class="ident" id="7917195">w2</span>&nbsp;<span class="op" id="7917198">:=</span>&nbsp;<span class="ident" id="7917201">io</span><span class="op" id="7917203">.</span><span class="ident" id="7917204">Pipe</span><span class="op" id="7917208">(</span><span class="op" id="7917209">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917213">return</span>&nbsp;<span class="op" id="7917220">&amp;</span><span class="ident" id="7917221">pipe</span><span class="op" id="7917225">{</span><span class="ident" id="7917226">r1</span><span class="op" id="7917228">,</span>&nbsp;<span class="ident" id="7917230">w2</span><span class="op" id="7917232">}</span><span class="op" id="7917233">,</span>&nbsp;<span class="op" id="7917235">&amp;</span><span class="ident" id="7917236">pipe</span><span class="op" id="7917240">{</span><span class="ident" id="7917241">r2</span><span class="op" id="7917243">,</span>&nbsp;<span class="ident" id="7917245">w1</span><span class="op" id="7917247">}</span><br>
<span class="lineno"></span><span class="op" id="7917249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917252">type</span>&nbsp;<span class="ident" id="7917257">pipe</span>&nbsp;<span class="keyword" id="7917262">struct</span>&nbsp;<span class="op" id="7917269">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917272">*</span><span class="ident" id="7917273">io</span><span class="op" id="7917275">.</span><span class="ident" id="7917276">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917288">*</span><span class="ident" id="7917289">io</span><span class="op" id="7917291">.</span><span class="ident" id="7917292">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="7917303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917306">type</span>&nbsp;<span class="ident" id="7917311">pipeAddr</span>&nbsp;<span class="builtintype" id="7917320">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="7917325">func</span>&nbsp;<span class="op" id="7917330">(</span><span class="ident" id="7917331">pipeAddr</span><span class="op" id="7917339">)</span>&nbsp;<span class="ident" id="7917341">Network</span><span class="op" id="7917348">(</span><span class="op" id="7917349">)</span>&nbsp;<span class="builtintype" id="7917351">string</span>&nbsp;<span class="op" id="7917358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917361">return</span>&nbsp;<span class="string" id="7917368">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7917375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="7917378">func</span>&nbsp;<span class="op" id="7917383">(</span><span class="ident" id="7917384">pipeAddr</span><span class="op" id="7917392">)</span>&nbsp;<span class="ident" id="7917394">String</span><span class="op" id="7917400">(</span><span class="op" id="7917401">)</span>&nbsp;<span class="builtintype" id="7917403">string</span>&nbsp;<span class="op" id="7917410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917413">return</span>&nbsp;<span class="string" id="7917420">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7917427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917430">func</span>&nbsp;<span class="op" id="7917435">(</span><span class="ident" id="7917436">p</span>&nbsp;<span class="op" id="7917438">*</span><span class="ident" id="7917439">pipe</span><span class="op" id="7917443">)</span>&nbsp;<span class="ident" id="7917445">Close</span><span class="op" id="7917450">(</span><span class="op" id="7917451">)</span>&nbsp;<span class="builtintype" id="7917453">error</span>&nbsp;<span class="op" id="7917459">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917462">err</span>&nbsp;<span class="op" id="7917466">:=</span>&nbsp;<span class="ident" id="7917469">p</span><span class="op" id="7917470">.</span><span class="ident" id="7917471">PipeReader</span><span class="op" id="7917481">.</span><span class="ident" id="7917482">Close</span><span class="op" id="7917487">(</span><span class="op" id="7917488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917491">err1</span>&nbsp;<span class="op" id="7917496">:=</span>&nbsp;<span class="ident" id="7917499">p</span><span class="op" id="7917500">.</span><span class="ident" id="7917501">PipeWriter</span><span class="op" id="7917511">.</span><span class="ident" id="7917512">Close</span><span class="op" id="7917517">(</span><span class="op" id="7917518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917521">if</span>&nbsp;<span class="ident" id="7917524">err</span>&nbsp;<span class="op" id="7917528">==</span>&nbsp;<span class="builtintype" id="7917531">nil</span>&nbsp;<span class="op" id="7917535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917539">err</span>&nbsp;<span class="op" id="7917543">=</span>&nbsp;<span class="ident" id="7917545">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917551">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917554">return</span>&nbsp;<span class="ident" id="7917561">err</span><br>
<span class="lineno"></span><span class="op" id="7917565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917568">func</span>&nbsp;<span class="op" id="7917573">(</span><span class="ident" id="7917574">p</span>&nbsp;<span class="op" id="7917576">*</span><span class="ident" id="7917577">pipe</span><span class="op" id="7917581">)</span>&nbsp;<span class="ident" id="7917583">LocalAddr</span><span class="op" id="7917592">(</span><span class="op" id="7917593">)</span>&nbsp;<span class="ident" id="7917595">net</span><span class="op" id="7917598">.</span><span class="ident" id="7917599">Addr</span>&nbsp;<span class="op" id="7917604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917607">return</span>&nbsp;<span class="ident" id="7917614">pipeAddr</span><span class="op" id="7917622">(</span><span class="num" id="7917623">0</span><span class="op" id="7917624">)</span><br>
<span class="lineno">280</span><span class="op" id="7917626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917629">func</span>&nbsp;<span class="op" id="7917634">(</span><span class="ident" id="7917635">p</span>&nbsp;<span class="op" id="7917637">*</span><span class="ident" id="7917638">pipe</span><span class="op" id="7917642">)</span>&nbsp;<span class="ident" id="7917644">RemoteAddr</span><span class="op" id="7917654">(</span><span class="op" id="7917655">)</span>&nbsp;<span class="ident" id="7917657">net</span><span class="op" id="7917660">.</span><span class="ident" id="7917661">Addr</span>&nbsp;<span class="op" id="7917666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917669">return</span>&nbsp;<span class="ident" id="7917676">pipeAddr</span><span class="op" id="7917684">(</span><span class="num" id="7917685">0</span><span class="op" id="7917686">)</span><br>
<span class="lineno"></span><span class="op" id="7917688">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="7917691">func</span>&nbsp;<span class="op" id="7917696">(</span><span class="ident" id="7917697">p</span>&nbsp;<span class="op" id="7917699">*</span><span class="ident" id="7917700">pipe</span><span class="op" id="7917704">)</span>&nbsp;<span class="ident" id="7917706">SetTimeout</span><span class="op" id="7917716">(</span><span class="ident" id="7917717">nsec</span>&nbsp;<span class="ident" id="7917722">int64</span><span class="op" id="7917727">)</span>&nbsp;<span class="builtintype" id="7917729">error</span>&nbsp;<span class="op" id="7917735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917738">return</span>&nbsp;<span class="ident" id="7917745">errors</span><span class="op" id="7917751">.</span><span class="ident" id="7917752">New</span><span class="op" id="7917755">(</span><span class="string" id="7917756">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7917792">)</span><br>
<span class="lineno"></span><span class="op" id="7917794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="7917797">func</span>&nbsp;<span class="op" id="7917802">(</span><span class="ident" id="7917803">p</span>&nbsp;<span class="op" id="7917805">*</span><span class="ident" id="7917806">pipe</span><span class="op" id="7917810">)</span>&nbsp;<span class="ident" id="7917812">SetReadTimeout</span><span class="op" id="7917826">(</span><span class="ident" id="7917827">nsec</span>&nbsp;<span class="ident" id="7917832">int64</span><span class="op" id="7917837">)</span>&nbsp;<span class="builtintype" id="7917839">error</span>&nbsp;<span class="op" id="7917845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917848">return</span>&nbsp;<span class="ident" id="7917855">errors</span><span class="op" id="7917861">.</span><span class="ident" id="7917862">New</span><span class="op" id="7917865">(</span><span class="string" id="7917866">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7917902">)</span><br>
<span class="lineno"></span><span class="op" id="7917904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917907">func</span>&nbsp;<span class="op" id="7917912">(</span><span class="ident" id="7917913">p</span>&nbsp;<span class="op" id="7917915">*</span><span class="ident" id="7917916">pipe</span><span class="op" id="7917920">)</span>&nbsp;<span class="ident" id="7917922">SetWriteTimeout</span><span class="op" id="7917937">(</span><span class="ident" id="7917938">nsec</span>&nbsp;<span class="ident" id="7917943">int64</span><span class="op" id="7917948">)</span>&nbsp;<span class="builtintype" id="7917950">error</span>&nbsp;<span class="op" id="7917956">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917959">return</span>&nbsp;<span class="ident" id="7917966">errors</span><span class="op" id="7917972">.</span><span class="ident" id="7917973">New</span><span class="op" id="7917976">(</span><span class="string" id="7917977">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7918013">)</span><br>
<span class="lineno"></span><span class="op" id="7918015">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
