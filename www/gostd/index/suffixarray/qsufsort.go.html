<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5634529">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5634584">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5634638">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5634689">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5634743">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5634791">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5634843">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5634894">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5634967">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5635039">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5635116">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5635190">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5635268">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5635343">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5635420">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5635481">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5635552">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5635629">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5635704">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5635783">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5635859">package</span>&nbsp;<span class="ident" id="5635867">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5635880">import</span>&nbsp;<span class="string" id="5635887">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5635895">func</span>&nbsp;<span class="ident" id="5635900">qsufsort</span><span class="op" id="5635908">(</span><span class="ident" id="5635909">data</span>&nbsp;<span class="op" id="5635914">[</span><span class="op" id="5635915">]</span><span class="builtintype" id="5635916">byte</span><span class="op" id="5635920">)</span>&nbsp;<span class="op" id="5635922">[</span><span class="op" id="5635923">]</span><span class="builtintype" id="5635924">int</span>&nbsp;<span class="op" id="5635928">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635931">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635975">sa</span>&nbsp;<span class="op" id="5635978">:=</span>&nbsp;<span class="ident" id="5635981">sortedByFirstByte</span><span class="op" id="5635998">(</span><span class="ident" id="5635999">data</span><span class="op" id="5636003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636006">if</span>&nbsp;<span class="builtinfunc" id="5636009">len</span><span class="op" id="5636012">(</span><span class="ident" id="5636013">sa</span><span class="op" id="5636015">)</span>&nbsp;<span class="op" id="5636017">&lt;</span>&nbsp;<span class="num" id="5636019">2</span>&nbsp;<span class="op" id="5636021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636025">return</span>&nbsp;<span class="ident" id="5636032">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636036">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636039">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636077">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636153">inv</span>&nbsp;<span class="op" id="5636157">:=</span>&nbsp;<span class="ident" id="5636160">initGroups</span><span class="op" id="5636170">(</span><span class="ident" id="5636171">sa</span><span class="op" id="5636173">,</span>&nbsp;<span class="ident" id="5636175">data</span><span class="op" id="5636179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636183">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636214">sufSortable</span>&nbsp;<span class="op" id="5636226">:=</span>&nbsp;<span class="op" id="5636229">&amp;</span><span class="ident" id="5636230">suffixSortable</span><span class="op" id="5636244">{</span><span class="ident" id="5636245">sa</span><span class="op" id="5636247">:</span>&nbsp;<span class="ident" id="5636249">sa</span><span class="op" id="5636251">,</span>&nbsp;<span class="ident" id="5636253">inv</span><span class="op" id="5636256">:</span>&nbsp;<span class="ident" id="5636258">inv</span><span class="op" id="5636261">,</span>&nbsp;<span class="ident" id="5636263">h</span><span class="op" id="5636264">:</span>&nbsp;<span class="num" id="5636266">1</span><span class="op" id="5636267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636271">for</span>&nbsp;<span class="ident" id="5636275">sa</span><span class="op" id="5636277">[</span><span class="num" id="5636278">0</span><span class="op" id="5636279">]</span>&nbsp;<span class="op" id="5636281">&gt;</span>&nbsp;<span class="op" id="5636283">-</span><span class="builtinfunc" id="5636284">len</span><span class="op" id="5636287">(</span><span class="ident" id="5636288">sa</span><span class="op" id="5636290">)</span>&nbsp;<span class="op" id="5636292">{</span>&nbsp;<span class="comment" id="5636294">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636343">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636398">pi</span>&nbsp;<span class="op" id="5636401">:=</span>&nbsp;<span class="num" id="5636404">0</span>&nbsp;<span class="comment" id="5636406">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636447">sl</span>&nbsp;<span class="op" id="5636450">:=</span>&nbsp;<span class="num" id="5636453">0</span>&nbsp;<span class="comment" id="5636455">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636498">for</span>&nbsp;<span class="ident" id="5636502">pi</span>&nbsp;<span class="op" id="5636505">&lt;</span>&nbsp;<span class="builtinfunc" id="5636507">len</span><span class="op" id="5636510">(</span><span class="ident" id="5636511">sa</span><span class="op" id="5636513">)</span>&nbsp;<span class="op" id="5636515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636520">if</span>&nbsp;<span class="ident" id="5636523">s</span>&nbsp;<span class="op" id="5636525">:=</span>&nbsp;<span class="ident" id="5636528">sa</span><span class="op" id="5636530">[</span><span class="ident" id="5636531">pi</span><span class="op" id="5636533">]</span><span class="op" id="5636534">;</span>&nbsp;<span class="ident" id="5636536">s</span>&nbsp;<span class="op" id="5636538">&lt;</span>&nbsp;<span class="num" id="5636540">0</span>&nbsp;<span class="op" id="5636542">{</span>&nbsp;<span class="comment" id="5636544">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636577">pi</span>&nbsp;<span class="op" id="5636580">-=</span>&nbsp;<span class="ident" id="5636583">s</span>&nbsp;<span class="comment" id="5636585">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636615">sl</span>&nbsp;<span class="op" id="5636618">+=</span>&nbsp;<span class="ident" id="5636621">s</span>&nbsp;<span class="comment" id="5636623">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636654">}</span>&nbsp;<span class="keyword" id="5636656">else</span>&nbsp;<span class="op" id="5636661">{</span>&nbsp;<span class="comment" id="5636663">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636698">if</span>&nbsp;<span class="ident" id="5636701">sl</span>&nbsp;<span class="op" id="5636704">!=</span>&nbsp;<span class="num" id="5636707">0</span>&nbsp;<span class="op" id="5636709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636716">sa</span><span class="op" id="5636718">[</span><span class="ident" id="5636719">pi</span><span class="op" id="5636721">+</span><span class="ident" id="5636722">sl</span><span class="op" id="5636724">]</span>&nbsp;<span class="op" id="5636726">=</span>&nbsp;<span class="ident" id="5636728">sl</span>&nbsp;<span class="comment" id="5636731">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636771">sl</span>&nbsp;<span class="op" id="5636774">=</span>&nbsp;<span class="num" id="5636776">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636782">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636788">pk</span>&nbsp;<span class="op" id="5636791">:=</span>&nbsp;<span class="ident" id="5636794">inv</span><span class="op" id="5636797">[</span><span class="ident" id="5636798">s</span><span class="op" id="5636799">]</span>&nbsp;<span class="op" id="5636801">+</span>&nbsp;<span class="num" id="5636803">1</span>&nbsp;<span class="comment" id="5636805">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636852">sufSortable</span><span class="op" id="5636863">.</span><span class="ident" id="5636864">sa</span>&nbsp;<span class="op" id="5636867">=</span>&nbsp;<span class="ident" id="5636869">sa</span><span class="op" id="5636871">[</span><span class="ident" id="5636872">pi</span><span class="op" id="5636874">:</span><span class="ident" id="5636875">pk</span><span class="op" id="5636877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636883">sort</span><span class="op" id="5636887">.</span><span class="ident" id="5636888">Sort</span><span class="op" id="5636892">(</span><span class="ident" id="5636893">sufSortable</span><span class="op" id="5636904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636910">sufSortable</span><span class="op" id="5636921">.</span><span class="ident" id="5636922">updateGroups</span><span class="op" id="5636934">(</span><span class="ident" id="5636935">pi</span><span class="op" id="5636937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636943">pi</span>&nbsp;<span class="op" id="5636946">=</span>&nbsp;<span class="ident" id="5636948">pk</span>&nbsp;<span class="comment" id="5636951">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636976">if</span>&nbsp;<span class="ident" id="5636979">sl</span>&nbsp;<span class="op" id="5636982">!=</span>&nbsp;<span class="num" id="5636985">0</span>&nbsp;<span class="op" id="5636987">{</span>&nbsp;<span class="comment" id="5636989">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637033">sa</span><span class="op" id="5637035">[</span><span class="ident" id="5637036">pi</span><span class="op" id="5637038">+</span><span class="ident" id="5637039">sl</span><span class="op" id="5637041">]</span>&nbsp;<span class="op" id="5637043">=</span>&nbsp;<span class="ident" id="5637045">sl</span>&nbsp;<span class="comment" id="5637048">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637088">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637093">sufSortable</span><span class="op" id="5637104">.</span><span class="ident" id="5637105">h</span>&nbsp;<span class="op" id="5637107">*=</span>&nbsp;<span class="num" id="5637110">2</span>&nbsp;<span class="comment" id="5637112">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637140">for</span>&nbsp;<span class="ident" id="5637144">i</span>&nbsp;<span class="op" id="5637146">:=</span>&nbsp;<span class="keyword" id="5637149">range</span>&nbsp;<span class="ident" id="5637155">sa</span>&nbsp;<span class="op" id="5637158">{</span>&nbsp;<span class="comment" id="5637160">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637203">sa</span><span class="op" id="5637205">[</span><span class="ident" id="5637206">inv</span><span class="op" id="5637209">[</span><span class="ident" id="5637210">i</span><span class="op" id="5637211">]</span><span class="op" id="5637212">]</span>&nbsp;<span class="op" id="5637214">=</span>&nbsp;<span class="ident" id="5637216">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637222">return</span>&nbsp;<span class="ident" id="5637229">sa</span><br>
<span class="lineno"></span><span class="op" id="5637232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5637235">func</span>&nbsp;<span class="ident" id="5637240">sortedByFirstByte</span><span class="op" id="5637257">(</span><span class="ident" id="5637258">data</span>&nbsp;<span class="op" id="5637263">[</span><span class="op" id="5637264">]</span><span class="builtintype" id="5637265">byte</span><span class="op" id="5637269">)</span>&nbsp;<span class="op" id="5637271">[</span><span class="op" id="5637272">]</span><span class="builtintype" id="5637273">int</span>&nbsp;<span class="op" id="5637277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637280">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637302">var</span>&nbsp;<span class="ident" id="5637306">count</span>&nbsp;<span class="op" id="5637312">[</span><span class="num" id="5637313">256</span><span class="op" id="5637316">]</span><span class="builtintype" id="5637317">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637322">for</span>&nbsp;<span class="ident" id="5637326">_</span><span class="op" id="5637327">,</span>&nbsp;<span class="ident" id="5637329">b</span>&nbsp;<span class="op" id="5637331">:=</span>&nbsp;<span class="keyword" id="5637334">range</span>&nbsp;<span class="ident" id="5637340">data</span>&nbsp;<span class="op" id="5637345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637349">count</span><span class="op" id="5637354">[</span><span class="ident" id="5637355">b</span><span class="op" id="5637356">]</span><span class="op" id="5637357">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637364">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637435">sum</span>&nbsp;<span class="op" id="5637439">:=</span>&nbsp;<span class="num" id="5637442">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637445">for</span>&nbsp;<span class="ident" id="5637449">b</span>&nbsp;<span class="op" id="5637451">:=</span>&nbsp;<span class="keyword" id="5637454">range</span>&nbsp;<span class="ident" id="5637460">count</span>&nbsp;<span class="op" id="5637466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637470">count</span><span class="op" id="5637475">[</span><span class="ident" id="5637476">b</span><span class="op" id="5637477">]</span><span class="op" id="5637478">,</span>&nbsp;<span class="ident" id="5637480">sum</span>&nbsp;<span class="op" id="5637484">=</span>&nbsp;<span class="ident" id="5637486">sum</span><span class="op" id="5637489">,</span>&nbsp;<span class="ident" id="5637491">count</span><span class="op" id="5637496">[</span><span class="ident" id="5637497">b</span><span class="op" id="5637498">]</span><span class="op" id="5637499">+</span><span class="ident" id="5637500">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637508">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637577">sa</span>&nbsp;<span class="op" id="5637580">:=</span>&nbsp;<span class="builtinfunc" id="5637583">make</span><span class="op" id="5637587">(</span><span class="op" id="5637588">[</span><span class="op" id="5637589">]</span><span class="builtintype" id="5637590">int</span><span class="op" id="5637593">,</span>&nbsp;<span class="builtinfunc" id="5637595">len</span><span class="op" id="5637598">(</span><span class="ident" id="5637599">data</span><span class="op" id="5637603">)</span><span class="op" id="5637604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637607">for</span>&nbsp;<span class="ident" id="5637611">i</span><span class="op" id="5637612">,</span>&nbsp;<span class="ident" id="5637614">b</span>&nbsp;<span class="op" id="5637616">:=</span>&nbsp;<span class="keyword" id="5637619">range</span>&nbsp;<span class="ident" id="5637625">data</span>&nbsp;<span class="op" id="5637630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637634">sa</span><span class="op" id="5637636">[</span><span class="ident" id="5637637">count</span><span class="op" id="5637642">[</span><span class="ident" id="5637643">b</span><span class="op" id="5637644">]</span><span class="op" id="5637645">]</span>&nbsp;<span class="op" id="5637647">=</span>&nbsp;<span class="ident" id="5637649">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637653">count</span><span class="op" id="5637658">[</span><span class="ident" id="5637659">b</span><span class="op" id="5637660">]</span><span class="op" id="5637661">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637668">return</span>&nbsp;<span class="ident" id="5637675">sa</span><br>
<span class="lineno"></span><span class="op" id="5637678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5637681">func</span>&nbsp;<span class="ident" id="5637686">initGroups</span><span class="op" id="5637696">(</span><span class="ident" id="5637697">sa</span>&nbsp;<span class="op" id="5637700">[</span><span class="op" id="5637701">]</span><span class="builtintype" id="5637702">int</span><span class="op" id="5637705">,</span>&nbsp;<span class="ident" id="5637707">data</span>&nbsp;<span class="op" id="5637712">[</span><span class="op" id="5637713">]</span><span class="builtintype" id="5637714">byte</span><span class="op" id="5637718">)</span>&nbsp;<span class="op" id="5637720">[</span><span class="op" id="5637721">]</span><span class="builtintype" id="5637722">int</span>&nbsp;<span class="op" id="5637726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637729">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637796">inv</span>&nbsp;<span class="op" id="5637800">:=</span>&nbsp;<span class="builtinfunc" id="5637803">make</span><span class="op" id="5637807">(</span><span class="op" id="5637808">[</span><span class="op" id="5637809">]</span><span class="builtintype" id="5637810">int</span><span class="op" id="5637813">,</span>&nbsp;<span class="builtinfunc" id="5637815">len</span><span class="op" id="5637818">(</span><span class="ident" id="5637819">data</span><span class="op" id="5637823">)</span><span class="op" id="5637824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637827">prevGroup</span>&nbsp;<span class="op" id="5637837">:=</span>&nbsp;<span class="builtinfunc" id="5637840">len</span><span class="op" id="5637843">(</span><span class="ident" id="5637844">sa</span><span class="op" id="5637846">)</span>&nbsp;<span class="op" id="5637848">-</span>&nbsp;<span class="num" id="5637850">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637853">groupByte</span>&nbsp;<span class="op" id="5637863">:=</span>&nbsp;<span class="ident" id="5637866">data</span><span class="op" id="5637870">[</span><span class="ident" id="5637871">sa</span><span class="op" id="5637873">[</span><span class="ident" id="5637874">prevGroup</span><span class="op" id="5637883">]</span><span class="op" id="5637884">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637887">for</span>&nbsp;<span class="ident" id="5637891">i</span>&nbsp;<span class="op" id="5637893">:=</span>&nbsp;<span class="builtinfunc" id="5637896">len</span><span class="op" id="5637899">(</span><span class="ident" id="5637900">sa</span><span class="op" id="5637902">)</span>&nbsp;<span class="op" id="5637904">-</span>&nbsp;<span class="num" id="5637906">1</span><span class="op" id="5637907">;</span>&nbsp;<span class="ident" id="5637909">i</span>&nbsp;<span class="op" id="5637911">&gt;=</span>&nbsp;<span class="num" id="5637914">0</span><span class="op" id="5637915">;</span>&nbsp;<span class="ident" id="5637917">i</span><span class="op" id="5637918">--</span>&nbsp;<span class="op" id="5637921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637925">if</span>&nbsp;<span class="ident" id="5637928">b</span>&nbsp;<span class="op" id="5637930">:=</span>&nbsp;<span class="ident" id="5637933">data</span><span class="op" id="5637937">[</span><span class="ident" id="5637938">sa</span><span class="op" id="5637940">[</span><span class="ident" id="5637941">i</span><span class="op" id="5637942">]</span><span class="op" id="5637943">]</span><span class="op" id="5637944">;</span>&nbsp;<span class="ident" id="5637946">b</span>&nbsp;<span class="op" id="5637948">&lt;</span>&nbsp;<span class="ident" id="5637950">groupByte</span>&nbsp;<span class="op" id="5637960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637965">if</span>&nbsp;<span class="ident" id="5637968">prevGroup</span>&nbsp;<span class="op" id="5637978">==</span>&nbsp;<span class="ident" id="5637981">i</span><span class="op" id="5637982">+</span><span class="num" id="5637983">1</span>&nbsp;<span class="op" id="5637985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637991">sa</span><span class="op" id="5637993">[</span><span class="ident" id="5637994">i</span><span class="op" id="5637995">+</span><span class="num" id="5637996">1</span><span class="op" id="5637997">]</span>&nbsp;<span class="op" id="5637999">=</span>&nbsp;<span class="op" id="5638001">-</span><span class="num" id="5638002">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638007">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638012">groupByte</span>&nbsp;<span class="op" id="5638022">=</span>&nbsp;<span class="ident" id="5638024">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638029">prevGroup</span>&nbsp;<span class="op" id="5638039">=</span>&nbsp;<span class="ident" id="5638041">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638049">inv</span><span class="op" id="5638052">[</span><span class="ident" id="5638053">sa</span><span class="op" id="5638055">[</span><span class="ident" id="5638056">i</span><span class="op" id="5638057">]</span><span class="op" id="5638058">]</span>&nbsp;<span class="op" id="5638060">=</span>&nbsp;<span class="ident" id="5638062">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638074">if</span>&nbsp;<span class="ident" id="5638077">prevGroup</span>&nbsp;<span class="op" id="5638087">==</span>&nbsp;<span class="num" id="5638090">0</span>&nbsp;<span class="op" id="5638092">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638097">sa</span><span class="op" id="5638099">[</span><span class="num" id="5638100">0</span><span class="op" id="5638101">]</span>&nbsp;<span class="op" id="5638103">=</span>&nbsp;<span class="op" id="5638105">-</span><span class="num" id="5638106">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638116">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638177">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638240">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638284">lastByte</span>&nbsp;<span class="op" id="5638293">:=</span>&nbsp;<span class="ident" id="5638296">data</span><span class="op" id="5638300">[</span><span class="builtinfunc" id="5638301">len</span><span class="op" id="5638304">(</span><span class="ident" id="5638305">data</span><span class="op" id="5638309">)</span><span class="op" id="5638310">-</span><span class="num" id="5638311">1</span><span class="op" id="5638312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638315">s</span>&nbsp;<span class="op" id="5638317">:=</span>&nbsp;<span class="op" id="5638320">-</span><span class="num" id="5638321">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638324">for</span>&nbsp;<span class="ident" id="5638328">i</span>&nbsp;<span class="op" id="5638330">:=</span>&nbsp;<span class="keyword" id="5638333">range</span>&nbsp;<span class="ident" id="5638339">sa</span>&nbsp;<span class="op" id="5638342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638346">if</span>&nbsp;<span class="ident" id="5638349">sa</span><span class="op" id="5638351">[</span><span class="ident" id="5638352">i</span><span class="op" id="5638353">]</span>&nbsp;<span class="op" id="5638355">&gt;=</span>&nbsp;<span class="num" id="5638358">0</span>&nbsp;<span class="op" id="5638360">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638365">if</span>&nbsp;<span class="ident" id="5638368">data</span><span class="op" id="5638372">[</span><span class="ident" id="5638373">sa</span><span class="op" id="5638375">[</span><span class="ident" id="5638376">i</span><span class="op" id="5638377">]</span><span class="op" id="5638378">]</span>&nbsp;<span class="op" id="5638380">==</span>&nbsp;<span class="ident" id="5638383">lastByte</span>&nbsp;<span class="op" id="5638392">&amp;&amp;</span>&nbsp;<span class="ident" id="5638395">s</span>&nbsp;<span class="op" id="5638397">==</span>&nbsp;<span class="op" id="5638400">-</span><span class="num" id="5638401">1</span>&nbsp;<span class="op" id="5638403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638409">s</span>&nbsp;<span class="op" id="5638411">=</span>&nbsp;<span class="ident" id="5638413">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638423">if</span>&nbsp;<span class="ident" id="5638426">sa</span><span class="op" id="5638428">[</span><span class="ident" id="5638429">i</span><span class="op" id="5638430">]</span>&nbsp;<span class="op" id="5638432">==</span>&nbsp;<span class="builtinfunc" id="5638435">len</span><span class="op" id="5638438">(</span><span class="ident" id="5638439">sa</span><span class="op" id="5638441">)</span><span class="op" id="5638442">-</span><span class="num" id="5638443">1</span>&nbsp;<span class="op" id="5638445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638451">sa</span><span class="op" id="5638453">[</span><span class="ident" id="5638454">i</span><span class="op" id="5638455">]</span><span class="op" id="5638456">,</span>&nbsp;<span class="ident" id="5638458">sa</span><span class="op" id="5638460">[</span><span class="ident" id="5638461">s</span><span class="op" id="5638462">]</span>&nbsp;<span class="op" id="5638464">=</span>&nbsp;<span class="ident" id="5638466">sa</span><span class="op" id="5638468">[</span><span class="ident" id="5638469">s</span><span class="op" id="5638470">]</span><span class="op" id="5638471">,</span>&nbsp;<span class="ident" id="5638473">sa</span><span class="op" id="5638475">[</span><span class="ident" id="5638476">i</span><span class="op" id="5638477">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638483">inv</span><span class="op" id="5638486">[</span><span class="ident" id="5638487">sa</span><span class="op" id="5638489">[</span><span class="ident" id="5638490">s</span><span class="op" id="5638491">]</span><span class="op" id="5638492">]</span>&nbsp;<span class="op" id="5638494">=</span>&nbsp;<span class="ident" id="5638496">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638502">sa</span><span class="op" id="5638504">[</span><span class="ident" id="5638505">s</span><span class="op" id="5638506">]</span>&nbsp;<span class="op" id="5638508">=</span>&nbsp;<span class="op" id="5638510">-</span><span class="num" id="5638511">1</span>&nbsp;<span class="comment" id="5638513">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638556">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638569">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638575">return</span>&nbsp;<span class="ident" id="5638582">inv</span><br>
<span class="lineno"></span><span class="op" id="5638586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5638589">type</span>&nbsp;<span class="ident" id="5638594">suffixSortable</span>&nbsp;<span class="keyword" id="5638609">struct</span>&nbsp;<span class="op" id="5638616">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638619">sa</span>&nbsp;&nbsp;<span class="op" id="5638623">[</span><span class="op" id="5638624">]</span><span class="builtintype" id="5638625">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638630">inv</span>&nbsp;<span class="op" id="5638634">[</span><span class="op" id="5638635">]</span><span class="builtintype" id="5638636">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638641">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5638645">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638650">buf</span>&nbsp;<span class="op" id="5638654">[</span><span class="op" id="5638655">]</span><span class="builtintype" id="5638656">int</span>&nbsp;<span class="comment" id="5638660">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5638684">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5638687">func</span>&nbsp;<span class="op" id="5638692">(</span><span class="ident" id="5638693">x</span>&nbsp;<span class="op" id="5638695">*</span><span class="ident" id="5638696">suffixSortable</span><span class="op" id="5638710">)</span>&nbsp;<span class="ident" id="5638712">Len</span><span class="op" id="5638715">(</span><span class="op" id="5638716">)</span>&nbsp;<span class="builtintype" id="5638718">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638732">{</span>&nbsp;<span class="keyword" id="5638734">return</span>&nbsp;<span class="builtinfunc" id="5638741">len</span><span class="op" id="5638744">(</span><span class="ident" id="5638745">x</span><span class="op" id="5638746">.</span><span class="ident" id="5638747">sa</span><span class="op" id="5638749">)</span>&nbsp;<span class="op" id="5638751">}</span><br>
<span class="lineno"></span><span class="keyword" id="5638753">func</span>&nbsp;<span class="op" id="5638758">(</span><span class="ident" id="5638759">x</span>&nbsp;<span class="op" id="5638761">*</span><span class="ident" id="5638762">suffixSortable</span><span class="op" id="5638776">)</span>&nbsp;<span class="ident" id="5638778">Less</span><span class="op" id="5638782">(</span><span class="ident" id="5638783">i</span><span class="op" id="5638784">,</span>&nbsp;<span class="ident" id="5638786">j</span>&nbsp;<span class="builtintype" id="5638788">int</span><span class="op" id="5638791">)</span>&nbsp;<span class="builtintype" id="5638793">bool</span>&nbsp;<span class="op" id="5638798">{</span>&nbsp;<span class="keyword" id="5638800">return</span>&nbsp;<span class="ident" id="5638807">x</span><span class="op" id="5638808">.</span><span class="ident" id="5638809">inv</span><span class="op" id="5638812">[</span><span class="ident" id="5638813">x</span><span class="op" id="5638814">.</span><span class="ident" id="5638815">sa</span><span class="op" id="5638817">[</span><span class="ident" id="5638818">i</span><span class="op" id="5638819">]</span><span class="op" id="5638820">+</span><span class="ident" id="5638821">x</span><span class="op" id="5638822">.</span><span class="ident" id="5638823">h</span><span class="op" id="5638824">]</span>&nbsp;<span class="op" id="5638826">&lt;</span>&nbsp;<span class="ident" id="5638828">x</span><span class="op" id="5638829">.</span><span class="ident" id="5638830">inv</span><span class="op" id="5638833">[</span><span class="ident" id="5638834">x</span><span class="op" id="5638835">.</span><span class="ident" id="5638836">sa</span><span class="op" id="5638838">[</span><span class="ident" id="5638839">j</span><span class="op" id="5638840">]</span><span class="op" id="5638841">+</span><span class="ident" id="5638842">x</span><span class="op" id="5638843">.</span><span class="ident" id="5638844">h</span><span class="op" id="5638845">]</span>&nbsp;<span class="op" id="5638847">}</span><br>
<span class="lineno"></span><span class="keyword" id="5638849">func</span>&nbsp;<span class="op" id="5638854">(</span><span class="ident" id="5638855">x</span>&nbsp;<span class="op" id="5638857">*</span><span class="ident" id="5638858">suffixSortable</span><span class="op" id="5638872">)</span>&nbsp;<span class="ident" id="5638874">Swap</span><span class="op" id="5638878">(</span><span class="ident" id="5638879">i</span><span class="op" id="5638880">,</span>&nbsp;<span class="ident" id="5638882">j</span>&nbsp;<span class="builtintype" id="5638884">int</span><span class="op" id="5638887">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638894">{</span>&nbsp;<span class="ident" id="5638896">x</span><span class="op" id="5638897">.</span><span class="ident" id="5638898">sa</span><span class="op" id="5638900">[</span><span class="ident" id="5638901">i</span><span class="op" id="5638902">]</span><span class="op" id="5638903">,</span>&nbsp;<span class="ident" id="5638905">x</span><span class="op" id="5638906">.</span><span class="ident" id="5638907">sa</span><span class="op" id="5638909">[</span><span class="ident" id="5638910">j</span><span class="op" id="5638911">]</span>&nbsp;<span class="op" id="5638913">=</span>&nbsp;<span class="ident" id="5638915">x</span><span class="op" id="5638916">.</span><span class="ident" id="5638917">sa</span><span class="op" id="5638919">[</span><span class="ident" id="5638920">j</span><span class="op" id="5638921">]</span><span class="op" id="5638922">,</span>&nbsp;<span class="ident" id="5638924">x</span><span class="op" id="5638925">.</span><span class="ident" id="5638926">sa</span><span class="op" id="5638928">[</span><span class="ident" id="5638929">i</span><span class="op" id="5638930">]</span>&nbsp;<span class="op" id="5638932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5638935">func</span>&nbsp;<span class="op" id="5638940">(</span><span class="ident" id="5638941">x</span>&nbsp;<span class="op" id="5638943">*</span><span class="ident" id="5638944">suffixSortable</span><span class="op" id="5638958">)</span>&nbsp;<span class="ident" id="5638960">updateGroups</span><span class="op" id="5638972">(</span><span class="ident" id="5638973">offset</span>&nbsp;<span class="builtintype" id="5638980">int</span><span class="op" id="5638983">)</span>&nbsp;<span class="op" id="5638985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638988">bounds</span>&nbsp;<span class="op" id="5638995">:=</span>&nbsp;<span class="ident" id="5638998">x</span><span class="op" id="5638999">.</span><span class="ident" id="5639000">buf</span><span class="op" id="5639003">[</span><span class="num" id="5639004">0</span><span class="op" id="5639005">:</span><span class="num" id="5639006">0</span><span class="op" id="5639007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639010">group</span>&nbsp;<span class="op" id="5639016">:=</span>&nbsp;<span class="ident" id="5639019">x</span><span class="op" id="5639020">.</span><span class="ident" id="5639021">inv</span><span class="op" id="5639024">[</span><span class="ident" id="5639025">x</span><span class="op" id="5639026">.</span><span class="ident" id="5639027">sa</span><span class="op" id="5639029">[</span><span class="num" id="5639030">0</span><span class="op" id="5639031">]</span><span class="op" id="5639032">+</span><span class="ident" id="5639033">x</span><span class="op" id="5639034">.</span><span class="ident" id="5639035">h</span><span class="op" id="5639036">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639039">for</span>&nbsp;<span class="ident" id="5639043">i</span>&nbsp;<span class="op" id="5639045">:=</span>&nbsp;<span class="num" id="5639048">1</span><span class="op" id="5639049">;</span>&nbsp;<span class="ident" id="5639051">i</span>&nbsp;<span class="op" id="5639053">&lt;</span>&nbsp;<span class="builtinfunc" id="5639055">len</span><span class="op" id="5639058">(</span><span class="ident" id="5639059">x</span><span class="op" id="5639060">.</span><span class="ident" id="5639061">sa</span><span class="op" id="5639063">)</span><span class="op" id="5639064">;</span>&nbsp;<span class="ident" id="5639066">i</span><span class="op" id="5639067">++</span>&nbsp;<span class="op" id="5639070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639074">if</span>&nbsp;<span class="ident" id="5639077">g</span>&nbsp;<span class="op" id="5639079">:=</span>&nbsp;<span class="ident" id="5639082">x</span><span class="op" id="5639083">.</span><span class="ident" id="5639084">inv</span><span class="op" id="5639087">[</span><span class="ident" id="5639088">x</span><span class="op" id="5639089">.</span><span class="ident" id="5639090">sa</span><span class="op" id="5639092">[</span><span class="ident" id="5639093">i</span><span class="op" id="5639094">]</span><span class="op" id="5639095">+</span><span class="ident" id="5639096">x</span><span class="op" id="5639097">.</span><span class="ident" id="5639098">h</span><span class="op" id="5639099">]</span><span class="op" id="5639100">;</span>&nbsp;<span class="ident" id="5639102">g</span>&nbsp;<span class="op" id="5639104">&gt;</span>&nbsp;<span class="ident" id="5639106">group</span>&nbsp;<span class="op" id="5639112">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639117">bounds</span>&nbsp;<span class="op" id="5639124">=</span>&nbsp;<span class="builtinfunc" id="5639126">append</span><span class="op" id="5639132">(</span><span class="ident" id="5639133">bounds</span><span class="op" id="5639139">,</span>&nbsp;<span class="ident" id="5639141">i</span><span class="op" id="5639142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639147">group</span>&nbsp;<span class="op" id="5639153">=</span>&nbsp;<span class="ident" id="5639155">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639165">bounds</span>&nbsp;<span class="op" id="5639172">=</span>&nbsp;<span class="builtinfunc" id="5639174">append</span><span class="op" id="5639180">(</span><span class="ident" id="5639181">bounds</span><span class="op" id="5639187">,</span>&nbsp;<span class="builtinfunc" id="5639189">len</span><span class="op" id="5639192">(</span><span class="ident" id="5639193">x</span><span class="op" id="5639194">.</span><span class="ident" id="5639195">sa</span><span class="op" id="5639197">)</span><span class="op" id="5639198">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639201">x</span><span class="op" id="5639202">.</span><span class="ident" id="5639203">buf</span>&nbsp;<span class="op" id="5639207">=</span>&nbsp;<span class="ident" id="5639209">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639218">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639286">prev</span>&nbsp;<span class="op" id="5639291">:=</span>&nbsp;<span class="num" id="5639294">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639297">for</span>&nbsp;<span class="ident" id="5639301">_</span><span class="op" id="5639302">,</span>&nbsp;<span class="ident" id="5639304">b</span>&nbsp;<span class="op" id="5639306">:=</span>&nbsp;<span class="keyword" id="5639309">range</span>&nbsp;<span class="ident" id="5639315">bounds</span>&nbsp;<span class="op" id="5639322">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639326">for</span>&nbsp;<span class="ident" id="5639330">i</span>&nbsp;<span class="op" id="5639332">:=</span>&nbsp;<span class="ident" id="5639335">prev</span><span class="op" id="5639339">;</span>&nbsp;<span class="ident" id="5639341">i</span>&nbsp;<span class="op" id="5639343">&lt;</span>&nbsp;<span class="ident" id="5639345">b</span><span class="op" id="5639346">;</span>&nbsp;<span class="ident" id="5639348">i</span><span class="op" id="5639349">++</span>&nbsp;<span class="op" id="5639352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639357">x</span><span class="op" id="5639358">.</span><span class="ident" id="5639359">inv</span><span class="op" id="5639362">[</span><span class="ident" id="5639363">x</span><span class="op" id="5639364">.</span><span class="ident" id="5639365">sa</span><span class="op" id="5639367">[</span><span class="ident" id="5639368">i</span><span class="op" id="5639369">]</span><span class="op" id="5639370">]</span>&nbsp;<span class="op" id="5639372">=</span>&nbsp;<span class="ident" id="5639374">offset</span>&nbsp;<span class="op" id="5639381">+</span>&nbsp;<span class="ident" id="5639383">b</span>&nbsp;<span class="op" id="5639385">-</span>&nbsp;<span class="num" id="5639387">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639395">if</span>&nbsp;<span class="ident" id="5639398">b</span><span class="op" id="5639399">-</span><span class="ident" id="5639400">prev</span>&nbsp;<span class="op" id="5639405">==</span>&nbsp;<span class="num" id="5639408">1</span>&nbsp;<span class="op" id="5639410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639415">x</span><span class="op" id="5639416">.</span><span class="ident" id="5639417">sa</span><span class="op" id="5639419">[</span><span class="ident" id="5639420">prev</span><span class="op" id="5639424">]</span>&nbsp;<span class="op" id="5639426">=</span>&nbsp;<span class="op" id="5639428">-</span><span class="num" id="5639429">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639437">prev</span>&nbsp;<span class="op" id="5639442">=</span>&nbsp;<span class="ident" id="5639444">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639447">}</span><br>
<span class="lineno"></span><span class="op" id="5639449">}</span>
</div>
</body>
</html>
