<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html" class="current">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5549242">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5549297">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5549351">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5549402">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="5549487">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="5549535">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="5549557">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="5549579">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="5549601">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5549653">package</span>&nbsp;<span class="ident" id="5549661">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5549667">import</span>&nbsp;<span class="op" id="5549674">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549677">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549691">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549710">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549720">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549726">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549733">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5549750">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5549760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5549763">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5549825">type</span>&nbsp;<span class="ident" id="5549830">Client</span>&nbsp;<span class="keyword" id="5549837">struct</span>&nbsp;<span class="op" id="5549844">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549847">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549926">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549957">Text</span>&nbsp;<span class="op" id="5549962">*</span><span class="ident" id="5549963">textproto</span><span class="op" id="5549972">.</span><span class="ident" id="5549973">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549979">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550052">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550073">conn</span>&nbsp;<span class="ident" id="5550078">net</span><span class="op" id="5550081">.</span><span class="ident" id="5550082">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550088">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550124">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5550135">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550141">serverName</span>&nbsp;<span class="builtintype" id="5550152">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550160">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550192">ext</span>&nbsp;<span class="keyword" id="5550196">map</span><span class="op" id="5550199">[</span><span class="builtintype" id="5550200">string</span><span class="op" id="5550206">]</span><span class="builtintype" id="5550207">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550215">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550245">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550256">[</span><span class="op" id="5550257">]</span><span class="builtintype" id="5550258">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550266">localName</span>&nbsp;&nbsp;<span class="builtintype" id="5550277">string</span>&nbsp;<span class="comment" id="5550284">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550317">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5550328">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5550335">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550368">helloError</span>&nbsp;<span class="builtintype" id="5550379">error</span>&nbsp;&nbsp;<span class="comment" id="5550386">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="5550414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5550417">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="5550483">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="5550523">func</span>&nbsp;<span class="ident" id="5550528">Dial</span><span class="op" id="5550532">(</span><span class="ident" id="5550533">addr</span>&nbsp;<span class="builtintype" id="5550538">string</span><span class="op" id="5550544">)</span>&nbsp;<span class="op" id="5550546">(</span><span class="op" id="5550547">*</span><span class="ident" id="5550548">Client</span><span class="op" id="5550554">,</span>&nbsp;<span class="builtintype" id="5550556">error</span><span class="op" id="5550561">)</span>&nbsp;<span class="op" id="5550563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550566">conn</span><span class="op" id="5550570">,</span>&nbsp;<span class="ident" id="5550572">err</span>&nbsp;<span class="op" id="5550576">:=</span>&nbsp;<span class="ident" id="5550579">net</span><span class="op" id="5550582">.</span><span class="ident" id="5550583">Dial</span><span class="op" id="5550587">(</span><span class="string" id="5550588">&#34;tcp&#34;</span><span class="op" id="5550593">,</span>&nbsp;<span class="ident" id="5550595">addr</span><span class="op" id="5550599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550602">if</span>&nbsp;<span class="ident" id="5550605">err</span>&nbsp;<span class="op" id="5550609">!=</span>&nbsp;<span class="ident" id="5550612">nil</span>&nbsp;<span class="op" id="5550616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550620">return</span>&nbsp;<span class="ident" id="5550627">nil</span><span class="op" id="5550630">,</span>&nbsp;<span class="ident" id="5550632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550637">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550640">host</span><span class="op" id="5550644">,</span>&nbsp;<span class="ident" id="5550646">_</span><span class="op" id="5550647">,</span>&nbsp;<span class="ident" id="5550649">_</span>&nbsp;<span class="op" id="5550651">:=</span>&nbsp;<span class="ident" id="5550654">net</span><span class="op" id="5550657">.</span><span class="ident" id="5550658">SplitHostPort</span><span class="op" id="5550671">(</span><span class="ident" id="5550672">addr</span><span class="op" id="5550676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550679">return</span>&nbsp;<span class="ident" id="5550686">NewClient</span><span class="op" id="5550695">(</span><span class="ident" id="5550696">conn</span><span class="op" id="5550700">,</span>&nbsp;<span class="ident" id="5550702">host</span><span class="op" id="5550706">)</span><br>
<span class="lineno"></span><span class="op" id="5550708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5550711">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="5550788">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="5550835">func</span>&nbsp;<span class="ident" id="5550840">NewClient</span><span class="op" id="5550849">(</span><span class="ident" id="5550850">conn</span>&nbsp;<span class="ident" id="5550855">net</span><span class="op" id="5550858">.</span><span class="ident" id="5550859">Conn</span><span class="op" id="5550863">,</span>&nbsp;<span class="ident" id="5550865">host</span>&nbsp;<span class="builtintype" id="5550870">string</span><span class="op" id="5550876">)</span>&nbsp;<span class="op" id="5550878">(</span><span class="op" id="5550879">*</span><span class="ident" id="5550880">Client</span><span class="op" id="5550886">,</span>&nbsp;<span class="builtintype" id="5550888">error</span><span class="op" id="5550893">)</span>&nbsp;<span class="op" id="5550895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550898">text</span>&nbsp;<span class="op" id="5550903">:=</span>&nbsp;<span class="ident" id="5550906">textproto</span><span class="op" id="5550915">.</span><span class="ident" id="5550916">NewConn</span><span class="op" id="5550923">(</span><span class="ident" id="5550924">conn</span><span class="op" id="5550928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550931">_</span><span class="op" id="5550932">,</span>&nbsp;<span class="ident" id="5550934">_</span><span class="op" id="5550935">,</span>&nbsp;<span class="ident" id="5550937">err</span>&nbsp;<span class="op" id="5550941">:=</span>&nbsp;<span class="ident" id="5550944">text</span><span class="op" id="5550948">.</span><span class="ident" id="5550949">ReadResponse</span><span class="op" id="5550961">(</span><span class="num" id="5550962">220</span><span class="op" id="5550965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550968">if</span>&nbsp;<span class="ident" id="5550971">err</span>&nbsp;<span class="op" id="5550975">!=</span>&nbsp;<span class="ident" id="5550978">nil</span>&nbsp;<span class="op" id="5550982">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550986">text</span><span class="op" id="5550990">.</span><span class="ident" id="5550991">Close</span><span class="op" id="5550996">(</span><span class="op" id="5550997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551001">return</span>&nbsp;<span class="ident" id="5551008">nil</span><span class="op" id="5551011">,</span>&nbsp;<span class="ident" id="5551013">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551021">c</span>&nbsp;<span class="op" id="5551023">:=</span>&nbsp;<span class="op" id="5551026">&amp;</span><span class="ident" id="5551027">Client</span><span class="op" id="5551033">{</span><span class="ident" id="5551034">Text</span><span class="op" id="5551038">:</span>&nbsp;<span class="ident" id="5551040">text</span><span class="op" id="5551044">,</span>&nbsp;<span class="ident" id="5551046">conn</span><span class="op" id="5551050">:</span>&nbsp;<span class="ident" id="5551052">conn</span><span class="op" id="5551056">,</span>&nbsp;<span class="ident" id="5551058">serverName</span><span class="op" id="5551068">:</span>&nbsp;<span class="ident" id="5551070">host</span><span class="op" id="5551074">,</span>&nbsp;<span class="ident" id="5551076">localName</span><span class="op" id="5551085">:</span>&nbsp;<span class="string" id="5551087">&#34;localhost&#34;</span><span class="op" id="5551098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551101">return</span>&nbsp;<span class="ident" id="5551108">c</span><span class="op" id="5551109">,</span>&nbsp;<span class="ident" id="5551111">nil</span><br>
<span class="lineno">65</span><span class="op" id="5551115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5551118">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5551150">func</span>&nbsp;<span class="op" id="5551155">(</span><span class="ident" id="5551156">c</span>&nbsp;<span class="op" id="5551158">*</span><span class="ident" id="5551159">Client</span><span class="op" id="5551165">)</span>&nbsp;<span class="ident" id="5551167">Close</span><span class="op" id="5551172">(</span><span class="op" id="5551173">)</span>&nbsp;<span class="builtintype" id="5551175">error</span>&nbsp;<span class="op" id="5551181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551184">return</span>&nbsp;<span class="ident" id="5551191">c</span><span class="op" id="5551192">.</span><span class="ident" id="5551193">Text</span><span class="op" id="5551197">.</span><span class="ident" id="5551198">Close</span><span class="op" id="5551203">(</span><span class="op" id="5551204">)</span><br>
<span class="lineno">70</span><span class="op" id="5551206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5551209">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5551251">func</span>&nbsp;<span class="op" id="5551256">(</span><span class="ident" id="5551257">c</span>&nbsp;<span class="op" id="5551259">*</span><span class="ident" id="5551260">Client</span><span class="op" id="5551266">)</span>&nbsp;<span class="ident" id="5551268">hello</span><span class="op" id="5551273">(</span><span class="op" id="5551274">)</span>&nbsp;<span class="builtintype" id="5551276">error</span>&nbsp;<span class="op" id="5551282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551285">if</span>&nbsp;<span class="op" id="5551288">!</span><span class="ident" id="5551289">c</span><span class="op" id="5551290">.</span><span class="ident" id="5551291">didHello</span>&nbsp;<span class="op" id="5551300">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551304">c</span><span class="op" id="5551305">.</span><span class="ident" id="5551306">didHello</span>&nbsp;<span class="op" id="5551315">=</span>&nbsp;<span class="builtintype" id="5551317">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551324">err</span>&nbsp;<span class="op" id="5551328">:=</span>&nbsp;<span class="ident" id="5551331">c</span><span class="op" id="5551332">.</span><span class="ident" id="5551333">ehlo</span><span class="op" id="5551337">(</span><span class="op" id="5551338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551342">if</span>&nbsp;<span class="ident" id="5551345">err</span>&nbsp;<span class="op" id="5551349">!=</span>&nbsp;<span class="ident" id="5551352">nil</span>&nbsp;<span class="op" id="5551356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551361">c</span><span class="op" id="5551362">.</span><span class="ident" id="5551363">helloError</span>&nbsp;<span class="op" id="5551374">=</span>&nbsp;<span class="ident" id="5551376">c</span><span class="op" id="5551377">.</span><span class="ident" id="5551378">helo</span><span class="op" id="5551382">(</span><span class="op" id="5551383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551387">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551393">return</span>&nbsp;<span class="ident" id="5551400">c</span><span class="op" id="5551401">.</span><span class="ident" id="5551402">helloError</span><br>
<span class="lineno"></span><span class="op" id="5551413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5551416">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="5551484">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5551553">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5551630">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5551704">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5551733">func</span>&nbsp;<span class="op" id="5551738">(</span><span class="ident" id="5551739">c</span>&nbsp;<span class="op" id="5551741">*</span><span class="ident" id="5551742">Client</span><span class="op" id="5551748">)</span>&nbsp;<span class="ident" id="5551750">Hello</span><span class="op" id="5551755">(</span><span class="ident" id="5551756">localName</span>&nbsp;<span class="builtintype" id="5551766">string</span><span class="op" id="5551772">)</span>&nbsp;<span class="builtintype" id="5551774">error</span>&nbsp;<span class="op" id="5551780">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551783">if</span>&nbsp;<span class="ident" id="5551786">c</span><span class="op" id="5551787">.</span><span class="ident" id="5551788">didHello</span>&nbsp;<span class="op" id="5551797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551801">return</span>&nbsp;<span class="ident" id="5551808">errors</span><span class="op" id="5551814">.</span><span class="ident" id="5551815">New</span><span class="op" id="5551818">(</span><span class="string" id="5551819">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="5551859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551865">c</span><span class="op" id="5551866">.</span><span class="ident" id="5551867">localName</span>&nbsp;<span class="op" id="5551877">=</span>&nbsp;<span class="ident" id="5551879">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551890">return</span>&nbsp;<span class="ident" id="5551897">c</span><span class="op" id="5551898">.</span><span class="ident" id="5551899">hello</span><span class="op" id="5551904">(</span><span class="op" id="5551905">)</span><br>
<span class="lineno">95</span><span class="op" id="5551907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5551910">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="5551989">func</span>&nbsp;<span class="op" id="5551994">(</span><span class="ident" id="5551995">c</span>&nbsp;<span class="op" id="5551997">*</span><span class="ident" id="5551998">Client</span><span class="op" id="5552004">)</span>&nbsp;<span class="ident" id="5552006">cmd</span><span class="op" id="5552009">(</span><span class="ident" id="5552010">expectCode</span>&nbsp;<span class="builtintype" id="5552021">int</span><span class="op" id="5552024">,</span>&nbsp;<span class="ident" id="5552026">format</span>&nbsp;<span class="builtintype" id="5552033">string</span><span class="op" id="5552039">,</span>&nbsp;<span class="ident" id="5552041">args</span>&nbsp;<span class="op" id="5552046">...</span><span class="keyword" id="5552049">interface</span><span class="op" id="5552058">{</span><span class="op" id="5552059">}</span><span class="op" id="5552060">)</span>&nbsp;<span class="op" id="5552062">(</span><span class="builtintype" id="5552063">int</span><span class="op" id="5552066">,</span>&nbsp;<span class="builtintype" id="5552068">string</span><span class="op" id="5552074">,</span>&nbsp;<span class="builtintype" id="5552076">error</span><span class="op" id="5552081">)</span>&nbsp;<span class="op" id="5552083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552086">id</span><span class="op" id="5552088">,</span>&nbsp;<span class="ident" id="5552090">err</span>&nbsp;<span class="op" id="5552094">:=</span>&nbsp;<span class="ident" id="5552097">c</span><span class="op" id="5552098">.</span><span class="ident" id="5552099">Text</span><span class="op" id="5552103">.</span><span class="ident" id="5552104">Cmd</span><span class="op" id="5552107">(</span><span class="ident" id="5552108">format</span><span class="op" id="5552114">,</span>&nbsp;<span class="ident" id="5552116">args</span><span class="op" id="5552120">...</span><span class="op" id="5552123">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552126">if</span>&nbsp;<span class="ident" id="5552129">err</span>&nbsp;<span class="op" id="5552133">!=</span>&nbsp;<span class="ident" id="5552136">nil</span>&nbsp;<span class="op" id="5552140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552144">return</span>&nbsp;<span class="num" id="5552151">0</span><span class="op" id="5552152">,</span>&nbsp;<span class="string" id="5552154">&#34;&#34;</span><span class="op" id="5552156">,</span>&nbsp;<span class="ident" id="5552158">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5552163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552166">c</span><span class="op" id="5552167">.</span><span class="ident" id="5552168">Text</span><span class="op" id="5552172">.</span><span class="ident" id="5552173">StartResponse</span><span class="op" id="5552186">(</span><span class="ident" id="5552187">id</span><span class="op" id="5552189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552192">defer</span>&nbsp;<span class="ident" id="5552198">c</span><span class="op" id="5552199">.</span><span class="ident" id="5552200">Text</span><span class="op" id="5552204">.</span><span class="ident" id="5552205">EndResponse</span><span class="op" id="5552216">(</span><span class="ident" id="5552217">id</span><span class="op" id="5552219">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552222">code</span><span class="op" id="5552226">,</span>&nbsp;<span class="ident" id="5552228">msg</span><span class="op" id="5552231">,</span>&nbsp;<span class="ident" id="5552233">err</span>&nbsp;<span class="op" id="5552237">:=</span>&nbsp;<span class="ident" id="5552240">c</span><span class="op" id="5552241">.</span><span class="ident" id="5552242">Text</span><span class="op" id="5552246">.</span><span class="ident" id="5552247">ReadResponse</span><span class="op" id="5552259">(</span><span class="ident" id="5552260">expectCode</span><span class="op" id="5552270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552273">return</span>&nbsp;<span class="ident" id="5552280">code</span><span class="op" id="5552284">,</span>&nbsp;<span class="ident" id="5552286">msg</span><span class="op" id="5552289">,</span>&nbsp;<span class="ident" id="5552291">err</span><br>
<span class="lineno"></span><span class="op" id="5552295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5552298">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="5552377">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="5552410">func</span>&nbsp;<span class="op" id="5552415">(</span><span class="ident" id="5552416">c</span>&nbsp;<span class="op" id="5552418">*</span><span class="ident" id="5552419">Client</span><span class="op" id="5552425">)</span>&nbsp;<span class="ident" id="5552427">helo</span><span class="op" id="5552431">(</span><span class="op" id="5552432">)</span>&nbsp;<span class="builtintype" id="5552434">error</span>&nbsp;<span class="op" id="5552440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552443">c</span><span class="op" id="5552444">.</span><span class="ident" id="5552445">ext</span>&nbsp;<span class="op" id="5552449">=</span>&nbsp;<span class="ident" id="5552451">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552456">_</span><span class="op" id="5552457">,</span>&nbsp;<span class="ident" id="5552459">_</span><span class="op" id="5552460">,</span>&nbsp;<span class="ident" id="5552462">err</span>&nbsp;<span class="op" id="5552466">:=</span>&nbsp;<span class="ident" id="5552469">c</span><span class="op" id="5552470">.</span><span class="ident" id="5552471">cmd</span><span class="op" id="5552474">(</span><span class="num" id="5552475">250</span><span class="op" id="5552478">,</span>&nbsp;<span class="string" id="5552480">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="5552489">,</span>&nbsp;<span class="ident" id="5552491">c</span><span class="op" id="5552492">.</span><span class="ident" id="5552493">localName</span><span class="op" id="5552502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552505">return</span>&nbsp;<span class="ident" id="5552512">err</span><br>
<span class="lineno">115</span><span class="op" id="5552516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5552519">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5552586">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5552651">func</span>&nbsp;<span class="op" id="5552656">(</span><span class="ident" id="5552657">c</span>&nbsp;<span class="op" id="5552659">*</span><span class="ident" id="5552660">Client</span><span class="op" id="5552666">)</span>&nbsp;<span class="ident" id="5552668">ehlo</span><span class="op" id="5552672">(</span><span class="op" id="5552673">)</span>&nbsp;<span class="builtintype" id="5552675">error</span>&nbsp;<span class="op" id="5552681">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552684">_</span><span class="op" id="5552685">,</span>&nbsp;<span class="ident" id="5552687">msg</span><span class="op" id="5552690">,</span>&nbsp;<span class="ident" id="5552692">err</span>&nbsp;<span class="op" id="5552696">:=</span>&nbsp;<span class="ident" id="5552699">c</span><span class="op" id="5552700">.</span><span class="ident" id="5552701">cmd</span><span class="op" id="5552704">(</span><span class="num" id="5552705">250</span><span class="op" id="5552708">,</span>&nbsp;<span class="string" id="5552710">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="5552719">,</span>&nbsp;<span class="ident" id="5552721">c</span><span class="op" id="5552722">.</span><span class="ident" id="5552723">localName</span><span class="op" id="5552732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552735">if</span>&nbsp;<span class="ident" id="5552738">err</span>&nbsp;<span class="op" id="5552742">!=</span>&nbsp;<span class="ident" id="5552745">nil</span>&nbsp;<span class="op" id="5552749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552753">return</span>&nbsp;<span class="ident" id="5552760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5552765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552768">ext</span>&nbsp;<span class="op" id="5552772">:=</span>&nbsp;<span class="builtinfunc" id="5552775">make</span><span class="op" id="5552779">(</span><span class="keyword" id="5552780">map</span><span class="op" id="5552783">[</span><span class="builtintype" id="5552784">string</span><span class="op" id="5552790">]</span><span class="builtintype" id="5552791">string</span><span class="op" id="5552797">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552800">extList</span>&nbsp;<span class="op" id="5552808">:=</span>&nbsp;<span class="ident" id="5552811">strings</span><span class="op" id="5552818">.</span><span class="ident" id="5552819">Split</span><span class="op" id="5552824">(</span><span class="ident" id="5552825">msg</span><span class="op" id="5552828">,</span>&nbsp;<span class="string" id="5552830">&#34;\n&#34;</span><span class="op" id="5552834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552837">if</span>&nbsp;<span class="builtinfunc" id="5552840">len</span><span class="op" id="5552843">(</span><span class="ident" id="5552844">extList</span><span class="op" id="5552851">)</span>&nbsp;<span class="op" id="5552853">&gt;</span>&nbsp;<span class="num" id="5552855">1</span>&nbsp;<span class="op" id="5552857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552861">extList</span>&nbsp;<span class="op" id="5552869">=</span>&nbsp;<span class="ident" id="5552871">extList</span><span class="op" id="5552878">[</span><span class="num" id="5552879">1</span><span class="op" id="5552880">:</span><span class="op" id="5552881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552885">for</span>&nbsp;<span class="ident" id="5552889">_</span><span class="op" id="5552890">,</span>&nbsp;<span class="ident" id="5552892">line</span>&nbsp;<span class="op" id="5552897">:=</span>&nbsp;<span class="keyword" id="5552900">range</span>&nbsp;<span class="ident" id="5552906">extList</span>&nbsp;<span class="op" id="5552914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552919">args</span>&nbsp;<span class="op" id="5552924">:=</span>&nbsp;<span class="ident" id="5552927">strings</span><span class="op" id="5552934">.</span><span class="ident" id="5552935">SplitN</span><span class="op" id="5552941">(</span><span class="ident" id="5552942">line</span><span class="op" id="5552946">,</span>&nbsp;<span class="string" id="5552948">&#34;&nbsp;&#34;</span><span class="op" id="5552951">,</span>&nbsp;<span class="num" id="5552953">2</span><span class="op" id="5552954">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552959">if</span>&nbsp;<span class="builtinfunc" id="5552962">len</span><span class="op" id="5552965">(</span><span class="ident" id="5552966">args</span><span class="op" id="5552970">)</span>&nbsp;<span class="op" id="5552972">&gt;</span>&nbsp;<span class="num" id="5552974">1</span>&nbsp;<span class="op" id="5552976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552982">ext</span><span class="op" id="5552985">[</span><span class="ident" id="5552986">args</span><span class="op" id="5552990">[</span><span class="num" id="5552991">0</span><span class="op" id="5552992">]</span><span class="op" id="5552993">]</span>&nbsp;<span class="op" id="5552995">=</span>&nbsp;<span class="ident" id="5552997">args</span><span class="op" id="5553001">[</span><span class="num" id="5553002">1</span><span class="op" id="5553003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553008">}</span>&nbsp;<span class="keyword" id="5553010">else</span>&nbsp;<span class="op" id="5553015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553021">ext</span><span class="op" id="5553024">[</span><span class="ident" id="5553025">args</span><span class="op" id="5553029">[</span><span class="num" id="5553030">0</span><span class="op" id="5553031">]</span><span class="op" id="5553032">]</span>&nbsp;<span class="op" id="5553034">=</span>&nbsp;<span class="string" id="5553036">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553042">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553052">if</span>&nbsp;<span class="ident" id="5553055">mechs</span><span class="op" id="5553060">,</span>&nbsp;<span class="ident" id="5553062">ok</span>&nbsp;<span class="op" id="5553065">:=</span>&nbsp;<span class="ident" id="5553068">ext</span><span class="op" id="5553071">[</span><span class="string" id="5553072">&#34;AUTH&#34;</span><span class="op" id="5553078">]</span><span class="op" id="5553079">;</span>&nbsp;<span class="ident" id="5553081">ok</span>&nbsp;<span class="op" id="5553084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553088">c</span><span class="op" id="5553089">.</span><span class="ident" id="5553090">auth</span>&nbsp;<span class="op" id="5553095">=</span>&nbsp;<span class="ident" id="5553097">strings</span><span class="op" id="5553104">.</span><span class="ident" id="5553105">Split</span><span class="op" id="5553110">(</span><span class="ident" id="5553111">mechs</span><span class="op" id="5553116">,</span>&nbsp;<span class="string" id="5553118">&#34;&nbsp;&#34;</span><span class="op" id="5553121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553124">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553127">c</span><span class="op" id="5553128">.</span><span class="ident" id="5553129">ext</span>&nbsp;<span class="op" id="5553133">=</span>&nbsp;<span class="ident" id="5553135">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553140">return</span>&nbsp;<span class="ident" id="5553147">err</span><br>
<span class="lineno"></span><span class="op" id="5553151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5553154">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="5553233">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5553310">func</span>&nbsp;<span class="op" id="5553315">(</span><span class="ident" id="5553316">c</span>&nbsp;<span class="op" id="5553318">*</span><span class="ident" id="5553319">Client</span><span class="op" id="5553325">)</span>&nbsp;<span class="ident" id="5553327">StartTLS</span><span class="op" id="5553335">(</span><span class="ident" id="5553336">config</span>&nbsp;<span class="op" id="5553343">*</span><span class="ident" id="5553344">tls</span><span class="op" id="5553347">.</span><span class="ident" id="5553348">Config</span><span class="op" id="5553354">)</span>&nbsp;<span class="builtintype" id="5553356">error</span>&nbsp;<span class="op" id="5553362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553365">if</span>&nbsp;<span class="ident" id="5553368">err</span>&nbsp;<span class="op" id="5553372">:=</span>&nbsp;<span class="ident" id="5553375">c</span><span class="op" id="5553376">.</span><span class="ident" id="5553377">hello</span><span class="op" id="5553382">(</span><span class="op" id="5553383">)</span><span class="op" id="5553384">;</span>&nbsp;<span class="ident" id="5553386">err</span>&nbsp;<span class="op" id="5553390">!=</span>&nbsp;<span class="ident" id="5553393">nil</span>&nbsp;<span class="op" id="5553397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553401">return</span>&nbsp;<span class="ident" id="5553408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553413">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553416">_</span><span class="op" id="5553417">,</span>&nbsp;<span class="ident" id="5553419">_</span><span class="op" id="5553420">,</span>&nbsp;<span class="ident" id="5553422">err</span>&nbsp;<span class="op" id="5553426">:=</span>&nbsp;<span class="ident" id="5553429">c</span><span class="op" id="5553430">.</span><span class="ident" id="5553431">cmd</span><span class="op" id="5553434">(</span><span class="num" id="5553435">220</span><span class="op" id="5553438">,</span>&nbsp;<span class="string" id="5553440">&#34;STARTTLS&#34;</span><span class="op" id="5553450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553453">if</span>&nbsp;<span class="ident" id="5553456">err</span>&nbsp;<span class="op" id="5553460">!=</span>&nbsp;<span class="ident" id="5553463">nil</span>&nbsp;<span class="op" id="5553467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553471">return</span>&nbsp;<span class="ident" id="5553478">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553486">c</span><span class="op" id="5553487">.</span><span class="ident" id="5553488">conn</span>&nbsp;<span class="op" id="5553493">=</span>&nbsp;<span class="ident" id="5553495">tls</span><span class="op" id="5553498">.</span><span class="ident" id="5553499">Client</span><span class="op" id="5553505">(</span><span class="ident" id="5553506">c</span><span class="op" id="5553507">.</span><span class="ident" id="5553508">conn</span><span class="op" id="5553512">,</span>&nbsp;<span class="ident" id="5553514">config</span><span class="op" id="5553520">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553523">c</span><span class="op" id="5553524">.</span><span class="ident" id="5553525">Text</span>&nbsp;<span class="op" id="5553530">=</span>&nbsp;<span class="ident" id="5553532">textproto</span><span class="op" id="5553541">.</span><span class="ident" id="5553542">NewConn</span><span class="op" id="5553549">(</span><span class="ident" id="5553550">c</span><span class="op" id="5553551">.</span><span class="ident" id="5553552">conn</span><span class="op" id="5553556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553559">c</span><span class="op" id="5553560">.</span><span class="ident" id="5553561">tls</span>&nbsp;<span class="op" id="5553565">=</span>&nbsp;<span class="builtintype" id="5553567">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553573">return</span>&nbsp;<span class="ident" id="5553580">c</span><span class="op" id="5553581">.</span><span class="ident" id="5553582">ehlo</span><span class="op" id="5553586">(</span><span class="op" id="5553587">)</span><br>
<span class="lineno"></span><span class="op" id="5553589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5553592">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5553657">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5553722">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="5553788">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="5553839">func</span>&nbsp;<span class="op" id="5553844">(</span><span class="ident" id="5553845">c</span>&nbsp;<span class="op" id="5553847">*</span><span class="ident" id="5553848">Client</span><span class="op" id="5553854">)</span>&nbsp;<span class="ident" id="5553856">Verify</span><span class="op" id="5553862">(</span><span class="ident" id="5553863">addr</span>&nbsp;<span class="builtintype" id="5553868">string</span><span class="op" id="5553874">)</span>&nbsp;<span class="builtintype" id="5553876">error</span>&nbsp;<span class="op" id="5553882">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553885">if</span>&nbsp;<span class="ident" id="5553888">err</span>&nbsp;<span class="op" id="5553892">:=</span>&nbsp;<span class="ident" id="5553895">c</span><span class="op" id="5553896">.</span><span class="ident" id="5553897">hello</span><span class="op" id="5553902">(</span><span class="op" id="5553903">)</span><span class="op" id="5553904">;</span>&nbsp;<span class="ident" id="5553906">err</span>&nbsp;<span class="op" id="5553910">!=</span>&nbsp;<span class="ident" id="5553913">nil</span>&nbsp;<span class="op" id="5553917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553921">return</span>&nbsp;<span class="ident" id="5553928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553936">_</span><span class="op" id="5553937">,</span>&nbsp;<span class="ident" id="5553939">_</span><span class="op" id="5553940">,</span>&nbsp;<span class="ident" id="5553942">err</span>&nbsp;<span class="op" id="5553946">:=</span>&nbsp;<span class="ident" id="5553949">c</span><span class="op" id="5553950">.</span><span class="ident" id="5553951">cmd</span><span class="op" id="5553954">(</span><span class="num" id="5553955">250</span><span class="op" id="5553958">,</span>&nbsp;<span class="string" id="5553960">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="5553969">,</span>&nbsp;<span class="ident" id="5553971">addr</span><span class="op" id="5553975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553978">return</span>&nbsp;<span class="ident" id="5553985">err</span><br>
<span class="lineno">170</span><span class="op" id="5553989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5553992">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="5554068">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5554118">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="5554191">func</span>&nbsp;<span class="op" id="5554196">(</span><span class="ident" id="5554197">c</span>&nbsp;<span class="op" id="5554199">*</span><span class="ident" id="5554200">Client</span><span class="op" id="5554206">)</span>&nbsp;<span class="ident" id="5554208">Auth</span><span class="op" id="5554212">(</span><span class="ident" id="5554213">a</span>&nbsp;<span class="ident" id="5554215">Auth</span><span class="op" id="5554219">)</span>&nbsp;<span class="builtintype" id="5554221">error</span>&nbsp;<span class="op" id="5554227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554230">if</span>&nbsp;<span class="ident" id="5554233">err</span>&nbsp;<span class="op" id="5554237">:=</span>&nbsp;<span class="ident" id="5554240">c</span><span class="op" id="5554241">.</span><span class="ident" id="5554242">hello</span><span class="op" id="5554247">(</span><span class="op" id="5554248">)</span><span class="op" id="5554249">;</span>&nbsp;<span class="ident" id="5554251">err</span>&nbsp;<span class="op" id="5554255">!=</span>&nbsp;<span class="ident" id="5554258">nil</span>&nbsp;<span class="op" id="5554262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554266">return</span>&nbsp;<span class="ident" id="5554273">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554281">encoding</span>&nbsp;<span class="op" id="5554290">:=</span>&nbsp;<span class="ident" id="5554293">base64</span><span class="op" id="5554299">.</span><span class="ident" id="5554300">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554313">mech</span><span class="op" id="5554317">,</span>&nbsp;<span class="ident" id="5554319">resp</span><span class="op" id="5554323">,</span>&nbsp;<span class="ident" id="5554325">err</span>&nbsp;<span class="op" id="5554329">:=</span>&nbsp;<span class="ident" id="5554332">a</span><span class="op" id="5554333">.</span><span class="ident" id="5554334">Start</span><span class="op" id="5554339">(</span><span class="op" id="5554340">&amp;</span><span class="ident" id="5554341">ServerInfo</span><span class="op" id="5554351">{</span><span class="ident" id="5554352">c</span><span class="op" id="5554353">.</span><span class="ident" id="5554354">serverName</span><span class="op" id="5554364">,</span>&nbsp;<span class="ident" id="5554366">c</span><span class="op" id="5554367">.</span><span class="ident" id="5554368">tls</span><span class="op" id="5554371">,</span>&nbsp;<span class="ident" id="5554373">c</span><span class="op" id="5554374">.</span><span class="ident" id="5554375">auth</span><span class="op" id="5554379">}</span><span class="op" id="5554380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554383">if</span>&nbsp;<span class="ident" id="5554386">err</span>&nbsp;<span class="op" id="5554390">!=</span>&nbsp;<span class="ident" id="5554393">nil</span>&nbsp;<span class="op" id="5554397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554401">c</span><span class="op" id="5554402">.</span><span class="ident" id="5554403">Quit</span><span class="op" id="5554407">(</span><span class="op" id="5554408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554412">return</span>&nbsp;<span class="ident" id="5554419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554424">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554427">resp64</span>&nbsp;<span class="op" id="5554434">:=</span>&nbsp;<span class="builtinfunc" id="5554437">make</span><span class="op" id="5554441">(</span><span class="op" id="5554442">[</span><span class="op" id="5554443">]</span><span class="builtintype" id="5554444">byte</span><span class="op" id="5554448">,</span>&nbsp;<span class="ident" id="5554450">encoding</span><span class="op" id="5554458">.</span><span class="ident" id="5554459">EncodedLen</span><span class="op" id="5554469">(</span><span class="builtinfunc" id="5554470">len</span><span class="op" id="5554473">(</span><span class="ident" id="5554474">resp</span><span class="op" id="5554478">)</span><span class="op" id="5554479">)</span><span class="op" id="5554480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554483">encoding</span><span class="op" id="5554491">.</span><span class="ident" id="5554492">Encode</span><span class="op" id="5554498">(</span><span class="ident" id="5554499">resp64</span><span class="op" id="5554505">,</span>&nbsp;<span class="ident" id="5554507">resp</span><span class="op" id="5554511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554514">code</span><span class="op" id="5554518">,</span>&nbsp;<span class="ident" id="5554520">msg64</span><span class="op" id="5554525">,</span>&nbsp;<span class="ident" id="5554527">err</span>&nbsp;<span class="op" id="5554531">:=</span>&nbsp;<span class="ident" id="5554534">c</span><span class="op" id="5554535">.</span><span class="ident" id="5554536">cmd</span><span class="op" id="5554539">(</span><span class="num" id="5554540">0</span><span class="op" id="5554541">,</span>&nbsp;<span class="string" id="5554543">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="5554555">,</span>&nbsp;<span class="ident" id="5554557">mech</span><span class="op" id="5554561">,</span>&nbsp;<span class="ident" id="5554563">resp64</span><span class="op" id="5554569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554572">for</span>&nbsp;<span class="ident" id="5554576">err</span>&nbsp;<span class="op" id="5554580">==</span>&nbsp;<span class="ident" id="5554583">nil</span>&nbsp;<span class="op" id="5554587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554591">var</span>&nbsp;<span class="ident" id="5554595">msg</span>&nbsp;<span class="op" id="5554599">[</span><span class="op" id="5554600">]</span><span class="builtintype" id="5554601">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554608">switch</span>&nbsp;<span class="ident" id="5554615">code</span>&nbsp;<span class="op" id="5554620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554624">case</span>&nbsp;<span class="num" id="5554629">334</span><span class="op" id="5554632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554637">msg</span><span class="op" id="5554640">,</span>&nbsp;<span class="ident" id="5554642">err</span>&nbsp;<span class="op" id="5554646">=</span>&nbsp;<span class="ident" id="5554648">encoding</span><span class="op" id="5554656">.</span><span class="ident" id="5554657">DecodeString</span><span class="op" id="5554669">(</span><span class="ident" id="5554670">msg64</span><span class="op" id="5554675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554679">case</span>&nbsp;<span class="num" id="5554684">235</span><span class="op" id="5554687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5554692">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554757">msg</span>&nbsp;<span class="op" id="5554761">=</span>&nbsp;<span class="op" id="5554763">[</span><span class="op" id="5554764">]</span><span class="builtintype" id="5554765">byte</span><span class="op" id="5554769">(</span><span class="ident" id="5554770">msg64</span><span class="op" id="5554775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554779">default</span><span class="op" id="5554786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554791">err</span>&nbsp;<span class="op" id="5554795">=</span>&nbsp;<span class="op" id="5554797">&amp;</span><span class="ident" id="5554798">textproto</span><span class="op" id="5554807">.</span><span class="ident" id="5554808">Error</span><span class="op" id="5554813">{</span><span class="ident" id="5554814">Code</span><span class="op" id="5554818">:</span>&nbsp;<span class="ident" id="5554820">code</span><span class="op" id="5554824">,</span>&nbsp;<span class="ident" id="5554826">Msg</span><span class="op" id="5554829">:</span>&nbsp;<span class="ident" id="5554831">msg64</span><span class="op" id="5554836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554844">if</span>&nbsp;<span class="ident" id="5554847">err</span>&nbsp;<span class="op" id="5554851">==</span>&nbsp;<span class="ident" id="5554854">nil</span>&nbsp;<span class="op" id="5554858">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554863">resp</span><span class="op" id="5554867">,</span>&nbsp;<span class="ident" id="5554869">err</span>&nbsp;<span class="op" id="5554873">=</span>&nbsp;<span class="ident" id="5554875">a</span><span class="op" id="5554876">.</span><span class="ident" id="5554877">Next</span><span class="op" id="5554881">(</span><span class="ident" id="5554882">msg</span><span class="op" id="5554885">,</span>&nbsp;<span class="ident" id="5554887">code</span>&nbsp;<span class="op" id="5554892">==</span>&nbsp;<span class="num" id="5554895">334</span><span class="op" id="5554898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554906">if</span>&nbsp;<span class="ident" id="5554909">err</span>&nbsp;<span class="op" id="5554913">!=</span>&nbsp;<span class="ident" id="5554916">nil</span>&nbsp;<span class="op" id="5554920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5554925">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554946">c</span><span class="op" id="5554947">.</span><span class="ident" id="5554948">cmd</span><span class="op" id="5554951">(</span><span class="num" id="5554952">501</span><span class="op" id="5554955">,</span>&nbsp;<span class="string" id="5554957">&#34;*&#34;</span><span class="op" id="5554960">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554965">c</span><span class="op" id="5554966">.</span><span class="ident" id="5554967">Quit</span><span class="op" id="5554971">(</span><span class="op" id="5554972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554977">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554989">if</span>&nbsp;<span class="ident" id="5554992">resp</span>&nbsp;<span class="op" id="5554997">==</span>&nbsp;<span class="ident" id="5555000">nil</span>&nbsp;<span class="op" id="5555004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555009">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5555017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555021">resp64</span>&nbsp;<span class="op" id="5555028">=</span>&nbsp;<span class="builtinfunc" id="5555030">make</span><span class="op" id="5555034">(</span><span class="op" id="5555035">[</span><span class="op" id="5555036">]</span><span class="builtintype" id="5555037">byte</span><span class="op" id="5555041">,</span>&nbsp;<span class="ident" id="5555043">encoding</span><span class="op" id="5555051">.</span><span class="ident" id="5555052">EncodedLen</span><span class="op" id="5555062">(</span><span class="builtinfunc" id="5555063">len</span><span class="op" id="5555066">(</span><span class="ident" id="5555067">resp</span><span class="op" id="5555071">)</span><span class="op" id="5555072">)</span><span class="op" id="5555073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555077">encoding</span><span class="op" id="5555085">.</span><span class="ident" id="5555086">Encode</span><span class="op" id="5555092">(</span><span class="ident" id="5555093">resp64</span><span class="op" id="5555099">,</span>&nbsp;<span class="ident" id="5555101">resp</span><span class="op" id="5555105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555109">code</span><span class="op" id="5555113">,</span>&nbsp;<span class="ident" id="5555115">msg64</span><span class="op" id="5555120">,</span>&nbsp;<span class="ident" id="5555122">err</span>&nbsp;<span class="op" id="5555126">=</span>&nbsp;<span class="ident" id="5555128">c</span><span class="op" id="5555129">.</span><span class="ident" id="5555130">cmd</span><span class="op" id="5555133">(</span><span class="num" id="5555134">0</span><span class="op" id="5555135">,</span>&nbsp;<span class="builtintype" id="5555137">string</span><span class="op" id="5555143">(</span><span class="ident" id="5555144">resp64</span><span class="op" id="5555150">)</span><span class="op" id="5555151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5555154">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555157">return</span>&nbsp;<span class="ident" id="5555164">err</span><br>
<span class="lineno"></span><span class="op" id="5555168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5555171">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5555249">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="5555327">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5555341">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5555421">func</span>&nbsp;<span class="op" id="5555426">(</span><span class="ident" id="5555427">c</span>&nbsp;<span class="op" id="5555429">*</span><span class="ident" id="5555430">Client</span><span class="op" id="5555436">)</span>&nbsp;<span class="ident" id="5555438">Mail</span><span class="op" id="5555442">(</span><span class="ident" id="5555443">from</span>&nbsp;<span class="builtintype" id="5555448">string</span><span class="op" id="5555454">)</span>&nbsp;<span class="builtintype" id="5555456">error</span>&nbsp;<span class="op" id="5555462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555465">if</span>&nbsp;<span class="ident" id="5555468">err</span>&nbsp;<span class="op" id="5555472">:=</span>&nbsp;<span class="ident" id="5555475">c</span><span class="op" id="5555476">.</span><span class="ident" id="5555477">hello</span><span class="op" id="5555482">(</span><span class="op" id="5555483">)</span><span class="op" id="5555484">;</span>&nbsp;<span class="ident" id="5555486">err</span>&nbsp;<span class="op" id="5555490">!=</span>&nbsp;<span class="ident" id="5555493">nil</span>&nbsp;<span class="op" id="5555497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555501">return</span>&nbsp;<span class="ident" id="5555508">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5555513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555516">cmdStr</span>&nbsp;<span class="op" id="5555523">:=</span>&nbsp;<span class="string" id="5555526">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555544">if</span>&nbsp;<span class="ident" id="5555547">c</span><span class="op" id="5555548">.</span><span class="ident" id="5555549">ext</span>&nbsp;<span class="op" id="5555553">!=</span>&nbsp;<span class="ident" id="5555556">nil</span>&nbsp;<span class="op" id="5555560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555564">if</span>&nbsp;<span class="ident" id="5555567">_</span><span class="op" id="5555568">,</span>&nbsp;<span class="ident" id="5555570">ok</span>&nbsp;<span class="op" id="5555573">:=</span>&nbsp;<span class="ident" id="5555576">c</span><span class="op" id="5555577">.</span><span class="ident" id="5555578">ext</span><span class="op" id="5555581">[</span><span class="string" id="5555582">&#34;8BITMIME&#34;</span><span class="op" id="5555592">]</span><span class="op" id="5555593">;</span>&nbsp;<span class="ident" id="5555595">ok</span>&nbsp;<span class="op" id="5555598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555603">cmdStr</span>&nbsp;<span class="op" id="5555610">+=</span>&nbsp;<span class="string" id="5555613">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5555632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5555635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555638">_</span><span class="op" id="5555639">,</span>&nbsp;<span class="ident" id="5555641">_</span><span class="op" id="5555642">,</span>&nbsp;<span class="ident" id="5555644">err</span>&nbsp;<span class="op" id="5555648">:=</span>&nbsp;<span class="ident" id="5555651">c</span><span class="op" id="5555652">.</span><span class="ident" id="5555653">cmd</span><span class="op" id="5555656">(</span><span class="num" id="5555657">250</span><span class="op" id="5555660">,</span>&nbsp;<span class="ident" id="5555662">cmdStr</span><span class="op" id="5555668">,</span>&nbsp;<span class="ident" id="5555670">from</span><span class="op" id="5555674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555677">return</span>&nbsp;<span class="ident" id="5555684">err</span><br>
<span class="lineno"></span><span class="op" id="5555688">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5555691">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5555769">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5555845">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="5555882">func</span>&nbsp;<span class="op" id="5555887">(</span><span class="ident" id="5555888">c</span>&nbsp;<span class="op" id="5555890">*</span><span class="ident" id="5555891">Client</span><span class="op" id="5555897">)</span>&nbsp;<span class="ident" id="5555899">Rcpt</span><span class="op" id="5555903">(</span><span class="ident" id="5555904">to</span>&nbsp;<span class="builtintype" id="5555907">string</span><span class="op" id="5555913">)</span>&nbsp;<span class="builtintype" id="5555915">error</span>&nbsp;<span class="op" id="5555921">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5555924">_</span><span class="op" id="5555925">,</span>&nbsp;<span class="ident" id="5555927">_</span><span class="op" id="5555928">,</span>&nbsp;<span class="ident" id="5555930">err</span>&nbsp;<span class="op" id="5555934">:=</span>&nbsp;<span class="ident" id="5555937">c</span><span class="op" id="5555938">.</span><span class="ident" id="5555939">cmd</span><span class="op" id="5555942">(</span><span class="num" id="5555943">25</span><span class="op" id="5555945">,</span>&nbsp;<span class="string" id="5555947">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="5555961">,</span>&nbsp;<span class="ident" id="5555963">to</span><span class="op" id="5555965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5555968">return</span>&nbsp;<span class="ident" id="5555975">err</span><br>
<span class="lineno"></span><span class="op" id="5555979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5555982">type</span>&nbsp;<span class="ident" id="5555987">dataCloser</span>&nbsp;<span class="keyword" id="5555998">struct</span>&nbsp;<span class="op" id="5556005">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5556008">c</span>&nbsp;<span class="op" id="5556010">*</span><span class="ident" id="5556011">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5556019">io</span><span class="op" id="5556021">.</span><span class="ident" id="5556022">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="5556034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5556037">func</span>&nbsp;<span class="op" id="5556042">(</span><span class="ident" id="5556043">d</span>&nbsp;<span class="op" id="5556045">*</span><span class="ident" id="5556046">dataCloser</span><span class="op" id="5556056">)</span>&nbsp;<span class="ident" id="5556058">Close</span><span class="op" id="5556063">(</span><span class="op" id="5556064">)</span>&nbsp;<span class="builtintype" id="5556066">error</span>&nbsp;<span class="op" id="5556072">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5556075">d</span><span class="op" id="5556076">.</span><span class="ident" id="5556077">WriteCloser</span><span class="op" id="5556088">.</span><span class="ident" id="5556089">Close</span><span class="op" id="5556094">(</span><span class="op" id="5556095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5556098">_</span><span class="op" id="5556099">,</span>&nbsp;<span class="ident" id="5556101">_</span><span class="op" id="5556102">,</span>&nbsp;<span class="ident" id="5556104">err</span>&nbsp;<span class="op" id="5556108">:=</span>&nbsp;<span class="ident" id="5556111">d</span><span class="op" id="5556112">.</span><span class="ident" id="5556113">c</span><span class="op" id="5556114">.</span><span class="ident" id="5556115">Text</span><span class="op" id="5556119">.</span><span class="ident" id="5556120">ReadResponse</span><span class="op" id="5556132">(</span><span class="num" id="5556133">250</span><span class="op" id="5556136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556139">return</span>&nbsp;<span class="ident" id="5556146">err</span><br>
<span class="lineno"></span><span class="op" id="5556150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5556153">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5556223">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="5556292">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5556333">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="5556398">func</span>&nbsp;<span class="op" id="5556403">(</span><span class="ident" id="5556404">c</span>&nbsp;<span class="op" id="5556406">*</span><span class="ident" id="5556407">Client</span><span class="op" id="5556413">)</span>&nbsp;<span class="ident" id="5556415">Data</span><span class="op" id="5556419">(</span><span class="op" id="5556420">)</span>&nbsp;<span class="op" id="5556422">(</span><span class="ident" id="5556423">io</span><span class="op" id="5556425">.</span><span class="ident" id="5556426">WriteCloser</span><span class="op" id="5556437">,</span>&nbsp;<span class="builtintype" id="5556439">error</span><span class="op" id="5556444">)</span>&nbsp;<span class="op" id="5556446">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5556449">_</span><span class="op" id="5556450">,</span>&nbsp;<span class="ident" id="5556452">_</span><span class="op" id="5556453">,</span>&nbsp;<span class="ident" id="5556455">err</span>&nbsp;<span class="op" id="5556459">:=</span>&nbsp;<span class="ident" id="5556462">c</span><span class="op" id="5556463">.</span><span class="ident" id="5556464">cmd</span><span class="op" id="5556467">(</span><span class="num" id="5556468">354</span><span class="op" id="5556471">,</span>&nbsp;<span class="string" id="5556473">&#34;DATA&#34;</span><span class="op" id="5556479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556482">if</span>&nbsp;<span class="ident" id="5556485">err</span>&nbsp;<span class="op" id="5556489">!=</span>&nbsp;<span class="ident" id="5556492">nil</span>&nbsp;<span class="op" id="5556496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556500">return</span>&nbsp;<span class="ident" id="5556507">nil</span><span class="op" id="5556510">,</span>&nbsp;<span class="ident" id="5556512">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5556517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556520">return</span>&nbsp;<span class="op" id="5556527">&amp;</span><span class="ident" id="5556528">dataCloser</span><span class="op" id="5556538">{</span><span class="ident" id="5556539">c</span><span class="op" id="5556540">,</span>&nbsp;<span class="ident" id="5556542">c</span><span class="op" id="5556543">.</span><span class="ident" id="5556544">Text</span><span class="op" id="5556548">.</span><span class="ident" id="5556549">DotWriter</span><span class="op" id="5556558">(</span><span class="op" id="5556559">)</span><span class="op" id="5556560">}</span><span class="op" id="5556561">,</span>&nbsp;<span class="ident" id="5556563">nil</span><br>
<span class="lineno">265</span><span class="op" id="5556567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5556570">var</span>&nbsp;<span class="ident" id="5556574">testHookStartTLS</span>&nbsp;<span class="keyword" id="5556591">func</span><span class="op" id="5556595">(</span><span class="op" id="5556596">*</span><span class="ident" id="5556597">tls</span><span class="op" id="5556600">.</span><span class="ident" id="5556601">Config</span><span class="op" id="5556607">)</span>&nbsp;<span class="comment" id="5556609">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5556635">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="5556698">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="5556768">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5556836">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="5556852">func</span>&nbsp;<span class="ident" id="5556857">SendMail</span><span class="op" id="5556865">(</span><span class="ident" id="5556866">addr</span>&nbsp;<span class="builtintype" id="5556871">string</span><span class="op" id="5556877">,</span>&nbsp;<span class="ident" id="5556879">a</span>&nbsp;<span class="ident" id="5556881">Auth</span><span class="op" id="5556885">,</span>&nbsp;<span class="ident" id="5556887">from</span>&nbsp;<span class="builtintype" id="5556892">string</span><span class="op" id="5556898">,</span>&nbsp;<span class="ident" id="5556900">to</span>&nbsp;<span class="op" id="5556903">[</span><span class="op" id="5556904">]</span><span class="builtintype" id="5556905">string</span><span class="op" id="5556911">,</span>&nbsp;<span class="ident" id="5556913">msg</span>&nbsp;<span class="op" id="5556917">[</span><span class="op" id="5556918">]</span><span class="builtintype" id="5556919">byte</span><span class="op" id="5556923">)</span>&nbsp;<span class="builtintype" id="5556925">error</span>&nbsp;<span class="op" id="5556931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5556934">c</span><span class="op" id="5556935">,</span>&nbsp;<span class="ident" id="5556937">err</span>&nbsp;<span class="op" id="5556941">:=</span>&nbsp;<span class="ident" id="5556944">Dial</span><span class="op" id="5556948">(</span><span class="ident" id="5556949">addr</span><span class="op" id="5556953">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556956">if</span>&nbsp;<span class="ident" id="5556959">err</span>&nbsp;<span class="op" id="5556963">!=</span>&nbsp;<span class="ident" id="5556966">nil</span>&nbsp;<span class="op" id="5556970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556974">return</span>&nbsp;<span class="ident" id="5556981">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5556986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5556989">defer</span>&nbsp;<span class="ident" id="5556995">c</span><span class="op" id="5556996">.</span><span class="ident" id="5556997">Close</span><span class="op" id="5557002">(</span><span class="op" id="5557003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557006">if</span>&nbsp;<span class="ident" id="5557009">err</span>&nbsp;<span class="op" id="5557013">=</span>&nbsp;<span class="ident" id="5557015">c</span><span class="op" id="5557016">.</span><span class="ident" id="5557017">hello</span><span class="op" id="5557022">(</span><span class="op" id="5557023">)</span><span class="op" id="5557024">;</span>&nbsp;<span class="ident" id="5557026">err</span>&nbsp;<span class="op" id="5557030">!=</span>&nbsp;<span class="ident" id="5557033">nil</span>&nbsp;<span class="op" id="5557037">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557041">return</span>&nbsp;<span class="ident" id="5557048">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557056">if</span>&nbsp;<span class="ident" id="5557059">ok</span><span class="op" id="5557061">,</span>&nbsp;<span class="ident" id="5557063">_</span>&nbsp;<span class="op" id="5557065">:=</span>&nbsp;<span class="ident" id="5557068">c</span><span class="op" id="5557069">.</span><span class="ident" id="5557070">Extension</span><span class="op" id="5557079">(</span><span class="string" id="5557080">&#34;STARTTLS&#34;</span><span class="op" id="5557090">)</span><span class="op" id="5557091">;</span>&nbsp;<span class="ident" id="5557093">ok</span>&nbsp;<span class="op" id="5557096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557100">config</span>&nbsp;<span class="op" id="5557107">:=</span>&nbsp;<span class="op" id="5557110">&amp;</span><span class="ident" id="5557111">tls</span><span class="op" id="5557114">.</span><span class="ident" id="5557115">Config</span><span class="op" id="5557121">{</span><span class="ident" id="5557122">ServerName</span><span class="op" id="5557132">:</span>&nbsp;<span class="ident" id="5557134">c</span><span class="op" id="5557135">.</span><span class="ident" id="5557136">serverName</span><span class="op" id="5557146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557150">if</span>&nbsp;<span class="ident" id="5557153">testHookStartTLS</span>&nbsp;<span class="op" id="5557170">!=</span>&nbsp;<span class="ident" id="5557173">nil</span>&nbsp;<span class="op" id="5557177">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557182">testHookStartTLS</span><span class="op" id="5557198">(</span><span class="ident" id="5557199">config</span><span class="op" id="5557205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557213">if</span>&nbsp;<span class="ident" id="5557216">err</span>&nbsp;<span class="op" id="5557220">=</span>&nbsp;<span class="ident" id="5557222">c</span><span class="op" id="5557223">.</span><span class="ident" id="5557224">StartTLS</span><span class="op" id="5557232">(</span><span class="ident" id="5557233">config</span><span class="op" id="5557239">)</span><span class="op" id="5557240">;</span>&nbsp;<span class="ident" id="5557242">err</span>&nbsp;<span class="op" id="5557246">!=</span>&nbsp;<span class="ident" id="5557249">nil</span>&nbsp;<span class="op" id="5557253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557258">return</span>&nbsp;<span class="ident" id="5557265">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557271">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557277">if</span>&nbsp;<span class="ident" id="5557280">a</span>&nbsp;<span class="op" id="5557282">!=</span>&nbsp;<span class="ident" id="5557285">nil</span>&nbsp;<span class="op" id="5557289">&amp;&amp;</span>&nbsp;<span class="ident" id="5557292">c</span><span class="op" id="5557293">.</span><span class="ident" id="5557294">ext</span>&nbsp;<span class="op" id="5557298">!=</span>&nbsp;<span class="ident" id="5557301">nil</span>&nbsp;<span class="op" id="5557305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557309">if</span>&nbsp;<span class="ident" id="5557312">_</span><span class="op" id="5557313">,</span>&nbsp;<span class="ident" id="5557315">ok</span>&nbsp;<span class="op" id="5557318">:=</span>&nbsp;<span class="ident" id="5557321">c</span><span class="op" id="5557322">.</span><span class="ident" id="5557323">ext</span><span class="op" id="5557326">[</span><span class="string" id="5557327">&#34;AUTH&#34;</span><span class="op" id="5557333">]</span><span class="op" id="5557334">;</span>&nbsp;<span class="ident" id="5557336">ok</span>&nbsp;<span class="op" id="5557339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557344">if</span>&nbsp;<span class="ident" id="5557347">err</span>&nbsp;<span class="op" id="5557351">=</span>&nbsp;<span class="ident" id="5557353">c</span><span class="op" id="5557354">.</span><span class="ident" id="5557355">Auth</span><span class="op" id="5557359">(</span><span class="ident" id="5557360">a</span><span class="op" id="5557361">)</span><span class="op" id="5557362">;</span>&nbsp;<span class="ident" id="5557364">err</span>&nbsp;<span class="op" id="5557368">!=</span>&nbsp;<span class="ident" id="5557371">nil</span>&nbsp;<span class="op" id="5557375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557381">return</span>&nbsp;<span class="ident" id="5557388">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557405">if</span>&nbsp;<span class="ident" id="5557408">err</span>&nbsp;<span class="op" id="5557412">=</span>&nbsp;<span class="ident" id="5557414">c</span><span class="op" id="5557415">.</span><span class="ident" id="5557416">Mail</span><span class="op" id="5557420">(</span><span class="ident" id="5557421">from</span><span class="op" id="5557425">)</span><span class="op" id="5557426">;</span>&nbsp;<span class="ident" id="5557428">err</span>&nbsp;<span class="op" id="5557432">!=</span>&nbsp;<span class="ident" id="5557435">nil</span>&nbsp;<span class="op" id="5557439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557443">return</span>&nbsp;<span class="ident" id="5557450">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557458">for</span>&nbsp;<span class="ident" id="5557462">_</span><span class="op" id="5557463">,</span>&nbsp;<span class="ident" id="5557465">addr</span>&nbsp;<span class="op" id="5557470">:=</span>&nbsp;<span class="keyword" id="5557473">range</span>&nbsp;<span class="ident" id="5557479">to</span>&nbsp;<span class="op" id="5557482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557486">if</span>&nbsp;<span class="ident" id="5557489">err</span>&nbsp;<span class="op" id="5557493">=</span>&nbsp;<span class="ident" id="5557495">c</span><span class="op" id="5557496">.</span><span class="ident" id="5557497">Rcpt</span><span class="op" id="5557501">(</span><span class="ident" id="5557502">addr</span><span class="op" id="5557506">)</span><span class="op" id="5557507">;</span>&nbsp;<span class="ident" id="5557509">err</span>&nbsp;<span class="op" id="5557513">!=</span>&nbsp;<span class="ident" id="5557516">nil</span>&nbsp;<span class="op" id="5557520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557525">return</span>&nbsp;<span class="ident" id="5557532">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557538">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557544">w</span><span class="op" id="5557545">,</span>&nbsp;<span class="ident" id="5557547">err</span>&nbsp;<span class="op" id="5557551">:=</span>&nbsp;<span class="ident" id="5557554">c</span><span class="op" id="5557555">.</span><span class="ident" id="5557556">Data</span><span class="op" id="5557560">(</span><span class="op" id="5557561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557564">if</span>&nbsp;<span class="ident" id="5557567">err</span>&nbsp;<span class="op" id="5557571">!=</span>&nbsp;<span class="ident" id="5557574">nil</span>&nbsp;<span class="op" id="5557578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557582">return</span>&nbsp;<span class="ident" id="5557589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557594">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557597">_</span><span class="op" id="5557598">,</span>&nbsp;<span class="ident" id="5557600">err</span>&nbsp;<span class="op" id="5557604">=</span>&nbsp;<span class="ident" id="5557606">w</span><span class="op" id="5557607">.</span><span class="ident" id="5557608">Write</span><span class="op" id="5557613">(</span><span class="ident" id="5557614">msg</span><span class="op" id="5557617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557620">if</span>&nbsp;<span class="ident" id="5557623">err</span>&nbsp;<span class="op" id="5557627">!=</span>&nbsp;<span class="ident" id="5557630">nil</span>&nbsp;<span class="op" id="5557634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557638">return</span>&nbsp;<span class="ident" id="5557645">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557653">err</span>&nbsp;<span class="op" id="5557657">=</span>&nbsp;<span class="ident" id="5557659">w</span><span class="op" id="5557660">.</span><span class="ident" id="5557661">Close</span><span class="op" id="5557666">(</span><span class="op" id="5557667">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557670">if</span>&nbsp;<span class="ident" id="5557673">err</span>&nbsp;<span class="op" id="5557677">!=</span>&nbsp;<span class="ident" id="5557680">nil</span>&nbsp;<span class="op" id="5557684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557688">return</span>&nbsp;<span class="ident" id="5557695">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5557703">return</span>&nbsp;<span class="ident" id="5557710">c</span><span class="op" id="5557711">.</span><span class="ident" id="5557712">Quit</span><span class="op" id="5557716">(</span><span class="op" id="5557717">)</span><br>
<span class="lineno"></span><span class="op" id="5557719">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="5557722">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5557790">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="5557864">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5557932">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="5557971">func</span>&nbsp;<span class="op" id="5557976">(</span><span class="ident" id="5557977">c</span>&nbsp;<span class="op" id="5557979">*</span><span class="ident" id="5557980">Client</span><span class="op" id="5557986">)</span>&nbsp;<span class="ident" id="5557988">Extension</span><span class="op" id="5557997">(</span><span class="ident" id="5557998">ext</span>&nbsp;<span class="builtintype" id="5558002">string</span><span class="op" id="5558008">)</span>&nbsp;<span class="op" id="5558010">(</span><span class="builtintype" id="5558011">bool</span><span class="op" id="5558015">,</span>&nbsp;<span class="builtintype" id="5558017">string</span><span class="op" id="5558023">)</span>&nbsp;<span class="op" id="5558025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558028">if</span>&nbsp;<span class="ident" id="5558031">err</span>&nbsp;<span class="op" id="5558035">:=</span>&nbsp;<span class="ident" id="5558038">c</span><span class="op" id="5558039">.</span><span class="ident" id="5558040">hello</span><span class="op" id="5558045">(</span><span class="op" id="5558046">)</span><span class="op" id="5558047">;</span>&nbsp;<span class="ident" id="5558049">err</span>&nbsp;<span class="op" id="5558053">!=</span>&nbsp;<span class="ident" id="5558056">nil</span>&nbsp;<span class="op" id="5558060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558064">return</span>&nbsp;<span class="builtintype" id="5558071">false</span><span class="op" id="5558076">,</span>&nbsp;<span class="string" id="5558078">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5558082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558085">if</span>&nbsp;<span class="ident" id="5558088">c</span><span class="op" id="5558089">.</span><span class="ident" id="5558090">ext</span>&nbsp;<span class="op" id="5558094">==</span>&nbsp;<span class="ident" id="5558097">nil</span>&nbsp;<span class="op" id="5558101">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558105">return</span>&nbsp;<span class="builtintype" id="5558112">false</span><span class="op" id="5558117">,</span>&nbsp;<span class="string" id="5558119">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5558123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558126">ext</span>&nbsp;<span class="op" id="5558130">=</span>&nbsp;<span class="ident" id="5558132">strings</span><span class="op" id="5558139">.</span><span class="ident" id="5558140">ToUpper</span><span class="op" id="5558147">(</span><span class="ident" id="5558148">ext</span><span class="op" id="5558151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558154">param</span><span class="op" id="5558159">,</span>&nbsp;<span class="ident" id="5558161">ok</span>&nbsp;<span class="op" id="5558164">:=</span>&nbsp;<span class="ident" id="5558167">c</span><span class="op" id="5558168">.</span><span class="ident" id="5558169">ext</span><span class="op" id="5558172">[</span><span class="ident" id="5558173">ext</span><span class="op" id="5558176">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558179">return</span>&nbsp;<span class="ident" id="5558186">ok</span><span class="op" id="5558188">,</span>&nbsp;<span class="ident" id="5558190">param</span><br>
<span class="lineno">335</span><span class="op" id="5558196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5558199">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="5558272">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5558288">func</span>&nbsp;<span class="op" id="5558293">(</span><span class="ident" id="5558294">c</span>&nbsp;<span class="op" id="5558296">*</span><span class="ident" id="5558297">Client</span><span class="op" id="5558303">)</span>&nbsp;<span class="ident" id="5558305">Reset</span><span class="op" id="5558310">(</span><span class="op" id="5558311">)</span>&nbsp;<span class="builtintype" id="5558313">error</span>&nbsp;<span class="op" id="5558319">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558322">if</span>&nbsp;<span class="ident" id="5558325">err</span>&nbsp;<span class="op" id="5558329">:=</span>&nbsp;<span class="ident" id="5558332">c</span><span class="op" id="5558333">.</span><span class="ident" id="5558334">hello</span><span class="op" id="5558339">(</span><span class="op" id="5558340">)</span><span class="op" id="5558341">;</span>&nbsp;<span class="ident" id="5558343">err</span>&nbsp;<span class="op" id="5558347">!=</span>&nbsp;<span class="ident" id="5558350">nil</span>&nbsp;<span class="op" id="5558354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558358">return</span>&nbsp;<span class="ident" id="5558365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5558370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558373">_</span><span class="op" id="5558374">,</span>&nbsp;<span class="ident" id="5558376">_</span><span class="op" id="5558377">,</span>&nbsp;<span class="ident" id="5558379">err</span>&nbsp;<span class="op" id="5558383">:=</span>&nbsp;<span class="ident" id="5558386">c</span><span class="op" id="5558387">.</span><span class="ident" id="5558388">cmd</span><span class="op" id="5558391">(</span><span class="num" id="5558392">250</span><span class="op" id="5558395">,</span>&nbsp;<span class="string" id="5558397">&#34;RSET&#34;</span><span class="op" id="5558403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558406">return</span>&nbsp;<span class="ident" id="5558413">err</span><br>
<span class="lineno">345</span><span class="op" id="5558417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5558420">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5558492">func</span>&nbsp;<span class="op" id="5558497">(</span><span class="ident" id="5558498">c</span>&nbsp;<span class="op" id="5558500">*</span><span class="ident" id="5558501">Client</span><span class="op" id="5558507">)</span>&nbsp;<span class="ident" id="5558509">Quit</span><span class="op" id="5558513">(</span><span class="op" id="5558514">)</span>&nbsp;<span class="builtintype" id="5558516">error</span>&nbsp;<span class="op" id="5558522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558525">if</span>&nbsp;<span class="ident" id="5558528">err</span>&nbsp;<span class="op" id="5558532">:=</span>&nbsp;<span class="ident" id="5558535">c</span><span class="op" id="5558536">.</span><span class="ident" id="5558537">hello</span><span class="op" id="5558542">(</span><span class="op" id="5558543">)</span><span class="op" id="5558544">;</span>&nbsp;<span class="ident" id="5558546">err</span>&nbsp;<span class="op" id="5558550">!=</span>&nbsp;<span class="ident" id="5558553">nil</span>&nbsp;<span class="op" id="5558557">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558561">return</span>&nbsp;<span class="ident" id="5558568">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5558573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558576">_</span><span class="op" id="5558577">,</span>&nbsp;<span class="ident" id="5558579">_</span><span class="op" id="5558580">,</span>&nbsp;<span class="ident" id="5558582">err</span>&nbsp;<span class="op" id="5558586">:=</span>&nbsp;<span class="ident" id="5558589">c</span><span class="op" id="5558590">.</span><span class="ident" id="5558591">cmd</span><span class="op" id="5558594">(</span><span class="num" id="5558595">221</span><span class="op" id="5558598">,</span>&nbsp;<span class="string" id="5558600">&#34;QUIT&#34;</span><span class="op" id="5558606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558609">if</span>&nbsp;<span class="ident" id="5558612">err</span>&nbsp;<span class="op" id="5558616">!=</span>&nbsp;<span class="ident" id="5558619">nil</span>&nbsp;<span class="op" id="5558623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558627">return</span>&nbsp;<span class="ident" id="5558634">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5558639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558642">return</span>&nbsp;<span class="ident" id="5558649">c</span><span class="op" id="5558650">.</span><span class="ident" id="5558651">Text</span><span class="op" id="5558655">.</span><span class="ident" id="5558656">Close</span><span class="op" id="5558661">(</span><span class="op" id="5558662">)</span><br>
<span class="lineno"></span><span class="op" id="5558664">}</span>
</div>
</body>
</html>
