<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html" class="current">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5095568">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5095623">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5095677">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5095728">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5095782">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5095830">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5095882">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5095933">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5096006">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5096078">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5096155">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5096229">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5096307">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5096382">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5096459">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5096520">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5096591">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5096668">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5096743">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5096822">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5096898">package</span>&nbsp;<span class="ident" id="5096906">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5096919">import</span>&nbsp;<span class="string" id="5096926">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5096934">func</span>&nbsp;<span class="ident" id="5096939">qsufsort</span><span class="op" id="5096947">(</span><span class="ident" id="5096948">data</span>&nbsp;<span class="op" id="5096953">[</span><span class="op" id="5096954">]</span><span class="builtintype" id="5096955">byte</span><span class="op" id="5096959">)</span>&nbsp;<span class="op" id="5096961">[</span><span class="op" id="5096962">]</span><span class="builtintype" id="5096963">int</span>&nbsp;<span class="op" id="5096967">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5096970">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097014">sa</span>&nbsp;<span class="op" id="5097017">:=</span>&nbsp;<span class="ident" id="5097020">sortedByFirstByte</span><span class="op" id="5097037">(</span><span class="ident" id="5097038">data</span><span class="op" id="5097042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097045">if</span>&nbsp;<span class="builtinfunc" id="5097048">len</span><span class="op" id="5097051">(</span><span class="ident" id="5097052">sa</span><span class="op" id="5097054">)</span>&nbsp;<span class="op" id="5097056">&lt;</span>&nbsp;<span class="num" id="5097058">2</span>&nbsp;<span class="op" id="5097060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097064">return</span>&nbsp;<span class="ident" id="5097071">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097075">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097078">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097116">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097192">inv</span>&nbsp;<span class="op" id="5097196">:=</span>&nbsp;<span class="ident" id="5097199">initGroups</span><span class="op" id="5097209">(</span><span class="ident" id="5097210">sa</span><span class="op" id="5097212">,</span>&nbsp;<span class="ident" id="5097214">data</span><span class="op" id="5097218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097222">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097253">sufSortable</span>&nbsp;<span class="op" id="5097265">:=</span>&nbsp;<span class="op" id="5097268">&amp;</span><span class="ident" id="5097269">suffixSortable</span><span class="op" id="5097283">{</span><span class="ident" id="5097284">sa</span><span class="op" id="5097286">:</span>&nbsp;<span class="ident" id="5097288">sa</span><span class="op" id="5097290">,</span>&nbsp;<span class="ident" id="5097292">inv</span><span class="op" id="5097295">:</span>&nbsp;<span class="ident" id="5097297">inv</span><span class="op" id="5097300">,</span>&nbsp;<span class="ident" id="5097302">h</span><span class="op" id="5097303">:</span>&nbsp;<span class="num" id="5097305">1</span><span class="op" id="5097306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097310">for</span>&nbsp;<span class="ident" id="5097314">sa</span><span class="op" id="5097316">[</span><span class="num" id="5097317">0</span><span class="op" id="5097318">]</span>&nbsp;<span class="op" id="5097320">&gt;</span>&nbsp;<span class="op" id="5097322">-</span><span class="builtinfunc" id="5097323">len</span><span class="op" id="5097326">(</span><span class="ident" id="5097327">sa</span><span class="op" id="5097329">)</span>&nbsp;<span class="op" id="5097331">{</span>&nbsp;<span class="comment" id="5097333">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097382">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097437">pi</span>&nbsp;<span class="op" id="5097440">:=</span>&nbsp;<span class="num" id="5097443">0</span>&nbsp;<span class="comment" id="5097445">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097486">sl</span>&nbsp;<span class="op" id="5097489">:=</span>&nbsp;<span class="num" id="5097492">0</span>&nbsp;<span class="comment" id="5097494">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097537">for</span>&nbsp;<span class="ident" id="5097541">pi</span>&nbsp;<span class="op" id="5097544">&lt;</span>&nbsp;<span class="builtinfunc" id="5097546">len</span><span class="op" id="5097549">(</span><span class="ident" id="5097550">sa</span><span class="op" id="5097552">)</span>&nbsp;<span class="op" id="5097554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097559">if</span>&nbsp;<span class="ident" id="5097562">s</span>&nbsp;<span class="op" id="5097564">:=</span>&nbsp;<span class="ident" id="5097567">sa</span><span class="op" id="5097569">[</span><span class="ident" id="5097570">pi</span><span class="op" id="5097572">]</span><span class="op" id="5097573">;</span>&nbsp;<span class="ident" id="5097575">s</span>&nbsp;<span class="op" id="5097577">&lt;</span>&nbsp;<span class="num" id="5097579">0</span>&nbsp;<span class="op" id="5097581">{</span>&nbsp;<span class="comment" id="5097583">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097616">pi</span>&nbsp;<span class="op" id="5097619">-=</span>&nbsp;<span class="ident" id="5097622">s</span>&nbsp;<span class="comment" id="5097624">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097654">sl</span>&nbsp;<span class="op" id="5097657">+=</span>&nbsp;<span class="ident" id="5097660">s</span>&nbsp;<span class="comment" id="5097662">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097693">}</span>&nbsp;<span class="keyword" id="5097695">else</span>&nbsp;<span class="op" id="5097700">{</span>&nbsp;<span class="comment" id="5097702">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097737">if</span>&nbsp;<span class="ident" id="5097740">sl</span>&nbsp;<span class="op" id="5097743">!=</span>&nbsp;<span class="num" id="5097746">0</span>&nbsp;<span class="op" id="5097748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097755">sa</span><span class="op" id="5097757">[</span><span class="ident" id="5097758">pi</span><span class="op" id="5097760">+</span><span class="ident" id="5097761">sl</span><span class="op" id="5097763">]</span>&nbsp;<span class="op" id="5097765">=</span>&nbsp;<span class="ident" id="5097767">sl</span>&nbsp;<span class="comment" id="5097770">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097810">sl</span>&nbsp;<span class="op" id="5097813">=</span>&nbsp;<span class="num" id="5097815">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097821">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097827">pk</span>&nbsp;<span class="op" id="5097830">:=</span>&nbsp;<span class="ident" id="5097833">inv</span><span class="op" id="5097836">[</span><span class="ident" id="5097837">s</span><span class="op" id="5097838">]</span>&nbsp;<span class="op" id="5097840">+</span>&nbsp;<span class="num" id="5097842">1</span>&nbsp;<span class="comment" id="5097844">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097891">sufSortable</span><span class="op" id="5097902">.</span><span class="ident" id="5097903">sa</span>&nbsp;<span class="op" id="5097906">=</span>&nbsp;<span class="ident" id="5097908">sa</span><span class="op" id="5097910">[</span><span class="ident" id="5097911">pi</span><span class="op" id="5097913">:</span><span class="ident" id="5097914">pk</span><span class="op" id="5097916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097922">sort</span><span class="op" id="5097926">.</span><span class="ident" id="5097927">Sort</span><span class="op" id="5097931">(</span><span class="ident" id="5097932">sufSortable</span><span class="op" id="5097943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097949">sufSortable</span><span class="op" id="5097960">.</span><span class="ident" id="5097961">updateGroups</span><span class="op" id="5097973">(</span><span class="ident" id="5097974">pi</span><span class="op" id="5097976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097982">pi</span>&nbsp;<span class="op" id="5097985">=</span>&nbsp;<span class="ident" id="5097987">pk</span>&nbsp;<span class="comment" id="5097990">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098015">if</span>&nbsp;<span class="ident" id="5098018">sl</span>&nbsp;<span class="op" id="5098021">!=</span>&nbsp;<span class="num" id="5098024">0</span>&nbsp;<span class="op" id="5098026">{</span>&nbsp;<span class="comment" id="5098028">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098072">sa</span><span class="op" id="5098074">[</span><span class="ident" id="5098075">pi</span><span class="op" id="5098077">+</span><span class="ident" id="5098078">sl</span><span class="op" id="5098080">]</span>&nbsp;<span class="op" id="5098082">=</span>&nbsp;<span class="ident" id="5098084">sl</span>&nbsp;<span class="comment" id="5098087">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098127">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098132">sufSortable</span><span class="op" id="5098143">.</span><span class="ident" id="5098144">h</span>&nbsp;<span class="op" id="5098146">*=</span>&nbsp;<span class="num" id="5098149">2</span>&nbsp;<span class="comment" id="5098151">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098179">for</span>&nbsp;<span class="ident" id="5098183">i</span>&nbsp;<span class="op" id="5098185">:=</span>&nbsp;<span class="keyword" id="5098188">range</span>&nbsp;<span class="ident" id="5098194">sa</span>&nbsp;<span class="op" id="5098197">{</span>&nbsp;<span class="comment" id="5098199">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098242">sa</span><span class="op" id="5098244">[</span><span class="ident" id="5098245">inv</span><span class="op" id="5098248">[</span><span class="ident" id="5098249">i</span><span class="op" id="5098250">]</span><span class="op" id="5098251">]</span>&nbsp;<span class="op" id="5098253">=</span>&nbsp;<span class="ident" id="5098255">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098261">return</span>&nbsp;<span class="ident" id="5098268">sa</span><br>
<span class="lineno"></span><span class="op" id="5098271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5098274">func</span>&nbsp;<span class="ident" id="5098279">sortedByFirstByte</span><span class="op" id="5098296">(</span><span class="ident" id="5098297">data</span>&nbsp;<span class="op" id="5098302">[</span><span class="op" id="5098303">]</span><span class="builtintype" id="5098304">byte</span><span class="op" id="5098308">)</span>&nbsp;<span class="op" id="5098310">[</span><span class="op" id="5098311">]</span><span class="builtintype" id="5098312">int</span>&nbsp;<span class="op" id="5098316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098319">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098341">var</span>&nbsp;<span class="ident" id="5098345">count</span>&nbsp;<span class="op" id="5098351">[</span><span class="num" id="5098352">256</span><span class="op" id="5098355">]</span><span class="builtintype" id="5098356">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098361">for</span>&nbsp;<span class="ident" id="5098365">_</span><span class="op" id="5098366">,</span>&nbsp;<span class="ident" id="5098368">b</span>&nbsp;<span class="op" id="5098370">:=</span>&nbsp;<span class="keyword" id="5098373">range</span>&nbsp;<span class="ident" id="5098379">data</span>&nbsp;<span class="op" id="5098384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098388">count</span><span class="op" id="5098393">[</span><span class="ident" id="5098394">b</span><span class="op" id="5098395">]</span><span class="op" id="5098396">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098403">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098474">sum</span>&nbsp;<span class="op" id="5098478">:=</span>&nbsp;<span class="num" id="5098481">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098484">for</span>&nbsp;<span class="ident" id="5098488">b</span>&nbsp;<span class="op" id="5098490">:=</span>&nbsp;<span class="keyword" id="5098493">range</span>&nbsp;<span class="ident" id="5098499">count</span>&nbsp;<span class="op" id="5098505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098509">count</span><span class="op" id="5098514">[</span><span class="ident" id="5098515">b</span><span class="op" id="5098516">]</span><span class="op" id="5098517">,</span>&nbsp;<span class="ident" id="5098519">sum</span>&nbsp;<span class="op" id="5098523">=</span>&nbsp;<span class="ident" id="5098525">sum</span><span class="op" id="5098528">,</span>&nbsp;<span class="ident" id="5098530">count</span><span class="op" id="5098535">[</span><span class="ident" id="5098536">b</span><span class="op" id="5098537">]</span><span class="op" id="5098538">+</span><span class="ident" id="5098539">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098547">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098616">sa</span>&nbsp;<span class="op" id="5098619">:=</span>&nbsp;<span class="builtinfunc" id="5098622">make</span><span class="op" id="5098626">(</span><span class="op" id="5098627">[</span><span class="op" id="5098628">]</span><span class="builtintype" id="5098629">int</span><span class="op" id="5098632">,</span>&nbsp;<span class="builtinfunc" id="5098634">len</span><span class="op" id="5098637">(</span><span class="ident" id="5098638">data</span><span class="op" id="5098642">)</span><span class="op" id="5098643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098646">for</span>&nbsp;<span class="ident" id="5098650">i</span><span class="op" id="5098651">,</span>&nbsp;<span class="ident" id="5098653">b</span>&nbsp;<span class="op" id="5098655">:=</span>&nbsp;<span class="keyword" id="5098658">range</span>&nbsp;<span class="ident" id="5098664">data</span>&nbsp;<span class="op" id="5098669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098673">sa</span><span class="op" id="5098675">[</span><span class="ident" id="5098676">count</span><span class="op" id="5098681">[</span><span class="ident" id="5098682">b</span><span class="op" id="5098683">]</span><span class="op" id="5098684">]</span>&nbsp;<span class="op" id="5098686">=</span>&nbsp;<span class="ident" id="5098688">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098692">count</span><span class="op" id="5098697">[</span><span class="ident" id="5098698">b</span><span class="op" id="5098699">]</span><span class="op" id="5098700">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098707">return</span>&nbsp;<span class="ident" id="5098714">sa</span><br>
<span class="lineno"></span><span class="op" id="5098717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5098720">func</span>&nbsp;<span class="ident" id="5098725">initGroups</span><span class="op" id="5098735">(</span><span class="ident" id="5098736">sa</span>&nbsp;<span class="op" id="5098739">[</span><span class="op" id="5098740">]</span><span class="builtintype" id="5098741">int</span><span class="op" id="5098744">,</span>&nbsp;<span class="ident" id="5098746">data</span>&nbsp;<span class="op" id="5098751">[</span><span class="op" id="5098752">]</span><span class="builtintype" id="5098753">byte</span><span class="op" id="5098757">)</span>&nbsp;<span class="op" id="5098759">[</span><span class="op" id="5098760">]</span><span class="builtintype" id="5098761">int</span>&nbsp;<span class="op" id="5098765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098768">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098835">inv</span>&nbsp;<span class="op" id="5098839">:=</span>&nbsp;<span class="builtinfunc" id="5098842">make</span><span class="op" id="5098846">(</span><span class="op" id="5098847">[</span><span class="op" id="5098848">]</span><span class="builtintype" id="5098849">int</span><span class="op" id="5098852">,</span>&nbsp;<span class="builtinfunc" id="5098854">len</span><span class="op" id="5098857">(</span><span class="ident" id="5098858">data</span><span class="op" id="5098862">)</span><span class="op" id="5098863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098866">prevGroup</span>&nbsp;<span class="op" id="5098876">:=</span>&nbsp;<span class="builtinfunc" id="5098879">len</span><span class="op" id="5098882">(</span><span class="ident" id="5098883">sa</span><span class="op" id="5098885">)</span>&nbsp;<span class="op" id="5098887">-</span>&nbsp;<span class="num" id="5098889">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098892">groupByte</span>&nbsp;<span class="op" id="5098902">:=</span>&nbsp;<span class="ident" id="5098905">data</span><span class="op" id="5098909">[</span><span class="ident" id="5098910">sa</span><span class="op" id="5098912">[</span><span class="ident" id="5098913">prevGroup</span><span class="op" id="5098922">]</span><span class="op" id="5098923">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098926">for</span>&nbsp;<span class="ident" id="5098930">i</span>&nbsp;<span class="op" id="5098932">:=</span>&nbsp;<span class="builtinfunc" id="5098935">len</span><span class="op" id="5098938">(</span><span class="ident" id="5098939">sa</span><span class="op" id="5098941">)</span>&nbsp;<span class="op" id="5098943">-</span>&nbsp;<span class="num" id="5098945">1</span><span class="op" id="5098946">;</span>&nbsp;<span class="ident" id="5098948">i</span>&nbsp;<span class="op" id="5098950">&gt;=</span>&nbsp;<span class="num" id="5098953">0</span><span class="op" id="5098954">;</span>&nbsp;<span class="ident" id="5098956">i</span><span class="op" id="5098957">--</span>&nbsp;<span class="op" id="5098960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098964">if</span>&nbsp;<span class="ident" id="5098967">b</span>&nbsp;<span class="op" id="5098969">:=</span>&nbsp;<span class="ident" id="5098972">data</span><span class="op" id="5098976">[</span><span class="ident" id="5098977">sa</span><span class="op" id="5098979">[</span><span class="ident" id="5098980">i</span><span class="op" id="5098981">]</span><span class="op" id="5098982">]</span><span class="op" id="5098983">;</span>&nbsp;<span class="ident" id="5098985">b</span>&nbsp;<span class="op" id="5098987">&lt;</span>&nbsp;<span class="ident" id="5098989">groupByte</span>&nbsp;<span class="op" id="5098999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099004">if</span>&nbsp;<span class="ident" id="5099007">prevGroup</span>&nbsp;<span class="op" id="5099017">==</span>&nbsp;<span class="ident" id="5099020">i</span><span class="op" id="5099021">+</span><span class="num" id="5099022">1</span>&nbsp;<span class="op" id="5099024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099030">sa</span><span class="op" id="5099032">[</span><span class="ident" id="5099033">i</span><span class="op" id="5099034">+</span><span class="num" id="5099035">1</span><span class="op" id="5099036">]</span>&nbsp;<span class="op" id="5099038">=</span>&nbsp;<span class="op" id="5099040">-</span><span class="num" id="5099041">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099046">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099051">groupByte</span>&nbsp;<span class="op" id="5099061">=</span>&nbsp;<span class="ident" id="5099063">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099068">prevGroup</span>&nbsp;<span class="op" id="5099078">=</span>&nbsp;<span class="ident" id="5099080">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099088">inv</span><span class="op" id="5099091">[</span><span class="ident" id="5099092">sa</span><span class="op" id="5099094">[</span><span class="ident" id="5099095">i</span><span class="op" id="5099096">]</span><span class="op" id="5099097">]</span>&nbsp;<span class="op" id="5099099">=</span>&nbsp;<span class="ident" id="5099101">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099113">if</span>&nbsp;<span class="ident" id="5099116">prevGroup</span>&nbsp;<span class="op" id="5099126">==</span>&nbsp;<span class="num" id="5099129">0</span>&nbsp;<span class="op" id="5099131">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099136">sa</span><span class="op" id="5099138">[</span><span class="num" id="5099139">0</span><span class="op" id="5099140">]</span>&nbsp;<span class="op" id="5099142">=</span>&nbsp;<span class="op" id="5099144">-</span><span class="num" id="5099145">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099155">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099216">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099279">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099323">lastByte</span>&nbsp;<span class="op" id="5099332">:=</span>&nbsp;<span class="ident" id="5099335">data</span><span class="op" id="5099339">[</span><span class="builtinfunc" id="5099340">len</span><span class="op" id="5099343">(</span><span class="ident" id="5099344">data</span><span class="op" id="5099348">)</span><span class="op" id="5099349">-</span><span class="num" id="5099350">1</span><span class="op" id="5099351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099354">s</span>&nbsp;<span class="op" id="5099356">:=</span>&nbsp;<span class="op" id="5099359">-</span><span class="num" id="5099360">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099363">for</span>&nbsp;<span class="ident" id="5099367">i</span>&nbsp;<span class="op" id="5099369">:=</span>&nbsp;<span class="keyword" id="5099372">range</span>&nbsp;<span class="ident" id="5099378">sa</span>&nbsp;<span class="op" id="5099381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099385">if</span>&nbsp;<span class="ident" id="5099388">sa</span><span class="op" id="5099390">[</span><span class="ident" id="5099391">i</span><span class="op" id="5099392">]</span>&nbsp;<span class="op" id="5099394">&gt;=</span>&nbsp;<span class="num" id="5099397">0</span>&nbsp;<span class="op" id="5099399">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099404">if</span>&nbsp;<span class="ident" id="5099407">data</span><span class="op" id="5099411">[</span><span class="ident" id="5099412">sa</span><span class="op" id="5099414">[</span><span class="ident" id="5099415">i</span><span class="op" id="5099416">]</span><span class="op" id="5099417">]</span>&nbsp;<span class="op" id="5099419">==</span>&nbsp;<span class="ident" id="5099422">lastByte</span>&nbsp;<span class="op" id="5099431">&amp;&amp;</span>&nbsp;<span class="ident" id="5099434">s</span>&nbsp;<span class="op" id="5099436">==</span>&nbsp;<span class="op" id="5099439">-</span><span class="num" id="5099440">1</span>&nbsp;<span class="op" id="5099442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099448">s</span>&nbsp;<span class="op" id="5099450">=</span>&nbsp;<span class="ident" id="5099452">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099462">if</span>&nbsp;<span class="ident" id="5099465">sa</span><span class="op" id="5099467">[</span><span class="ident" id="5099468">i</span><span class="op" id="5099469">]</span>&nbsp;<span class="op" id="5099471">==</span>&nbsp;<span class="builtinfunc" id="5099474">len</span><span class="op" id="5099477">(</span><span class="ident" id="5099478">sa</span><span class="op" id="5099480">)</span><span class="op" id="5099481">-</span><span class="num" id="5099482">1</span>&nbsp;<span class="op" id="5099484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099490">sa</span><span class="op" id="5099492">[</span><span class="ident" id="5099493">i</span><span class="op" id="5099494">]</span><span class="op" id="5099495">,</span>&nbsp;<span class="ident" id="5099497">sa</span><span class="op" id="5099499">[</span><span class="ident" id="5099500">s</span><span class="op" id="5099501">]</span>&nbsp;<span class="op" id="5099503">=</span>&nbsp;<span class="ident" id="5099505">sa</span><span class="op" id="5099507">[</span><span class="ident" id="5099508">s</span><span class="op" id="5099509">]</span><span class="op" id="5099510">,</span>&nbsp;<span class="ident" id="5099512">sa</span><span class="op" id="5099514">[</span><span class="ident" id="5099515">i</span><span class="op" id="5099516">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099522">inv</span><span class="op" id="5099525">[</span><span class="ident" id="5099526">sa</span><span class="op" id="5099528">[</span><span class="ident" id="5099529">s</span><span class="op" id="5099530">]</span><span class="op" id="5099531">]</span>&nbsp;<span class="op" id="5099533">=</span>&nbsp;<span class="ident" id="5099535">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099541">sa</span><span class="op" id="5099543">[</span><span class="ident" id="5099544">s</span><span class="op" id="5099545">]</span>&nbsp;<span class="op" id="5099547">=</span>&nbsp;<span class="op" id="5099549">-</span><span class="num" id="5099550">1</span>&nbsp;<span class="comment" id="5099552">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099595">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099608">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099614">return</span>&nbsp;<span class="ident" id="5099621">inv</span><br>
<span class="lineno"></span><span class="op" id="5099625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5099628">type</span>&nbsp;<span class="ident" id="5099633">suffixSortable</span>&nbsp;<span class="keyword" id="5099648">struct</span>&nbsp;<span class="op" id="5099655">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099658">sa</span>&nbsp;&nbsp;<span class="op" id="5099662">[</span><span class="op" id="5099663">]</span><span class="builtintype" id="5099664">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099669">inv</span>&nbsp;<span class="op" id="5099673">[</span><span class="op" id="5099674">]</span><span class="builtintype" id="5099675">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099680">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5099684">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099689">buf</span>&nbsp;<span class="op" id="5099693">[</span><span class="op" id="5099694">]</span><span class="builtintype" id="5099695">int</span>&nbsp;<span class="comment" id="5099699">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5099723">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5099726">func</span>&nbsp;<span class="op" id="5099731">(</span><span class="ident" id="5099732">x</span>&nbsp;<span class="op" id="5099734">*</span><span class="ident" id="5099735">suffixSortable</span><span class="op" id="5099749">)</span>&nbsp;<span class="ident" id="5099751">Len</span><span class="op" id="5099754">(</span><span class="op" id="5099755">)</span>&nbsp;<span class="builtintype" id="5099757">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5099771">{</span>&nbsp;<span class="keyword" id="5099773">return</span>&nbsp;<span class="builtinfunc" id="5099780">len</span><span class="op" id="5099783">(</span><span class="ident" id="5099784">x</span><span class="op" id="5099785">.</span><span class="ident" id="5099786">sa</span><span class="op" id="5099788">)</span>&nbsp;<span class="op" id="5099790">}</span><br>
<span class="lineno"></span><span class="keyword" id="5099792">func</span>&nbsp;<span class="op" id="5099797">(</span><span class="ident" id="5099798">x</span>&nbsp;<span class="op" id="5099800">*</span><span class="ident" id="5099801">suffixSortable</span><span class="op" id="5099815">)</span>&nbsp;<span class="ident" id="5099817">Less</span><span class="op" id="5099821">(</span><span class="ident" id="5099822">i</span><span class="op" id="5099823">,</span>&nbsp;<span class="ident" id="5099825">j</span>&nbsp;<span class="builtintype" id="5099827">int</span><span class="op" id="5099830">)</span>&nbsp;<span class="builtintype" id="5099832">bool</span>&nbsp;<span class="op" id="5099837">{</span>&nbsp;<span class="keyword" id="5099839">return</span>&nbsp;<span class="ident" id="5099846">x</span><span class="op" id="5099847">.</span><span class="ident" id="5099848">inv</span><span class="op" id="5099851">[</span><span class="ident" id="5099852">x</span><span class="op" id="5099853">.</span><span class="ident" id="5099854">sa</span><span class="op" id="5099856">[</span><span class="ident" id="5099857">i</span><span class="op" id="5099858">]</span><span class="op" id="5099859">+</span><span class="ident" id="5099860">x</span><span class="op" id="5099861">.</span><span class="ident" id="5099862">h</span><span class="op" id="5099863">]</span>&nbsp;<span class="op" id="5099865">&lt;</span>&nbsp;<span class="ident" id="5099867">x</span><span class="op" id="5099868">.</span><span class="ident" id="5099869">inv</span><span class="op" id="5099872">[</span><span class="ident" id="5099873">x</span><span class="op" id="5099874">.</span><span class="ident" id="5099875">sa</span><span class="op" id="5099877">[</span><span class="ident" id="5099878">j</span><span class="op" id="5099879">]</span><span class="op" id="5099880">+</span><span class="ident" id="5099881">x</span><span class="op" id="5099882">.</span><span class="ident" id="5099883">h</span><span class="op" id="5099884">]</span>&nbsp;<span class="op" id="5099886">}</span><br>
<span class="lineno"></span><span class="keyword" id="5099888">func</span>&nbsp;<span class="op" id="5099893">(</span><span class="ident" id="5099894">x</span>&nbsp;<span class="op" id="5099896">*</span><span class="ident" id="5099897">suffixSortable</span><span class="op" id="5099911">)</span>&nbsp;<span class="ident" id="5099913">Swap</span><span class="op" id="5099917">(</span><span class="ident" id="5099918">i</span><span class="op" id="5099919">,</span>&nbsp;<span class="ident" id="5099921">j</span>&nbsp;<span class="builtintype" id="5099923">int</span><span class="op" id="5099926">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5099933">{</span>&nbsp;<span class="ident" id="5099935">x</span><span class="op" id="5099936">.</span><span class="ident" id="5099937">sa</span><span class="op" id="5099939">[</span><span class="ident" id="5099940">i</span><span class="op" id="5099941">]</span><span class="op" id="5099942">,</span>&nbsp;<span class="ident" id="5099944">x</span><span class="op" id="5099945">.</span><span class="ident" id="5099946">sa</span><span class="op" id="5099948">[</span><span class="ident" id="5099949">j</span><span class="op" id="5099950">]</span>&nbsp;<span class="op" id="5099952">=</span>&nbsp;<span class="ident" id="5099954">x</span><span class="op" id="5099955">.</span><span class="ident" id="5099956">sa</span><span class="op" id="5099958">[</span><span class="ident" id="5099959">j</span><span class="op" id="5099960">]</span><span class="op" id="5099961">,</span>&nbsp;<span class="ident" id="5099963">x</span><span class="op" id="5099964">.</span><span class="ident" id="5099965">sa</span><span class="op" id="5099967">[</span><span class="ident" id="5099968">i</span><span class="op" id="5099969">]</span>&nbsp;<span class="op" id="5099971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5099974">func</span>&nbsp;<span class="op" id="5099979">(</span><span class="ident" id="5099980">x</span>&nbsp;<span class="op" id="5099982">*</span><span class="ident" id="5099983">suffixSortable</span><span class="op" id="5099997">)</span>&nbsp;<span class="ident" id="5099999">updateGroups</span><span class="op" id="5100011">(</span><span class="ident" id="5100012">offset</span>&nbsp;<span class="builtintype" id="5100019">int</span><span class="op" id="5100022">)</span>&nbsp;<span class="op" id="5100024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100027">bounds</span>&nbsp;<span class="op" id="5100034">:=</span>&nbsp;<span class="ident" id="5100037">x</span><span class="op" id="5100038">.</span><span class="ident" id="5100039">buf</span><span class="op" id="5100042">[</span><span class="num" id="5100043">0</span><span class="op" id="5100044">:</span><span class="num" id="5100045">0</span><span class="op" id="5100046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100049">group</span>&nbsp;<span class="op" id="5100055">:=</span>&nbsp;<span class="ident" id="5100058">x</span><span class="op" id="5100059">.</span><span class="ident" id="5100060">inv</span><span class="op" id="5100063">[</span><span class="ident" id="5100064">x</span><span class="op" id="5100065">.</span><span class="ident" id="5100066">sa</span><span class="op" id="5100068">[</span><span class="num" id="5100069">0</span><span class="op" id="5100070">]</span><span class="op" id="5100071">+</span><span class="ident" id="5100072">x</span><span class="op" id="5100073">.</span><span class="ident" id="5100074">h</span><span class="op" id="5100075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100078">for</span>&nbsp;<span class="ident" id="5100082">i</span>&nbsp;<span class="op" id="5100084">:=</span>&nbsp;<span class="num" id="5100087">1</span><span class="op" id="5100088">;</span>&nbsp;<span class="ident" id="5100090">i</span>&nbsp;<span class="op" id="5100092">&lt;</span>&nbsp;<span class="builtinfunc" id="5100094">len</span><span class="op" id="5100097">(</span><span class="ident" id="5100098">x</span><span class="op" id="5100099">.</span><span class="ident" id="5100100">sa</span><span class="op" id="5100102">)</span><span class="op" id="5100103">;</span>&nbsp;<span class="ident" id="5100105">i</span><span class="op" id="5100106">++</span>&nbsp;<span class="op" id="5100109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100113">if</span>&nbsp;<span class="ident" id="5100116">g</span>&nbsp;<span class="op" id="5100118">:=</span>&nbsp;<span class="ident" id="5100121">x</span><span class="op" id="5100122">.</span><span class="ident" id="5100123">inv</span><span class="op" id="5100126">[</span><span class="ident" id="5100127">x</span><span class="op" id="5100128">.</span><span class="ident" id="5100129">sa</span><span class="op" id="5100131">[</span><span class="ident" id="5100132">i</span><span class="op" id="5100133">]</span><span class="op" id="5100134">+</span><span class="ident" id="5100135">x</span><span class="op" id="5100136">.</span><span class="ident" id="5100137">h</span><span class="op" id="5100138">]</span><span class="op" id="5100139">;</span>&nbsp;<span class="ident" id="5100141">g</span>&nbsp;<span class="op" id="5100143">&gt;</span>&nbsp;<span class="ident" id="5100145">group</span>&nbsp;<span class="op" id="5100151">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100156">bounds</span>&nbsp;<span class="op" id="5100163">=</span>&nbsp;<span class="builtinfunc" id="5100165">append</span><span class="op" id="5100171">(</span><span class="ident" id="5100172">bounds</span><span class="op" id="5100178">,</span>&nbsp;<span class="ident" id="5100180">i</span><span class="op" id="5100181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100186">group</span>&nbsp;<span class="op" id="5100192">=</span>&nbsp;<span class="ident" id="5100194">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100204">bounds</span>&nbsp;<span class="op" id="5100211">=</span>&nbsp;<span class="builtinfunc" id="5100213">append</span><span class="op" id="5100219">(</span><span class="ident" id="5100220">bounds</span><span class="op" id="5100226">,</span>&nbsp;<span class="builtinfunc" id="5100228">len</span><span class="op" id="5100231">(</span><span class="ident" id="5100232">x</span><span class="op" id="5100233">.</span><span class="ident" id="5100234">sa</span><span class="op" id="5100236">)</span><span class="op" id="5100237">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100240">x</span><span class="op" id="5100241">.</span><span class="ident" id="5100242">buf</span>&nbsp;<span class="op" id="5100246">=</span>&nbsp;<span class="ident" id="5100248">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100257">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100325">prev</span>&nbsp;<span class="op" id="5100330">:=</span>&nbsp;<span class="num" id="5100333">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100336">for</span>&nbsp;<span class="ident" id="5100340">_</span><span class="op" id="5100341">,</span>&nbsp;<span class="ident" id="5100343">b</span>&nbsp;<span class="op" id="5100345">:=</span>&nbsp;<span class="keyword" id="5100348">range</span>&nbsp;<span class="ident" id="5100354">bounds</span>&nbsp;<span class="op" id="5100361">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100365">for</span>&nbsp;<span class="ident" id="5100369">i</span>&nbsp;<span class="op" id="5100371">:=</span>&nbsp;<span class="ident" id="5100374">prev</span><span class="op" id="5100378">;</span>&nbsp;<span class="ident" id="5100380">i</span>&nbsp;<span class="op" id="5100382">&lt;</span>&nbsp;<span class="ident" id="5100384">b</span><span class="op" id="5100385">;</span>&nbsp;<span class="ident" id="5100387">i</span><span class="op" id="5100388">++</span>&nbsp;<span class="op" id="5100391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100396">x</span><span class="op" id="5100397">.</span><span class="ident" id="5100398">inv</span><span class="op" id="5100401">[</span><span class="ident" id="5100402">x</span><span class="op" id="5100403">.</span><span class="ident" id="5100404">sa</span><span class="op" id="5100406">[</span><span class="ident" id="5100407">i</span><span class="op" id="5100408">]</span><span class="op" id="5100409">]</span>&nbsp;<span class="op" id="5100411">=</span>&nbsp;<span class="ident" id="5100413">offset</span>&nbsp;<span class="op" id="5100420">+</span>&nbsp;<span class="ident" id="5100422">b</span>&nbsp;<span class="op" id="5100424">-</span>&nbsp;<span class="num" id="5100426">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100434">if</span>&nbsp;<span class="ident" id="5100437">b</span><span class="op" id="5100438">-</span><span class="ident" id="5100439">prev</span>&nbsp;<span class="op" id="5100444">==</span>&nbsp;<span class="num" id="5100447">1</span>&nbsp;<span class="op" id="5100449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100454">x</span><span class="op" id="5100455">.</span><span class="ident" id="5100456">sa</span><span class="op" id="5100458">[</span><span class="ident" id="5100459">prev</span><span class="op" id="5100463">]</span>&nbsp;<span class="op" id="5100465">=</span>&nbsp;<span class="op" id="5100467">-</span><span class="num" id="5100468">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100476">prev</span>&nbsp;<span class="op" id="5100481">=</span>&nbsp;<span class="ident" id="5100483">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100486">}</span><br>
<span class="lineno"></span><span class="op" id="5100488">}</span>
</div>
</body>
</html>
