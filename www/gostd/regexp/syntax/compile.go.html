<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5258090">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5258145">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5258199">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5258250">package</span>&nbsp;<span class="ident" id="5258258">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5258266">import</span>&nbsp;<span class="string" id="5258273">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5258284">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5258370">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5258449">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5258520">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5258586">//</span><br>
<span class="lineno"></span><span class="comment" id="5258589">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5258667">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5258728">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5258775">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5258845">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5258922">type</span>&nbsp;<span class="ident" id="5258927">patchList</span>&nbsp;<span class="builtintype" id="5258937">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5258945">func</span>&nbsp;<span class="op" id="5258950">(</span><span class="ident" id="5258951">l</span>&nbsp;<span class="ident" id="5258953">patchList</span><span class="op" id="5258962">)</span>&nbsp;<span class="ident" id="5258964">next</span><span class="op" id="5258968">(</span><span class="ident" id="5258969">p</span>&nbsp;<span class="op" id="5258971">*</span><span class="ident" id="5258972">Prog</span><span class="op" id="5258976">)</span>&nbsp;<span class="ident" id="5258978">patchList</span>&nbsp;<span class="op" id="5258988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258991">i</span>&nbsp;<span class="op" id="5258993">:=</span>&nbsp;<span class="op" id="5258996">&amp;</span><span class="ident" id="5258997">p</span><span class="op" id="5258998">.</span><span class="ident" id="5258999">Inst</span><span class="op" id="5259003">[</span><span class="ident" id="5259004">l</span><span class="op" id="5259005">&gt;&gt;</span><span class="num" id="5259007">1</span><span class="op" id="5259008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259011">if</span>&nbsp;<span class="ident" id="5259014">l</span><span class="op" id="5259015">&amp;</span><span class="num" id="5259016">1</span>&nbsp;<span class="op" id="5259018">==</span>&nbsp;<span class="num" id="5259021">0</span>&nbsp;<span class="op" id="5259023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259027">return</span>&nbsp;<span class="ident" id="5259034">patchList</span><span class="op" id="5259043">(</span><span class="ident" id="5259044">i</span><span class="op" id="5259045">.</span><span class="ident" id="5259046">Out</span><span class="op" id="5259049">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259055">return</span>&nbsp;<span class="ident" id="5259062">patchList</span><span class="op" id="5259071">(</span><span class="ident" id="5259072">i</span><span class="op" id="5259073">.</span><span class="ident" id="5259074">Arg</span><span class="op" id="5259077">)</span><br>
<span class="lineno"></span><span class="op" id="5259079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259082">func</span>&nbsp;<span class="op" id="5259087">(</span><span class="ident" id="5259088">l</span>&nbsp;<span class="ident" id="5259090">patchList</span><span class="op" id="5259099">)</span>&nbsp;<span class="ident" id="5259101">patch</span><span class="op" id="5259106">(</span><span class="ident" id="5259107">p</span>&nbsp;<span class="op" id="5259109">*</span><span class="ident" id="5259110">Prog</span><span class="op" id="5259114">,</span>&nbsp;<span class="ident" id="5259116">val</span>&nbsp;<span class="builtintype" id="5259120">uint32</span><span class="op" id="5259126">)</span>&nbsp;<span class="op" id="5259128">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259131">for</span>&nbsp;<span class="ident" id="5259135">l</span>&nbsp;<span class="op" id="5259137">!=</span>&nbsp;<span class="num" id="5259140">0</span>&nbsp;<span class="op" id="5259142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259146">i</span>&nbsp;<span class="op" id="5259148">:=</span>&nbsp;<span class="op" id="5259151">&amp;</span><span class="ident" id="5259152">p</span><span class="op" id="5259153">.</span><span class="ident" id="5259154">Inst</span><span class="op" id="5259158">[</span><span class="ident" id="5259159">l</span><span class="op" id="5259160">&gt;&gt;</span><span class="num" id="5259162">1</span><span class="op" id="5259163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259167">if</span>&nbsp;<span class="ident" id="5259170">l</span><span class="op" id="5259171">&amp;</span><span class="num" id="5259172">1</span>&nbsp;<span class="op" id="5259174">==</span>&nbsp;<span class="num" id="5259177">0</span>&nbsp;<span class="op" id="5259179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259184">l</span>&nbsp;<span class="op" id="5259186">=</span>&nbsp;<span class="ident" id="5259188">patchList</span><span class="op" id="5259197">(</span><span class="ident" id="5259198">i</span><span class="op" id="5259199">.</span><span class="ident" id="5259200">Out</span><span class="op" id="5259203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259208">i</span><span class="op" id="5259209">.</span><span class="ident" id="5259210">Out</span>&nbsp;<span class="op" id="5259214">=</span>&nbsp;<span class="ident" id="5259216">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259222">}</span>&nbsp;<span class="keyword" id="5259224">else</span>&nbsp;<span class="op" id="5259229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259234">l</span>&nbsp;<span class="op" id="5259236">=</span>&nbsp;<span class="ident" id="5259238">patchList</span><span class="op" id="5259247">(</span><span class="ident" id="5259248">i</span><span class="op" id="5259249">.</span><span class="ident" id="5259250">Arg</span><span class="op" id="5259253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259258">i</span><span class="op" id="5259259">.</span><span class="ident" id="5259260">Arg</span>&nbsp;<span class="op" id="5259264">=</span>&nbsp;<span class="ident" id="5259266">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259275">}</span><br>
<span class="lineno">40</span><span class="op" id="5259277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259280">func</span>&nbsp;<span class="op" id="5259285">(</span><span class="ident" id="5259286">l1</span>&nbsp;<span class="ident" id="5259289">patchList</span><span class="op" id="5259298">)</span>&nbsp;<span class="builtinfunc" id="5259300">append</span><span class="op" id="5259306">(</span><span class="ident" id="5259307">p</span>&nbsp;<span class="op" id="5259309">*</span><span class="ident" id="5259310">Prog</span><span class="op" id="5259314">,</span>&nbsp;<span class="ident" id="5259316">l2</span>&nbsp;<span class="ident" id="5259319">patchList</span><span class="op" id="5259328">)</span>&nbsp;<span class="ident" id="5259330">patchList</span>&nbsp;<span class="op" id="5259340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259343">if</span>&nbsp;<span class="ident" id="5259346">l1</span>&nbsp;<span class="op" id="5259349">==</span>&nbsp;<span class="num" id="5259352">0</span>&nbsp;<span class="op" id="5259354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259358">return</span>&nbsp;<span class="ident" id="5259365">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259372">if</span>&nbsp;<span class="ident" id="5259375">l2</span>&nbsp;<span class="op" id="5259378">==</span>&nbsp;<span class="num" id="5259381">0</span>&nbsp;<span class="op" id="5259383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259387">return</span>&nbsp;<span class="ident" id="5259394">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259402">last</span>&nbsp;<span class="op" id="5259407">:=</span>&nbsp;<span class="ident" id="5259410">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259414">for</span>&nbsp;<span class="op" id="5259418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259422">next</span>&nbsp;<span class="op" id="5259427">:=</span>&nbsp;<span class="ident" id="5259430">last</span><span class="op" id="5259434">.</span><span class="ident" id="5259435">next</span><span class="op" id="5259439">(</span><span class="ident" id="5259440">p</span><span class="op" id="5259441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259445">if</span>&nbsp;<span class="ident" id="5259448">next</span>&nbsp;<span class="op" id="5259453">==</span>&nbsp;<span class="num" id="5259456">0</span>&nbsp;<span class="op" id="5259458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259463">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259475">last</span>&nbsp;<span class="op" id="5259480">=</span>&nbsp;<span class="ident" id="5259482">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259492">i</span>&nbsp;<span class="op" id="5259494">:=</span>&nbsp;<span class="op" id="5259497">&amp;</span><span class="ident" id="5259498">p</span><span class="op" id="5259499">.</span><span class="ident" id="5259500">Inst</span><span class="op" id="5259504">[</span><span class="ident" id="5259505">last</span><span class="op" id="5259509">&gt;&gt;</span><span class="num" id="5259511">1</span><span class="op" id="5259512">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259515">if</span>&nbsp;<span class="ident" id="5259518">last</span><span class="op" id="5259522">&amp;</span><span class="num" id="5259523">1</span>&nbsp;<span class="op" id="5259525">==</span>&nbsp;<span class="num" id="5259528">0</span>&nbsp;<span class="op" id="5259530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259534">i</span><span class="op" id="5259535">.</span><span class="ident" id="5259536">Out</span>&nbsp;<span class="op" id="5259540">=</span>&nbsp;<span class="builtintype" id="5259542">uint32</span><span class="op" id="5259548">(</span><span class="ident" id="5259549">l2</span><span class="op" id="5259551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259554">}</span>&nbsp;<span class="keyword" id="5259556">else</span>&nbsp;<span class="op" id="5259561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259565">i</span><span class="op" id="5259566">.</span><span class="ident" id="5259567">Arg</span>&nbsp;<span class="op" id="5259571">=</span>&nbsp;<span class="builtintype" id="5259573">uint32</span><span class="op" id="5259579">(</span><span class="ident" id="5259580">l2</span><span class="op" id="5259582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259585">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259588">return</span>&nbsp;<span class="ident" id="5259595">l1</span><br>
<span class="lineno"></span><span class="op" id="5259598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5259601">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5259651">type</span>&nbsp;<span class="ident" id="5259656">frag</span>&nbsp;<span class="keyword" id="5259661">struct</span>&nbsp;<span class="op" id="5259668">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259671">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5259675">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5259685">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259716">out</span>&nbsp;<span class="ident" id="5259720">patchList</span>&nbsp;<span class="comment" id="5259730">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5259765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259768">type</span>&nbsp;<span class="ident" id="5259773">compiler</span>&nbsp;<span class="keyword" id="5259782">struct</span>&nbsp;<span class="op" id="5259789">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259792">p</span>&nbsp;<span class="op" id="5259794">*</span><span class="ident" id="5259795">Prog</span><br>
<span class="lineno"></span><span class="op" id="5259800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5259803">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5259865">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5259944">func</span>&nbsp;<span class="ident" id="5259949">Compile</span><span class="op" id="5259956">(</span><span class="ident" id="5259957">re</span>&nbsp;<span class="op" id="5259960">*</span><span class="ident" id="5259961">Regexp</span><span class="op" id="5259967">)</span>&nbsp;<span class="op" id="5259969">(</span><span class="op" id="5259970">*</span><span class="ident" id="5259971">Prog</span><span class="op" id="5259975">,</span>&nbsp;<span class="builtintype" id="5259977">error</span><span class="op" id="5259982">)</span>&nbsp;<span class="op" id="5259984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259987">var</span>&nbsp;<span class="ident" id="5259991">c</span>&nbsp;<span class="ident" id="5259993">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260003">c</span><span class="op" id="5260004">.</span><span class="ident" id="5260005">init</span><span class="op" id="5260009">(</span><span class="op" id="5260010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260013">f</span>&nbsp;<span class="op" id="5260015">:=</span>&nbsp;<span class="ident" id="5260018">c</span><span class="op" id="5260019">.</span><span class="ident" id="5260020">compile</span><span class="op" id="5260027">(</span><span class="ident" id="5260028">re</span><span class="op" id="5260030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260033">f</span><span class="op" id="5260034">.</span><span class="ident" id="5260035">out</span><span class="op" id="5260038">.</span><span class="ident" id="5260039">patch</span><span class="op" id="5260044">(</span><span class="ident" id="5260045">c</span><span class="op" id="5260046">.</span><span class="ident" id="5260047">p</span><span class="op" id="5260048">,</span>&nbsp;<span class="ident" id="5260050">c</span><span class="op" id="5260051">.</span><span class="ident" id="5260052">inst</span><span class="op" id="5260056">(</span><span class="ident" id="5260057">InstMatch</span><span class="op" id="5260066">)</span><span class="op" id="5260067">.</span><span class="ident" id="5260068">i</span><span class="op" id="5260069">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260072">c</span><span class="op" id="5260073">.</span><span class="ident" id="5260074">p</span><span class="op" id="5260075">.</span><span class="ident" id="5260076">Start</span>&nbsp;<span class="op" id="5260082">=</span>&nbsp;<span class="builtintype" id="5260084">int</span><span class="op" id="5260087">(</span><span class="ident" id="5260088">f</span><span class="op" id="5260089">.</span><span class="ident" id="5260090">i</span><span class="op" id="5260091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260094">return</span>&nbsp;<span class="ident" id="5260101">c</span><span class="op" id="5260102">.</span><span class="ident" id="5260103">p</span><span class="op" id="5260104">,</span>&nbsp;<span class="ident" id="5260106">nil</span><br>
<span class="lineno"></span><span class="op" id="5260110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260113">func</span>&nbsp;<span class="op" id="5260118">(</span><span class="ident" id="5260119">c</span>&nbsp;<span class="op" id="5260121">*</span><span class="ident" id="5260122">compiler</span><span class="op" id="5260130">)</span>&nbsp;<span class="ident" id="5260132">init</span><span class="op" id="5260136">(</span><span class="op" id="5260137">)</span>&nbsp;<span class="op" id="5260139">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260142">c</span><span class="op" id="5260143">.</span><span class="ident" id="5260144">p</span>&nbsp;<span class="op" id="5260146">=</span>&nbsp;<span class="builtinfunc" id="5260148">new</span><span class="op" id="5260151">(</span><span class="ident" id="5260152">Prog</span><span class="op" id="5260156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260159">c</span><span class="op" id="5260160">.</span><span class="ident" id="5260161">p</span><span class="op" id="5260162">.</span><span class="ident" id="5260163">NumCap</span>&nbsp;<span class="op" id="5260170">=</span>&nbsp;<span class="num" id="5260172">2</span>&nbsp;<span class="comment" id="5260174">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260214">c</span><span class="op" id="5260215">.</span><span class="ident" id="5260216">inst</span><span class="op" id="5260220">(</span><span class="ident" id="5260221">InstFail</span><span class="op" id="5260229">)</span><br>
<span class="lineno"></span><span class="op" id="5260231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5260234">var</span>&nbsp;<span class="ident" id="5260238">anyRuneNotNL</span>&nbsp;<span class="op" id="5260251">=</span>&nbsp;<span class="op" id="5260253">[</span><span class="op" id="5260254">]</span><span class="builtintype" id="5260255">rune</span><span class="op" id="5260259">{</span><span class="num" id="5260260">0</span><span class="op" id="5260261">,</span>&nbsp;<span class="string" id="5260263">&#39;\n&#39;</span>&nbsp;<span class="op" id="5260268">-</span>&nbsp;<span class="num" id="5260270">1</span><span class="op" id="5260271">,</span>&nbsp;<span class="string" id="5260273">&#39;\n&#39;</span>&nbsp;<span class="op" id="5260278">+</span>&nbsp;<span class="num" id="5260280">1</span><span class="op" id="5260281">,</span>&nbsp;<span class="ident" id="5260283">unicode</span><span class="op" id="5260290">.</span><span class="ident" id="5260291">MaxRune</span><span class="op" id="5260298">}</span><br>
<span class="lineno"></span><span class="keyword" id="5260300">var</span>&nbsp;<span class="ident" id="5260304">anyRune</span>&nbsp;<span class="op" id="5260312">=</span>&nbsp;<span class="op" id="5260314">[</span><span class="op" id="5260315">]</span><span class="builtintype" id="5260316">rune</span><span class="op" id="5260320">{</span><span class="num" id="5260321">0</span><span class="op" id="5260322">,</span>&nbsp;<span class="ident" id="5260324">unicode</span><span class="op" id="5260331">.</span><span class="ident" id="5260332">MaxRune</span><span class="op" id="5260339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260342">func</span>&nbsp;<span class="op" id="5260347">(</span><span class="ident" id="5260348">c</span>&nbsp;<span class="op" id="5260350">*</span><span class="ident" id="5260351">compiler</span><span class="op" id="5260359">)</span>&nbsp;<span class="ident" id="5260361">compile</span><span class="op" id="5260368">(</span><span class="ident" id="5260369">re</span>&nbsp;<span class="op" id="5260372">*</span><span class="ident" id="5260373">Regexp</span><span class="op" id="5260379">)</span>&nbsp;<span class="ident" id="5260381">frag</span>&nbsp;<span class="op" id="5260386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260389">switch</span>&nbsp;<span class="ident" id="5260396">re</span><span class="op" id="5260398">.</span><span class="ident" id="5260399">Op</span>&nbsp;<span class="op" id="5260402">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260405">case</span>&nbsp;<span class="ident" id="5260410">OpNoMatch</span><span class="op" id="5260419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260423">return</span>&nbsp;<span class="ident" id="5260430">c</span><span class="op" id="5260431">.</span><span class="ident" id="5260432">fail</span><span class="op" id="5260436">(</span><span class="op" id="5260437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260440">case</span>&nbsp;<span class="ident" id="5260445">OpEmptyMatch</span><span class="op" id="5260457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260461">return</span>&nbsp;<span class="ident" id="5260468">c</span><span class="op" id="5260469">.</span><span class="ident" id="5260470">nop</span><span class="op" id="5260473">(</span><span class="op" id="5260474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260477">case</span>&nbsp;<span class="ident" id="5260482">OpLiteral</span><span class="op" id="5260491">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260495">if</span>&nbsp;<span class="builtinfunc" id="5260498">len</span><span class="op" id="5260501">(</span><span class="ident" id="5260502">re</span><span class="op" id="5260504">.</span><span class="ident" id="5260505">Rune</span><span class="op" id="5260509">)</span>&nbsp;<span class="op" id="5260511">==</span>&nbsp;<span class="num" id="5260514">0</span>&nbsp;<span class="op" id="5260516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260521">return</span>&nbsp;<span class="ident" id="5260528">c</span><span class="op" id="5260529">.</span><span class="ident" id="5260530">nop</span><span class="op" id="5260533">(</span><span class="op" id="5260534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260542">var</span>&nbsp;<span class="ident" id="5260546">f</span>&nbsp;<span class="ident" id="5260548">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260555">for</span>&nbsp;<span class="ident" id="5260559">j</span>&nbsp;<span class="op" id="5260561">:=</span>&nbsp;<span class="keyword" id="5260564">range</span>&nbsp;<span class="ident" id="5260570">re</span><span class="op" id="5260572">.</span><span class="ident" id="5260573">Rune</span>&nbsp;<span class="op" id="5260578">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260583">f1</span>&nbsp;<span class="op" id="5260586">:=</span>&nbsp;<span class="ident" id="5260589">c</span><span class="op" id="5260590">.</span><span class="builtintype" id="5260591">rune</span><span class="op" id="5260595">(</span><span class="ident" id="5260596">re</span><span class="op" id="5260598">.</span><span class="ident" id="5260599">Rune</span><span class="op" id="5260603">[</span><span class="ident" id="5260604">j</span><span class="op" id="5260605">:</span><span class="ident" id="5260606">j</span><span class="op" id="5260607">+</span><span class="num" id="5260608">1</span><span class="op" id="5260609">]</span><span class="op" id="5260610">,</span>&nbsp;<span class="ident" id="5260612">re</span><span class="op" id="5260614">.</span><span class="ident" id="5260615">Flags</span><span class="op" id="5260620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260625">if</span>&nbsp;<span class="ident" id="5260628">j</span>&nbsp;<span class="op" id="5260630">==</span>&nbsp;<span class="num" id="5260633">0</span>&nbsp;<span class="op" id="5260635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260641">f</span>&nbsp;<span class="op" id="5260643">=</span>&nbsp;<span class="ident" id="5260645">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260651">}</span>&nbsp;<span class="keyword" id="5260653">else</span>&nbsp;<span class="op" id="5260658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260664">f</span>&nbsp;<span class="op" id="5260666">=</span>&nbsp;<span class="ident" id="5260668">c</span><span class="op" id="5260669">.</span><span class="ident" id="5260670">cat</span><span class="op" id="5260673">(</span><span class="ident" id="5260674">f</span><span class="op" id="5260675">,</span>&nbsp;<span class="ident" id="5260677">f1</span><span class="op" id="5260679">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260692">return</span>&nbsp;<span class="ident" id="5260699">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260702">case</span>&nbsp;<span class="ident" id="5260707">OpCharClass</span><span class="op" id="5260718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260722">return</span>&nbsp;<span class="ident" id="5260729">c</span><span class="op" id="5260730">.</span><span class="builtintype" id="5260731">rune</span><span class="op" id="5260735">(</span><span class="ident" id="5260736">re</span><span class="op" id="5260738">.</span><span class="ident" id="5260739">Rune</span><span class="op" id="5260743">,</span>&nbsp;<span class="ident" id="5260745">re</span><span class="op" id="5260747">.</span><span class="ident" id="5260748">Flags</span><span class="op" id="5260753">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260756">case</span>&nbsp;<span class="ident" id="5260761">OpAnyCharNotNL</span><span class="op" id="5260775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260779">return</span>&nbsp;<span class="ident" id="5260786">c</span><span class="op" id="5260787">.</span><span class="builtintype" id="5260788">rune</span><span class="op" id="5260792">(</span><span class="ident" id="5260793">anyRuneNotNL</span><span class="op" id="5260805">,</span>&nbsp;<span class="num" id="5260807">0</span><span class="op" id="5260808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260811">case</span>&nbsp;<span class="ident" id="5260816">OpAnyChar</span><span class="op" id="5260825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260829">return</span>&nbsp;<span class="ident" id="5260836">c</span><span class="op" id="5260837">.</span><span class="builtintype" id="5260838">rune</span><span class="op" id="5260842">(</span><span class="ident" id="5260843">anyRune</span><span class="op" id="5260850">,</span>&nbsp;<span class="num" id="5260852">0</span><span class="op" id="5260853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260856">case</span>&nbsp;<span class="ident" id="5260861">OpBeginLine</span><span class="op" id="5260872">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260876">return</span>&nbsp;<span class="ident" id="5260883">c</span><span class="op" id="5260884">.</span><span class="ident" id="5260885">empty</span><span class="op" id="5260890">(</span><span class="ident" id="5260891">EmptyBeginLine</span><span class="op" id="5260905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260908">case</span>&nbsp;<span class="ident" id="5260913">OpEndLine</span><span class="op" id="5260922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260926">return</span>&nbsp;<span class="ident" id="5260933">c</span><span class="op" id="5260934">.</span><span class="ident" id="5260935">empty</span><span class="op" id="5260940">(</span><span class="ident" id="5260941">EmptyEndLine</span><span class="op" id="5260953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260956">case</span>&nbsp;<span class="ident" id="5260961">OpBeginText</span><span class="op" id="5260972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260976">return</span>&nbsp;<span class="ident" id="5260983">c</span><span class="op" id="5260984">.</span><span class="ident" id="5260985">empty</span><span class="op" id="5260990">(</span><span class="ident" id="5260991">EmptyBeginText</span><span class="op" id="5261005">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261008">case</span>&nbsp;<span class="ident" id="5261013">OpEndText</span><span class="op" id="5261022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261026">return</span>&nbsp;<span class="ident" id="5261033">c</span><span class="op" id="5261034">.</span><span class="ident" id="5261035">empty</span><span class="op" id="5261040">(</span><span class="ident" id="5261041">EmptyEndText</span><span class="op" id="5261053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261056">case</span>&nbsp;<span class="ident" id="5261061">OpWordBoundary</span><span class="op" id="5261075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261079">return</span>&nbsp;<span class="ident" id="5261086">c</span><span class="op" id="5261087">.</span><span class="ident" id="5261088">empty</span><span class="op" id="5261093">(</span><span class="ident" id="5261094">EmptyWordBoundary</span><span class="op" id="5261111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261114">case</span>&nbsp;<span class="ident" id="5261119">OpNoWordBoundary</span><span class="op" id="5261135">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261139">return</span>&nbsp;<span class="ident" id="5261146">c</span><span class="op" id="5261147">.</span><span class="ident" id="5261148">empty</span><span class="op" id="5261153">(</span><span class="ident" id="5261154">EmptyNoWordBoundary</span><span class="op" id="5261173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261176">case</span>&nbsp;<span class="ident" id="5261181">OpCapture</span><span class="op" id="5261190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261194">bra</span>&nbsp;<span class="op" id="5261198">:=</span>&nbsp;<span class="ident" id="5261201">c</span><span class="op" id="5261202">.</span><span class="builtinfunc" id="5261203">cap</span><span class="op" id="5261206">(</span><span class="builtintype" id="5261207">uint32</span><span class="op" id="5261213">(</span><span class="ident" id="5261214">re</span><span class="op" id="5261216">.</span><span class="ident" id="5261217">Cap</span>&nbsp;<span class="op" id="5261221">&lt;&lt;</span>&nbsp;<span class="num" id="5261224">1</span><span class="op" id="5261225">)</span><span class="op" id="5261226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261230">sub</span>&nbsp;<span class="op" id="5261234">:=</span>&nbsp;<span class="ident" id="5261237">c</span><span class="op" id="5261238">.</span><span class="ident" id="5261239">compile</span><span class="op" id="5261246">(</span><span class="ident" id="5261247">re</span><span class="op" id="5261249">.</span><span class="ident" id="5261250">Sub</span><span class="op" id="5261253">[</span><span class="num" id="5261254">0</span><span class="op" id="5261255">]</span><span class="op" id="5261256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261260">ket</span>&nbsp;<span class="op" id="5261264">:=</span>&nbsp;<span class="ident" id="5261267">c</span><span class="op" id="5261268">.</span><span class="builtinfunc" id="5261269">cap</span><span class="op" id="5261272">(</span><span class="builtintype" id="5261273">uint32</span><span class="op" id="5261279">(</span><span class="ident" id="5261280">re</span><span class="op" id="5261282">.</span><span class="ident" id="5261283">Cap</span><span class="op" id="5261286">&lt;&lt;</span><span class="num" id="5261288">1</span>&nbsp;<span class="op" id="5261290">|</span>&nbsp;<span class="num" id="5261292">1</span><span class="op" id="5261293">)</span><span class="op" id="5261294">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261298">return</span>&nbsp;<span class="ident" id="5261305">c</span><span class="op" id="5261306">.</span><span class="ident" id="5261307">cat</span><span class="op" id="5261310">(</span><span class="ident" id="5261311">c</span><span class="op" id="5261312">.</span><span class="ident" id="5261313">cat</span><span class="op" id="5261316">(</span><span class="ident" id="5261317">bra</span><span class="op" id="5261320">,</span>&nbsp;<span class="ident" id="5261322">sub</span><span class="op" id="5261325">)</span><span class="op" id="5261326">,</span>&nbsp;<span class="ident" id="5261328">ket</span><span class="op" id="5261331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261334">case</span>&nbsp;<span class="ident" id="5261339">OpStar</span><span class="op" id="5261345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261349">return</span>&nbsp;<span class="ident" id="5261356">c</span><span class="op" id="5261357">.</span><span class="ident" id="5261358">star</span><span class="op" id="5261362">(</span><span class="ident" id="5261363">c</span><span class="op" id="5261364">.</span><span class="ident" id="5261365">compile</span><span class="op" id="5261372">(</span><span class="ident" id="5261373">re</span><span class="op" id="5261375">.</span><span class="ident" id="5261376">Sub</span><span class="op" id="5261379">[</span><span class="num" id="5261380">0</span><span class="op" id="5261381">]</span><span class="op" id="5261382">)</span><span class="op" id="5261383">,</span>&nbsp;<span class="ident" id="5261385">re</span><span class="op" id="5261387">.</span><span class="ident" id="5261388">Flags</span><span class="op" id="5261393">&amp;</span><span class="ident" id="5261394">NonGreedy</span>&nbsp;<span class="op" id="5261404">!=</span>&nbsp;<span class="num" id="5261407">0</span><span class="op" id="5261408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261411">case</span>&nbsp;<span class="ident" id="5261416">OpPlus</span><span class="op" id="5261422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261426">return</span>&nbsp;<span class="ident" id="5261433">c</span><span class="op" id="5261434">.</span><span class="ident" id="5261435">plus</span><span class="op" id="5261439">(</span><span class="ident" id="5261440">c</span><span class="op" id="5261441">.</span><span class="ident" id="5261442">compile</span><span class="op" id="5261449">(</span><span class="ident" id="5261450">re</span><span class="op" id="5261452">.</span><span class="ident" id="5261453">Sub</span><span class="op" id="5261456">[</span><span class="num" id="5261457">0</span><span class="op" id="5261458">]</span><span class="op" id="5261459">)</span><span class="op" id="5261460">,</span>&nbsp;<span class="ident" id="5261462">re</span><span class="op" id="5261464">.</span><span class="ident" id="5261465">Flags</span><span class="op" id="5261470">&amp;</span><span class="ident" id="5261471">NonGreedy</span>&nbsp;<span class="op" id="5261481">!=</span>&nbsp;<span class="num" id="5261484">0</span><span class="op" id="5261485">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261488">case</span>&nbsp;<span class="ident" id="5261493">OpQuest</span><span class="op" id="5261500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261504">return</span>&nbsp;<span class="ident" id="5261511">c</span><span class="op" id="5261512">.</span><span class="ident" id="5261513">quest</span><span class="op" id="5261518">(</span><span class="ident" id="5261519">c</span><span class="op" id="5261520">.</span><span class="ident" id="5261521">compile</span><span class="op" id="5261528">(</span><span class="ident" id="5261529">re</span><span class="op" id="5261531">.</span><span class="ident" id="5261532">Sub</span><span class="op" id="5261535">[</span><span class="num" id="5261536">0</span><span class="op" id="5261537">]</span><span class="op" id="5261538">)</span><span class="op" id="5261539">,</span>&nbsp;<span class="ident" id="5261541">re</span><span class="op" id="5261543">.</span><span class="ident" id="5261544">Flags</span><span class="op" id="5261549">&amp;</span><span class="ident" id="5261550">NonGreedy</span>&nbsp;<span class="op" id="5261560">!=</span>&nbsp;<span class="num" id="5261563">0</span><span class="op" id="5261564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261567">case</span>&nbsp;<span class="ident" id="5261572">OpConcat</span><span class="op" id="5261580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261584">if</span>&nbsp;<span class="builtinfunc" id="5261587">len</span><span class="op" id="5261590">(</span><span class="ident" id="5261591">re</span><span class="op" id="5261593">.</span><span class="ident" id="5261594">Sub</span><span class="op" id="5261597">)</span>&nbsp;<span class="op" id="5261599">==</span>&nbsp;<span class="num" id="5261602">0</span>&nbsp;<span class="op" id="5261604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261609">return</span>&nbsp;<span class="ident" id="5261616">c</span><span class="op" id="5261617">.</span><span class="ident" id="5261618">nop</span><span class="op" id="5261621">(</span><span class="op" id="5261622">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261630">var</span>&nbsp;<span class="ident" id="5261634">f</span>&nbsp;<span class="ident" id="5261636">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261643">for</span>&nbsp;<span class="ident" id="5261647">i</span><span class="op" id="5261648">,</span>&nbsp;<span class="ident" id="5261650">sub</span>&nbsp;<span class="op" id="5261654">:=</span>&nbsp;<span class="keyword" id="5261657">range</span>&nbsp;<span class="ident" id="5261663">re</span><span class="op" id="5261665">.</span><span class="ident" id="5261666">Sub</span>&nbsp;<span class="op" id="5261670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261675">if</span>&nbsp;<span class="ident" id="5261678">i</span>&nbsp;<span class="op" id="5261680">==</span>&nbsp;<span class="num" id="5261683">0</span>&nbsp;<span class="op" id="5261685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261691">f</span>&nbsp;<span class="op" id="5261693">=</span>&nbsp;<span class="ident" id="5261695">c</span><span class="op" id="5261696">.</span><span class="ident" id="5261697">compile</span><span class="op" id="5261704">(</span><span class="ident" id="5261705">sub</span><span class="op" id="5261708">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261713">}</span>&nbsp;<span class="keyword" id="5261715">else</span>&nbsp;<span class="op" id="5261720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261726">f</span>&nbsp;<span class="op" id="5261728">=</span>&nbsp;<span class="ident" id="5261730">c</span><span class="op" id="5261731">.</span><span class="ident" id="5261732">cat</span><span class="op" id="5261735">(</span><span class="ident" id="5261736">f</span><span class="op" id="5261737">,</span>&nbsp;<span class="ident" id="5261739">c</span><span class="op" id="5261740">.</span><span class="ident" id="5261741">compile</span><span class="op" id="5261748">(</span><span class="ident" id="5261749">sub</span><span class="op" id="5261752">)</span><span class="op" id="5261753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261766">return</span>&nbsp;<span class="ident" id="5261773">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261776">case</span>&nbsp;<span class="ident" id="5261781">OpAlternate</span><span class="op" id="5261792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261796">var</span>&nbsp;<span class="ident" id="5261800">f</span>&nbsp;<span class="ident" id="5261802">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261809">for</span>&nbsp;<span class="ident" id="5261813">_</span><span class="op" id="5261814">,</span>&nbsp;<span class="ident" id="5261816">sub</span>&nbsp;<span class="op" id="5261820">:=</span>&nbsp;<span class="keyword" id="5261823">range</span>&nbsp;<span class="ident" id="5261829">re</span><span class="op" id="5261831">.</span><span class="ident" id="5261832">Sub</span>&nbsp;<span class="op" id="5261836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261841">f</span>&nbsp;<span class="op" id="5261843">=</span>&nbsp;<span class="ident" id="5261845">c</span><span class="op" id="5261846">.</span><span class="ident" id="5261847">alt</span><span class="op" id="5261850">(</span><span class="ident" id="5261851">f</span><span class="op" id="5261852">,</span>&nbsp;<span class="ident" id="5261854">c</span><span class="op" id="5261855">.</span><span class="ident" id="5261856">compile</span><span class="op" id="5261863">(</span><span class="ident" id="5261864">sub</span><span class="op" id="5261867">)</span><span class="op" id="5261868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261872">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261876">return</span>&nbsp;<span class="ident" id="5261883">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5261889">panic</span><span class="op" id="5261894">(</span><span class="string" id="5261895">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5261930">)</span><br>
<span class="lineno"></span><span class="op" id="5261932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5261935">func</span>&nbsp;<span class="op" id="5261940">(</span><span class="ident" id="5261941">c</span>&nbsp;<span class="op" id="5261943">*</span><span class="ident" id="5261944">compiler</span><span class="op" id="5261952">)</span>&nbsp;<span class="ident" id="5261954">inst</span><span class="op" id="5261958">(</span><span class="ident" id="5261959">op</span>&nbsp;<span class="ident" id="5261962">InstOp</span><span class="op" id="5261968">)</span>&nbsp;<span class="ident" id="5261970">frag</span>&nbsp;<span class="op" id="5261975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261978">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262008">f</span>&nbsp;<span class="op" id="5262010">:=</span>&nbsp;<span class="ident" id="5262013">frag</span><span class="op" id="5262017">{</span><span class="ident" id="5262018">i</span><span class="op" id="5262019">:</span>&nbsp;<span class="builtintype" id="5262021">uint32</span><span class="op" id="5262027">(</span><span class="builtinfunc" id="5262028">len</span><span class="op" id="5262031">(</span><span class="ident" id="5262032">c</span><span class="op" id="5262033">.</span><span class="ident" id="5262034">p</span><span class="op" id="5262035">.</span><span class="ident" id="5262036">Inst</span><span class="op" id="5262040">)</span><span class="op" id="5262041">)</span><span class="op" id="5262042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262045">c</span><span class="op" id="5262046">.</span><span class="ident" id="5262047">p</span><span class="op" id="5262048">.</span><span class="ident" id="5262049">Inst</span>&nbsp;<span class="op" id="5262054">=</span>&nbsp;<span class="builtinfunc" id="5262056">append</span><span class="op" id="5262062">(</span><span class="ident" id="5262063">c</span><span class="op" id="5262064">.</span><span class="ident" id="5262065">p</span><span class="op" id="5262066">.</span><span class="ident" id="5262067">Inst</span><span class="op" id="5262071">,</span>&nbsp;<span class="ident" id="5262073">Inst</span><span class="op" id="5262077">{</span><span class="ident" id="5262078">Op</span><span class="op" id="5262080">:</span>&nbsp;<span class="ident" id="5262082">op</span><span class="op" id="5262084">}</span><span class="op" id="5262085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262088">return</span>&nbsp;<span class="ident" id="5262095">f</span><br>
<span class="lineno">175</span><span class="op" id="5262097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262100">func</span>&nbsp;<span class="op" id="5262105">(</span><span class="ident" id="5262106">c</span>&nbsp;<span class="op" id="5262108">*</span><span class="ident" id="5262109">compiler</span><span class="op" id="5262117">)</span>&nbsp;<span class="ident" id="5262119">nop</span><span class="op" id="5262122">(</span><span class="op" id="5262123">)</span>&nbsp;<span class="ident" id="5262125">frag</span>&nbsp;<span class="op" id="5262130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262133">f</span>&nbsp;<span class="op" id="5262135">:=</span>&nbsp;<span class="ident" id="5262138">c</span><span class="op" id="5262139">.</span><span class="ident" id="5262140">inst</span><span class="op" id="5262144">(</span><span class="ident" id="5262145">InstNop</span><span class="op" id="5262152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262155">f</span><span class="op" id="5262156">.</span><span class="ident" id="5262157">out</span>&nbsp;<span class="op" id="5262161">=</span>&nbsp;<span class="ident" id="5262163">patchList</span><span class="op" id="5262172">(</span><span class="ident" id="5262173">f</span><span class="op" id="5262174">.</span><span class="ident" id="5262175">i</span>&nbsp;<span class="op" id="5262177">&lt;&lt;</span>&nbsp;<span class="num" id="5262180">1</span><span class="op" id="5262181">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262184">return</span>&nbsp;<span class="ident" id="5262191">f</span><br>
<span class="lineno"></span><span class="op" id="5262193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262196">func</span>&nbsp;<span class="op" id="5262201">(</span><span class="ident" id="5262202">c</span>&nbsp;<span class="op" id="5262204">*</span><span class="ident" id="5262205">compiler</span><span class="op" id="5262213">)</span>&nbsp;<span class="ident" id="5262215">fail</span><span class="op" id="5262219">(</span><span class="op" id="5262220">)</span>&nbsp;<span class="ident" id="5262222">frag</span>&nbsp;<span class="op" id="5262227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262230">return</span>&nbsp;<span class="ident" id="5262237">frag</span><span class="op" id="5262241">{</span><span class="op" id="5262242">}</span><br>
<span class="lineno">185</span><span class="op" id="5262244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262247">func</span>&nbsp;<span class="op" id="5262252">(</span><span class="ident" id="5262253">c</span>&nbsp;<span class="op" id="5262255">*</span><span class="ident" id="5262256">compiler</span><span class="op" id="5262264">)</span>&nbsp;<span class="builtinfunc" id="5262266">cap</span><span class="op" id="5262269">(</span><span class="ident" id="5262270">arg</span>&nbsp;<span class="builtintype" id="5262274">uint32</span><span class="op" id="5262280">)</span>&nbsp;<span class="ident" id="5262282">frag</span>&nbsp;<span class="op" id="5262287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262290">f</span>&nbsp;<span class="op" id="5262292">:=</span>&nbsp;<span class="ident" id="5262295">c</span><span class="op" id="5262296">.</span><span class="ident" id="5262297">inst</span><span class="op" id="5262301">(</span><span class="ident" id="5262302">InstCapture</span><span class="op" id="5262313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262316">f</span><span class="op" id="5262317">.</span><span class="ident" id="5262318">out</span>&nbsp;<span class="op" id="5262322">=</span>&nbsp;<span class="ident" id="5262324">patchList</span><span class="op" id="5262333">(</span><span class="ident" id="5262334">f</span><span class="op" id="5262335">.</span><span class="ident" id="5262336">i</span>&nbsp;<span class="op" id="5262338">&lt;&lt;</span>&nbsp;<span class="num" id="5262341">1</span><span class="op" id="5262342">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262345">c</span><span class="op" id="5262346">.</span><span class="ident" id="5262347">p</span><span class="op" id="5262348">.</span><span class="ident" id="5262349">Inst</span><span class="op" id="5262353">[</span><span class="ident" id="5262354">f</span><span class="op" id="5262355">.</span><span class="ident" id="5262356">i</span><span class="op" id="5262357">]</span><span class="op" id="5262358">.</span><span class="ident" id="5262359">Arg</span>&nbsp;<span class="op" id="5262363">=</span>&nbsp;<span class="ident" id="5262365">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262371">if</span>&nbsp;<span class="ident" id="5262374">c</span><span class="op" id="5262375">.</span><span class="ident" id="5262376">p</span><span class="op" id="5262377">.</span><span class="ident" id="5262378">NumCap</span>&nbsp;<span class="op" id="5262385">&lt;</span>&nbsp;<span class="builtintype" id="5262387">int</span><span class="op" id="5262390">(</span><span class="ident" id="5262391">arg</span><span class="op" id="5262394">)</span><span class="op" id="5262395">+</span><span class="num" id="5262396">1</span>&nbsp;<span class="op" id="5262398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262402">c</span><span class="op" id="5262403">.</span><span class="ident" id="5262404">p</span><span class="op" id="5262405">.</span><span class="ident" id="5262406">NumCap</span>&nbsp;<span class="op" id="5262413">=</span>&nbsp;<span class="builtintype" id="5262415">int</span><span class="op" id="5262418">(</span><span class="ident" id="5262419">arg</span><span class="op" id="5262422">)</span>&nbsp;<span class="op" id="5262424">+</span>&nbsp;<span class="num" id="5262426">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262429">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262432">return</span>&nbsp;<span class="ident" id="5262439">f</span><br>
<span class="lineno"></span><span class="op" id="5262441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262444">func</span>&nbsp;<span class="op" id="5262449">(</span><span class="ident" id="5262450">c</span>&nbsp;<span class="op" id="5262452">*</span><span class="ident" id="5262453">compiler</span><span class="op" id="5262461">)</span>&nbsp;<span class="ident" id="5262463">cat</span><span class="op" id="5262466">(</span><span class="ident" id="5262467">f1</span><span class="op" id="5262469">,</span>&nbsp;<span class="ident" id="5262471">f2</span>&nbsp;<span class="ident" id="5262474">frag</span><span class="op" id="5262478">)</span>&nbsp;<span class="ident" id="5262480">frag</span>&nbsp;<span class="op" id="5262485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5262488">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262521">if</span>&nbsp;<span class="ident" id="5262524">f1</span><span class="op" id="5262526">.</span><span class="ident" id="5262527">i</span>&nbsp;<span class="op" id="5262529">==</span>&nbsp;<span class="num" id="5262532">0</span>&nbsp;<span class="op" id="5262534">||</span>&nbsp;<span class="ident" id="5262537">f2</span><span class="op" id="5262539">.</span><span class="ident" id="5262540">i</span>&nbsp;<span class="op" id="5262542">==</span>&nbsp;<span class="num" id="5262545">0</span>&nbsp;<span class="op" id="5262547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262551">return</span>&nbsp;<span class="ident" id="5262558">frag</span><span class="op" id="5262562">{</span><span class="op" id="5262563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5262570">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262591">f1</span><span class="op" id="5262593">.</span><span class="ident" id="5262594">out</span><span class="op" id="5262597">.</span><span class="ident" id="5262598">patch</span><span class="op" id="5262603">(</span><span class="ident" id="5262604">c</span><span class="op" id="5262605">.</span><span class="ident" id="5262606">p</span><span class="op" id="5262607">,</span>&nbsp;<span class="ident" id="5262609">f2</span><span class="op" id="5262611">.</span><span class="ident" id="5262612">i</span><span class="op" id="5262613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262616">return</span>&nbsp;<span class="ident" id="5262623">frag</span><span class="op" id="5262627">{</span><span class="ident" id="5262628">f1</span><span class="op" id="5262630">.</span><span class="ident" id="5262631">i</span><span class="op" id="5262632">,</span>&nbsp;<span class="ident" id="5262634">f2</span><span class="op" id="5262636">.</span><span class="ident" id="5262637">out</span><span class="op" id="5262640">}</span><br>
<span class="lineno"></span><span class="op" id="5262642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5262645">func</span>&nbsp;<span class="op" id="5262650">(</span><span class="ident" id="5262651">c</span>&nbsp;<span class="op" id="5262653">*</span><span class="ident" id="5262654">compiler</span><span class="op" id="5262662">)</span>&nbsp;<span class="ident" id="5262664">alt</span><span class="op" id="5262667">(</span><span class="ident" id="5262668">f1</span><span class="op" id="5262670">,</span>&nbsp;<span class="ident" id="5262672">f2</span>&nbsp;<span class="ident" id="5262675">frag</span><span class="op" id="5262679">)</span>&nbsp;<span class="ident" id="5262681">frag</span>&nbsp;<span class="op" id="5262686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5262689">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262717">if</span>&nbsp;<span class="ident" id="5262720">f1</span><span class="op" id="5262722">.</span><span class="ident" id="5262723">i</span>&nbsp;<span class="op" id="5262725">==</span>&nbsp;<span class="num" id="5262728">0</span>&nbsp;<span class="op" id="5262730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262734">return</span>&nbsp;<span class="ident" id="5262741">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262745">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262748">if</span>&nbsp;<span class="ident" id="5262751">f2</span><span class="op" id="5262753">.</span><span class="ident" id="5262754">i</span>&nbsp;<span class="op" id="5262756">==</span>&nbsp;<span class="num" id="5262759">0</span>&nbsp;<span class="op" id="5262761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262765">return</span>&nbsp;<span class="ident" id="5262772">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262780">f</span>&nbsp;<span class="op" id="5262782">:=</span>&nbsp;<span class="ident" id="5262785">c</span><span class="op" id="5262786">.</span><span class="ident" id="5262787">inst</span><span class="op" id="5262791">(</span><span class="ident" id="5262792">InstAlt</span><span class="op" id="5262799">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262802">i</span>&nbsp;<span class="op" id="5262804">:=</span>&nbsp;<span class="op" id="5262807">&amp;</span><span class="ident" id="5262808">c</span><span class="op" id="5262809">.</span><span class="ident" id="5262810">p</span><span class="op" id="5262811">.</span><span class="ident" id="5262812">Inst</span><span class="op" id="5262816">[</span><span class="ident" id="5262817">f</span><span class="op" id="5262818">.</span><span class="ident" id="5262819">i</span><span class="op" id="5262820">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262823">i</span><span class="op" id="5262824">.</span><span class="ident" id="5262825">Out</span>&nbsp;<span class="op" id="5262829">=</span>&nbsp;<span class="ident" id="5262831">f1</span><span class="op" id="5262833">.</span><span class="ident" id="5262834">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262837">i</span><span class="op" id="5262838">.</span><span class="ident" id="5262839">Arg</span>&nbsp;<span class="op" id="5262843">=</span>&nbsp;<span class="ident" id="5262845">f2</span><span class="op" id="5262847">.</span><span class="ident" id="5262848">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262851">f</span><span class="op" id="5262852">.</span><span class="ident" id="5262853">out</span>&nbsp;<span class="op" id="5262857">=</span>&nbsp;<span class="ident" id="5262859">f1</span><span class="op" id="5262861">.</span><span class="ident" id="5262862">out</span><span class="op" id="5262865">.</span><span class="builtinfunc" id="5262866">append</span><span class="op" id="5262872">(</span><span class="ident" id="5262873">c</span><span class="op" id="5262874">.</span><span class="ident" id="5262875">p</span><span class="op" id="5262876">,</span>&nbsp;<span class="ident" id="5262878">f2</span><span class="op" id="5262880">.</span><span class="ident" id="5262881">out</span><span class="op" id="5262884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262887">return</span>&nbsp;<span class="ident" id="5262894">f</span><br>
<span class="lineno">225</span><span class="op" id="5262896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262899">func</span>&nbsp;<span class="op" id="5262904">(</span><span class="ident" id="5262905">c</span>&nbsp;<span class="op" id="5262907">*</span><span class="ident" id="5262908">compiler</span><span class="op" id="5262916">)</span>&nbsp;<span class="ident" id="5262918">quest</span><span class="op" id="5262923">(</span><span class="ident" id="5262924">f1</span>&nbsp;<span class="ident" id="5262927">frag</span><span class="op" id="5262931">,</span>&nbsp;<span class="ident" id="5262933">nongreedy</span>&nbsp;<span class="builtintype" id="5262943">bool</span><span class="op" id="5262947">)</span>&nbsp;<span class="ident" id="5262949">frag</span>&nbsp;<span class="op" id="5262954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262957">f</span>&nbsp;<span class="op" id="5262959">:=</span>&nbsp;<span class="ident" id="5262962">c</span><span class="op" id="5262963">.</span><span class="ident" id="5262964">inst</span><span class="op" id="5262968">(</span><span class="ident" id="5262969">InstAlt</span><span class="op" id="5262976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262979">i</span>&nbsp;<span class="op" id="5262981">:=</span>&nbsp;<span class="op" id="5262984">&amp;</span><span class="ident" id="5262985">c</span><span class="op" id="5262986">.</span><span class="ident" id="5262987">p</span><span class="op" id="5262988">.</span><span class="ident" id="5262989">Inst</span><span class="op" id="5262993">[</span><span class="ident" id="5262994">f</span><span class="op" id="5262995">.</span><span class="ident" id="5262996">i</span><span class="op" id="5262997">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263000">if</span>&nbsp;<span class="ident" id="5263003">nongreedy</span>&nbsp;<span class="op" id="5263013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263017">i</span><span class="op" id="5263018">.</span><span class="ident" id="5263019">Arg</span>&nbsp;<span class="op" id="5263023">=</span>&nbsp;<span class="ident" id="5263025">f1</span><span class="op" id="5263027">.</span><span class="ident" id="5263028">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263032">f</span><span class="op" id="5263033">.</span><span class="ident" id="5263034">out</span>&nbsp;<span class="op" id="5263038">=</span>&nbsp;<span class="ident" id="5263040">patchList</span><span class="op" id="5263049">(</span><span class="ident" id="5263050">f</span><span class="op" id="5263051">.</span><span class="ident" id="5263052">i</span>&nbsp;<span class="op" id="5263054">&lt;&lt;</span>&nbsp;<span class="num" id="5263057">1</span><span class="op" id="5263058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263061">}</span>&nbsp;<span class="keyword" id="5263063">else</span>&nbsp;<span class="op" id="5263068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263072">i</span><span class="op" id="5263073">.</span><span class="ident" id="5263074">Out</span>&nbsp;<span class="op" id="5263078">=</span>&nbsp;<span class="ident" id="5263080">f1</span><span class="op" id="5263082">.</span><span class="ident" id="5263083">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263087">f</span><span class="op" id="5263088">.</span><span class="ident" id="5263089">out</span>&nbsp;<span class="op" id="5263093">=</span>&nbsp;<span class="ident" id="5263095">patchList</span><span class="op" id="5263104">(</span><span class="ident" id="5263105">f</span><span class="op" id="5263106">.</span><span class="ident" id="5263107">i</span><span class="op" id="5263108">&lt;&lt;</span><span class="num" id="5263110">1</span>&nbsp;<span class="op" id="5263112">|</span>&nbsp;<span class="num" id="5263114">1</span><span class="op" id="5263115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263121">f</span><span class="op" id="5263122">.</span><span class="ident" id="5263123">out</span>&nbsp;<span class="op" id="5263127">=</span>&nbsp;<span class="ident" id="5263129">f</span><span class="op" id="5263130">.</span><span class="ident" id="5263131">out</span><span class="op" id="5263134">.</span><span class="builtinfunc" id="5263135">append</span><span class="op" id="5263141">(</span><span class="ident" id="5263142">c</span><span class="op" id="5263143">.</span><span class="ident" id="5263144">p</span><span class="op" id="5263145">,</span>&nbsp;<span class="ident" id="5263147">f1</span><span class="op" id="5263149">.</span><span class="ident" id="5263150">out</span><span class="op" id="5263153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263156">return</span>&nbsp;<span class="ident" id="5263163">f</span><br>
<span class="lineno"></span><span class="op" id="5263165">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5263168">func</span>&nbsp;<span class="op" id="5263173">(</span><span class="ident" id="5263174">c</span>&nbsp;<span class="op" id="5263176">*</span><span class="ident" id="5263177">compiler</span><span class="op" id="5263185">)</span>&nbsp;<span class="ident" id="5263187">star</span><span class="op" id="5263191">(</span><span class="ident" id="5263192">f1</span>&nbsp;<span class="ident" id="5263195">frag</span><span class="op" id="5263199">,</span>&nbsp;<span class="ident" id="5263201">nongreedy</span>&nbsp;<span class="builtintype" id="5263211">bool</span><span class="op" id="5263215">)</span>&nbsp;<span class="ident" id="5263217">frag</span>&nbsp;<span class="op" id="5263222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263225">f</span>&nbsp;<span class="op" id="5263227">:=</span>&nbsp;<span class="ident" id="5263230">c</span><span class="op" id="5263231">.</span><span class="ident" id="5263232">inst</span><span class="op" id="5263236">(</span><span class="ident" id="5263237">InstAlt</span><span class="op" id="5263244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263247">i</span>&nbsp;<span class="op" id="5263249">:=</span>&nbsp;<span class="op" id="5263252">&amp;</span><span class="ident" id="5263253">c</span><span class="op" id="5263254">.</span><span class="ident" id="5263255">p</span><span class="op" id="5263256">.</span><span class="ident" id="5263257">Inst</span><span class="op" id="5263261">[</span><span class="ident" id="5263262">f</span><span class="op" id="5263263">.</span><span class="ident" id="5263264">i</span><span class="op" id="5263265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263268">if</span>&nbsp;<span class="ident" id="5263271">nongreedy</span>&nbsp;<span class="op" id="5263281">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263285">i</span><span class="op" id="5263286">.</span><span class="ident" id="5263287">Arg</span>&nbsp;<span class="op" id="5263291">=</span>&nbsp;<span class="ident" id="5263293">f1</span><span class="op" id="5263295">.</span><span class="ident" id="5263296">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263300">f</span><span class="op" id="5263301">.</span><span class="ident" id="5263302">out</span>&nbsp;<span class="op" id="5263306">=</span>&nbsp;<span class="ident" id="5263308">patchList</span><span class="op" id="5263317">(</span><span class="ident" id="5263318">f</span><span class="op" id="5263319">.</span><span class="ident" id="5263320">i</span>&nbsp;<span class="op" id="5263322">&lt;&lt;</span>&nbsp;<span class="num" id="5263325">1</span><span class="op" id="5263326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263329">}</span>&nbsp;<span class="keyword" id="5263331">else</span>&nbsp;<span class="op" id="5263336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263340">i</span><span class="op" id="5263341">.</span><span class="ident" id="5263342">Out</span>&nbsp;<span class="op" id="5263346">=</span>&nbsp;<span class="ident" id="5263348">f1</span><span class="op" id="5263350">.</span><span class="ident" id="5263351">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263355">f</span><span class="op" id="5263356">.</span><span class="ident" id="5263357">out</span>&nbsp;<span class="op" id="5263361">=</span>&nbsp;<span class="ident" id="5263363">patchList</span><span class="op" id="5263372">(</span><span class="ident" id="5263373">f</span><span class="op" id="5263374">.</span><span class="ident" id="5263375">i</span><span class="op" id="5263376">&lt;&lt;</span><span class="num" id="5263378">1</span>&nbsp;<span class="op" id="5263380">|</span>&nbsp;<span class="num" id="5263382">1</span><span class="op" id="5263383">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263389">f1</span><span class="op" id="5263391">.</span><span class="ident" id="5263392">out</span><span class="op" id="5263395">.</span><span class="ident" id="5263396">patch</span><span class="op" id="5263401">(</span><span class="ident" id="5263402">c</span><span class="op" id="5263403">.</span><span class="ident" id="5263404">p</span><span class="op" id="5263405">,</span>&nbsp;<span class="ident" id="5263407">f</span><span class="op" id="5263408">.</span><span class="ident" id="5263409">i</span><span class="op" id="5263410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263413">return</span>&nbsp;<span class="ident" id="5263420">f</span><br>
<span class="lineno"></span><span class="op" id="5263422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5263425">func</span>&nbsp;<span class="op" id="5263430">(</span><span class="ident" id="5263431">c</span>&nbsp;<span class="op" id="5263433">*</span><span class="ident" id="5263434">compiler</span><span class="op" id="5263442">)</span>&nbsp;<span class="ident" id="5263444">plus</span><span class="op" id="5263448">(</span><span class="ident" id="5263449">f1</span>&nbsp;<span class="ident" id="5263452">frag</span><span class="op" id="5263456">,</span>&nbsp;<span class="ident" id="5263458">nongreedy</span>&nbsp;<span class="builtintype" id="5263468">bool</span><span class="op" id="5263472">)</span>&nbsp;<span class="ident" id="5263474">frag</span>&nbsp;<span class="op" id="5263479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263482">return</span>&nbsp;<span class="ident" id="5263489">frag</span><span class="op" id="5263493">{</span><span class="ident" id="5263494">f1</span><span class="op" id="5263496">.</span><span class="ident" id="5263497">i</span><span class="op" id="5263498">,</span>&nbsp;<span class="ident" id="5263500">c</span><span class="op" id="5263501">.</span><span class="ident" id="5263502">star</span><span class="op" id="5263506">(</span><span class="ident" id="5263507">f1</span><span class="op" id="5263509">,</span>&nbsp;<span class="ident" id="5263511">nongreedy</span><span class="op" id="5263520">)</span><span class="op" id="5263521">.</span><span class="ident" id="5263522">out</span><span class="op" id="5263525">}</span><br>
<span class="lineno"></span><span class="op" id="5263527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5263530">func</span>&nbsp;<span class="op" id="5263535">(</span><span class="ident" id="5263536">c</span>&nbsp;<span class="op" id="5263538">*</span><span class="ident" id="5263539">compiler</span><span class="op" id="5263547">)</span>&nbsp;<span class="ident" id="5263549">empty</span><span class="op" id="5263554">(</span><span class="ident" id="5263555">op</span>&nbsp;<span class="ident" id="5263558">EmptyOp</span><span class="op" id="5263565">)</span>&nbsp;<span class="ident" id="5263567">frag</span>&nbsp;<span class="op" id="5263572">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263575">f</span>&nbsp;<span class="op" id="5263577">:=</span>&nbsp;<span class="ident" id="5263580">c</span><span class="op" id="5263581">.</span><span class="ident" id="5263582">inst</span><span class="op" id="5263586">(</span><span class="ident" id="5263587">InstEmptyWidth</span><span class="op" id="5263601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263604">c</span><span class="op" id="5263605">.</span><span class="ident" id="5263606">p</span><span class="op" id="5263607">.</span><span class="ident" id="5263608">Inst</span><span class="op" id="5263612">[</span><span class="ident" id="5263613">f</span><span class="op" id="5263614">.</span><span class="ident" id="5263615">i</span><span class="op" id="5263616">]</span><span class="op" id="5263617">.</span><span class="ident" id="5263618">Arg</span>&nbsp;<span class="op" id="5263622">=</span>&nbsp;<span class="builtintype" id="5263624">uint32</span><span class="op" id="5263630">(</span><span class="ident" id="5263631">op</span><span class="op" id="5263633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263636">f</span><span class="op" id="5263637">.</span><span class="ident" id="5263638">out</span>&nbsp;<span class="op" id="5263642">=</span>&nbsp;<span class="ident" id="5263644">patchList</span><span class="op" id="5263653">(</span><span class="ident" id="5263654">f</span><span class="op" id="5263655">.</span><span class="ident" id="5263656">i</span>&nbsp;<span class="op" id="5263658">&lt;&lt;</span>&nbsp;<span class="num" id="5263661">1</span><span class="op" id="5263662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263665">return</span>&nbsp;<span class="ident" id="5263672">f</span><br>
<span class="lineno"></span><span class="op" id="5263674">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5263677">func</span>&nbsp;<span class="op" id="5263682">(</span><span class="ident" id="5263683">c</span>&nbsp;<span class="op" id="5263685">*</span><span class="ident" id="5263686">compiler</span><span class="op" id="5263694">)</span>&nbsp;<span class="builtintype" id="5263696">rune</span><span class="op" id="5263700">(</span><span class="ident" id="5263701">r</span>&nbsp;<span class="op" id="5263703">[</span><span class="op" id="5263704">]</span><span class="builtintype" id="5263705">rune</span><span class="op" id="5263709">,</span>&nbsp;<span class="ident" id="5263711">flags</span>&nbsp;<span class="ident" id="5263717">Flags</span><span class="op" id="5263722">)</span>&nbsp;<span class="ident" id="5263724">frag</span>&nbsp;<span class="op" id="5263729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263732">f</span>&nbsp;<span class="op" id="5263734">:=</span>&nbsp;<span class="ident" id="5263737">c</span><span class="op" id="5263738">.</span><span class="ident" id="5263739">inst</span><span class="op" id="5263743">(</span><span class="ident" id="5263744">InstRune</span><span class="op" id="5263752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263755">i</span>&nbsp;<span class="op" id="5263757">:=</span>&nbsp;<span class="op" id="5263760">&amp;</span><span class="ident" id="5263761">c</span><span class="op" id="5263762">.</span><span class="ident" id="5263763">p</span><span class="op" id="5263764">.</span><span class="ident" id="5263765">Inst</span><span class="op" id="5263769">[</span><span class="ident" id="5263770">f</span><span class="op" id="5263771">.</span><span class="ident" id="5263772">i</span><span class="op" id="5263773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263776">i</span><span class="op" id="5263777">.</span><span class="ident" id="5263778">Rune</span>&nbsp;<span class="op" id="5263783">=</span>&nbsp;<span class="ident" id="5263785">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263788">flags</span>&nbsp;<span class="op" id="5263794">&amp;=</span>&nbsp;<span class="ident" id="5263797">FoldCase</span>&nbsp;<span class="comment" id="5263806">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263841">if</span>&nbsp;<span class="builtinfunc" id="5263844">len</span><span class="op" id="5263847">(</span><span class="ident" id="5263848">r</span><span class="op" id="5263849">)</span>&nbsp;<span class="op" id="5263851">!=</span>&nbsp;<span class="num" id="5263854">1</span>&nbsp;<span class="op" id="5263856">||</span>&nbsp;<span class="ident" id="5263859">unicode</span><span class="op" id="5263866">.</span><span class="ident" id="5263867">SimpleFold</span><span class="op" id="5263877">(</span><span class="ident" id="5263878">r</span><span class="op" id="5263879">[</span><span class="num" id="5263880">0</span><span class="op" id="5263881">]</span><span class="op" id="5263882">)</span>&nbsp;<span class="op" id="5263884">==</span>&nbsp;<span class="ident" id="5263887">r</span><span class="op" id="5263888">[</span><span class="num" id="5263889">0</span><span class="op" id="5263890">]</span>&nbsp;<span class="op" id="5263892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263896">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263929">flags</span>&nbsp;<span class="op" id="5263935">&amp;^=</span>&nbsp;<span class="ident" id="5263939">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263949">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263952">i</span><span class="op" id="5263953">.</span><span class="ident" id="5263954">Arg</span>&nbsp;<span class="op" id="5263958">=</span>&nbsp;<span class="builtintype" id="5263960">uint32</span><span class="op" id="5263966">(</span><span class="ident" id="5263967">flags</span><span class="op" id="5263972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263975">f</span><span class="op" id="5263976">.</span><span class="ident" id="5263977">out</span>&nbsp;<span class="op" id="5263981">=</span>&nbsp;<span class="ident" id="5263983">patchList</span><span class="op" id="5263992">(</span><span class="ident" id="5263993">f</span><span class="op" id="5263994">.</span><span class="ident" id="5263995">i</span>&nbsp;<span class="op" id="5263997">&lt;&lt;</span>&nbsp;<span class="num" id="5264000">1</span><span class="op" id="5264001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264005">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264041">switch</span>&nbsp;<span class="op" id="5264048">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264051">case</span>&nbsp;<span class="ident" id="5264056">flags</span><span class="op" id="5264061">&amp;</span><span class="ident" id="5264062">FoldCase</span>&nbsp;<span class="op" id="5264071">==</span>&nbsp;<span class="num" id="5264074">0</span>&nbsp;<span class="op" id="5264076">&amp;&amp;</span>&nbsp;<span class="op" id="5264079">(</span><span class="builtinfunc" id="5264080">len</span><span class="op" id="5264083">(</span><span class="ident" id="5264084">r</span><span class="op" id="5264085">)</span>&nbsp;<span class="op" id="5264087">==</span>&nbsp;<span class="num" id="5264090">1</span>&nbsp;<span class="op" id="5264092">||</span>&nbsp;<span class="builtinfunc" id="5264095">len</span><span class="op" id="5264098">(</span><span class="ident" id="5264099">r</span><span class="op" id="5264100">)</span>&nbsp;<span class="op" id="5264102">==</span>&nbsp;<span class="num" id="5264105">2</span>&nbsp;<span class="op" id="5264107">&amp;&amp;</span>&nbsp;<span class="ident" id="5264110">r</span><span class="op" id="5264111">[</span><span class="num" id="5264112">0</span><span class="op" id="5264113">]</span>&nbsp;<span class="op" id="5264115">==</span>&nbsp;<span class="ident" id="5264118">r</span><span class="op" id="5264119">[</span><span class="num" id="5264120">1</span><span class="op" id="5264121">]</span><span class="op" id="5264122">)</span><span class="op" id="5264123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264127">i</span><span class="op" id="5264128">.</span><span class="ident" id="5264129">Op</span>&nbsp;<span class="op" id="5264132">=</span>&nbsp;<span class="ident" id="5264134">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264145">case</span>&nbsp;<span class="builtinfunc" id="5264150">len</span><span class="op" id="5264153">(</span><span class="ident" id="5264154">r</span><span class="op" id="5264155">)</span>&nbsp;<span class="op" id="5264157">==</span>&nbsp;<span class="num" id="5264160">2</span>&nbsp;<span class="op" id="5264162">&amp;&amp;</span>&nbsp;<span class="ident" id="5264165">r</span><span class="op" id="5264166">[</span><span class="num" id="5264167">0</span><span class="op" id="5264168">]</span>&nbsp;<span class="op" id="5264170">==</span>&nbsp;<span class="num" id="5264173">0</span>&nbsp;<span class="op" id="5264175">&amp;&amp;</span>&nbsp;<span class="ident" id="5264178">r</span><span class="op" id="5264179">[</span><span class="num" id="5264180">1</span><span class="op" id="5264181">]</span>&nbsp;<span class="op" id="5264183">==</span>&nbsp;<span class="ident" id="5264186">unicode</span><span class="op" id="5264193">.</span><span class="ident" id="5264194">MaxRune</span><span class="op" id="5264201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264205">i</span><span class="op" id="5264206">.</span><span class="ident" id="5264207">Op</span>&nbsp;<span class="op" id="5264210">=</span>&nbsp;<span class="ident" id="5264212">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264225">case</span>&nbsp;<span class="builtinfunc" id="5264230">len</span><span class="op" id="5264233">(</span><span class="ident" id="5264234">r</span><span class="op" id="5264235">)</span>&nbsp;<span class="op" id="5264237">==</span>&nbsp;<span class="num" id="5264240">4</span>&nbsp;<span class="op" id="5264242">&amp;&amp;</span>&nbsp;<span class="ident" id="5264245">r</span><span class="op" id="5264246">[</span><span class="num" id="5264247">0</span><span class="op" id="5264248">]</span>&nbsp;<span class="op" id="5264250">==</span>&nbsp;<span class="num" id="5264253">0</span>&nbsp;<span class="op" id="5264255">&amp;&amp;</span>&nbsp;<span class="ident" id="5264258">r</span><span class="op" id="5264259">[</span><span class="num" id="5264260">1</span><span class="op" id="5264261">]</span>&nbsp;<span class="op" id="5264263">==</span>&nbsp;<span class="string" id="5264266">&#39;\n&#39;</span><span class="op" id="5264270">-</span><span class="num" id="5264271">1</span>&nbsp;<span class="op" id="5264273">&amp;&amp;</span>&nbsp;<span class="ident" id="5264276">r</span><span class="op" id="5264277">[</span><span class="num" id="5264278">2</span><span class="op" id="5264279">]</span>&nbsp;<span class="op" id="5264281">==</span>&nbsp;<span class="string" id="5264284">&#39;\n&#39;</span><span class="op" id="5264288">+</span><span class="num" id="5264289">1</span>&nbsp;<span class="op" id="5264291">&amp;&amp;</span>&nbsp;<span class="ident" id="5264294">r</span><span class="op" id="5264295">[</span><span class="num" id="5264296">3</span><span class="op" id="5264297">]</span>&nbsp;<span class="op" id="5264299">==</span>&nbsp;<span class="ident" id="5264302">unicode</span><span class="op" id="5264309">.</span><span class="ident" id="5264310">MaxRune</span><span class="op" id="5264317">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264321">i</span><span class="op" id="5264322">.</span><span class="ident" id="5264323">Op</span>&nbsp;<span class="op" id="5264326">=</span>&nbsp;<span class="ident" id="5264328">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264350">return</span>&nbsp;<span class="ident" id="5264357">f</span><br>
<span class="lineno"></span><span class="op" id="5264359">}</span>
</div>
</body>
</html>
