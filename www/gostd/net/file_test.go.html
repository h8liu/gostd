<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7784980">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7785035">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7785089">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7785140">package</span>&nbsp;<span class="ident" id="7785148">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7785153">import</span>&nbsp;<span class="op" id="7785160">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7785163">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7785169">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7785180">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7785191">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7785201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7785204">type</span>&nbsp;<span class="ident" id="7785209">listenerFile</span>&nbsp;<span class="keyword" id="7785222">interface</span>&nbsp;<span class="op" id="7785232">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785235">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785245">File</span><span class="op" id="7785249">(</span><span class="op" id="7785250">)</span>&nbsp;<span class="op" id="7785252">(</span><span class="ident" id="7785253">f</span>&nbsp;<span class="op" id="7785255">*</span><span class="ident" id="7785256">os</span><span class="op" id="7785258">.</span><span class="ident" id="7785259">File</span><span class="op" id="7785263">,</span>&nbsp;<span class="ident" id="7785265">err</span>&nbsp;<span class="builtintype" id="7785269">error</span><span class="op" id="7785274">)</span><br>
<span class="lineno"></span><span class="op" id="7785276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7785279">type</span>&nbsp;<span class="ident" id="7785284">packetConnFile</span>&nbsp;<span class="keyword" id="7785299">interface</span>&nbsp;<span class="op" id="7785309">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785312">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785324">File</span><span class="op" id="7785328">(</span><span class="op" id="7785329">)</span>&nbsp;<span class="op" id="7785331">(</span><span class="ident" id="7785332">f</span>&nbsp;<span class="op" id="7785334">*</span><span class="ident" id="7785335">os</span><span class="op" id="7785337">.</span><span class="ident" id="7785338">File</span><span class="op" id="7785342">,</span>&nbsp;<span class="ident" id="7785344">err</span>&nbsp;<span class="builtintype" id="7785348">error</span><span class="op" id="7785353">)</span><br>
<span class="lineno"></span><span class="op" id="7785355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7785358">type</span>&nbsp;<span class="ident" id="7785363">connFile</span>&nbsp;<span class="keyword" id="7785372">interface</span>&nbsp;<span class="op" id="7785382">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785385">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785391">File</span><span class="op" id="7785395">(</span><span class="op" id="7785396">)</span>&nbsp;<span class="op" id="7785398">(</span><span class="ident" id="7785399">f</span>&nbsp;<span class="op" id="7785401">*</span><span class="ident" id="7785402">os</span><span class="op" id="7785404">.</span><span class="ident" id="7785405">File</span><span class="op" id="7785409">,</span>&nbsp;<span class="ident" id="7785411">err</span>&nbsp;<span class="builtintype" id="7785415">error</span><span class="op" id="7785420">)</span><br>
<span class="lineno"></span><span class="op" id="7785422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7785425">func</span>&nbsp;<span class="ident" id="7785430">testFileListener</span><span class="op" id="7785446">(</span><span class="ident" id="7785447">t</span>&nbsp;<span class="op" id="7785449">*</span><span class="ident" id="7785450">testing</span><span class="op" id="7785457">.</span><span class="ident" id="7785458">T</span><span class="op" id="7785459">,</span>&nbsp;<span class="ident" id="7785461">net</span><span class="op" id="7785464">,</span>&nbsp;<span class="ident" id="7785466">laddr</span>&nbsp;<span class="builtintype" id="7785472">string</span><span class="op" id="7785478">)</span>&nbsp;<span class="op" id="7785480">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785483">switch</span>&nbsp;<span class="ident" id="7785490">net</span>&nbsp;<span class="op" id="7785494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785497">case</span>&nbsp;<span class="string" id="7785502">&#34;tcp&#34;</span><span class="op" id="7785507">,</span>&nbsp;<span class="string" id="7785509">&#34;tcp4&#34;</span><span class="op" id="7785515">,</span>&nbsp;<span class="string" id="7785517">&#34;tcp6&#34;</span><span class="op" id="7785523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785527">laddr</span>&nbsp;<span class="op" id="7785533">+=</span>&nbsp;<span class="string" id="7785536">&#34;:0&#34;</span>&nbsp;<span class="comment" id="7785541">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7785564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785567">l</span><span class="op" id="7785568">,</span>&nbsp;<span class="ident" id="7785570">err</span>&nbsp;<span class="op" id="7785574">:=</span>&nbsp;<span class="ident" id="7785577">Listen</span><span class="op" id="7785583">(</span><span class="ident" id="7785584">net</span><span class="op" id="7785587">,</span>&nbsp;<span class="ident" id="7785589">laddr</span><span class="op" id="7785594">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785597">if</span>&nbsp;<span class="ident" id="7785600">err</span>&nbsp;<span class="op" id="7785604">!=</span>&nbsp;<span class="ident" id="7785607">nil</span>&nbsp;<span class="op" id="7785611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785615">t</span><span class="op" id="7785616">.</span><span class="ident" id="7785617">Fatalf</span><span class="op" id="7785623">(</span><span class="string" id="7785624">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7785643">,</span>&nbsp;<span class="ident" id="7785645">err</span><span class="op" id="7785648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7785651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785654">defer</span>&nbsp;<span class="ident" id="7785660">l</span><span class="op" id="7785661">.</span><span class="ident" id="7785662">Close</span><span class="op" id="7785667">(</span><span class="op" id="7785668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785671">lf</span>&nbsp;<span class="op" id="7785674">:=</span>&nbsp;<span class="ident" id="7785677">l</span><span class="op" id="7785678">.</span><span class="op" id="7785679">(</span><span class="ident" id="7785680">listenerFile</span><span class="op" id="7785692">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785695">f</span><span class="op" id="7785696">,</span>&nbsp;<span class="ident" id="7785698">err</span>&nbsp;<span class="op" id="7785702">:=</span>&nbsp;<span class="ident" id="7785705">lf</span><span class="op" id="7785707">.</span><span class="ident" id="7785708">File</span><span class="op" id="7785712">(</span><span class="op" id="7785713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785716">if</span>&nbsp;<span class="ident" id="7785719">err</span>&nbsp;<span class="op" id="7785723">!=</span>&nbsp;<span class="ident" id="7785726">nil</span>&nbsp;<span class="op" id="7785730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785734">t</span><span class="op" id="7785735">.</span><span class="ident" id="7785736">Fatalf</span><span class="op" id="7785742">(</span><span class="string" id="7785743">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7785760">,</span>&nbsp;<span class="ident" id="7785762">err</span><span class="op" id="7785765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7785768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785771">c</span><span class="op" id="7785772">,</span>&nbsp;<span class="ident" id="7785774">err</span>&nbsp;<span class="op" id="7785778">:=</span>&nbsp;<span class="ident" id="7785781">FileListener</span><span class="op" id="7785793">(</span><span class="ident" id="7785794">f</span><span class="op" id="7785795">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785798">if</span>&nbsp;<span class="ident" id="7785801">err</span>&nbsp;<span class="op" id="7785805">!=</span>&nbsp;<span class="ident" id="7785808">nil</span>&nbsp;<span class="op" id="7785812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785816">t</span><span class="op" id="7785817">.</span><span class="ident" id="7785818">Fatalf</span><span class="op" id="7785824">(</span><span class="string" id="7785825">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7785850">,</span>&nbsp;<span class="ident" id="7785852">err</span><span class="op" id="7785855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7785858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785861">if</span>&nbsp;<span class="op" id="7785864">!</span><span class="ident" id="7785865">reflect</span><span class="op" id="7785872">.</span><span class="ident" id="7785873">DeepEqual</span><span class="op" id="7785882">(</span><span class="ident" id="7785883">l</span><span class="op" id="7785884">.</span><span class="ident" id="7785885">Addr</span><span class="op" id="7785889">(</span><span class="op" id="7785890">)</span><span class="op" id="7785891">,</span>&nbsp;<span class="ident" id="7785893">c</span><span class="op" id="7785894">.</span><span class="ident" id="7785895">Addr</span><span class="op" id="7785899">(</span><span class="op" id="7785900">)</span><span class="op" id="7785901">)</span>&nbsp;<span class="op" id="7785903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7785907">t</span><span class="op" id="7785908">.</span><span class="ident" id="7785909">Fatalf</span><span class="op" id="7785915">(</span><span class="string" id="7785916">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="7785945">,</span>&nbsp;<span class="ident" id="7785947">l</span><span class="op" id="7785948">.</span><span class="ident" id="7785949">Addr</span><span class="op" id="7785953">(</span><span class="op" id="7785954">)</span><span class="op" id="7785955">,</span>&nbsp;<span class="ident" id="7785957">c</span><span class="op" id="7785958">.</span><span class="ident" id="7785959">Addr</span><span class="op" id="7785963">(</span><span class="op" id="7785964">)</span><span class="op" id="7785965">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7785968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7785971">if</span>&nbsp;<span class="ident" id="7785974">err</span>&nbsp;<span class="op" id="7785978">:=</span>&nbsp;<span class="ident" id="7785981">c</span><span class="op" id="7785982">.</span><span class="ident" id="7785983">Close</span><span class="op" id="7785988">(</span><span class="op" id="7785989">)</span><span class="op" id="7785990">;</span>&nbsp;<span class="ident" id="7785992">err</span>&nbsp;<span class="op" id="7785996">!=</span>&nbsp;<span class="ident" id="7785999">nil</span>&nbsp;<span class="op" id="7786003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7786007">t</span><span class="op" id="7786008">.</span><span class="ident" id="7786009">Fatalf</span><span class="op" id="7786015">(</span><span class="string" id="7786016">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7786034">,</span>&nbsp;<span class="ident" id="7786036">err</span><span class="op" id="7786039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7786045">if</span>&nbsp;<span class="ident" id="7786048">err</span>&nbsp;<span class="op" id="7786052">:=</span>&nbsp;<span class="ident" id="7786055">f</span><span class="op" id="7786056">.</span><span class="ident" id="7786057">Close</span><span class="op" id="7786062">(</span><span class="op" id="7786063">)</span><span class="op" id="7786064">;</span>&nbsp;<span class="ident" id="7786066">err</span>&nbsp;<span class="op" id="7786070">!=</span>&nbsp;<span class="ident" id="7786073">nil</span>&nbsp;<span class="op" id="7786077">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7786081">t</span><span class="op" id="7786082">.</span><span class="ident" id="7786083">Fatalf</span><span class="op" id="7786089">(</span><span class="string" id="7786090">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7786108">,</span>&nbsp;<span class="ident" id="7786110">err</span><span class="op" id="7786113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786116">}</span><br>
<span class="lineno"></span><span class="op" id="7786118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7786121">var</span>&nbsp;<span class="ident" id="7786125">fileListenerTests</span>&nbsp;<span class="op" id="7786143">=</span>&nbsp;<span class="op" id="7786145">[</span><span class="op" id="7786146">]</span><span class="keyword" id="7786147">struct</span>&nbsp;<span class="op" id="7786154">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7786157">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7786163">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7786171">laddr</span>&nbsp;<span class="builtintype" id="7786177">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7786185">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="7786191">bool</span>&nbsp;<span class="comment" id="7786196">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7786237">linux</span>&nbsp;<span class="builtintype" id="7786243">bool</span>&nbsp;<span class="comment" id="7786248">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7786302">}</span><span class="op" id="7786303">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786306">{</span><span class="ident" id="7786307">net</span><span class="op" id="7786310">:</span>&nbsp;<span class="string" id="7786312">&#34;tcp&#34;</span><span class="op" id="7786317">,</span>&nbsp;<span class="ident" id="7786319">laddr</span><span class="op" id="7786324">:</span>&nbsp;<span class="string" id="7786326">&#34;&#34;</span><span class="op" id="7786328">}</span><span class="op" id="7786329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786332">{</span><span class="ident" id="7786333">net</span><span class="op" id="7786336">:</span>&nbsp;<span class="string" id="7786338">&#34;tcp&#34;</span><span class="op" id="7786343">,</span>&nbsp;<span class="ident" id="7786345">laddr</span><span class="op" id="7786350">:</span>&nbsp;<span class="string" id="7786352">&#34;0.0.0.0&#34;</span><span class="op" id="7786361">}</span><span class="op" id="7786362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786365">{</span><span class="ident" id="7786366">net</span><span class="op" id="7786369">:</span>&nbsp;<span class="string" id="7786371">&#34;tcp&#34;</span><span class="op" id="7786376">,</span>&nbsp;<span class="ident" id="7786378">laddr</span><span class="op" id="7786383">:</span>&nbsp;<span class="string" id="7786385">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7786403">}</span><span class="op" id="7786404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786407">{</span><span class="ident" id="7786408">net</span><span class="op" id="7786411">:</span>&nbsp;<span class="string" id="7786413">&#34;tcp&#34;</span><span class="op" id="7786418">,</span>&nbsp;<span class="ident" id="7786420">laddr</span><span class="op" id="7786425">:</span>&nbsp;<span class="string" id="7786427">&#34;[::]&#34;</span><span class="op" id="7786433">,</span>&nbsp;<span class="ident" id="7786435">ipv6</span><span class="op" id="7786439">:</span>&nbsp;<span class="builtintype" id="7786441">true</span><span class="op" id="7786445">}</span><span class="op" id="7786446">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786450">{</span><span class="ident" id="7786451">net</span><span class="op" id="7786454">:</span>&nbsp;<span class="string" id="7786456">&#34;tcp&#34;</span><span class="op" id="7786461">,</span>&nbsp;<span class="ident" id="7786463">laddr</span><span class="op" id="7786468">:</span>&nbsp;<span class="string" id="7786470">&#34;127.0.0.1&#34;</span><span class="op" id="7786481">}</span><span class="op" id="7786482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786485">{</span><span class="ident" id="7786486">net</span><span class="op" id="7786489">:</span>&nbsp;<span class="string" id="7786491">&#34;tcp&#34;</span><span class="op" id="7786496">,</span>&nbsp;<span class="ident" id="7786498">laddr</span><span class="op" id="7786503">:</span>&nbsp;<span class="string" id="7786505">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7786525">}</span><span class="op" id="7786526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786529">{</span><span class="ident" id="7786530">net</span><span class="op" id="7786533">:</span>&nbsp;<span class="string" id="7786535">&#34;tcp&#34;</span><span class="op" id="7786540">,</span>&nbsp;<span class="ident" id="7786542">laddr</span><span class="op" id="7786547">:</span>&nbsp;<span class="string" id="7786549">&#34;[::1]&#34;</span><span class="op" id="7786556">,</span>&nbsp;<span class="ident" id="7786558">ipv6</span><span class="op" id="7786562">:</span>&nbsp;<span class="builtintype" id="7786564">true</span><span class="op" id="7786568">}</span><span class="op" id="7786569">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786573">{</span><span class="ident" id="7786574">net</span><span class="op" id="7786577">:</span>&nbsp;<span class="string" id="7786579">&#34;tcp4&#34;</span><span class="op" id="7786585">,</span>&nbsp;<span class="ident" id="7786587">laddr</span><span class="op" id="7786592">:</span>&nbsp;<span class="string" id="7786594">&#34;&#34;</span><span class="op" id="7786596">}</span><span class="op" id="7786597">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786600">{</span><span class="ident" id="7786601">net</span><span class="op" id="7786604">:</span>&nbsp;<span class="string" id="7786606">&#34;tcp4&#34;</span><span class="op" id="7786612">,</span>&nbsp;<span class="ident" id="7786614">laddr</span><span class="op" id="7786619">:</span>&nbsp;<span class="string" id="7786621">&#34;0.0.0.0&#34;</span><span class="op" id="7786630">}</span><span class="op" id="7786631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786634">{</span><span class="ident" id="7786635">net</span><span class="op" id="7786638">:</span>&nbsp;<span class="string" id="7786640">&#34;tcp4&#34;</span><span class="op" id="7786646">,</span>&nbsp;<span class="ident" id="7786648">laddr</span><span class="op" id="7786653">:</span>&nbsp;<span class="string" id="7786655">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7786673">}</span><span class="op" id="7786674">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786678">{</span><span class="ident" id="7786679">net</span><span class="op" id="7786682">:</span>&nbsp;<span class="string" id="7786684">&#34;tcp4&#34;</span><span class="op" id="7786690">,</span>&nbsp;<span class="ident" id="7786692">laddr</span><span class="op" id="7786697">:</span>&nbsp;<span class="string" id="7786699">&#34;127.0.0.1&#34;</span><span class="op" id="7786710">}</span><span class="op" id="7786711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786714">{</span><span class="ident" id="7786715">net</span><span class="op" id="7786718">:</span>&nbsp;<span class="string" id="7786720">&#34;tcp4&#34;</span><span class="op" id="7786726">,</span>&nbsp;<span class="ident" id="7786728">laddr</span><span class="op" id="7786733">:</span>&nbsp;<span class="string" id="7786735">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7786755">}</span><span class="op" id="7786756">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786760">{</span><span class="ident" id="7786761">net</span><span class="op" id="7786764">:</span>&nbsp;<span class="string" id="7786766">&#34;tcp6&#34;</span><span class="op" id="7786772">,</span>&nbsp;<span class="ident" id="7786774">laddr</span><span class="op" id="7786779">:</span>&nbsp;<span class="string" id="7786781">&#34;&#34;</span><span class="op" id="7786783">,</span>&nbsp;<span class="ident" id="7786785">ipv6</span><span class="op" id="7786789">:</span>&nbsp;<span class="builtintype" id="7786791">true</span><span class="op" id="7786795">}</span><span class="op" id="7786796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786799">{</span><span class="ident" id="7786800">net</span><span class="op" id="7786803">:</span>&nbsp;<span class="string" id="7786805">&#34;tcp6&#34;</span><span class="op" id="7786811">,</span>&nbsp;<span class="ident" id="7786813">laddr</span><span class="op" id="7786818">:</span>&nbsp;<span class="string" id="7786820">&#34;[::]&#34;</span><span class="op" id="7786826">,</span>&nbsp;<span class="ident" id="7786828">ipv6</span><span class="op" id="7786832">:</span>&nbsp;<span class="builtintype" id="7786834">true</span><span class="op" id="7786838">}</span><span class="op" id="7786839">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786843">{</span><span class="ident" id="7786844">net</span><span class="op" id="7786847">:</span>&nbsp;<span class="string" id="7786849">&#34;tcp6&#34;</span><span class="op" id="7786855">,</span>&nbsp;<span class="ident" id="7786857">laddr</span><span class="op" id="7786862">:</span>&nbsp;<span class="string" id="7786864">&#34;[::1]&#34;</span><span class="op" id="7786871">,</span>&nbsp;<span class="ident" id="7786873">ipv6</span><span class="op" id="7786877">:</span>&nbsp;<span class="builtintype" id="7786879">true</span><span class="op" id="7786883">}</span><span class="op" id="7786884">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786888">{</span><span class="ident" id="7786889">net</span><span class="op" id="7786892">:</span>&nbsp;<span class="string" id="7786894">&#34;unix&#34;</span><span class="op" id="7786900">,</span>&nbsp;<span class="ident" id="7786902">laddr</span><span class="op" id="7786907">:</span>&nbsp;<span class="string" id="7786909">&#34;@gotest/net&#34;</span><span class="op" id="7786922">,</span>&nbsp;<span class="ident" id="7786924">linux</span><span class="op" id="7786929">:</span>&nbsp;<span class="builtintype" id="7786931">true</span><span class="op" id="7786935">}</span><span class="op" id="7786936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7786939">{</span><span class="ident" id="7786940">net</span><span class="op" id="7786943">:</span>&nbsp;<span class="string" id="7786945">&#34;unixpacket&#34;</span><span class="op" id="7786957">,</span>&nbsp;<span class="ident" id="7786959">laddr</span><span class="op" id="7786964">:</span>&nbsp;<span class="string" id="7786966">&#34;@gotest/net&#34;</span><span class="op" id="7786979">,</span>&nbsp;<span class="ident" id="7786981">linux</span><span class="op" id="7786986">:</span>&nbsp;<span class="builtintype" id="7786988">true</span><span class="op" id="7786992">}</span><span class="op" id="7786993">,</span><br>
<span class="lineno"></span><span class="op" id="7786995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7786998">func</span>&nbsp;<span class="ident" id="7787003">TestFileListener</span><span class="op" id="7787019">(</span><span class="ident" id="7787020">t</span>&nbsp;<span class="op" id="7787022">*</span><span class="ident" id="7787023">testing</span><span class="op" id="7787030">.</span><span class="ident" id="7787031">T</span><span class="op" id="7787032">)</span>&nbsp;<span class="op" id="7787034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787037">switch</span>&nbsp;<span class="ident" id="7787044">runtime</span><span class="op" id="7787051">.</span><span class="ident" id="7787052">GOOS</span>&nbsp;<span class="op" id="7787057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787060">case</span>&nbsp;<span class="string" id="7787065">&#34;nacl&#34;</span><span class="op" id="7787071">,</span>&nbsp;<span class="string" id="7787073">&#34;windows&#34;</span><span class="op" id="7787082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787086">t</span><span class="op" id="7787087">.</span><span class="ident" id="7787088">Skipf</span><span class="op" id="7787093">(</span><span class="string" id="7787094">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7787115">,</span>&nbsp;<span class="ident" id="7787117">runtime</span><span class="op" id="7787124">.</span><span class="ident" id="7787125">GOOS</span><span class="op" id="7787129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787132">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787136">for</span>&nbsp;<span class="ident" id="7787140">_</span><span class="op" id="7787141">,</span>&nbsp;<span class="ident" id="7787143">tt</span>&nbsp;<span class="op" id="7787146">:=</span>&nbsp;<span class="keyword" id="7787149">range</span>&nbsp;<span class="ident" id="7787155">fileListenerTests</span>&nbsp;<span class="op" id="7787173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787177">if</span>&nbsp;<span class="ident" id="7787180">skipServerTest</span><span class="op" id="7787194">(</span><span class="ident" id="7787195">tt</span><span class="op" id="7787197">.</span><span class="ident" id="7787198">net</span><span class="op" id="7787201">,</span>&nbsp;<span class="string" id="7787203">&#34;unix&#34;</span><span class="op" id="7787209">,</span>&nbsp;<span class="ident" id="7787211">tt</span><span class="op" id="7787213">.</span><span class="ident" id="7787214">laddr</span><span class="op" id="7787219">,</span>&nbsp;<span class="ident" id="7787221">tt</span><span class="op" id="7787223">.</span><span class="ident" id="7787224">ipv6</span><span class="op" id="7787228">,</span>&nbsp;<span class="builtintype" id="7787230">false</span><span class="op" id="7787235">,</span>&nbsp;<span class="ident" id="7787237">tt</span><span class="op" id="7787239">.</span><span class="ident" id="7787240">linux</span><span class="op" id="7787245">)</span>&nbsp;<span class="op" id="7787247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787252">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787263">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787267">if</span>&nbsp;<span class="ident" id="7787270">skipServerTest</span><span class="op" id="7787284">(</span><span class="ident" id="7787285">tt</span><span class="op" id="7787287">.</span><span class="ident" id="7787288">net</span><span class="op" id="7787291">,</span>&nbsp;<span class="string" id="7787293">&#34;unixpacket&#34;</span><span class="op" id="7787305">,</span>&nbsp;<span class="ident" id="7787307">tt</span><span class="op" id="7787309">.</span><span class="ident" id="7787310">laddr</span><span class="op" id="7787315">,</span>&nbsp;<span class="ident" id="7787317">tt</span><span class="op" id="7787319">.</span><span class="ident" id="7787320">ipv6</span><span class="op" id="7787324">,</span>&nbsp;<span class="builtintype" id="7787326">false</span><span class="op" id="7787331">,</span>&nbsp;<span class="ident" id="7787333">tt</span><span class="op" id="7787335">.</span><span class="ident" id="7787336">linux</span><span class="op" id="7787341">)</span>&nbsp;<span class="op" id="7787343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787348">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787363">testFileListener</span><span class="op" id="7787379">(</span><span class="ident" id="7787380">t</span><span class="op" id="7787381">,</span>&nbsp;<span class="ident" id="7787383">tt</span><span class="op" id="7787385">.</span><span class="ident" id="7787386">net</span><span class="op" id="7787389">,</span>&nbsp;<span class="ident" id="7787391">tt</span><span class="op" id="7787393">.</span><span class="ident" id="7787394">laddr</span><span class="op" id="7787399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787402">}</span><br>
<span class="lineno">105</span><span class="op" id="7787404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7787407">func</span>&nbsp;<span class="ident" id="7787412">testFilePacketConn</span><span class="op" id="7787430">(</span><span class="ident" id="7787431">t</span>&nbsp;<span class="op" id="7787433">*</span><span class="ident" id="7787434">testing</span><span class="op" id="7787441">.</span><span class="ident" id="7787442">T</span><span class="op" id="7787443">,</span>&nbsp;<span class="ident" id="7787445">pcf</span>&nbsp;<span class="ident" id="7787449">packetConnFile</span><span class="op" id="7787463">,</span>&nbsp;<span class="ident" id="7787465">listen</span>&nbsp;<span class="builtintype" id="7787472">bool</span><span class="op" id="7787476">)</span>&nbsp;<span class="op" id="7787478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787481">f</span><span class="op" id="7787482">,</span>&nbsp;<span class="ident" id="7787484">err</span>&nbsp;<span class="op" id="7787488">:=</span>&nbsp;<span class="ident" id="7787491">pcf</span><span class="op" id="7787494">.</span><span class="ident" id="7787495">File</span><span class="op" id="7787499">(</span><span class="op" id="7787500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787503">if</span>&nbsp;<span class="ident" id="7787506">err</span>&nbsp;<span class="op" id="7787510">!=</span>&nbsp;<span class="ident" id="7787513">nil</span>&nbsp;<span class="op" id="7787517">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787521">t</span><span class="op" id="7787522">.</span><span class="ident" id="7787523">Fatalf</span><span class="op" id="7787529">(</span><span class="string" id="7787530">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7787547">,</span>&nbsp;<span class="ident" id="7787549">err</span><span class="op" id="7787552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787558">c</span><span class="op" id="7787559">,</span>&nbsp;<span class="ident" id="7787561">err</span>&nbsp;<span class="op" id="7787565">:=</span>&nbsp;<span class="ident" id="7787568">FilePacketConn</span><span class="op" id="7787582">(</span><span class="ident" id="7787583">f</span><span class="op" id="7787584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787587">if</span>&nbsp;<span class="ident" id="7787590">err</span>&nbsp;<span class="op" id="7787594">!=</span>&nbsp;<span class="ident" id="7787597">nil</span>&nbsp;<span class="op" id="7787601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787605">t</span><span class="op" id="7787606">.</span><span class="ident" id="7787607">Fatalf</span><span class="op" id="7787613">(</span><span class="string" id="7787614">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7787641">,</span>&nbsp;<span class="ident" id="7787643">err</span><span class="op" id="7787646">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787652">if</span>&nbsp;<span class="op" id="7787655">!</span><span class="ident" id="7787656">reflect</span><span class="op" id="7787663">.</span><span class="ident" id="7787664">DeepEqual</span><span class="op" id="7787673">(</span><span class="ident" id="7787674">pcf</span><span class="op" id="7787677">.</span><span class="ident" id="7787678">LocalAddr</span><span class="op" id="7787687">(</span><span class="op" id="7787688">)</span><span class="op" id="7787689">,</span>&nbsp;<span class="ident" id="7787691">c</span><span class="op" id="7787692">.</span><span class="ident" id="7787693">LocalAddr</span><span class="op" id="7787702">(</span><span class="op" id="7787703">)</span><span class="op" id="7787704">)</span>&nbsp;<span class="op" id="7787706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787710">t</span><span class="op" id="7787711">.</span><span class="ident" id="7787712">Fatalf</span><span class="op" id="7787718">(</span><span class="string" id="7787719">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="7787753">,</span>&nbsp;<span class="ident" id="7787755">pcf</span><span class="op" id="7787758">.</span><span class="ident" id="7787759">LocalAddr</span><span class="op" id="7787768">(</span><span class="op" id="7787769">)</span><span class="op" id="7787770">,</span>&nbsp;<span class="ident" id="7787772">c</span><span class="op" id="7787773">.</span><span class="ident" id="7787774">LocalAddr</span><span class="op" id="7787783">(</span><span class="op" id="7787784">)</span><span class="op" id="7787785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787791">if</span>&nbsp;<span class="ident" id="7787794">listen</span>&nbsp;<span class="op" id="7787801">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787805">if</span>&nbsp;<span class="ident" id="7787808">_</span><span class="op" id="7787809">,</span>&nbsp;<span class="ident" id="7787811">err</span>&nbsp;<span class="op" id="7787815">:=</span>&nbsp;<span class="ident" id="7787818">c</span><span class="op" id="7787819">.</span><span class="ident" id="7787820">WriteTo</span><span class="op" id="7787827">(</span><span class="op" id="7787828">[</span><span class="op" id="7787829">]</span><span class="builtintype" id="7787830">byte</span><span class="op" id="7787834">{</span><span class="op" id="7787835">}</span><span class="op" id="7787836">,</span>&nbsp;<span class="ident" id="7787838">c</span><span class="op" id="7787839">.</span><span class="ident" id="7787840">LocalAddr</span><span class="op" id="7787849">(</span><span class="op" id="7787850">)</span><span class="op" id="7787851">)</span><span class="op" id="7787852">;</span>&nbsp;<span class="ident" id="7787854">err</span>&nbsp;<span class="op" id="7787858">!=</span>&nbsp;<span class="ident" id="7787861">nil</span>&nbsp;<span class="op" id="7787865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787870">t</span><span class="op" id="7787871">.</span><span class="ident" id="7787872">Fatalf</span><span class="op" id="7787878">(</span><span class="string" id="7787879">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7787899">,</span>&nbsp;<span class="ident" id="7787901">err</span><span class="op" id="7787904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787914">if</span>&nbsp;<span class="ident" id="7787917">err</span>&nbsp;<span class="op" id="7787921">:=</span>&nbsp;<span class="ident" id="7787924">c</span><span class="op" id="7787925">.</span><span class="ident" id="7787926">Close</span><span class="op" id="7787931">(</span><span class="op" id="7787932">)</span><span class="op" id="7787933">;</span>&nbsp;<span class="ident" id="7787935">err</span>&nbsp;<span class="op" id="7787939">!=</span>&nbsp;<span class="ident" id="7787942">nil</span>&nbsp;<span class="op" id="7787946">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7787950">t</span><span class="op" id="7787951">.</span><span class="ident" id="7787952">Fatalf</span><span class="op" id="7787958">(</span><span class="string" id="7787959">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7787977">,</span>&nbsp;<span class="ident" id="7787979">err</span><span class="op" id="7787982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7787985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7787988">if</span>&nbsp;<span class="ident" id="7787991">err</span>&nbsp;<span class="op" id="7787995">:=</span>&nbsp;<span class="ident" id="7787998">f</span><span class="op" id="7787999">.</span><span class="ident" id="7788000">Close</span><span class="op" id="7788005">(</span><span class="op" id="7788006">)</span><span class="op" id="7788007">;</span>&nbsp;<span class="ident" id="7788009">err</span>&nbsp;<span class="op" id="7788013">!=</span>&nbsp;<span class="ident" id="7788016">nil</span>&nbsp;<span class="op" id="7788020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788024">t</span><span class="op" id="7788025">.</span><span class="ident" id="7788026">Fatalf</span><span class="op" id="7788032">(</span><span class="string" id="7788033">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7788051">,</span>&nbsp;<span class="ident" id="7788053">err</span><span class="op" id="7788056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788059">}</span><br>
<span class="lineno">130</span><span class="op" id="7788061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7788064">func</span>&nbsp;<span class="ident" id="7788069">testFilePacketConnListen</span><span class="op" id="7788093">(</span><span class="ident" id="7788094">t</span>&nbsp;<span class="op" id="7788096">*</span><span class="ident" id="7788097">testing</span><span class="op" id="7788104">.</span><span class="ident" id="7788105">T</span><span class="op" id="7788106">,</span>&nbsp;<span class="ident" id="7788108">net</span><span class="op" id="7788111">,</span>&nbsp;<span class="ident" id="7788113">laddr</span>&nbsp;<span class="builtintype" id="7788119">string</span><span class="op" id="7788125">)</span>&nbsp;<span class="op" id="7788127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788130">switch</span>&nbsp;<span class="ident" id="7788137">net</span>&nbsp;<span class="op" id="7788141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788144">case</span>&nbsp;<span class="string" id="7788149">&#34;udp&#34;</span><span class="op" id="7788154">,</span>&nbsp;<span class="string" id="7788156">&#34;udp4&#34;</span><span class="op" id="7788162">,</span>&nbsp;<span class="string" id="7788164">&#34;udp6&#34;</span><span class="op" id="7788170">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788174">laddr</span>&nbsp;<span class="op" id="7788180">+=</span>&nbsp;<span class="string" id="7788183">&#34;:0&#34;</span>&nbsp;<span class="comment" id="7788188">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788214">l</span><span class="op" id="7788215">,</span>&nbsp;<span class="ident" id="7788217">err</span>&nbsp;<span class="op" id="7788221">:=</span>&nbsp;<span class="ident" id="7788224">ListenPacket</span><span class="op" id="7788236">(</span><span class="ident" id="7788237">net</span><span class="op" id="7788240">,</span>&nbsp;<span class="ident" id="7788242">laddr</span><span class="op" id="7788247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788250">if</span>&nbsp;<span class="ident" id="7788253">err</span>&nbsp;<span class="op" id="7788257">!=</span>&nbsp;<span class="ident" id="7788260">nil</span>&nbsp;<span class="op" id="7788264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788268">t</span><span class="op" id="7788269">.</span><span class="ident" id="7788270">Fatalf</span><span class="op" id="7788276">(</span><span class="string" id="7788277">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7788302">,</span>&nbsp;<span class="ident" id="7788304">err</span><span class="op" id="7788307">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788313">testFilePacketConn</span><span class="op" id="7788331">(</span><span class="ident" id="7788332">t</span><span class="op" id="7788333">,</span>&nbsp;<span class="ident" id="7788335">l</span><span class="op" id="7788336">.</span><span class="op" id="7788337">(</span><span class="ident" id="7788338">packetConnFile</span><span class="op" id="7788352">)</span><span class="op" id="7788353">,</span>&nbsp;<span class="builtintype" id="7788355">true</span><span class="op" id="7788359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788362">if</span>&nbsp;<span class="ident" id="7788365">err</span>&nbsp;<span class="op" id="7788369">:=</span>&nbsp;<span class="ident" id="7788372">l</span><span class="op" id="7788373">.</span><span class="ident" id="7788374">Close</span><span class="op" id="7788379">(</span><span class="op" id="7788380">)</span><span class="op" id="7788381">;</span>&nbsp;<span class="ident" id="7788383">err</span>&nbsp;<span class="op" id="7788387">!=</span>&nbsp;<span class="ident" id="7788390">nil</span>&nbsp;<span class="op" id="7788394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788398">t</span><span class="op" id="7788399">.</span><span class="ident" id="7788400">Fatalf</span><span class="op" id="7788406">(</span><span class="string" id="7788407">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7788425">,</span>&nbsp;<span class="ident" id="7788427">err</span><span class="op" id="7788430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788433">}</span><br>
<span class="lineno">145</span><span class="op" id="7788435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7788438">func</span>&nbsp;<span class="ident" id="7788443">testFilePacketConnDial</span><span class="op" id="7788465">(</span><span class="ident" id="7788466">t</span>&nbsp;<span class="op" id="7788468">*</span><span class="ident" id="7788469">testing</span><span class="op" id="7788476">.</span><span class="ident" id="7788477">T</span><span class="op" id="7788478">,</span>&nbsp;<span class="ident" id="7788480">net</span><span class="op" id="7788483">,</span>&nbsp;<span class="ident" id="7788485">raddr</span>&nbsp;<span class="builtintype" id="7788491">string</span><span class="op" id="7788497">)</span>&nbsp;<span class="op" id="7788499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788502">switch</span>&nbsp;<span class="ident" id="7788509">net</span>&nbsp;<span class="op" id="7788513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788516">case</span>&nbsp;<span class="string" id="7788521">&#34;udp&#34;</span><span class="op" id="7788526">,</span>&nbsp;<span class="string" id="7788528">&#34;udp4&#34;</span><span class="op" id="7788534">,</span>&nbsp;<span class="string" id="7788536">&#34;udp6&#34;</span><span class="op" id="7788542">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788546">raddr</span>&nbsp;<span class="op" id="7788552">+=</span>&nbsp;<span class="string" id="7788555">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788568">c</span><span class="op" id="7788569">,</span>&nbsp;<span class="ident" id="7788571">err</span>&nbsp;<span class="op" id="7788575">:=</span>&nbsp;<span class="ident" id="7788578">Dial</span><span class="op" id="7788582">(</span><span class="ident" id="7788583">net</span><span class="op" id="7788586">,</span>&nbsp;<span class="ident" id="7788588">raddr</span><span class="op" id="7788593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788596">if</span>&nbsp;<span class="ident" id="7788599">err</span>&nbsp;<span class="op" id="7788603">!=</span>&nbsp;<span class="ident" id="7788606">nil</span>&nbsp;<span class="op" id="7788610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788614">t</span><span class="op" id="7788615">.</span><span class="ident" id="7788616">Fatalf</span><span class="op" id="7788622">(</span><span class="string" id="7788623">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7788640">,</span>&nbsp;<span class="ident" id="7788642">err</span><span class="op" id="7788645">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788651">testFilePacketConn</span><span class="op" id="7788669">(</span><span class="ident" id="7788670">t</span><span class="op" id="7788671">,</span>&nbsp;<span class="ident" id="7788673">c</span><span class="op" id="7788674">.</span><span class="op" id="7788675">(</span><span class="ident" id="7788676">packetConnFile</span><span class="op" id="7788690">)</span><span class="op" id="7788691">,</span>&nbsp;<span class="builtintype" id="7788693">false</span><span class="op" id="7788698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7788701">if</span>&nbsp;<span class="ident" id="7788704">err</span>&nbsp;<span class="op" id="7788708">:=</span>&nbsp;<span class="ident" id="7788711">c</span><span class="op" id="7788712">.</span><span class="ident" id="7788713">Close</span><span class="op" id="7788718">(</span><span class="op" id="7788719">)</span><span class="op" id="7788720">;</span>&nbsp;<span class="ident" id="7788722">err</span>&nbsp;<span class="op" id="7788726">!=</span>&nbsp;<span class="ident" id="7788729">nil</span>&nbsp;<span class="op" id="7788733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788737">t</span><span class="op" id="7788738">.</span><span class="ident" id="7788739">Fatalf</span><span class="op" id="7788745">(</span><span class="string" id="7788746">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7788764">,</span>&nbsp;<span class="ident" id="7788766">err</span><span class="op" id="7788769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788772">}</span><br>
<span class="lineno">160</span><span class="op" id="7788774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7788777">var</span>&nbsp;<span class="ident" id="7788781">filePacketConnTests</span>&nbsp;<span class="op" id="7788801">=</span>&nbsp;<span class="op" id="7788803">[</span><span class="op" id="7788804">]</span><span class="keyword" id="7788805">struct</span>&nbsp;<span class="op" id="7788812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788815">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7788821">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788829">addr</span>&nbsp;&nbsp;<span class="builtintype" id="7788835">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788843">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="7788849">bool</span>&nbsp;<span class="comment" id="7788854">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7788895">linux</span>&nbsp;<span class="builtintype" id="7788901">bool</span>&nbsp;<span class="comment" id="7788906">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7788960">}</span><span class="op" id="7788961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788964">{</span><span class="ident" id="7788965">net</span><span class="op" id="7788968">:</span>&nbsp;<span class="string" id="7788970">&#34;udp&#34;</span><span class="op" id="7788975">,</span>&nbsp;<span class="ident" id="7788977">addr</span><span class="op" id="7788981">:</span>&nbsp;<span class="string" id="7788983">&#34;127.0.0.1&#34;</span><span class="op" id="7788994">}</span><span class="op" id="7788995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7788998">{</span><span class="ident" id="7788999">net</span><span class="op" id="7789002">:</span>&nbsp;<span class="string" id="7789004">&#34;udp&#34;</span><span class="op" id="7789009">,</span>&nbsp;<span class="ident" id="7789011">addr</span><span class="op" id="7789015">:</span>&nbsp;<span class="string" id="7789017">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7789037">}</span><span class="op" id="7789038">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789041">{</span><span class="ident" id="7789042">net</span><span class="op" id="7789045">:</span>&nbsp;<span class="string" id="7789047">&#34;udp&#34;</span><span class="op" id="7789052">,</span>&nbsp;<span class="ident" id="7789054">addr</span><span class="op" id="7789058">:</span>&nbsp;<span class="string" id="7789060">&#34;[::1]&#34;</span><span class="op" id="7789067">,</span>&nbsp;<span class="ident" id="7789069">ipv6</span><span class="op" id="7789073">:</span>&nbsp;<span class="builtintype" id="7789075">true</span><span class="op" id="7789079">}</span><span class="op" id="7789080">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789084">{</span><span class="ident" id="7789085">net</span><span class="op" id="7789088">:</span>&nbsp;<span class="string" id="7789090">&#34;udp4&#34;</span><span class="op" id="7789096">,</span>&nbsp;<span class="ident" id="7789098">addr</span><span class="op" id="7789102">:</span>&nbsp;<span class="string" id="7789104">&#34;127.0.0.1&#34;</span><span class="op" id="7789115">}</span><span class="op" id="7789116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789119">{</span><span class="ident" id="7789120">net</span><span class="op" id="7789123">:</span>&nbsp;<span class="string" id="7789125">&#34;udp4&#34;</span><span class="op" id="7789131">,</span>&nbsp;<span class="ident" id="7789133">addr</span><span class="op" id="7789137">:</span>&nbsp;<span class="string" id="7789139">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7789159">}</span><span class="op" id="7789160">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789164">{</span><span class="ident" id="7789165">net</span><span class="op" id="7789168">:</span>&nbsp;<span class="string" id="7789170">&#34;udp6&#34;</span><span class="op" id="7789176">,</span>&nbsp;<span class="ident" id="7789178">addr</span><span class="op" id="7789182">:</span>&nbsp;<span class="string" id="7789184">&#34;[::1]&#34;</span><span class="op" id="7789191">,</span>&nbsp;<span class="ident" id="7789193">ipv6</span><span class="op" id="7789197">:</span>&nbsp;<span class="builtintype" id="7789199">true</span><span class="op" id="7789203">}</span><span class="op" id="7789204">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789208">{</span><span class="ident" id="7789209">net</span><span class="op" id="7789212">:</span>&nbsp;<span class="string" id="7789214">&#34;ip4:icmp&#34;</span><span class="op" id="7789224">,</span>&nbsp;<span class="ident" id="7789226">addr</span><span class="op" id="7789230">:</span>&nbsp;<span class="string" id="7789232">&#34;127.0.0.1&#34;</span><span class="op" id="7789243">}</span><span class="op" id="7789244">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789248">{</span><span class="ident" id="7789249">net</span><span class="op" id="7789252">:</span>&nbsp;<span class="string" id="7789254">&#34;unixgram&#34;</span><span class="op" id="7789264">,</span>&nbsp;<span class="ident" id="7789266">addr</span><span class="op" id="7789270">:</span>&nbsp;<span class="string" id="7789272">&#34;@gotest3/net&#34;</span><span class="op" id="7789286">,</span>&nbsp;<span class="ident" id="7789288">linux</span><span class="op" id="7789293">:</span>&nbsp;<span class="builtintype" id="7789295">true</span><span class="op" id="7789299">}</span><span class="op" id="7789300">,</span><br>
<span class="lineno">180</span><span class="op" id="7789302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7789305">func</span>&nbsp;<span class="ident" id="7789310">TestFilePacketConn</span><span class="op" id="7789328">(</span><span class="ident" id="7789329">t</span>&nbsp;<span class="op" id="7789331">*</span><span class="ident" id="7789332">testing</span><span class="op" id="7789339">.</span><span class="ident" id="7789340">T</span><span class="op" id="7789341">)</span>&nbsp;<span class="op" id="7789343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789346">switch</span>&nbsp;<span class="ident" id="7789353">runtime</span><span class="op" id="7789360">.</span><span class="ident" id="7789361">GOOS</span>&nbsp;<span class="op" id="7789366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789369">case</span>&nbsp;<span class="string" id="7789374">&#34;nacl&#34;</span><span class="op" id="7789380">,</span>&nbsp;<span class="string" id="7789382">&#34;plan9&#34;</span><span class="op" id="7789389">,</span>&nbsp;<span class="string" id="7789391">&#34;windows&#34;</span><span class="op" id="7789400">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7789404">t</span><span class="op" id="7789405">.</span><span class="ident" id="7789406">Skipf</span><span class="op" id="7789411">(</span><span class="string" id="7789412">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7789433">,</span>&nbsp;<span class="ident" id="7789435">runtime</span><span class="op" id="7789442">.</span><span class="ident" id="7789443">GOOS</span><span class="op" id="7789447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789454">for</span>&nbsp;<span class="ident" id="7789458">_</span><span class="op" id="7789459">,</span>&nbsp;<span class="ident" id="7789461">tt</span>&nbsp;<span class="op" id="7789464">:=</span>&nbsp;<span class="keyword" id="7789467">range</span>&nbsp;<span class="ident" id="7789473">filePacketConnTests</span>&nbsp;<span class="op" id="7789493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789497">if</span>&nbsp;<span class="ident" id="7789500">skipServerTest</span><span class="op" id="7789514">(</span><span class="ident" id="7789515">tt</span><span class="op" id="7789517">.</span><span class="ident" id="7789518">net</span><span class="op" id="7789521">,</span>&nbsp;<span class="string" id="7789523">&#34;unixgram&#34;</span><span class="op" id="7789533">,</span>&nbsp;<span class="ident" id="7789535">tt</span><span class="op" id="7789537">.</span><span class="ident" id="7789538">addr</span><span class="op" id="7789542">,</span>&nbsp;<span class="ident" id="7789544">tt</span><span class="op" id="7789546">.</span><span class="ident" id="7789547">ipv6</span><span class="op" id="7789551">,</span>&nbsp;<span class="builtintype" id="7789553">false</span><span class="op" id="7789558">,</span>&nbsp;<span class="ident" id="7789560">tt</span><span class="op" id="7789562">.</span><span class="ident" id="7789563">linux</span><span class="op" id="7789568">)</span>&nbsp;<span class="op" id="7789570">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789575">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789590">if</span>&nbsp;<span class="ident" id="7789593">os</span><span class="op" id="7789595">.</span><span class="ident" id="7789596">Getuid</span><span class="op" id="7789602">(</span><span class="op" id="7789603">)</span>&nbsp;<span class="op" id="7789605">!=</span>&nbsp;<span class="num" id="7789608">0</span>&nbsp;<span class="op" id="7789610">&amp;&amp;</span>&nbsp;<span class="ident" id="7789613">tt</span><span class="op" id="7789615">.</span><span class="ident" id="7789616">net</span>&nbsp;<span class="op" id="7789620">==</span>&nbsp;<span class="string" id="7789623">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="7789634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7789639">t</span><span class="op" id="7789640">.</span><span class="ident" id="7789641">Log</span><span class="op" id="7789644">(</span><span class="string" id="7789645">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7789674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789679">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7789694">testFilePacketConnListen</span><span class="op" id="7789718">(</span><span class="ident" id="7789719">t</span><span class="op" id="7789720">,</span>&nbsp;<span class="ident" id="7789722">tt</span><span class="op" id="7789724">.</span><span class="ident" id="7789725">net</span><span class="op" id="7789728">,</span>&nbsp;<span class="ident" id="7789730">tt</span><span class="op" id="7789732">.</span><span class="ident" id="7789733">addr</span><span class="op" id="7789737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789741">switch</span>&nbsp;<span class="ident" id="7789748">tt</span><span class="op" id="7789750">.</span><span class="ident" id="7789751">addr</span>&nbsp;<span class="op" id="7789756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789760">case</span>&nbsp;<span class="string" id="7789765">&#34;&#34;</span><span class="op" id="7789767">,</span>&nbsp;<span class="string" id="7789769">&#34;0.0.0.0&#34;</span><span class="op" id="7789778">,</span>&nbsp;<span class="string" id="7789780">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7789798">,</span>&nbsp;<span class="string" id="7789800">&#34;[::]&#34;</span><span class="op" id="7789806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789810">default</span><span class="op" id="7789817">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7789822">if</span>&nbsp;<span class="ident" id="7789825">tt</span><span class="op" id="7789827">.</span><span class="ident" id="7789828">net</span>&nbsp;<span class="op" id="7789832">!=</span>&nbsp;<span class="string" id="7789835">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7789846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7789852">testFilePacketConnDial</span><span class="op" id="7789874">(</span><span class="ident" id="7789875">t</span><span class="op" id="7789876">,</span>&nbsp;<span class="ident" id="7789878">tt</span><span class="op" id="7789880">.</span><span class="ident" id="7789881">net</span><span class="op" id="7789884">,</span>&nbsp;<span class="ident" id="7789886">tt</span><span class="op" id="7789888">.</span><span class="ident" id="7789889">addr</span><span class="op" id="7789893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7789905">}</span><br>
<span class="lineno">205</span><span class="op" id="7789907">}</span>
</div>
</body>
</html>
