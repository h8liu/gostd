<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6528887">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6528942">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6528996">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6529047">package</span>&nbsp;<span class="ident" id="6529055">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6529062">import</span>&nbsp;<span class="op" id="6529069">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6529072">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6529085">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6529091">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6529102">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6529112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6529115">func</span>&nbsp;<span class="ident" id="6529120">TestWriteHeapDumpNonempty</span><span class="op" id="6529145">(</span><span class="ident" id="6529146">t</span>&nbsp;<span class="op" id="6529148">*</span><span class="ident" id="6529149">testing</span><span class="op" id="6529156">.</span><span class="ident" id="6529157">T</span><span class="op" id="6529158">)</span>&nbsp;<span class="op" id="6529160">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529163">if</span>&nbsp;<span class="ident" id="6529166">runtime</span><span class="op" id="6529173">.</span><span class="ident" id="6529174">GOOS</span>&nbsp;<span class="op" id="6529179">==</span>&nbsp;<span class="string" id="6529182">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6529189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529193">t</span><span class="op" id="6529194">.</span><span class="ident" id="6529195">Skip</span><span class="op" id="6529199">(</span><span class="string" id="6529200">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="6529241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529247">f</span><span class="op" id="6529248">,</span>&nbsp;<span class="ident" id="6529250">err</span>&nbsp;<span class="op" id="6529254">:=</span>&nbsp;<span class="ident" id="6529257">ioutil</span><span class="op" id="6529263">.</span><span class="ident" id="6529264">TempFile</span><span class="op" id="6529272">(</span><span class="string" id="6529273">&#34;&#34;</span><span class="op" id="6529275">,</span>&nbsp;<span class="string" id="6529277">&#34;heapdumptest&#34;</span><span class="op" id="6529291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529294">if</span>&nbsp;<span class="ident" id="6529297">err</span>&nbsp;<span class="op" id="6529301">!=</span>&nbsp;<span class="ident" id="6529304">nil</span>&nbsp;<span class="op" id="6529308">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529312">t</span><span class="op" id="6529313">.</span><span class="ident" id="6529314">Fatalf</span><span class="op" id="6529320">(</span><span class="string" id="6529321">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529342">,</span>&nbsp;<span class="ident" id="6529344">err</span><span class="op" id="6529347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529353">defer</span>&nbsp;<span class="ident" id="6529359">os</span><span class="op" id="6529361">.</span><span class="ident" id="6529362">Remove</span><span class="op" id="6529368">(</span><span class="ident" id="6529369">f</span><span class="op" id="6529370">.</span><span class="ident" id="6529371">Name</span><span class="op" id="6529375">(</span><span class="op" id="6529376">)</span><span class="op" id="6529377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529380">defer</span>&nbsp;<span class="ident" id="6529386">f</span><span class="op" id="6529387">.</span><span class="ident" id="6529388">Close</span><span class="op" id="6529393">(</span><span class="op" id="6529394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529397">WriteHeapDump</span><span class="op" id="6529410">(</span><span class="ident" id="6529411">f</span><span class="op" id="6529412">.</span><span class="ident" id="6529413">Fd</span><span class="op" id="6529415">(</span><span class="op" id="6529416">)</span><span class="op" id="6529417">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529420">fi</span><span class="op" id="6529422">,</span>&nbsp;<span class="ident" id="6529424">err</span>&nbsp;<span class="op" id="6529428">:=</span>&nbsp;<span class="ident" id="6529431">f</span><span class="op" id="6529432">.</span><span class="ident" id="6529433">Stat</span><span class="op" id="6529437">(</span><span class="op" id="6529438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529441">if</span>&nbsp;<span class="ident" id="6529444">err</span>&nbsp;<span class="op" id="6529448">!=</span>&nbsp;<span class="ident" id="6529451">nil</span>&nbsp;<span class="op" id="6529455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529459">t</span><span class="op" id="6529460">.</span><span class="ident" id="6529461">Fatalf</span><span class="op" id="6529467">(</span><span class="string" id="6529468">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529485">,</span>&nbsp;<span class="ident" id="6529487">err</span><span class="op" id="6529490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529496">const</span>&nbsp;<span class="ident" id="6529502">minSize</span>&nbsp;<span class="op" id="6529510">=</span>&nbsp;<span class="num" id="6529512">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529515">if</span>&nbsp;<span class="ident" id="6529518">size</span>&nbsp;<span class="op" id="6529523">:=</span>&nbsp;<span class="ident" id="6529526">fi</span><span class="op" id="6529528">.</span><span class="ident" id="6529529">Size</span><span class="op" id="6529533">(</span><span class="op" id="6529534">)</span><span class="op" id="6529535">;</span>&nbsp;<span class="ident" id="6529537">size</span>&nbsp;<span class="op" id="6529542">&lt;</span>&nbsp;<span class="ident" id="6529544">minSize</span>&nbsp;<span class="op" id="6529552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529556">t</span><span class="op" id="6529557">.</span><span class="ident" id="6529558">Fatalf</span><span class="op" id="6529564">(</span><span class="string" id="6529565">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6529618">,</span>&nbsp;<span class="ident" id="6529620">size</span><span class="op" id="6529624">,</span>&nbsp;<span class="ident" id="6529626">minSize</span><span class="op" id="6529633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529636">}</span><br>
<span class="lineno"></span><span class="op" id="6529638">}</span>
</div>
</body>
</html>
