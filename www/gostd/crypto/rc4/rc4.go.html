<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html" class="current">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4667186">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4667241">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4667295">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4667346">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4667419">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4667444">package</span>&nbsp;<span class="ident" id="4667452">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4667457">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4667527">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4667567">import</span>&nbsp;<span class="string" id="4667574">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4667585">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4667643">type</span>&nbsp;<span class="ident" id="4667648">Cipher</span>&nbsp;<span class="keyword" id="4667655">struct</span>&nbsp;<span class="op" id="4667662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667665">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667670">[</span><span class="num" id="4667671">256</span><span class="op" id="4667674">]</span><span class="builtintype" id="4667675">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667683">i</span><span class="op" id="4667684">,</span>&nbsp;<span class="ident" id="4667686">j</span>&nbsp;<span class="builtintype" id="4667688">uint8</span><br>
<span class="lineno"></span><span class="op" id="4667694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4667697">type</span>&nbsp;<span class="ident" id="4667702">KeySizeError</span>&nbsp;<span class="builtintype" id="4667715">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4667720">func</span>&nbsp;<span class="op" id="4667725">(</span><span class="ident" id="4667726">k</span>&nbsp;<span class="ident" id="4667728">KeySizeError</span><span class="op" id="4667740">)</span>&nbsp;<span class="ident" id="4667742">Error</span><span class="op" id="4667747">(</span><span class="op" id="4667748">)</span>&nbsp;<span class="builtintype" id="4667750">string</span>&nbsp;<span class="op" id="4667757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4667760">return</span>&nbsp;<span class="string" id="4667767">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4667799">+</span>&nbsp;<span class="ident" id="4667801">strconv</span><span class="op" id="4667808">.</span><span class="ident" id="4667809">Itoa</span><span class="op" id="4667813">(</span><span class="builtintype" id="4667814">int</span><span class="op" id="4667817">(</span><span class="ident" id="4667818">k</span><span class="op" id="4667819">)</span><span class="op" id="4667820">)</span><br>
<span class="lineno"></span><span class="op" id="4667822">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4667825">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4667904">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4667955">func</span>&nbsp;<span class="ident" id="4667960">NewCipher</span><span class="op" id="4667969">(</span><span class="ident" id="4667970">key</span>&nbsp;<span class="op" id="4667974">[</span><span class="op" id="4667975">]</span><span class="builtintype" id="4667976">byte</span><span class="op" id="4667980">)</span>&nbsp;<span class="op" id="4667982">(</span><span class="op" id="4667983">*</span><span class="ident" id="4667984">Cipher</span><span class="op" id="4667990">,</span>&nbsp;<span class="builtintype" id="4667992">error</span><span class="op" id="4667997">)</span>&nbsp;<span class="op" id="4667999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668002">k</span>&nbsp;<span class="op" id="4668004">:=</span>&nbsp;<span class="builtinfunc" id="4668007">len</span><span class="op" id="4668010">(</span><span class="ident" id="4668011">key</span><span class="op" id="4668014">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668017">if</span>&nbsp;<span class="ident" id="4668020">k</span>&nbsp;<span class="op" id="4668022">&lt;</span>&nbsp;<span class="num" id="4668024">1</span>&nbsp;<span class="op" id="4668026">||</span>&nbsp;<span class="ident" id="4668029">k</span>&nbsp;<span class="op" id="4668031">&gt;</span>&nbsp;<span class="num" id="4668033">256</span>&nbsp;<span class="op" id="4668037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668041">return</span>&nbsp;<span class="ident" id="4668048">nil</span><span class="op" id="4668051">,</span>&nbsp;<span class="ident" id="4668053">KeySizeError</span><span class="op" id="4668065">(</span><span class="ident" id="4668066">k</span><span class="op" id="4668067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668073">var</span>&nbsp;<span class="ident" id="4668077">c</span>&nbsp;<span class="ident" id="4668079">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668087">for</span>&nbsp;<span class="ident" id="4668091">i</span>&nbsp;<span class="op" id="4668093">:=</span>&nbsp;<span class="num" id="4668096">0</span><span class="op" id="4668097">;</span>&nbsp;<span class="ident" id="4668099">i</span>&nbsp;<span class="op" id="4668101">&lt;</span>&nbsp;<span class="num" id="4668103">256</span><span class="op" id="4668106">;</span>&nbsp;<span class="ident" id="4668108">i</span><span class="op" id="4668109">++</span>&nbsp;<span class="op" id="4668112">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668116">c</span><span class="op" id="4668117">.</span><span class="ident" id="4668118">s</span><span class="op" id="4668119">[</span><span class="ident" id="4668120">i</span><span class="op" id="4668121">]</span>&nbsp;<span class="op" id="4668123">=</span>&nbsp;<span class="builtintype" id="4668125">uint32</span><span class="op" id="4668131">(</span><span class="ident" id="4668132">i</span><span class="op" id="4668133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668139">var</span>&nbsp;<span class="ident" id="4668143">j</span>&nbsp;<span class="builtintype" id="4668145">uint8</span>&nbsp;<span class="op" id="4668151">=</span>&nbsp;<span class="num" id="4668153">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668156">for</span>&nbsp;<span class="ident" id="4668160">i</span>&nbsp;<span class="op" id="4668162">:=</span>&nbsp;<span class="num" id="4668165">0</span><span class="op" id="4668166">;</span>&nbsp;<span class="ident" id="4668168">i</span>&nbsp;<span class="op" id="4668170">&lt;</span>&nbsp;<span class="num" id="4668172">256</span><span class="op" id="4668175">;</span>&nbsp;<span class="ident" id="4668177">i</span><span class="op" id="4668178">++</span>&nbsp;<span class="op" id="4668181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668185">j</span>&nbsp;<span class="op" id="4668187">+=</span>&nbsp;<span class="builtintype" id="4668190">uint8</span><span class="op" id="4668195">(</span><span class="ident" id="4668196">c</span><span class="op" id="4668197">.</span><span class="ident" id="4668198">s</span><span class="op" id="4668199">[</span><span class="ident" id="4668200">i</span><span class="op" id="4668201">]</span><span class="op" id="4668202">)</span>&nbsp;<span class="op" id="4668204">+</span>&nbsp;<span class="ident" id="4668206">key</span><span class="op" id="4668209">[</span><span class="ident" id="4668210">i</span><span class="op" id="4668211">%</span><span class="ident" id="4668212">k</span><span class="op" id="4668213">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668217">c</span><span class="op" id="4668218">.</span><span class="ident" id="4668219">s</span><span class="op" id="4668220">[</span><span class="ident" id="4668221">i</span><span class="op" id="4668222">]</span><span class="op" id="4668223">,</span>&nbsp;<span class="ident" id="4668225">c</span><span class="op" id="4668226">.</span><span class="ident" id="4668227">s</span><span class="op" id="4668228">[</span><span class="ident" id="4668229">j</span><span class="op" id="4668230">]</span>&nbsp;<span class="op" id="4668232">=</span>&nbsp;<span class="ident" id="4668234">c</span><span class="op" id="4668235">.</span><span class="ident" id="4668236">s</span><span class="op" id="4668237">[</span><span class="ident" id="4668238">j</span><span class="op" id="4668239">]</span><span class="op" id="4668240">,</span>&nbsp;<span class="ident" id="4668242">c</span><span class="op" id="4668243">.</span><span class="ident" id="4668244">s</span><span class="op" id="4668245">[</span><span class="ident" id="4668246">i</span><span class="op" id="4668247">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668253">return</span>&nbsp;<span class="op" id="4668260">&amp;</span><span class="ident" id="4668261">c</span><span class="op" id="4668262">,</span>&nbsp;<span class="ident" id="4668264">nil</span><br>
<span class="lineno"></span><span class="op" id="4668268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4668271">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4668339">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4668360">func</span>&nbsp;<span class="op" id="4668365">(</span><span class="ident" id="4668366">c</span>&nbsp;<span class="op" id="4668368">*</span><span class="ident" id="4668369">Cipher</span><span class="op" id="4668375">)</span>&nbsp;<span class="ident" id="4668377">Reset</span><span class="op" id="4668382">(</span><span class="op" id="4668383">)</span>&nbsp;<span class="op" id="4668385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668388">for</span>&nbsp;<span class="ident" id="4668392">i</span>&nbsp;<span class="op" id="4668394">:=</span>&nbsp;<span class="keyword" id="4668397">range</span>&nbsp;<span class="ident" id="4668403">c</span><span class="op" id="4668404">.</span><span class="ident" id="4668405">s</span>&nbsp;<span class="op" id="4668407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668411">c</span><span class="op" id="4668412">.</span><span class="ident" id="4668413">s</span><span class="op" id="4668414">[</span><span class="ident" id="4668415">i</span><span class="op" id="4668416">]</span>&nbsp;<span class="op" id="4668418">=</span>&nbsp;<span class="num" id="4668420">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668426">c</span><span class="op" id="4668427">.</span><span class="ident" id="4668428">i</span><span class="op" id="4668429">,</span>&nbsp;<span class="ident" id="4668431">c</span><span class="op" id="4668432">.</span><span class="ident" id="4668433">j</span>&nbsp;<span class="op" id="4668435">=</span>&nbsp;<span class="num" id="4668437">0</span><span class="op" id="4668438">,</span>&nbsp;<span class="num" id="4668440">0</span><br>
<span class="lineno"></span><span class="op" id="4668442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4668445">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4668514">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4668585">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4668601">//</span><br>
<span class="lineno"></span><span class="comment" id="4668604">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4668674">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4668740">func</span>&nbsp;<span class="op" id="4668745">(</span><span class="ident" id="4668746">c</span>&nbsp;<span class="op" id="4668748">*</span><span class="ident" id="4668749">Cipher</span><span class="op" id="4668755">)</span>&nbsp;<span class="ident" id="4668757">xorKeyStreamGeneric</span><span class="op" id="4668776">(</span><span class="ident" id="4668777">dst</span><span class="op" id="4668780">,</span>&nbsp;<span class="ident" id="4668782">src</span>&nbsp;<span class="op" id="4668786">[</span><span class="op" id="4668787">]</span><span class="builtintype" id="4668788">byte</span><span class="op" id="4668792">)</span>&nbsp;<span class="op" id="4668794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668797">i</span><span class="op" id="4668798">,</span>&nbsp;<span class="ident" id="4668800">j</span>&nbsp;<span class="op" id="4668802">:=</span>&nbsp;<span class="ident" id="4668805">c</span><span class="op" id="4668806">.</span><span class="ident" id="4668807">i</span><span class="op" id="4668808">,</span>&nbsp;<span class="ident" id="4668810">c</span><span class="op" id="4668811">.</span><span class="ident" id="4668812">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4668815">for</span>&nbsp;<span class="ident" id="4668819">k</span><span class="op" id="4668820">,</span>&nbsp;<span class="ident" id="4668822">v</span>&nbsp;<span class="op" id="4668824">:=</span>&nbsp;<span class="keyword" id="4668827">range</span>&nbsp;<span class="ident" id="4668833">src</span>&nbsp;<span class="op" id="4668837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668841">i</span>&nbsp;<span class="op" id="4668843">+=</span>&nbsp;<span class="num" id="4668846">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668850">j</span>&nbsp;<span class="op" id="4668852">+=</span>&nbsp;<span class="builtintype" id="4668855">uint8</span><span class="op" id="4668860">(</span><span class="ident" id="4668861">c</span><span class="op" id="4668862">.</span><span class="ident" id="4668863">s</span><span class="op" id="4668864">[</span><span class="ident" id="4668865">i</span><span class="op" id="4668866">]</span><span class="op" id="4668867">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668871">c</span><span class="op" id="4668872">.</span><span class="ident" id="4668873">s</span><span class="op" id="4668874">[</span><span class="ident" id="4668875">i</span><span class="op" id="4668876">]</span><span class="op" id="4668877">,</span>&nbsp;<span class="ident" id="4668879">c</span><span class="op" id="4668880">.</span><span class="ident" id="4668881">s</span><span class="op" id="4668882">[</span><span class="ident" id="4668883">j</span><span class="op" id="4668884">]</span>&nbsp;<span class="op" id="4668886">=</span>&nbsp;<span class="ident" id="4668888">c</span><span class="op" id="4668889">.</span><span class="ident" id="4668890">s</span><span class="op" id="4668891">[</span><span class="ident" id="4668892">j</span><span class="op" id="4668893">]</span><span class="op" id="4668894">,</span>&nbsp;<span class="ident" id="4668896">c</span><span class="op" id="4668897">.</span><span class="ident" id="4668898">s</span><span class="op" id="4668899">[</span><span class="ident" id="4668900">i</span><span class="op" id="4668901">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668905">dst</span><span class="op" id="4668908">[</span><span class="ident" id="4668909">k</span><span class="op" id="4668910">]</span>&nbsp;<span class="op" id="4668912">=</span>&nbsp;<span class="ident" id="4668914">v</span>&nbsp;<span class="op" id="4668916">^</span>&nbsp;<span class="builtintype" id="4668918">uint8</span><span class="op" id="4668923">(</span><span class="ident" id="4668924">c</span><span class="op" id="4668925">.</span><span class="ident" id="4668926">s</span><span class="op" id="4668927">[</span><span class="builtintype" id="4668928">uint8</span><span class="op" id="4668933">(</span><span class="ident" id="4668934">c</span><span class="op" id="4668935">.</span><span class="ident" id="4668936">s</span><span class="op" id="4668937">[</span><span class="ident" id="4668938">i</span><span class="op" id="4668939">]</span><span class="op" id="4668940">+</span><span class="ident" id="4668941">c</span><span class="op" id="4668942">.</span><span class="ident" id="4668943">s</span><span class="op" id="4668944">[</span><span class="ident" id="4668945">j</span><span class="op" id="4668946">]</span><span class="op" id="4668947">)</span><span class="op" id="4668948">]</span><span class="op" id="4668949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668955">c</span><span class="op" id="4668956">.</span><span class="ident" id="4668957">i</span><span class="op" id="4668958">,</span>&nbsp;<span class="ident" id="4668960">c</span><span class="op" id="4668961">.</span><span class="ident" id="4668962">j</span>&nbsp;<span class="op" id="4668964">=</span>&nbsp;<span class="ident" id="4668966">i</span><span class="op" id="4668967">,</span>&nbsp;<span class="ident" id="4668969">j</span><br>
<span class="lineno"></span><span class="op" id="4668971">}</span>
</div>
</body>
</html>
