<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html" class="current">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3287993">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3288048">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3288102">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3288153">package</span>&nbsp;<span class="ident" id="3288161">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3288166">import</span>&nbsp;<span class="op" id="3288173">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3288176">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3288185">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3288192">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3288204">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="3288211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3288214">type</span>&nbsp;<span class="ident" id="3288219">byPos</span>&nbsp;<span class="op" id="3288225">[</span><span class="op" id="3288226">]</span><span class="op" id="3288227">*</span><span class="ident" id="3288228">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3288242">func</span>&nbsp;<span class="op" id="3288247">(</span><span class="ident" id="3288248">a</span>&nbsp;<span class="ident" id="3288250">byPos</span><span class="op" id="3288255">)</span>&nbsp;<span class="ident" id="3288257">Len</span><span class="op" id="3288260">(</span><span class="op" id="3288261">)</span>&nbsp;<span class="builtintype" id="3288263">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3288277">{</span>&nbsp;<span class="keyword" id="3288279">return</span>&nbsp;<span class="builtinfunc" id="3288286">len</span><span class="op" id="3288289">(</span><span class="ident" id="3288290">a</span><span class="op" id="3288291">)</span>&nbsp;<span class="op" id="3288293">}</span><br>
<span class="lineno"></span><span class="keyword" id="3288295">func</span>&nbsp;<span class="op" id="3288300">(</span><span class="ident" id="3288301">a</span>&nbsp;<span class="ident" id="3288303">byPos</span><span class="op" id="3288308">)</span>&nbsp;<span class="ident" id="3288310">Less</span><span class="op" id="3288314">(</span><span class="ident" id="3288315">i</span><span class="op" id="3288316">,</span>&nbsp;<span class="ident" id="3288318">j</span>&nbsp;<span class="builtintype" id="3288320">int</span><span class="op" id="3288323">)</span>&nbsp;<span class="builtintype" id="3288325">bool</span>&nbsp;<span class="op" id="3288330">{</span>&nbsp;<span class="keyword" id="3288332">return</span>&nbsp;<span class="ident" id="3288339">a</span><span class="op" id="3288340">[</span><span class="ident" id="3288341">i</span><span class="op" id="3288342">]</span><span class="op" id="3288343">.</span><span class="ident" id="3288344">Pos</span><span class="op" id="3288347">(</span><span class="op" id="3288348">)</span>&nbsp;<span class="op" id="3288350">&lt;</span>&nbsp;<span class="ident" id="3288352">a</span><span class="op" id="3288353">[</span><span class="ident" id="3288354">j</span><span class="op" id="3288355">]</span><span class="op" id="3288356">.</span><span class="ident" id="3288357">Pos</span><span class="op" id="3288360">(</span><span class="op" id="3288361">)</span>&nbsp;<span class="op" id="3288363">}</span><br>
<span class="lineno"></span><span class="keyword" id="3288365">func</span>&nbsp;<span class="op" id="3288370">(</span><span class="ident" id="3288371">a</span>&nbsp;<span class="ident" id="3288373">byPos</span><span class="op" id="3288378">)</span>&nbsp;<span class="ident" id="3288380">Swap</span><span class="op" id="3288384">(</span><span class="ident" id="3288385">i</span><span class="op" id="3288386">,</span>&nbsp;<span class="ident" id="3288388">j</span>&nbsp;<span class="builtintype" id="3288390">int</span><span class="op" id="3288393">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3288400">{</span>&nbsp;<span class="ident" id="3288402">a</span><span class="op" id="3288403">[</span><span class="ident" id="3288404">i</span><span class="op" id="3288405">]</span><span class="op" id="3288406">,</span>&nbsp;<span class="ident" id="3288408">a</span><span class="op" id="3288409">[</span><span class="ident" id="3288410">j</span><span class="op" id="3288411">]</span>&nbsp;<span class="op" id="3288413">=</span>&nbsp;<span class="ident" id="3288415">a</span><span class="op" id="3288416">[</span><span class="ident" id="3288417">j</span><span class="op" id="3288418">]</span><span class="op" id="3288419">,</span>&nbsp;<span class="ident" id="3288421">a</span><span class="op" id="3288422">[</span><span class="ident" id="3288423">i</span><span class="op" id="3288424">]</span>&nbsp;<span class="op" id="3288426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3288429">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3288495">//</span><br>
<span class="lineno"></span><span class="keyword" id="3288498">func</span>&nbsp;<span class="ident" id="3288503">sortComments</span><span class="op" id="3288515">(</span><span class="ident" id="3288516">list</span>&nbsp;<span class="op" id="3288521">[</span><span class="op" id="3288522">]</span><span class="op" id="3288523">*</span><span class="ident" id="3288524">CommentGroup</span><span class="op" id="3288536">)</span>&nbsp;<span class="op" id="3288538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3288541">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3288600">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3288658">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3288687">if</span>&nbsp;<span class="ident" id="3288690">orderedList</span>&nbsp;<span class="op" id="3288702">:=</span>&nbsp;<span class="ident" id="3288705">byPos</span><span class="op" id="3288710">(</span><span class="ident" id="3288711">list</span><span class="op" id="3288715">)</span><span class="op" id="3288716">;</span>&nbsp;<span class="op" id="3288718">!</span><span class="ident" id="3288719">sort</span><span class="op" id="3288723">.</span><span class="ident" id="3288724">IsSorted</span><span class="op" id="3288732">(</span><span class="ident" id="3288733">orderedList</span><span class="op" id="3288744">)</span>&nbsp;<span class="op" id="3288746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3288750">sort</span><span class="op" id="3288754">.</span><span class="ident" id="3288755">Sort</span><span class="op" id="3288759">(</span><span class="ident" id="3288760">orderedList</span><span class="op" id="3288771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3288774">}</span><br>
<span class="lineno"></span><span class="op" id="3288776">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3288779">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="3288840">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3288902">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="3288922">//</span><br>
<span class="lineno">35</span><span class="keyword" id="3288925">type</span>&nbsp;<span class="ident" id="3288930">CommentMap</span>&nbsp;<span class="keyword" id="3288941">map</span><span class="op" id="3288944">[</span><span class="ident" id="3288945">Node</span><span class="op" id="3288949">]</span><span class="op" id="3288950">[</span><span class="op" id="3288951">]</span><span class="op" id="3288952">*</span><span class="ident" id="3288953">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3288967">func</span>&nbsp;<span class="op" id="3288972">(</span><span class="ident" id="3288973">cmap</span>&nbsp;<span class="ident" id="3288978">CommentMap</span><span class="op" id="3288988">)</span>&nbsp;<span class="ident" id="3288990">addComment</span><span class="op" id="3289000">(</span><span class="ident" id="3289001">n</span>&nbsp;<span class="ident" id="3289003">Node</span><span class="op" id="3289007">,</span>&nbsp;<span class="ident" id="3289009">c</span>&nbsp;<span class="op" id="3289011">*</span><span class="ident" id="3289012">CommentGroup</span><span class="op" id="3289024">)</span>&nbsp;<span class="op" id="3289026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289029">list</span>&nbsp;<span class="op" id="3289034">:=</span>&nbsp;<span class="ident" id="3289037">cmap</span><span class="op" id="3289041">[</span><span class="ident" id="3289042">n</span><span class="op" id="3289043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289046">if</span>&nbsp;<span class="builtinfunc" id="3289049">len</span><span class="op" id="3289052">(</span><span class="ident" id="3289053">list</span><span class="op" id="3289057">)</span>&nbsp;<span class="op" id="3289059">==</span>&nbsp;<span class="num" id="3289062">0</span>&nbsp;<span class="op" id="3289064">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289068">list</span>&nbsp;<span class="op" id="3289073">=</span>&nbsp;<span class="op" id="3289075">[</span><span class="op" id="3289076">]</span><span class="op" id="3289077">*</span><span class="ident" id="3289078">CommentGroup</span><span class="op" id="3289090">{</span><span class="ident" id="3289091">c</span><span class="op" id="3289092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3289095">}</span>&nbsp;<span class="keyword" id="3289097">else</span>&nbsp;<span class="op" id="3289102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289106">list</span>&nbsp;<span class="op" id="3289111">=</span>&nbsp;<span class="builtinfunc" id="3289113">append</span><span class="op" id="3289119">(</span><span class="ident" id="3289120">list</span><span class="op" id="3289124">,</span>&nbsp;<span class="ident" id="3289126">c</span><span class="op" id="3289127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3289130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289133">cmap</span><span class="op" id="3289137">[</span><span class="ident" id="3289138">n</span><span class="op" id="3289139">]</span>&nbsp;<span class="op" id="3289141">=</span>&nbsp;<span class="ident" id="3289143">list</span><br>
<span class="lineno">45</span><span class="op" id="3289148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3289151">type</span>&nbsp;<span class="ident" id="3289156">byInterval</span>&nbsp;<span class="op" id="3289167">[</span><span class="op" id="3289168">]</span><span class="ident" id="3289169">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3289175">func</span>&nbsp;<span class="op" id="3289180">(</span><span class="ident" id="3289181">a</span>&nbsp;<span class="ident" id="3289183">byInterval</span><span class="op" id="3289193">)</span>&nbsp;<span class="ident" id="3289195">Len</span><span class="op" id="3289198">(</span><span class="op" id="3289199">)</span>&nbsp;<span class="builtintype" id="3289201">int</span>&nbsp;<span class="op" id="3289205">{</span>&nbsp;<span class="keyword" id="3289207">return</span>&nbsp;<span class="builtinfunc" id="3289214">len</span><span class="op" id="3289217">(</span><span class="ident" id="3289218">a</span><span class="op" id="3289219">)</span>&nbsp;<span class="op" id="3289221">}</span><br>
<span class="lineno">50</span><span class="keyword" id="3289223">func</span>&nbsp;<span class="op" id="3289228">(</span><span class="ident" id="3289229">a</span>&nbsp;<span class="ident" id="3289231">byInterval</span><span class="op" id="3289241">)</span>&nbsp;<span class="ident" id="3289243">Less</span><span class="op" id="3289247">(</span><span class="ident" id="3289248">i</span><span class="op" id="3289249">,</span>&nbsp;<span class="ident" id="3289251">j</span>&nbsp;<span class="builtintype" id="3289253">int</span><span class="op" id="3289256">)</span>&nbsp;<span class="builtintype" id="3289258">bool</span>&nbsp;<span class="op" id="3289263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289266">pi</span><span class="op" id="3289268">,</span>&nbsp;<span class="ident" id="3289270">pj</span>&nbsp;<span class="op" id="3289273">:=</span>&nbsp;<span class="ident" id="3289276">a</span><span class="op" id="3289277">[</span><span class="ident" id="3289278">i</span><span class="op" id="3289279">]</span><span class="op" id="3289280">.</span><span class="ident" id="3289281">Pos</span><span class="op" id="3289284">(</span><span class="op" id="3289285">)</span><span class="op" id="3289286">,</span>&nbsp;<span class="ident" id="3289288">a</span><span class="op" id="3289289">[</span><span class="ident" id="3289290">j</span><span class="op" id="3289291">]</span><span class="op" id="3289292">.</span><span class="ident" id="3289293">Pos</span><span class="op" id="3289296">(</span><span class="op" id="3289297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289300">return</span>&nbsp;<span class="ident" id="3289307">pi</span>&nbsp;<span class="op" id="3289310">&lt;</span>&nbsp;<span class="ident" id="3289312">pj</span>&nbsp;<span class="op" id="3289315">||</span>&nbsp;<span class="ident" id="3289318">pi</span>&nbsp;<span class="op" id="3289321">==</span>&nbsp;<span class="ident" id="3289324">pj</span>&nbsp;<span class="op" id="3289327">&amp;&amp;</span>&nbsp;<span class="ident" id="3289330">a</span><span class="op" id="3289331">[</span><span class="ident" id="3289332">i</span><span class="op" id="3289333">]</span><span class="op" id="3289334">.</span><span class="ident" id="3289335">End</span><span class="op" id="3289338">(</span><span class="op" id="3289339">)</span>&nbsp;<span class="op" id="3289341">&gt;</span>&nbsp;<span class="ident" id="3289343">a</span><span class="op" id="3289344">[</span><span class="ident" id="3289345">j</span><span class="op" id="3289346">]</span><span class="op" id="3289347">.</span><span class="ident" id="3289348">End</span><span class="op" id="3289351">(</span><span class="op" id="3289352">)</span><br>
<span class="lineno"></span><span class="op" id="3289354">}</span><br>
<span class="lineno"></span><span class="keyword" id="3289356">func</span>&nbsp;<span class="op" id="3289361">(</span><span class="ident" id="3289362">a</span>&nbsp;<span class="ident" id="3289364">byInterval</span><span class="op" id="3289374">)</span>&nbsp;<span class="ident" id="3289376">Swap</span><span class="op" id="3289380">(</span><span class="ident" id="3289381">i</span><span class="op" id="3289382">,</span>&nbsp;<span class="ident" id="3289384">j</span>&nbsp;<span class="builtintype" id="3289386">int</span><span class="op" id="3289389">)</span>&nbsp;<span class="op" id="3289391">{</span>&nbsp;<span class="ident" id="3289393">a</span><span class="op" id="3289394">[</span><span class="ident" id="3289395">i</span><span class="op" id="3289396">]</span><span class="op" id="3289397">,</span>&nbsp;<span class="ident" id="3289399">a</span><span class="op" id="3289400">[</span><span class="ident" id="3289401">j</span><span class="op" id="3289402">]</span>&nbsp;<span class="op" id="3289404">=</span>&nbsp;<span class="ident" id="3289406">a</span><span class="op" id="3289407">[</span><span class="ident" id="3289408">j</span><span class="op" id="3289409">]</span><span class="op" id="3289410">,</span>&nbsp;<span class="ident" id="3289412">a</span><span class="op" id="3289413">[</span><span class="ident" id="3289414">i</span><span class="op" id="3289415">]</span>&nbsp;<span class="op" id="3289417">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3289420">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3289488">//</span><br>
<span class="lineno"></span><span class="keyword" id="3289491">func</span>&nbsp;<span class="ident" id="3289496">nodeList</span><span class="op" id="3289504">(</span><span class="ident" id="3289505">n</span>&nbsp;<span class="ident" id="3289507">Node</span><span class="op" id="3289511">)</span>&nbsp;<span class="op" id="3289513">[</span><span class="op" id="3289514">]</span><span class="ident" id="3289515">Node</span>&nbsp;<span class="op" id="3289520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289523">var</span>&nbsp;<span class="ident" id="3289527">list</span>&nbsp;<span class="op" id="3289532">[</span><span class="op" id="3289533">]</span><span class="ident" id="3289534">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289540">Inspect</span><span class="op" id="3289547">(</span><span class="ident" id="3289548">n</span><span class="op" id="3289549">,</span>&nbsp;<span class="keyword" id="3289551">func</span><span class="op" id="3289555">(</span><span class="ident" id="3289556">n</span>&nbsp;<span class="ident" id="3289558">Node</span><span class="op" id="3289562">)</span>&nbsp;<span class="builtintype" id="3289564">bool</span>&nbsp;<span class="op" id="3289569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3289573">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289601">switch</span>&nbsp;<span class="ident" id="3289608">n</span><span class="op" id="3289609">.</span><span class="op" id="3289610">(</span><span class="keyword" id="3289611">type</span><span class="op" id="3289615">)</span>&nbsp;<span class="op" id="3289617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289621">case</span>&nbsp;<span class="ident" id="3289626">nil</span><span class="op" id="3289629">,</span>&nbsp;<span class="op" id="3289631">*</span><span class="ident" id="3289632">CommentGroup</span><span class="op" id="3289644">,</span>&nbsp;<span class="op" id="3289646">*</span><span class="ident" id="3289647">Comment</span><span class="op" id="3289654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289659">return</span>&nbsp;<span class="builtintype" id="3289666">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3289674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289678">list</span>&nbsp;<span class="op" id="3289683">=</span>&nbsp;<span class="builtinfunc" id="3289685">append</span><span class="op" id="3289691">(</span><span class="ident" id="3289692">list</span><span class="op" id="3289696">,</span>&nbsp;<span class="ident" id="3289698">n</span><span class="op" id="3289699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289703">return</span>&nbsp;<span class="builtintype" id="3289710">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3289716">}</span><span class="op" id="3289717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3289720">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3289792">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3289863">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3289934">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3289954">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3289986">return</span>&nbsp;<span class="ident" id="3289993">list</span><br>
<span class="lineno">75</span><span class="op" id="3289998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3290001">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="3290074">//</span><br>
<span class="lineno"></span><span class="keyword" id="3290077">type</span>&nbsp;<span class="ident" id="3290082">commentListReader</span>&nbsp;<span class="keyword" id="3290100">struct</span>&nbsp;<span class="op" id="3290107">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290110">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290119">*</span><span class="ident" id="3290120">token</span><span class="op" id="3290125">.</span><span class="ident" id="3290126">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290135">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290144">[</span><span class="op" id="3290145">]</span><span class="op" id="3290146">*</span><span class="ident" id="3290147">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290161">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3290170">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290175">comment</span>&nbsp;&nbsp;<span class="op" id="3290184">*</span><span class="ident" id="3290185">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="3290199">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290234">pos</span><span class="op" id="3290237">,</span>&nbsp;<span class="ident" id="3290239">end</span>&nbsp;<span class="ident" id="3290243">token</span><span class="op" id="3290248">.</span><span class="ident" id="3290249">Position</span>&nbsp;<span class="comment" id="3290258">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="3290311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3290314">func</span>&nbsp;<span class="op" id="3290319">(</span><span class="ident" id="3290320">r</span>&nbsp;<span class="op" id="3290322">*</span><span class="ident" id="3290323">commentListReader</span><span class="op" id="3290340">)</span>&nbsp;<span class="ident" id="3290342">eol</span><span class="op" id="3290345">(</span><span class="op" id="3290346">)</span>&nbsp;<span class="builtintype" id="3290348">bool</span>&nbsp;<span class="op" id="3290353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290356">return</span>&nbsp;<span class="ident" id="3290363">r</span><span class="op" id="3290364">.</span><span class="ident" id="3290365">index</span>&nbsp;<span class="op" id="3290371">&gt;=</span>&nbsp;<span class="builtinfunc" id="3290374">len</span><span class="op" id="3290377">(</span><span class="ident" id="3290378">r</span><span class="op" id="3290379">.</span><span class="ident" id="3290380">list</span><span class="op" id="3290384">)</span><br>
<span class="lineno"></span><span class="op" id="3290386">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3290389">func</span>&nbsp;<span class="op" id="3290394">(</span><span class="ident" id="3290395">r</span>&nbsp;<span class="op" id="3290397">*</span><span class="ident" id="3290398">commentListReader</span><span class="op" id="3290415">)</span>&nbsp;<span class="ident" id="3290417">next</span><span class="op" id="3290421">(</span><span class="op" id="3290422">)</span>&nbsp;<span class="op" id="3290424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3290427">if</span>&nbsp;<span class="op" id="3290430">!</span><span class="ident" id="3290431">r</span><span class="op" id="3290432">.</span><span class="ident" id="3290433">eol</span><span class="op" id="3290436">(</span><span class="op" id="3290437">)</span>&nbsp;<span class="op" id="3290439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290443">r</span><span class="op" id="3290444">.</span><span class="ident" id="3290445">comment</span>&nbsp;<span class="op" id="3290453">=</span>&nbsp;<span class="ident" id="3290455">r</span><span class="op" id="3290456">.</span><span class="ident" id="3290457">list</span><span class="op" id="3290461">[</span><span class="ident" id="3290462">r</span><span class="op" id="3290463">.</span><span class="ident" id="3290464">index</span><span class="op" id="3290469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290473">r</span><span class="op" id="3290474">.</span><span class="ident" id="3290475">pos</span>&nbsp;<span class="op" id="3290479">=</span>&nbsp;<span class="ident" id="3290481">r</span><span class="op" id="3290482">.</span><span class="ident" id="3290483">fset</span><span class="op" id="3290487">.</span><span class="ident" id="3290488">Position</span><span class="op" id="3290496">(</span><span class="ident" id="3290497">r</span><span class="op" id="3290498">.</span><span class="ident" id="3290499">comment</span><span class="op" id="3290506">.</span><span class="ident" id="3290507">Pos</span><span class="op" id="3290510">(</span><span class="op" id="3290511">)</span><span class="op" id="3290512">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290516">r</span><span class="op" id="3290517">.</span><span class="ident" id="3290518">end</span>&nbsp;<span class="op" id="3290522">=</span>&nbsp;<span class="ident" id="3290524">r</span><span class="op" id="3290525">.</span><span class="ident" id="3290526">fset</span><span class="op" id="3290530">.</span><span class="ident" id="3290531">Position</span><span class="op" id="3290539">(</span><span class="ident" id="3290540">r</span><span class="op" id="3290541">.</span><span class="ident" id="3290542">comment</span><span class="op" id="3290549">.</span><span class="ident" id="3290550">End</span><span class="op" id="3290553">(</span><span class="op" id="3290554">)</span><span class="op" id="3290555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290559">r</span><span class="op" id="3290560">.</span><span class="ident" id="3290561">index</span><span class="op" id="3290566">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290570">}</span><br>
<span class="lineno"></span><span class="op" id="3290572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3290575">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="3290619">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="3290698">//</span><br>
<span class="lineno"></span><span class="keyword" id="3290701">type</span>&nbsp;<span class="ident" id="3290706">nodeStack</span>&nbsp;<span class="op" id="3290716">[</span><span class="op" id="3290717">]</span><span class="ident" id="3290718">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3290724">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3290778">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="3290813">//</span><br>
<span class="lineno"></span><span class="keyword" id="3290816">func</span>&nbsp;<span class="op" id="3290821">(</span><span class="ident" id="3290822">s</span>&nbsp;<span class="op" id="3290824">*</span><span class="ident" id="3290825">nodeStack</span><span class="op" id="3290834">)</span>&nbsp;<span class="ident" id="3290836">push</span><span class="op" id="3290840">(</span><span class="ident" id="3290841">n</span>&nbsp;<span class="ident" id="3290843">Node</span><span class="op" id="3290847">)</span>&nbsp;<span class="op" id="3290849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3290852">s</span><span class="op" id="3290853">.</span><span class="ident" id="3290854">pop</span><span class="op" id="3290857">(</span><span class="ident" id="3290858">n</span><span class="op" id="3290859">.</span><span class="ident" id="3290860">Pos</span><span class="op" id="3290863">(</span><span class="op" id="3290864">)</span><span class="op" id="3290865">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3290868">*</span><span class="ident" id="3290869">s</span>&nbsp;<span class="op" id="3290871">=</span>&nbsp;<span class="builtinfunc" id="3290873">append</span><span class="op" id="3290879">(</span><span class="op" id="3290880">(</span><span class="op" id="3290881">*</span><span class="ident" id="3290882">s</span><span class="op" id="3290883">)</span><span class="op" id="3290884">,</span>&nbsp;<span class="ident" id="3290886">n</span><span class="op" id="3290887">)</span><br>
<span class="lineno"></span><span class="op" id="3290889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3290892">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="3290947">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="3291007">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="3291043">//</span><br>
<span class="lineno"></span><span class="keyword" id="3291046">func</span>&nbsp;<span class="op" id="3291051">(</span><span class="ident" id="3291052">s</span>&nbsp;<span class="op" id="3291054">*</span><span class="ident" id="3291055">nodeStack</span><span class="op" id="3291064">)</span>&nbsp;<span class="ident" id="3291066">pop</span><span class="op" id="3291069">(</span><span class="ident" id="3291070">pos</span>&nbsp;<span class="ident" id="3291074">token</span><span class="op" id="3291079">.</span><span class="ident" id="3291080">Pos</span><span class="op" id="3291083">)</span>&nbsp;<span class="op" id="3291085">(</span><span class="ident" id="3291086">top</span>&nbsp;<span class="ident" id="3291090">Node</span><span class="op" id="3291094">)</span>&nbsp;<span class="op" id="3291096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291099">i</span>&nbsp;<span class="op" id="3291101">:=</span>&nbsp;<span class="builtinfunc" id="3291104">len</span><span class="op" id="3291107">(</span><span class="op" id="3291108">*</span><span class="ident" id="3291109">s</span><span class="op" id="3291110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291113">for</span>&nbsp;<span class="ident" id="3291117">i</span>&nbsp;<span class="op" id="3291119">&gt;</span>&nbsp;<span class="num" id="3291121">0</span>&nbsp;<span class="op" id="3291123">&amp;&amp;</span>&nbsp;<span class="op" id="3291126">(</span><span class="op" id="3291127">*</span><span class="ident" id="3291128">s</span><span class="op" id="3291129">)</span><span class="op" id="3291130">[</span><span class="ident" id="3291131">i</span><span class="op" id="3291132">-</span><span class="num" id="3291133">1</span><span class="op" id="3291134">]</span><span class="op" id="3291135">.</span><span class="ident" id="3291136">End</span><span class="op" id="3291139">(</span><span class="op" id="3291140">)</span>&nbsp;<span class="op" id="3291142">&lt;=</span>&nbsp;<span class="ident" id="3291145">pos</span>&nbsp;<span class="op" id="3291149">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291153">top</span>&nbsp;<span class="op" id="3291157">=</span>&nbsp;<span class="op" id="3291159">(</span><span class="op" id="3291160">*</span><span class="ident" id="3291161">s</span><span class="op" id="3291162">)</span><span class="op" id="3291163">[</span><span class="ident" id="3291164">i</span><span class="op" id="3291165">-</span><span class="num" id="3291166">1</span><span class="op" id="3291167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3291171">i</span><span class="op" id="3291172">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3291176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3291179">*</span><span class="ident" id="3291180">s</span>&nbsp;<span class="op" id="3291182">=</span>&nbsp;<span class="op" id="3291184">(</span><span class="op" id="3291185">*</span><span class="ident" id="3291186">s</span><span class="op" id="3291187">)</span><span class="op" id="3291188">[</span><span class="num" id="3291189">0</span><span class="op" id="3291190">:</span><span class="ident" id="3291191">i</span><span class="op" id="3291192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291195">return</span>&nbsp;<span class="ident" id="3291202">top</span><br>
<span class="lineno">125</span><span class="op" id="3291206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3291209">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="3291282">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="3291351">//</span><br>
<span class="lineno">130</span><span class="comment" id="3291354">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="3291407">//</span><br>
<span class="lineno"></span><span class="comment" id="3291410">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="3291453">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3291519">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="3291583">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3291651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3291681">//</span><br>
<span class="lineno"></span><span class="comment" id="3291684">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3291753">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="3291818">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="3291887">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="3291954">//</span><br>
<span class="lineno"></span><span class="keyword" id="3291957">func</span>&nbsp;<span class="ident" id="3291962">NewCommentMap</span><span class="op" id="3291975">(</span><span class="ident" id="3291976">fset</span>&nbsp;<span class="op" id="3291981">*</span><span class="ident" id="3291982">token</span><span class="op" id="3291987">.</span><span class="ident" id="3291988">FileSet</span><span class="op" id="3291995">,</span>&nbsp;<span class="ident" id="3291997">node</span>&nbsp;<span class="ident" id="3292002">Node</span><span class="op" id="3292006">,</span>&nbsp;<span class="ident" id="3292008">comments</span>&nbsp;<span class="op" id="3292017">[</span><span class="op" id="3292018">]</span><span class="op" id="3292019">*</span><span class="ident" id="3292020">CommentGroup</span><span class="op" id="3292032">)</span>&nbsp;<span class="ident" id="3292034">CommentMap</span>&nbsp;<span class="op" id="3292045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292048">if</span>&nbsp;<span class="builtinfunc" id="3292051">len</span><span class="op" id="3292054">(</span><span class="ident" id="3292055">comments</span><span class="op" id="3292063">)</span>&nbsp;<span class="op" id="3292065">==</span>&nbsp;<span class="num" id="3292068">0</span>&nbsp;<span class="op" id="3292070">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292074">return</span>&nbsp;<span class="ident" id="3292081">nil</span>&nbsp;<span class="comment" id="3292085">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292112">cmap</span>&nbsp;<span class="op" id="3292117">:=</span>&nbsp;<span class="builtinfunc" id="3292120">make</span><span class="op" id="3292124">(</span><span class="ident" id="3292125">CommentMap</span><span class="op" id="3292135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292139">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292167">tmp</span>&nbsp;<span class="op" id="3292171">:=</span>&nbsp;<span class="builtinfunc" id="3292174">make</span><span class="op" id="3292178">(</span><span class="op" id="3292179">[</span><span class="op" id="3292180">]</span><span class="op" id="3292181">*</span><span class="ident" id="3292182">CommentGroup</span><span class="op" id="3292194">,</span>&nbsp;<span class="builtinfunc" id="3292196">len</span><span class="op" id="3292199">(</span><span class="ident" id="3292200">comments</span><span class="op" id="3292208">)</span><span class="op" id="3292209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3292212">copy</span><span class="op" id="3292216">(</span><span class="ident" id="3292217">tmp</span><span class="op" id="3292220">,</span>&nbsp;<span class="ident" id="3292222">comments</span><span class="op" id="3292230">)</span>&nbsp;<span class="comment" id="3292232">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292267">sortComments</span><span class="op" id="3292279">(</span><span class="ident" id="3292280">tmp</span><span class="op" id="3292283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292286">r</span>&nbsp;<span class="op" id="3292288">:=</span>&nbsp;<span class="ident" id="3292291">commentListReader</span><span class="op" id="3292308">{</span><span class="ident" id="3292309">fset</span><span class="op" id="3292313">:</span>&nbsp;<span class="ident" id="3292315">fset</span><span class="op" id="3292319">,</span>&nbsp;<span class="ident" id="3292321">list</span><span class="op" id="3292325">:</span>&nbsp;<span class="ident" id="3292327">tmp</span><span class="op" id="3292330">}</span>&nbsp;<span class="comment" id="3292332">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292371">r</span><span class="op" id="3292372">.</span><span class="ident" id="3292373">next</span><span class="op" id="3292377">(</span><span class="op" id="3292378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292382">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292420">nodes</span>&nbsp;<span class="op" id="3292426">:=</span>&nbsp;<span class="ident" id="3292429">nodeList</span><span class="op" id="3292437">(</span><span class="ident" id="3292438">node</span><span class="op" id="3292442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292445">nodes</span>&nbsp;<span class="op" id="3292451">=</span>&nbsp;<span class="builtinfunc" id="3292453">append</span><span class="op" id="3292459">(</span><span class="ident" id="3292460">nodes</span><span class="op" id="3292465">,</span>&nbsp;<span class="ident" id="3292467">nil</span><span class="op" id="3292470">)</span>&nbsp;<span class="comment" id="3292472">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292493">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292524">var</span>&nbsp;<span class="op" id="3292528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292532">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292538">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292553">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292572">pend</span>&nbsp;&nbsp;<span class="ident" id="3292578">token</span><span class="op" id="3292583">.</span><span class="ident" id="3292584">Position</span>&nbsp;<span class="comment" id="3292593">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292607">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292613">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292628">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292687">pgend</span>&nbsp;<span class="ident" id="3292693">token</span><span class="op" id="3292698">.</span><span class="ident" id="3292699">Position</span>&nbsp;<span class="comment" id="3292708">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292723">stack</span>&nbsp;<span class="ident" id="3292729">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292744">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292773">for</span>&nbsp;<span class="ident" id="3292777">_</span><span class="op" id="3292778">,</span>&nbsp;<span class="ident" id="3292780">q</span>&nbsp;<span class="op" id="3292782">:=</span>&nbsp;<span class="keyword" id="3292785">range</span>&nbsp;<span class="ident" id="3292791">nodes</span>&nbsp;<span class="op" id="3292797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292801">var</span>&nbsp;<span class="ident" id="3292805">qpos</span>&nbsp;<span class="ident" id="3292810">token</span><span class="op" id="3292815">.</span><span class="ident" id="3292816">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3292827">if</span>&nbsp;<span class="ident" id="3292830">q</span>&nbsp;<span class="op" id="3292832">!=</span>&nbsp;<span class="ident" id="3292835">nil</span>&nbsp;<span class="op" id="3292839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3292844">qpos</span>&nbsp;<span class="op" id="3292849">=</span>&nbsp;<span class="ident" id="3292851">fset</span><span class="op" id="3292855">.</span><span class="ident" id="3292856">Position</span><span class="op" id="3292864">(</span><span class="ident" id="3292865">q</span><span class="op" id="3292866">.</span><span class="ident" id="3292867">Pos</span><span class="op" id="3292870">(</span><span class="op" id="3292871">)</span><span class="op" id="3292872">)</span>&nbsp;<span class="comment" id="3292874">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3292901">}</span>&nbsp;<span class="keyword" id="3292903">else</span>&nbsp;<span class="op" id="3292908">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292913">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3292966">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293019">const</span>&nbsp;<span class="ident" id="3293025">infinity</span>&nbsp;<span class="op" id="3293034">=</span>&nbsp;<span class="num" id="3293036">1</span>&nbsp;<span class="op" id="3293038">&lt;&lt;</span>&nbsp;<span class="num" id="3293041">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293047">qpos</span><span class="op" id="3293051">.</span><span class="ident" id="3293052">Offset</span>&nbsp;<span class="op" id="3293059">=</span>&nbsp;<span class="ident" id="3293061">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293073">qpos</span><span class="op" id="3293077">.</span><span class="ident" id="3293078">Line</span>&nbsp;<span class="op" id="3293083">=</span>&nbsp;<span class="ident" id="3293085">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293101">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293143">for</span>&nbsp;<span class="ident" id="3293147">r</span><span class="op" id="3293148">.</span><span class="ident" id="3293149">end</span><span class="op" id="3293152">.</span><span class="ident" id="3293153">Offset</span>&nbsp;<span class="op" id="3293160">&lt;=</span>&nbsp;<span class="ident" id="3293163">qpos</span><span class="op" id="3293167">.</span><span class="ident" id="3293168">Offset</span>&nbsp;<span class="op" id="3293175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293180">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293214">if</span>&nbsp;<span class="ident" id="3293217">top</span>&nbsp;<span class="op" id="3293221">:=</span>&nbsp;<span class="ident" id="3293224">stack</span><span class="op" id="3293229">.</span><span class="ident" id="3293230">pop</span><span class="op" id="3293233">(</span><span class="ident" id="3293234">r</span><span class="op" id="3293235">.</span><span class="ident" id="3293236">comment</span><span class="op" id="3293243">.</span><span class="ident" id="3293244">Pos</span><span class="op" id="3293247">(</span><span class="op" id="3293248">)</span><span class="op" id="3293249">)</span><span class="op" id="3293250">;</span>&nbsp;<span class="ident" id="3293252">top</span>&nbsp;<span class="op" id="3293256">!=</span>&nbsp;<span class="ident" id="3293259">nil</span>&nbsp;<span class="op" id="3293263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293269">pg</span>&nbsp;<span class="op" id="3293272">=</span>&nbsp;<span class="ident" id="3293274">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293282">pgend</span>&nbsp;<span class="op" id="3293288">=</span>&nbsp;<span class="ident" id="3293290">fset</span><span class="op" id="3293294">.</span><span class="ident" id="3293295">Position</span><span class="op" id="3293303">(</span><span class="ident" id="3293304">pg</span><span class="op" id="3293306">.</span><span class="ident" id="3293307">End</span><span class="op" id="3293310">(</span><span class="op" id="3293311">)</span><span class="op" id="3293312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293322">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293379">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293439">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293501">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293513">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293561">var</span>&nbsp;<span class="ident" id="3293565">assoc</span>&nbsp;<span class="ident" id="3293571">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293579">switch</span>&nbsp;<span class="op" id="3293586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293591">case</span>&nbsp;<span class="ident" id="3293596">pg</span>&nbsp;<span class="op" id="3293599">!=</span>&nbsp;<span class="ident" id="3293602">nil</span>&nbsp;<span class="op" id="3293606">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3293613">(</span><span class="ident" id="3293614">pgend</span><span class="op" id="3293619">.</span><span class="ident" id="3293620">Line</span>&nbsp;<span class="op" id="3293625">==</span>&nbsp;<span class="ident" id="3293628">r</span><span class="op" id="3293629">.</span><span class="ident" id="3293630">pos</span><span class="op" id="3293633">.</span><span class="ident" id="3293634">Line</span>&nbsp;<span class="op" id="3293639">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293647">pgend</span><span class="op" id="3293652">.</span><span class="ident" id="3293653">Line</span><span class="op" id="3293657">+</span><span class="num" id="3293658">1</span>&nbsp;<span class="op" id="3293660">==</span>&nbsp;<span class="ident" id="3293663">r</span><span class="op" id="3293664">.</span><span class="ident" id="3293665">pos</span><span class="op" id="3293668">.</span><span class="ident" id="3293669">Line</span>&nbsp;<span class="op" id="3293674">&amp;&amp;</span>&nbsp;<span class="ident" id="3293677">r</span><span class="op" id="3293678">.</span><span class="ident" id="3293679">end</span><span class="op" id="3293682">.</span><span class="ident" id="3293683">Line</span><span class="op" id="3293687">+</span><span class="num" id="3293688">1</span>&nbsp;<span class="op" id="3293690">&lt;</span>&nbsp;<span class="ident" id="3293692">qpos</span><span class="op" id="3293696">.</span><span class="ident" id="3293697">Line</span><span class="op" id="3293701">)</span><span class="op" id="3293702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293708">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293778">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293837">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293901">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3293928">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3293981">assoc</span>&nbsp;<span class="op" id="3293987">=</span>&nbsp;<span class="ident" id="3293989">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3293995">case</span>&nbsp;<span class="ident" id="3294000">p</span>&nbsp;<span class="op" id="3294002">!=</span>&nbsp;<span class="ident" id="3294005">nil</span>&nbsp;<span class="op" id="3294009">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294016">(</span><span class="ident" id="3294017">pend</span><span class="op" id="3294021">.</span><span class="ident" id="3294022">Line</span>&nbsp;<span class="op" id="3294027">==</span>&nbsp;<span class="ident" id="3294030">r</span><span class="op" id="3294031">.</span><span class="ident" id="3294032">pos</span><span class="op" id="3294035">.</span><span class="ident" id="3294036">Line</span>&nbsp;<span class="op" id="3294041">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294049">pend</span><span class="op" id="3294053">.</span><span class="ident" id="3294054">Line</span><span class="op" id="3294058">+</span><span class="num" id="3294059">1</span>&nbsp;<span class="op" id="3294061">==</span>&nbsp;<span class="ident" id="3294064">r</span><span class="op" id="3294065">.</span><span class="ident" id="3294066">pos</span><span class="op" id="3294069">.</span><span class="ident" id="3294070">Line</span>&nbsp;<span class="op" id="3294075">&amp;&amp;</span>&nbsp;<span class="ident" id="3294078">r</span><span class="op" id="3294079">.</span><span class="ident" id="3294080">end</span><span class="op" id="3294083">.</span><span class="ident" id="3294084">Line</span><span class="op" id="3294088">+</span><span class="num" id="3294089">1</span>&nbsp;<span class="op" id="3294091">&lt;</span>&nbsp;<span class="ident" id="3294093">qpos</span><span class="op" id="3294097">.</span><span class="ident" id="3294098">Line</span>&nbsp;<span class="op" id="3294103">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294111">q</span>&nbsp;<span class="op" id="3294113">==</span>&nbsp;<span class="ident" id="3294116">nil</span><span class="op" id="3294119">)</span><span class="op" id="3294120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294126">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294181">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294246">assoc</span>&nbsp;<span class="op" id="3294252">=</span>&nbsp;<span class="ident" id="3294254">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294259">default</span><span class="op" id="3294266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294272">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294326">if</span>&nbsp;<span class="ident" id="3294329">q</span>&nbsp;<span class="op" id="3294331">==</span>&nbsp;<span class="ident" id="3294334">nil</span>&nbsp;<span class="op" id="3294338">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294345">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294394">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3294445">panic</span><span class="op" id="3294450">(</span><span class="string" id="3294451">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="3294515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294527">assoc</span>&nbsp;<span class="op" id="3294533">=</span>&nbsp;<span class="ident" id="3294535">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294545">cmap</span><span class="op" id="3294549">.</span><span class="ident" id="3294550">addComment</span><span class="op" id="3294560">(</span><span class="ident" id="3294561">assoc</span><span class="op" id="3294566">,</span>&nbsp;<span class="ident" id="3294568">r</span><span class="op" id="3294569">.</span><span class="ident" id="3294570">comment</span><span class="op" id="3294577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294582">if</span>&nbsp;<span class="ident" id="3294585">r</span><span class="op" id="3294586">.</span><span class="ident" id="3294587">eol</span><span class="op" id="3294590">(</span><span class="op" id="3294591">)</span>&nbsp;<span class="op" id="3294593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294599">return</span>&nbsp;<span class="ident" id="3294606">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294614">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294619">r</span><span class="op" id="3294620">.</span><span class="ident" id="3294621">next</span><span class="op" id="3294625">(</span><span class="op" id="3294626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294635">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294661">p</span>&nbsp;<span class="op" id="3294663">=</span>&nbsp;<span class="ident" id="3294665">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294669">pend</span>&nbsp;<span class="op" id="3294674">=</span>&nbsp;<span class="ident" id="3294676">fset</span><span class="op" id="3294680">.</span><span class="ident" id="3294681">Position</span><span class="op" id="3294689">(</span><span class="ident" id="3294690">p</span><span class="op" id="3294691">.</span><span class="ident" id="3294692">End</span><span class="op" id="3294695">(</span><span class="op" id="3294696">)</span><span class="op" id="3294697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3294702">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294764">switch</span>&nbsp;<span class="ident" id="3294771">q</span><span class="op" id="3294772">.</span><span class="op" id="3294773">(</span><span class="keyword" id="3294774">type</span><span class="op" id="3294778">)</span>&nbsp;<span class="op" id="3294780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294784">case</span>&nbsp;<span class="op" id="3294789">*</span><span class="ident" id="3294790">File</span><span class="op" id="3294794">,</span>&nbsp;<span class="op" id="3294796">*</span><span class="ident" id="3294797">Field</span><span class="op" id="3294802">,</span>&nbsp;<span class="ident" id="3294804">Decl</span><span class="op" id="3294808">,</span>&nbsp;<span class="ident" id="3294810">Spec</span><span class="op" id="3294814">,</span>&nbsp;<span class="ident" id="3294816">Stmt</span><span class="op" id="3294820">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3294825">stack</span><span class="op" id="3294830">.</span><span class="ident" id="3294831">push</span><span class="op" id="3294835">(</span><span class="ident" id="3294836">q</span><span class="op" id="3294837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3294844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3294848">return</span>&nbsp;<span class="ident" id="3294855">cmap</span><br>
<span class="lineno">240</span><span class="op" id="3294860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3294863">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="3294931">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3294999">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="3295045">//</span><br>
<span class="lineno"></span><span class="keyword" id="3295048">func</span>&nbsp;<span class="op" id="3295053">(</span><span class="ident" id="3295054">cmap</span>&nbsp;<span class="ident" id="3295059">CommentMap</span><span class="op" id="3295069">)</span>&nbsp;<span class="ident" id="3295071">Update</span><span class="op" id="3295077">(</span><span class="ident" id="3295078">old</span><span class="op" id="3295081">,</span>&nbsp;<span class="builtinfunc" id="3295083">new</span>&nbsp;<span class="ident" id="3295087">Node</span><span class="op" id="3295091">)</span>&nbsp;<span class="ident" id="3295093">Node</span>&nbsp;<span class="op" id="3295098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295101">if</span>&nbsp;<span class="ident" id="3295104">list</span>&nbsp;<span class="op" id="3295109">:=</span>&nbsp;<span class="ident" id="3295112">cmap</span><span class="op" id="3295116">[</span><span class="ident" id="3295117">old</span><span class="op" id="3295120">]</span><span class="op" id="3295121">;</span>&nbsp;<span class="builtinfunc" id="3295123">len</span><span class="op" id="3295126">(</span><span class="ident" id="3295127">list</span><span class="op" id="3295131">)</span>&nbsp;<span class="op" id="3295133">&gt;</span>&nbsp;<span class="num" id="3295135">0</span>&nbsp;<span class="op" id="3295137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3295141">delete</span><span class="op" id="3295147">(</span><span class="ident" id="3295148">cmap</span><span class="op" id="3295152">,</span>&nbsp;<span class="ident" id="3295154">old</span><span class="op" id="3295157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295161">cmap</span><span class="op" id="3295165">[</span><span class="builtinfunc" id="3295166">new</span><span class="op" id="3295169">]</span>&nbsp;<span class="op" id="3295171">=</span>&nbsp;<span class="builtinfunc" id="3295173">append</span><span class="op" id="3295179">(</span><span class="ident" id="3295180">cmap</span><span class="op" id="3295184">[</span><span class="builtinfunc" id="3295185">new</span><span class="op" id="3295188">]</span><span class="op" id="3295189">,</span>&nbsp;<span class="ident" id="3295191">list</span><span class="op" id="3295195">...</span><span class="op" id="3295198">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295204">return</span>&nbsp;<span class="builtinfunc" id="3295211">new</span><br>
<span class="lineno"></span><span class="op" id="3295215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3295218">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="3295279">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3295339">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="3295369">//</span><br>
<span class="lineno"></span><span class="keyword" id="3295372">func</span>&nbsp;<span class="op" id="3295377">(</span><span class="ident" id="3295378">cmap</span>&nbsp;<span class="ident" id="3295383">CommentMap</span><span class="op" id="3295393">)</span>&nbsp;<span class="ident" id="3295395">Filter</span><span class="op" id="3295401">(</span><span class="ident" id="3295402">node</span>&nbsp;<span class="ident" id="3295407">Node</span><span class="op" id="3295411">)</span>&nbsp;<span class="ident" id="3295413">CommentMap</span>&nbsp;<span class="op" id="3295424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295427">umap</span>&nbsp;<span class="op" id="3295432">:=</span>&nbsp;<span class="builtinfunc" id="3295435">make</span><span class="op" id="3295439">(</span><span class="ident" id="3295440">CommentMap</span><span class="op" id="3295450">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295453">Inspect</span><span class="op" id="3295460">(</span><span class="ident" id="3295461">node</span><span class="op" id="3295465">,</span>&nbsp;<span class="keyword" id="3295467">func</span><span class="op" id="3295471">(</span><span class="ident" id="3295472">n</span>&nbsp;<span class="ident" id="3295474">Node</span><span class="op" id="3295478">)</span>&nbsp;<span class="builtintype" id="3295480">bool</span>&nbsp;<span class="op" id="3295485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295489">if</span>&nbsp;<span class="ident" id="3295492">g</span>&nbsp;<span class="op" id="3295494">:=</span>&nbsp;<span class="ident" id="3295497">cmap</span><span class="op" id="3295501">[</span><span class="ident" id="3295502">n</span><span class="op" id="3295503">]</span><span class="op" id="3295504">;</span>&nbsp;<span class="builtinfunc" id="3295506">len</span><span class="op" id="3295509">(</span><span class="ident" id="3295510">g</span><span class="op" id="3295511">)</span>&nbsp;<span class="op" id="3295513">&gt;</span>&nbsp;<span class="num" id="3295515">0</span>&nbsp;<span class="op" id="3295517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295522">umap</span><span class="op" id="3295526">[</span><span class="ident" id="3295527">n</span><span class="op" id="3295528">]</span>&nbsp;<span class="op" id="3295530">=</span>&nbsp;<span class="ident" id="3295532">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295540">return</span>&nbsp;<span class="builtintype" id="3295547">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295553">}</span><span class="op" id="3295554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295557">return</span>&nbsp;<span class="ident" id="3295564">umap</span><br>
<span class="lineno"></span><span class="op" id="3295569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3295572">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="3295639">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3295680">//</span><br>
<span class="lineno"></span><span class="keyword" id="3295683">func</span>&nbsp;<span class="op" id="3295688">(</span><span class="ident" id="3295689">cmap</span>&nbsp;<span class="ident" id="3295694">CommentMap</span><span class="op" id="3295704">)</span>&nbsp;<span class="ident" id="3295706">Comments</span><span class="op" id="3295714">(</span><span class="op" id="3295715">)</span>&nbsp;<span class="op" id="3295717">[</span><span class="op" id="3295718">]</span><span class="op" id="3295719">*</span><span class="ident" id="3295720">CommentGroup</span>&nbsp;<span class="op" id="3295733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295736">list</span>&nbsp;<span class="op" id="3295741">:=</span>&nbsp;<span class="builtinfunc" id="3295744">make</span><span class="op" id="3295748">(</span><span class="op" id="3295749">[</span><span class="op" id="3295750">]</span><span class="op" id="3295751">*</span><span class="ident" id="3295752">CommentGroup</span><span class="op" id="3295764">,</span>&nbsp;<span class="num" id="3295766">0</span><span class="op" id="3295767">,</span>&nbsp;<span class="builtinfunc" id="3295769">len</span><span class="op" id="3295772">(</span><span class="ident" id="3295773">cmap</span><span class="op" id="3295777">)</span><span class="op" id="3295778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295781">for</span>&nbsp;<span class="ident" id="3295785">_</span><span class="op" id="3295786">,</span>&nbsp;<span class="ident" id="3295788">e</span>&nbsp;<span class="op" id="3295790">:=</span>&nbsp;<span class="keyword" id="3295793">range</span>&nbsp;<span class="ident" id="3295799">cmap</span>&nbsp;<span class="op" id="3295804">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295808">list</span>&nbsp;<span class="op" id="3295813">=</span>&nbsp;<span class="builtinfunc" id="3295815">append</span><span class="op" id="3295821">(</span><span class="ident" id="3295822">list</span><span class="op" id="3295826">,</span>&nbsp;<span class="ident" id="3295828">e</span><span class="op" id="3295829">...</span><span class="op" id="3295832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3295835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3295838">sortComments</span><span class="op" id="3295850">(</span><span class="ident" id="3295851">list</span><span class="op" id="3295855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295858">return</span>&nbsp;<span class="ident" id="3295865">list</span><br>
<span class="lineno"></span><span class="op" id="3295870">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="3295873">func</span>&nbsp;<span class="ident" id="3295878">summary</span><span class="op" id="3295885">(</span><span class="ident" id="3295886">list</span>&nbsp;<span class="op" id="3295891">[</span><span class="op" id="3295892">]</span><span class="op" id="3295893">*</span><span class="ident" id="3295894">CommentGroup</span><span class="op" id="3295906">)</span>&nbsp;<span class="builtintype" id="3295908">string</span>&nbsp;<span class="op" id="3295915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295918">const</span>&nbsp;<span class="ident" id="3295924">maxLen</span>&nbsp;<span class="op" id="3295931">=</span>&nbsp;<span class="num" id="3295933">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295937">var</span>&nbsp;<span class="ident" id="3295941">buf</span>&nbsp;<span class="ident" id="3295945">bytes</span><span class="op" id="3295950">.</span><span class="ident" id="3295951">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3295960">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="3295985">loop</span><span class="op" id="3295989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3295992">for</span>&nbsp;<span class="ident" id="3295996">_</span><span class="op" id="3295997">,</span>&nbsp;<span class="ident" id="3295999">group</span>&nbsp;<span class="op" id="3296005">:=</span>&nbsp;<span class="keyword" id="3296008">range</span>&nbsp;<span class="ident" id="3296014">list</span>&nbsp;<span class="op" id="3296019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296023">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296085">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296145">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296179">for</span>&nbsp;<span class="ident" id="3296183">_</span><span class="op" id="3296184">,</span>&nbsp;<span class="ident" id="3296186">comment</span>&nbsp;<span class="op" id="3296194">:=</span>&nbsp;<span class="keyword" id="3296197">range</span>&nbsp;<span class="ident" id="3296203">group</span><span class="op" id="3296208">.</span><span class="ident" id="3296209">List</span>&nbsp;<span class="op" id="3296214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296219">if</span>&nbsp;<span class="ident" id="3296222">buf</span><span class="op" id="3296225">.</span><span class="ident" id="3296226">Len</span><span class="op" id="3296229">(</span><span class="op" id="3296230">)</span>&nbsp;<span class="op" id="3296232">&gt;=</span>&nbsp;<span class="ident" id="3296235">maxLen</span>&nbsp;<span class="op" id="3296242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296248">break</span>&nbsp;<span class="ident" id="3296254">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296262">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296267">buf</span><span class="op" id="3296270">.</span><span class="ident" id="3296271">WriteString</span><span class="op" id="3296282">(</span><span class="ident" id="3296283">comment</span><span class="op" id="3296290">.</span><span class="ident" id="3296291">Text</span><span class="op" id="3296295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296306">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296331">if</span>&nbsp;<span class="ident" id="3296334">buf</span><span class="op" id="3296337">.</span><span class="ident" id="3296338">Len</span><span class="op" id="3296341">(</span><span class="op" id="3296342">)</span>&nbsp;<span class="op" id="3296344">&gt;</span>&nbsp;<span class="ident" id="3296346">maxLen</span>&nbsp;<span class="op" id="3296353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296357">buf</span><span class="op" id="3296360">.</span><span class="ident" id="3296361">Truncate</span><span class="op" id="3296369">(</span><span class="ident" id="3296370">maxLen</span>&nbsp;<span class="op" id="3296377">-</span>&nbsp;<span class="num" id="3296379">3</span><span class="op" id="3296380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296384">buf</span><span class="op" id="3296387">.</span><span class="ident" id="3296388">WriteString</span><span class="op" id="3296399">(</span><span class="string" id="3296400">&#34;...&#34;</span><span class="op" id="3296405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296412">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296451">bytes</span>&nbsp;<span class="op" id="3296457">:=</span>&nbsp;<span class="ident" id="3296460">buf</span><span class="op" id="3296463">.</span><span class="ident" id="3296464">Bytes</span><span class="op" id="3296469">(</span><span class="op" id="3296470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296473">for</span>&nbsp;<span class="ident" id="3296477">i</span><span class="op" id="3296478">,</span>&nbsp;<span class="ident" id="3296480">b</span>&nbsp;<span class="op" id="3296482">:=</span>&nbsp;<span class="keyword" id="3296485">range</span>&nbsp;<span class="ident" id="3296491">bytes</span>&nbsp;<span class="op" id="3296497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296501">switch</span>&nbsp;<span class="ident" id="3296508">b</span>&nbsp;<span class="op" id="3296510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296514">case</span>&nbsp;<span class="string" id="3296519">&#39;\t&#39;</span><span class="op" id="3296523">,</span>&nbsp;<span class="string" id="3296525">&#39;\n&#39;</span><span class="op" id="3296529">,</span>&nbsp;<span class="string" id="3296531">&#39;\r&#39;</span><span class="op" id="3296535">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296540">bytes</span><span class="op" id="3296545">[</span><span class="ident" id="3296546">i</span><span class="op" id="3296547">]</span>&nbsp;<span class="op" id="3296549">=</span>&nbsp;<span class="string" id="3296551">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296564">return</span>&nbsp;<span class="builtintype" id="3296571">string</span><span class="op" id="3296577">(</span><span class="ident" id="3296578">bytes</span><span class="op" id="3296583">)</span><br>
<span class="lineno">315</span><span class="op" id="3296585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3296588">func</span>&nbsp;<span class="op" id="3296593">(</span><span class="ident" id="3296594">cmap</span>&nbsp;<span class="ident" id="3296599">CommentMap</span><span class="op" id="3296609">)</span>&nbsp;<span class="ident" id="3296611">String</span><span class="op" id="3296617">(</span><span class="op" id="3296618">)</span>&nbsp;<span class="builtintype" id="3296620">string</span>&nbsp;<span class="op" id="3296627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296630">var</span>&nbsp;<span class="ident" id="3296634">buf</span>&nbsp;<span class="ident" id="3296638">bytes</span><span class="op" id="3296643">.</span><span class="ident" id="3296644">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296652">fmt</span><span class="op" id="3296655">.</span><span class="ident" id="3296656">Fprintln</span><span class="op" id="3296664">(</span><span class="op" id="3296665">&amp;</span><span class="ident" id="3296666">buf</span><span class="op" id="3296669">,</span>&nbsp;<span class="string" id="3296671">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="3296685">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296688">for</span>&nbsp;<span class="ident" id="3296692">node</span><span class="op" id="3296696">,</span>&nbsp;<span class="ident" id="3296698">comment</span>&nbsp;<span class="op" id="3296706">:=</span>&nbsp;<span class="keyword" id="3296709">range</span>&nbsp;<span class="ident" id="3296715">cmap</span>&nbsp;<span class="op" id="3296720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296724">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296788">var</span>&nbsp;<span class="ident" id="3296792">s</span>&nbsp;<span class="builtintype" id="3296794">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296803">if</span>&nbsp;<span class="ident" id="3296806">ident</span><span class="op" id="3296811">,</span>&nbsp;<span class="ident" id="3296813">ok</span>&nbsp;<span class="op" id="3296816">:=</span>&nbsp;<span class="ident" id="3296819">node</span><span class="op" id="3296823">.</span><span class="op" id="3296824">(</span><span class="op" id="3296825">*</span><span class="ident" id="3296826">Ident</span><span class="op" id="3296831">)</span><span class="op" id="3296832">;</span>&nbsp;<span class="ident" id="3296834">ok</span>&nbsp;<span class="op" id="3296837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296842">s</span>&nbsp;<span class="op" id="3296844">=</span>&nbsp;<span class="ident" id="3296846">ident</span><span class="op" id="3296851">.</span><span class="ident" id="3296852">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296859">}</span>&nbsp;<span class="keyword" id="3296861">else</span>&nbsp;<span class="op" id="3296866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296871">s</span>&nbsp;<span class="op" id="3296873">=</span>&nbsp;<span class="ident" id="3296875">fmt</span><span class="op" id="3296878">.</span><span class="ident" id="3296879">Sprintf</span><span class="op" id="3296886">(</span><span class="string" id="3296887">&#34;%T&#34;</span><span class="op" id="3296891">,</span>&nbsp;<span class="ident" id="3296893">node</span><span class="op" id="3296897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296905">fmt</span><span class="op" id="3296908">.</span><span class="ident" id="3296909">Fprintf</span><span class="op" id="3296916">(</span><span class="op" id="3296917">&amp;</span><span class="ident" id="3296918">buf</span><span class="op" id="3296921">,</span>&nbsp;<span class="string" id="3296923">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="3296942">,</span>&nbsp;<span class="ident" id="3296944">node</span><span class="op" id="3296948">,</span>&nbsp;<span class="ident" id="3296950">s</span><span class="op" id="3296951">,</span>&nbsp;<span class="ident" id="3296953">summary</span><span class="op" id="3296960">(</span><span class="ident" id="3296961">comment</span><span class="op" id="3296968">)</span><span class="op" id="3296969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296972">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296975">fmt</span><span class="op" id="3296978">.</span><span class="ident" id="3296979">Fprintln</span><span class="op" id="3296987">(</span><span class="op" id="3296988">&amp;</span><span class="ident" id="3296989">buf</span><span class="op" id="3296992">,</span>&nbsp;<span class="string" id="3296994">&#34;}&#34;</span><span class="op" id="3296997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297000">return</span>&nbsp;<span class="ident" id="3297007">buf</span><span class="op" id="3297010">.</span><span class="ident" id="3297011">String</span><span class="op" id="3297017">(</span><span class="op" id="3297018">)</span><br>
<span class="lineno"></span><span class="op" id="3297020">}</span>
</div>
</body>
</html>
