<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html" class="current">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4278863">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4278918">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4278972">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4279023">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="4279096">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="4279111">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="4279183">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="4279257">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4279306">package</span>&nbsp;<span class="ident" id="4279314">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279325">import</span>&nbsp;<span class="op" id="4279332">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4279335">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4279344">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4279353">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4279360">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4279365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4279368">type</span>&nbsp;<span class="ident" id="4279373">qpReader</span>&nbsp;<span class="keyword" id="4279382">struct</span>&nbsp;<span class="op" id="4279389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279392">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4279397">*</span><span class="ident" id="4279398">bufio</span><span class="op" id="4279403">.</span><span class="ident" id="4279404">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279412">rerr</span>&nbsp;<span class="builtintype" id="4279417">error</span>&nbsp;&nbsp;<span class="comment" id="4279424">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279444">line</span>&nbsp;<span class="op" id="4279449">[</span><span class="op" id="4279450">]</span><span class="builtintype" id="4279451">byte</span>&nbsp;<span class="comment" id="4279456">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="4279492">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4279495">func</span>&nbsp;<span class="ident" id="4279500">newQuotedPrintableReader</span><span class="op" id="4279524">(</span><span class="ident" id="4279525">r</span>&nbsp;<span class="ident" id="4279527">io</span><span class="op" id="4279529">.</span><span class="ident" id="4279530">Reader</span><span class="op" id="4279536">)</span>&nbsp;<span class="ident" id="4279538">io</span><span class="op" id="4279540">.</span><span class="ident" id="4279541">Reader</span>&nbsp;<span class="op" id="4279548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279551">return</span>&nbsp;<span class="op" id="4279558">&amp;</span><span class="ident" id="4279559">qpReader</span><span class="op" id="4279567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279571">br</span><span class="op" id="4279573">:</span>&nbsp;<span class="ident" id="4279575">bufio</span><span class="op" id="4279580">.</span><span class="ident" id="4279581">NewReader</span><span class="op" id="4279590">(</span><span class="ident" id="4279591">r</span><span class="op" id="4279592">)</span><span class="op" id="4279593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279596">}</span><br>
<span class="lineno">30</span><span class="op" id="4279598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279601">func</span>&nbsp;<span class="ident" id="4279606">fromHex</span><span class="op" id="4279613">(</span><span class="ident" id="4279614">b</span>&nbsp;<span class="builtintype" id="4279616">byte</span><span class="op" id="4279620">)</span>&nbsp;<span class="op" id="4279622">(</span><span class="builtintype" id="4279623">byte</span><span class="op" id="4279627">,</span>&nbsp;<span class="builtintype" id="4279629">error</span><span class="op" id="4279634">)</span>&nbsp;<span class="op" id="4279636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279639">switch</span>&nbsp;<span class="op" id="4279646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279649">case</span>&nbsp;<span class="ident" id="4279654">b</span>&nbsp;<span class="op" id="4279656">&gt;=</span>&nbsp;<span class="string" id="4279659">&#39;0&#39;</span>&nbsp;<span class="op" id="4279663">&amp;&amp;</span>&nbsp;<span class="ident" id="4279666">b</span>&nbsp;<span class="op" id="4279668">&lt;=</span>&nbsp;<span class="string" id="4279671">&#39;9&#39;</span><span class="op" id="4279674">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279678">return</span>&nbsp;<span class="ident" id="4279685">b</span>&nbsp;<span class="op" id="4279687">-</span>&nbsp;<span class="string" id="4279689">&#39;0&#39;</span><span class="op" id="4279692">,</span>&nbsp;<span class="ident" id="4279694">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279699">case</span>&nbsp;<span class="ident" id="4279704">b</span>&nbsp;<span class="op" id="4279706">&gt;=</span>&nbsp;<span class="string" id="4279709">&#39;A&#39;</span>&nbsp;<span class="op" id="4279713">&amp;&amp;</span>&nbsp;<span class="ident" id="4279716">b</span>&nbsp;<span class="op" id="4279718">&lt;=</span>&nbsp;<span class="string" id="4279721">&#39;F&#39;</span><span class="op" id="4279724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279728">return</span>&nbsp;<span class="ident" id="4279735">b</span>&nbsp;<span class="op" id="4279737">-</span>&nbsp;<span class="string" id="4279739">&#39;A&#39;</span>&nbsp;<span class="op" id="4279743">+</span>&nbsp;<span class="num" id="4279745">10</span><span class="op" id="4279747">,</span>&nbsp;<span class="ident" id="4279749">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279757">return</span>&nbsp;<span class="num" id="4279764">0</span><span class="op" id="4279765">,</span>&nbsp;<span class="ident" id="4279767">fmt</span><span class="op" id="4279770">.</span><span class="ident" id="4279771">Errorf</span><span class="op" id="4279777">(</span><span class="string" id="4279778">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="4279831">,</span>&nbsp;<span class="ident" id="4279833">b</span><span class="op" id="4279834">)</span><br>
<span class="lineno">40</span><span class="op" id="4279836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279839">func</span>&nbsp;<span class="op" id="4279844">(</span><span class="ident" id="4279845">q</span>&nbsp;<span class="op" id="4279847">*</span><span class="ident" id="4279848">qpReader</span><span class="op" id="4279856">)</span>&nbsp;<span class="ident" id="4279858">readHexByte</span><span class="op" id="4279869">(</span><span class="ident" id="4279870">v</span>&nbsp;<span class="op" id="4279872">[</span><span class="op" id="4279873">]</span><span class="builtintype" id="4279874">byte</span><span class="op" id="4279878">)</span>&nbsp;<span class="op" id="4279880">(</span><span class="ident" id="4279881">b</span>&nbsp;<span class="builtintype" id="4279883">byte</span><span class="op" id="4279887">,</span>&nbsp;<span class="ident" id="4279889">err</span>&nbsp;<span class="builtintype" id="4279893">error</span><span class="op" id="4279898">)</span>&nbsp;<span class="op" id="4279900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279903">if</span>&nbsp;<span class="builtinfunc" id="4279906">len</span><span class="op" id="4279909">(</span><span class="ident" id="4279910">v</span><span class="op" id="4279911">)</span>&nbsp;<span class="op" id="4279913">&lt;</span>&nbsp;<span class="num" id="4279915">2</span>&nbsp;<span class="op" id="4279917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279921">return</span>&nbsp;<span class="num" id="4279928">0</span><span class="op" id="4279929">,</span>&nbsp;<span class="ident" id="4279931">io</span><span class="op" id="4279933">.</span><span class="ident" id="4279934">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279955">var</span>&nbsp;<span class="ident" id="4279959">hb</span><span class="op" id="4279961">,</span>&nbsp;<span class="ident" id="4279963">lb</span>&nbsp;<span class="builtintype" id="4279966">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279972">if</span>&nbsp;<span class="ident" id="4279975">hb</span><span class="op" id="4279977">,</span>&nbsp;<span class="ident" id="4279979">err</span>&nbsp;<span class="op" id="4279983">=</span>&nbsp;<span class="ident" id="4279985">fromHex</span><span class="op" id="4279992">(</span><span class="ident" id="4279993">v</span><span class="op" id="4279994">[</span><span class="num" id="4279995">0</span><span class="op" id="4279996">]</span><span class="op" id="4279997">)</span><span class="op" id="4279998">;</span>&nbsp;<span class="ident" id="4280000">err</span>&nbsp;<span class="op" id="4280004">!=</span>&nbsp;<span class="ident" id="4280007">nil</span>&nbsp;<span class="op" id="4280011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280015">return</span>&nbsp;<span class="num" id="4280022">0</span><span class="op" id="4280023">,</span>&nbsp;<span class="ident" id="4280025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280030">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280033">if</span>&nbsp;<span class="ident" id="4280036">lb</span><span class="op" id="4280038">,</span>&nbsp;<span class="ident" id="4280040">err</span>&nbsp;<span class="op" id="4280044">=</span>&nbsp;<span class="ident" id="4280046">fromHex</span><span class="op" id="4280053">(</span><span class="ident" id="4280054">v</span><span class="op" id="4280055">[</span><span class="num" id="4280056">1</span><span class="op" id="4280057">]</span><span class="op" id="4280058">)</span><span class="op" id="4280059">;</span>&nbsp;<span class="ident" id="4280061">err</span>&nbsp;<span class="op" id="4280065">!=</span>&nbsp;<span class="ident" id="4280068">nil</span>&nbsp;<span class="op" id="4280072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280076">return</span>&nbsp;<span class="num" id="4280083">0</span><span class="op" id="4280084">,</span>&nbsp;<span class="ident" id="4280086">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280094">return</span>&nbsp;<span class="ident" id="4280101">hb</span><span class="op" id="4280103">&lt;&lt;</span><span class="num" id="4280105">4</span>&nbsp;<span class="op" id="4280107">|</span>&nbsp;<span class="ident" id="4280109">lb</span><span class="op" id="4280111">,</span>&nbsp;<span class="ident" id="4280113">nil</span><br>
<span class="lineno"></span><span class="op" id="4280117">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="4280120">func</span>&nbsp;<span class="ident" id="4280125">isQPDiscardWhitespace</span><span class="op" id="4280146">(</span><span class="ident" id="4280147">r</span>&nbsp;<span class="builtintype" id="4280149">rune</span><span class="op" id="4280153">)</span>&nbsp;<span class="builtintype" id="4280155">bool</span>&nbsp;<span class="op" id="4280160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280163">switch</span>&nbsp;<span class="ident" id="4280170">r</span>&nbsp;<span class="op" id="4280172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280175">case</span>&nbsp;<span class="string" id="4280180">&#39;\n&#39;</span><span class="op" id="4280184">,</span>&nbsp;<span class="string" id="4280186">&#39;\r&#39;</span><span class="op" id="4280190">,</span>&nbsp;<span class="string" id="4280192">&#39;&nbsp;&#39;</span><span class="op" id="4280195">,</span>&nbsp;<span class="string" id="4280197">&#39;\t&#39;</span><span class="op" id="4280201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280205">return</span>&nbsp;<span class="builtintype" id="4280212">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280221">return</span>&nbsp;<span class="builtintype" id="4280228">false</span><br>
<span class="lineno"></span><span class="op" id="4280234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4280237">var</span>&nbsp;<span class="op" id="4280241">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280244">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280255">=</span>&nbsp;<span class="op" id="4280257">[</span><span class="op" id="4280258">]</span><span class="builtintype" id="4280259">byte</span><span class="op" id="4280263">(</span><span class="string" id="4280264">&#34;\r\n&#34;</span><span class="op" id="4280270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280273">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280284">=</span>&nbsp;<span class="op" id="4280286">[</span><span class="op" id="4280287">]</span><span class="builtintype" id="4280288">byte</span><span class="op" id="4280292">(</span><span class="string" id="4280293">&#34;\n&#34;</span><span class="op" id="4280297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280300">softSuffix</span>&nbsp;<span class="op" id="4280311">=</span>&nbsp;<span class="op" id="4280313">[</span><span class="op" id="4280314">]</span><span class="builtintype" id="4280315">byte</span><span class="op" id="4280319">(</span><span class="string" id="4280320">&#34;=&#34;</span><span class="op" id="4280323">)</span><br>
<span class="lineno"></span><span class="op" id="4280325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4280328">func</span>&nbsp;<span class="op" id="4280333">(</span><span class="ident" id="4280334">q</span>&nbsp;<span class="op" id="4280336">*</span><span class="ident" id="4280337">qpReader</span><span class="op" id="4280345">)</span>&nbsp;<span class="ident" id="4280347">Read</span><span class="op" id="4280351">(</span><span class="ident" id="4280352">p</span>&nbsp;<span class="op" id="4280354">[</span><span class="op" id="4280355">]</span><span class="builtintype" id="4280356">byte</span><span class="op" id="4280360">)</span>&nbsp;<span class="op" id="4280362">(</span><span class="ident" id="4280363">n</span>&nbsp;<span class="builtintype" id="4280365">int</span><span class="op" id="4280368">,</span>&nbsp;<span class="ident" id="4280370">err</span>&nbsp;<span class="builtintype" id="4280374">error</span><span class="op" id="4280379">)</span>&nbsp;<span class="op" id="4280381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280384">for</span>&nbsp;<span class="builtinfunc" id="4280388">len</span><span class="op" id="4280391">(</span><span class="ident" id="4280392">p</span><span class="op" id="4280393">)</span>&nbsp;<span class="op" id="4280395">&gt;</span>&nbsp;<span class="num" id="4280397">0</span>&nbsp;<span class="op" id="4280399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280403">if</span>&nbsp;<span class="builtinfunc" id="4280406">len</span><span class="op" id="4280409">(</span><span class="ident" id="4280410">q</span><span class="op" id="4280411">.</span><span class="ident" id="4280412">line</span><span class="op" id="4280416">)</span>&nbsp;<span class="op" id="4280418">==</span>&nbsp;<span class="num" id="4280421">0</span>&nbsp;<span class="op" id="4280423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280428">if</span>&nbsp;<span class="ident" id="4280431">q</span><span class="op" id="4280432">.</span><span class="ident" id="4280433">rerr</span>&nbsp;<span class="op" id="4280438">!=</span>&nbsp;<span class="ident" id="4280441">nil</span>&nbsp;<span class="op" id="4280445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280451">return</span>&nbsp;<span class="ident" id="4280458">n</span><span class="op" id="4280459">,</span>&nbsp;<span class="ident" id="4280461">q</span><span class="op" id="4280462">.</span><span class="ident" id="4280463">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280476">q</span><span class="op" id="4280477">.</span><span class="ident" id="4280478">line</span><span class="op" id="4280482">,</span>&nbsp;<span class="ident" id="4280484">q</span><span class="op" id="4280485">.</span><span class="ident" id="4280486">rerr</span>&nbsp;<span class="op" id="4280491">=</span>&nbsp;<span class="ident" id="4280493">q</span><span class="op" id="4280494">.</span><span class="ident" id="4280495">br</span><span class="op" id="4280497">.</span><span class="ident" id="4280498">ReadSlice</span><span class="op" id="4280507">(</span><span class="string" id="4280508">&#39;\n&#39;</span><span class="op" id="4280512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280518">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280570">hasLF</span>&nbsp;<span class="op" id="4280576">:=</span>&nbsp;<span class="ident" id="4280579">bytes</span><span class="op" id="4280584">.</span><span class="ident" id="4280585">HasSuffix</span><span class="op" id="4280594">(</span><span class="ident" id="4280595">q</span><span class="op" id="4280596">.</span><span class="ident" id="4280597">line</span><span class="op" id="4280601">,</span>&nbsp;<span class="ident" id="4280603">lf</span><span class="op" id="4280605">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280610">hasCR</span>&nbsp;<span class="op" id="4280616">:=</span>&nbsp;<span class="ident" id="4280619">bytes</span><span class="op" id="4280624">.</span><span class="ident" id="4280625">HasSuffix</span><span class="op" id="4280634">(</span><span class="ident" id="4280635">q</span><span class="op" id="4280636">.</span><span class="ident" id="4280637">line</span><span class="op" id="4280641">,</span>&nbsp;<span class="ident" id="4280643">crlf</span><span class="op" id="4280647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280652">wholeLine</span>&nbsp;<span class="op" id="4280662">:=</span>&nbsp;<span class="ident" id="4280665">q</span><span class="op" id="4280666">.</span><span class="ident" id="4280667">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280675">q</span><span class="op" id="4280676">.</span><span class="ident" id="4280677">line</span>&nbsp;<span class="op" id="4280682">=</span>&nbsp;<span class="ident" id="4280684">bytes</span><span class="op" id="4280689">.</span><span class="ident" id="4280690">TrimRightFunc</span><span class="op" id="4280703">(</span><span class="ident" id="4280704">wholeLine</span><span class="op" id="4280713">,</span>&nbsp;<span class="ident" id="4280715">isQPDiscardWhitespace</span><span class="op" id="4280736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280741">if</span>&nbsp;<span class="ident" id="4280744">bytes</span><span class="op" id="4280749">.</span><span class="ident" id="4280750">HasSuffix</span><span class="op" id="4280759">(</span><span class="ident" id="4280760">q</span><span class="op" id="4280761">.</span><span class="ident" id="4280762">line</span><span class="op" id="4280766">,</span>&nbsp;<span class="ident" id="4280768">softSuffix</span><span class="op" id="4280778">)</span>&nbsp;<span class="op" id="4280780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280786">rightStripped</span>&nbsp;<span class="op" id="4280800">:=</span>&nbsp;<span class="ident" id="4280803">wholeLine</span><span class="op" id="4280812">[</span><span class="builtinfunc" id="4280813">len</span><span class="op" id="4280816">(</span><span class="ident" id="4280817">q</span><span class="op" id="4280818">.</span><span class="ident" id="4280819">line</span><span class="op" id="4280823">)</span><span class="op" id="4280824">:</span><span class="op" id="4280825">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280831">q</span><span class="op" id="4280832">.</span><span class="ident" id="4280833">line</span>&nbsp;<span class="op" id="4280838">=</span>&nbsp;<span class="ident" id="4280840">q</span><span class="op" id="4280841">.</span><span class="ident" id="4280842">line</span><span class="op" id="4280846">[</span><span class="op" id="4280847">:</span><span class="builtinfunc" id="4280848">len</span><span class="op" id="4280851">(</span><span class="ident" id="4280852">q</span><span class="op" id="4280853">.</span><span class="ident" id="4280854">line</span><span class="op" id="4280858">)</span><span class="op" id="4280859">-</span><span class="num" id="4280860">1</span><span class="op" id="4280861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280867">if</span>&nbsp;<span class="op" id="4280870">!</span><span class="ident" id="4280871">bytes</span><span class="op" id="4280876">.</span><span class="ident" id="4280877">HasPrefix</span><span class="op" id="4280886">(</span><span class="ident" id="4280887">rightStripped</span><span class="op" id="4280900">,</span>&nbsp;<span class="ident" id="4280902">lf</span><span class="op" id="4280904">)</span>&nbsp;<span class="op" id="4280906">&amp;&amp;</span>&nbsp;<span class="op" id="4280909">!</span><span class="ident" id="4280910">bytes</span><span class="op" id="4280915">.</span><span class="ident" id="4280916">HasPrefix</span><span class="op" id="4280925">(</span><span class="ident" id="4280926">rightStripped</span><span class="op" id="4280939">,</span>&nbsp;<span class="ident" id="4280941">crlf</span><span class="op" id="4280945">)</span>&nbsp;<span class="op" id="4280947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280954">q</span><span class="op" id="4280955">.</span><span class="ident" id="4280956">rerr</span>&nbsp;<span class="op" id="4280961">=</span>&nbsp;<span class="ident" id="4280963">fmt</span><span class="op" id="4280966">.</span><span class="ident" id="4280967">Errorf</span><span class="op" id="4280973">(</span><span class="string" id="4280974">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="4281012">,</span>&nbsp;<span class="ident" id="4281014">rightStripped</span><span class="op" id="4281027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281038">}</span>&nbsp;<span class="keyword" id="4281040">else</span>&nbsp;<span class="keyword" id="4281045">if</span>&nbsp;<span class="ident" id="4281048">hasLF</span>&nbsp;<span class="op" id="4281054">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281060">if</span>&nbsp;<span class="ident" id="4281063">hasCR</span>&nbsp;<span class="op" id="4281069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281076">q</span><span class="op" id="4281077">.</span><span class="ident" id="4281078">line</span>&nbsp;<span class="op" id="4281083">=</span>&nbsp;<span class="builtinfunc" id="4281085">append</span><span class="op" id="4281091">(</span><span class="ident" id="4281092">q</span><span class="op" id="4281093">.</span><span class="ident" id="4281094">line</span><span class="op" id="4281098">,</span>&nbsp;<span class="string" id="4281100">&#39;\r&#39;</span><span class="op" id="4281104">,</span>&nbsp;<span class="string" id="4281106">&#39;\n&#39;</span><span class="op" id="4281110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281116">}</span>&nbsp;<span class="keyword" id="4281118">else</span>&nbsp;<span class="op" id="4281123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281130">q</span><span class="op" id="4281131">.</span><span class="ident" id="4281132">line</span>&nbsp;<span class="op" id="4281137">=</span>&nbsp;<span class="builtinfunc" id="4281139">append</span><span class="op" id="4281145">(</span><span class="ident" id="4281146">q</span><span class="op" id="4281147">.</span><span class="ident" id="4281148">line</span><span class="op" id="4281152">,</span>&nbsp;<span class="string" id="4281154">&#39;\n&#39;</span><span class="op" id="4281158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281164">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281174">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281189">b</span>&nbsp;<span class="op" id="4281191">:=</span>&nbsp;<span class="ident" id="4281194">q</span><span class="op" id="4281195">.</span><span class="ident" id="4281196">line</span><span class="op" id="4281200">[</span><span class="num" id="4281201">0</span><span class="op" id="4281202">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281207">switch</span>&nbsp;<span class="op" id="4281214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281218">case</span>&nbsp;<span class="ident" id="4281223">b</span>&nbsp;<span class="op" id="4281225">==</span>&nbsp;<span class="string" id="4281228">&#39;=&#39;</span><span class="op" id="4281231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281236">b</span><span class="op" id="4281237">,</span>&nbsp;<span class="ident" id="4281239">err</span>&nbsp;<span class="op" id="4281243">=</span>&nbsp;<span class="ident" id="4281245">q</span><span class="op" id="4281246">.</span><span class="ident" id="4281247">readHexByte</span><span class="op" id="4281258">(</span><span class="ident" id="4281259">q</span><span class="op" id="4281260">.</span><span class="ident" id="4281261">line</span><span class="op" id="4281265">[</span><span class="num" id="4281266">1</span><span class="op" id="4281267">:</span><span class="op" id="4281268">]</span><span class="op" id="4281269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281274">if</span>&nbsp;<span class="ident" id="4281277">err</span>&nbsp;<span class="op" id="4281281">!=</span>&nbsp;<span class="ident" id="4281284">nil</span>&nbsp;<span class="op" id="4281288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281294">return</span>&nbsp;<span class="ident" id="4281301">n</span><span class="op" id="4281302">,</span>&nbsp;<span class="ident" id="4281304">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281316">q</span><span class="op" id="4281317">.</span><span class="ident" id="4281318">line</span>&nbsp;<span class="op" id="4281323">=</span>&nbsp;<span class="ident" id="4281325">q</span><span class="op" id="4281326">.</span><span class="ident" id="4281327">line</span><span class="op" id="4281331">[</span><span class="num" id="4281332">2</span><span class="op" id="4281333">:</span><span class="op" id="4281334">]</span>&nbsp;<span class="comment" id="4281336">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281375">case</span>&nbsp;<span class="ident" id="4281380">b</span>&nbsp;<span class="op" id="4281382">==</span>&nbsp;<span class="string" id="4281385">&#39;\t&#39;</span>&nbsp;<span class="op" id="4281390">||</span>&nbsp;<span class="ident" id="4281393">b</span>&nbsp;<span class="op" id="4281395">==</span>&nbsp;<span class="string" id="4281398">&#39;\r&#39;</span>&nbsp;<span class="op" id="4281403">||</span>&nbsp;<span class="ident" id="4281406">b</span>&nbsp;<span class="op" id="4281408">==</span>&nbsp;<span class="string" id="4281411">&#39;\n&#39;</span><span class="op" id="4281415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281420">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281428">case</span>&nbsp;<span class="ident" id="4281433">b</span>&nbsp;<span class="op" id="4281435">&lt;</span>&nbsp;<span class="string" id="4281437">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4281441">||</span>&nbsp;<span class="ident" id="4281444">b</span>&nbsp;<span class="op" id="4281446">&gt;</span>&nbsp;<span class="string" id="4281448">&#39;~&#39;</span><span class="op" id="4281451">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281456">return</span>&nbsp;<span class="ident" id="4281463">n</span><span class="op" id="4281464">,</span>&nbsp;<span class="ident" id="4281466">fmt</span><span class="op" id="4281469">.</span><span class="ident" id="4281470">Errorf</span><span class="op" id="4281476">(</span><span class="string" id="4281477">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="4281544">,</span>&nbsp;<span class="ident" id="4281546">b</span><span class="op" id="4281547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281555">p</span><span class="op" id="4281556">[</span><span class="num" id="4281557">0</span><span class="op" id="4281558">]</span>&nbsp;<span class="op" id="4281560">=</span>&nbsp;<span class="ident" id="4281562">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281566">p</span>&nbsp;<span class="op" id="4281568">=</span>&nbsp;<span class="ident" id="4281570">p</span><span class="op" id="4281571">[</span><span class="num" id="4281572">1</span><span class="op" id="4281573">:</span><span class="op" id="4281574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281578">q</span><span class="op" id="4281579">.</span><span class="ident" id="4281580">line</span>&nbsp;<span class="op" id="4281585">=</span>&nbsp;<span class="ident" id="4281587">q</span><span class="op" id="4281588">.</span><span class="ident" id="4281589">line</span><span class="op" id="4281593">[</span><span class="num" id="4281594">1</span><span class="op" id="4281595">:</span><span class="op" id="4281596">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281600">n</span><span class="op" id="4281601">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281608">return</span>&nbsp;<span class="ident" id="4281615">n</span><span class="op" id="4281616">,</span>&nbsp;<span class="ident" id="4281618">nil</span><br>
<span class="lineno"></span><span class="op" id="4281622">}</span>
</div>
</body>
</html>
