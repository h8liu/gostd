<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3036093">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3036148">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3036202">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3036253">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3036324">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="3036390">//</span><br>
<span class="lineno"></span><span class="comment" id="3036393">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3036461">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="3036517">//</span><br>
<span class="lineno"></span><span class="keyword" id="3036520">package</span>&nbsp;<span class="ident" id="3036528">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3036539">import</span>&nbsp;<span class="op" id="3036546">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3036549">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3036558">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3036564">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3036579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036582">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="3036662">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036688">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="3036762">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3036837">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="3036910">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="3036937">//</span><br>
<span class="lineno"></span><span class="keyword" id="3036940">type</span>&nbsp;<span class="ident" id="3036945">cell</span>&nbsp;<span class="keyword" id="3036950">struct</span>&nbsp;<span class="op" id="3036957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3036960">size</span>&nbsp;&nbsp;<span class="builtintype" id="3036966">int</span>&nbsp;&nbsp;<span class="comment" id="3036971">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3036994">width</span>&nbsp;<span class="builtintype" id="3037000">int</span>&nbsp;&nbsp;<span class="comment" id="3037005">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037029">htab</span>&nbsp;&nbsp;<span class="builtintype" id="3037035">bool</span>&nbsp;<span class="comment" id="3037040">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="3037092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3037095">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="3037161">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="3037214">//</span><br>
<span class="lineno"></span><span class="comment" id="3037217">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="3037286">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3037350">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="3037418">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="3037482">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="3037545">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3037610">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="3037680">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3037747">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="3037813">//</span><br>
<span class="lineno"></span><span class="comment" id="3037816">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="3037888">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="3037927">//</span><br>
<span class="lineno"></span><span class="comment" id="3037930">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="3037998">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="3038062">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3038127">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="3038141">//</span><br>
<span class="lineno"></span><span class="comment" id="3038144">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="3038212">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3038271">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="3038344">//</span><br>
<span class="lineno"></span><span class="comment" id="3038347">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="3038412">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="3038478">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3038546">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3038612">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3038678">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3038744">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="3038813">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="3038828">//</span><br>
<span class="lineno"></span><span class="comment" id="3038831">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="3038896">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="3038963">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="3039029">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="3039095">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="3039143">//</span><br>
<span class="lineno"></span><span class="comment" id="3039146">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="3039213">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="3039282">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="3039321">//</span><br>
<span class="lineno"></span><span class="keyword" id="3039324">type</span>&nbsp;<span class="ident" id="3039329">Writer</span>&nbsp;<span class="keyword" id="3039336">struct</span>&nbsp;<span class="op" id="3039343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039346">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039364">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3039373">io</span><span class="op" id="3039375">.</span><span class="ident" id="3039376">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039384">minwidth</span>&nbsp;<span class="builtintype" id="3039393">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039398">tabwidth</span>&nbsp;<span class="builtintype" id="3039407">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039412">padding</span>&nbsp;&nbsp;<span class="builtintype" id="3039421">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039426">padbytes</span>&nbsp;<span class="op" id="3039435">[</span><span class="num" id="3039436">8</span><span class="op" id="3039437">]</span><span class="builtintype" id="3039438">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039444">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3039453">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039460">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039478">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039486">bytes</span><span class="op" id="3039491">.</span><span class="ident" id="3039492">Buffer</span>&nbsp;<span class="comment" id="3039499">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039548">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3039556">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039569">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039649">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039657">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039670">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039755">endChar</span>&nbsp;<span class="builtintype" id="3039763">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039776">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039877">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3039885">[</span><span class="op" id="3039886">]</span><span class="op" id="3039887">[</span><span class="op" id="3039888">]</span><span class="ident" id="3039889">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039898">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039946">widths</span>&nbsp;&nbsp;<span class="op" id="3039954">[</span><span class="op" id="3039955">]</span><span class="builtintype" id="3039956">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039967">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="3040029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3040032">func</span>&nbsp;<span class="op" id="3040037">(</span><span class="ident" id="3040038">b</span>&nbsp;<span class="op" id="3040040">*</span><span class="ident" id="3040041">Writer</span><span class="op" id="3040047">)</span>&nbsp;<span class="ident" id="3040049">addLine</span><span class="op" id="3040056">(</span><span class="op" id="3040057">)</span>&nbsp;<span class="op" id="3040059">{</span>&nbsp;<span class="ident" id="3040061">b</span><span class="op" id="3040062">.</span><span class="ident" id="3040063">lines</span>&nbsp;<span class="op" id="3040069">=</span>&nbsp;<span class="builtinfunc" id="3040071">append</span><span class="op" id="3040077">(</span><span class="ident" id="3040078">b</span><span class="op" id="3040079">.</span><span class="ident" id="3040080">lines</span><span class="op" id="3040085">,</span>&nbsp;<span class="op" id="3040087">[</span><span class="op" id="3040088">]</span><span class="ident" id="3040089">cell</span><span class="op" id="3040093">{</span><span class="op" id="3040094">}</span><span class="op" id="3040095">)</span>&nbsp;<span class="op" id="3040097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3040100">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3040128">func</span>&nbsp;<span class="op" id="3040133">(</span><span class="ident" id="3040134">b</span>&nbsp;<span class="op" id="3040136">*</span><span class="ident" id="3040137">Writer</span><span class="op" id="3040143">)</span>&nbsp;<span class="ident" id="3040145">reset</span><span class="op" id="3040150">(</span><span class="op" id="3040151">)</span>&nbsp;<span class="op" id="3040153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040156">b</span><span class="op" id="3040157">.</span><span class="ident" id="3040158">buf</span><span class="op" id="3040161">.</span><span class="ident" id="3040162">Reset</span><span class="op" id="3040167">(</span><span class="op" id="3040168">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040171">b</span><span class="op" id="3040172">.</span><span class="ident" id="3040173">pos</span>&nbsp;<span class="op" id="3040177">=</span>&nbsp;<span class="num" id="3040179">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040182">b</span><span class="op" id="3040183">.</span><span class="ident" id="3040184">cell</span>&nbsp;<span class="op" id="3040189">=</span>&nbsp;<span class="ident" id="3040191">cell</span><span class="op" id="3040195">{</span><span class="op" id="3040196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040199">b</span><span class="op" id="3040200">.</span><span class="ident" id="3040201">endChar</span>&nbsp;<span class="op" id="3040209">=</span>&nbsp;<span class="num" id="3040211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040214">b</span><span class="op" id="3040215">.</span><span class="ident" id="3040216">lines</span>&nbsp;<span class="op" id="3040222">=</span>&nbsp;<span class="ident" id="3040224">b</span><span class="op" id="3040225">.</span><span class="ident" id="3040226">lines</span><span class="op" id="3040231">[</span><span class="num" id="3040232">0</span><span class="op" id="3040233">:</span><span class="num" id="3040234">0</span><span class="op" id="3040235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040238">b</span><span class="op" id="3040239">.</span><span class="ident" id="3040240">widths</span>&nbsp;<span class="op" id="3040247">=</span>&nbsp;<span class="ident" id="3040249">b</span><span class="op" id="3040250">.</span><span class="ident" id="3040251">widths</span><span class="op" id="3040257">[</span><span class="num" id="3040258">0</span><span class="op" id="3040259">:</span><span class="num" id="3040260">0</span><span class="op" id="3040261">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040264">b</span><span class="op" id="3040265">.</span><span class="ident" id="3040266">addLine</span><span class="op" id="3040273">(</span><span class="op" id="3040274">)</span><br>
<span class="lineno"></span><span class="op" id="3040276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3040279">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="3040323">//</span><br>
<span class="lineno">110</span><span class="comment" id="3040326">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="3040407">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="3040485">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="3040534">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="3040601">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="3040683">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="3040762">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="3040788">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3040859">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3040909">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="3040982">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="3041041">//</span><br>
<span class="lineno"></span><span class="comment" id="3041044">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="3041097">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="3041150">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="3041203">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="3041256">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="3041309">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="3041359">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="3041409">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3041462">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="3041512">const</span>&nbsp;<span class="op" id="3041518">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041521">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041580">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041637">FilterHTML</span>&nbsp;<span class="builtintype" id="3041648">uint</span>&nbsp;<span class="op" id="3041653">=</span>&nbsp;<span class="num" id="3041655">1</span>&nbsp;<span class="op" id="3041657">&lt;&lt;</span>&nbsp;<span class="ident" id="3041660">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041667">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041728">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041789">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041803">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041846">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041877">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041890">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041946">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041980">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042002">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042064">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042125">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042137">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042204">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042263">Debug</span><br>
<span class="lineno"></span><span class="op" id="3042269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3042272">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="3042354">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="3042435">//</span><br>
<span class="lineno"></span><span class="comment" id="3042438">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="3042491">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="3042557">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="3042620">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="3042660">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3042717">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="3042775">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="3042833">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="3042893">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="3042952">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="3042981">//</span><br>
<span class="lineno"></span><span class="keyword" id="3042984">func</span>&nbsp;<span class="op" id="3042989">(</span><span class="ident" id="3042990">b</span>&nbsp;<span class="op" id="3042992">*</span><span class="ident" id="3042993">Writer</span><span class="op" id="3042999">)</span>&nbsp;<span class="ident" id="3043001">Init</span><span class="op" id="3043005">(</span><span class="ident" id="3043006">output</span>&nbsp;<span class="ident" id="3043013">io</span><span class="op" id="3043015">.</span><span class="ident" id="3043016">Writer</span><span class="op" id="3043022">,</span>&nbsp;<span class="ident" id="3043024">minwidth</span><span class="op" id="3043032">,</span>&nbsp;<span class="ident" id="3043034">tabwidth</span><span class="op" id="3043042">,</span>&nbsp;<span class="ident" id="3043044">padding</span>&nbsp;<span class="builtintype" id="3043052">int</span><span class="op" id="3043055">,</span>&nbsp;<span class="ident" id="3043057">padchar</span>&nbsp;<span class="builtintype" id="3043065">byte</span><span class="op" id="3043069">,</span>&nbsp;<span class="ident" id="3043071">flags</span>&nbsp;<span class="builtintype" id="3043077">uint</span><span class="op" id="3043081">)</span>&nbsp;<span class="op" id="3043083">*</span><span class="ident" id="3043084">Writer</span>&nbsp;<span class="op" id="3043091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043094">if</span>&nbsp;<span class="ident" id="3043097">minwidth</span>&nbsp;<span class="op" id="3043106">&lt;</span>&nbsp;<span class="num" id="3043108">0</span>&nbsp;<span class="op" id="3043110">||</span>&nbsp;<span class="ident" id="3043113">tabwidth</span>&nbsp;<span class="op" id="3043122">&lt;</span>&nbsp;<span class="num" id="3043124">0</span>&nbsp;<span class="op" id="3043126">||</span>&nbsp;<span class="ident" id="3043129">padding</span>&nbsp;<span class="op" id="3043137">&lt;</span>&nbsp;<span class="num" id="3043139">0</span>&nbsp;<span class="op" id="3043141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3043145">panic</span><span class="op" id="3043150">(</span><span class="string" id="3043151">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="3043192">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043198">b</span><span class="op" id="3043199">.</span><span class="ident" id="3043200">output</span>&nbsp;<span class="op" id="3043207">=</span>&nbsp;<span class="ident" id="3043209">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043217">b</span><span class="op" id="3043218">.</span><span class="ident" id="3043219">minwidth</span>&nbsp;<span class="op" id="3043228">=</span>&nbsp;<span class="ident" id="3043230">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043240">b</span><span class="op" id="3043241">.</span><span class="ident" id="3043242">tabwidth</span>&nbsp;<span class="op" id="3043251">=</span>&nbsp;<span class="ident" id="3043253">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043263">b</span><span class="op" id="3043264">.</span><span class="ident" id="3043265">padding</span>&nbsp;<span class="op" id="3043273">=</span>&nbsp;<span class="ident" id="3043275">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043284">for</span>&nbsp;<span class="ident" id="3043288">i</span>&nbsp;<span class="op" id="3043290">:=</span>&nbsp;<span class="keyword" id="3043293">range</span>&nbsp;<span class="ident" id="3043299">b</span><span class="op" id="3043300">.</span><span class="ident" id="3043301">padbytes</span>&nbsp;<span class="op" id="3043310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043314">b</span><span class="op" id="3043315">.</span><span class="ident" id="3043316">padbytes</span><span class="op" id="3043324">[</span><span class="ident" id="3043325">i</span><span class="op" id="3043326">]</span>&nbsp;<span class="op" id="3043328">=</span>&nbsp;<span class="ident" id="3043330">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043342">if</span>&nbsp;<span class="ident" id="3043345">padchar</span>&nbsp;<span class="op" id="3043353">==</span>&nbsp;<span class="string" id="3043356">&#39;\t&#39;</span>&nbsp;<span class="op" id="3043361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3043365">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043406">flags</span>&nbsp;<span class="op" id="3043412">&amp;^=</span>&nbsp;<span class="ident" id="3043416">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043431">b</span><span class="op" id="3043432">.</span><span class="ident" id="3043433">flags</span>&nbsp;<span class="op" id="3043439">=</span>&nbsp;<span class="ident" id="3043441">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043449">b</span><span class="op" id="3043450">.</span><span class="ident" id="3043451">reset</span><span class="op" id="3043456">(</span><span class="op" id="3043457">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043461">return</span>&nbsp;<span class="ident" id="3043468">b</span><br>
<span class="lineno"></span><span class="op" id="3043470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3043473">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="3043513">func</span>&nbsp;<span class="op" id="3043518">(</span><span class="ident" id="3043519">b</span>&nbsp;<span class="op" id="3043521">*</span><span class="ident" id="3043522">Writer</span><span class="op" id="3043528">)</span>&nbsp;<span class="ident" id="3043530">dump</span><span class="op" id="3043534">(</span><span class="op" id="3043535">)</span>&nbsp;<span class="op" id="3043537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043540">pos</span>&nbsp;<span class="op" id="3043544">:=</span>&nbsp;<span class="num" id="3043547">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043550">for</span>&nbsp;<span class="ident" id="3043554">i</span><span class="op" id="3043555">,</span>&nbsp;<span class="ident" id="3043557">line</span>&nbsp;<span class="op" id="3043562">:=</span>&nbsp;<span class="keyword" id="3043565">range</span>&nbsp;<span class="ident" id="3043571">b</span><span class="op" id="3043572">.</span><span class="ident" id="3043573">lines</span>&nbsp;<span class="op" id="3043579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3043583">print</span><span class="op" id="3043588">(</span><span class="string" id="3043589">&#34;(&#34;</span><span class="op" id="3043592">,</span>&nbsp;<span class="ident" id="3043594">i</span><span class="op" id="3043595">,</span>&nbsp;<span class="string" id="3043597">&#34;)&nbsp;&#34;</span><span class="op" id="3043601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043605">for</span>&nbsp;<span class="ident" id="3043609">_</span><span class="op" id="3043610">,</span>&nbsp;<span class="ident" id="3043612">c</span>&nbsp;<span class="op" id="3043614">:=</span>&nbsp;<span class="keyword" id="3043617">range</span>&nbsp;<span class="ident" id="3043623">line</span>&nbsp;<span class="op" id="3043628">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3043633">print</span><span class="op" id="3043638">(</span><span class="string" id="3043639">&#34;[&#34;</span><span class="op" id="3043642">,</span>&nbsp;<span class="builtintype" id="3043644">string</span><span class="op" id="3043650">(</span><span class="ident" id="3043651">b</span><span class="op" id="3043652">.</span><span class="ident" id="3043653">buf</span><span class="op" id="3043656">.</span><span class="ident" id="3043657">Bytes</span><span class="op" id="3043662">(</span><span class="op" id="3043663">)</span><span class="op" id="3043664">[</span><span class="ident" id="3043665">pos</span><span class="op" id="3043668">:</span><span class="ident" id="3043669">pos</span><span class="op" id="3043672">+</span><span class="ident" id="3043673">c</span><span class="op" id="3043674">.</span><span class="ident" id="3043675">size</span><span class="op" id="3043679">]</span><span class="op" id="3043680">)</span><span class="op" id="3043681">,</span>&nbsp;<span class="string" id="3043683">&#34;]&#34;</span><span class="op" id="3043686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043691">pos</span>&nbsp;<span class="op" id="3043695">+=</span>&nbsp;<span class="ident" id="3043698">c</span><span class="op" id="3043699">.</span><span class="ident" id="3043700">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3043711">print</span><span class="op" id="3043716">(</span><span class="string" id="3043717">&#34;\n&#34;</span><span class="op" id="3043721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043724">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3043727">print</span><span class="op" id="3043732">(</span><span class="string" id="3043733">&#34;\n&#34;</span><span class="op" id="3043737">)</span><br>
<span class="lineno"></span><span class="op" id="3043739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3043742">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3043812">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="3043887">type</span>&nbsp;<span class="ident" id="3043892">osError</span>&nbsp;<span class="keyword" id="3043900">struct</span>&nbsp;<span class="op" id="3043907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043910">err</span>&nbsp;<span class="builtintype" id="3043914">error</span><br>
<span class="lineno"></span><span class="op" id="3043920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3043923">func</span>&nbsp;<span class="op" id="3043928">(</span><span class="ident" id="3043929">b</span>&nbsp;<span class="op" id="3043931">*</span><span class="ident" id="3043932">Writer</span><span class="op" id="3043938">)</span>&nbsp;<span class="ident" id="3043940">write0</span><span class="op" id="3043946">(</span><span class="ident" id="3043947">buf</span>&nbsp;<span class="op" id="3043951">[</span><span class="op" id="3043952">]</span><span class="builtintype" id="3043953">byte</span><span class="op" id="3043957">)</span>&nbsp;<span class="op" id="3043959">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043962">n</span><span class="op" id="3043963">,</span>&nbsp;<span class="ident" id="3043965">err</span>&nbsp;<span class="op" id="3043969">:=</span>&nbsp;<span class="ident" id="3043972">b</span><span class="op" id="3043973">.</span><span class="ident" id="3043974">output</span><span class="op" id="3043980">.</span><span class="ident" id="3043981">Write</span><span class="op" id="3043986">(</span><span class="ident" id="3043987">buf</span><span class="op" id="3043990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043993">if</span>&nbsp;<span class="ident" id="3043996">n</span>&nbsp;<span class="op" id="3043998">!=</span>&nbsp;<span class="builtinfunc" id="3044001">len</span><span class="op" id="3044004">(</span><span class="ident" id="3044005">buf</span><span class="op" id="3044008">)</span>&nbsp;<span class="op" id="3044010">&amp;&amp;</span>&nbsp;<span class="ident" id="3044013">err</span>&nbsp;<span class="op" id="3044017">==</span>&nbsp;<span class="ident" id="3044020">nil</span>&nbsp;<span class="op" id="3044024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044028">err</span>&nbsp;<span class="op" id="3044032">=</span>&nbsp;<span class="ident" id="3044034">io</span><span class="op" id="3044036">.</span><span class="ident" id="3044037">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044055">if</span>&nbsp;<span class="ident" id="3044058">err</span>&nbsp;<span class="op" id="3044062">!=</span>&nbsp;<span class="ident" id="3044065">nil</span>&nbsp;<span class="op" id="3044069">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3044073">panic</span><span class="op" id="3044078">(</span><span class="ident" id="3044079">osError</span><span class="op" id="3044086">{</span><span class="ident" id="3044087">err</span><span class="op" id="3044090">}</span><span class="op" id="3044091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044094">}</span><br>
<span class="lineno"></span><span class="op" id="3044096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3044099">func</span>&nbsp;<span class="op" id="3044104">(</span><span class="ident" id="3044105">b</span>&nbsp;<span class="op" id="3044107">*</span><span class="ident" id="3044108">Writer</span><span class="op" id="3044114">)</span>&nbsp;<span class="ident" id="3044116">writeN</span><span class="op" id="3044122">(</span><span class="ident" id="3044123">src</span>&nbsp;<span class="op" id="3044127">[</span><span class="op" id="3044128">]</span><span class="builtintype" id="3044129">byte</span><span class="op" id="3044133">,</span>&nbsp;<span class="ident" id="3044135">n</span>&nbsp;<span class="builtintype" id="3044137">int</span><span class="op" id="3044140">)</span>&nbsp;<span class="op" id="3044142">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044145">for</span>&nbsp;<span class="ident" id="3044149">n</span>&nbsp;<span class="op" id="3044151">&gt;</span>&nbsp;<span class="builtinfunc" id="3044153">len</span><span class="op" id="3044156">(</span><span class="ident" id="3044157">src</span><span class="op" id="3044160">)</span>&nbsp;<span class="op" id="3044162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044166">b</span><span class="op" id="3044167">.</span><span class="ident" id="3044168">write0</span><span class="op" id="3044174">(</span><span class="ident" id="3044175">src</span><span class="op" id="3044178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044182">n</span>&nbsp;<span class="op" id="3044184">-=</span>&nbsp;<span class="builtinfunc" id="3044187">len</span><span class="op" id="3044190">(</span><span class="ident" id="3044191">src</span><span class="op" id="3044194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044200">b</span><span class="op" id="3044201">.</span><span class="ident" id="3044202">write0</span><span class="op" id="3044208">(</span><span class="ident" id="3044209">src</span><span class="op" id="3044212">[</span><span class="num" id="3044213">0</span><span class="op" id="3044214">:</span><span class="ident" id="3044215">n</span><span class="op" id="3044216">]</span><span class="op" id="3044217">)</span><br>
<span class="lineno">230</span><span class="op" id="3044219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3044222">var</span>&nbsp;<span class="op" id="3044226">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044229">newline</span>&nbsp;<span class="op" id="3044237">=</span>&nbsp;<span class="op" id="3044239">[</span><span class="op" id="3044240">]</span><span class="builtintype" id="3044241">byte</span><span class="op" id="3044245">{</span><span class="string" id="3044246">&#39;\n&#39;</span><span class="op" id="3044250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044253">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044261">=</span>&nbsp;<span class="op" id="3044263">[</span><span class="op" id="3044264">]</span><span class="builtintype" id="3044265">byte</span><span class="op" id="3044269">(</span><span class="string" id="3044270">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="3044288">)</span><br>
<span class="lineno">235</span><span class="op" id="3044290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3044293">func</span>&nbsp;<span class="op" id="3044298">(</span><span class="ident" id="3044299">b</span>&nbsp;<span class="op" id="3044301">*</span><span class="ident" id="3044302">Writer</span><span class="op" id="3044308">)</span>&nbsp;<span class="ident" id="3044310">writePadding</span><span class="op" id="3044322">(</span><span class="ident" id="3044323">textw</span><span class="op" id="3044328">,</span>&nbsp;<span class="ident" id="3044330">cellw</span>&nbsp;<span class="builtintype" id="3044336">int</span><span class="op" id="3044339">,</span>&nbsp;<span class="ident" id="3044341">useTabs</span>&nbsp;<span class="builtintype" id="3044349">bool</span><span class="op" id="3044353">)</span>&nbsp;<span class="op" id="3044355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044358">if</span>&nbsp;<span class="ident" id="3044361">b</span><span class="op" id="3044362">.</span><span class="ident" id="3044363">padbytes</span><span class="op" id="3044371">[</span><span class="num" id="3044372">0</span><span class="op" id="3044373">]</span>&nbsp;<span class="op" id="3044375">==</span>&nbsp;<span class="string" id="3044378">&#39;\t&#39;</span>&nbsp;<span class="op" id="3044383">||</span>&nbsp;<span class="ident" id="3044386">useTabs</span>&nbsp;<span class="op" id="3044394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3044398">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044429">if</span>&nbsp;<span class="ident" id="3044432">b</span><span class="op" id="3044433">.</span><span class="ident" id="3044434">tabwidth</span>&nbsp;<span class="op" id="3044443">==</span>&nbsp;<span class="num" id="3044446">0</span>&nbsp;<span class="op" id="3044448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044453">return</span>&nbsp;<span class="comment" id="3044460">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3044511">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044563">cellw</span>&nbsp;<span class="op" id="3044569">=</span>&nbsp;<span class="op" id="3044571">(</span><span class="ident" id="3044572">cellw</span>&nbsp;<span class="op" id="3044578">+</span>&nbsp;<span class="ident" id="3044580">b</span><span class="op" id="3044581">.</span><span class="ident" id="3044582">tabwidth</span>&nbsp;<span class="op" id="3044591">-</span>&nbsp;<span class="num" id="3044593">1</span><span class="op" id="3044594">)</span>&nbsp;<span class="op" id="3044596">/</span>&nbsp;<span class="ident" id="3044598">b</span><span class="op" id="3044599">.</span><span class="ident" id="3044600">tabwidth</span>&nbsp;<span class="op" id="3044609">*</span>&nbsp;<span class="ident" id="3044611">b</span><span class="op" id="3044612">.</span><span class="ident" id="3044613">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044624">n</span>&nbsp;<span class="op" id="3044626">:=</span>&nbsp;<span class="ident" id="3044629">cellw</span>&nbsp;<span class="op" id="3044635">-</span>&nbsp;<span class="ident" id="3044637">textw</span>&nbsp;<span class="comment" id="3044643">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044666">if</span>&nbsp;<span class="ident" id="3044669">n</span>&nbsp;<span class="op" id="3044671">&lt;</span>&nbsp;<span class="num" id="3044673">0</span>&nbsp;<span class="op" id="3044675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3044680">panic</span><span class="op" id="3044685">(</span><span class="string" id="3044686">&#34;internal&nbsp;error&#34;</span><span class="op" id="3044702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044710">b</span><span class="op" id="3044711">.</span><span class="ident" id="3044712">writeN</span><span class="op" id="3044718">(</span><span class="ident" id="3044719">tabs</span><span class="op" id="3044723">,</span>&nbsp;<span class="op" id="3044725">(</span><span class="ident" id="3044726">n</span><span class="op" id="3044727">+</span><span class="ident" id="3044728">b</span><span class="op" id="3044729">.</span><span class="ident" id="3044730">tabwidth</span><span class="op" id="3044738">-</span><span class="num" id="3044739">1</span><span class="op" id="3044740">)</span><span class="op" id="3044741">/</span><span class="ident" id="3044742">b</span><span class="op" id="3044743">.</span><span class="ident" id="3044744">tabwidth</span><span class="op" id="3044752">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044756">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3044768">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044812">b</span><span class="op" id="3044813">.</span><span class="ident" id="3044814">writeN</span><span class="op" id="3044820">(</span><span class="ident" id="3044821">b</span><span class="op" id="3044822">.</span><span class="ident" id="3044823">padbytes</span><span class="op" id="3044831">[</span><span class="num" id="3044832">0</span><span class="op" id="3044833">:</span><span class="op" id="3044834">]</span><span class="op" id="3044835">,</span>&nbsp;<span class="ident" id="3044837">cellw</span><span class="op" id="3044842">-</span><span class="ident" id="3044843">textw</span><span class="op" id="3044848">)</span><br>
<span class="lineno">255</span><span class="op" id="3044850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3044853">var</span>&nbsp;<span class="ident" id="3044857">vbar</span>&nbsp;<span class="op" id="3044862">=</span>&nbsp;<span class="op" id="3044864">[</span><span class="op" id="3044865">]</span><span class="builtintype" id="3044866">byte</span><span class="op" id="3044870">{</span><span class="string" id="3044871">&#39;|&#39;</span><span class="op" id="3044874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3044877">func</span>&nbsp;<span class="op" id="3044882">(</span><span class="ident" id="3044883">b</span>&nbsp;<span class="op" id="3044885">*</span><span class="ident" id="3044886">Writer</span><span class="op" id="3044892">)</span>&nbsp;<span class="ident" id="3044894">writeLines</span><span class="op" id="3044904">(</span><span class="ident" id="3044905">pos0</span>&nbsp;<span class="builtintype" id="3044910">int</span><span class="op" id="3044913">,</span>&nbsp;<span class="ident" id="3044915">line0</span><span class="op" id="3044920">,</span>&nbsp;<span class="ident" id="3044922">line1</span>&nbsp;<span class="builtintype" id="3044928">int</span><span class="op" id="3044931">)</span>&nbsp;<span class="op" id="3044933">(</span><span class="ident" id="3044934">pos</span>&nbsp;<span class="builtintype" id="3044938">int</span><span class="op" id="3044941">)</span>&nbsp;<span class="op" id="3044943">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044946">pos</span>&nbsp;<span class="op" id="3044950">=</span>&nbsp;<span class="ident" id="3044952">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044958">for</span>&nbsp;<span class="ident" id="3044962">i</span>&nbsp;<span class="op" id="3044964">:=</span>&nbsp;<span class="ident" id="3044967">line0</span><span class="op" id="3044972">;</span>&nbsp;<span class="ident" id="3044974">i</span>&nbsp;<span class="op" id="3044976">&lt;</span>&nbsp;<span class="ident" id="3044978">line1</span><span class="op" id="3044983">;</span>&nbsp;<span class="ident" id="3044985">i</span><span class="op" id="3044986">++</span>&nbsp;<span class="op" id="3044989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044993">line</span>&nbsp;<span class="op" id="3044998">:=</span>&nbsp;<span class="ident" id="3045001">b</span><span class="op" id="3045002">.</span><span class="ident" id="3045003">lines</span><span class="op" id="3045008">[</span><span class="ident" id="3045009">i</span><span class="op" id="3045010">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3045015">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045077">useTabs</span>&nbsp;<span class="op" id="3045085">:=</span>&nbsp;<span class="ident" id="3045088">b</span><span class="op" id="3045089">.</span><span class="ident" id="3045090">flags</span><span class="op" id="3045095">&amp;</span><span class="ident" id="3045096">TabIndent</span>&nbsp;<span class="op" id="3045106">!=</span>&nbsp;<span class="num" id="3045109">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045114">for</span>&nbsp;<span class="ident" id="3045118">j</span><span class="op" id="3045119">,</span>&nbsp;<span class="ident" id="3045121">c</span>&nbsp;<span class="op" id="3045123">:=</span>&nbsp;<span class="keyword" id="3045126">range</span>&nbsp;<span class="ident" id="3045132">line</span>&nbsp;<span class="op" id="3045137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045142">if</span>&nbsp;<span class="ident" id="3045145">j</span>&nbsp;<span class="op" id="3045147">&gt;</span>&nbsp;<span class="num" id="3045149">0</span>&nbsp;<span class="op" id="3045151">&amp;&amp;</span>&nbsp;<span class="ident" id="3045154">b</span><span class="op" id="3045155">.</span><span class="ident" id="3045156">flags</span><span class="op" id="3045161">&amp;</span><span class="ident" id="3045162">Debug</span>&nbsp;<span class="op" id="3045168">!=</span>&nbsp;<span class="num" id="3045171">0</span>&nbsp;<span class="op" id="3045173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3045179">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045208">b</span><span class="op" id="3045209">.</span><span class="ident" id="3045210">write0</span><span class="op" id="3045216">(</span><span class="ident" id="3045217">vbar</span><span class="op" id="3045221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045232">if</span>&nbsp;<span class="ident" id="3045235">c</span><span class="op" id="3045236">.</span><span class="ident" id="3045237">size</span>&nbsp;<span class="op" id="3045242">==</span>&nbsp;<span class="num" id="3045245">0</span>&nbsp;<span class="op" id="3045247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3045253">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045271">if</span>&nbsp;<span class="ident" id="3045274">j</span>&nbsp;<span class="op" id="3045276">&lt;</span>&nbsp;<span class="builtinfunc" id="3045278">len</span><span class="op" id="3045281">(</span><span class="ident" id="3045282">b</span><span class="op" id="3045283">.</span><span class="ident" id="3045284">widths</span><span class="op" id="3045290">)</span>&nbsp;<span class="op" id="3045292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045299">b</span><span class="op" id="3045300">.</span><span class="ident" id="3045301">writePadding</span><span class="op" id="3045313">(</span><span class="ident" id="3045314">c</span><span class="op" id="3045315">.</span><span class="ident" id="3045316">width</span><span class="op" id="3045321">,</span>&nbsp;<span class="ident" id="3045323">b</span><span class="op" id="3045324">.</span><span class="ident" id="3045325">widths</span><span class="op" id="3045331">[</span><span class="ident" id="3045332">j</span><span class="op" id="3045333">]</span><span class="op" id="3045334">,</span>&nbsp;<span class="ident" id="3045336">useTabs</span><span class="op" id="3045343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045354">}</span>&nbsp;<span class="keyword" id="3045356">else</span>&nbsp;<span class="op" id="3045361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3045367">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045389">useTabs</span>&nbsp;<span class="op" id="3045397">=</span>&nbsp;<span class="builtintype" id="3045399">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045409">if</span>&nbsp;<span class="ident" id="3045412">b</span><span class="op" id="3045413">.</span><span class="ident" id="3045414">flags</span><span class="op" id="3045419">&amp;</span><span class="ident" id="3045420">AlignRight</span>&nbsp;<span class="op" id="3045431">==</span>&nbsp;<span class="num" id="3045434">0</span>&nbsp;<span class="op" id="3045436">{</span>&nbsp;<span class="comment" id="3045438">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045457">b</span><span class="op" id="3045458">.</span><span class="ident" id="3045459">write0</span><span class="op" id="3045465">(</span><span class="ident" id="3045466">b</span><span class="op" id="3045467">.</span><span class="ident" id="3045468">buf</span><span class="op" id="3045471">.</span><span class="ident" id="3045472">Bytes</span><span class="op" id="3045477">(</span><span class="op" id="3045478">)</span><span class="op" id="3045479">[</span><span class="ident" id="3045480">pos</span>&nbsp;<span class="op" id="3045484">:</span>&nbsp;<span class="ident" id="3045486">pos</span><span class="op" id="3045489">+</span><span class="ident" id="3045490">c</span><span class="op" id="3045491">.</span><span class="ident" id="3045492">size</span><span class="op" id="3045496">]</span><span class="op" id="3045497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045504">pos</span>&nbsp;<span class="op" id="3045508">+=</span>&nbsp;<span class="ident" id="3045511">c</span><span class="op" id="3045512">.</span><span class="ident" id="3045513">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045523">if</span>&nbsp;<span class="ident" id="3045526">j</span>&nbsp;<span class="op" id="3045528">&lt;</span>&nbsp;<span class="builtinfunc" id="3045530">len</span><span class="op" id="3045533">(</span><span class="ident" id="3045534">b</span><span class="op" id="3045535">.</span><span class="ident" id="3045536">widths</span><span class="op" id="3045542">)</span>&nbsp;<span class="op" id="3045544">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045552">b</span><span class="op" id="3045553">.</span><span class="ident" id="3045554">writePadding</span><span class="op" id="3045566">(</span><span class="ident" id="3045567">c</span><span class="op" id="3045568">.</span><span class="ident" id="3045569">width</span><span class="op" id="3045574">,</span>&nbsp;<span class="ident" id="3045576">b</span><span class="op" id="3045577">.</span><span class="ident" id="3045578">widths</span><span class="op" id="3045584">[</span><span class="ident" id="3045585">j</span><span class="op" id="3045586">]</span><span class="op" id="3045587">,</span>&nbsp;<span class="builtintype" id="3045589">false</span><span class="op" id="3045594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045607">}</span>&nbsp;<span class="keyword" id="3045609">else</span>&nbsp;<span class="op" id="3045614">{</span>&nbsp;<span class="comment" id="3045616">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045636">if</span>&nbsp;<span class="ident" id="3045639">j</span>&nbsp;<span class="op" id="3045641">&lt;</span>&nbsp;<span class="builtinfunc" id="3045643">len</span><span class="op" id="3045646">(</span><span class="ident" id="3045647">b</span><span class="op" id="3045648">.</span><span class="ident" id="3045649">widths</span><span class="op" id="3045655">)</span>&nbsp;<span class="op" id="3045657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045665">b</span><span class="op" id="3045666">.</span><span class="ident" id="3045667">writePadding</span><span class="op" id="3045679">(</span><span class="ident" id="3045680">c</span><span class="op" id="3045681">.</span><span class="ident" id="3045682">width</span><span class="op" id="3045687">,</span>&nbsp;<span class="ident" id="3045689">b</span><span class="op" id="3045690">.</span><span class="ident" id="3045691">widths</span><span class="op" id="3045697">[</span><span class="ident" id="3045698">j</span><span class="op" id="3045699">]</span><span class="op" id="3045700">,</span>&nbsp;<span class="builtintype" id="3045702">false</span><span class="op" id="3045707">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045721">b</span><span class="op" id="3045722">.</span><span class="ident" id="3045723">write0</span><span class="op" id="3045729">(</span><span class="ident" id="3045730">b</span><span class="op" id="3045731">.</span><span class="ident" id="3045732">buf</span><span class="op" id="3045735">.</span><span class="ident" id="3045736">Bytes</span><span class="op" id="3045741">(</span><span class="op" id="3045742">)</span><span class="op" id="3045743">[</span><span class="ident" id="3045744">pos</span>&nbsp;<span class="op" id="3045748">:</span>&nbsp;<span class="ident" id="3045750">pos</span><span class="op" id="3045753">+</span><span class="ident" id="3045754">c</span><span class="op" id="3045755">.</span><span class="ident" id="3045756">size</span><span class="op" id="3045760">]</span><span class="op" id="3045761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045768">pos</span>&nbsp;<span class="op" id="3045772">+=</span>&nbsp;<span class="ident" id="3045775">c</span><span class="op" id="3045776">.</span><span class="ident" id="3045777">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045791">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045800">if</span>&nbsp;<span class="ident" id="3045803">i</span><span class="op" id="3045804">+</span><span class="num" id="3045805">1</span>&nbsp;<span class="op" id="3045807">==</span>&nbsp;<span class="builtinfunc" id="3045810">len</span><span class="op" id="3045813">(</span><span class="ident" id="3045814">b</span><span class="op" id="3045815">.</span><span class="ident" id="3045816">lines</span><span class="op" id="3045821">)</span>&nbsp;<span class="op" id="3045823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3045828">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3045894">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045930">b</span><span class="op" id="3045931">.</span><span class="ident" id="3045932">write0</span><span class="op" id="3045938">(</span><span class="ident" id="3045939">b</span><span class="op" id="3045940">.</span><span class="ident" id="3045941">buf</span><span class="op" id="3045944">.</span><span class="ident" id="3045945">Bytes</span><span class="op" id="3045950">(</span><span class="op" id="3045951">)</span><span class="op" id="3045952">[</span><span class="ident" id="3045953">pos</span>&nbsp;<span class="op" id="3045957">:</span>&nbsp;<span class="ident" id="3045959">pos</span><span class="op" id="3045962">+</span><span class="ident" id="3045963">b</span><span class="op" id="3045964">.</span><span class="ident" id="3045965">cell</span><span class="op" id="3045969">.</span><span class="ident" id="3045970">size</span><span class="op" id="3045974">]</span><span class="op" id="3045975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045980">pos</span>&nbsp;<span class="op" id="3045984">+=</span>&nbsp;<span class="ident" id="3045987">b</span><span class="op" id="3045988">.</span><span class="ident" id="3045989">cell</span><span class="op" id="3045993">.</span><span class="ident" id="3045994">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046001">}</span>&nbsp;<span class="keyword" id="3046003">else</span>&nbsp;<span class="op" id="3046008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046013">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046053">b</span><span class="op" id="3046054">.</span><span class="ident" id="3046055">write0</span><span class="op" id="3046061">(</span><span class="ident" id="3046062">newline</span><span class="op" id="3046069">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046079">return</span><br>
<span class="lineno"></span><span class="op" id="3046086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3046089">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="3046155">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="3046222">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3046287">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="3046318">//</span><br>
<span class="lineno">315</span><span class="keyword" id="3046321">func</span>&nbsp;<span class="op" id="3046326">(</span><span class="ident" id="3046327">b</span>&nbsp;<span class="op" id="3046329">*</span><span class="ident" id="3046330">Writer</span><span class="op" id="3046336">)</span>&nbsp;<span class="ident" id="3046338">format</span><span class="op" id="3046344">(</span><span class="ident" id="3046345">pos0</span>&nbsp;<span class="builtintype" id="3046350">int</span><span class="op" id="3046353">,</span>&nbsp;<span class="ident" id="3046355">line0</span><span class="op" id="3046360">,</span>&nbsp;<span class="ident" id="3046362">line1</span>&nbsp;<span class="builtintype" id="3046368">int</span><span class="op" id="3046371">)</span>&nbsp;<span class="op" id="3046373">(</span><span class="ident" id="3046374">pos</span>&nbsp;<span class="builtintype" id="3046378">int</span><span class="op" id="3046381">)</span>&nbsp;<span class="op" id="3046383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046386">pos</span>&nbsp;<span class="op" id="3046390">=</span>&nbsp;<span class="ident" id="3046392">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046398">column</span>&nbsp;<span class="op" id="3046405">:=</span>&nbsp;<span class="builtinfunc" id="3046408">len</span><span class="op" id="3046411">(</span><span class="ident" id="3046412">b</span><span class="op" id="3046413">.</span><span class="ident" id="3046414">widths</span><span class="op" id="3046420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046423">for</span>&nbsp;<span class="ident" id="3046427">this</span>&nbsp;<span class="op" id="3046432">:=</span>&nbsp;<span class="ident" id="3046435">line0</span><span class="op" id="3046440">;</span>&nbsp;<span class="ident" id="3046442">this</span>&nbsp;<span class="op" id="3046447">&lt;</span>&nbsp;<span class="ident" id="3046449">line1</span><span class="op" id="3046454">;</span>&nbsp;<span class="ident" id="3046456">this</span><span class="op" id="3046460">++</span>&nbsp;<span class="op" id="3046463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046467">line</span>&nbsp;<span class="op" id="3046472">:=</span>&nbsp;<span class="ident" id="3046475">b</span><span class="op" id="3046476">.</span><span class="ident" id="3046477">lines</span><span class="op" id="3046482">[</span><span class="ident" id="3046483">this</span><span class="op" id="3046487">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046492">if</span>&nbsp;<span class="ident" id="3046495">column</span>&nbsp;<span class="op" id="3046502">&lt;</span>&nbsp;<span class="builtinfunc" id="3046504">len</span><span class="op" id="3046507">(</span><span class="ident" id="3046508">line</span><span class="op" id="3046512">)</span><span class="op" id="3046513">-</span><span class="num" id="3046514">1</span>&nbsp;<span class="op" id="3046516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046521">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046567">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046611">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046670">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046729">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046788">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046808">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046861">pos</span>&nbsp;<span class="op" id="3046865">=</span>&nbsp;<span class="ident" id="3046867">b</span><span class="op" id="3046868">.</span><span class="ident" id="3046869">writeLines</span><span class="op" id="3046879">(</span><span class="ident" id="3046880">pos</span><span class="op" id="3046883">,</span>&nbsp;<span class="ident" id="3046885">line0</span><span class="op" id="3046890">,</span>&nbsp;<span class="ident" id="3046892">this</span><span class="op" id="3046896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046901">line0</span>&nbsp;<span class="op" id="3046907">=</span>&nbsp;<span class="ident" id="3046909">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3046918">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046943">width</span>&nbsp;<span class="op" id="3046949">:=</span>&nbsp;<span class="ident" id="3046952">b</span><span class="op" id="3046953">.</span><span class="ident" id="3046954">minwidth</span>&nbsp;<span class="comment" id="3046963">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046990">discardable</span>&nbsp;<span class="op" id="3047002">:=</span>&nbsp;<span class="builtintype" id="3047005">true</span>&nbsp;<span class="comment" id="3047010">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047070">for</span>&nbsp;<span class="op" id="3047074">;</span>&nbsp;<span class="ident" id="3047076">this</span>&nbsp;<span class="op" id="3047081">&lt;</span>&nbsp;<span class="ident" id="3047083">line1</span><span class="op" id="3047088">;</span>&nbsp;<span class="ident" id="3047090">this</span><span class="op" id="3047094">++</span>&nbsp;<span class="op" id="3047097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047103">line</span>&nbsp;<span class="op" id="3047108">=</span>&nbsp;<span class="ident" id="3047110">b</span><span class="op" id="3047111">.</span><span class="ident" id="3047112">lines</span><span class="op" id="3047117">[</span><span class="ident" id="3047118">this</span><span class="op" id="3047122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047128">if</span>&nbsp;<span class="ident" id="3047131">column</span>&nbsp;<span class="op" id="3047138">&lt;</span>&nbsp;<span class="builtinfunc" id="3047140">len</span><span class="op" id="3047143">(</span><span class="ident" id="3047144">line</span><span class="op" id="3047148">)</span><span class="op" id="3047149">-</span><span class="num" id="3047150">1</span>&nbsp;<span class="op" id="3047152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047159">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047194">c</span>&nbsp;<span class="op" id="3047196">:=</span>&nbsp;<span class="ident" id="3047199">line</span><span class="op" id="3047203">[</span><span class="ident" id="3047204">column</span><span class="op" id="3047210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047217">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047238">if</span>&nbsp;<span class="ident" id="3047241">w</span>&nbsp;<span class="op" id="3047243">:=</span>&nbsp;<span class="ident" id="3047246">c</span><span class="op" id="3047247">.</span><span class="ident" id="3047248">width</span>&nbsp;<span class="op" id="3047254">+</span>&nbsp;<span class="ident" id="3047256">b</span><span class="op" id="3047257">.</span><span class="ident" id="3047258">padding</span><span class="op" id="3047265">;</span>&nbsp;<span class="ident" id="3047267">w</span>&nbsp;<span class="op" id="3047269">&gt;</span>&nbsp;<span class="ident" id="3047271">width</span>&nbsp;<span class="op" id="3047277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047285">width</span>&nbsp;<span class="op" id="3047291">=</span>&nbsp;<span class="ident" id="3047293">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047300">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047307">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047334">if</span>&nbsp;<span class="ident" id="3047337">c</span><span class="op" id="3047338">.</span><span class="ident" id="3047339">width</span>&nbsp;<span class="op" id="3047345">&gt;</span>&nbsp;<span class="num" id="3047347">0</span>&nbsp;<span class="op" id="3047349">||</span>&nbsp;<span class="ident" id="3047352">c</span><span class="op" id="3047353">.</span><span class="ident" id="3047354">htab</span>&nbsp;<span class="op" id="3047359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047367">discardable</span>&nbsp;<span class="op" id="3047379">=</span>&nbsp;<span class="builtintype" id="3047381">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047398">}</span>&nbsp;<span class="keyword" id="3047400">else</span>&nbsp;<span class="op" id="3047405">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047412">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047432">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047456">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047497">if</span>&nbsp;<span class="ident" id="3047500">discardable</span>&nbsp;<span class="op" id="3047512">&amp;&amp;</span>&nbsp;<span class="ident" id="3047515">b</span><span class="op" id="3047516">.</span><span class="ident" id="3047517">flags</span><span class="op" id="3047522">&amp;</span><span class="ident" id="3047523">DiscardEmptyColumns</span>&nbsp;<span class="op" id="3047543">!=</span>&nbsp;<span class="num" id="3047546">0</span>&nbsp;<span class="op" id="3047548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047554">width</span>&nbsp;<span class="op" id="3047560">=</span>&nbsp;<span class="num" id="3047562">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047573">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047636">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047706">b</span><span class="op" id="3047707">.</span><span class="ident" id="3047708">widths</span>&nbsp;<span class="op" id="3047715">=</span>&nbsp;<span class="builtinfunc" id="3047717">append</span><span class="op" id="3047723">(</span><span class="ident" id="3047724">b</span><span class="op" id="3047725">.</span><span class="ident" id="3047726">widths</span><span class="op" id="3047732">,</span>&nbsp;<span class="ident" id="3047734">width</span><span class="op" id="3047739">)</span>&nbsp;<span class="comment" id="3047741">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047758">pos</span>&nbsp;<span class="op" id="3047762">=</span>&nbsp;<span class="ident" id="3047764">b</span><span class="op" id="3047765">.</span><span class="ident" id="3047766">format</span><span class="op" id="3047772">(</span><span class="ident" id="3047773">pos</span><span class="op" id="3047776">,</span>&nbsp;<span class="ident" id="3047778">line0</span><span class="op" id="3047783">,</span>&nbsp;<span class="ident" id="3047785">this</span><span class="op" id="3047789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047794">b</span><span class="op" id="3047795">.</span><span class="ident" id="3047796">widths</span>&nbsp;<span class="op" id="3047803">=</span>&nbsp;<span class="ident" id="3047805">b</span><span class="op" id="3047806">.</span><span class="ident" id="3047807">widths</span><span class="op" id="3047813">[</span><span class="num" id="3047814">0</span>&nbsp;<span class="op" id="3047816">:</span>&nbsp;<span class="builtinfunc" id="3047818">len</span><span class="op" id="3047821">(</span><span class="ident" id="3047822">b</span><span class="op" id="3047823">.</span><span class="ident" id="3047824">widths</span><span class="op" id="3047830">)</span><span class="op" id="3047831">-</span><span class="num" id="3047832">1</span><span class="op" id="3047833">]</span>&nbsp;<span class="comment" id="3047835">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047851">line0</span>&nbsp;<span class="op" id="3047857">=</span>&nbsp;<span class="ident" id="3047859">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047873">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047909">return</span>&nbsp;<span class="ident" id="3047916">b</span><span class="op" id="3047917">.</span><span class="ident" id="3047918">writeLines</span><span class="op" id="3047928">(</span><span class="ident" id="3047929">pos</span><span class="op" id="3047932">,</span>&nbsp;<span class="ident" id="3047934">line0</span><span class="op" id="3047939">,</span>&nbsp;<span class="ident" id="3047941">line1</span><span class="op" id="3047946">)</span><br>
<span class="lineno"></span><span class="op" id="3047948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3047951">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="3047983">func</span>&nbsp;<span class="op" id="3047988">(</span><span class="ident" id="3047989">b</span>&nbsp;<span class="op" id="3047991">*</span><span class="ident" id="3047992">Writer</span><span class="op" id="3047998">)</span>&nbsp;<span class="builtinfunc" id="3048000">append</span><span class="op" id="3048006">(</span><span class="ident" id="3048007">text</span>&nbsp;<span class="op" id="3048012">[</span><span class="op" id="3048013">]</span><span class="builtintype" id="3048014">byte</span><span class="op" id="3048018">)</span>&nbsp;<span class="op" id="3048020">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048023">b</span><span class="op" id="3048024">.</span><span class="ident" id="3048025">buf</span><span class="op" id="3048028">.</span><span class="ident" id="3048029">Write</span><span class="op" id="3048034">(</span><span class="ident" id="3048035">text</span><span class="op" id="3048039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048042">b</span><span class="op" id="3048043">.</span><span class="ident" id="3048044">cell</span><span class="op" id="3048048">.</span><span class="ident" id="3048049">size</span>&nbsp;<span class="op" id="3048054">+=</span>&nbsp;<span class="builtinfunc" id="3048057">len</span><span class="op" id="3048060">(</span><span class="ident" id="3048061">text</span><span class="op" id="3048065">)</span><br>
<span class="lineno"></span><span class="op" id="3048067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3048070">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="3048096">func</span>&nbsp;<span class="op" id="3048101">(</span><span class="ident" id="3048102">b</span>&nbsp;<span class="op" id="3048104">*</span><span class="ident" id="3048105">Writer</span><span class="op" id="3048111">)</span>&nbsp;<span class="ident" id="3048113">updateWidth</span><span class="op" id="3048124">(</span><span class="op" id="3048125">)</span>&nbsp;<span class="op" id="3048127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048130">b</span><span class="op" id="3048131">.</span><span class="ident" id="3048132">cell</span><span class="op" id="3048136">.</span><span class="ident" id="3048137">width</span>&nbsp;<span class="op" id="3048143">+=</span>&nbsp;<span class="ident" id="3048146">utf8</span><span class="op" id="3048150">.</span><span class="ident" id="3048151">RuneCount</span><span class="op" id="3048160">(</span><span class="ident" id="3048161">b</span><span class="op" id="3048162">.</span><span class="ident" id="3048163">buf</span><span class="op" id="3048166">.</span><span class="ident" id="3048167">Bytes</span><span class="op" id="3048172">(</span><span class="op" id="3048173">)</span><span class="op" id="3048174">[</span><span class="ident" id="3048175">b</span><span class="op" id="3048176">.</span><span class="ident" id="3048177">pos</span><span class="op" id="3048180">:</span><span class="ident" id="3048181">b</span><span class="op" id="3048182">.</span><span class="ident" id="3048183">buf</span><span class="op" id="3048186">.</span><span class="ident" id="3048187">Len</span><span class="op" id="3048190">(</span><span class="op" id="3048191">)</span><span class="op" id="3048192">]</span><span class="op" id="3048193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048196">b</span><span class="op" id="3048197">.</span><span class="ident" id="3048198">pos</span>&nbsp;<span class="op" id="3048202">=</span>&nbsp;<span class="ident" id="3048204">b</span><span class="op" id="3048205">.</span><span class="ident" id="3048206">buf</span><span class="op" id="3048209">.</span><span class="ident" id="3048210">Len</span><span class="op" id="3048213">(</span><span class="op" id="3048214">)</span><br>
<span class="lineno"></span><span class="op" id="3048216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3048219">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="3048283">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3048353">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3048420">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="3048458">//</span><br>
<span class="lineno">390</span><span class="comment" id="3048461">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3048542">//</span><br>
<span class="lineno"></span><span class="keyword" id="3048545">const</span>&nbsp;<span class="ident" id="3048551">Escape</span>&nbsp;<span class="op" id="3048558">=</span>&nbsp;<span class="string" id="3048560">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3048568">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="3048591">func</span>&nbsp;<span class="op" id="3048596">(</span><span class="ident" id="3048597">b</span>&nbsp;<span class="op" id="3048599">*</span><span class="ident" id="3048600">Writer</span><span class="op" id="3048606">)</span>&nbsp;<span class="ident" id="3048608">startEscape</span><span class="op" id="3048619">(</span><span class="ident" id="3048620">ch</span>&nbsp;<span class="builtintype" id="3048623">byte</span><span class="op" id="3048627">)</span>&nbsp;<span class="op" id="3048629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048632">switch</span>&nbsp;<span class="ident" id="3048639">ch</span>&nbsp;<span class="op" id="3048642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048645">case</span>&nbsp;<span class="ident" id="3048650">Escape</span><span class="op" id="3048656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048660">b</span><span class="op" id="3048661">.</span><span class="ident" id="3048662">endChar</span>&nbsp;<span class="op" id="3048670">=</span>&nbsp;<span class="ident" id="3048672">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048680">case</span>&nbsp;<span class="string" id="3048685">&#39;&lt;&#39;</span><span class="op" id="3048688">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048692">b</span><span class="op" id="3048693">.</span><span class="ident" id="3048694">endChar</span>&nbsp;<span class="op" id="3048702">=</span>&nbsp;<span class="string" id="3048704">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048709">case</span>&nbsp;<span class="string" id="3048714">&#39;&amp;&#39;</span><span class="op" id="3048717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048721">b</span><span class="op" id="3048722">.</span><span class="ident" id="3048723">endChar</span>&nbsp;<span class="op" id="3048731">=</span>&nbsp;<span class="string" id="3048733">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048738">}</span><br>
<span class="lineno"></span><span class="op" id="3048740">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3048743">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="3048817">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="3048893">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3048965">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="3048995">//</span><br>
<span class="lineno"></span><span class="keyword" id="3048998">func</span>&nbsp;<span class="op" id="3049003">(</span><span class="ident" id="3049004">b</span>&nbsp;<span class="op" id="3049006">*</span><span class="ident" id="3049007">Writer</span><span class="op" id="3049013">)</span>&nbsp;<span class="ident" id="3049015">endEscape</span><span class="op" id="3049024">(</span><span class="op" id="3049025">)</span>&nbsp;<span class="op" id="3049027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049030">switch</span>&nbsp;<span class="ident" id="3049037">b</span><span class="op" id="3049038">.</span><span class="ident" id="3049039">endChar</span>&nbsp;<span class="op" id="3049047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049050">case</span>&nbsp;<span class="ident" id="3049055">Escape</span><span class="op" id="3049061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049065">b</span><span class="op" id="3049066">.</span><span class="ident" id="3049067">updateWidth</span><span class="op" id="3049078">(</span><span class="op" id="3049079">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049083">if</span>&nbsp;<span class="ident" id="3049086">b</span><span class="op" id="3049087">.</span><span class="ident" id="3049088">flags</span><span class="op" id="3049093">&amp;</span><span class="ident" id="3049094">StripEscape</span>&nbsp;<span class="op" id="3049106">==</span>&nbsp;<span class="num" id="3049109">0</span>&nbsp;<span class="op" id="3049111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049116">b</span><span class="op" id="3049117">.</span><span class="ident" id="3049118">cell</span><span class="op" id="3049122">.</span><span class="ident" id="3049123">width</span>&nbsp;<span class="op" id="3049129">-=</span>&nbsp;<span class="num" id="3049132">2</span>&nbsp;<span class="comment" id="3049134">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049171">case</span>&nbsp;<span class="string" id="3049176">&#39;&gt;&#39;</span><span class="op" id="3049179">:</span>&nbsp;<span class="comment" id="3049181">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049203">case</span>&nbsp;<span class="string" id="3049208">&#39;;&#39;</span><span class="op" id="3049211">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049215">b</span><span class="op" id="3049216">.</span><span class="ident" id="3049217">cell</span><span class="op" id="3049221">.</span><span class="ident" id="3049222">width</span><span class="op" id="3049227">++</span>&nbsp;<span class="comment" id="3049230">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049263">b</span><span class="op" id="3049264">.</span><span class="ident" id="3049265">pos</span>&nbsp;<span class="op" id="3049269">=</span>&nbsp;<span class="ident" id="3049271">b</span><span class="op" id="3049272">.</span><span class="ident" id="3049273">buf</span><span class="op" id="3049276">.</span><span class="ident" id="3049277">Len</span><span class="op" id="3049280">(</span><span class="op" id="3049281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049284">b</span><span class="op" id="3049285">.</span><span class="ident" id="3049286">endChar</span>&nbsp;<span class="op" id="3049294">=</span>&nbsp;<span class="num" id="3049296">0</span><br>
<span class="lineno"></span><span class="op" id="3049298">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="3049301">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3049372">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3049431">//</span><br>
<span class="lineno"></span><span class="keyword" id="3049434">func</span>&nbsp;<span class="op" id="3049439">(</span><span class="ident" id="3049440">b</span>&nbsp;<span class="op" id="3049442">*</span><span class="ident" id="3049443">Writer</span><span class="op" id="3049449">)</span>&nbsp;<span class="ident" id="3049451">terminateCell</span><span class="op" id="3049464">(</span><span class="ident" id="3049465">htab</span>&nbsp;<span class="builtintype" id="3049470">bool</span><span class="op" id="3049474">)</span>&nbsp;<span class="builtintype" id="3049476">int</span>&nbsp;<span class="op" id="3049480">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049483">b</span><span class="op" id="3049484">.</span><span class="ident" id="3049485">cell</span><span class="op" id="3049489">.</span><span class="ident" id="3049490">htab</span>&nbsp;<span class="op" id="3049495">=</span>&nbsp;<span class="ident" id="3049497">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049503">line</span>&nbsp;<span class="op" id="3049508">:=</span>&nbsp;<span class="op" id="3049511">&amp;</span><span class="ident" id="3049512">b</span><span class="op" id="3049513">.</span><span class="ident" id="3049514">lines</span><span class="op" id="3049519">[</span><span class="builtinfunc" id="3049520">len</span><span class="op" id="3049523">(</span><span class="ident" id="3049524">b</span><span class="op" id="3049525">.</span><span class="ident" id="3049526">lines</span><span class="op" id="3049531">)</span><span class="op" id="3049532">-</span><span class="num" id="3049533">1</span><span class="op" id="3049534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049537">*</span><span class="ident" id="3049538">line</span>&nbsp;<span class="op" id="3049543">=</span>&nbsp;<span class="builtinfunc" id="3049545">append</span><span class="op" id="3049551">(</span><span class="op" id="3049552">*</span><span class="ident" id="3049553">line</span><span class="op" id="3049557">,</span>&nbsp;<span class="ident" id="3049559">b</span><span class="op" id="3049560">.</span><span class="ident" id="3049561">cell</span><span class="op" id="3049565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3049568">b</span><span class="op" id="3049569">.</span><span class="ident" id="3049570">cell</span>&nbsp;<span class="op" id="3049575">=</span>&nbsp;<span class="ident" id="3049577">cell</span><span class="op" id="3049581">{</span><span class="op" id="3049582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049585">return</span>&nbsp;<span class="builtinfunc" id="3049592">len</span><span class="op" id="3049595">(</span><span class="op" id="3049596">*</span><span class="ident" id="3049597">line</span><span class="op" id="3049601">)</span><br>
<span class="lineno">435</span><span class="op" id="3049603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3049606">func</span>&nbsp;<span class="ident" id="3049611">handlePanic</span><span class="op" id="3049622">(</span><span class="ident" id="3049623">err</span>&nbsp;<span class="op" id="3049627">*</span><span class="builtintype" id="3049628">error</span><span class="op" id="3049633">,</span>&nbsp;<span class="ident" id="3049635">op</span>&nbsp;<span class="builtintype" id="3049638">string</span><span class="op" id="3049644">)</span>&nbsp;<span class="op" id="3049646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049649">if</span>&nbsp;<span class="ident" id="3049652">e</span>&nbsp;<span class="op" id="3049654">:=</span>&nbsp;<span class="builtinfunc" id="3049657">recover</span><span class="op" id="3049664">(</span><span class="op" id="3049665">)</span><span class="op" id="3049666">;</span>&nbsp;<span class="ident" id="3049668">e</span>&nbsp;<span class="op" id="3049670">!=</span>&nbsp;<span class="ident" id="3049673">nil</span>&nbsp;<span class="op" id="3049677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049681">if</span>&nbsp;<span class="ident" id="3049684">nerr</span><span class="op" id="3049688">,</span>&nbsp;<span class="ident" id="3049690">ok</span>&nbsp;<span class="op" id="3049693">:=</span>&nbsp;<span class="ident" id="3049696">e</span><span class="op" id="3049697">.</span><span class="op" id="3049698">(</span><span class="ident" id="3049699">osError</span><span class="op" id="3049706">)</span><span class="op" id="3049707">;</span>&nbsp;<span class="ident" id="3049709">ok</span>&nbsp;<span class="op" id="3049712">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049717">*</span><span class="ident" id="3049718">err</span>&nbsp;<span class="op" id="3049722">=</span>&nbsp;<span class="ident" id="3049724">nerr</span><span class="op" id="3049728">.</span><span class="ident" id="3049729">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3049749">panic</span><span class="op" id="3049754">(</span><span class="string" id="3049755">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="3049782">+</span>&nbsp;<span class="ident" id="3049784">op</span><span class="op" id="3049786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049789">}</span><br>
<span class="lineno">445</span><span class="op" id="3049791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3049794">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="3049859">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="3049925">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="3049980">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="3050017">//</span><br>
<span class="lineno"></span><span class="keyword" id="3050020">func</span>&nbsp;<span class="op" id="3050025">(</span><span class="ident" id="3050026">b</span>&nbsp;<span class="op" id="3050028">*</span><span class="ident" id="3050029">Writer</span><span class="op" id="3050035">)</span>&nbsp;<span class="ident" id="3050037">Flush</span><span class="op" id="3050042">(</span><span class="op" id="3050043">)</span>&nbsp;<span class="op" id="3050045">(</span><span class="ident" id="3050046">err</span>&nbsp;<span class="builtintype" id="3050050">error</span><span class="op" id="3050055">)</span>&nbsp;<span class="op" id="3050057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050060">defer</span>&nbsp;<span class="ident" id="3050066">b</span><span class="op" id="3050067">.</span><span class="ident" id="3050068">reset</span><span class="op" id="3050073">(</span><span class="op" id="3050074">)</span>&nbsp;<span class="comment" id="3050076">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050111">defer</span>&nbsp;<span class="ident" id="3050117">handlePanic</span><span class="op" id="3050128">(</span><span class="op" id="3050129">&amp;</span><span class="ident" id="3050130">err</span><span class="op" id="3050133">,</span>&nbsp;<span class="string" id="3050135">&#34;Flush&#34;</span><span class="op" id="3050142">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050146">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050180">if</span>&nbsp;<span class="ident" id="3050183">b</span><span class="op" id="3050184">.</span><span class="ident" id="3050185">cell</span><span class="op" id="3050189">.</span><span class="ident" id="3050190">size</span>&nbsp;<span class="op" id="3050195">&gt;</span>&nbsp;<span class="num" id="3050197">0</span>&nbsp;<span class="op" id="3050199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050203">if</span>&nbsp;<span class="ident" id="3050206">b</span><span class="op" id="3050207">.</span><span class="ident" id="3050208">endChar</span>&nbsp;<span class="op" id="3050216">!=</span>&nbsp;<span class="num" id="3050219">0</span>&nbsp;<span class="op" id="3050221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050226">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050280">b</span><span class="op" id="3050281">.</span><span class="ident" id="3050282">endEscape</span><span class="op" id="3050291">(</span><span class="op" id="3050292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050300">b</span><span class="op" id="3050301">.</span><span class="ident" id="3050302">terminateCell</span><span class="op" id="3050315">(</span><span class="builtintype" id="3050316">false</span><span class="op" id="3050321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050328">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050358">b</span><span class="op" id="3050359">.</span><span class="ident" id="3050360">format</span><span class="op" id="3050366">(</span><span class="num" id="3050367">0</span><span class="op" id="3050368">,</span>&nbsp;<span class="num" id="3050370">0</span><span class="op" id="3050371">,</span>&nbsp;<span class="builtinfunc" id="3050373">len</span><span class="op" id="3050376">(</span><span class="ident" id="3050377">b</span><span class="op" id="3050378">.</span><span class="ident" id="3050379">lines</span><span class="op" id="3050384">)</span><span class="op" id="3050385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050389">return</span><br>
<span class="lineno"></span><span class="op" id="3050396">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="3050399">var</span>&nbsp;<span class="ident" id="3050403">hbar</span>&nbsp;<span class="op" id="3050408">=</span>&nbsp;<span class="op" id="3050410">[</span><span class="op" id="3050411">]</span><span class="builtintype" id="3050412">byte</span><span class="op" id="3050416">(</span><span class="string" id="3050417">&#34;---\n&#34;</span><span class="op" id="3050424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3050427">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3050464">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="3050513">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="3050563">//</span><br>
<span class="lineno"></span><span class="keyword" id="3050566">func</span>&nbsp;<span class="op" id="3050571">(</span><span class="ident" id="3050572">b</span>&nbsp;<span class="op" id="3050574">*</span><span class="ident" id="3050575">Writer</span><span class="op" id="3050581">)</span>&nbsp;<span class="ident" id="3050583">Write</span><span class="op" id="3050588">(</span><span class="ident" id="3050589">buf</span>&nbsp;<span class="op" id="3050593">[</span><span class="op" id="3050594">]</span><span class="builtintype" id="3050595">byte</span><span class="op" id="3050599">)</span>&nbsp;<span class="op" id="3050601">(</span><span class="ident" id="3050602">n</span>&nbsp;<span class="builtintype" id="3050604">int</span><span class="op" id="3050607">,</span>&nbsp;<span class="ident" id="3050609">err</span>&nbsp;<span class="builtintype" id="3050613">error</span><span class="op" id="3050618">)</span>&nbsp;<span class="op" id="3050620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050623">defer</span>&nbsp;<span class="ident" id="3050629">handlePanic</span><span class="op" id="3050640">(</span><span class="op" id="3050641">&amp;</span><span class="ident" id="3050642">err</span><span class="op" id="3050645">,</span>&nbsp;<span class="string" id="3050647">&#34;Write&#34;</span><span class="op" id="3050654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050658">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050684">n</span>&nbsp;<span class="op" id="3050686">=</span>&nbsp;<span class="num" id="3050688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050691">for</span>&nbsp;<span class="ident" id="3050695">i</span><span class="op" id="3050696">,</span>&nbsp;<span class="ident" id="3050698">ch</span>&nbsp;<span class="op" id="3050701">:=</span>&nbsp;<span class="keyword" id="3050704">range</span>&nbsp;<span class="ident" id="3050710">buf</span>&nbsp;<span class="op" id="3050714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050718">if</span>&nbsp;<span class="ident" id="3050721">b</span><span class="op" id="3050722">.</span><span class="ident" id="3050723">endChar</span>&nbsp;<span class="op" id="3050731">==</span>&nbsp;<span class="num" id="3050734">0</span>&nbsp;<span class="op" id="3050736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050741">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050762">switch</span>&nbsp;<span class="ident" id="3050769">ch</span>&nbsp;<span class="op" id="3050772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050777">case</span>&nbsp;<span class="string" id="3050782">&#39;\t&#39;</span><span class="op" id="3050786">,</span>&nbsp;<span class="string" id="3050788">&#39;\v&#39;</span><span class="op" id="3050792">,</span>&nbsp;<span class="string" id="3050794">&#39;\n&#39;</span><span class="op" id="3050798">,</span>&nbsp;<span class="string" id="3050800">&#39;\f&#39;</span><span class="op" id="3050804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050810">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050829">b</span><span class="op" id="3050830">.</span><span class="builtinfunc" id="3050831">append</span><span class="op" id="3050837">(</span><span class="ident" id="3050838">buf</span><span class="op" id="3050841">[</span><span class="ident" id="3050842">n</span><span class="op" id="3050843">:</span><span class="ident" id="3050844">i</span><span class="op" id="3050845">]</span><span class="op" id="3050846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050852">b</span><span class="op" id="3050853">.</span><span class="ident" id="3050854">updateWidth</span><span class="op" id="3050865">(</span><span class="op" id="3050866">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050872">n</span>&nbsp;<span class="op" id="3050874">=</span>&nbsp;<span class="ident" id="3050876">i</span>&nbsp;<span class="op" id="3050878">+</span>&nbsp;<span class="num" id="3050880">1</span>&nbsp;<span class="comment" id="3050882">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050901">ncells</span>&nbsp;<span class="op" id="3050908">:=</span>&nbsp;<span class="ident" id="3050911">b</span><span class="op" id="3050912">.</span><span class="ident" id="3050913">terminateCell</span><span class="op" id="3050926">(</span><span class="ident" id="3050927">ch</span>&nbsp;<span class="op" id="3050930">==</span>&nbsp;<span class="string" id="3050933">&#39;\t&#39;</span><span class="op" id="3050937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050943">if</span>&nbsp;<span class="ident" id="3050946">ch</span>&nbsp;<span class="op" id="3050949">==</span>&nbsp;<span class="string" id="3050952">&#39;\n&#39;</span>&nbsp;<span class="op" id="3050957">||</span>&nbsp;<span class="ident" id="3050960">ch</span>&nbsp;<span class="op" id="3050963">==</span>&nbsp;<span class="string" id="3050966">&#39;\f&#39;</span>&nbsp;<span class="op" id="3050971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3050978">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051001">b</span><span class="op" id="3051002">.</span><span class="ident" id="3051003">addLine</span><span class="op" id="3051010">(</span><span class="op" id="3051011">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051018">if</span>&nbsp;<span class="ident" id="3051021">ch</span>&nbsp;<span class="op" id="3051024">==</span>&nbsp;<span class="string" id="3051027">&#39;\f&#39;</span>&nbsp;<span class="op" id="3051032">||</span>&nbsp;<span class="ident" id="3051035">ncells</span>&nbsp;<span class="op" id="3051042">==</span>&nbsp;<span class="num" id="3051045">1</span>&nbsp;<span class="op" id="3051047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051055">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051121">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051186">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051252">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051313">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051339">if</span>&nbsp;<span class="ident" id="3051342">err</span>&nbsp;<span class="op" id="3051346">=</span>&nbsp;<span class="ident" id="3051348">b</span><span class="op" id="3051349">.</span><span class="ident" id="3051350">Flush</span><span class="op" id="3051355">(</span><span class="op" id="3051356">)</span><span class="op" id="3051357">;</span>&nbsp;<span class="ident" id="3051359">err</span>&nbsp;<span class="op" id="3051363">!=</span>&nbsp;<span class="ident" id="3051366">nil</span>&nbsp;<span class="op" id="3051370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051379">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051400">if</span>&nbsp;<span class="ident" id="3051403">ch</span>&nbsp;<span class="op" id="3051406">==</span>&nbsp;<span class="string" id="3051409">&#39;\f&#39;</span>&nbsp;<span class="op" id="3051414">&amp;&amp;</span>&nbsp;<span class="ident" id="3051417">b</span><span class="op" id="3051418">.</span><span class="ident" id="3051419">flags</span><span class="op" id="3051424">&amp;</span><span class="ident" id="3051425">Debug</span>&nbsp;<span class="op" id="3051431">!=</span>&nbsp;<span class="num" id="3051434">0</span>&nbsp;<span class="op" id="3051436">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051445">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051478">b</span><span class="op" id="3051479">.</span><span class="ident" id="3051480">write0</span><span class="op" id="3051486">(</span><span class="ident" id="3051487">hbar</span><span class="op" id="3051491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051512">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051518">case</span>&nbsp;<span class="ident" id="3051523">Escape</span><span class="op" id="3051529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051535">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051568">b</span><span class="op" id="3051569">.</span><span class="builtinfunc" id="3051570">append</span><span class="op" id="3051576">(</span><span class="ident" id="3051577">buf</span><span class="op" id="3051580">[</span><span class="ident" id="3051581">n</span><span class="op" id="3051582">:</span><span class="ident" id="3051583">i</span><span class="op" id="3051584">]</span><span class="op" id="3051585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051591">b</span><span class="op" id="3051592">.</span><span class="ident" id="3051593">updateWidth</span><span class="op" id="3051604">(</span><span class="op" id="3051605">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051611">n</span>&nbsp;<span class="op" id="3051613">=</span>&nbsp;<span class="ident" id="3051615">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051621">if</span>&nbsp;<span class="ident" id="3051624">b</span><span class="op" id="3051625">.</span><span class="ident" id="3051626">flags</span><span class="op" id="3051631">&amp;</span><span class="ident" id="3051632">StripEscape</span>&nbsp;<span class="op" id="3051644">!=</span>&nbsp;<span class="num" id="3051647">0</span>&nbsp;<span class="op" id="3051649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051656">n</span><span class="op" id="3051657">++</span>&nbsp;<span class="comment" id="3051660">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051686">b</span><span class="op" id="3051687">.</span><span class="ident" id="3051688">startEscape</span><span class="op" id="3051699">(</span><span class="ident" id="3051700">Escape</span><span class="op" id="3051706">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051712">case</span>&nbsp;<span class="string" id="3051717">&#39;&lt;&#39;</span><span class="op" id="3051720">,</span>&nbsp;<span class="string" id="3051722">&#39;&amp;&#39;</span><span class="op" id="3051725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051731">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051766">if</span>&nbsp;<span class="ident" id="3051769">b</span><span class="op" id="3051770">.</span><span class="ident" id="3051771">flags</span><span class="op" id="3051776">&amp;</span><span class="ident" id="3051777">FilterHTML</span>&nbsp;<span class="op" id="3051788">!=</span>&nbsp;<span class="num" id="3051791">0</span>&nbsp;<span class="op" id="3051793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051800">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051828">b</span><span class="op" id="3051829">.</span><span class="builtinfunc" id="3051830">append</span><span class="op" id="3051836">(</span><span class="ident" id="3051837">buf</span><span class="op" id="3051840">[</span><span class="ident" id="3051841">n</span><span class="op" id="3051842">:</span><span class="ident" id="3051843">i</span><span class="op" id="3051844">]</span><span class="op" id="3051845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051852">b</span><span class="op" id="3051853">.</span><span class="ident" id="3051854">updateWidth</span><span class="op" id="3051865">(</span><span class="op" id="3051866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051873">n</span>&nbsp;<span class="op" id="3051875">=</span>&nbsp;<span class="ident" id="3051877">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051884">b</span><span class="op" id="3051885">.</span><span class="ident" id="3051886">startEscape</span><span class="op" id="3051897">(</span><span class="ident" id="3051898">ch</span><span class="op" id="3051900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051906">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051916">}</span>&nbsp;<span class="keyword" id="3051918">else</span>&nbsp;<span class="op" id="3051923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051928">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051948">if</span>&nbsp;<span class="ident" id="3051951">ch</span>&nbsp;<span class="op" id="3051954">==</span>&nbsp;<span class="ident" id="3051957">b</span><span class="op" id="3051958">.</span><span class="ident" id="3051959">endChar</span>&nbsp;<span class="op" id="3051967">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3051973">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051998">j</span>&nbsp;<span class="op" id="3052000">:=</span>&nbsp;<span class="ident" id="3052003">i</span>&nbsp;<span class="op" id="3052005">+</span>&nbsp;<span class="num" id="3052007">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052013">if</span>&nbsp;<span class="ident" id="3052016">ch</span>&nbsp;<span class="op" id="3052019">==</span>&nbsp;<span class="ident" id="3052022">Escape</span>&nbsp;<span class="op" id="3052029">&amp;&amp;</span>&nbsp;<span class="ident" id="3052032">b</span><span class="op" id="3052033">.</span><span class="ident" id="3052034">flags</span><span class="op" id="3052039">&amp;</span><span class="ident" id="3052040">StripEscape</span>&nbsp;<span class="op" id="3052052">!=</span>&nbsp;<span class="num" id="3052055">0</span>&nbsp;<span class="op" id="3052057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052064">j</span>&nbsp;<span class="op" id="3052066">=</span>&nbsp;<span class="ident" id="3052068">i</span>&nbsp;<span class="comment" id="3052070">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052090">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052096">b</span><span class="op" id="3052097">.</span><span class="builtinfunc" id="3052098">append</span><span class="op" id="3052104">(</span><span class="ident" id="3052105">buf</span><span class="op" id="3052108">[</span><span class="ident" id="3052109">n</span><span class="op" id="3052110">:</span><span class="ident" id="3052111">j</span><span class="op" id="3052112">]</span><span class="op" id="3052113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052119">n</span>&nbsp;<span class="op" id="3052121">=</span>&nbsp;<span class="ident" id="3052123">i</span>&nbsp;<span class="op" id="3052125">+</span>&nbsp;<span class="num" id="3052127">1</span>&nbsp;<span class="comment" id="3052129">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052148">b</span><span class="op" id="3052149">.</span><span class="ident" id="3052150">endEscape</span><span class="op" id="3052159">(</span><span class="op" id="3052160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052169">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3052176">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052201">b</span><span class="op" id="3052202">.</span><span class="builtinfunc" id="3052203">append</span><span class="op" id="3052209">(</span><span class="ident" id="3052210">buf</span><span class="op" id="3052213">[</span><span class="ident" id="3052214">n</span><span class="op" id="3052215">:</span><span class="op" id="3052216">]</span><span class="op" id="3052217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052220">n</span>&nbsp;<span class="op" id="3052222">=</span>&nbsp;<span class="builtinfunc" id="3052224">len</span><span class="op" id="3052227">(</span><span class="ident" id="3052228">buf</span><span class="op" id="3052231">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052234">return</span><br>
<span class="lineno"></span><span class="op" id="3052241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3052244">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="3052307">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="3052364">//</span><br>
<span class="lineno"></span><span class="keyword" id="3052367">func</span>&nbsp;<span class="ident" id="3052372">NewWriter</span><span class="op" id="3052381">(</span><span class="ident" id="3052382">output</span>&nbsp;<span class="ident" id="3052389">io</span><span class="op" id="3052391">.</span><span class="ident" id="3052392">Writer</span><span class="op" id="3052398">,</span>&nbsp;<span class="ident" id="3052400">minwidth</span><span class="op" id="3052408">,</span>&nbsp;<span class="ident" id="3052410">tabwidth</span><span class="op" id="3052418">,</span>&nbsp;<span class="ident" id="3052420">padding</span>&nbsp;<span class="builtintype" id="3052428">int</span><span class="op" id="3052431">,</span>&nbsp;<span class="ident" id="3052433">padchar</span>&nbsp;<span class="builtintype" id="3052441">byte</span><span class="op" id="3052445">,</span>&nbsp;<span class="ident" id="3052447">flags</span>&nbsp;<span class="builtintype" id="3052453">uint</span><span class="op" id="3052457">)</span>&nbsp;<span class="op" id="3052459">*</span><span class="ident" id="3052460">Writer</span>&nbsp;<span class="op" id="3052467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052470">return</span>&nbsp;<span class="builtinfunc" id="3052477">new</span><span class="op" id="3052480">(</span><span class="ident" id="3052481">Writer</span><span class="op" id="3052487">)</span><span class="op" id="3052488">.</span><span class="ident" id="3052489">Init</span><span class="op" id="3052493">(</span><span class="ident" id="3052494">output</span><span class="op" id="3052500">,</span>&nbsp;<span class="ident" id="3052502">minwidth</span><span class="op" id="3052510">,</span>&nbsp;<span class="ident" id="3052512">tabwidth</span><span class="op" id="3052520">,</span>&nbsp;<span class="ident" id="3052522">padding</span><span class="op" id="3052529">,</span>&nbsp;<span class="ident" id="3052531">padchar</span><span class="op" id="3052538">,</span>&nbsp;<span class="ident" id="3052540">flags</span><span class="op" id="3052545">)</span><br>
<span class="lineno"></span><span class="op" id="3052547">}</span>
</div>
</body>
</html>
