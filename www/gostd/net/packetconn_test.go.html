<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8278762">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8278818">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8278872">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8278923">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="8279002">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8279011">package</span>&nbsp;<span class="ident" id="8279019">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8279024">import</span>&nbsp;<span class="op" id="8279031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279034">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279040">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279051">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279062">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279073">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8279080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8279083">func</span>&nbsp;<span class="ident" id="8279088">packetConnTestData</span><span class="op" id="8279106">(</span><span class="ident" id="8279107">t</span>&nbsp;<span class="op" id="8279109">*</span><span class="ident" id="8279110">testing</span><span class="op" id="8279117">.</span><span class="ident" id="8279118">T</span><span class="op" id="8279119">,</span>&nbsp;<span class="ident" id="8279121">net</span>&nbsp;<span class="builtintype" id="8279125">string</span><span class="op" id="8279131">,</span>&nbsp;<span class="ident" id="8279133">i</span>&nbsp;<span class="builtintype" id="8279135">int</span><span class="op" id="8279138">)</span>&nbsp;<span class="op" id="8279140">(</span><span class="op" id="8279141">[</span><span class="op" id="8279142">]</span><span class="builtintype" id="8279143">byte</span><span class="op" id="8279147">,</span>&nbsp;<span class="keyword" id="8279149">func</span><span class="op" id="8279153">(</span><span class="op" id="8279154">)</span><span class="op" id="8279155">)</span>&nbsp;<span class="op" id="8279157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279160">switch</span>&nbsp;<span class="ident" id="8279167">net</span>&nbsp;<span class="op" id="8279171">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279174">case</span>&nbsp;<span class="string" id="8279179">&#34;udp&#34;</span><span class="op" id="8279184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279188">return</span>&nbsp;<span class="op" id="8279195">[</span><span class="op" id="8279196">]</span><span class="builtintype" id="8279197">byte</span><span class="op" id="8279201">(</span><span class="string" id="8279202">&#34;UDP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="8279223">)</span><span class="op" id="8279224">,</span>&nbsp;<span class="ident" id="8279226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279231">case</span>&nbsp;<span class="string" id="8279236">&#34;ip&#34;</span><span class="op" id="8279240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279244">if</span>&nbsp;<span class="ident" id="8279247">skip</span><span class="op" id="8279251">,</span>&nbsp;<span class="ident" id="8279253">skipmsg</span>&nbsp;<span class="op" id="8279261">:=</span>&nbsp;<span class="ident" id="8279264">skipRawSocketTest</span><span class="op" id="8279281">(</span><span class="ident" id="8279282">t</span><span class="op" id="8279283">)</span><span class="op" id="8279284">;</span>&nbsp;<span class="ident" id="8279286">skip</span>&nbsp;<span class="op" id="8279291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279296">return</span>&nbsp;<span class="ident" id="8279303">nil</span><span class="op" id="8279306">,</span>&nbsp;<span class="keyword" id="8279308">func</span><span class="op" id="8279312">(</span><span class="op" id="8279313">)</span>&nbsp;<span class="op" id="8279315">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279321">t</span><span class="op" id="8279322">.</span><span class="ident" id="8279323">Logf</span><span class="op" id="8279327">(</span><span class="ident" id="8279328">skipmsg</span><span class="op" id="8279335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279348">b</span><span class="op" id="8279349">,</span>&nbsp;<span class="ident" id="8279351">err</span>&nbsp;<span class="op" id="8279355">:=</span>&nbsp;<span class="op" id="8279358">(</span><span class="op" id="8279359">&amp;</span><span class="ident" id="8279360">icmpMessage</span><span class="op" id="8279371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279376">Type</span><span class="op" id="8279380">:</span>&nbsp;<span class="ident" id="8279382">icmpv4EchoRequest</span><span class="op" id="8279399">,</span>&nbsp;<span class="ident" id="8279401">Code</span><span class="op" id="8279405">:</span>&nbsp;<span class="num" id="8279407">0</span><span class="op" id="8279408">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279413">Body</span><span class="op" id="8279417">:</span>&nbsp;<span class="op" id="8279419">&amp;</span><span class="ident" id="8279420">icmpEcho</span><span class="op" id="8279428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279434">ID</span><span class="op" id="8279436">:</span>&nbsp;<span class="ident" id="8279438">os</span><span class="op" id="8279440">.</span><span class="ident" id="8279441">Getpid</span><span class="op" id="8279447">(</span><span class="op" id="8279448">)</span>&nbsp;<span class="op" id="8279450">&amp;</span>&nbsp;<span class="num" id="8279452">0xffff</span><span class="op" id="8279458">,</span>&nbsp;<span class="ident" id="8279460">Seq</span><span class="op" id="8279463">:</span>&nbsp;<span class="ident" id="8279465">i</span>&nbsp;<span class="op" id="8279467">+</span>&nbsp;<span class="num" id="8279469">1</span><span class="op" id="8279470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279476">Data</span><span class="op" id="8279480">:</span>&nbsp;<span class="op" id="8279482">[</span><span class="op" id="8279483">]</span><span class="builtintype" id="8279484">byte</span><span class="op" id="8279488">(</span><span class="string" id="8279489">&#34;IP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="8279509">)</span><span class="op" id="8279510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279515">}</span><span class="op" id="8279516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279520">}</span><span class="op" id="8279521">)</span><span class="op" id="8279522">.</span><span class="ident" id="8279523">Marshal</span><span class="op" id="8279530">(</span><span class="op" id="8279531">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279535">if</span>&nbsp;<span class="ident" id="8279538">err</span>&nbsp;<span class="op" id="8279542">!=</span>&nbsp;<span class="ident" id="8279545">nil</span>&nbsp;<span class="op" id="8279549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279554">return</span>&nbsp;<span class="ident" id="8279561">nil</span><span class="op" id="8279564">,</span>&nbsp;<span class="keyword" id="8279566">func</span><span class="op" id="8279570">(</span><span class="op" id="8279571">)</span>&nbsp;<span class="op" id="8279573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279579">t</span><span class="op" id="8279580">.</span><span class="ident" id="8279581">Fatalf</span><span class="op" id="8279587">(</span><span class="string" id="8279588">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8279620">,</span>&nbsp;<span class="ident" id="8279622">err</span><span class="op" id="8279625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279634">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279638">return</span>&nbsp;<span class="ident" id="8279645">b</span><span class="op" id="8279646">,</span>&nbsp;<span class="ident" id="8279648">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279653">case</span>&nbsp;<span class="string" id="8279658">&#34;unixgram&#34;</span><span class="op" id="8279668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279672">switch</span>&nbsp;<span class="ident" id="8279679">runtime</span><span class="op" id="8279686">.</span><span class="ident" id="8279687">GOOS</span>&nbsp;<span class="op" id="8279692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279696">case</span>&nbsp;<span class="string" id="8279701">&#34;nacl&#34;</span><span class="op" id="8279707">,</span>&nbsp;<span class="string" id="8279709">&#34;plan9&#34;</span><span class="op" id="8279716">,</span>&nbsp;<span class="string" id="8279718">&#34;windows&#34;</span><span class="op" id="8279727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279732">return</span>&nbsp;<span class="ident" id="8279739">nil</span><span class="op" id="8279742">,</span>&nbsp;<span class="keyword" id="8279744">func</span><span class="op" id="8279748">(</span><span class="op" id="8279749">)</span>&nbsp;<span class="op" id="8279751">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279757">t</span><span class="op" id="8279758">.</span><span class="ident" id="8279759">Logf</span><span class="op" id="8279763">(</span><span class="string" id="8279764">&#34;skipping&nbsp;%q&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8279788">,</span>&nbsp;<span class="ident" id="8279790">net</span><span class="op" id="8279793">,</span>&nbsp;<span class="ident" id="8279795">runtime</span><span class="op" id="8279802">.</span><span class="ident" id="8279803">GOOS</span><span class="op" id="8279807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279816">default</span><span class="op" id="8279823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279828">return</span>&nbsp;<span class="op" id="8279835">[</span><span class="op" id="8279836">]</span><span class="builtintype" id="8279837">byte</span><span class="op" id="8279841">(</span><span class="string" id="8279842">&#34;UNIXGRAM&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="8279868">)</span><span class="op" id="8279869">,</span>&nbsp;<span class="ident" id="8279871">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279877">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279880">default</span><span class="op" id="8279887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279891">return</span>&nbsp;<span class="ident" id="8279898">nil</span><span class="op" id="8279901">,</span>&nbsp;<span class="keyword" id="8279903">func</span><span class="op" id="8279907">(</span><span class="op" id="8279908">)</span>&nbsp;<span class="op" id="8279910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279915">t</span><span class="op" id="8279916">.</span><span class="ident" id="8279917">Logf</span><span class="op" id="8279921">(</span><span class="string" id="8279922">&#34;skipping&nbsp;%q&nbsp;test&#34;</span><span class="op" id="8279940">,</span>&nbsp;<span class="ident" id="8279942">net</span><span class="op" id="8279945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279952">}</span><br>
<span class="lineno">55</span><span class="op" id="8279954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8279957">var</span>&nbsp;<span class="ident" id="8279961">packetConnTests</span>&nbsp;<span class="op" id="8279977">=</span>&nbsp;<span class="op" id="8279979">[</span><span class="op" id="8279980">]</span><span class="keyword" id="8279981">struct</span>&nbsp;<span class="op" id="8279988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279991">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8279997">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280005">addr1</span>&nbsp;<span class="builtintype" id="8280011">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280019">addr2</span>&nbsp;<span class="builtintype" id="8280025">string</span><br>
<span class="lineno"></span><span class="op" id="8280032">}</span><span class="op" id="8280033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280036">{</span><span class="string" id="8280037">&#34;udp&#34;</span><span class="op" id="8280042">,</span>&nbsp;<span class="string" id="8280044">&#34;127.0.0.1:0&#34;</span><span class="op" id="8280057">,</span>&nbsp;<span class="string" id="8280059">&#34;127.0.0.1:0&#34;</span><span class="op" id="8280072">}</span><span class="op" id="8280073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280076">{</span><span class="string" id="8280077">&#34;ip:icmp&#34;</span><span class="op" id="8280086">,</span>&nbsp;<span class="string" id="8280088">&#34;127.0.0.1&#34;</span><span class="op" id="8280099">,</span>&nbsp;<span class="string" id="8280101">&#34;127.0.0.1&#34;</span><span class="op" id="8280112">}</span><span class="op" id="8280113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280116">{</span><span class="string" id="8280117">&#34;unixgram&#34;</span><span class="op" id="8280127">,</span>&nbsp;<span class="ident" id="8280129">testUnixAddr</span><span class="op" id="8280141">(</span><span class="op" id="8280142">)</span><span class="op" id="8280143">,</span>&nbsp;<span class="ident" id="8280145">testUnixAddr</span><span class="op" id="8280157">(</span><span class="op" id="8280158">)</span><span class="op" id="8280159">}</span><span class="op" id="8280160">,</span><br>
<span class="lineno">65</span><span class="op" id="8280162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8280165">func</span>&nbsp;<span class="ident" id="8280170">TestPacketConn</span><span class="op" id="8280184">(</span><span class="ident" id="8280185">t</span>&nbsp;<span class="op" id="8280187">*</span><span class="ident" id="8280188">testing</span><span class="op" id="8280195">.</span><span class="ident" id="8280196">T</span><span class="op" id="8280197">)</span>&nbsp;<span class="op" id="8280199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280202">closer</span>&nbsp;<span class="op" id="8280209">:=</span>&nbsp;<span class="keyword" id="8280212">func</span><span class="op" id="8280216">(</span><span class="ident" id="8280217">c</span>&nbsp;<span class="ident" id="8280219">PacketConn</span><span class="op" id="8280229">,</span>&nbsp;<span class="ident" id="8280231">net</span><span class="op" id="8280234">,</span>&nbsp;<span class="ident" id="8280236">addr1</span><span class="op" id="8280241">,</span>&nbsp;<span class="ident" id="8280243">addr2</span>&nbsp;<span class="builtintype" id="8280249">string</span><span class="op" id="8280255">)</span>&nbsp;<span class="op" id="8280257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280261">c</span><span class="op" id="8280262">.</span><span class="ident" id="8280263">Close</span><span class="op" id="8280268">(</span><span class="op" id="8280269">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280273">switch</span>&nbsp;<span class="ident" id="8280280">net</span>&nbsp;<span class="op" id="8280284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280288">case</span>&nbsp;<span class="string" id="8280293">&#34;unixgram&#34;</span><span class="op" id="8280303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280308">os</span><span class="op" id="8280310">.</span><span class="ident" id="8280311">Remove</span><span class="op" id="8280317">(</span><span class="ident" id="8280318">addr1</span><span class="op" id="8280323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280328">os</span><span class="op" id="8280330">.</span><span class="ident" id="8280331">Remove</span><span class="op" id="8280337">(</span><span class="ident" id="8280338">addr2</span><span class="op" id="8280343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280347">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280354">for</span>&nbsp;<span class="ident" id="8280358">i</span><span class="op" id="8280359">,</span>&nbsp;<span class="ident" id="8280361">tt</span>&nbsp;<span class="op" id="8280364">:=</span>&nbsp;<span class="keyword" id="8280367">range</span>&nbsp;<span class="ident" id="8280373">packetConnTests</span>&nbsp;<span class="op" id="8280389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280393">netstr</span>&nbsp;<span class="op" id="8280400">:=</span>&nbsp;<span class="ident" id="8280403">strings</span><span class="op" id="8280410">.</span><span class="ident" id="8280411">Split</span><span class="op" id="8280416">(</span><span class="ident" id="8280417">tt</span><span class="op" id="8280419">.</span><span class="ident" id="8280420">net</span><span class="op" id="8280423">,</span>&nbsp;<span class="string" id="8280425">&#34;:&#34;</span><span class="op" id="8280428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280432">wb</span><span class="op" id="8280434">,</span>&nbsp;<span class="ident" id="8280436">skipOrFatalFn</span>&nbsp;<span class="op" id="8280450">:=</span>&nbsp;<span class="ident" id="8280453">packetConnTestData</span><span class="op" id="8280471">(</span><span class="ident" id="8280472">t</span><span class="op" id="8280473">,</span>&nbsp;<span class="ident" id="8280475">netstr</span><span class="op" id="8280481">[</span><span class="num" id="8280482">0</span><span class="op" id="8280483">]</span><span class="op" id="8280484">,</span>&nbsp;<span class="ident" id="8280486">i</span><span class="op" id="8280487">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280491">if</span>&nbsp;<span class="ident" id="8280494">skipOrFatalFn</span>&nbsp;<span class="op" id="8280508">!=</span>&nbsp;<span class="ident" id="8280511">nil</span>&nbsp;<span class="op" id="8280515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280520">skipOrFatalFn</span><span class="op" id="8280533">(</span><span class="op" id="8280534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280539">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280555">c1</span><span class="op" id="8280557">,</span>&nbsp;<span class="ident" id="8280559">err</span>&nbsp;<span class="op" id="8280563">:=</span>&nbsp;<span class="ident" id="8280566">ListenPacket</span><span class="op" id="8280578">(</span><span class="ident" id="8280579">tt</span><span class="op" id="8280581">.</span><span class="ident" id="8280582">net</span><span class="op" id="8280585">,</span>&nbsp;<span class="ident" id="8280587">tt</span><span class="op" id="8280589">.</span><span class="ident" id="8280590">addr1</span><span class="op" id="8280595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280599">if</span>&nbsp;<span class="ident" id="8280602">err</span>&nbsp;<span class="op" id="8280606">!=</span>&nbsp;<span class="ident" id="8280609">nil</span>&nbsp;<span class="op" id="8280613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280618">t</span><span class="op" id="8280619">.</span><span class="ident" id="8280620">Fatalf</span><span class="op" id="8280626">(</span><span class="string" id="8280627">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8280652">,</span>&nbsp;<span class="ident" id="8280654">err</span><span class="op" id="8280657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280665">defer</span>&nbsp;<span class="ident" id="8280671">closer</span><span class="op" id="8280677">(</span><span class="ident" id="8280678">c1</span><span class="op" id="8280680">,</span>&nbsp;<span class="ident" id="8280682">netstr</span><span class="op" id="8280688">[</span><span class="num" id="8280689">0</span><span class="op" id="8280690">]</span><span class="op" id="8280691">,</span>&nbsp;<span class="ident" id="8280693">tt</span><span class="op" id="8280695">.</span><span class="ident" id="8280696">addr1</span><span class="op" id="8280701">,</span>&nbsp;<span class="ident" id="8280703">tt</span><span class="op" id="8280705">.</span><span class="ident" id="8280706">addr2</span><span class="op" id="8280711">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280715">c1</span><span class="op" id="8280717">.</span><span class="ident" id="8280718">LocalAddr</span><span class="op" id="8280727">(</span><span class="op" id="8280728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280732">c1</span><span class="op" id="8280734">.</span><span class="ident" id="8280735">SetDeadline</span><span class="op" id="8280746">(</span><span class="ident" id="8280747">time</span><span class="op" id="8280751">.</span><span class="ident" id="8280752">Now</span><span class="op" id="8280755">(</span><span class="op" id="8280756">)</span><span class="op" id="8280757">.</span><span class="ident" id="8280758">Add</span><span class="op" id="8280761">(</span><span class="num" id="8280762">100</span>&nbsp;<span class="op" id="8280766">*</span>&nbsp;<span class="ident" id="8280768">time</span><span class="op" id="8280772">.</span><span class="ident" id="8280773">Millisecond</span><span class="op" id="8280784">)</span><span class="op" id="8280785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280789">c1</span><span class="op" id="8280791">.</span><span class="ident" id="8280792">SetReadDeadline</span><span class="op" id="8280807">(</span><span class="ident" id="8280808">time</span><span class="op" id="8280812">.</span><span class="ident" id="8280813">Now</span><span class="op" id="8280816">(</span><span class="op" id="8280817">)</span><span class="op" id="8280818">.</span><span class="ident" id="8280819">Add</span><span class="op" id="8280822">(</span><span class="num" id="8280823">100</span>&nbsp;<span class="op" id="8280827">*</span>&nbsp;<span class="ident" id="8280829">time</span><span class="op" id="8280833">.</span><span class="ident" id="8280834">Millisecond</span><span class="op" id="8280845">)</span><span class="op" id="8280846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280850">c1</span><span class="op" id="8280852">.</span><span class="ident" id="8280853">SetWriteDeadline</span><span class="op" id="8280869">(</span><span class="ident" id="8280870">time</span><span class="op" id="8280874">.</span><span class="ident" id="8280875">Now</span><span class="op" id="8280878">(</span><span class="op" id="8280879">)</span><span class="op" id="8280880">.</span><span class="ident" id="8280881">Add</span><span class="op" id="8280884">(</span><span class="num" id="8280885">100</span>&nbsp;<span class="op" id="8280889">*</span>&nbsp;<span class="ident" id="8280891">time</span><span class="op" id="8280895">.</span><span class="ident" id="8280896">Millisecond</span><span class="op" id="8280907">)</span><span class="op" id="8280908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280913">c2</span><span class="op" id="8280915">,</span>&nbsp;<span class="ident" id="8280917">err</span>&nbsp;<span class="op" id="8280921">:=</span>&nbsp;<span class="ident" id="8280924">ListenPacket</span><span class="op" id="8280936">(</span><span class="ident" id="8280937">tt</span><span class="op" id="8280939">.</span><span class="ident" id="8280940">net</span><span class="op" id="8280943">,</span>&nbsp;<span class="ident" id="8280945">tt</span><span class="op" id="8280947">.</span><span class="ident" id="8280948">addr2</span><span class="op" id="8280953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280957">if</span>&nbsp;<span class="ident" id="8280960">err</span>&nbsp;<span class="op" id="8280964">!=</span>&nbsp;<span class="ident" id="8280967">nil</span>&nbsp;<span class="op" id="8280971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280976">t</span><span class="op" id="8280977">.</span><span class="ident" id="8280978">Fatalf</span><span class="op" id="8280984">(</span><span class="string" id="8280985">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8281010">,</span>&nbsp;<span class="ident" id="8281012">err</span><span class="op" id="8281015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281023">defer</span>&nbsp;<span class="ident" id="8281029">closer</span><span class="op" id="8281035">(</span><span class="ident" id="8281036">c2</span><span class="op" id="8281038">,</span>&nbsp;<span class="ident" id="8281040">netstr</span><span class="op" id="8281046">[</span><span class="num" id="8281047">0</span><span class="op" id="8281048">]</span><span class="op" id="8281049">,</span>&nbsp;<span class="ident" id="8281051">tt</span><span class="op" id="8281053">.</span><span class="ident" id="8281054">addr1</span><span class="op" id="8281059">,</span>&nbsp;<span class="ident" id="8281061">tt</span><span class="op" id="8281063">.</span><span class="ident" id="8281064">addr2</span><span class="op" id="8281069">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281073">c2</span><span class="op" id="8281075">.</span><span class="ident" id="8281076">LocalAddr</span><span class="op" id="8281085">(</span><span class="op" id="8281086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281090">c2</span><span class="op" id="8281092">.</span><span class="ident" id="8281093">SetDeadline</span><span class="op" id="8281104">(</span><span class="ident" id="8281105">time</span><span class="op" id="8281109">.</span><span class="ident" id="8281110">Now</span><span class="op" id="8281113">(</span><span class="op" id="8281114">)</span><span class="op" id="8281115">.</span><span class="ident" id="8281116">Add</span><span class="op" id="8281119">(</span><span class="num" id="8281120">100</span>&nbsp;<span class="op" id="8281124">*</span>&nbsp;<span class="ident" id="8281126">time</span><span class="op" id="8281130">.</span><span class="ident" id="8281131">Millisecond</span><span class="op" id="8281142">)</span><span class="op" id="8281143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281147">c2</span><span class="op" id="8281149">.</span><span class="ident" id="8281150">SetReadDeadline</span><span class="op" id="8281165">(</span><span class="ident" id="8281166">time</span><span class="op" id="8281170">.</span><span class="ident" id="8281171">Now</span><span class="op" id="8281174">(</span><span class="op" id="8281175">)</span><span class="op" id="8281176">.</span><span class="ident" id="8281177">Add</span><span class="op" id="8281180">(</span><span class="num" id="8281181">100</span>&nbsp;<span class="op" id="8281185">*</span>&nbsp;<span class="ident" id="8281187">time</span><span class="op" id="8281191">.</span><span class="ident" id="8281192">Millisecond</span><span class="op" id="8281203">)</span><span class="op" id="8281204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281208">c2</span><span class="op" id="8281210">.</span><span class="ident" id="8281211">SetWriteDeadline</span><span class="op" id="8281227">(</span><span class="ident" id="8281228">time</span><span class="op" id="8281232">.</span><span class="ident" id="8281233">Now</span><span class="op" id="8281236">(</span><span class="op" id="8281237">)</span><span class="op" id="8281238">.</span><span class="ident" id="8281239">Add</span><span class="op" id="8281242">(</span><span class="num" id="8281243">100</span>&nbsp;<span class="op" id="8281247">*</span>&nbsp;<span class="ident" id="8281249">time</span><span class="op" id="8281253">.</span><span class="ident" id="8281254">Millisecond</span><span class="op" id="8281265">)</span><span class="op" id="8281266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281271">if</span>&nbsp;<span class="ident" id="8281274">_</span><span class="op" id="8281275">,</span>&nbsp;<span class="ident" id="8281277">err</span>&nbsp;<span class="op" id="8281281">:=</span>&nbsp;<span class="ident" id="8281284">c1</span><span class="op" id="8281286">.</span><span class="ident" id="8281287">WriteTo</span><span class="op" id="8281294">(</span><span class="ident" id="8281295">wb</span><span class="op" id="8281297">,</span>&nbsp;<span class="ident" id="8281299">c2</span><span class="op" id="8281301">.</span><span class="ident" id="8281302">LocalAddr</span><span class="op" id="8281311">(</span><span class="op" id="8281312">)</span><span class="op" id="8281313">)</span><span class="op" id="8281314">;</span>&nbsp;<span class="ident" id="8281316">err</span>&nbsp;<span class="op" id="8281320">!=</span>&nbsp;<span class="ident" id="8281323">nil</span>&nbsp;<span class="op" id="8281327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281332">t</span><span class="op" id="8281333">.</span><span class="ident" id="8281334">Fatalf</span><span class="op" id="8281340">(</span><span class="string" id="8281341">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8281372">,</span>&nbsp;<span class="ident" id="8281374">err</span><span class="op" id="8281377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281385">rb2</span>&nbsp;<span class="op" id="8281389">:=</span>&nbsp;<span class="builtinfunc" id="8281392">make</span><span class="op" id="8281396">(</span><span class="op" id="8281397">[</span><span class="op" id="8281398">]</span><span class="builtintype" id="8281399">byte</span><span class="op" id="8281403">,</span>&nbsp;<span class="num" id="8281405">128</span><span class="op" id="8281408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281412">if</span>&nbsp;<span class="ident" id="8281415">_</span><span class="op" id="8281416">,</span>&nbsp;<span class="ident" id="8281418">_</span><span class="op" id="8281419">,</span>&nbsp;<span class="ident" id="8281421">err</span>&nbsp;<span class="op" id="8281425">:=</span>&nbsp;<span class="ident" id="8281428">c2</span><span class="op" id="8281430">.</span><span class="ident" id="8281431">ReadFrom</span><span class="op" id="8281439">(</span><span class="ident" id="8281440">rb2</span><span class="op" id="8281443">)</span><span class="op" id="8281444">;</span>&nbsp;<span class="ident" id="8281446">err</span>&nbsp;<span class="op" id="8281450">!=</span>&nbsp;<span class="ident" id="8281453">nil</span>&nbsp;<span class="op" id="8281457">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281462">t</span><span class="op" id="8281463">.</span><span class="ident" id="8281464">Fatalf</span><span class="op" id="8281470">(</span><span class="string" id="8281471">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8281503">,</span>&nbsp;<span class="ident" id="8281505">err</span><span class="op" id="8281508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281516">if</span>&nbsp;<span class="ident" id="8281519">_</span><span class="op" id="8281520">,</span>&nbsp;<span class="ident" id="8281522">err</span>&nbsp;<span class="op" id="8281526">:=</span>&nbsp;<span class="ident" id="8281529">c2</span><span class="op" id="8281531">.</span><span class="ident" id="8281532">WriteTo</span><span class="op" id="8281539">(</span><span class="ident" id="8281540">wb</span><span class="op" id="8281542">,</span>&nbsp;<span class="ident" id="8281544">c1</span><span class="op" id="8281546">.</span><span class="ident" id="8281547">LocalAddr</span><span class="op" id="8281556">(</span><span class="op" id="8281557">)</span><span class="op" id="8281558">)</span><span class="op" id="8281559">;</span>&nbsp;<span class="ident" id="8281561">err</span>&nbsp;<span class="op" id="8281565">!=</span>&nbsp;<span class="ident" id="8281568">nil</span>&nbsp;<span class="op" id="8281572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281577">t</span><span class="op" id="8281578">.</span><span class="ident" id="8281579">Fatalf</span><span class="op" id="8281585">(</span><span class="string" id="8281586">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8281617">,</span>&nbsp;<span class="ident" id="8281619">err</span><span class="op" id="8281622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281626">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281630">rb1</span>&nbsp;<span class="op" id="8281634">:=</span>&nbsp;<span class="builtinfunc" id="8281637">make</span><span class="op" id="8281641">(</span><span class="op" id="8281642">[</span><span class="op" id="8281643">]</span><span class="builtintype" id="8281644">byte</span><span class="op" id="8281648">,</span>&nbsp;<span class="num" id="8281650">128</span><span class="op" id="8281653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281657">if</span>&nbsp;<span class="ident" id="8281660">_</span><span class="op" id="8281661">,</span>&nbsp;<span class="ident" id="8281663">_</span><span class="op" id="8281664">,</span>&nbsp;<span class="ident" id="8281666">err</span>&nbsp;<span class="op" id="8281670">:=</span>&nbsp;<span class="ident" id="8281673">c1</span><span class="op" id="8281675">.</span><span class="ident" id="8281676">ReadFrom</span><span class="op" id="8281684">(</span><span class="ident" id="8281685">rb1</span><span class="op" id="8281688">)</span><span class="op" id="8281689">;</span>&nbsp;<span class="ident" id="8281691">err</span>&nbsp;<span class="op" id="8281695">!=</span>&nbsp;<span class="ident" id="8281698">nil</span>&nbsp;<span class="op" id="8281702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281707">t</span><span class="op" id="8281708">.</span><span class="ident" id="8281709">Fatalf</span><span class="op" id="8281715">(</span><span class="string" id="8281716">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8281748">,</span>&nbsp;<span class="ident" id="8281750">err</span><span class="op" id="8281753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281760">}</span><br>
<span class="lineno">120</span><span class="op" id="8281762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281765">func</span>&nbsp;<span class="ident" id="8281770">TestConnAndPacketConn</span><span class="op" id="8281791">(</span><span class="ident" id="8281792">t</span>&nbsp;<span class="op" id="8281794">*</span><span class="ident" id="8281795">testing</span><span class="op" id="8281802">.</span><span class="ident" id="8281803">T</span><span class="op" id="8281804">)</span>&nbsp;<span class="op" id="8281806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281809">closer</span>&nbsp;<span class="op" id="8281816">:=</span>&nbsp;<span class="keyword" id="8281819">func</span><span class="op" id="8281823">(</span><span class="ident" id="8281824">c</span>&nbsp;<span class="ident" id="8281826">PacketConn</span><span class="op" id="8281836">,</span>&nbsp;<span class="ident" id="8281838">net</span><span class="op" id="8281841">,</span>&nbsp;<span class="ident" id="8281843">addr1</span><span class="op" id="8281848">,</span>&nbsp;<span class="ident" id="8281850">addr2</span>&nbsp;<span class="builtintype" id="8281856">string</span><span class="op" id="8281862">)</span>&nbsp;<span class="op" id="8281864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281868">c</span><span class="op" id="8281869">.</span><span class="ident" id="8281870">Close</span><span class="op" id="8281875">(</span><span class="op" id="8281876">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281880">switch</span>&nbsp;<span class="ident" id="8281887">net</span>&nbsp;<span class="op" id="8281891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281895">case</span>&nbsp;<span class="string" id="8281900">&#34;unixgram&#34;</span><span class="op" id="8281910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281915">os</span><span class="op" id="8281917">.</span><span class="ident" id="8281918">Remove</span><span class="op" id="8281924">(</span><span class="ident" id="8281925">addr1</span><span class="op" id="8281930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281935">os</span><span class="op" id="8281937">.</span><span class="ident" id="8281938">Remove</span><span class="op" id="8281944">(</span><span class="ident" id="8281945">addr2</span><span class="op" id="8281950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281954">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281961">for</span>&nbsp;<span class="ident" id="8281965">i</span><span class="op" id="8281966">,</span>&nbsp;<span class="ident" id="8281968">tt</span>&nbsp;<span class="op" id="8281971">:=</span>&nbsp;<span class="keyword" id="8281974">range</span>&nbsp;<span class="ident" id="8281980">packetConnTests</span>&nbsp;<span class="op" id="8281996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282000">var</span>&nbsp;<span class="ident" id="8282004">wb</span>&nbsp;<span class="op" id="8282007">[</span><span class="op" id="8282008">]</span><span class="builtintype" id="8282009">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282016">netstr</span>&nbsp;<span class="op" id="8282023">:=</span>&nbsp;<span class="ident" id="8282026">strings</span><span class="op" id="8282033">.</span><span class="ident" id="8282034">Split</span><span class="op" id="8282039">(</span><span class="ident" id="8282040">tt</span><span class="op" id="8282042">.</span><span class="ident" id="8282043">net</span><span class="op" id="8282046">,</span>&nbsp;<span class="string" id="8282048">&#34;:&#34;</span><span class="op" id="8282051">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282055">wb</span><span class="op" id="8282057">,</span>&nbsp;<span class="ident" id="8282059">skipOrFatalFn</span>&nbsp;<span class="op" id="8282073">:=</span>&nbsp;<span class="ident" id="8282076">packetConnTestData</span><span class="op" id="8282094">(</span><span class="ident" id="8282095">t</span><span class="op" id="8282096">,</span>&nbsp;<span class="ident" id="8282098">netstr</span><span class="op" id="8282104">[</span><span class="num" id="8282105">0</span><span class="op" id="8282106">]</span><span class="op" id="8282107">,</span>&nbsp;<span class="ident" id="8282109">i</span><span class="op" id="8282110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282114">if</span>&nbsp;<span class="ident" id="8282117">skipOrFatalFn</span>&nbsp;<span class="op" id="8282131">!=</span>&nbsp;<span class="ident" id="8282134">nil</span>&nbsp;<span class="op" id="8282138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282143">skipOrFatalFn</span><span class="op" id="8282156">(</span><span class="op" id="8282157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282162">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282173">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282178">c1</span><span class="op" id="8282180">,</span>&nbsp;<span class="ident" id="8282182">err</span>&nbsp;<span class="op" id="8282186">:=</span>&nbsp;<span class="ident" id="8282189">ListenPacket</span><span class="op" id="8282201">(</span><span class="ident" id="8282202">tt</span><span class="op" id="8282204">.</span><span class="ident" id="8282205">net</span><span class="op" id="8282208">,</span>&nbsp;<span class="ident" id="8282210">tt</span><span class="op" id="8282212">.</span><span class="ident" id="8282213">addr1</span><span class="op" id="8282218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282222">if</span>&nbsp;<span class="ident" id="8282225">err</span>&nbsp;<span class="op" id="8282229">!=</span>&nbsp;<span class="ident" id="8282232">nil</span>&nbsp;<span class="op" id="8282236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282241">t</span><span class="op" id="8282242">.</span><span class="ident" id="8282243">Fatalf</span><span class="op" id="8282249">(</span><span class="string" id="8282250">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8282275">,</span>&nbsp;<span class="ident" id="8282277">err</span><span class="op" id="8282280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282284">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282288">defer</span>&nbsp;<span class="ident" id="8282294">closer</span><span class="op" id="8282300">(</span><span class="ident" id="8282301">c1</span><span class="op" id="8282303">,</span>&nbsp;<span class="ident" id="8282305">netstr</span><span class="op" id="8282311">[</span><span class="num" id="8282312">0</span><span class="op" id="8282313">]</span><span class="op" id="8282314">,</span>&nbsp;<span class="ident" id="8282316">tt</span><span class="op" id="8282318">.</span><span class="ident" id="8282319">addr1</span><span class="op" id="8282324">,</span>&nbsp;<span class="ident" id="8282326">tt</span><span class="op" id="8282328">.</span><span class="ident" id="8282329">addr2</span><span class="op" id="8282334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282338">c1</span><span class="op" id="8282340">.</span><span class="ident" id="8282341">LocalAddr</span><span class="op" id="8282350">(</span><span class="op" id="8282351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282355">c1</span><span class="op" id="8282357">.</span><span class="ident" id="8282358">SetDeadline</span><span class="op" id="8282369">(</span><span class="ident" id="8282370">time</span><span class="op" id="8282374">.</span><span class="ident" id="8282375">Now</span><span class="op" id="8282378">(</span><span class="op" id="8282379">)</span><span class="op" id="8282380">.</span><span class="ident" id="8282381">Add</span><span class="op" id="8282384">(</span><span class="num" id="8282385">100</span>&nbsp;<span class="op" id="8282389">*</span>&nbsp;<span class="ident" id="8282391">time</span><span class="op" id="8282395">.</span><span class="ident" id="8282396">Millisecond</span><span class="op" id="8282407">)</span><span class="op" id="8282408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282412">c1</span><span class="op" id="8282414">.</span><span class="ident" id="8282415">SetReadDeadline</span><span class="op" id="8282430">(</span><span class="ident" id="8282431">time</span><span class="op" id="8282435">.</span><span class="ident" id="8282436">Now</span><span class="op" id="8282439">(</span><span class="op" id="8282440">)</span><span class="op" id="8282441">.</span><span class="ident" id="8282442">Add</span><span class="op" id="8282445">(</span><span class="num" id="8282446">100</span>&nbsp;<span class="op" id="8282450">*</span>&nbsp;<span class="ident" id="8282452">time</span><span class="op" id="8282456">.</span><span class="ident" id="8282457">Millisecond</span><span class="op" id="8282468">)</span><span class="op" id="8282469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282473">c1</span><span class="op" id="8282475">.</span><span class="ident" id="8282476">SetWriteDeadline</span><span class="op" id="8282492">(</span><span class="ident" id="8282493">time</span><span class="op" id="8282497">.</span><span class="ident" id="8282498">Now</span><span class="op" id="8282501">(</span><span class="op" id="8282502">)</span><span class="op" id="8282503">.</span><span class="ident" id="8282504">Add</span><span class="op" id="8282507">(</span><span class="num" id="8282508">100</span>&nbsp;<span class="op" id="8282512">*</span>&nbsp;<span class="ident" id="8282514">time</span><span class="op" id="8282518">.</span><span class="ident" id="8282519">Millisecond</span><span class="op" id="8282530">)</span><span class="op" id="8282531">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282536">c2</span><span class="op" id="8282538">,</span>&nbsp;<span class="ident" id="8282540">err</span>&nbsp;<span class="op" id="8282544">:=</span>&nbsp;<span class="ident" id="8282547">Dial</span><span class="op" id="8282551">(</span><span class="ident" id="8282552">tt</span><span class="op" id="8282554">.</span><span class="ident" id="8282555">net</span><span class="op" id="8282558">,</span>&nbsp;<span class="ident" id="8282560">c1</span><span class="op" id="8282562">.</span><span class="ident" id="8282563">LocalAddr</span><span class="op" id="8282572">(</span><span class="op" id="8282573">)</span><span class="op" id="8282574">.</span><span class="ident" id="8282575">String</span><span class="op" id="8282581">(</span><span class="op" id="8282582">)</span><span class="op" id="8282583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282587">if</span>&nbsp;<span class="ident" id="8282590">err</span>&nbsp;<span class="op" id="8282594">!=</span>&nbsp;<span class="ident" id="8282597">nil</span>&nbsp;<span class="op" id="8282601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282606">t</span><span class="op" id="8282607">.</span><span class="ident" id="8282608">Fatalf</span><span class="op" id="8282614">(</span><span class="string" id="8282615">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8282632">,</span>&nbsp;<span class="ident" id="8282634">err</span><span class="op" id="8282637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282641">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282645">defer</span>&nbsp;<span class="ident" id="8282651">c2</span><span class="op" id="8282653">.</span><span class="ident" id="8282654">Close</span><span class="op" id="8282659">(</span><span class="op" id="8282660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282664">c2</span><span class="op" id="8282666">.</span><span class="ident" id="8282667">LocalAddr</span><span class="op" id="8282676">(</span><span class="op" id="8282677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282681">c2</span><span class="op" id="8282683">.</span><span class="ident" id="8282684">RemoteAddr</span><span class="op" id="8282694">(</span><span class="op" id="8282695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282699">c2</span><span class="op" id="8282701">.</span><span class="ident" id="8282702">SetDeadline</span><span class="op" id="8282713">(</span><span class="ident" id="8282714">time</span><span class="op" id="8282718">.</span><span class="ident" id="8282719">Now</span><span class="op" id="8282722">(</span><span class="op" id="8282723">)</span><span class="op" id="8282724">.</span><span class="ident" id="8282725">Add</span><span class="op" id="8282728">(</span><span class="num" id="8282729">100</span>&nbsp;<span class="op" id="8282733">*</span>&nbsp;<span class="ident" id="8282735">time</span><span class="op" id="8282739">.</span><span class="ident" id="8282740">Millisecond</span><span class="op" id="8282751">)</span><span class="op" id="8282752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282756">c2</span><span class="op" id="8282758">.</span><span class="ident" id="8282759">SetReadDeadline</span><span class="op" id="8282774">(</span><span class="ident" id="8282775">time</span><span class="op" id="8282779">.</span><span class="ident" id="8282780">Now</span><span class="op" id="8282783">(</span><span class="op" id="8282784">)</span><span class="op" id="8282785">.</span><span class="ident" id="8282786">Add</span><span class="op" id="8282789">(</span><span class="num" id="8282790">100</span>&nbsp;<span class="op" id="8282794">*</span>&nbsp;<span class="ident" id="8282796">time</span><span class="op" id="8282800">.</span><span class="ident" id="8282801">Millisecond</span><span class="op" id="8282812">)</span><span class="op" id="8282813">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282817">c2</span><span class="op" id="8282819">.</span><span class="ident" id="8282820">SetWriteDeadline</span><span class="op" id="8282836">(</span><span class="ident" id="8282837">time</span><span class="op" id="8282841">.</span><span class="ident" id="8282842">Now</span><span class="op" id="8282845">(</span><span class="op" id="8282846">)</span><span class="op" id="8282847">.</span><span class="ident" id="8282848">Add</span><span class="op" id="8282851">(</span><span class="num" id="8282852">100</span>&nbsp;<span class="op" id="8282856">*</span>&nbsp;<span class="ident" id="8282858">time</span><span class="op" id="8282862">.</span><span class="ident" id="8282863">Millisecond</span><span class="op" id="8282874">)</span><span class="op" id="8282875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282880">if</span>&nbsp;<span class="ident" id="8282883">_</span><span class="op" id="8282884">,</span>&nbsp;<span class="ident" id="8282886">err</span>&nbsp;<span class="op" id="8282890">:=</span>&nbsp;<span class="ident" id="8282893">c2</span><span class="op" id="8282895">.</span><span class="ident" id="8282896">Write</span><span class="op" id="8282901">(</span><span class="ident" id="8282902">wb</span><span class="op" id="8282904">)</span><span class="op" id="8282905">;</span>&nbsp;<span class="ident" id="8282907">err</span>&nbsp;<span class="op" id="8282911">!=</span>&nbsp;<span class="ident" id="8282914">nil</span>&nbsp;<span class="op" id="8282918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282923">t</span><span class="op" id="8282924">.</span><span class="ident" id="8282925">Fatalf</span><span class="op" id="8282931">(</span><span class="string" id="8282932">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8282955">,</span>&nbsp;<span class="ident" id="8282957">err</span><span class="op" id="8282960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282964">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282968">rb1</span>&nbsp;<span class="op" id="8282972">:=</span>&nbsp;<span class="builtinfunc" id="8282975">make</span><span class="op" id="8282979">(</span><span class="op" id="8282980">[</span><span class="op" id="8282981">]</span><span class="builtintype" id="8282982">byte</span><span class="op" id="8282986">,</span>&nbsp;<span class="num" id="8282988">128</span><span class="op" id="8282991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282995">if</span>&nbsp;<span class="ident" id="8282998">_</span><span class="op" id="8282999">,</span>&nbsp;<span class="ident" id="8283001">_</span><span class="op" id="8283002">,</span>&nbsp;<span class="ident" id="8283004">err</span>&nbsp;<span class="op" id="8283008">:=</span>&nbsp;<span class="ident" id="8283011">c1</span><span class="op" id="8283013">.</span><span class="ident" id="8283014">ReadFrom</span><span class="op" id="8283022">(</span><span class="ident" id="8283023">rb1</span><span class="op" id="8283026">)</span><span class="op" id="8283027">;</span>&nbsp;<span class="ident" id="8283029">err</span>&nbsp;<span class="op" id="8283033">!=</span>&nbsp;<span class="ident" id="8283036">nil</span>&nbsp;<span class="op" id="8283040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283045">t</span><span class="op" id="8283046">.</span><span class="ident" id="8283047">Fatalf</span><span class="op" id="8283053">(</span><span class="string" id="8283054">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8283086">,</span>&nbsp;<span class="ident" id="8283088">err</span><span class="op" id="8283091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283099">var</span>&nbsp;<span class="ident" id="8283103">dst</span>&nbsp;<span class="ident" id="8283107">Addr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283114">switch</span>&nbsp;<span class="ident" id="8283121">netstr</span><span class="op" id="8283127">[</span><span class="num" id="8283128">0</span><span class="op" id="8283129">]</span>&nbsp;<span class="op" id="8283131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283135">case</span>&nbsp;<span class="string" id="8283140">&#34;ip&#34;</span><span class="op" id="8283144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283149">dst</span>&nbsp;<span class="op" id="8283153">=</span>&nbsp;<span class="op" id="8283155">&amp;</span><span class="ident" id="8283156">IPAddr</span><span class="op" id="8283162">{</span><span class="ident" id="8283163">IP</span><span class="op" id="8283165">:</span>&nbsp;<span class="ident" id="8283167">IPv4</span><span class="op" id="8283171">(</span><span class="num" id="8283172">127</span><span class="op" id="8283175">,</span>&nbsp;<span class="num" id="8283177">0</span><span class="op" id="8283178">,</span>&nbsp;<span class="num" id="8283180">0</span><span class="op" id="8283181">,</span>&nbsp;<span class="num" id="8283183">1</span><span class="op" id="8283184">)</span><span class="op" id="8283185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283189">case</span>&nbsp;<span class="string" id="8283194">&#34;unixgram&#34;</span><span class="op" id="8283204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283209">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283220">default</span><span class="op" id="8283227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283232">dst</span>&nbsp;<span class="op" id="8283236">=</span>&nbsp;<span class="ident" id="8283238">c2</span><span class="op" id="8283240">.</span><span class="ident" id="8283241">LocalAddr</span><span class="op" id="8283250">(</span><span class="op" id="8283251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283259">if</span>&nbsp;<span class="ident" id="8283262">_</span><span class="op" id="8283263">,</span>&nbsp;<span class="ident" id="8283265">err</span>&nbsp;<span class="op" id="8283269">:=</span>&nbsp;<span class="ident" id="8283272">c1</span><span class="op" id="8283274">.</span><span class="ident" id="8283275">WriteTo</span><span class="op" id="8283282">(</span><span class="ident" id="8283283">wb</span><span class="op" id="8283285">,</span>&nbsp;<span class="ident" id="8283287">dst</span><span class="op" id="8283290">)</span><span class="op" id="8283291">;</span>&nbsp;<span class="ident" id="8283293">err</span>&nbsp;<span class="op" id="8283297">!=</span>&nbsp;<span class="ident" id="8283300">nil</span>&nbsp;<span class="op" id="8283304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283309">t</span><span class="op" id="8283310">.</span><span class="ident" id="8283311">Fatalf</span><span class="op" id="8283317">(</span><span class="string" id="8283318">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8283349">,</span>&nbsp;<span class="ident" id="8283351">err</span><span class="op" id="8283354">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283362">rb2</span>&nbsp;<span class="op" id="8283366">:=</span>&nbsp;<span class="builtinfunc" id="8283369">make</span><span class="op" id="8283373">(</span><span class="op" id="8283374">[</span><span class="op" id="8283375">]</span><span class="builtintype" id="8283376">byte</span><span class="op" id="8283380">,</span>&nbsp;<span class="num" id="8283382">128</span><span class="op" id="8283385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283389">if</span>&nbsp;<span class="ident" id="8283392">_</span><span class="op" id="8283393">,</span>&nbsp;<span class="ident" id="8283395">err</span>&nbsp;<span class="op" id="8283399">:=</span>&nbsp;<span class="ident" id="8283402">c2</span><span class="op" id="8283404">.</span><span class="ident" id="8283405">Read</span><span class="op" id="8283409">(</span><span class="ident" id="8283410">rb2</span><span class="op" id="8283413">)</span><span class="op" id="8283414">;</span>&nbsp;<span class="ident" id="8283416">err</span>&nbsp;<span class="op" id="8283420">!=</span>&nbsp;<span class="ident" id="8283423">nil</span>&nbsp;<span class="op" id="8283427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283432">t</span><span class="op" id="8283433">.</span><span class="ident" id="8283434">Fatalf</span><span class="op" id="8283440">(</span><span class="string" id="8283441">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8283463">,</span>&nbsp;<span class="ident" id="8283465">err</span><span class="op" id="8283468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283472">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283475">}</span><br>
<span class="lineno"></span><span class="op" id="8283477">}</span>
</div>
</body>
</html>
