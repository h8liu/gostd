<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html" class="current">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2293501">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2293556">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2293610">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2293661">package</span>&nbsp;<span class="ident" id="2293669">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2293675">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2293735">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2293795">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2293854">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2293884">//</span><br>
<span class="lineno"></span><span class="comment" id="2293887">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2293943">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2294012">//</span><br>
<span class="lineno">15</span><span class="comment" id="2294015">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2294074">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2294130">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2294187">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2294204">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2294260">//</span><br>
<span class="lineno"></span><span class="comment" id="2294263">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2294275">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2294326">//</span><br>
<span class="lineno"></span><span class="comment" id="2294329">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2294339">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2294367">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2294415">//</span><br>
<span class="lineno"></span><span class="comment" id="2294418">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2294476">//</span><br>
<span class="lineno">30</span><span class="comment" id="2294479">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2294543">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2294607">//</span><br>
<span class="lineno"></span><span class="comment" id="2294610">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2294675">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2294709">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2294723">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2294788">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2294817">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2294875">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2294892">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2294950">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2295011">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2295078">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2295143">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2295206">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2295272">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2295307">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2295378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2295428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2295478">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2295528">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2295578">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2295628">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2295695">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2295725">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2295778">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2295828">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2295873">//</span><br>
<span class="lineno"></span><span class="comment" id="2295876">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2295938">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2296007">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2296046">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2296110">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2296174">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2296238">//</span><br>
<span class="lineno"></span><span class="comment" id="2296241">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2296307">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2296362">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2296410">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2296474">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2296539">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2296557">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2296629">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2296701">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2296773">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2296845">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2296917">//</span><br>
<span class="lineno"></span><span class="comment" id="2296920">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2296947">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2296986">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2297015">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2297066">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2297123">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2297153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2297222">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2297274">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2297339">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2297410">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2297445">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2297491">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2297550">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2297610">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2297681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2297744">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2297789">//</span><br>
<span class="lineno"></span><span class="comment" id="2297792">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2297810">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2297856">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2297887">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2297942">//</span><br>
<span class="lineno"></span><span class="comment" id="2297945">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2297958">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2298028">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2298068">//</span><br>
<span class="lineno">105</span><span class="comment" id="2298071">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2298086">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2298110">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2298180">//</span><br>
<span class="lineno"></span><span class="comment" id="2298183">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2298197">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2298263">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2298327">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2298393">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2298437">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2298441">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2298505">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2298565">//</span><br>
<span class="lineno"></span><span class="comment" id="2298568">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2298590">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2298612">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2298632">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2298652">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2298697">func</span>&nbsp;<span class="ident" id="2298702">Expm1</span><span class="op" id="2298707">(</span><span class="ident" id="2298708">x</span>&nbsp;<span class="builtintype" id="2298710">float64</span><span class="op" id="2298717">)</span>&nbsp;<span class="builtintype" id="2298719">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2298728">func</span>&nbsp;<span class="ident" id="2298733">expm1</span><span class="op" id="2298738">(</span><span class="ident" id="2298739">x</span>&nbsp;<span class="builtintype" id="2298741">float64</span><span class="op" id="2298748">)</span>&nbsp;<span class="builtintype" id="2298750">float64</span>&nbsp;<span class="op" id="2298758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2298761">const</span>&nbsp;<span class="op" id="2298767">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298771">Othreshold</span>&nbsp;<span class="op" id="2298782">=</span>&nbsp;<span class="num" id="2298784">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2298811">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298835">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2298846">=</span>&nbsp;<span class="num" id="2298848">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2298875">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298899">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2298910">=</span>&nbsp;<span class="num" id="2298912">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2298939">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298963">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2298974">=</span>&nbsp;<span class="num" id="2298976">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2299003">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299027">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2299038">=</span>&nbsp;<span class="num" id="2299040">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2299067">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299091">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2299102">=</span>&nbsp;<span class="num" id="2299104">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2299131">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299155">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2299166">=</span>&nbsp;<span class="num" id="2299168">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2299195">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299219">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2299230">=</span>&nbsp;<span class="num" id="2299232">1.0</span>&nbsp;<span class="op" id="2299236">/</span>&nbsp;<span class="op" id="2299238">(</span><span class="num" id="2299239">1</span>&nbsp;<span class="op" id="2299241">&lt;&lt;</span>&nbsp;<span class="num" id="2299244">54</span><span class="op" id="2299246">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2299259">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299292">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299334">Q1</span>&nbsp;<span class="op" id="2299337">=</span>&nbsp;<span class="op" id="2299339">-</span><span class="num" id="2299340">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2299367">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299391">Q2</span>&nbsp;<span class="op" id="2299394">=</span>&nbsp;<span class="num" id="2299396">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2299424">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299448">Q3</span>&nbsp;<span class="op" id="2299451">=</span>&nbsp;<span class="op" id="2299453">-</span><span class="num" id="2299454">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2299481">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299505">Q4</span>&nbsp;<span class="op" id="2299508">=</span>&nbsp;<span class="num" id="2299510">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2299538">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299562">Q5</span>&nbsp;<span class="op" id="2299565">=</span>&nbsp;<span class="op" id="2299567">-</span><span class="num" id="2299568">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2299595">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299622">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299640">switch</span>&nbsp;<span class="op" id="2299647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299650">case</span>&nbsp;<span class="ident" id="2299655">IsInf</span><span class="op" id="2299660">(</span><span class="ident" id="2299661">x</span><span class="op" id="2299662">,</span>&nbsp;<span class="num" id="2299664">1</span><span class="op" id="2299665">)</span>&nbsp;<span class="op" id="2299667">||</span>&nbsp;<span class="ident" id="2299670">IsNaN</span><span class="op" id="2299675">(</span><span class="ident" id="2299676">x</span><span class="op" id="2299677">)</span><span class="op" id="2299678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299682">return</span>&nbsp;<span class="ident" id="2299689">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299692">case</span>&nbsp;<span class="ident" id="2299697">IsInf</span><span class="op" id="2299702">(</span><span class="ident" id="2299703">x</span><span class="op" id="2299704">,</span>&nbsp;<span class="op" id="2299706">-</span><span class="num" id="2299707">1</span><span class="op" id="2299708">)</span><span class="op" id="2299709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299713">return</span>&nbsp;<span class="op" id="2299720">-</span><span class="num" id="2299721">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299728">absx</span>&nbsp;<span class="op" id="2299733">:=</span>&nbsp;<span class="ident" id="2299736">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299739">sign</span>&nbsp;<span class="op" id="2299744">:=</span>&nbsp;<span class="builtintype" id="2299747">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299754">if</span>&nbsp;<span class="ident" id="2299757">x</span>&nbsp;<span class="op" id="2299759">&lt;</span>&nbsp;<span class="num" id="2299761">0</span>&nbsp;<span class="op" id="2299763">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299767">absx</span>&nbsp;<span class="op" id="2299772">=</span>&nbsp;<span class="op" id="2299774">-</span><span class="ident" id="2299775">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299782">sign</span>&nbsp;<span class="op" id="2299787">=</span>&nbsp;<span class="builtintype" id="2299789">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299799">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299828">if</span>&nbsp;<span class="ident" id="2299831">absx</span>&nbsp;<span class="op" id="2299836">&gt;=</span>&nbsp;<span class="ident" id="2299839">Ln2X56</span>&nbsp;<span class="op" id="2299846">{</span>&nbsp;<span class="comment" id="2299848">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299872">if</span>&nbsp;<span class="ident" id="2299875">absx</span>&nbsp;<span class="op" id="2299880">&gt;=</span>&nbsp;<span class="ident" id="2299883">Othreshold</span>&nbsp;<span class="op" id="2299894">{</span>&nbsp;<span class="comment" id="2299896">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299922">return</span>&nbsp;<span class="ident" id="2299929">Inf</span><span class="op" id="2299932">(</span><span class="num" id="2299933">1</span><span class="op" id="2299934">)</span>&nbsp;<span class="comment" id="2299936">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299954">if</span>&nbsp;<span class="ident" id="2299957">sign</span>&nbsp;<span class="op" id="2299962">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299967">return</span>&nbsp;<span class="op" id="2299974">-</span><span class="num" id="2299975">1</span>&nbsp;<span class="comment" id="2299977">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2300014">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300037">var</span>&nbsp;<span class="ident" id="2300041">c</span>&nbsp;<span class="builtintype" id="2300043">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300052">var</span>&nbsp;<span class="ident" id="2300056">k</span>&nbsp;<span class="builtintype" id="2300058">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300063">if</span>&nbsp;<span class="ident" id="2300066">absx</span>&nbsp;<span class="op" id="2300071">&gt;</span>&nbsp;<span class="ident" id="2300073">Ln2Half</span>&nbsp;<span class="op" id="2300081">{</span>&nbsp;<span class="comment" id="2300083">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300108">var</span>&nbsp;<span class="ident" id="2300112">hi</span><span class="op" id="2300114">,</span>&nbsp;<span class="ident" id="2300116">lo</span>&nbsp;<span class="builtintype" id="2300119">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300129">if</span>&nbsp;<span class="ident" id="2300132">absx</span>&nbsp;<span class="op" id="2300137">&lt;</span>&nbsp;<span class="ident" id="2300139">Ln2HalfX3</span>&nbsp;<span class="op" id="2300149">{</span>&nbsp;<span class="comment" id="2300151">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300177">if</span>&nbsp;<span class="op" id="2300180">!</span><span class="ident" id="2300181">sign</span>&nbsp;<span class="op" id="2300186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300192">hi</span>&nbsp;<span class="op" id="2300195">=</span>&nbsp;<span class="ident" id="2300197">x</span>&nbsp;<span class="op" id="2300199">-</span>&nbsp;<span class="ident" id="2300201">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300211">lo</span>&nbsp;<span class="op" id="2300214">=</span>&nbsp;<span class="ident" id="2300216">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300226">k</span>&nbsp;<span class="op" id="2300228">=</span>&nbsp;<span class="num" id="2300230">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300235">}</span>&nbsp;<span class="keyword" id="2300237">else</span>&nbsp;<span class="op" id="2300242">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300248">hi</span>&nbsp;<span class="op" id="2300251">=</span>&nbsp;<span class="ident" id="2300253">x</span>&nbsp;<span class="op" id="2300255">+</span>&nbsp;<span class="ident" id="2300257">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300267">lo</span>&nbsp;<span class="op" id="2300270">=</span>&nbsp;<span class="op" id="2300272">-</span><span class="ident" id="2300273">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300283">k</span>&nbsp;<span class="op" id="2300285">=</span>&nbsp;<span class="op" id="2300287">-</span><span class="num" id="2300288">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300297">}</span>&nbsp;<span class="keyword" id="2300299">else</span>&nbsp;<span class="op" id="2300304">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300309">if</span>&nbsp;<span class="op" id="2300312">!</span><span class="ident" id="2300313">sign</span>&nbsp;<span class="op" id="2300318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300324">k</span>&nbsp;<span class="op" id="2300326">=</span>&nbsp;<span class="builtintype" id="2300328">int</span><span class="op" id="2300331">(</span><span class="ident" id="2300332">InvLn2</span><span class="op" id="2300338">*</span><span class="ident" id="2300339">x</span>&nbsp;<span class="op" id="2300341">+</span>&nbsp;<span class="num" id="2300343">0.5</span><span class="op" id="2300346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300351">}</span>&nbsp;<span class="keyword" id="2300353">else</span>&nbsp;<span class="op" id="2300358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300364">k</span>&nbsp;<span class="op" id="2300366">=</span>&nbsp;<span class="builtintype" id="2300368">int</span><span class="op" id="2300371">(</span><span class="ident" id="2300372">InvLn2</span><span class="op" id="2300378">*</span><span class="ident" id="2300379">x</span>&nbsp;<span class="op" id="2300381">-</span>&nbsp;<span class="num" id="2300383">0.5</span><span class="op" id="2300386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300391">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300396">t</span>&nbsp;<span class="op" id="2300398">:=</span>&nbsp;<span class="builtintype" id="2300401">float64</span><span class="op" id="2300408">(</span><span class="ident" id="2300409">k</span><span class="op" id="2300410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300415">hi</span>&nbsp;<span class="op" id="2300418">=</span>&nbsp;<span class="ident" id="2300420">x</span>&nbsp;<span class="op" id="2300422">-</span>&nbsp;<span class="ident" id="2300424">t</span><span class="op" id="2300425">*</span><span class="ident" id="2300426">Ln2Hi</span>&nbsp;<span class="comment" id="2300432">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300462">lo</span>&nbsp;<span class="op" id="2300465">=</span>&nbsp;<span class="ident" id="2300467">t</span>&nbsp;<span class="op" id="2300469">*</span>&nbsp;<span class="ident" id="2300471">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300483">x</span>&nbsp;<span class="op" id="2300485">=</span>&nbsp;<span class="ident" id="2300487">hi</span>&nbsp;<span class="op" id="2300490">-</span>&nbsp;<span class="ident" id="2300492">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300497">c</span>&nbsp;<span class="op" id="2300499">=</span>&nbsp;<span class="op" id="2300501">(</span><span class="ident" id="2300502">hi</span>&nbsp;<span class="op" id="2300505">-</span>&nbsp;<span class="ident" id="2300507">x</span><span class="op" id="2300508">)</span>&nbsp;<span class="op" id="2300510">-</span>&nbsp;<span class="ident" id="2300512">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300516">}</span>&nbsp;<span class="keyword" id="2300518">else</span>&nbsp;<span class="keyword" id="2300523">if</span>&nbsp;<span class="ident" id="2300526">absx</span>&nbsp;<span class="op" id="2300531">&lt;</span>&nbsp;<span class="ident" id="2300533">Tiny</span>&nbsp;<span class="op" id="2300538">{</span>&nbsp;<span class="comment" id="2300540">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300573">return</span>&nbsp;<span class="ident" id="2300580">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300583">}</span>&nbsp;<span class="keyword" id="2300585">else</span>&nbsp;<span class="op" id="2300590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300594">k</span>&nbsp;<span class="op" id="2300596">=</span>&nbsp;<span class="num" id="2300598">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2300605">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300635">hfx</span>&nbsp;<span class="op" id="2300639">:=</span>&nbsp;<span class="num" id="2300642">0.5</span>&nbsp;<span class="op" id="2300646">*</span>&nbsp;<span class="ident" id="2300648">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300651">hxs</span>&nbsp;<span class="op" id="2300655">:=</span>&nbsp;<span class="ident" id="2300658">x</span>&nbsp;<span class="op" id="2300660">*</span>&nbsp;<span class="ident" id="2300662">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300667">r1</span>&nbsp;<span class="op" id="2300670">:=</span>&nbsp;<span class="num" id="2300673">1</span>&nbsp;<span class="op" id="2300675">+</span>&nbsp;<span class="ident" id="2300677">hxs</span><span class="op" id="2300680">*</span><span class="op" id="2300681">(</span><span class="ident" id="2300682">Q1</span><span class="op" id="2300684">+</span><span class="ident" id="2300685">hxs</span><span class="op" id="2300688">*</span><span class="op" id="2300689">(</span><span class="ident" id="2300690">Q2</span><span class="op" id="2300692">+</span><span class="ident" id="2300693">hxs</span><span class="op" id="2300696">*</span><span class="op" id="2300697">(</span><span class="ident" id="2300698">Q3</span><span class="op" id="2300700">+</span><span class="ident" id="2300701">hxs</span><span class="op" id="2300704">*</span><span class="op" id="2300705">(</span><span class="ident" id="2300706">Q4</span><span class="op" id="2300708">+</span><span class="ident" id="2300709">hxs</span><span class="op" id="2300712">*</span><span class="ident" id="2300713">Q5</span><span class="op" id="2300715">)</span><span class="op" id="2300716">)</span><span class="op" id="2300717">)</span><span class="op" id="2300718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300721">t</span>&nbsp;<span class="op" id="2300723">:=</span>&nbsp;<span class="num" id="2300726">3</span>&nbsp;<span class="op" id="2300728">-</span>&nbsp;<span class="ident" id="2300730">r1</span><span class="op" id="2300732">*</span><span class="ident" id="2300733">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300738">e</span>&nbsp;<span class="op" id="2300740">:=</span>&nbsp;<span class="ident" id="2300743">hxs</span>&nbsp;<span class="op" id="2300747">*</span>&nbsp;<span class="op" id="2300749">(</span><span class="op" id="2300750">(</span><span class="ident" id="2300751">r1</span>&nbsp;<span class="op" id="2300754">-</span>&nbsp;<span class="ident" id="2300756">t</span><span class="op" id="2300757">)</span>&nbsp;<span class="op" id="2300759">/</span>&nbsp;<span class="op" id="2300761">(</span><span class="num" id="2300762">6.0</span>&nbsp;<span class="op" id="2300766">-</span>&nbsp;<span class="ident" id="2300768">x</span><span class="op" id="2300769">*</span><span class="ident" id="2300770">t</span><span class="op" id="2300771">)</span><span class="op" id="2300772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300775">if</span>&nbsp;<span class="ident" id="2300778">k</span>&nbsp;<span class="op" id="2300780">!=</span>&nbsp;<span class="num" id="2300783">0</span>&nbsp;<span class="op" id="2300785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300789">e</span>&nbsp;<span class="op" id="2300791">=</span>&nbsp;<span class="op" id="2300793">(</span><span class="ident" id="2300794">x</span><span class="op" id="2300795">*</span><span class="op" id="2300796">(</span><span class="ident" id="2300797">e</span><span class="op" id="2300798">-</span><span class="ident" id="2300799">c</span><span class="op" id="2300800">)</span>&nbsp;<span class="op" id="2300802">-</span>&nbsp;<span class="ident" id="2300804">c</span><span class="op" id="2300805">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300809">e</span>&nbsp;<span class="op" id="2300811">-=</span>&nbsp;<span class="ident" id="2300814">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300820">switch</span>&nbsp;<span class="op" id="2300827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300831">case</span>&nbsp;<span class="ident" id="2300836">k</span>&nbsp;<span class="op" id="2300838">==</span>&nbsp;<span class="op" id="2300841">-</span><span class="num" id="2300842">1</span><span class="op" id="2300843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300848">return</span>&nbsp;<span class="num" id="2300855">0.5</span><span class="op" id="2300858">*</span><span class="op" id="2300859">(</span><span class="ident" id="2300860">x</span><span class="op" id="2300861">-</span><span class="ident" id="2300862">e</span><span class="op" id="2300863">)</span>&nbsp;<span class="op" id="2300865">-</span>&nbsp;<span class="num" id="2300867">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300873">case</span>&nbsp;<span class="ident" id="2300878">k</span>&nbsp;<span class="op" id="2300880">==</span>&nbsp;<span class="num" id="2300883">1</span><span class="op" id="2300884">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300889">if</span>&nbsp;<span class="ident" id="2300892">x</span>&nbsp;<span class="op" id="2300894">&lt;</span>&nbsp;<span class="op" id="2300896">-</span><span class="num" id="2300897">0.25</span>&nbsp;<span class="op" id="2300902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300908">return</span>&nbsp;<span class="op" id="2300915">-</span><span class="num" id="2300916">2</span>&nbsp;<span class="op" id="2300918">*</span>&nbsp;<span class="op" id="2300920">(</span><span class="ident" id="2300921">e</span>&nbsp;<span class="op" id="2300923">-</span>&nbsp;<span class="op" id="2300925">(</span><span class="ident" id="2300926">x</span>&nbsp;<span class="op" id="2300928">+</span>&nbsp;<span class="num" id="2300930">0.5</span><span class="op" id="2300933">)</span><span class="op" id="2300934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300944">return</span>&nbsp;<span class="num" id="2300951">1</span>&nbsp;<span class="op" id="2300953">+</span>&nbsp;<span class="num" id="2300955">2</span><span class="op" id="2300956">*</span><span class="op" id="2300957">(</span><span class="ident" id="2300958">x</span><span class="op" id="2300959">-</span><span class="ident" id="2300960">e</span><span class="op" id="2300961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300965">case</span>&nbsp;<span class="ident" id="2300970">k</span>&nbsp;<span class="op" id="2300972">&lt;=</span>&nbsp;<span class="op" id="2300975">-</span><span class="num" id="2300976">2</span>&nbsp;<span class="op" id="2300978">||</span>&nbsp;<span class="ident" id="2300981">k</span>&nbsp;<span class="op" id="2300983">&gt;</span>&nbsp;<span class="num" id="2300985">56</span><span class="op" id="2300987">:</span>&nbsp;<span class="comment" id="2300989">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301022">y</span>&nbsp;<span class="op" id="2301024">:=</span>&nbsp;<span class="num" id="2301027">1</span>&nbsp;<span class="op" id="2301029">-</span>&nbsp;<span class="op" id="2301031">(</span><span class="ident" id="2301032">e</span>&nbsp;<span class="op" id="2301034">-</span>&nbsp;<span class="ident" id="2301036">x</span><span class="op" id="2301037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301042">y</span>&nbsp;<span class="op" id="2301044">=</span>&nbsp;<span class="ident" id="2301046">Float64frombits</span><span class="op" id="2301061">(</span><span class="ident" id="2301062">Float64bits</span><span class="op" id="2301073">(</span><span class="ident" id="2301074">y</span><span class="op" id="2301075">)</span>&nbsp;<span class="op" id="2301077">+</span>&nbsp;<span class="ident" id="2301079">uint64</span><span class="op" id="2301085">(</span><span class="ident" id="2301086">k</span><span class="op" id="2301087">)</span><span class="op" id="2301088">&lt;&lt;</span><span class="num" id="2301090">52</span><span class="op" id="2301092">)</span>&nbsp;<span class="comment" id="2301094">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301122">return</span>&nbsp;<span class="ident" id="2301129">y</span>&nbsp;<span class="op" id="2301131">-</span>&nbsp;<span class="num" id="2301133">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2301137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301141">if</span>&nbsp;<span class="ident" id="2301144">k</span>&nbsp;<span class="op" id="2301146">&lt;</span>&nbsp;<span class="num" id="2301148">20</span>&nbsp;<span class="op" id="2301151">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301156">t</span>&nbsp;<span class="op" id="2301158">:=</span>&nbsp;<span class="ident" id="2301161">Float64frombits</span><span class="op" id="2301176">(</span><span class="num" id="2301177">0x3ff0000000000000</span>&nbsp;<span class="op" id="2301196">-</span>&nbsp;<span class="op" id="2301198">(</span><span class="num" id="2301199">0x20000000000000</span>&nbsp;<span class="op" id="2301216">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2301219">uint</span><span class="op" id="2301223">(</span><span class="ident" id="2301224">k</span><span class="op" id="2301225">)</span><span class="op" id="2301226">)</span><span class="op" id="2301227">)</span>&nbsp;<span class="comment" id="2301229">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301245">y</span>&nbsp;<span class="op" id="2301247">:=</span>&nbsp;<span class="ident" id="2301250">t</span>&nbsp;<span class="op" id="2301252">-</span>&nbsp;<span class="op" id="2301254">(</span><span class="ident" id="2301255">e</span>&nbsp;<span class="op" id="2301257">-</span>&nbsp;<span class="ident" id="2301259">x</span><span class="op" id="2301260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301265">y</span>&nbsp;<span class="op" id="2301267">=</span>&nbsp;<span class="ident" id="2301269">Float64frombits</span><span class="op" id="2301284">(</span><span class="ident" id="2301285">Float64bits</span><span class="op" id="2301296">(</span><span class="ident" id="2301297">y</span><span class="op" id="2301298">)</span>&nbsp;<span class="op" id="2301300">+</span>&nbsp;<span class="ident" id="2301302">uint64</span><span class="op" id="2301308">(</span><span class="ident" id="2301309">k</span><span class="op" id="2301310">)</span><span class="op" id="2301311">&lt;&lt;</span><span class="num" id="2301313">52</span><span class="op" id="2301315">)</span>&nbsp;<span class="comment" id="2301317">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301345">return</span>&nbsp;<span class="ident" id="2301352">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2301356">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301360">t</span>&nbsp;<span class="op" id="2301362">:=</span>&nbsp;<span class="ident" id="2301365">Float64frombits</span><span class="op" id="2301380">(</span><span class="ident" id="2301381">uint64</span><span class="op" id="2301387">(</span><span class="op" id="2301388">(</span><span class="num" id="2301389">0x3ff</span>&nbsp;<span class="op" id="2301395">-</span>&nbsp;<span class="ident" id="2301397">k</span><span class="op" id="2301398">)</span>&nbsp;<span class="op" id="2301400">&lt;&lt;</span>&nbsp;<span class="num" id="2301403">52</span><span class="op" id="2301405">)</span><span class="op" id="2301406">)</span>&nbsp;<span class="comment" id="2301408">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301419">y</span>&nbsp;<span class="op" id="2301421">:=</span>&nbsp;<span class="ident" id="2301424">x</span>&nbsp;<span class="op" id="2301426">-</span>&nbsp;<span class="op" id="2301428">(</span><span class="ident" id="2301429">e</span>&nbsp;<span class="op" id="2301431">+</span>&nbsp;<span class="ident" id="2301433">t</span><span class="op" id="2301434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301438">y</span>&nbsp;<span class="op" id="2301440">+=</span>&nbsp;<span class="num" id="2301443">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301447">y</span>&nbsp;<span class="op" id="2301449">=</span>&nbsp;<span class="ident" id="2301451">Float64frombits</span><span class="op" id="2301466">(</span><span class="ident" id="2301467">Float64bits</span><span class="op" id="2301478">(</span><span class="ident" id="2301479">y</span><span class="op" id="2301480">)</span>&nbsp;<span class="op" id="2301482">+</span>&nbsp;<span class="ident" id="2301484">uint64</span><span class="op" id="2301490">(</span><span class="ident" id="2301491">k</span><span class="op" id="2301492">)</span><span class="op" id="2301493">&lt;&lt;</span><span class="num" id="2301495">52</span><span class="op" id="2301497">)</span>&nbsp;<span class="comment" id="2301499">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301526">return</span>&nbsp;<span class="ident" id="2301533">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2301536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301539">return</span>&nbsp;<span class="ident" id="2301546">x</span>&nbsp;<span class="op" id="2301548">-</span>&nbsp;<span class="op" id="2301550">(</span><span class="ident" id="2301551">x</span><span class="op" id="2301552">*</span><span class="ident" id="2301553">e</span>&nbsp;<span class="op" id="2301555">-</span>&nbsp;<span class="ident" id="2301557">hxs</span><span class="op" id="2301560">)</span>&nbsp;<span class="comment" id="2301562">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2301572">}</span>
</div>
</body>
</html>
