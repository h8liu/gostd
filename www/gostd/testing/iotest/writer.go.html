<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5872167">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5872222">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5872276">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5872327">package</span>&nbsp;<span class="ident" id="5872335">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5872343">import</span>&nbsp;<span class="string" id="5872350">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5872356">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="5872408">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5872445">func</span>&nbsp;<span class="ident" id="5872450">TruncateWriter</span><span class="op" id="5872464">(</span><span class="ident" id="5872465">w</span>&nbsp;<span class="ident" id="5872467">io</span><span class="op" id="5872469">.</span><span class="ident" id="5872470">Writer</span><span class="op" id="5872476">,</span>&nbsp;<span class="ident" id="5872478">n</span>&nbsp;<span class="ident" id="5872480">int64</span><span class="op" id="5872485">)</span>&nbsp;<span class="ident" id="5872487">io</span><span class="op" id="5872489">.</span><span class="ident" id="5872490">Writer</span>&nbsp;<span class="op" id="5872497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5872500">return</span>&nbsp;<span class="op" id="5872507">&amp;</span><span class="ident" id="5872508">truncateWriter</span><span class="op" id="5872522">{</span><span class="ident" id="5872523">w</span><span class="op" id="5872524">,</span>&nbsp;<span class="ident" id="5872526">n</span><span class="op" id="5872527">}</span><br>
<span class="lineno"></span><span class="op" id="5872529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5872532">type</span>&nbsp;<span class="ident" id="5872537">truncateWriter</span>&nbsp;<span class="keyword" id="5872552">struct</span>&nbsp;<span class="op" id="5872559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872562">w</span>&nbsp;<span class="ident" id="5872564">io</span><span class="op" id="5872566">.</span><span class="ident" id="5872567">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872575">n</span>&nbsp;<span class="ident" id="5872577">int64</span><br>
<span class="lineno"></span><span class="op" id="5872583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5872586">func</span>&nbsp;<span class="op" id="5872591">(</span><span class="ident" id="5872592">t</span>&nbsp;<span class="op" id="5872594">*</span><span class="ident" id="5872595">truncateWriter</span><span class="op" id="5872609">)</span>&nbsp;<span class="ident" id="5872611">Write</span><span class="op" id="5872616">(</span><span class="ident" id="5872617">p</span>&nbsp;<span class="op" id="5872619">[</span><span class="op" id="5872620">]</span><span class="builtintype" id="5872621">byte</span><span class="op" id="5872625">)</span>&nbsp;<span class="op" id="5872627">(</span><span class="ident" id="5872628">n</span>&nbsp;<span class="builtintype" id="5872630">int</span><span class="op" id="5872633">,</span>&nbsp;<span class="ident" id="5872635">err</span>&nbsp;<span class="builtintype" id="5872639">error</span><span class="op" id="5872644">)</span>&nbsp;<span class="op" id="5872646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5872649">if</span>&nbsp;<span class="ident" id="5872652">t</span><span class="op" id="5872653">.</span><span class="ident" id="5872654">n</span>&nbsp;<span class="op" id="5872656">&lt;=</span>&nbsp;<span class="num" id="5872659">0</span>&nbsp;<span class="op" id="5872661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5872665">return</span>&nbsp;<span class="builtinfunc" id="5872672">len</span><span class="op" id="5872675">(</span><span class="ident" id="5872676">p</span><span class="op" id="5872677">)</span><span class="op" id="5872678">,</span>&nbsp;<span class="ident" id="5872680">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5872685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5872688">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872703">n</span>&nbsp;<span class="op" id="5872705">=</span>&nbsp;<span class="builtinfunc" id="5872707">len</span><span class="op" id="5872710">(</span><span class="ident" id="5872711">p</span><span class="op" id="5872712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5872715">if</span>&nbsp;<span class="ident" id="5872718">int64</span><span class="op" id="5872723">(</span><span class="ident" id="5872724">n</span><span class="op" id="5872725">)</span>&nbsp;<span class="op" id="5872727">&gt;</span>&nbsp;<span class="ident" id="5872729">t</span><span class="op" id="5872730">.</span><span class="ident" id="5872731">n</span>&nbsp;<span class="op" id="5872733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872737">n</span>&nbsp;<span class="op" id="5872739">=</span>&nbsp;<span class="builtintype" id="5872741">int</span><span class="op" id="5872744">(</span><span class="ident" id="5872745">t</span><span class="op" id="5872746">.</span><span class="ident" id="5872747">n</span><span class="op" id="5872748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5872751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872754">n</span><span class="op" id="5872755">,</span>&nbsp;<span class="ident" id="5872757">err</span>&nbsp;<span class="op" id="5872761">=</span>&nbsp;<span class="ident" id="5872763">t</span><span class="op" id="5872764">.</span><span class="ident" id="5872765">w</span><span class="op" id="5872766">.</span><span class="ident" id="5872767">Write</span><span class="op" id="5872772">(</span><span class="ident" id="5872773">p</span><span class="op" id="5872774">[</span><span class="num" id="5872775">0</span><span class="op" id="5872776">:</span><span class="ident" id="5872777">n</span><span class="op" id="5872778">]</span><span class="op" id="5872779">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872782">t</span><span class="op" id="5872783">.</span><span class="ident" id="5872784">n</span>&nbsp;<span class="op" id="5872786">-=</span>&nbsp;<span class="ident" id="5872789">int64</span><span class="op" id="5872794">(</span><span class="ident" id="5872795">n</span><span class="op" id="5872796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5872799">if</span>&nbsp;<span class="ident" id="5872802">err</span>&nbsp;<span class="op" id="5872806">==</span>&nbsp;<span class="ident" id="5872809">nil</span>&nbsp;<span class="op" id="5872813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5872817">n</span>&nbsp;<span class="op" id="5872819">=</span>&nbsp;<span class="builtinfunc" id="5872821">len</span><span class="op" id="5872824">(</span><span class="ident" id="5872825">p</span><span class="op" id="5872826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5872829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5872832">return</span><br>
<span class="lineno">35</span><span class="op" id="5872839">}</span>
</div>
</body>
</html>
