<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6531431">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6531486">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6531540">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6531591">package</span>&nbsp;<span class="ident" id="6531599">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6531604">import</span>&nbsp;<span class="op" id="6531611">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531614">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531623">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531630">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531639">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531654">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531660">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531673">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531679">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531690">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6531700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6531703">var</span>&nbsp;<span class="ident" id="6531707">filenames</span>&nbsp;<span class="op" id="6531717">=</span>&nbsp;<span class="op" id="6531719">[</span><span class="op" id="6531720">]</span><span class="builtintype" id="6531721">string</span><span class="op" id="6531727">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531730">&#34;basn0g01&#34;</span><span class="op" id="6531740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531743">&#34;basn0g01-30&#34;</span><span class="op" id="6531756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531759">&#34;basn0g02&#34;</span><span class="op" id="6531769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531772">&#34;basn0g02-29&#34;</span><span class="op" id="6531785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531788">&#34;basn0g04&#34;</span><span class="op" id="6531798">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531801">&#34;basn0g04-31&#34;</span><span class="op" id="6531814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531817">&#34;basn0g08&#34;</span><span class="op" id="6531827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531830">&#34;basn0g16&#34;</span><span class="op" id="6531840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531843">&#34;basn2c08&#34;</span><span class="op" id="6531853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531856">&#34;basn2c16&#34;</span><span class="op" id="6531866">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531869">&#34;basn3p01&#34;</span><span class="op" id="6531879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531882">&#34;basn3p02&#34;</span><span class="op" id="6531892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531895">&#34;basn3p04&#34;</span><span class="op" id="6531905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531908">&#34;basn3p04-31i&#34;</span><span class="op" id="6531922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531925">&#34;basn3p08&#34;</span><span class="op" id="6531935">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531938">&#34;basn3p08-trns&#34;</span><span class="op" id="6531953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531956">&#34;basn4a08&#34;</span><span class="op" id="6531966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531969">&#34;basn4a16&#34;</span><span class="op" id="6531979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531982">&#34;basn6a08&#34;</span><span class="op" id="6531992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531995">&#34;basn6a16&#34;</span><span class="op" id="6532005">,</span><br>
<span class="lineno">40</span><span class="op" id="6532007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6532010">var</span>&nbsp;<span class="ident" id="6532014">filenamesPaletted</span>&nbsp;<span class="op" id="6532032">=</span>&nbsp;<span class="op" id="6532034">[</span><span class="op" id="6532035">]</span><span class="builtintype" id="6532036">string</span><span class="op" id="6532042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532045">&#34;basn3p01&#34;</span><span class="op" id="6532055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532058">&#34;basn3p02&#34;</span><span class="op" id="6532068">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532071">&#34;basn3p04&#34;</span><span class="op" id="6532081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532084">&#34;basn3p08&#34;</span><span class="op" id="6532094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532097">&#34;basn3p08-trns&#34;</span><span class="op" id="6532112">,</span><br>
<span class="lineno"></span><span class="op" id="6532114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6532117">var</span>&nbsp;<span class="ident" id="6532121">filenamesShort</span>&nbsp;<span class="op" id="6532136">=</span>&nbsp;<span class="op" id="6532138">[</span><span class="op" id="6532139">]</span><span class="builtintype" id="6532140">string</span><span class="op" id="6532146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532149">&#34;basn0g01&#34;</span><span class="op" id="6532159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532162">&#34;basn0g04-31&#34;</span><span class="op" id="6532175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6532178">&#34;basn6a16&#34;</span><span class="op" id="6532188">,</span><br>
<span class="lineno"></span><span class="op" id="6532190">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6532193">func</span>&nbsp;<span class="ident" id="6532198">readPNG</span><span class="op" id="6532205">(</span><span class="ident" id="6532206">filename</span>&nbsp;<span class="builtintype" id="6532215">string</span><span class="op" id="6532221">)</span>&nbsp;<span class="op" id="6532223">(</span><span class="ident" id="6532224">image</span><span class="op" id="6532229">.</span><span class="ident" id="6532230">Image</span><span class="op" id="6532235">,</span>&nbsp;<span class="builtintype" id="6532237">error</span><span class="op" id="6532242">)</span>&nbsp;<span class="op" id="6532244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532247">f</span><span class="op" id="6532248">,</span>&nbsp;<span class="ident" id="6532250">err</span>&nbsp;<span class="op" id="6532254">:=</span>&nbsp;<span class="ident" id="6532257">os</span><span class="op" id="6532259">.</span><span class="ident" id="6532260">Open</span><span class="op" id="6532264">(</span><span class="ident" id="6532265">filename</span><span class="op" id="6532273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532276">if</span>&nbsp;<span class="ident" id="6532279">err</span>&nbsp;<span class="op" id="6532283">!=</span>&nbsp;<span class="ident" id="6532286">nil</span>&nbsp;<span class="op" id="6532290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532294">return</span>&nbsp;<span class="ident" id="6532301">nil</span><span class="op" id="6532304">,</span>&nbsp;<span class="ident" id="6532306">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532314">defer</span>&nbsp;<span class="ident" id="6532320">f</span><span class="op" id="6532321">.</span><span class="ident" id="6532322">Close</span><span class="op" id="6532327">(</span><span class="op" id="6532328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532331">return</span>&nbsp;<span class="ident" id="6532338">Decode</span><span class="op" id="6532344">(</span><span class="ident" id="6532345">f</span><span class="op" id="6532346">)</span><br>
<span class="lineno"></span><span class="op" id="6532348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6532351">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="6532401">func</span>&nbsp;<span class="ident" id="6532406">sng</span><span class="op" id="6532409">(</span><span class="ident" id="6532410">w</span>&nbsp;<span class="ident" id="6532412">io</span><span class="op" id="6532414">.</span><span class="ident" id="6532415">WriteCloser</span><span class="op" id="6532426">,</span>&nbsp;<span class="ident" id="6532428">filename</span>&nbsp;<span class="builtintype" id="6532437">string</span><span class="op" id="6532443">,</span>&nbsp;<span class="ident" id="6532445">png</span>&nbsp;<span class="ident" id="6532449">image</span><span class="op" id="6532454">.</span><span class="ident" id="6532455">Image</span><span class="op" id="6532460">)</span>&nbsp;<span class="op" id="6532462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532465">defer</span>&nbsp;<span class="ident" id="6532471">w</span><span class="op" id="6532472">.</span><span class="ident" id="6532473">Close</span><span class="op" id="6532478">(</span><span class="op" id="6532479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532482">bounds</span>&nbsp;<span class="op" id="6532489">:=</span>&nbsp;<span class="ident" id="6532492">png</span><span class="op" id="6532495">.</span><span class="ident" id="6532496">Bounds</span><span class="op" id="6532502">(</span><span class="op" id="6532503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532506">cm</span>&nbsp;<span class="op" id="6532509">:=</span>&nbsp;<span class="ident" id="6532512">png</span><span class="op" id="6532515">.</span><span class="ident" id="6532516">ColorModel</span><span class="op" id="6532526">(</span><span class="op" id="6532527">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532530">var</span>&nbsp;<span class="ident" id="6532534">bitdepth</span>&nbsp;<span class="builtintype" id="6532543">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532548">switch</span>&nbsp;<span class="ident" id="6532555">cm</span>&nbsp;<span class="op" id="6532558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532561">case</span>&nbsp;<span class="ident" id="6532566">color</span><span class="op" id="6532571">.</span><span class="ident" id="6532572">RGBAModel</span><span class="op" id="6532581">,</span>&nbsp;<span class="ident" id="6532583">color</span><span class="op" id="6532588">.</span><span class="ident" id="6532589">NRGBAModel</span><span class="op" id="6532599">,</span>&nbsp;<span class="ident" id="6532601">color</span><span class="op" id="6532606">.</span><span class="ident" id="6532607">AlphaModel</span><span class="op" id="6532617">,</span>&nbsp;<span class="ident" id="6532619">color</span><span class="op" id="6532624">.</span><span class="ident" id="6532625">GrayModel</span><span class="op" id="6532634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532638">bitdepth</span>&nbsp;<span class="op" id="6532647">=</span>&nbsp;<span class="num" id="6532649">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532652">default</span><span class="op" id="6532659">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532663">bitdepth</span>&nbsp;<span class="op" id="6532672">=</span>&nbsp;<span class="num" id="6532674">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532681">cpm</span><span class="op" id="6532684">,</span>&nbsp;<span class="ident" id="6532686">_</span>&nbsp;<span class="op" id="6532688">:=</span>&nbsp;<span class="ident" id="6532691">cm</span><span class="op" id="6532693">.</span><span class="op" id="6532694">(</span><span class="ident" id="6532695">color</span><span class="op" id="6532700">.</span><span class="ident" id="6532701">Palette</span><span class="op" id="6532708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532711">var</span>&nbsp;<span class="ident" id="6532715">paletted</span>&nbsp;<span class="op" id="6532724">*</span><span class="ident" id="6532725">image</span><span class="op" id="6532730">.</span><span class="ident" id="6532731">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532741">if</span>&nbsp;<span class="ident" id="6532744">cpm</span>&nbsp;<span class="op" id="6532748">!=</span>&nbsp;<span class="ident" id="6532751">nil</span>&nbsp;<span class="op" id="6532755">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532759">switch</span>&nbsp;<span class="op" id="6532766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532770">case</span>&nbsp;<span class="builtinfunc" id="6532775">len</span><span class="op" id="6532778">(</span><span class="ident" id="6532779">cpm</span><span class="op" id="6532782">)</span>&nbsp;<span class="op" id="6532784">&lt;=</span>&nbsp;<span class="num" id="6532787">2</span><span class="op" id="6532788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532793">bitdepth</span>&nbsp;<span class="op" id="6532802">=</span>&nbsp;<span class="num" id="6532804">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532808">case</span>&nbsp;<span class="builtinfunc" id="6532813">len</span><span class="op" id="6532816">(</span><span class="ident" id="6532817">cpm</span><span class="op" id="6532820">)</span>&nbsp;<span class="op" id="6532822">&lt;=</span>&nbsp;<span class="num" id="6532825">4</span><span class="op" id="6532826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532831">bitdepth</span>&nbsp;<span class="op" id="6532840">=</span>&nbsp;<span class="num" id="6532842">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532846">case</span>&nbsp;<span class="builtinfunc" id="6532851">len</span><span class="op" id="6532854">(</span><span class="ident" id="6532855">cpm</span><span class="op" id="6532858">)</span>&nbsp;<span class="op" id="6532860">&lt;=</span>&nbsp;<span class="num" id="6532863">16</span><span class="op" id="6532865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532870">bitdepth</span>&nbsp;<span class="op" id="6532879">=</span>&nbsp;<span class="num" id="6532881">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532885">default</span><span class="op" id="6532892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532897">bitdepth</span>&nbsp;<span class="op" id="6532906">=</span>&nbsp;<span class="num" id="6532908">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532912">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532916">paletted</span>&nbsp;<span class="op" id="6532925">=</span>&nbsp;<span class="ident" id="6532927">png</span><span class="op" id="6532930">.</span><span class="op" id="6532931">(</span><span class="op" id="6532932">*</span><span class="ident" id="6532933">image</span><span class="op" id="6532938">.</span><span class="ident" id="6532939">Paletted</span><span class="op" id="6532947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6532954">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532987">io</span><span class="op" id="6532989">.</span><span class="ident" id="6532990">WriteString</span><span class="op" id="6533001">(</span><span class="ident" id="6533002">w</span><span class="op" id="6533003">,</span>&nbsp;<span class="string" id="6533005">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="6533018">+</span><span class="ident" id="6533019">filename</span><span class="op" id="6533027">+</span><span class="string" id="6533028">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="6533044">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533047">fmt</span><span class="op" id="6533050">.</span><span class="ident" id="6533051">Fprintf</span><span class="op" id="6533058">(</span><span class="ident" id="6533059">w</span><span class="op" id="6533060">,</span>&nbsp;<span class="string" id="6533062">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="6533106">,</span>&nbsp;<span class="ident" id="6533108">bounds</span><span class="op" id="6533114">.</span><span class="ident" id="6533115">Dx</span><span class="op" id="6533117">(</span><span class="op" id="6533118">)</span><span class="op" id="6533119">,</span>&nbsp;<span class="ident" id="6533121">bounds</span><span class="op" id="6533127">.</span><span class="ident" id="6533128">Dy</span><span class="op" id="6533130">(</span><span class="op" id="6533131">)</span><span class="op" id="6533132">,</span>&nbsp;<span class="ident" id="6533134">bitdepth</span><span class="op" id="6533142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533145">switch</span>&nbsp;<span class="op" id="6533152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533155">case</span>&nbsp;<span class="ident" id="6533160">cm</span>&nbsp;<span class="op" id="6533163">==</span>&nbsp;<span class="ident" id="6533166">color</span><span class="op" id="6533171">.</span><span class="ident" id="6533172">RGBAModel</span><span class="op" id="6533181">,</span>&nbsp;<span class="ident" id="6533183">cm</span>&nbsp;<span class="op" id="6533186">==</span>&nbsp;<span class="ident" id="6533189">color</span><span class="op" id="6533194">.</span><span class="ident" id="6533195">RGBA64Model</span><span class="op" id="6533206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533210">io</span><span class="op" id="6533212">.</span><span class="ident" id="6533213">WriteString</span><span class="op" id="6533224">(</span><span class="ident" id="6533225">w</span><span class="op" id="6533226">,</span>&nbsp;<span class="string" id="6533228">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="6533248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533251">case</span>&nbsp;<span class="ident" id="6533256">cm</span>&nbsp;<span class="op" id="6533259">==</span>&nbsp;<span class="ident" id="6533262">color</span><span class="op" id="6533267">.</span><span class="ident" id="6533268">NRGBAModel</span><span class="op" id="6533278">,</span>&nbsp;<span class="ident" id="6533280">cm</span>&nbsp;<span class="op" id="6533283">==</span>&nbsp;<span class="ident" id="6533286">color</span><span class="op" id="6533291">.</span><span class="ident" id="6533292">NRGBA64Model</span><span class="op" id="6533304">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533308">io</span><span class="op" id="6533310">.</span><span class="ident" id="6533311">WriteString</span><span class="op" id="6533322">(</span><span class="ident" id="6533323">w</span><span class="op" id="6533324">,</span>&nbsp;<span class="string" id="6533326">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="6533352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533355">case</span>&nbsp;<span class="ident" id="6533360">cm</span>&nbsp;<span class="op" id="6533363">==</span>&nbsp;<span class="ident" id="6533366">color</span><span class="op" id="6533371">.</span><span class="ident" id="6533372">GrayModel</span><span class="op" id="6533381">,</span>&nbsp;<span class="ident" id="6533383">cm</span>&nbsp;<span class="op" id="6533386">==</span>&nbsp;<span class="ident" id="6533389">color</span><span class="op" id="6533394">.</span><span class="ident" id="6533395">Gray16Model</span><span class="op" id="6533406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533410">io</span><span class="op" id="6533412">.</span><span class="ident" id="6533413">WriteString</span><span class="op" id="6533424">(</span><span class="ident" id="6533425">w</span><span class="op" id="6533426">,</span>&nbsp;<span class="string" id="6533428">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="6533452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533455">case</span>&nbsp;<span class="ident" id="6533460">cpm</span>&nbsp;<span class="op" id="6533464">!=</span>&nbsp;<span class="ident" id="6533467">nil</span><span class="op" id="6533470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533474">io</span><span class="op" id="6533476">.</span><span class="ident" id="6533477">WriteString</span><span class="op" id="6533488">(</span><span class="ident" id="6533489">w</span><span class="op" id="6533490">,</span>&nbsp;<span class="string" id="6533492">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="6533520">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533523">default</span><span class="op" id="6533530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533534">io</span><span class="op" id="6533536">.</span><span class="ident" id="6533537">WriteString</span><span class="op" id="6533548">(</span><span class="ident" id="6533549">w</span><span class="op" id="6533550">,</span>&nbsp;<span class="string" id="6533552">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="6533587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533593">io</span><span class="op" id="6533595">.</span><span class="ident" id="6533596">WriteString</span><span class="op" id="6533607">(</span><span class="ident" id="6533608">w</span><span class="op" id="6533609">,</span>&nbsp;<span class="string" id="6533611">&#34;}\n&#34;</span><span class="op" id="6533616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6533620">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6533713">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533798">io</span><span class="op" id="6533800">.</span><span class="ident" id="6533801">WriteString</span><span class="op" id="6533812">(</span><span class="ident" id="6533813">w</span><span class="op" id="6533814">,</span>&nbsp;<span class="string" id="6533816">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="6533833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6533837">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533882">if</span>&nbsp;<span class="ident" id="6533885">cpm</span>&nbsp;<span class="op" id="6533889">!=</span>&nbsp;<span class="ident" id="6533892">nil</span>&nbsp;<span class="op" id="6533896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533900">lastAlpha</span>&nbsp;<span class="op" id="6533910">:=</span>&nbsp;<span class="op" id="6533913">-</span><span class="num" id="6533914">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533918">io</span><span class="op" id="6533920">.</span><span class="ident" id="6533921">WriteString</span><span class="op" id="6533932">(</span><span class="ident" id="6533933">w</span><span class="op" id="6533934">,</span>&nbsp;<span class="string" id="6533936">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="6533946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533950">for</span>&nbsp;<span class="ident" id="6533954">i</span><span class="op" id="6533955">,</span>&nbsp;<span class="ident" id="6533957">c</span>&nbsp;<span class="op" id="6533959">:=</span>&nbsp;<span class="keyword" id="6533962">range</span>&nbsp;<span class="ident" id="6533968">cpm</span>&nbsp;<span class="op" id="6533972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533977">var</span>&nbsp;<span class="ident" id="6533981">r</span><span class="op" id="6533982">,</span>&nbsp;<span class="ident" id="6533984">g</span><span class="op" id="6533985">,</span>&nbsp;<span class="ident" id="6533987">b</span><span class="op" id="6533988">,</span>&nbsp;<span class="ident" id="6533990">a</span>&nbsp;<span class="builtintype" id="6533992">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534001">switch</span>&nbsp;<span class="ident" id="6534008">c</span>&nbsp;<span class="op" id="6534010">:=</span>&nbsp;<span class="ident" id="6534013">c</span><span class="op" id="6534014">.</span><span class="op" id="6534015">(</span><span class="keyword" id="6534016">type</span><span class="op" id="6534020">)</span>&nbsp;<span class="op" id="6534022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534027">case</span>&nbsp;<span class="ident" id="6534032">color</span><span class="op" id="6534037">.</span><span class="ident" id="6534038">RGBA</span><span class="op" id="6534042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534048">r</span><span class="op" id="6534049">,</span>&nbsp;<span class="ident" id="6534051">g</span><span class="op" id="6534052">,</span>&nbsp;<span class="ident" id="6534054">b</span><span class="op" id="6534055">,</span>&nbsp;<span class="ident" id="6534057">a</span>&nbsp;<span class="op" id="6534059">=</span>&nbsp;<span class="ident" id="6534061">c</span><span class="op" id="6534062">.</span><span class="ident" id="6534063">R</span><span class="op" id="6534064">,</span>&nbsp;<span class="ident" id="6534066">c</span><span class="op" id="6534067">.</span><span class="ident" id="6534068">G</span><span class="op" id="6534069">,</span>&nbsp;<span class="ident" id="6534071">c</span><span class="op" id="6534072">.</span><span class="ident" id="6534073">B</span><span class="op" id="6534074">,</span>&nbsp;<span class="num" id="6534076">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534084">case</span>&nbsp;<span class="ident" id="6534089">color</span><span class="op" id="6534094">.</span><span class="ident" id="6534095">NRGBA</span><span class="op" id="6534100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534106">r</span><span class="op" id="6534107">,</span>&nbsp;<span class="ident" id="6534109">g</span><span class="op" id="6534110">,</span>&nbsp;<span class="ident" id="6534112">b</span><span class="op" id="6534113">,</span>&nbsp;<span class="ident" id="6534115">a</span>&nbsp;<span class="op" id="6534117">=</span>&nbsp;<span class="ident" id="6534119">c</span><span class="op" id="6534120">.</span><span class="ident" id="6534121">R</span><span class="op" id="6534122">,</span>&nbsp;<span class="ident" id="6534124">c</span><span class="op" id="6534125">.</span><span class="ident" id="6534126">G</span><span class="op" id="6534127">,</span>&nbsp;<span class="ident" id="6534129">c</span><span class="op" id="6534130">.</span><span class="ident" id="6534131">B</span><span class="op" id="6534132">,</span>&nbsp;<span class="ident" id="6534134">c</span><span class="op" id="6534135">.</span><span class="ident" id="6534136">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534141">default</span><span class="op" id="6534148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6534154">panic</span><span class="op" id="6534159">(</span><span class="string" id="6534160">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="6534188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534198">if</span>&nbsp;<span class="ident" id="6534201">a</span>&nbsp;<span class="op" id="6534203">!=</span>&nbsp;<span class="num" id="6534206">0xff</span>&nbsp;<span class="op" id="6534211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534217">lastAlpha</span>&nbsp;<span class="op" id="6534227">=</span>&nbsp;<span class="ident" id="6534229">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534239">fmt</span><span class="op" id="6534242">.</span><span class="ident" id="6534243">Fprintf</span><span class="op" id="6534250">(</span><span class="ident" id="6534251">w</span><span class="op" id="6534252">,</span>&nbsp;<span class="string" id="6534254">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="6534310">,</span>&nbsp;<span class="ident" id="6534312">r</span><span class="op" id="6534313">,</span>&nbsp;<span class="ident" id="6534315">g</span><span class="op" id="6534316">,</span>&nbsp;<span class="ident" id="6534318">b</span><span class="op" id="6534319">,</span>&nbsp;<span class="ident" id="6534321">r</span><span class="op" id="6534322">,</span>&nbsp;<span class="ident" id="6534324">g</span><span class="op" id="6534325">,</span>&nbsp;<span class="ident" id="6534327">b</span><span class="op" id="6534328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534336">io</span><span class="op" id="6534338">.</span><span class="ident" id="6534339">WriteString</span><span class="op" id="6534350">(</span><span class="ident" id="6534351">w</span><span class="op" id="6534352">,</span>&nbsp;<span class="string" id="6534354">&#34;}\n&#34;</span><span class="op" id="6534359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534363">if</span>&nbsp;<span class="ident" id="6534366">lastAlpha</span>&nbsp;<span class="op" id="6534376">!=</span>&nbsp;<span class="op" id="6534379">-</span><span class="num" id="6534380">1</span>&nbsp;<span class="op" id="6534382">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534387">io</span><span class="op" id="6534389">.</span><span class="ident" id="6534390">WriteString</span><span class="op" id="6534401">(</span><span class="ident" id="6534402">w</span><span class="op" id="6534403">,</span>&nbsp;<span class="string" id="6534405">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="6534415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534420">for</span>&nbsp;<span class="ident" id="6534424">i</span>&nbsp;<span class="op" id="6534426">:=</span>&nbsp;<span class="num" id="6534429">0</span><span class="op" id="6534430">;</span>&nbsp;<span class="ident" id="6534432">i</span>&nbsp;<span class="op" id="6534434">&lt;=</span>&nbsp;<span class="ident" id="6534437">lastAlpha</span><span class="op" id="6534446">;</span>&nbsp;<span class="ident" id="6534448">i</span><span class="op" id="6534449">++</span>&nbsp;<span class="op" id="6534452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534458">_</span><span class="op" id="6534459">,</span>&nbsp;<span class="ident" id="6534461">_</span><span class="op" id="6534462">,</span>&nbsp;<span class="ident" id="6534464">_</span><span class="op" id="6534465">,</span>&nbsp;<span class="ident" id="6534467">a</span>&nbsp;<span class="op" id="6534469">:=</span>&nbsp;<span class="ident" id="6534472">cpm</span><span class="op" id="6534475">[</span><span class="ident" id="6534476">i</span><span class="op" id="6534477">]</span><span class="op" id="6534478">.</span><span class="ident" id="6534479">RGBA</span><span class="op" id="6534483">(</span><span class="op" id="6534484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534490">a</span>&nbsp;<span class="op" id="6534492">&gt;&gt;=</span>&nbsp;<span class="num" id="6534496">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534502">fmt</span><span class="op" id="6534505">.</span><span class="ident" id="6534506">Fprintf</span><span class="op" id="6534513">(</span><span class="ident" id="6534514">w</span><span class="op" id="6534515">,</span>&nbsp;<span class="string" id="6534517">&#34;&nbsp;%d&#34;</span><span class="op" id="6534522">,</span>&nbsp;<span class="ident" id="6534524">a</span><span class="op" id="6534525">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534535">io</span><span class="op" id="6534537">.</span><span class="ident" id="6534538">WriteString</span><span class="op" id="6534549">(</span><span class="ident" id="6534550">w</span><span class="op" id="6534551">,</span>&nbsp;<span class="string" id="6534553">&#34;}\n&#34;</span><span class="op" id="6534558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6534569">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534590">io</span><span class="op" id="6534592">.</span><span class="ident" id="6534593">WriteString</span><span class="op" id="6534604">(</span><span class="ident" id="6534605">w</span><span class="op" id="6534606">,</span>&nbsp;<span class="string" id="6534608">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="6534635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534638">for</span>&nbsp;<span class="ident" id="6534642">y</span>&nbsp;<span class="op" id="6534644">:=</span>&nbsp;<span class="ident" id="6534647">bounds</span><span class="op" id="6534653">.</span><span class="ident" id="6534654">Min</span><span class="op" id="6534657">.</span><span class="ident" id="6534658">Y</span><span class="op" id="6534659">;</span>&nbsp;<span class="ident" id="6534661">y</span>&nbsp;<span class="op" id="6534663">&lt;</span>&nbsp;<span class="ident" id="6534665">bounds</span><span class="op" id="6534671">.</span><span class="ident" id="6534672">Max</span><span class="op" id="6534675">.</span><span class="ident" id="6534676">Y</span><span class="op" id="6534677">;</span>&nbsp;<span class="ident" id="6534679">y</span><span class="op" id="6534680">++</span>&nbsp;<span class="op" id="6534683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534687">switch</span>&nbsp;<span class="op" id="6534694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534698">case</span>&nbsp;<span class="ident" id="6534703">cm</span>&nbsp;<span class="op" id="6534706">==</span>&nbsp;<span class="ident" id="6534709">color</span><span class="op" id="6534714">.</span><span class="ident" id="6534715">GrayModel</span><span class="op" id="6534724">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534729">for</span>&nbsp;<span class="ident" id="6534733">x</span>&nbsp;<span class="op" id="6534735">:=</span>&nbsp;<span class="ident" id="6534738">bounds</span><span class="op" id="6534744">.</span><span class="ident" id="6534745">Min</span><span class="op" id="6534748">.</span><span class="ident" id="6534749">X</span><span class="op" id="6534750">;</span>&nbsp;<span class="ident" id="6534752">x</span>&nbsp;<span class="op" id="6534754">&lt;</span>&nbsp;<span class="ident" id="6534756">bounds</span><span class="op" id="6534762">.</span><span class="ident" id="6534763">Max</span><span class="op" id="6534766">.</span><span class="ident" id="6534767">X</span><span class="op" id="6534768">;</span>&nbsp;<span class="ident" id="6534770">x</span><span class="op" id="6534771">++</span>&nbsp;<span class="op" id="6534774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534780">gray</span>&nbsp;<span class="op" id="6534785">:=</span>&nbsp;<span class="ident" id="6534788">png</span><span class="op" id="6534791">.</span><span class="ident" id="6534792">At</span><span class="op" id="6534794">(</span><span class="ident" id="6534795">x</span><span class="op" id="6534796">,</span>&nbsp;<span class="ident" id="6534798">y</span><span class="op" id="6534799">)</span><span class="op" id="6534800">.</span><span class="op" id="6534801">(</span><span class="ident" id="6534802">color</span><span class="op" id="6534807">.</span><span class="ident" id="6534808">Gray</span><span class="op" id="6534812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534818">fmt</span><span class="op" id="6534821">.</span><span class="ident" id="6534822">Fprintf</span><span class="op" id="6534829">(</span><span class="ident" id="6534830">w</span><span class="op" id="6534831">,</span>&nbsp;<span class="string" id="6534833">&#34;%02x&#34;</span><span class="op" id="6534839">,</span>&nbsp;<span class="ident" id="6534841">gray</span><span class="op" id="6534845">.</span><span class="ident" id="6534846">Y</span><span class="op" id="6534847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534856">case</span>&nbsp;<span class="ident" id="6534861">cm</span>&nbsp;<span class="op" id="6534864">==</span>&nbsp;<span class="ident" id="6534867">color</span><span class="op" id="6534872">.</span><span class="ident" id="6534873">Gray16Model</span><span class="op" id="6534884">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534889">for</span>&nbsp;<span class="ident" id="6534893">x</span>&nbsp;<span class="op" id="6534895">:=</span>&nbsp;<span class="ident" id="6534898">bounds</span><span class="op" id="6534904">.</span><span class="ident" id="6534905">Min</span><span class="op" id="6534908">.</span><span class="ident" id="6534909">X</span><span class="op" id="6534910">;</span>&nbsp;<span class="ident" id="6534912">x</span>&nbsp;<span class="op" id="6534914">&lt;</span>&nbsp;<span class="ident" id="6534916">bounds</span><span class="op" id="6534922">.</span><span class="ident" id="6534923">Max</span><span class="op" id="6534926">.</span><span class="ident" id="6534927">X</span><span class="op" id="6534928">;</span>&nbsp;<span class="ident" id="6534930">x</span><span class="op" id="6534931">++</span>&nbsp;<span class="op" id="6534934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534940">gray16</span>&nbsp;<span class="op" id="6534947">:=</span>&nbsp;<span class="ident" id="6534950">png</span><span class="op" id="6534953">.</span><span class="ident" id="6534954">At</span><span class="op" id="6534956">(</span><span class="ident" id="6534957">x</span><span class="op" id="6534958">,</span>&nbsp;<span class="ident" id="6534960">y</span><span class="op" id="6534961">)</span><span class="op" id="6534962">.</span><span class="op" id="6534963">(</span><span class="ident" id="6534964">color</span><span class="op" id="6534969">.</span><span class="ident" id="6534970">Gray16</span><span class="op" id="6534976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534982">fmt</span><span class="op" id="6534985">.</span><span class="ident" id="6534986">Fprintf</span><span class="op" id="6534993">(</span><span class="ident" id="6534994">w</span><span class="op" id="6534995">,</span>&nbsp;<span class="string" id="6534997">&#34;%04x&nbsp;&#34;</span><span class="op" id="6535004">,</span>&nbsp;<span class="ident" id="6535006">gray16</span><span class="op" id="6535012">.</span><span class="ident" id="6535013">Y</span><span class="op" id="6535014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535023">case</span>&nbsp;<span class="ident" id="6535028">cm</span>&nbsp;<span class="op" id="6535031">==</span>&nbsp;<span class="ident" id="6535034">color</span><span class="op" id="6535039">.</span><span class="ident" id="6535040">RGBAModel</span><span class="op" id="6535049">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535054">for</span>&nbsp;<span class="ident" id="6535058">x</span>&nbsp;<span class="op" id="6535060">:=</span>&nbsp;<span class="ident" id="6535063">bounds</span><span class="op" id="6535069">.</span><span class="ident" id="6535070">Min</span><span class="op" id="6535073">.</span><span class="ident" id="6535074">X</span><span class="op" id="6535075">;</span>&nbsp;<span class="ident" id="6535077">x</span>&nbsp;<span class="op" id="6535079">&lt;</span>&nbsp;<span class="ident" id="6535081">bounds</span><span class="op" id="6535087">.</span><span class="ident" id="6535088">Max</span><span class="op" id="6535091">.</span><span class="ident" id="6535092">X</span><span class="op" id="6535093">;</span>&nbsp;<span class="ident" id="6535095">x</span><span class="op" id="6535096">++</span>&nbsp;<span class="op" id="6535099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535105">rgba</span>&nbsp;<span class="op" id="6535110">:=</span>&nbsp;<span class="ident" id="6535113">png</span><span class="op" id="6535116">.</span><span class="ident" id="6535117">At</span><span class="op" id="6535119">(</span><span class="ident" id="6535120">x</span><span class="op" id="6535121">,</span>&nbsp;<span class="ident" id="6535123">y</span><span class="op" id="6535124">)</span><span class="op" id="6535125">.</span><span class="op" id="6535126">(</span><span class="ident" id="6535127">color</span><span class="op" id="6535132">.</span><span class="ident" id="6535133">RGBA</span><span class="op" id="6535137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535143">fmt</span><span class="op" id="6535146">.</span><span class="ident" id="6535147">Fprintf</span><span class="op" id="6535154">(</span><span class="ident" id="6535155">w</span><span class="op" id="6535156">,</span>&nbsp;<span class="string" id="6535158">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6535173">,</span>&nbsp;<span class="ident" id="6535175">rgba</span><span class="op" id="6535179">.</span><span class="ident" id="6535180">R</span><span class="op" id="6535181">,</span>&nbsp;<span class="ident" id="6535183">rgba</span><span class="op" id="6535187">.</span><span class="ident" id="6535188">G</span><span class="op" id="6535189">,</span>&nbsp;<span class="ident" id="6535191">rgba</span><span class="op" id="6535195">.</span><span class="ident" id="6535196">B</span><span class="op" id="6535197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535206">case</span>&nbsp;<span class="ident" id="6535211">cm</span>&nbsp;<span class="op" id="6535214">==</span>&nbsp;<span class="ident" id="6535217">color</span><span class="op" id="6535222">.</span><span class="ident" id="6535223">RGBA64Model</span><span class="op" id="6535234">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535239">for</span>&nbsp;<span class="ident" id="6535243">x</span>&nbsp;<span class="op" id="6535245">:=</span>&nbsp;<span class="ident" id="6535248">bounds</span><span class="op" id="6535254">.</span><span class="ident" id="6535255">Min</span><span class="op" id="6535258">.</span><span class="ident" id="6535259">X</span><span class="op" id="6535260">;</span>&nbsp;<span class="ident" id="6535262">x</span>&nbsp;<span class="op" id="6535264">&lt;</span>&nbsp;<span class="ident" id="6535266">bounds</span><span class="op" id="6535272">.</span><span class="ident" id="6535273">Max</span><span class="op" id="6535276">.</span><span class="ident" id="6535277">X</span><span class="op" id="6535278">;</span>&nbsp;<span class="ident" id="6535280">x</span><span class="op" id="6535281">++</span>&nbsp;<span class="op" id="6535284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535290">rgba64</span>&nbsp;<span class="op" id="6535297">:=</span>&nbsp;<span class="ident" id="6535300">png</span><span class="op" id="6535303">.</span><span class="ident" id="6535304">At</span><span class="op" id="6535306">(</span><span class="ident" id="6535307">x</span><span class="op" id="6535308">,</span>&nbsp;<span class="ident" id="6535310">y</span><span class="op" id="6535311">)</span><span class="op" id="6535312">.</span><span class="op" id="6535313">(</span><span class="ident" id="6535314">color</span><span class="op" id="6535319">.</span><span class="ident" id="6535320">RGBA64</span><span class="op" id="6535326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535332">fmt</span><span class="op" id="6535335">.</span><span class="ident" id="6535336">Fprintf</span><span class="op" id="6535343">(</span><span class="ident" id="6535344">w</span><span class="op" id="6535345">,</span>&nbsp;<span class="string" id="6535347">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6535362">,</span>&nbsp;<span class="ident" id="6535364">rgba64</span><span class="op" id="6535370">.</span><span class="ident" id="6535371">R</span><span class="op" id="6535372">,</span>&nbsp;<span class="ident" id="6535374">rgba64</span><span class="op" id="6535380">.</span><span class="ident" id="6535381">G</span><span class="op" id="6535382">,</span>&nbsp;<span class="ident" id="6535384">rgba64</span><span class="op" id="6535390">.</span><span class="ident" id="6535391">B</span><span class="op" id="6535392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535401">case</span>&nbsp;<span class="ident" id="6535406">cm</span>&nbsp;<span class="op" id="6535409">==</span>&nbsp;<span class="ident" id="6535412">color</span><span class="op" id="6535417">.</span><span class="ident" id="6535418">NRGBAModel</span><span class="op" id="6535428">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535433">for</span>&nbsp;<span class="ident" id="6535437">x</span>&nbsp;<span class="op" id="6535439">:=</span>&nbsp;<span class="ident" id="6535442">bounds</span><span class="op" id="6535448">.</span><span class="ident" id="6535449">Min</span><span class="op" id="6535452">.</span><span class="ident" id="6535453">X</span><span class="op" id="6535454">;</span>&nbsp;<span class="ident" id="6535456">x</span>&nbsp;<span class="op" id="6535458">&lt;</span>&nbsp;<span class="ident" id="6535460">bounds</span><span class="op" id="6535466">.</span><span class="ident" id="6535467">Max</span><span class="op" id="6535470">.</span><span class="ident" id="6535471">X</span><span class="op" id="6535472">;</span>&nbsp;<span class="ident" id="6535474">x</span><span class="op" id="6535475">++</span>&nbsp;<span class="op" id="6535478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535484">nrgba</span>&nbsp;<span class="op" id="6535490">:=</span>&nbsp;<span class="ident" id="6535493">png</span><span class="op" id="6535496">.</span><span class="ident" id="6535497">At</span><span class="op" id="6535499">(</span><span class="ident" id="6535500">x</span><span class="op" id="6535501">,</span>&nbsp;<span class="ident" id="6535503">y</span><span class="op" id="6535504">)</span><span class="op" id="6535505">.</span><span class="op" id="6535506">(</span><span class="ident" id="6535507">color</span><span class="op" id="6535512">.</span><span class="ident" id="6535513">NRGBA</span><span class="op" id="6535518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535524">fmt</span><span class="op" id="6535527">.</span><span class="ident" id="6535528">Fprintf</span><span class="op" id="6535535">(</span><span class="ident" id="6535536">w</span><span class="op" id="6535537">,</span>&nbsp;<span class="string" id="6535539">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6535558">,</span>&nbsp;<span class="ident" id="6535560">nrgba</span><span class="op" id="6535565">.</span><span class="ident" id="6535566">R</span><span class="op" id="6535567">,</span>&nbsp;<span class="ident" id="6535569">nrgba</span><span class="op" id="6535574">.</span><span class="ident" id="6535575">G</span><span class="op" id="6535576">,</span>&nbsp;<span class="ident" id="6535578">nrgba</span><span class="op" id="6535583">.</span><span class="ident" id="6535584">B</span><span class="op" id="6535585">,</span>&nbsp;<span class="ident" id="6535587">nrgba</span><span class="op" id="6535592">.</span><span class="ident" id="6535593">A</span><span class="op" id="6535594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535603">case</span>&nbsp;<span class="ident" id="6535608">cm</span>&nbsp;<span class="op" id="6535611">==</span>&nbsp;<span class="ident" id="6535614">color</span><span class="op" id="6535619">.</span><span class="ident" id="6535620">NRGBA64Model</span><span class="op" id="6535632">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535637">for</span>&nbsp;<span class="ident" id="6535641">x</span>&nbsp;<span class="op" id="6535643">:=</span>&nbsp;<span class="ident" id="6535646">bounds</span><span class="op" id="6535652">.</span><span class="ident" id="6535653">Min</span><span class="op" id="6535656">.</span><span class="ident" id="6535657">X</span><span class="op" id="6535658">;</span>&nbsp;<span class="ident" id="6535660">x</span>&nbsp;<span class="op" id="6535662">&lt;</span>&nbsp;<span class="ident" id="6535664">bounds</span><span class="op" id="6535670">.</span><span class="ident" id="6535671">Max</span><span class="op" id="6535674">.</span><span class="ident" id="6535675">X</span><span class="op" id="6535676">;</span>&nbsp;<span class="ident" id="6535678">x</span><span class="op" id="6535679">++</span>&nbsp;<span class="op" id="6535682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535688">nrgba64</span>&nbsp;<span class="op" id="6535696">:=</span>&nbsp;<span class="ident" id="6535699">png</span><span class="op" id="6535702">.</span><span class="ident" id="6535703">At</span><span class="op" id="6535705">(</span><span class="ident" id="6535706">x</span><span class="op" id="6535707">,</span>&nbsp;<span class="ident" id="6535709">y</span><span class="op" id="6535710">)</span><span class="op" id="6535711">.</span><span class="op" id="6535712">(</span><span class="ident" id="6535713">color</span><span class="op" id="6535718">.</span><span class="ident" id="6535719">NRGBA64</span><span class="op" id="6535726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535732">fmt</span><span class="op" id="6535735">.</span><span class="ident" id="6535736">Fprintf</span><span class="op" id="6535743">(</span><span class="ident" id="6535744">w</span><span class="op" id="6535745">,</span>&nbsp;<span class="string" id="6535747">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6535766">,</span>&nbsp;<span class="ident" id="6535768">nrgba64</span><span class="op" id="6535775">.</span><span class="ident" id="6535776">R</span><span class="op" id="6535777">,</span>&nbsp;<span class="ident" id="6535779">nrgba64</span><span class="op" id="6535786">.</span><span class="ident" id="6535787">G</span><span class="op" id="6535788">,</span>&nbsp;<span class="ident" id="6535790">nrgba64</span><span class="op" id="6535797">.</span><span class="ident" id="6535798">B</span><span class="op" id="6535799">,</span>&nbsp;<span class="ident" id="6535801">nrgba64</span><span class="op" id="6535808">.</span><span class="ident" id="6535809">A</span><span class="op" id="6535810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535819">case</span>&nbsp;<span class="ident" id="6535824">cpm</span>&nbsp;<span class="op" id="6535828">!=</span>&nbsp;<span class="ident" id="6535831">nil</span><span class="op" id="6535834">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535839">var</span>&nbsp;<span class="ident" id="6535843">b</span><span class="op" id="6535844">,</span>&nbsp;<span class="ident" id="6535846">c</span>&nbsp;<span class="builtintype" id="6535848">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535855">for</span>&nbsp;<span class="ident" id="6535859">x</span>&nbsp;<span class="op" id="6535861">:=</span>&nbsp;<span class="ident" id="6535864">bounds</span><span class="op" id="6535870">.</span><span class="ident" id="6535871">Min</span><span class="op" id="6535874">.</span><span class="ident" id="6535875">X</span><span class="op" id="6535876">;</span>&nbsp;<span class="ident" id="6535878">x</span>&nbsp;<span class="op" id="6535880">&lt;</span>&nbsp;<span class="ident" id="6535882">bounds</span><span class="op" id="6535888">.</span><span class="ident" id="6535889">Max</span><span class="op" id="6535892">.</span><span class="ident" id="6535893">X</span><span class="op" id="6535894">;</span>&nbsp;<span class="ident" id="6535896">x</span><span class="op" id="6535897">++</span>&nbsp;<span class="op" id="6535900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535906">b</span>&nbsp;<span class="op" id="6535908">=</span>&nbsp;<span class="ident" id="6535910">b</span><span class="op" id="6535911">&lt;&lt;</span><span class="builtintype" id="6535913">uint</span><span class="op" id="6535917">(</span><span class="ident" id="6535918">bitdepth</span><span class="op" id="6535926">)</span>&nbsp;<span class="op" id="6535928">|</span>&nbsp;<span class="builtintype" id="6535930">int</span><span class="op" id="6535933">(</span><span class="ident" id="6535934">paletted</span><span class="op" id="6535942">.</span><span class="ident" id="6535943">ColorIndexAt</span><span class="op" id="6535955">(</span><span class="ident" id="6535956">x</span><span class="op" id="6535957">,</span>&nbsp;<span class="ident" id="6535959">y</span><span class="op" id="6535960">)</span><span class="op" id="6535961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535967">c</span><span class="op" id="6535968">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535975">if</span>&nbsp;<span class="ident" id="6535978">c</span>&nbsp;<span class="op" id="6535980">==</span>&nbsp;<span class="num" id="6535983">8</span><span class="op" id="6535984">/</span><span class="ident" id="6535985">bitdepth</span>&nbsp;<span class="op" id="6535994">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536001">fmt</span><span class="op" id="6536004">.</span><span class="ident" id="6536005">Fprintf</span><span class="op" id="6536012">(</span><span class="ident" id="6536013">w</span><span class="op" id="6536014">,</span>&nbsp;<span class="string" id="6536016">&#34;%02x&#34;</span><span class="op" id="6536022">,</span>&nbsp;<span class="ident" id="6536024">b</span><span class="op" id="6536025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536032">b</span>&nbsp;<span class="op" id="6536034">=</span>&nbsp;<span class="num" id="6536036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536043">c</span>&nbsp;<span class="op" id="6536045">=</span>&nbsp;<span class="num" id="6536047">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536058">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536063">if</span>&nbsp;<span class="ident" id="6536066">c</span>&nbsp;<span class="op" id="6536068">!=</span>&nbsp;<span class="num" id="6536071">0</span>&nbsp;<span class="op" id="6536073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536079">for</span>&nbsp;<span class="ident" id="6536083">c</span>&nbsp;<span class="op" id="6536085">!=</span>&nbsp;<span class="num" id="6536088">8</span><span class="op" id="6536089">/</span><span class="ident" id="6536090">bitdepth</span>&nbsp;<span class="op" id="6536099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536106">b</span>&nbsp;<span class="op" id="6536108">=</span>&nbsp;<span class="ident" id="6536110">b</span>&nbsp;<span class="op" id="6536112">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6536115">uint</span><span class="op" id="6536119">(</span><span class="ident" id="6536120">bitdepth</span><span class="op" id="6536128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536135">c</span><span class="op" id="6536136">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536143">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536149">fmt</span><span class="op" id="6536152">.</span><span class="ident" id="6536153">Fprintf</span><span class="op" id="6536160">(</span><span class="ident" id="6536161">w</span><span class="op" id="6536162">,</span>&nbsp;<span class="string" id="6536164">&#34;%02x&#34;</span><span class="op" id="6536170">,</span>&nbsp;<span class="ident" id="6536172">b</span><span class="op" id="6536173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536186">io</span><span class="op" id="6536188">.</span><span class="ident" id="6536189">WriteString</span><span class="op" id="6536200">(</span><span class="ident" id="6536201">w</span><span class="op" id="6536202">,</span>&nbsp;<span class="string" id="6536204">&#34;\n&#34;</span><span class="op" id="6536208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536211">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536214">io</span><span class="op" id="6536216">.</span><span class="ident" id="6536217">WriteString</span><span class="op" id="6536228">(</span><span class="ident" id="6536229">w</span><span class="op" id="6536230">,</span>&nbsp;<span class="string" id="6536232">&#34;}\n&#34;</span><span class="op" id="6536237">)</span><br>
<span class="lineno"></span><span class="op" id="6536239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6536242">func</span>&nbsp;<span class="ident" id="6536247">TestReader</span><span class="op" id="6536257">(</span><span class="ident" id="6536258">t</span>&nbsp;<span class="op" id="6536260">*</span><span class="ident" id="6536261">testing</span><span class="op" id="6536268">.</span><span class="ident" id="6536269">T</span><span class="op" id="6536270">)</span>&nbsp;<span class="op" id="6536272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536275">names</span>&nbsp;<span class="op" id="6536281">:=</span>&nbsp;<span class="ident" id="6536284">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536295">if</span>&nbsp;<span class="ident" id="6536298">testing</span><span class="op" id="6536305">.</span><span class="ident" id="6536306">Short</span><span class="op" id="6536311">(</span><span class="op" id="6536312">)</span>&nbsp;<span class="op" id="6536314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536318">names</span>&nbsp;<span class="op" id="6536324">=</span>&nbsp;<span class="ident" id="6536326">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536345">for</span>&nbsp;<span class="ident" id="6536349">_</span><span class="op" id="6536350">,</span>&nbsp;<span class="ident" id="6536352">fn</span>&nbsp;<span class="op" id="6536355">:=</span>&nbsp;<span class="keyword" id="6536358">range</span>&nbsp;<span class="ident" id="6536364">names</span>&nbsp;<span class="op" id="6536370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536374">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536399">img</span><span class="op" id="6536402">,</span>&nbsp;<span class="ident" id="6536404">err</span>&nbsp;<span class="op" id="6536408">:=</span>&nbsp;<span class="ident" id="6536411">readPNG</span><span class="op" id="6536418">(</span><span class="string" id="6536419">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6536440">+</span>&nbsp;<span class="ident" id="6536442">fn</span>&nbsp;<span class="op" id="6536445">+</span>&nbsp;<span class="string" id="6536447">&#34;.png&#34;</span><span class="op" id="6536453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536457">if</span>&nbsp;<span class="ident" id="6536460">err</span>&nbsp;<span class="op" id="6536464">!=</span>&nbsp;<span class="ident" id="6536467">nil</span>&nbsp;<span class="op" id="6536471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536476">t</span><span class="op" id="6536477">.</span><span class="ident" id="6536478">Error</span><span class="op" id="6536483">(</span><span class="ident" id="6536484">fn</span><span class="op" id="6536486">,</span>&nbsp;<span class="ident" id="6536488">err</span><span class="op" id="6536491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536496">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536507">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536512">if</span>&nbsp;<span class="ident" id="6536515">fn</span>&nbsp;<span class="op" id="6536518">==</span>&nbsp;<span class="string" id="6536521">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="6536532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536537">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536614">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536660">c</span>&nbsp;<span class="op" id="6536662">:=</span>&nbsp;<span class="ident" id="6536665">img</span><span class="op" id="6536668">.</span><span class="ident" id="6536669">At</span><span class="op" id="6536671">(</span><span class="num" id="6536672">2</span><span class="op" id="6536673">,</span>&nbsp;<span class="num" id="6536675">1</span><span class="op" id="6536676">)</span><span class="op" id="6536677">.</span><span class="op" id="6536678">(</span><span class="ident" id="6536679">color</span><span class="op" id="6536684">.</span><span class="ident" id="6536685">NRGBA64</span><span class="op" id="6536692">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536697">if</span>&nbsp;<span class="ident" id="6536700">c</span><span class="op" id="6536701">.</span><span class="ident" id="6536702">R</span>&nbsp;<span class="op" id="6536704">!=</span>&nbsp;<span class="num" id="6536707">0x11a7</span>&nbsp;<span class="op" id="6536714">||</span>&nbsp;<span class="ident" id="6536717">c</span><span class="op" id="6536718">.</span><span class="ident" id="6536719">G</span>&nbsp;<span class="op" id="6536721">!=</span>&nbsp;<span class="num" id="6536724">0x11a7</span>&nbsp;<span class="op" id="6536731">||</span>&nbsp;<span class="ident" id="6536734">c</span><span class="op" id="6536735">.</span><span class="ident" id="6536736">B</span>&nbsp;<span class="op" id="6536738">!=</span>&nbsp;<span class="num" id="6536741">0x11a7</span>&nbsp;<span class="op" id="6536748">||</span>&nbsp;<span class="ident" id="6536751">c</span><span class="op" id="6536752">.</span><span class="ident" id="6536753">A</span>&nbsp;<span class="op" id="6536755">!=</span>&nbsp;<span class="num" id="6536758">0x1085</span>&nbsp;<span class="op" id="6536765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536771">t</span><span class="op" id="6536772">.</span><span class="ident" id="6536773">Error</span><span class="op" id="6536778">(</span><span class="ident" id="6536779">fn</span><span class="op" id="6536781">,</span>&nbsp;<span class="ident" id="6536783">fmt</span><span class="op" id="6536786">.</span><span class="ident" id="6536787">Errorf</span><span class="op" id="6536793">(</span><span class="string" id="6536794">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="6536827">,</span>&nbsp;<span class="ident" id="6536829">c</span><span class="op" id="6536830">)</span><span class="op" id="6536831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536841">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536852">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536857">piper</span><span class="op" id="6536862">,</span>&nbsp;<span class="ident" id="6536864">pipew</span>&nbsp;<span class="op" id="6536870">:=</span>&nbsp;<span class="ident" id="6536873">io</span><span class="op" id="6536875">.</span><span class="ident" id="6536876">Pipe</span><span class="op" id="6536880">(</span><span class="op" id="6536881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536885">pb</span>&nbsp;<span class="op" id="6536888">:=</span>&nbsp;<span class="ident" id="6536891">bufio</span><span class="op" id="6536896">.</span><span class="ident" id="6536897">NewScanner</span><span class="op" id="6536907">(</span><span class="ident" id="6536908">piper</span><span class="op" id="6536913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536917">go</span>&nbsp;<span class="ident" id="6536920">sng</span><span class="op" id="6536923">(</span><span class="ident" id="6536924">pipew</span><span class="op" id="6536929">,</span>&nbsp;<span class="ident" id="6536931">fn</span><span class="op" id="6536933">,</span>&nbsp;<span class="ident" id="6536935">img</span><span class="op" id="6536938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536942">defer</span>&nbsp;<span class="ident" id="6536948">piper</span><span class="op" id="6536953">.</span><span class="ident" id="6536954">Close</span><span class="op" id="6536959">(</span><span class="op" id="6536960">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536965">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536990">sf</span><span class="op" id="6536992">,</span>&nbsp;<span class="ident" id="6536994">err</span>&nbsp;<span class="op" id="6536998">:=</span>&nbsp;<span class="ident" id="6537001">os</span><span class="op" id="6537003">.</span><span class="ident" id="6537004">Open</span><span class="op" id="6537008">(</span><span class="string" id="6537009">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6537030">+</span>&nbsp;<span class="ident" id="6537032">fn</span>&nbsp;<span class="op" id="6537035">+</span>&nbsp;<span class="string" id="6537037">&#34;.sng&#34;</span><span class="op" id="6537043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537047">if</span>&nbsp;<span class="ident" id="6537050">err</span>&nbsp;<span class="op" id="6537054">!=</span>&nbsp;<span class="ident" id="6537057">nil</span>&nbsp;<span class="op" id="6537061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537066">t</span><span class="op" id="6537067">.</span><span class="ident" id="6537068">Error</span><span class="op" id="6537073">(</span><span class="ident" id="6537074">fn</span><span class="op" id="6537076">,</span>&nbsp;<span class="ident" id="6537078">err</span><span class="op" id="6537081">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537086">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537101">defer</span>&nbsp;<span class="ident" id="6537107">sf</span><span class="op" id="6537109">.</span><span class="ident" id="6537110">Close</span><span class="op" id="6537115">(</span><span class="op" id="6537116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537120">sb</span>&nbsp;<span class="op" id="6537123">:=</span>&nbsp;<span class="ident" id="6537126">bufio</span><span class="op" id="6537131">.</span><span class="ident" id="6537132">NewScanner</span><span class="op" id="6537142">(</span><span class="ident" id="6537143">sf</span><span class="op" id="6537145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537149">if</span>&nbsp;<span class="ident" id="6537152">err</span>&nbsp;<span class="op" id="6537156">!=</span>&nbsp;<span class="ident" id="6537159">nil</span>&nbsp;<span class="op" id="6537163">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537168">t</span><span class="op" id="6537169">.</span><span class="ident" id="6537170">Error</span><span class="op" id="6537175">(</span><span class="ident" id="6537176">fn</span><span class="op" id="6537178">,</span>&nbsp;<span class="ident" id="6537180">err</span><span class="op" id="6537183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537188">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537204">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537255">for</span>&nbsp;<span class="op" id="6537259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537264">pdone</span>&nbsp;<span class="op" id="6537270">:=</span>&nbsp;<span class="op" id="6537273">!</span><span class="ident" id="6537274">pb</span><span class="op" id="6537276">.</span><span class="ident" id="6537277">Scan</span><span class="op" id="6537281">(</span><span class="op" id="6537282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537287">sdone</span>&nbsp;<span class="op" id="6537293">:=</span>&nbsp;<span class="op" id="6537296">!</span><span class="ident" id="6537297">sb</span><span class="op" id="6537299">.</span><span class="ident" id="6537300">Scan</span><span class="op" id="6537304">(</span><span class="op" id="6537305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537310">if</span>&nbsp;<span class="ident" id="6537313">pdone</span>&nbsp;<span class="op" id="6537319">&amp;&amp;</span>&nbsp;<span class="ident" id="6537322">sdone</span>&nbsp;<span class="op" id="6537328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537334">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537348">if</span>&nbsp;<span class="ident" id="6537351">pdone</span>&nbsp;<span class="op" id="6537357">||</span>&nbsp;<span class="ident" id="6537360">sdone</span>&nbsp;<span class="op" id="6537366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537372">t</span><span class="op" id="6537373">.</span><span class="ident" id="6537374">Errorf</span><span class="op" id="6537380">(</span><span class="string" id="6537381">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="6537402">,</span>&nbsp;<span class="ident" id="6537404">fn</span><span class="op" id="6537406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537412">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537421">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537426">ps</span>&nbsp;<span class="op" id="6537429">:=</span>&nbsp;<span class="ident" id="6537432">pb</span><span class="op" id="6537434">.</span><span class="ident" id="6537435">Text</span><span class="op" id="6537439">(</span><span class="op" id="6537440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537445">ss</span>&nbsp;<span class="op" id="6537448">:=</span>&nbsp;<span class="ident" id="6537451">sb</span><span class="op" id="6537453">.</span><span class="ident" id="6537454">Text</span><span class="op" id="6537458">(</span><span class="op" id="6537459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537464">if</span>&nbsp;<span class="ident" id="6537467">ps</span>&nbsp;<span class="op" id="6537470">!=</span>&nbsp;<span class="ident" id="6537473">ss</span>&nbsp;<span class="op" id="6537476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537482">t</span><span class="op" id="6537483">.</span><span class="ident" id="6537484">Errorf</span><span class="op" id="6537490">(</span><span class="string" id="6537491">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="6537521">,</span>&nbsp;<span class="ident" id="6537523">fn</span><span class="op" id="6537525">,</span>&nbsp;<span class="ident" id="6537527">ps</span><span class="op" id="6537529">,</span>&nbsp;<span class="ident" id="6537531">ss</span><span class="op" id="6537533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537539">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537556">if</span>&nbsp;<span class="ident" id="6537559">pb</span><span class="op" id="6537561">.</span><span class="ident" id="6537562">Err</span><span class="op" id="6537565">(</span><span class="op" id="6537566">)</span>&nbsp;<span class="op" id="6537568">!=</span>&nbsp;<span class="ident" id="6537571">nil</span>&nbsp;<span class="op" id="6537575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537580">t</span><span class="op" id="6537581">.</span><span class="ident" id="6537582">Error</span><span class="op" id="6537587">(</span><span class="ident" id="6537588">fn</span><span class="op" id="6537590">,</span>&nbsp;<span class="ident" id="6537592">pb</span><span class="op" id="6537594">.</span><span class="ident" id="6537595">Err</span><span class="op" id="6537598">(</span><span class="op" id="6537599">)</span><span class="op" id="6537600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537604">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537608">if</span>&nbsp;<span class="ident" id="6537611">sb</span><span class="op" id="6537613">.</span><span class="ident" id="6537614">Err</span><span class="op" id="6537617">(</span><span class="op" id="6537618">)</span>&nbsp;<span class="op" id="6537620">!=</span>&nbsp;<span class="ident" id="6537623">nil</span>&nbsp;<span class="op" id="6537627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537632">t</span><span class="op" id="6537633">.</span><span class="ident" id="6537634">Error</span><span class="op" id="6537639">(</span><span class="ident" id="6537640">fn</span><span class="op" id="6537642">,</span>&nbsp;<span class="ident" id="6537644">sb</span><span class="op" id="6537646">.</span><span class="ident" id="6537647">Err</span><span class="op" id="6537650">(</span><span class="op" id="6537651">)</span><span class="op" id="6537652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537659">}</span><br>
<span class="lineno"></span><span class="op" id="6537661">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6537664">var</span>&nbsp;<span class="ident" id="6537668">readerErrors</span>&nbsp;<span class="op" id="6537681">=</span>&nbsp;<span class="op" id="6537683">[</span><span class="op" id="6537684">]</span><span class="keyword" id="6537685">struct</span>&nbsp;<span class="op" id="6537692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537695">file</span>&nbsp;<span class="builtintype" id="6537700">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537708">err</span>&nbsp;&nbsp;<span class="builtintype" id="6537713">string</span><br>
<span class="lineno"></span><span class="op" id="6537720">}</span><span class="op" id="6537721">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537724">{</span><span class="string" id="6537725">&#34;invalid-zlib.png&#34;</span><span class="op" id="6537743">,</span>&nbsp;<span class="string" id="6537745">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="6537769">}</span><span class="op" id="6537770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537773">{</span><span class="string" id="6537774">&#34;invalid-crc32.png&#34;</span><span class="op" id="6537793">,</span>&nbsp;<span class="string" id="6537795">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6537813">}</span><span class="op" id="6537814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537817">{</span><span class="string" id="6537818">&#34;invalid-noend.png&#34;</span><span class="op" id="6537837">,</span>&nbsp;<span class="string" id="6537839">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6537855">}</span><span class="op" id="6537856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537859">{</span><span class="string" id="6537860">&#34;invalid-trunc.png&#34;</span><span class="op" id="6537879">,</span>&nbsp;<span class="string" id="6537881">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6537897">}</span><span class="op" id="6537898">,</span><br>
<span class="lineno"></span><span class="op" id="6537900">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6537903">func</span>&nbsp;<span class="ident" id="6537908">TestReaderError</span><span class="op" id="6537923">(</span><span class="ident" id="6537924">t</span>&nbsp;<span class="op" id="6537926">*</span><span class="ident" id="6537927">testing</span><span class="op" id="6537934">.</span><span class="ident" id="6537935">T</span><span class="op" id="6537936">)</span>&nbsp;<span class="op" id="6537938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537941">for</span>&nbsp;<span class="ident" id="6537945">_</span><span class="op" id="6537946">,</span>&nbsp;<span class="ident" id="6537948">tt</span>&nbsp;<span class="op" id="6537951">:=</span>&nbsp;<span class="keyword" id="6537954">range</span>&nbsp;<span class="ident" id="6537960">readerErrors</span>&nbsp;<span class="op" id="6537973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537977">img</span><span class="op" id="6537980">,</span>&nbsp;<span class="ident" id="6537982">err</span>&nbsp;<span class="op" id="6537986">:=</span>&nbsp;<span class="ident" id="6537989">readPNG</span><span class="op" id="6537996">(</span><span class="string" id="6537997">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="6538009">+</span>&nbsp;<span class="ident" id="6538011">tt</span><span class="op" id="6538013">.</span><span class="ident" id="6538014">file</span><span class="op" id="6538018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538022">if</span>&nbsp;<span class="ident" id="6538025">err</span>&nbsp;<span class="op" id="6538029">==</span>&nbsp;<span class="ident" id="6538032">nil</span>&nbsp;<span class="op" id="6538036">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538041">t</span><span class="op" id="6538042">.</span><span class="ident" id="6538043">Errorf</span><span class="op" id="6538049">(</span><span class="string" id="6538050">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="6538078">,</span>&nbsp;<span class="ident" id="6538080">tt</span><span class="op" id="6538082">.</span><span class="ident" id="6538083">file</span><span class="op" id="6538087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538107">if</span>&nbsp;<span class="op" id="6538110">!</span><span class="ident" id="6538111">strings</span><span class="op" id="6538118">.</span><span class="ident" id="6538119">Contains</span><span class="op" id="6538127">(</span><span class="ident" id="6538128">err</span><span class="op" id="6538131">.</span><span class="ident" id="6538132">Error</span><span class="op" id="6538137">(</span><span class="op" id="6538138">)</span><span class="op" id="6538139">,</span>&nbsp;<span class="ident" id="6538141">tt</span><span class="op" id="6538143">.</span><span class="ident" id="6538144">err</span><span class="op" id="6538147">)</span>&nbsp;<span class="op" id="6538149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538154">t</span><span class="op" id="6538155">.</span><span class="ident" id="6538156">Errorf</span><span class="op" id="6538162">(</span><span class="string" id="6538163">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6538189">,</span>&nbsp;<span class="ident" id="6538191">tt</span><span class="op" id="6538193">.</span><span class="ident" id="6538194">file</span><span class="op" id="6538198">,</span>&nbsp;<span class="ident" id="6538200">err</span><span class="op" id="6538203">,</span>&nbsp;<span class="ident" id="6538205">tt</span><span class="op" id="6538207">.</span><span class="ident" id="6538208">err</span><span class="op" id="6538211">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538219">if</span>&nbsp;<span class="ident" id="6538222">img</span>&nbsp;<span class="op" id="6538226">!=</span>&nbsp;<span class="ident" id="6538229">nil</span>&nbsp;<span class="op" id="6538233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538238">t</span><span class="op" id="6538239">.</span><span class="ident" id="6538240">Errorf</span><span class="op" id="6538246">(</span><span class="string" id="6538247">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="6538280">,</span>&nbsp;<span class="ident" id="6538282">tt</span><span class="op" id="6538284">.</span><span class="ident" id="6538285">file</span><span class="op" id="6538289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538296">}</span><br>
<span class="lineno">295</span><span class="op" id="6538298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538301">func</span>&nbsp;<span class="ident" id="6538306">TestPalettedDecodeConfig</span><span class="op" id="6538330">(</span><span class="ident" id="6538331">t</span>&nbsp;<span class="op" id="6538333">*</span><span class="ident" id="6538334">testing</span><span class="op" id="6538341">.</span><span class="ident" id="6538342">T</span><span class="op" id="6538343">)</span>&nbsp;<span class="op" id="6538345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538348">for</span>&nbsp;<span class="ident" id="6538352">_</span><span class="op" id="6538353">,</span>&nbsp;<span class="ident" id="6538355">fn</span>&nbsp;<span class="op" id="6538358">:=</span>&nbsp;<span class="keyword" id="6538361">range</span>&nbsp;<span class="ident" id="6538367">filenamesPaletted</span>&nbsp;<span class="op" id="6538385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538389">f</span><span class="op" id="6538390">,</span>&nbsp;<span class="ident" id="6538392">err</span>&nbsp;<span class="op" id="6538396">:=</span>&nbsp;<span class="ident" id="6538399">os</span><span class="op" id="6538401">.</span><span class="ident" id="6538402">Open</span><span class="op" id="6538406">(</span><span class="string" id="6538407">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6538428">+</span>&nbsp;<span class="ident" id="6538430">fn</span>&nbsp;<span class="op" id="6538433">+</span>&nbsp;<span class="string" id="6538435">&#34;.png&#34;</span><span class="op" id="6538441">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538445">if</span>&nbsp;<span class="ident" id="6538448">err</span>&nbsp;<span class="op" id="6538452">!=</span>&nbsp;<span class="ident" id="6538455">nil</span>&nbsp;<span class="op" id="6538459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538464">t</span><span class="op" id="6538465">.</span><span class="ident" id="6538466">Errorf</span><span class="op" id="6538472">(</span><span class="string" id="6538473">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6538494">,</span>&nbsp;<span class="ident" id="6538496">fn</span><span class="op" id="6538498">,</span>&nbsp;<span class="ident" id="6538500">err</span><span class="op" id="6538503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538508">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538523">defer</span>&nbsp;<span class="ident" id="6538529">f</span><span class="op" id="6538530">.</span><span class="ident" id="6538531">Close</span><span class="op" id="6538536">(</span><span class="op" id="6538537">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538541">cfg</span><span class="op" id="6538544">,</span>&nbsp;<span class="ident" id="6538546">err</span>&nbsp;<span class="op" id="6538550">:=</span>&nbsp;<span class="ident" id="6538553">DecodeConfig</span><span class="op" id="6538565">(</span><span class="ident" id="6538566">f</span><span class="op" id="6538567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538571">if</span>&nbsp;<span class="ident" id="6538574">err</span>&nbsp;<span class="op" id="6538578">!=</span>&nbsp;<span class="ident" id="6538581">nil</span>&nbsp;<span class="op" id="6538585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538590">t</span><span class="op" id="6538591">.</span><span class="ident" id="6538592">Errorf</span><span class="op" id="6538598">(</span><span class="string" id="6538599">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6538607">,</span>&nbsp;<span class="ident" id="6538609">fn</span><span class="op" id="6538611">,</span>&nbsp;<span class="ident" id="6538613">err</span><span class="op" id="6538616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538621">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538632">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538636">pal</span><span class="op" id="6538639">,</span>&nbsp;<span class="ident" id="6538641">ok</span>&nbsp;<span class="op" id="6538644">:=</span>&nbsp;<span class="ident" id="6538647">cfg</span><span class="op" id="6538650">.</span><span class="ident" id="6538651">ColorModel</span><span class="op" id="6538661">.</span><span class="op" id="6538662">(</span><span class="ident" id="6538663">color</span><span class="op" id="6538668">.</span><span class="ident" id="6538669">Palette</span><span class="op" id="6538676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538680">if</span>&nbsp;<span class="op" id="6538683">!</span><span class="ident" id="6538684">ok</span>&nbsp;<span class="op" id="6538687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538692">t</span><span class="op" id="6538693">.</span><span class="ident" id="6538694">Errorf</span><span class="op" id="6538700">(</span><span class="string" id="6538701">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="6538736">,</span>&nbsp;<span class="ident" id="6538738">fn</span><span class="op" id="6538740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538745">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538756">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538760">if</span>&nbsp;<span class="ident" id="6538763">pal</span>&nbsp;<span class="op" id="6538767">==</span>&nbsp;<span class="ident" id="6538770">nil</span>&nbsp;<span class="op" id="6538774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538779">t</span><span class="op" id="6538780">.</span><span class="ident" id="6538781">Errorf</span><span class="op" id="6538787">(</span><span class="string" id="6538788">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="6538817">,</span>&nbsp;<span class="ident" id="6538819">fn</span><span class="op" id="6538821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538826">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538840">}</span><br>
<span class="lineno">320</span><span class="op" id="6538842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538845">func</span>&nbsp;<span class="ident" id="6538850">benchmarkDecode</span><span class="op" id="6538865">(</span><span class="ident" id="6538866">b</span>&nbsp;<span class="op" id="6538868">*</span><span class="ident" id="6538869">testing</span><span class="op" id="6538876">.</span><span class="ident" id="6538877">B</span><span class="op" id="6538878">,</span>&nbsp;<span class="ident" id="6538880">filename</span>&nbsp;<span class="builtintype" id="6538889">string</span><span class="op" id="6538895">,</span>&nbsp;<span class="ident" id="6538897">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6538911">int</span><span class="op" id="6538914">)</span>&nbsp;<span class="op" id="6538916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538919">b</span><span class="op" id="6538920">.</span><span class="ident" id="6538921">StopTimer</span><span class="op" id="6538930">(</span><span class="op" id="6538931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538934">data</span><span class="op" id="6538938">,</span>&nbsp;<span class="ident" id="6538940">err</span>&nbsp;<span class="op" id="6538944">:=</span>&nbsp;<span class="ident" id="6538947">ioutil</span><span class="op" id="6538953">.</span><span class="ident" id="6538954">ReadFile</span><span class="op" id="6538962">(</span><span class="ident" id="6538963">filename</span><span class="op" id="6538971">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538974">if</span>&nbsp;<span class="ident" id="6538977">err</span>&nbsp;<span class="op" id="6538981">!=</span>&nbsp;<span class="ident" id="6538984">nil</span>&nbsp;<span class="op" id="6538988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538992">b</span><span class="op" id="6538993">.</span><span class="ident" id="6538994">Fatal</span><span class="op" id="6538999">(</span><span class="ident" id="6539000">err</span><span class="op" id="6539003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539009">s</span>&nbsp;<span class="op" id="6539011">:=</span>&nbsp;<span class="builtintype" id="6539014">string</span><span class="op" id="6539020">(</span><span class="ident" id="6539021">data</span><span class="op" id="6539025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539028">cfg</span><span class="op" id="6539031">,</span>&nbsp;<span class="ident" id="6539033">err</span>&nbsp;<span class="op" id="6539037">:=</span>&nbsp;<span class="ident" id="6539040">DecodeConfig</span><span class="op" id="6539052">(</span><span class="ident" id="6539053">strings</span><span class="op" id="6539060">.</span><span class="ident" id="6539061">NewReader</span><span class="op" id="6539070">(</span><span class="ident" id="6539071">s</span><span class="op" id="6539072">)</span><span class="op" id="6539073">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539076">if</span>&nbsp;<span class="ident" id="6539079">err</span>&nbsp;<span class="op" id="6539083">!=</span>&nbsp;<span class="ident" id="6539086">nil</span>&nbsp;<span class="op" id="6539090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539094">b</span><span class="op" id="6539095">.</span><span class="ident" id="6539096">Fatal</span><span class="op" id="6539101">(</span><span class="ident" id="6539102">err</span><span class="op" id="6539105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539111">b</span><span class="op" id="6539112">.</span><span class="ident" id="6539113">SetBytes</span><span class="op" id="6539121">(</span><span class="ident" id="6539122">int64</span><span class="op" id="6539127">(</span><span class="ident" id="6539128">cfg</span><span class="op" id="6539131">.</span><span class="ident" id="6539132">Width</span>&nbsp;<span class="op" id="6539138">*</span>&nbsp;<span class="ident" id="6539140">cfg</span><span class="op" id="6539143">.</span><span class="ident" id="6539144">Height</span>&nbsp;<span class="op" id="6539151">*</span>&nbsp;<span class="ident" id="6539153">bytesPerPixel</span><span class="op" id="6539166">)</span><span class="op" id="6539167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539170">b</span><span class="op" id="6539171">.</span><span class="ident" id="6539172">StartTimer</span><span class="op" id="6539182">(</span><span class="op" id="6539183">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539186">for</span>&nbsp;<span class="ident" id="6539190">i</span>&nbsp;<span class="op" id="6539192">:=</span>&nbsp;<span class="num" id="6539195">0</span><span class="op" id="6539196">;</span>&nbsp;<span class="ident" id="6539198">i</span>&nbsp;<span class="op" id="6539200">&lt;</span>&nbsp;<span class="ident" id="6539202">b</span><span class="op" id="6539203">.</span><span class="ident" id="6539204">N</span><span class="op" id="6539205">;</span>&nbsp;<span class="ident" id="6539207">i</span><span class="op" id="6539208">++</span>&nbsp;<span class="op" id="6539211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539215">Decode</span><span class="op" id="6539221">(</span><span class="ident" id="6539222">strings</span><span class="op" id="6539229">.</span><span class="ident" id="6539230">NewReader</span><span class="op" id="6539239">(</span><span class="ident" id="6539240">s</span><span class="op" id="6539241">)</span><span class="op" id="6539242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539245">}</span><br>
<span class="lineno"></span><span class="op" id="6539247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6539250">func</span>&nbsp;<span class="ident" id="6539255">BenchmarkDecodeGray</span><span class="op" id="6539274">(</span><span class="ident" id="6539275">b</span>&nbsp;<span class="op" id="6539277">*</span><span class="ident" id="6539278">testing</span><span class="op" id="6539285">.</span><span class="ident" id="6539286">B</span><span class="op" id="6539287">)</span>&nbsp;<span class="op" id="6539289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539292">benchmarkDecode</span><span class="op" id="6539307">(</span><span class="ident" id="6539308">b</span><span class="op" id="6539309">,</span>&nbsp;<span class="string" id="6539311">&#34;testdata/benchGray.png&#34;</span><span class="op" id="6539335">,</span>&nbsp;<span class="num" id="6539337">1</span><span class="op" id="6539338">)</span><br>
<span class="lineno"></span><span class="op" id="6539340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539343">func</span>&nbsp;<span class="ident" id="6539348">BenchmarkDecodeNRGBAGradient</span><span class="op" id="6539376">(</span><span class="ident" id="6539377">b</span>&nbsp;<span class="op" id="6539379">*</span><span class="ident" id="6539380">testing</span><span class="op" id="6539387">.</span><span class="ident" id="6539388">B</span><span class="op" id="6539389">)</span>&nbsp;<span class="op" id="6539391">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539394">benchmarkDecode</span><span class="op" id="6539409">(</span><span class="ident" id="6539410">b</span><span class="op" id="6539411">,</span>&nbsp;<span class="string" id="6539413">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="6539447">,</span>&nbsp;<span class="num" id="6539449">4</span><span class="op" id="6539450">)</span><br>
<span class="lineno"></span><span class="op" id="6539452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539455">func</span>&nbsp;<span class="ident" id="6539460">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="6539486">(</span><span class="ident" id="6539487">b</span>&nbsp;<span class="op" id="6539489">*</span><span class="ident" id="6539490">testing</span><span class="op" id="6539497">.</span><span class="ident" id="6539498">B</span><span class="op" id="6539499">)</span>&nbsp;<span class="op" id="6539501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539504">benchmarkDecode</span><span class="op" id="6539519">(</span><span class="ident" id="6539520">b</span><span class="op" id="6539521">,</span>&nbsp;<span class="string" id="6539523">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="6539555">,</span>&nbsp;<span class="num" id="6539557">4</span><span class="op" id="6539558">)</span><br>
<span class="lineno">350</span><span class="op" id="6539560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539563">func</span>&nbsp;<span class="ident" id="6539568">BenchmarkDecodePaletted</span><span class="op" id="6539591">(</span><span class="ident" id="6539592">b</span>&nbsp;<span class="op" id="6539594">*</span><span class="ident" id="6539595">testing</span><span class="op" id="6539602">.</span><span class="ident" id="6539603">B</span><span class="op" id="6539604">)</span>&nbsp;<span class="op" id="6539606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539609">benchmarkDecode</span><span class="op" id="6539624">(</span><span class="ident" id="6539625">b</span><span class="op" id="6539626">,</span>&nbsp;<span class="string" id="6539628">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="6539656">,</span>&nbsp;<span class="num" id="6539658">1</span><span class="op" id="6539659">)</span><br>
<span class="lineno"></span><span class="op" id="6539661">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6539664">func</span>&nbsp;<span class="ident" id="6539669">BenchmarkDecodeRGB</span><span class="op" id="6539687">(</span><span class="ident" id="6539688">b</span>&nbsp;<span class="op" id="6539690">*</span><span class="ident" id="6539691">testing</span><span class="op" id="6539698">.</span><span class="ident" id="6539699">B</span><span class="op" id="6539700">)</span>&nbsp;<span class="op" id="6539702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539705">benchmarkDecode</span><span class="op" id="6539720">(</span><span class="ident" id="6539721">b</span><span class="op" id="6539722">,</span>&nbsp;<span class="string" id="6539724">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="6539747">,</span>&nbsp;<span class="num" id="6539749">4</span><span class="op" id="6539750">)</span><br>
<span class="lineno"></span><span class="op" id="6539752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="6539755">func</span>&nbsp;<span class="ident" id="6539760">BenchmarkDecodeInterlacing</span><span class="op" id="6539786">(</span><span class="ident" id="6539787">b</span>&nbsp;<span class="op" id="6539789">*</span><span class="ident" id="6539790">testing</span><span class="op" id="6539797">.</span><span class="ident" id="6539798">B</span><span class="op" id="6539799">)</span>&nbsp;<span class="op" id="6539801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539804">benchmarkDecode</span><span class="op" id="6539819">(</span><span class="ident" id="6539820">b</span><span class="op" id="6539821">,</span>&nbsp;<span class="string" id="6539823">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="6539856">,</span>&nbsp;<span class="num" id="6539858">4</span><span class="op" id="6539859">)</span><br>
<span class="lineno"></span><span class="op" id="6539861">}</span>
</div>
</body>
</html>
