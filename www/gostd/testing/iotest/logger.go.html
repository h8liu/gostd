<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html" class="current">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5960730">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5960785">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5960839">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5960890">package</span>&nbsp;<span class="ident" id="5960898">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5960906">import</span>&nbsp;<span class="op" id="5960913">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5960916">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5960922">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5960928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5960931">type</span>&nbsp;<span class="ident" id="5960936">writeLogger</span>&nbsp;<span class="keyword" id="5960948">struct</span>&nbsp;<span class="op" id="5960955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960958">prefix</span>&nbsp;<span class="builtintype" id="5960965">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960973">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960980">io</span><span class="op" id="5960982">.</span><span class="ident" id="5960983">Writer</span><br>
<span class="lineno">15</span><span class="op" id="5960990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5960993">func</span>&nbsp;<span class="op" id="5960998">(</span><span class="ident" id="5960999">l</span>&nbsp;<span class="op" id="5961001">*</span><span class="ident" id="5961002">writeLogger</span><span class="op" id="5961013">)</span>&nbsp;<span class="ident" id="5961015">Write</span><span class="op" id="5961020">(</span><span class="ident" id="5961021">p</span>&nbsp;<span class="op" id="5961023">[</span><span class="op" id="5961024">]</span><span class="builtintype" id="5961025">byte</span><span class="op" id="5961029">)</span>&nbsp;<span class="op" id="5961031">(</span><span class="ident" id="5961032">n</span>&nbsp;<span class="builtintype" id="5961034">int</span><span class="op" id="5961037">,</span>&nbsp;<span class="ident" id="5961039">err</span>&nbsp;<span class="builtintype" id="5961043">error</span><span class="op" id="5961048">)</span>&nbsp;<span class="op" id="5961050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961053">n</span><span class="op" id="5961054">,</span>&nbsp;<span class="ident" id="5961056">err</span>&nbsp;<span class="op" id="5961060">=</span>&nbsp;<span class="ident" id="5961062">l</span><span class="op" id="5961063">.</span><span class="ident" id="5961064">w</span><span class="op" id="5961065">.</span><span class="ident" id="5961066">Write</span><span class="op" id="5961071">(</span><span class="ident" id="5961072">p</span><span class="op" id="5961073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961076">if</span>&nbsp;<span class="ident" id="5961079">err</span>&nbsp;<span class="op" id="5961083">!=</span>&nbsp;<span class="builtintype" id="5961086">nil</span>&nbsp;<span class="op" id="5961090">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961094">log</span><span class="op" id="5961097">.</span><span class="ident" id="5961098">Printf</span><span class="op" id="5961104">(</span><span class="string" id="5961105">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="5961116">,</span>&nbsp;<span class="ident" id="5961118">l</span><span class="op" id="5961119">.</span><span class="ident" id="5961120">prefix</span><span class="op" id="5961126">,</span>&nbsp;<span class="ident" id="5961128">p</span><span class="op" id="5961129">[</span><span class="num" id="5961130">0</span><span class="op" id="5961131">:</span><span class="ident" id="5961132">n</span><span class="op" id="5961133">]</span><span class="op" id="5961134">,</span>&nbsp;<span class="ident" id="5961136">err</span><span class="op" id="5961139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961142">}</span>&nbsp;<span class="keyword" id="5961144">else</span>&nbsp;<span class="op" id="5961149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961153">log</span><span class="op" id="5961156">.</span><span class="ident" id="5961157">Printf</span><span class="op" id="5961163">(</span><span class="string" id="5961164">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5961171">,</span>&nbsp;<span class="ident" id="5961173">l</span><span class="op" id="5961174">.</span><span class="ident" id="5961175">prefix</span><span class="op" id="5961181">,</span>&nbsp;<span class="ident" id="5961183">p</span><span class="op" id="5961184">[</span><span class="num" id="5961185">0</span><span class="op" id="5961186">:</span><span class="ident" id="5961187">n</span><span class="op" id="5961188">]</span><span class="op" id="5961189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961195">return</span><br>
<span class="lineno">25</span><span class="op" id="5961202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961205">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="5961267">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="5961332">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="5961389">func</span>&nbsp;<span class="ident" id="5961394">NewWriteLogger</span><span class="op" id="5961408">(</span><span class="ident" id="5961409">prefix</span>&nbsp;<span class="builtintype" id="5961416">string</span><span class="op" id="5961422">,</span>&nbsp;<span class="ident" id="5961424">w</span>&nbsp;<span class="ident" id="5961426">io</span><span class="op" id="5961428">.</span><span class="ident" id="5961429">Writer</span><span class="op" id="5961435">)</span>&nbsp;<span class="ident" id="5961437">io</span><span class="op" id="5961439">.</span><span class="ident" id="5961440">Writer</span>&nbsp;<span class="op" id="5961447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961450">return</span>&nbsp;<span class="op" id="5961457">&amp;</span><span class="ident" id="5961458">writeLogger</span><span class="op" id="5961469">{</span><span class="ident" id="5961470">prefix</span><span class="op" id="5961476">,</span>&nbsp;<span class="ident" id="5961478">w</span><span class="op" id="5961479">}</span><br>
<span class="lineno"></span><span class="op" id="5961481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5961484">type</span>&nbsp;<span class="ident" id="5961489">readLogger</span>&nbsp;<span class="keyword" id="5961500">struct</span>&nbsp;<span class="op" id="5961507">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961510">prefix</span>&nbsp;<span class="builtintype" id="5961517">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961525">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961532">io</span><span class="op" id="5961534">.</span><span class="ident" id="5961535">Reader</span><br>
<span class="lineno"></span><span class="op" id="5961542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5961545">func</span>&nbsp;<span class="op" id="5961550">(</span><span class="ident" id="5961551">l</span>&nbsp;<span class="op" id="5961553">*</span><span class="ident" id="5961554">readLogger</span><span class="op" id="5961564">)</span>&nbsp;<span class="ident" id="5961566">Read</span><span class="op" id="5961570">(</span><span class="ident" id="5961571">p</span>&nbsp;<span class="op" id="5961573">[</span><span class="op" id="5961574">]</span><span class="builtintype" id="5961575">byte</span><span class="op" id="5961579">)</span>&nbsp;<span class="op" id="5961581">(</span><span class="ident" id="5961582">n</span>&nbsp;<span class="builtintype" id="5961584">int</span><span class="op" id="5961587">,</span>&nbsp;<span class="ident" id="5961589">err</span>&nbsp;<span class="builtintype" id="5961593">error</span><span class="op" id="5961598">)</span>&nbsp;<span class="op" id="5961600">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961603">n</span><span class="op" id="5961604">,</span>&nbsp;<span class="ident" id="5961606">err</span>&nbsp;<span class="op" id="5961610">=</span>&nbsp;<span class="ident" id="5961612">l</span><span class="op" id="5961613">.</span><span class="ident" id="5961614">r</span><span class="op" id="5961615">.</span><span class="ident" id="5961616">Read</span><span class="op" id="5961620">(</span><span class="ident" id="5961621">p</span><span class="op" id="5961622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961625">if</span>&nbsp;<span class="ident" id="5961628">err</span>&nbsp;<span class="op" id="5961632">!=</span>&nbsp;<span class="builtintype" id="5961635">nil</span>&nbsp;<span class="op" id="5961639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961643">log</span><span class="op" id="5961646">.</span><span class="ident" id="5961647">Printf</span><span class="op" id="5961653">(</span><span class="string" id="5961654">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="5961665">,</span>&nbsp;<span class="ident" id="5961667">l</span><span class="op" id="5961668">.</span><span class="ident" id="5961669">prefix</span><span class="op" id="5961675">,</span>&nbsp;<span class="ident" id="5961677">p</span><span class="op" id="5961678">[</span><span class="num" id="5961679">0</span><span class="op" id="5961680">:</span><span class="ident" id="5961681">n</span><span class="op" id="5961682">]</span><span class="op" id="5961683">,</span>&nbsp;<span class="ident" id="5961685">err</span><span class="op" id="5961688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961691">}</span>&nbsp;<span class="keyword" id="5961693">else</span>&nbsp;<span class="op" id="5961698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961702">log</span><span class="op" id="5961705">.</span><span class="ident" id="5961706">Printf</span><span class="op" id="5961712">(</span><span class="string" id="5961713">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5961720">,</span>&nbsp;<span class="ident" id="5961722">l</span><span class="op" id="5961723">.</span><span class="ident" id="5961724">prefix</span><span class="op" id="5961730">,</span>&nbsp;<span class="ident" id="5961732">p</span><span class="op" id="5961733">[</span><span class="num" id="5961734">0</span><span class="op" id="5961735">:</span><span class="ident" id="5961736">n</span><span class="op" id="5961737">]</span><span class="op" id="5961738">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961744">return</span><br>
<span class="lineno"></span><span class="op" id="5961751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961754">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="5961815">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="5961878">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="5961935">func</span>&nbsp;<span class="ident" id="5961940">NewReadLogger</span><span class="op" id="5961953">(</span><span class="ident" id="5961954">prefix</span>&nbsp;<span class="builtintype" id="5961961">string</span><span class="op" id="5961967">,</span>&nbsp;<span class="ident" id="5961969">r</span>&nbsp;<span class="ident" id="5961971">io</span><span class="op" id="5961973">.</span><span class="ident" id="5961974">Reader</span><span class="op" id="5961980">)</span>&nbsp;<span class="ident" id="5961982">io</span><span class="op" id="5961984">.</span><span class="ident" id="5961985">Reader</span>&nbsp;<span class="op" id="5961992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961995">return</span>&nbsp;<span class="op" id="5962002">&amp;</span><span class="ident" id="5962003">readLogger</span><span class="op" id="5962013">{</span><span class="ident" id="5962014">prefix</span><span class="op" id="5962020">,</span>&nbsp;<span class="ident" id="5962022">r</span><span class="op" id="5962023">}</span><br>
<span class="lineno"></span><span class="op" id="5962025">}</span>
</div>
</body>
</html>
