<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>internal/syscall</h2>
<ul>
<li><a href="/gostd/internal/syscall/getrandom_linux.go.html">getrandom_linux.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3836501">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3836557">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3836611">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3836662">package</span>&nbsp;<span class="ident" id="3836670">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3836679">import</span>&nbsp;<span class="op" id="3836686">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836689">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836700">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3836715">stdsyscall</span>&nbsp;<span class="string" id="3836726">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836737">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3836746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3836749">var</span>&nbsp;<span class="ident" id="3836753">randomTrap</span>&nbsp;<span class="op" id="3836764">=</span>&nbsp;<span class="keyword" id="3836766">map</span><span class="op" id="3836769">[</span><span class="builtintype" id="3836770">string</span><span class="op" id="3836776">]</span><span class="builtintype" id="3836777">uintptr</span><span class="op" id="3836784">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836787">&#34;386&#34;</span><span class="op" id="3836792">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3836796">355</span><span class="op" id="3836799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836802">&#34;amd64&#34;</span><span class="op" id="3836809">:</span>&nbsp;<span class="num" id="3836811">318</span><span class="op" id="3836814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836817">&#34;arm&#34;</span><span class="op" id="3836822">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3836826">384</span><span class="op" id="3836829">,</span><br>
<span class="lineno"></span><span class="op" id="3836831">}</span><span class="op" id="3836832">[</span><span class="ident" id="3836833">runtime</span><span class="op" id="3836840">.</span><span class="ident" id="3836841">GOARCH</span><span class="op" id="3836847">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3836850">var</span>&nbsp;<span class="ident" id="3836854">randomUnsupported</span>&nbsp;<span class="builtintype" id="3836872">int32</span>&nbsp;<span class="comment" id="3836878">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3836889">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3836956">type</span>&nbsp;<span class="ident" id="3836961">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3836975">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3836984">const</span>&nbsp;<span class="op" id="3836990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3836993">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837053">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3837067">GetRandomFlag</span>&nbsp;<span class="op" id="3837081">=</span>&nbsp;<span class="num" id="3837083">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3837092">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837164">GRND_RANDOM</span>&nbsp;<span class="ident" id="3837176">GetRandomFlag</span>&nbsp;<span class="op" id="3837190">=</span>&nbsp;<span class="num" id="3837192">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3837199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3837202">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3837254">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3837377">func</span>&nbsp;<span class="ident" id="3837382">GetRandom</span><span class="op" id="3837391">(</span><span class="ident" id="3837392">p</span>&nbsp;<span class="op" id="3837394">[</span><span class="op" id="3837395">]</span><span class="builtintype" id="3837396">byte</span><span class="op" id="3837400">,</span>&nbsp;<span class="ident" id="3837402">flags</span>&nbsp;<span class="ident" id="3837408">GetRandomFlag</span><span class="op" id="3837421">)</span>&nbsp;<span class="op" id="3837423">(</span><span class="ident" id="3837424">n</span>&nbsp;<span class="builtintype" id="3837426">int</span><span class="op" id="3837429">,</span>&nbsp;<span class="ident" id="3837431">err</span>&nbsp;<span class="builtintype" id="3837435">error</span><span class="op" id="3837440">)</span>&nbsp;<span class="op" id="3837442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837445">if</span>&nbsp;<span class="ident" id="3837448">randomTrap</span>&nbsp;<span class="op" id="3837459">==</span>&nbsp;<span class="num" id="3837462">0</span>&nbsp;<span class="op" id="3837464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837468">return</span>&nbsp;<span class="num" id="3837475">0</span><span class="op" id="3837476">,</span>&nbsp;<span class="ident" id="3837478">stdsyscall</span><span class="op" id="3837488">.</span><span class="ident" id="3837489">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837500">if</span>&nbsp;<span class="builtinfunc" id="3837503">len</span><span class="op" id="3837506">(</span><span class="ident" id="3837507">p</span><span class="op" id="3837508">)</span>&nbsp;<span class="op" id="3837510">==</span>&nbsp;<span class="num" id="3837513">0</span>&nbsp;<span class="op" id="3837515">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837519">return</span>&nbsp;<span class="num" id="3837526">0</span><span class="op" id="3837527">,</span>&nbsp;<span class="ident" id="3837529">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837537">if</span>&nbsp;<span class="ident" id="3837540">atomic</span><span class="op" id="3837546">.</span><span class="ident" id="3837547">LoadInt32</span><span class="op" id="3837556">(</span><span class="op" id="3837557">&amp;</span><span class="ident" id="3837558">randomUnsupported</span><span class="op" id="3837575">)</span>&nbsp;<span class="op" id="3837577">!=</span>&nbsp;<span class="num" id="3837580">0</span>&nbsp;<span class="op" id="3837582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837586">return</span>&nbsp;<span class="num" id="3837593">0</span><span class="op" id="3837594">,</span>&nbsp;<span class="ident" id="3837596">stdsyscall</span><span class="op" id="3837606">.</span><span class="ident" id="3837607">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837615">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837618">r1</span><span class="op" id="3837620">,</span>&nbsp;<span class="ident" id="3837622">_</span><span class="op" id="3837623">,</span>&nbsp;<span class="ident" id="3837625">errno</span>&nbsp;<span class="op" id="3837631">:=</span>&nbsp;<span class="ident" id="3837634">stdsyscall</span><span class="op" id="3837644">.</span><span class="ident" id="3837645">Syscall</span><span class="op" id="3837652">(</span><span class="ident" id="3837653">randomTrap</span><span class="op" id="3837663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3837667">uintptr</span><span class="op" id="3837674">(</span><span class="ident" id="3837675">unsafe</span><span class="op" id="3837681">.</span><span class="ident" id="3837682">Pointer</span><span class="op" id="3837689">(</span><span class="op" id="3837690">&amp;</span><span class="ident" id="3837691">p</span><span class="op" id="3837692">[</span><span class="num" id="3837693">0</span><span class="op" id="3837694">]</span><span class="op" id="3837695">)</span><span class="op" id="3837696">)</span><span class="op" id="3837697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3837701">uintptr</span><span class="op" id="3837708">(</span><span class="builtinfunc" id="3837709">len</span><span class="op" id="3837712">(</span><span class="ident" id="3837713">p</span><span class="op" id="3837714">)</span><span class="op" id="3837715">)</span><span class="op" id="3837716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3837720">uintptr</span><span class="op" id="3837727">(</span><span class="ident" id="3837728">flags</span><span class="op" id="3837733">)</span><span class="op" id="3837734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837737">if</span>&nbsp;<span class="ident" id="3837740">errno</span>&nbsp;<span class="op" id="3837746">!=</span>&nbsp;<span class="num" id="3837749">0</span>&nbsp;<span class="op" id="3837751">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837755">if</span>&nbsp;<span class="ident" id="3837758">errno</span>&nbsp;<span class="op" id="3837764">==</span>&nbsp;<span class="ident" id="3837767">stdsyscall</span><span class="op" id="3837777">.</span><span class="ident" id="3837778">ENOSYS</span>&nbsp;<span class="op" id="3837785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837790">atomic</span><span class="op" id="3837796">.</span><span class="ident" id="3837797">StoreInt32</span><span class="op" id="3837807">(</span><span class="op" id="3837808">&amp;</span><span class="ident" id="3837809">randomUnsupported</span><span class="op" id="3837826">,</span>&nbsp;<span class="num" id="3837828">1</span><span class="op" id="3837829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837837">return</span>&nbsp;<span class="num" id="3837844">0</span><span class="op" id="3837845">,</span>&nbsp;<span class="ident" id="3837847">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837854">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837857">return</span>&nbsp;<span class="builtintype" id="3837864">int</span><span class="op" id="3837867">(</span><span class="ident" id="3837868">r1</span><span class="op" id="3837870">)</span><span class="op" id="3837871">,</span>&nbsp;<span class="ident" id="3837873">nil</span><br>
<span class="lineno"></span><span class="op" id="3837877">}</span>
</div>
</body>
</html>
