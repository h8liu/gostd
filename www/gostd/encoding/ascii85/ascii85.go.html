<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6161401">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6161456">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6161510">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6161561">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6161617">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6161694">package</span>&nbsp;<span class="ident" id="6161702">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6161711">import</span>&nbsp;<span class="op" id="6161718">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6161721">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6161727">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6161737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161740">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161759">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6161818">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6161881">//</span><br>
<span class="lineno"></span><span class="comment" id="6161884">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6161948">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6162014">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6162086">//</span><br>
<span class="lineno">25</span><span class="comment" id="6162089">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6162153">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6162183">func</span>&nbsp;<span class="ident" id="6162188">Encode</span><span class="op" id="6162194">(</span><span class="ident" id="6162195">dst</span><span class="op" id="6162198">,</span>&nbsp;<span class="ident" id="6162200">src</span>&nbsp;<span class="op" id="6162204">[</span><span class="op" id="6162205">]</span><span class="builtintype" id="6162206">byte</span><span class="op" id="6162210">)</span>&nbsp;<span class="builtintype" id="6162212">int</span>&nbsp;<span class="op" id="6162216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162219">if</span>&nbsp;<span class="builtinfunc" id="6162222">len</span><span class="op" id="6162225">(</span><span class="ident" id="6162226">src</span><span class="op" id="6162229">)</span>&nbsp;<span class="op" id="6162231">==</span>&nbsp;<span class="num" id="6162234">0</span>&nbsp;<span class="op" id="6162236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162240">return</span>&nbsp;<span class="num" id="6162247">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6162250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162254">n</span>&nbsp;<span class="op" id="6162256">:=</span>&nbsp;<span class="num" id="6162259">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162262">for</span>&nbsp;<span class="builtinfunc" id="6162266">len</span><span class="op" id="6162269">(</span><span class="ident" id="6162270">src</span><span class="op" id="6162273">)</span>&nbsp;<span class="op" id="6162275">&gt;</span>&nbsp;<span class="num" id="6162277">0</span>&nbsp;<span class="op" id="6162279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162283">dst</span><span class="op" id="6162286">[</span><span class="num" id="6162287">0</span><span class="op" id="6162288">]</span>&nbsp;<span class="op" id="6162290">=</span>&nbsp;<span class="num" id="6162292">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162296">dst</span><span class="op" id="6162299">[</span><span class="num" id="6162300">1</span><span class="op" id="6162301">]</span>&nbsp;<span class="op" id="6162303">=</span>&nbsp;<span class="num" id="6162305">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162309">dst</span><span class="op" id="6162312">[</span><span class="num" id="6162313">2</span><span class="op" id="6162314">]</span>&nbsp;<span class="op" id="6162316">=</span>&nbsp;<span class="num" id="6162318">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162322">dst</span><span class="op" id="6162325">[</span><span class="num" id="6162326">3</span><span class="op" id="6162327">]</span>&nbsp;<span class="op" id="6162329">=</span>&nbsp;<span class="num" id="6162331">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162335">dst</span><span class="op" id="6162338">[</span><span class="num" id="6162339">4</span><span class="op" id="6162340">]</span>&nbsp;<span class="op" id="6162342">=</span>&nbsp;<span class="num" id="6162344">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6162349">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162412">var</span>&nbsp;<span class="ident" id="6162416">v</span>&nbsp;<span class="builtintype" id="6162418">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162427">switch</span>&nbsp;<span class="builtinfunc" id="6162434">len</span><span class="op" id="6162437">(</span><span class="ident" id="6162438">src</span><span class="op" id="6162441">)</span>&nbsp;<span class="op" id="6162443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162447">default</span><span class="op" id="6162454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162459">v</span>&nbsp;<span class="op" id="6162461">|=</span>&nbsp;<span class="builtintype" id="6162464">uint32</span><span class="op" id="6162470">(</span><span class="ident" id="6162471">src</span><span class="op" id="6162474">[</span><span class="num" id="6162475">3</span><span class="op" id="6162476">]</span><span class="op" id="6162477">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162482">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162496">case</span>&nbsp;<span class="num" id="6162501">3</span><span class="op" id="6162502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162507">v</span>&nbsp;<span class="op" id="6162509">|=</span>&nbsp;<span class="builtintype" id="6162512">uint32</span><span class="op" id="6162518">(</span><span class="ident" id="6162519">src</span><span class="op" id="6162522">[</span><span class="num" id="6162523">2</span><span class="op" id="6162524">]</span><span class="op" id="6162525">)</span>&nbsp;<span class="op" id="6162527">&lt;&lt;</span>&nbsp;<span class="num" id="6162530">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162535">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162549">case</span>&nbsp;<span class="num" id="6162554">2</span><span class="op" id="6162555">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162560">v</span>&nbsp;<span class="op" id="6162562">|=</span>&nbsp;<span class="builtintype" id="6162565">uint32</span><span class="op" id="6162571">(</span><span class="ident" id="6162572">src</span><span class="op" id="6162575">[</span><span class="num" id="6162576">1</span><span class="op" id="6162577">]</span><span class="op" id="6162578">)</span>&nbsp;<span class="op" id="6162580">&lt;&lt;</span>&nbsp;<span class="num" id="6162583">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162589">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162603">case</span>&nbsp;<span class="num" id="6162608">1</span><span class="op" id="6162609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162614">v</span>&nbsp;<span class="op" id="6162616">|=</span>&nbsp;<span class="builtintype" id="6162619">uint32</span><span class="op" id="6162625">(</span><span class="ident" id="6162626">src</span><span class="op" id="6162629">[</span><span class="num" id="6162630">0</span><span class="op" id="6162631">]</span><span class="op" id="6162632">)</span>&nbsp;<span class="op" id="6162634">&lt;&lt;</span>&nbsp;<span class="num" id="6162637">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6162642">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6162647">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162694">if</span>&nbsp;<span class="ident" id="6162697">v</span>&nbsp;<span class="op" id="6162699">==</span>&nbsp;<span class="num" id="6162702">0</span>&nbsp;<span class="op" id="6162704">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6162707">len</span><span class="op" id="6162710">(</span><span class="ident" id="6162711">src</span><span class="op" id="6162714">)</span>&nbsp;<span class="op" id="6162716">&gt;=</span>&nbsp;<span class="num" id="6162719">4</span>&nbsp;<span class="op" id="6162721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162726">dst</span><span class="op" id="6162729">[</span><span class="num" id="6162730">0</span><span class="op" id="6162731">]</span>&nbsp;<span class="op" id="6162733">=</span>&nbsp;<span class="string" id="6162735">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162742">dst</span>&nbsp;<span class="op" id="6162746">=</span>&nbsp;<span class="ident" id="6162748">dst</span><span class="op" id="6162751">[</span><span class="num" id="6162752">1</span><span class="op" id="6162753">:</span><span class="op" id="6162754">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162759">src</span>&nbsp;<span class="op" id="6162763">=</span>&nbsp;<span class="ident" id="6162765">src</span><span class="op" id="6162768">[</span><span class="num" id="6162769">4</span><span class="op" id="6162770">:</span><span class="op" id="6162771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162776">n</span><span class="op" id="6162777">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162783">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6162794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6162799">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162847">for</span>&nbsp;<span class="ident" id="6162851">i</span>&nbsp;<span class="op" id="6162853">:=</span>&nbsp;<span class="num" id="6162856">4</span><span class="op" id="6162857">;</span>&nbsp;<span class="ident" id="6162859">i</span>&nbsp;<span class="op" id="6162861">&gt;=</span>&nbsp;<span class="num" id="6162864">0</span><span class="op" id="6162865">;</span>&nbsp;<span class="ident" id="6162867">i</span><span class="op" id="6162868">--</span>&nbsp;<span class="op" id="6162871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162876">dst</span><span class="op" id="6162879">[</span><span class="ident" id="6162880">i</span><span class="op" id="6162881">]</span>&nbsp;<span class="op" id="6162883">=</span>&nbsp;<span class="string" id="6162885">&#39;!&#39;</span>&nbsp;<span class="op" id="6162889">+</span>&nbsp;<span class="builtintype" id="6162891">byte</span><span class="op" id="6162895">(</span><span class="ident" id="6162896">v</span><span class="op" id="6162897">%</span><span class="num" id="6162898">85</span><span class="op" id="6162900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162905">v</span>&nbsp;<span class="op" id="6162907">/=</span>&nbsp;<span class="num" id="6162910">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6162915">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6162920">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6162978">m</span>&nbsp;<span class="op" id="6162980">:=</span>&nbsp;<span class="num" id="6162983">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162987">if</span>&nbsp;<span class="builtinfunc" id="6162990">len</span><span class="op" id="6162993">(</span><span class="ident" id="6162994">src</span><span class="op" id="6162997">)</span>&nbsp;<span class="op" id="6162999">&lt;</span>&nbsp;<span class="num" id="6163001">4</span>&nbsp;<span class="op" id="6163003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163008">m</span>&nbsp;<span class="op" id="6163010">-=</span>&nbsp;<span class="num" id="6163013">4</span>&nbsp;<span class="op" id="6163015">-</span>&nbsp;<span class="builtinfunc" id="6163017">len</span><span class="op" id="6163020">(</span><span class="ident" id="6163021">src</span><span class="op" id="6163024">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163029">src</span>&nbsp;<span class="op" id="6163033">=</span>&nbsp;<span class="ident" id="6163035">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163041">}</span>&nbsp;<span class="keyword" id="6163043">else</span>&nbsp;<span class="op" id="6163048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163053">src</span>&nbsp;<span class="op" id="6163057">=</span>&nbsp;<span class="ident" id="6163059">src</span><span class="op" id="6163062">[</span><span class="num" id="6163063">4</span><span class="op" id="6163064">:</span><span class="op" id="6163065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163073">dst</span>&nbsp;<span class="op" id="6163077">=</span>&nbsp;<span class="ident" id="6163079">dst</span><span class="op" id="6163082">[</span><span class="ident" id="6163083">m</span><span class="op" id="6163084">:</span><span class="op" id="6163085">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163089">n</span>&nbsp;<span class="op" id="6163091">+=</span>&nbsp;<span class="ident" id="6163094">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163100">return</span>&nbsp;<span class="ident" id="6163107">n</span><br>
<span class="lineno"></span><span class="op" id="6163109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6163112">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6163190">func</span>&nbsp;<span class="ident" id="6163195">MaxEncodedLen</span><span class="op" id="6163208">(</span><span class="ident" id="6163209">n</span>&nbsp;<span class="builtintype" id="6163211">int</span><span class="op" id="6163214">)</span>&nbsp;<span class="builtintype" id="6163216">int</span>&nbsp;<span class="op" id="6163220">{</span>&nbsp;<span class="keyword" id="6163222">return</span>&nbsp;<span class="op" id="6163229">(</span><span class="ident" id="6163230">n</span>&nbsp;<span class="op" id="6163232">+</span>&nbsp;<span class="num" id="6163234">3</span><span class="op" id="6163235">)</span>&nbsp;<span class="op" id="6163237">/</span>&nbsp;<span class="num" id="6163239">4</span>&nbsp;<span class="op" id="6163241">*</span>&nbsp;<span class="num" id="6163243">5</span>&nbsp;<span class="op" id="6163245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6163248">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6163317">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6163379">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6163440">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6163508">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6163535">func</span>&nbsp;<span class="ident" id="6163540">NewEncoder</span><span class="op" id="6163550">(</span><span class="ident" id="6163551">w</span>&nbsp;<span class="ident" id="6163553">io</span><span class="op" id="6163555">.</span><span class="ident" id="6163556">Writer</span><span class="op" id="6163562">)</span>&nbsp;<span class="ident" id="6163564">io</span><span class="op" id="6163566">.</span><span class="ident" id="6163567">WriteCloser</span>&nbsp;<span class="op" id="6163579">{</span>&nbsp;<span class="keyword" id="6163581">return</span>&nbsp;<span class="op" id="6163588">&amp;</span><span class="ident" id="6163589">encoder</span><span class="op" id="6163596">{</span><span class="ident" id="6163597">w</span><span class="op" id="6163598">:</span>&nbsp;<span class="ident" id="6163600">w</span><span class="op" id="6163601">}</span>&nbsp;<span class="op" id="6163603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6163606">type</span>&nbsp;<span class="ident" id="6163611">encoder</span>&nbsp;<span class="keyword" id="6163619">struct</span>&nbsp;<span class="op" id="6163626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163629">err</span>&nbsp;&nbsp;<span class="builtintype" id="6163634">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163641">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163646">io</span><span class="op" id="6163648">.</span><span class="ident" id="6163649">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163657">buf</span>&nbsp;&nbsp;<span class="op" id="6163662">[</span><span class="num" id="6163663">4</span><span class="op" id="6163664">]</span><span class="builtintype" id="6163665">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163673">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163713">nbuf</span>&nbsp;<span class="builtintype" id="6163718">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163729">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163756">out</span>&nbsp;&nbsp;<span class="op" id="6163761">[</span><span class="num" id="6163762">1024</span><span class="op" id="6163766">]</span><span class="builtintype" id="6163767">byte</span>&nbsp;<span class="comment" id="6163772">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6163789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6163792">func</span>&nbsp;<span class="op" id="6163797">(</span><span class="ident" id="6163798">e</span>&nbsp;<span class="op" id="6163800">*</span><span class="ident" id="6163801">encoder</span><span class="op" id="6163808">)</span>&nbsp;<span class="ident" id="6163810">Write</span><span class="op" id="6163815">(</span><span class="ident" id="6163816">p</span>&nbsp;<span class="op" id="6163818">[</span><span class="op" id="6163819">]</span><span class="builtintype" id="6163820">byte</span><span class="op" id="6163824">)</span>&nbsp;<span class="op" id="6163826">(</span><span class="ident" id="6163827">n</span>&nbsp;<span class="builtintype" id="6163829">int</span><span class="op" id="6163832">,</span>&nbsp;<span class="ident" id="6163834">err</span>&nbsp;<span class="builtintype" id="6163838">error</span><span class="op" id="6163843">)</span>&nbsp;<span class="op" id="6163845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163848">if</span>&nbsp;<span class="ident" id="6163851">e</span><span class="op" id="6163852">.</span><span class="ident" id="6163853">err</span>&nbsp;<span class="op" id="6163857">!=</span>&nbsp;<span class="ident" id="6163860">nil</span>&nbsp;<span class="op" id="6163864">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163868">return</span>&nbsp;<span class="num" id="6163875">0</span><span class="op" id="6163876">,</span>&nbsp;<span class="ident" id="6163878">e</span><span class="op" id="6163879">.</span><span class="ident" id="6163880">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6163885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6163889">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163909">if</span>&nbsp;<span class="ident" id="6163912">e</span><span class="op" id="6163913">.</span><span class="ident" id="6163914">nbuf</span>&nbsp;<span class="op" id="6163919">&gt;</span>&nbsp;<span class="num" id="6163921">0</span>&nbsp;<span class="op" id="6163923">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163927">var</span>&nbsp;<span class="ident" id="6163931">i</span>&nbsp;<span class="builtintype" id="6163933">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6163939">for</span>&nbsp;<span class="ident" id="6163943">i</span>&nbsp;<span class="op" id="6163945">=</span>&nbsp;<span class="num" id="6163947">0</span><span class="op" id="6163948">;</span>&nbsp;<span class="ident" id="6163950">i</span>&nbsp;<span class="op" id="6163952">&lt;</span>&nbsp;<span class="builtinfunc" id="6163954">len</span><span class="op" id="6163957">(</span><span class="ident" id="6163958">p</span><span class="op" id="6163959">)</span>&nbsp;<span class="op" id="6163961">&amp;&amp;</span>&nbsp;<span class="ident" id="6163964">e</span><span class="op" id="6163965">.</span><span class="ident" id="6163966">nbuf</span>&nbsp;<span class="op" id="6163971">&lt;</span>&nbsp;<span class="num" id="6163973">4</span><span class="op" id="6163974">;</span>&nbsp;<span class="ident" id="6163976">i</span><span class="op" id="6163977">++</span>&nbsp;<span class="op" id="6163980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6163985">e</span><span class="op" id="6163986">.</span><span class="ident" id="6163987">buf</span><span class="op" id="6163990">[</span><span class="ident" id="6163991">e</span><span class="op" id="6163992">.</span><span class="ident" id="6163993">nbuf</span><span class="op" id="6163997">]</span>&nbsp;<span class="op" id="6163999">=</span>&nbsp;<span class="ident" id="6164001">p</span><span class="op" id="6164002">[</span><span class="ident" id="6164003">i</span><span class="op" id="6164004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164009">e</span><span class="op" id="6164010">.</span><span class="ident" id="6164011">nbuf</span><span class="op" id="6164015">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164020">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164024">n</span>&nbsp;<span class="op" id="6164026">+=</span>&nbsp;<span class="ident" id="6164029">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164033">p</span>&nbsp;<span class="op" id="6164035">=</span>&nbsp;<span class="ident" id="6164037">p</span><span class="op" id="6164038">[</span><span class="ident" id="6164039">i</span><span class="op" id="6164040">:</span><span class="op" id="6164041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164045">if</span>&nbsp;<span class="ident" id="6164048">e</span><span class="op" id="6164049">.</span><span class="ident" id="6164050">nbuf</span>&nbsp;<span class="op" id="6164055">&lt;</span>&nbsp;<span class="num" id="6164057">4</span>&nbsp;<span class="op" id="6164059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164064">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164073">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164077">nout</span>&nbsp;<span class="op" id="6164082">:=</span>&nbsp;<span class="ident" id="6164085">Encode</span><span class="op" id="6164091">(</span><span class="ident" id="6164092">e</span><span class="op" id="6164093">.</span><span class="ident" id="6164094">out</span><span class="op" id="6164097">[</span><span class="num" id="6164098">0</span><span class="op" id="6164099">:</span><span class="op" id="6164100">]</span><span class="op" id="6164101">,</span>&nbsp;<span class="ident" id="6164103">e</span><span class="op" id="6164104">.</span><span class="ident" id="6164105">buf</span><span class="op" id="6164108">[</span><span class="num" id="6164109">0</span><span class="op" id="6164110">:</span><span class="op" id="6164111">]</span><span class="op" id="6164112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164116">if</span>&nbsp;<span class="ident" id="6164119">_</span><span class="op" id="6164120">,</span>&nbsp;<span class="ident" id="6164122">e</span><span class="op" id="6164123">.</span><span class="ident" id="6164124">err</span>&nbsp;<span class="op" id="6164128">=</span>&nbsp;<span class="ident" id="6164130">e</span><span class="op" id="6164131">.</span><span class="ident" id="6164132">w</span><span class="op" id="6164133">.</span><span class="ident" id="6164134">Write</span><span class="op" id="6164139">(</span><span class="ident" id="6164140">e</span><span class="op" id="6164141">.</span><span class="ident" id="6164142">out</span><span class="op" id="6164145">[</span><span class="num" id="6164146">0</span><span class="op" id="6164147">:</span><span class="ident" id="6164148">nout</span><span class="op" id="6164152">]</span><span class="op" id="6164153">)</span><span class="op" id="6164154">;</span>&nbsp;<span class="ident" id="6164156">e</span><span class="op" id="6164157">.</span><span class="ident" id="6164158">err</span>&nbsp;<span class="op" id="6164162">!=</span>&nbsp;<span class="ident" id="6164165">nil</span>&nbsp;<span class="op" id="6164169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164174">return</span>&nbsp;<span class="ident" id="6164181">n</span><span class="op" id="6164182">,</span>&nbsp;<span class="ident" id="6164184">e</span><span class="op" id="6164185">.</span><span class="ident" id="6164186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164196">e</span><span class="op" id="6164197">.</span><span class="ident" id="6164198">nbuf</span>&nbsp;<span class="op" id="6164203">=</span>&nbsp;<span class="num" id="6164205">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6164212">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164239">for</span>&nbsp;<span class="builtinfunc" id="6164243">len</span><span class="op" id="6164246">(</span><span class="ident" id="6164247">p</span><span class="op" id="6164248">)</span>&nbsp;<span class="op" id="6164250">&gt;=</span>&nbsp;<span class="num" id="6164253">4</span>&nbsp;<span class="op" id="6164255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164259">nn</span>&nbsp;<span class="op" id="6164262">:=</span>&nbsp;<span class="builtinfunc" id="6164265">len</span><span class="op" id="6164268">(</span><span class="ident" id="6164269">e</span><span class="op" id="6164270">.</span><span class="ident" id="6164271">out</span><span class="op" id="6164274">)</span>&nbsp;<span class="op" id="6164276">/</span>&nbsp;<span class="num" id="6164278">5</span>&nbsp;<span class="op" id="6164280">*</span>&nbsp;<span class="num" id="6164282">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164286">if</span>&nbsp;<span class="ident" id="6164289">nn</span>&nbsp;<span class="op" id="6164292">&gt;</span>&nbsp;<span class="builtinfunc" id="6164294">len</span><span class="op" id="6164297">(</span><span class="ident" id="6164298">p</span><span class="op" id="6164299">)</span>&nbsp;<span class="op" id="6164301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164306">nn</span>&nbsp;<span class="op" id="6164309">=</span>&nbsp;<span class="builtinfunc" id="6164311">len</span><span class="op" id="6164314">(</span><span class="ident" id="6164315">p</span><span class="op" id="6164316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164324">nn</span>&nbsp;<span class="op" id="6164327">-=</span>&nbsp;<span class="ident" id="6164330">nn</span>&nbsp;<span class="op" id="6164333">%</span>&nbsp;<span class="num" id="6164335">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164339">if</span>&nbsp;<span class="ident" id="6164342">nn</span>&nbsp;<span class="op" id="6164345">&gt;</span>&nbsp;<span class="num" id="6164347">0</span>&nbsp;<span class="op" id="6164349">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164354">nout</span>&nbsp;<span class="op" id="6164359">:=</span>&nbsp;<span class="ident" id="6164362">Encode</span><span class="op" id="6164368">(</span><span class="ident" id="6164369">e</span><span class="op" id="6164370">.</span><span class="ident" id="6164371">out</span><span class="op" id="6164374">[</span><span class="num" id="6164375">0</span><span class="op" id="6164376">:</span><span class="op" id="6164377">]</span><span class="op" id="6164378">,</span>&nbsp;<span class="ident" id="6164380">p</span><span class="op" id="6164381">[</span><span class="num" id="6164382">0</span><span class="op" id="6164383">:</span><span class="ident" id="6164384">nn</span><span class="op" id="6164386">]</span><span class="op" id="6164387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164392">if</span>&nbsp;<span class="ident" id="6164395">_</span><span class="op" id="6164396">,</span>&nbsp;<span class="ident" id="6164398">e</span><span class="op" id="6164399">.</span><span class="ident" id="6164400">err</span>&nbsp;<span class="op" id="6164404">=</span>&nbsp;<span class="ident" id="6164406">e</span><span class="op" id="6164407">.</span><span class="ident" id="6164408">w</span><span class="op" id="6164409">.</span><span class="ident" id="6164410">Write</span><span class="op" id="6164415">(</span><span class="ident" id="6164416">e</span><span class="op" id="6164417">.</span><span class="ident" id="6164418">out</span><span class="op" id="6164421">[</span><span class="num" id="6164422">0</span><span class="op" id="6164423">:</span><span class="ident" id="6164424">nout</span><span class="op" id="6164428">]</span><span class="op" id="6164429">)</span><span class="op" id="6164430">;</span>&nbsp;<span class="ident" id="6164432">e</span><span class="op" id="6164433">.</span><span class="ident" id="6164434">err</span>&nbsp;<span class="op" id="6164438">!=</span>&nbsp;<span class="ident" id="6164441">nil</span>&nbsp;<span class="op" id="6164445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164451">return</span>&nbsp;<span class="ident" id="6164458">n</span><span class="op" id="6164459">,</span>&nbsp;<span class="ident" id="6164461">e</span><span class="op" id="6164462">.</span><span class="ident" id="6164463">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164474">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164478">n</span>&nbsp;<span class="op" id="6164480">+=</span>&nbsp;<span class="ident" id="6164483">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164488">p</span>&nbsp;<span class="op" id="6164490">=</span>&nbsp;<span class="ident" id="6164492">p</span><span class="op" id="6164493">[</span><span class="ident" id="6164494">nn</span><span class="op" id="6164496">:</span><span class="op" id="6164497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6164504">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164525">for</span>&nbsp;<span class="ident" id="6164529">i</span>&nbsp;<span class="op" id="6164531">:=</span>&nbsp;<span class="num" id="6164534">0</span><span class="op" id="6164535">;</span>&nbsp;<span class="ident" id="6164537">i</span>&nbsp;<span class="op" id="6164539">&lt;</span>&nbsp;<span class="builtinfunc" id="6164541">len</span><span class="op" id="6164544">(</span><span class="ident" id="6164545">p</span><span class="op" id="6164546">)</span><span class="op" id="6164547">;</span>&nbsp;<span class="ident" id="6164549">i</span><span class="op" id="6164550">++</span>&nbsp;<span class="op" id="6164553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164557">e</span><span class="op" id="6164558">.</span><span class="ident" id="6164559">buf</span><span class="op" id="6164562">[</span><span class="ident" id="6164563">i</span><span class="op" id="6164564">]</span>&nbsp;<span class="op" id="6164566">=</span>&nbsp;<span class="ident" id="6164568">p</span><span class="op" id="6164569">[</span><span class="ident" id="6164570">i</span><span class="op" id="6164571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164577">e</span><span class="op" id="6164578">.</span><span class="ident" id="6164579">nbuf</span>&nbsp;<span class="op" id="6164584">=</span>&nbsp;<span class="builtinfunc" id="6164586">len</span><span class="op" id="6164589">(</span><span class="ident" id="6164590">p</span><span class="op" id="6164591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164594">n</span>&nbsp;<span class="op" id="6164596">+=</span>&nbsp;<span class="builtinfunc" id="6164599">len</span><span class="op" id="6164602">(</span><span class="ident" id="6164603">p</span><span class="op" id="6164604">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164607">return</span><br>
<span class="lineno"></span><span class="op" id="6164614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6164617">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6164671">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6164724">func</span>&nbsp;<span class="op" id="6164729">(</span><span class="ident" id="6164730">e</span>&nbsp;<span class="op" id="6164732">*</span><span class="ident" id="6164733">encoder</span><span class="op" id="6164740">)</span>&nbsp;<span class="ident" id="6164742">Close</span><span class="op" id="6164747">(</span><span class="op" id="6164748">)</span>&nbsp;<span class="builtintype" id="6164750">error</span>&nbsp;<span class="op" id="6164756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6164759">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164816">if</span>&nbsp;<span class="ident" id="6164819">e</span><span class="op" id="6164820">.</span><span class="ident" id="6164821">err</span>&nbsp;<span class="op" id="6164825">==</span>&nbsp;<span class="ident" id="6164828">nil</span>&nbsp;<span class="op" id="6164832">&amp;&amp;</span>&nbsp;<span class="ident" id="6164835">e</span><span class="op" id="6164836">.</span><span class="ident" id="6164837">nbuf</span>&nbsp;<span class="op" id="6164842">&gt;</span>&nbsp;<span class="num" id="6164844">0</span>&nbsp;<span class="op" id="6164846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164850">nout</span>&nbsp;<span class="op" id="6164855">:=</span>&nbsp;<span class="ident" id="6164858">Encode</span><span class="op" id="6164864">(</span><span class="ident" id="6164865">e</span><span class="op" id="6164866">.</span><span class="ident" id="6164867">out</span><span class="op" id="6164870">[</span><span class="num" id="6164871">0</span><span class="op" id="6164872">:</span><span class="op" id="6164873">]</span><span class="op" id="6164874">,</span>&nbsp;<span class="ident" id="6164876">e</span><span class="op" id="6164877">.</span><span class="ident" id="6164878">buf</span><span class="op" id="6164881">[</span><span class="num" id="6164882">0</span><span class="op" id="6164883">:</span><span class="ident" id="6164884">e</span><span class="op" id="6164885">.</span><span class="ident" id="6164886">nbuf</span><span class="op" id="6164890">]</span><span class="op" id="6164891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164895">e</span><span class="op" id="6164896">.</span><span class="ident" id="6164897">nbuf</span>&nbsp;<span class="op" id="6164902">=</span>&nbsp;<span class="num" id="6164904">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6164908">_</span><span class="op" id="6164909">,</span>&nbsp;<span class="ident" id="6164911">e</span><span class="op" id="6164912">.</span><span class="ident" id="6164913">err</span>&nbsp;<span class="op" id="6164917">=</span>&nbsp;<span class="ident" id="6164919">e</span><span class="op" id="6164920">.</span><span class="ident" id="6164921">w</span><span class="op" id="6164922">.</span><span class="ident" id="6164923">Write</span><span class="op" id="6164928">(</span><span class="ident" id="6164929">e</span><span class="op" id="6164930">.</span><span class="ident" id="6164931">out</span><span class="op" id="6164934">[</span><span class="num" id="6164935">0</span><span class="op" id="6164936">:</span><span class="ident" id="6164937">nout</span><span class="op" id="6164941">]</span><span class="op" id="6164942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6164945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6164948">return</span>&nbsp;<span class="ident" id="6164955">e</span><span class="op" id="6164956">.</span><span class="ident" id="6164957">err</span><br>
<span class="lineno"></span><span class="op" id="6164961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6164964">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6164983">type</span>&nbsp;<span class="ident" id="6164988">CorruptInputError</span>&nbsp;<span class="ident" id="6165006">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6165013">func</span>&nbsp;<span class="op" id="6165018">(</span><span class="ident" id="6165019">e</span>&nbsp;<span class="ident" id="6165021">CorruptInputError</span><span class="op" id="6165038">)</span>&nbsp;<span class="ident" id="6165040">Error</span><span class="op" id="6165045">(</span><span class="op" id="6165046">)</span>&nbsp;<span class="builtintype" id="6165048">string</span>&nbsp;<span class="op" id="6165055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165058">return</span>&nbsp;<span class="string" id="6165065">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6165103">+</span>&nbsp;<span class="ident" id="6165105">strconv</span><span class="op" id="6165112">.</span><span class="ident" id="6165113">FormatInt</span><span class="op" id="6165122">(</span><span class="ident" id="6165123">int64</span><span class="op" id="6165128">(</span><span class="ident" id="6165129">e</span><span class="op" id="6165130">)</span><span class="op" id="6165131">,</span>&nbsp;<span class="num" id="6165133">10</span><span class="op" id="6165135">)</span><br>
<span class="lineno"></span><span class="op" id="6165137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6165140">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6165198">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6165259">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6165323">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6165388">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6165443">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6165507">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6165568">//</span><br>
<span class="lineno"></span><span class="comment" id="6165571">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6165631">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6165693">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6165750">//</span><br>
<span class="lineno"></span><span class="comment" id="6165753">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6165811">//</span><br>
<span class="lineno"></span><span class="keyword" id="6165814">func</span>&nbsp;<span class="ident" id="6165819">Decode</span><span class="op" id="6165825">(</span><span class="ident" id="6165826">dst</span><span class="op" id="6165829">,</span>&nbsp;<span class="ident" id="6165831">src</span>&nbsp;<span class="op" id="6165835">[</span><span class="op" id="6165836">]</span><span class="builtintype" id="6165837">byte</span><span class="op" id="6165841">,</span>&nbsp;<span class="ident" id="6165843">flush</span>&nbsp;<span class="builtintype" id="6165849">bool</span><span class="op" id="6165853">)</span>&nbsp;<span class="op" id="6165855">(</span><span class="ident" id="6165856">ndst</span><span class="op" id="6165860">,</span>&nbsp;<span class="ident" id="6165862">nsrc</span>&nbsp;<span class="builtintype" id="6165867">int</span><span class="op" id="6165870">,</span>&nbsp;<span class="ident" id="6165872">err</span>&nbsp;<span class="builtintype" id="6165876">error</span><span class="op" id="6165881">)</span>&nbsp;<span class="op" id="6165883">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165886">var</span>&nbsp;<span class="ident" id="6165890">v</span>&nbsp;<span class="builtintype" id="6165892">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165900">var</span>&nbsp;<span class="ident" id="6165904">nb</span>&nbsp;<span class="builtintype" id="6165907">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165912">for</span>&nbsp;<span class="ident" id="6165916">i</span><span class="op" id="6165917">,</span>&nbsp;<span class="ident" id="6165919">b</span>&nbsp;<span class="op" id="6165921">:=</span>&nbsp;<span class="keyword" id="6165924">range</span>&nbsp;<span class="ident" id="6165930">src</span>&nbsp;<span class="op" id="6165934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165938">if</span>&nbsp;<span class="builtinfunc" id="6165941">len</span><span class="op" id="6165944">(</span><span class="ident" id="6165945">dst</span><span class="op" id="6165948">)</span><span class="op" id="6165949">-</span><span class="ident" id="6165950">ndst</span>&nbsp;<span class="op" id="6165955">&lt;</span>&nbsp;<span class="num" id="6165957">4</span>&nbsp;<span class="op" id="6165959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165964">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6165973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165977">switch</span>&nbsp;<span class="op" id="6165984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165988">case</span>&nbsp;<span class="ident" id="6165993">b</span>&nbsp;<span class="op" id="6165995">&lt;=</span>&nbsp;<span class="string" id="6165998">&#39;&nbsp;&#39;</span><span class="op" id="6166001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166006">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166017">case</span>&nbsp;<span class="ident" id="6166022">b</span>&nbsp;<span class="op" id="6166024">==</span>&nbsp;<span class="string" id="6166027">&#39;z&#39;</span>&nbsp;<span class="op" id="6166031">&amp;&amp;</span>&nbsp;<span class="ident" id="6166034">nb</span>&nbsp;<span class="op" id="6166037">==</span>&nbsp;<span class="num" id="6166040">0</span><span class="op" id="6166041">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166046">nb</span>&nbsp;<span class="op" id="6166049">=</span>&nbsp;<span class="num" id="6166051">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166056">v</span>&nbsp;<span class="op" id="6166058">=</span>&nbsp;<span class="num" id="6166060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166064">case</span>&nbsp;<span class="string" id="6166069">&#39;!&#39;</span>&nbsp;<span class="op" id="6166073">&lt;=</span>&nbsp;<span class="ident" id="6166076">b</span>&nbsp;<span class="op" id="6166078">&amp;&amp;</span>&nbsp;<span class="ident" id="6166081">b</span>&nbsp;<span class="op" id="6166083">&lt;=</span>&nbsp;<span class="string" id="6166086">&#39;u&#39;</span><span class="op" id="6166089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166094">v</span>&nbsp;<span class="op" id="6166096">=</span>&nbsp;<span class="ident" id="6166098">v</span><span class="op" id="6166099">*</span><span class="num" id="6166100">85</span>&nbsp;<span class="op" id="6166103">+</span>&nbsp;<span class="builtintype" id="6166105">uint32</span><span class="op" id="6166111">(</span><span class="ident" id="6166112">b</span><span class="op" id="6166113">-</span><span class="string" id="6166114">&#39;!&#39;</span><span class="op" id="6166117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166122">nb</span><span class="op" id="6166124">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166129">default</span><span class="op" id="6166136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166141">return</span>&nbsp;<span class="num" id="6166148">0</span><span class="op" id="6166149">,</span>&nbsp;<span class="num" id="6166151">0</span><span class="op" id="6166152">,</span>&nbsp;<span class="ident" id="6166154">CorruptInputError</span><span class="op" id="6166171">(</span><span class="ident" id="6166172">i</span><span class="op" id="6166173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166181">if</span>&nbsp;<span class="ident" id="6166184">nb</span>&nbsp;<span class="op" id="6166187">==</span>&nbsp;<span class="num" id="6166190">5</span>&nbsp;<span class="op" id="6166192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166197">nsrc</span>&nbsp;<span class="op" id="6166202">=</span>&nbsp;<span class="ident" id="6166204">i</span>&nbsp;<span class="op" id="6166206">+</span>&nbsp;<span class="num" id="6166208">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166213">dst</span><span class="op" id="6166216">[</span><span class="ident" id="6166217">ndst</span><span class="op" id="6166221">]</span>&nbsp;<span class="op" id="6166223">=</span>&nbsp;<span class="builtintype" id="6166225">byte</span><span class="op" id="6166229">(</span><span class="ident" id="6166230">v</span>&nbsp;<span class="op" id="6166232">&gt;&gt;</span>&nbsp;<span class="num" id="6166235">24</span><span class="op" id="6166237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166242">dst</span><span class="op" id="6166245">[</span><span class="ident" id="6166246">ndst</span><span class="op" id="6166250">+</span><span class="num" id="6166251">1</span><span class="op" id="6166252">]</span>&nbsp;<span class="op" id="6166254">=</span>&nbsp;<span class="builtintype" id="6166256">byte</span><span class="op" id="6166260">(</span><span class="ident" id="6166261">v</span>&nbsp;<span class="op" id="6166263">&gt;&gt;</span>&nbsp;<span class="num" id="6166266">16</span><span class="op" id="6166268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166273">dst</span><span class="op" id="6166276">[</span><span class="ident" id="6166277">ndst</span><span class="op" id="6166281">+</span><span class="num" id="6166282">2</span><span class="op" id="6166283">]</span>&nbsp;<span class="op" id="6166285">=</span>&nbsp;<span class="builtintype" id="6166287">byte</span><span class="op" id="6166291">(</span><span class="ident" id="6166292">v</span>&nbsp;<span class="op" id="6166294">&gt;&gt;</span>&nbsp;<span class="num" id="6166297">8</span><span class="op" id="6166298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166303">dst</span><span class="op" id="6166306">[</span><span class="ident" id="6166307">ndst</span><span class="op" id="6166311">+</span><span class="num" id="6166312">3</span><span class="op" id="6166313">]</span>&nbsp;<span class="op" id="6166315">=</span>&nbsp;<span class="builtintype" id="6166317">byte</span><span class="op" id="6166321">(</span><span class="ident" id="6166322">v</span><span class="op" id="6166323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166328">ndst</span>&nbsp;<span class="op" id="6166333">+=</span>&nbsp;<span class="num" id="6166336">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166341">nb</span>&nbsp;<span class="op" id="6166344">=</span>&nbsp;<span class="num" id="6166346">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166351">v</span>&nbsp;<span class="op" id="6166353">=</span>&nbsp;<span class="num" id="6166355">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166365">if</span>&nbsp;<span class="ident" id="6166368">flush</span>&nbsp;<span class="op" id="6166374">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166378">nsrc</span>&nbsp;<span class="op" id="6166383">=</span>&nbsp;<span class="builtinfunc" id="6166385">len</span><span class="op" id="6166388">(</span><span class="ident" id="6166389">src</span><span class="op" id="6166392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166396">if</span>&nbsp;<span class="ident" id="6166399">nb</span>&nbsp;<span class="op" id="6166402">&gt;</span>&nbsp;<span class="num" id="6166404">0</span>&nbsp;<span class="op" id="6166406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166411">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166465">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166514">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166565">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166619">if</span>&nbsp;<span class="ident" id="6166622">nb</span>&nbsp;<span class="op" id="6166625">==</span>&nbsp;<span class="num" id="6166628">1</span>&nbsp;<span class="op" id="6166630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166636">return</span>&nbsp;<span class="num" id="6166643">0</span><span class="op" id="6166644">,</span>&nbsp;<span class="num" id="6166646">0</span><span class="op" id="6166647">,</span>&nbsp;<span class="ident" id="6166649">CorruptInputError</span><span class="op" id="6166666">(</span><span class="builtinfunc" id="6166667">len</span><span class="op" id="6166670">(</span><span class="ident" id="6166671">src</span><span class="op" id="6166674">)</span><span class="op" id="6166675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166685">for</span>&nbsp;<span class="ident" id="6166689">i</span>&nbsp;<span class="op" id="6166691">:=</span>&nbsp;<span class="ident" id="6166694">nb</span><span class="op" id="6166696">;</span>&nbsp;<span class="ident" id="6166698">i</span>&nbsp;<span class="op" id="6166700">&lt;</span>&nbsp;<span class="num" id="6166702">5</span><span class="op" id="6166703">;</span>&nbsp;<span class="ident" id="6166705">i</span><span class="op" id="6166706">++</span>&nbsp;<span class="op" id="6166709">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166715">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166769">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6166827">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166884">v</span>&nbsp;<span class="op" id="6166886">=</span>&nbsp;<span class="ident" id="6166888">v</span><span class="op" id="6166889">*</span><span class="num" id="6166890">85</span>&nbsp;<span class="op" id="6166893">+</span>&nbsp;<span class="num" id="6166895">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166901">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166906">for</span>&nbsp;<span class="ident" id="6166910">i</span>&nbsp;<span class="op" id="6166912">:=</span>&nbsp;<span class="num" id="6166915">0</span><span class="op" id="6166916">;</span>&nbsp;<span class="ident" id="6166918">i</span>&nbsp;<span class="op" id="6166920">&lt;</span>&nbsp;<span class="ident" id="6166922">nb</span><span class="op" id="6166924">-</span><span class="num" id="6166925">1</span><span class="op" id="6166926">;</span>&nbsp;<span class="ident" id="6166928">i</span><span class="op" id="6166929">++</span>&nbsp;<span class="op" id="6166932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166938">dst</span><span class="op" id="6166941">[</span><span class="ident" id="6166942">ndst</span><span class="op" id="6166946">]</span>&nbsp;<span class="op" id="6166948">=</span>&nbsp;<span class="builtintype" id="6166950">byte</span><span class="op" id="6166954">(</span><span class="ident" id="6166955">v</span>&nbsp;<span class="op" id="6166957">&gt;&gt;</span>&nbsp;<span class="num" id="6166960">24</span><span class="op" id="6166962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166968">v</span>&nbsp;<span class="op" id="6166970">&lt;&lt;=</span>&nbsp;<span class="num" id="6166974">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166980">ndst</span><span class="op" id="6166984">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166990">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167000">return</span><br>
<span class="lineno"></span><span class="op" id="6167007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6167010">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6167065">func</span>&nbsp;<span class="ident" id="6167070">NewDecoder</span><span class="op" id="6167080">(</span><span class="ident" id="6167081">r</span>&nbsp;<span class="ident" id="6167083">io</span><span class="op" id="6167085">.</span><span class="ident" id="6167086">Reader</span><span class="op" id="6167092">)</span>&nbsp;<span class="ident" id="6167094">io</span><span class="op" id="6167096">.</span><span class="ident" id="6167097">Reader</span>&nbsp;<span class="op" id="6167104">{</span>&nbsp;<span class="keyword" id="6167106">return</span>&nbsp;<span class="op" id="6167113">&amp;</span><span class="ident" id="6167114">decoder</span><span class="op" id="6167121">{</span><span class="ident" id="6167122">r</span><span class="op" id="6167123">:</span>&nbsp;<span class="ident" id="6167125">r</span><span class="op" id="6167126">}</span>&nbsp;<span class="op" id="6167128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6167131">type</span>&nbsp;<span class="ident" id="6167136">decoder</span>&nbsp;<span class="keyword" id="6167144">struct</span>&nbsp;<span class="op" id="6167151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167154">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6167162">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167169">readErr</span>&nbsp;<span class="builtintype" id="6167177">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167184">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167192">io</span><span class="op" id="6167194">.</span><span class="ident" id="6167195">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167203">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167211">[</span><span class="num" id="6167212">1024</span><span class="op" id="6167216">]</span><span class="builtintype" id="6167217">byte</span>&nbsp;<span class="comment" id="6167222">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167241">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6167249">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167254">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167262">[</span><span class="op" id="6167263">]</span><span class="builtintype" id="6167264">byte</span>&nbsp;<span class="comment" id="6167269">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167297">outbuf</span>&nbsp;&nbsp;<span class="op" id="6167305">[</span><span class="num" id="6167306">1024</span><span class="op" id="6167310">]</span><span class="builtintype" id="6167311">byte</span><br>
<span class="lineno"></span><span class="op" id="6167316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6167319">func</span>&nbsp;<span class="op" id="6167324">(</span><span class="ident" id="6167325">d</span>&nbsp;<span class="op" id="6167327">*</span><span class="ident" id="6167328">decoder</span><span class="op" id="6167335">)</span>&nbsp;<span class="ident" id="6167337">Read</span><span class="op" id="6167341">(</span><span class="ident" id="6167342">p</span>&nbsp;<span class="op" id="6167344">[</span><span class="op" id="6167345">]</span><span class="builtintype" id="6167346">byte</span><span class="op" id="6167350">)</span>&nbsp;<span class="op" id="6167352">(</span><span class="ident" id="6167353">n</span>&nbsp;<span class="builtintype" id="6167355">int</span><span class="op" id="6167358">,</span>&nbsp;<span class="ident" id="6167360">err</span>&nbsp;<span class="builtintype" id="6167364">error</span><span class="op" id="6167369">)</span>&nbsp;<span class="op" id="6167371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167374">if</span>&nbsp;<span class="builtinfunc" id="6167377">len</span><span class="op" id="6167380">(</span><span class="ident" id="6167381">p</span><span class="op" id="6167382">)</span>&nbsp;<span class="op" id="6167384">==</span>&nbsp;<span class="num" id="6167387">0</span>&nbsp;<span class="op" id="6167389">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167393">return</span>&nbsp;<span class="num" id="6167400">0</span><span class="op" id="6167401">,</span>&nbsp;<span class="ident" id="6167403">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6167408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167411">if</span>&nbsp;<span class="ident" id="6167414">d</span><span class="op" id="6167415">.</span><span class="ident" id="6167416">err</span>&nbsp;<span class="op" id="6167420">!=</span>&nbsp;<span class="ident" id="6167423">nil</span>&nbsp;<span class="op" id="6167427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167431">return</span>&nbsp;<span class="num" id="6167438">0</span><span class="op" id="6167439">,</span>&nbsp;<span class="ident" id="6167441">d</span><span class="op" id="6167442">.</span><span class="ident" id="6167443">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6167448">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167452">for</span>&nbsp;<span class="op" id="6167456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6167460">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167504">if</span>&nbsp;<span class="builtinfunc" id="6167507">len</span><span class="op" id="6167510">(</span><span class="ident" id="6167511">d</span><span class="op" id="6167512">.</span><span class="ident" id="6167513">out</span><span class="op" id="6167516">)</span>&nbsp;<span class="op" id="6167518">&gt;</span>&nbsp;<span class="num" id="6167520">0</span>&nbsp;<span class="op" id="6167522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167527">n</span>&nbsp;<span class="op" id="6167529">=</span>&nbsp;<span class="builtinfunc" id="6167531">copy</span><span class="op" id="6167535">(</span><span class="ident" id="6167536">p</span><span class="op" id="6167537">,</span>&nbsp;<span class="ident" id="6167539">d</span><span class="op" id="6167540">.</span><span class="ident" id="6167541">out</span><span class="op" id="6167544">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167549">d</span><span class="op" id="6167550">.</span><span class="ident" id="6167551">out</span>&nbsp;<span class="op" id="6167555">=</span>&nbsp;<span class="ident" id="6167557">d</span><span class="op" id="6167558">.</span><span class="ident" id="6167559">out</span><span class="op" id="6167562">[</span><span class="ident" id="6167563">n</span><span class="op" id="6167564">:</span><span class="op" id="6167565">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167570">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6167579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6167584">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167627">var</span>&nbsp;<span class="ident" id="6167631">nn</span><span class="op" id="6167633">,</span>&nbsp;<span class="ident" id="6167635">nsrc</span><span class="op" id="6167639">,</span>&nbsp;<span class="ident" id="6167641">ndst</span>&nbsp;<span class="builtintype" id="6167646">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167652">if</span>&nbsp;<span class="ident" id="6167655">d</span><span class="op" id="6167656">.</span><span class="ident" id="6167657">nbuf</span>&nbsp;<span class="op" id="6167662">&gt;</span>&nbsp;<span class="num" id="6167664">0</span>&nbsp;<span class="op" id="6167666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167671">ndst</span><span class="op" id="6167675">,</span>&nbsp;<span class="ident" id="6167677">nsrc</span><span class="op" id="6167681">,</span>&nbsp;<span class="ident" id="6167683">d</span><span class="op" id="6167684">.</span><span class="ident" id="6167685">err</span>&nbsp;<span class="op" id="6167689">=</span>&nbsp;<span class="ident" id="6167691">Decode</span><span class="op" id="6167697">(</span><span class="ident" id="6167698">d</span><span class="op" id="6167699">.</span><span class="ident" id="6167700">outbuf</span><span class="op" id="6167706">[</span><span class="num" id="6167707">0</span><span class="op" id="6167708">:</span><span class="op" id="6167709">]</span><span class="op" id="6167710">,</span>&nbsp;<span class="ident" id="6167712">d</span><span class="op" id="6167713">.</span><span class="ident" id="6167714">buf</span><span class="op" id="6167717">[</span><span class="num" id="6167718">0</span><span class="op" id="6167719">:</span><span class="ident" id="6167720">d</span><span class="op" id="6167721">.</span><span class="ident" id="6167722">nbuf</span><span class="op" id="6167726">]</span><span class="op" id="6167727">,</span>&nbsp;<span class="ident" id="6167729">d</span><span class="op" id="6167730">.</span><span class="ident" id="6167731">readErr</span>&nbsp;<span class="op" id="6167739">!=</span>&nbsp;<span class="ident" id="6167742">nil</span><span class="op" id="6167745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167750">if</span>&nbsp;<span class="ident" id="6167753">ndst</span>&nbsp;<span class="op" id="6167758">&gt;</span>&nbsp;<span class="num" id="6167760">0</span>&nbsp;<span class="op" id="6167762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167768">d</span><span class="op" id="6167769">.</span><span class="ident" id="6167770">out</span>&nbsp;<span class="op" id="6167774">=</span>&nbsp;<span class="ident" id="6167776">d</span><span class="op" id="6167777">.</span><span class="ident" id="6167778">outbuf</span><span class="op" id="6167784">[</span><span class="num" id="6167785">0</span><span class="op" id="6167786">:</span><span class="ident" id="6167787">ndst</span><span class="op" id="6167791">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167797">d</span><span class="op" id="6167798">.</span><span class="ident" id="6167799">nbuf</span>&nbsp;<span class="op" id="6167804">=</span>&nbsp;<span class="builtinfunc" id="6167806">copy</span><span class="op" id="6167810">(</span><span class="ident" id="6167811">d</span><span class="op" id="6167812">.</span><span class="ident" id="6167813">buf</span><span class="op" id="6167816">[</span><span class="num" id="6167817">0</span><span class="op" id="6167818">:</span><span class="op" id="6167819">]</span><span class="op" id="6167820">,</span>&nbsp;<span class="ident" id="6167822">d</span><span class="op" id="6167823">.</span><span class="ident" id="6167824">buf</span><span class="op" id="6167827">[</span><span class="ident" id="6167828">nsrc</span><span class="op" id="6167832">:</span><span class="ident" id="6167833">d</span><span class="op" id="6167834">.</span><span class="ident" id="6167835">nbuf</span><span class="op" id="6167839">]</span><span class="op" id="6167840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167846">continue</span>&nbsp;<span class="comment" id="6167855">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6167881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167886">if</span>&nbsp;<span class="ident" id="6167889">ndst</span>&nbsp;<span class="op" id="6167894">==</span>&nbsp;<span class="num" id="6167897">0</span>&nbsp;<span class="op" id="6167899">&amp;&amp;</span>&nbsp;<span class="ident" id="6167902">d</span><span class="op" id="6167903">.</span><span class="ident" id="6167904">err</span>&nbsp;<span class="op" id="6167908">==</span>&nbsp;<span class="ident" id="6167911">nil</span>&nbsp;<span class="op" id="6167915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6167921">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6167993">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168051">off</span>&nbsp;<span class="op" id="6168055">:=</span>&nbsp;<span class="num" id="6168058">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168064">for</span>&nbsp;<span class="ident" id="6168068">i</span>&nbsp;<span class="op" id="6168070">:=</span>&nbsp;<span class="num" id="6168073">0</span><span class="op" id="6168074">;</span>&nbsp;<span class="ident" id="6168076">i</span>&nbsp;<span class="op" id="6168078">&lt;</span>&nbsp;<span class="ident" id="6168080">d</span><span class="op" id="6168081">.</span><span class="ident" id="6168082">nbuf</span><span class="op" id="6168086">;</span>&nbsp;<span class="ident" id="6168088">i</span><span class="op" id="6168089">++</span>&nbsp;<span class="op" id="6168092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168099">if</span>&nbsp;<span class="ident" id="6168102">d</span><span class="op" id="6168103">.</span><span class="ident" id="6168104">buf</span><span class="op" id="6168107">[</span><span class="ident" id="6168108">i</span><span class="op" id="6168109">]</span>&nbsp;<span class="op" id="6168111">&gt;</span>&nbsp;<span class="string" id="6168113">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6168117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168125">d</span><span class="op" id="6168126">.</span><span class="ident" id="6168127">buf</span><span class="op" id="6168130">[</span><span class="ident" id="6168131">off</span><span class="op" id="6168134">]</span>&nbsp;<span class="op" id="6168136">=</span>&nbsp;<span class="ident" id="6168138">d</span><span class="op" id="6168139">.</span><span class="ident" id="6168140">buf</span><span class="op" id="6168143">[</span><span class="ident" id="6168144">i</span><span class="op" id="6168145">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168153">off</span><span class="op" id="6168156">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168176">d</span><span class="op" id="6168177">.</span><span class="ident" id="6168178">nbuf</span>&nbsp;<span class="op" id="6168183">=</span>&nbsp;<span class="ident" id="6168185">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168192">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168201">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168258">if</span>&nbsp;<span class="ident" id="6168261">d</span><span class="op" id="6168262">.</span><span class="ident" id="6168263">err</span>&nbsp;<span class="op" id="6168267">!=</span>&nbsp;<span class="ident" id="6168270">nil</span>&nbsp;<span class="op" id="6168274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168279">return</span>&nbsp;<span class="num" id="6168286">0</span><span class="op" id="6168287">,</span>&nbsp;<span class="ident" id="6168289">d</span><span class="op" id="6168290">.</span><span class="ident" id="6168291">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168301">if</span>&nbsp;<span class="ident" id="6168304">d</span><span class="op" id="6168305">.</span><span class="ident" id="6168306">readErr</span>&nbsp;<span class="op" id="6168314">!=</span>&nbsp;<span class="ident" id="6168317">nil</span>&nbsp;<span class="op" id="6168321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168326">d</span><span class="op" id="6168327">.</span><span class="ident" id="6168328">err</span>&nbsp;<span class="op" id="6168332">=</span>&nbsp;<span class="ident" id="6168334">d</span><span class="op" id="6168335">.</span><span class="ident" id="6168336">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168347">return</span>&nbsp;<span class="num" id="6168354">0</span><span class="op" id="6168355">,</span>&nbsp;<span class="ident" id="6168357">d</span><span class="op" id="6168358">.</span><span class="ident" id="6168359">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168365">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168370">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168391">nn</span><span class="op" id="6168393">,</span>&nbsp;<span class="ident" id="6168395">d</span><span class="op" id="6168396">.</span><span class="ident" id="6168397">readErr</span>&nbsp;<span class="op" id="6168405">=</span>&nbsp;<span class="ident" id="6168407">d</span><span class="op" id="6168408">.</span><span class="ident" id="6168409">r</span><span class="op" id="6168410">.</span><span class="ident" id="6168411">Read</span><span class="op" id="6168415">(</span><span class="ident" id="6168416">d</span><span class="op" id="6168417">.</span><span class="ident" id="6168418">buf</span><span class="op" id="6168421">[</span><span class="ident" id="6168422">d</span><span class="op" id="6168423">.</span><span class="ident" id="6168424">nbuf</span><span class="op" id="6168428">:</span><span class="op" id="6168429">]</span><span class="op" id="6168430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168434">d</span><span class="op" id="6168435">.</span><span class="ident" id="6168436">nbuf</span>&nbsp;<span class="op" id="6168441">+=</span>&nbsp;<span class="ident" id="6168444">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168448">}</span><br>
<span class="lineno">310</span><span class="op" id="6168450">}</span>
</div>
</body>
</html>
