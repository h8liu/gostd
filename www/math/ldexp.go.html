<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2047087">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2047142">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2047196">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2047247">package</span>&nbsp;<span class="ident" id="2047255">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2047261">//&nbsp;Ldexp&nbsp;is&nbsp;the&nbsp;inverse&nbsp;of&nbsp;Frexp.</span><br>
<span class="lineno"></span><span class="comment" id="2047295">//&nbsp;It&nbsp;returns&nbsp;frac&nbsp;×&nbsp;2**exp.</span><br>
<span class="lineno"></span><span class="comment" id="2047325">//</span><br>
<span class="lineno">10</span><span class="comment" id="2047328">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="2047350">//&nbsp;&nbsp;&nbsp;&nbspLdexp(±0,&nbsp;exp)&nbsp;=&nbsp;±0</span><br>
<span class="lineno"></span><span class="comment" id="2047375">//&nbsp;&nbsp;&nbsp;&nbspLdexp(±Inf,&nbsp;exp)&nbsp;=&nbsp;±Inf</span><br>
<span class="lineno"></span><span class="comment" id="2047404">//&nbsp;&nbsp;&nbsp;&nbspLdexp(NaN,&nbsp;exp)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="keyword" id="2047429">func</span>&nbsp;<span class="ident" id="2047434">Ldexp</span><span class="op" id="2047439">(</span><span class="ident" id="2047440">frac</span>&nbsp;<span class="builtintype" id="2047445">float64</span><span class="op" id="2047452">,</span>&nbsp;<span class="ident" id="2047454">exp</span>&nbsp;<span class="builtintype" id="2047458">int</span><span class="op" id="2047461">)</span>&nbsp;<span class="builtintype" id="2047463">float64</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2047472">func</span>&nbsp;<span class="ident" id="2047477">ldexp</span><span class="op" id="2047482">(</span><span class="ident" id="2047483">frac</span>&nbsp;<span class="builtintype" id="2047488">float64</span><span class="op" id="2047495">,</span>&nbsp;<span class="ident" id="2047497">exp</span>&nbsp;<span class="builtintype" id="2047501">int</span><span class="op" id="2047504">)</span>&nbsp;<span class="builtintype" id="2047506">float64</span>&nbsp;<span class="op" id="2047514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2047517">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047535">switch</span>&nbsp;<span class="op" id="2047542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047545">case</span>&nbsp;<span class="ident" id="2047550">frac</span>&nbsp;<span class="op" id="2047555">==</span>&nbsp;<span class="num" id="2047558">0</span><span class="op" id="2047559">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047563">return</span>&nbsp;<span class="ident" id="2047570">frac</span>&nbsp;<span class="comment" id="2047575">//&nbsp;correctly&nbsp;return&nbsp;-0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047599">case</span>&nbsp;<span class="ident" id="2047604">IsInf</span><span class="op" id="2047609">(</span><span class="ident" id="2047610">frac</span><span class="op" id="2047614">,</span>&nbsp;<span class="num" id="2047616">0</span><span class="op" id="2047617">)</span>&nbsp;<span class="op" id="2047619">||</span>&nbsp;<span class="ident" id="2047622">IsNaN</span><span class="op" id="2047627">(</span><span class="ident" id="2047628">frac</span><span class="op" id="2047632">)</span><span class="op" id="2047633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047637">return</span>&nbsp;<span class="ident" id="2047644">frac</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047653">frac</span><span class="op" id="2047657">,</span>&nbsp;<span class="ident" id="2047659">e</span>&nbsp;<span class="op" id="2047661">:=</span>&nbsp;<span class="ident" id="2047664">normalize</span><span class="op" id="2047673">(</span><span class="ident" id="2047674">frac</span><span class="op" id="2047678">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047681">exp</span>&nbsp;<span class="op" id="2047685">+=</span>&nbsp;<span class="ident" id="2047688">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047691">x</span>&nbsp;<span class="op" id="2047693">:=</span>&nbsp;<span class="ident" id="2047696">Float64bits</span><span class="op" id="2047707">(</span><span class="ident" id="2047708">frac</span><span class="op" id="2047712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047715">exp</span>&nbsp;<span class="op" id="2047719">+=</span>&nbsp;<span class="builtintype" id="2047722">int</span><span class="op" id="2047725">(</span><span class="ident" id="2047726">x</span><span class="op" id="2047727">&gt;&gt;</span><span class="ident" id="2047729">shift</span><span class="op" id="2047734">)</span><span class="op" id="2047735">&amp;</span><span class="ident" id="2047736">mask</span>&nbsp;<span class="op" id="2047741">-</span>&nbsp;<span class="ident" id="2047743">bias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047749">if</span>&nbsp;<span class="ident" id="2047752">exp</span>&nbsp;<span class="op" id="2047756">&lt;</span>&nbsp;<span class="op" id="2047758">-</span><span class="num" id="2047759">1074</span>&nbsp;<span class="op" id="2047764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047768">return</span>&nbsp;<span class="ident" id="2047775">Copysign</span><span class="op" id="2047783">(</span><span class="num" id="2047784">0</span><span class="op" id="2047785">,</span>&nbsp;<span class="ident" id="2047787">frac</span><span class="op" id="2047791">)</span>&nbsp;<span class="comment" id="2047793">//&nbsp;underflow</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047810">if</span>&nbsp;<span class="ident" id="2047813">exp</span>&nbsp;<span class="op" id="2047817">&gt;</span>&nbsp;<span class="num" id="2047819">1023</span>&nbsp;<span class="op" id="2047824">{</span>&nbsp;<span class="comment" id="2047826">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047840">if</span>&nbsp;<span class="ident" id="2047843">frac</span>&nbsp;<span class="op" id="2047848">&lt;</span>&nbsp;<span class="num" id="2047850">0</span>&nbsp;<span class="op" id="2047852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047857">return</span>&nbsp;<span class="ident" id="2047864">Inf</span><span class="op" id="2047867">(</span><span class="op" id="2047868">-</span><span class="num" id="2047869">1</span><span class="op" id="2047870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047874">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047878">return</span>&nbsp;<span class="ident" id="2047885">Inf</span><span class="op" id="2047888">(</span><span class="num" id="2047889">1</span><span class="op" id="2047890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047896">var</span>&nbsp;<span class="ident" id="2047900">m</span>&nbsp;<span class="builtintype" id="2047902">float64</span>&nbsp;<span class="op" id="2047910">=</span>&nbsp;<span class="num" id="2047912">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047915">if</span>&nbsp;<span class="ident" id="2047918">exp</span>&nbsp;<span class="op" id="2047922">&lt;</span>&nbsp;<span class="op" id="2047924">-</span><span class="num" id="2047925">1022</span>&nbsp;<span class="op" id="2047930">{</span>&nbsp;<span class="comment" id="2047932">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047946">exp</span>&nbsp;<span class="op" id="2047950">+=</span>&nbsp;<span class="num" id="2047953">52</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047958">m</span>&nbsp;<span class="op" id="2047960">=</span>&nbsp;<span class="num" id="2047962">1.0</span>&nbsp;<span class="op" id="2047966">/</span>&nbsp;<span class="op" id="2047968">(</span><span class="num" id="2047969">1</span>&nbsp;<span class="op" id="2047971">&lt;&lt;</span>&nbsp;<span class="num" id="2047974">52</span><span class="op" id="2047976">)</span>&nbsp;<span class="comment" id="2047978">//&nbsp;2**-52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047992">x</span>&nbsp;<span class="op" id="2047994">&amp;^=</span>&nbsp;<span class="ident" id="2047998">mask</span>&nbsp;<span class="op" id="2048003">&lt;&lt;</span>&nbsp;<span class="ident" id="2048006">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048013">x</span>&nbsp;<span class="op" id="2048015">|=</span>&nbsp;<span class="ident" id="2048018">uint64</span><span class="op" id="2048024">(</span><span class="ident" id="2048025">exp</span><span class="op" id="2048028">+</span><span class="ident" id="2048029">bias</span><span class="op" id="2048033">)</span>&nbsp;<span class="op" id="2048035">&lt;&lt;</span>&nbsp;<span class="ident" id="2048038">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048045">return</span>&nbsp;<span class="ident" id="2048052">m</span>&nbsp;<span class="op" id="2048054">*</span>&nbsp;<span class="ident" id="2048056">Float64frombits</span><span class="op" id="2048071">(</span><span class="ident" id="2048072">x</span><span class="op" id="2048073">)</span><br>
<span class="lineno">45</span><span class="op" id="2048075">}</span>
</div>
</body>
</html>
