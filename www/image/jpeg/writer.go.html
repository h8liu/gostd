<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3163604">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3163659">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3163713">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3163764">package</span>&nbsp;<span class="ident" id="3163772">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3163778">import</span>&nbsp;<span class="op" id="3163785">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3163788">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3163797">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3163807">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3163816">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3163831">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3163836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3163839">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="3163883">func</span>&nbsp;<span class="ident" id="3163888">min</span><span class="op" id="3163891">(</span><span class="ident" id="3163892">x</span><span class="op" id="3163893">,</span>&nbsp;<span class="ident" id="3163895">y</span>&nbsp;<span class="builtintype" id="3163897">int</span><span class="op" id="3163900">)</span>&nbsp;<span class="builtintype" id="3163902">int</span>&nbsp;<span class="op" id="3163906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163909">if</span>&nbsp;<span class="ident" id="3163912"><a href="/image/jpeg/writer.go.html#3163892">x</a></span>&nbsp;<span class="op" id="3163914">&lt;</span>&nbsp;<span class="ident" id="3163916"><a href="/image/jpeg/writer.go.html#3163895">y</a></span>&nbsp;<span class="op" id="3163918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163922">return</span>&nbsp;<span class="ident" id="3163929"><a href="/image/jpeg/writer.go.html#3163892">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163932">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163935">return</span>&nbsp;<span class="ident" id="3163942"><a href="/image/jpeg/writer.go.html#3163895">y</a></span><br>
<span class="lineno"></span><span class="op" id="3163944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3163947">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="3164026">func</span>&nbsp;<span class="ident" id="3164031">div</span><span class="op" id="3164034">(</span><span class="ident" id="3164035">a</span><span class="op" id="3164036">,</span>&nbsp;<span class="ident" id="3164038">b</span>&nbsp;<span class="builtintype" id="3164040">int32</span><span class="op" id="3164045">)</span>&nbsp;<span class="builtintype" id="3164047">int32</span>&nbsp;<span class="op" id="3164053">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164056">if</span>&nbsp;<span class="ident" id="3164059"><a href="/image/jpeg/writer.go.html#3164035">a</a></span>&nbsp;<span class="op" id="3164061">&gt;=</span>&nbsp;<span class="num" id="3164064">0</span>&nbsp;<span class="op" id="3164066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164070">return</span>&nbsp;<span class="op" id="3164077">(</span><span class="ident" id="3164078"><a href="/image/jpeg/writer.go.html#3164035">a</a></span>&nbsp;<span class="op" id="3164080">+</span>&nbsp;<span class="op" id="3164082">(</span><span class="ident" id="3164083"><a href="/image/jpeg/writer.go.html#3164038">b</a></span>&nbsp;<span class="op" id="3164085">&gt;&gt;</span>&nbsp;<span class="num" id="3164088">1</span><span class="op" id="3164089">)</span><span class="op" id="3164090">)</span>&nbsp;<span class="op" id="3164092">/</span>&nbsp;<span class="ident" id="3164094"><a href="/image/jpeg/writer.go.html#3164038">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164100">return</span>&nbsp;<span class="op" id="3164107">-</span><span class="op" id="3164108">(</span><span class="op" id="3164109">(</span><span class="op" id="3164110">-</span><span class="ident" id="3164111"><a href="/image/jpeg/writer.go.html#3164035">a</a></span>&nbsp;<span class="op" id="3164113">+</span>&nbsp;<span class="op" id="3164115">(</span><span class="ident" id="3164116"><a href="/image/jpeg/writer.go.html#3164038">b</a></span>&nbsp;<span class="op" id="3164118">&gt;&gt;</span>&nbsp;<span class="num" id="3164121">1</span><span class="op" id="3164122">)</span><span class="op" id="3164123">)</span>&nbsp;<span class="op" id="3164125">/</span>&nbsp;<span class="ident" id="3164127"><a href="/image/jpeg/writer.go.html#3164038">b</a></span><span class="op" id="3164128">)</span><br>
<span class="lineno"></span><span class="op" id="3164130">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3164133">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3164198">var</span>&nbsp;<span class="ident" id="3164202">bitCount</span>&nbsp;<span class="op" id="3164211">=</span>&nbsp;<span class="op" id="3164213">[</span><span class="num" id="3164214">256</span><span class="op" id="3164217">]</span><span class="builtintype" id="3164218">byte</span><span class="op" id="3164222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164225">0</span><span class="op" id="3164226">,</span>&nbsp;<span class="num" id="3164228">1</span><span class="op" id="3164229">,</span>&nbsp;<span class="num" id="3164231">2</span><span class="op" id="3164232">,</span>&nbsp;<span class="num" id="3164234">2</span><span class="op" id="3164235">,</span>&nbsp;<span class="num" id="3164237">3</span><span class="op" id="3164238">,</span>&nbsp;<span class="num" id="3164240">3</span><span class="op" id="3164241">,</span>&nbsp;<span class="num" id="3164243">3</span><span class="op" id="3164244">,</span>&nbsp;<span class="num" id="3164246">3</span><span class="op" id="3164247">,</span>&nbsp;<span class="num" id="3164249">4</span><span class="op" id="3164250">,</span>&nbsp;<span class="num" id="3164252">4</span><span class="op" id="3164253">,</span>&nbsp;<span class="num" id="3164255">4</span><span class="op" id="3164256">,</span>&nbsp;<span class="num" id="3164258">4</span><span class="op" id="3164259">,</span>&nbsp;<span class="num" id="3164261">4</span><span class="op" id="3164262">,</span>&nbsp;<span class="num" id="3164264">4</span><span class="op" id="3164265">,</span>&nbsp;<span class="num" id="3164267">4</span><span class="op" id="3164268">,</span>&nbsp;<span class="num" id="3164270">4</span><span class="op" id="3164271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164274">5</span><span class="op" id="3164275">,</span>&nbsp;<span class="num" id="3164277">5</span><span class="op" id="3164278">,</span>&nbsp;<span class="num" id="3164280">5</span><span class="op" id="3164281">,</span>&nbsp;<span class="num" id="3164283">5</span><span class="op" id="3164284">,</span>&nbsp;<span class="num" id="3164286">5</span><span class="op" id="3164287">,</span>&nbsp;<span class="num" id="3164289">5</span><span class="op" id="3164290">,</span>&nbsp;<span class="num" id="3164292">5</span><span class="op" id="3164293">,</span>&nbsp;<span class="num" id="3164295">5</span><span class="op" id="3164296">,</span>&nbsp;<span class="num" id="3164298">5</span><span class="op" id="3164299">,</span>&nbsp;<span class="num" id="3164301">5</span><span class="op" id="3164302">,</span>&nbsp;<span class="num" id="3164304">5</span><span class="op" id="3164305">,</span>&nbsp;<span class="num" id="3164307">5</span><span class="op" id="3164308">,</span>&nbsp;<span class="num" id="3164310">5</span><span class="op" id="3164311">,</span>&nbsp;<span class="num" id="3164313">5</span><span class="op" id="3164314">,</span>&nbsp;<span class="num" id="3164316">5</span><span class="op" id="3164317">,</span>&nbsp;<span class="num" id="3164319">5</span><span class="op" id="3164320">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164323">6</span><span class="op" id="3164324">,</span>&nbsp;<span class="num" id="3164326">6</span><span class="op" id="3164327">,</span>&nbsp;<span class="num" id="3164329">6</span><span class="op" id="3164330">,</span>&nbsp;<span class="num" id="3164332">6</span><span class="op" id="3164333">,</span>&nbsp;<span class="num" id="3164335">6</span><span class="op" id="3164336">,</span>&nbsp;<span class="num" id="3164338">6</span><span class="op" id="3164339">,</span>&nbsp;<span class="num" id="3164341">6</span><span class="op" id="3164342">,</span>&nbsp;<span class="num" id="3164344">6</span><span class="op" id="3164345">,</span>&nbsp;<span class="num" id="3164347">6</span><span class="op" id="3164348">,</span>&nbsp;<span class="num" id="3164350">6</span><span class="op" id="3164351">,</span>&nbsp;<span class="num" id="3164353">6</span><span class="op" id="3164354">,</span>&nbsp;<span class="num" id="3164356">6</span><span class="op" id="3164357">,</span>&nbsp;<span class="num" id="3164359">6</span><span class="op" id="3164360">,</span>&nbsp;<span class="num" id="3164362">6</span><span class="op" id="3164363">,</span>&nbsp;<span class="num" id="3164365">6</span><span class="op" id="3164366">,</span>&nbsp;<span class="num" id="3164368">6</span><span class="op" id="3164369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164372">6</span><span class="op" id="3164373">,</span>&nbsp;<span class="num" id="3164375">6</span><span class="op" id="3164376">,</span>&nbsp;<span class="num" id="3164378">6</span><span class="op" id="3164379">,</span>&nbsp;<span class="num" id="3164381">6</span><span class="op" id="3164382">,</span>&nbsp;<span class="num" id="3164384">6</span><span class="op" id="3164385">,</span>&nbsp;<span class="num" id="3164387">6</span><span class="op" id="3164388">,</span>&nbsp;<span class="num" id="3164390">6</span><span class="op" id="3164391">,</span>&nbsp;<span class="num" id="3164393">6</span><span class="op" id="3164394">,</span>&nbsp;<span class="num" id="3164396">6</span><span class="op" id="3164397">,</span>&nbsp;<span class="num" id="3164399">6</span><span class="op" id="3164400">,</span>&nbsp;<span class="num" id="3164402">6</span><span class="op" id="3164403">,</span>&nbsp;<span class="num" id="3164405">6</span><span class="op" id="3164406">,</span>&nbsp;<span class="num" id="3164408">6</span><span class="op" id="3164409">,</span>&nbsp;<span class="num" id="3164411">6</span><span class="op" id="3164412">,</span>&nbsp;<span class="num" id="3164414">6</span><span class="op" id="3164415">,</span>&nbsp;<span class="num" id="3164417">6</span><span class="op" id="3164418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164421">7</span><span class="op" id="3164422">,</span>&nbsp;<span class="num" id="3164424">7</span><span class="op" id="3164425">,</span>&nbsp;<span class="num" id="3164427">7</span><span class="op" id="3164428">,</span>&nbsp;<span class="num" id="3164430">7</span><span class="op" id="3164431">,</span>&nbsp;<span class="num" id="3164433">7</span><span class="op" id="3164434">,</span>&nbsp;<span class="num" id="3164436">7</span><span class="op" id="3164437">,</span>&nbsp;<span class="num" id="3164439">7</span><span class="op" id="3164440">,</span>&nbsp;<span class="num" id="3164442">7</span><span class="op" id="3164443">,</span>&nbsp;<span class="num" id="3164445">7</span><span class="op" id="3164446">,</span>&nbsp;<span class="num" id="3164448">7</span><span class="op" id="3164449">,</span>&nbsp;<span class="num" id="3164451">7</span><span class="op" id="3164452">,</span>&nbsp;<span class="num" id="3164454">7</span><span class="op" id="3164455">,</span>&nbsp;<span class="num" id="3164457">7</span><span class="op" id="3164458">,</span>&nbsp;<span class="num" id="3164460">7</span><span class="op" id="3164461">,</span>&nbsp;<span class="num" id="3164463">7</span><span class="op" id="3164464">,</span>&nbsp;<span class="num" id="3164466">7</span><span class="op" id="3164467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164470">7</span><span class="op" id="3164471">,</span>&nbsp;<span class="num" id="3164473">7</span><span class="op" id="3164474">,</span>&nbsp;<span class="num" id="3164476">7</span><span class="op" id="3164477">,</span>&nbsp;<span class="num" id="3164479">7</span><span class="op" id="3164480">,</span>&nbsp;<span class="num" id="3164482">7</span><span class="op" id="3164483">,</span>&nbsp;<span class="num" id="3164485">7</span><span class="op" id="3164486">,</span>&nbsp;<span class="num" id="3164488">7</span><span class="op" id="3164489">,</span>&nbsp;<span class="num" id="3164491">7</span><span class="op" id="3164492">,</span>&nbsp;<span class="num" id="3164494">7</span><span class="op" id="3164495">,</span>&nbsp;<span class="num" id="3164497">7</span><span class="op" id="3164498">,</span>&nbsp;<span class="num" id="3164500">7</span><span class="op" id="3164501">,</span>&nbsp;<span class="num" id="3164503">7</span><span class="op" id="3164504">,</span>&nbsp;<span class="num" id="3164506">7</span><span class="op" id="3164507">,</span>&nbsp;<span class="num" id="3164509">7</span><span class="op" id="3164510">,</span>&nbsp;<span class="num" id="3164512">7</span><span class="op" id="3164513">,</span>&nbsp;<span class="num" id="3164515">7</span><span class="op" id="3164516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164519">7</span><span class="op" id="3164520">,</span>&nbsp;<span class="num" id="3164522">7</span><span class="op" id="3164523">,</span>&nbsp;<span class="num" id="3164525">7</span><span class="op" id="3164526">,</span>&nbsp;<span class="num" id="3164528">7</span><span class="op" id="3164529">,</span>&nbsp;<span class="num" id="3164531">7</span><span class="op" id="3164532">,</span>&nbsp;<span class="num" id="3164534">7</span><span class="op" id="3164535">,</span>&nbsp;<span class="num" id="3164537">7</span><span class="op" id="3164538">,</span>&nbsp;<span class="num" id="3164540">7</span><span class="op" id="3164541">,</span>&nbsp;<span class="num" id="3164543">7</span><span class="op" id="3164544">,</span>&nbsp;<span class="num" id="3164546">7</span><span class="op" id="3164547">,</span>&nbsp;<span class="num" id="3164549">7</span><span class="op" id="3164550">,</span>&nbsp;<span class="num" id="3164552">7</span><span class="op" id="3164553">,</span>&nbsp;<span class="num" id="3164555">7</span><span class="op" id="3164556">,</span>&nbsp;<span class="num" id="3164558">7</span><span class="op" id="3164559">,</span>&nbsp;<span class="num" id="3164561">7</span><span class="op" id="3164562">,</span>&nbsp;<span class="num" id="3164564">7</span><span class="op" id="3164565">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164568">7</span><span class="op" id="3164569">,</span>&nbsp;<span class="num" id="3164571">7</span><span class="op" id="3164572">,</span>&nbsp;<span class="num" id="3164574">7</span><span class="op" id="3164575">,</span>&nbsp;<span class="num" id="3164577">7</span><span class="op" id="3164578">,</span>&nbsp;<span class="num" id="3164580">7</span><span class="op" id="3164581">,</span>&nbsp;<span class="num" id="3164583">7</span><span class="op" id="3164584">,</span>&nbsp;<span class="num" id="3164586">7</span><span class="op" id="3164587">,</span>&nbsp;<span class="num" id="3164589">7</span><span class="op" id="3164590">,</span>&nbsp;<span class="num" id="3164592">7</span><span class="op" id="3164593">,</span>&nbsp;<span class="num" id="3164595">7</span><span class="op" id="3164596">,</span>&nbsp;<span class="num" id="3164598">7</span><span class="op" id="3164599">,</span>&nbsp;<span class="num" id="3164601">7</span><span class="op" id="3164602">,</span>&nbsp;<span class="num" id="3164604">7</span><span class="op" id="3164605">,</span>&nbsp;<span class="num" id="3164607">7</span><span class="op" id="3164608">,</span>&nbsp;<span class="num" id="3164610">7</span><span class="op" id="3164611">,</span>&nbsp;<span class="num" id="3164613">7</span><span class="op" id="3164614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164617">8</span><span class="op" id="3164618">,</span>&nbsp;<span class="num" id="3164620">8</span><span class="op" id="3164621">,</span>&nbsp;<span class="num" id="3164623">8</span><span class="op" id="3164624">,</span>&nbsp;<span class="num" id="3164626">8</span><span class="op" id="3164627">,</span>&nbsp;<span class="num" id="3164629">8</span><span class="op" id="3164630">,</span>&nbsp;<span class="num" id="3164632">8</span><span class="op" id="3164633">,</span>&nbsp;<span class="num" id="3164635">8</span><span class="op" id="3164636">,</span>&nbsp;<span class="num" id="3164638">8</span><span class="op" id="3164639">,</span>&nbsp;<span class="num" id="3164641">8</span><span class="op" id="3164642">,</span>&nbsp;<span class="num" id="3164644">8</span><span class="op" id="3164645">,</span>&nbsp;<span class="num" id="3164647">8</span><span class="op" id="3164648">,</span>&nbsp;<span class="num" id="3164650">8</span><span class="op" id="3164651">,</span>&nbsp;<span class="num" id="3164653">8</span><span class="op" id="3164654">,</span>&nbsp;<span class="num" id="3164656">8</span><span class="op" id="3164657">,</span>&nbsp;<span class="num" id="3164659">8</span><span class="op" id="3164660">,</span>&nbsp;<span class="num" id="3164662">8</span><span class="op" id="3164663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164666">8</span><span class="op" id="3164667">,</span>&nbsp;<span class="num" id="3164669">8</span><span class="op" id="3164670">,</span>&nbsp;<span class="num" id="3164672">8</span><span class="op" id="3164673">,</span>&nbsp;<span class="num" id="3164675">8</span><span class="op" id="3164676">,</span>&nbsp;<span class="num" id="3164678">8</span><span class="op" id="3164679">,</span>&nbsp;<span class="num" id="3164681">8</span><span class="op" id="3164682">,</span>&nbsp;<span class="num" id="3164684">8</span><span class="op" id="3164685">,</span>&nbsp;<span class="num" id="3164687">8</span><span class="op" id="3164688">,</span>&nbsp;<span class="num" id="3164690">8</span><span class="op" id="3164691">,</span>&nbsp;<span class="num" id="3164693">8</span><span class="op" id="3164694">,</span>&nbsp;<span class="num" id="3164696">8</span><span class="op" id="3164697">,</span>&nbsp;<span class="num" id="3164699">8</span><span class="op" id="3164700">,</span>&nbsp;<span class="num" id="3164702">8</span><span class="op" id="3164703">,</span>&nbsp;<span class="num" id="3164705">8</span><span class="op" id="3164706">,</span>&nbsp;<span class="num" id="3164708">8</span><span class="op" id="3164709">,</span>&nbsp;<span class="num" id="3164711">8</span><span class="op" id="3164712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164715">8</span><span class="op" id="3164716">,</span>&nbsp;<span class="num" id="3164718">8</span><span class="op" id="3164719">,</span>&nbsp;<span class="num" id="3164721">8</span><span class="op" id="3164722">,</span>&nbsp;<span class="num" id="3164724">8</span><span class="op" id="3164725">,</span>&nbsp;<span class="num" id="3164727">8</span><span class="op" id="3164728">,</span>&nbsp;<span class="num" id="3164730">8</span><span class="op" id="3164731">,</span>&nbsp;<span class="num" id="3164733">8</span><span class="op" id="3164734">,</span>&nbsp;<span class="num" id="3164736">8</span><span class="op" id="3164737">,</span>&nbsp;<span class="num" id="3164739">8</span><span class="op" id="3164740">,</span>&nbsp;<span class="num" id="3164742">8</span><span class="op" id="3164743">,</span>&nbsp;<span class="num" id="3164745">8</span><span class="op" id="3164746">,</span>&nbsp;<span class="num" id="3164748">8</span><span class="op" id="3164749">,</span>&nbsp;<span class="num" id="3164751">8</span><span class="op" id="3164752">,</span>&nbsp;<span class="num" id="3164754">8</span><span class="op" id="3164755">,</span>&nbsp;<span class="num" id="3164757">8</span><span class="op" id="3164758">,</span>&nbsp;<span class="num" id="3164760">8</span><span class="op" id="3164761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164764">8</span><span class="op" id="3164765">,</span>&nbsp;<span class="num" id="3164767">8</span><span class="op" id="3164768">,</span>&nbsp;<span class="num" id="3164770">8</span><span class="op" id="3164771">,</span>&nbsp;<span class="num" id="3164773">8</span><span class="op" id="3164774">,</span>&nbsp;<span class="num" id="3164776">8</span><span class="op" id="3164777">,</span>&nbsp;<span class="num" id="3164779">8</span><span class="op" id="3164780">,</span>&nbsp;<span class="num" id="3164782">8</span><span class="op" id="3164783">,</span>&nbsp;<span class="num" id="3164785">8</span><span class="op" id="3164786">,</span>&nbsp;<span class="num" id="3164788">8</span><span class="op" id="3164789">,</span>&nbsp;<span class="num" id="3164791">8</span><span class="op" id="3164792">,</span>&nbsp;<span class="num" id="3164794">8</span><span class="op" id="3164795">,</span>&nbsp;<span class="num" id="3164797">8</span><span class="op" id="3164798">,</span>&nbsp;<span class="num" id="3164800">8</span><span class="op" id="3164801">,</span>&nbsp;<span class="num" id="3164803">8</span><span class="op" id="3164804">,</span>&nbsp;<span class="num" id="3164806">8</span><span class="op" id="3164807">,</span>&nbsp;<span class="num" id="3164809">8</span><span class="op" id="3164810">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164813">8</span><span class="op" id="3164814">,</span>&nbsp;<span class="num" id="3164816">8</span><span class="op" id="3164817">,</span>&nbsp;<span class="num" id="3164819">8</span><span class="op" id="3164820">,</span>&nbsp;<span class="num" id="3164822">8</span><span class="op" id="3164823">,</span>&nbsp;<span class="num" id="3164825">8</span><span class="op" id="3164826">,</span>&nbsp;<span class="num" id="3164828">8</span><span class="op" id="3164829">,</span>&nbsp;<span class="num" id="3164831">8</span><span class="op" id="3164832">,</span>&nbsp;<span class="num" id="3164834">8</span><span class="op" id="3164835">,</span>&nbsp;<span class="num" id="3164837">8</span><span class="op" id="3164838">,</span>&nbsp;<span class="num" id="3164840">8</span><span class="op" id="3164841">,</span>&nbsp;<span class="num" id="3164843">8</span><span class="op" id="3164844">,</span>&nbsp;<span class="num" id="3164846">8</span><span class="op" id="3164847">,</span>&nbsp;<span class="num" id="3164849">8</span><span class="op" id="3164850">,</span>&nbsp;<span class="num" id="3164852">8</span><span class="op" id="3164853">,</span>&nbsp;<span class="num" id="3164855">8</span><span class="op" id="3164856">,</span>&nbsp;<span class="num" id="3164858">8</span><span class="op" id="3164859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164862">8</span><span class="op" id="3164863">,</span>&nbsp;<span class="num" id="3164865">8</span><span class="op" id="3164866">,</span>&nbsp;<span class="num" id="3164868">8</span><span class="op" id="3164869">,</span>&nbsp;<span class="num" id="3164871">8</span><span class="op" id="3164872">,</span>&nbsp;<span class="num" id="3164874">8</span><span class="op" id="3164875">,</span>&nbsp;<span class="num" id="3164877">8</span><span class="op" id="3164878">,</span>&nbsp;<span class="num" id="3164880">8</span><span class="op" id="3164881">,</span>&nbsp;<span class="num" id="3164883">8</span><span class="op" id="3164884">,</span>&nbsp;<span class="num" id="3164886">8</span><span class="op" id="3164887">,</span>&nbsp;<span class="num" id="3164889">8</span><span class="op" id="3164890">,</span>&nbsp;<span class="num" id="3164892">8</span><span class="op" id="3164893">,</span>&nbsp;<span class="num" id="3164895">8</span><span class="op" id="3164896">,</span>&nbsp;<span class="num" id="3164898">8</span><span class="op" id="3164899">,</span>&nbsp;<span class="num" id="3164901">8</span><span class="op" id="3164902">,</span>&nbsp;<span class="num" id="3164904">8</span><span class="op" id="3164905">,</span>&nbsp;<span class="num" id="3164907">8</span><span class="op" id="3164908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164911">8</span><span class="op" id="3164912">,</span>&nbsp;<span class="num" id="3164914">8</span><span class="op" id="3164915">,</span>&nbsp;<span class="num" id="3164917">8</span><span class="op" id="3164918">,</span>&nbsp;<span class="num" id="3164920">8</span><span class="op" id="3164921">,</span>&nbsp;<span class="num" id="3164923">8</span><span class="op" id="3164924">,</span>&nbsp;<span class="num" id="3164926">8</span><span class="op" id="3164927">,</span>&nbsp;<span class="num" id="3164929">8</span><span class="op" id="3164930">,</span>&nbsp;<span class="num" id="3164932">8</span><span class="op" id="3164933">,</span>&nbsp;<span class="num" id="3164935">8</span><span class="op" id="3164936">,</span>&nbsp;<span class="num" id="3164938">8</span><span class="op" id="3164939">,</span>&nbsp;<span class="num" id="3164941">8</span><span class="op" id="3164942">,</span>&nbsp;<span class="num" id="3164944">8</span><span class="op" id="3164945">,</span>&nbsp;<span class="num" id="3164947">8</span><span class="op" id="3164948">,</span>&nbsp;<span class="num" id="3164950">8</span><span class="op" id="3164951">,</span>&nbsp;<span class="num" id="3164953">8</span><span class="op" id="3164954">,</span>&nbsp;<span class="num" id="3164956">8</span><span class="op" id="3164957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3164960">8</span><span class="op" id="3164961">,</span>&nbsp;<span class="num" id="3164963">8</span><span class="op" id="3164964">,</span>&nbsp;<span class="num" id="3164966">8</span><span class="op" id="3164967">,</span>&nbsp;<span class="num" id="3164969">8</span><span class="op" id="3164970">,</span>&nbsp;<span class="num" id="3164972">8</span><span class="op" id="3164973">,</span>&nbsp;<span class="num" id="3164975">8</span><span class="op" id="3164976">,</span>&nbsp;<span class="num" id="3164978">8</span><span class="op" id="3164979">,</span>&nbsp;<span class="num" id="3164981">8</span><span class="op" id="3164982">,</span>&nbsp;<span class="num" id="3164984">8</span><span class="op" id="3164985">,</span>&nbsp;<span class="num" id="3164987">8</span><span class="op" id="3164988">,</span>&nbsp;<span class="num" id="3164990">8</span><span class="op" id="3164991">,</span>&nbsp;<span class="num" id="3164993">8</span><span class="op" id="3164994">,</span>&nbsp;<span class="num" id="3164996">8</span><span class="op" id="3164997">,</span>&nbsp;<span class="num" id="3164999">8</span><span class="op" id="3165000">,</span>&nbsp;<span class="num" id="3165002">8</span><span class="op" id="3165003">,</span>&nbsp;<span class="num" id="3165005">8</span><span class="op" id="3165006">,</span><br>
<span class="lineno"></span><span class="op" id="3165008">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3165011">type</span>&nbsp;<span class="ident" id="3165016">quantIndex</span>&nbsp;<span class="builtintype" id="3165027">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3165032">const</span>&nbsp;<span class="op" id="3165038">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165041">quantIndexLuminance</span>&nbsp;<span class="ident" id="3165061"><a href="/image/jpeg/writer.go.html#3165016">quantIndex</a></span>&nbsp;<span class="op" id="3165072">=</span>&nbsp;<span class="ident" id="3165074">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165080">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165103">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="3165115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3165118">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="3165195">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="3165271">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3165347">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="3165365">var</span>&nbsp;<span class="ident" id="3165369">unscaledQuant</span>&nbsp;<span class="op" id="3165383">=</span>&nbsp;<span class="op" id="3165385">[</span><span class="ident" id="3165386"><a href="/image/jpeg/writer.go.html#3165103">nQuantIndex</a></span><span class="op" id="3165397">]</span><span class="op" id="3165398">[</span><span class="ident" id="3165399"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3165408">]</span><span class="builtintype" id="3165409">byte</span><span class="op" id="3165413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165416">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165435">16</span><span class="op" id="3165437">,</span>&nbsp;<span class="num" id="3165439">11</span><span class="op" id="3165441">,</span>&nbsp;<span class="num" id="3165443">12</span><span class="op" id="3165445">,</span>&nbsp;<span class="num" id="3165447">14</span><span class="op" id="3165449">,</span>&nbsp;<span class="num" id="3165451">12</span><span class="op" id="3165453">,</span>&nbsp;<span class="num" id="3165455">10</span><span class="op" id="3165457">,</span>&nbsp;<span class="num" id="3165459">16</span><span class="op" id="3165461">,</span>&nbsp;<span class="num" id="3165463">14</span><span class="op" id="3165465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165469">13</span><span class="op" id="3165471">,</span>&nbsp;<span class="num" id="3165473">14</span><span class="op" id="3165475">,</span>&nbsp;<span class="num" id="3165477">18</span><span class="op" id="3165479">,</span>&nbsp;<span class="num" id="3165481">17</span><span class="op" id="3165483">,</span>&nbsp;<span class="num" id="3165485">16</span><span class="op" id="3165487">,</span>&nbsp;<span class="num" id="3165489">19</span><span class="op" id="3165491">,</span>&nbsp;<span class="num" id="3165493">24</span><span class="op" id="3165495">,</span>&nbsp;<span class="num" id="3165497">40</span><span class="op" id="3165499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165503">26</span><span class="op" id="3165505">,</span>&nbsp;<span class="num" id="3165507">24</span><span class="op" id="3165509">,</span>&nbsp;<span class="num" id="3165511">22</span><span class="op" id="3165513">,</span>&nbsp;<span class="num" id="3165515">22</span><span class="op" id="3165517">,</span>&nbsp;<span class="num" id="3165519">24</span><span class="op" id="3165521">,</span>&nbsp;<span class="num" id="3165523">49</span><span class="op" id="3165525">,</span>&nbsp;<span class="num" id="3165527">35</span><span class="op" id="3165529">,</span>&nbsp;<span class="num" id="3165531">37</span><span class="op" id="3165533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165537">29</span><span class="op" id="3165539">,</span>&nbsp;<span class="num" id="3165541">40</span><span class="op" id="3165543">,</span>&nbsp;<span class="num" id="3165545">58</span><span class="op" id="3165547">,</span>&nbsp;<span class="num" id="3165549">51</span><span class="op" id="3165551">,</span>&nbsp;<span class="num" id="3165553">61</span><span class="op" id="3165555">,</span>&nbsp;<span class="num" id="3165557">60</span><span class="op" id="3165559">,</span>&nbsp;<span class="num" id="3165561">57</span><span class="op" id="3165563">,</span>&nbsp;<span class="num" id="3165565">51</span><span class="op" id="3165567">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165571">56</span><span class="op" id="3165573">,</span>&nbsp;<span class="num" id="3165575">55</span><span class="op" id="3165577">,</span>&nbsp;<span class="num" id="3165579">64</span><span class="op" id="3165581">,</span>&nbsp;<span class="num" id="3165583">72</span><span class="op" id="3165585">,</span>&nbsp;<span class="num" id="3165587">92</span><span class="op" id="3165589">,</span>&nbsp;<span class="num" id="3165591">78</span><span class="op" id="3165593">,</span>&nbsp;<span class="num" id="3165595">64</span><span class="op" id="3165597">,</span>&nbsp;<span class="num" id="3165599">68</span><span class="op" id="3165601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165605">87</span><span class="op" id="3165607">,</span>&nbsp;<span class="num" id="3165609">69</span><span class="op" id="3165611">,</span>&nbsp;<span class="num" id="3165613">55</span><span class="op" id="3165615">,</span>&nbsp;<span class="num" id="3165617">56</span><span class="op" id="3165619">,</span>&nbsp;<span class="num" id="3165621">80</span><span class="op" id="3165623">,</span>&nbsp;<span class="num" id="3165625">109</span><span class="op" id="3165628">,</span>&nbsp;<span class="num" id="3165630">81</span><span class="op" id="3165632">,</span>&nbsp;<span class="num" id="3165634">87</span><span class="op" id="3165636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165640">95</span><span class="op" id="3165642">,</span>&nbsp;<span class="num" id="3165644">98</span><span class="op" id="3165646">,</span>&nbsp;<span class="num" id="3165648">103</span><span class="op" id="3165651">,</span>&nbsp;<span class="num" id="3165653">104</span><span class="op" id="3165656">,</span>&nbsp;<span class="num" id="3165658">103</span><span class="op" id="3165661">,</span>&nbsp;<span class="num" id="3165663">62</span><span class="op" id="3165665">,</span>&nbsp;<span class="num" id="3165667">77</span><span class="op" id="3165669">,</span>&nbsp;<span class="num" id="3165671">113</span><span class="op" id="3165674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165678">121</span><span class="op" id="3165681">,</span>&nbsp;<span class="num" id="3165683">112</span><span class="op" id="3165686">,</span>&nbsp;<span class="num" id="3165688">100</span><span class="op" id="3165691">,</span>&nbsp;<span class="num" id="3165693">120</span><span class="op" id="3165696">,</span>&nbsp;<span class="num" id="3165698">92</span><span class="op" id="3165700">,</span>&nbsp;<span class="num" id="3165702">101</span><span class="op" id="3165705">,</span>&nbsp;<span class="num" id="3165707">103</span><span class="op" id="3165710">,</span>&nbsp;<span class="num" id="3165712">99</span><span class="op" id="3165714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165717">}</span><span class="op" id="3165718">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165721">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165742">17</span><span class="op" id="3165744">,</span>&nbsp;<span class="num" id="3165746">18</span><span class="op" id="3165748">,</span>&nbsp;<span class="num" id="3165750">18</span><span class="op" id="3165752">,</span>&nbsp;<span class="num" id="3165754">24</span><span class="op" id="3165756">,</span>&nbsp;<span class="num" id="3165758">21</span><span class="op" id="3165760">,</span>&nbsp;<span class="num" id="3165762">24</span><span class="op" id="3165764">,</span>&nbsp;<span class="num" id="3165766">47</span><span class="op" id="3165768">,</span>&nbsp;<span class="num" id="3165770">26</span><span class="op" id="3165772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165776">26</span><span class="op" id="3165778">,</span>&nbsp;<span class="num" id="3165780">47</span><span class="op" id="3165782">,</span>&nbsp;<span class="num" id="3165784">99</span><span class="op" id="3165786">,</span>&nbsp;<span class="num" id="3165788">66</span><span class="op" id="3165790">,</span>&nbsp;<span class="num" id="3165792">56</span><span class="op" id="3165794">,</span>&nbsp;<span class="num" id="3165796">66</span><span class="op" id="3165798">,</span>&nbsp;<span class="num" id="3165800">99</span><span class="op" id="3165802">,</span>&nbsp;<span class="num" id="3165804">99</span><span class="op" id="3165806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165810">99</span><span class="op" id="3165812">,</span>&nbsp;<span class="num" id="3165814">99</span><span class="op" id="3165816">,</span>&nbsp;<span class="num" id="3165818">99</span><span class="op" id="3165820">,</span>&nbsp;<span class="num" id="3165822">99</span><span class="op" id="3165824">,</span>&nbsp;<span class="num" id="3165826">99</span><span class="op" id="3165828">,</span>&nbsp;<span class="num" id="3165830">99</span><span class="op" id="3165832">,</span>&nbsp;<span class="num" id="3165834">99</span><span class="op" id="3165836">,</span>&nbsp;<span class="num" id="3165838">99</span><span class="op" id="3165840">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165844">99</span><span class="op" id="3165846">,</span>&nbsp;<span class="num" id="3165848">99</span><span class="op" id="3165850">,</span>&nbsp;<span class="num" id="3165852">99</span><span class="op" id="3165854">,</span>&nbsp;<span class="num" id="3165856">99</span><span class="op" id="3165858">,</span>&nbsp;<span class="num" id="3165860">99</span><span class="op" id="3165862">,</span>&nbsp;<span class="num" id="3165864">99</span><span class="op" id="3165866">,</span>&nbsp;<span class="num" id="3165868">99</span><span class="op" id="3165870">,</span>&nbsp;<span class="num" id="3165872">99</span><span class="op" id="3165874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165878">99</span><span class="op" id="3165880">,</span>&nbsp;<span class="num" id="3165882">99</span><span class="op" id="3165884">,</span>&nbsp;<span class="num" id="3165886">99</span><span class="op" id="3165888">,</span>&nbsp;<span class="num" id="3165890">99</span><span class="op" id="3165892">,</span>&nbsp;<span class="num" id="3165894">99</span><span class="op" id="3165896">,</span>&nbsp;<span class="num" id="3165898">99</span><span class="op" id="3165900">,</span>&nbsp;<span class="num" id="3165902">99</span><span class="op" id="3165904">,</span>&nbsp;<span class="num" id="3165906">99</span><span class="op" id="3165908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165912">99</span><span class="op" id="3165914">,</span>&nbsp;<span class="num" id="3165916">99</span><span class="op" id="3165918">,</span>&nbsp;<span class="num" id="3165920">99</span><span class="op" id="3165922">,</span>&nbsp;<span class="num" id="3165924">99</span><span class="op" id="3165926">,</span>&nbsp;<span class="num" id="3165928">99</span><span class="op" id="3165930">,</span>&nbsp;<span class="num" id="3165932">99</span><span class="op" id="3165934">,</span>&nbsp;<span class="num" id="3165936">99</span><span class="op" id="3165938">,</span>&nbsp;<span class="num" id="3165940">99</span><span class="op" id="3165942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165946">99</span><span class="op" id="3165948">,</span>&nbsp;<span class="num" id="3165950">99</span><span class="op" id="3165952">,</span>&nbsp;<span class="num" id="3165954">99</span><span class="op" id="3165956">,</span>&nbsp;<span class="num" id="3165958">99</span><span class="op" id="3165960">,</span>&nbsp;<span class="num" id="3165962">99</span><span class="op" id="3165964">,</span>&nbsp;<span class="num" id="3165966">99</span><span class="op" id="3165968">,</span>&nbsp;<span class="num" id="3165970">99</span><span class="op" id="3165972">,</span>&nbsp;<span class="num" id="3165974">99</span><span class="op" id="3165976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3165980">99</span><span class="op" id="3165982">,</span>&nbsp;<span class="num" id="3165984">99</span><span class="op" id="3165986">,</span>&nbsp;<span class="num" id="3165988">99</span><span class="op" id="3165990">,</span>&nbsp;<span class="num" id="3165992">99</span><span class="op" id="3165994">,</span>&nbsp;<span class="num" id="3165996">99</span><span class="op" id="3165998">,</span>&nbsp;<span class="num" id="3166000">99</span><span class="op" id="3166002">,</span>&nbsp;<span class="num" id="3166004">99</span><span class="op" id="3166006">,</span>&nbsp;<span class="num" id="3166008">99</span><span class="op" id="3166010">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166013">}</span><span class="op" id="3166014">,</span><br>
<span class="lineno"></span><span class="op" id="3166016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3166019">type</span>&nbsp;<span class="ident" id="3166024">huffIndex</span>&nbsp;<span class="builtintype" id="3166034">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3166039">const</span>&nbsp;<span class="op" id="3166045">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166048">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="3166069"><a href="/image/jpeg/writer.go.html#3166024">huffIndex</a></span>&nbsp;<span class="op" id="3166079">=</span>&nbsp;<span class="ident" id="3166081">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166087">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166109">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166133">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166157">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="3166168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3166171">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3166216">type</span>&nbsp;<span class="ident" id="3166221">huffmanSpec</span>&nbsp;<span class="keyword" id="3166233">struct</span>&nbsp;<span class="op" id="3166240">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166243">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166297">count</span>&nbsp;<span class="op" id="3166303">[</span><span class="num" id="3166304">16</span><span class="op" id="3166306">]</span><span class="builtintype" id="3166307">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166313">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166369">value</span>&nbsp;<span class="op" id="3166375">[</span><span class="op" id="3166376">]</span><span class="builtintype" id="3166377">byte</span><br>
<span class="lineno"></span><span class="op" id="3166382">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3166385">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="3166443">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="3166506">var</span>&nbsp;<span class="ident" id="3166510">theHuffmanSpec</span>&nbsp;<span class="op" id="3166525">=</span>&nbsp;<span class="op" id="3166527">[</span><span class="ident" id="3166528"><a href="/image/jpeg/writer.go.html#3166157">nHuffIndex</a></span><span class="op" id="3166538">]</span><span class="ident" id="3166539"><a href="/image/jpeg/writer.go.html#3166221">huffmanSpec</a></span><span class="op" id="3166550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166553">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166575">[</span><span class="num" id="3166576">16</span><span class="op" id="3166578">]</span><span class="builtintype" id="3166579">byte</span><span class="op" id="3166583">{</span><span class="num" id="3166584">0</span><span class="op" id="3166585">,</span>&nbsp;<span class="num" id="3166587">1</span><span class="op" id="3166588">,</span>&nbsp;<span class="num" id="3166590">5</span><span class="op" id="3166591">,</span>&nbsp;<span class="num" id="3166593">1</span><span class="op" id="3166594">,</span>&nbsp;<span class="num" id="3166596">1</span><span class="op" id="3166597">,</span>&nbsp;<span class="num" id="3166599">1</span><span class="op" id="3166600">,</span>&nbsp;<span class="num" id="3166602">1</span><span class="op" id="3166603">,</span>&nbsp;<span class="num" id="3166605">1</span><span class="op" id="3166606">,</span>&nbsp;<span class="num" id="3166608">1</span><span class="op" id="3166609">,</span>&nbsp;<span class="num" id="3166611">0</span><span class="op" id="3166612">,</span>&nbsp;<span class="num" id="3166614">0</span><span class="op" id="3166615">,</span>&nbsp;<span class="num" id="3166617">0</span><span class="op" id="3166618">,</span>&nbsp;<span class="num" id="3166620">0</span><span class="op" id="3166621">,</span>&nbsp;<span class="num" id="3166623">0</span><span class="op" id="3166624">,</span>&nbsp;<span class="num" id="3166626">0</span><span class="op" id="3166627">,</span>&nbsp;<span class="num" id="3166629">0</span><span class="op" id="3166630">}</span><span class="op" id="3166631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166635">[</span><span class="op" id="3166636">]</span><span class="builtintype" id="3166637">byte</span><span class="op" id="3166641">{</span><span class="num" id="3166642">0</span><span class="op" id="3166643">,</span>&nbsp;<span class="num" id="3166645">1</span><span class="op" id="3166646">,</span>&nbsp;<span class="num" id="3166648">2</span><span class="op" id="3166649">,</span>&nbsp;<span class="num" id="3166651">3</span><span class="op" id="3166652">,</span>&nbsp;<span class="num" id="3166654">4</span><span class="op" id="3166655">,</span>&nbsp;<span class="num" id="3166657">5</span><span class="op" id="3166658">,</span>&nbsp;<span class="num" id="3166660">6</span><span class="op" id="3166661">,</span>&nbsp;<span class="num" id="3166663">7</span><span class="op" id="3166664">,</span>&nbsp;<span class="num" id="3166666">8</span><span class="op" id="3166667">,</span>&nbsp;<span class="num" id="3166669">9</span><span class="op" id="3166670">,</span>&nbsp;<span class="num" id="3166672">10</span><span class="op" id="3166674">,</span>&nbsp;<span class="num" id="3166676">11</span><span class="op" id="3166678">}</span><span class="op" id="3166679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166682">}</span><span class="op" id="3166683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166686">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166708">[</span><span class="num" id="3166709">16</span><span class="op" id="3166711">]</span><span class="builtintype" id="3166712">byte</span><span class="op" id="3166716">{</span><span class="num" id="3166717">0</span><span class="op" id="3166718">,</span>&nbsp;<span class="num" id="3166720">2</span><span class="op" id="3166721">,</span>&nbsp;<span class="num" id="3166723">1</span><span class="op" id="3166724">,</span>&nbsp;<span class="num" id="3166726">3</span><span class="op" id="3166727">,</span>&nbsp;<span class="num" id="3166729">3</span><span class="op" id="3166730">,</span>&nbsp;<span class="num" id="3166732">2</span><span class="op" id="3166733">,</span>&nbsp;<span class="num" id="3166735">4</span><span class="op" id="3166736">,</span>&nbsp;<span class="num" id="3166738">3</span><span class="op" id="3166739">,</span>&nbsp;<span class="num" id="3166741">5</span><span class="op" id="3166742">,</span>&nbsp;<span class="num" id="3166744">5</span><span class="op" id="3166745">,</span>&nbsp;<span class="num" id="3166747">4</span><span class="op" id="3166748">,</span>&nbsp;<span class="num" id="3166750">4</span><span class="op" id="3166751">,</span>&nbsp;<span class="num" id="3166753">0</span><span class="op" id="3166754">,</span>&nbsp;<span class="num" id="3166756">0</span><span class="op" id="3166757">,</span>&nbsp;<span class="num" id="3166759">1</span><span class="op" id="3166760">,</span>&nbsp;<span class="num" id="3166762">125</span><span class="op" id="3166765">}</span><span class="op" id="3166766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166770">[</span><span class="op" id="3166771">]</span><span class="builtintype" id="3166772">byte</span><span class="op" id="3166776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3166781">0x01</span><span class="op" id="3166785">,</span>&nbsp;<span class="num" id="3166787">0x02</span><span class="op" id="3166791">,</span>&nbsp;<span class="num" id="3166793">0x03</span><span class="op" id="3166797">,</span>&nbsp;<span class="num" id="3166799">0x00</span><span class="op" id="3166803">,</span>&nbsp;<span class="num" id="3166805">0x04</span><span class="op" id="3166809">,</span>&nbsp;<span class="num" id="3166811">0x11</span><span class="op" id="3166815">,</span>&nbsp;<span class="num" id="3166817">0x05</span><span class="op" id="3166821">,</span>&nbsp;<span class="num" id="3166823">0x12</span><span class="op" id="3166827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3166832">0x21</span><span class="op" id="3166836">,</span>&nbsp;<span class="num" id="3166838">0x31</span><span class="op" id="3166842">,</span>&nbsp;<span class="num" id="3166844">0x41</span><span class="op" id="3166848">,</span>&nbsp;<span class="num" id="3166850">0x06</span><span class="op" id="3166854">,</span>&nbsp;<span class="num" id="3166856">0x13</span><span class="op" id="3166860">,</span>&nbsp;<span class="num" id="3166862">0x51</span><span class="op" id="3166866">,</span>&nbsp;<span class="num" id="3166868">0x61</span><span class="op" id="3166872">,</span>&nbsp;<span class="num" id="3166874">0x07</span><span class="op" id="3166878">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3166883">0x22</span><span class="op" id="3166887">,</span>&nbsp;<span class="num" id="3166889">0x71</span><span class="op" id="3166893">,</span>&nbsp;<span class="num" id="3166895">0x14</span><span class="op" id="3166899">,</span>&nbsp;<span class="num" id="3166901">0x32</span><span class="op" id="3166905">,</span>&nbsp;<span class="num" id="3166907">0x81</span><span class="op" id="3166911">,</span>&nbsp;<span class="num" id="3166913">0x91</span><span class="op" id="3166917">,</span>&nbsp;<span class="num" id="3166919">0xa1</span><span class="op" id="3166923">,</span>&nbsp;<span class="num" id="3166925">0x08</span><span class="op" id="3166929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3166934">0x23</span><span class="op" id="3166938">,</span>&nbsp;<span class="num" id="3166940">0x42</span><span class="op" id="3166944">,</span>&nbsp;<span class="num" id="3166946">0xb1</span><span class="op" id="3166950">,</span>&nbsp;<span class="num" id="3166952">0xc1</span><span class="op" id="3166956">,</span>&nbsp;<span class="num" id="3166958">0x15</span><span class="op" id="3166962">,</span>&nbsp;<span class="num" id="3166964">0x52</span><span class="op" id="3166968">,</span>&nbsp;<span class="num" id="3166970">0xd1</span><span class="op" id="3166974">,</span>&nbsp;<span class="num" id="3166976">0xf0</span><span class="op" id="3166980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3166985">0x24</span><span class="op" id="3166989">,</span>&nbsp;<span class="num" id="3166991">0x33</span><span class="op" id="3166995">,</span>&nbsp;<span class="num" id="3166997">0x62</span><span class="op" id="3167001">,</span>&nbsp;<span class="num" id="3167003">0x72</span><span class="op" id="3167007">,</span>&nbsp;<span class="num" id="3167009">0x82</span><span class="op" id="3167013">,</span>&nbsp;<span class="num" id="3167015">0x09</span><span class="op" id="3167019">,</span>&nbsp;<span class="num" id="3167021">0x0a</span><span class="op" id="3167025">,</span>&nbsp;<span class="num" id="3167027">0x16</span><span class="op" id="3167031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167036">0x17</span><span class="op" id="3167040">,</span>&nbsp;<span class="num" id="3167042">0x18</span><span class="op" id="3167046">,</span>&nbsp;<span class="num" id="3167048">0x19</span><span class="op" id="3167052">,</span>&nbsp;<span class="num" id="3167054">0x1a</span><span class="op" id="3167058">,</span>&nbsp;<span class="num" id="3167060">0x25</span><span class="op" id="3167064">,</span>&nbsp;<span class="num" id="3167066">0x26</span><span class="op" id="3167070">,</span>&nbsp;<span class="num" id="3167072">0x27</span><span class="op" id="3167076">,</span>&nbsp;<span class="num" id="3167078">0x28</span><span class="op" id="3167082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167087">0x29</span><span class="op" id="3167091">,</span>&nbsp;<span class="num" id="3167093">0x2a</span><span class="op" id="3167097">,</span>&nbsp;<span class="num" id="3167099">0x34</span><span class="op" id="3167103">,</span>&nbsp;<span class="num" id="3167105">0x35</span><span class="op" id="3167109">,</span>&nbsp;<span class="num" id="3167111">0x36</span><span class="op" id="3167115">,</span>&nbsp;<span class="num" id="3167117">0x37</span><span class="op" id="3167121">,</span>&nbsp;<span class="num" id="3167123">0x38</span><span class="op" id="3167127">,</span>&nbsp;<span class="num" id="3167129">0x39</span><span class="op" id="3167133">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167138">0x3a</span><span class="op" id="3167142">,</span>&nbsp;<span class="num" id="3167144">0x43</span><span class="op" id="3167148">,</span>&nbsp;<span class="num" id="3167150">0x44</span><span class="op" id="3167154">,</span>&nbsp;<span class="num" id="3167156">0x45</span><span class="op" id="3167160">,</span>&nbsp;<span class="num" id="3167162">0x46</span><span class="op" id="3167166">,</span>&nbsp;<span class="num" id="3167168">0x47</span><span class="op" id="3167172">,</span>&nbsp;<span class="num" id="3167174">0x48</span><span class="op" id="3167178">,</span>&nbsp;<span class="num" id="3167180">0x49</span><span class="op" id="3167184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167189">0x4a</span><span class="op" id="3167193">,</span>&nbsp;<span class="num" id="3167195">0x53</span><span class="op" id="3167199">,</span>&nbsp;<span class="num" id="3167201">0x54</span><span class="op" id="3167205">,</span>&nbsp;<span class="num" id="3167207">0x55</span><span class="op" id="3167211">,</span>&nbsp;<span class="num" id="3167213">0x56</span><span class="op" id="3167217">,</span>&nbsp;<span class="num" id="3167219">0x57</span><span class="op" id="3167223">,</span>&nbsp;<span class="num" id="3167225">0x58</span><span class="op" id="3167229">,</span>&nbsp;<span class="num" id="3167231">0x59</span><span class="op" id="3167235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167240">0x5a</span><span class="op" id="3167244">,</span>&nbsp;<span class="num" id="3167246">0x63</span><span class="op" id="3167250">,</span>&nbsp;<span class="num" id="3167252">0x64</span><span class="op" id="3167256">,</span>&nbsp;<span class="num" id="3167258">0x65</span><span class="op" id="3167262">,</span>&nbsp;<span class="num" id="3167264">0x66</span><span class="op" id="3167268">,</span>&nbsp;<span class="num" id="3167270">0x67</span><span class="op" id="3167274">,</span>&nbsp;<span class="num" id="3167276">0x68</span><span class="op" id="3167280">,</span>&nbsp;<span class="num" id="3167282">0x69</span><span class="op" id="3167286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167291">0x6a</span><span class="op" id="3167295">,</span>&nbsp;<span class="num" id="3167297">0x73</span><span class="op" id="3167301">,</span>&nbsp;<span class="num" id="3167303">0x74</span><span class="op" id="3167307">,</span>&nbsp;<span class="num" id="3167309">0x75</span><span class="op" id="3167313">,</span>&nbsp;<span class="num" id="3167315">0x76</span><span class="op" id="3167319">,</span>&nbsp;<span class="num" id="3167321">0x77</span><span class="op" id="3167325">,</span>&nbsp;<span class="num" id="3167327">0x78</span><span class="op" id="3167331">,</span>&nbsp;<span class="num" id="3167333">0x79</span><span class="op" id="3167337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167342">0x7a</span><span class="op" id="3167346">,</span>&nbsp;<span class="num" id="3167348">0x83</span><span class="op" id="3167352">,</span>&nbsp;<span class="num" id="3167354">0x84</span><span class="op" id="3167358">,</span>&nbsp;<span class="num" id="3167360">0x85</span><span class="op" id="3167364">,</span>&nbsp;<span class="num" id="3167366">0x86</span><span class="op" id="3167370">,</span>&nbsp;<span class="num" id="3167372">0x87</span><span class="op" id="3167376">,</span>&nbsp;<span class="num" id="3167378">0x88</span><span class="op" id="3167382">,</span>&nbsp;<span class="num" id="3167384">0x89</span><span class="op" id="3167388">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167393">0x8a</span><span class="op" id="3167397">,</span>&nbsp;<span class="num" id="3167399">0x92</span><span class="op" id="3167403">,</span>&nbsp;<span class="num" id="3167405">0x93</span><span class="op" id="3167409">,</span>&nbsp;<span class="num" id="3167411">0x94</span><span class="op" id="3167415">,</span>&nbsp;<span class="num" id="3167417">0x95</span><span class="op" id="3167421">,</span>&nbsp;<span class="num" id="3167423">0x96</span><span class="op" id="3167427">,</span>&nbsp;<span class="num" id="3167429">0x97</span><span class="op" id="3167433">,</span>&nbsp;<span class="num" id="3167435">0x98</span><span class="op" id="3167439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167444">0x99</span><span class="op" id="3167448">,</span>&nbsp;<span class="num" id="3167450">0x9a</span><span class="op" id="3167454">,</span>&nbsp;<span class="num" id="3167456">0xa2</span><span class="op" id="3167460">,</span>&nbsp;<span class="num" id="3167462">0xa3</span><span class="op" id="3167466">,</span>&nbsp;<span class="num" id="3167468">0xa4</span><span class="op" id="3167472">,</span>&nbsp;<span class="num" id="3167474">0xa5</span><span class="op" id="3167478">,</span>&nbsp;<span class="num" id="3167480">0xa6</span><span class="op" id="3167484">,</span>&nbsp;<span class="num" id="3167486">0xa7</span><span class="op" id="3167490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167495">0xa8</span><span class="op" id="3167499">,</span>&nbsp;<span class="num" id="3167501">0xa9</span><span class="op" id="3167505">,</span>&nbsp;<span class="num" id="3167507">0xaa</span><span class="op" id="3167511">,</span>&nbsp;<span class="num" id="3167513">0xb2</span><span class="op" id="3167517">,</span>&nbsp;<span class="num" id="3167519">0xb3</span><span class="op" id="3167523">,</span>&nbsp;<span class="num" id="3167525">0xb4</span><span class="op" id="3167529">,</span>&nbsp;<span class="num" id="3167531">0xb5</span><span class="op" id="3167535">,</span>&nbsp;<span class="num" id="3167537">0xb6</span><span class="op" id="3167541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167546">0xb7</span><span class="op" id="3167550">,</span>&nbsp;<span class="num" id="3167552">0xb8</span><span class="op" id="3167556">,</span>&nbsp;<span class="num" id="3167558">0xb9</span><span class="op" id="3167562">,</span>&nbsp;<span class="num" id="3167564">0xba</span><span class="op" id="3167568">,</span>&nbsp;<span class="num" id="3167570">0xc2</span><span class="op" id="3167574">,</span>&nbsp;<span class="num" id="3167576">0xc3</span><span class="op" id="3167580">,</span>&nbsp;<span class="num" id="3167582">0xc4</span><span class="op" id="3167586">,</span>&nbsp;<span class="num" id="3167588">0xc5</span><span class="op" id="3167592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167597">0xc6</span><span class="op" id="3167601">,</span>&nbsp;<span class="num" id="3167603">0xc7</span><span class="op" id="3167607">,</span>&nbsp;<span class="num" id="3167609">0xc8</span><span class="op" id="3167613">,</span>&nbsp;<span class="num" id="3167615">0xc9</span><span class="op" id="3167619">,</span>&nbsp;<span class="num" id="3167621">0xca</span><span class="op" id="3167625">,</span>&nbsp;<span class="num" id="3167627">0xd2</span><span class="op" id="3167631">,</span>&nbsp;<span class="num" id="3167633">0xd3</span><span class="op" id="3167637">,</span>&nbsp;<span class="num" id="3167639">0xd4</span><span class="op" id="3167643">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167648">0xd5</span><span class="op" id="3167652">,</span>&nbsp;<span class="num" id="3167654">0xd6</span><span class="op" id="3167658">,</span>&nbsp;<span class="num" id="3167660">0xd7</span><span class="op" id="3167664">,</span>&nbsp;<span class="num" id="3167666">0xd8</span><span class="op" id="3167670">,</span>&nbsp;<span class="num" id="3167672">0xd9</span><span class="op" id="3167676">,</span>&nbsp;<span class="num" id="3167678">0xda</span><span class="op" id="3167682">,</span>&nbsp;<span class="num" id="3167684">0xe1</span><span class="op" id="3167688">,</span>&nbsp;<span class="num" id="3167690">0xe2</span><span class="op" id="3167694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167699">0xe3</span><span class="op" id="3167703">,</span>&nbsp;<span class="num" id="3167705">0xe4</span><span class="op" id="3167709">,</span>&nbsp;<span class="num" id="3167711">0xe5</span><span class="op" id="3167715">,</span>&nbsp;<span class="num" id="3167717">0xe6</span><span class="op" id="3167721">,</span>&nbsp;<span class="num" id="3167723">0xe7</span><span class="op" id="3167727">,</span>&nbsp;<span class="num" id="3167729">0xe8</span><span class="op" id="3167733">,</span>&nbsp;<span class="num" id="3167735">0xe9</span><span class="op" id="3167739">,</span>&nbsp;<span class="num" id="3167741">0xea</span><span class="op" id="3167745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167750">0xf1</span><span class="op" id="3167754">,</span>&nbsp;<span class="num" id="3167756">0xf2</span><span class="op" id="3167760">,</span>&nbsp;<span class="num" id="3167762">0xf3</span><span class="op" id="3167766">,</span>&nbsp;<span class="num" id="3167768">0xf4</span><span class="op" id="3167772">,</span>&nbsp;<span class="num" id="3167774">0xf5</span><span class="op" id="3167778">,</span>&nbsp;<span class="num" id="3167780">0xf6</span><span class="op" id="3167784">,</span>&nbsp;<span class="num" id="3167786">0xf7</span><span class="op" id="3167790">,</span>&nbsp;<span class="num" id="3167792">0xf8</span><span class="op" id="3167796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3167801">0xf9</span><span class="op" id="3167805">,</span>&nbsp;<span class="num" id="3167807">0xfa</span><span class="op" id="3167811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167815">}</span><span class="op" id="3167816">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167819">}</span><span class="op" id="3167820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167823">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167847">[</span><span class="num" id="3167848">16</span><span class="op" id="3167850">]</span><span class="builtintype" id="3167851">byte</span><span class="op" id="3167855">{</span><span class="num" id="3167856">0</span><span class="op" id="3167857">,</span>&nbsp;<span class="num" id="3167859">3</span><span class="op" id="3167860">,</span>&nbsp;<span class="num" id="3167862">1</span><span class="op" id="3167863">,</span>&nbsp;<span class="num" id="3167865">1</span><span class="op" id="3167866">,</span>&nbsp;<span class="num" id="3167868">1</span><span class="op" id="3167869">,</span>&nbsp;<span class="num" id="3167871">1</span><span class="op" id="3167872">,</span>&nbsp;<span class="num" id="3167874">1</span><span class="op" id="3167875">,</span>&nbsp;<span class="num" id="3167877">1</span><span class="op" id="3167878">,</span>&nbsp;<span class="num" id="3167880">1</span><span class="op" id="3167881">,</span>&nbsp;<span class="num" id="3167883">1</span><span class="op" id="3167884">,</span>&nbsp;<span class="num" id="3167886">1</span><span class="op" id="3167887">,</span>&nbsp;<span class="num" id="3167889">0</span><span class="op" id="3167890">,</span>&nbsp;<span class="num" id="3167892">0</span><span class="op" id="3167893">,</span>&nbsp;<span class="num" id="3167895">0</span><span class="op" id="3167896">,</span>&nbsp;<span class="num" id="3167898">0</span><span class="op" id="3167899">,</span>&nbsp;<span class="num" id="3167901">0</span><span class="op" id="3167902">}</span><span class="op" id="3167903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167907">[</span><span class="op" id="3167908">]</span><span class="builtintype" id="3167909">byte</span><span class="op" id="3167913">{</span><span class="num" id="3167914">0</span><span class="op" id="3167915">,</span>&nbsp;<span class="num" id="3167917">1</span><span class="op" id="3167918">,</span>&nbsp;<span class="num" id="3167920">2</span><span class="op" id="3167921">,</span>&nbsp;<span class="num" id="3167923">3</span><span class="op" id="3167924">,</span>&nbsp;<span class="num" id="3167926">4</span><span class="op" id="3167927">,</span>&nbsp;<span class="num" id="3167929">5</span><span class="op" id="3167930">,</span>&nbsp;<span class="num" id="3167932">6</span><span class="op" id="3167933">,</span>&nbsp;<span class="num" id="3167935">7</span><span class="op" id="3167936">,</span>&nbsp;<span class="num" id="3167938">8</span><span class="op" id="3167939">,</span>&nbsp;<span class="num" id="3167941">9</span><span class="op" id="3167942">,</span>&nbsp;<span class="num" id="3167944">10</span><span class="op" id="3167946">,</span>&nbsp;<span class="num" id="3167948">11</span><span class="op" id="3167950">}</span><span class="op" id="3167951">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167954">}</span><span class="op" id="3167955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167958">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167982">[</span><span class="num" id="3167983">16</span><span class="op" id="3167985">]</span><span class="builtintype" id="3167986">byte</span><span class="op" id="3167990">{</span><span class="num" id="3167991">0</span><span class="op" id="3167992">,</span>&nbsp;<span class="num" id="3167994">2</span><span class="op" id="3167995">,</span>&nbsp;<span class="num" id="3167997">1</span><span class="op" id="3167998">,</span>&nbsp;<span class="num" id="3168000">2</span><span class="op" id="3168001">,</span>&nbsp;<span class="num" id="3168003">4</span><span class="op" id="3168004">,</span>&nbsp;<span class="num" id="3168006">4</span><span class="op" id="3168007">,</span>&nbsp;<span class="num" id="3168009">3</span><span class="op" id="3168010">,</span>&nbsp;<span class="num" id="3168012">4</span><span class="op" id="3168013">,</span>&nbsp;<span class="num" id="3168015">7</span><span class="op" id="3168016">,</span>&nbsp;<span class="num" id="3168018">5</span><span class="op" id="3168019">,</span>&nbsp;<span class="num" id="3168021">4</span><span class="op" id="3168022">,</span>&nbsp;<span class="num" id="3168024">4</span><span class="op" id="3168025">,</span>&nbsp;<span class="num" id="3168027">0</span><span class="op" id="3168028">,</span>&nbsp;<span class="num" id="3168030">1</span><span class="op" id="3168031">,</span>&nbsp;<span class="num" id="3168033">2</span><span class="op" id="3168034">,</span>&nbsp;<span class="num" id="3168036">119</span><span class="op" id="3168039">}</span><span class="op" id="3168040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168044">[</span><span class="op" id="3168045">]</span><span class="builtintype" id="3168046">byte</span><span class="op" id="3168050">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168055">0x00</span><span class="op" id="3168059">,</span>&nbsp;<span class="num" id="3168061">0x01</span><span class="op" id="3168065">,</span>&nbsp;<span class="num" id="3168067">0x02</span><span class="op" id="3168071">,</span>&nbsp;<span class="num" id="3168073">0x03</span><span class="op" id="3168077">,</span>&nbsp;<span class="num" id="3168079">0x11</span><span class="op" id="3168083">,</span>&nbsp;<span class="num" id="3168085">0x04</span><span class="op" id="3168089">,</span>&nbsp;<span class="num" id="3168091">0x05</span><span class="op" id="3168095">,</span>&nbsp;<span class="num" id="3168097">0x21</span><span class="op" id="3168101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168106">0x31</span><span class="op" id="3168110">,</span>&nbsp;<span class="num" id="3168112">0x06</span><span class="op" id="3168116">,</span>&nbsp;<span class="num" id="3168118">0x12</span><span class="op" id="3168122">,</span>&nbsp;<span class="num" id="3168124">0x41</span><span class="op" id="3168128">,</span>&nbsp;<span class="num" id="3168130">0x51</span><span class="op" id="3168134">,</span>&nbsp;<span class="num" id="3168136">0x07</span><span class="op" id="3168140">,</span>&nbsp;<span class="num" id="3168142">0x61</span><span class="op" id="3168146">,</span>&nbsp;<span class="num" id="3168148">0x71</span><span class="op" id="3168152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168157">0x13</span><span class="op" id="3168161">,</span>&nbsp;<span class="num" id="3168163">0x22</span><span class="op" id="3168167">,</span>&nbsp;<span class="num" id="3168169">0x32</span><span class="op" id="3168173">,</span>&nbsp;<span class="num" id="3168175">0x81</span><span class="op" id="3168179">,</span>&nbsp;<span class="num" id="3168181">0x08</span><span class="op" id="3168185">,</span>&nbsp;<span class="num" id="3168187">0x14</span><span class="op" id="3168191">,</span>&nbsp;<span class="num" id="3168193">0x42</span><span class="op" id="3168197">,</span>&nbsp;<span class="num" id="3168199">0x91</span><span class="op" id="3168203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168208">0xa1</span><span class="op" id="3168212">,</span>&nbsp;<span class="num" id="3168214">0xb1</span><span class="op" id="3168218">,</span>&nbsp;<span class="num" id="3168220">0xc1</span><span class="op" id="3168224">,</span>&nbsp;<span class="num" id="3168226">0x09</span><span class="op" id="3168230">,</span>&nbsp;<span class="num" id="3168232">0x23</span><span class="op" id="3168236">,</span>&nbsp;<span class="num" id="3168238">0x33</span><span class="op" id="3168242">,</span>&nbsp;<span class="num" id="3168244">0x52</span><span class="op" id="3168248">,</span>&nbsp;<span class="num" id="3168250">0xf0</span><span class="op" id="3168254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168259">0x15</span><span class="op" id="3168263">,</span>&nbsp;<span class="num" id="3168265">0x62</span><span class="op" id="3168269">,</span>&nbsp;<span class="num" id="3168271">0x72</span><span class="op" id="3168275">,</span>&nbsp;<span class="num" id="3168277">0xd1</span><span class="op" id="3168281">,</span>&nbsp;<span class="num" id="3168283">0x0a</span><span class="op" id="3168287">,</span>&nbsp;<span class="num" id="3168289">0x16</span><span class="op" id="3168293">,</span>&nbsp;<span class="num" id="3168295">0x24</span><span class="op" id="3168299">,</span>&nbsp;<span class="num" id="3168301">0x34</span><span class="op" id="3168305">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168310">0xe1</span><span class="op" id="3168314">,</span>&nbsp;<span class="num" id="3168316">0x25</span><span class="op" id="3168320">,</span>&nbsp;<span class="num" id="3168322">0xf1</span><span class="op" id="3168326">,</span>&nbsp;<span class="num" id="3168328">0x17</span><span class="op" id="3168332">,</span>&nbsp;<span class="num" id="3168334">0x18</span><span class="op" id="3168338">,</span>&nbsp;<span class="num" id="3168340">0x19</span><span class="op" id="3168344">,</span>&nbsp;<span class="num" id="3168346">0x1a</span><span class="op" id="3168350">,</span>&nbsp;<span class="num" id="3168352">0x26</span><span class="op" id="3168356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168361">0x27</span><span class="op" id="3168365">,</span>&nbsp;<span class="num" id="3168367">0x28</span><span class="op" id="3168371">,</span>&nbsp;<span class="num" id="3168373">0x29</span><span class="op" id="3168377">,</span>&nbsp;<span class="num" id="3168379">0x2a</span><span class="op" id="3168383">,</span>&nbsp;<span class="num" id="3168385">0x35</span><span class="op" id="3168389">,</span>&nbsp;<span class="num" id="3168391">0x36</span><span class="op" id="3168395">,</span>&nbsp;<span class="num" id="3168397">0x37</span><span class="op" id="3168401">,</span>&nbsp;<span class="num" id="3168403">0x38</span><span class="op" id="3168407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168412">0x39</span><span class="op" id="3168416">,</span>&nbsp;<span class="num" id="3168418">0x3a</span><span class="op" id="3168422">,</span>&nbsp;<span class="num" id="3168424">0x43</span><span class="op" id="3168428">,</span>&nbsp;<span class="num" id="3168430">0x44</span><span class="op" id="3168434">,</span>&nbsp;<span class="num" id="3168436">0x45</span><span class="op" id="3168440">,</span>&nbsp;<span class="num" id="3168442">0x46</span><span class="op" id="3168446">,</span>&nbsp;<span class="num" id="3168448">0x47</span><span class="op" id="3168452">,</span>&nbsp;<span class="num" id="3168454">0x48</span><span class="op" id="3168458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168463">0x49</span><span class="op" id="3168467">,</span>&nbsp;<span class="num" id="3168469">0x4a</span><span class="op" id="3168473">,</span>&nbsp;<span class="num" id="3168475">0x53</span><span class="op" id="3168479">,</span>&nbsp;<span class="num" id="3168481">0x54</span><span class="op" id="3168485">,</span>&nbsp;<span class="num" id="3168487">0x55</span><span class="op" id="3168491">,</span>&nbsp;<span class="num" id="3168493">0x56</span><span class="op" id="3168497">,</span>&nbsp;<span class="num" id="3168499">0x57</span><span class="op" id="3168503">,</span>&nbsp;<span class="num" id="3168505">0x58</span><span class="op" id="3168509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168514">0x59</span><span class="op" id="3168518">,</span>&nbsp;<span class="num" id="3168520">0x5a</span><span class="op" id="3168524">,</span>&nbsp;<span class="num" id="3168526">0x63</span><span class="op" id="3168530">,</span>&nbsp;<span class="num" id="3168532">0x64</span><span class="op" id="3168536">,</span>&nbsp;<span class="num" id="3168538">0x65</span><span class="op" id="3168542">,</span>&nbsp;<span class="num" id="3168544">0x66</span><span class="op" id="3168548">,</span>&nbsp;<span class="num" id="3168550">0x67</span><span class="op" id="3168554">,</span>&nbsp;<span class="num" id="3168556">0x68</span><span class="op" id="3168560">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168565">0x69</span><span class="op" id="3168569">,</span>&nbsp;<span class="num" id="3168571">0x6a</span><span class="op" id="3168575">,</span>&nbsp;<span class="num" id="3168577">0x73</span><span class="op" id="3168581">,</span>&nbsp;<span class="num" id="3168583">0x74</span><span class="op" id="3168587">,</span>&nbsp;<span class="num" id="3168589">0x75</span><span class="op" id="3168593">,</span>&nbsp;<span class="num" id="3168595">0x76</span><span class="op" id="3168599">,</span>&nbsp;<span class="num" id="3168601">0x77</span><span class="op" id="3168605">,</span>&nbsp;<span class="num" id="3168607">0x78</span><span class="op" id="3168611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168616">0x79</span><span class="op" id="3168620">,</span>&nbsp;<span class="num" id="3168622">0x7a</span><span class="op" id="3168626">,</span>&nbsp;<span class="num" id="3168628">0x82</span><span class="op" id="3168632">,</span>&nbsp;<span class="num" id="3168634">0x83</span><span class="op" id="3168638">,</span>&nbsp;<span class="num" id="3168640">0x84</span><span class="op" id="3168644">,</span>&nbsp;<span class="num" id="3168646">0x85</span><span class="op" id="3168650">,</span>&nbsp;<span class="num" id="3168652">0x86</span><span class="op" id="3168656">,</span>&nbsp;<span class="num" id="3168658">0x87</span><span class="op" id="3168662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168667">0x88</span><span class="op" id="3168671">,</span>&nbsp;<span class="num" id="3168673">0x89</span><span class="op" id="3168677">,</span>&nbsp;<span class="num" id="3168679">0x8a</span><span class="op" id="3168683">,</span>&nbsp;<span class="num" id="3168685">0x92</span><span class="op" id="3168689">,</span>&nbsp;<span class="num" id="3168691">0x93</span><span class="op" id="3168695">,</span>&nbsp;<span class="num" id="3168697">0x94</span><span class="op" id="3168701">,</span>&nbsp;<span class="num" id="3168703">0x95</span><span class="op" id="3168707">,</span>&nbsp;<span class="num" id="3168709">0x96</span><span class="op" id="3168713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168718">0x97</span><span class="op" id="3168722">,</span>&nbsp;<span class="num" id="3168724">0x98</span><span class="op" id="3168728">,</span>&nbsp;<span class="num" id="3168730">0x99</span><span class="op" id="3168734">,</span>&nbsp;<span class="num" id="3168736">0x9a</span><span class="op" id="3168740">,</span>&nbsp;<span class="num" id="3168742">0xa2</span><span class="op" id="3168746">,</span>&nbsp;<span class="num" id="3168748">0xa3</span><span class="op" id="3168752">,</span>&nbsp;<span class="num" id="3168754">0xa4</span><span class="op" id="3168758">,</span>&nbsp;<span class="num" id="3168760">0xa5</span><span class="op" id="3168764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168769">0xa6</span><span class="op" id="3168773">,</span>&nbsp;<span class="num" id="3168775">0xa7</span><span class="op" id="3168779">,</span>&nbsp;<span class="num" id="3168781">0xa8</span><span class="op" id="3168785">,</span>&nbsp;<span class="num" id="3168787">0xa9</span><span class="op" id="3168791">,</span>&nbsp;<span class="num" id="3168793">0xaa</span><span class="op" id="3168797">,</span>&nbsp;<span class="num" id="3168799">0xb2</span><span class="op" id="3168803">,</span>&nbsp;<span class="num" id="3168805">0xb3</span><span class="op" id="3168809">,</span>&nbsp;<span class="num" id="3168811">0xb4</span><span class="op" id="3168815">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168820">0xb5</span><span class="op" id="3168824">,</span>&nbsp;<span class="num" id="3168826">0xb6</span><span class="op" id="3168830">,</span>&nbsp;<span class="num" id="3168832">0xb7</span><span class="op" id="3168836">,</span>&nbsp;<span class="num" id="3168838">0xb8</span><span class="op" id="3168842">,</span>&nbsp;<span class="num" id="3168844">0xb9</span><span class="op" id="3168848">,</span>&nbsp;<span class="num" id="3168850">0xba</span><span class="op" id="3168854">,</span>&nbsp;<span class="num" id="3168856">0xc2</span><span class="op" id="3168860">,</span>&nbsp;<span class="num" id="3168862">0xc3</span><span class="op" id="3168866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168871">0xc4</span><span class="op" id="3168875">,</span>&nbsp;<span class="num" id="3168877">0xc5</span><span class="op" id="3168881">,</span>&nbsp;<span class="num" id="3168883">0xc6</span><span class="op" id="3168887">,</span>&nbsp;<span class="num" id="3168889">0xc7</span><span class="op" id="3168893">,</span>&nbsp;<span class="num" id="3168895">0xc8</span><span class="op" id="3168899">,</span>&nbsp;<span class="num" id="3168901">0xc9</span><span class="op" id="3168905">,</span>&nbsp;<span class="num" id="3168907">0xca</span><span class="op" id="3168911">,</span>&nbsp;<span class="num" id="3168913">0xd2</span><span class="op" id="3168917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168922">0xd3</span><span class="op" id="3168926">,</span>&nbsp;<span class="num" id="3168928">0xd4</span><span class="op" id="3168932">,</span>&nbsp;<span class="num" id="3168934">0xd5</span><span class="op" id="3168938">,</span>&nbsp;<span class="num" id="3168940">0xd6</span><span class="op" id="3168944">,</span>&nbsp;<span class="num" id="3168946">0xd7</span><span class="op" id="3168950">,</span>&nbsp;<span class="num" id="3168952">0xd8</span><span class="op" id="3168956">,</span>&nbsp;<span class="num" id="3168958">0xd9</span><span class="op" id="3168962">,</span>&nbsp;<span class="num" id="3168964">0xda</span><span class="op" id="3168968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3168973">0xe2</span><span class="op" id="3168977">,</span>&nbsp;<span class="num" id="3168979">0xe3</span><span class="op" id="3168983">,</span>&nbsp;<span class="num" id="3168985">0xe4</span><span class="op" id="3168989">,</span>&nbsp;<span class="num" id="3168991">0xe5</span><span class="op" id="3168995">,</span>&nbsp;<span class="num" id="3168997">0xe6</span><span class="op" id="3169001">,</span>&nbsp;<span class="num" id="3169003">0xe7</span><span class="op" id="3169007">,</span>&nbsp;<span class="num" id="3169009">0xe8</span><span class="op" id="3169013">,</span>&nbsp;<span class="num" id="3169015">0xe9</span><span class="op" id="3169019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3169024">0xea</span><span class="op" id="3169028">,</span>&nbsp;<span class="num" id="3169030">0xf2</span><span class="op" id="3169034">,</span>&nbsp;<span class="num" id="3169036">0xf3</span><span class="op" id="3169040">,</span>&nbsp;<span class="num" id="3169042">0xf4</span><span class="op" id="3169046">,</span>&nbsp;<span class="num" id="3169048">0xf5</span><span class="op" id="3169052">,</span>&nbsp;<span class="num" id="3169054">0xf6</span><span class="op" id="3169058">,</span>&nbsp;<span class="num" id="3169060">0xf7</span><span class="op" id="3169064">,</span>&nbsp;<span class="num" id="3169066">0xf8</span><span class="op" id="3169070">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3169075">0xf9</span><span class="op" id="3169079">,</span>&nbsp;<span class="num" id="3169081">0xfa</span><span class="op" id="3169085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169089">}</span><span class="op" id="3169090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169093">}</span><span class="op" id="3169094">,</span><br>
<span class="lineno"></span><span class="op" id="3169096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3169099">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="3169174">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3169251">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="3169329">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="3169370">type</span>&nbsp;<span class="ident" id="3169375">huffmanLUT</span>&nbsp;<span class="op" id="3169386">[</span><span class="op" id="3169387">]</span><span class="builtintype" id="3169388">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3169396">func</span>&nbsp;<span class="op" id="3169401">(</span><span class="ident" id="3169402">h</span>&nbsp;<span class="op" id="3169404">*</span><span class="ident" id="3169405"><a href="/image/jpeg/writer.go.html#3169375">huffmanLUT</a></span><span class="op" id="3169415">)</span>&nbsp;<span class="ident" id="3169417">init</span><span class="op" id="3169421">(</span><span class="ident" id="3169422">s</span>&nbsp;<span class="ident" id="3169424"><a href="/image/jpeg/writer.go.html#3166221">huffmanSpec</a></span><span class="op" id="3169435">)</span>&nbsp;<span class="op" id="3169437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169440">maxValue</span>&nbsp;<span class="op" id="3169449">:=</span>&nbsp;<span class="num" id="3169452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169455">for</span>&nbsp;<span class="ident" id="3169459">_</span><span class="op" id="3169460">,</span>&nbsp;<span class="ident" id="3169462">v</span>&nbsp;<span class="op" id="3169464">:=</span>&nbsp;<span class="keyword" id="3169467">range</span>&nbsp;<span class="ident" id="3169473"><a href="/image/jpeg/writer.go.html#3169422">s</a></span><span class="op" id="3169474">.</span><span class="ident" id="3169475">value</span>&nbsp;<span class="op" id="3169481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169485">if</span>&nbsp;<span class="builtintype" id="3169488">int</span><span class="op" id="3169491">(</span><span class="ident" id="3169492"><a href="/image/jpeg/writer.go.html#3169462">v</a></span><span class="op" id="3169493">)</span>&nbsp;<span class="op" id="3169495">&gt;</span>&nbsp;<span class="ident" id="3169497"><a href="/image/jpeg/writer.go.html#3169440">maxValue</a></span>&nbsp;<span class="op" id="3169506">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169511"><a href="/image/jpeg/writer.go.html#3169440">maxValue</a></span>&nbsp;<span class="op" id="3169520">=</span>&nbsp;<span class="builtintype" id="3169522">int</span><span class="op" id="3169525">(</span><span class="ident" id="3169526"><a href="/image/jpeg/writer.go.html#3169462">v</a></span><span class="op" id="3169527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169537">*</span><span class="ident" id="3169538"><a href="/image/jpeg/writer.go.html#3169402">h</a></span>&nbsp;<span class="op" id="3169540">=</span>&nbsp;<span class="builtinfunc" id="3169542">make</span><span class="op" id="3169546">(</span><span class="op" id="3169547">[</span><span class="op" id="3169548">]</span><span class="builtintype" id="3169549">uint32</span><span class="op" id="3169555">,</span>&nbsp;<span class="ident" id="3169557"><a href="/image/jpeg/writer.go.html#3169440">maxValue</a></span><span class="op" id="3169565">+</span><span class="num" id="3169566">1</span><span class="op" id="3169567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169570">code</span><span class="op" id="3169574">,</span>&nbsp;<span class="ident" id="3169576">k</span>&nbsp;<span class="op" id="3169578">:=</span>&nbsp;<span class="builtintype" id="3169581">uint32</span><span class="op" id="3169587">(</span><span class="num" id="3169588">0</span><span class="op" id="3169589">)</span><span class="op" id="3169590">,</span>&nbsp;<span class="num" id="3169592">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169595">for</span>&nbsp;<span class="ident" id="3169599">i</span>&nbsp;<span class="op" id="3169601">:=</span>&nbsp;<span class="num" id="3169604">0</span><span class="op" id="3169605">;</span>&nbsp;<span class="ident" id="3169607"><a href="/image/jpeg/writer.go.html#3169599">i</a></span>&nbsp;<span class="op" id="3169609">&lt;</span>&nbsp;<span class="builtinfunc" id="3169611">len</span><span class="op" id="3169614">(</span><span class="ident" id="3169615"><a href="/image/jpeg/writer.go.html#3169422">s</a></span><span class="op" id="3169616">.</span><span class="ident" id="3169617">count</span><span class="op" id="3169622">)</span><span class="op" id="3169623">;</span>&nbsp;<span class="ident" id="3169625"><a href="/image/jpeg/writer.go.html#3169599">i</a></span><span class="op" id="3169626">++</span>&nbsp;<span class="op" id="3169629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169633">nBits</span>&nbsp;<span class="op" id="3169639">:=</span>&nbsp;<span class="builtintype" id="3169642">uint32</span><span class="op" id="3169648">(</span><span class="ident" id="3169649"><a href="/image/jpeg/writer.go.html#3169599">i</a></span><span class="op" id="3169650">+</span><span class="num" id="3169651">1</span><span class="op" id="3169652">)</span>&nbsp;<span class="op" id="3169654">&lt;&lt;</span>&nbsp;<span class="num" id="3169657">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169662">for</span>&nbsp;<span class="ident" id="3169666">j</span>&nbsp;<span class="op" id="3169668">:=</span>&nbsp;<span class="builtintype" id="3169671">uint8</span><span class="op" id="3169676">(</span><span class="num" id="3169677">0</span><span class="op" id="3169678">)</span><span class="op" id="3169679">;</span>&nbsp;<span class="ident" id="3169681"><a href="/image/jpeg/writer.go.html#3169666">j</a></span>&nbsp;<span class="op" id="3169683">&lt;</span>&nbsp;<span class="ident" id="3169685"><a href="/image/jpeg/writer.go.html#3169422">s</a></span><span class="op" id="3169686">.</span><span class="ident" id="3169687">count</span><span class="op" id="3169692">[</span><span class="ident" id="3169693"><a href="/image/jpeg/writer.go.html#3169599">i</a></span><span class="op" id="3169694">]</span><span class="op" id="3169695">;</span>&nbsp;<span class="ident" id="3169697"><a href="/image/jpeg/writer.go.html#3169666">j</a></span><span class="op" id="3169698">++</span>&nbsp;<span class="op" id="3169701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169706">(</span><span class="op" id="3169707">*</span><span class="ident" id="3169708"><a href="/image/jpeg/writer.go.html#3169402">h</a></span><span class="op" id="3169709">)</span><span class="op" id="3169710">[</span><span class="ident" id="3169711"><a href="/image/jpeg/writer.go.html#3169422">s</a></span><span class="op" id="3169712">.</span><span class="ident" id="3169713">value</span><span class="op" id="3169718">[</span><span class="ident" id="3169719"><a href="/image/jpeg/writer.go.html#3169576">k</a></span><span class="op" id="3169720">]</span><span class="op" id="3169721">]</span>&nbsp;<span class="op" id="3169723">=</span>&nbsp;<span class="ident" id="3169725"><a href="/image/jpeg/writer.go.html#3169633">nBits</a></span>&nbsp;<span class="op" id="3169731">|</span>&nbsp;<span class="ident" id="3169733"><a href="/image/jpeg/writer.go.html#3169570">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169741"><a href="/image/jpeg/writer.go.html#3169570">code</a></span><span class="op" id="3169745">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169751"><a href="/image/jpeg/writer.go.html#3169576">k</a></span><span class="op" id="3169752">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169761"><a href="/image/jpeg/writer.go.html#3169570">code</a></span>&nbsp;<span class="op" id="3169766">&lt;&lt;=</span>&nbsp;<span class="num" id="3169770">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169773">}</span><br>
<span class="lineno"></span><span class="op" id="3169775">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3169778">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="3169843">var</span>&nbsp;<span class="ident" id="3169847">theHuffmanLUT</span>&nbsp;<span class="op" id="3169861">[</span><span class="num" id="3169862">4</span><span class="op" id="3169863">]</span><span class="ident" id="3169864"><a href="/image/jpeg/writer.go.html#3169375">huffmanLUT</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3169876">func</span>&nbsp;<span class="ident" id="3169881">init</span><span class="op" id="3169885">(</span><span class="op" id="3169886">)</span>&nbsp;<span class="op" id="3169888">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169891">for</span>&nbsp;<span class="ident" id="3169895">i</span><span class="op" id="3169896">,</span>&nbsp;<span class="ident" id="3169898">s</span>&nbsp;<span class="op" id="3169900">:=</span>&nbsp;<span class="keyword" id="3169903">range</span>&nbsp;<span class="ident" id="3169909"><a href="/image/jpeg/writer.go.html#3166510">theHuffmanSpec</a></span>&nbsp;<span class="op" id="3169924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169928"><a href="/image/jpeg/writer.go.html#3169847">theHuffmanLUT</a></span><span class="op" id="3169941">[</span><span class="ident" id="3169942"><a href="/image/jpeg/writer.go.html#3169895">i</a></span><span class="op" id="3169943">]</span><span class="op" id="3169944">.</span><span class="ident" id="3169945">init</span><span class="op" id="3169949">(</span><span class="ident" id="3169950"><a href="/image/jpeg/writer.go.html#3169898">s</a></span><span class="op" id="3169951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169954">}</span><br>
<span class="lineno"></span><span class="op" id="3169956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3169959">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3169991">type</span>&nbsp;<span class="ident" id="3169996">writer</span>&nbsp;<span class="keyword" id="3170003">interface</span>&nbsp;<span class="op" id="3170013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170016">Flush</span><span class="op" id="3170021">(</span><span class="op" id="3170022">)</span>&nbsp;<span class="builtintype" id="3170024">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170031"><a href="/image/jpeg/writer.go.html#3163831">io</a></span><span class="op" id="3170033">.</span><span class="ident" id="3170034">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170042"><a href="/image/jpeg/writer.go.html#3163831">io</a></span><span class="op" id="3170044">.</span><span class="ident" id="3170045">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="3170056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3170059">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="3170107">type</span>&nbsp;<span class="ident" id="3170112">encoder</span>&nbsp;<span class="keyword" id="3170120">struct</span>&nbsp;<span class="op" id="3170127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170130">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170205">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170276">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3170280"><a href="/image/jpeg/writer.go.html#3169996">writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170288">err</span>&nbsp;<span class="builtintype" id="3170292">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170299">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170328">buf</span>&nbsp;<span class="op" id="3170332">[</span><span class="num" id="3170333">16</span><span class="op" id="3170335">]</span><span class="builtintype" id="3170336">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170342">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170397">bits</span><span class="op" id="3170401">,</span>&nbsp;<span class="ident" id="3170403">nBits</span>&nbsp;<span class="builtintype" id="3170409">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170417">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170480">quant</span>&nbsp;<span class="op" id="3170486">[</span><span class="ident" id="3170487"><a href="/image/jpeg/writer.go.html#3165103">nQuantIndex</a></span><span class="op" id="3170498">]</span><span class="op" id="3170499">[</span><span class="ident" id="3170500"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3170509">]</span><span class="builtintype" id="3170510">byte</span><br>
<span class="lineno"></span><span class="op" id="3170515">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="3170518">func</span>&nbsp;<span class="op" id="3170523">(</span><span class="ident" id="3170524">e</span>&nbsp;<span class="op" id="3170526">*</span><span class="ident" id="3170527"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3170534">)</span>&nbsp;<span class="ident" id="3170536">flush</span><span class="op" id="3170541">(</span><span class="op" id="3170542">)</span>&nbsp;<span class="op" id="3170544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170547">if</span>&nbsp;<span class="ident" id="3170550"><a href="/image/jpeg/writer.go.html#3170524">e</a></span><span class="op" id="3170551">.</span><span class="ident" id="3170552">err</span>&nbsp;<span class="op" id="3170556">!=</span>&nbsp;<span class="ident" id="3170559">nil</span>&nbsp;<span class="op" id="3170563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170567">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170575">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170578"><a href="/image/jpeg/writer.go.html#3170524">e</a></span><span class="op" id="3170579">.</span><span class="ident" id="3170580">err</span>&nbsp;<span class="op" id="3170584">=</span>&nbsp;<span class="ident" id="3170586"><a href="/image/jpeg/writer.go.html#3170524">e</a></span><span class="op" id="3170587">.</span><span class="ident" id="3170588">w</span><span class="op" id="3170589">.</span><span class="ident" id="3170590">Flush</span><span class="op" id="3170595">(</span><span class="op" id="3170596">)</span><br>
<span class="lineno"></span><span class="op" id="3170598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3170601">func</span>&nbsp;<span class="op" id="3170606">(</span><span class="ident" id="3170607">e</span>&nbsp;<span class="op" id="3170609">*</span><span class="ident" id="3170610"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3170617">)</span>&nbsp;<span class="ident" id="3170619">write</span><span class="op" id="3170624">(</span><span class="ident" id="3170625">p</span>&nbsp;<span class="op" id="3170627">[</span><span class="op" id="3170628">]</span><span class="builtintype" id="3170629">byte</span><span class="op" id="3170633">)</span>&nbsp;<span class="op" id="3170635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170638">if</span>&nbsp;<span class="ident" id="3170641"><a href="/image/jpeg/writer.go.html#3170607">e</a></span><span class="op" id="3170642">.</span><span class="ident" id="3170643">err</span>&nbsp;<span class="op" id="3170647">!=</span>&nbsp;<span class="ident" id="3170650">nil</span>&nbsp;<span class="op" id="3170654">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170658">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170669">_</span><span class="op" id="3170670">,</span>&nbsp;<span class="ident" id="3170672"><a href="/image/jpeg/writer.go.html#3170607">e</a></span><span class="op" id="3170673">.</span><span class="ident" id="3170674">err</span>&nbsp;<span class="op" id="3170678">=</span>&nbsp;<span class="ident" id="3170680"><a href="/image/jpeg/writer.go.html#3170607">e</a></span><span class="op" id="3170681">.</span><span class="ident" id="3170682">w</span><span class="op" id="3170683">.</span><span class="ident" id="3170684">Write</span><span class="op" id="3170689">(</span><span class="ident" id="3170690"><a href="/image/jpeg/writer.go.html#3170625">p</a></span><span class="op" id="3170691">)</span><br>
<span class="lineno"></span><span class="op" id="3170693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="3170696">func</span>&nbsp;<span class="op" id="3170701">(</span><span class="ident" id="3170702">e</span>&nbsp;<span class="op" id="3170704">*</span><span class="ident" id="3170705"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3170712">)</span>&nbsp;<span class="ident" id="3170714">writeByte</span><span class="op" id="3170723">(</span><span class="ident" id="3170724">b</span>&nbsp;<span class="builtintype" id="3170726">byte</span><span class="op" id="3170730">)</span>&nbsp;<span class="op" id="3170732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170735">if</span>&nbsp;<span class="ident" id="3170738"><a href="/image/jpeg/writer.go.html#3170702">e</a></span><span class="op" id="3170739">.</span><span class="ident" id="3170740">err</span>&nbsp;<span class="op" id="3170744">!=</span>&nbsp;<span class="ident" id="3170747">nil</span>&nbsp;<span class="op" id="3170751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170755">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170766"><a href="/image/jpeg/writer.go.html#3170702">e</a></span><span class="op" id="3170767">.</span><span class="ident" id="3170768">err</span>&nbsp;<span class="op" id="3170772">=</span>&nbsp;<span class="ident" id="3170774"><a href="/image/jpeg/writer.go.html#3170702">e</a></span><span class="op" id="3170775">.</span><span class="ident" id="3170776">w</span><span class="op" id="3170777">.</span><span class="ident" id="3170778">WriteByte</span><span class="op" id="3170787">(</span><span class="ident" id="3170788"><a href="/image/jpeg/writer.go.html#3170724">b</a></span><span class="op" id="3170789">)</span><br>
<span class="lineno">250</span><span class="op" id="3170791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3170794">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="3170868">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="3170923">func</span>&nbsp;<span class="op" id="3170928">(</span><span class="ident" id="3170929">e</span>&nbsp;<span class="op" id="3170931">*</span><span class="ident" id="3170932"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3170939">)</span>&nbsp;<span class="ident" id="3170941">emit</span><span class="op" id="3170945">(</span><span class="ident" id="3170946">bits</span><span class="op" id="3170950">,</span>&nbsp;<span class="ident" id="3170952">nBits</span>&nbsp;<span class="builtintype" id="3170958">uint32</span><span class="op" id="3170964">)</span>&nbsp;<span class="op" id="3170966">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170969"><a href="/image/jpeg/writer.go.html#3170952">nBits</a></span>&nbsp;<span class="op" id="3170975">+=</span>&nbsp;<span class="ident" id="3170978"><a href="/image/jpeg/writer.go.html#3170929">e</a></span><span class="op" id="3170979">.</span><span class="ident" id="3170980">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170987"><a href="/image/jpeg/writer.go.html#3170946">bits</a></span>&nbsp;<span class="op" id="3170992">&lt;&lt;=</span>&nbsp;<span class="num" id="3170996">32</span>&nbsp;<span class="op" id="3170999">-</span>&nbsp;<span class="ident" id="3171001"><a href="/image/jpeg/writer.go.html#3170952">nBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171008"><a href="/image/jpeg/writer.go.html#3170946">bits</a></span>&nbsp;<span class="op" id="3171013">|=</span>&nbsp;<span class="ident" id="3171016"><a href="/image/jpeg/writer.go.html#3170929">e</a></span><span class="op" id="3171017">.</span><span class="ident" id="3171018">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171024">for</span>&nbsp;<span class="ident" id="3171028"><a href="/image/jpeg/writer.go.html#3170952">nBits</a></span>&nbsp;<span class="op" id="3171034">&gt;=</span>&nbsp;<span class="num" id="3171037">8</span>&nbsp;<span class="op" id="3171039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171043">b</span>&nbsp;<span class="op" id="3171045">:=</span>&nbsp;<span class="builtintype" id="3171048">uint8</span><span class="op" id="3171053">(</span><span class="ident" id="3171054"><a href="/image/jpeg/writer.go.html#3170946">bits</a></span>&nbsp;<span class="op" id="3171059">&gt;&gt;</span>&nbsp;<span class="num" id="3171062">24</span><span class="op" id="3171064">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171068"><a href="/image/jpeg/writer.go.html#3170929">e</a></span><span class="op" id="3171069">.</span><span class="ident" id="3171070">writeByte</span><span class="op" id="3171079">(</span><span class="ident" id="3171080"><a href="/image/jpeg/writer.go.html#3171043">b</a></span><span class="op" id="3171081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171085">if</span>&nbsp;<span class="ident" id="3171088"><a href="/image/jpeg/writer.go.html#3171043">b</a></span>&nbsp;<span class="op" id="3171090">==</span>&nbsp;<span class="num" id="3171093">0xff</span>&nbsp;<span class="op" id="3171098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171103"><a href="/image/jpeg/writer.go.html#3170929">e</a></span><span class="op" id="3171104">.</span><span class="ident" id="3171105">writeByte</span><span class="op" id="3171114">(</span><span class="num" id="3171115">0x00</span><span class="op" id="3171119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171127"><a href="/image/jpeg/writer.go.html#3170946">bits</a></span>&nbsp;<span class="op" id="3171132">&lt;&lt;=</span>&nbsp;<span class="num" id="3171136">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171140"><a href="/image/jpeg/writer.go.html#3170952">nBits</a></span>&nbsp;<span class="op" id="3171146">-=</span>&nbsp;<span class="num" id="3171149">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171155"><a href="/image/jpeg/writer.go.html#3170929">e</a></span><span class="op" id="3171156">.</span><span class="ident" id="3171157">bits</span><span class="op" id="3171161">,</span>&nbsp;<span class="ident" id="3171163"><a href="/image/jpeg/writer.go.html#3170929">e</a></span><span class="op" id="3171164">.</span><span class="ident" id="3171165">nBits</span>&nbsp;<span class="op" id="3171171">=</span>&nbsp;<span class="ident" id="3171173"><a href="/image/jpeg/writer.go.html#3170946">bits</a></span><span class="op" id="3171177">,</span>&nbsp;<span class="ident" id="3171179"><a href="/image/jpeg/writer.go.html#3170952">nBits</a></span><br>
<span class="lineno"></span><span class="op" id="3171185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3171188">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3171254">func</span>&nbsp;<span class="op" id="3171259">(</span><span class="ident" id="3171260">e</span>&nbsp;<span class="op" id="3171262">*</span><span class="ident" id="3171263"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3171270">)</span>&nbsp;<span class="ident" id="3171272">emitHuff</span><span class="op" id="3171280">(</span><span class="ident" id="3171281">h</span>&nbsp;<span class="ident" id="3171283"><a href="/image/jpeg/writer.go.html#3166024">huffIndex</a></span><span class="op" id="3171292">,</span>&nbsp;<span class="ident" id="3171294">value</span>&nbsp;<span class="builtintype" id="3171300">int32</span><span class="op" id="3171305">)</span>&nbsp;<span class="op" id="3171307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171310">x</span>&nbsp;<span class="op" id="3171312">:=</span>&nbsp;<span class="ident" id="3171315"><a href="/image/jpeg/writer.go.html#3169847">theHuffmanLUT</a></span><span class="op" id="3171328">[</span><span class="ident" id="3171329"><a href="/image/jpeg/writer.go.html#3171281">h</a></span><span class="op" id="3171330">]</span><span class="op" id="3171331">[</span><span class="ident" id="3171332"><a href="/image/jpeg/writer.go.html#3171294">value</a></span><span class="op" id="3171337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171340"><a href="/image/jpeg/writer.go.html#3171260">e</a></span><span class="op" id="3171341">.</span><span class="ident" id="3171342">emit</span><span class="op" id="3171346">(</span><span class="ident" id="3171347"><a href="/image/jpeg/writer.go.html#3171310">x</a></span><span class="op" id="3171348">&amp;</span><span class="op" id="3171349">(</span><span class="num" id="3171350">1</span><span class="op" id="3171351">&lt;&lt;</span><span class="num" id="3171353">24</span><span class="op" id="3171355">-</span><span class="num" id="3171356">1</span><span class="op" id="3171357">)</span><span class="op" id="3171358">,</span>&nbsp;<span class="ident" id="3171360"><a href="/image/jpeg/writer.go.html#3171310">x</a></span><span class="op" id="3171361">&gt;&gt;</span><span class="num" id="3171363">24</span><span class="op" id="3171365">)</span><br>
<span class="lineno"></span><span class="op" id="3171367">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3171370">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3171449">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3171469">func</span>&nbsp;<span class="op" id="3171474">(</span><span class="ident" id="3171475">e</span>&nbsp;<span class="op" id="3171477">*</span><span class="ident" id="3171478"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3171485">)</span>&nbsp;<span class="ident" id="3171487">emitHuffRLE</span><span class="op" id="3171498">(</span><span class="ident" id="3171499">h</span>&nbsp;<span class="ident" id="3171501"><a href="/image/jpeg/writer.go.html#3166024">huffIndex</a></span><span class="op" id="3171510">,</span>&nbsp;<span class="ident" id="3171512">runLength</span><span class="op" id="3171521">,</span>&nbsp;<span class="ident" id="3171523">value</span>&nbsp;<span class="builtintype" id="3171529">int32</span><span class="op" id="3171534">)</span>&nbsp;<span class="op" id="3171536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171539">a</span><span class="op" id="3171540">,</span>&nbsp;<span class="ident" id="3171542">b</span>&nbsp;<span class="op" id="3171544">:=</span>&nbsp;<span class="ident" id="3171547"><a href="/image/jpeg/writer.go.html#3171523">value</a></span><span class="op" id="3171552">,</span>&nbsp;<span class="ident" id="3171554"><a href="/image/jpeg/writer.go.html#3171523">value</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171561">if</span>&nbsp;<span class="ident" id="3171564"><a href="/image/jpeg/writer.go.html#3171539">a</a></span>&nbsp;<span class="op" id="3171566">&lt;</span>&nbsp;<span class="num" id="3171568">0</span>&nbsp;<span class="op" id="3171570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171574"><a href="/image/jpeg/writer.go.html#3171539">a</a></span><span class="op" id="3171575">,</span>&nbsp;<span class="ident" id="3171577"><a href="/image/jpeg/writer.go.html#3171542">b</a></span>&nbsp;<span class="op" id="3171579">=</span>&nbsp;<span class="op" id="3171581">-</span><span class="ident" id="3171582"><a href="/image/jpeg/writer.go.html#3171523">value</a></span><span class="op" id="3171587">,</span>&nbsp;<span class="ident" id="3171589"><a href="/image/jpeg/writer.go.html#3171523">value</a></span><span class="op" id="3171594">-</span><span class="num" id="3171595">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171601">var</span>&nbsp;<span class="ident" id="3171605">nBits</span>&nbsp;<span class="builtintype" id="3171611">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171619">if</span>&nbsp;<span class="ident" id="3171622"><a href="/image/jpeg/writer.go.html#3171539">a</a></span>&nbsp;<span class="op" id="3171624">&lt;</span>&nbsp;<span class="num" id="3171626">0x100</span>&nbsp;<span class="op" id="3171632">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171636"><a href="/image/jpeg/writer.go.html#3171605">nBits</a></span>&nbsp;<span class="op" id="3171642">=</span>&nbsp;<span class="builtintype" id="3171644">uint32</span><span class="op" id="3171650">(</span><span class="ident" id="3171651"><a href="/image/jpeg/writer.go.html#3164202">bitCount</a></span><span class="op" id="3171659">[</span><span class="ident" id="3171660"><a href="/image/jpeg/writer.go.html#3171539">a</a></span><span class="op" id="3171661">]</span><span class="op" id="3171662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171665">}</span>&nbsp;<span class="keyword" id="3171667">else</span>&nbsp;<span class="op" id="3171672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171676"><a href="/image/jpeg/writer.go.html#3171605">nBits</a></span>&nbsp;<span class="op" id="3171682">=</span>&nbsp;<span class="num" id="3171684">8</span>&nbsp;<span class="op" id="3171686">+</span>&nbsp;<span class="builtintype" id="3171688">uint32</span><span class="op" id="3171694">(</span><span class="ident" id="3171695"><a href="/image/jpeg/writer.go.html#3164202">bitCount</a></span><span class="op" id="3171703">[</span><span class="ident" id="3171704"><a href="/image/jpeg/writer.go.html#3171539">a</a></span><span class="op" id="3171705">&gt;&gt;</span><span class="num" id="3171707">8</span><span class="op" id="3171708">]</span><span class="op" id="3171709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171715"><a href="/image/jpeg/writer.go.html#3171475">e</a></span><span class="op" id="3171716">.</span><span class="ident" id="3171717">emitHuff</span><span class="op" id="3171725">(</span><span class="ident" id="3171726"><a href="/image/jpeg/writer.go.html#3171499">h</a></span><span class="op" id="3171727">,</span>&nbsp;<span class="ident" id="3171729"><a href="/image/jpeg/writer.go.html#3171512">runLength</a></span><span class="op" id="3171738">&lt;&lt;</span><span class="num" id="3171740">4</span><span class="op" id="3171741">|</span><span class="builtintype" id="3171742">int32</span><span class="op" id="3171747">(</span><span class="ident" id="3171748"><a href="/image/jpeg/writer.go.html#3171605">nBits</a></span><span class="op" id="3171753">)</span><span class="op" id="3171754">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171757">if</span>&nbsp;<span class="ident" id="3171760"><a href="/image/jpeg/writer.go.html#3171605">nBits</a></span>&nbsp;<span class="op" id="3171766">&gt;</span>&nbsp;<span class="num" id="3171768">0</span>&nbsp;<span class="op" id="3171770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171774"><a href="/image/jpeg/writer.go.html#3171475">e</a></span><span class="op" id="3171775">.</span><span class="ident" id="3171776">emit</span><span class="op" id="3171780">(</span><span class="builtintype" id="3171781">uint32</span><span class="op" id="3171787">(</span><span class="ident" id="3171788"><a href="/image/jpeg/writer.go.html#3171542">b</a></span><span class="op" id="3171789">)</span><span class="op" id="3171790">&amp;</span><span class="op" id="3171791">(</span><span class="num" id="3171792">1</span><span class="op" id="3171793">&lt;&lt;</span><span class="ident" id="3171795"><a href="/image/jpeg/writer.go.html#3171605">nBits</a></span><span class="op" id="3171800">-</span><span class="num" id="3171801">1</span><span class="op" id="3171802">)</span><span class="op" id="3171803">,</span>&nbsp;<span class="ident" id="3171805"><a href="/image/jpeg/writer.go.html#3171605">nBits</a></span><span class="op" id="3171810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171813">}</span><br>
<span class="lineno"></span><span class="op" id="3171815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3171818">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3171893">func</span>&nbsp;<span class="op" id="3171898">(</span><span class="ident" id="3171899">e</span>&nbsp;<span class="op" id="3171901">*</span><span class="ident" id="3171902"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3171909">)</span>&nbsp;<span class="ident" id="3171911">writeMarkerHeader</span><span class="op" id="3171928">(</span><span class="ident" id="3171929">marker</span>&nbsp;<span class="builtintype" id="3171936">uint8</span><span class="op" id="3171941">,</span>&nbsp;<span class="ident" id="3171943">markerlen</span>&nbsp;<span class="builtintype" id="3171953">int</span><span class="op" id="3171956">)</span>&nbsp;<span class="op" id="3171958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171961"><a href="/image/jpeg/writer.go.html#3171899">e</a></span><span class="op" id="3171962">.</span><span class="ident" id="3171963">buf</span><span class="op" id="3171966">[</span><span class="num" id="3171967">0</span><span class="op" id="3171968">]</span>&nbsp;<span class="op" id="3171970">=</span>&nbsp;<span class="num" id="3171972">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171978"><a href="/image/jpeg/writer.go.html#3171899">e</a></span><span class="op" id="3171979">.</span><span class="ident" id="3171980">buf</span><span class="op" id="3171983">[</span><span class="num" id="3171984">1</span><span class="op" id="3171985">]</span>&nbsp;<span class="op" id="3171987">=</span>&nbsp;<span class="ident" id="3171989"><a href="/image/jpeg/writer.go.html#3171929">marker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171997"><a href="/image/jpeg/writer.go.html#3171899">e</a></span><span class="op" id="3171998">.</span><span class="ident" id="3171999">buf</span><span class="op" id="3172002">[</span><span class="num" id="3172003">2</span><span class="op" id="3172004">]</span>&nbsp;<span class="op" id="3172006">=</span>&nbsp;<span class="builtintype" id="3172008">uint8</span><span class="op" id="3172013">(</span><span class="ident" id="3172014"><a href="/image/jpeg/writer.go.html#3171943">markerlen</a></span>&nbsp;<span class="op" id="3172024">&gt;&gt;</span>&nbsp;<span class="num" id="3172027">8</span><span class="op" id="3172028">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172031"><a href="/image/jpeg/writer.go.html#3171899">e</a></span><span class="op" id="3172032">.</span><span class="ident" id="3172033">buf</span><span class="op" id="3172036">[</span><span class="num" id="3172037">3</span><span class="op" id="3172038">]</span>&nbsp;<span class="op" id="3172040">=</span>&nbsp;<span class="builtintype" id="3172042">uint8</span><span class="op" id="3172047">(</span><span class="ident" id="3172048"><a href="/image/jpeg/writer.go.html#3171943">markerlen</a></span>&nbsp;<span class="op" id="3172058">&amp;</span>&nbsp;<span class="num" id="3172060">0xff</span><span class="op" id="3172064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172067"><a href="/image/jpeg/writer.go.html#3171899">e</a></span><span class="op" id="3172068">.</span><span class="ident" id="3172069">write</span><span class="op" id="3172074">(</span><span class="ident" id="3172075"><a href="/image/jpeg/writer.go.html#3171899">e</a></span><span class="op" id="3172076">.</span><span class="ident" id="3172077">buf</span><span class="op" id="3172080">[</span><span class="op" id="3172081">:</span><span class="num" id="3172082">4</span><span class="op" id="3172083">]</span><span class="op" id="3172084">)</span><br>
<span class="lineno"></span><span class="op" id="3172086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3172089">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="3172146">func</span>&nbsp;<span class="op" id="3172151">(</span><span class="ident" id="3172152">e</span>&nbsp;<span class="op" id="3172154">*</span><span class="ident" id="3172155"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3172162">)</span>&nbsp;<span class="ident" id="3172164">writeDQT</span><span class="op" id="3172172">(</span><span class="op" id="3172173">)</span>&nbsp;<span class="op" id="3172175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172178">const</span>&nbsp;<span class="ident" id="3172184">markerlen</span>&nbsp;<span class="op" id="3172194">=</span>&nbsp;<span class="num" id="3172196">2</span>&nbsp;<span class="op" id="3172198">+</span>&nbsp;<span class="builtintype" id="3172200">int</span><span class="op" id="3172203">(</span><span class="ident" id="3172204"><a href="/image/jpeg/writer.go.html#3165103">nQuantIndex</a></span><span class="op" id="3172215">)</span><span class="op" id="3172216">*</span><span class="op" id="3172217">(</span><span class="num" id="3172218">1</span><span class="op" id="3172219">+</span><span class="ident" id="3172220"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3172229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172232"><a href="/image/jpeg/writer.go.html#3172152">e</a></span><span class="op" id="3172233">.</span><span class="ident" id="3172234">writeMarkerHeader</span><span class="op" id="3172251">(</span><span class="ident" id="3172252"><a href="/image/jpeg/reader.go.html#3137225">dqtMarker</a></span><span class="op" id="3172261">,</span>&nbsp;<span class="ident" id="3172263"><a href="/image/jpeg/writer.go.html#3172184">markerlen</a></span><span class="op" id="3172272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172275">for</span>&nbsp;<span class="ident" id="3172279">i</span>&nbsp;<span class="op" id="3172281">:=</span>&nbsp;<span class="keyword" id="3172284">range</span>&nbsp;<span class="ident" id="3172290"><a href="/image/jpeg/writer.go.html#3172152">e</a></span><span class="op" id="3172291">.</span><span class="ident" id="3172292">quant</span>&nbsp;<span class="op" id="3172298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172302"><a href="/image/jpeg/writer.go.html#3172152">e</a></span><span class="op" id="3172303">.</span><span class="ident" id="3172304">writeByte</span><span class="op" id="3172313">(</span><span class="builtintype" id="3172314">uint8</span><span class="op" id="3172319">(</span><span class="ident" id="3172320"><a href="/image/jpeg/writer.go.html#3172279">i</a></span><span class="op" id="3172321">)</span><span class="op" id="3172322">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172326"><a href="/image/jpeg/writer.go.html#3172152">e</a></span><span class="op" id="3172327">.</span><span class="ident" id="3172328">write</span><span class="op" id="3172333">(</span><span class="ident" id="3172334"><a href="/image/jpeg/writer.go.html#3172152">e</a></span><span class="op" id="3172335">.</span><span class="ident" id="3172336">quant</span><span class="op" id="3172341">[</span><span class="ident" id="3172342"><a href="/image/jpeg/writer.go.html#3172279">i</a></span><span class="op" id="3172343">]</span><span class="op" id="3172344">[</span><span class="op" id="3172345">:</span><span class="op" id="3172346">]</span><span class="op" id="3172347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172350">}</span><br>
<span class="lineno"></span><span class="op" id="3172352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3172355">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="3172413">func</span>&nbsp;<span class="op" id="3172418">(</span><span class="ident" id="3172419">e</span>&nbsp;<span class="op" id="3172421">*</span><span class="ident" id="3172422"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3172429">)</span>&nbsp;<span class="ident" id="3172431">writeSOF0</span><span class="op" id="3172440">(</span><span class="ident" id="3172441">size</span>&nbsp;<span class="ident" id="3172446"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3172451">.</span><span class="ident" id="3172452">Point</span><span class="op" id="3172457">,</span>&nbsp;<span class="ident" id="3172459">nComponent</span>&nbsp;<span class="builtintype" id="3172470">int</span><span class="op" id="3172473">)</span>&nbsp;<span class="op" id="3172475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172478">markerlen</span>&nbsp;<span class="op" id="3172488">:=</span>&nbsp;<span class="num" id="3172491">8</span>&nbsp;<span class="op" id="3172493">+</span>&nbsp;<span class="num" id="3172495">3</span><span class="op" id="3172496">*</span><span class="ident" id="3172497"><a href="/image/jpeg/writer.go.html#3172459">nComponent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172509"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172510">.</span><span class="ident" id="3172511">writeMarkerHeader</span><span class="op" id="3172528">(</span><span class="ident" id="3172529"><a href="/image/jpeg/reader.go.html#3137077">sof0Marker</a></span><span class="op" id="3172539">,</span>&nbsp;<span class="ident" id="3172541"><a href="/image/jpeg/writer.go.html#3172478">markerlen</a></span><span class="op" id="3172550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172553"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172554">.</span><span class="ident" id="3172555">buf</span><span class="op" id="3172558">[</span><span class="num" id="3172559">0</span><span class="op" id="3172560">]</span>&nbsp;<span class="op" id="3172562">=</span>&nbsp;<span class="num" id="3172564">8</span>&nbsp;<span class="comment" id="3172566">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172583"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172584">.</span><span class="ident" id="3172585">buf</span><span class="op" id="3172588">[</span><span class="num" id="3172589">1</span><span class="op" id="3172590">]</span>&nbsp;<span class="op" id="3172592">=</span>&nbsp;<span class="builtintype" id="3172594">uint8</span><span class="op" id="3172599">(</span><span class="ident" id="3172600"><a href="/image/jpeg/writer.go.html#3172441">size</a></span><span class="op" id="3172604">.</span><span class="ident" id="3172605">Y</span>&nbsp;<span class="op" id="3172607">&gt;&gt;</span>&nbsp;<span class="num" id="3172610">8</span><span class="op" id="3172611">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172614"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172615">.</span><span class="ident" id="3172616">buf</span><span class="op" id="3172619">[</span><span class="num" id="3172620">2</span><span class="op" id="3172621">]</span>&nbsp;<span class="op" id="3172623">=</span>&nbsp;<span class="builtintype" id="3172625">uint8</span><span class="op" id="3172630">(</span><span class="ident" id="3172631"><a href="/image/jpeg/writer.go.html#3172441">size</a></span><span class="op" id="3172635">.</span><span class="ident" id="3172636">Y</span>&nbsp;<span class="op" id="3172638">&amp;</span>&nbsp;<span class="num" id="3172640">0xff</span><span class="op" id="3172644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172647"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172648">.</span><span class="ident" id="3172649">buf</span><span class="op" id="3172652">[</span><span class="num" id="3172653">3</span><span class="op" id="3172654">]</span>&nbsp;<span class="op" id="3172656">=</span>&nbsp;<span class="builtintype" id="3172658">uint8</span><span class="op" id="3172663">(</span><span class="ident" id="3172664"><a href="/image/jpeg/writer.go.html#3172441">size</a></span><span class="op" id="3172668">.</span><span class="ident" id="3172669">X</span>&nbsp;<span class="op" id="3172671">&gt;&gt;</span>&nbsp;<span class="num" id="3172674">8</span><span class="op" id="3172675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172678"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172679">.</span><span class="ident" id="3172680">buf</span><span class="op" id="3172683">[</span><span class="num" id="3172684">4</span><span class="op" id="3172685">]</span>&nbsp;<span class="op" id="3172687">=</span>&nbsp;<span class="builtintype" id="3172689">uint8</span><span class="op" id="3172694">(</span><span class="ident" id="3172695"><a href="/image/jpeg/writer.go.html#3172441">size</a></span><span class="op" id="3172699">.</span><span class="ident" id="3172700">X</span>&nbsp;<span class="op" id="3172702">&amp;</span>&nbsp;<span class="num" id="3172704">0xff</span><span class="op" id="3172708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172711"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172712">.</span><span class="ident" id="3172713">buf</span><span class="op" id="3172716">[</span><span class="num" id="3172717">5</span><span class="op" id="3172718">]</span>&nbsp;<span class="op" id="3172720">=</span>&nbsp;<span class="builtintype" id="3172722">uint8</span><span class="op" id="3172727">(</span><span class="ident" id="3172728"><a href="/image/jpeg/writer.go.html#3172459">nComponent</a></span><span class="op" id="3172738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172741">if</span>&nbsp;<span class="ident" id="3172744"><a href="/image/jpeg/writer.go.html#3172459">nComponent</a></span>&nbsp;<span class="op" id="3172755">==</span>&nbsp;<span class="num" id="3172758">1</span>&nbsp;<span class="op" id="3172760">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172764"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172765">.</span><span class="ident" id="3172766">buf</span><span class="op" id="3172769">[</span><span class="num" id="3172770">6</span><span class="op" id="3172771">]</span>&nbsp;<span class="op" id="3172773">=</span>&nbsp;<span class="num" id="3172775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3172779">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172820"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172821">.</span><span class="ident" id="3172822">buf</span><span class="op" id="3172825">[</span><span class="num" id="3172826">7</span><span class="op" id="3172827">]</span>&nbsp;<span class="op" id="3172829">=</span>&nbsp;<span class="num" id="3172831">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172838"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172839">.</span><span class="ident" id="3172840">buf</span><span class="op" id="3172843">[</span><span class="num" id="3172844">8</span><span class="op" id="3172845">]</span>&nbsp;<span class="op" id="3172847">=</span>&nbsp;<span class="num" id="3172849">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172855">}</span>&nbsp;<span class="keyword" id="3172857">else</span>&nbsp;<span class="op" id="3172862">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172866">for</span>&nbsp;<span class="ident" id="3172870">i</span>&nbsp;<span class="op" id="3172872">:=</span>&nbsp;<span class="num" id="3172875">0</span><span class="op" id="3172876">;</span>&nbsp;<span class="ident" id="3172878"><a href="/image/jpeg/writer.go.html#3172870">i</a></span>&nbsp;<span class="op" id="3172880">&lt;</span>&nbsp;<span class="ident" id="3172882"><a href="/image/jpeg/writer.go.html#3172459">nComponent</a></span><span class="op" id="3172892">;</span>&nbsp;<span class="ident" id="3172894"><a href="/image/jpeg/writer.go.html#3172870">i</a></span><span class="op" id="3172895">++</span>&nbsp;<span class="op" id="3172898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172903"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172904">.</span><span class="ident" id="3172905">buf</span><span class="op" id="3172908">[</span><span class="num" id="3172909">3</span><span class="op" id="3172910">*</span><span class="ident" id="3172911"><a href="/image/jpeg/writer.go.html#3172870">i</a></span><span class="op" id="3172912">+</span><span class="num" id="3172913">6</span><span class="op" id="3172914">]</span>&nbsp;<span class="op" id="3172916">=</span>&nbsp;<span class="builtintype" id="3172918">uint8</span><span class="op" id="3172923">(</span><span class="ident" id="3172924"><a href="/image/jpeg/writer.go.html#3172870">i</a></span>&nbsp;<span class="op" id="3172926">+</span>&nbsp;<span class="num" id="3172928">1</span><span class="op" id="3172929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3172934">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172973"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3172974">.</span><span class="ident" id="3172975">buf</span><span class="op" id="3172978">[</span><span class="num" id="3172979">3</span><span class="op" id="3172980">*</span><span class="ident" id="3172981"><a href="/image/jpeg/writer.go.html#3172870">i</a></span><span class="op" id="3172982">+</span><span class="num" id="3172983">7</span><span class="op" id="3172984">]</span>&nbsp;<span class="op" id="3172986">=</span>&nbsp;<span class="string" id="3172988">&#34;\x22\x11\x11&#34;</span><span class="op" id="3173002">[</span><span class="ident" id="3173003"><a href="/image/jpeg/writer.go.html#3172870">i</a></span><span class="op" id="3173004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173009"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3173010">.</span><span class="ident" id="3173011">buf</span><span class="op" id="3173014">[</span><span class="num" id="3173015">3</span><span class="op" id="3173016">*</span><span class="ident" id="3173017"><a href="/image/jpeg/writer.go.html#3172870">i</a></span><span class="op" id="3173018">+</span><span class="num" id="3173019">8</span><span class="op" id="3173020">]</span>&nbsp;<span class="op" id="3173022">=</span>&nbsp;<span class="string" id="3173024">&#34;\x00\x01\x01&#34;</span><span class="op" id="3173038">[</span><span class="ident" id="3173039"><a href="/image/jpeg/writer.go.html#3172870">i</a></span><span class="op" id="3173040">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173050"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3173051">.</span><span class="ident" id="3173052">write</span><span class="op" id="3173057">(</span><span class="ident" id="3173058"><a href="/image/jpeg/writer.go.html#3172419">e</a></span><span class="op" id="3173059">.</span><span class="ident" id="3173060">buf</span><span class="op" id="3173063">[</span><span class="op" id="3173064">:</span><span class="num" id="3173065">3</span><span class="op" id="3173066">*</span><span class="op" id="3173067">(</span><span class="ident" id="3173068"><a href="/image/jpeg/writer.go.html#3172459">nComponent</a></span><span class="op" id="3173078">-</span><span class="num" id="3173079">1</span><span class="op" id="3173080">)</span><span class="op" id="3173081">+</span><span class="num" id="3173082">9</span><span class="op" id="3173083">]</span><span class="op" id="3173084">)</span><br>
<span class="lineno"></span><span class="op" id="3173086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3173089">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="3173141">func</span>&nbsp;<span class="op" id="3173146">(</span><span class="ident" id="3173147">e</span>&nbsp;<span class="op" id="3173149">*</span><span class="ident" id="3173150"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3173157">)</span>&nbsp;<span class="ident" id="3173159">writeDHT</span><span class="op" id="3173167">(</span><span class="ident" id="3173168">nComponent</span>&nbsp;<span class="builtintype" id="3173179">int</span><span class="op" id="3173182">)</span>&nbsp;<span class="op" id="3173184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173187">markerlen</span>&nbsp;<span class="op" id="3173197">:=</span>&nbsp;<span class="num" id="3173200">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173203">specs</span>&nbsp;<span class="op" id="3173209">:=</span>&nbsp;<span class="ident" id="3173212"><a href="/image/jpeg/writer.go.html#3166510">theHuffmanSpec</a></span><span class="op" id="3173226">[</span><span class="op" id="3173227">:</span><span class="op" id="3173228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173231">if</span>&nbsp;<span class="ident" id="3173234"><a href="/image/jpeg/writer.go.html#3173168">nComponent</a></span>&nbsp;<span class="op" id="3173245">==</span>&nbsp;<span class="num" id="3173248">1</span>&nbsp;<span class="op" id="3173250">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3173254">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173288"><a href="/image/jpeg/writer.go.html#3173203">specs</a></span>&nbsp;<span class="op" id="3173294">=</span>&nbsp;<span class="ident" id="3173296"><a href="/image/jpeg/writer.go.html#3173203">specs</a></span><span class="op" id="3173301">[</span><span class="op" id="3173302">:</span><span class="num" id="3173303">2</span><span class="op" id="3173304">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173310">for</span>&nbsp;<span class="ident" id="3173314">_</span><span class="op" id="3173315">,</span>&nbsp;<span class="ident" id="3173317">s</span>&nbsp;<span class="op" id="3173319">:=</span>&nbsp;<span class="keyword" id="3173322">range</span>&nbsp;<span class="ident" id="3173328"><a href="/image/jpeg/writer.go.html#3173203">specs</a></span>&nbsp;<span class="op" id="3173334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173338"><a href="/image/jpeg/writer.go.html#3173187">markerlen</a></span>&nbsp;<span class="op" id="3173348">+=</span>&nbsp;<span class="num" id="3173351">1</span>&nbsp;<span class="op" id="3173353">+</span>&nbsp;<span class="num" id="3173355">16</span>&nbsp;<span class="op" id="3173358">+</span>&nbsp;<span class="builtinfunc" id="3173360">len</span><span class="op" id="3173363">(</span><span class="ident" id="3173364"><a href="/image/jpeg/writer.go.html#3173317">s</a></span><span class="op" id="3173365">.</span><span class="ident" id="3173366">value</span><span class="op" id="3173371">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173377"><a href="/image/jpeg/writer.go.html#3173147">e</a></span><span class="op" id="3173378">.</span><span class="ident" id="3173379">writeMarkerHeader</span><span class="op" id="3173396">(</span><span class="ident" id="3173397"><a href="/image/jpeg/reader.go.html#3137180">dhtMarker</a></span><span class="op" id="3173406">,</span>&nbsp;<span class="ident" id="3173408"><a href="/image/jpeg/writer.go.html#3173187">markerlen</a></span><span class="op" id="3173417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173420">for</span>&nbsp;<span class="ident" id="3173424">i</span><span class="op" id="3173425">,</span>&nbsp;<span class="ident" id="3173427">s</span>&nbsp;<span class="op" id="3173429">:=</span>&nbsp;<span class="keyword" id="3173432">range</span>&nbsp;<span class="ident" id="3173438"><a href="/image/jpeg/writer.go.html#3173203">specs</a></span>&nbsp;<span class="op" id="3173444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173448"><a href="/image/jpeg/writer.go.html#3173147">e</a></span><span class="op" id="3173449">.</span><span class="ident" id="3173450">writeByte</span><span class="op" id="3173459">(</span><span class="string" id="3173460">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="3173478">[</span><span class="ident" id="3173479"><a href="/image/jpeg/writer.go.html#3173424">i</a></span><span class="op" id="3173480">]</span><span class="op" id="3173481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173485"><a href="/image/jpeg/writer.go.html#3173147">e</a></span><span class="op" id="3173486">.</span><span class="ident" id="3173487">write</span><span class="op" id="3173492">(</span><span class="ident" id="3173493"><a href="/image/jpeg/writer.go.html#3173427">s</a></span><span class="op" id="3173494">.</span><span class="ident" id="3173495">count</span><span class="op" id="3173500">[</span><span class="op" id="3173501">:</span><span class="op" id="3173502">]</span><span class="op" id="3173503">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173507"><a href="/image/jpeg/writer.go.html#3173147">e</a></span><span class="op" id="3173508">.</span><span class="ident" id="3173509">write</span><span class="op" id="3173514">(</span><span class="ident" id="3173515"><a href="/image/jpeg/writer.go.html#3173427">s</a></span><span class="op" id="3173516">.</span><span class="ident" id="3173517">value</span><span class="op" id="3173522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173525">}</span><br>
<span class="lineno"></span><span class="op" id="3173527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3173530">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="3173609">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3173688">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="3173720">func</span>&nbsp;<span class="op" id="3173725">(</span><span class="ident" id="3173726">e</span>&nbsp;<span class="op" id="3173728">*</span><span class="ident" id="3173729"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3173736">)</span>&nbsp;<span class="ident" id="3173738">writeBlock</span><span class="op" id="3173748">(</span><span class="ident" id="3173749">b</span>&nbsp;<span class="op" id="3173751">*</span><span class="ident" id="3173752"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3173757">,</span>&nbsp;<span class="ident" id="3173759">q</span>&nbsp;<span class="ident" id="3173761"><a href="/image/jpeg/writer.go.html#3165016">quantIndex</a></span><span class="op" id="3173771">,</span>&nbsp;<span class="ident" id="3173773">prevDC</span>&nbsp;<span class="builtintype" id="3173780">int32</span><span class="op" id="3173785">)</span>&nbsp;<span class="builtintype" id="3173787">int32</span>&nbsp;<span class="op" id="3173793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173796"><a href="/image/jpeg/fdct.go.html#3120952">fdct</a></span><span class="op" id="3173800">(</span><span class="ident" id="3173801"><a href="/image/jpeg/writer.go.html#3173749">b</a></span><span class="op" id="3173802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3173805">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173828">dc</span>&nbsp;<span class="op" id="3173831">:=</span>&nbsp;<span class="ident" id="3173834"><a href="/image/jpeg/writer.go.html#3164031">div</a></span><span class="op" id="3173837">(</span><span class="ident" id="3173838"><a href="/image/jpeg/writer.go.html#3173749">b</a></span><span class="op" id="3173839">[</span><span class="num" id="3173840">0</span><span class="op" id="3173841">]</span><span class="op" id="3173842">,</span>&nbsp;<span class="num" id="3173844">8</span><span class="op" id="3173845">*</span><span class="builtintype" id="3173846">int32</span><span class="op" id="3173851">(</span><span class="ident" id="3173852"><a href="/image/jpeg/writer.go.html#3173726">e</a></span><span class="op" id="3173853">.</span><span class="ident" id="3173854">quant</span><span class="op" id="3173859">[</span><span class="ident" id="3173860"><a href="/image/jpeg/writer.go.html#3173759">q</a></span><span class="op" id="3173861">]</span><span class="op" id="3173862">[</span><span class="num" id="3173863">0</span><span class="op" id="3173864">]</span><span class="op" id="3173865">)</span><span class="op" id="3173866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173869"><a href="/image/jpeg/writer.go.html#3173726">e</a></span><span class="op" id="3173870">.</span><span class="ident" id="3173871">emitHuffRLE</span><span class="op" id="3173882">(</span><span class="ident" id="3173883"><a href="/image/jpeg/writer.go.html#3166024">huffIndex</a></span><span class="op" id="3173892">(</span><span class="num" id="3173893">2</span><span class="op" id="3173894">*</span><span class="ident" id="3173895"><a href="/image/jpeg/writer.go.html#3173759">q</a></span><span class="op" id="3173896">+</span><span class="num" id="3173897">0</span><span class="op" id="3173898">)</span><span class="op" id="3173899">,</span>&nbsp;<span class="num" id="3173901">0</span><span class="op" id="3173902">,</span>&nbsp;<span class="ident" id="3173904"><a href="/image/jpeg/writer.go.html#3173828">dc</a></span><span class="op" id="3173906">-</span><span class="ident" id="3173907"><a href="/image/jpeg/writer.go.html#3173773">prevDC</a></span><span class="op" id="3173913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3173916">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173944">h</span><span class="op" id="3173945">,</span>&nbsp;<span class="ident" id="3173947">runLength</span>&nbsp;<span class="op" id="3173957">:=</span>&nbsp;<span class="ident" id="3173960"><a href="/image/jpeg/writer.go.html#3166024">huffIndex</a></span><span class="op" id="3173969">(</span><span class="num" id="3173970">2</span><span class="op" id="3173971">*</span><span class="ident" id="3173972"><a href="/image/jpeg/writer.go.html#3173759">q</a></span><span class="op" id="3173973">+</span><span class="num" id="3173974">1</span><span class="op" id="3173975">)</span><span class="op" id="3173976">,</span>&nbsp;<span class="builtintype" id="3173978">int32</span><span class="op" id="3173983">(</span><span class="num" id="3173984">0</span><span class="op" id="3173985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173988">for</span>&nbsp;<span class="ident" id="3173992">zig</span>&nbsp;<span class="op" id="3173996">:=</span>&nbsp;<span class="num" id="3173999">1</span><span class="op" id="3174000">;</span>&nbsp;<span class="ident" id="3174002"><a href="/image/jpeg/writer.go.html#3173992">zig</a></span>&nbsp;<span class="op" id="3174006">&lt;</span>&nbsp;<span class="ident" id="3174008"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3174017">;</span>&nbsp;<span class="ident" id="3174019"><a href="/image/jpeg/writer.go.html#3173992">zig</a></span><span class="op" id="3174022">++</span>&nbsp;<span class="op" id="3174025">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174029">ac</span>&nbsp;<span class="op" id="3174032">:=</span>&nbsp;<span class="ident" id="3174035"><a href="/image/jpeg/writer.go.html#3164031">div</a></span><span class="op" id="3174038">(</span><span class="ident" id="3174039"><a href="/image/jpeg/writer.go.html#3173749">b</a></span><span class="op" id="3174040">[</span><span class="ident" id="3174041"><a href="/image/jpeg/reader.go.html#3137806">unzig</a></span><span class="op" id="3174046">[</span><span class="ident" id="3174047"><a href="/image/jpeg/writer.go.html#3173992">zig</a></span><span class="op" id="3174050">]</span><span class="op" id="3174051">]</span><span class="op" id="3174052">,</span>&nbsp;<span class="num" id="3174054">8</span><span class="op" id="3174055">*</span><span class="builtintype" id="3174056">int32</span><span class="op" id="3174061">(</span><span class="ident" id="3174062"><a href="/image/jpeg/writer.go.html#3173726">e</a></span><span class="op" id="3174063">.</span><span class="ident" id="3174064">quant</span><span class="op" id="3174069">[</span><span class="ident" id="3174070"><a href="/image/jpeg/writer.go.html#3173759">q</a></span><span class="op" id="3174071">]</span><span class="op" id="3174072">[</span><span class="ident" id="3174073"><a href="/image/jpeg/writer.go.html#3173992">zig</a></span><span class="op" id="3174076">]</span><span class="op" id="3174077">)</span><span class="op" id="3174078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174082">if</span>&nbsp;<span class="ident" id="3174085"><a href="/image/jpeg/writer.go.html#3174029">ac</a></span>&nbsp;<span class="op" id="3174088">==</span>&nbsp;<span class="num" id="3174091">0</span>&nbsp;<span class="op" id="3174093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174098"><a href="/image/jpeg/writer.go.html#3173947">runLength</a></span><span class="op" id="3174107">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174112">}</span>&nbsp;<span class="keyword" id="3174114">else</span>&nbsp;<span class="op" id="3174119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174124">for</span>&nbsp;<span class="ident" id="3174128"><a href="/image/jpeg/writer.go.html#3173947">runLength</a></span>&nbsp;<span class="op" id="3174138">&gt;</span>&nbsp;<span class="num" id="3174140">15</span>&nbsp;<span class="op" id="3174143">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174149"><a href="/image/jpeg/writer.go.html#3173726">e</a></span><span class="op" id="3174150">.</span><span class="ident" id="3174151">emitHuff</span><span class="op" id="3174159">(</span><span class="ident" id="3174160"><a href="/image/jpeg/writer.go.html#3173944">h</a></span><span class="op" id="3174161">,</span>&nbsp;<span class="num" id="3174163">0xf0</span><span class="op" id="3174167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174173"><a href="/image/jpeg/writer.go.html#3173947">runLength</a></span>&nbsp;<span class="op" id="3174183">-=</span>&nbsp;<span class="num" id="3174186">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174197"><a href="/image/jpeg/writer.go.html#3173726">e</a></span><span class="op" id="3174198">.</span><span class="ident" id="3174199">emitHuffRLE</span><span class="op" id="3174210">(</span><span class="ident" id="3174211"><a href="/image/jpeg/writer.go.html#3173944">h</a></span><span class="op" id="3174212">,</span>&nbsp;<span class="ident" id="3174214"><a href="/image/jpeg/writer.go.html#3173947">runLength</a></span><span class="op" id="3174223">,</span>&nbsp;<span class="ident" id="3174225"><a href="/image/jpeg/writer.go.html#3174029">ac</a></span><span class="op" id="3174227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174232"><a href="/image/jpeg/writer.go.html#3173947">runLength</a></span>&nbsp;<span class="op" id="3174242">=</span>&nbsp;<span class="num" id="3174244">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174254">if</span>&nbsp;<span class="ident" id="3174257"><a href="/image/jpeg/writer.go.html#3173947">runLength</a></span>&nbsp;<span class="op" id="3174267">&gt;</span>&nbsp;<span class="num" id="3174269">0</span>&nbsp;<span class="op" id="3174271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174275"><a href="/image/jpeg/writer.go.html#3173726">e</a></span><span class="op" id="3174276">.</span><span class="ident" id="3174277">emitHuff</span><span class="op" id="3174285">(</span><span class="ident" id="3174286"><a href="/image/jpeg/writer.go.html#3173944">h</a></span><span class="op" id="3174287">,</span>&nbsp;<span class="num" id="3174289">0x00</span><span class="op" id="3174293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174296">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174299">return</span>&nbsp;<span class="ident" id="3174306"><a href="/image/jpeg/writer.go.html#3173828">dc</a></span><br>
<span class="lineno"></span><span class="op" id="3174309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3174312">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3174386">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="3174403">func</span>&nbsp;<span class="ident" id="3174408">toYCbCr</span><span class="op" id="3174415">(</span><span class="ident" id="3174416">m</span>&nbsp;<span class="ident" id="3174418"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3174423">.</span><span class="ident" id="3174424">Image</span><span class="op" id="3174429">,</span>&nbsp;<span class="ident" id="3174431">p</span>&nbsp;<span class="ident" id="3174433"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3174438">.</span><span class="ident" id="3174439">Point</span><span class="op" id="3174444">,</span>&nbsp;<span class="ident" id="3174446">yBlock</span><span class="op" id="3174452">,</span>&nbsp;<span class="ident" id="3174454">cbBlock</span><span class="op" id="3174461">,</span>&nbsp;<span class="ident" id="3174463">crBlock</span>&nbsp;<span class="op" id="3174471">*</span><span class="ident" id="3174472"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3174477">)</span>&nbsp;<span class="op" id="3174479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174482">b</span>&nbsp;<span class="op" id="3174484">:=</span>&nbsp;<span class="ident" id="3174487"><a href="/image/jpeg/writer.go.html#3174416">m</a></span><span class="op" id="3174488">.</span><span class="ident" id="3174489">Bounds</span><span class="op" id="3174495">(</span><span class="op" id="3174496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174499">xmax</span>&nbsp;<span class="op" id="3174504">:=</span>&nbsp;<span class="ident" id="3174507"><a href="/image/jpeg/writer.go.html#3174482">b</a></span><span class="op" id="3174508">.</span><span class="ident" id="3174509">Max</span><span class="op" id="3174512">.</span><span class="ident" id="3174513">X</span>&nbsp;<span class="op" id="3174515">-</span>&nbsp;<span class="num" id="3174517">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174520">ymax</span>&nbsp;<span class="op" id="3174525">:=</span>&nbsp;<span class="ident" id="3174528"><a href="/image/jpeg/writer.go.html#3174482">b</a></span><span class="op" id="3174529">.</span><span class="ident" id="3174530">Max</span><span class="op" id="3174533">.</span><span class="ident" id="3174534">Y</span>&nbsp;<span class="op" id="3174536">-</span>&nbsp;<span class="num" id="3174538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174541">for</span>&nbsp;<span class="ident" id="3174545">j</span>&nbsp;<span class="op" id="3174547">:=</span>&nbsp;<span class="num" id="3174550">0</span><span class="op" id="3174551">;</span>&nbsp;<span class="ident" id="3174553"><a href="/image/jpeg/writer.go.html#3174545">j</a></span>&nbsp;<span class="op" id="3174555">&lt;</span>&nbsp;<span class="num" id="3174557">8</span><span class="op" id="3174558">;</span>&nbsp;<span class="ident" id="3174560"><a href="/image/jpeg/writer.go.html#3174545">j</a></span><span class="op" id="3174561">++</span>&nbsp;<span class="op" id="3174564">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174568">for</span>&nbsp;<span class="ident" id="3174572">i</span>&nbsp;<span class="op" id="3174574">:=</span>&nbsp;<span class="num" id="3174577">0</span><span class="op" id="3174578">;</span>&nbsp;<span class="ident" id="3174580"><a href="/image/jpeg/writer.go.html#3174572">i</a></span>&nbsp;<span class="op" id="3174582">&lt;</span>&nbsp;<span class="num" id="3174584">8</span><span class="op" id="3174585">;</span>&nbsp;<span class="ident" id="3174587"><a href="/image/jpeg/writer.go.html#3174572">i</a></span><span class="op" id="3174588">++</span>&nbsp;<span class="op" id="3174591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174596">r</span><span class="op" id="3174597">,</span>&nbsp;<span class="ident" id="3174599">g</span><span class="op" id="3174600">,</span>&nbsp;<span class="ident" id="3174602">b</span><span class="op" id="3174603">,</span>&nbsp;<span class="ident" id="3174605">_</span>&nbsp;<span class="op" id="3174607">:=</span>&nbsp;<span class="ident" id="3174610"><a href="/image/jpeg/writer.go.html#3174416">m</a></span><span class="op" id="3174611">.</span><span class="ident" id="3174612">At</span><span class="op" id="3174614">(</span><span class="ident" id="3174615"><a href="/image/jpeg/writer.go.html#3163888">min</a></span><span class="op" id="3174618">(</span><span class="ident" id="3174619"><a href="/image/jpeg/writer.go.html#3174431">p</a></span><span class="op" id="3174620">.</span><span class="ident" id="3174621">X</span><span class="op" id="3174622">+</span><span class="ident" id="3174623"><a href="/image/jpeg/writer.go.html#3174572">i</a></span><span class="op" id="3174624">,</span>&nbsp;<span class="ident" id="3174626"><a href="/image/jpeg/writer.go.html#3174499">xmax</a></span><span class="op" id="3174630">)</span><span class="op" id="3174631">,</span>&nbsp;<span class="ident" id="3174633"><a href="/image/jpeg/writer.go.html#3163888">min</a></span><span class="op" id="3174636">(</span><span class="ident" id="3174637"><a href="/image/jpeg/writer.go.html#3174431">p</a></span><span class="op" id="3174638">.</span><span class="ident" id="3174639">Y</span><span class="op" id="3174640">+</span><span class="ident" id="3174641"><a href="/image/jpeg/writer.go.html#3174545">j</a></span><span class="op" id="3174642">,</span>&nbsp;<span class="ident" id="3174644"><a href="/image/jpeg/writer.go.html#3174520">ymax</a></span><span class="op" id="3174648">)</span><span class="op" id="3174649">)</span><span class="op" id="3174650">.</span><span class="ident" id="3174651">RGBA</span><span class="op" id="3174655">(</span><span class="op" id="3174656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174661">yy</span><span class="op" id="3174663">,</span>&nbsp;<span class="ident" id="3174665">cb</span><span class="op" id="3174667">,</span>&nbsp;<span class="ident" id="3174669">cr</span>&nbsp;<span class="op" id="3174672">:=</span>&nbsp;<span class="ident" id="3174675"><a href="/image/jpeg/writer.go.html#3163816">color</a></span><span class="op" id="3174680">.</span><span class="ident" id="3174681">RGBToYCbCr</span><span class="op" id="3174691">(</span><span class="builtintype" id="3174692">uint8</span><span class="op" id="3174697">(</span><span class="ident" id="3174698"><a href="/image/jpeg/writer.go.html#3174596">r</a></span><span class="op" id="3174699">&gt;&gt;</span><span class="num" id="3174701">8</span><span class="op" id="3174702">)</span><span class="op" id="3174703">,</span>&nbsp;<span class="builtintype" id="3174705">uint8</span><span class="op" id="3174710">(</span><span class="ident" id="3174711"><a href="/image/jpeg/writer.go.html#3174599">g</a></span><span class="op" id="3174712">&gt;&gt;</span><span class="num" id="3174714">8</span><span class="op" id="3174715">)</span><span class="op" id="3174716">,</span>&nbsp;<span class="builtintype" id="3174718">uint8</span><span class="op" id="3174723">(</span><span class="ident" id="3174724"><a href="/image/jpeg/writer.go.html#3174602">b</a></span><span class="op" id="3174725">&gt;&gt;</span><span class="num" id="3174727">8</span><span class="op" id="3174728">)</span><span class="op" id="3174729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174734"><a href="/image/jpeg/writer.go.html#3174446">yBlock</a></span><span class="op" id="3174740">[</span><span class="num" id="3174741">8</span><span class="op" id="3174742">*</span><span class="ident" id="3174743"><a href="/image/jpeg/writer.go.html#3174545">j</a></span><span class="op" id="3174744">+</span><span class="ident" id="3174745"><a href="/image/jpeg/writer.go.html#3174572">i</a></span><span class="op" id="3174746">]</span>&nbsp;<span class="op" id="3174748">=</span>&nbsp;<span class="builtintype" id="3174750">int32</span><span class="op" id="3174755">(</span><span class="ident" id="3174756"><a href="/image/jpeg/writer.go.html#3174661">yy</a></span><span class="op" id="3174758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174763"><a href="/image/jpeg/writer.go.html#3174454">cbBlock</a></span><span class="op" id="3174770">[</span><span class="num" id="3174771">8</span><span class="op" id="3174772">*</span><span class="ident" id="3174773"><a href="/image/jpeg/writer.go.html#3174545">j</a></span><span class="op" id="3174774">+</span><span class="ident" id="3174775"><a href="/image/jpeg/writer.go.html#3174572">i</a></span><span class="op" id="3174776">]</span>&nbsp;<span class="op" id="3174778">=</span>&nbsp;<span class="builtintype" id="3174780">int32</span><span class="op" id="3174785">(</span><span class="ident" id="3174786"><a href="/image/jpeg/writer.go.html#3174665">cb</a></span><span class="op" id="3174788">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174793"><a href="/image/jpeg/writer.go.html#3174463">crBlock</a></span><span class="op" id="3174800">[</span><span class="num" id="3174801">8</span><span class="op" id="3174802">*</span><span class="ident" id="3174803"><a href="/image/jpeg/writer.go.html#3174545">j</a></span><span class="op" id="3174804">+</span><span class="ident" id="3174805"><a href="/image/jpeg/writer.go.html#3174572">i</a></span><span class="op" id="3174806">]</span>&nbsp;<span class="op" id="3174808">=</span>&nbsp;<span class="builtintype" id="3174810">int32</span><span class="op" id="3174815">(</span><span class="ident" id="3174816"><a href="/image/jpeg/writer.go.html#3174669">cr</a></span><span class="op" id="3174818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174825">}</span><br>
<span class="lineno"></span><span class="op" id="3174827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="3174830">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="3174906">func</span>&nbsp;<span class="ident" id="3174911">grayToY</span><span class="op" id="3174918">(</span><span class="ident" id="3174919">m</span>&nbsp;<span class="op" id="3174921">*</span><span class="ident" id="3174922"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3174927">.</span><span class="ident" id="3174928">Gray</span><span class="op" id="3174932">,</span>&nbsp;<span class="ident" id="3174934">p</span>&nbsp;<span class="ident" id="3174936"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3174941">.</span><span class="ident" id="3174942">Point</span><span class="op" id="3174947">,</span>&nbsp;<span class="ident" id="3174949">yBlock</span>&nbsp;<span class="op" id="3174956">*</span><span class="ident" id="3174957"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3174962">)</span>&nbsp;<span class="op" id="3174964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174967">b</span>&nbsp;<span class="op" id="3174969">:=</span>&nbsp;<span class="ident" id="3174972"><a href="/image/jpeg/writer.go.html#3174919">m</a></span><span class="op" id="3174973">.</span><span class="ident" id="3174974">Bounds</span><span class="op" id="3174980">(</span><span class="op" id="3174981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174984">xmax</span>&nbsp;<span class="op" id="3174989">:=</span>&nbsp;<span class="ident" id="3174992"><a href="/image/jpeg/writer.go.html#3174967">b</a></span><span class="op" id="3174993">.</span><span class="ident" id="3174994">Max</span><span class="op" id="3174997">.</span><span class="ident" id="3174998">X</span>&nbsp;<span class="op" id="3175000">-</span>&nbsp;<span class="num" id="3175002">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175005">ymax</span>&nbsp;<span class="op" id="3175010">:=</span>&nbsp;<span class="ident" id="3175013"><a href="/image/jpeg/writer.go.html#3174967">b</a></span><span class="op" id="3175014">.</span><span class="ident" id="3175015">Max</span><span class="op" id="3175018">.</span><span class="ident" id="3175019">Y</span>&nbsp;<span class="op" id="3175021">-</span>&nbsp;<span class="num" id="3175023">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175026">pix</span>&nbsp;<span class="op" id="3175030">:=</span>&nbsp;<span class="ident" id="3175033"><a href="/image/jpeg/writer.go.html#3174919">m</a></span><span class="op" id="3175034">.</span><span class="ident" id="3175035">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175040">for</span>&nbsp;<span class="ident" id="3175044">j</span>&nbsp;<span class="op" id="3175046">:=</span>&nbsp;<span class="num" id="3175049">0</span><span class="op" id="3175050">;</span>&nbsp;<span class="ident" id="3175052"><a href="/image/jpeg/writer.go.html#3175044">j</a></span>&nbsp;<span class="op" id="3175054">&lt;</span>&nbsp;<span class="num" id="3175056">8</span><span class="op" id="3175057">;</span>&nbsp;<span class="ident" id="3175059"><a href="/image/jpeg/writer.go.html#3175044">j</a></span><span class="op" id="3175060">++</span>&nbsp;<span class="op" id="3175063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175067">for</span>&nbsp;<span class="ident" id="3175071">i</span>&nbsp;<span class="op" id="3175073">:=</span>&nbsp;<span class="num" id="3175076">0</span><span class="op" id="3175077">;</span>&nbsp;<span class="ident" id="3175079"><a href="/image/jpeg/writer.go.html#3175071">i</a></span>&nbsp;<span class="op" id="3175081">&lt;</span>&nbsp;<span class="num" id="3175083">8</span><span class="op" id="3175084">;</span>&nbsp;<span class="ident" id="3175086"><a href="/image/jpeg/writer.go.html#3175071">i</a></span><span class="op" id="3175087">++</span>&nbsp;<span class="op" id="3175090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175095">idx</span>&nbsp;<span class="op" id="3175099">:=</span>&nbsp;<span class="ident" id="3175102"><a href="/image/jpeg/writer.go.html#3174919">m</a></span><span class="op" id="3175103">.</span><span class="ident" id="3175104">PixOffset</span><span class="op" id="3175113">(</span><span class="ident" id="3175114"><a href="/image/jpeg/writer.go.html#3163888">min</a></span><span class="op" id="3175117">(</span><span class="ident" id="3175118"><a href="/image/jpeg/writer.go.html#3174934">p</a></span><span class="op" id="3175119">.</span><span class="ident" id="3175120">X</span><span class="op" id="3175121">+</span><span class="ident" id="3175122"><a href="/image/jpeg/writer.go.html#3175071">i</a></span><span class="op" id="3175123">,</span>&nbsp;<span class="ident" id="3175125"><a href="/image/jpeg/writer.go.html#3174984">xmax</a></span><span class="op" id="3175129">)</span><span class="op" id="3175130">,</span>&nbsp;<span class="ident" id="3175132"><a href="/image/jpeg/writer.go.html#3163888">min</a></span><span class="op" id="3175135">(</span><span class="ident" id="3175136"><a href="/image/jpeg/writer.go.html#3174934">p</a></span><span class="op" id="3175137">.</span><span class="ident" id="3175138">Y</span><span class="op" id="3175139">+</span><span class="ident" id="3175140"><a href="/image/jpeg/writer.go.html#3175044">j</a></span><span class="op" id="3175141">,</span>&nbsp;<span class="ident" id="3175143"><a href="/image/jpeg/writer.go.html#3175005">ymax</a></span><span class="op" id="3175147">)</span><span class="op" id="3175148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175153"><a href="/image/jpeg/writer.go.html#3174949">yBlock</a></span><span class="op" id="3175159">[</span><span class="num" id="3175160">8</span><span class="op" id="3175161">*</span><span class="ident" id="3175162"><a href="/image/jpeg/writer.go.html#3175044">j</a></span><span class="op" id="3175163">+</span><span class="ident" id="3175164"><a href="/image/jpeg/writer.go.html#3175071">i</a></span><span class="op" id="3175165">]</span>&nbsp;<span class="op" id="3175167">=</span>&nbsp;<span class="builtintype" id="3175169">int32</span><span class="op" id="3175174">(</span><span class="ident" id="3175175"><a href="/image/jpeg/writer.go.html#3175026">pix</a></span><span class="op" id="3175178">[</span><span class="ident" id="3175179"><a href="/image/jpeg/writer.go.html#3175095">idx</a></span><span class="op" id="3175182">]</span><span class="op" id="3175183">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175190">}</span><br>
<span class="lineno"></span><span class="op" id="3175192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3175195">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="3175269">func</span>&nbsp;<span class="ident" id="3175274">rgbaToYCbCr</span><span class="op" id="3175285">(</span><span class="ident" id="3175286">m</span>&nbsp;<span class="op" id="3175288">*</span><span class="ident" id="3175289"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3175294">.</span><span class="ident" id="3175295">RGBA</span><span class="op" id="3175299">,</span>&nbsp;<span class="ident" id="3175301">p</span>&nbsp;<span class="ident" id="3175303"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3175308">.</span><span class="ident" id="3175309">Point</span><span class="op" id="3175314">,</span>&nbsp;<span class="ident" id="3175316">yBlock</span><span class="op" id="3175322">,</span>&nbsp;<span class="ident" id="3175324">cbBlock</span><span class="op" id="3175331">,</span>&nbsp;<span class="ident" id="3175333">crBlock</span>&nbsp;<span class="op" id="3175341">*</span><span class="ident" id="3175342"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3175347">)</span>&nbsp;<span class="op" id="3175349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175352">b</span>&nbsp;<span class="op" id="3175354">:=</span>&nbsp;<span class="ident" id="3175357"><a href="/image/jpeg/writer.go.html#3175286">m</a></span><span class="op" id="3175358">.</span><span class="ident" id="3175359">Bounds</span><span class="op" id="3175365">(</span><span class="op" id="3175366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175369">xmax</span>&nbsp;<span class="op" id="3175374">:=</span>&nbsp;<span class="ident" id="3175377"><a href="/image/jpeg/writer.go.html#3175352">b</a></span><span class="op" id="3175378">.</span><span class="ident" id="3175379">Max</span><span class="op" id="3175382">.</span><span class="ident" id="3175383">X</span>&nbsp;<span class="op" id="3175385">-</span>&nbsp;<span class="num" id="3175387">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175390">ymax</span>&nbsp;<span class="op" id="3175395">:=</span>&nbsp;<span class="ident" id="3175398"><a href="/image/jpeg/writer.go.html#3175352">b</a></span><span class="op" id="3175399">.</span><span class="ident" id="3175400">Max</span><span class="op" id="3175403">.</span><span class="ident" id="3175404">Y</span>&nbsp;<span class="op" id="3175406">-</span>&nbsp;<span class="num" id="3175408">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175411">for</span>&nbsp;<span class="ident" id="3175415">j</span>&nbsp;<span class="op" id="3175417">:=</span>&nbsp;<span class="num" id="3175420">0</span><span class="op" id="3175421">;</span>&nbsp;<span class="ident" id="3175423"><a href="/image/jpeg/writer.go.html#3175415">j</a></span>&nbsp;<span class="op" id="3175425">&lt;</span>&nbsp;<span class="num" id="3175427">8</span><span class="op" id="3175428">;</span>&nbsp;<span class="ident" id="3175430"><a href="/image/jpeg/writer.go.html#3175415">j</a></span><span class="op" id="3175431">++</span>&nbsp;<span class="op" id="3175434">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175438">sj</span>&nbsp;<span class="op" id="3175441">:=</span>&nbsp;<span class="ident" id="3175444"><a href="/image/jpeg/writer.go.html#3175301">p</a></span><span class="op" id="3175445">.</span><span class="ident" id="3175446">Y</span>&nbsp;<span class="op" id="3175448">+</span>&nbsp;<span class="ident" id="3175450"><a href="/image/jpeg/writer.go.html#3175415">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175454">if</span>&nbsp;<span class="ident" id="3175457"><a href="/image/jpeg/writer.go.html#3175438">sj</a></span>&nbsp;<span class="op" id="3175460">&gt;</span>&nbsp;<span class="ident" id="3175462"><a href="/image/jpeg/writer.go.html#3175390">ymax</a></span>&nbsp;<span class="op" id="3175467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175472"><a href="/image/jpeg/writer.go.html#3175438">sj</a></span>&nbsp;<span class="op" id="3175475">=</span>&nbsp;<span class="ident" id="3175477"><a href="/image/jpeg/writer.go.html#3175390">ymax</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175488">offset</span>&nbsp;<span class="op" id="3175495">:=</span>&nbsp;<span class="op" id="3175498">(</span><span class="ident" id="3175499"><a href="/image/jpeg/writer.go.html#3175438">sj</a></span><span class="op" id="3175501">-</span><span class="ident" id="3175502"><a href="/image/jpeg/writer.go.html#3175352">b</a></span><span class="op" id="3175503">.</span><span class="ident" id="3175504">Min</span><span class="op" id="3175507">.</span><span class="ident" id="3175508">Y</span><span class="op" id="3175509">)</span><span class="op" id="3175510">*</span><span class="ident" id="3175511"><a href="/image/jpeg/writer.go.html#3175286">m</a></span><span class="op" id="3175512">.</span><span class="ident" id="3175513">Stride</span>&nbsp;<span class="op" id="3175520">-</span>&nbsp;<span class="ident" id="3175522"><a href="/image/jpeg/writer.go.html#3175352">b</a></span><span class="op" id="3175523">.</span><span class="ident" id="3175524">Min</span><span class="op" id="3175527">.</span><span class="ident" id="3175528">X</span><span class="op" id="3175529">*</span><span class="num" id="3175530">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175534">for</span>&nbsp;<span class="ident" id="3175538">i</span>&nbsp;<span class="op" id="3175540">:=</span>&nbsp;<span class="num" id="3175543">0</span><span class="op" id="3175544">;</span>&nbsp;<span class="ident" id="3175546"><a href="/image/jpeg/writer.go.html#3175538">i</a></span>&nbsp;<span class="op" id="3175548">&lt;</span>&nbsp;<span class="num" id="3175550">8</span><span class="op" id="3175551">;</span>&nbsp;<span class="ident" id="3175553"><a href="/image/jpeg/writer.go.html#3175538">i</a></span><span class="op" id="3175554">++</span>&nbsp;<span class="op" id="3175557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175562">sx</span>&nbsp;<span class="op" id="3175565">:=</span>&nbsp;<span class="ident" id="3175568"><a href="/image/jpeg/writer.go.html#3175301">p</a></span><span class="op" id="3175569">.</span><span class="ident" id="3175570">X</span>&nbsp;<span class="op" id="3175572">+</span>&nbsp;<span class="ident" id="3175574"><a href="/image/jpeg/writer.go.html#3175538">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175579">if</span>&nbsp;<span class="ident" id="3175582"><a href="/image/jpeg/writer.go.html#3175562">sx</a></span>&nbsp;<span class="op" id="3175585">&gt;</span>&nbsp;<span class="ident" id="3175587"><a href="/image/jpeg/writer.go.html#3175369">xmax</a></span>&nbsp;<span class="op" id="3175592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175598"><a href="/image/jpeg/writer.go.html#3175562">sx</a></span>&nbsp;<span class="op" id="3175601">=</span>&nbsp;<span class="ident" id="3175603"><a href="/image/jpeg/writer.go.html#3175369">xmax</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175611">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175616">pix</span>&nbsp;<span class="op" id="3175620">:=</span>&nbsp;<span class="ident" id="3175623"><a href="/image/jpeg/writer.go.html#3175286">m</a></span><span class="op" id="3175624">.</span><span class="ident" id="3175625">Pix</span><span class="op" id="3175628">[</span><span class="ident" id="3175629"><a href="/image/jpeg/writer.go.html#3175488">offset</a></span><span class="op" id="3175635">+</span><span class="ident" id="3175636"><a href="/image/jpeg/writer.go.html#3175562">sx</a></span><span class="op" id="3175638">*</span><span class="num" id="3175639">4</span><span class="op" id="3175640">:</span><span class="op" id="3175641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175646">yy</span><span class="op" id="3175648">,</span>&nbsp;<span class="ident" id="3175650">cb</span><span class="op" id="3175652">,</span>&nbsp;<span class="ident" id="3175654">cr</span>&nbsp;<span class="op" id="3175657">:=</span>&nbsp;<span class="ident" id="3175660"><a href="/image/jpeg/writer.go.html#3163816">color</a></span><span class="op" id="3175665">.</span><span class="ident" id="3175666">RGBToYCbCr</span><span class="op" id="3175676">(</span><span class="ident" id="3175677"><a href="/image/jpeg/writer.go.html#3175616">pix</a></span><span class="op" id="3175680">[</span><span class="num" id="3175681">0</span><span class="op" id="3175682">]</span><span class="op" id="3175683">,</span>&nbsp;<span class="ident" id="3175685"><a href="/image/jpeg/writer.go.html#3175616">pix</a></span><span class="op" id="3175688">[</span><span class="num" id="3175689">1</span><span class="op" id="3175690">]</span><span class="op" id="3175691">,</span>&nbsp;<span class="ident" id="3175693"><a href="/image/jpeg/writer.go.html#3175616">pix</a></span><span class="op" id="3175696">[</span><span class="num" id="3175697">2</span><span class="op" id="3175698">]</span><span class="op" id="3175699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175704"><a href="/image/jpeg/writer.go.html#3175316">yBlock</a></span><span class="op" id="3175710">[</span><span class="num" id="3175711">8</span><span class="op" id="3175712">*</span><span class="ident" id="3175713"><a href="/image/jpeg/writer.go.html#3175415">j</a></span><span class="op" id="3175714">+</span><span class="ident" id="3175715"><a href="/image/jpeg/writer.go.html#3175538">i</a></span><span class="op" id="3175716">]</span>&nbsp;<span class="op" id="3175718">=</span>&nbsp;<span class="builtintype" id="3175720">int32</span><span class="op" id="3175725">(</span><span class="ident" id="3175726"><a href="/image/jpeg/writer.go.html#3175646">yy</a></span><span class="op" id="3175728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175733"><a href="/image/jpeg/writer.go.html#3175324">cbBlock</a></span><span class="op" id="3175740">[</span><span class="num" id="3175741">8</span><span class="op" id="3175742">*</span><span class="ident" id="3175743"><a href="/image/jpeg/writer.go.html#3175415">j</a></span><span class="op" id="3175744">+</span><span class="ident" id="3175745"><a href="/image/jpeg/writer.go.html#3175538">i</a></span><span class="op" id="3175746">]</span>&nbsp;<span class="op" id="3175748">=</span>&nbsp;<span class="builtintype" id="3175750">int32</span><span class="op" id="3175755">(</span><span class="ident" id="3175756"><a href="/image/jpeg/writer.go.html#3175650">cb</a></span><span class="op" id="3175758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175763"><a href="/image/jpeg/writer.go.html#3175333">crBlock</a></span><span class="op" id="3175770">[</span><span class="num" id="3175771">8</span><span class="op" id="3175772">*</span><span class="ident" id="3175773"><a href="/image/jpeg/writer.go.html#3175415">j</a></span><span class="op" id="3175774">+</span><span class="ident" id="3175775"><a href="/image/jpeg/writer.go.html#3175538">i</a></span><span class="op" id="3175776">]</span>&nbsp;<span class="op" id="3175778">=</span>&nbsp;<span class="builtintype" id="3175780">int32</span><span class="op" id="3175785">(</span><span class="ident" id="3175786"><a href="/image/jpeg/writer.go.html#3175654">cr</a></span><span class="op" id="3175788">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175795">}</span><br>
<span class="lineno"></span><span class="op" id="3175797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3175800">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="3175876">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="3175890">func</span>&nbsp;<span class="ident" id="3175895">scale</span><span class="op" id="3175900">(</span><span class="ident" id="3175901">dst</span>&nbsp;<span class="op" id="3175905">*</span><span class="ident" id="3175906"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3175911">,</span>&nbsp;<span class="ident" id="3175913">src</span>&nbsp;<span class="op" id="3175917">*</span><span class="op" id="3175918">[</span><span class="num" id="3175919">4</span><span class="op" id="3175920">]</span><span class="ident" id="3175921"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3175926">)</span>&nbsp;<span class="op" id="3175928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175931">for</span>&nbsp;<span class="ident" id="3175935">i</span>&nbsp;<span class="op" id="3175937">:=</span>&nbsp;<span class="num" id="3175940">0</span><span class="op" id="3175941">;</span>&nbsp;<span class="ident" id="3175943"><a href="/image/jpeg/writer.go.html#3175935">i</a></span>&nbsp;<span class="op" id="3175945">&lt;</span>&nbsp;<span class="num" id="3175947">4</span><span class="op" id="3175948">;</span>&nbsp;<span class="ident" id="3175950"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3175951">++</span>&nbsp;<span class="op" id="3175954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175958">dstOff</span>&nbsp;<span class="op" id="3175965">:=</span>&nbsp;<span class="op" id="3175968">(</span><span class="ident" id="3175969"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3175970">&amp;</span><span class="num" id="3175971">2</span><span class="op" id="3175972">)</span><span class="op" id="3175973">&lt;&lt;</span><span class="num" id="3175975">4</span>&nbsp;<span class="op" id="3175977">|</span>&nbsp;<span class="op" id="3175979">(</span><span class="ident" id="3175980"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3175981">&amp;</span><span class="num" id="3175982">1</span><span class="op" id="3175983">)</span><span class="op" id="3175984">&lt;&lt;</span><span class="num" id="3175986">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175990">for</span>&nbsp;<span class="ident" id="3175994">y</span>&nbsp;<span class="op" id="3175996">:=</span>&nbsp;<span class="num" id="3175999">0</span><span class="op" id="3176000">;</span>&nbsp;<span class="ident" id="3176002"><a href="/image/jpeg/writer.go.html#3175994">y</a></span>&nbsp;<span class="op" id="3176004">&lt;</span>&nbsp;<span class="num" id="3176006">4</span><span class="op" id="3176007">;</span>&nbsp;<span class="ident" id="3176009"><a href="/image/jpeg/writer.go.html#3175994">y</a></span><span class="op" id="3176010">++</span>&nbsp;<span class="op" id="3176013">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176018">for</span>&nbsp;<span class="ident" id="3176022">x</span>&nbsp;<span class="op" id="3176024">:=</span>&nbsp;<span class="num" id="3176027">0</span><span class="op" id="3176028">;</span>&nbsp;<span class="ident" id="3176030"><a href="/image/jpeg/writer.go.html#3176022">x</a></span>&nbsp;<span class="op" id="3176032">&lt;</span>&nbsp;<span class="num" id="3176034">4</span><span class="op" id="3176035">;</span>&nbsp;<span class="ident" id="3176037"><a href="/image/jpeg/writer.go.html#3176022">x</a></span><span class="op" id="3176038">++</span>&nbsp;<span class="op" id="3176041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176047">j</span>&nbsp;<span class="op" id="3176049">:=</span>&nbsp;<span class="num" id="3176052">16</span><span class="op" id="3176054">*</span><span class="ident" id="3176055"><a href="/image/jpeg/writer.go.html#3175994">y</a></span>&nbsp;<span class="op" id="3176057">+</span>&nbsp;<span class="num" id="3176059">2</span><span class="op" id="3176060">*</span><span class="ident" id="3176061"><a href="/image/jpeg/writer.go.html#3176022">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176067">sum</span>&nbsp;<span class="op" id="3176071">:=</span>&nbsp;<span class="ident" id="3176074"><a href="/image/jpeg/writer.go.html#3175913">src</a></span><span class="op" id="3176077">[</span><span class="ident" id="3176078"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3176079">]</span><span class="op" id="3176080">[</span><span class="ident" id="3176081"><a href="/image/jpeg/writer.go.html#3176047">j</a></span><span class="op" id="3176082">]</span>&nbsp;<span class="op" id="3176084">+</span>&nbsp;<span class="ident" id="3176086"><a href="/image/jpeg/writer.go.html#3175913">src</a></span><span class="op" id="3176089">[</span><span class="ident" id="3176090"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3176091">]</span><span class="op" id="3176092">[</span><span class="ident" id="3176093"><a href="/image/jpeg/writer.go.html#3176047">j</a></span><span class="op" id="3176094">+</span><span class="num" id="3176095">1</span><span class="op" id="3176096">]</span>&nbsp;<span class="op" id="3176098">+</span>&nbsp;<span class="ident" id="3176100"><a href="/image/jpeg/writer.go.html#3175913">src</a></span><span class="op" id="3176103">[</span><span class="ident" id="3176104"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3176105">]</span><span class="op" id="3176106">[</span><span class="ident" id="3176107"><a href="/image/jpeg/writer.go.html#3176047">j</a></span><span class="op" id="3176108">+</span><span class="num" id="3176109">8</span><span class="op" id="3176110">]</span>&nbsp;<span class="op" id="3176112">+</span>&nbsp;<span class="ident" id="3176114"><a href="/image/jpeg/writer.go.html#3175913">src</a></span><span class="op" id="3176117">[</span><span class="ident" id="3176118"><a href="/image/jpeg/writer.go.html#3175935">i</a></span><span class="op" id="3176119">]</span><span class="op" id="3176120">[</span><span class="ident" id="3176121"><a href="/image/jpeg/writer.go.html#3176047">j</a></span><span class="op" id="3176122">+</span><span class="num" id="3176123">9</span><span class="op" id="3176124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176130"><a href="/image/jpeg/writer.go.html#3175901">dst</a></span><span class="op" id="3176133">[</span><span class="num" id="3176134">8</span><span class="op" id="3176135">*</span><span class="ident" id="3176136"><a href="/image/jpeg/writer.go.html#3175994">y</a></span><span class="op" id="3176137">+</span><span class="ident" id="3176138"><a href="/image/jpeg/writer.go.html#3176022">x</a></span><span class="op" id="3176139">+</span><span class="ident" id="3176140"><a href="/image/jpeg/writer.go.html#3175958">dstOff</a></span><span class="op" id="3176146">]</span>&nbsp;<span class="op" id="3176148">=</span>&nbsp;<span class="op" id="3176150">(</span><span class="ident" id="3176151"><a href="/image/jpeg/writer.go.html#3176067">sum</a></span>&nbsp;<span class="op" id="3176155">+</span>&nbsp;<span class="num" id="3176157">2</span><span class="op" id="3176158">)</span>&nbsp;<span class="op" id="3176160">&gt;&gt;</span>&nbsp;<span class="num" id="3176163">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176168">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176175">}</span><br>
<span class="lineno"></span><span class="op" id="3176177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3176180">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="3176244">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176279">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176317">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176377">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3176448">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="3176523">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="3176566">var</span>&nbsp;<span class="ident" id="3176570">sosHeaderY</span>&nbsp;<span class="op" id="3176581">=</span>&nbsp;<span class="op" id="3176583">[</span><span class="op" id="3176584">]</span><span class="builtintype" id="3176585">byte</span><span class="op" id="3176589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3176592">0xff</span><span class="op" id="3176596">,</span>&nbsp;<span class="num" id="3176598">0xda</span><span class="op" id="3176602">,</span>&nbsp;<span class="num" id="3176604">0x00</span><span class="op" id="3176608">,</span>&nbsp;<span class="num" id="3176610">0x08</span><span class="op" id="3176614">,</span>&nbsp;<span class="num" id="3176616">0x01</span><span class="op" id="3176620">,</span>&nbsp;<span class="num" id="3176622">0x01</span><span class="op" id="3176626">,</span>&nbsp;<span class="num" id="3176628">0x00</span><span class="op" id="3176632">,</span>&nbsp;<span class="num" id="3176634">0x00</span><span class="op" id="3176638">,</span>&nbsp;<span class="num" id="3176640">0x3f</span><span class="op" id="3176644">,</span>&nbsp;<span class="num" id="3176646">0x00</span><span class="op" id="3176650">,</span><br>
<span class="lineno"></span><span class="op" id="3176652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="3176655">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="3176724">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176759">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176797">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176857">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="3176917">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3176977">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3177048">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="3177123">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="3177166">var</span>&nbsp;<span class="ident" id="3177170">sosHeaderYCbCr</span>&nbsp;<span class="op" id="3177185">=</span>&nbsp;<span class="op" id="3177187">[</span><span class="op" id="3177188">]</span><span class="builtintype" id="3177189">byte</span><span class="op" id="3177193">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3177196">0xff</span><span class="op" id="3177200">,</span>&nbsp;<span class="num" id="3177202">0xda</span><span class="op" id="3177206">,</span>&nbsp;<span class="num" id="3177208">0x00</span><span class="op" id="3177212">,</span>&nbsp;<span class="num" id="3177214">0x0c</span><span class="op" id="3177218">,</span>&nbsp;<span class="num" id="3177220">0x03</span><span class="op" id="3177224">,</span>&nbsp;<span class="num" id="3177226">0x01</span><span class="op" id="3177230">,</span>&nbsp;<span class="num" id="3177232">0x00</span><span class="op" id="3177236">,</span>&nbsp;<span class="num" id="3177238">0x02</span><span class="op" id="3177242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3177245">0x11</span><span class="op" id="3177249">,</span>&nbsp;<span class="num" id="3177251">0x03</span><span class="op" id="3177255">,</span>&nbsp;<span class="num" id="3177257">0x11</span><span class="op" id="3177261">,</span>&nbsp;<span class="num" id="3177263">0x00</span><span class="op" id="3177267">,</span>&nbsp;<span class="num" id="3177269">0x3f</span><span class="op" id="3177273">,</span>&nbsp;<span class="num" id="3177275">0x00</span><span class="op" id="3177279">,</span><br>
<span class="lineno"></span><span class="op" id="3177281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3177284">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="3177327">func</span>&nbsp;<span class="op" id="3177332">(</span><span class="ident" id="3177333">e</span>&nbsp;<span class="op" id="3177335">*</span><span class="ident" id="3177336"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><span class="op" id="3177343">)</span>&nbsp;<span class="ident" id="3177345">writeSOS</span><span class="op" id="3177353">(</span><span class="ident" id="3177354">m</span>&nbsp;<span class="ident" id="3177356"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3177361">.</span><span class="ident" id="3177362">Image</span><span class="op" id="3177367">)</span>&nbsp;<span class="op" id="3177369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177372">switch</span>&nbsp;<span class="ident" id="3177379"><a href="/image/jpeg/writer.go.html#3177354">m</a></span><span class="op" id="3177380">.</span><span class="op" id="3177381">(</span><span class="keyword" id="3177382">type</span><span class="op" id="3177386">)</span>&nbsp;<span class="op" id="3177388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177391">case</span>&nbsp;<span class="op" id="3177396">*</span><span class="ident" id="3177397"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3177402">.</span><span class="ident" id="3177403">Gray</span><span class="op" id="3177407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177411"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3177412">.</span><span class="ident" id="3177413">write</span><span class="op" id="3177418">(</span><span class="ident" id="3177419"><a href="/image/jpeg/writer.go.html#3176570">sosHeaderY</a></span><span class="op" id="3177429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177432">default</span><span class="op" id="3177439">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177443"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3177444">.</span><span class="ident" id="3177445">write</span><span class="op" id="3177450">(</span><span class="ident" id="3177451"><a href="/image/jpeg/writer.go.html#3177170">sosHeaderYCbCr</a></span><span class="op" id="3177465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3177468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177471">var</span>&nbsp;<span class="op" id="3177475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177479">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177526">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177578">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177585"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177593">cb</span><span class="op" id="3177595">,</span>&nbsp;<span class="ident" id="3177597">cr</span>&nbsp;<span class="op" id="3177600">[</span><span class="num" id="3177601">4</span><span class="op" id="3177602">]</span><span class="ident" id="3177603"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177611">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177649">prevDCY</span><span class="op" id="3177656">,</span>&nbsp;<span class="ident" id="3177658">prevDCCb</span><span class="op" id="3177666">,</span>&nbsp;<span class="ident" id="3177668">prevDCCr</span>&nbsp;<span class="builtintype" id="3177677">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3177684">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177687">bounds</span>&nbsp;<span class="op" id="3177694">:=</span>&nbsp;<span class="ident" id="3177697"><a href="/image/jpeg/writer.go.html#3177354">m</a></span><span class="op" id="3177698">.</span><span class="ident" id="3177699">Bounds</span><span class="op" id="3177705">(</span><span class="op" id="3177706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177709">switch</span>&nbsp;<span class="ident" id="3177716">m</span>&nbsp;<span class="op" id="3177718">:=</span>&nbsp;<span class="ident" id="3177721"><a href="/image/jpeg/writer.go.html#3177354">m</a></span><span class="op" id="3177722">.</span><span class="op" id="3177723">(</span><span class="keyword" id="3177724">type</span><span class="op" id="3177728">)</span>&nbsp;<span class="op" id="3177730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177733">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177795">case</span>&nbsp;<span class="op" id="3177800">*</span><span class="ident" id="3177801"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3177806">.</span><span class="ident" id="3177807">Gray</span><span class="op" id="3177811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177815">for</span>&nbsp;<span class="ident" id="3177819">y</span>&nbsp;<span class="op" id="3177821">:=</span>&nbsp;<span class="ident" id="3177824"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3177830">.</span><span class="ident" id="3177831">Min</span><span class="op" id="3177834">.</span><span class="ident" id="3177835">Y</span><span class="op" id="3177836">;</span>&nbsp;<span class="ident" id="3177838"><a href="/image/jpeg/writer.go.html#3177819">y</a></span>&nbsp;<span class="op" id="3177840">&lt;</span>&nbsp;<span class="ident" id="3177842"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3177848">.</span><span class="ident" id="3177849">Max</span><span class="op" id="3177852">.</span><span class="ident" id="3177853">Y</span><span class="op" id="3177854">;</span>&nbsp;<span class="ident" id="3177856"><a href="/image/jpeg/writer.go.html#3177819">y</a></span>&nbsp;<span class="op" id="3177858">+=</span>&nbsp;<span class="num" id="3177861">8</span>&nbsp;<span class="op" id="3177863">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3177868">for</span>&nbsp;<span class="ident" id="3177872">x</span>&nbsp;<span class="op" id="3177874">:=</span>&nbsp;<span class="ident" id="3177877"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3177883">.</span><span class="ident" id="3177884">Min</span><span class="op" id="3177887">.</span><span class="ident" id="3177888">X</span><span class="op" id="3177889">;</span>&nbsp;<span class="ident" id="3177891"><a href="/image/jpeg/writer.go.html#3177872">x</a></span>&nbsp;<span class="op" id="3177893">&lt;</span>&nbsp;<span class="ident" id="3177895"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3177901">.</span><span class="ident" id="3177902">Max</span><span class="op" id="3177905">.</span><span class="ident" id="3177906">X</span><span class="op" id="3177907">;</span>&nbsp;<span class="ident" id="3177909"><a href="/image/jpeg/writer.go.html#3177872">x</a></span>&nbsp;<span class="op" id="3177911">+=</span>&nbsp;<span class="num" id="3177914">8</span>&nbsp;<span class="op" id="3177916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177922">p</span>&nbsp;<span class="op" id="3177924">:=</span>&nbsp;<span class="ident" id="3177927"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3177932">.</span><span class="ident" id="3177933">Pt</span><span class="op" id="3177935">(</span><span class="ident" id="3177936"><a href="/image/jpeg/writer.go.html#3177872">x</a></span><span class="op" id="3177937">,</span>&nbsp;<span class="ident" id="3177939"><a href="/image/jpeg/writer.go.html#3177819">y</a></span><span class="op" id="3177940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177946"><a href="/image/jpeg/writer.go.html#3174911">grayToY</a></span><span class="op" id="3177953">(</span><span class="ident" id="3177954"><a href="/image/jpeg/writer.go.html#3177716">m</a></span><span class="op" id="3177955">,</span>&nbsp;<span class="ident" id="3177957"><a href="/image/jpeg/writer.go.html#3177922">p</a></span><span class="op" id="3177958">,</span>&nbsp;<span class="op" id="3177960">&amp;</span><span class="ident" id="3177961"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3177962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177968"><a href="/image/jpeg/writer.go.html#3177649">prevDCY</a></span>&nbsp;<span class="op" id="3177976">=</span>&nbsp;<span class="ident" id="3177978"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3177979">.</span><span class="ident" id="3177980">writeBlock</span><span class="op" id="3177990">(</span><span class="op" id="3177991">&amp;</span><span class="ident" id="3177992"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3177993">,</span>&nbsp;<span class="num" id="3177995">0</span><span class="op" id="3177996">,</span>&nbsp;<span class="ident" id="3177998"><a href="/image/jpeg/writer.go.html#3177649">prevDCY</a></span><span class="op" id="3178005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178010">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178017">default</span><span class="op" id="3178024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178028">rgba</span><span class="op" id="3178032">,</span>&nbsp;<span class="ident" id="3178034">_</span>&nbsp;<span class="op" id="3178036">:=</span>&nbsp;<span class="ident" id="3178039"><a href="/image/jpeg/writer.go.html#3177716">m</a></span><span class="op" id="3178040">.</span><span class="op" id="3178041">(</span><span class="op" id="3178042">*</span><span class="ident" id="3178043"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3178048">.</span><span class="ident" id="3178049">RGBA</span><span class="op" id="3178053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178057">for</span>&nbsp;<span class="ident" id="3178061">y</span>&nbsp;<span class="op" id="3178063">:=</span>&nbsp;<span class="ident" id="3178066"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3178072">.</span><span class="ident" id="3178073">Min</span><span class="op" id="3178076">.</span><span class="ident" id="3178077">Y</span><span class="op" id="3178078">;</span>&nbsp;<span class="ident" id="3178080"><a href="/image/jpeg/writer.go.html#3178061">y</a></span>&nbsp;<span class="op" id="3178082">&lt;</span>&nbsp;<span class="ident" id="3178084"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3178090">.</span><span class="ident" id="3178091">Max</span><span class="op" id="3178094">.</span><span class="ident" id="3178095">Y</span><span class="op" id="3178096">;</span>&nbsp;<span class="ident" id="3178098"><a href="/image/jpeg/writer.go.html#3178061">y</a></span>&nbsp;<span class="op" id="3178100">+=</span>&nbsp;<span class="num" id="3178103">16</span>&nbsp;<span class="op" id="3178106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178111">for</span>&nbsp;<span class="ident" id="3178115">x</span>&nbsp;<span class="op" id="3178117">:=</span>&nbsp;<span class="ident" id="3178120"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3178126">.</span><span class="ident" id="3178127">Min</span><span class="op" id="3178130">.</span><span class="ident" id="3178131">X</span><span class="op" id="3178132">;</span>&nbsp;<span class="ident" id="3178134"><a href="/image/jpeg/writer.go.html#3178115">x</a></span>&nbsp;<span class="op" id="3178136">&lt;</span>&nbsp;<span class="ident" id="3178138"><a href="/image/jpeg/writer.go.html#3177687">bounds</a></span><span class="op" id="3178144">.</span><span class="ident" id="3178145">Max</span><span class="op" id="3178148">.</span><span class="ident" id="3178149">X</span><span class="op" id="3178150">;</span>&nbsp;<span class="ident" id="3178152"><a href="/image/jpeg/writer.go.html#3178115">x</a></span>&nbsp;<span class="op" id="3178154">+=</span>&nbsp;<span class="num" id="3178157">16</span>&nbsp;<span class="op" id="3178160">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178166">for</span>&nbsp;<span class="ident" id="3178170">i</span>&nbsp;<span class="op" id="3178172">:=</span>&nbsp;<span class="num" id="3178175">0</span><span class="op" id="3178176">;</span>&nbsp;<span class="ident" id="3178178"><a href="/image/jpeg/writer.go.html#3178170">i</a></span>&nbsp;<span class="op" id="3178180">&lt;</span>&nbsp;<span class="num" id="3178182">4</span><span class="op" id="3178183">;</span>&nbsp;<span class="ident" id="3178185"><a href="/image/jpeg/writer.go.html#3178170">i</a></span><span class="op" id="3178186">++</span>&nbsp;<span class="op" id="3178189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178196">xOff</span>&nbsp;<span class="op" id="3178201">:=</span>&nbsp;<span class="op" id="3178204">(</span><span class="ident" id="3178205"><a href="/image/jpeg/writer.go.html#3178170">i</a></span>&nbsp;<span class="op" id="3178207">&amp;</span>&nbsp;<span class="num" id="3178209">1</span><span class="op" id="3178210">)</span>&nbsp;<span class="op" id="3178212">*</span>&nbsp;<span class="num" id="3178214">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178221">yOff</span>&nbsp;<span class="op" id="3178226">:=</span>&nbsp;<span class="op" id="3178229">(</span><span class="ident" id="3178230"><a href="/image/jpeg/writer.go.html#3178170">i</a></span>&nbsp;<span class="op" id="3178232">&amp;</span>&nbsp;<span class="num" id="3178234">2</span><span class="op" id="3178235">)</span>&nbsp;<span class="op" id="3178237">*</span>&nbsp;<span class="num" id="3178239">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178246">p</span>&nbsp;<span class="op" id="3178248">:=</span>&nbsp;<span class="ident" id="3178251"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3178256">.</span><span class="ident" id="3178257">Pt</span><span class="op" id="3178259">(</span><span class="ident" id="3178260"><a href="/image/jpeg/writer.go.html#3178115">x</a></span><span class="op" id="3178261">+</span><span class="ident" id="3178262"><a href="/image/jpeg/writer.go.html#3178196">xOff</a></span><span class="op" id="3178266">,</span>&nbsp;<span class="ident" id="3178268"><a href="/image/jpeg/writer.go.html#3178061">y</a></span><span class="op" id="3178269">+</span><span class="ident" id="3178270"><a href="/image/jpeg/writer.go.html#3178221">yOff</a></span><span class="op" id="3178274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178281">if</span>&nbsp;<span class="ident" id="3178284"><a href="/image/jpeg/writer.go.html#3178028">rgba</a></span>&nbsp;<span class="op" id="3178289">!=</span>&nbsp;<span class="ident" id="3178292">nil</span>&nbsp;<span class="op" id="3178296">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178304"><a href="/image/jpeg/writer.go.html#3175274">rgbaToYCbCr</a></span><span class="op" id="3178315">(</span><span class="ident" id="3178316"><a href="/image/jpeg/writer.go.html#3178028">rgba</a></span><span class="op" id="3178320">,</span>&nbsp;<span class="ident" id="3178322"><a href="/image/jpeg/writer.go.html#3178246">p</a></span><span class="op" id="3178323">,</span>&nbsp;<span class="op" id="3178325">&amp;</span><span class="ident" id="3178326"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178327">,</span>&nbsp;<span class="op" id="3178329">&amp;</span><span class="ident" id="3178330"><a href="/image/jpeg/writer.go.html#3177593">cb</a></span><span class="op" id="3178332">[</span><span class="ident" id="3178333"><a href="/image/jpeg/writer.go.html#3178170">i</a></span><span class="op" id="3178334">]</span><span class="op" id="3178335">,</span>&nbsp;<span class="op" id="3178337">&amp;</span><span class="ident" id="3178338"><a href="/image/jpeg/writer.go.html#3177597">cr</a></span><span class="op" id="3178340">[</span><span class="ident" id="3178341"><a href="/image/jpeg/writer.go.html#3178170">i</a></span><span class="op" id="3178342">]</span><span class="op" id="3178343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178350">}</span>&nbsp;<span class="keyword" id="3178352">else</span>&nbsp;<span class="op" id="3178357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178365"><a href="/image/jpeg/writer.go.html#3174408">toYCbCr</a></span><span class="op" id="3178372">(</span><span class="ident" id="3178373"><a href="/image/jpeg/writer.go.html#3177716">m</a></span><span class="op" id="3178374">,</span>&nbsp;<span class="ident" id="3178376"><a href="/image/jpeg/writer.go.html#3178246">p</a></span><span class="op" id="3178377">,</span>&nbsp;<span class="op" id="3178379">&amp;</span><span class="ident" id="3178380"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178381">,</span>&nbsp;<span class="op" id="3178383">&amp;</span><span class="ident" id="3178384"><a href="/image/jpeg/writer.go.html#3177593">cb</a></span><span class="op" id="3178386">[</span><span class="ident" id="3178387"><a href="/image/jpeg/writer.go.html#3178170">i</a></span><span class="op" id="3178388">]</span><span class="op" id="3178389">,</span>&nbsp;<span class="op" id="3178391">&amp;</span><span class="ident" id="3178392"><a href="/image/jpeg/writer.go.html#3177597">cr</a></span><span class="op" id="3178394">[</span><span class="ident" id="3178395"><a href="/image/jpeg/writer.go.html#3178170">i</a></span><span class="op" id="3178396">]</span><span class="op" id="3178397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178411"><a href="/image/jpeg/writer.go.html#3177649">prevDCY</a></span>&nbsp;<span class="op" id="3178419">=</span>&nbsp;<span class="ident" id="3178421"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3178422">.</span><span class="ident" id="3178423">writeBlock</span><span class="op" id="3178433">(</span><span class="op" id="3178434">&amp;</span><span class="ident" id="3178435"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178436">,</span>&nbsp;<span class="num" id="3178438">0</span><span class="op" id="3178439">,</span>&nbsp;<span class="ident" id="3178441"><a href="/image/jpeg/writer.go.html#3177649">prevDCY</a></span><span class="op" id="3178448">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178460"><a href="/image/jpeg/writer.go.html#3175895">scale</a></span><span class="op" id="3178465">(</span><span class="op" id="3178466">&amp;</span><span class="ident" id="3178467"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178468">,</span>&nbsp;<span class="op" id="3178470">&amp;</span><span class="ident" id="3178471"><a href="/image/jpeg/writer.go.html#3177593">cb</a></span><span class="op" id="3178473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178479"><a href="/image/jpeg/writer.go.html#3177658">prevDCCb</a></span>&nbsp;<span class="op" id="3178488">=</span>&nbsp;<span class="ident" id="3178490"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3178491">.</span><span class="ident" id="3178492">writeBlock</span><span class="op" id="3178502">(</span><span class="op" id="3178503">&amp;</span><span class="ident" id="3178504"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178505">,</span>&nbsp;<span class="num" id="3178507">1</span><span class="op" id="3178508">,</span>&nbsp;<span class="ident" id="3178510"><a href="/image/jpeg/writer.go.html#3177658">prevDCCb</a></span><span class="op" id="3178518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178524"><a href="/image/jpeg/writer.go.html#3175895">scale</a></span><span class="op" id="3178529">(</span><span class="op" id="3178530">&amp;</span><span class="ident" id="3178531"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178532">,</span>&nbsp;<span class="op" id="3178534">&amp;</span><span class="ident" id="3178535"><a href="/image/jpeg/writer.go.html#3177597">cr</a></span><span class="op" id="3178537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178543"><a href="/image/jpeg/writer.go.html#3177668">prevDCCr</a></span>&nbsp;<span class="op" id="3178552">=</span>&nbsp;<span class="ident" id="3178554"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3178555">.</span><span class="ident" id="3178556">writeBlock</span><span class="op" id="3178566">(</span><span class="op" id="3178567">&amp;</span><span class="ident" id="3178568"><a href="/image/jpeg/writer.go.html#3177578">b</a></span><span class="op" id="3178569">,</span>&nbsp;<span class="num" id="3178571">1</span><span class="op" id="3178572">,</span>&nbsp;<span class="ident" id="3178574"><a href="/image/jpeg/writer.go.html#3177668">prevDCCr</a></span><span class="op" id="3178582">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3178597">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178629"><a href="/image/jpeg/writer.go.html#3177333">e</a></span><span class="op" id="3178630">.</span><span class="ident" id="3178631">emit</span><span class="op" id="3178635">(</span><span class="num" id="3178636">0x7f</span><span class="op" id="3178640">,</span>&nbsp;<span class="num" id="3178642">7</span><span class="op" id="3178643">)</span><br>
<span class="lineno">535</span><span class="op" id="3178645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3178648">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="3178709">const</span>&nbsp;<span class="ident" id="3178715">DefaultQuality</span>&nbsp;<span class="op" id="3178730">=</span>&nbsp;<span class="num" id="3178732">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="3178736">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="3178776">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="3178837">type</span>&nbsp;<span class="ident" id="3178842">Options</span>&nbsp;<span class="keyword" id="3178850">struct</span>&nbsp;<span class="op" id="3178857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178860">Quality</span>&nbsp;<span class="builtintype" id="3178868">int</span><br>
<span class="lineno"></span><span class="op" id="3178872">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3178875">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3178954">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="3179023">func</span>&nbsp;<span class="ident" id="3179028">Encode</span><span class="op" id="3179034">(</span><span class="ident" id="3179035">w</span>&nbsp;<span class="ident" id="3179037"><a href="/image/jpeg/writer.go.html#3163831">io</a></span><span class="op" id="3179039">.</span><span class="ident" id="3179040">Writer</span><span class="op" id="3179046">,</span>&nbsp;<span class="ident" id="3179048">m</span>&nbsp;<span class="ident" id="3179050"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3179055">.</span><span class="ident" id="3179056">Image</span><span class="op" id="3179061">,</span>&nbsp;<span class="ident" id="3179063">o</span>&nbsp;<span class="op" id="3179065">*</span><span class="ident" id="3179066"><a href="/image/jpeg/writer.go.html#3178842">Options</a></span><span class="op" id="3179073">)</span>&nbsp;<span class="builtintype" id="3179075">error</span>&nbsp;<span class="op" id="3179081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179084">b</span>&nbsp;<span class="op" id="3179086">:=</span>&nbsp;<span class="ident" id="3179089"><a href="/image/jpeg/writer.go.html#3179048">m</a></span><span class="op" id="3179090">.</span><span class="ident" id="3179091">Bounds</span><span class="op" id="3179097">(</span><span class="op" id="3179098">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179101">if</span>&nbsp;<span class="ident" id="3179104"><a href="/image/jpeg/writer.go.html#3179084">b</a></span><span class="op" id="3179105">.</span><span class="ident" id="3179106">Dx</span><span class="op" id="3179108">(</span><span class="op" id="3179109">)</span>&nbsp;<span class="op" id="3179111">&gt;=</span>&nbsp;<span class="num" id="3179114">1</span><span class="op" id="3179115">&lt;&lt;</span><span class="num" id="3179117">16</span>&nbsp;<span class="op" id="3179120">||</span>&nbsp;<span class="ident" id="3179123"><a href="/image/jpeg/writer.go.html#3179084">b</a></span><span class="op" id="3179124">.</span><span class="ident" id="3179125">Dy</span><span class="op" id="3179127">(</span><span class="op" id="3179128">)</span>&nbsp;<span class="op" id="3179130">&gt;=</span>&nbsp;<span class="num" id="3179133">1</span><span class="op" id="3179134">&lt;&lt;</span><span class="num" id="3179136">16</span>&nbsp;<span class="op" id="3179139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179143">return</span>&nbsp;<span class="ident" id="3179150"><a href="/image/jpeg/writer.go.html#3163797">errors</a></span><span class="op" id="3179156">.</span><span class="ident" id="3179157">New</span><span class="op" id="3179160">(</span><span class="string" id="3179161">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="3179197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179203">var</span>&nbsp;<span class="ident" id="3179207">e</span>&nbsp;<span class="ident" id="3179209"><a href="/image/jpeg/writer.go.html#3170112">encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179218">if</span>&nbsp;<span class="ident" id="3179221">ww</span><span class="op" id="3179223">,</span>&nbsp;<span class="ident" id="3179225">ok</span>&nbsp;<span class="op" id="3179228">:=</span>&nbsp;<span class="ident" id="3179231"><a href="/image/jpeg/writer.go.html#3179035">w</a></span><span class="op" id="3179232">.</span><span class="op" id="3179233">(</span><span class="ident" id="3179234"><a href="/image/jpeg/writer.go.html#3169996">writer</a></span><span class="op" id="3179240">)</span><span class="op" id="3179241">;</span>&nbsp;<span class="ident" id="3179243"><a href="/image/jpeg/writer.go.html#3179225">ok</a></span>&nbsp;<span class="op" id="3179246">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179250"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3179251">.</span><span class="ident" id="3179252">w</span>&nbsp;<span class="op" id="3179254">=</span>&nbsp;<span class="ident" id="3179256"><a href="/image/jpeg/writer.go.html#3179221">ww</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179260">}</span>&nbsp;<span class="keyword" id="3179262">else</span>&nbsp;<span class="op" id="3179267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179271"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3179272">.</span><span class="ident" id="3179273">w</span>&nbsp;<span class="op" id="3179275">=</span>&nbsp;<span class="ident" id="3179277"><a href="/image/jpeg/writer.go.html#3163788">bufio</a></span><span class="op" id="3179282">.</span><span class="ident" id="3179283">NewWriter</span><span class="op" id="3179292">(</span><span class="ident" id="3179293"><a href="/image/jpeg/writer.go.html#3179035">w</a></span><span class="op" id="3179294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179300">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179330">quality</span>&nbsp;<span class="op" id="3179338">:=</span>&nbsp;<span class="ident" id="3179341"><a href="/image/jpeg/writer.go.html#3178715">DefaultQuality</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179357">if</span>&nbsp;<span class="ident" id="3179360"><a href="/image/jpeg/writer.go.html#3179063">o</a></span>&nbsp;<span class="op" id="3179362">!=</span>&nbsp;<span class="ident" id="3179365">nil</span>&nbsp;<span class="op" id="3179369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179373"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span>&nbsp;<span class="op" id="3179381">=</span>&nbsp;<span class="ident" id="3179383"><a href="/image/jpeg/writer.go.html#3179063">o</a></span><span class="op" id="3179384">.</span><span class="ident" id="3179385">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179395">if</span>&nbsp;<span class="ident" id="3179398"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span>&nbsp;<span class="op" id="3179406">&lt;</span>&nbsp;<span class="num" id="3179408">1</span>&nbsp;<span class="op" id="3179410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179415"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span>&nbsp;<span class="op" id="3179423">=</span>&nbsp;<span class="num" id="3179425">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179429">}</span>&nbsp;<span class="keyword" id="3179431">else</span>&nbsp;<span class="keyword" id="3179436">if</span>&nbsp;<span class="ident" id="3179439"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span>&nbsp;<span class="op" id="3179447">&gt;</span>&nbsp;<span class="num" id="3179449">100</span>&nbsp;<span class="op" id="3179453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179458"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span>&nbsp;<span class="op" id="3179466">=</span>&nbsp;<span class="num" id="3179468">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179480">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179535">var</span>&nbsp;<span class="ident" id="3179539">scale</span>&nbsp;<span class="builtintype" id="3179545">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179550">if</span>&nbsp;<span class="ident" id="3179553"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span>&nbsp;<span class="op" id="3179561">&lt;</span>&nbsp;<span class="num" id="3179563">50</span>&nbsp;<span class="op" id="3179566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179570"><a href="/image/jpeg/writer.go.html#3179539">scale</a></span>&nbsp;<span class="op" id="3179576">=</span>&nbsp;<span class="num" id="3179578">5000</span>&nbsp;<span class="op" id="3179583">/</span>&nbsp;<span class="ident" id="3179585"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179594">}</span>&nbsp;<span class="keyword" id="3179596">else</span>&nbsp;<span class="op" id="3179601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179605"><a href="/image/jpeg/writer.go.html#3179539">scale</a></span>&nbsp;<span class="op" id="3179611">=</span>&nbsp;<span class="num" id="3179613">200</span>&nbsp;<span class="op" id="3179617">-</span>&nbsp;<span class="ident" id="3179619"><a href="/image/jpeg/writer.go.html#3179330">quality</a></span><span class="op" id="3179626">*</span><span class="num" id="3179627">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179633">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179673">for</span>&nbsp;<span class="ident" id="3179677">i</span>&nbsp;<span class="op" id="3179679">:=</span>&nbsp;<span class="keyword" id="3179682">range</span>&nbsp;<span class="ident" id="3179688"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3179689">.</span><span class="ident" id="3179690">quant</span>&nbsp;<span class="op" id="3179696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179700">for</span>&nbsp;<span class="ident" id="3179704">j</span>&nbsp;<span class="op" id="3179706">:=</span>&nbsp;<span class="keyword" id="3179709">range</span>&nbsp;<span class="ident" id="3179715"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3179716">.</span><span class="ident" id="3179717">quant</span><span class="op" id="3179722">[</span><span class="ident" id="3179723"><a href="/image/jpeg/writer.go.html#3179677">i</a></span><span class="op" id="3179724">]</span>&nbsp;<span class="op" id="3179726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179731">x</span>&nbsp;<span class="op" id="3179733">:=</span>&nbsp;<span class="builtintype" id="3179736">int</span><span class="op" id="3179739">(</span><span class="ident" id="3179740"><a href="/image/jpeg/writer.go.html#3165369">unscaledQuant</a></span><span class="op" id="3179753">[</span><span class="ident" id="3179754"><a href="/image/jpeg/writer.go.html#3179677">i</a></span><span class="op" id="3179755">]</span><span class="op" id="3179756">[</span><span class="ident" id="3179757"><a href="/image/jpeg/writer.go.html#3179704">j</a></span><span class="op" id="3179758">]</span><span class="op" id="3179759">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179764"><a href="/image/jpeg/writer.go.html#3179731">x</a></span>&nbsp;<span class="op" id="3179766">=</span>&nbsp;<span class="op" id="3179768">(</span><span class="ident" id="3179769"><a href="/image/jpeg/writer.go.html#3179731">x</a></span><span class="op" id="3179770">*</span><span class="ident" id="3179771"><a href="/image/jpeg/writer.go.html#3179539">scale</a></span>&nbsp;<span class="op" id="3179777">+</span>&nbsp;<span class="num" id="3179779">50</span><span class="op" id="3179781">)</span>&nbsp;<span class="op" id="3179783">/</span>&nbsp;<span class="num" id="3179785">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179792">if</span>&nbsp;<span class="ident" id="3179795"><a href="/image/jpeg/writer.go.html#3179731">x</a></span>&nbsp;<span class="op" id="3179797">&lt;</span>&nbsp;<span class="num" id="3179799">1</span>&nbsp;<span class="op" id="3179801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179807"><a href="/image/jpeg/writer.go.html#3179731">x</a></span>&nbsp;<span class="op" id="3179809">=</span>&nbsp;<span class="num" id="3179811">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179816">}</span>&nbsp;<span class="keyword" id="3179818">else</span>&nbsp;<span class="keyword" id="3179823">if</span>&nbsp;<span class="ident" id="3179826"><a href="/image/jpeg/writer.go.html#3179731">x</a></span>&nbsp;<span class="op" id="3179828">&gt;</span>&nbsp;<span class="num" id="3179830">255</span>&nbsp;<span class="op" id="3179834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179840"><a href="/image/jpeg/writer.go.html#3179731">x</a></span>&nbsp;<span class="op" id="3179842">=</span>&nbsp;<span class="num" id="3179844">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179856"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3179857">.</span><span class="ident" id="3179858">quant</span><span class="op" id="3179863">[</span><span class="ident" id="3179864"><a href="/image/jpeg/writer.go.html#3179677">i</a></span><span class="op" id="3179865">]</span><span class="op" id="3179866">[</span><span class="ident" id="3179867"><a href="/image/jpeg/writer.go.html#3179704">j</a></span><span class="op" id="3179868">]</span>&nbsp;<span class="op" id="3179870">=</span>&nbsp;<span class="builtintype" id="3179872">uint8</span><span class="op" id="3179877">(</span><span class="ident" id="3179878"><a href="/image/jpeg/writer.go.html#3179731">x</a></span><span class="op" id="3179879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3179886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179889">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179949">nComponent</span>&nbsp;<span class="op" id="3179960">:=</span>&nbsp;<span class="num" id="3179963">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179966">switch</span>&nbsp;<span class="ident" id="3179973"><a href="/image/jpeg/writer.go.html#3179048">m</a></span><span class="op" id="3179974">.</span><span class="op" id="3179975">(</span><span class="keyword" id="3179976">type</span><span class="op" id="3179980">)</span>&nbsp;<span class="op" id="3179982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179985">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180047">case</span>&nbsp;<span class="op" id="3180052">*</span><span class="ident" id="3180053"><a href="/image/jpeg/writer.go.html#3163807">image</a></span><span class="op" id="3180058">.</span><span class="ident" id="3180059">Gray</span><span class="op" id="3180063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180067"><a href="/image/jpeg/writer.go.html#3179949">nComponent</a></span>&nbsp;<span class="op" id="3180078">=</span>&nbsp;<span class="num" id="3180080">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180086">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180123"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180124">.</span><span class="ident" id="3180125">buf</span><span class="op" id="3180128">[</span><span class="num" id="3180129">0</span><span class="op" id="3180130">]</span>&nbsp;<span class="op" id="3180132">=</span>&nbsp;<span class="num" id="3180134">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180140"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180141">.</span><span class="ident" id="3180142">buf</span><span class="op" id="3180145">[</span><span class="num" id="3180146">1</span><span class="op" id="3180147">]</span>&nbsp;<span class="op" id="3180149">=</span>&nbsp;<span class="num" id="3180151">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180157"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180158">.</span><span class="ident" id="3180159">write</span><span class="op" id="3180164">(</span><span class="ident" id="3180165"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180166">.</span><span class="ident" id="3180167">buf</span><span class="op" id="3180170">[</span><span class="op" id="3180171">:</span><span class="num" id="3180172">2</span><span class="op" id="3180173">]</span><span class="op" id="3180174">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180177">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180212"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180213">.</span><span class="ident" id="3180214">writeDQT</span><span class="op" id="3180222">(</span><span class="op" id="3180223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180226">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180258"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180259">.</span><span class="ident" id="3180260">writeSOF0</span><span class="op" id="3180269">(</span><span class="ident" id="3180270"><a href="/image/jpeg/writer.go.html#3179084">b</a></span><span class="op" id="3180271">.</span><span class="ident" id="3180272">Size</span><span class="op" id="3180276">(</span><span class="op" id="3180277">)</span><span class="op" id="3180278">,</span>&nbsp;<span class="ident" id="3180280"><a href="/image/jpeg/writer.go.html#3179949">nComponent</a></span><span class="op" id="3180290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180293">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180323"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180324">.</span><span class="ident" id="3180325">writeDHT</span><span class="op" id="3180333">(</span><span class="ident" id="3180334"><a href="/image/jpeg/writer.go.html#3179949">nComponent</a></span><span class="op" id="3180344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180347">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180373"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180374">.</span><span class="ident" id="3180375">writeSOS</span><span class="op" id="3180383">(</span><span class="ident" id="3180384"><a href="/image/jpeg/writer.go.html#3179048">m</a></span><span class="op" id="3180385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180388">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180423"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180424">.</span><span class="ident" id="3180425">buf</span><span class="op" id="3180428">[</span><span class="num" id="3180429">0</span><span class="op" id="3180430">]</span>&nbsp;<span class="op" id="3180432">=</span>&nbsp;<span class="num" id="3180434">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180440"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180441">.</span><span class="ident" id="3180442">buf</span><span class="op" id="3180445">[</span><span class="num" id="3180446">1</span><span class="op" id="3180447">]</span>&nbsp;<span class="op" id="3180449">=</span>&nbsp;<span class="num" id="3180451">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180457"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180458">.</span><span class="ident" id="3180459">write</span><span class="op" id="3180464">(</span><span class="ident" id="3180465"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180466">.</span><span class="ident" id="3180467">buf</span><span class="op" id="3180470">[</span><span class="op" id="3180471">:</span><span class="num" id="3180472">2</span><span class="op" id="3180473">]</span><span class="op" id="3180474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180477"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180478">.</span><span class="ident" id="3180479">flush</span><span class="op" id="3180484">(</span><span class="op" id="3180485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180488">return</span>&nbsp;<span class="ident" id="3180495"><a href="/image/jpeg/writer.go.html#3179207">e</a></span><span class="op" id="3180496">.</span><span class="ident" id="3180497">err</span><br>
<span class="lineno"></span><span class="op" id="3180501">}</span>
</div>
</body>
</html>
