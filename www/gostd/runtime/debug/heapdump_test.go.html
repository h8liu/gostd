<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7032756">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7032811">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7032865">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7032916">package</span>&nbsp;<span class="ident" id="7032924">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032931">import</span>&nbsp;<span class="op" id="7032938">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7032941">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7032954">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7032960">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7032971">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7032981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032984">func</span>&nbsp;<span class="ident" id="7032989">TestWriteHeapDumpNonempty</span><span class="op" id="7033014">(</span><span class="ident" id="7033015">t</span>&nbsp;<span class="op" id="7033017">*</span><span class="ident" id="7033018">testing</span><span class="op" id="7033025">.</span><span class="ident" id="7033026">T</span><span class="op" id="7033027">)</span>&nbsp;<span class="op" id="7033029">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033032">if</span>&nbsp;<span class="ident" id="7033035">runtime</span><span class="op" id="7033042">.</span><span class="ident" id="7033043">GOOS</span>&nbsp;<span class="op" id="7033048">==</span>&nbsp;<span class="string" id="7033051">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7033058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033062">t</span><span class="op" id="7033063">.</span><span class="ident" id="7033064">Skip</span><span class="op" id="7033068">(</span><span class="string" id="7033069">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="7033110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7033113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033116">f</span><span class="op" id="7033117">,</span>&nbsp;<span class="ident" id="7033119">err</span>&nbsp;<span class="op" id="7033123">:=</span>&nbsp;<span class="ident" id="7033126">ioutil</span><span class="op" id="7033132">.</span><span class="ident" id="7033133">TempFile</span><span class="op" id="7033141">(</span><span class="string" id="7033142">&#34;&#34;</span><span class="op" id="7033144">,</span>&nbsp;<span class="string" id="7033146">&#34;heapdumptest&#34;</span><span class="op" id="7033160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033163">if</span>&nbsp;<span class="ident" id="7033166">err</span>&nbsp;<span class="op" id="7033170">!=</span>&nbsp;<span class="ident" id="7033173">nil</span>&nbsp;<span class="op" id="7033177">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033181">t</span><span class="op" id="7033182">.</span><span class="ident" id="7033183">Fatalf</span><span class="op" id="7033189">(</span><span class="string" id="7033190">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7033211">,</span>&nbsp;<span class="ident" id="7033213">err</span><span class="op" id="7033216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7033219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033222">defer</span>&nbsp;<span class="ident" id="7033228">os</span><span class="op" id="7033230">.</span><span class="ident" id="7033231">Remove</span><span class="op" id="7033237">(</span><span class="ident" id="7033238">f</span><span class="op" id="7033239">.</span><span class="ident" id="7033240">Name</span><span class="op" id="7033244">(</span><span class="op" id="7033245">)</span><span class="op" id="7033246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033249">defer</span>&nbsp;<span class="ident" id="7033255">f</span><span class="op" id="7033256">.</span><span class="ident" id="7033257">Close</span><span class="op" id="7033262">(</span><span class="op" id="7033263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033266">WriteHeapDump</span><span class="op" id="7033279">(</span><span class="ident" id="7033280">f</span><span class="op" id="7033281">.</span><span class="ident" id="7033282">Fd</span><span class="op" id="7033284">(</span><span class="op" id="7033285">)</span><span class="op" id="7033286">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033289">fi</span><span class="op" id="7033291">,</span>&nbsp;<span class="ident" id="7033293">err</span>&nbsp;<span class="op" id="7033297">:=</span>&nbsp;<span class="ident" id="7033300">f</span><span class="op" id="7033301">.</span><span class="ident" id="7033302">Stat</span><span class="op" id="7033306">(</span><span class="op" id="7033307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033310">if</span>&nbsp;<span class="ident" id="7033313">err</span>&nbsp;<span class="op" id="7033317">!=</span>&nbsp;<span class="ident" id="7033320">nil</span>&nbsp;<span class="op" id="7033324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033328">t</span><span class="op" id="7033329">.</span><span class="ident" id="7033330">Fatalf</span><span class="op" id="7033336">(</span><span class="string" id="7033337">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7033354">,</span>&nbsp;<span class="ident" id="7033356">err</span><span class="op" id="7033359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7033362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033365">const</span>&nbsp;<span class="ident" id="7033371">minSize</span>&nbsp;<span class="op" id="7033379">=</span>&nbsp;<span class="num" id="7033381">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033384">if</span>&nbsp;<span class="ident" id="7033387">size</span>&nbsp;<span class="op" id="7033392">:=</span>&nbsp;<span class="ident" id="7033395">fi</span><span class="op" id="7033397">.</span><span class="ident" id="7033398">Size</span><span class="op" id="7033402">(</span><span class="op" id="7033403">)</span><span class="op" id="7033404">;</span>&nbsp;<span class="ident" id="7033406">size</span>&nbsp;<span class="op" id="7033411">&lt;</span>&nbsp;<span class="ident" id="7033413">minSize</span>&nbsp;<span class="op" id="7033421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033425">t</span><span class="op" id="7033426">.</span><span class="ident" id="7033427">Fatalf</span><span class="op" id="7033433">(</span><span class="string" id="7033434">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7033487">,</span>&nbsp;<span class="ident" id="7033489">size</span><span class="op" id="7033493">,</span>&nbsp;<span class="ident" id="7033495">minSize</span><span class="op" id="7033502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7033505">}</span><br>
<span class="lineno"></span><span class="op" id="7033507">}</span>
</div>
</body>
</html>
