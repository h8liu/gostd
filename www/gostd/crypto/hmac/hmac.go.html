<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html" class="current">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3886551">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3886606">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3886660">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3886711">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="3887365">package</span>&nbsp;<span class="ident" id="3887373">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3887379">import</span>&nbsp;<span class="op" id="3887386">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3887389">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3887406">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3887413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3887416">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="3887429">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3887494">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3887555">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="3887599">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="3887643">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3887691">type</span>&nbsp;<span class="ident" id="3887696">hmac</span>&nbsp;<span class="keyword" id="3887701">struct</span>&nbsp;<span class="op" id="3887708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887711">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887724">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887729">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887742">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887747">key</span><span class="op" id="3887750">,</span>&nbsp;<span class="ident" id="3887752">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3887760">[</span><span class="op" id="3887761">]</span><span class="builtintype" id="3887762">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887768">outer</span><span class="op" id="3887773">,</span>&nbsp;<span class="ident" id="3887775">inner</span>&nbsp;<span class="ident" id="3887781">hash</span><span class="op" id="3887785">.</span><span class="ident" id="3887786">Hash</span><br>
<span class="lineno"></span><span class="op" id="3887791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3887794">func</span>&nbsp;<span class="op" id="3887799">(</span><span class="ident" id="3887800">h</span>&nbsp;<span class="op" id="3887802">*</span><span class="ident" id="3887803">hmac</span><span class="op" id="3887807">)</span>&nbsp;<span class="ident" id="3887809">tmpPad</span><span class="op" id="3887815">(</span><span class="ident" id="3887816">xor</span>&nbsp;<span class="builtintype" id="3887820">byte</span><span class="op" id="3887824">)</span>&nbsp;<span class="op" id="3887826">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3887829">for</span>&nbsp;<span class="ident" id="3887833">i</span><span class="op" id="3887834">,</span>&nbsp;<span class="ident" id="3887836">k</span>&nbsp;<span class="op" id="3887838">:=</span>&nbsp;<span class="keyword" id="3887841">range</span>&nbsp;<span class="ident" id="3887847">h</span><span class="op" id="3887848">.</span><span class="ident" id="3887849">key</span>&nbsp;<span class="op" id="3887853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887857">h</span><span class="op" id="3887858">.</span><span class="ident" id="3887859">tmp</span><span class="op" id="3887862">[</span><span class="ident" id="3887863">i</span><span class="op" id="3887864">]</span>&nbsp;<span class="op" id="3887866">=</span>&nbsp;<span class="ident" id="3887868">xor</span>&nbsp;<span class="op" id="3887872">^</span>&nbsp;<span class="ident" id="3887874">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3887877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3887880">for</span>&nbsp;<span class="ident" id="3887884">i</span>&nbsp;<span class="op" id="3887886">:=</span>&nbsp;<span class="builtinfunc" id="3887889">len</span><span class="op" id="3887892">(</span><span class="ident" id="3887893">h</span><span class="op" id="3887894">.</span><span class="ident" id="3887895">key</span><span class="op" id="3887898">)</span><span class="op" id="3887899">;</span>&nbsp;<span class="ident" id="3887901">i</span>&nbsp;<span class="op" id="3887903">&lt;</span>&nbsp;<span class="ident" id="3887905">h</span><span class="op" id="3887906">.</span><span class="ident" id="3887907">blocksize</span><span class="op" id="3887916">;</span>&nbsp;<span class="ident" id="3887918">i</span><span class="op" id="3887919">++</span>&nbsp;<span class="op" id="3887922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887926">h</span><span class="op" id="3887927">.</span><span class="ident" id="3887928">tmp</span><span class="op" id="3887931">[</span><span class="ident" id="3887932">i</span><span class="op" id="3887933">]</span>&nbsp;<span class="op" id="3887935">=</span>&nbsp;<span class="ident" id="3887937">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3887942">}</span><br>
<span class="lineno"></span><span class="op" id="3887944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3887947">func</span>&nbsp;<span class="op" id="3887952">(</span><span class="ident" id="3887953">h</span>&nbsp;<span class="op" id="3887955">*</span><span class="ident" id="3887956">hmac</span><span class="op" id="3887960">)</span>&nbsp;<span class="ident" id="3887962">Sum</span><span class="op" id="3887965">(</span><span class="ident" id="3887966">in</span>&nbsp;<span class="op" id="3887969">[</span><span class="op" id="3887970">]</span><span class="builtintype" id="3887971">byte</span><span class="op" id="3887975">)</span>&nbsp;<span class="op" id="3887977">[</span><span class="op" id="3887978">]</span><span class="builtintype" id="3887979">byte</span>&nbsp;<span class="op" id="3887984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3887987">origLen</span>&nbsp;<span class="op" id="3887995">:=</span>&nbsp;<span class="builtinfunc" id="3887998">len</span><span class="op" id="3888001">(</span><span class="ident" id="3888002">in</span><span class="op" id="3888004">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888007">in</span>&nbsp;<span class="op" id="3888010">=</span>&nbsp;<span class="ident" id="3888012">h</span><span class="op" id="3888013">.</span><span class="ident" id="3888014">inner</span><span class="op" id="3888019">.</span><span class="ident" id="3888020">Sum</span><span class="op" id="3888023">(</span><span class="ident" id="3888024">in</span><span class="op" id="3888026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888029">h</span><span class="op" id="3888030">.</span><span class="ident" id="3888031">tmpPad</span><span class="op" id="3888037">(</span><span class="num" id="3888038">0x5c</span><span class="op" id="3888042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3888045">copy</span><span class="op" id="3888049">(</span><span class="ident" id="3888050">h</span><span class="op" id="3888051">.</span><span class="ident" id="3888052">tmp</span><span class="op" id="3888055">[</span><span class="ident" id="3888056">h</span><span class="op" id="3888057">.</span><span class="ident" id="3888058">blocksize</span><span class="op" id="3888067">:</span><span class="op" id="3888068">]</span><span class="op" id="3888069">,</span>&nbsp;<span class="ident" id="3888071">in</span><span class="op" id="3888073">[</span><span class="ident" id="3888074">origLen</span><span class="op" id="3888081">:</span><span class="op" id="3888082">]</span><span class="op" id="3888083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888086">h</span><span class="op" id="3888087">.</span><span class="ident" id="3888088">outer</span><span class="op" id="3888093">.</span><span class="ident" id="3888094">Reset</span><span class="op" id="3888099">(</span><span class="op" id="3888100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888103">h</span><span class="op" id="3888104">.</span><span class="ident" id="3888105">outer</span><span class="op" id="3888110">.</span><span class="ident" id="3888111">Write</span><span class="op" id="3888116">(</span><span class="ident" id="3888117">h</span><span class="op" id="3888118">.</span><span class="ident" id="3888119">tmp</span><span class="op" id="3888122">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3888125">return</span>&nbsp;<span class="ident" id="3888132">h</span><span class="op" id="3888133">.</span><span class="ident" id="3888134">outer</span><span class="op" id="3888139">.</span><span class="ident" id="3888140">Sum</span><span class="op" id="3888143">(</span><span class="ident" id="3888144">in</span><span class="op" id="3888146">[</span><span class="op" id="3888147">:</span><span class="ident" id="3888148">origLen</span><span class="op" id="3888155">]</span><span class="op" id="3888156">)</span><br>
<span class="lineno"></span><span class="op" id="3888158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3888161">func</span>&nbsp;<span class="op" id="3888166">(</span><span class="ident" id="3888167">h</span>&nbsp;<span class="op" id="3888169">*</span><span class="ident" id="3888170">hmac</span><span class="op" id="3888174">)</span>&nbsp;<span class="ident" id="3888176">Write</span><span class="op" id="3888181">(</span><span class="ident" id="3888182">p</span>&nbsp;<span class="op" id="3888184">[</span><span class="op" id="3888185">]</span><span class="builtintype" id="3888186">byte</span><span class="op" id="3888190">)</span>&nbsp;<span class="op" id="3888192">(</span><span class="ident" id="3888193">n</span>&nbsp;<span class="builtintype" id="3888195">int</span><span class="op" id="3888198">,</span>&nbsp;<span class="ident" id="3888200">err</span>&nbsp;<span class="builtintype" id="3888204">error</span><span class="op" id="3888209">)</span>&nbsp;<span class="op" id="3888211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3888214">return</span>&nbsp;<span class="ident" id="3888221">h</span><span class="op" id="3888222">.</span><span class="ident" id="3888223">inner</span><span class="op" id="3888228">.</span><span class="ident" id="3888229">Write</span><span class="op" id="3888234">(</span><span class="ident" id="3888235">p</span><span class="op" id="3888236">)</span><br>
<span class="lineno">65</span><span class="op" id="3888238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3888241">func</span>&nbsp;<span class="op" id="3888246">(</span><span class="ident" id="3888247">h</span>&nbsp;<span class="op" id="3888249">*</span><span class="ident" id="3888250">hmac</span><span class="op" id="3888254">)</span>&nbsp;<span class="ident" id="3888256">Size</span><span class="op" id="3888260">(</span><span class="op" id="3888261">)</span>&nbsp;<span class="builtintype" id="3888263">int</span>&nbsp;<span class="op" id="3888267">{</span>&nbsp;<span class="keyword" id="3888269">return</span>&nbsp;<span class="ident" id="3888276">h</span><span class="op" id="3888277">.</span><span class="ident" id="3888278">size</span>&nbsp;<span class="op" id="3888283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3888286">func</span>&nbsp;<span class="op" id="3888291">(</span><span class="ident" id="3888292">h</span>&nbsp;<span class="op" id="3888294">*</span><span class="ident" id="3888295">hmac</span><span class="op" id="3888299">)</span>&nbsp;<span class="ident" id="3888301">BlockSize</span><span class="op" id="3888310">(</span><span class="op" id="3888311">)</span>&nbsp;<span class="builtintype" id="3888313">int</span>&nbsp;<span class="op" id="3888317">{</span>&nbsp;<span class="keyword" id="3888319">return</span>&nbsp;<span class="ident" id="3888326">h</span><span class="op" id="3888327">.</span><span class="ident" id="3888328">blocksize</span>&nbsp;<span class="op" id="3888338">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3888341">func</span>&nbsp;<span class="op" id="3888346">(</span><span class="ident" id="3888347">h</span>&nbsp;<span class="op" id="3888349">*</span><span class="ident" id="3888350">hmac</span><span class="op" id="3888354">)</span>&nbsp;<span class="ident" id="3888356">Reset</span><span class="op" id="3888361">(</span><span class="op" id="3888362">)</span>&nbsp;<span class="op" id="3888364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888367">h</span><span class="op" id="3888368">.</span><span class="ident" id="3888369">inner</span><span class="op" id="3888374">.</span><span class="ident" id="3888375">Reset</span><span class="op" id="3888380">(</span><span class="op" id="3888381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888384">h</span><span class="op" id="3888385">.</span><span class="ident" id="3888386">tmpPad</span><span class="op" id="3888392">(</span><span class="num" id="3888393">0x36</span><span class="op" id="3888397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888400">h</span><span class="op" id="3888401">.</span><span class="ident" id="3888402">inner</span><span class="op" id="3888407">.</span><span class="ident" id="3888408">Write</span><span class="op" id="3888413">(</span><span class="ident" id="3888414">h</span><span class="op" id="3888415">.</span><span class="ident" id="3888416">tmp</span><span class="op" id="3888419">[</span><span class="op" id="3888420">:</span><span class="ident" id="3888421">h</span><span class="op" id="3888422">.</span><span class="ident" id="3888423">blocksize</span><span class="op" id="3888432">]</span><span class="op" id="3888433">)</span><br>
<span class="lineno">75</span><span class="op" id="3888435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3888438">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3888509">func</span>&nbsp;<span class="ident" id="3888514">New</span><span class="op" id="3888517">(</span><span class="ident" id="3888518">h</span>&nbsp;<span class="keyword" id="3888520">func</span><span class="op" id="3888524">(</span><span class="op" id="3888525">)</span>&nbsp;<span class="ident" id="3888527">hash</span><span class="op" id="3888531">.</span><span class="ident" id="3888532">Hash</span><span class="op" id="3888536">,</span>&nbsp;<span class="ident" id="3888538">key</span>&nbsp;<span class="op" id="3888542">[</span><span class="op" id="3888543">]</span><span class="builtintype" id="3888544">byte</span><span class="op" id="3888548">)</span>&nbsp;<span class="ident" id="3888550">hash</span><span class="op" id="3888554">.</span><span class="ident" id="3888555">Hash</span>&nbsp;<span class="op" id="3888560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888563">hm</span>&nbsp;<span class="op" id="3888566">:=</span>&nbsp;<span class="builtinfunc" id="3888569">new</span><span class="op" id="3888572">(</span><span class="ident" id="3888573">hmac</span><span class="op" id="3888577">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888580">hm</span><span class="op" id="3888582">.</span><span class="ident" id="3888583">outer</span>&nbsp;<span class="op" id="3888589">=</span>&nbsp;<span class="ident" id="3888591">h</span><span class="op" id="3888592">(</span><span class="op" id="3888593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888596">hm</span><span class="op" id="3888598">.</span><span class="ident" id="3888599">inner</span>&nbsp;<span class="op" id="3888605">=</span>&nbsp;<span class="ident" id="3888607">h</span><span class="op" id="3888608">(</span><span class="op" id="3888609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888612">hm</span><span class="op" id="3888614">.</span><span class="ident" id="3888615">size</span>&nbsp;<span class="op" id="3888620">=</span>&nbsp;<span class="ident" id="3888622">hm</span><span class="op" id="3888624">.</span><span class="ident" id="3888625">inner</span><span class="op" id="3888630">.</span><span class="ident" id="3888631">Size</span><span class="op" id="3888635">(</span><span class="op" id="3888636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888639">hm</span><span class="op" id="3888641">.</span><span class="ident" id="3888642">blocksize</span>&nbsp;<span class="op" id="3888652">=</span>&nbsp;<span class="ident" id="3888654">hm</span><span class="op" id="3888656">.</span><span class="ident" id="3888657">inner</span><span class="op" id="3888662">.</span><span class="ident" id="3888663">BlockSize</span><span class="op" id="3888672">(</span><span class="op" id="3888673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888676">hm</span><span class="op" id="3888678">.</span><span class="ident" id="3888679">tmp</span>&nbsp;<span class="op" id="3888683">=</span>&nbsp;<span class="builtinfunc" id="3888685">make</span><span class="op" id="3888689">(</span><span class="op" id="3888690">[</span><span class="op" id="3888691">]</span><span class="builtintype" id="3888692">byte</span><span class="op" id="3888696">,</span>&nbsp;<span class="ident" id="3888698">hm</span><span class="op" id="3888700">.</span><span class="ident" id="3888701">blocksize</span><span class="op" id="3888710">+</span><span class="ident" id="3888711">hm</span><span class="op" id="3888713">.</span><span class="ident" id="3888714">size</span><span class="op" id="3888718">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3888721">if</span>&nbsp;<span class="builtinfunc" id="3888724">len</span><span class="op" id="3888727">(</span><span class="ident" id="3888728">key</span><span class="op" id="3888731">)</span>&nbsp;<span class="op" id="3888733">&gt;</span>&nbsp;<span class="ident" id="3888735">hm</span><span class="op" id="3888737">.</span><span class="ident" id="3888738">blocksize</span>&nbsp;<span class="op" id="3888748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3888752">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888785">hm</span><span class="op" id="3888787">.</span><span class="ident" id="3888788">outer</span><span class="op" id="3888793">.</span><span class="ident" id="3888794">Write</span><span class="op" id="3888799">(</span><span class="ident" id="3888800">key</span><span class="op" id="3888803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888807">key</span>&nbsp;<span class="op" id="3888811">=</span>&nbsp;<span class="ident" id="3888813">hm</span><span class="op" id="3888815">.</span><span class="ident" id="3888816">outer</span><span class="op" id="3888821">.</span><span class="ident" id="3888822">Sum</span><span class="op" id="3888825">(</span><span class="builtintype" id="3888826">nil</span><span class="op" id="3888829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3888832">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888835">hm</span><span class="op" id="3888837">.</span><span class="ident" id="3888838">key</span>&nbsp;<span class="op" id="3888842">=</span>&nbsp;<span class="builtinfunc" id="3888844">make</span><span class="op" id="3888848">(</span><span class="op" id="3888849">[</span><span class="op" id="3888850">]</span><span class="builtintype" id="3888851">byte</span><span class="op" id="3888855">,</span>&nbsp;<span class="builtinfunc" id="3888857">len</span><span class="op" id="3888860">(</span><span class="ident" id="3888861">key</span><span class="op" id="3888864">)</span><span class="op" id="3888865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3888868">copy</span><span class="op" id="3888872">(</span><span class="ident" id="3888873">hm</span><span class="op" id="3888875">.</span><span class="ident" id="3888876">key</span><span class="op" id="3888879">,</span>&nbsp;<span class="ident" id="3888881">key</span><span class="op" id="3888884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3888887">hm</span><span class="op" id="3888889">.</span><span class="ident" id="3888890">Reset</span><span class="op" id="3888895">(</span><span class="op" id="3888896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3888899">return</span>&nbsp;<span class="ident" id="3888906">hm</span><br>
<span class="lineno"></span><span class="op" id="3888909">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3888912">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3888988">func</span>&nbsp;<span class="ident" id="3888993">Equal</span><span class="op" id="3888998">(</span><span class="ident" id="3888999">mac1</span><span class="op" id="3889003">,</span>&nbsp;<span class="ident" id="3889005">mac2</span>&nbsp;<span class="op" id="3889010">[</span><span class="op" id="3889011">]</span><span class="builtintype" id="3889012">byte</span><span class="op" id="3889016">)</span>&nbsp;<span class="builtintype" id="3889018">bool</span>&nbsp;<span class="op" id="3889023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3889026">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3889095">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3889168">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3889182">return</span>&nbsp;<span class="builtinfunc" id="3889189">len</span><span class="op" id="3889192">(</span><span class="ident" id="3889193">mac1</span><span class="op" id="3889197">)</span>&nbsp;<span class="op" id="3889199">==</span>&nbsp;<span class="builtinfunc" id="3889202">len</span><span class="op" id="3889205">(</span><span class="ident" id="3889206">mac2</span><span class="op" id="3889210">)</span>&nbsp;<span class="op" id="3889212">&amp;&amp;</span>&nbsp;<span class="ident" id="3889215">subtle</span><span class="op" id="3889221">.</span><span class="ident" id="3889222">ConstantTimeCompare</span><span class="op" id="3889241">(</span><span class="ident" id="3889242">mac1</span><span class="op" id="3889246">,</span>&nbsp;<span class="ident" id="3889248">mac2</span><span class="op" id="3889252">)</span>&nbsp;<span class="op" id="3889254">==</span>&nbsp;<span class="num" id="3889257">1</span><br>
<span class="lineno"></span><span class="op" id="3889259">}</span>
</div>
</body>
</html>
