<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html" class="current">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6583003">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6583058">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6583112">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6583163">package</span>&nbsp;<span class="ident" id="6583171">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6583176">import</span>&nbsp;<span class="op" id="6583183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6583186">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6583194">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6583201">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6583207">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6583218">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6583229">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6583239">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6583242">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6583315">var</span>&nbsp;<span class="ident" id="6583319">testIPv6</span>&nbsp;<span class="op" id="6583328">=</span>&nbsp;<span class="ident" id="6583330">flag</span><span class="op" id="6583334">.</span><span class="ident" id="6583335">Bool</span><span class="op" id="6583339">(</span><span class="string" id="6583340">&#34;ipv6&#34;</span><span class="op" id="6583346">,</span>&nbsp;<span class="builtintype" id="6583348">false</span><span class="op" id="6583353">,</span>&nbsp;<span class="string" id="6583355">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="6583386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6583389">func</span>&nbsp;<span class="ident" id="6583394">TestResolveGoogle</span><span class="op" id="6583411">(</span><span class="ident" id="6583412">t</span>&nbsp;<span class="op" id="6583414">*</span><span class="ident" id="6583415">testing</span><span class="op" id="6583422">.</span><span class="ident" id="6583423">T</span><span class="op" id="6583424">)</span>&nbsp;<span class="op" id="6583426">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6583429">if</span>&nbsp;<span class="ident" id="6583432">testing</span><span class="op" id="6583439">.</span><span class="ident" id="6583440">Short</span><span class="op" id="6583445">(</span><span class="op" id="6583446">)</span>&nbsp;<span class="op" id="6583448">||</span>&nbsp;<span class="op" id="6583451">!</span><span class="op" id="6583452">*</span><span class="ident" id="6583453">testExternal</span>&nbsp;<span class="op" id="6583466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6583470">t</span><span class="op" id="6583471">.</span><span class="ident" id="6583472">Skip</span><span class="op" id="6583476">(</span><span class="string" id="6583477">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6583518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6583521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6583525">for</span>&nbsp;<span class="ident" id="6583529">_</span><span class="op" id="6583530">,</span>&nbsp;<span class="ident" id="6583532">network</span>&nbsp;<span class="op" id="6583540">:=</span>&nbsp;<span class="keyword" id="6583543">range</span>&nbsp;<span class="op" id="6583549">[</span><span class="op" id="6583550">]</span><span class="builtintype" id="6583551">string</span><span class="op" id="6583557">{</span><span class="string" id="6583558">&#34;tcp&#34;</span><span class="op" id="6583563">,</span>&nbsp;<span class="string" id="6583565">&#34;tcp4&#34;</span><span class="op" id="6583571">,</span>&nbsp;<span class="string" id="6583573">&#34;tcp6&#34;</span><span class="op" id="6583579">}</span>&nbsp;<span class="op" id="6583581">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6583585">addr</span><span class="op" id="6583589">,</span>&nbsp;<span class="ident" id="6583591">err</span>&nbsp;<span class="op" id="6583595">:=</span>&nbsp;<span class="ident" id="6583598">ResolveTCPAddr</span><span class="op" id="6583612">(</span><span class="ident" id="6583613">network</span><span class="op" id="6583620">,</span>&nbsp;<span class="string" id="6583622">&#34;www.google.com:http&#34;</span><span class="op" id="6583643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6583647">if</span>&nbsp;<span class="ident" id="6583650">err</span>&nbsp;<span class="op" id="6583654">!=</span>&nbsp;<span class="ident" id="6583657">nil</span>&nbsp;<span class="op" id="6583661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6583666">if</span>&nbsp;<span class="op" id="6583669">(</span><span class="ident" id="6583670">network</span>&nbsp;<span class="op" id="6583678">==</span>&nbsp;<span class="string" id="6583681">&#34;tcp&#34;</span>&nbsp;<span class="op" id="6583687">||</span>&nbsp;<span class="ident" id="6583690">network</span>&nbsp;<span class="op" id="6583698">==</span>&nbsp;<span class="string" id="6583701">&#34;tcp4&#34;</span><span class="op" id="6583707">)</span>&nbsp;<span class="op" id="6583709">&amp;&amp;</span>&nbsp;<span class="op" id="6583712">!</span><span class="ident" id="6583713">supportsIPv4</span>&nbsp;<span class="op" id="6583726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6583732">t</span><span class="op" id="6583733">.</span><span class="ident" id="6583734">Logf</span><span class="op" id="6583738">(</span><span class="string" id="6583739">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="6583766">,</span>&nbsp;<span class="ident" id="6583768">err</span><span class="op" id="6583771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6583776">}</span>&nbsp;<span class="keyword" id="6583778">else</span>&nbsp;<span class="keyword" id="6583783">if</span>&nbsp;<span class="ident" id="6583786">network</span>&nbsp;<span class="op" id="6583794">==</span>&nbsp;<span class="string" id="6583797">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6583804">&amp;&amp;</span>&nbsp;<span class="op" id="6583807">!</span><span class="ident" id="6583808">supportsIPv6</span>&nbsp;<span class="op" id="6583821">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6583827">t</span><span class="op" id="6583828">.</span><span class="ident" id="6583829">Logf</span><span class="op" id="6583833">(</span><span class="string" id="6583834">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="6583861">,</span>&nbsp;<span class="ident" id="6583863">err</span><span class="op" id="6583866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6583871">}</span>&nbsp;<span class="keyword" id="6583873">else</span>&nbsp;<span class="op" id="6583878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6583884">t</span><span class="op" id="6583885">.</span><span class="ident" id="6583886">Errorf</span><span class="op" id="6583892">(</span><span class="string" id="6583893">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6583920">,</span>&nbsp;<span class="ident" id="6583922">err</span><span class="op" id="6583925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6583930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6583935">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6583946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6583950">if</span>&nbsp;<span class="op" id="6583953">(</span><span class="ident" id="6583954">network</span>&nbsp;<span class="op" id="6583962">==</span>&nbsp;<span class="string" id="6583965">&#34;tcp&#34;</span>&nbsp;<span class="op" id="6583971">||</span>&nbsp;<span class="ident" id="6583974">network</span>&nbsp;<span class="op" id="6583982">==</span>&nbsp;<span class="string" id="6583985">&#34;tcp4&#34;</span><span class="op" id="6583991">)</span>&nbsp;<span class="op" id="6583993">&amp;&amp;</span>&nbsp;<span class="ident" id="6583996">addr</span><span class="op" id="6584000">.</span><span class="ident" id="6584001">IP</span><span class="op" id="6584003">.</span><span class="ident" id="6584004">To4</span><span class="op" id="6584007">(</span><span class="op" id="6584008">)</span>&nbsp;<span class="op" id="6584010">==</span>&nbsp;<span class="ident" id="6584013">nil</span>&nbsp;<span class="op" id="6584017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584022">t</span><span class="op" id="6584023">.</span><span class="ident" id="6584024">Errorf</span><span class="op" id="6584030">(</span><span class="string" id="6584031">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="6584071">,</span>&nbsp;<span class="ident" id="6584073">addr</span><span class="op" id="6584077">,</span>&nbsp;<span class="ident" id="6584079">network</span><span class="op" id="6584086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584090">}</span>&nbsp;<span class="keyword" id="6584092">else</span>&nbsp;<span class="keyword" id="6584097">if</span>&nbsp;<span class="ident" id="6584100">network</span>&nbsp;<span class="op" id="6584108">==</span>&nbsp;<span class="string" id="6584111">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6584118">&amp;&amp;</span>&nbsp;<span class="op" id="6584121">(</span><span class="ident" id="6584122">addr</span><span class="op" id="6584126">.</span><span class="ident" id="6584127">IP</span><span class="op" id="6584129">.</span><span class="ident" id="6584130">To16</span><span class="op" id="6584134">(</span><span class="op" id="6584135">)</span>&nbsp;<span class="op" id="6584137">==</span>&nbsp;<span class="ident" id="6584140">nil</span>&nbsp;<span class="op" id="6584144">||</span>&nbsp;<span class="ident" id="6584147">addr</span><span class="op" id="6584151">.</span><span class="ident" id="6584152">IP</span><span class="op" id="6584154">.</span><span class="ident" id="6584155">To4</span><span class="op" id="6584158">(</span><span class="op" id="6584159">)</span>&nbsp;<span class="op" id="6584161">!=</span>&nbsp;<span class="ident" id="6584164">nil</span><span class="op" id="6584167">)</span>&nbsp;<span class="op" id="6584169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584174">t</span><span class="op" id="6584175">.</span><span class="ident" id="6584176">Errorf</span><span class="op" id="6584182">(</span><span class="string" id="6584183">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="6584223">,</span>&nbsp;<span class="ident" id="6584225">addr</span><span class="op" id="6584229">,</span>&nbsp;<span class="ident" id="6584231">network</span><span class="op" id="6584238">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584245">}</span><br>
<span class="lineno"></span><span class="op" id="6584247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6584250">func</span>&nbsp;<span class="ident" id="6584255">TestDialGoogle</span><span class="op" id="6584269">(</span><span class="ident" id="6584270">t</span>&nbsp;<span class="op" id="6584272">*</span><span class="ident" id="6584273">testing</span><span class="op" id="6584280">.</span><span class="ident" id="6584281">T</span><span class="op" id="6584282">)</span>&nbsp;<span class="op" id="6584284">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584287">if</span>&nbsp;<span class="ident" id="6584290">testing</span><span class="op" id="6584297">.</span><span class="ident" id="6584298">Short</span><span class="op" id="6584303">(</span><span class="op" id="6584304">)</span>&nbsp;<span class="op" id="6584306">||</span>&nbsp;<span class="op" id="6584309">!</span><span class="op" id="6584310">*</span><span class="ident" id="6584311">testExternal</span>&nbsp;<span class="op" id="6584324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584328">t</span><span class="op" id="6584329">.</span><span class="ident" id="6584330">Skip</span><span class="op" id="6584334">(</span><span class="string" id="6584335">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6584376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584383">d</span>&nbsp;<span class="op" id="6584385">:=</span>&nbsp;<span class="op" id="6584388">&amp;</span><span class="ident" id="6584389">Dialer</span><span class="op" id="6584395">{</span><span class="ident" id="6584396">DualStack</span><span class="op" id="6584405">:</span>&nbsp;<span class="builtintype" id="6584407">true</span><span class="op" id="6584411">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584414">for</span>&nbsp;<span class="ident" id="6584418">_</span><span class="op" id="6584419">,</span>&nbsp;<span class="ident" id="6584421">network</span>&nbsp;<span class="op" id="6584429">:=</span>&nbsp;<span class="keyword" id="6584432">range</span>&nbsp;<span class="op" id="6584438">[</span><span class="op" id="6584439">]</span><span class="builtintype" id="6584440">string</span><span class="op" id="6584446">{</span><span class="string" id="6584447">&#34;tcp&#34;</span><span class="op" id="6584452">,</span>&nbsp;<span class="string" id="6584454">&#34;tcp4&#34;</span><span class="op" id="6584460">,</span>&nbsp;<span class="string" id="6584462">&#34;tcp6&#34;</span><span class="op" id="6584468">}</span>&nbsp;<span class="op" id="6584470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584474">if</span>&nbsp;<span class="ident" id="6584477">network</span>&nbsp;<span class="op" id="6584485">==</span>&nbsp;<span class="string" id="6584488">&#34;tcp&#34;</span>&nbsp;<span class="op" id="6584494">&amp;&amp;</span>&nbsp;<span class="op" id="6584497">!</span><span class="ident" id="6584498">supportsIPv4</span>&nbsp;<span class="op" id="6584511">&amp;&amp;</span>&nbsp;<span class="op" id="6584514">!</span><span class="ident" id="6584515">supportsIPv6</span>&nbsp;<span class="op" id="6584528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584533">t</span><span class="op" id="6584534">.</span><span class="ident" id="6584535">Logf</span><span class="op" id="6584539">(</span><span class="string" id="6584540">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6584593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584598">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584609">}</span>&nbsp;<span class="keyword" id="6584611">else</span>&nbsp;<span class="keyword" id="6584616">if</span>&nbsp;<span class="ident" id="6584619">network</span>&nbsp;<span class="op" id="6584627">==</span>&nbsp;<span class="string" id="6584630">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="6584637">&amp;&amp;</span>&nbsp;<span class="op" id="6584640">!</span><span class="ident" id="6584641">supportsIPv4</span>&nbsp;<span class="op" id="6584654">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584659">t</span><span class="op" id="6584660">.</span><span class="ident" id="6584661">Logf</span><span class="op" id="6584665">(</span><span class="string" id="6584666">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6584704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584709">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584720">}</span>&nbsp;<span class="keyword" id="6584722">else</span>&nbsp;<span class="keyword" id="6584727">if</span>&nbsp;<span class="ident" id="6584730">network</span>&nbsp;<span class="op" id="6584738">==</span>&nbsp;<span class="string" id="6584741">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6584748">&amp;&amp;</span>&nbsp;<span class="op" id="6584751">!</span><span class="ident" id="6584752">supportsIPv6</span>&nbsp;<span class="op" id="6584765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584770">t</span><span class="op" id="6584771">.</span><span class="ident" id="6584772">Logf</span><span class="op" id="6584776">(</span><span class="string" id="6584777">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6584815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584820">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584831">}</span>&nbsp;<span class="keyword" id="6584833">else</span>&nbsp;<span class="keyword" id="6584838">if</span>&nbsp;<span class="ident" id="6584841">network</span>&nbsp;<span class="op" id="6584849">==</span>&nbsp;<span class="string" id="6584852">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6584859">&amp;&amp;</span>&nbsp;<span class="op" id="6584862">!</span><span class="op" id="6584863">*</span><span class="ident" id="6584864">testIPv6</span>&nbsp;<span class="op" id="6584873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6584878">t</span><span class="op" id="6584879">.</span><span class="ident" id="6584880">Logf</span><span class="op" id="6584884">(</span><span class="string" id="6584885">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6584921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584926">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6584937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6584941">if</span>&nbsp;<span class="ident" id="6584944">c</span><span class="op" id="6584945">,</span>&nbsp;<span class="ident" id="6584947">err</span>&nbsp;<span class="op" id="6584951">:=</span>&nbsp;<span class="ident" id="6584954">d</span><span class="op" id="6584955">.</span><span class="ident" id="6584956">Dial</span><span class="op" id="6584960">(</span><span class="ident" id="6584961">network</span><span class="op" id="6584968">,</span>&nbsp;<span class="string" id="6584970">&#34;www.google.com:http&#34;</span><span class="op" id="6584991">)</span><span class="op" id="6584992">;</span>&nbsp;<span class="ident" id="6584994">err</span>&nbsp;<span class="op" id="6584998">!=</span>&nbsp;<span class="ident" id="6585001">nil</span>&nbsp;<span class="op" id="6585005">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585010">t</span><span class="op" id="6585011">.</span><span class="ident" id="6585012">Errorf</span><span class="op" id="6585018">(</span><span class="string" id="6585019">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6585036">,</span>&nbsp;<span class="ident" id="6585038">err</span><span class="op" id="6585041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6585045">}</span>&nbsp;<span class="keyword" id="6585047">else</span>&nbsp;<span class="op" id="6585052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585057">c</span><span class="op" id="6585058">.</span><span class="ident" id="6585059">Close</span><span class="op" id="6585064">(</span><span class="op" id="6585065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6585069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6585072">}</span><br>
<span class="lineno">70</span><span class="op" id="6585074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6585077">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="6585133">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="6585187">func</span>&nbsp;<span class="ident" id="6585192">fetchGoogle</span><span class="op" id="6585203">(</span><span class="ident" id="6585204">t</span>&nbsp;<span class="op" id="6585206">*</span><span class="ident" id="6585207">testing</span><span class="op" id="6585214">.</span><span class="ident" id="6585215">T</span><span class="op" id="6585216">,</span>&nbsp;<span class="ident" id="6585218">fd</span>&nbsp;<span class="ident" id="6585221">Conn</span><span class="op" id="6585225">,</span>&nbsp;<span class="ident" id="6585227">network</span><span class="op" id="6585234">,</span>&nbsp;<span class="ident" id="6585236">addr</span>&nbsp;<span class="builtintype" id="6585241">string</span><span class="op" id="6585247">)</span>&nbsp;<span class="op" id="6585249">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585252">req</span>&nbsp;<span class="op" id="6585256">:=</span>&nbsp;<span class="op" id="6585259">[</span><span class="op" id="6585260">]</span><span class="builtintype" id="6585261">byte</span><span class="op" id="6585265">(</span><span class="string" id="6585266">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="6585324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585327">n</span><span class="op" id="6585328">,</span>&nbsp;<span class="ident" id="6585330">err</span>&nbsp;<span class="op" id="6585334">:=</span>&nbsp;<span class="ident" id="6585337">fd</span><span class="op" id="6585339">.</span><span class="ident" id="6585340">Write</span><span class="op" id="6585345">(</span><span class="ident" id="6585346">req</span><span class="op" id="6585349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585353">buf</span>&nbsp;<span class="op" id="6585357">:=</span>&nbsp;<span class="builtinfunc" id="6585360">make</span><span class="op" id="6585364">(</span><span class="op" id="6585365">[</span><span class="op" id="6585366">]</span><span class="builtintype" id="6585367">byte</span><span class="op" id="6585371">,</span>&nbsp;<span class="num" id="6585373">1000</span><span class="op" id="6585377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585380">n</span><span class="op" id="6585381">,</span>&nbsp;<span class="ident" id="6585383">err</span>&nbsp;<span class="op" id="6585387">=</span>&nbsp;<span class="ident" id="6585389">io</span><span class="op" id="6585391">.</span><span class="ident" id="6585392">ReadFull</span><span class="op" id="6585400">(</span><span class="ident" id="6585401">fd</span><span class="op" id="6585403">,</span>&nbsp;<span class="ident" id="6585405">buf</span><span class="op" id="6585408">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6585412">if</span>&nbsp;<span class="ident" id="6585415">n</span>&nbsp;<span class="op" id="6585417">&lt;</span>&nbsp;<span class="num" id="6585419">1000</span>&nbsp;<span class="op" id="6585424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585428">t</span><span class="op" id="6585429">.</span><span class="ident" id="6585430">Errorf</span><span class="op" id="6585436">(</span><span class="string" id="6585437">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="6585483">,</span>&nbsp;<span class="ident" id="6585485">network</span><span class="op" id="6585492">,</span>&nbsp;<span class="ident" id="6585494">addr</span><span class="op" id="6585498">,</span>&nbsp;<span class="ident" id="6585500">err</span><span class="op" id="6585503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6585507">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6585515">}</span><br>
<span class="lineno">85</span><span class="op" id="6585517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6585520">func</span>&nbsp;<span class="ident" id="6585525">doDial</span><span class="op" id="6585531">(</span><span class="ident" id="6585532">t</span>&nbsp;<span class="op" id="6585534">*</span><span class="ident" id="6585535">testing</span><span class="op" id="6585542">.</span><span class="ident" id="6585543">T</span><span class="op" id="6585544">,</span>&nbsp;<span class="ident" id="6585546">network</span><span class="op" id="6585553">,</span>&nbsp;<span class="ident" id="6585555">addr</span>&nbsp;<span class="builtintype" id="6585560">string</span><span class="op" id="6585566">)</span>&nbsp;<span class="op" id="6585568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585571">fd</span><span class="op" id="6585573">,</span>&nbsp;<span class="ident" id="6585575">err</span>&nbsp;<span class="op" id="6585579">:=</span>&nbsp;<span class="ident" id="6585582">Dial</span><span class="op" id="6585586">(</span><span class="ident" id="6585587">network</span><span class="op" id="6585594">,</span>&nbsp;<span class="ident" id="6585596">addr</span><span class="op" id="6585600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6585603">if</span>&nbsp;<span class="ident" id="6585606">err</span>&nbsp;<span class="op" id="6585610">!=</span>&nbsp;<span class="ident" id="6585613">nil</span>&nbsp;<span class="op" id="6585617">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585621">t</span><span class="op" id="6585622">.</span><span class="ident" id="6585623">Errorf</span><span class="op" id="6585629">(</span><span class="string" id="6585630">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6585656">,</span>&nbsp;<span class="ident" id="6585658">network</span><span class="op" id="6585665">,</span>&nbsp;<span class="string" id="6585667">&#34;&#34;</span><span class="op" id="6585669">,</span>&nbsp;<span class="ident" id="6585671">addr</span><span class="op" id="6585675">,</span>&nbsp;<span class="ident" id="6585677">err</span><span class="op" id="6585680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6585684">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6585692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585695">fetchGoogle</span><span class="op" id="6585706">(</span><span class="ident" id="6585707">t</span><span class="op" id="6585708">,</span>&nbsp;<span class="ident" id="6585710">fd</span><span class="op" id="6585712">,</span>&nbsp;<span class="ident" id="6585714">network</span><span class="op" id="6585721">,</span>&nbsp;<span class="ident" id="6585723">addr</span><span class="op" id="6585727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6585730">fd</span><span class="op" id="6585732">.</span><span class="ident" id="6585733">Close</span><span class="op" id="6585738">(</span><span class="op" id="6585739">)</span><br>
<span class="lineno">95</span><span class="op" id="6585741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6585744">var</span>&nbsp;<span class="ident" id="6585748">googleaddrsipv4</span>&nbsp;<span class="op" id="6585764">=</span>&nbsp;<span class="op" id="6585766">[</span><span class="op" id="6585767">]</span><span class="builtintype" id="6585768">string</span><span class="op" id="6585774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585777">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="6585793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585796">&#34;www.google.com:80&#34;</span><span class="op" id="6585815">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585818">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="6585836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585839">&#34;www.google.com:http&#34;</span><span class="op" id="6585860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585863">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="6585889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585892">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6585917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585920">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="6585951">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585954">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6585990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6585993">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6586031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586034">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6586066">,</span><br>
<span class="lineno"></span><span class="op" id="6586068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6586071">func</span>&nbsp;<span class="ident" id="6586076">TestDialGoogleIPv4</span><span class="op" id="6586094">(</span><span class="ident" id="6586095">t</span>&nbsp;<span class="op" id="6586097">*</span><span class="ident" id="6586098">testing</span><span class="op" id="6586105">.</span><span class="ident" id="6586106">T</span><span class="op" id="6586107">)</span>&nbsp;<span class="op" id="6586109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586112">if</span>&nbsp;<span class="ident" id="6586115">testing</span><span class="op" id="6586122">.</span><span class="ident" id="6586123">Short</span><span class="op" id="6586128">(</span><span class="op" id="6586129">)</span>&nbsp;<span class="op" id="6586131">||</span>&nbsp;<span class="op" id="6586134">!</span><span class="op" id="6586135">*</span><span class="ident" id="6586136">testExternal</span>&nbsp;<span class="op" id="6586149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586153">t</span><span class="op" id="6586154">.</span><span class="ident" id="6586155">Skip</span><span class="op" id="6586159">(</span><span class="string" id="6586160">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6586201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6586208">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6586257">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586277">addrs</span><span class="op" id="6586282">,</span>&nbsp;<span class="ident" id="6586284">err</span>&nbsp;<span class="op" id="6586288">:=</span>&nbsp;<span class="ident" id="6586291">LookupIP</span><span class="op" id="6586299">(</span><span class="string" id="6586300">&#34;www.google.com&#34;</span><span class="op" id="6586316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586319">if</span>&nbsp;<span class="ident" id="6586322">err</span>&nbsp;<span class="op" id="6586326">!=</span>&nbsp;<span class="ident" id="6586329">nil</span>&nbsp;<span class="op" id="6586333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586337">t</span><span class="op" id="6586338">.</span><span class="ident" id="6586339">Fatalf</span><span class="op" id="6586345">(</span><span class="string" id="6586346">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="6586373">,</span>&nbsp;<span class="ident" id="6586375">err</span><span class="op" id="6586378">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586384">var</span>&nbsp;<span class="ident" id="6586388">ip</span>&nbsp;<span class="ident" id="6586391">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586395">for</span>&nbsp;<span class="ident" id="6586399">_</span><span class="op" id="6586400">,</span>&nbsp;<span class="ident" id="6586402">addr</span>&nbsp;<span class="op" id="6586407">:=</span>&nbsp;<span class="keyword" id="6586410">range</span>&nbsp;<span class="ident" id="6586416">addrs</span>&nbsp;<span class="op" id="6586422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586426">if</span>&nbsp;<span class="ident" id="6586429">x</span>&nbsp;<span class="op" id="6586431">:=</span>&nbsp;<span class="ident" id="6586434">addr</span><span class="op" id="6586438">.</span><span class="ident" id="6586439">To4</span><span class="op" id="6586442">(</span><span class="op" id="6586443">)</span><span class="op" id="6586444">;</span>&nbsp;<span class="ident" id="6586446">x</span>&nbsp;<span class="op" id="6586448">!=</span>&nbsp;<span class="ident" id="6586451">nil</span>&nbsp;<span class="op" id="6586455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586460">ip</span>&nbsp;<span class="op" id="6586463">=</span>&nbsp;<span class="ident" id="6586465">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586470">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586484">if</span>&nbsp;<span class="ident" id="6586487">ip</span>&nbsp;<span class="op" id="6586490">==</span>&nbsp;<span class="ident" id="6586493">nil</span>&nbsp;<span class="op" id="6586497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586501">t</span><span class="op" id="6586502">.</span><span class="ident" id="6586503">Fatalf</span><span class="op" id="6586509">(</span><span class="string" id="6586510">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="6586548">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586555">for</span>&nbsp;<span class="ident" id="6586559">i</span><span class="op" id="6586560">,</span>&nbsp;<span class="ident" id="6586562">s</span>&nbsp;<span class="op" id="6586564">:=</span>&nbsp;<span class="keyword" id="6586567">range</span>&nbsp;<span class="ident" id="6586573">googleaddrsipv4</span>&nbsp;<span class="op" id="6586589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586593">if</span>&nbsp;<span class="ident" id="6586596">strings</span><span class="op" id="6586603">.</span><span class="ident" id="6586604">Contains</span><span class="op" id="6586612">(</span><span class="ident" id="6586613">s</span><span class="op" id="6586614">,</span>&nbsp;<span class="string" id="6586616">&#34;%&#34;</span><span class="op" id="6586619">)</span>&nbsp;<span class="op" id="6586621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586626">googleaddrsipv4</span><span class="op" id="6586641">[</span><span class="ident" id="6586642">i</span><span class="op" id="6586643">]</span>&nbsp;<span class="op" id="6586645">=</span>&nbsp;<span class="ident" id="6586647">fmt</span><span class="op" id="6586650">.</span><span class="ident" id="6586651">Sprintf</span><span class="op" id="6586658">(</span><span class="ident" id="6586659">s</span><span class="op" id="6586660">,</span>&nbsp;<span class="ident" id="6586662">ip</span><span class="op" id="6586664">[</span><span class="num" id="6586665">0</span><span class="op" id="6586666">]</span><span class="op" id="6586667">,</span>&nbsp;<span class="ident" id="6586669">ip</span><span class="op" id="6586671">[</span><span class="num" id="6586672">1</span><span class="op" id="6586673">]</span><span class="op" id="6586674">,</span>&nbsp;<span class="ident" id="6586676">ip</span><span class="op" id="6586678">[</span><span class="num" id="6586679">2</span><span class="op" id="6586680">]</span><span class="op" id="6586681">,</span>&nbsp;<span class="ident" id="6586683">ip</span><span class="op" id="6586685">[</span><span class="num" id="6586686">3</span><span class="op" id="6586687">]</span><span class="op" id="6586688">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586699">for</span>&nbsp;<span class="ident" id="6586703">i</span>&nbsp;<span class="op" id="6586705">:=</span>&nbsp;<span class="num" id="6586708">0</span><span class="op" id="6586709">;</span>&nbsp;<span class="ident" id="6586711">i</span>&nbsp;<span class="op" id="6586713">&lt;</span>&nbsp;<span class="builtinfunc" id="6586715">len</span><span class="op" id="6586718">(</span><span class="ident" id="6586719">googleaddrsipv4</span><span class="op" id="6586734">)</span><span class="op" id="6586735">;</span>&nbsp;<span class="ident" id="6586737">i</span><span class="op" id="6586738">++</span>&nbsp;<span class="op" id="6586741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586745">addr</span>&nbsp;<span class="op" id="6586750">:=</span>&nbsp;<span class="ident" id="6586753">googleaddrsipv4</span><span class="op" id="6586768">[</span><span class="ident" id="6586769">i</span><span class="op" id="6586770">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586774">if</span>&nbsp;<span class="ident" id="6586777">addr</span>&nbsp;<span class="op" id="6586782">==</span>&nbsp;<span class="string" id="6586785">&#34;&#34;</span>&nbsp;<span class="op" id="6586788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586793">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586808">t</span><span class="op" id="6586809">.</span><span class="ident" id="6586810">Logf</span><span class="op" id="6586814">(</span><span class="string" id="6586815">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="6586825">,</span>&nbsp;<span class="ident" id="6586827">addr</span><span class="op" id="6586831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586835">doDial</span><span class="op" id="6586841">(</span><span class="ident" id="6586842">t</span><span class="op" id="6586843">,</span>&nbsp;<span class="string" id="6586845">&#34;tcp&#34;</span><span class="op" id="6586850">,</span>&nbsp;<span class="ident" id="6586852">addr</span><span class="op" id="6586856">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586860">if</span>&nbsp;<span class="ident" id="6586863">addr</span><span class="op" id="6586867">[</span><span class="num" id="6586868">0</span><span class="op" id="6586869">]</span>&nbsp;<span class="op" id="6586871">!=</span>&nbsp;<span class="string" id="6586874">&#39;[&#39;</span>&nbsp;<span class="op" id="6586878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586883">doDial</span><span class="op" id="6586889">(</span><span class="ident" id="6586890">t</span><span class="op" id="6586891">,</span>&nbsp;<span class="string" id="6586893">&#34;tcp4&#34;</span><span class="op" id="6586899">,</span>&nbsp;<span class="ident" id="6586901">addr</span><span class="op" id="6586905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6586910">if</span>&nbsp;<span class="ident" id="6586913">supportsIPv6</span>&nbsp;<span class="op" id="6586926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6586932">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586987">syscall</span><span class="op" id="6586994">.</span><span class="ident" id="6586995">SocketDisableIPv6</span>&nbsp;<span class="op" id="6587013">=</span>&nbsp;<span class="builtintype" id="6587015">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587024">doDial</span><span class="op" id="6587030">(</span><span class="ident" id="6587031">t</span><span class="op" id="6587032">,</span>&nbsp;<span class="string" id="6587034">&#34;tcp&#34;</span><span class="op" id="6587039">,</span>&nbsp;<span class="ident" id="6587041">addr</span><span class="op" id="6587045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587051">doDial</span><span class="op" id="6587057">(</span><span class="ident" id="6587058">t</span><span class="op" id="6587059">,</span>&nbsp;<span class="string" id="6587061">&#34;tcp4&#34;</span><span class="op" id="6587067">,</span>&nbsp;<span class="ident" id="6587069">addr</span><span class="op" id="6587073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587079">syscall</span><span class="op" id="6587086">.</span><span class="ident" id="6587087">SocketDisableIPv6</span>&nbsp;<span class="op" id="6587105">=</span>&nbsp;<span class="builtintype" id="6587107">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587120">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587123">}</span><br>
<span class="lineno"></span><span class="op" id="6587125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6587128">var</span>&nbsp;<span class="ident" id="6587132">googleaddrsipv6</span>&nbsp;<span class="op" id="6587148">=</span>&nbsp;<span class="op" id="6587150">[</span><span class="op" id="6587151">]</span><span class="builtintype" id="6587152">string</span><span class="op" id="6587158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6587161">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="6587239">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6587242">&#34;ipv6.google.com:80&#34;</span><span class="op" id="6587262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6587265">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="6587345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6587348">&#34;ipv6.google.com:http&#34;</span><span class="op" id="6587370">,</span><br>
<span class="lineno"></span><span class="op" id="6587372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="6587375">func</span>&nbsp;<span class="ident" id="6587380">TestDialGoogleIPv6</span><span class="op" id="6587398">(</span><span class="ident" id="6587399">t</span>&nbsp;<span class="op" id="6587401">*</span><span class="ident" id="6587402">testing</span><span class="op" id="6587409">.</span><span class="ident" id="6587410">T</span><span class="op" id="6587411">)</span>&nbsp;<span class="op" id="6587413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587416">if</span>&nbsp;<span class="ident" id="6587419">testing</span><span class="op" id="6587426">.</span><span class="ident" id="6587427">Short</span><span class="op" id="6587432">(</span><span class="op" id="6587433">)</span>&nbsp;<span class="op" id="6587435">||</span>&nbsp;<span class="op" id="6587438">!</span><span class="op" id="6587439">*</span><span class="ident" id="6587440">testExternal</span>&nbsp;<span class="op" id="6587453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587457">t</span><span class="op" id="6587458">.</span><span class="ident" id="6587459">Skip</span><span class="op" id="6587463">(</span><span class="string" id="6587464">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6587505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6587511">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587557">if</span>&nbsp;<span class="op" id="6587560">!</span><span class="ident" id="6587561">supportsIPv6</span>&nbsp;<span class="op" id="6587574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587578">t</span><span class="op" id="6587579">.</span><span class="ident" id="6587580">Skip</span><span class="op" id="6587584">(</span><span class="string" id="6587585">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6587623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587629">if</span>&nbsp;<span class="op" id="6587632">!</span><span class="op" id="6587633">*</span><span class="ident" id="6587634">testIPv6</span>&nbsp;<span class="op" id="6587643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587647">t</span><span class="op" id="6587648">.</span><span class="ident" id="6587649">Skip</span><span class="op" id="6587653">(</span><span class="string" id="6587654">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6587690">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6587697">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6587751">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587771">addrs</span><span class="op" id="6587776">,</span>&nbsp;<span class="ident" id="6587778">err</span>&nbsp;<span class="op" id="6587782">:=</span>&nbsp;<span class="ident" id="6587785">LookupIP</span><span class="op" id="6587793">(</span><span class="string" id="6587794">&#34;ipv6.google.com&#34;</span><span class="op" id="6587811">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587814">if</span>&nbsp;<span class="ident" id="6587817">err</span>&nbsp;<span class="op" id="6587821">!=</span>&nbsp;<span class="ident" id="6587824">nil</span>&nbsp;<span class="op" id="6587828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587832">t</span><span class="op" id="6587833">.</span><span class="ident" id="6587834">Fatalf</span><span class="op" id="6587840">(</span><span class="string" id="6587841">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="6587869">,</span>&nbsp;<span class="ident" id="6587871">err</span><span class="op" id="6587874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587880">var</span>&nbsp;<span class="ident" id="6587884">ip</span>&nbsp;<span class="ident" id="6587887">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587891">for</span>&nbsp;<span class="ident" id="6587895">_</span><span class="op" id="6587896">,</span>&nbsp;<span class="ident" id="6587898">addr</span>&nbsp;<span class="op" id="6587903">:=</span>&nbsp;<span class="keyword" id="6587906">range</span>&nbsp;<span class="ident" id="6587912">addrs</span>&nbsp;<span class="op" id="6587918">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587922">if</span>&nbsp;<span class="ident" id="6587925">x</span>&nbsp;<span class="op" id="6587927">:=</span>&nbsp;<span class="ident" id="6587930">addr</span><span class="op" id="6587934">.</span><span class="ident" id="6587935">To16</span><span class="op" id="6587939">(</span><span class="op" id="6587940">)</span><span class="op" id="6587941">;</span>&nbsp;<span class="ident" id="6587943">x</span>&nbsp;<span class="op" id="6587945">!=</span>&nbsp;<span class="ident" id="6587948">nil</span>&nbsp;<span class="op" id="6587952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587957">ip</span>&nbsp;<span class="op" id="6587960">=</span>&nbsp;<span class="ident" id="6587962">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587967">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587978">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6587981">if</span>&nbsp;<span class="ident" id="6587984">ip</span>&nbsp;<span class="op" id="6587987">==</span>&nbsp;<span class="ident" id="6587990">nil</span>&nbsp;<span class="op" id="6587994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6587998">t</span><span class="op" id="6587999">.</span><span class="ident" id="6588000">Fatalf</span><span class="op" id="6588006">(</span><span class="string" id="6588007">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="6588046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588053">for</span>&nbsp;<span class="ident" id="6588057">i</span><span class="op" id="6588058">,</span>&nbsp;<span class="ident" id="6588060">s</span>&nbsp;<span class="op" id="6588062">:=</span>&nbsp;<span class="keyword" id="6588065">range</span>&nbsp;<span class="ident" id="6588071">googleaddrsipv6</span>&nbsp;<span class="op" id="6588087">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588091">if</span>&nbsp;<span class="ident" id="6588094">strings</span><span class="op" id="6588101">.</span><span class="ident" id="6588102">Contains</span><span class="op" id="6588110">(</span><span class="ident" id="6588111">s</span><span class="op" id="6588112">,</span>&nbsp;<span class="string" id="6588114">&#34;%&#34;</span><span class="op" id="6588117">)</span>&nbsp;<span class="op" id="6588119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588124">googleaddrsipv6</span><span class="op" id="6588139">[</span><span class="ident" id="6588140">i</span><span class="op" id="6588141">]</span>&nbsp;<span class="op" id="6588143">=</span>&nbsp;<span class="ident" id="6588145">fmt</span><span class="op" id="6588148">.</span><span class="ident" id="6588149">Sprintf</span><span class="op" id="6588156">(</span><span class="ident" id="6588157">s</span><span class="op" id="6588158">,</span>&nbsp;<span class="ident" id="6588160">ip</span><span class="op" id="6588162">[</span><span class="num" id="6588163">0</span><span class="op" id="6588164">]</span><span class="op" id="6588165">,</span>&nbsp;<span class="ident" id="6588167">ip</span><span class="op" id="6588169">[</span><span class="num" id="6588170">1</span><span class="op" id="6588171">]</span><span class="op" id="6588172">,</span>&nbsp;<span class="ident" id="6588174">ip</span><span class="op" id="6588176">[</span><span class="num" id="6588177">2</span><span class="op" id="6588178">]</span><span class="op" id="6588179">,</span>&nbsp;<span class="ident" id="6588181">ip</span><span class="op" id="6588183">[</span><span class="num" id="6588184">3</span><span class="op" id="6588185">]</span><span class="op" id="6588186">,</span>&nbsp;<span class="ident" id="6588188">ip</span><span class="op" id="6588190">[</span><span class="num" id="6588191">4</span><span class="op" id="6588192">]</span><span class="op" id="6588193">,</span>&nbsp;<span class="ident" id="6588195">ip</span><span class="op" id="6588197">[</span><span class="num" id="6588198">5</span><span class="op" id="6588199">]</span><span class="op" id="6588200">,</span>&nbsp;<span class="ident" id="6588202">ip</span><span class="op" id="6588204">[</span><span class="num" id="6588205">6</span><span class="op" id="6588206">]</span><span class="op" id="6588207">,</span>&nbsp;<span class="ident" id="6588209">ip</span><span class="op" id="6588211">[</span><span class="num" id="6588212">7</span><span class="op" id="6588213">]</span><span class="op" id="6588214">,</span>&nbsp;<span class="ident" id="6588216">ip</span><span class="op" id="6588218">[</span><span class="num" id="6588219">8</span><span class="op" id="6588220">]</span><span class="op" id="6588221">,</span>&nbsp;<span class="ident" id="6588223">ip</span><span class="op" id="6588225">[</span><span class="num" id="6588226">9</span><span class="op" id="6588227">]</span><span class="op" id="6588228">,</span>&nbsp;<span class="ident" id="6588230">ip</span><span class="op" id="6588232">[</span><span class="num" id="6588233">10</span><span class="op" id="6588235">]</span><span class="op" id="6588236">,</span>&nbsp;<span class="ident" id="6588238">ip</span><span class="op" id="6588240">[</span><span class="num" id="6588241">11</span><span class="op" id="6588243">]</span><span class="op" id="6588244">,</span>&nbsp;<span class="ident" id="6588246">ip</span><span class="op" id="6588248">[</span><span class="num" id="6588249">12</span><span class="op" id="6588251">]</span><span class="op" id="6588252">,</span>&nbsp;<span class="ident" id="6588254">ip</span><span class="op" id="6588256">[</span><span class="num" id="6588257">13</span><span class="op" id="6588259">]</span><span class="op" id="6588260">,</span>&nbsp;<span class="ident" id="6588262">ip</span><span class="op" id="6588264">[</span><span class="num" id="6588265">14</span><span class="op" id="6588267">]</span><span class="op" id="6588268">,</span>&nbsp;<span class="ident" id="6588270">ip</span><span class="op" id="6588272">[</span><span class="num" id="6588273">15</span><span class="op" id="6588275">]</span><span class="op" id="6588276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588287">for</span>&nbsp;<span class="ident" id="6588291">i</span>&nbsp;<span class="op" id="6588293">:=</span>&nbsp;<span class="num" id="6588296">0</span><span class="op" id="6588297">;</span>&nbsp;<span class="ident" id="6588299">i</span>&nbsp;<span class="op" id="6588301">&lt;</span>&nbsp;<span class="builtinfunc" id="6588303">len</span><span class="op" id="6588306">(</span><span class="ident" id="6588307">googleaddrsipv6</span><span class="op" id="6588322">)</span><span class="op" id="6588323">;</span>&nbsp;<span class="ident" id="6588325">i</span><span class="op" id="6588326">++</span>&nbsp;<span class="op" id="6588329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588333">addr</span>&nbsp;<span class="op" id="6588338">:=</span>&nbsp;<span class="ident" id="6588341">googleaddrsipv6</span><span class="op" id="6588356">[</span><span class="ident" id="6588357">i</span><span class="op" id="6588358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588362">if</span>&nbsp;<span class="ident" id="6588365">addr</span>&nbsp;<span class="op" id="6588370">==</span>&nbsp;<span class="string" id="6588373">&#34;&#34;</span>&nbsp;<span class="op" id="6588376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588381">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588392">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588396">t</span><span class="op" id="6588397">.</span><span class="ident" id="6588398">Logf</span><span class="op" id="6588402">(</span><span class="string" id="6588403">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="6588413">,</span>&nbsp;<span class="ident" id="6588415">addr</span><span class="op" id="6588419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588423">doDial</span><span class="op" id="6588429">(</span><span class="ident" id="6588430">t</span><span class="op" id="6588431">,</span>&nbsp;<span class="string" id="6588433">&#34;tcp&#34;</span><span class="op" id="6588438">,</span>&nbsp;<span class="ident" id="6588440">addr</span><span class="op" id="6588444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588448">doDial</span><span class="op" id="6588454">(</span><span class="ident" id="6588455">t</span><span class="op" id="6588456">,</span>&nbsp;<span class="string" id="6588458">&#34;tcp6&#34;</span><span class="op" id="6588464">,</span>&nbsp;<span class="ident" id="6588466">addr</span><span class="op" id="6588470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588473">}</span><br>
<span class="lineno"></span><span class="op" id="6588475">}</span>
</div>
</body>
</html>
