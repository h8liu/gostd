<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7924948">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7925003">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7925057">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7925108">package</span>&nbsp;<span class="ident" id="7925116">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7925121">import</span>&nbsp;<span class="op" id="7925128">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925131">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925140">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925156">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925175">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925189">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925205">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925221">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925231">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925238">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925244">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925256">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925263">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925269">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925280">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925297">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925308">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7925319">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7925326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7925329">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7925407">type</span>&nbsp;<span class="ident" id="7925412">zeroSource</span>&nbsp;<span class="keyword" id="7925423">struct</span><span class="op" id="7925429">{</span><span class="op" id="7925430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7925433">func</span>&nbsp;<span class="op" id="7925438">(</span><span class="ident" id="7925439">zeroSource</span><span class="op" id="7925449">)</span>&nbsp;<span class="ident" id="7925451">Read</span><span class="op" id="7925455">(</span><span class="ident" id="7925456">b</span>&nbsp;<span class="op" id="7925458">[</span><span class="op" id="7925459">]</span><span class="builtintype" id="7925460">byte</span><span class="op" id="7925464">)</span>&nbsp;<span class="op" id="7925466">(</span><span class="ident" id="7925467">n</span>&nbsp;<span class="builtintype" id="7925469">int</span><span class="op" id="7925472">,</span>&nbsp;<span class="ident" id="7925474">err</span>&nbsp;<span class="builtintype" id="7925478">error</span><span class="op" id="7925483">)</span>&nbsp;<span class="op" id="7925485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925488">for</span>&nbsp;<span class="ident" id="7925492">i</span>&nbsp;<span class="op" id="7925494">:=</span>&nbsp;<span class="keyword" id="7925497">range</span>&nbsp;<span class="ident" id="7925503">b</span>&nbsp;<span class="op" id="7925505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925509">b</span><span class="op" id="7925510">[</span><span class="ident" id="7925511">i</span><span class="op" id="7925512">]</span>&nbsp;<span class="op" id="7925514">=</span>&nbsp;<span class="num" id="7925516">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925523">return</span>&nbsp;<span class="builtinfunc" id="7925530">len</span><span class="op" id="7925533">(</span><span class="ident" id="7925534">b</span><span class="op" id="7925535">)</span><span class="op" id="7925536">,</span>&nbsp;<span class="ident" id="7925538">nil</span><br>
<span class="lineno"></span><span class="op" id="7925542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7925545">var</span>&nbsp;<span class="ident" id="7925549">testConfig</span>&nbsp;<span class="op" id="7925560">*</span><span class="ident" id="7925561">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7925569">func</span>&nbsp;<span class="ident" id="7925574">init</span><span class="op" id="7925578">(</span><span class="op" id="7925579">)</span>&nbsp;<span class="op" id="7925581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925584">testConfig</span>&nbsp;<span class="op" id="7925595">=</span>&nbsp;<span class="op" id="7925597">&amp;</span><span class="ident" id="7925598">Config</span><span class="op" id="7925604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925608">Time</span><span class="op" id="7925612">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7925628">func</span><span class="op" id="7925632">(</span><span class="op" id="7925633">)</span>&nbsp;<span class="ident" id="7925635">time</span><span class="op" id="7925639">.</span><span class="ident" id="7925640">Time</span>&nbsp;<span class="op" id="7925645">{</span>&nbsp;<span class="keyword" id="7925647">return</span>&nbsp;<span class="ident" id="7925654">time</span><span class="op" id="7925658">.</span><span class="ident" id="7925659">Unix</span><span class="op" id="7925663">(</span><span class="num" id="7925664">0</span><span class="op" id="7925665">,</span>&nbsp;<span class="num" id="7925667">0</span><span class="op" id="7925668">)</span>&nbsp;<span class="op" id="7925670">}</span><span class="op" id="7925671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925675">Rand</span><span class="op" id="7925679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7925695">zeroSource</span><span class="op" id="7925705">{</span><span class="op" id="7925706">}</span><span class="op" id="7925707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925711">Certificates</span><span class="op" id="7925723">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7925731">make</span><span class="op" id="7925735">(</span><span class="op" id="7925736">[</span><span class="op" id="7925737">]</span><span class="ident" id="7925738">Certificate</span><span class="op" id="7925749">,</span>&nbsp;<span class="num" id="7925751">2</span><span class="op" id="7925752">)</span><span class="op" id="7925753">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925757">InsecureSkipVerify</span><span class="op" id="7925775">:</span>&nbsp;<span class="builtintype" id="7925777">true</span><span class="op" id="7925781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925785">MinVersion</span><span class="op" id="7925795">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7925805">VersionSSL30</span><span class="op" id="7925817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925821">MaxVersion</span><span class="op" id="7925831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7925841">VersionTLS12</span><span class="op" id="7925853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925859">testConfig</span><span class="op" id="7925869">.</span><span class="ident" id="7925870">Certificates</span><span class="op" id="7925882">[</span><span class="num" id="7925883">0</span><span class="op" id="7925884">]</span><span class="op" id="7925885">.</span><span class="ident" id="7925886">Certificate</span>&nbsp;<span class="op" id="7925898">=</span>&nbsp;<span class="op" id="7925900">[</span><span class="op" id="7925901">]</span><span class="op" id="7925902">[</span><span class="op" id="7925903">]</span><span class="builtintype" id="7925904">byte</span><span class="op" id="7925908">{</span><span class="ident" id="7925909">testRSACertificate</span><span class="op" id="7925927">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925930">testConfig</span><span class="op" id="7925940">.</span><span class="ident" id="7925941">Certificates</span><span class="op" id="7925953">[</span><span class="num" id="7925954">0</span><span class="op" id="7925955">]</span><span class="op" id="7925956">.</span><span class="ident" id="7925957">PrivateKey</span>&nbsp;<span class="op" id="7925968">=</span>&nbsp;<span class="ident" id="7925970">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925989">testConfig</span><span class="op" id="7925999">.</span><span class="ident" id="7926000">Certificates</span><span class="op" id="7926012">[</span><span class="num" id="7926013">1</span><span class="op" id="7926014">]</span><span class="op" id="7926015">.</span><span class="ident" id="7926016">Certificate</span>&nbsp;<span class="op" id="7926028">=</span>&nbsp;<span class="op" id="7926030">[</span><span class="op" id="7926031">]</span><span class="op" id="7926032">[</span><span class="op" id="7926033">]</span><span class="builtintype" id="7926034">byte</span><span class="op" id="7926038">{</span><span class="ident" id="7926039">testSNICertificate</span><span class="op" id="7926057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926060">testConfig</span><span class="op" id="7926070">.</span><span class="ident" id="7926071">Certificates</span><span class="op" id="7926083">[</span><span class="num" id="7926084">1</span><span class="op" id="7926085">]</span><span class="op" id="7926086">.</span><span class="ident" id="7926087">PrivateKey</span>&nbsp;<span class="op" id="7926098">=</span>&nbsp;<span class="ident" id="7926100">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926119">testConfig</span><span class="op" id="7926129">.</span><span class="ident" id="7926130">BuildNameToCertificate</span><span class="op" id="7926152">(</span><span class="op" id="7926153">)</span><br>
<span class="lineno"></span><span class="op" id="7926155">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7926158">func</span>&nbsp;<span class="ident" id="7926163">testClientHelloFailure</span><span class="op" id="7926185">(</span><span class="ident" id="7926186">t</span>&nbsp;<span class="op" id="7926188">*</span><span class="ident" id="7926189">testing</span><span class="op" id="7926196">.</span><span class="ident" id="7926197">T</span><span class="op" id="7926198">,</span>&nbsp;<span class="ident" id="7926200">m</span>&nbsp;<span class="ident" id="7926202">handshakeMessage</span><span class="op" id="7926218">,</span>&nbsp;<span class="ident" id="7926220">expectedSubStr</span>&nbsp;<span class="builtintype" id="7926235">string</span><span class="op" id="7926241">)</span>&nbsp;<span class="op" id="7926243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7926246">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7926287">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7926330">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926350">c</span><span class="op" id="7926351">,</span>&nbsp;<span class="ident" id="7926353">s</span>&nbsp;<span class="op" id="7926355">:=</span>&nbsp;<span class="ident" id="7926358">net</span><span class="op" id="7926361">.</span><span class="ident" id="7926362">Pipe</span><span class="op" id="7926366">(</span><span class="op" id="7926367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926370">go</span>&nbsp;<span class="keyword" id="7926373">func</span><span class="op" id="7926377">(</span><span class="op" id="7926378">)</span>&nbsp;<span class="op" id="7926380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926384">cli</span>&nbsp;<span class="op" id="7926388">:=</span>&nbsp;<span class="ident" id="7926391">Client</span><span class="op" id="7926397">(</span><span class="ident" id="7926398">c</span><span class="op" id="7926399">,</span>&nbsp;<span class="ident" id="7926401">testConfig</span><span class="op" id="7926411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926415">if</span>&nbsp;<span class="ident" id="7926418">ch</span><span class="op" id="7926420">,</span>&nbsp;<span class="ident" id="7926422">ok</span>&nbsp;<span class="op" id="7926425">:=</span>&nbsp;<span class="ident" id="7926428">m</span><span class="op" id="7926429">.</span><span class="op" id="7926430">(</span><span class="op" id="7926431">*</span><span class="ident" id="7926432">clientHelloMsg</span><span class="op" id="7926446">)</span><span class="op" id="7926447">;</span>&nbsp;<span class="ident" id="7926449">ok</span>&nbsp;<span class="op" id="7926452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926457">cli</span><span class="op" id="7926460">.</span><span class="ident" id="7926461">vers</span>&nbsp;<span class="op" id="7926466">=</span>&nbsp;<span class="ident" id="7926468">ch</span><span class="op" id="7926470">.</span><span class="ident" id="7926471">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926482">cli</span><span class="op" id="7926485">.</span><span class="ident" id="7926486">writeRecord</span><span class="op" id="7926497">(</span><span class="ident" id="7926498">recordTypeHandshake</span><span class="op" id="7926517">,</span>&nbsp;<span class="ident" id="7926519">m</span><span class="op" id="7926520">.</span><span class="ident" id="7926521">marshal</span><span class="op" id="7926528">(</span><span class="op" id="7926529">)</span><span class="op" id="7926530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926534">c</span><span class="op" id="7926535">.</span><span class="ident" id="7926536">Close</span><span class="op" id="7926541">(</span><span class="op" id="7926542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926545">}</span><span class="op" id="7926546">(</span><span class="op" id="7926547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926550">err</span>&nbsp;<span class="op" id="7926554">:=</span>&nbsp;<span class="ident" id="7926557">Server</span><span class="op" id="7926563">(</span><span class="ident" id="7926564">s</span><span class="op" id="7926565">,</span>&nbsp;<span class="ident" id="7926567">testConfig</span><span class="op" id="7926577">)</span><span class="op" id="7926578">.</span><span class="ident" id="7926579">Handshake</span><span class="op" id="7926588">(</span><span class="op" id="7926589">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926592">s</span><span class="op" id="7926593">.</span><span class="ident" id="7926594">Close</span><span class="op" id="7926599">(</span><span class="op" id="7926600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926603">if</span>&nbsp;<span class="ident" id="7926606">err</span>&nbsp;<span class="op" id="7926610">==</span>&nbsp;<span class="ident" id="7926613">nil</span>&nbsp;<span class="op" id="7926617">||</span>&nbsp;<span class="op" id="7926620">!</span><span class="ident" id="7926621">strings</span><span class="op" id="7926628">.</span><span class="ident" id="7926629">Contains</span><span class="op" id="7926637">(</span><span class="ident" id="7926638">err</span><span class="op" id="7926641">.</span><span class="ident" id="7926642">Error</span><span class="op" id="7926647">(</span><span class="op" id="7926648">)</span><span class="op" id="7926649">,</span>&nbsp;<span class="ident" id="7926651">expectedSubStr</span><span class="op" id="7926665">)</span>&nbsp;<span class="op" id="7926667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926671">t</span><span class="op" id="7926672">.</span><span class="ident" id="7926673">Errorf</span><span class="op" id="7926679">(</span><span class="string" id="7926680">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7926729">,</span>&nbsp;<span class="ident" id="7926731">err</span><span class="op" id="7926734">,</span>&nbsp;<span class="ident" id="7926736">expectedSubStr</span><span class="op" id="7926750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926753">}</span><br>
<span class="lineno"></span><span class="op" id="7926755">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7926758">func</span>&nbsp;<span class="ident" id="7926763">TestSimpleError</span><span class="op" id="7926778">(</span><span class="ident" id="7926779">t</span>&nbsp;<span class="op" id="7926781">*</span><span class="ident" id="7926782">testing</span><span class="op" id="7926789">.</span><span class="ident" id="7926790">T</span><span class="op" id="7926791">)</span>&nbsp;<span class="op" id="7926793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926796">testClientHelloFailure</span><span class="op" id="7926818">(</span><span class="ident" id="7926819">t</span><span class="op" id="7926820">,</span>&nbsp;<span class="op" id="7926822">&amp;</span><span class="ident" id="7926823">serverHelloDoneMsg</span><span class="op" id="7926841">{</span><span class="op" id="7926842">}</span><span class="op" id="7926843">,</span>&nbsp;<span class="string" id="7926845">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7926875">)</span><br>
<span class="lineno"></span><span class="op" id="7926877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7926880">var</span>&nbsp;<span class="ident" id="7926884">badProtocolVersions</span>&nbsp;<span class="op" id="7926904">=</span>&nbsp;<span class="op" id="7926906">[</span><span class="op" id="7926907">]</span><span class="builtintype" id="7926908">uint16</span><span class="op" id="7926914">{</span><span class="num" id="7926915">0x0000</span><span class="op" id="7926921">,</span>&nbsp;<span class="num" id="7926923">0x0005</span><span class="op" id="7926929">,</span>&nbsp;<span class="num" id="7926931">0x0100</span><span class="op" id="7926937">,</span>&nbsp;<span class="num" id="7926939">0x0105</span><span class="op" id="7926945">,</span>&nbsp;<span class="num" id="7926947">0x0200</span><span class="op" id="7926953">,</span>&nbsp;<span class="num" id="7926955">0x0205</span><span class="op" id="7926961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7926964">func</span>&nbsp;<span class="ident" id="7926969">TestRejectBadProtocolVersion</span><span class="op" id="7926997">(</span><span class="ident" id="7926998">t</span>&nbsp;<span class="op" id="7927000">*</span><span class="ident" id="7927001">testing</span><span class="op" id="7927008">.</span><span class="ident" id="7927009">T</span><span class="op" id="7927010">)</span>&nbsp;<span class="op" id="7927012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927015">for</span>&nbsp;<span class="ident" id="7927019">_</span><span class="op" id="7927020">,</span>&nbsp;<span class="ident" id="7927022">v</span>&nbsp;<span class="op" id="7927024">:=</span>&nbsp;<span class="keyword" id="7927027">range</span>&nbsp;<span class="ident" id="7927033">badProtocolVersions</span>&nbsp;<span class="op" id="7927053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927057">testClientHelloFailure</span><span class="op" id="7927079">(</span><span class="ident" id="7927080">t</span><span class="op" id="7927081">,</span>&nbsp;<span class="op" id="7927083">&amp;</span><span class="ident" id="7927084">clientHelloMsg</span><span class="op" id="7927098">{</span><span class="ident" id="7927099">vers</span><span class="op" id="7927103">:</span>&nbsp;<span class="ident" id="7927105">v</span><span class="op" id="7927106">}</span><span class="op" id="7927107">,</span>&nbsp;<span class="string" id="7927109">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7927148">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927151">}</span><br>
<span class="lineno"></span><span class="op" id="7927153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7927156">func</span>&nbsp;<span class="ident" id="7927161">TestNoSuiteOverlap</span><span class="op" id="7927179">(</span><span class="ident" id="7927180">t</span>&nbsp;<span class="op" id="7927182">*</span><span class="ident" id="7927183">testing</span><span class="op" id="7927190">.</span><span class="ident" id="7927191">T</span><span class="op" id="7927192">)</span>&nbsp;<span class="op" id="7927194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927197">clientHello</span>&nbsp;<span class="op" id="7927209">:=</span>&nbsp;<span class="op" id="7927212">&amp;</span><span class="ident" id="7927213">clientHelloMsg</span><span class="op" id="7927227">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927231">vers</span><span class="op" id="7927235">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7927251">0x0301</span><span class="op" id="7927257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927261">cipherSuites</span><span class="op" id="7927273">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7927281">[</span><span class="op" id="7927282">]</span><span class="builtintype" id="7927283">uint16</span><span class="op" id="7927289">{</span><span class="num" id="7927290">0xff00</span><span class="op" id="7927296">}</span><span class="op" id="7927297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927301">compressionMethods</span><span class="op" id="7927319">:</span>&nbsp;<span class="op" id="7927321">[</span><span class="op" id="7927322">]</span><span class="builtintype" id="7927323">uint8</span><span class="op" id="7927328">{</span><span class="num" id="7927329">0</span><span class="op" id="7927330">}</span><span class="op" id="7927331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927337">testClientHelloFailure</span><span class="op" id="7927359">(</span><span class="ident" id="7927360">t</span><span class="op" id="7927361">,</span>&nbsp;<span class="ident" id="7927363">clientHello</span><span class="op" id="7927374">,</span>&nbsp;<span class="string" id="7927376">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7927429">)</span><br>
<span class="lineno">95</span><span class="op" id="7927431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7927434">func</span>&nbsp;<span class="ident" id="7927439">TestNoCompressionOverlap</span><span class="op" id="7927463">(</span><span class="ident" id="7927464">t</span>&nbsp;<span class="op" id="7927466">*</span><span class="ident" id="7927467">testing</span><span class="op" id="7927474">.</span><span class="ident" id="7927475">T</span><span class="op" id="7927476">)</span>&nbsp;<span class="op" id="7927478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927481">clientHello</span>&nbsp;<span class="op" id="7927493">:=</span>&nbsp;<span class="op" id="7927496">&amp;</span><span class="ident" id="7927497">clientHelloMsg</span><span class="op" id="7927511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927515">vers</span><span class="op" id="7927519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7927535">0x0301</span><span class="op" id="7927541">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927545">cipherSuites</span><span class="op" id="7927557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7927565">[</span><span class="op" id="7927566">]</span><span class="builtintype" id="7927567">uint16</span><span class="op" id="7927573">{</span><span class="ident" id="7927574">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7927598">}</span><span class="op" id="7927599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927603">compressionMethods</span><span class="op" id="7927621">:</span>&nbsp;<span class="op" id="7927623">[</span><span class="op" id="7927624">]</span><span class="builtintype" id="7927625">uint8</span><span class="op" id="7927630">{</span><span class="num" id="7927631">0xff</span><span class="op" id="7927635">}</span><span class="op" id="7927636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927642">testClientHelloFailure</span><span class="op" id="7927664">(</span><span class="ident" id="7927665">t</span><span class="op" id="7927666">,</span>&nbsp;<span class="ident" id="7927668">clientHello</span><span class="op" id="7927679">,</span>&nbsp;<span class="string" id="7927681">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7927731">)</span><br>
<span class="lineno"></span><span class="op" id="7927733">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7927736">func</span>&nbsp;<span class="ident" id="7927741">TestTLS12OnlyCipherSuites</span><span class="op" id="7927766">(</span><span class="ident" id="7927767">t</span>&nbsp;<span class="op" id="7927769">*</span><span class="ident" id="7927770">testing</span><span class="op" id="7927777">.</span><span class="ident" id="7927778">T</span><span class="op" id="7927779">)</span>&nbsp;<span class="op" id="7927781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7927784">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7927855">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927890">var</span>&nbsp;<span class="ident" id="7927894">zeros</span>&nbsp;<span class="op" id="7927900">[</span><span class="num" id="7927901">32</span><span class="op" id="7927903">]</span><span class="builtintype" id="7927904">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927911">clientHello</span>&nbsp;<span class="op" id="7927923">:=</span>&nbsp;<span class="op" id="7927926">&amp;</span><span class="ident" id="7927927">clientHelloMsg</span><span class="op" id="7927941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927945">vers</span><span class="op" id="7927949">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7927953">VersionTLS11</span><span class="op" id="7927965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927969">random</span><span class="op" id="7927975">:</span>&nbsp;<span class="ident" id="7927977">zeros</span><span class="op" id="7927982">[</span><span class="op" id="7927983">:</span><span class="op" id="7927984">]</span><span class="op" id="7927985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927989">cipherSuites</span><span class="op" id="7928001">:</span>&nbsp;<span class="op" id="7928003">[</span><span class="op" id="7928004">]</span><span class="builtintype" id="7928005">uint16</span><span class="op" id="7928011">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7928016">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7928068">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7928116">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7928168">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928210">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="7928247">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928252">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7928276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928280">}</span><span class="op" id="7928281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928285">compressionMethods</span><span class="op" id="7928303">:</span>&nbsp;<span class="op" id="7928305">[</span><span class="op" id="7928306">]</span><span class="builtintype" id="7928307">uint8</span><span class="op" id="7928312">{</span><span class="ident" id="7928313">compressionNone</span><span class="op" id="7928328">}</span><span class="op" id="7928329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928333">supportedCurves</span><span class="op" id="7928348">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7928353">[</span><span class="op" id="7928354">]</span><span class="ident" id="7928355">CurveID</span><span class="op" id="7928362">{</span><span class="ident" id="7928363">CurveP256</span><span class="op" id="7928372">,</span>&nbsp;<span class="ident" id="7928374">CurveP384</span><span class="op" id="7928383">,</span>&nbsp;<span class="ident" id="7928385">CurveP521</span><span class="op" id="7928394">}</span><span class="op" id="7928395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928399">supportedPoints</span><span class="op" id="7928414">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7928419">[</span><span class="op" id="7928420">]</span><span class="builtintype" id="7928421">uint8</span><span class="op" id="7928426">{</span><span class="ident" id="7928427">pointFormatUncompressed</span><span class="op" id="7928450">}</span><span class="op" id="7928451">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928458">c</span><span class="op" id="7928459">,</span>&nbsp;<span class="ident" id="7928461">s</span>&nbsp;<span class="op" id="7928463">:=</span>&nbsp;<span class="ident" id="7928466">net</span><span class="op" id="7928469">.</span><span class="ident" id="7928470">Pipe</span><span class="op" id="7928474">(</span><span class="op" id="7928475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928478">var</span>&nbsp;<span class="ident" id="7928482">reply</span>&nbsp;<span class="keyword" id="7928488">interface</span><span class="op" id="7928497">{</span><span class="op" id="7928498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928501">var</span>&nbsp;<span class="ident" id="7928505">clientErr</span>&nbsp;<span class="builtintype" id="7928515">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928522">go</span>&nbsp;<span class="keyword" id="7928525">func</span><span class="op" id="7928529">(</span><span class="op" id="7928530">)</span>&nbsp;<span class="op" id="7928532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928536">cli</span>&nbsp;<span class="op" id="7928540">:=</span>&nbsp;<span class="ident" id="7928543">Client</span><span class="op" id="7928549">(</span><span class="ident" id="7928550">c</span><span class="op" id="7928551">,</span>&nbsp;<span class="ident" id="7928553">testConfig</span><span class="op" id="7928563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928567">cli</span><span class="op" id="7928570">.</span><span class="ident" id="7928571">vers</span>&nbsp;<span class="op" id="7928576">=</span>&nbsp;<span class="ident" id="7928578">clientHello</span><span class="op" id="7928589">.</span><span class="ident" id="7928590">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928597">cli</span><span class="op" id="7928600">.</span><span class="ident" id="7928601">writeRecord</span><span class="op" id="7928612">(</span><span class="ident" id="7928613">recordTypeHandshake</span><span class="op" id="7928632">,</span>&nbsp;<span class="ident" id="7928634">clientHello</span><span class="op" id="7928645">.</span><span class="ident" id="7928646">marshal</span><span class="op" id="7928653">(</span><span class="op" id="7928654">)</span><span class="op" id="7928655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928659">reply</span><span class="op" id="7928664">,</span>&nbsp;<span class="ident" id="7928666">clientErr</span>&nbsp;<span class="op" id="7928676">=</span>&nbsp;<span class="ident" id="7928678">cli</span><span class="op" id="7928681">.</span><span class="ident" id="7928682">readHandshake</span><span class="op" id="7928695">(</span><span class="op" id="7928696">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928700">c</span><span class="op" id="7928701">.</span><span class="ident" id="7928702">Close</span><span class="op" id="7928707">(</span><span class="op" id="7928708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928711">}</span><span class="op" id="7928712">(</span><span class="op" id="7928713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928716">config</span>&nbsp;<span class="op" id="7928723">:=</span>&nbsp;<span class="op" id="7928726">*</span><span class="ident" id="7928727">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928739">config</span><span class="op" id="7928745">.</span><span class="ident" id="7928746">CipherSuites</span>&nbsp;<span class="op" id="7928759">=</span>&nbsp;<span class="ident" id="7928761">clientHello</span><span class="op" id="7928772">.</span><span class="ident" id="7928773">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928787">Server</span><span class="op" id="7928793">(</span><span class="ident" id="7928794">s</span><span class="op" id="7928795">,</span>&nbsp;<span class="op" id="7928797">&amp;</span><span class="ident" id="7928798">config</span><span class="op" id="7928804">)</span><span class="op" id="7928805">.</span><span class="ident" id="7928806">Handshake</span><span class="op" id="7928815">(</span><span class="op" id="7928816">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928819">s</span><span class="op" id="7928820">.</span><span class="ident" id="7928821">Close</span><span class="op" id="7928826">(</span><span class="op" id="7928827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928830">if</span>&nbsp;<span class="ident" id="7928833">clientErr</span>&nbsp;<span class="op" id="7928843">!=</span>&nbsp;<span class="ident" id="7928846">nil</span>&nbsp;<span class="op" id="7928850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928854">t</span><span class="op" id="7928855">.</span><span class="ident" id="7928856">Fatal</span><span class="op" id="7928861">(</span><span class="ident" id="7928862">clientErr</span><span class="op" id="7928871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928877">serverHello</span><span class="op" id="7928888">,</span>&nbsp;<span class="ident" id="7928890">ok</span>&nbsp;<span class="op" id="7928893">:=</span>&nbsp;<span class="ident" id="7928896">reply</span><span class="op" id="7928901">.</span><span class="op" id="7928902">(</span><span class="op" id="7928903">*</span><span class="ident" id="7928904">serverHelloMsg</span><span class="op" id="7928918">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928921">if</span>&nbsp;<span class="op" id="7928924">!</span><span class="ident" id="7928925">ok</span>&nbsp;<span class="op" id="7928928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928932">t</span><span class="op" id="7928933">.</span><span class="ident" id="7928934">Fatalf</span><span class="op" id="7928940">(</span><span class="string" id="7928941">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7928992">,</span>&nbsp;<span class="ident" id="7928994">reply</span><span class="op" id="7928999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929005">if</span>&nbsp;<span class="ident" id="7929008">s</span>&nbsp;<span class="op" id="7929010">:=</span>&nbsp;<span class="ident" id="7929013">serverHello</span><span class="op" id="7929024">.</span><span class="ident" id="7929025">cipherSuite</span><span class="op" id="7929036">;</span>&nbsp;<span class="ident" id="7929038">s</span>&nbsp;<span class="op" id="7929040">!=</span>&nbsp;<span class="ident" id="7929043">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7929068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929072">t</span><span class="op" id="7929073">.</span><span class="ident" id="7929074">Fatalf</span><span class="op" id="7929080">(</span><span class="string" id="7929081">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7929115">,</span>&nbsp;<span class="ident" id="7929117">s</span><span class="op" id="7929118">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929121">}</span><br>
<span class="lineno"></span><span class="op" id="7929123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7929126">func</span>&nbsp;<span class="ident" id="7929131">TestAlertForwarding</span><span class="op" id="7929150">(</span><span class="ident" id="7929151">t</span>&nbsp;<span class="op" id="7929153">*</span><span class="ident" id="7929154">testing</span><span class="op" id="7929161">.</span><span class="ident" id="7929162">T</span><span class="op" id="7929163">)</span>&nbsp;<span class="op" id="7929165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929168">c</span><span class="op" id="7929169">,</span>&nbsp;<span class="ident" id="7929171">s</span>&nbsp;<span class="op" id="7929173">:=</span>&nbsp;<span class="ident" id="7929176">net</span><span class="op" id="7929179">.</span><span class="ident" id="7929180">Pipe</span><span class="op" id="7929184">(</span><span class="op" id="7929185">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929188">go</span>&nbsp;<span class="keyword" id="7929191">func</span><span class="op" id="7929195">(</span><span class="op" id="7929196">)</span>&nbsp;<span class="op" id="7929198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929202">Client</span><span class="op" id="7929208">(</span><span class="ident" id="7929209">c</span><span class="op" id="7929210">,</span>&nbsp;<span class="ident" id="7929212">testConfig</span><span class="op" id="7929222">)</span><span class="op" id="7929223">.</span><span class="ident" id="7929224">sendAlert</span><span class="op" id="7929233">(</span><span class="ident" id="7929234">alertUnknownCA</span><span class="op" id="7929248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929252">c</span><span class="op" id="7929253">.</span><span class="ident" id="7929254">Close</span><span class="op" id="7929259">(</span><span class="op" id="7929260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929263">}</span><span class="op" id="7929264">(</span><span class="op" id="7929265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929269">err</span>&nbsp;<span class="op" id="7929273">:=</span>&nbsp;<span class="ident" id="7929276">Server</span><span class="op" id="7929282">(</span><span class="ident" id="7929283">s</span><span class="op" id="7929284">,</span>&nbsp;<span class="ident" id="7929286">testConfig</span><span class="op" id="7929296">)</span><span class="op" id="7929297">.</span><span class="ident" id="7929298">Handshake</span><span class="op" id="7929307">(</span><span class="op" id="7929308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929311">s</span><span class="op" id="7929312">.</span><span class="ident" id="7929313">Close</span><span class="op" id="7929318">(</span><span class="op" id="7929319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929322">if</span>&nbsp;<span class="ident" id="7929325">e</span><span class="op" id="7929326">,</span>&nbsp;<span class="ident" id="7929328">ok</span>&nbsp;<span class="op" id="7929331">:=</span>&nbsp;<span class="ident" id="7929334">err</span><span class="op" id="7929337">.</span><span class="op" id="7929338">(</span><span class="op" id="7929339">*</span><span class="ident" id="7929340">net</span><span class="op" id="7929343">.</span><span class="ident" id="7929344">OpError</span><span class="op" id="7929351">)</span><span class="op" id="7929352">;</span>&nbsp;<span class="op" id="7929354">!</span><span class="ident" id="7929355">ok</span>&nbsp;<span class="op" id="7929358">||</span>&nbsp;<span class="ident" id="7929361">e</span><span class="op" id="7929362">.</span><span class="ident" id="7929363">Err</span>&nbsp;<span class="op" id="7929367">!=</span>&nbsp;<span class="builtintype" id="7929370">error</span><span class="op" id="7929375">(</span><span class="ident" id="7929376">alertUnknownCA</span><span class="op" id="7929390">)</span>&nbsp;<span class="op" id="7929392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929396">t</span><span class="op" id="7929397">.</span><span class="ident" id="7929398">Errorf</span><span class="op" id="7929404">(</span><span class="string" id="7929405">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7929434">,</span>&nbsp;<span class="ident" id="7929436">err</span><span class="op" id="7929439">,</span>&nbsp;<span class="builtintype" id="7929441">error</span><span class="op" id="7929446">(</span><span class="ident" id="7929447">alertUnknownCA</span><span class="op" id="7929461">)</span><span class="op" id="7929462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929465">}</span><br>
<span class="lineno">165</span><span class="op" id="7929467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7929470">func</span>&nbsp;<span class="ident" id="7929475">TestClose</span><span class="op" id="7929484">(</span><span class="ident" id="7929485">t</span>&nbsp;<span class="op" id="7929487">*</span><span class="ident" id="7929488">testing</span><span class="op" id="7929495">.</span><span class="ident" id="7929496">T</span><span class="op" id="7929497">)</span>&nbsp;<span class="op" id="7929499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929502">c</span><span class="op" id="7929503">,</span>&nbsp;<span class="ident" id="7929505">s</span>&nbsp;<span class="op" id="7929507">:=</span>&nbsp;<span class="ident" id="7929510">net</span><span class="op" id="7929513">.</span><span class="ident" id="7929514">Pipe</span><span class="op" id="7929518">(</span><span class="op" id="7929519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929522">go</span>&nbsp;<span class="ident" id="7929525">c</span><span class="op" id="7929526">.</span><span class="ident" id="7929527">Close</span><span class="op" id="7929532">(</span><span class="op" id="7929533">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929537">err</span>&nbsp;<span class="op" id="7929541">:=</span>&nbsp;<span class="ident" id="7929544">Server</span><span class="op" id="7929550">(</span><span class="ident" id="7929551">s</span><span class="op" id="7929552">,</span>&nbsp;<span class="ident" id="7929554">testConfig</span><span class="op" id="7929564">)</span><span class="op" id="7929565">.</span><span class="ident" id="7929566">Handshake</span><span class="op" id="7929575">(</span><span class="op" id="7929576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929579">s</span><span class="op" id="7929580">.</span><span class="ident" id="7929581">Close</span><span class="op" id="7929586">(</span><span class="op" id="7929587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929590">if</span>&nbsp;<span class="ident" id="7929593">err</span>&nbsp;<span class="op" id="7929597">!=</span>&nbsp;<span class="ident" id="7929600">io</span><span class="op" id="7929602">.</span><span class="ident" id="7929603">EOF</span>&nbsp;<span class="op" id="7929607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929611">t</span><span class="op" id="7929612">.</span><span class="ident" id="7929613">Errorf</span><span class="op" id="7929619">(</span><span class="string" id="7929620">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7929649">,</span>&nbsp;<span class="ident" id="7929651">err</span><span class="op" id="7929654">,</span>&nbsp;<span class="ident" id="7929656">io</span><span class="op" id="7929658">.</span><span class="ident" id="7929659">EOF</span><span class="op" id="7929662">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929665">}</span><br>
<span class="lineno"></span><span class="op" id="7929667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7929670">func</span>&nbsp;<span class="ident" id="7929675">testHandshake</span><span class="op" id="7929688">(</span><span class="ident" id="7929689">clientConfig</span><span class="op" id="7929701">,</span>&nbsp;<span class="ident" id="7929703">serverConfig</span>&nbsp;<span class="op" id="7929716">*</span><span class="ident" id="7929717">Config</span><span class="op" id="7929723">)</span>&nbsp;<span class="op" id="7929725">(</span><span class="ident" id="7929726">state</span>&nbsp;<span class="ident" id="7929732">ConnectionState</span><span class="op" id="7929747">,</span>&nbsp;<span class="ident" id="7929749">err</span>&nbsp;<span class="builtintype" id="7929753">error</span><span class="op" id="7929758">)</span>&nbsp;<span class="op" id="7929760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929763">c</span><span class="op" id="7929764">,</span>&nbsp;<span class="ident" id="7929766">s</span>&nbsp;<span class="op" id="7929768">:=</span>&nbsp;<span class="ident" id="7929771">net</span><span class="op" id="7929774">.</span><span class="ident" id="7929775">Pipe</span><span class="op" id="7929779">(</span><span class="op" id="7929780">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929783">done</span>&nbsp;<span class="op" id="7929788">:=</span>&nbsp;<span class="builtinfunc" id="7929791">make</span><span class="op" id="7929795">(</span><span class="keyword" id="7929796">chan</span>&nbsp;<span class="builtintype" id="7929801">bool</span><span class="op" id="7929805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929808">go</span>&nbsp;<span class="keyword" id="7929811">func</span><span class="op" id="7929815">(</span><span class="op" id="7929816">)</span>&nbsp;<span class="op" id="7929818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929822">cli</span>&nbsp;<span class="op" id="7929826">:=</span>&nbsp;<span class="ident" id="7929829">Client</span><span class="op" id="7929835">(</span><span class="ident" id="7929836">c</span><span class="op" id="7929837">,</span>&nbsp;<span class="ident" id="7929839">clientConfig</span><span class="op" id="7929851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929855">cli</span><span class="op" id="7929858">.</span><span class="ident" id="7929859">Handshake</span><span class="op" id="7929868">(</span><span class="op" id="7929869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929873">c</span><span class="op" id="7929874">.</span><span class="ident" id="7929875">Close</span><span class="op" id="7929880">(</span><span class="op" id="7929881">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929885">done</span>&nbsp;<span class="op" id="7929890">&lt;-</span>&nbsp;<span class="builtintype" id="7929893">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929899">}</span><span class="op" id="7929900">(</span><span class="op" id="7929901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929904">server</span>&nbsp;<span class="op" id="7929911">:=</span>&nbsp;<span class="ident" id="7929914">Server</span><span class="op" id="7929920">(</span><span class="ident" id="7929921">s</span><span class="op" id="7929922">,</span>&nbsp;<span class="ident" id="7929924">serverConfig</span><span class="op" id="7929936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929939">err</span>&nbsp;<span class="op" id="7929943">=</span>&nbsp;<span class="ident" id="7929945">server</span><span class="op" id="7929951">.</span><span class="ident" id="7929952">Handshake</span><span class="op" id="7929961">(</span><span class="op" id="7929962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929965">if</span>&nbsp;<span class="ident" id="7929968">err</span>&nbsp;<span class="op" id="7929972">==</span>&nbsp;<span class="ident" id="7929975">nil</span>&nbsp;<span class="op" id="7929979">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929983">state</span>&nbsp;<span class="op" id="7929989">=</span>&nbsp;<span class="ident" id="7929991">server</span><span class="op" id="7929997">.</span><span class="ident" id="7929998">ConnectionState</span><span class="op" id="7930013">(</span><span class="op" id="7930014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930020">s</span><span class="op" id="7930021">.</span><span class="ident" id="7930022">Close</span><span class="op" id="7930027">(</span><span class="op" id="7930028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930031">&lt;-</span><span class="ident" id="7930033">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930039">return</span><br>
<span class="lineno">195</span><span class="op" id="7930046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7930049">func</span>&nbsp;<span class="ident" id="7930054">TestVersion</span><span class="op" id="7930065">(</span><span class="ident" id="7930066">t</span>&nbsp;<span class="op" id="7930068">*</span><span class="ident" id="7930069">testing</span><span class="op" id="7930076">.</span><span class="ident" id="7930077">T</span><span class="op" id="7930078">)</span>&nbsp;<span class="op" id="7930080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930083">serverConfig</span>&nbsp;<span class="op" id="7930096">:=</span>&nbsp;<span class="op" id="7930099">&amp;</span><span class="ident" id="7930100">Config</span><span class="op" id="7930106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930110">Certificates</span><span class="op" id="7930122">:</span>&nbsp;<span class="ident" id="7930124">testConfig</span><span class="op" id="7930134">.</span><span class="ident" id="7930135">Certificates</span><span class="op" id="7930147">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930151">MaxVersion</span><span class="op" id="7930161">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7930165">VersionTLS11</span><span class="op" id="7930177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930183">clientConfig</span>&nbsp;<span class="op" id="7930196">:=</span>&nbsp;<span class="op" id="7930199">&amp;</span><span class="ident" id="7930200">Config</span><span class="op" id="7930206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930210">InsecureSkipVerify</span><span class="op" id="7930228">:</span>&nbsp;<span class="builtintype" id="7930230">true</span><span class="op" id="7930234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930237">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930240">state</span><span class="op" id="7930245">,</span>&nbsp;<span class="ident" id="7930247">err</span>&nbsp;<span class="op" id="7930251">:=</span>&nbsp;<span class="ident" id="7930254">testHandshake</span><span class="op" id="7930267">(</span><span class="ident" id="7930268">clientConfig</span><span class="op" id="7930280">,</span>&nbsp;<span class="ident" id="7930282">serverConfig</span><span class="op" id="7930294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930297">if</span>&nbsp;<span class="ident" id="7930300">err</span>&nbsp;<span class="op" id="7930304">!=</span>&nbsp;<span class="ident" id="7930307">nil</span>&nbsp;<span class="op" id="7930311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930315">t</span><span class="op" id="7930316">.</span><span class="ident" id="7930317">Fatalf</span><span class="op" id="7930323">(</span><span class="string" id="7930324">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7930346">,</span>&nbsp;<span class="ident" id="7930348">err</span><span class="op" id="7930351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930357">if</span>&nbsp;<span class="ident" id="7930360">state</span><span class="op" id="7930365">.</span><span class="ident" id="7930366">Version</span>&nbsp;<span class="op" id="7930374">!=</span>&nbsp;<span class="ident" id="7930377">VersionTLS11</span>&nbsp;<span class="op" id="7930390">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930394">t</span><span class="op" id="7930395">.</span><span class="ident" id="7930396">Fatalf</span><span class="op" id="7930402">(</span><span class="string" id="7930403">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7930439">,</span>&nbsp;<span class="ident" id="7930441">state</span><span class="op" id="7930446">.</span><span class="ident" id="7930447">Version</span><span class="op" id="7930454">,</span>&nbsp;<span class="ident" id="7930456">VersionTLS11</span><span class="op" id="7930468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930471">}</span><br>
<span class="lineno"></span><span class="op" id="7930473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7930476">func</span>&nbsp;<span class="ident" id="7930481">TestCipherSuitePreference</span><span class="op" id="7930506">(</span><span class="ident" id="7930507">t</span>&nbsp;<span class="op" id="7930509">*</span><span class="ident" id="7930510">testing</span><span class="op" id="7930517">.</span><span class="ident" id="7930518">T</span><span class="op" id="7930519">)</span>&nbsp;<span class="op" id="7930521">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930524">serverConfig</span>&nbsp;<span class="op" id="7930537">:=</span>&nbsp;<span class="op" id="7930540">&amp;</span><span class="ident" id="7930541">Config</span><span class="op" id="7930547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930551">CipherSuites</span><span class="op" id="7930563">:</span>&nbsp;<span class="op" id="7930565">[</span><span class="op" id="7930566">]</span><span class="builtintype" id="7930567">uint16</span><span class="op" id="7930573">{</span><span class="ident" id="7930574">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7930598">,</span>&nbsp;<span class="ident" id="7930600">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7930628">,</span>&nbsp;<span class="ident" id="7930630">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7930660">}</span><span class="op" id="7930661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930665">Certificates</span><span class="op" id="7930677">:</span>&nbsp;<span class="ident" id="7930679">testConfig</span><span class="op" id="7930689">.</span><span class="ident" id="7930690">Certificates</span><span class="op" id="7930702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930706">MaxVersion</span><span class="op" id="7930716">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7930720">VersionTLS11</span><span class="op" id="7930732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930735">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930738">clientConfig</span>&nbsp;<span class="op" id="7930751">:=</span>&nbsp;<span class="op" id="7930754">&amp;</span><span class="ident" id="7930755">Config</span><span class="op" id="7930761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930765">CipherSuites</span><span class="op" id="7930777">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7930785">[</span><span class="op" id="7930786">]</span><span class="builtintype" id="7930787">uint16</span><span class="op" id="7930793">{</span><span class="ident" id="7930794">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7930822">,</span>&nbsp;<span class="ident" id="7930824">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7930848">}</span><span class="op" id="7930849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930853">InsecureSkipVerify</span><span class="op" id="7930871">:</span>&nbsp;<span class="builtintype" id="7930873">true</span><span class="op" id="7930877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930883">state</span><span class="op" id="7930888">,</span>&nbsp;<span class="ident" id="7930890">err</span>&nbsp;<span class="op" id="7930894">:=</span>&nbsp;<span class="ident" id="7930897">testHandshake</span><span class="op" id="7930910">(</span><span class="ident" id="7930911">clientConfig</span><span class="op" id="7930923">,</span>&nbsp;<span class="ident" id="7930925">serverConfig</span><span class="op" id="7930937">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930940">if</span>&nbsp;<span class="ident" id="7930943">err</span>&nbsp;<span class="op" id="7930947">!=</span>&nbsp;<span class="ident" id="7930950">nil</span>&nbsp;<span class="op" id="7930954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930958">t</span><span class="op" id="7930959">.</span><span class="ident" id="7930960">Fatalf</span><span class="op" id="7930966">(</span><span class="string" id="7930967">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7930989">,</span>&nbsp;<span class="ident" id="7930991">err</span><span class="op" id="7930994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931000">if</span>&nbsp;<span class="ident" id="7931003">state</span><span class="op" id="7931008">.</span><span class="ident" id="7931009">CipherSuite</span>&nbsp;<span class="op" id="7931021">!=</span>&nbsp;<span class="ident" id="7931024">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="7931053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931057">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931120">t</span><span class="op" id="7931121">.</span><span class="ident" id="7931122">Fatalf</span><span class="op" id="7931128">(</span><span class="string" id="7931129">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7931171">,</span>&nbsp;<span class="ident" id="7931173">state</span><span class="op" id="7931178">.</span><span class="ident" id="7931179">CipherSuite</span><span class="op" id="7931190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931197">serverConfig</span><span class="op" id="7931209">.</span><span class="ident" id="7931210">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7931235">=</span>&nbsp;<span class="builtintype" id="7931237">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931243">state</span><span class="op" id="7931248">,</span>&nbsp;<span class="ident" id="7931250">err</span>&nbsp;<span class="op" id="7931254">=</span>&nbsp;<span class="ident" id="7931256">testHandshake</span><span class="op" id="7931269">(</span><span class="ident" id="7931270">clientConfig</span><span class="op" id="7931282">,</span>&nbsp;<span class="ident" id="7931284">serverConfig</span><span class="op" id="7931296">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931299">if</span>&nbsp;<span class="ident" id="7931302">err</span>&nbsp;<span class="op" id="7931306">!=</span>&nbsp;<span class="ident" id="7931309">nil</span>&nbsp;<span class="op" id="7931313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931317">t</span><span class="op" id="7931318">.</span><span class="ident" id="7931319">Fatalf</span><span class="op" id="7931325">(</span><span class="string" id="7931326">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7931348">,</span>&nbsp;<span class="ident" id="7931350">err</span><span class="op" id="7931353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931359">if</span>&nbsp;<span class="ident" id="7931362">state</span><span class="op" id="7931367">.</span><span class="ident" id="7931368">CipherSuite</span>&nbsp;<span class="op" id="7931380">!=</span>&nbsp;<span class="ident" id="7931383">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7931408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931412">t</span><span class="op" id="7931413">.</span><span class="ident" id="7931414">Fatalf</span><span class="op" id="7931420">(</span><span class="string" id="7931421">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7931463">,</span>&nbsp;<span class="ident" id="7931465">state</span><span class="op" id="7931470">.</span><span class="ident" id="7931471">CipherSuite</span><span class="op" id="7931482">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931485">}</span><br>
<span class="lineno"></span><span class="op" id="7931487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7931490">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7931565">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7931581">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7931661">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7931680">type</span>&nbsp;<span class="ident" id="7931685">serverTest</span>&nbsp;<span class="keyword" id="7931696">struct</span>&nbsp;<span class="op" id="7931703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931706">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931779">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931820">name</span>&nbsp;<span class="builtintype" id="7931825">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931833">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931899">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931944">command</span>&nbsp;<span class="op" id="7931952">[</span><span class="op" id="7931953">]</span><span class="builtintype" id="7931954">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931962">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932026">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932060">expectedPeerCerts</span>&nbsp;<span class="op" id="7932078">[</span><span class="op" id="7932079">]</span><span class="builtintype" id="7932080">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932088">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932159">config</span>&nbsp;<span class="op" id="7932166">*</span><span class="ident" id="7932167">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932175">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932249">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932287">expectAlert</span>&nbsp;<span class="builtintype" id="7932299">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932305">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932374">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932446">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7932476">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932484">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932553">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7932626">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932663">validate</span>&nbsp;<span class="keyword" id="7932672">func</span><span class="op" id="7932676">(</span><span class="ident" id="7932677">ConnectionState</span><span class="op" id="7932692">)</span>&nbsp;<span class="builtintype" id="7932694">error</span><br>
<span class="lineno">270</span><span class="op" id="7932700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7932703">var</span>&nbsp;<span class="ident" id="7932707">defaultClientCommand</span>&nbsp;<span class="op" id="7932728">=</span>&nbsp;<span class="op" id="7932730">[</span><span class="op" id="7932731">]</span><span class="builtintype" id="7932732">string</span><span class="op" id="7932738">{</span><span class="string" id="7932739">&#34;openssl&#34;</span><span class="op" id="7932748">,</span>&nbsp;<span class="string" id="7932750">&#34;s_client&#34;</span><span class="op" id="7932760">,</span>&nbsp;<span class="string" id="7932762">&#34;-no_ticket&#34;</span><span class="op" id="7932774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7932777">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7932853">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7932933">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7932948">func</span>&nbsp;<span class="op" id="7932953">(</span><span class="ident" id="7932954">test</span>&nbsp;<span class="op" id="7932959">*</span><span class="ident" id="7932960">serverTest</span><span class="op" id="7932970">)</span>&nbsp;<span class="ident" id="7932972">connFromCommand</span><span class="op" id="7932987">(</span><span class="op" id="7932988">)</span>&nbsp;<span class="op" id="7932990">(</span><span class="ident" id="7932991">conn</span>&nbsp;<span class="op" id="7932996">*</span><span class="ident" id="7932997">recordingConn</span><span class="op" id="7933010">,</span>&nbsp;<span class="ident" id="7933012">child</span>&nbsp;<span class="op" id="7933018">*</span><span class="ident" id="7933019">exec</span><span class="op" id="7933023">.</span><span class="ident" id="7933024">Cmd</span><span class="op" id="7933027">,</span>&nbsp;<span class="ident" id="7933029">err</span>&nbsp;<span class="builtintype" id="7933033">error</span><span class="op" id="7933038">)</span>&nbsp;<span class="op" id="7933040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933043">l</span><span class="op" id="7933044">,</span>&nbsp;<span class="ident" id="7933046">err</span>&nbsp;<span class="op" id="7933050">:=</span>&nbsp;<span class="ident" id="7933053">net</span><span class="op" id="7933056">.</span><span class="ident" id="7933057">ListenTCP</span><span class="op" id="7933066">(</span><span class="string" id="7933067">&#34;tcp&#34;</span><span class="op" id="7933072">,</span>&nbsp;<span class="op" id="7933074">&amp;</span><span class="ident" id="7933075">net</span><span class="op" id="7933078">.</span><span class="ident" id="7933079">TCPAddr</span><span class="op" id="7933086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933090">IP</span><span class="op" id="7933092">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7933096">net</span><span class="op" id="7933099">.</span><span class="ident" id="7933100">IPv4</span><span class="op" id="7933104">(</span><span class="num" id="7933105">127</span><span class="op" id="7933108">,</span>&nbsp;<span class="num" id="7933110">0</span><span class="op" id="7933111">,</span>&nbsp;<span class="num" id="7933113">0</span><span class="op" id="7933114">,</span>&nbsp;<span class="num" id="7933116">1</span><span class="op" id="7933117">)</span><span class="op" id="7933118">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933122">Port</span><span class="op" id="7933126">:</span>&nbsp;<span class="num" id="7933128">0</span><span class="op" id="7933129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933132">}</span><span class="op" id="7933133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933136">if</span>&nbsp;<span class="ident" id="7933139">err</span>&nbsp;<span class="op" id="7933143">!=</span>&nbsp;<span class="ident" id="7933146">nil</span>&nbsp;<span class="op" id="7933150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933154">return</span>&nbsp;<span class="ident" id="7933161">nil</span><span class="op" id="7933164">,</span>&nbsp;<span class="ident" id="7933166">nil</span><span class="op" id="7933169">,</span>&nbsp;<span class="ident" id="7933171">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933176">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933179">defer</span>&nbsp;<span class="ident" id="7933185">l</span><span class="op" id="7933186">.</span><span class="ident" id="7933187">Close</span><span class="op" id="7933192">(</span><span class="op" id="7933193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933197">port</span>&nbsp;<span class="op" id="7933202">:=</span>&nbsp;<span class="ident" id="7933205">l</span><span class="op" id="7933206">.</span><span class="ident" id="7933207">Addr</span><span class="op" id="7933211">(</span><span class="op" id="7933212">)</span><span class="op" id="7933213">.</span><span class="op" id="7933214">(</span><span class="op" id="7933215">*</span><span class="ident" id="7933216">net</span><span class="op" id="7933219">.</span><span class="ident" id="7933220">TCPAddr</span><span class="op" id="7933227">)</span><span class="op" id="7933228">.</span><span class="ident" id="7933229">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933236">var</span>&nbsp;<span class="ident" id="7933240">command</span>&nbsp;<span class="op" id="7933248">[</span><span class="op" id="7933249">]</span><span class="builtintype" id="7933250">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933258">command</span>&nbsp;<span class="op" id="7933266">=</span>&nbsp;<span class="builtinfunc" id="7933268">append</span><span class="op" id="7933274">(</span><span class="ident" id="7933275">command</span><span class="op" id="7933282">,</span>&nbsp;<span class="ident" id="7933284">test</span><span class="op" id="7933288">.</span><span class="ident" id="7933289">command</span><span class="op" id="7933296">...</span><span class="op" id="7933299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933302">if</span>&nbsp;<span class="builtinfunc" id="7933305">len</span><span class="op" id="7933308">(</span><span class="ident" id="7933309">command</span><span class="op" id="7933316">)</span>&nbsp;<span class="op" id="7933318">==</span>&nbsp;<span class="num" id="7933321">0</span>&nbsp;<span class="op" id="7933323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933327">command</span>&nbsp;<span class="op" id="7933335">=</span>&nbsp;<span class="ident" id="7933337">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933362">command</span>&nbsp;<span class="op" id="7933370">=</span>&nbsp;<span class="builtinfunc" id="7933372">append</span><span class="op" id="7933378">(</span><span class="ident" id="7933379">command</span><span class="op" id="7933386">,</span>&nbsp;<span class="string" id="7933388">&#34;-connect&#34;</span><span class="op" id="7933398">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933401">command</span>&nbsp;<span class="op" id="7933409">=</span>&nbsp;<span class="builtinfunc" id="7933411">append</span><span class="op" id="7933417">(</span><span class="ident" id="7933418">command</span><span class="op" id="7933425">,</span>&nbsp;<span class="ident" id="7933427">fmt</span><span class="op" id="7933430">.</span><span class="ident" id="7933431">Sprintf</span><span class="op" id="7933438">(</span><span class="string" id="7933439">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7933453">,</span>&nbsp;<span class="ident" id="7933455">port</span><span class="op" id="7933459">)</span><span class="op" id="7933460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933463">cmd</span>&nbsp;<span class="op" id="7933467">:=</span>&nbsp;<span class="ident" id="7933470">exec</span><span class="op" id="7933474">.</span><span class="ident" id="7933475">Command</span><span class="op" id="7933482">(</span><span class="ident" id="7933483">command</span><span class="op" id="7933490">[</span><span class="num" id="7933491">0</span><span class="op" id="7933492">]</span><span class="op" id="7933493">,</span>&nbsp;<span class="ident" id="7933495">command</span><span class="op" id="7933502">[</span><span class="num" id="7933503">1</span><span class="op" id="7933504">:</span><span class="op" id="7933505">]</span><span class="op" id="7933506">...</span><span class="op" id="7933509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933512">cmd</span><span class="op" id="7933515">.</span><span class="ident" id="7933516">Stdin</span>&nbsp;<span class="op" id="7933522">=</span>&nbsp;<span class="ident" id="7933524">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933529">var</span>&nbsp;<span class="ident" id="7933533">output</span>&nbsp;<span class="ident" id="7933540">bytes</span><span class="op" id="7933545">.</span><span class="ident" id="7933546">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933554">cmd</span><span class="op" id="7933557">.</span><span class="ident" id="7933558">Stdout</span>&nbsp;<span class="op" id="7933565">=</span>&nbsp;<span class="op" id="7933567">&amp;</span><span class="ident" id="7933568">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933576">cmd</span><span class="op" id="7933579">.</span><span class="ident" id="7933580">Stderr</span>&nbsp;<span class="op" id="7933587">=</span>&nbsp;<span class="op" id="7933589">&amp;</span><span class="ident" id="7933590">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933598">if</span>&nbsp;<span class="ident" id="7933601">err</span>&nbsp;<span class="op" id="7933605">:=</span>&nbsp;<span class="ident" id="7933608">cmd</span><span class="op" id="7933611">.</span><span class="ident" id="7933612">Start</span><span class="op" id="7933617">(</span><span class="op" id="7933618">)</span><span class="op" id="7933619">;</span>&nbsp;<span class="ident" id="7933621">err</span>&nbsp;<span class="op" id="7933625">!=</span>&nbsp;<span class="ident" id="7933628">nil</span>&nbsp;<span class="op" id="7933632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933636">return</span>&nbsp;<span class="ident" id="7933643">nil</span><span class="op" id="7933646">,</span>&nbsp;<span class="ident" id="7933648">nil</span><span class="op" id="7933651">,</span>&nbsp;<span class="ident" id="7933653">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933662">connChan</span>&nbsp;<span class="op" id="7933671">:=</span>&nbsp;<span class="builtinfunc" id="7933674">make</span><span class="op" id="7933678">(</span><span class="keyword" id="7933679">chan</span>&nbsp;<span class="keyword" id="7933684">interface</span><span class="op" id="7933693">{</span><span class="op" id="7933694">}</span><span class="op" id="7933695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933698">go</span>&nbsp;<span class="keyword" id="7933701">func</span><span class="op" id="7933705">(</span><span class="op" id="7933706">)</span>&nbsp;<span class="op" id="7933708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933712">tcpConn</span><span class="op" id="7933719">,</span>&nbsp;<span class="ident" id="7933721">err</span>&nbsp;<span class="op" id="7933725">:=</span>&nbsp;<span class="ident" id="7933728">l</span><span class="op" id="7933729">.</span><span class="ident" id="7933730">Accept</span><span class="op" id="7933736">(</span><span class="op" id="7933737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933741">if</span>&nbsp;<span class="ident" id="7933744">err</span>&nbsp;<span class="op" id="7933748">!=</span>&nbsp;<span class="ident" id="7933751">nil</span>&nbsp;<span class="op" id="7933755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933760">connChan</span>&nbsp;<span class="op" id="7933769">&lt;-</span>&nbsp;<span class="ident" id="7933772">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933782">connChan</span>&nbsp;<span class="op" id="7933791">&lt;-</span>&nbsp;<span class="ident" id="7933794">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933803">}</span><span class="op" id="7933804">(</span><span class="op" id="7933805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933809">var</span>&nbsp;<span class="ident" id="7933813">tcpConn</span>&nbsp;<span class="ident" id="7933821">net</span><span class="op" id="7933824">.</span><span class="ident" id="7933825">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933831">select</span>&nbsp;<span class="op" id="7933838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933841">case</span>&nbsp;<span class="ident" id="7933846">connOrError</span>&nbsp;<span class="op" id="7933858">:=</span>&nbsp;<span class="op" id="7933861">&lt;-</span><span class="ident" id="7933863">connChan</span><span class="op" id="7933871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933875">if</span>&nbsp;<span class="ident" id="7933878">err</span><span class="op" id="7933881">,</span>&nbsp;<span class="ident" id="7933883">ok</span>&nbsp;<span class="op" id="7933886">:=</span>&nbsp;<span class="ident" id="7933889">connOrError</span><span class="op" id="7933900">.</span><span class="op" id="7933901">(</span><span class="builtintype" id="7933902">error</span><span class="op" id="7933907">)</span><span class="op" id="7933908">;</span>&nbsp;<span class="ident" id="7933910">ok</span>&nbsp;<span class="op" id="7933913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933918">return</span>&nbsp;<span class="ident" id="7933925">nil</span><span class="op" id="7933928">,</span>&nbsp;<span class="ident" id="7933930">nil</span><span class="op" id="7933933">,</span>&nbsp;<span class="ident" id="7933935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933941">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933945">tcpConn</span>&nbsp;<span class="op" id="7933953">=</span>&nbsp;<span class="ident" id="7933955">connOrError</span><span class="op" id="7933966">.</span><span class="op" id="7933967">(</span><span class="ident" id="7933968">net</span><span class="op" id="7933971">.</span><span class="ident" id="7933972">Conn</span><span class="op" id="7933976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933979">case</span>&nbsp;<span class="op" id="7933984">&lt;-</span><span class="ident" id="7933986">time</span><span class="op" id="7933990">.</span><span class="ident" id="7933991">After</span><span class="op" id="7933996">(</span><span class="num" id="7933997">2</span>&nbsp;<span class="op" id="7933999">*</span>&nbsp;<span class="ident" id="7934001">time</span><span class="op" id="7934005">.</span><span class="ident" id="7934006">Second</span><span class="op" id="7934012">)</span><span class="op" id="7934013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934017">output</span><span class="op" id="7934023">.</span><span class="ident" id="7934024">WriteTo</span><span class="op" id="7934031">(</span><span class="ident" id="7934032">os</span><span class="op" id="7934034">.</span><span class="ident" id="7934035">Stdout</span><span class="op" id="7934041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934045">return</span>&nbsp;<span class="ident" id="7934052">nil</span><span class="op" id="7934055">,</span>&nbsp;<span class="ident" id="7934057">nil</span><span class="op" id="7934060">,</span>&nbsp;<span class="ident" id="7934062">errors</span><span class="op" id="7934068">.</span><span class="ident" id="7934069">New</span><span class="op" id="7934072">(</span><span class="string" id="7934073">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7934126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934129">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934133">record</span>&nbsp;<span class="op" id="7934140">:=</span>&nbsp;<span class="op" id="7934143">&amp;</span><span class="ident" id="7934144">recordingConn</span><span class="op" id="7934157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934161">Conn</span><span class="op" id="7934165">:</span>&nbsp;<span class="ident" id="7934167">tcpConn</span><span class="op" id="7934174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934181">return</span>&nbsp;<span class="ident" id="7934188">record</span><span class="op" id="7934194">,</span>&nbsp;<span class="ident" id="7934196">cmd</span><span class="op" id="7934199">,</span>&nbsp;<span class="ident" id="7934201">nil</span><br>
<span class="lineno"></span><span class="op" id="7934205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7934208">func</span>&nbsp;<span class="op" id="7934213">(</span><span class="ident" id="7934214">test</span>&nbsp;<span class="op" id="7934219">*</span><span class="ident" id="7934220">serverTest</span><span class="op" id="7934230">)</span>&nbsp;<span class="ident" id="7934232">dataPath</span><span class="op" id="7934240">(</span><span class="op" id="7934241">)</span>&nbsp;<span class="builtintype" id="7934243">string</span>&nbsp;<span class="op" id="7934250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934253">return</span>&nbsp;<span class="ident" id="7934260">filepath</span><span class="op" id="7934268">.</span><span class="ident" id="7934269">Join</span><span class="op" id="7934273">(</span><span class="string" id="7934274">&#34;testdata&#34;</span><span class="op" id="7934284">,</span>&nbsp;<span class="string" id="7934286">&#34;Server-&#34;</span><span class="op" id="7934295">+</span><span class="ident" id="7934296">test</span><span class="op" id="7934300">.</span><span class="ident" id="7934301">name</span><span class="op" id="7934305">)</span><br>
<span class="lineno">335</span><span class="op" id="7934307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7934310">func</span>&nbsp;<span class="op" id="7934315">(</span><span class="ident" id="7934316">test</span>&nbsp;<span class="op" id="7934321">*</span><span class="ident" id="7934322">serverTest</span><span class="op" id="7934332">)</span>&nbsp;<span class="ident" id="7934334">loadData</span><span class="op" id="7934342">(</span><span class="op" id="7934343">)</span>&nbsp;<span class="op" id="7934345">(</span><span class="ident" id="7934346">flows</span>&nbsp;<span class="op" id="7934352">[</span><span class="op" id="7934353">]</span><span class="op" id="7934354">[</span><span class="op" id="7934355">]</span><span class="builtintype" id="7934356">byte</span><span class="op" id="7934360">,</span>&nbsp;<span class="ident" id="7934362">err</span>&nbsp;<span class="builtintype" id="7934366">error</span><span class="op" id="7934371">)</span>&nbsp;<span class="op" id="7934373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934376">in</span><span class="op" id="7934378">,</span>&nbsp;<span class="ident" id="7934380">err</span>&nbsp;<span class="op" id="7934384">:=</span>&nbsp;<span class="ident" id="7934387">os</span><span class="op" id="7934389">.</span><span class="ident" id="7934390">Open</span><span class="op" id="7934394">(</span><span class="ident" id="7934395">test</span><span class="op" id="7934399">.</span><span class="ident" id="7934400">dataPath</span><span class="op" id="7934408">(</span><span class="op" id="7934409">)</span><span class="op" id="7934410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934413">if</span>&nbsp;<span class="ident" id="7934416">err</span>&nbsp;<span class="op" id="7934420">!=</span>&nbsp;<span class="ident" id="7934423">nil</span>&nbsp;<span class="op" id="7934427">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934431">return</span>&nbsp;<span class="ident" id="7934438">nil</span><span class="op" id="7934441">,</span>&nbsp;<span class="ident" id="7934443">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934451">defer</span>&nbsp;<span class="ident" id="7934457">in</span><span class="op" id="7934459">.</span><span class="ident" id="7934460">Close</span><span class="op" id="7934465">(</span><span class="op" id="7934466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934469">return</span>&nbsp;<span class="ident" id="7934476">parseTestData</span><span class="op" id="7934489">(</span><span class="ident" id="7934490">in</span><span class="op" id="7934492">)</span><br>
<span class="lineno"></span><span class="op" id="7934494">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7934497">func</span>&nbsp;<span class="op" id="7934502">(</span><span class="ident" id="7934503">test</span>&nbsp;<span class="op" id="7934508">*</span><span class="ident" id="7934509">serverTest</span><span class="op" id="7934519">)</span>&nbsp;<span class="ident" id="7934521">run</span><span class="op" id="7934524">(</span><span class="ident" id="7934525">t</span>&nbsp;<span class="op" id="7934527">*</span><span class="ident" id="7934528">testing</span><span class="op" id="7934535">.</span><span class="ident" id="7934536">T</span><span class="op" id="7934537">,</span>&nbsp;<span class="ident" id="7934539">write</span>&nbsp;<span class="builtintype" id="7934545">bool</span><span class="op" id="7934549">)</span>&nbsp;<span class="op" id="7934551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934554">var</span>&nbsp;<span class="ident" id="7934558">clientConn</span><span class="op" id="7934568">,</span>&nbsp;<span class="ident" id="7934570">serverConn</span>&nbsp;<span class="ident" id="7934581">net</span><span class="op" id="7934584">.</span><span class="ident" id="7934585">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934591">var</span>&nbsp;<span class="ident" id="7934595">recordingConn</span>&nbsp;<span class="op" id="7934609">*</span><span class="ident" id="7934610">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934625">var</span>&nbsp;<span class="ident" id="7934629">childProcess</span>&nbsp;<span class="op" id="7934642">*</span><span class="ident" id="7934643">exec</span><span class="op" id="7934647">.</span><span class="ident" id="7934648">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934654">if</span>&nbsp;<span class="ident" id="7934657">write</span>&nbsp;<span class="op" id="7934663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934667">var</span>&nbsp;<span class="ident" id="7934671">err</span>&nbsp;<span class="builtintype" id="7934675">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934683">recordingConn</span><span class="op" id="7934696">,</span>&nbsp;<span class="ident" id="7934698">childProcess</span><span class="op" id="7934710">,</span>&nbsp;<span class="ident" id="7934712">err</span>&nbsp;<span class="op" id="7934716">=</span>&nbsp;<span class="ident" id="7934718">test</span><span class="op" id="7934722">.</span><span class="ident" id="7934723">connFromCommand</span><span class="op" id="7934738">(</span><span class="op" id="7934739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934743">if</span>&nbsp;<span class="ident" id="7934746">err</span>&nbsp;<span class="op" id="7934750">!=</span>&nbsp;<span class="ident" id="7934753">nil</span>&nbsp;<span class="op" id="7934757">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934762">t</span><span class="op" id="7934763">.</span><span class="ident" id="7934764">Fatalf</span><span class="op" id="7934770">(</span><span class="string" id="7934771">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7934803">,</span>&nbsp;<span class="ident" id="7934805">err</span><span class="op" id="7934808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934816">serverConn</span>&nbsp;<span class="op" id="7934827">=</span>&nbsp;<span class="ident" id="7934829">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934844">}</span>&nbsp;<span class="keyword" id="7934846">else</span>&nbsp;<span class="op" id="7934851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934855">clientConn</span><span class="op" id="7934865">,</span>&nbsp;<span class="ident" id="7934867">serverConn</span>&nbsp;<span class="op" id="7934878">=</span>&nbsp;<span class="ident" id="7934880">net</span><span class="op" id="7934883">.</span><span class="ident" id="7934884">Pipe</span><span class="op" id="7934888">(</span><span class="op" id="7934889">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934895">config</span>&nbsp;<span class="op" id="7934902">:=</span>&nbsp;<span class="ident" id="7934905">test</span><span class="op" id="7934909">.</span><span class="ident" id="7934910">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934918">if</span>&nbsp;<span class="ident" id="7934921">config</span>&nbsp;<span class="op" id="7934928">==</span>&nbsp;<span class="ident" id="7934931">nil</span>&nbsp;<span class="op" id="7934935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934939">config</span>&nbsp;<span class="op" id="7934946">=</span>&nbsp;<span class="ident" id="7934948">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934960">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934963">server</span>&nbsp;<span class="op" id="7934970">:=</span>&nbsp;<span class="ident" id="7934973">Server</span><span class="op" id="7934979">(</span><span class="ident" id="7934980">serverConn</span><span class="op" id="7934990">,</span>&nbsp;<span class="ident" id="7934992">config</span><span class="op" id="7934998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935001">connStateChan</span>&nbsp;<span class="op" id="7935015">:=</span>&nbsp;<span class="builtinfunc" id="7935018">make</span><span class="op" id="7935022">(</span><span class="keyword" id="7935023">chan</span>&nbsp;<span class="ident" id="7935028">ConnectionState</span><span class="op" id="7935043">,</span>&nbsp;<span class="num" id="7935045">1</span><span class="op" id="7935046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935049">go</span>&nbsp;<span class="keyword" id="7935052">func</span><span class="op" id="7935056">(</span><span class="op" id="7935057">)</span>&nbsp;<span class="op" id="7935059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935063">var</span>&nbsp;<span class="ident" id="7935067">err</span>&nbsp;<span class="builtintype" id="7935071">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935079">if</span>&nbsp;<span class="ident" id="7935082">_</span><span class="op" id="7935083">,</span>&nbsp;<span class="ident" id="7935085">err</span>&nbsp;<span class="op" id="7935089">=</span>&nbsp;<span class="ident" id="7935091">server</span><span class="op" id="7935097">.</span><span class="ident" id="7935098">Write</span><span class="op" id="7935103">(</span><span class="op" id="7935104">[</span><span class="op" id="7935105">]</span><span class="builtintype" id="7935106">byte</span><span class="op" id="7935110">(</span><span class="string" id="7935111">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7935127">)</span><span class="op" id="7935128">)</span><span class="op" id="7935129">;</span>&nbsp;<span class="ident" id="7935131">err</span>&nbsp;<span class="op" id="7935135">!=</span>&nbsp;<span class="ident" id="7935138">nil</span>&nbsp;<span class="op" id="7935142">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935147">t</span><span class="op" id="7935148">.</span><span class="ident" id="7935149">Logf</span><span class="op" id="7935153">(</span><span class="string" id="7935154">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7935183">,</span>&nbsp;<span class="ident" id="7935185">err</span><span class="op" id="7935188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935196">if</span>&nbsp;<span class="builtinfunc" id="7935199">len</span><span class="op" id="7935202">(</span><span class="ident" id="7935203">test</span><span class="op" id="7935207">.</span><span class="ident" id="7935208">expectHandshakeErrorIncluding</span><span class="op" id="7935237">)</span>&nbsp;<span class="op" id="7935239">&gt;</span>&nbsp;<span class="num" id="7935241">0</span>&nbsp;<span class="op" id="7935243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935248">if</span>&nbsp;<span class="ident" id="7935251">err</span>&nbsp;<span class="op" id="7935255">==</span>&nbsp;<span class="ident" id="7935258">nil</span>&nbsp;<span class="op" id="7935262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935268">t</span><span class="op" id="7935269">.</span><span class="ident" id="7935270">Errorf</span><span class="op" id="7935276">(</span><span class="string" id="7935277">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7935316">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935321">}</span>&nbsp;<span class="keyword" id="7935323">else</span>&nbsp;<span class="keyword" id="7935328">if</span>&nbsp;<span class="ident" id="7935331">s</span>&nbsp;<span class="op" id="7935333">:=</span>&nbsp;<span class="ident" id="7935336">err</span><span class="op" id="7935339">.</span><span class="ident" id="7935340">Error</span><span class="op" id="7935345">(</span><span class="op" id="7935346">)</span><span class="op" id="7935347">;</span>&nbsp;<span class="op" id="7935349">!</span><span class="ident" id="7935350">strings</span><span class="op" id="7935357">.</span><span class="ident" id="7935358">Contains</span><span class="op" id="7935366">(</span><span class="ident" id="7935367">s</span><span class="op" id="7935368">,</span>&nbsp;<span class="ident" id="7935370">test</span><span class="op" id="7935374">.</span><span class="ident" id="7935375">expectHandshakeErrorIncluding</span><span class="op" id="7935404">)</span>&nbsp;<span class="op" id="7935406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935412">t</span><span class="op" id="7935413">.</span><span class="ident" id="7935414">Errorf</span><span class="op" id="7935420">(</span><span class="string" id="7935421">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7935466">,</span>&nbsp;<span class="ident" id="7935468">test</span><span class="op" id="7935472">.</span><span class="ident" id="7935473">expectHandshakeErrorIncluding</span><span class="op" id="7935502">,</span>&nbsp;<span class="ident" id="7935504">s</span><span class="op" id="7935505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935518">server</span><span class="op" id="7935524">.</span><span class="ident" id="7935525">Close</span><span class="op" id="7935530">(</span><span class="op" id="7935531">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935535">serverConn</span><span class="op" id="7935545">.</span><span class="ident" id="7935546">Close</span><span class="op" id="7935551">(</span><span class="op" id="7935552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935556">connStateChan</span>&nbsp;<span class="op" id="7935570">&lt;-</span>&nbsp;<span class="ident" id="7935573">server</span><span class="op" id="7935579">.</span><span class="ident" id="7935580">ConnectionState</span><span class="op" id="7935595">(</span><span class="op" id="7935596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935599">}</span><span class="op" id="7935600">(</span><span class="op" id="7935601">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935605">if</span>&nbsp;<span class="op" id="7935608">!</span><span class="ident" id="7935609">write</span>&nbsp;<span class="op" id="7935615">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935619">flows</span><span class="op" id="7935624">,</span>&nbsp;<span class="ident" id="7935626">err</span>&nbsp;<span class="op" id="7935630">:=</span>&nbsp;<span class="ident" id="7935633">test</span><span class="op" id="7935637">.</span><span class="ident" id="7935638">loadData</span><span class="op" id="7935646">(</span><span class="op" id="7935647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935651">if</span>&nbsp;<span class="ident" id="7935654">err</span>&nbsp;<span class="op" id="7935658">!=</span>&nbsp;<span class="ident" id="7935661">nil</span>&nbsp;<span class="op" id="7935665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935670">if</span>&nbsp;<span class="op" id="7935673">!</span><span class="ident" id="7935674">test</span><span class="op" id="7935678">.</span><span class="ident" id="7935679">expectAlert</span>&nbsp;<span class="op" id="7935691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935697">t</span><span class="op" id="7935698">.</span><span class="ident" id="7935699">Fatalf</span><span class="op" id="7935705">(</span><span class="string" id="7935706">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7935739">,</span>&nbsp;<span class="ident" id="7935741">test</span><span class="op" id="7935745">.</span><span class="ident" id="7935746">name</span><span class="op" id="7935750">,</span>&nbsp;<span class="ident" id="7935752">test</span><span class="op" id="7935756">.</span><span class="ident" id="7935757">dataPath</span><span class="op" id="7935765">(</span><span class="op" id="7935766">)</span><span class="op" id="7935767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935772">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935780">for</span>&nbsp;<span class="ident" id="7935784">i</span><span class="op" id="7935785">,</span>&nbsp;<span class="ident" id="7935787">b</span>&nbsp;<span class="op" id="7935789">:=</span>&nbsp;<span class="keyword" id="7935792">range</span>&nbsp;<span class="ident" id="7935798">flows</span>&nbsp;<span class="op" id="7935804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935809">if</span>&nbsp;<span class="ident" id="7935812">i</span><span class="op" id="7935813">%</span><span class="num" id="7935814">2</span>&nbsp;<span class="op" id="7935816">==</span>&nbsp;<span class="num" id="7935819">0</span>&nbsp;<span class="op" id="7935821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935827">clientConn</span><span class="op" id="7935837">.</span><span class="ident" id="7935838">Write</span><span class="op" id="7935843">(</span><span class="ident" id="7935844">b</span><span class="op" id="7935845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935851">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935868">bb</span>&nbsp;<span class="op" id="7935871">:=</span>&nbsp;<span class="builtinfunc" id="7935874">make</span><span class="op" id="7935878">(</span><span class="op" id="7935879">[</span><span class="op" id="7935880">]</span><span class="builtintype" id="7935881">byte</span><span class="op" id="7935885">,</span>&nbsp;<span class="builtinfunc" id="7935887">len</span><span class="op" id="7935890">(</span><span class="ident" id="7935891">b</span><span class="op" id="7935892">)</span><span class="op" id="7935893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935898">n</span><span class="op" id="7935899">,</span>&nbsp;<span class="ident" id="7935901">err</span>&nbsp;<span class="op" id="7935905">:=</span>&nbsp;<span class="ident" id="7935908">io</span><span class="op" id="7935910">.</span><span class="ident" id="7935911">ReadFull</span><span class="op" id="7935919">(</span><span class="ident" id="7935920">clientConn</span><span class="op" id="7935930">,</span>&nbsp;<span class="ident" id="7935932">bb</span><span class="op" id="7935934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935939">if</span>&nbsp;<span class="ident" id="7935942">test</span><span class="op" id="7935946">.</span><span class="ident" id="7935947">expectAlert</span>&nbsp;<span class="op" id="7935959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935965">if</span>&nbsp;<span class="ident" id="7935968">err</span>&nbsp;<span class="op" id="7935972">==</span>&nbsp;<span class="ident" id="7935975">nil</span>&nbsp;<span class="op" id="7935979">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935986">t</span><span class="op" id="7935987">.</span><span class="ident" id="7935988">Fatal</span><span class="op" id="7935993">(</span><span class="string" id="7935994">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7936036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936047">}</span>&nbsp;<span class="keyword" id="7936049">else</span>&nbsp;<span class="op" id="7936054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936060">if</span>&nbsp;<span class="ident" id="7936063">err</span>&nbsp;<span class="op" id="7936067">!=</span>&nbsp;<span class="ident" id="7936070">nil</span>&nbsp;<span class="op" id="7936074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936081">t</span><span class="op" id="7936082">.</span><span class="ident" id="7936083">Fatalf</span><span class="op" id="7936089">(</span><span class="string" id="7936090">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7936143">,</span>&nbsp;<span class="ident" id="7936145">test</span><span class="op" id="7936149">.</span><span class="ident" id="7936150">name</span><span class="op" id="7936154">,</span>&nbsp;<span class="ident" id="7936156">i</span><span class="op" id="7936157">+</span><span class="num" id="7936158">1</span><span class="op" id="7936159">,</span>&nbsp;<span class="ident" id="7936161">err</span><span class="op" id="7936164">,</span>&nbsp;<span class="ident" id="7936166">n</span><span class="op" id="7936167">,</span>&nbsp;<span class="builtinfunc" id="7936169">len</span><span class="op" id="7936172">(</span><span class="ident" id="7936173">bb</span><span class="op" id="7936175">)</span><span class="op" id="7936176">,</span>&nbsp;<span class="ident" id="7936178">bb</span><span class="op" id="7936180">[</span><span class="op" id="7936181">:</span><span class="ident" id="7936182">n</span><span class="op" id="7936183">]</span><span class="op" id="7936184">,</span>&nbsp;<span class="ident" id="7936186">b</span><span class="op" id="7936187">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936199">if</span>&nbsp;<span class="op" id="7936202">!</span><span class="ident" id="7936203">bytes</span><span class="op" id="7936208">.</span><span class="ident" id="7936209">Equal</span><span class="op" id="7936214">(</span><span class="ident" id="7936215">b</span><span class="op" id="7936216">,</span>&nbsp;<span class="ident" id="7936218">bb</span><span class="op" id="7936220">)</span>&nbsp;<span class="op" id="7936222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936229">t</span><span class="op" id="7936230">.</span><span class="ident" id="7936231">Fatalf</span><span class="op" id="7936237">(</span><span class="string" id="7936238">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7936280">,</span>&nbsp;<span class="ident" id="7936282">test</span><span class="op" id="7936286">.</span><span class="ident" id="7936287">name</span><span class="op" id="7936291">,</span>&nbsp;<span class="ident" id="7936293">i</span><span class="op" id="7936294">+</span><span class="num" id="7936295">1</span><span class="op" id="7936296">,</span>&nbsp;<span class="ident" id="7936298">bb</span><span class="op" id="7936300">,</span>&nbsp;<span class="ident" id="7936302">b</span><span class="op" id="7936303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936314">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936322">clientConn</span><span class="op" id="7936332">.</span><span class="ident" id="7936333">Close</span><span class="op" id="7936338">(</span><span class="op" id="7936339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936346">connState</span>&nbsp;<span class="op" id="7936356">:=</span>&nbsp;<span class="op" id="7936359">&lt;-</span><span class="ident" id="7936361">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936376">peerCerts</span>&nbsp;<span class="op" id="7936386">:=</span>&nbsp;<span class="ident" id="7936389">connState</span><span class="op" id="7936398">.</span><span class="ident" id="7936399">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936417">if</span>&nbsp;<span class="builtinfunc" id="7936420">len</span><span class="op" id="7936423">(</span><span class="ident" id="7936424">peerCerts</span><span class="op" id="7936433">)</span>&nbsp;<span class="op" id="7936435">==</span>&nbsp;<span class="builtinfunc" id="7936438">len</span><span class="op" id="7936441">(</span><span class="ident" id="7936442">test</span><span class="op" id="7936446">.</span><span class="ident" id="7936447">expectedPeerCerts</span><span class="op" id="7936464">)</span>&nbsp;<span class="op" id="7936466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936470">for</span>&nbsp;<span class="ident" id="7936474">i</span><span class="op" id="7936475">,</span>&nbsp;<span class="ident" id="7936477">peerCert</span>&nbsp;<span class="op" id="7936486">:=</span>&nbsp;<span class="keyword" id="7936489">range</span>&nbsp;<span class="ident" id="7936495">peerCerts</span>&nbsp;<span class="op" id="7936505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936510">block</span><span class="op" id="7936515">,</span>&nbsp;<span class="ident" id="7936517">_</span>&nbsp;<span class="op" id="7936519">:=</span>&nbsp;<span class="ident" id="7936522">pem</span><span class="op" id="7936525">.</span><span class="ident" id="7936526">Decode</span><span class="op" id="7936532">(</span><span class="op" id="7936533">[</span><span class="op" id="7936534">]</span><span class="builtintype" id="7936535">byte</span><span class="op" id="7936539">(</span><span class="ident" id="7936540">test</span><span class="op" id="7936544">.</span><span class="ident" id="7936545">expectedPeerCerts</span><span class="op" id="7936562">[</span><span class="ident" id="7936563">i</span><span class="op" id="7936564">]</span><span class="op" id="7936565">)</span><span class="op" id="7936566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936571">if</span>&nbsp;<span class="op" id="7936574">!</span><span class="ident" id="7936575">bytes</span><span class="op" id="7936580">.</span><span class="ident" id="7936581">Equal</span><span class="op" id="7936586">(</span><span class="ident" id="7936587">block</span><span class="op" id="7936592">.</span><span class="ident" id="7936593">Bytes</span><span class="op" id="7936598">,</span>&nbsp;<span class="ident" id="7936600">peerCert</span><span class="op" id="7936608">.</span><span class="ident" id="7936609">Raw</span><span class="op" id="7936612">)</span>&nbsp;<span class="op" id="7936614">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936620">t</span><span class="op" id="7936621">.</span><span class="ident" id="7936622">Fatalf</span><span class="op" id="7936628">(</span><span class="string" id="7936629">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7936659">,</span>&nbsp;<span class="ident" id="7936661">test</span><span class="op" id="7936665">.</span><span class="ident" id="7936666">name</span><span class="op" id="7936670">,</span>&nbsp;<span class="ident" id="7936672">i</span><span class="op" id="7936673">+</span><span class="num" id="7936674">1</span><span class="op" id="7936675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936687">}</span>&nbsp;<span class="keyword" id="7936689">else</span>&nbsp;<span class="op" id="7936694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936698">t</span><span class="op" id="7936699">.</span><span class="ident" id="7936700">Fatalf</span><span class="op" id="7936706">(</span><span class="string" id="7936707">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7936766">,</span>&nbsp;<span class="ident" id="7936768">test</span><span class="op" id="7936772">.</span><span class="ident" id="7936773">name</span><span class="op" id="7936777">,</span>&nbsp;<span class="builtinfunc" id="7936779">len</span><span class="op" id="7936782">(</span><span class="ident" id="7936783">test</span><span class="op" id="7936787">.</span><span class="ident" id="7936788">expectedPeerCerts</span><span class="op" id="7936805">)</span><span class="op" id="7936806">,</span>&nbsp;<span class="builtinfunc" id="7936808">len</span><span class="op" id="7936811">(</span><span class="ident" id="7936812">peerCerts</span><span class="op" id="7936821">)</span><span class="op" id="7936822">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936829">if</span>&nbsp;<span class="ident" id="7936832">test</span><span class="op" id="7936836">.</span><span class="ident" id="7936837">validate</span>&nbsp;<span class="op" id="7936846">!=</span>&nbsp;<span class="ident" id="7936849">nil</span>&nbsp;<span class="op" id="7936853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936857">if</span>&nbsp;<span class="ident" id="7936860">err</span>&nbsp;<span class="op" id="7936864">:=</span>&nbsp;<span class="ident" id="7936867">test</span><span class="op" id="7936871">.</span><span class="ident" id="7936872">validate</span><span class="op" id="7936880">(</span><span class="ident" id="7936881">connState</span><span class="op" id="7936890">)</span><span class="op" id="7936891">;</span>&nbsp;<span class="ident" id="7936893">err</span>&nbsp;<span class="op" id="7936897">!=</span>&nbsp;<span class="ident" id="7936900">nil</span>&nbsp;<span class="op" id="7936904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936909">t</span><span class="op" id="7936910">.</span><span class="ident" id="7936911">Fatalf</span><span class="op" id="7936917">(</span><span class="string" id="7936918">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7936956">,</span>&nbsp;<span class="ident" id="7936958">err</span><span class="op" id="7936961">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936972">if</span>&nbsp;<span class="ident" id="7936975">write</span>&nbsp;<span class="op" id="7936981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936985">path</span>&nbsp;<span class="op" id="7936990">:=</span>&nbsp;<span class="ident" id="7936993">test</span><span class="op" id="7936997">.</span><span class="ident" id="7936998">dataPath</span><span class="op" id="7937006">(</span><span class="op" id="7937007">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937011">out</span><span class="op" id="7937014">,</span>&nbsp;<span class="ident" id="7937016">err</span>&nbsp;<span class="op" id="7937020">:=</span>&nbsp;<span class="ident" id="7937023">os</span><span class="op" id="7937025">.</span><span class="ident" id="7937026">OpenFile</span><span class="op" id="7937034">(</span><span class="ident" id="7937035">path</span><span class="op" id="7937039">,</span>&nbsp;<span class="ident" id="7937041">os</span><span class="op" id="7937043">.</span><span class="ident" id="7937044">O_WRONLY</span><span class="op" id="7937052">|</span><span class="ident" id="7937053">os</span><span class="op" id="7937055">.</span><span class="ident" id="7937056">O_CREATE</span><span class="op" id="7937064">|</span><span class="ident" id="7937065">os</span><span class="op" id="7937067">.</span><span class="ident" id="7937068">O_TRUNC</span><span class="op" id="7937075">,</span>&nbsp;<span class="num" id="7937077">0644</span><span class="op" id="7937081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937085">if</span>&nbsp;<span class="ident" id="7937088">err</span>&nbsp;<span class="op" id="7937092">!=</span>&nbsp;<span class="ident" id="7937095">nil</span>&nbsp;<span class="op" id="7937099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937104">t</span><span class="op" id="7937105">.</span><span class="ident" id="7937106">Fatalf</span><span class="op" id="7937112">(</span><span class="string" id="7937113">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7937147">,</span>&nbsp;<span class="ident" id="7937149">err</span><span class="op" id="7937152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937160">defer</span>&nbsp;<span class="ident" id="7937166">out</span><span class="op" id="7937169">.</span><span class="ident" id="7937170">Close</span><span class="op" id="7937175">(</span><span class="op" id="7937176">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937180">recordingConn</span><span class="op" id="7937193">.</span><span class="ident" id="7937194">Close</span><span class="op" id="7937199">(</span><span class="op" id="7937200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937204">if</span>&nbsp;<span class="builtinfunc" id="7937207">len</span><span class="op" id="7937210">(</span><span class="ident" id="7937211">recordingConn</span><span class="op" id="7937224">.</span><span class="ident" id="7937225">flows</span><span class="op" id="7937230">)</span>&nbsp;<span class="op" id="7937232">&lt;</span>&nbsp;<span class="num" id="7937234">3</span>&nbsp;<span class="op" id="7937236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937241">childProcess</span><span class="op" id="7937253">.</span><span class="ident" id="7937254">Stdout</span><span class="op" id="7937260">.</span><span class="op" id="7937261">(</span><span class="op" id="7937262">*</span><span class="ident" id="7937263">bytes</span><span class="op" id="7937268">.</span><span class="ident" id="7937269">Buffer</span><span class="op" id="7937275">)</span><span class="op" id="7937276">.</span><span class="ident" id="7937277">WriteTo</span><span class="op" id="7937284">(</span><span class="ident" id="7937285">os</span><span class="op" id="7937287">.</span><span class="ident" id="7937288">Stdout</span><span class="op" id="7937294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937299">if</span>&nbsp;<span class="builtinfunc" id="7937302">len</span><span class="op" id="7937305">(</span><span class="ident" id="7937306">test</span><span class="op" id="7937310">.</span><span class="ident" id="7937311">expectHandshakeErrorIncluding</span><span class="op" id="7937340">)</span>&nbsp;<span class="op" id="7937342">==</span>&nbsp;<span class="num" id="7937345">0</span>&nbsp;<span class="op" id="7937347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937353">t</span><span class="op" id="7937354">.</span><span class="ident" id="7937355">Fatalf</span><span class="op" id="7937361">(</span><span class="string" id="7937362">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7937380">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937393">recordingConn</span><span class="op" id="7937406">.</span><span class="ident" id="7937407">WriteTo</span><span class="op" id="7937414">(</span><span class="ident" id="7937415">out</span><span class="op" id="7937418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937422">fmt</span><span class="op" id="7937425">.</span><span class="ident" id="7937426">Printf</span><span class="op" id="7937432">(</span><span class="string" id="7937433">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7937445">,</span>&nbsp;<span class="ident" id="7937447">path</span><span class="op" id="7937451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937455">childProcess</span><span class="op" id="7937467">.</span><span class="ident" id="7937468">Wait</span><span class="op" id="7937472">(</span><span class="op" id="7937473">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937476">}</span><br>
<span class="lineno"></span><span class="op" id="7937478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7937481">func</span>&nbsp;<span class="ident" id="7937486">runServerTestForVersion</span><span class="op" id="7937509">(</span><span class="ident" id="7937510">t</span>&nbsp;<span class="op" id="7937512">*</span><span class="ident" id="7937513">testing</span><span class="op" id="7937520">.</span><span class="ident" id="7937521">T</span><span class="op" id="7937522">,</span>&nbsp;<span class="ident" id="7937524">template</span>&nbsp;<span class="op" id="7937533">*</span><span class="ident" id="7937534">serverTest</span><span class="op" id="7937544">,</span>&nbsp;<span class="ident" id="7937546">prefix</span><span class="op" id="7937552">,</span>&nbsp;<span class="ident" id="7937554">option</span>&nbsp;<span class="builtintype" id="7937561">string</span><span class="op" id="7937567">)</span>&nbsp;<span class="op" id="7937569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937572">test</span>&nbsp;<span class="op" id="7937577">:=</span>&nbsp;<span class="op" id="7937580">*</span><span class="ident" id="7937581">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937591">test</span><span class="op" id="7937595">.</span><span class="ident" id="7937596">name</span>&nbsp;<span class="op" id="7937601">=</span>&nbsp;<span class="ident" id="7937603">prefix</span>&nbsp;<span class="op" id="7937610">+</span>&nbsp;<span class="ident" id="7937612">test</span><span class="op" id="7937616">.</span><span class="ident" id="7937617">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937623">if</span>&nbsp;<span class="builtinfunc" id="7937626">len</span><span class="op" id="7937629">(</span><span class="ident" id="7937630">test</span><span class="op" id="7937634">.</span><span class="ident" id="7937635">command</span><span class="op" id="7937642">)</span>&nbsp;<span class="op" id="7937644">==</span>&nbsp;<span class="num" id="7937647">0</span>&nbsp;<span class="op" id="7937649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937653">test</span><span class="op" id="7937657">.</span><span class="ident" id="7937658">command</span>&nbsp;<span class="op" id="7937666">=</span>&nbsp;<span class="ident" id="7937668">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937693">test</span><span class="op" id="7937697">.</span><span class="ident" id="7937698">command</span>&nbsp;<span class="op" id="7937706">=</span>&nbsp;<span class="builtinfunc" id="7937708">append</span><span class="op" id="7937714">(</span><span class="op" id="7937715">[</span><span class="op" id="7937716">]</span><span class="builtintype" id="7937717">string</span><span class="op" id="7937723">(</span><span class="ident" id="7937724">nil</span><span class="op" id="7937727">)</span><span class="op" id="7937728">,</span>&nbsp;<span class="ident" id="7937730">test</span><span class="op" id="7937734">.</span><span class="ident" id="7937735">command</span><span class="op" id="7937742">...</span><span class="op" id="7937745">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937748">test</span><span class="op" id="7937752">.</span><span class="ident" id="7937753">command</span>&nbsp;<span class="op" id="7937761">=</span>&nbsp;<span class="builtinfunc" id="7937763">append</span><span class="op" id="7937769">(</span><span class="ident" id="7937770">test</span><span class="op" id="7937774">.</span><span class="ident" id="7937775">command</span><span class="op" id="7937782">,</span>&nbsp;<span class="ident" id="7937784">option</span><span class="op" id="7937790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937793">test</span><span class="op" id="7937797">.</span><span class="ident" id="7937798">run</span><span class="op" id="7937801">(</span><span class="ident" id="7937802">t</span><span class="op" id="7937803">,</span>&nbsp;<span class="op" id="7937805">*</span><span class="ident" id="7937806">update</span><span class="op" id="7937812">)</span><br>
<span class="lineno"></span><span class="op" id="7937814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7937817">func</span>&nbsp;<span class="ident" id="7937822">runServerTestSSLv3</span><span class="op" id="7937840">(</span><span class="ident" id="7937841">t</span>&nbsp;<span class="op" id="7937843">*</span><span class="ident" id="7937844">testing</span><span class="op" id="7937851">.</span><span class="ident" id="7937852">T</span><span class="op" id="7937853">,</span>&nbsp;<span class="ident" id="7937855">template</span>&nbsp;<span class="op" id="7937864">*</span><span class="ident" id="7937865">serverTest</span><span class="op" id="7937875">)</span>&nbsp;<span class="op" id="7937877">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937880">runServerTestForVersion</span><span class="op" id="7937903">(</span><span class="ident" id="7937904">t</span><span class="op" id="7937905">,</span>&nbsp;<span class="ident" id="7937907">template</span><span class="op" id="7937915">,</span>&nbsp;<span class="string" id="7937917">&#34;SSLv3-&#34;</span><span class="op" id="7937925">,</span>&nbsp;<span class="string" id="7937927">&#34;-ssl3&#34;</span><span class="op" id="7937934">)</span><br>
<span class="lineno"></span><span class="op" id="7937936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7937939">func</span>&nbsp;<span class="ident" id="7937944">runServerTestTLS10</span><span class="op" id="7937962">(</span><span class="ident" id="7937963">t</span>&nbsp;<span class="op" id="7937965">*</span><span class="ident" id="7937966">testing</span><span class="op" id="7937973">.</span><span class="ident" id="7937974">T</span><span class="op" id="7937975">,</span>&nbsp;<span class="ident" id="7937977">template</span>&nbsp;<span class="op" id="7937986">*</span><span class="ident" id="7937987">serverTest</span><span class="op" id="7937997">)</span>&nbsp;<span class="op" id="7937999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938002">runServerTestForVersion</span><span class="op" id="7938025">(</span><span class="ident" id="7938026">t</span><span class="op" id="7938027">,</span>&nbsp;<span class="ident" id="7938029">template</span><span class="op" id="7938037">,</span>&nbsp;<span class="string" id="7938039">&#34;TLSv10-&#34;</span><span class="op" id="7938048">,</span>&nbsp;<span class="string" id="7938050">&#34;-tls1&#34;</span><span class="op" id="7938057">)</span><br>
<span class="lineno">470</span><span class="op" id="7938059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7938062">func</span>&nbsp;<span class="ident" id="7938067">runServerTestTLS11</span><span class="op" id="7938085">(</span><span class="ident" id="7938086">t</span>&nbsp;<span class="op" id="7938088">*</span><span class="ident" id="7938089">testing</span><span class="op" id="7938096">.</span><span class="ident" id="7938097">T</span><span class="op" id="7938098">,</span>&nbsp;<span class="ident" id="7938100">template</span>&nbsp;<span class="op" id="7938109">*</span><span class="ident" id="7938110">serverTest</span><span class="op" id="7938120">)</span>&nbsp;<span class="op" id="7938122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938125">runServerTestForVersion</span><span class="op" id="7938148">(</span><span class="ident" id="7938149">t</span><span class="op" id="7938150">,</span>&nbsp;<span class="ident" id="7938152">template</span><span class="op" id="7938160">,</span>&nbsp;<span class="string" id="7938162">&#34;TLSv11-&#34;</span><span class="op" id="7938171">,</span>&nbsp;<span class="string" id="7938173">&#34;-tls1_1&#34;</span><span class="op" id="7938182">)</span><br>
<span class="lineno"></span><span class="op" id="7938184">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7938187">func</span>&nbsp;<span class="ident" id="7938192">runServerTestTLS12</span><span class="op" id="7938210">(</span><span class="ident" id="7938211">t</span>&nbsp;<span class="op" id="7938213">*</span><span class="ident" id="7938214">testing</span><span class="op" id="7938221">.</span><span class="ident" id="7938222">T</span><span class="op" id="7938223">,</span>&nbsp;<span class="ident" id="7938225">template</span>&nbsp;<span class="op" id="7938234">*</span><span class="ident" id="7938235">serverTest</span><span class="op" id="7938245">)</span>&nbsp;<span class="op" id="7938247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938250">runServerTestForVersion</span><span class="op" id="7938273">(</span><span class="ident" id="7938274">t</span><span class="op" id="7938275">,</span>&nbsp;<span class="ident" id="7938277">template</span><span class="op" id="7938285">,</span>&nbsp;<span class="string" id="7938287">&#34;TLSv12-&#34;</span><span class="op" id="7938296">,</span>&nbsp;<span class="string" id="7938298">&#34;-tls1_2&#34;</span><span class="op" id="7938307">)</span><br>
<span class="lineno"></span><span class="op" id="7938309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7938312">func</span>&nbsp;<span class="ident" id="7938317">TestHandshakeServerRSARC4</span><span class="op" id="7938342">(</span><span class="ident" id="7938343">t</span>&nbsp;<span class="op" id="7938345">*</span><span class="ident" id="7938346">testing</span><span class="op" id="7938353">.</span><span class="ident" id="7938354">T</span><span class="op" id="7938355">)</span>&nbsp;<span class="op" id="7938357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938360">test</span>&nbsp;<span class="op" id="7938365">:=</span>&nbsp;<span class="op" id="7938368">&amp;</span><span class="ident" id="7938369">serverTest</span><span class="op" id="7938379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938383">name</span><span class="op" id="7938387">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7938392">&#34;RSA-RC4&#34;</span><span class="op" id="7938401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938405">command</span><span class="op" id="7938412">:</span>&nbsp;<span class="op" id="7938414">[</span><span class="op" id="7938415">]</span><span class="builtintype" id="7938416">string</span><span class="op" id="7938422">{</span><span class="string" id="7938423">&#34;openssl&#34;</span><span class="op" id="7938432">,</span>&nbsp;<span class="string" id="7938434">&#34;s_client&#34;</span><span class="op" id="7938444">,</span>&nbsp;<span class="string" id="7938446">&#34;-no_ticket&#34;</span><span class="op" id="7938458">,</span>&nbsp;<span class="string" id="7938460">&#34;-cipher&#34;</span><span class="op" id="7938469">,</span>&nbsp;<span class="string" id="7938471">&#34;RC4-SHA&#34;</span><span class="op" id="7938480">}</span><span class="op" id="7938481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938484">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938487">runServerTestSSLv3</span><span class="op" id="7938505">(</span><span class="ident" id="7938506">t</span><span class="op" id="7938507">,</span>&nbsp;<span class="ident" id="7938509">test</span><span class="op" id="7938513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938516">runServerTestTLS10</span><span class="op" id="7938534">(</span><span class="ident" id="7938535">t</span><span class="op" id="7938536">,</span>&nbsp;<span class="ident" id="7938538">test</span><span class="op" id="7938542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938545">runServerTestTLS11</span><span class="op" id="7938563">(</span><span class="ident" id="7938564">t</span><span class="op" id="7938565">,</span>&nbsp;<span class="ident" id="7938567">test</span><span class="op" id="7938571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938574">runServerTestTLS12</span><span class="op" id="7938592">(</span><span class="ident" id="7938593">t</span><span class="op" id="7938594">,</span>&nbsp;<span class="ident" id="7938596">test</span><span class="op" id="7938600">)</span><br>
<span class="lineno"></span><span class="op" id="7938602">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7938605">func</span>&nbsp;<span class="ident" id="7938610">TestHandshakeServerRSA3DES</span><span class="op" id="7938636">(</span><span class="ident" id="7938637">t</span>&nbsp;<span class="op" id="7938639">*</span><span class="ident" id="7938640">testing</span><span class="op" id="7938647">.</span><span class="ident" id="7938648">T</span><span class="op" id="7938649">)</span>&nbsp;<span class="op" id="7938651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938654">test</span>&nbsp;<span class="op" id="7938659">:=</span>&nbsp;<span class="op" id="7938662">&amp;</span><span class="ident" id="7938663">serverTest</span><span class="op" id="7938673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938677">name</span><span class="op" id="7938681">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7938686">&#34;RSA-3DES&#34;</span><span class="op" id="7938696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938700">command</span><span class="op" id="7938707">:</span>&nbsp;<span class="op" id="7938709">[</span><span class="op" id="7938710">]</span><span class="builtintype" id="7938711">string</span><span class="op" id="7938717">{</span><span class="string" id="7938718">&#34;openssl&#34;</span><span class="op" id="7938727">,</span>&nbsp;<span class="string" id="7938729">&#34;s_client&#34;</span><span class="op" id="7938739">,</span>&nbsp;<span class="string" id="7938741">&#34;-no_ticket&#34;</span><span class="op" id="7938753">,</span>&nbsp;<span class="string" id="7938755">&#34;-cipher&#34;</span><span class="op" id="7938764">,</span>&nbsp;<span class="string" id="7938766">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7938780">}</span><span class="op" id="7938781">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938787">runServerTestSSLv3</span><span class="op" id="7938805">(</span><span class="ident" id="7938806">t</span><span class="op" id="7938807">,</span>&nbsp;<span class="ident" id="7938809">test</span><span class="op" id="7938813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938816">runServerTestTLS10</span><span class="op" id="7938834">(</span><span class="ident" id="7938835">t</span><span class="op" id="7938836">,</span>&nbsp;<span class="ident" id="7938838">test</span><span class="op" id="7938842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938845">runServerTestTLS12</span><span class="op" id="7938863">(</span><span class="ident" id="7938864">t</span><span class="op" id="7938865">,</span>&nbsp;<span class="ident" id="7938867">test</span><span class="op" id="7938871">)</span><br>
<span class="lineno"></span><span class="op" id="7938873">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7938876">func</span>&nbsp;<span class="ident" id="7938881">TestHandshakeServerRSAAES</span><span class="op" id="7938906">(</span><span class="ident" id="7938907">t</span>&nbsp;<span class="op" id="7938909">*</span><span class="ident" id="7938910">testing</span><span class="op" id="7938917">.</span><span class="ident" id="7938918">T</span><span class="op" id="7938919">)</span>&nbsp;<span class="op" id="7938921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938924">test</span>&nbsp;<span class="op" id="7938929">:=</span>&nbsp;<span class="op" id="7938932">&amp;</span><span class="ident" id="7938933">serverTest</span><span class="op" id="7938943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938947">name</span><span class="op" id="7938951">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7938956">&#34;RSA-AES&#34;</span><span class="op" id="7938965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938969">command</span><span class="op" id="7938976">:</span>&nbsp;<span class="op" id="7938978">[</span><span class="op" id="7938979">]</span><span class="builtintype" id="7938980">string</span><span class="op" id="7938986">{</span><span class="string" id="7938987">&#34;openssl&#34;</span><span class="op" id="7938996">,</span>&nbsp;<span class="string" id="7938998">&#34;s_client&#34;</span><span class="op" id="7939008">,</span>&nbsp;<span class="string" id="7939010">&#34;-no_ticket&#34;</span><span class="op" id="7939022">,</span>&nbsp;<span class="string" id="7939024">&#34;-cipher&#34;</span><span class="op" id="7939033">,</span>&nbsp;<span class="string" id="7939035">&#34;AES128-SHA&#34;</span><span class="op" id="7939047">}</span><span class="op" id="7939048">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939054">runServerTestSSLv3</span><span class="op" id="7939072">(</span><span class="ident" id="7939073">t</span><span class="op" id="7939074">,</span>&nbsp;<span class="ident" id="7939076">test</span><span class="op" id="7939080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939083">runServerTestTLS10</span><span class="op" id="7939101">(</span><span class="ident" id="7939102">t</span><span class="op" id="7939103">,</span>&nbsp;<span class="ident" id="7939105">test</span><span class="op" id="7939109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939112">runServerTestTLS12</span><span class="op" id="7939130">(</span><span class="ident" id="7939131">t</span><span class="op" id="7939132">,</span>&nbsp;<span class="ident" id="7939134">test</span><span class="op" id="7939138">)</span><br>
<span class="lineno"></span><span class="op" id="7939140">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7939143">func</span>&nbsp;<span class="ident" id="7939148">TestHandshakeServerAESGCM</span><span class="op" id="7939173">(</span><span class="ident" id="7939174">t</span>&nbsp;<span class="op" id="7939176">*</span><span class="ident" id="7939177">testing</span><span class="op" id="7939184">.</span><span class="ident" id="7939185">T</span><span class="op" id="7939186">)</span>&nbsp;<span class="op" id="7939188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939191">test</span>&nbsp;<span class="op" id="7939196">:=</span>&nbsp;<span class="op" id="7939199">&amp;</span><span class="ident" id="7939200">serverTest</span><span class="op" id="7939210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939214">name</span><span class="op" id="7939218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7939223">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7939236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939240">command</span><span class="op" id="7939247">:</span>&nbsp;<span class="op" id="7939249">[</span><span class="op" id="7939250">]</span><span class="builtintype" id="7939251">string</span><span class="op" id="7939257">{</span><span class="string" id="7939258">&#34;openssl&#34;</span><span class="op" id="7939267">,</span>&nbsp;<span class="string" id="7939269">&#34;s_client&#34;</span><span class="op" id="7939279">,</span>&nbsp;<span class="string" id="7939281">&#34;-no_ticket&#34;</span><span class="op" id="7939293">,</span>&nbsp;<span class="string" id="7939295">&#34;-cipher&#34;</span><span class="op" id="7939304">,</span>&nbsp;<span class="string" id="7939306">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7939335">}</span><span class="op" id="7939336">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939342">runServerTestTLS12</span><span class="op" id="7939360">(</span><span class="ident" id="7939361">t</span><span class="op" id="7939362">,</span>&nbsp;<span class="ident" id="7939364">test</span><span class="op" id="7939368">)</span><br>
<span class="lineno"></span><span class="op" id="7939370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7939373">func</span>&nbsp;<span class="ident" id="7939378">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7939410">(</span><span class="ident" id="7939411">t</span>&nbsp;<span class="op" id="7939413">*</span><span class="ident" id="7939414">testing</span><span class="op" id="7939421">.</span><span class="ident" id="7939422">T</span><span class="op" id="7939423">)</span>&nbsp;<span class="op" id="7939425">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939428">config</span>&nbsp;<span class="op" id="7939435">:=</span>&nbsp;<span class="op" id="7939438">*</span><span class="ident" id="7939439">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939451">config</span><span class="op" id="7939457">.</span><span class="ident" id="7939458">Certificates</span>&nbsp;<span class="op" id="7939471">=</span>&nbsp;<span class="builtinfunc" id="7939473">make</span><span class="op" id="7939477">(</span><span class="op" id="7939478">[</span><span class="op" id="7939479">]</span><span class="ident" id="7939480">Certificate</span><span class="op" id="7939491">,</span>&nbsp;<span class="num" id="7939493">1</span><span class="op" id="7939494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939497">config</span><span class="op" id="7939503">.</span><span class="ident" id="7939504">Certificates</span><span class="op" id="7939516">[</span><span class="num" id="7939517">0</span><span class="op" id="7939518">]</span><span class="op" id="7939519">.</span><span class="ident" id="7939520">Certificate</span>&nbsp;<span class="op" id="7939532">=</span>&nbsp;<span class="op" id="7939534">[</span><span class="op" id="7939535">]</span><span class="op" id="7939536">[</span><span class="op" id="7939537">]</span><span class="builtintype" id="7939538">byte</span><span class="op" id="7939542">{</span><span class="ident" id="7939543">testECDSACertificate</span><span class="op" id="7939563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939566">config</span><span class="op" id="7939572">.</span><span class="ident" id="7939573">Certificates</span><span class="op" id="7939585">[</span><span class="num" id="7939586">0</span><span class="op" id="7939587">]</span><span class="op" id="7939588">.</span><span class="ident" id="7939589">PrivateKey</span>&nbsp;<span class="op" id="7939600">=</span>&nbsp;<span class="ident" id="7939602">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939623">config</span><span class="op" id="7939629">.</span><span class="ident" id="7939630">BuildNameToCertificate</span><span class="op" id="7939652">(</span><span class="op" id="7939653">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939657">test</span>&nbsp;<span class="op" id="7939662">:=</span>&nbsp;<span class="op" id="7939665">&amp;</span><span class="ident" id="7939666">serverTest</span><span class="op" id="7939676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939680">name</span><span class="op" id="7939684">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7939689">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7939706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939710">command</span><span class="op" id="7939717">:</span>&nbsp;<span class="op" id="7939719">[</span><span class="op" id="7939720">]</span><span class="builtintype" id="7939721">string</span><span class="op" id="7939727">{</span><span class="string" id="7939728">&#34;openssl&#34;</span><span class="op" id="7939737">,</span>&nbsp;<span class="string" id="7939739">&#34;s_client&#34;</span><span class="op" id="7939749">,</span>&nbsp;<span class="string" id="7939751">&#34;-no_ticket&#34;</span><span class="op" id="7939763">,</span>&nbsp;<span class="string" id="7939765">&#34;-cipher&#34;</span><span class="op" id="7939774">,</span>&nbsp;<span class="string" id="7939776">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7939800">}</span><span class="op" id="7939801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939805">config</span><span class="op" id="7939811">:</span>&nbsp;&nbsp;<span class="op" id="7939814">&amp;</span><span class="ident" id="7939815">config</span><span class="op" id="7939821">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939827">runServerTestTLS10</span><span class="op" id="7939845">(</span><span class="ident" id="7939846">t</span><span class="op" id="7939847">,</span>&nbsp;<span class="ident" id="7939849">test</span><span class="op" id="7939853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939856">runServerTestTLS12</span><span class="op" id="7939874">(</span><span class="ident" id="7939875">t</span><span class="op" id="7939876">,</span>&nbsp;<span class="ident" id="7939878">test</span><span class="op" id="7939882">)</span><br>
<span class="lineno"></span><span class="op" id="7939884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7939887">func</span>&nbsp;<span class="ident" id="7939892">TestHandshakeServerALPN</span><span class="op" id="7939915">(</span><span class="ident" id="7939916">t</span>&nbsp;<span class="op" id="7939918">*</span><span class="ident" id="7939919">testing</span><span class="op" id="7939926">.</span><span class="ident" id="7939927">T</span><span class="op" id="7939928">)</span>&nbsp;<span class="op" id="7939930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939933">config</span>&nbsp;<span class="op" id="7939940">:=</span>&nbsp;<span class="op" id="7939943">*</span><span class="ident" id="7939944">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939956">config</span><span class="op" id="7939962">.</span><span class="ident" id="7939963">NextProtos</span>&nbsp;<span class="op" id="7939974">=</span>&nbsp;<span class="op" id="7939976">[</span><span class="op" id="7939977">]</span><span class="builtintype" id="7939978">string</span><span class="op" id="7939984">{</span><span class="string" id="7939985">&#34;proto1&#34;</span><span class="op" id="7939993">,</span>&nbsp;<span class="string" id="7939995">&#34;proto2&#34;</span><span class="op" id="7940003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940007">test</span>&nbsp;<span class="op" id="7940012">:=</span>&nbsp;<span class="op" id="7940015">&amp;</span><span class="ident" id="7940016">serverTest</span><span class="op" id="7940026">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940030">name</span><span class="op" id="7940034">:</span>&nbsp;<span class="string" id="7940036">&#34;ALPN&#34;</span><span class="op" id="7940042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940046">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940112">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940155">command</span><span class="op" id="7940162">:</span>&nbsp;<span class="op" id="7940164">[</span><span class="op" id="7940165">]</span><span class="builtintype" id="7940166">string</span><span class="op" id="7940172">{</span><span class="string" id="7940173">&#34;openssl&#34;</span><span class="op" id="7940182">,</span>&nbsp;<span class="string" id="7940184">&#34;s_client&#34;</span><span class="op" id="7940194">,</span>&nbsp;<span class="string" id="7940196">&#34;-alpn&#34;</span><span class="op" id="7940203">,</span>&nbsp;<span class="string" id="7940205">&#34;proto2,proto1&#34;</span><span class="op" id="7940220">}</span><span class="op" id="7940221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940225">config</span><span class="op" id="7940231">:</span>&nbsp;&nbsp;<span class="op" id="7940234">&amp;</span><span class="ident" id="7940235">config</span><span class="op" id="7940241">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940245">validate</span><span class="op" id="7940253">:</span>&nbsp;<span class="keyword" id="7940255">func</span><span class="op" id="7940259">(</span><span class="ident" id="7940260">state</span>&nbsp;<span class="ident" id="7940266">ConnectionState</span><span class="op" id="7940281">)</span>&nbsp;<span class="builtintype" id="7940283">error</span>&nbsp;<span class="op" id="7940289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940294">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940353">if</span>&nbsp;<span class="ident" id="7940356">state</span><span class="op" id="7940361">.</span><span class="ident" id="7940362">NegotiatedProtocol</span>&nbsp;<span class="op" id="7940381">!=</span>&nbsp;<span class="string" id="7940384">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7940393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940399">return</span>&nbsp;<span class="ident" id="7940406">fmt</span><span class="op" id="7940409">.</span><span class="ident" id="7940410">Errorf</span><span class="op" id="7940416">(</span><span class="string" id="7940417">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7940449">,</span>&nbsp;<span class="ident" id="7940451">state</span><span class="op" id="7940456">.</span><span class="ident" id="7940457">NegotiatedProtocol</span><span class="op" id="7940475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940480">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940485">return</span>&nbsp;<span class="ident" id="7940492">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940498">}</span><span class="op" id="7940499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940505">runServerTestTLS12</span><span class="op" id="7940523">(</span><span class="ident" id="7940524">t</span><span class="op" id="7940525">,</span>&nbsp;<span class="ident" id="7940527">test</span><span class="op" id="7940531">)</span><br>
<span class="lineno"></span><span class="op" id="7940533">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7940536">func</span>&nbsp;<span class="ident" id="7940541">TestHandshakeServerALPNNoMatch</span><span class="op" id="7940571">(</span><span class="ident" id="7940572">t</span>&nbsp;<span class="op" id="7940574">*</span><span class="ident" id="7940575">testing</span><span class="op" id="7940582">.</span><span class="ident" id="7940583">T</span><span class="op" id="7940584">)</span>&nbsp;<span class="op" id="7940586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940589">config</span>&nbsp;<span class="op" id="7940596">:=</span>&nbsp;<span class="op" id="7940599">*</span><span class="ident" id="7940600">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940612">config</span><span class="op" id="7940618">.</span><span class="ident" id="7940619">NextProtos</span>&nbsp;<span class="op" id="7940630">=</span>&nbsp;<span class="op" id="7940632">[</span><span class="op" id="7940633">]</span><span class="builtintype" id="7940634">string</span><span class="op" id="7940640">{</span><span class="string" id="7940641">&#34;proto3&#34;</span><span class="op" id="7940649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940653">test</span>&nbsp;<span class="op" id="7940658">:=</span>&nbsp;<span class="op" id="7940661">&amp;</span><span class="ident" id="7940662">serverTest</span><span class="op" id="7940672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940676">name</span><span class="op" id="7940680">:</span>&nbsp;<span class="string" id="7940682">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7940696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940700">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940766">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940809">command</span><span class="op" id="7940816">:</span>&nbsp;<span class="op" id="7940818">[</span><span class="op" id="7940819">]</span><span class="builtintype" id="7940820">string</span><span class="op" id="7940826">{</span><span class="string" id="7940827">&#34;openssl&#34;</span><span class="op" id="7940836">,</span>&nbsp;<span class="string" id="7940838">&#34;s_client&#34;</span><span class="op" id="7940848">,</span>&nbsp;<span class="string" id="7940850">&#34;-alpn&#34;</span><span class="op" id="7940857">,</span>&nbsp;<span class="string" id="7940859">&#34;proto2,proto1&#34;</span><span class="op" id="7940874">}</span><span class="op" id="7940875">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940879">config</span><span class="op" id="7940885">:</span>&nbsp;&nbsp;<span class="op" id="7940888">&amp;</span><span class="ident" id="7940889">config</span><span class="op" id="7940895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940899">validate</span><span class="op" id="7940907">:</span>&nbsp;<span class="keyword" id="7940909">func</span><span class="op" id="7940913">(</span><span class="ident" id="7940914">state</span>&nbsp;<span class="ident" id="7940920">ConnectionState</span><span class="op" id="7940935">)</span>&nbsp;<span class="builtintype" id="7940937">error</span>&nbsp;<span class="op" id="7940943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940948">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7941007">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941050">if</span>&nbsp;<span class="ident" id="7941053">state</span><span class="op" id="7941058">.</span><span class="ident" id="7941059">NegotiatedProtocol</span>&nbsp;<span class="op" id="7941078">!=</span>&nbsp;<span class="string" id="7941081">&#34;&#34;</span>&nbsp;<span class="op" id="7941084">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941090">return</span>&nbsp;<span class="ident" id="7941097">fmt</span><span class="op" id="7941100">.</span><span class="ident" id="7941101">Errorf</span><span class="op" id="7941107">(</span><span class="string" id="7941108">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7941136">,</span>&nbsp;<span class="ident" id="7941138">state</span><span class="op" id="7941143">.</span><span class="ident" id="7941144">NegotiatedProtocol</span><span class="op" id="7941162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941172">return</span>&nbsp;<span class="ident" id="7941179">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941185">}</span><span class="op" id="7941186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941189">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941192">runServerTestTLS12</span><span class="op" id="7941210">(</span><span class="ident" id="7941211">t</span><span class="op" id="7941212">,</span>&nbsp;<span class="ident" id="7941214">test</span><span class="op" id="7941218">)</span><br>
<span class="lineno"></span><span class="op" id="7941220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7941223">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7941295">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7941375">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7941439">func</span>&nbsp;<span class="ident" id="7941444">TestHandshakeServerSNI</span><span class="op" id="7941466">(</span><span class="ident" id="7941467">t</span>&nbsp;<span class="op" id="7941469">*</span><span class="ident" id="7941470">testing</span><span class="op" id="7941477">.</span><span class="ident" id="7941478">T</span><span class="op" id="7941479">)</span>&nbsp;<span class="op" id="7941481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941484">test</span>&nbsp;<span class="op" id="7941489">:=</span>&nbsp;<span class="op" id="7941492">&amp;</span><span class="ident" id="7941493">serverTest</span><span class="op" id="7941503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941507">name</span><span class="op" id="7941511">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7941516">&#34;SNI&#34;</span><span class="op" id="7941521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941525">command</span><span class="op" id="7941532">:</span>&nbsp;<span class="op" id="7941534">[</span><span class="op" id="7941535">]</span><span class="builtintype" id="7941536">string</span><span class="op" id="7941542">{</span><span class="string" id="7941543">&#34;openssl&#34;</span><span class="op" id="7941552">,</span>&nbsp;<span class="string" id="7941554">&#34;s_client&#34;</span><span class="op" id="7941564">,</span>&nbsp;<span class="string" id="7941566">&#34;-no_ticket&#34;</span><span class="op" id="7941578">,</span>&nbsp;<span class="string" id="7941580">&#34;-cipher&#34;</span><span class="op" id="7941589">,</span>&nbsp;<span class="string" id="7941591">&#34;AES128-SHA&#34;</span><span class="op" id="7941603">,</span>&nbsp;<span class="string" id="7941605">&#34;-servername&#34;</span><span class="op" id="7941618">,</span>&nbsp;<span class="string" id="7941620">&#34;snitest.com&#34;</span><span class="op" id="7941633">}</span><span class="op" id="7941634">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941640">runServerTestTLS12</span><span class="op" id="7941658">(</span><span class="ident" id="7941659">t</span><span class="op" id="7941660">,</span>&nbsp;<span class="ident" id="7941662">test</span><span class="op" id="7941666">)</span><br>
<span class="lineno"></span><span class="op" id="7941668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7941671">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7941750">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7941793">func</span>&nbsp;<span class="ident" id="7941798">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7941834">(</span><span class="ident" id="7941835">t</span>&nbsp;<span class="op" id="7941837">*</span><span class="ident" id="7941838">testing</span><span class="op" id="7941845">.</span><span class="ident" id="7941846">T</span><span class="op" id="7941847">)</span>&nbsp;<span class="op" id="7941849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941852">config</span>&nbsp;<span class="op" id="7941859">:=</span>&nbsp;<span class="op" id="7941862">*</span><span class="ident" id="7941863">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7941876">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941945">nameToCert</span>&nbsp;<span class="op" id="7941956">:=</span>&nbsp;<span class="ident" id="7941959">config</span><span class="op" id="7941965">.</span><span class="ident" id="7941966">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941985">config</span><span class="op" id="7941991">.</span><span class="ident" id="7941992">NameToCertificate</span>&nbsp;<span class="op" id="7942010">=</span>&nbsp;<span class="ident" id="7942012">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942017">config</span><span class="op" id="7942023">.</span><span class="ident" id="7942024">GetCertificate</span>&nbsp;<span class="op" id="7942039">=</span>&nbsp;<span class="keyword" id="7942041">func</span><span class="op" id="7942045">(</span><span class="ident" id="7942046">clientHello</span>&nbsp;<span class="op" id="7942058">*</span><span class="ident" id="7942059">ClientHelloInfo</span><span class="op" id="7942074">)</span>&nbsp;<span class="op" id="7942076">(</span><span class="op" id="7942077">*</span><span class="ident" id="7942078">Certificate</span><span class="op" id="7942089">,</span>&nbsp;<span class="builtintype" id="7942091">error</span><span class="op" id="7942096">)</span>&nbsp;<span class="op" id="7942098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942102">cert</span><span class="op" id="7942106">,</span>&nbsp;<span class="ident" id="7942108">_</span>&nbsp;<span class="op" id="7942110">:=</span>&nbsp;<span class="ident" id="7942113">nameToCert</span><span class="op" id="7942123">[</span><span class="ident" id="7942124">clientHello</span><span class="op" id="7942135">.</span><span class="ident" id="7942136">ServerName</span><span class="op" id="7942146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942150">return</span>&nbsp;<span class="ident" id="7942157">cert</span><span class="op" id="7942161">,</span>&nbsp;<span class="ident" id="7942163">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942171">test</span>&nbsp;<span class="op" id="7942176">:=</span>&nbsp;<span class="op" id="7942179">&amp;</span><span class="ident" id="7942180">serverTest</span><span class="op" id="7942190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942194">name</span><span class="op" id="7942198">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7942203">&#34;SNI&#34;</span><span class="op" id="7942208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942212">command</span><span class="op" id="7942219">:</span>&nbsp;<span class="op" id="7942221">[</span><span class="op" id="7942222">]</span><span class="builtintype" id="7942223">string</span><span class="op" id="7942229">{</span><span class="string" id="7942230">&#34;openssl&#34;</span><span class="op" id="7942239">,</span>&nbsp;<span class="string" id="7942241">&#34;s_client&#34;</span><span class="op" id="7942251">,</span>&nbsp;<span class="string" id="7942253">&#34;-no_ticket&#34;</span><span class="op" id="7942265">,</span>&nbsp;<span class="string" id="7942267">&#34;-cipher&#34;</span><span class="op" id="7942276">,</span>&nbsp;<span class="string" id="7942278">&#34;AES128-SHA&#34;</span><span class="op" id="7942290">,</span>&nbsp;<span class="string" id="7942292">&#34;-servername&#34;</span><span class="op" id="7942305">,</span>&nbsp;<span class="string" id="7942307">&#34;snitest.com&#34;</span><span class="op" id="7942320">}</span><span class="op" id="7942321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942325">config</span><span class="op" id="7942331">:</span>&nbsp;&nbsp;<span class="op" id="7942334">&amp;</span><span class="ident" id="7942335">config</span><span class="op" id="7942341">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942347">runServerTestTLS12</span><span class="op" id="7942365">(</span><span class="ident" id="7942366">t</span><span class="op" id="7942367">,</span>&nbsp;<span class="ident" id="7942369">test</span><span class="op" id="7942373">)</span><br>
<span class="lineno"></span><span class="op" id="7942375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7942378">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7942437">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7942512">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7942586">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7942616">func</span>&nbsp;<span class="ident" id="7942621">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7942665">(</span><span class="ident" id="7942666">t</span>&nbsp;<span class="op" id="7942668">*</span><span class="ident" id="7942669">testing</span><span class="op" id="7942676">.</span><span class="ident" id="7942677">T</span><span class="op" id="7942678">)</span>&nbsp;<span class="op" id="7942680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942683">config</span>&nbsp;<span class="op" id="7942690">:=</span>&nbsp;<span class="op" id="7942693">*</span><span class="ident" id="7942694">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942707">config</span><span class="op" id="7942713">.</span><span class="ident" id="7942714">GetCertificate</span>&nbsp;<span class="op" id="7942729">=</span>&nbsp;<span class="keyword" id="7942731">func</span><span class="op" id="7942735">(</span><span class="ident" id="7942736">clientHello</span>&nbsp;<span class="op" id="7942748">*</span><span class="ident" id="7942749">ClientHelloInfo</span><span class="op" id="7942764">)</span>&nbsp;<span class="op" id="7942766">(</span><span class="op" id="7942767">*</span><span class="ident" id="7942768">Certificate</span><span class="op" id="7942779">,</span>&nbsp;<span class="builtintype" id="7942781">error</span><span class="op" id="7942786">)</span>&nbsp;<span class="op" id="7942788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942792">return</span>&nbsp;<span class="ident" id="7942799">nil</span><span class="op" id="7942802">,</span>&nbsp;<span class="ident" id="7942804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942812">test</span>&nbsp;<span class="op" id="7942817">:=</span>&nbsp;<span class="op" id="7942820">&amp;</span><span class="ident" id="7942821">serverTest</span><span class="op" id="7942831">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942835">name</span><span class="op" id="7942839">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7942844">&#34;SNI&#34;</span><span class="op" id="7942849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942853">command</span><span class="op" id="7942860">:</span>&nbsp;<span class="op" id="7942862">[</span><span class="op" id="7942863">]</span><span class="builtintype" id="7942864">string</span><span class="op" id="7942870">{</span><span class="string" id="7942871">&#34;openssl&#34;</span><span class="op" id="7942880">,</span>&nbsp;<span class="string" id="7942882">&#34;s_client&#34;</span><span class="op" id="7942892">,</span>&nbsp;<span class="string" id="7942894">&#34;-no_ticket&#34;</span><span class="op" id="7942906">,</span>&nbsp;<span class="string" id="7942908">&#34;-cipher&#34;</span><span class="op" id="7942917">,</span>&nbsp;<span class="string" id="7942919">&#34;AES128-SHA&#34;</span><span class="op" id="7942931">,</span>&nbsp;<span class="string" id="7942933">&#34;-servername&#34;</span><span class="op" id="7942946">,</span>&nbsp;<span class="string" id="7942948">&#34;snitest.com&#34;</span><span class="op" id="7942961">}</span><span class="op" id="7942962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942966">config</span><span class="op" id="7942972">:</span>&nbsp;&nbsp;<span class="op" id="7942975">&amp;</span><span class="ident" id="7942976">config</span><span class="op" id="7942982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942988">runServerTestTLS12</span><span class="op" id="7943006">(</span><span class="ident" id="7943007">t</span><span class="op" id="7943008">,</span>&nbsp;<span class="ident" id="7943010">test</span><span class="op" id="7943014">)</span><br>
<span class="lineno">625</span><span class="op" id="7943016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7943019">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7943095">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7943136">func</span>&nbsp;<span class="ident" id="7943141">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7943182">(</span><span class="ident" id="7943183">t</span>&nbsp;<span class="op" id="7943185">*</span><span class="ident" id="7943186">testing</span><span class="op" id="7943193">.</span><span class="ident" id="7943194">T</span><span class="op" id="7943195">)</span>&nbsp;<span class="op" id="7943197">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943200">config</span>&nbsp;<span class="op" id="7943207">:=</span>&nbsp;<span class="op" id="7943210">*</span><span class="ident" id="7943211">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943224">config</span><span class="op" id="7943230">.</span><span class="ident" id="7943231">GetCertificate</span>&nbsp;<span class="op" id="7943246">=</span>&nbsp;<span class="keyword" id="7943248">func</span><span class="op" id="7943252">(</span><span class="ident" id="7943253">clientHello</span>&nbsp;<span class="op" id="7943265">*</span><span class="ident" id="7943266">ClientHelloInfo</span><span class="op" id="7943281">)</span>&nbsp;<span class="op" id="7943283">(</span><span class="op" id="7943284">*</span><span class="ident" id="7943285">Certificate</span><span class="op" id="7943296">,</span>&nbsp;<span class="builtintype" id="7943298">error</span><span class="op" id="7943303">)</span>&nbsp;<span class="op" id="7943305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943309">return</span>&nbsp;<span class="ident" id="7943316">nil</span><span class="op" id="7943319">,</span>&nbsp;<span class="ident" id="7943321">fmt</span><span class="op" id="7943324">.</span><span class="ident" id="7943325">Errorf</span><span class="op" id="7943331">(</span><span class="string" id="7943332">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7943362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943365">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943368">test</span>&nbsp;<span class="op" id="7943373">:=</span>&nbsp;<span class="op" id="7943376">&amp;</span><span class="ident" id="7943377">serverTest</span><span class="op" id="7943387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943391">name</span><span class="op" id="7943395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943404">&#34;SNI&#34;</span><span class="op" id="7943409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943413">command</span><span class="op" id="7943420">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7943426">[</span><span class="op" id="7943427">]</span><span class="builtintype" id="7943428">string</span><span class="op" id="7943434">{</span><span class="string" id="7943435">&#34;openssl&#34;</span><span class="op" id="7943444">,</span>&nbsp;<span class="string" id="7943446">&#34;s_client&#34;</span><span class="op" id="7943456">,</span>&nbsp;<span class="string" id="7943458">&#34;-no_ticket&#34;</span><span class="op" id="7943470">,</span>&nbsp;<span class="string" id="7943472">&#34;-cipher&#34;</span><span class="op" id="7943481">,</span>&nbsp;<span class="string" id="7943483">&#34;AES128-SHA&#34;</span><span class="op" id="7943495">,</span>&nbsp;<span class="string" id="7943497">&#34;-servername&#34;</span><span class="op" id="7943510">,</span>&nbsp;<span class="string" id="7943512">&#34;snitest.com&#34;</span><span class="op" id="7943525">}</span><span class="op" id="7943526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943530">config</span><span class="op" id="7943536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7943543">&amp;</span><span class="ident" id="7943544">config</span><span class="op" id="7943550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943554">expectAlert</span><span class="op" id="7943565">:</span>&nbsp;<span class="builtintype" id="7943567">true</span><span class="op" id="7943571">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943577">runServerTestTLS12</span><span class="op" id="7943595">(</span><span class="ident" id="7943596">t</span><span class="op" id="7943597">,</span>&nbsp;<span class="ident" id="7943599">test</span><span class="op" id="7943603">)</span><br>
<span class="lineno"></span><span class="op" id="7943605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7943608">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7943688">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7943762">func</span>&nbsp;<span class="ident" id="7943767">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7943801">(</span><span class="ident" id="7943802">t</span>&nbsp;<span class="op" id="7943804">*</span><span class="ident" id="7943805">testing</span><span class="op" id="7943812">.</span><span class="ident" id="7943813">T</span><span class="op" id="7943814">)</span>&nbsp;<span class="op" id="7943816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943819">config</span>&nbsp;<span class="op" id="7943826">:=</span>&nbsp;<span class="op" id="7943829">*</span><span class="ident" id="7943830">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943842">config</span><span class="op" id="7943848">.</span><span class="ident" id="7943849">CipherSuites</span>&nbsp;<span class="op" id="7943862">=</span>&nbsp;<span class="op" id="7943864">[</span><span class="op" id="7943865">]</span><span class="builtintype" id="7943866">uint16</span><span class="op" id="7943872">{</span><span class="ident" id="7943873">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7943909">,</span>&nbsp;<span class="ident" id="7943911">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7943945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943948">config</span><span class="op" id="7943954">.</span><span class="ident" id="7943955">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7943980">=</span>&nbsp;<span class="builtintype" id="7943982">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943989">test</span>&nbsp;<span class="op" id="7943994">:=</span>&nbsp;<span class="op" id="7943997">&amp;</span><span class="ident" id="7943998">serverTest</span><span class="op" id="7944008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944012">name</span><span class="op" id="7944016">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7944020">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7944050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944054">config</span><span class="op" id="7944060">:</span>&nbsp;<span class="op" id="7944062">&amp;</span><span class="ident" id="7944063">config</span><span class="op" id="7944069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944072">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944075">runServerTestTLS12</span><span class="op" id="7944093">(</span><span class="ident" id="7944094">t</span><span class="op" id="7944095">,</span>&nbsp;<span class="ident" id="7944097">test</span><span class="op" id="7944101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944105">config</span>&nbsp;<span class="op" id="7944112">=</span>&nbsp;<span class="op" id="7944114">*</span><span class="ident" id="7944115">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944127">config</span><span class="op" id="7944133">.</span><span class="ident" id="7944134">CipherSuites</span>&nbsp;<span class="op" id="7944147">=</span>&nbsp;<span class="op" id="7944149">[</span><span class="op" id="7944150">]</span><span class="builtintype" id="7944151">uint16</span><span class="op" id="7944157">{</span><span class="ident" id="7944158">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7944192">,</span>&nbsp;<span class="ident" id="7944194">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7944230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944233">config</span><span class="op" id="7944239">.</span><span class="ident" id="7944240">Certificates</span>&nbsp;<span class="op" id="7944253">=</span>&nbsp;<span class="op" id="7944255">[</span><span class="op" id="7944256">]</span><span class="ident" id="7944257">Certificate</span><span class="op" id="7944268">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944277">Certificate</span><span class="op" id="7944288">:</span>&nbsp;<span class="op" id="7944290">[</span><span class="op" id="7944291">]</span><span class="op" id="7944292">[</span><span class="op" id="7944293">]</span><span class="builtintype" id="7944294">byte</span><span class="op" id="7944298">{</span><span class="ident" id="7944299">testECDSACertificate</span><span class="op" id="7944319">}</span><span class="op" id="7944320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944325">PrivateKey</span><span class="op" id="7944335">:</span>&nbsp;&nbsp;<span class="ident" id="7944338">testECDSAPrivateKey</span><span class="op" id="7944357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944361">}</span><span class="op" id="7944362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944365">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944368">config</span><span class="op" id="7944374">.</span><span class="ident" id="7944375">BuildNameToCertificate</span><span class="op" id="7944397">(</span><span class="op" id="7944398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944401">config</span><span class="op" id="7944407">.</span><span class="ident" id="7944408">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7944433">=</span>&nbsp;<span class="builtintype" id="7944435">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944442">test</span>&nbsp;<span class="op" id="7944447">=</span>&nbsp;<span class="op" id="7944449">&amp;</span><span class="ident" id="7944450">serverTest</span><span class="op" id="7944460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944464">name</span><span class="op" id="7944468">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7944472">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7944504">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944508">config</span><span class="op" id="7944514">:</span>&nbsp;<span class="op" id="7944516">&amp;</span><span class="ident" id="7944517">config</span><span class="op" id="7944523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944529">runServerTestTLS12</span><span class="op" id="7944547">(</span><span class="ident" id="7944548">t</span><span class="op" id="7944549">,</span>&nbsp;<span class="ident" id="7944551">test</span><span class="op" id="7944555">)</span><br>
<span class="lineno"></span><span class="op" id="7944557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7944560">func</span>&nbsp;<span class="ident" id="7944565">TestResumption</span><span class="op" id="7944579">(</span><span class="ident" id="7944580">t</span>&nbsp;<span class="op" id="7944582">*</span><span class="ident" id="7944583">testing</span><span class="op" id="7944590">.</span><span class="ident" id="7944591">T</span><span class="op" id="7944592">)</span>&nbsp;<span class="op" id="7944594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944597">sessionFilePath</span>&nbsp;<span class="op" id="7944613">:=</span>&nbsp;<span class="ident" id="7944616">tempFile</span><span class="op" id="7944624">(</span><span class="string" id="7944625">&#34;&#34;</span><span class="op" id="7944627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944630">defer</span>&nbsp;<span class="ident" id="7944636">os</span><span class="op" id="7944638">.</span><span class="ident" id="7944639">Remove</span><span class="op" id="7944645">(</span><span class="ident" id="7944646">sessionFilePath</span><span class="op" id="7944661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944665">test</span>&nbsp;<span class="op" id="7944670">:=</span>&nbsp;<span class="op" id="7944673">&amp;</span><span class="ident" id="7944674">serverTest</span><span class="op" id="7944684">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944688">name</span><span class="op" id="7944692">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7944697">&#34;IssueTicket&#34;</span><span class="op" id="7944710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944714">command</span><span class="op" id="7944721">:</span>&nbsp;<span class="op" id="7944723">[</span><span class="op" id="7944724">]</span><span class="builtintype" id="7944725">string</span><span class="op" id="7944731">{</span><span class="string" id="7944732">&#34;openssl&#34;</span><span class="op" id="7944741">,</span>&nbsp;<span class="string" id="7944743">&#34;s_client&#34;</span><span class="op" id="7944753">,</span>&nbsp;<span class="string" id="7944755">&#34;-cipher&#34;</span><span class="op" id="7944764">,</span>&nbsp;<span class="string" id="7944766">&#34;RC4-SHA&#34;</span><span class="op" id="7944775">,</span>&nbsp;<span class="string" id="7944777">&#34;-sess_out&#34;</span><span class="op" id="7944788">,</span>&nbsp;<span class="ident" id="7944790">sessionFilePath</span><span class="op" id="7944805">}</span><span class="op" id="7944806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944812">runServerTestTLS12</span><span class="op" id="7944830">(</span><span class="ident" id="7944831">t</span><span class="op" id="7944832">,</span>&nbsp;<span class="ident" id="7944834">test</span><span class="op" id="7944838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944842">test</span>&nbsp;<span class="op" id="7944847">=</span>&nbsp;<span class="op" id="7944849">&amp;</span><span class="ident" id="7944850">serverTest</span><span class="op" id="7944860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944864">name</span><span class="op" id="7944868">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7944873">&#34;Resume&#34;</span><span class="op" id="7944881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944885">command</span><span class="op" id="7944892">:</span>&nbsp;<span class="op" id="7944894">[</span><span class="op" id="7944895">]</span><span class="builtintype" id="7944896">string</span><span class="op" id="7944902">{</span><span class="string" id="7944903">&#34;openssl&#34;</span><span class="op" id="7944912">,</span>&nbsp;<span class="string" id="7944914">&#34;s_client&#34;</span><span class="op" id="7944924">,</span>&nbsp;<span class="string" id="7944926">&#34;-cipher&#34;</span><span class="op" id="7944935">,</span>&nbsp;<span class="string" id="7944937">&#34;RC4-SHA&#34;</span><span class="op" id="7944946">,</span>&nbsp;<span class="string" id="7944948">&#34;-sess_in&#34;</span><span class="op" id="7944958">,</span>&nbsp;<span class="ident" id="7944960">sessionFilePath</span><span class="op" id="7944975">}</span><span class="op" id="7944976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944982">runServerTestTLS12</span><span class="op" id="7945000">(</span><span class="ident" id="7945001">t</span><span class="op" id="7945002">,</span>&nbsp;<span class="ident" id="7945004">test</span><span class="op" id="7945008">)</span><br>
<span class="lineno">690</span><span class="op" id="7945010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7945013">func</span>&nbsp;<span class="ident" id="7945018">TestResumptionDisabled</span><span class="op" id="7945040">(</span><span class="ident" id="7945041">t</span>&nbsp;<span class="op" id="7945043">*</span><span class="ident" id="7945044">testing</span><span class="op" id="7945051">.</span><span class="ident" id="7945052">T</span><span class="op" id="7945053">)</span>&nbsp;<span class="op" id="7945055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945058">sessionFilePath</span>&nbsp;<span class="op" id="7945074">:=</span>&nbsp;<span class="ident" id="7945077">tempFile</span><span class="op" id="7945085">(</span><span class="string" id="7945086">&#34;&#34;</span><span class="op" id="7945088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945091">defer</span>&nbsp;<span class="ident" id="7945097">os</span><span class="op" id="7945099">.</span><span class="ident" id="7945100">Remove</span><span class="op" id="7945106">(</span><span class="ident" id="7945107">sessionFilePath</span><span class="op" id="7945122">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945126">config</span>&nbsp;<span class="op" id="7945133">:=</span>&nbsp;<span class="op" id="7945136">*</span><span class="ident" id="7945137">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945150">test</span>&nbsp;<span class="op" id="7945155">:=</span>&nbsp;<span class="op" id="7945158">&amp;</span><span class="ident" id="7945159">serverTest</span><span class="op" id="7945169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945173">name</span><span class="op" id="7945177">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7945182">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7945205">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945209">command</span><span class="op" id="7945216">:</span>&nbsp;<span class="op" id="7945218">[</span><span class="op" id="7945219">]</span><span class="builtintype" id="7945220">string</span><span class="op" id="7945226">{</span><span class="string" id="7945227">&#34;openssl&#34;</span><span class="op" id="7945236">,</span>&nbsp;<span class="string" id="7945238">&#34;s_client&#34;</span><span class="op" id="7945248">,</span>&nbsp;<span class="string" id="7945250">&#34;-cipher&#34;</span><span class="op" id="7945259">,</span>&nbsp;<span class="string" id="7945261">&#34;RC4-SHA&#34;</span><span class="op" id="7945270">,</span>&nbsp;<span class="string" id="7945272">&#34;-sess_out&#34;</span><span class="op" id="7945283">,</span>&nbsp;<span class="ident" id="7945285">sessionFilePath</span><span class="op" id="7945300">}</span><span class="op" id="7945301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945305">config</span><span class="op" id="7945311">:</span>&nbsp;&nbsp;<span class="op" id="7945314">&amp;</span><span class="ident" id="7945315">config</span><span class="op" id="7945321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945327">runServerTestTLS12</span><span class="op" id="7945345">(</span><span class="ident" id="7945346">t</span><span class="op" id="7945347">,</span>&nbsp;<span class="ident" id="7945349">test</span><span class="op" id="7945353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945357">config</span><span class="op" id="7945363">.</span><span class="ident" id="7945364">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7945387">=</span>&nbsp;<span class="builtintype" id="7945389">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945396">test</span>&nbsp;<span class="op" id="7945401">=</span>&nbsp;<span class="op" id="7945403">&amp;</span><span class="ident" id="7945404">serverTest</span><span class="op" id="7945414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945418">name</span><span class="op" id="7945422">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7945427">&#34;ResumeDisabled&#34;</span><span class="op" id="7945443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945447">command</span><span class="op" id="7945454">:</span>&nbsp;<span class="op" id="7945456">[</span><span class="op" id="7945457">]</span><span class="builtintype" id="7945458">string</span><span class="op" id="7945464">{</span><span class="string" id="7945465">&#34;openssl&#34;</span><span class="op" id="7945474">,</span>&nbsp;<span class="string" id="7945476">&#34;s_client&#34;</span><span class="op" id="7945486">,</span>&nbsp;<span class="string" id="7945488">&#34;-cipher&#34;</span><span class="op" id="7945497">,</span>&nbsp;<span class="string" id="7945499">&#34;RC4-SHA&#34;</span><span class="op" id="7945508">,</span>&nbsp;<span class="string" id="7945510">&#34;-sess_in&#34;</span><span class="op" id="7945520">,</span>&nbsp;<span class="ident" id="7945522">sessionFilePath</span><span class="op" id="7945537">}</span><span class="op" id="7945538">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945542">config</span><span class="op" id="7945548">:</span>&nbsp;&nbsp;<span class="op" id="7945551">&amp;</span><span class="ident" id="7945552">config</span><span class="op" id="7945558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945564">runServerTestTLS12</span><span class="op" id="7945582">(</span><span class="ident" id="7945583">t</span><span class="op" id="7945584">,</span>&nbsp;<span class="ident" id="7945586">test</span><span class="op" id="7945590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7945594">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7945666">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7945734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7945737">func</span>&nbsp;<span class="ident" id="7945742">TestFallbackSCSV</span><span class="op" id="7945758">(</span><span class="ident" id="7945759">t</span>&nbsp;<span class="op" id="7945761">*</span><span class="ident" id="7945762">testing</span><span class="op" id="7945769">.</span><span class="ident" id="7945770">T</span><span class="op" id="7945771">)</span>&nbsp;<span class="op" id="7945773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945776">test</span>&nbsp;<span class="op" id="7945781">:=</span>&nbsp;<span class="op" id="7945784">&amp;</span><span class="ident" id="7945785">serverTest</span><span class="op" id="7945795">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945799">name</span><span class="op" id="7945803">:</span>&nbsp;<span class="string" id="7945805">&#34;FallbackSCSV&#34;</span><span class="op" id="7945819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7945823">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945884">command</span><span class="op" id="7945891">:</span>&nbsp;<span class="op" id="7945893">[</span><span class="op" id="7945894">]</span><span class="builtintype" id="7945895">string</span><span class="op" id="7945901">{</span><span class="string" id="7945902">&#34;openssl&#34;</span><span class="op" id="7945911">,</span>&nbsp;<span class="string" id="7945913">&#34;s_client&#34;</span><span class="op" id="7945923">,</span>&nbsp;<span class="string" id="7945925">&#34;-fallback_scsv&#34;</span><span class="op" id="7945941">}</span><span class="op" id="7945942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945946">expectHandshakeErrorIncluding</span><span class="op" id="7945975">:</span>&nbsp;<span class="string" id="7945977">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7946009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946012">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946015">runServerTestTLS11</span><span class="op" id="7946033">(</span><span class="ident" id="7946034">t</span><span class="op" id="7946035">,</span>&nbsp;<span class="ident" id="7946037">test</span><span class="op" id="7946041">)</span><br>
<span class="lineno"></span><span class="op" id="7946043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7946046">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7946107">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7946169">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7946205">const</span>&nbsp;<span class="ident" id="7946211">clientCertificatePEM</span>&nbsp;<span class="op" id="7946232">=</span>&nbsp;<span class="string" id="7946234">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7946967">const</span>&nbsp;<span class="ident" id="7946973">clientKeyPEM</span>&nbsp;<span class="op" id="7946986">=</span>&nbsp;<span class="string" id="7946988">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7947875">const</span>&nbsp;<span class="ident" id="7947881">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7947907">=</span>&nbsp;<span class="string" id="7947909">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7948662">const</span>&nbsp;<span class="ident" id="7948668">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7948686">=</span>&nbsp;<span class="string" id="7948688">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7949128">func</span>&nbsp;<span class="ident" id="7949133">TestClientAuth</span><span class="op" id="7949147">(</span><span class="ident" id="7949148">t</span>&nbsp;<span class="op" id="7949150">*</span><span class="ident" id="7949151">testing</span><span class="op" id="7949158">.</span><span class="ident" id="7949159">T</span><span class="op" id="7949160">)</span>&nbsp;<span class="op" id="7949162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949165">var</span>&nbsp;<span class="ident" id="7949169">certPath</span><span class="op" id="7949177">,</span>&nbsp;<span class="ident" id="7949179">keyPath</span><span class="op" id="7949186">,</span>&nbsp;<span class="ident" id="7949188">ecdsaCertPath</span><span class="op" id="7949201">,</span>&nbsp;<span class="ident" id="7949203">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7949216">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949225">if</span>&nbsp;<span class="op" id="7949228">*</span><span class="ident" id="7949229">update</span>&nbsp;<span class="op" id="7949236">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949240">certPath</span>&nbsp;<span class="op" id="7949249">=</span>&nbsp;<span class="ident" id="7949251">tempFile</span><span class="op" id="7949259">(</span><span class="ident" id="7949260">clientCertificatePEM</span><span class="op" id="7949280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949284">defer</span>&nbsp;<span class="ident" id="7949290">os</span><span class="op" id="7949292">.</span><span class="ident" id="7949293">Remove</span><span class="op" id="7949299">(</span><span class="ident" id="7949300">certPath</span><span class="op" id="7949308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949312">keyPath</span>&nbsp;<span class="op" id="7949320">=</span>&nbsp;<span class="ident" id="7949322">tempFile</span><span class="op" id="7949330">(</span><span class="ident" id="7949331">clientKeyPEM</span><span class="op" id="7949343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949347">defer</span>&nbsp;<span class="ident" id="7949353">os</span><span class="op" id="7949355">.</span><span class="ident" id="7949356">Remove</span><span class="op" id="7949362">(</span><span class="ident" id="7949363">keyPath</span><span class="op" id="7949370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949374">ecdsaCertPath</span>&nbsp;<span class="op" id="7949388">=</span>&nbsp;<span class="ident" id="7949390">tempFile</span><span class="op" id="7949398">(</span><span class="ident" id="7949399">clientECDSACertificatePEM</span><span class="op" id="7949424">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949428">defer</span>&nbsp;<span class="ident" id="7949434">os</span><span class="op" id="7949436">.</span><span class="ident" id="7949437">Remove</span><span class="op" id="7949443">(</span><span class="ident" id="7949444">ecdsaCertPath</span><span class="op" id="7949457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949461">ecdsaKeyPath</span>&nbsp;<span class="op" id="7949474">=</span>&nbsp;<span class="ident" id="7949476">tempFile</span><span class="op" id="7949484">(</span><span class="ident" id="7949485">clientECDSAKeyPEM</span><span class="op" id="7949502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949506">defer</span>&nbsp;<span class="ident" id="7949512">os</span><span class="op" id="7949514">.</span><span class="ident" id="7949515">Remove</span><span class="op" id="7949521">(</span><span class="ident" id="7949522">ecdsaKeyPath</span><span class="op" id="7949534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949541">config</span>&nbsp;<span class="op" id="7949548">:=</span>&nbsp;<span class="op" id="7949551">*</span><span class="ident" id="7949552">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949564">config</span><span class="op" id="7949570">.</span><span class="ident" id="7949571">ClientAuth</span>&nbsp;<span class="op" id="7949582">=</span>&nbsp;<span class="ident" id="7949584">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949604">test</span>&nbsp;<span class="op" id="7949609">:=</span>&nbsp;<span class="op" id="7949612">&amp;</span><span class="ident" id="7949613">serverTest</span><span class="op" id="7949623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949627">name</span><span class="op" id="7949631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7949636">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7949665">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949669">command</span><span class="op" id="7949676">:</span>&nbsp;<span class="op" id="7949678">[</span><span class="op" id="7949679">]</span><span class="builtintype" id="7949680">string</span><span class="op" id="7949686">{</span><span class="string" id="7949687">&#34;openssl&#34;</span><span class="op" id="7949696">,</span>&nbsp;<span class="string" id="7949698">&#34;s_client&#34;</span><span class="op" id="7949708">,</span>&nbsp;<span class="string" id="7949710">&#34;-no_ticket&#34;</span><span class="op" id="7949722">,</span>&nbsp;<span class="string" id="7949724">&#34;-cipher&#34;</span><span class="op" id="7949733">,</span>&nbsp;<span class="string" id="7949735">&#34;RC4-SHA&#34;</span><span class="op" id="7949744">}</span><span class="op" id="7949745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949749">config</span><span class="op" id="7949755">:</span>&nbsp;&nbsp;<span class="op" id="7949758">&amp;</span><span class="ident" id="7949759">config</span><span class="op" id="7949765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949771">runServerTestTLS12</span><span class="op" id="7949789">(</span><span class="ident" id="7949790">t</span><span class="op" id="7949791">,</span>&nbsp;<span class="ident" id="7949793">test</span><span class="op" id="7949797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949801">test</span>&nbsp;<span class="op" id="7949806">=</span>&nbsp;<span class="op" id="7949808">&amp;</span><span class="ident" id="7949809">serverTest</span><span class="op" id="7949819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949823">name</span><span class="op" id="7949827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7949842">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7949871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949875">command</span><span class="op" id="7949882">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7949894">[</span><span class="op" id="7949895">]</span><span class="builtintype" id="7949896">string</span><span class="op" id="7949902">{</span><span class="string" id="7949903">&#34;openssl&#34;</span><span class="op" id="7949912">,</span>&nbsp;<span class="string" id="7949914">&#34;s_client&#34;</span><span class="op" id="7949924">,</span>&nbsp;<span class="string" id="7949926">&#34;-no_ticket&#34;</span><span class="op" id="7949938">,</span>&nbsp;<span class="string" id="7949940">&#34;-cipher&#34;</span><span class="op" id="7949949">,</span>&nbsp;<span class="string" id="7949951">&#34;RC4-SHA&#34;</span><span class="op" id="7949960">,</span>&nbsp;<span class="string" id="7949962">&#34;-cert&#34;</span><span class="op" id="7949969">,</span>&nbsp;<span class="ident" id="7949971">certPath</span><span class="op" id="7949979">,</span>&nbsp;<span class="string" id="7949981">&#34;-key&#34;</span><span class="op" id="7949987">,</span>&nbsp;<span class="ident" id="7949989">keyPath</span><span class="op" id="7949996">}</span><span class="op" id="7949997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950001">config</span><span class="op" id="7950007">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950020">&amp;</span><span class="ident" id="7950021">config</span><span class="op" id="7950027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950031">expectedPeerCerts</span><span class="op" id="7950048">:</span>&nbsp;<span class="op" id="7950050">[</span><span class="op" id="7950051">]</span><span class="builtintype" id="7950052">string</span><span class="op" id="7950058">{</span><span class="ident" id="7950059">clientCertificatePEM</span><span class="op" id="7950079">}</span><span class="op" id="7950080">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950086">runServerTestTLS12</span><span class="op" id="7950104">(</span><span class="ident" id="7950105">t</span><span class="op" id="7950106">,</span>&nbsp;<span class="ident" id="7950108">test</span><span class="op" id="7950112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950116">test</span>&nbsp;<span class="op" id="7950121">=</span>&nbsp;<span class="op" id="7950123">&amp;</span><span class="ident" id="7950124">serverTest</span><span class="op" id="7950134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950138">name</span><span class="op" id="7950142">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7950157">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7950191">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950195">command</span><span class="op" id="7950202">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950214">[</span><span class="op" id="7950215">]</span><span class="builtintype" id="7950216">string</span><span class="op" id="7950222">{</span><span class="string" id="7950223">&#34;openssl&#34;</span><span class="op" id="7950232">,</span>&nbsp;<span class="string" id="7950234">&#34;s_client&#34;</span><span class="op" id="7950244">,</span>&nbsp;<span class="string" id="7950246">&#34;-no_ticket&#34;</span><span class="op" id="7950258">,</span>&nbsp;<span class="string" id="7950260">&#34;-cipher&#34;</span><span class="op" id="7950269">,</span>&nbsp;<span class="string" id="7950271">&#34;RC4-SHA&#34;</span><span class="op" id="7950280">,</span>&nbsp;<span class="string" id="7950282">&#34;-cert&#34;</span><span class="op" id="7950289">,</span>&nbsp;<span class="ident" id="7950291">ecdsaCertPath</span><span class="op" id="7950304">,</span>&nbsp;<span class="string" id="7950306">&#34;-key&#34;</span><span class="op" id="7950312">,</span>&nbsp;<span class="ident" id="7950314">ecdsaKeyPath</span><span class="op" id="7950326">}</span><span class="op" id="7950327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950331">config</span><span class="op" id="7950337">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950350">&amp;</span><span class="ident" id="7950351">config</span><span class="op" id="7950357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950361">expectedPeerCerts</span><span class="op" id="7950378">:</span>&nbsp;<span class="op" id="7950380">[</span><span class="op" id="7950381">]</span><span class="builtintype" id="7950382">string</span><span class="op" id="7950388">{</span><span class="ident" id="7950389">clientECDSACertificatePEM</span><span class="op" id="7950414">}</span><span class="op" id="7950415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950421">runServerTestTLS12</span><span class="op" id="7950439">(</span><span class="ident" id="7950440">t</span><span class="op" id="7950441">,</span>&nbsp;<span class="ident" id="7950443">test</span><span class="op" id="7950447">)</span><br>
<span class="lineno">830</span><span class="op" id="7950449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950452">func</span>&nbsp;<span class="ident" id="7950457">bigFromString</span><span class="op" id="7950470">(</span><span class="ident" id="7950471">s</span>&nbsp;<span class="builtintype" id="7950473">string</span><span class="op" id="7950479">)</span>&nbsp;<span class="op" id="7950481">*</span><span class="ident" id="7950482">big</span><span class="op" id="7950485">.</span><span class="ident" id="7950486">Int</span>&nbsp;<span class="op" id="7950490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950493">ret</span>&nbsp;<span class="op" id="7950497">:=</span>&nbsp;<span class="builtinfunc" id="7950500">new</span><span class="op" id="7950503">(</span><span class="ident" id="7950504">big</span><span class="op" id="7950507">.</span><span class="ident" id="7950508">Int</span><span class="op" id="7950511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950514">ret</span><span class="op" id="7950517">.</span><span class="ident" id="7950518">SetString</span><span class="op" id="7950527">(</span><span class="ident" id="7950528">s</span><span class="op" id="7950529">,</span>&nbsp;<span class="num" id="7950531">10</span><span class="op" id="7950533">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950536">return</span>&nbsp;<span class="ident" id="7950543">ret</span><br>
<span class="lineno"></span><span class="op" id="7950547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950550">func</span>&nbsp;<span class="ident" id="7950555">fromHex</span><span class="op" id="7950562">(</span><span class="ident" id="7950563">s</span>&nbsp;<span class="builtintype" id="7950565">string</span><span class="op" id="7950571">)</span>&nbsp;<span class="op" id="7950573">[</span><span class="op" id="7950574">]</span><span class="builtintype" id="7950575">byte</span>&nbsp;<span class="op" id="7950580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950583">b</span><span class="op" id="7950584">,</span>&nbsp;<span class="ident" id="7950586">_</span>&nbsp;<span class="op" id="7950588">:=</span>&nbsp;<span class="ident" id="7950591">hex</span><span class="op" id="7950594">.</span><span class="ident" id="7950595">DecodeString</span><span class="op" id="7950607">(</span><span class="ident" id="7950608">s</span><span class="op" id="7950609">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950612">return</span>&nbsp;<span class="ident" id="7950619">b</span><br>
<span class="lineno"></span><span class="op" id="7950621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950624">var</span>&nbsp;<span class="ident" id="7950628">testRSACertificate</span>&nbsp;<span class="op" id="7950647">=</span>&nbsp;<span class="ident" id="7950649">fromHex</span><span class="op" id="7950656">(</span><span class="string" id="7950657">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7952043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7952046">var</span>&nbsp;<span class="ident" id="7952050">testECDSACertificate</span>&nbsp;<span class="op" id="7952071">=</span>&nbsp;<span class="ident" id="7952073">fromHex</span><span class="op" id="7952080">(</span><span class="string" id="7952081">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7953115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953118">var</span>&nbsp;<span class="ident" id="7953122">testSNICertificate</span>&nbsp;<span class="op" id="7953141">=</span>&nbsp;<span class="ident" id="7953143">fromHex</span><span class="op" id="7953150">(</span><span class="string" id="7953151">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7954157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954160">var</span>&nbsp;<span class="ident" id="7954164">testRSAPrivateKey</span>&nbsp;<span class="op" id="7954182">=</span>&nbsp;<span class="op" id="7954184">&amp;</span><span class="ident" id="7954185">rsa</span><span class="op" id="7954188">.</span><span class="ident" id="7954189">PrivateKey</span><span class="op" id="7954199">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954202">PublicKey</span><span class="op" id="7954211">:</span>&nbsp;<span class="ident" id="7954213">rsa</span><span class="op" id="7954216">.</span><span class="ident" id="7954217">PublicKey</span><span class="op" id="7954226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954230">N</span><span class="op" id="7954231">:</span>&nbsp;<span class="ident" id="7954233">bigFromString</span><span class="op" id="7954246">(</span><span class="string" id="7954247">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7954558">)</span><span class="op" id="7954559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954563">E</span><span class="op" id="7954564">:</span>&nbsp;<span class="num" id="7954566">65537</span><span class="op" id="7954571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954574">}</span><span class="op" id="7954575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954578">D</span><span class="op" id="7954579">:</span>&nbsp;<span class="ident" id="7954581">bigFromString</span><span class="op" id="7954594">(</span><span class="string" id="7954595">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7954905">)</span><span class="op" id="7954906">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954909">Primes</span><span class="op" id="7954915">:</span>&nbsp;<span class="op" id="7954917">[</span><span class="op" id="7954918">]</span><span class="op" id="7954919">*</span><span class="ident" id="7954920">big</span><span class="op" id="7954923">.</span><span class="ident" id="7954924">Int</span><span class="op" id="7954927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954931">bigFromString</span><span class="op" id="7954944">(</span><span class="string" id="7954945">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7955102">)</span><span class="op" id="7955103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955107">bigFromString</span><span class="op" id="7955120">(</span><span class="string" id="7955121">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7955278">)</span><span class="op" id="7955279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955282">}</span><span class="op" id="7955283">,</span><br>
<span class="lineno"></span><span class="op" id="7955285">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7955288">var</span>&nbsp;<span class="ident" id="7955292">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7955312">=</span>&nbsp;<span class="op" id="7955314">&amp;</span><span class="ident" id="7955315">ecdsa</span><span class="op" id="7955320">.</span><span class="ident" id="7955321">PrivateKey</span><span class="op" id="7955331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955334">PublicKey</span><span class="op" id="7955343">:</span>&nbsp;<span class="ident" id="7955345">ecdsa</span><span class="op" id="7955350">.</span><span class="ident" id="7955351">PublicKey</span><span class="op" id="7955360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955364">Curve</span><span class="op" id="7955369">:</span>&nbsp;<span class="ident" id="7955371">elliptic</span><span class="op" id="7955379">.</span><span class="ident" id="7955380">P521</span><span class="op" id="7955384">(</span><span class="op" id="7955385">)</span><span class="op" id="7955386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955390">X</span><span class="op" id="7955391">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955397">bigFromString</span><span class="op" id="7955410">(</span><span class="string" id="7955411">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7955570">)</span><span class="op" id="7955571">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955575">Y</span><span class="op" id="7955576">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955582">bigFromString</span><span class="op" id="7955595">(</span><span class="string" id="7955596">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7955755">)</span><span class="op" id="7955756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955759">}</span><span class="op" id="7955760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955763">D</span><span class="op" id="7955764">:</span>&nbsp;<span class="ident" id="7955766">bigFromString</span><span class="op" id="7955779">(</span><span class="string" id="7955780">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7955939">)</span><span class="op" id="7955940">,</span><br>
<span class="lineno"></span><span class="op" id="7955942">}</span>
</div>
</body>
</html>
