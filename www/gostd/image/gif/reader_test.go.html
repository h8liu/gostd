<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8087468">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8087523">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8087577">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8087628">package</span>&nbsp;<span class="ident" id="8087636">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8087641">import</span>&nbsp;<span class="op" id="8087648">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087651">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087660">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087676">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087685">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087700">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087711">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8087721">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8087724">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="8087791">const</span>&nbsp;<span class="op" id="8087797">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8087800">headerStr</span>&nbsp;<span class="op" id="8087810">=</span>&nbsp;<span class="string" id="8087812">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="8087821">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087825">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="8087844">+</span>&nbsp;<span class="comment" id="8087846">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8087869">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="8087884">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8087952">paletteStr</span>&nbsp;<span class="op" id="8087963">=</span>&nbsp;<span class="string" id="8087965">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="8087992">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088035">trailerStr</span>&nbsp;<span class="op" id="8088046">=</span>&nbsp;<span class="string" id="8088048">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="8088055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="8088058">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="8088130">func</span>&nbsp;<span class="ident" id="8088135">lzwEncode</span><span class="op" id="8088144">(</span><span class="ident" id="8088145">n</span>&nbsp;<span class="builtintype" id="8088147">int</span><span class="op" id="8088150">)</span>&nbsp;<span class="op" id="8088152">[</span><span class="op" id="8088153">]</span><span class="builtintype" id="8088154">byte</span>&nbsp;<span class="op" id="8088159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088162">b</span>&nbsp;<span class="op" id="8088164">:=</span>&nbsp;<span class="op" id="8088167">&amp;</span><span class="ident" id="8088168">bytes</span><span class="op" id="8088173">.</span><span class="ident" id="8088174">Buffer</span><span class="op" id="8088180">{</span><span class="op" id="8088181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088184">w</span>&nbsp;<span class="op" id="8088186">:=</span>&nbsp;<span class="ident" id="8088189">lzw</span><span class="op" id="8088192">.</span><span class="ident" id="8088193">NewWriter</span><span class="op" id="8088202">(</span><span class="ident" id="8088203">b</span><span class="op" id="8088204">,</span>&nbsp;<span class="ident" id="8088206">lzw</span><span class="op" id="8088209">.</span><span class="ident" id="8088210">LSB</span><span class="op" id="8088213">,</span>&nbsp;<span class="num" id="8088215">2</span><span class="op" id="8088216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088219">w</span><span class="op" id="8088220">.</span><span class="ident" id="8088221">Write</span><span class="op" id="8088226">(</span><span class="builtinfunc" id="8088227">make</span><span class="op" id="8088231">(</span><span class="op" id="8088232">[</span><span class="op" id="8088233">]</span><span class="builtintype" id="8088234">byte</span><span class="op" id="8088238">,</span>&nbsp;<span class="ident" id="8088240">n</span><span class="op" id="8088241">)</span><span class="op" id="8088242">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088245">w</span><span class="op" id="8088246">.</span><span class="ident" id="8088247">Close</span><span class="op" id="8088252">(</span><span class="op" id="8088253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8088256">return</span>&nbsp;<span class="ident" id="8088263">b</span><span class="op" id="8088264">.</span><span class="ident" id="8088265">Bytes</span><span class="op" id="8088270">(</span><span class="op" id="8088271">)</span><br>
<span class="lineno"></span><span class="op" id="8088273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8088276">func</span>&nbsp;<span class="ident" id="8088281">TestDecode</span><span class="op" id="8088291">(</span><span class="ident" id="8088292">t</span>&nbsp;<span class="op" id="8088294">*</span><span class="ident" id="8088295">testing</span><span class="op" id="8088302">.</span><span class="ident" id="8088303">T</span><span class="op" id="8088304">)</span>&nbsp;<span class="op" id="8088306">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088309">testCases</span>&nbsp;<span class="op" id="8088319">:=</span>&nbsp;<span class="op" id="8088322">[</span><span class="op" id="8088323">]</span><span class="keyword" id="8088324">struct</span>&nbsp;<span class="op" id="8088331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088335">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8088343">int</span>&nbsp;&nbsp;<span class="comment" id="8088348">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088393">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8088401">bool</span>&nbsp;<span class="comment" id="8088406">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088471">wantErr</span>&nbsp;<span class="builtintype" id="8088479">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088486">}</span><span class="op" id="8088487">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088491">{</span><span class="num" id="8088492">0</span><span class="op" id="8088493">,</span>&nbsp;<span class="builtintype" id="8088495">false</span><span class="op" id="8088500">,</span>&nbsp;<span class="ident" id="8088502">errNotEnough</span><span class="op" id="8088514">}</span><span class="op" id="8088515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088519">{</span><span class="num" id="8088520">1</span><span class="op" id="8088521">,</span>&nbsp;<span class="builtintype" id="8088523">false</span><span class="op" id="8088528">,</span>&nbsp;<span class="ident" id="8088530">errNotEnough</span><span class="op" id="8088542">}</span><span class="op" id="8088543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088547">{</span><span class="num" id="8088548">2</span><span class="op" id="8088549">,</span>&nbsp;<span class="builtintype" id="8088551">false</span><span class="op" id="8088556">,</span>&nbsp;<span class="builtintype" id="8088558">nil</span><span class="op" id="8088561">}</span><span class="op" id="8088562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088566">{</span><span class="num" id="8088567">2</span><span class="op" id="8088568">,</span>&nbsp;<span class="builtintype" id="8088570">true</span><span class="op" id="8088574">,</span>&nbsp;<span class="ident" id="8088576">errTooMuch</span><span class="op" id="8088586">}</span><span class="op" id="8088587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088591">{</span><span class="num" id="8088592">3</span><span class="op" id="8088593">,</span>&nbsp;<span class="builtintype" id="8088595">false</span><span class="op" id="8088600">,</span>&nbsp;<span class="ident" id="8088602">errTooMuch</span><span class="op" id="8088612">}</span><span class="op" id="8088613">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8088619">for</span>&nbsp;<span class="ident" id="8088623">_</span><span class="op" id="8088624">,</span>&nbsp;<span class="ident" id="8088626">tc</span>&nbsp;<span class="op" id="8088629">:=</span>&nbsp;<span class="keyword" id="8088632">range</span>&nbsp;<span class="ident" id="8088638">testCases</span>&nbsp;<span class="op" id="8088648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088652">b</span>&nbsp;<span class="op" id="8088654">:=</span>&nbsp;<span class="op" id="8088657">&amp;</span><span class="ident" id="8088658">bytes</span><span class="op" id="8088663">.</span><span class="ident" id="8088664">Buffer</span><span class="op" id="8088670">{</span><span class="op" id="8088671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088675">b</span><span class="op" id="8088676">.</span><span class="ident" id="8088677">WriteString</span><span class="op" id="8088688">(</span><span class="ident" id="8088689">headerStr</span><span class="op" id="8088698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088702">b</span><span class="op" id="8088703">.</span><span class="ident" id="8088704">WriteString</span><span class="op" id="8088715">(</span><span class="ident" id="8088716">paletteStr</span><span class="op" id="8088726">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8088730">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8088802">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8088871">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8088940">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088975">b</span><span class="op" id="8088976">.</span><span class="ident" id="8088977">WriteString</span><span class="op" id="8088988">(</span><span class="string" id="8088989">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8089035">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089039">if</span>&nbsp;<span class="ident" id="8089042">tc</span><span class="op" id="8089044">.</span><span class="ident" id="8089045">nPix</span>&nbsp;<span class="op" id="8089050">&gt;</span>&nbsp;<span class="num" id="8089052">0</span>&nbsp;<span class="op" id="8089054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089059">enc</span>&nbsp;<span class="op" id="8089063">:=</span>&nbsp;<span class="ident" id="8089066">lzwEncode</span><span class="op" id="8089075">(</span><span class="ident" id="8089076">tc</span><span class="op" id="8089078">.</span><span class="ident" id="8089079">nPix</span><span class="op" id="8089083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089088">if</span>&nbsp;<span class="builtinfunc" id="8089091">len</span><span class="op" id="8089094">(</span><span class="ident" id="8089095">enc</span><span class="op" id="8089098">)</span>&nbsp;<span class="op" id="8089100">&gt;</span>&nbsp;<span class="num" id="8089102">0xff</span>&nbsp;<span class="op" id="8089107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089113">t</span><span class="op" id="8089114">.</span><span class="ident" id="8089115">Errorf</span><span class="op" id="8089121">(</span><span class="string" id="8089122">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="8089176">,</span>&nbsp;<span class="ident" id="8089178">tc</span><span class="op" id="8089180">.</span><span class="ident" id="8089181">nPix</span><span class="op" id="8089185">,</span>&nbsp;<span class="ident" id="8089187">tc</span><span class="op" id="8089189">.</span><span class="ident" id="8089190">extra</span><span class="op" id="8089195">,</span>&nbsp;<span class="builtinfunc" id="8089197">len</span><span class="op" id="8089200">(</span><span class="ident" id="8089201">enc</span><span class="op" id="8089204">)</span><span class="op" id="8089205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089211">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089228">b</span><span class="op" id="8089229">.</span><span class="ident" id="8089230">WriteByte</span><span class="op" id="8089239">(</span><span class="builtintype" id="8089240">byte</span><span class="op" id="8089244">(</span><span class="builtinfunc" id="8089245">len</span><span class="op" id="8089248">(</span><span class="ident" id="8089249">enc</span><span class="op" id="8089252">)</span><span class="op" id="8089253">)</span><span class="op" id="8089254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089259">b</span><span class="op" id="8089260">.</span><span class="ident" id="8089261">Write</span><span class="op" id="8089266">(</span><span class="ident" id="8089267">enc</span><span class="op" id="8089270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089278">if</span>&nbsp;<span class="ident" id="8089281">tc</span><span class="op" id="8089283">.</span><span class="ident" id="8089284">extra</span>&nbsp;<span class="op" id="8089290">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089295">b</span><span class="op" id="8089296">.</span><span class="ident" id="8089297">WriteString</span><span class="op" id="8089308">(</span><span class="string" id="8089309">&#34;\x01\x02&#34;</span><span class="op" id="8089319">)</span>&nbsp;<span class="comment" id="8089321">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089366">b</span><span class="op" id="8089367">.</span><span class="ident" id="8089368">WriteByte</span><span class="op" id="8089377">(</span><span class="num" id="8089378">0x00</span><span class="op" id="8089382">)</span>&nbsp;<span class="comment" id="8089384">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089441">b</span><span class="op" id="8089442">.</span><span class="ident" id="8089443">WriteString</span><span class="op" id="8089454">(</span><span class="ident" id="8089455">trailerStr</span><span class="op" id="8089465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089470">got</span><span class="op" id="8089473">,</span>&nbsp;<span class="ident" id="8089475">err</span>&nbsp;<span class="op" id="8089479">:=</span>&nbsp;<span class="ident" id="8089482">Decode</span><span class="op" id="8089488">(</span><span class="ident" id="8089489">b</span><span class="op" id="8089490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089494">if</span>&nbsp;<span class="ident" id="8089497">err</span>&nbsp;<span class="op" id="8089501">!=</span>&nbsp;<span class="ident" id="8089504">tc</span><span class="op" id="8089506">.</span><span class="ident" id="8089507">wantErr</span>&nbsp;<span class="op" id="8089515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089520">t</span><span class="op" id="8089521">.</span><span class="ident" id="8089522">Errorf</span><span class="op" id="8089528">(</span><span class="string" id="8089529">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8089566">,</span>&nbsp;<span class="ident" id="8089568">tc</span><span class="op" id="8089570">.</span><span class="ident" id="8089571">nPix</span><span class="op" id="8089575">,</span>&nbsp;<span class="ident" id="8089577">tc</span><span class="op" id="8089579">.</span><span class="ident" id="8089580">extra</span><span class="op" id="8089585">,</span>&nbsp;<span class="ident" id="8089587">err</span><span class="op" id="8089590">,</span>&nbsp;<span class="ident" id="8089592">tc</span><span class="op" id="8089594">.</span><span class="ident" id="8089595">wantErr</span><span class="op" id="8089602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089611">if</span>&nbsp;<span class="ident" id="8089614">tc</span><span class="op" id="8089616">.</span><span class="ident" id="8089617">wantErr</span>&nbsp;<span class="op" id="8089625">!=</span>&nbsp;<span class="builtintype" id="8089628">nil</span>&nbsp;<span class="op" id="8089632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089652">want</span>&nbsp;<span class="op" id="8089657">:=</span>&nbsp;<span class="op" id="8089660">&amp;</span><span class="ident" id="8089661">image</span><span class="op" id="8089666">.</span><span class="ident" id="8089667">Paletted</span><span class="op" id="8089675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089680">Pix</span><span class="op" id="8089683">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089688">[</span><span class="op" id="8089689">]</span><span class="builtintype" id="8089690">uint8</span><span class="op" id="8089695">{</span><span class="num" id="8089696">0</span><span class="op" id="8089697">,</span>&nbsp;<span class="num" id="8089699">0</span><span class="op" id="8089700">}</span><span class="op" id="8089701">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089706">Stride</span><span class="op" id="8089712">:</span>&nbsp;<span class="num" id="8089714">2</span><span class="op" id="8089715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089720">Rect</span><span class="op" id="8089724">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8089728">image</span><span class="op" id="8089733">.</span><span class="ident" id="8089734">Rect</span><span class="op" id="8089738">(</span><span class="num" id="8089739">0</span><span class="op" id="8089740">,</span>&nbsp;<span class="num" id="8089742">0</span><span class="op" id="8089743">,</span>&nbsp;<span class="num" id="8089745">2</span><span class="op" id="8089746">,</span>&nbsp;<span class="num" id="8089748">1</span><span class="op" id="8089749">)</span><span class="op" id="8089750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089755">Palette</span><span class="op" id="8089762">:</span>&nbsp;<span class="ident" id="8089764">color</span><span class="op" id="8089769">.</span><span class="ident" id="8089770">Palette</span><span class="op" id="8089777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089783">color</span><span class="op" id="8089788">.</span><span class="ident" id="8089789">RGBA</span><span class="op" id="8089793">{</span><span class="num" id="8089794">0x10</span><span class="op" id="8089798">,</span>&nbsp;<span class="num" id="8089800">0x20</span><span class="op" id="8089804">,</span>&nbsp;<span class="num" id="8089806">0x30</span><span class="op" id="8089810">,</span>&nbsp;<span class="num" id="8089812">0xff</span><span class="op" id="8089816">}</span><span class="op" id="8089817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089823">color</span><span class="op" id="8089828">.</span><span class="ident" id="8089829">RGBA</span><span class="op" id="8089833">{</span><span class="num" id="8089834">0x40</span><span class="op" id="8089838">,</span>&nbsp;<span class="num" id="8089840">0x50</span><span class="op" id="8089844">,</span>&nbsp;<span class="num" id="8089846">0x60</span><span class="op" id="8089850">,</span>&nbsp;<span class="num" id="8089852">0xff</span><span class="op" id="8089856">}</span><span class="op" id="8089857">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089862">}</span><span class="op" id="8089863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8089871">if</span>&nbsp;<span class="op" id="8089874">!</span><span class="ident" id="8089875">reflect</span><span class="op" id="8089882">.</span><span class="ident" id="8089883">DeepEqual</span><span class="op" id="8089892">(</span><span class="ident" id="8089893">got</span><span class="op" id="8089896">,</span>&nbsp;<span class="ident" id="8089898">want</span><span class="op" id="8089902">)</span>&nbsp;<span class="op" id="8089904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8089909">t</span><span class="op" id="8089910">.</span><span class="ident" id="8089911">Errorf</span><span class="op" id="8089917">(</span><span class="string" id="8089918">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8089955">,</span>&nbsp;<span class="ident" id="8089957">tc</span><span class="op" id="8089959">.</span><span class="ident" id="8089960">nPix</span><span class="op" id="8089964">,</span>&nbsp;<span class="ident" id="8089966">tc</span><span class="op" id="8089968">.</span><span class="ident" id="8089969">extra</span><span class="op" id="8089974">,</span>&nbsp;<span class="ident" id="8089976">got</span><span class="op" id="8089979">,</span>&nbsp;<span class="ident" id="8089981">want</span><span class="op" id="8089985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089989">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8089992">}</span><br>
<span class="lineno"></span><span class="op" id="8089994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8089997">func</span>&nbsp;<span class="ident" id="8090002">TestTransparentIndex</span><span class="op" id="8090022">(</span><span class="ident" id="8090023">t</span>&nbsp;<span class="op" id="8090025">*</span><span class="ident" id="8090026">testing</span><span class="op" id="8090033">.</span><span class="ident" id="8090034">T</span><span class="op" id="8090035">)</span>&nbsp;<span class="op" id="8090037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090040">b</span>&nbsp;<span class="op" id="8090042">:=</span>&nbsp;<span class="op" id="8090045">&amp;</span><span class="ident" id="8090046">bytes</span><span class="op" id="8090051">.</span><span class="ident" id="8090052">Buffer</span><span class="op" id="8090058">{</span><span class="op" id="8090059">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090062">b</span><span class="op" id="8090063">.</span><span class="ident" id="8090064">WriteString</span><span class="op" id="8090075">(</span><span class="ident" id="8090076">headerStr</span><span class="op" id="8090085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090088">b</span><span class="op" id="8090089">.</span><span class="ident" id="8090090">WriteString</span><span class="op" id="8090101">(</span><span class="ident" id="8090102">paletteStr</span><span class="op" id="8090112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8090115">for</span>&nbsp;<span class="ident" id="8090119">transparentIndex</span>&nbsp;<span class="op" id="8090136">:=</span>&nbsp;<span class="num" id="8090139">0</span><span class="op" id="8090140">;</span>&nbsp;<span class="ident" id="8090142">transparentIndex</span>&nbsp;<span class="op" id="8090159">&lt;</span>&nbsp;<span class="num" id="8090161">3</span><span class="op" id="8090162">;</span>&nbsp;<span class="ident" id="8090164">transparentIndex</span><span class="op" id="8090180">++</span>&nbsp;<span class="op" id="8090183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8090187">if</span>&nbsp;<span class="ident" id="8090190">transparentIndex</span>&nbsp;<span class="op" id="8090207">&lt;</span>&nbsp;<span class="num" id="8090209">2</span>&nbsp;<span class="op" id="8090211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8090216">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090275">b</span><span class="op" id="8090276">.</span><span class="ident" id="8090277">WriteString</span><span class="op" id="8090288">(</span><span class="string" id="8090289">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="8090315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090320">b</span><span class="op" id="8090321">.</span><span class="ident" id="8090322">WriteByte</span><span class="op" id="8090331">(</span><span class="builtintype" id="8090332">byte</span><span class="op" id="8090336">(</span><span class="ident" id="8090337">transparentIndex</span><span class="op" id="8090353">)</span><span class="op" id="8090354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090359">b</span><span class="op" id="8090360">.</span><span class="ident" id="8090361">WriteByte</span><span class="op" id="8090370">(</span><span class="num" id="8090371">0</span><span class="op" id="8090372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8090380">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090436">b</span><span class="op" id="8090437">.</span><span class="ident" id="8090438">WriteString</span><span class="op" id="8090449">(</span><span class="string" id="8090450">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8090496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090500">enc</span>&nbsp;<span class="op" id="8090504">:=</span>&nbsp;<span class="ident" id="8090507">lzwEncode</span><span class="op" id="8090516">(</span><span class="num" id="8090517">2</span><span class="op" id="8090518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8090522">if</span>&nbsp;<span class="builtinfunc" id="8090525">len</span><span class="op" id="8090528">(</span><span class="ident" id="8090529">enc</span><span class="op" id="8090532">)</span>&nbsp;<span class="op" id="8090534">&gt;</span>&nbsp;<span class="num" id="8090536">0xff</span>&nbsp;<span class="op" id="8090541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090546">t</span><span class="op" id="8090547">.</span><span class="ident" id="8090548">Fatalf</span><span class="op" id="8090554">(</span><span class="string" id="8090555">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="8090590">,</span>&nbsp;<span class="builtinfunc" id="8090592">len</span><span class="op" id="8090595">(</span><span class="ident" id="8090596">enc</span><span class="op" id="8090599">)</span><span class="op" id="8090600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090604">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090608">b</span><span class="op" id="8090609">.</span><span class="ident" id="8090610">WriteByte</span><span class="op" id="8090619">(</span><span class="builtintype" id="8090620">byte</span><span class="op" id="8090624">(</span><span class="builtinfunc" id="8090625">len</span><span class="op" id="8090628">(</span><span class="ident" id="8090629">enc</span><span class="op" id="8090632">)</span><span class="op" id="8090633">)</span><span class="op" id="8090634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090638">b</span><span class="op" id="8090639">.</span><span class="ident" id="8090640">Write</span><span class="op" id="8090645">(</span><span class="ident" id="8090646">enc</span><span class="op" id="8090649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090653">b</span><span class="op" id="8090654">.</span><span class="ident" id="8090655">WriteByte</span><span class="op" id="8090664">(</span><span class="num" id="8090665">0x00</span><span class="op" id="8090669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090675">b</span><span class="op" id="8090676">.</span><span class="ident" id="8090677">WriteString</span><span class="op" id="8090688">(</span><span class="ident" id="8090689">trailerStr</span><span class="op" id="8090699">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090703">g</span><span class="op" id="8090704">,</span>&nbsp;<span class="ident" id="8090706">err</span>&nbsp;<span class="op" id="8090710">:=</span>&nbsp;<span class="ident" id="8090713">DecodeAll</span><span class="op" id="8090722">(</span><span class="ident" id="8090723">b</span><span class="op" id="8090724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8090727">if</span>&nbsp;<span class="ident" id="8090730">err</span>&nbsp;<span class="op" id="8090734">!=</span>&nbsp;<span class="builtintype" id="8090737">nil</span>&nbsp;<span class="op" id="8090741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090745">t</span><span class="op" id="8090746">.</span><span class="ident" id="8090747">Fatalf</span><span class="op" id="8090753">(</span><span class="string" id="8090754">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="8090769">,</span>&nbsp;<span class="ident" id="8090771">err</span><span class="op" id="8090774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090777">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090780">c0</span>&nbsp;<span class="op" id="8090783">:=</span>&nbsp;<span class="ident" id="8090786">color</span><span class="op" id="8090791">.</span><span class="ident" id="8090792">RGBA</span><span class="op" id="8090796">{</span><span class="ident" id="8090797">paletteStr</span><span class="op" id="8090807">[</span><span class="num" id="8090808">0</span><span class="op" id="8090809">]</span><span class="op" id="8090810">,</span>&nbsp;<span class="ident" id="8090812">paletteStr</span><span class="op" id="8090822">[</span><span class="num" id="8090823">1</span><span class="op" id="8090824">]</span><span class="op" id="8090825">,</span>&nbsp;<span class="ident" id="8090827">paletteStr</span><span class="op" id="8090837">[</span><span class="num" id="8090838">2</span><span class="op" id="8090839">]</span><span class="op" id="8090840">,</span>&nbsp;<span class="num" id="8090842">0xff</span><span class="op" id="8090846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090849">c1</span>&nbsp;<span class="op" id="8090852">:=</span>&nbsp;<span class="ident" id="8090855">color</span><span class="op" id="8090860">.</span><span class="ident" id="8090861">RGBA</span><span class="op" id="8090865">{</span><span class="ident" id="8090866">paletteStr</span><span class="op" id="8090876">[</span><span class="num" id="8090877">3</span><span class="op" id="8090878">]</span><span class="op" id="8090879">,</span>&nbsp;<span class="ident" id="8090881">paletteStr</span><span class="op" id="8090891">[</span><span class="num" id="8090892">4</span><span class="op" id="8090893">]</span><span class="op" id="8090894">,</span>&nbsp;<span class="ident" id="8090896">paletteStr</span><span class="op" id="8090906">[</span><span class="num" id="8090907">5</span><span class="op" id="8090908">]</span><span class="op" id="8090909">,</span>&nbsp;<span class="num" id="8090911">0xff</span><span class="op" id="8090915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090918">cz</span>&nbsp;<span class="op" id="8090921">:=</span>&nbsp;<span class="ident" id="8090924">color</span><span class="op" id="8090929">.</span><span class="ident" id="8090930">RGBA</span><span class="op" id="8090934">{</span><span class="op" id="8090935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8090938">wants</span>&nbsp;<span class="op" id="8090944">:=</span>&nbsp;<span class="op" id="8090947">[</span><span class="op" id="8090948">]</span><span class="ident" id="8090949">color</span><span class="op" id="8090954">.</span><span class="ident" id="8090955">Palette</span><span class="op" id="8090962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090966">{</span><span class="ident" id="8090967">cz</span><span class="op" id="8090969">,</span>&nbsp;<span class="ident" id="8090971">c1</span><span class="op" id="8090973">}</span><span class="op" id="8090974">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090978">{</span><span class="ident" id="8090979">c0</span><span class="op" id="8090981">,</span>&nbsp;<span class="ident" id="8090983">cz</span><span class="op" id="8090985">}</span><span class="op" id="8090986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8090990">{</span><span class="ident" id="8090991">c0</span><span class="op" id="8090993">,</span>&nbsp;<span class="ident" id="8090995">c1</span><span class="op" id="8090997">}</span><span class="op" id="8090998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8091001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8091004">if</span>&nbsp;<span class="builtinfunc" id="8091007">len</span><span class="op" id="8091010">(</span><span class="ident" id="8091011">g</span><span class="op" id="8091012">.</span><span class="ident" id="8091013">Image</span><span class="op" id="8091018">)</span>&nbsp;<span class="op" id="8091020">!=</span>&nbsp;<span class="builtinfunc" id="8091023">len</span><span class="op" id="8091026">(</span><span class="ident" id="8091027">wants</span><span class="op" id="8091032">)</span>&nbsp;<span class="op" id="8091034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8091038">t</span><span class="op" id="8091039">.</span><span class="ident" id="8091040">Fatalf</span><span class="op" id="8091046">(</span><span class="string" id="8091047">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8091071">,</span>&nbsp;<span class="builtinfunc" id="8091073">len</span><span class="op" id="8091076">(</span><span class="ident" id="8091077">g</span><span class="op" id="8091078">.</span><span class="ident" id="8091079">Image</span><span class="op" id="8091084">)</span><span class="op" id="8091085">,</span>&nbsp;<span class="builtinfunc" id="8091087">len</span><span class="op" id="8091090">(</span><span class="ident" id="8091091">wants</span><span class="op" id="8091096">)</span><span class="op" id="8091097">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8091100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8091103">for</span>&nbsp;<span class="ident" id="8091107">i</span><span class="op" id="8091108">,</span>&nbsp;<span class="ident" id="8091110">want</span>&nbsp;<span class="op" id="8091115">:=</span>&nbsp;<span class="keyword" id="8091118">range</span>&nbsp;<span class="ident" id="8091124">wants</span>&nbsp;<span class="op" id="8091130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8091134">got</span>&nbsp;<span class="op" id="8091138">:=</span>&nbsp;<span class="ident" id="8091141">g</span><span class="op" id="8091142">.</span><span class="ident" id="8091143">Image</span><span class="op" id="8091148">[</span><span class="ident" id="8091149">i</span><span class="op" id="8091150">]</span><span class="op" id="8091151">.</span><span class="ident" id="8091152">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8091162">if</span>&nbsp;<span class="op" id="8091165">!</span><span class="ident" id="8091166">reflect</span><span class="op" id="8091173">.</span><span class="ident" id="8091174">DeepEqual</span><span class="op" id="8091183">(</span><span class="ident" id="8091184">got</span><span class="op" id="8091187">,</span>&nbsp;<span class="ident" id="8091189">want</span><span class="op" id="8091193">)</span>&nbsp;<span class="op" id="8091195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8091200">t</span><span class="op" id="8091201">.</span><span class="ident" id="8091202">Errorf</span><span class="op" id="8091208">(</span><span class="string" id="8091209">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8091241">,</span>&nbsp;<span class="ident" id="8091243">i</span><span class="op" id="8091244">,</span>&nbsp;<span class="ident" id="8091246">got</span><span class="op" id="8091249">,</span>&nbsp;<span class="ident" id="8091251">want</span><span class="op" id="8091255">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8091259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8091262">}</span><br>
<span class="lineno"></span><span class="op" id="8091264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8091267">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="8091342">var</span>&nbsp;<span class="ident" id="8091346">testGIF</span>&nbsp;<span class="op" id="8091354">=</span>&nbsp;<span class="op" id="8091356">[</span><span class="op" id="8091357">]</span><span class="builtintype" id="8091358">byte</span><span class="op" id="8091362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8091365">&#39;G&#39;</span><span class="op" id="8091368">,</span>&nbsp;<span class="string" id="8091370">&#39;I&#39;</span><span class="op" id="8091373">,</span>&nbsp;<span class="string" id="8091375">&#39;F&#39;</span><span class="op" id="8091378">,</span>&nbsp;<span class="string" id="8091380">&#39;8&#39;</span><span class="op" id="8091383">,</span>&nbsp;<span class="string" id="8091385">&#39;9&#39;</span><span class="op" id="8091388">,</span>&nbsp;<span class="string" id="8091390">&#39;a&#39;</span><span class="op" id="8091393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091396">1</span><span class="op" id="8091397">,</span>&nbsp;<span class="num" id="8091399">0</span><span class="op" id="8091400">,</span>&nbsp;<span class="num" id="8091402">1</span><span class="op" id="8091403">,</span>&nbsp;<span class="num" id="8091405">0</span><span class="op" id="8091406">,</span>&nbsp;<span class="comment" id="8091408">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091425">128</span><span class="op" id="8091428">,</span>&nbsp;<span class="num" id="8091430">0</span><span class="op" id="8091431">,</span>&nbsp;<span class="num" id="8091433">0</span><span class="op" id="8091434">,</span>&nbsp;<span class="comment" id="8091436">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091470">0</span><span class="op" id="8091471">,</span>&nbsp;<span class="num" id="8091473">0</span><span class="op" id="8091474">,</span>&nbsp;<span class="num" id="8091476">0</span><span class="op" id="8091477">,</span>&nbsp;<span class="num" id="8091479">1</span><span class="op" id="8091480">,</span>&nbsp;<span class="num" id="8091482">1</span><span class="op" id="8091483">,</span>&nbsp;<span class="num" id="8091485">1</span><span class="op" id="8091486">,</span>&nbsp;<span class="comment" id="8091488">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091528">0x21</span><span class="op" id="8091532">,</span>&nbsp;<span class="num" id="8091534">0xf9</span><span class="op" id="8091538">,</span>&nbsp;<span class="num" id="8091540">0x04</span><span class="op" id="8091544">,</span>&nbsp;<span class="num" id="8091546">0x00</span><span class="op" id="8091550">,</span>&nbsp;<span class="num" id="8091552">0x00</span><span class="op" id="8091556">,</span>&nbsp;<span class="num" id="8091558">0x00</span><span class="op" id="8091562">,</span>&nbsp;<span class="num" id="8091564">0xff</span><span class="op" id="8091568">,</span>&nbsp;<span class="num" id="8091570">0x00</span><span class="op" id="8091574">,</span>&nbsp;<span class="comment" id="8091576">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8091585">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091609">0x2c</span><span class="op" id="8091613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091616">0x00</span><span class="op" id="8091620">,</span>&nbsp;<span class="num" id="8091622">0x00</span><span class="op" id="8091626">,</span>&nbsp;<span class="num" id="8091628">0x00</span><span class="op" id="8091632">,</span>&nbsp;<span class="num" id="8091634">0x00</span><span class="op" id="8091638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091641">0x01</span><span class="op" id="8091645">,</span>&nbsp;<span class="num" id="8091647">0x00</span><span class="op" id="8091651">,</span>&nbsp;<span class="num" id="8091653">0x01</span><span class="op" id="8091657">,</span>&nbsp;<span class="num" id="8091659">0x00</span><span class="op" id="8091663">,</span>&nbsp;<span class="comment" id="8091665">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091674">0x00</span><span class="op" id="8091678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091681">0x02</span><span class="op" id="8091685">,</span>&nbsp;<span class="num" id="8091687">0x02</span><span class="op" id="8091691">,</span>&nbsp;<span class="num" id="8091693">0x4c</span><span class="op" id="8091697">,</span>&nbsp;<span class="num" id="8091699">0x01</span><span class="op" id="8091703">,</span>&nbsp;<span class="num" id="8091705">0x00</span><span class="op" id="8091709">,</span>&nbsp;<span class="comment" id="8091711">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8091726">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8091738">0x3b</span><span class="op" id="8091742">,</span><br>
<span class="lineno"></span><span class="op" id="8091744">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8091747">func</span>&nbsp;<span class="ident" id="8091752">try</span><span class="op" id="8091755">(</span><span class="ident" id="8091756">t</span>&nbsp;<span class="op" id="8091758">*</span><span class="ident" id="8091759">testing</span><span class="op" id="8091766">.</span><span class="ident" id="8091767">T</span><span class="op" id="8091768">,</span>&nbsp;<span class="ident" id="8091770">b</span>&nbsp;<span class="op" id="8091772">[</span><span class="op" id="8091773">]</span><span class="builtintype" id="8091774">byte</span><span class="op" id="8091778">,</span>&nbsp;<span class="ident" id="8091780">want</span>&nbsp;<span class="builtintype" id="8091785">string</span><span class="op" id="8091791">)</span>&nbsp;<span class="op" id="8091793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8091796">_</span><span class="op" id="8091797">,</span>&nbsp;<span class="ident" id="8091799">err</span>&nbsp;<span class="op" id="8091803">:=</span>&nbsp;<span class="ident" id="8091806">DecodeAll</span><span class="op" id="8091815">(</span><span class="ident" id="8091816">bytes</span><span class="op" id="8091821">.</span><span class="ident" id="8091822">NewReader</span><span class="op" id="8091831">(</span><span class="ident" id="8091832">b</span><span class="op" id="8091833">)</span><span class="op" id="8091834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8091837">var</span>&nbsp;<span class="ident" id="8091841">got</span>&nbsp;<span class="builtintype" id="8091845">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8091853">if</span>&nbsp;<span class="ident" id="8091856">err</span>&nbsp;<span class="op" id="8091860">!=</span>&nbsp;<span class="builtintype" id="8091863">nil</span>&nbsp;<span class="op" id="8091867">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8091871">got</span>&nbsp;<span class="op" id="8091875">=</span>&nbsp;<span class="ident" id="8091877">err</span><span class="op" id="8091880">.</span><span class="ident" id="8091881">Error</span><span class="op" id="8091886">(</span><span class="op" id="8091887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8091890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8091893">if</span>&nbsp;<span class="ident" id="8091896">got</span>&nbsp;<span class="op" id="8091900">!=</span>&nbsp;<span class="ident" id="8091903">want</span>&nbsp;<span class="op" id="8091908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8091912">t</span><span class="op" id="8091913">.</span><span class="ident" id="8091914">Fatalf</span><span class="op" id="8091920">(</span><span class="string" id="8091921">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8091938">,</span>&nbsp;<span class="ident" id="8091940">got</span><span class="op" id="8091943">,</span>&nbsp;<span class="ident" id="8091945">want</span><span class="op" id="8091949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8091952">}</span><br>
<span class="lineno">165</span><span class="op" id="8091954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8091957">func</span>&nbsp;<span class="ident" id="8091962">TestBounds</span><span class="op" id="8091972">(</span><span class="ident" id="8091973">t</span>&nbsp;<span class="op" id="8091975">*</span><span class="ident" id="8091976">testing</span><span class="op" id="8091983">.</span><span class="ident" id="8091984">T</span><span class="op" id="8091985">)</span>&nbsp;<span class="op" id="8091987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8091990">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092024">gif</span>&nbsp;<span class="op" id="8092028">:=</span>&nbsp;<span class="builtinfunc" id="8092031">make</span><span class="op" id="8092035">(</span><span class="op" id="8092036">[</span><span class="op" id="8092037">]</span><span class="builtintype" id="8092038">byte</span><span class="op" id="8092042">,</span>&nbsp;<span class="builtinfunc" id="8092044">len</span><span class="op" id="8092047">(</span><span class="ident" id="8092048">testGIF</span><span class="op" id="8092055">)</span><span class="op" id="8092056">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8092059">copy</span><span class="op" id="8092063">(</span><span class="ident" id="8092064">gif</span><span class="op" id="8092067">,</span>&nbsp;<span class="ident" id="8092069">testGIF</span><span class="op" id="8092076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092079">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092121">gif</span><span class="op" id="8092124">[</span><span class="num" id="8092125">32</span><span class="op" id="8092127">]</span>&nbsp;<span class="op" id="8092129">=</span>&nbsp;<span class="num" id="8092131">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092134">want</span>&nbsp;<span class="op" id="8092139">:=</span>&nbsp;<span class="string" id="8092142">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092188">try</span><span class="op" id="8092191">(</span><span class="ident" id="8092192">t</span><span class="op" id="8092193">,</span>&nbsp;<span class="ident" id="8092195">gif</span><span class="op" id="8092198">,</span>&nbsp;<span class="ident" id="8092200">want</span><span class="op" id="8092204">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092208">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092263">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092305">gif</span><span class="op" id="8092308">[</span><span class="num" id="8092309">32</span><span class="op" id="8092311">]</span>&nbsp;<span class="op" id="8092313">=</span>&nbsp;<span class="num" id="8092315">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092318">want</span>&nbsp;<span class="op" id="8092323">=</span>&nbsp;<span class="string" id="8092325">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092353">try</span><span class="op" id="8092356">(</span><span class="ident" id="8092357">t</span><span class="op" id="8092358">,</span>&nbsp;<span class="ident" id="8092360">gif</span><span class="op" id="8092363">,</span>&nbsp;<span class="ident" id="8092365">want</span><span class="op" id="8092369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092372">gif</span><span class="op" id="8092375">[</span><span class="num" id="8092376">32</span><span class="op" id="8092378">]</span>&nbsp;<span class="op" id="8092380">=</span>&nbsp;<span class="num" id="8092382">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092386">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092435">want</span>&nbsp;<span class="op" id="8092440">=</span>&nbsp;<span class="string" id="8092442">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8092488">for</span>&nbsp;<span class="ident" id="8092492">i</span>&nbsp;<span class="op" id="8092494">:=</span>&nbsp;<span class="num" id="8092497">0</span><span class="op" id="8092498">;</span>&nbsp;<span class="ident" id="8092500">i</span>&nbsp;<span class="op" id="8092502">&lt;</span>&nbsp;<span class="num" id="8092504">4</span><span class="op" id="8092505">;</span>&nbsp;<span class="ident" id="8092507">i</span><span class="op" id="8092508">++</span>&nbsp;<span class="op" id="8092511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092515">gif</span><span class="op" id="8092518">[</span><span class="num" id="8092519">32</span><span class="op" id="8092521">+</span><span class="ident" id="8092522">i</span><span class="op" id="8092523">]</span>&nbsp;<span class="op" id="8092525">=</span>&nbsp;<span class="num" id="8092527">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8092533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092536">try</span><span class="op" id="8092539">(</span><span class="ident" id="8092540">t</span><span class="op" id="8092541">,</span>&nbsp;<span class="ident" id="8092543">gif</span><span class="op" id="8092546">,</span>&nbsp;<span class="ident" id="8092548">want</span><span class="op" id="8092552">)</span><br>
<span class="lineno"></span><span class="op" id="8092554">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8092557">func</span>&nbsp;<span class="ident" id="8092562">TestNoPalette</span><span class="op" id="8092575">(</span><span class="ident" id="8092576">t</span>&nbsp;<span class="op" id="8092578">*</span><span class="ident" id="8092579">testing</span><span class="op" id="8092586">.</span><span class="ident" id="8092587">T</span><span class="op" id="8092588">)</span>&nbsp;<span class="op" id="8092590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092593">b</span>&nbsp;<span class="op" id="8092595">:=</span>&nbsp;<span class="op" id="8092598">&amp;</span><span class="ident" id="8092599">bytes</span><span class="op" id="8092604">.</span><span class="ident" id="8092605">Buffer</span><span class="op" id="8092611">{</span><span class="op" id="8092612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092616">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092675">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092696">b</span><span class="op" id="8092697">.</span><span class="ident" id="8092698">WriteString</span><span class="op" id="8092709">(</span><span class="ident" id="8092710">headerStr</span><span class="op" id="8092719">[</span><span class="op" id="8092720">:</span><span class="builtinfunc" id="8092721">len</span><span class="op" id="8092724">(</span><span class="ident" id="8092725">headerStr</span><span class="op" id="8092734">)</span><span class="op" id="8092735">-</span><span class="num" id="8092736">3</span><span class="op" id="8092737">]</span><span class="op" id="8092738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092741">b</span><span class="op" id="8092742">.</span><span class="ident" id="8092743">WriteString</span><span class="op" id="8092754">(</span><span class="string" id="8092755">&#34;\x00\x00\x00&#34;</span><span class="op" id="8092769">)</span>&nbsp;<span class="comment" id="8092771">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092795">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092840">b</span><span class="op" id="8092841">.</span><span class="ident" id="8092842">WriteString</span><span class="op" id="8092853">(</span><span class="string" id="8092854">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8092900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8092904">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8092977">pix</span>&nbsp;<span class="op" id="8092981">:=</span>&nbsp;<span class="op" id="8092984">[</span><span class="op" id="8092985">]</span><span class="builtintype" id="8092986">byte</span><span class="op" id="8092990">{</span><span class="num" id="8092991">0</span><span class="op" id="8092992">,</span>&nbsp;<span class="num" id="8092994">128</span><span class="op" id="8092997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093000">enc</span>&nbsp;<span class="op" id="8093004">:=</span>&nbsp;<span class="op" id="8093007">&amp;</span><span class="ident" id="8093008">bytes</span><span class="op" id="8093013">.</span><span class="ident" id="8093014">Buffer</span><span class="op" id="8093020">{</span><span class="op" id="8093021">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093024">w</span>&nbsp;<span class="op" id="8093026">:=</span>&nbsp;<span class="ident" id="8093029">lzw</span><span class="op" id="8093032">.</span><span class="ident" id="8093033">NewWriter</span><span class="op" id="8093042">(</span><span class="ident" id="8093043">enc</span><span class="op" id="8093046">,</span>&nbsp;<span class="ident" id="8093048">lzw</span><span class="op" id="8093051">.</span><span class="ident" id="8093052">LSB</span><span class="op" id="8093055">,</span>&nbsp;<span class="num" id="8093057">2</span><span class="op" id="8093058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093061">w</span><span class="op" id="8093062">.</span><span class="ident" id="8093063">Write</span><span class="op" id="8093068">(</span><span class="ident" id="8093069">pix</span><span class="op" id="8093072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093075">w</span><span class="op" id="8093076">.</span><span class="ident" id="8093077">Close</span><span class="op" id="8093082">(</span><span class="op" id="8093083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093086">b</span><span class="op" id="8093087">.</span><span class="ident" id="8093088">WriteByte</span><span class="op" id="8093097">(</span><span class="builtintype" id="8093098">byte</span><span class="op" id="8093102">(</span><span class="builtinfunc" id="8093103">len</span><span class="op" id="8093106">(</span><span class="ident" id="8093107">enc</span><span class="op" id="8093110">.</span><span class="ident" id="8093111">Bytes</span><span class="op" id="8093116">(</span><span class="op" id="8093117">)</span><span class="op" id="8093118">)</span><span class="op" id="8093119">)</span><span class="op" id="8093120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093123">b</span><span class="op" id="8093124">.</span><span class="ident" id="8093125">Write</span><span class="op" id="8093130">(</span><span class="ident" id="8093131">enc</span><span class="op" id="8093134">.</span><span class="ident" id="8093135">Bytes</span><span class="op" id="8093140">(</span><span class="op" id="8093141">)</span><span class="op" id="8093142">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093145">b</span><span class="op" id="8093146">.</span><span class="ident" id="8093147">WriteByte</span><span class="op" id="8093156">(</span><span class="num" id="8093157">0x00</span><span class="op" id="8093161">)</span>&nbsp;<span class="comment" id="8093163">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093220">b</span><span class="op" id="8093221">.</span><span class="ident" id="8093222">WriteString</span><span class="op" id="8093233">(</span><span class="ident" id="8093234">trailerStr</span><span class="op" id="8093244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093248">try</span><span class="op" id="8093251">(</span><span class="ident" id="8093252">t</span><span class="op" id="8093253">,</span>&nbsp;<span class="ident" id="8093255">b</span><span class="op" id="8093256">.</span><span class="ident" id="8093257">Bytes</span><span class="op" id="8093262">(</span><span class="op" id="8093263">)</span><span class="op" id="8093264">,</span>&nbsp;<span class="string" id="8093266">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="8093292">)</span><br>
<span class="lineno">215</span><span class="op" id="8093294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8093297">func</span>&nbsp;<span class="ident" id="8093302">TestPixelOutsidePaletteRange</span><span class="op" id="8093330">(</span><span class="ident" id="8093331">t</span>&nbsp;<span class="op" id="8093333">*</span><span class="ident" id="8093334">testing</span><span class="op" id="8093341">.</span><span class="ident" id="8093342">T</span><span class="op" id="8093343">)</span>&nbsp;<span class="op" id="8093345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8093348">for</span>&nbsp;<span class="ident" id="8093352">_</span><span class="op" id="8093353">,</span>&nbsp;<span class="ident" id="8093355">pval</span>&nbsp;<span class="op" id="8093360">:=</span>&nbsp;<span class="keyword" id="8093363">range</span>&nbsp;<span class="op" id="8093369">[</span><span class="op" id="8093370">]</span><span class="builtintype" id="8093371">byte</span><span class="op" id="8093375">{</span><span class="num" id="8093376">0</span><span class="op" id="8093377">,</span>&nbsp;<span class="num" id="8093379">1</span><span class="op" id="8093380">,</span>&nbsp;<span class="num" id="8093382">2</span><span class="op" id="8093383">,</span>&nbsp;<span class="num" id="8093385">3</span><span class="op" id="8093386">,</span>&nbsp;<span class="num" id="8093388">255</span><span class="op" id="8093391">}</span>&nbsp;<span class="op" id="8093393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093397">b</span>&nbsp;<span class="op" id="8093399">:=</span>&nbsp;<span class="op" id="8093402">&amp;</span><span class="ident" id="8093403">bytes</span><span class="op" id="8093408">.</span><span class="ident" id="8093409">Buffer</span><span class="op" id="8093415">{</span><span class="op" id="8093416">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8093421">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093468">b</span><span class="op" id="8093469">.</span><span class="ident" id="8093470">WriteString</span><span class="op" id="8093481">(</span><span class="ident" id="8093482">headerStr</span><span class="op" id="8093491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093495">b</span><span class="op" id="8093496">.</span><span class="ident" id="8093497">WriteString</span><span class="op" id="8093508">(</span><span class="ident" id="8093509">paletteStr</span><span class="op" id="8093519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8093524">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093570">b</span><span class="op" id="8093571">.</span><span class="ident" id="8093572">WriteString</span><span class="op" id="8093583">(</span><span class="string" id="8093584">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8093630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8093635">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093698">pix</span>&nbsp;<span class="op" id="8093702">:=</span>&nbsp;<span class="op" id="8093705">[</span><span class="op" id="8093706">]</span><span class="builtintype" id="8093707">byte</span><span class="op" id="8093711">{</span><span class="ident" id="8093712">pval</span><span class="op" id="8093716">,</span>&nbsp;<span class="ident" id="8093718">pval</span><span class="op" id="8093722">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093726">enc</span>&nbsp;<span class="op" id="8093730">:=</span>&nbsp;<span class="op" id="8093733">&amp;</span><span class="ident" id="8093734">bytes</span><span class="op" id="8093739">.</span><span class="ident" id="8093740">Buffer</span><span class="op" id="8093746">{</span><span class="op" id="8093747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093751">w</span>&nbsp;<span class="op" id="8093753">:=</span>&nbsp;<span class="ident" id="8093756">lzw</span><span class="op" id="8093759">.</span><span class="ident" id="8093760">NewWriter</span><span class="op" id="8093769">(</span><span class="ident" id="8093770">enc</span><span class="op" id="8093773">,</span>&nbsp;<span class="ident" id="8093775">lzw</span><span class="op" id="8093778">.</span><span class="ident" id="8093779">LSB</span><span class="op" id="8093782">,</span>&nbsp;<span class="num" id="8093784">2</span><span class="op" id="8093785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093789">w</span><span class="op" id="8093790">.</span><span class="ident" id="8093791">Write</span><span class="op" id="8093796">(</span><span class="ident" id="8093797">pix</span><span class="op" id="8093800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093804">w</span><span class="op" id="8093805">.</span><span class="ident" id="8093806">Close</span><span class="op" id="8093811">(</span><span class="op" id="8093812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093816">b</span><span class="op" id="8093817">.</span><span class="ident" id="8093818">WriteByte</span><span class="op" id="8093827">(</span><span class="builtintype" id="8093828">byte</span><span class="op" id="8093832">(</span><span class="builtinfunc" id="8093833">len</span><span class="op" id="8093836">(</span><span class="ident" id="8093837">enc</span><span class="op" id="8093840">.</span><span class="ident" id="8093841">Bytes</span><span class="op" id="8093846">(</span><span class="op" id="8093847">)</span><span class="op" id="8093848">)</span><span class="op" id="8093849">)</span><span class="op" id="8093850">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093854">b</span><span class="op" id="8093855">.</span><span class="ident" id="8093856">Write</span><span class="op" id="8093861">(</span><span class="ident" id="8093862">enc</span><span class="op" id="8093865">.</span><span class="ident" id="8093866">Bytes</span><span class="op" id="8093871">(</span><span class="op" id="8093872">)</span><span class="op" id="8093873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093877">b</span><span class="op" id="8093878">.</span><span class="ident" id="8093879">WriteByte</span><span class="op" id="8093888">(</span><span class="num" id="8093889">0x00</span><span class="op" id="8093893">)</span>&nbsp;<span class="comment" id="8093895">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8093953">b</span><span class="op" id="8093954">.</span><span class="ident" id="8093955">WriteString</span><span class="op" id="8093966">(</span><span class="ident" id="8093967">trailerStr</span><span class="op" id="8093977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8093982">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094056">want</span>&nbsp;<span class="op" id="8094061">:=</span>&nbsp;<span class="string" id="8094064">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094069">if</span>&nbsp;<span class="ident" id="8094072">pval</span>&nbsp;<span class="op" id="8094077">&gt;=</span>&nbsp;<span class="num" id="8094080">2</span>&nbsp;<span class="op" id="8094082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094087">want</span>&nbsp;<span class="op" id="8094092">=</span>&nbsp;<span class="string" id="8094094">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8094123">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094127">try</span><span class="op" id="8094130">(</span><span class="ident" id="8094131">t</span><span class="op" id="8094132">,</span>&nbsp;<span class="ident" id="8094134">b</span><span class="op" id="8094135">.</span><span class="ident" id="8094136">Bytes</span><span class="op" id="8094141">(</span><span class="op" id="8094142">)</span><span class="op" id="8094143">,</span>&nbsp;<span class="ident" id="8094145">want</span><span class="op" id="8094149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8094152">}</span><br>
<span class="lineno"></span><span class="op" id="8094154">}</span>
</div>
</body>
</html>
