<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io/ioutil</h2>
<ul>
<li><a href="/gostd/io/ioutil/ioutil.go.html">ioutil.go</a></li>
<li><a href="/gostd/io/ioutil/ioutil_test.go.html">ioutil_test.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile.go.html">tempfile.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile_test.go.html" class="current">tempfile_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8483407">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8483462">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8483516">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8483567">package</span>&nbsp;<span class="ident" id="8483575">ioutil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8483583">import</span>&nbsp;<span class="op" id="8483590">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483593">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483599">&#34;path/filepath&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483616">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483626">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8483636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8483639">func</span>&nbsp;<span class="ident" id="8483644">TestTempFile</span><span class="op" id="8483656">(</span><span class="ident" id="8483657">t</span>&nbsp;<span class="op" id="8483659">*</span><span class="ident" id="8483660">testing</span><span class="op" id="8483667">.</span><span class="ident" id="8483668">T</span><span class="op" id="8483669">)</span>&nbsp;<span class="op" id="8483671">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483674">f</span><span class="op" id="8483675">,</span>&nbsp;<span class="ident" id="8483677">err</span>&nbsp;<span class="op" id="8483681">:=</span>&nbsp;<span class="ident" id="8483684">TempFile</span><span class="op" id="8483692">(</span><span class="string" id="8483693">&#34;/_not_exists_&#34;</span><span class="op" id="8483708">,</span>&nbsp;<span class="string" id="8483710">&#34;foo&#34;</span><span class="op" id="8483715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483718">if</span>&nbsp;<span class="ident" id="8483721">f</span>&nbsp;<span class="op" id="8483723">!=</span>&nbsp;<span class="builtintype" id="8483726">nil</span>&nbsp;<span class="op" id="8483730">||</span>&nbsp;<span class="ident" id="8483733">err</span>&nbsp;<span class="op" id="8483737">==</span>&nbsp;<span class="builtintype" id="8483740">nil</span>&nbsp;<span class="op" id="8483744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483748">t</span><span class="op" id="8483749">.</span><span class="ident" id="8483750">Errorf</span><span class="op" id="8483756">(</span><span class="string" id="8483757">&#34;TempFile(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8483800">,</span>&nbsp;<span class="ident" id="8483802">f</span><span class="op" id="8483803">,</span>&nbsp;<span class="ident" id="8483805">err</span><span class="op" id="8483808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483815">dir</span>&nbsp;<span class="op" id="8483819">:=</span>&nbsp;<span class="ident" id="8483822">os</span><span class="op" id="8483824">.</span><span class="ident" id="8483825">TempDir</span><span class="op" id="8483832">(</span><span class="op" id="8483833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483836">f</span><span class="op" id="8483837">,</span>&nbsp;<span class="ident" id="8483839">err</span>&nbsp;<span class="op" id="8483843">=</span>&nbsp;<span class="ident" id="8483845">TempFile</span><span class="op" id="8483853">(</span><span class="ident" id="8483854">dir</span><span class="op" id="8483857">,</span>&nbsp;<span class="string" id="8483859">&#34;ioutil_test&#34;</span><span class="op" id="8483872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483875">if</span>&nbsp;<span class="ident" id="8483878">f</span>&nbsp;<span class="op" id="8483880">==</span>&nbsp;<span class="builtintype" id="8483883">nil</span>&nbsp;<span class="op" id="8483887">||</span>&nbsp;<span class="ident" id="8483890">err</span>&nbsp;<span class="op" id="8483894">!=</span>&nbsp;<span class="builtintype" id="8483897">nil</span>&nbsp;<span class="op" id="8483901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483905">t</span><span class="op" id="8483906">.</span><span class="ident" id="8483907">Errorf</span><span class="op" id="8483913">(</span><span class="string" id="8483914">&#34;TempFile(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8483953">,</span>&nbsp;<span class="ident" id="8483955">f</span><span class="op" id="8483956">,</span>&nbsp;<span class="ident" id="8483958">err</span><span class="op" id="8483961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483964">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483967">if</span>&nbsp;<span class="ident" id="8483970">f</span>&nbsp;<span class="op" id="8483972">!=</span>&nbsp;<span class="builtintype" id="8483975">nil</span>&nbsp;<span class="op" id="8483979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483983">f</span><span class="op" id="8483984">.</span><span class="ident" id="8483985">Close</span><span class="op" id="8483990">(</span><span class="op" id="8483991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483995">os</span><span class="op" id="8483997">.</span><span class="ident" id="8483998">Remove</span><span class="op" id="8484004">(</span><span class="ident" id="8484005">f</span><span class="op" id="8484006">.</span><span class="ident" id="8484007">Name</span><span class="op" id="8484011">(</span><span class="op" id="8484012">)</span><span class="op" id="8484013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484017">re</span>&nbsp;<span class="op" id="8484020">:=</span>&nbsp;<span class="ident" id="8484023">regexp</span><span class="op" id="8484029">.</span><span class="ident" id="8484030">MustCompile</span><span class="op" id="8484041">(</span><span class="string" id="8484042">&#34;^&#34;</span>&nbsp;<span class="op" id="8484046">+</span>&nbsp;<span class="ident" id="8484048">regexp</span><span class="op" id="8484054">.</span><span class="ident" id="8484055">QuoteMeta</span><span class="op" id="8484064">(</span><span class="ident" id="8484065">filepath</span><span class="op" id="8484073">.</span><span class="ident" id="8484074">Join</span><span class="op" id="8484078">(</span><span class="ident" id="8484079">dir</span><span class="op" id="8484082">,</span>&nbsp;<span class="string" id="8484084">&#34;ioutil_test&#34;</span><span class="op" id="8484097">)</span><span class="op" id="8484098">)</span>&nbsp;<span class="op" id="8484100">+</span>&nbsp;<span class="string" id="8484102">&#34;[0-9]+$&#34;</span><span class="op" id="8484111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484115">if</span>&nbsp;<span class="op" id="8484118">!</span><span class="ident" id="8484119">re</span><span class="op" id="8484121">.</span><span class="ident" id="8484122">MatchString</span><span class="op" id="8484133">(</span><span class="ident" id="8484134">f</span><span class="op" id="8484135">.</span><span class="ident" id="8484136">Name</span><span class="op" id="8484140">(</span><span class="op" id="8484141">)</span><span class="op" id="8484142">)</span>&nbsp;<span class="op" id="8484144">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484149">t</span><span class="op" id="8484150">.</span><span class="ident" id="8484151">Errorf</span><span class="op" id="8484157">(</span><span class="string" id="8484158">&#34;TempFile(`&#34;</span><span class="op" id="8484170">+</span><span class="ident" id="8484171">dir</span><span class="op" id="8484174">+</span><span class="string" id="8484175">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="8484214">,</span>&nbsp;<span class="ident" id="8484216">f</span><span class="op" id="8484217">.</span><span class="ident" id="8484218">Name</span><span class="op" id="8484222">(</span><span class="op" id="8484223">)</span><span class="op" id="8484224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484231">}</span><br>
<span class="lineno"></span><span class="op" id="8484233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="8484236">func</span>&nbsp;<span class="ident" id="8484241">TestTempDir</span><span class="op" id="8484252">(</span><span class="ident" id="8484253">t</span>&nbsp;<span class="op" id="8484255">*</span><span class="ident" id="8484256">testing</span><span class="op" id="8484263">.</span><span class="ident" id="8484264">T</span><span class="op" id="8484265">)</span>&nbsp;<span class="op" id="8484267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484270">name</span><span class="op" id="8484274">,</span>&nbsp;<span class="ident" id="8484276">err</span>&nbsp;<span class="op" id="8484280">:=</span>&nbsp;<span class="ident" id="8484283">TempDir</span><span class="op" id="8484290">(</span><span class="string" id="8484291">&#34;/_not_exists_&#34;</span><span class="op" id="8484306">,</span>&nbsp;<span class="string" id="8484308">&#34;foo&#34;</span><span class="op" id="8484313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484316">if</span>&nbsp;<span class="ident" id="8484319">name</span>&nbsp;<span class="op" id="8484324">!=</span>&nbsp;<span class="string" id="8484327">&#34;&#34;</span>&nbsp;<span class="op" id="8484330">||</span>&nbsp;<span class="ident" id="8484333">err</span>&nbsp;<span class="op" id="8484337">==</span>&nbsp;<span class="builtintype" id="8484340">nil</span>&nbsp;<span class="op" id="8484344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484348">t</span><span class="op" id="8484349">.</span><span class="ident" id="8484350">Errorf</span><span class="op" id="8484356">(</span><span class="string" id="8484357">&#34;TempDir(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8484399">,</span>&nbsp;<span class="ident" id="8484401">name</span><span class="op" id="8484405">,</span>&nbsp;<span class="ident" id="8484407">err</span><span class="op" id="8484410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484413">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484417">dir</span>&nbsp;<span class="op" id="8484421">:=</span>&nbsp;<span class="ident" id="8484424">os</span><span class="op" id="8484426">.</span><span class="ident" id="8484427">TempDir</span><span class="op" id="8484434">(</span><span class="op" id="8484435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484438">name</span><span class="op" id="8484442">,</span>&nbsp;<span class="ident" id="8484444">err</span>&nbsp;<span class="op" id="8484448">=</span>&nbsp;<span class="ident" id="8484450">TempDir</span><span class="op" id="8484457">(</span><span class="ident" id="8484458">dir</span><span class="op" id="8484461">,</span>&nbsp;<span class="string" id="8484463">&#34;ioutil_test&#34;</span><span class="op" id="8484476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484479">if</span>&nbsp;<span class="ident" id="8484482">name</span>&nbsp;<span class="op" id="8484487">==</span>&nbsp;<span class="string" id="8484490">&#34;&#34;</span>&nbsp;<span class="op" id="8484493">||</span>&nbsp;<span class="ident" id="8484496">err</span>&nbsp;<span class="op" id="8484500">!=</span>&nbsp;<span class="builtintype" id="8484503">nil</span>&nbsp;<span class="op" id="8484507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484511">t</span><span class="op" id="8484512">.</span><span class="ident" id="8484513">Errorf</span><span class="op" id="8484519">(</span><span class="string" id="8484520">&#34;TempDir(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8484558">,</span>&nbsp;<span class="ident" id="8484560">name</span><span class="op" id="8484564">,</span>&nbsp;<span class="ident" id="8484566">err</span><span class="op" id="8484569">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484575">if</span>&nbsp;<span class="ident" id="8484578">name</span>&nbsp;<span class="op" id="8484583">!=</span>&nbsp;<span class="string" id="8484586">&#34;&#34;</span>&nbsp;<span class="op" id="8484589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484593">os</span><span class="op" id="8484595">.</span><span class="ident" id="8484596">Remove</span><span class="op" id="8484602">(</span><span class="ident" id="8484603">name</span><span class="op" id="8484607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484611">re</span>&nbsp;<span class="op" id="8484614">:=</span>&nbsp;<span class="ident" id="8484617">regexp</span><span class="op" id="8484623">.</span><span class="ident" id="8484624">MustCompile</span><span class="op" id="8484635">(</span><span class="string" id="8484636">&#34;^&#34;</span>&nbsp;<span class="op" id="8484640">+</span>&nbsp;<span class="ident" id="8484642">regexp</span><span class="op" id="8484648">.</span><span class="ident" id="8484649">QuoteMeta</span><span class="op" id="8484658">(</span><span class="ident" id="8484659">filepath</span><span class="op" id="8484667">.</span><span class="ident" id="8484668">Join</span><span class="op" id="8484672">(</span><span class="ident" id="8484673">dir</span><span class="op" id="8484676">,</span>&nbsp;<span class="string" id="8484678">&#34;ioutil_test&#34;</span><span class="op" id="8484691">)</span><span class="op" id="8484692">)</span>&nbsp;<span class="op" id="8484694">+</span>&nbsp;<span class="string" id="8484696">&#34;[0-9]+$&#34;</span><span class="op" id="8484705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484709">if</span>&nbsp;<span class="op" id="8484712">!</span><span class="ident" id="8484713">re</span><span class="op" id="8484715">.</span><span class="ident" id="8484716">MatchString</span><span class="op" id="8484727">(</span><span class="ident" id="8484728">name</span><span class="op" id="8484732">)</span>&nbsp;<span class="op" id="8484734">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484739">t</span><span class="op" id="8484740">.</span><span class="ident" id="8484741">Errorf</span><span class="op" id="8484747">(</span><span class="string" id="8484748">&#34;TempDir(`&#34;</span><span class="op" id="8484759">+</span><span class="ident" id="8484760">dir</span><span class="op" id="8484763">+</span><span class="string" id="8484764">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="8484803">,</span>&nbsp;<span class="ident" id="8484805">name</span><span class="op" id="8484809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484816">}</span><br>
<span class="lineno"></span><span class="op" id="8484818">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
