<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html" class="current">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3297023">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3297078">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3297132">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3297183">package</span>&nbsp;<span class="ident" id="3297191">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3297196">import</span>&nbsp;<span class="op" id="3297203">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3297206">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3297218">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3297225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3297228">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3297308">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3297329">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="3297401">func</span>&nbsp;<span class="ident" id="3297406">exportFilter</span><span class="op" id="3297418">(</span><span class="ident" id="3297419">name</span>&nbsp;<span class="builtintype" id="3297424">string</span><span class="op" id="3297430">)</span>&nbsp;<span class="builtintype" id="3297432">bool</span>&nbsp;<span class="op" id="3297437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297440">return</span>&nbsp;<span class="ident" id="3297447">IsExported</span><span class="op" id="3297457">(</span><span class="ident" id="3297458">name</span><span class="op" id="3297462">)</span><br>
<span class="lineno"></span><span class="op" id="3297464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3297467">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3297536">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="3297616">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3297694">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3297770">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="3297822">//</span><br>
<span class="lineno"></span><span class="comment" id="3297825">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="3297889">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3297920">//</span><br>
<span class="lineno"></span><span class="keyword" id="3297923">func</span>&nbsp;<span class="ident" id="3297928">FileExports</span><span class="op" id="3297939">(</span><span class="ident" id="3297940">src</span>&nbsp;<span class="op" id="3297944">*</span><span class="ident" id="3297945">File</span><span class="op" id="3297949">)</span>&nbsp;<span class="builtintype" id="3297951">bool</span>&nbsp;<span class="op" id="3297956">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297959">return</span>&nbsp;<span class="ident" id="3297966">filterFile</span><span class="op" id="3297976">(</span><span class="ident" id="3297977">src</span><span class="op" id="3297980">,</span>&nbsp;<span class="ident" id="3297982">exportFilter</span><span class="op" id="3297994">,</span>&nbsp;<span class="builtintype" id="3297996">true</span><span class="op" id="3298000">)</span><br>
<span class="lineno"></span><span class="op" id="3298002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3298005">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3298073">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="3298147">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="3298208">//</span><br>
<span class="lineno"></span><span class="comment" id="3298211">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="3298278">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3298309">//</span><br>
<span class="lineno">40</span><span class="keyword" id="3298312">func</span>&nbsp;<span class="ident" id="3298317">PackageExports</span><span class="op" id="3298331">(</span><span class="ident" id="3298332">pkg</span>&nbsp;<span class="op" id="3298336">*</span><span class="ident" id="3298337">Package</span><span class="op" id="3298344">)</span>&nbsp;<span class="builtintype" id="3298346">bool</span>&nbsp;<span class="op" id="3298351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298354">return</span>&nbsp;<span class="ident" id="3298361">filterPackage</span><span class="op" id="3298374">(</span><span class="ident" id="3298375">pkg</span><span class="op" id="3298378">,</span>&nbsp;<span class="ident" id="3298380">exportFilter</span><span class="op" id="3298392">,</span>&nbsp;<span class="builtintype" id="3298394">true</span><span class="op" id="3298398">)</span><br>
<span class="lineno"></span><span class="op" id="3298400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3298403">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="3298483">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3298505">type</span>&nbsp;<span class="ident" id="3298510">Filter</span>&nbsp;<span class="keyword" id="3298517">func</span><span class="op" id="3298521">(</span><span class="builtintype" id="3298522">string</span><span class="op" id="3298528">)</span>&nbsp;<span class="builtintype" id="3298530">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3298536">func</span>&nbsp;<span class="ident" id="3298541">filterIdentList</span><span class="op" id="3298556">(</span><span class="ident" id="3298557">list</span>&nbsp;<span class="op" id="3298562">[</span><span class="op" id="3298563">]</span><span class="op" id="3298564">*</span><span class="ident" id="3298565">Ident</span><span class="op" id="3298570">,</span>&nbsp;<span class="ident" id="3298572">f</span>&nbsp;<span class="ident" id="3298574">Filter</span><span class="op" id="3298580">)</span>&nbsp;<span class="op" id="3298582">[</span><span class="op" id="3298583">]</span><span class="op" id="3298584">*</span><span class="ident" id="3298585">Ident</span>&nbsp;<span class="op" id="3298591">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298594">j</span>&nbsp;<span class="op" id="3298596">:=</span>&nbsp;<span class="num" id="3298599">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298602">for</span>&nbsp;<span class="ident" id="3298606">_</span><span class="op" id="3298607">,</span>&nbsp;<span class="ident" id="3298609">x</span>&nbsp;<span class="op" id="3298611">:=</span>&nbsp;<span class="keyword" id="3298614">range</span>&nbsp;<span class="ident" id="3298620">list</span>&nbsp;<span class="op" id="3298625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298629">if</span>&nbsp;<span class="ident" id="3298632">f</span><span class="op" id="3298633">(</span><span class="ident" id="3298634">x</span><span class="op" id="3298635">.</span><span class="ident" id="3298636">Name</span><span class="op" id="3298640">)</span>&nbsp;<span class="op" id="3298642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298647">list</span><span class="op" id="3298651">[</span><span class="ident" id="3298652">j</span><span class="op" id="3298653">]</span>&nbsp;<span class="op" id="3298655">=</span>&nbsp;<span class="ident" id="3298657">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298662">j</span><span class="op" id="3298663">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298674">return</span>&nbsp;<span class="ident" id="3298681">list</span><span class="op" id="3298685">[</span><span class="num" id="3298686">0</span><span class="op" id="3298687">:</span><span class="ident" id="3298688">j</span><span class="op" id="3298689">]</span><br>
<span class="lineno"></span><span class="op" id="3298691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3298694">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3298760">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="3298827">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3298866">//</span><br>
<span class="lineno"></span><span class="keyword" id="3298869">func</span>&nbsp;<span class="ident" id="3298874">fieldName</span><span class="op" id="3298883">(</span><span class="ident" id="3298884">x</span>&nbsp;<span class="ident" id="3298886">Expr</span><span class="op" id="3298890">)</span>&nbsp;<span class="op" id="3298892">*</span><span class="ident" id="3298893">Ident</span>&nbsp;<span class="op" id="3298899">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298902">switch</span>&nbsp;<span class="ident" id="3298909">t</span>&nbsp;<span class="op" id="3298911">:=</span>&nbsp;<span class="ident" id="3298914">x</span><span class="op" id="3298915">.</span><span class="op" id="3298916">(</span><span class="keyword" id="3298917">type</span><span class="op" id="3298921">)</span>&nbsp;<span class="op" id="3298923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298926">case</span>&nbsp;<span class="op" id="3298931">*</span><span class="ident" id="3298932">Ident</span><span class="op" id="3298937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298941">return</span>&nbsp;<span class="ident" id="3298948">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298951">case</span>&nbsp;<span class="op" id="3298956">*</span><span class="ident" id="3298957">SelectorExpr</span><span class="op" id="3298969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298973">if</span>&nbsp;<span class="ident" id="3298976">_</span><span class="op" id="3298977">,</span>&nbsp;<span class="ident" id="3298979">ok</span>&nbsp;<span class="op" id="3298982">:=</span>&nbsp;<span class="ident" id="3298985">t</span><span class="op" id="3298986">.</span><span class="ident" id="3298987">X</span><span class="op" id="3298988">.</span><span class="op" id="3298989">(</span><span class="op" id="3298990">*</span><span class="ident" id="3298991">Ident</span><span class="op" id="3298996">)</span><span class="op" id="3298997">;</span>&nbsp;<span class="ident" id="3298999">ok</span>&nbsp;<span class="op" id="3299002">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299007">return</span>&nbsp;<span class="ident" id="3299014">t</span><span class="op" id="3299015">.</span><span class="ident" id="3299016">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299025">case</span>&nbsp;<span class="op" id="3299030">*</span><span class="ident" id="3299031">StarExpr</span><span class="op" id="3299039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299043">return</span>&nbsp;<span class="ident" id="3299050">fieldName</span><span class="op" id="3299059">(</span><span class="ident" id="3299060">t</span><span class="op" id="3299061">.</span><span class="ident" id="3299062">X</span><span class="op" id="3299063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299066">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299069">return</span>&nbsp;<span class="ident" id="3299076">nil</span><br>
<span class="lineno"></span><span class="op" id="3299080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3299083">func</span>&nbsp;<span class="ident" id="3299088">filterFieldList</span><span class="op" id="3299103">(</span><span class="ident" id="3299104">fields</span>&nbsp;<span class="op" id="3299111">*</span><span class="ident" id="3299112">FieldList</span><span class="op" id="3299121">,</span>&nbsp;<span class="ident" id="3299123">filter</span>&nbsp;<span class="ident" id="3299130">Filter</span><span class="op" id="3299136">,</span>&nbsp;<span class="ident" id="3299138">export</span>&nbsp;<span class="builtintype" id="3299145">bool</span><span class="op" id="3299149">)</span>&nbsp;<span class="op" id="3299151">(</span><span class="ident" id="3299152">removedFields</span>&nbsp;<span class="builtintype" id="3299166">bool</span><span class="op" id="3299170">)</span>&nbsp;<span class="op" id="3299172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299175">if</span>&nbsp;<span class="ident" id="3299178">fields</span>&nbsp;<span class="op" id="3299185">==</span>&nbsp;<span class="ident" id="3299188">nil</span>&nbsp;<span class="op" id="3299192">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299196">return</span>&nbsp;<span class="builtintype" id="3299203">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299213">list</span>&nbsp;<span class="op" id="3299218">:=</span>&nbsp;<span class="ident" id="3299221">fields</span><span class="op" id="3299227">.</span><span class="ident" id="3299228">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299234">j</span>&nbsp;<span class="op" id="3299236">:=</span>&nbsp;<span class="num" id="3299239">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299242">for</span>&nbsp;<span class="ident" id="3299246">_</span><span class="op" id="3299247">,</span>&nbsp;<span class="ident" id="3299249">f</span>&nbsp;<span class="op" id="3299251">:=</span>&nbsp;<span class="keyword" id="3299254">range</span>&nbsp;<span class="ident" id="3299260">list</span>&nbsp;<span class="op" id="3299265">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299269">keepField</span>&nbsp;<span class="op" id="3299279">:=</span>&nbsp;<span class="builtintype" id="3299282">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299290">if</span>&nbsp;<span class="builtinfunc" id="3299293">len</span><span class="op" id="3299296">(</span><span class="ident" id="3299297">f</span><span class="op" id="3299298">.</span><span class="ident" id="3299299">Names</span><span class="op" id="3299304">)</span>&nbsp;<span class="op" id="3299306">==</span>&nbsp;<span class="num" id="3299309">0</span>&nbsp;<span class="op" id="3299311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3299316">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299338">name</span>&nbsp;<span class="op" id="3299343">:=</span>&nbsp;<span class="ident" id="3299346">fieldName</span><span class="op" id="3299355">(</span><span class="ident" id="3299356">f</span><span class="op" id="3299357">.</span><span class="ident" id="3299358">Type</span><span class="op" id="3299362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299367">keepField</span>&nbsp;<span class="op" id="3299377">=</span>&nbsp;<span class="ident" id="3299379">name</span>&nbsp;<span class="op" id="3299384">!=</span>&nbsp;<span class="ident" id="3299387">nil</span>&nbsp;<span class="op" id="3299391">&amp;&amp;</span>&nbsp;<span class="ident" id="3299394">filter</span><span class="op" id="3299400">(</span><span class="ident" id="3299401">name</span><span class="op" id="3299405">.</span><span class="ident" id="3299406">Name</span><span class="op" id="3299410">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299414">}</span>&nbsp;<span class="keyword" id="3299416">else</span>&nbsp;<span class="op" id="3299421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299426">n</span>&nbsp;<span class="op" id="3299428">:=</span>&nbsp;<span class="builtinfunc" id="3299431">len</span><span class="op" id="3299434">(</span><span class="ident" id="3299435">f</span><span class="op" id="3299436">.</span><span class="ident" id="3299437">Names</span><span class="op" id="3299442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299447">f</span><span class="op" id="3299448">.</span><span class="ident" id="3299449">Names</span>&nbsp;<span class="op" id="3299455">=</span>&nbsp;<span class="ident" id="3299457">filterIdentList</span><span class="op" id="3299472">(</span><span class="ident" id="3299473">f</span><span class="op" id="3299474">.</span><span class="ident" id="3299475">Names</span><span class="op" id="3299480">,</span>&nbsp;<span class="ident" id="3299482">filter</span><span class="op" id="3299488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299493">if</span>&nbsp;<span class="builtinfunc" id="3299496">len</span><span class="op" id="3299499">(</span><span class="ident" id="3299500">f</span><span class="op" id="3299501">.</span><span class="ident" id="3299502">Names</span><span class="op" id="3299507">)</span>&nbsp;<span class="op" id="3299509">&lt;</span>&nbsp;<span class="ident" id="3299511">n</span>&nbsp;<span class="op" id="3299513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299519">removedFields</span>&nbsp;<span class="op" id="3299533">=</span>&nbsp;<span class="builtintype" id="3299535">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299548">keepField</span>&nbsp;<span class="op" id="3299558">=</span>&nbsp;<span class="builtinfunc" id="3299560">len</span><span class="op" id="3299563">(</span><span class="ident" id="3299564">f</span><span class="op" id="3299565">.</span><span class="ident" id="3299566">Names</span><span class="op" id="3299571">)</span>&nbsp;<span class="op" id="3299573">&gt;</span>&nbsp;<span class="num" id="3299575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299583">if</span>&nbsp;<span class="ident" id="3299586">keepField</span>&nbsp;<span class="op" id="3299596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299601">if</span>&nbsp;<span class="ident" id="3299604">export</span>&nbsp;<span class="op" id="3299611">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299617">filterType</span><span class="op" id="3299627">(</span><span class="ident" id="3299628">f</span><span class="op" id="3299629">.</span><span class="ident" id="3299630">Type</span><span class="op" id="3299634">,</span>&nbsp;<span class="ident" id="3299636">filter</span><span class="op" id="3299642">,</span>&nbsp;<span class="ident" id="3299644">export</span><span class="op" id="3299650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299660">list</span><span class="op" id="3299664">[</span><span class="ident" id="3299665">j</span><span class="op" id="3299666">]</span>&nbsp;<span class="op" id="3299668">=</span>&nbsp;<span class="ident" id="3299670">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299675">j</span><span class="op" id="3299676">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299681">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299687">if</span>&nbsp;<span class="ident" id="3299690">j</span>&nbsp;<span class="op" id="3299692">&lt;</span>&nbsp;<span class="builtinfunc" id="3299694">len</span><span class="op" id="3299697">(</span><span class="ident" id="3299698">list</span><span class="op" id="3299702">)</span>&nbsp;<span class="op" id="3299704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299708">removedFields</span>&nbsp;<span class="op" id="3299722">=</span>&nbsp;<span class="builtintype" id="3299724">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299733">fields</span><span class="op" id="3299739">.</span><span class="ident" id="3299740">List</span>&nbsp;<span class="op" id="3299745">=</span>&nbsp;<span class="ident" id="3299747">list</span><span class="op" id="3299751">[</span><span class="num" id="3299752">0</span><span class="op" id="3299753">:</span><span class="ident" id="3299754">j</span><span class="op" id="3299755">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299758">return</span><br>
<span class="lineno"></span><span class="op" id="3299765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3299768">func</span>&nbsp;<span class="ident" id="3299773">filterParamList</span><span class="op" id="3299788">(</span><span class="ident" id="3299789">fields</span>&nbsp;<span class="op" id="3299796">*</span><span class="ident" id="3299797">FieldList</span><span class="op" id="3299806">,</span>&nbsp;<span class="ident" id="3299808">filter</span>&nbsp;<span class="ident" id="3299815">Filter</span><span class="op" id="3299821">,</span>&nbsp;<span class="ident" id="3299823">export</span>&nbsp;<span class="builtintype" id="3299830">bool</span><span class="op" id="3299834">)</span>&nbsp;<span class="builtintype" id="3299836">bool</span>&nbsp;<span class="op" id="3299841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299844">if</span>&nbsp;<span class="ident" id="3299847">fields</span>&nbsp;<span class="op" id="3299854">==</span>&nbsp;<span class="ident" id="3299857">nil</span>&nbsp;<span class="op" id="3299861">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299865">return</span>&nbsp;<span class="builtintype" id="3299872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299882">var</span>&nbsp;<span class="ident" id="3299886">b</span>&nbsp;<span class="builtintype" id="3299888">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299894">for</span>&nbsp;<span class="ident" id="3299898">_</span><span class="op" id="3299899">,</span>&nbsp;<span class="ident" id="3299901">f</span>&nbsp;<span class="op" id="3299903">:=</span>&nbsp;<span class="keyword" id="3299906">range</span>&nbsp;<span class="ident" id="3299912">fields</span><span class="op" id="3299918">.</span><span class="ident" id="3299919">List</span>&nbsp;<span class="op" id="3299924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299928">if</span>&nbsp;<span class="ident" id="3299931">filterType</span><span class="op" id="3299941">(</span><span class="ident" id="3299942">f</span><span class="op" id="3299943">.</span><span class="ident" id="3299944">Type</span><span class="op" id="3299948">,</span>&nbsp;<span class="ident" id="3299950">filter</span><span class="op" id="3299956">,</span>&nbsp;<span class="ident" id="3299958">export</span><span class="op" id="3299964">)</span>&nbsp;<span class="op" id="3299966">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299971">b</span>&nbsp;<span class="op" id="3299973">=</span>&nbsp;<span class="builtintype" id="3299975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299988">return</span>&nbsp;<span class="ident" id="3299995">b</span><br>
<span class="lineno"></span><span class="op" id="3299997">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3300000">func</span>&nbsp;<span class="ident" id="3300005">filterType</span><span class="op" id="3300015">(</span><span class="ident" id="3300016">typ</span>&nbsp;<span class="ident" id="3300020">Expr</span><span class="op" id="3300024">,</span>&nbsp;<span class="ident" id="3300026">f</span>&nbsp;<span class="ident" id="3300028">Filter</span><span class="op" id="3300034">,</span>&nbsp;<span class="ident" id="3300036">export</span>&nbsp;<span class="builtintype" id="3300043">bool</span><span class="op" id="3300047">)</span>&nbsp;<span class="builtintype" id="3300049">bool</span>&nbsp;<span class="op" id="3300054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300057">switch</span>&nbsp;<span class="ident" id="3300064">t</span>&nbsp;<span class="op" id="3300066">:=</span>&nbsp;<span class="ident" id="3300069">typ</span><span class="op" id="3300072">.</span><span class="op" id="3300073">(</span><span class="keyword" id="3300074">type</span><span class="op" id="3300078">)</span>&nbsp;<span class="op" id="3300080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300083">case</span>&nbsp;<span class="op" id="3300088">*</span><span class="ident" id="3300089">Ident</span><span class="op" id="3300094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300098">return</span>&nbsp;<span class="ident" id="3300105">f</span><span class="op" id="3300106">(</span><span class="ident" id="3300107">t</span><span class="op" id="3300108">.</span><span class="ident" id="3300109">Name</span><span class="op" id="3300113">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300116">case</span>&nbsp;<span class="op" id="3300121">*</span><span class="ident" id="3300122">ParenExpr</span><span class="op" id="3300131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300135">return</span>&nbsp;<span class="ident" id="3300142">filterType</span><span class="op" id="3300152">(</span><span class="ident" id="3300153">t</span><span class="op" id="3300154">.</span><span class="ident" id="3300155">X</span><span class="op" id="3300156">,</span>&nbsp;<span class="ident" id="3300158">f</span><span class="op" id="3300159">,</span>&nbsp;<span class="ident" id="3300161">export</span><span class="op" id="3300167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300170">case</span>&nbsp;<span class="op" id="3300175">*</span><span class="ident" id="3300176">ArrayType</span><span class="op" id="3300185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300189">return</span>&nbsp;<span class="ident" id="3300196">filterType</span><span class="op" id="3300206">(</span><span class="ident" id="3300207">t</span><span class="op" id="3300208">.</span><span class="ident" id="3300209">Elt</span><span class="op" id="3300212">,</span>&nbsp;<span class="ident" id="3300214">f</span><span class="op" id="3300215">,</span>&nbsp;<span class="ident" id="3300217">export</span><span class="op" id="3300223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300226">case</span>&nbsp;<span class="op" id="3300231">*</span><span class="ident" id="3300232">StructType</span><span class="op" id="3300242">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300246">if</span>&nbsp;<span class="ident" id="3300249">filterFieldList</span><span class="op" id="3300264">(</span><span class="ident" id="3300265">t</span><span class="op" id="3300266">.</span><span class="ident" id="3300267">Fields</span><span class="op" id="3300273">,</span>&nbsp;<span class="ident" id="3300275">f</span><span class="op" id="3300276">,</span>&nbsp;<span class="ident" id="3300278">export</span><span class="op" id="3300284">)</span>&nbsp;<span class="op" id="3300286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300291">t</span><span class="op" id="3300292">.</span><span class="ident" id="3300293">Incomplete</span>&nbsp;<span class="op" id="3300304">=</span>&nbsp;<span class="builtintype" id="3300306">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300317">return</span>&nbsp;<span class="builtinfunc" id="3300324">len</span><span class="op" id="3300327">(</span><span class="ident" id="3300328">t</span><span class="op" id="3300329">.</span><span class="ident" id="3300330">Fields</span><span class="op" id="3300336">.</span><span class="ident" id="3300337">List</span><span class="op" id="3300341">)</span>&nbsp;<span class="op" id="3300343">&gt;</span>&nbsp;<span class="num" id="3300345">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300348">case</span>&nbsp;<span class="op" id="3300353">*</span><span class="ident" id="3300354">FuncType</span><span class="op" id="3300362">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300366">b1</span>&nbsp;<span class="op" id="3300369">:=</span>&nbsp;<span class="ident" id="3300372">filterParamList</span><span class="op" id="3300387">(</span><span class="ident" id="3300388">t</span><span class="op" id="3300389">.</span><span class="ident" id="3300390">Params</span><span class="op" id="3300396">,</span>&nbsp;<span class="ident" id="3300398">f</span><span class="op" id="3300399">,</span>&nbsp;<span class="ident" id="3300401">export</span><span class="op" id="3300407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300411">b2</span>&nbsp;<span class="op" id="3300414">:=</span>&nbsp;<span class="ident" id="3300417">filterParamList</span><span class="op" id="3300432">(</span><span class="ident" id="3300433">t</span><span class="op" id="3300434">.</span><span class="ident" id="3300435">Results</span><span class="op" id="3300442">,</span>&nbsp;<span class="ident" id="3300444">f</span><span class="op" id="3300445">,</span>&nbsp;<span class="ident" id="3300447">export</span><span class="op" id="3300453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300457">return</span>&nbsp;<span class="ident" id="3300464">b1</span>&nbsp;<span class="op" id="3300467">||</span>&nbsp;<span class="ident" id="3300470">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300474">case</span>&nbsp;<span class="op" id="3300479">*</span><span class="ident" id="3300480">InterfaceType</span><span class="op" id="3300493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300497">if</span>&nbsp;<span class="ident" id="3300500">filterFieldList</span><span class="op" id="3300515">(</span><span class="ident" id="3300516">t</span><span class="op" id="3300517">.</span><span class="ident" id="3300518">Methods</span><span class="op" id="3300525">,</span>&nbsp;<span class="ident" id="3300527">f</span><span class="op" id="3300528">,</span>&nbsp;<span class="ident" id="3300530">export</span><span class="op" id="3300536">)</span>&nbsp;<span class="op" id="3300538">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300543">t</span><span class="op" id="3300544">.</span><span class="ident" id="3300545">Incomplete</span>&nbsp;<span class="op" id="3300556">=</span>&nbsp;<span class="builtintype" id="3300558">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300569">return</span>&nbsp;<span class="builtinfunc" id="3300576">len</span><span class="op" id="3300579">(</span><span class="ident" id="3300580">t</span><span class="op" id="3300581">.</span><span class="ident" id="3300582">Methods</span><span class="op" id="3300589">.</span><span class="ident" id="3300590">List</span><span class="op" id="3300594">)</span>&nbsp;<span class="op" id="3300596">&gt;</span>&nbsp;<span class="num" id="3300598">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300601">case</span>&nbsp;<span class="op" id="3300606">*</span><span class="ident" id="3300607">MapType</span><span class="op" id="3300614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300618">b1</span>&nbsp;<span class="op" id="3300621">:=</span>&nbsp;<span class="ident" id="3300624">filterType</span><span class="op" id="3300634">(</span><span class="ident" id="3300635">t</span><span class="op" id="3300636">.</span><span class="ident" id="3300637">Key</span><span class="op" id="3300640">,</span>&nbsp;<span class="ident" id="3300642">f</span><span class="op" id="3300643">,</span>&nbsp;<span class="ident" id="3300645">export</span><span class="op" id="3300651">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300655">b2</span>&nbsp;<span class="op" id="3300658">:=</span>&nbsp;<span class="ident" id="3300661">filterType</span><span class="op" id="3300671">(</span><span class="ident" id="3300672">t</span><span class="op" id="3300673">.</span><span class="ident" id="3300674">Value</span><span class="op" id="3300679">,</span>&nbsp;<span class="ident" id="3300681">f</span><span class="op" id="3300682">,</span>&nbsp;<span class="ident" id="3300684">export</span><span class="op" id="3300690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300694">return</span>&nbsp;<span class="ident" id="3300701">b1</span>&nbsp;<span class="op" id="3300704">||</span>&nbsp;<span class="ident" id="3300707">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300711">case</span>&nbsp;<span class="op" id="3300716">*</span><span class="ident" id="3300717">ChanType</span><span class="op" id="3300725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300729">return</span>&nbsp;<span class="ident" id="3300736">filterType</span><span class="op" id="3300746">(</span><span class="ident" id="3300747">t</span><span class="op" id="3300748">.</span><span class="ident" id="3300749">Value</span><span class="op" id="3300754">,</span>&nbsp;<span class="ident" id="3300756">f</span><span class="op" id="3300757">,</span>&nbsp;<span class="ident" id="3300759">export</span><span class="op" id="3300765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300768">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300771">return</span>&nbsp;<span class="builtintype" id="3300778">false</span><br>
<span class="lineno"></span><span class="op" id="3300784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3300787">func</span>&nbsp;<span class="ident" id="3300792">filterSpec</span><span class="op" id="3300802">(</span><span class="ident" id="3300803">spec</span>&nbsp;<span class="ident" id="3300808">Spec</span><span class="op" id="3300812">,</span>&nbsp;<span class="ident" id="3300814">f</span>&nbsp;<span class="ident" id="3300816">Filter</span><span class="op" id="3300822">,</span>&nbsp;<span class="ident" id="3300824">export</span>&nbsp;<span class="builtintype" id="3300831">bool</span><span class="op" id="3300835">)</span>&nbsp;<span class="builtintype" id="3300837">bool</span>&nbsp;<span class="op" id="3300842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300845">switch</span>&nbsp;<span class="ident" id="3300852">s</span>&nbsp;<span class="op" id="3300854">:=</span>&nbsp;<span class="ident" id="3300857">spec</span><span class="op" id="3300861">.</span><span class="op" id="3300862">(</span><span class="keyword" id="3300863">type</span><span class="op" id="3300867">)</span>&nbsp;<span class="op" id="3300869">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300872">case</span>&nbsp;<span class="op" id="3300877">*</span><span class="ident" id="3300878">ValueSpec</span><span class="op" id="3300887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300891">s</span><span class="op" id="3300892">.</span><span class="ident" id="3300893">Names</span>&nbsp;<span class="op" id="3300899">=</span>&nbsp;<span class="ident" id="3300901">filterIdentList</span><span class="op" id="3300916">(</span><span class="ident" id="3300917">s</span><span class="op" id="3300918">.</span><span class="ident" id="3300919">Names</span><span class="op" id="3300924">,</span>&nbsp;<span class="ident" id="3300926">f</span><span class="op" id="3300927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300931">if</span>&nbsp;<span class="builtinfunc" id="3300934">len</span><span class="op" id="3300937">(</span><span class="ident" id="3300938">s</span><span class="op" id="3300939">.</span><span class="ident" id="3300940">Names</span><span class="op" id="3300945">)</span>&nbsp;<span class="op" id="3300947">&gt;</span>&nbsp;<span class="num" id="3300949">0</span>&nbsp;<span class="op" id="3300951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300956">if</span>&nbsp;<span class="ident" id="3300959">export</span>&nbsp;<span class="op" id="3300966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300972">filterType</span><span class="op" id="3300982">(</span><span class="ident" id="3300983">s</span><span class="op" id="3300984">.</span><span class="ident" id="3300985">Type</span><span class="op" id="3300989">,</span>&nbsp;<span class="ident" id="3300991">f</span><span class="op" id="3300992">,</span>&nbsp;<span class="ident" id="3300994">export</span><span class="op" id="3301000">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301010">return</span>&nbsp;<span class="builtintype" id="3301017">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301027">case</span>&nbsp;<span class="op" id="3301032">*</span><span class="ident" id="3301033">TypeSpec</span><span class="op" id="3301041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301045">if</span>&nbsp;<span class="ident" id="3301048">f</span><span class="op" id="3301049">(</span><span class="ident" id="3301050">s</span><span class="op" id="3301051">.</span><span class="ident" id="3301052">Name</span><span class="op" id="3301056">.</span><span class="ident" id="3301057">Name</span><span class="op" id="3301061">)</span>&nbsp;<span class="op" id="3301063">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301068">if</span>&nbsp;<span class="ident" id="3301071">export</span>&nbsp;<span class="op" id="3301078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301084">filterType</span><span class="op" id="3301094">(</span><span class="ident" id="3301095">s</span><span class="op" id="3301096">.</span><span class="ident" id="3301097">Type</span><span class="op" id="3301101">,</span>&nbsp;<span class="ident" id="3301103">f</span><span class="op" id="3301104">,</span>&nbsp;<span class="ident" id="3301106">export</span><span class="op" id="3301112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301122">return</span>&nbsp;<span class="builtintype" id="3301129">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301136">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301140">if</span>&nbsp;<span class="op" id="3301143">!</span><span class="ident" id="3301144">export</span>&nbsp;<span class="op" id="3301151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301156">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301204">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301251">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301262">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301308">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301336">return</span>&nbsp;<span class="ident" id="3301343">filterType</span><span class="op" id="3301353">(</span><span class="ident" id="3301354">s</span><span class="op" id="3301355">.</span><span class="ident" id="3301356">Type</span><span class="op" id="3301360">,</span>&nbsp;<span class="ident" id="3301362">f</span><span class="op" id="3301363">,</span>&nbsp;<span class="ident" id="3301365">export</span><span class="op" id="3301371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301381">return</span>&nbsp;<span class="builtintype" id="3301388">false</span><br>
<span class="lineno">185</span><span class="op" id="3301394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3301397">func</span>&nbsp;<span class="ident" id="3301402">filterSpecList</span><span class="op" id="3301416">(</span><span class="ident" id="3301417">list</span>&nbsp;<span class="op" id="3301422">[</span><span class="op" id="3301423">]</span><span class="ident" id="3301424">Spec</span><span class="op" id="3301428">,</span>&nbsp;<span class="ident" id="3301430">f</span>&nbsp;<span class="ident" id="3301432">Filter</span><span class="op" id="3301438">,</span>&nbsp;<span class="ident" id="3301440">export</span>&nbsp;<span class="builtintype" id="3301447">bool</span><span class="op" id="3301451">)</span>&nbsp;<span class="op" id="3301453">[</span><span class="op" id="3301454">]</span><span class="ident" id="3301455">Spec</span>&nbsp;<span class="op" id="3301460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301463">j</span>&nbsp;<span class="op" id="3301465">:=</span>&nbsp;<span class="num" id="3301468">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301471">for</span>&nbsp;<span class="ident" id="3301475">_</span><span class="op" id="3301476">,</span>&nbsp;<span class="ident" id="3301478">s</span>&nbsp;<span class="op" id="3301480">:=</span>&nbsp;<span class="keyword" id="3301483">range</span>&nbsp;<span class="ident" id="3301489">list</span>&nbsp;<span class="op" id="3301494">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301498">if</span>&nbsp;<span class="ident" id="3301501">filterSpec</span><span class="op" id="3301511">(</span><span class="ident" id="3301512">s</span><span class="op" id="3301513">,</span>&nbsp;<span class="ident" id="3301515">f</span><span class="op" id="3301516">,</span>&nbsp;<span class="ident" id="3301518">export</span><span class="op" id="3301524">)</span>&nbsp;<span class="op" id="3301526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301531">list</span><span class="op" id="3301535">[</span><span class="ident" id="3301536">j</span><span class="op" id="3301537">]</span>&nbsp;<span class="op" id="3301539">=</span>&nbsp;<span class="ident" id="3301541">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301546">j</span><span class="op" id="3301547">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301555">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301558">return</span>&nbsp;<span class="ident" id="3301565">list</span><span class="op" id="3301569">[</span><span class="num" id="3301570">0</span><span class="op" id="3301571">:</span><span class="ident" id="3301572">j</span><span class="op" id="3301573">]</span><br>
<span class="lineno"></span><span class="op" id="3301575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3301578">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="3301648">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="3301717">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="3301784">//</span><br>
<span class="lineno"></span><span class="comment" id="3301787">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="3301857">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3301899">//</span><br>
<span class="lineno">205</span><span class="keyword" id="3301902">func</span>&nbsp;<span class="ident" id="3301907">FilterDecl</span><span class="op" id="3301917">(</span><span class="ident" id="3301918">decl</span>&nbsp;<span class="ident" id="3301923">Decl</span><span class="op" id="3301927">,</span>&nbsp;<span class="ident" id="3301929">f</span>&nbsp;<span class="ident" id="3301931">Filter</span><span class="op" id="3301937">)</span>&nbsp;<span class="builtintype" id="3301939">bool</span>&nbsp;<span class="op" id="3301944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301947">return</span>&nbsp;<span class="ident" id="3301954">filterDecl</span><span class="op" id="3301964">(</span><span class="ident" id="3301965">decl</span><span class="op" id="3301969">,</span>&nbsp;<span class="ident" id="3301971">f</span><span class="op" id="3301972">,</span>&nbsp;<span class="builtintype" id="3301974">false</span><span class="op" id="3301979">)</span><br>
<span class="lineno"></span><span class="op" id="3301981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3301984">func</span>&nbsp;<span class="ident" id="3301989">filterDecl</span><span class="op" id="3301999">(</span><span class="ident" id="3302000">decl</span>&nbsp;<span class="ident" id="3302005">Decl</span><span class="op" id="3302009">,</span>&nbsp;<span class="ident" id="3302011">f</span>&nbsp;<span class="ident" id="3302013">Filter</span><span class="op" id="3302019">,</span>&nbsp;<span class="ident" id="3302021">export</span>&nbsp;<span class="builtintype" id="3302028">bool</span><span class="op" id="3302032">)</span>&nbsp;<span class="builtintype" id="3302034">bool</span>&nbsp;<span class="op" id="3302039">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302042">switch</span>&nbsp;<span class="ident" id="3302049">d</span>&nbsp;<span class="op" id="3302051">:=</span>&nbsp;<span class="ident" id="3302054">decl</span><span class="op" id="3302058">.</span><span class="op" id="3302059">(</span><span class="keyword" id="3302060">type</span><span class="op" id="3302064">)</span>&nbsp;<span class="op" id="3302066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302069">case</span>&nbsp;<span class="op" id="3302074">*</span><span class="ident" id="3302075">GenDecl</span><span class="op" id="3302082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302086">d</span><span class="op" id="3302087">.</span><span class="ident" id="3302088">Specs</span>&nbsp;<span class="op" id="3302094">=</span>&nbsp;<span class="ident" id="3302096">filterSpecList</span><span class="op" id="3302110">(</span><span class="ident" id="3302111">d</span><span class="op" id="3302112">.</span><span class="ident" id="3302113">Specs</span><span class="op" id="3302118">,</span>&nbsp;<span class="ident" id="3302120">f</span><span class="op" id="3302121">,</span>&nbsp;<span class="ident" id="3302123">export</span><span class="op" id="3302129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302133">return</span>&nbsp;<span class="builtinfunc" id="3302140">len</span><span class="op" id="3302143">(</span><span class="ident" id="3302144">d</span><span class="op" id="3302145">.</span><span class="ident" id="3302146">Specs</span><span class="op" id="3302151">)</span>&nbsp;<span class="op" id="3302153">&gt;</span>&nbsp;<span class="num" id="3302155">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302158">case</span>&nbsp;<span class="op" id="3302163">*</span><span class="ident" id="3302164">FuncDecl</span><span class="op" id="3302172">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302176">return</span>&nbsp;<span class="ident" id="3302183">f</span><span class="op" id="3302184">(</span><span class="ident" id="3302185">d</span><span class="op" id="3302186">.</span><span class="ident" id="3302187">Name</span><span class="op" id="3302191">.</span><span class="ident" id="3302192">Name</span><span class="op" id="3302196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302202">return</span>&nbsp;<span class="builtintype" id="3302209">false</span><br>
<span class="lineno"></span><span class="op" id="3302215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3302218">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3302285">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3302350">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3302418">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="3302488">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="3302555">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="3302574">//</span><br>
<span class="lineno"></span><span class="comment" id="3302577">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="3302644">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3302697">//</span><br>
<span class="lineno">230</span><span class="keyword" id="3302700">func</span>&nbsp;<span class="ident" id="3302705">FilterFile</span><span class="op" id="3302715">(</span><span class="ident" id="3302716">src</span>&nbsp;<span class="op" id="3302720">*</span><span class="ident" id="3302721">File</span><span class="op" id="3302725">,</span>&nbsp;<span class="ident" id="3302727">f</span>&nbsp;<span class="ident" id="3302729">Filter</span><span class="op" id="3302735">)</span>&nbsp;<span class="builtintype" id="3302737">bool</span>&nbsp;<span class="op" id="3302742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302745">return</span>&nbsp;<span class="ident" id="3302752">filterFile</span><span class="op" id="3302762">(</span><span class="ident" id="3302763">src</span><span class="op" id="3302766">,</span>&nbsp;<span class="ident" id="3302768">f</span><span class="op" id="3302769">,</span>&nbsp;<span class="builtintype" id="3302771">false</span><span class="op" id="3302776">)</span><br>
<span class="lineno"></span><span class="op" id="3302778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3302781">func</span>&nbsp;<span class="ident" id="3302786">filterFile</span><span class="op" id="3302796">(</span><span class="ident" id="3302797">src</span>&nbsp;<span class="op" id="3302801">*</span><span class="ident" id="3302802">File</span><span class="op" id="3302806">,</span>&nbsp;<span class="ident" id="3302808">f</span>&nbsp;<span class="ident" id="3302810">Filter</span><span class="op" id="3302816">,</span>&nbsp;<span class="ident" id="3302818">export</span>&nbsp;<span class="builtintype" id="3302825">bool</span><span class="op" id="3302829">)</span>&nbsp;<span class="builtintype" id="3302831">bool</span>&nbsp;<span class="op" id="3302836">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302839">j</span>&nbsp;<span class="op" id="3302841">:=</span>&nbsp;<span class="num" id="3302844">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302847">for</span>&nbsp;<span class="ident" id="3302851">_</span><span class="op" id="3302852">,</span>&nbsp;<span class="ident" id="3302854">d</span>&nbsp;<span class="op" id="3302856">:=</span>&nbsp;<span class="keyword" id="3302859">range</span>&nbsp;<span class="ident" id="3302865">src</span><span class="op" id="3302868">.</span><span class="ident" id="3302869">Decls</span>&nbsp;<span class="op" id="3302875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302879">if</span>&nbsp;<span class="ident" id="3302882">filterDecl</span><span class="op" id="3302892">(</span><span class="ident" id="3302893">d</span><span class="op" id="3302894">,</span>&nbsp;<span class="ident" id="3302896">f</span><span class="op" id="3302897">,</span>&nbsp;<span class="ident" id="3302899">export</span><span class="op" id="3302905">)</span>&nbsp;<span class="op" id="3302907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302912">src</span><span class="op" id="3302915">.</span><span class="ident" id="3302916">Decls</span><span class="op" id="3302921">[</span><span class="ident" id="3302922">j</span><span class="op" id="3302923">]</span>&nbsp;<span class="op" id="3302925">=</span>&nbsp;<span class="ident" id="3302927">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302932">j</span><span class="op" id="3302933">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302944">src</span><span class="op" id="3302947">.</span><span class="ident" id="3302948">Decls</span>&nbsp;<span class="op" id="3302954">=</span>&nbsp;<span class="ident" id="3302956">src</span><span class="op" id="3302959">.</span><span class="ident" id="3302960">Decls</span><span class="op" id="3302965">[</span><span class="num" id="3302966">0</span><span class="op" id="3302967">:</span><span class="ident" id="3302968">j</span><span class="op" id="3302969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302972">return</span>&nbsp;<span class="ident" id="3302979">j</span>&nbsp;<span class="op" id="3302981">&gt;</span>&nbsp;<span class="num" id="3302983">0</span><br>
<span class="lineno"></span><span class="op" id="3302985">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="3302988">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="3303057">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3303126">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3303194">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="3303264">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3303334">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="3303406">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="3303415">//</span><br>
<span class="lineno"></span><span class="comment" id="3303418">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="3303488">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3303541">//</span><br>
<span class="lineno"></span><span class="keyword" id="3303544">func</span>&nbsp;<span class="ident" id="3303549">FilterPackage</span><span class="op" id="3303562">(</span><span class="ident" id="3303563">pkg</span>&nbsp;<span class="op" id="3303567">*</span><span class="ident" id="3303568">Package</span><span class="op" id="3303575">,</span>&nbsp;<span class="ident" id="3303577">f</span>&nbsp;<span class="ident" id="3303579">Filter</span><span class="op" id="3303585">)</span>&nbsp;<span class="builtintype" id="3303587">bool</span>&nbsp;<span class="op" id="3303592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303595">return</span>&nbsp;<span class="ident" id="3303602">filterPackage</span><span class="op" id="3303615">(</span><span class="ident" id="3303616">pkg</span><span class="op" id="3303619">,</span>&nbsp;<span class="ident" id="3303621">f</span><span class="op" id="3303622">,</span>&nbsp;<span class="builtintype" id="3303624">false</span><span class="op" id="3303629">)</span><br>
<span class="lineno"></span><span class="op" id="3303631">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="3303634">func</span>&nbsp;<span class="ident" id="3303639">filterPackage</span><span class="op" id="3303652">(</span><span class="ident" id="3303653">pkg</span>&nbsp;<span class="op" id="3303657">*</span><span class="ident" id="3303658">Package</span><span class="op" id="3303665">,</span>&nbsp;<span class="ident" id="3303667">f</span>&nbsp;<span class="ident" id="3303669">Filter</span><span class="op" id="3303675">,</span>&nbsp;<span class="ident" id="3303677">export</span>&nbsp;<span class="builtintype" id="3303684">bool</span><span class="op" id="3303688">)</span>&nbsp;<span class="builtintype" id="3303690">bool</span>&nbsp;<span class="op" id="3303695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303698">hasDecls</span>&nbsp;<span class="op" id="3303707">:=</span>&nbsp;<span class="builtintype" id="3303710">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303717">for</span>&nbsp;<span class="ident" id="3303721">_</span><span class="op" id="3303722">,</span>&nbsp;<span class="ident" id="3303724">src</span>&nbsp;<span class="op" id="3303728">:=</span>&nbsp;<span class="keyword" id="3303731">range</span>&nbsp;<span class="ident" id="3303737">pkg</span><span class="op" id="3303740">.</span><span class="ident" id="3303741">Files</span>&nbsp;<span class="op" id="3303747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303751">if</span>&nbsp;<span class="ident" id="3303754">filterFile</span><span class="op" id="3303764">(</span><span class="ident" id="3303765">src</span><span class="op" id="3303768">,</span>&nbsp;<span class="ident" id="3303770">f</span><span class="op" id="3303771">,</span>&nbsp;<span class="ident" id="3303773">export</span><span class="op" id="3303779">)</span>&nbsp;<span class="op" id="3303781">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303786">hasDecls</span>&nbsp;<span class="op" id="3303795">=</span>&nbsp;<span class="builtintype" id="3303797">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303810">return</span>&nbsp;<span class="ident" id="3303817">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="3303826">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="3303829">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3303909">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3303938">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="3304004">type</span>&nbsp;<span class="ident" id="3304009">MergeMode</span>&nbsp;<span class="builtintype" id="3304019">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304025">const</span>&nbsp;<span class="op" id="3304031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304034">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304092">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="3304113">MergeMode</span>&nbsp;<span class="op" id="3304123">=</span>&nbsp;<span class="num" id="3304125">1</span>&nbsp;<span class="op" id="3304127">&lt;&lt;</span>&nbsp;<span class="ident" id="3304130">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304136">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304197">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304244">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304272">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304328">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="3304351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3304354">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3304420">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3304487">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="3304531">//</span><br>
<span class="lineno"></span><span class="keyword" id="3304534">func</span>&nbsp;<span class="ident" id="3304539">nameOf</span><span class="op" id="3304545">(</span><span class="ident" id="3304546">f</span>&nbsp;<span class="op" id="3304548">*</span><span class="ident" id="3304549">FuncDecl</span><span class="op" id="3304557">)</span>&nbsp;<span class="builtintype" id="3304559">string</span>&nbsp;<span class="op" id="3304566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304569">if</span>&nbsp;<span class="ident" id="3304572">r</span>&nbsp;<span class="op" id="3304574">:=</span>&nbsp;<span class="ident" id="3304577">f</span><span class="op" id="3304578">.</span><span class="ident" id="3304579">Recv</span><span class="op" id="3304583">;</span>&nbsp;<span class="ident" id="3304585">r</span>&nbsp;<span class="op" id="3304587">!=</span>&nbsp;<span class="ident" id="3304590">nil</span>&nbsp;<span class="op" id="3304594">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3304597">len</span><span class="op" id="3304600">(</span><span class="ident" id="3304601">r</span><span class="op" id="3304602">.</span><span class="ident" id="3304603">List</span><span class="op" id="3304607">)</span>&nbsp;<span class="op" id="3304609">==</span>&nbsp;<span class="num" id="3304612">1</span>&nbsp;<span class="op" id="3304614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304618">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304665">t</span>&nbsp;<span class="op" id="3304667">:=</span>&nbsp;<span class="ident" id="3304670">r</span><span class="op" id="3304671">.</span><span class="ident" id="3304672">List</span><span class="op" id="3304676">[</span><span class="num" id="3304677">0</span><span class="op" id="3304678">]</span><span class="op" id="3304679">.</span><span class="ident" id="3304680">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304687">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304727">if</span>&nbsp;<span class="ident" id="3304730">p</span><span class="op" id="3304731">,</span>&nbsp;<span class="ident" id="3304733">_</span>&nbsp;<span class="op" id="3304735">:=</span>&nbsp;<span class="ident" id="3304738">t</span><span class="op" id="3304739">.</span><span class="op" id="3304740">(</span><span class="op" id="3304741">*</span><span class="ident" id="3304742">StarExpr</span><span class="op" id="3304750">)</span><span class="op" id="3304751">;</span>&nbsp;<span class="ident" id="3304753">p</span>&nbsp;<span class="op" id="3304755">!=</span>&nbsp;<span class="ident" id="3304758">nil</span>&nbsp;<span class="op" id="3304762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304767">t</span>&nbsp;<span class="op" id="3304769">=</span>&nbsp;<span class="ident" id="3304771">p</span><span class="op" id="3304772">.</span><span class="ident" id="3304773">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304781">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304824">if</span>&nbsp;<span class="ident" id="3304827">p</span><span class="op" id="3304828">,</span>&nbsp;<span class="ident" id="3304830">_</span>&nbsp;<span class="op" id="3304832">:=</span>&nbsp;<span class="ident" id="3304835">t</span><span class="op" id="3304836">.</span><span class="op" id="3304837">(</span><span class="op" id="3304838">*</span><span class="ident" id="3304839">Ident</span><span class="op" id="3304844">)</span><span class="op" id="3304845">;</span>&nbsp;<span class="ident" id="3304847">p</span>&nbsp;<span class="op" id="3304849">!=</span>&nbsp;<span class="ident" id="3304852">nil</span>&nbsp;<span class="op" id="3304856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304861">return</span>&nbsp;<span class="ident" id="3304868">p</span><span class="op" id="3304869">.</span><span class="ident" id="3304870">Name</span>&nbsp;<span class="op" id="3304875">+</span>&nbsp;<span class="string" id="3304877">&#34;.&#34;</span>&nbsp;<span class="op" id="3304881">+</span>&nbsp;<span class="ident" id="3304883">f</span><span class="op" id="3304884">.</span><span class="ident" id="3304885">Name</span><span class="op" id="3304889">.</span><span class="ident" id="3304890">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304901">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304941">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304944">return</span>&nbsp;<span class="ident" id="3304951">f</span><span class="op" id="3304952">.</span><span class="ident" id="3304953">Name</span><span class="op" id="3304957">.</span><span class="ident" id="3304958">Name</span><br>
<span class="lineno"></span><span class="op" id="3304963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3304966">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="3305037">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="3305112">//</span><br>
<span class="lineno"></span><span class="keyword" id="3305115">var</span>&nbsp;<span class="ident" id="3305119">separator</span>&nbsp;<span class="op" id="3305129">=</span>&nbsp;<span class="op" id="3305131">&amp;</span><span class="ident" id="3305132">Comment</span><span class="op" id="3305139">{</span><span class="ident" id="3305140">token</span><span class="op" id="3305145">.</span><span class="ident" id="3305146">NoPos</span><span class="op" id="3305151">,</span>&nbsp;<span class="string" id="3305153">&#34;//&#34;</span><span class="op" id="3305157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3305160">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3305227">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="3305301">//</span><br>
<span class="lineno"></span><span class="keyword" id="3305304">func</span>&nbsp;<span class="ident" id="3305309">MergePackageFiles</span><span class="op" id="3305326">(</span><span class="ident" id="3305327">pkg</span>&nbsp;<span class="op" id="3305331">*</span><span class="ident" id="3305332">Package</span><span class="op" id="3305339">,</span>&nbsp;<span class="ident" id="3305341">mode</span>&nbsp;<span class="ident" id="3305346">MergeMode</span><span class="op" id="3305355">)</span>&nbsp;<span class="op" id="3305357">*</span><span class="ident" id="3305358">File</span>&nbsp;<span class="op" id="3305363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305366">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305437">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305508">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305572">ndocs</span>&nbsp;<span class="op" id="3305578">:=</span>&nbsp;<span class="num" id="3305581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305584">ncomments</span>&nbsp;<span class="op" id="3305594">:=</span>&nbsp;<span class="num" id="3305597">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305600">ndecls</span>&nbsp;<span class="op" id="3305607">:=</span>&nbsp;<span class="num" id="3305610">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305613">filenames</span>&nbsp;<span class="op" id="3305623">:=</span>&nbsp;<span class="builtinfunc" id="3305626">make</span><span class="op" id="3305630">(</span><span class="op" id="3305631">[</span><span class="op" id="3305632">]</span><span class="builtintype" id="3305633">string</span><span class="op" id="3305639">,</span>&nbsp;<span class="builtinfunc" id="3305641">len</span><span class="op" id="3305644">(</span><span class="ident" id="3305645">pkg</span><span class="op" id="3305648">.</span><span class="ident" id="3305649">Files</span><span class="op" id="3305654">)</span><span class="op" id="3305655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305658">i</span>&nbsp;<span class="op" id="3305660">:=</span>&nbsp;<span class="num" id="3305663">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305666">for</span>&nbsp;<span class="ident" id="3305670">filename</span><span class="op" id="3305678">,</span>&nbsp;<span class="ident" id="3305680">f</span>&nbsp;<span class="op" id="3305682">:=</span>&nbsp;<span class="keyword" id="3305685">range</span>&nbsp;<span class="ident" id="3305691">pkg</span><span class="op" id="3305694">.</span><span class="ident" id="3305695">Files</span>&nbsp;<span class="op" id="3305701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305705">filenames</span><span class="op" id="3305714">[</span><span class="ident" id="3305715">i</span><span class="op" id="3305716">]</span>&nbsp;<span class="op" id="3305718">=</span>&nbsp;<span class="ident" id="3305720">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305731">i</span><span class="op" id="3305732">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3305737">if</span>&nbsp;<span class="ident" id="3305740">f</span><span class="op" id="3305741">.</span><span class="ident" id="3305742">Doc</span>&nbsp;<span class="op" id="3305746">!=</span>&nbsp;<span class="ident" id="3305749">nil</span>&nbsp;<span class="op" id="3305753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305758">ndocs</span>&nbsp;<span class="op" id="3305764">+=</span>&nbsp;<span class="builtinfunc" id="3305767">len</span><span class="op" id="3305770">(</span><span class="ident" id="3305771">f</span><span class="op" id="3305772">.</span><span class="ident" id="3305773">Doc</span><span class="op" id="3305776">.</span><span class="ident" id="3305777">List</span><span class="op" id="3305781">)</span>&nbsp;<span class="op" id="3305783">+</span>&nbsp;<span class="num" id="3305785">1</span>&nbsp;<span class="comment" id="3305787">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3305809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305813">ncomments</span>&nbsp;<span class="op" id="3305823">+=</span>&nbsp;<span class="builtinfunc" id="3305826">len</span><span class="op" id="3305829">(</span><span class="ident" id="3305830">f</span><span class="op" id="3305831">.</span><span class="ident" id="3305832">Comments</span><span class="op" id="3305840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305844">ndecls</span>&nbsp;<span class="op" id="3305851">+=</span>&nbsp;<span class="builtinfunc" id="3305854">len</span><span class="op" id="3305857">(</span><span class="ident" id="3305858">f</span><span class="op" id="3305859">.</span><span class="ident" id="3305860">Decls</span><span class="op" id="3305865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3305868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3305871">sort</span><span class="op" id="3305875">.</span><span class="ident" id="3305876">Strings</span><span class="op" id="3305883">(</span><span class="ident" id="3305884">filenames</span><span class="op" id="3305893">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305897">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3305963">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306030">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306097">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306163">var</span>&nbsp;<span class="ident" id="3306167">doc</span>&nbsp;<span class="op" id="3306171">*</span><span class="ident" id="3306172">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306186">var</span>&nbsp;<span class="ident" id="3306190">pos</span>&nbsp;<span class="ident" id="3306194">token</span><span class="op" id="3306199">.</span><span class="ident" id="3306200">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306205">if</span>&nbsp;<span class="ident" id="3306208">ndocs</span>&nbsp;<span class="op" id="3306214">&gt;</span>&nbsp;<span class="num" id="3306216">0</span>&nbsp;<span class="op" id="3306218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306222">list</span>&nbsp;<span class="op" id="3306227">:=</span>&nbsp;<span class="builtinfunc" id="3306230">make</span><span class="op" id="3306234">(</span><span class="op" id="3306235">[</span><span class="op" id="3306236">]</span><span class="op" id="3306237">*</span><span class="ident" id="3306238">Comment</span><span class="op" id="3306245">,</span>&nbsp;<span class="ident" id="3306247">ndocs</span><span class="op" id="3306252">-</span><span class="num" id="3306253">1</span><span class="op" id="3306254">)</span>&nbsp;<span class="comment" id="3306256">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306297">i</span>&nbsp;<span class="op" id="3306299">:=</span>&nbsp;<span class="num" id="3306302">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306306">for</span>&nbsp;<span class="ident" id="3306310">_</span><span class="op" id="3306311">,</span>&nbsp;<span class="ident" id="3306313">filename</span>&nbsp;<span class="op" id="3306322">:=</span>&nbsp;<span class="keyword" id="3306325">range</span>&nbsp;<span class="ident" id="3306331">filenames</span>&nbsp;<span class="op" id="3306341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306346">f</span>&nbsp;<span class="op" id="3306348">:=</span>&nbsp;<span class="ident" id="3306351">pkg</span><span class="op" id="3306354">.</span><span class="ident" id="3306355">Files</span><span class="op" id="3306360">[</span><span class="ident" id="3306361">filename</span><span class="op" id="3306369">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306374">if</span>&nbsp;<span class="ident" id="3306377">f</span><span class="op" id="3306378">.</span><span class="ident" id="3306379">Doc</span>&nbsp;<span class="op" id="3306383">!=</span>&nbsp;<span class="ident" id="3306386">nil</span>&nbsp;<span class="op" id="3306390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306396">if</span>&nbsp;<span class="ident" id="3306399">i</span>&nbsp;<span class="op" id="3306401">&gt;</span>&nbsp;<span class="num" id="3306403">0</span>&nbsp;<span class="op" id="3306405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306412">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306456">list</span><span class="op" id="3306460">[</span><span class="ident" id="3306461">i</span><span class="op" id="3306462">]</span>&nbsp;<span class="op" id="3306464">=</span>&nbsp;<span class="ident" id="3306466">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306481">i</span><span class="op" id="3306482">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306495">for</span>&nbsp;<span class="ident" id="3306499">_</span><span class="op" id="3306500">,</span>&nbsp;<span class="ident" id="3306502">c</span>&nbsp;<span class="op" id="3306504">:=</span>&nbsp;<span class="keyword" id="3306507">range</span>&nbsp;<span class="ident" id="3306513">f</span><span class="op" id="3306514">.</span><span class="ident" id="3306515">Doc</span><span class="op" id="3306518">.</span><span class="ident" id="3306519">List</span>&nbsp;<span class="op" id="3306524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306531">list</span><span class="op" id="3306535">[</span><span class="ident" id="3306536">i</span><span class="op" id="3306537">]</span>&nbsp;<span class="op" id="3306539">=</span>&nbsp;<span class="ident" id="3306541">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306548">i</span><span class="op" id="3306549">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306562">if</span>&nbsp;<span class="ident" id="3306565">f</span><span class="op" id="3306566">.</span><span class="ident" id="3306567">Package</span>&nbsp;<span class="op" id="3306575">&gt;</span>&nbsp;<span class="ident" id="3306577">pos</span>&nbsp;<span class="op" id="3306581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306588">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306640">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306694">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306709">pos</span>&nbsp;<span class="op" id="3306713">=</span>&nbsp;<span class="ident" id="3306715">f</span><span class="op" id="3306716">.</span><span class="ident" id="3306717">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306738">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306742">doc</span>&nbsp;<span class="op" id="3306746">=</span>&nbsp;<span class="op" id="3306748">&amp;</span><span class="ident" id="3306749">CommentGroup</span><span class="op" id="3306761">{</span><span class="ident" id="3306762">list</span><span class="op" id="3306766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3306769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306773">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306822">var</span>&nbsp;<span class="ident" id="3306826">decls</span>&nbsp;<span class="op" id="3306832">[</span><span class="op" id="3306833">]</span><span class="ident" id="3306834">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3306840">if</span>&nbsp;<span class="ident" id="3306843">ndecls</span>&nbsp;<span class="op" id="3306850">&gt;</span>&nbsp;<span class="num" id="3306852">0</span>&nbsp;<span class="op" id="3306854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306858">decls</span>&nbsp;<span class="op" id="3306864">=</span>&nbsp;<span class="builtinfunc" id="3306866">make</span><span class="op" id="3306870">(</span><span class="op" id="3306871">[</span><span class="op" id="3306872">]</span><span class="ident" id="3306873">Decl</span><span class="op" id="3306877">,</span>&nbsp;<span class="ident" id="3306879">ndecls</span><span class="op" id="3306885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306889">funcs</span>&nbsp;<span class="op" id="3306895">:=</span>&nbsp;<span class="builtinfunc" id="3306898">make</span><span class="op" id="3306902">(</span><span class="keyword" id="3306903">map</span><span class="op" id="3306906">[</span><span class="builtintype" id="3306907">string</span><span class="op" id="3306913">]</span><span class="builtintype" id="3306914">int</span><span class="op" id="3306917">)</span>&nbsp;<span class="comment" id="3306919">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3306956">i</span>&nbsp;<span class="op" id="3306958">:=</span>&nbsp;<span class="num" id="3306961">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3306986">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307005">n</span>&nbsp;<span class="op" id="3307007">:=</span>&nbsp;<span class="num" id="3307010">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307035">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307067">for</span>&nbsp;<span class="ident" id="3307071">_</span><span class="op" id="3307072">,</span>&nbsp;<span class="ident" id="3307074">filename</span>&nbsp;<span class="op" id="3307083">:=</span>&nbsp;<span class="keyword" id="3307086">range</span>&nbsp;<span class="ident" id="3307092">filenames</span>&nbsp;<span class="op" id="3307102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307107">f</span>&nbsp;<span class="op" id="3307109">:=</span>&nbsp;<span class="ident" id="3307112">pkg</span><span class="op" id="3307115">.</span><span class="ident" id="3307116">Files</span><span class="op" id="3307121">[</span><span class="ident" id="3307122">filename</span><span class="op" id="3307130">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307135">for</span>&nbsp;<span class="ident" id="3307139">_</span><span class="op" id="3307140">,</span>&nbsp;<span class="ident" id="3307142">d</span>&nbsp;<span class="op" id="3307144">:=</span>&nbsp;<span class="keyword" id="3307147">range</span>&nbsp;<span class="ident" id="3307153">f</span><span class="op" id="3307154">.</span><span class="ident" id="3307155">Decls</span>&nbsp;<span class="op" id="3307161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307167">if</span>&nbsp;<span class="ident" id="3307170">mode</span><span class="op" id="3307174">&amp;</span><span class="ident" id="3307175">FilterFuncDuplicates</span>&nbsp;<span class="op" id="3307196">!=</span>&nbsp;<span class="num" id="3307199">0</span>&nbsp;<span class="op" id="3307201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307208">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307259">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307309">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307357">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307407">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307460">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307468">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307518">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307569">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307622">if</span>&nbsp;<span class="ident" id="3307625">f</span><span class="op" id="3307626">,</span>&nbsp;<span class="ident" id="3307628">isFun</span>&nbsp;<span class="op" id="3307634">:=</span>&nbsp;<span class="ident" id="3307637">d</span><span class="op" id="3307638">.</span><span class="op" id="3307639">(</span><span class="op" id="3307640">*</span><span class="ident" id="3307641">FuncDecl</span><span class="op" id="3307649">)</span><span class="op" id="3307650">;</span>&nbsp;<span class="ident" id="3307652">isFun</span>&nbsp;<span class="op" id="3307658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307666">name</span>&nbsp;<span class="op" id="3307671">:=</span>&nbsp;<span class="ident" id="3307674">nameOf</span><span class="op" id="3307680">(</span><span class="ident" id="3307681">f</span><span class="op" id="3307682">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307690">if</span>&nbsp;<span class="ident" id="3307693">j</span><span class="op" id="3307694">,</span>&nbsp;<span class="ident" id="3307696">exists</span>&nbsp;<span class="op" id="3307703">:=</span>&nbsp;<span class="ident" id="3307706">funcs</span><span class="op" id="3307711">[</span><span class="ident" id="3307712">name</span><span class="op" id="3307716">]</span><span class="op" id="3307717">;</span>&nbsp;<span class="ident" id="3307719">exists</span>&nbsp;<span class="op" id="3307726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307735">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3307771">if</span>&nbsp;<span class="ident" id="3307774">decls</span><span class="op" id="3307779">[</span><span class="ident" id="3307780">j</span><span class="op" id="3307781">]</span>&nbsp;<span class="op" id="3307783">!=</span>&nbsp;<span class="ident" id="3307786">nil</span>&nbsp;<span class="op" id="3307790">&amp;&amp;</span>&nbsp;<span class="ident" id="3307793">decls</span><span class="op" id="3307798">[</span><span class="ident" id="3307799">j</span><span class="op" id="3307800">]</span><span class="op" id="3307801">.</span><span class="op" id="3307802">(</span><span class="op" id="3307803">*</span><span class="ident" id="3307804">FuncDecl</span><span class="op" id="3307812">)</span><span class="op" id="3307813">.</span><span class="ident" id="3307814">Doc</span>&nbsp;<span class="op" id="3307818">==</span>&nbsp;<span class="ident" id="3307821">nil</span>&nbsp;<span class="op" id="3307825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307835">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307889">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3307932">decls</span><span class="op" id="3307937">[</span><span class="ident" id="3307938">j</span><span class="op" id="3307939">]</span>&nbsp;<span class="op" id="3307941">=</span>&nbsp;<span class="ident" id="3307943">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3307954">}</span>&nbsp;<span class="keyword" id="3307956">else</span>&nbsp;<span class="op" id="3307961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3307971">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308009">d</span>&nbsp;<span class="op" id="3308011">=</span>&nbsp;<span class="ident" id="3308013">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308024">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308033">n</span><span class="op" id="3308034">++</span>&nbsp;<span class="comment" id="3308037">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308064">}</span>&nbsp;<span class="keyword" id="3308066">else</span>&nbsp;<span class="op" id="3308071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308080">funcs</span><span class="op" id="3308085">[</span><span class="ident" id="3308086">name</span><span class="op" id="3308090">]</span>&nbsp;<span class="op" id="3308092">=</span>&nbsp;<span class="ident" id="3308094">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308109">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308121">decls</span><span class="op" id="3308126">[</span><span class="ident" id="3308127">i</span><span class="op" id="3308128">]</span>&nbsp;<span class="op" id="3308130">=</span>&nbsp;<span class="ident" id="3308132">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308138">i</span><span class="op" id="3308139">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308149">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308154">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308217">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308284">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308351">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308416">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308449">if</span>&nbsp;<span class="ident" id="3308452">n</span>&nbsp;<span class="op" id="3308454">&gt;</span>&nbsp;<span class="num" id="3308456">0</span>&nbsp;<span class="op" id="3308458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308463">i</span>&nbsp;<span class="op" id="3308465">=</span>&nbsp;<span class="num" id="3308467">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308472">for</span>&nbsp;<span class="ident" id="3308476">_</span><span class="op" id="3308477">,</span>&nbsp;<span class="ident" id="3308479">d</span>&nbsp;<span class="op" id="3308481">:=</span>&nbsp;<span class="keyword" id="3308484">range</span>&nbsp;<span class="ident" id="3308490">decls</span>&nbsp;<span class="op" id="3308496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308502">if</span>&nbsp;<span class="ident" id="3308505">d</span>&nbsp;<span class="op" id="3308507">!=</span>&nbsp;<span class="ident" id="3308510">nil</span>&nbsp;<span class="op" id="3308514">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308521">decls</span><span class="op" id="3308526">[</span><span class="ident" id="3308527">i</span><span class="op" id="3308528">]</span>&nbsp;<span class="op" id="3308530">=</span>&nbsp;<span class="ident" id="3308532">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308539">i</span><span class="op" id="3308540">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308557">decls</span>&nbsp;<span class="op" id="3308563">=</span>&nbsp;<span class="ident" id="3308565">decls</span><span class="op" id="3308570">[</span><span class="num" id="3308571">0</span><span class="op" id="3308572">:</span><span class="ident" id="3308573">i</span><span class="op" id="3308574">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308585">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308634">var</span>&nbsp;<span class="ident" id="3308638">imports</span>&nbsp;<span class="op" id="3308646">[</span><span class="op" id="3308647">]</span><span class="op" id="3308648">*</span><span class="ident" id="3308649">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308661">if</span>&nbsp;<span class="ident" id="3308664">mode</span><span class="op" id="3308668">&amp;</span><span class="ident" id="3308669">FilterImportDuplicates</span>&nbsp;<span class="op" id="3308692">!=</span>&nbsp;<span class="num" id="3308695">0</span>&nbsp;<span class="op" id="3308697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308701">seen</span>&nbsp;<span class="op" id="3308706">:=</span>&nbsp;<span class="builtinfunc" id="3308709">make</span><span class="op" id="3308713">(</span><span class="keyword" id="3308714">map</span><span class="op" id="3308717">[</span><span class="builtintype" id="3308718">string</span><span class="op" id="3308724">]</span><span class="builtintype" id="3308725">bool</span><span class="op" id="3308729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308733">for</span>&nbsp;<span class="ident" id="3308737">_</span><span class="op" id="3308738">,</span>&nbsp;<span class="ident" id="3308740">filename</span>&nbsp;<span class="op" id="3308749">:=</span>&nbsp;<span class="keyword" id="3308752">range</span>&nbsp;<span class="ident" id="3308758">filenames</span>&nbsp;<span class="op" id="3308768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3308773">f</span>&nbsp;<span class="op" id="3308775">:=</span>&nbsp;<span class="ident" id="3308778">pkg</span><span class="op" id="3308781">.</span><span class="ident" id="3308782">Files</span><span class="op" id="3308787">[</span><span class="ident" id="3308788">filename</span><span class="op" id="3308796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308801">for</span>&nbsp;<span class="ident" id="3308805">_</span><span class="op" id="3308806">,</span>&nbsp;<span class="ident" id="3308808">imp</span>&nbsp;<span class="op" id="3308812">:=</span>&nbsp;<span class="keyword" id="3308815">range</span>&nbsp;<span class="ident" id="3308821">f</span><span class="op" id="3308822">.</span><span class="ident" id="3308823">Imports</span>&nbsp;<span class="op" id="3308831">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3308837">if</span>&nbsp;<span class="ident" id="3308840">path</span>&nbsp;<span class="op" id="3308845">:=</span>&nbsp;<span class="ident" id="3308848">imp</span><span class="op" id="3308851">.</span><span class="ident" id="3308852">Path</span><span class="op" id="3308856">.</span><span class="ident" id="3308857">Value</span><span class="op" id="3308862">;</span>&nbsp;<span class="op" id="3308864">!</span><span class="ident" id="3308865">seen</span><span class="op" id="3308869">[</span><span class="ident" id="3308870">path</span><span class="op" id="3308874">]</span>&nbsp;<span class="op" id="3308876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308883">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308928">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308984">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3309042">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3309071">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3309124">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3309179">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309209">imports</span>&nbsp;<span class="op" id="3309217">=</span>&nbsp;<span class="builtinfunc" id="3309219">append</span><span class="op" id="3309225">(</span><span class="ident" id="3309226">imports</span><span class="op" id="3309233">,</span>&nbsp;<span class="ident" id="3309235">imp</span><span class="op" id="3309238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309245">seen</span><span class="op" id="3309249">[</span><span class="ident" id="3309250">path</span><span class="op" id="3309254">]</span>&nbsp;<span class="op" id="3309256">=</span>&nbsp;<span class="builtintype" id="3309258">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309279">}</span>&nbsp;<span class="keyword" id="3309281">else</span>&nbsp;<span class="op" id="3309286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309290">for</span>&nbsp;<span class="ident" id="3309294">_</span><span class="op" id="3309295">,</span>&nbsp;<span class="ident" id="3309297">f</span>&nbsp;<span class="op" id="3309299">:=</span>&nbsp;<span class="keyword" id="3309302">range</span>&nbsp;<span class="ident" id="3309308">pkg</span><span class="op" id="3309311">.</span><span class="ident" id="3309312">Files</span>&nbsp;<span class="op" id="3309318">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309323">imports</span>&nbsp;<span class="op" id="3309331">=</span>&nbsp;<span class="builtinfunc" id="3309333">append</span><span class="op" id="3309339">(</span><span class="ident" id="3309340">imports</span><span class="op" id="3309347">,</span>&nbsp;<span class="ident" id="3309349">f</span><span class="op" id="3309350">.</span><span class="ident" id="3309351">Imports</span><span class="op" id="3309358">...</span><span class="op" id="3309361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3309372">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309417">var</span>&nbsp;<span class="ident" id="3309421">comments</span>&nbsp;<span class="op" id="3309430">[</span><span class="op" id="3309431">]</span><span class="op" id="3309432">*</span><span class="ident" id="3309433">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309447">if</span>&nbsp;<span class="ident" id="3309450">mode</span><span class="op" id="3309454">&amp;</span><span class="ident" id="3309455">FilterUnassociatedComments</span>&nbsp;<span class="op" id="3309482">==</span>&nbsp;<span class="num" id="3309485">0</span>&nbsp;<span class="op" id="3309487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309491">comments</span>&nbsp;<span class="op" id="3309500">=</span>&nbsp;<span class="builtinfunc" id="3309502">make</span><span class="op" id="3309506">(</span><span class="op" id="3309507">[</span><span class="op" id="3309508">]</span><span class="op" id="3309509">*</span><span class="ident" id="3309510">CommentGroup</span><span class="op" id="3309522">,</span>&nbsp;<span class="ident" id="3309524">ncomments</span><span class="op" id="3309533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309537">i</span>&nbsp;<span class="op" id="3309539">:=</span>&nbsp;<span class="num" id="3309542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309546">for</span>&nbsp;<span class="ident" id="3309550">_</span><span class="op" id="3309551">,</span>&nbsp;<span class="ident" id="3309553">f</span>&nbsp;<span class="op" id="3309555">:=</span>&nbsp;<span class="keyword" id="3309558">range</span>&nbsp;<span class="ident" id="3309564">pkg</span><span class="op" id="3309567">.</span><span class="ident" id="3309568">Files</span>&nbsp;<span class="op" id="3309574">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3309579">i</span>&nbsp;<span class="op" id="3309581">+=</span>&nbsp;<span class="builtinfunc" id="3309584">copy</span><span class="op" id="3309588">(</span><span class="ident" id="3309589">comments</span><span class="op" id="3309597">[</span><span class="ident" id="3309598">i</span><span class="op" id="3309599">:</span><span class="op" id="3309600">]</span><span class="op" id="3309601">,</span>&nbsp;<span class="ident" id="3309603">f</span><span class="op" id="3309604">.</span><span class="ident" id="3309605">Comments</span><span class="op" id="3309613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3309620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3309624">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3309678">return</span>&nbsp;<span class="op" id="3309685">&amp;</span><span class="ident" id="3309686">File</span><span class="op" id="3309690">{</span><span class="ident" id="3309691">doc</span><span class="op" id="3309694">,</span>&nbsp;<span class="ident" id="3309696">pos</span><span class="op" id="3309699">,</span>&nbsp;<span class="ident" id="3309701">NewIdent</span><span class="op" id="3309709">(</span><span class="ident" id="3309710">pkg</span><span class="op" id="3309713">.</span><span class="ident" id="3309714">Name</span><span class="op" id="3309718">)</span><span class="op" id="3309719">,</span>&nbsp;<span class="ident" id="3309721">decls</span><span class="op" id="3309726">,</span>&nbsp;<span class="ident" id="3309728">pkg</span><span class="op" id="3309731">.</span><span class="ident" id="3309732">Scope</span><span class="op" id="3309737">,</span>&nbsp;<span class="ident" id="3309739">imports</span><span class="op" id="3309746">,</span>&nbsp;<span class="ident" id="3309748">nil</span><span class="op" id="3309751">,</span>&nbsp;<span class="ident" id="3309753">comments</span><span class="op" id="3309761">}</span><br>
<span class="lineno"></span><span class="op" id="3309763">}</span>
</div>
</body>
</html>
