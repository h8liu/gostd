<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5916343">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5916398">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5916452">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5916503">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;NewPackage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916540">package</span>&nbsp;<span class="ident" id="5916548">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916553">import</span>&nbsp;<span class="op" id="5916560">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5916563">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5916570">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5916584">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5916596">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5916606">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5916609">type</span>&nbsp;<span class="ident" id="5916614">pkgBuilder</span>&nbsp;<span class="keyword" id="5916625">struct</span>&nbsp;<span class="op" id="5916632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916635">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5916642">*</span><span class="ident" id="5916643"><a href="/go/ast/resolve.go.html#5916584">token</a></span><span class="op" id="5916648">.</span><span class="ident" id="5916649">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916658">errors</span>&nbsp;<span class="ident" id="5916665"><a href="/go/ast/resolve.go.html#5916570">scanner</a></span><span class="op" id="5916672">.</span><span class="ident" id="5916673">ErrorList</span><br>
<span class="lineno"></span><span class="op" id="5916683">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5916686">func</span>&nbsp;<span class="op" id="5916691">(</span><span class="ident" id="5916692">p</span>&nbsp;<span class="op" id="5916694">*</span><span class="ident" id="5916695"><a href="/go/ast/resolve.go.html#5916614">pkgBuilder</a></span><span class="op" id="5916705">)</span>&nbsp;<span class="builtintype" id="5916707">error</span><span class="op" id="5916712">(</span><span class="ident" id="5916713">pos</span>&nbsp;<span class="ident" id="5916717"><a href="/go/ast/resolve.go.html#5916584">token</a></span><span class="op" id="5916722">.</span><span class="ident" id="5916723">Pos</span><span class="op" id="5916726">,</span>&nbsp;<span class="ident" id="5916728">msg</span>&nbsp;<span class="builtintype" id="5916732">string</span><span class="op" id="5916738">)</span>&nbsp;<span class="op" id="5916740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916743"><a href="/go/ast/resolve.go.html#5916692">p</a></span><span class="op" id="5916744">.</span><span class="ident" id="5916745">errors</span><span class="op" id="5916751">.</span><span class="ident" id="5916752">Add</span><span class="op" id="5916755">(</span><span class="ident" id="5916756"><a href="/go/ast/resolve.go.html#5916692">p</a></span><span class="op" id="5916757">.</span><span class="ident" id="5916758">fset</span><span class="op" id="5916762">.</span><span class="ident" id="5916763">Position</span><span class="op" id="5916771">(</span><span class="ident" id="5916772"><a href="/go/ast/resolve.go.html#5916713">pos</a></span><span class="op" id="5916775">)</span><span class="op" id="5916776">,</span>&nbsp;<span class="ident" id="5916778"><a href="/go/ast/resolve.go.html#5916728">msg</a></span><span class="op" id="5916781">)</span><br>
<span class="lineno"></span><span class="op" id="5916783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5916786">func</span>&nbsp;<span class="op" id="5916791">(</span><span class="ident" id="5916792">p</span>&nbsp;<span class="op" id="5916794">*</span><span class="ident" id="5916795"><a href="/go/ast/resolve.go.html#5916614">pkgBuilder</a></span><span class="op" id="5916805">)</span>&nbsp;<span class="ident" id="5916807">errorf</span><span class="op" id="5916813">(</span><span class="ident" id="5916814">pos</span>&nbsp;<span class="ident" id="5916818"><a href="/go/ast/resolve.go.html#5916584">token</a></span><span class="op" id="5916823">.</span><span class="ident" id="5916824">Pos</span><span class="op" id="5916827">,</span>&nbsp;<span class="ident" id="5916829">format</span>&nbsp;<span class="builtintype" id="5916836">string</span><span class="op" id="5916842">,</span>&nbsp;<span class="ident" id="5916844">args</span>&nbsp;<span class="op" id="5916849">...</span><span class="keyword" id="5916852">interface</span><span class="op" id="5916861">{</span><span class="op" id="5916862">}</span><span class="op" id="5916863">)</span>&nbsp;<span class="op" id="5916865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916868"><a href="/go/ast/resolve.go.html#5916792">p</a></span><span class="op" id="5916869">.</span><span class="builtintype" id="5916870">error</span><span class="op" id="5916875">(</span><span class="ident" id="5916876"><a href="/go/ast/resolve.go.html#5916814">pos</a></span><span class="op" id="5916879">,</span>&nbsp;<span class="ident" id="5916881"><a href="/go/ast/resolve.go.html#5916563">fmt</a></span><span class="op" id="5916884">.</span><span class="ident" id="5916885">Sprintf</span><span class="op" id="5916892">(</span><span class="ident" id="5916893"><a href="/go/ast/resolve.go.html#5916829">format</a></span><span class="op" id="5916899">,</span>&nbsp;<span class="ident" id="5916901"><a href="/go/ast/resolve.go.html#5916844">args</a></span><span class="op" id="5916905">...</span><span class="op" id="5916908">)</span><span class="op" id="5916909">)</span><br>
<span class="lineno"></span><span class="op" id="5916911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916914">func</span>&nbsp;<span class="op" id="5916919">(</span><span class="ident" id="5916920">p</span>&nbsp;<span class="op" id="5916922">*</span><span class="ident" id="5916923"><a href="/go/ast/resolve.go.html#5916614">pkgBuilder</a></span><span class="op" id="5916933">)</span>&nbsp;<span class="ident" id="5916935">declare</span><span class="op" id="5916942">(</span><span class="ident" id="5916943">scope</span><span class="op" id="5916948">,</span>&nbsp;<span class="ident" id="5916950">altScope</span>&nbsp;<span class="op" id="5916959">*</span><span class="ident" id="5916960"><a href="/go/ast/scope.go.html#5922125">Scope</a></span><span class="op" id="5916965">,</span>&nbsp;<span class="ident" id="5916967">obj</span>&nbsp;<span class="op" id="5916971">*</span><span class="ident" id="5916972"><a href="/go/ast/scope.go.html#5923836">Object</a></span><span class="op" id="5916978">)</span>&nbsp;<span class="op" id="5916980">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916983">alt</span>&nbsp;<span class="op" id="5916987">:=</span>&nbsp;<span class="ident" id="5916990"><a href="/go/ast/resolve.go.html#5916943">scope</a></span><span class="op" id="5916995">.</span><span class="ident" id="5916996">Insert</span><span class="op" id="5917002">(</span><span class="ident" id="5917003"><a href="/go/ast/resolve.go.html#5916967">obj</a></span><span class="op" id="5917006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917009">if</span>&nbsp;<span class="ident" id="5917012"><a href="/go/ast/resolve.go.html#5916983">alt</a></span>&nbsp;<span class="op" id="5917016">==</span>&nbsp;<span class="ident" id="5917019">nil</span>&nbsp;<span class="op" id="5917023">&amp;&amp;</span>&nbsp;<span class="ident" id="5917026"><a href="/go/ast/resolve.go.html#5916950">altScope</a></span>&nbsp;<span class="op" id="5917035">!=</span>&nbsp;<span class="ident" id="5917038">nil</span>&nbsp;<span class="op" id="5917042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917046">//&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;conflicting&nbsp;declaration&nbsp;in&nbsp;altScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917105"><a href="/go/ast/resolve.go.html#5916983">alt</a></span>&nbsp;<span class="op" id="5917109">=</span>&nbsp;<span class="ident" id="5917111"><a href="/go/ast/resolve.go.html#5916950">altScope</a></span><span class="op" id="5917119">.</span><span class="ident" id="5917120">Lookup</span><span class="op" id="5917126">(</span><span class="ident" id="5917127"><a href="/go/ast/resolve.go.html#5916967">obj</a></span><span class="op" id="5917130">.</span><span class="ident" id="5917131">Name</span><span class="op" id="5917135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917138">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917141">if</span>&nbsp;<span class="ident" id="5917144"><a href="/go/ast/resolve.go.html#5916983">alt</a></span>&nbsp;<span class="op" id="5917148">!=</span>&nbsp;<span class="ident" id="5917151">nil</span>&nbsp;<span class="op" id="5917155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917159">prevDecl</span>&nbsp;<span class="op" id="5917168">:=</span>&nbsp;<span class="string" id="5917171">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917176">if</span>&nbsp;<span class="ident" id="5917179">pos</span>&nbsp;<span class="op" id="5917183">:=</span>&nbsp;<span class="ident" id="5917186"><a href="/go/ast/resolve.go.html#5916983">alt</a></span><span class="op" id="5917189">.</span><span class="ident" id="5917190">Pos</span><span class="op" id="5917193">(</span><span class="op" id="5917194">)</span><span class="op" id="5917195">;</span>&nbsp;<span class="ident" id="5917197"><a href="/go/ast/resolve.go.html#5917179">pos</a></span><span class="op" id="5917200">.</span><span class="ident" id="5917201">IsValid</span><span class="op" id="5917208">(</span><span class="op" id="5917209">)</span>&nbsp;<span class="op" id="5917211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917216"><a href="/go/ast/resolve.go.html#5917159">prevDecl</a></span>&nbsp;<span class="op" id="5917225">=</span>&nbsp;<span class="ident" id="5917227"><a href="/go/ast/resolve.go.html#5916563">fmt</a></span><span class="op" id="5917230">.</span><span class="ident" id="5917231">Sprintf</span><span class="op" id="5917238">(</span><span class="string" id="5917239">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5917271">,</span>&nbsp;<span class="ident" id="5917273"><a href="/go/ast/resolve.go.html#5916920">p</a></span><span class="op" id="5917274">.</span><span class="ident" id="5917275">fset</span><span class="op" id="5917279">.</span><span class="ident" id="5917280">Position</span><span class="op" id="5917288">(</span><span class="ident" id="5917289"><a href="/go/ast/resolve.go.html#5917179">pos</a></span><span class="op" id="5917292">)</span><span class="op" id="5917293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917297">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917301"><a href="/go/ast/resolve.go.html#5916920">p</a></span><span class="op" id="5917302">.</span><span class="builtintype" id="5917303">error</span><span class="op" id="5917308">(</span><span class="ident" id="5917309"><a href="/go/ast/resolve.go.html#5916967">obj</a></span><span class="op" id="5917312">.</span><span class="ident" id="5917313">Pos</span><span class="op" id="5917316">(</span><span class="op" id="5917317">)</span><span class="op" id="5917318">,</span>&nbsp;<span class="ident" id="5917320"><a href="/go/ast/resolve.go.html#5916563">fmt</a></span><span class="op" id="5917323">.</span><span class="ident" id="5917324">Sprintf</span><span class="op" id="5917331">(</span><span class="string" id="5917332">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5917363">,</span>&nbsp;<span class="ident" id="5917365"><a href="/go/ast/resolve.go.html#5916967">obj</a></span><span class="op" id="5917368">.</span><span class="ident" id="5917369">Name</span><span class="op" id="5917373">,</span>&nbsp;<span class="ident" id="5917375"><a href="/go/ast/resolve.go.html#5917159">prevDecl</a></span><span class="op" id="5917383">)</span><span class="op" id="5917384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917387">}</span><br>
<span class="lineno"></span><span class="op" id="5917389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5917392">func</span>&nbsp;<span class="ident" id="5917397">resolve</span><span class="op" id="5917404">(</span><span class="ident" id="5917405">scope</span>&nbsp;<span class="op" id="5917411">*</span><span class="ident" id="5917412"><a href="/go/ast/scope.go.html#5922125">Scope</a></span><span class="op" id="5917417">,</span>&nbsp;<span class="ident" id="5917419">ident</span>&nbsp;<span class="op" id="5917425">*</span><span class="ident" id="5917426"><a href="/go/ast/ast.go.html#5858933">Ident</a></span><span class="op" id="5917431">)</span>&nbsp;<span class="builtintype" id="5917433">bool</span>&nbsp;<span class="op" id="5917438">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917441">for</span>&nbsp;<span class="op" id="5917445">;</span>&nbsp;<span class="ident" id="5917447"><a href="/go/ast/resolve.go.html#5917405">scope</a></span>&nbsp;<span class="op" id="5917453">!=</span>&nbsp;<span class="ident" id="5917456">nil</span><span class="op" id="5917459">;</span>&nbsp;<span class="ident" id="5917461"><a href="/go/ast/resolve.go.html#5917405">scope</a></span>&nbsp;<span class="op" id="5917467">=</span>&nbsp;<span class="ident" id="5917469"><a href="/go/ast/resolve.go.html#5917405">scope</a></span><span class="op" id="5917474">.</span><span class="ident" id="5917475">Outer</span>&nbsp;<span class="op" id="5917481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917485">if</span>&nbsp;<span class="ident" id="5917488">obj</span>&nbsp;<span class="op" id="5917492">:=</span>&nbsp;<span class="ident" id="5917495"><a href="/go/ast/resolve.go.html#5917405">scope</a></span><span class="op" id="5917500">.</span><span class="ident" id="5917501">Lookup</span><span class="op" id="5917507">(</span><span class="ident" id="5917508"><a href="/go/ast/resolve.go.html#5917419">ident</a></span><span class="op" id="5917513">.</span><span class="ident" id="5917514">Name</span><span class="op" id="5917518">)</span><span class="op" id="5917519">;</span>&nbsp;<span class="ident" id="5917521"><a href="/go/ast/resolve.go.html#5917488">obj</a></span>&nbsp;<span class="op" id="5917525">!=</span>&nbsp;<span class="ident" id="5917528">nil</span>&nbsp;<span class="op" id="5917532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917537"><a href="/go/ast/resolve.go.html#5917419">ident</a></span><span class="op" id="5917542">.</span><span class="ident" id="5917543">Obj</span>&nbsp;<span class="op" id="5917547">=</span>&nbsp;<span class="ident" id="5917549"><a href="/go/ast/resolve.go.html#5917488">obj</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917556">return</span>&nbsp;<span class="ident" id="5917563">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917570">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917576">return</span>&nbsp;<span class="ident" id="5917583">false</span><br>
<span class="lineno"></span><span class="op" id="5917589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917592">//&nbsp;An&nbsp;Importer&nbsp;resolves&nbsp;import&nbsp;paths&nbsp;to&nbsp;package&nbsp;Objects.</span><br>
<span class="lineno">55</span><span class="comment" id="5917649">//&nbsp;The&nbsp;imports&nbsp;map&nbsp;records&nbsp;the&nbsp;packages&nbsp;already&nbsp;imported,</span><br>
<span class="lineno"></span><span class="comment" id="5917707">//&nbsp;indexed&nbsp;by&nbsp;package&nbsp;id&nbsp;(canonical&nbsp;import&nbsp;path).</span><br>
<span class="lineno"></span><span class="comment" id="5917757">//&nbsp;An&nbsp;Importer&nbsp;must&nbsp;determine&nbsp;the&nbsp;canonical&nbsp;import&nbsp;path&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5917817">//&nbsp;check&nbsp;the&nbsp;map&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;already&nbsp;present&nbsp;in&nbsp;the&nbsp;imports&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5917886">//&nbsp;If&nbsp;so,&nbsp;the&nbsp;Importer&nbsp;can&nbsp;return&nbsp;the&nbsp;map&nbsp;entry.&nbsp;&nbsp;Otherwise,&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="5917951">//&nbsp;Importer&nbsp;should&nbsp;load&nbsp;the&nbsp;package&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;path&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5918016">//&nbsp;a&nbsp;new&nbsp;*Object&nbsp;(pkg),&nbsp;record&nbsp;pkg&nbsp;in&nbsp;the&nbsp;imports&nbsp;map,&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5918080">//&nbsp;return&nbsp;pkg.</span><br>
<span class="lineno"></span><span class="keyword" id="5918095">type</span>&nbsp;<span class="ident" id="5918100">Importer</span>&nbsp;<span class="keyword" id="5918109">func</span><span class="op" id="5918113">(</span><span class="ident" id="5918114">imports</span>&nbsp;<span class="keyword" id="5918122">map</span><span class="op" id="5918125">[</span><span class="builtintype" id="5918126">string</span><span class="op" id="5918132">]</span><span class="op" id="5918133">*</span><span class="ident" id="5918134"><a href="/go/ast/scope.go.html#5923836">Object</a></span><span class="op" id="5918140">,</span>&nbsp;<span class="ident" id="5918142">path</span>&nbsp;<span class="builtintype" id="5918147">string</span><span class="op" id="5918153">)</span>&nbsp;<span class="op" id="5918155">(</span><span class="ident" id="5918156">pkg</span>&nbsp;<span class="op" id="5918160">*</span><span class="ident" id="5918161"><a href="/go/ast/scope.go.html#5923836">Object</a></span><span class="op" id="5918167">,</span>&nbsp;<span class="ident" id="5918169">err</span>&nbsp;<span class="builtintype" id="5918173">error</span><span class="op" id="5918178">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5918181">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;Package&nbsp;node&nbsp;from&nbsp;a&nbsp;set&nbsp;of&nbsp;File&nbsp;nodes.&nbsp;It&nbsp;resolves</span><br>
<span class="lineno"></span><span class="comment" id="5918260">//&nbsp;unresolved&nbsp;identifiers&nbsp;across&nbsp;files&nbsp;and&nbsp;updates&nbsp;each&nbsp;file&#39;s&nbsp;Unresolved&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5918339">//&nbsp;accordingly.&nbsp;If&nbsp;a&nbsp;non-nil&nbsp;importer&nbsp;and&nbsp;universe&nbsp;scope&nbsp;are&nbsp;provided,&nbsp;they&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5918419">//&nbsp;used&nbsp;to&nbsp;resolve&nbsp;identifiers&nbsp;not&nbsp;declared&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;package&nbsp;files.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5918496">//&nbsp;remaining&nbsp;unresolved&nbsp;identifiers&nbsp;are&nbsp;reported&nbsp;as&nbsp;undeclared.&nbsp;If&nbsp;the&nbsp;files</span><br>
<span class="lineno">70</span><span class="comment" id="5918573">//&nbsp;belong&nbsp;to&nbsp;different&nbsp;packages,&nbsp;one&nbsp;package&nbsp;name&nbsp;is&nbsp;selected&nbsp;and&nbsp;files&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5918650">//&nbsp;different&nbsp;package&nbsp;names&nbsp;are&nbsp;reported&nbsp;and&nbsp;then&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5918708">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;package&nbsp;node&nbsp;and&nbsp;a&nbsp;scanner.ErrorList&nbsp;if&nbsp;there&nbsp;were&nbsp;errors.</span><br>
<span class="lineno"></span><span class="comment" id="5918786">//</span><br>
<span class="lineno"></span><span class="keyword" id="5918789">func</span>&nbsp;<span class="ident" id="5918794">NewPackage</span><span class="op" id="5918804">(</span><span class="ident" id="5918805">fset</span>&nbsp;<span class="op" id="5918810">*</span><span class="ident" id="5918811"><a href="/go/ast/resolve.go.html#5916584">token</a></span><span class="op" id="5918816">.</span><span class="ident" id="5918817">FileSet</span><span class="op" id="5918824">,</span>&nbsp;<span class="ident" id="5918826">files</span>&nbsp;<span class="keyword" id="5918832">map</span><span class="op" id="5918835">[</span><span class="builtintype" id="5918836">string</span><span class="op" id="5918842">]</span><span class="op" id="5918843">*</span><span class="ident" id="5918844"><a href="/go/ast/ast.go.html#5882563">File</a></span><span class="op" id="5918848">,</span>&nbsp;<span class="ident" id="5918850">importer</span>&nbsp;<span class="ident" id="5918859"><a href="/go/ast/resolve.go.html#5918100">Importer</a></span><span class="op" id="5918867">,</span>&nbsp;<span class="ident" id="5918869">universe</span>&nbsp;<span class="op" id="5918878">*</span><span class="ident" id="5918879"><a href="/go/ast/scope.go.html#5922125">Scope</a></span><span class="op" id="5918884">)</span>&nbsp;<span class="op" id="5918886">(</span><span class="op" id="5918887">*</span><span class="ident" id="5918888"><a href="/go/ast/ast.go.html#5883332">Package</a></span><span class="op" id="5918895">,</span>&nbsp;<span class="builtintype" id="5918897">error</span><span class="op" id="5918902">)</span>&nbsp;<span class="op" id="5918904">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918907">var</span>&nbsp;<span class="ident" id="5918911">p</span>&nbsp;<span class="ident" id="5918913"><a href="/go/ast/resolve.go.html#5916614">pkgBuilder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918925"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5918926">.</span><span class="ident" id="5918927">fset</span>&nbsp;<span class="op" id="5918932">=</span>&nbsp;<span class="ident" id="5918934"><a href="/go/ast/resolve.go.html#5918805">fset</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918941">//&nbsp;complete&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918968">pkgName</span>&nbsp;<span class="op" id="5918976">:=</span>&nbsp;<span class="string" id="5918979">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918983">pkgScope</span>&nbsp;<span class="op" id="5918992">:=</span>&nbsp;<span class="ident" id="5918995"><a href="/go/ast/scope.go.html#5922251">NewScope</a></span><span class="op" id="5919003">(</span><span class="ident" id="5919004"><a href="/go/ast/resolve.go.html#5918869">universe</a></span><span class="op" id="5919012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919015">for</span>&nbsp;<span class="ident" id="5919019">_</span><span class="op" id="5919020">,</span>&nbsp;<span class="ident" id="5919022">file</span>&nbsp;<span class="op" id="5919027">:=</span>&nbsp;<span class="keyword" id="5919030">range</span>&nbsp;<span class="ident" id="5919036"><a href="/go/ast/resolve.go.html#5918826">files</a></span>&nbsp;<span class="op" id="5919042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919046">//&nbsp;package&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919076">switch</span>&nbsp;<span class="ident" id="5919083">name</span>&nbsp;<span class="op" id="5919088">:=</span>&nbsp;<span class="ident" id="5919091"><a href="/go/ast/resolve.go.html#5919022">file</a></span><span class="op" id="5919095">.</span><span class="ident" id="5919096">Name</span><span class="op" id="5919100">.</span><span class="ident" id="5919101">Name</span><span class="op" id="5919105">;</span>&nbsp;<span class="op" id="5919107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919111">case</span>&nbsp;<span class="ident" id="5919116"><a href="/go/ast/resolve.go.html#5918968">pkgName</a></span>&nbsp;<span class="op" id="5919124">==</span>&nbsp;<span class="string" id="5919127">&#34;&#34;</span><span class="op" id="5919129">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919134"><a href="/go/ast/resolve.go.html#5918968">pkgName</a></span>&nbsp;<span class="op" id="5919142">=</span>&nbsp;<span class="ident" id="5919144"><a href="/go/ast/resolve.go.html#5919083">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919151">case</span>&nbsp;<span class="ident" id="5919156"><a href="/go/ast/resolve.go.html#5919083">name</a></span>&nbsp;<span class="op" id="5919161">!=</span>&nbsp;<span class="ident" id="5919164"><a href="/go/ast/resolve.go.html#5918968">pkgName</a></span><span class="op" id="5919171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919176"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5919177">.</span><span class="ident" id="5919178">errorf</span><span class="op" id="5919184">(</span><span class="ident" id="5919185"><a href="/go/ast/resolve.go.html#5919022">file</a></span><span class="op" id="5919189">.</span><span class="ident" id="5919190">Package</span><span class="op" id="5919197">,</span>&nbsp;<span class="string" id="5919199">&#34;package&nbsp;%s;&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="5919224">,</span>&nbsp;<span class="ident" id="5919226"><a href="/go/ast/resolve.go.html#5919083">name</a></span><span class="op" id="5919230">,</span>&nbsp;<span class="ident" id="5919232"><a href="/go/ast/resolve.go.html#5918968">pkgName</a></span><span class="op" id="5919239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919244">continue</span>&nbsp;<span class="comment" id="5919253">//&nbsp;ignore&nbsp;this&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919275">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919280">//&nbsp;collect&nbsp;top-level&nbsp;file&nbsp;objects&nbsp;in&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919333">for</span>&nbsp;<span class="ident" id="5919337">_</span><span class="op" id="5919338">,</span>&nbsp;<span class="ident" id="5919340">obj</span>&nbsp;<span class="op" id="5919344">:=</span>&nbsp;<span class="keyword" id="5919347">range</span>&nbsp;<span class="ident" id="5919353"><a href="/go/ast/resolve.go.html#5919022">file</a></span><span class="op" id="5919357">.</span><span class="ident" id="5919358">Scope</span><span class="op" id="5919363">.</span><span class="ident" id="5919364">Objects</span>&nbsp;<span class="op" id="5919372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919377"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5919378">.</span><span class="ident" id="5919379">declare</span><span class="op" id="5919386">(</span><span class="ident" id="5919387"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5919395">,</span>&nbsp;<span class="ident" id="5919397">nil</span><span class="op" id="5919400">,</span>&nbsp;<span class="ident" id="5919402"><a href="/go/ast/resolve.go.html#5919340">obj</a></span><span class="op" id="5919405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919409">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919416">//&nbsp;package&nbsp;global&nbsp;mapping&nbsp;of&nbsp;imported&nbsp;package&nbsp;ids&nbsp;to&nbsp;package&nbsp;objects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919486">imports</span>&nbsp;<span class="op" id="5919494">:=</span>&nbsp;<span class="builtinfunc" id="5919497">make</span><span class="op" id="5919501">(</span><span class="keyword" id="5919502">map</span><span class="op" id="5919505">[</span><span class="builtintype" id="5919506">string</span><span class="op" id="5919512">]</span><span class="op" id="5919513">*</span><span class="ident" id="5919514"><a href="/go/ast/scope.go.html#5923836">Object</a></span><span class="op" id="5919520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919524">//&nbsp;complete&nbsp;file&nbsp;scopes&nbsp;with&nbsp;imports&nbsp;and&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919586">for</span>&nbsp;<span class="ident" id="5919590">_</span><span class="op" id="5919591">,</span>&nbsp;<span class="ident" id="5919593">file</span>&nbsp;<span class="op" id="5919598">:=</span>&nbsp;<span class="keyword" id="5919601">range</span>&nbsp;<span class="ident" id="5919607"><a href="/go/ast/resolve.go.html#5918826">files</a></span>&nbsp;<span class="op" id="5919613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919617">//&nbsp;ignore&nbsp;file&nbsp;if&nbsp;it&nbsp;belongs&nbsp;to&nbsp;a&nbsp;different&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919671">//&nbsp;(error&nbsp;has&nbsp;already&nbsp;been&nbsp;reported)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919710">if</span>&nbsp;<span class="ident" id="5919713"><a href="/go/ast/resolve.go.html#5919593">file</a></span><span class="op" id="5919717">.</span><span class="ident" id="5919718">Name</span><span class="op" id="5919722">.</span><span class="ident" id="5919723">Name</span>&nbsp;<span class="op" id="5919728">!=</span>&nbsp;<span class="ident" id="5919731"><a href="/go/ast/resolve.go.html#5918968">pkgName</a></span>&nbsp;<span class="op" id="5919739">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919744">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919760">//&nbsp;build&nbsp;file&nbsp;scope&nbsp;by&nbsp;processing&nbsp;all&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919808">importErrors</span>&nbsp;<span class="op" id="5919821">:=</span>&nbsp;<span class="ident" id="5919824">false</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919832">fileScope</span>&nbsp;<span class="op" id="5919842">:=</span>&nbsp;<span class="ident" id="5919845"><a href="/go/ast/scope.go.html#5922251">NewScope</a></span><span class="op" id="5919853">(</span><span class="ident" id="5919854"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5919862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919866">for</span>&nbsp;<span class="ident" id="5919870">_</span><span class="op" id="5919871">,</span>&nbsp;<span class="ident" id="5919873">spec</span>&nbsp;<span class="op" id="5919878">:=</span>&nbsp;<span class="keyword" id="5919881">range</span>&nbsp;<span class="ident" id="5919887"><a href="/go/ast/resolve.go.html#5919593">file</a></span><span class="op" id="5919891">.</span><span class="ident" id="5919892">Imports</span>&nbsp;<span class="op" id="5919900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919905">if</span>&nbsp;<span class="ident" id="5919908"><a href="/go/ast/resolve.go.html#5918850">importer</a></span>&nbsp;<span class="op" id="5919917">==</span>&nbsp;<span class="ident" id="5919920">nil</span>&nbsp;<span class="op" id="5919924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919930"><a href="/go/ast/resolve.go.html#5919808">importErrors</a></span>&nbsp;<span class="op" id="5919943">=</span>&nbsp;<span class="ident" id="5919945">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919954">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919971">path</span><span class="op" id="5919975">,</span>&nbsp;<span class="ident" id="5919977">_</span>&nbsp;<span class="op" id="5919979">:=</span>&nbsp;<span class="ident" id="5919982"><a href="/go/ast/resolve.go.html#5916596">strconv</a></span><span class="op" id="5919989">.</span><span class="ident" id="5919990">Unquote</span><span class="op" id="5919997">(</span><span class="ident" id="5919998"><a href="/go/ast/resolve.go.html#5919873">spec</a></span><span class="op" id="5920002">.</span><span class="ident" id="5920003">Path</span><span class="op" id="5920007">.</span><span class="ident" id="5920008">Value</span><span class="op" id="5920013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920018">pkg</span><span class="op" id="5920021">,</span>&nbsp;<span class="ident" id="5920023">err</span>&nbsp;<span class="op" id="5920027">:=</span>&nbsp;<span class="ident" id="5920030"><a href="/go/ast/resolve.go.html#5918850">importer</a></span><span class="op" id="5920038">(</span><span class="ident" id="5920039"><a href="/go/ast/resolve.go.html#5919486">imports</a></span><span class="op" id="5920046">,</span>&nbsp;<span class="ident" id="5920048"><a href="/go/ast/resolve.go.html#5919971">path</a></span><span class="op" id="5920052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920057">if</span>&nbsp;<span class="ident" id="5920060"><a href="/go/ast/resolve.go.html#5920023">err</a></span>&nbsp;<span class="op" id="5920064">!=</span>&nbsp;<span class="ident" id="5920067">nil</span>&nbsp;<span class="op" id="5920071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920077"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5920078">.</span><span class="ident" id="5920079">errorf</span><span class="op" id="5920085">(</span><span class="ident" id="5920086"><a href="/go/ast/resolve.go.html#5919873">spec</a></span><span class="op" id="5920090">.</span><span class="ident" id="5920091">Path</span><span class="op" id="5920095">.</span><span class="ident" id="5920096">Pos</span><span class="op" id="5920099">(</span><span class="op" id="5920100">)</span><span class="op" id="5920101">,</span>&nbsp;<span class="string" id="5920103">&#34;could&nbsp;not&nbsp;import&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="5920129">,</span>&nbsp;<span class="ident" id="5920131"><a href="/go/ast/resolve.go.html#5919971">path</a></span><span class="op" id="5920135">,</span>&nbsp;<span class="ident" id="5920137"><a href="/go/ast/resolve.go.html#5920023">err</a></span><span class="op" id="5920140">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920146"><a href="/go/ast/resolve.go.html#5919808">importErrors</a></span>&nbsp;<span class="op" id="5920159">=</span>&nbsp;<span class="ident" id="5920161">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920170">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920187">//&nbsp;TODO(gri)&nbsp;If&nbsp;a&nbsp;local&nbsp;package&nbsp;name&nbsp;!=&nbsp;&#34;.&#34;&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920247">//&nbsp;global&nbsp;identifier&nbsp;resolution&nbsp;could&nbsp;proceed&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920308">//&nbsp;import&nbsp;failed.&nbsp;Consider&nbsp;adjusting&nbsp;the&nbsp;logic&nbsp;here&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920371">//&nbsp;local&nbsp;name&nbsp;overrides&nbsp;imported&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920420">name</span>&nbsp;<span class="op" id="5920425">:=</span>&nbsp;<span class="ident" id="5920428"><a href="/go/ast/resolve.go.html#5920018">pkg</a></span><span class="op" id="5920431">.</span><span class="ident" id="5920432">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920440">if</span>&nbsp;<span class="ident" id="5920443"><a href="/go/ast/resolve.go.html#5919873">spec</a></span><span class="op" id="5920447">.</span><span class="ident" id="5920448">Name</span>&nbsp;<span class="op" id="5920453">!=</span>&nbsp;<span class="ident" id="5920456">nil</span>&nbsp;<span class="op" id="5920460">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920466"><a href="/go/ast/resolve.go.html#5920420">name</a></span>&nbsp;<span class="op" id="5920471">=</span>&nbsp;<span class="ident" id="5920473"><a href="/go/ast/resolve.go.html#5919873">spec</a></span><span class="op" id="5920477">.</span><span class="ident" id="5920478">Name</span><span class="op" id="5920482">.</span><span class="ident" id="5920483">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920497">//&nbsp;add&nbsp;import&nbsp;to&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920528">if</span>&nbsp;<span class="ident" id="5920531"><a href="/go/ast/resolve.go.html#5920420">name</a></span>&nbsp;<span class="op" id="5920536">==</span>&nbsp;<span class="string" id="5920539">&#34;.&#34;</span>&nbsp;<span class="op" id="5920543">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920549">//&nbsp;merge&nbsp;imported&nbsp;scope&nbsp;with&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920593">for</span>&nbsp;<span class="ident" id="5920597">_</span><span class="op" id="5920598">,</span>&nbsp;<span class="ident" id="5920600">obj</span>&nbsp;<span class="op" id="5920604">:=</span>&nbsp;<span class="keyword" id="5920607">range</span>&nbsp;<span class="ident" id="5920613"><a href="/go/ast/resolve.go.html#5920018">pkg</a></span><span class="op" id="5920616">.</span><span class="ident" id="5920617">Data</span><span class="op" id="5920621">.</span><span class="op" id="5920622">(</span><span class="op" id="5920623">*</span><span class="ident" id="5920624"><a href="/go/ast/scope.go.html#5922125">Scope</a></span><span class="op" id="5920629">)</span><span class="op" id="5920630">.</span><span class="ident" id="5920631">Objects</span>&nbsp;<span class="op" id="5920639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920646"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5920647">.</span><span class="ident" id="5920648">declare</span><span class="op" id="5920655">(</span><span class="ident" id="5920656"><a href="/go/ast/resolve.go.html#5919832">fileScope</a></span><span class="op" id="5920665">,</span>&nbsp;<span class="ident" id="5920667"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5920675">,</span>&nbsp;<span class="ident" id="5920677"><a href="/go/ast/resolve.go.html#5920600">obj</a></span><span class="op" id="5920680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920691">}</span>&nbsp;<span class="keyword" id="5920693">else</span>&nbsp;<span class="keyword" id="5920698">if</span>&nbsp;<span class="ident" id="5920701"><a href="/go/ast/resolve.go.html#5920420">name</a></span>&nbsp;<span class="op" id="5920706">!=</span>&nbsp;<span class="string" id="5920709">&#34;_&#34;</span>&nbsp;<span class="op" id="5920713">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920719">//&nbsp;declare&nbsp;imported&nbsp;package&nbsp;object&nbsp;in&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920772">//&nbsp;(do&nbsp;not&nbsp;re-use&nbsp;pkg&nbsp;in&nbsp;the&nbsp;file&nbsp;scope&nbsp;but&nbsp;create</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920827">//&nbsp;a&nbsp;new&nbsp;object&nbsp;instead;&nbsp;the&nbsp;Decl&nbsp;field&nbsp;is&nbsp;different</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920884">//&nbsp;for&nbsp;different&nbsp;files)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920912">obj</span>&nbsp;<span class="op" id="5920916">:=</span>&nbsp;<span class="ident" id="5920919"><a href="/go/ast/scope.go.html#5924182">NewObj</a></span><span class="op" id="5920925">(</span><span class="ident" id="5920926"><a href="/go/ast/scope.go.html#5925450">Pkg</a></span><span class="op" id="5920929">,</span>&nbsp;<span class="ident" id="5920931"><a href="/go/ast/resolve.go.html#5920420">name</a></span><span class="op" id="5920935">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920941"><a href="/go/ast/resolve.go.html#5920912">obj</a></span><span class="op" id="5920944">.</span><span class="ident" id="5920945">Decl</span>&nbsp;<span class="op" id="5920950">=</span>&nbsp;<span class="ident" id="5920952"><a href="/go/ast/resolve.go.html#5919873">spec</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920961"><a href="/go/ast/resolve.go.html#5920912">obj</a></span><span class="op" id="5920964">.</span><span class="ident" id="5920965">Data</span>&nbsp;<span class="op" id="5920970">=</span>&nbsp;<span class="ident" id="5920972"><a href="/go/ast/resolve.go.html#5920018">pkg</a></span><span class="op" id="5920975">.</span><span class="ident" id="5920976">Data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920985"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5920986">.</span><span class="ident" id="5920987">declare</span><span class="op" id="5920994">(</span><span class="ident" id="5920995"><a href="/go/ast/resolve.go.html#5919832">fileScope</a></span><span class="op" id="5921004">,</span>&nbsp;<span class="ident" id="5921006"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5921014">,</span>&nbsp;<span class="ident" id="5921016"><a href="/go/ast/resolve.go.html#5920912">obj</a></span><span class="op" id="5921019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921028">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921033">//&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921058">if</span>&nbsp;<span class="ident" id="5921061"><a href="/go/ast/resolve.go.html#5919808">importErrors</a></span>&nbsp;<span class="op" id="5921074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921079">//&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;universe&nbsp;scope&nbsp;without&nbsp;correct&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921138">//&nbsp;(objects&nbsp;in&nbsp;the&nbsp;universe&nbsp;may&nbsp;be&nbsp;shadowed&nbsp;by&nbsp;imports;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921197">//&nbsp;with&nbsp;missing&nbsp;imports,&nbsp;identifiers&nbsp;might&nbsp;get&nbsp;resolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921256">//&nbsp;incorrectly&nbsp;to&nbsp;universe&nbsp;objects)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921295"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5921303">.</span><span class="ident" id="5921304">Outer</span>&nbsp;<span class="op" id="5921310">=</span>&nbsp;<span class="ident" id="5921312">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921322">i</span>&nbsp;<span class="op" id="5921324">:=</span>&nbsp;<span class="num" id="5921327">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921331">for</span>&nbsp;<span class="ident" id="5921335">_</span><span class="op" id="5921336">,</span>&nbsp;<span class="ident" id="5921338">ident</span>&nbsp;<span class="op" id="5921344">:=</span>&nbsp;<span class="keyword" id="5921347">range</span>&nbsp;<span class="ident" id="5921353"><a href="/go/ast/resolve.go.html#5919593">file</a></span><span class="op" id="5921357">.</span><span class="ident" id="5921358">Unresolved</span>&nbsp;<span class="op" id="5921369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921374">if</span>&nbsp;<span class="op" id="5921377">!</span><span class="ident" id="5921378"><a href="/go/ast/resolve.go.html#5917397">resolve</a></span><span class="op" id="5921385">(</span><span class="ident" id="5921386"><a href="/go/ast/resolve.go.html#5919832">fileScope</a></span><span class="op" id="5921395">,</span>&nbsp;<span class="ident" id="5921397"><a href="/go/ast/resolve.go.html#5921338">ident</a></span><span class="op" id="5921402">)</span>&nbsp;<span class="op" id="5921404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921410"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5921411">.</span><span class="ident" id="5921412">errorf</span><span class="op" id="5921418">(</span><span class="ident" id="5921419"><a href="/go/ast/resolve.go.html#5921338">ident</a></span><span class="op" id="5921424">.</span><span class="ident" id="5921425">Pos</span><span class="op" id="5921428">(</span><span class="op" id="5921429">)</span><span class="op" id="5921430">,</span>&nbsp;<span class="string" id="5921432">&#34;undeclared&nbsp;name:&nbsp;%s&#34;</span><span class="op" id="5921453">,</span>&nbsp;<span class="ident" id="5921455"><a href="/go/ast/resolve.go.html#5921338">ident</a></span><span class="op" id="5921460">.</span><span class="ident" id="5921461">Name</span><span class="op" id="5921465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921471"><a href="/go/ast/resolve.go.html#5919593">file</a></span><span class="op" id="5921475">.</span><span class="ident" id="5921476">Unresolved</span><span class="op" id="5921486">[</span><span class="ident" id="5921487"><a href="/go/ast/resolve.go.html#5921322">i</a></span><span class="op" id="5921488">]</span>&nbsp;<span class="op" id="5921490">=</span>&nbsp;<span class="ident" id="5921492"><a href="/go/ast/resolve.go.html#5921338">ident</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921502"><a href="/go/ast/resolve.go.html#5921322">i</a></span><span class="op" id="5921503">++</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921518"><a href="/go/ast/resolve.go.html#5919593">file</a></span><span class="op" id="5921522">.</span><span class="ident" id="5921523">Unresolved</span>&nbsp;<span class="op" id="5921534">=</span>&nbsp;<span class="ident" id="5921536"><a href="/go/ast/resolve.go.html#5919593">file</a></span><span class="op" id="5921540">.</span><span class="ident" id="5921541">Unresolved</span><span class="op" id="5921551">[</span><span class="num" id="5921552">0</span><span class="op" id="5921553">:</span><span class="ident" id="5921554"><a href="/go/ast/resolve.go.html#5921322">i</a></span><span class="op" id="5921555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921559"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5921567">.</span><span class="ident" id="5921568">Outer</span>&nbsp;<span class="op" id="5921574">=</span>&nbsp;<span class="ident" id="5921576"><a href="/go/ast/resolve.go.html#5918869">universe</a></span>&nbsp;<span class="comment" id="5921585">//&nbsp;reset&nbsp;universe&nbsp;scope</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921614"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5921615">.</span><span class="ident" id="5921616">errors</span><span class="op" id="5921622">.</span><span class="ident" id="5921623">Sort</span><span class="op" id="5921627">(</span><span class="op" id="5921628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921631">return</span>&nbsp;<span class="op" id="5921638">&amp;</span><span class="ident" id="5921639"><a href="/go/ast/ast.go.html#5883332">Package</a></span><span class="op" id="5921646">{</span><span class="ident" id="5921647"><a href="/go/ast/resolve.go.html#5918968">pkgName</a></span><span class="op" id="5921654">,</span>&nbsp;<span class="ident" id="5921656"><a href="/go/ast/resolve.go.html#5918983">pkgScope</a></span><span class="op" id="5921664">,</span>&nbsp;<span class="ident" id="5921666"><a href="/go/ast/resolve.go.html#5919486">imports</a></span><span class="op" id="5921673">,</span>&nbsp;<span class="ident" id="5921675"><a href="/go/ast/resolve.go.html#5918826">files</a></span><span class="op" id="5921680">}</span><span class="op" id="5921681">,</span>&nbsp;<span class="ident" id="5921683"><a href="/go/ast/resolve.go.html#5918911">p</a></span><span class="op" id="5921684">.</span><span class="ident" id="5921685">errors</span><span class="op" id="5921691">.</span><span class="ident" id="5921692">Err</span><span class="op" id="5921695">(</span><span class="op" id="5921696">)</span><br>
<span class="lineno"></span><span class="op" id="5921698">}</span>
</div>
</body>
</html>
