<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8479926">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8479982">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8480036">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8480087">package</span>&nbsp;<span class="ident" id="8480095">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480106">import</span>&nbsp;<span class="op" id="8480113">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8480116">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8480125">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8480134">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8480140">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8480151">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8480162">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8480172">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8480175">type</span>&nbsp;<span class="ident" id="8480180">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="8480203">struct</span>&nbsp;<span class="op" id="8480210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480213">in</span><span class="op" id="8480215">,</span>&nbsp;<span class="ident" id="8480217">out</span>&nbsp;<span class="builtintype" id="8480221">string</span><br>
<span class="lineno"></span><span class="op" id="8480228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8480231">var</span>&nbsp;<span class="ident" id="8480235">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8480259">=</span>&nbsp;<span class="op" id="8480261">[</span><span class="op" id="8480262">]</span><span class="ident" id="8480263">canonicalHeaderKeyTest</span><span class="op" id="8480285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480288">{</span><span class="string" id="8480289">&#34;a-b-c&#34;</span><span class="op" id="8480296">,</span>&nbsp;<span class="string" id="8480298">&#34;A-B-C&#34;</span><span class="op" id="8480305">}</span><span class="op" id="8480306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480309">{</span><span class="string" id="8480310">&#34;a-1-c&#34;</span><span class="op" id="8480317">,</span>&nbsp;<span class="string" id="8480319">&#34;A-1-C&#34;</span><span class="op" id="8480326">}</span><span class="op" id="8480327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480330">{</span><span class="string" id="8480331">&#34;User-Agent&#34;</span><span class="op" id="8480343">,</span>&nbsp;<span class="string" id="8480345">&#34;User-Agent&#34;</span><span class="op" id="8480357">}</span><span class="op" id="8480358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480361">{</span><span class="string" id="8480362">&#34;uSER-aGENT&#34;</span><span class="op" id="8480374">,</span>&nbsp;<span class="string" id="8480376">&#34;User-Agent&#34;</span><span class="op" id="8480388">}</span><span class="op" id="8480389">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480392">{</span><span class="string" id="8480393">&#34;user-agent&#34;</span><span class="op" id="8480405">,</span>&nbsp;<span class="string" id="8480407">&#34;User-Agent&#34;</span><span class="op" id="8480419">}</span><span class="op" id="8480420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480423">{</span><span class="string" id="8480424">&#34;USER-AGENT&#34;</span><span class="op" id="8480436">,</span>&nbsp;<span class="string" id="8480438">&#34;User-Agent&#34;</span><span class="op" id="8480450">}</span><span class="op" id="8480451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480454">{</span><span class="string" id="8480455">&#34;üser-agenT&#34;</span><span class="op" id="8480468">,</span>&nbsp;<span class="string" id="8480470">&#34;üser-Agent&#34;</span><span class="op" id="8480483">}</span><span class="op" id="8480484">,</span>&nbsp;<span class="comment" id="8480486">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8480511">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480566">{</span><span class="string" id="8480567">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="8480595">,</span>&nbsp;<span class="string" id="8480597">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="8480625">}</span><span class="op" id="8480626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480629">{</span><span class="string" id="8480630">&#34;foo&nbsp;bar&#34;</span><span class="op" id="8480639">,</span>&nbsp;<span class="string" id="8480641">&#34;Foo-Bar&#34;</span><span class="op" id="8480650">}</span><span class="op" id="8480651">,</span><br>
<span class="lineno"></span><span class="op" id="8480653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480656">func</span>&nbsp;<span class="ident" id="8480661">TestCanonicalMIMEHeaderKey</span><span class="op" id="8480687">(</span><span class="ident" id="8480688">t</span>&nbsp;<span class="op" id="8480690">*</span><span class="ident" id="8480691">testing</span><span class="op" id="8480698">.</span><span class="ident" id="8480699">T</span><span class="op" id="8480700">)</span>&nbsp;<span class="op" id="8480702">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480705">for</span>&nbsp;<span class="ident" id="8480709">_</span><span class="op" id="8480710">,</span>&nbsp;<span class="ident" id="8480712">tt</span>&nbsp;<span class="op" id="8480715">:=</span>&nbsp;<span class="keyword" id="8480718">range</span>&nbsp;<span class="ident" id="8480724">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8480748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480752">if</span>&nbsp;<span class="ident" id="8480755">s</span>&nbsp;<span class="op" id="8480757">:=</span>&nbsp;<span class="ident" id="8480760">CanonicalMIMEHeaderKey</span><span class="op" id="8480782">(</span><span class="ident" id="8480783">tt</span><span class="op" id="8480785">.</span><span class="ident" id="8480786">in</span><span class="op" id="8480788">)</span><span class="op" id="8480789">;</span>&nbsp;<span class="ident" id="8480791">s</span>&nbsp;<span class="op" id="8480793">!=</span>&nbsp;<span class="ident" id="8480796">tt</span><span class="op" id="8480798">.</span><span class="ident" id="8480799">out</span>&nbsp;<span class="op" id="8480803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480808">t</span><span class="op" id="8480809">.</span><span class="ident" id="8480810">Errorf</span><span class="op" id="8480816">(</span><span class="string" id="8480817">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8480859">,</span>&nbsp;<span class="ident" id="8480861">tt</span><span class="op" id="8480863">.</span><span class="ident" id="8480864">in</span><span class="op" id="8480866">,</span>&nbsp;<span class="ident" id="8480868">s</span><span class="op" id="8480869">,</span>&nbsp;<span class="ident" id="8480871">tt</span><span class="op" id="8480873">.</span><span class="ident" id="8480874">out</span><span class="op" id="8480877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480884">}</span><br>
<span class="lineno">40</span><span class="op" id="8480886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480889">func</span>&nbsp;<span class="ident" id="8480894">reader</span><span class="op" id="8480900">(</span><span class="ident" id="8480901">s</span>&nbsp;<span class="builtintype" id="8480903">string</span><span class="op" id="8480909">)</span>&nbsp;<span class="op" id="8480911">*</span><span class="ident" id="8480912">Reader</span>&nbsp;<span class="op" id="8480919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480922">return</span>&nbsp;<span class="ident" id="8480929">NewReader</span><span class="op" id="8480938">(</span><span class="ident" id="8480939">bufio</span><span class="op" id="8480944">.</span><span class="ident" id="8480945">NewReader</span><span class="op" id="8480954">(</span><span class="ident" id="8480955">strings</span><span class="op" id="8480962">.</span><span class="ident" id="8480963">NewReader</span><span class="op" id="8480972">(</span><span class="ident" id="8480973">s</span><span class="op" id="8480974">)</span><span class="op" id="8480975">)</span><span class="op" id="8480976">)</span><br>
<span class="lineno"></span><span class="op" id="8480978">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8480981">func</span>&nbsp;<span class="ident" id="8480986">TestReadLine</span><span class="op" id="8480998">(</span><span class="ident" id="8480999">t</span>&nbsp;<span class="op" id="8481001">*</span><span class="ident" id="8481002">testing</span><span class="op" id="8481009">.</span><span class="ident" id="8481010">T</span><span class="op" id="8481011">)</span>&nbsp;<span class="op" id="8481013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481016">r</span>&nbsp;<span class="op" id="8481018">:=</span>&nbsp;<span class="ident" id="8481021">reader</span><span class="op" id="8481027">(</span><span class="string" id="8481028">&#34;line1\nline2\n&#34;</span><span class="op" id="8481044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481047">s</span><span class="op" id="8481048">,</span>&nbsp;<span class="ident" id="8481050">err</span>&nbsp;<span class="op" id="8481054">:=</span>&nbsp;<span class="ident" id="8481057">r</span><span class="op" id="8481058">.</span><span class="ident" id="8481059">ReadLine</span><span class="op" id="8481067">(</span><span class="op" id="8481068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481071">if</span>&nbsp;<span class="ident" id="8481074">s</span>&nbsp;<span class="op" id="8481076">!=</span>&nbsp;<span class="string" id="8481079">&#34;line1&#34;</span>&nbsp;<span class="op" id="8481087">||</span>&nbsp;<span class="ident" id="8481090">err</span>&nbsp;<span class="op" id="8481094">!=</span>&nbsp;<span class="ident" id="8481097">nil</span>&nbsp;<span class="op" id="8481101">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481105">t</span><span class="op" id="8481106">.</span><span class="ident" id="8481107">Fatalf</span><span class="op" id="8481113">(</span><span class="string" id="8481114">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481130">,</span>&nbsp;<span class="ident" id="8481132">s</span><span class="op" id="8481133">,</span>&nbsp;<span class="ident" id="8481135">err</span><span class="op" id="8481138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481144">s</span><span class="op" id="8481145">,</span>&nbsp;<span class="ident" id="8481147">err</span>&nbsp;<span class="op" id="8481151">=</span>&nbsp;<span class="ident" id="8481153">r</span><span class="op" id="8481154">.</span><span class="ident" id="8481155">ReadLine</span><span class="op" id="8481163">(</span><span class="op" id="8481164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481167">if</span>&nbsp;<span class="ident" id="8481170">s</span>&nbsp;<span class="op" id="8481172">!=</span>&nbsp;<span class="string" id="8481175">&#34;line2&#34;</span>&nbsp;<span class="op" id="8481183">||</span>&nbsp;<span class="ident" id="8481186">err</span>&nbsp;<span class="op" id="8481190">!=</span>&nbsp;<span class="ident" id="8481193">nil</span>&nbsp;<span class="op" id="8481197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481201">t</span><span class="op" id="8481202">.</span><span class="ident" id="8481203">Fatalf</span><span class="op" id="8481209">(</span><span class="string" id="8481210">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481226">,</span>&nbsp;<span class="ident" id="8481228">s</span><span class="op" id="8481229">,</span>&nbsp;<span class="ident" id="8481231">err</span><span class="op" id="8481234">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481240">s</span><span class="op" id="8481241">,</span>&nbsp;<span class="ident" id="8481243">err</span>&nbsp;<span class="op" id="8481247">=</span>&nbsp;<span class="ident" id="8481249">r</span><span class="op" id="8481250">.</span><span class="ident" id="8481251">ReadLine</span><span class="op" id="8481259">(</span><span class="op" id="8481260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481263">if</span>&nbsp;<span class="ident" id="8481266">s</span>&nbsp;<span class="op" id="8481268">!=</span>&nbsp;<span class="string" id="8481271">&#34;&#34;</span>&nbsp;<span class="op" id="8481274">||</span>&nbsp;<span class="ident" id="8481277">err</span>&nbsp;<span class="op" id="8481281">!=</span>&nbsp;<span class="ident" id="8481284">io</span><span class="op" id="8481286">.</span><span class="ident" id="8481287">EOF</span>&nbsp;<span class="op" id="8481291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481295">t</span><span class="op" id="8481296">.</span><span class="ident" id="8481297">Fatalf</span><span class="op" id="8481303">(</span><span class="string" id="8481304">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481317">,</span>&nbsp;<span class="ident" id="8481319">s</span><span class="op" id="8481320">,</span>&nbsp;<span class="ident" id="8481322">err</span><span class="op" id="8481325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481328">}</span><br>
<span class="lineno">60</span><span class="op" id="8481330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481333">func</span>&nbsp;<span class="ident" id="8481338">TestReadContinuedLine</span><span class="op" id="8481359">(</span><span class="ident" id="8481360">t</span>&nbsp;<span class="op" id="8481362">*</span><span class="ident" id="8481363">testing</span><span class="op" id="8481370">.</span><span class="ident" id="8481371">T</span><span class="op" id="8481372">)</span>&nbsp;<span class="op" id="8481374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481377">r</span>&nbsp;<span class="op" id="8481379">:=</span>&nbsp;<span class="ident" id="8481382">reader</span><span class="op" id="8481388">(</span><span class="string" id="8481389">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="8481415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481418">s</span><span class="op" id="8481419">,</span>&nbsp;<span class="ident" id="8481421">err</span>&nbsp;<span class="op" id="8481425">:=</span>&nbsp;<span class="ident" id="8481428">r</span><span class="op" id="8481429">.</span><span class="ident" id="8481430">ReadContinuedLine</span><span class="op" id="8481447">(</span><span class="op" id="8481448">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481451">if</span>&nbsp;<span class="ident" id="8481454">s</span>&nbsp;<span class="op" id="8481456">!=</span>&nbsp;<span class="string" id="8481459">&#34;line1&#34;</span>&nbsp;<span class="op" id="8481467">||</span>&nbsp;<span class="ident" id="8481470">err</span>&nbsp;<span class="op" id="8481474">!=</span>&nbsp;<span class="ident" id="8481477">nil</span>&nbsp;<span class="op" id="8481481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481485">t</span><span class="op" id="8481486">.</span><span class="ident" id="8481487">Fatalf</span><span class="op" id="8481493">(</span><span class="string" id="8481494">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481510">,</span>&nbsp;<span class="ident" id="8481512">s</span><span class="op" id="8481513">,</span>&nbsp;<span class="ident" id="8481515">err</span><span class="op" id="8481518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481524">s</span><span class="op" id="8481525">,</span>&nbsp;<span class="ident" id="8481527">err</span>&nbsp;<span class="op" id="8481531">=</span>&nbsp;<span class="ident" id="8481533">r</span><span class="op" id="8481534">.</span><span class="ident" id="8481535">ReadContinuedLine</span><span class="op" id="8481552">(</span><span class="op" id="8481553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481556">if</span>&nbsp;<span class="ident" id="8481559">s</span>&nbsp;<span class="op" id="8481561">!=</span>&nbsp;<span class="string" id="8481564">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="8481573">||</span>&nbsp;<span class="ident" id="8481576">err</span>&nbsp;<span class="op" id="8481580">!=</span>&nbsp;<span class="ident" id="8481583">nil</span>&nbsp;<span class="op" id="8481587">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481591">t</span><span class="op" id="8481592">.</span><span class="ident" id="8481593">Fatalf</span><span class="op" id="8481599">(</span><span class="string" id="8481600">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481616">,</span>&nbsp;<span class="ident" id="8481618">s</span><span class="op" id="8481619">,</span>&nbsp;<span class="ident" id="8481621">err</span><span class="op" id="8481624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481630">s</span><span class="op" id="8481631">,</span>&nbsp;<span class="ident" id="8481633">err</span>&nbsp;<span class="op" id="8481637">=</span>&nbsp;<span class="ident" id="8481639">r</span><span class="op" id="8481640">.</span><span class="ident" id="8481641">ReadContinuedLine</span><span class="op" id="8481658">(</span><span class="op" id="8481659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481662">if</span>&nbsp;<span class="ident" id="8481665">s</span>&nbsp;<span class="op" id="8481667">!=</span>&nbsp;<span class="string" id="8481670">&#34;line3&#34;</span>&nbsp;<span class="op" id="8481678">||</span>&nbsp;<span class="ident" id="8481681">err</span>&nbsp;<span class="op" id="8481685">!=</span>&nbsp;<span class="ident" id="8481688">nil</span>&nbsp;<span class="op" id="8481692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481696">t</span><span class="op" id="8481697">.</span><span class="ident" id="8481698">Fatalf</span><span class="op" id="8481704">(</span><span class="string" id="8481705">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481721">,</span>&nbsp;<span class="ident" id="8481723">s</span><span class="op" id="8481724">,</span>&nbsp;<span class="ident" id="8481726">err</span><span class="op" id="8481729">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481735">s</span><span class="op" id="8481736">,</span>&nbsp;<span class="ident" id="8481738">err</span>&nbsp;<span class="op" id="8481742">=</span>&nbsp;<span class="ident" id="8481744">r</span><span class="op" id="8481745">.</span><span class="ident" id="8481746">ReadContinuedLine</span><span class="op" id="8481763">(</span><span class="op" id="8481764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481767">if</span>&nbsp;<span class="ident" id="8481770">s</span>&nbsp;<span class="op" id="8481772">!=</span>&nbsp;<span class="string" id="8481775">&#34;&#34;</span>&nbsp;<span class="op" id="8481778">||</span>&nbsp;<span class="ident" id="8481781">err</span>&nbsp;<span class="op" id="8481785">!=</span>&nbsp;<span class="ident" id="8481788">io</span><span class="op" id="8481790">.</span><span class="ident" id="8481791">EOF</span>&nbsp;<span class="op" id="8481795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481799">t</span><span class="op" id="8481800">.</span><span class="ident" id="8481801">Fatalf</span><span class="op" id="8481807">(</span><span class="string" id="8481808">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481821">,</span>&nbsp;<span class="ident" id="8481823">s</span><span class="op" id="8481824">,</span>&nbsp;<span class="ident" id="8481826">err</span><span class="op" id="8481829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481832">}</span><br>
<span class="lineno">80</span><span class="op" id="8481834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481837">func</span>&nbsp;<span class="ident" id="8481842">TestReadCodeLine</span><span class="op" id="8481858">(</span><span class="ident" id="8481859">t</span>&nbsp;<span class="op" id="8481861">*</span><span class="ident" id="8481862">testing</span><span class="op" id="8481869">.</span><span class="ident" id="8481870">T</span><span class="op" id="8481871">)</span>&nbsp;<span class="op" id="8481873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481876">r</span>&nbsp;<span class="op" id="8481878">:=</span>&nbsp;<span class="ident" id="8481881">reader</span><span class="op" id="8481887">(</span><span class="string" id="8481888">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="8481919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481922">code</span><span class="op" id="8481926">,</span>&nbsp;<span class="ident" id="8481928">msg</span><span class="op" id="8481931">,</span>&nbsp;<span class="ident" id="8481933">err</span>&nbsp;<span class="op" id="8481937">:=</span>&nbsp;<span class="ident" id="8481940">r</span><span class="op" id="8481941">.</span><span class="ident" id="8481942">ReadCodeLine</span><span class="op" id="8481954">(</span><span class="num" id="8481955">0</span><span class="op" id="8481956">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481959">if</span>&nbsp;<span class="ident" id="8481962">code</span>&nbsp;<span class="op" id="8481967">!=</span>&nbsp;<span class="num" id="8481970">123</span>&nbsp;<span class="op" id="8481974">||</span>&nbsp;<span class="ident" id="8481977">msg</span>&nbsp;<span class="op" id="8481981">!=</span>&nbsp;<span class="string" id="8481984">&#34;hi&#34;</span>&nbsp;<span class="op" id="8481989">||</span>&nbsp;<span class="ident" id="8481992">err</span>&nbsp;<span class="op" id="8481996">!=</span>&nbsp;<span class="ident" id="8481999">nil</span>&nbsp;<span class="op" id="8482003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482007">t</span><span class="op" id="8482008">.</span><span class="ident" id="8482009">Fatalf</span><span class="op" id="8482015">(</span><span class="string" id="8482016">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8482036">,</span>&nbsp;<span class="ident" id="8482038">code</span><span class="op" id="8482042">,</span>&nbsp;<span class="ident" id="8482044">msg</span><span class="op" id="8482047">,</span>&nbsp;<span class="ident" id="8482049">err</span><span class="op" id="8482052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482058">code</span><span class="op" id="8482062">,</span>&nbsp;<span class="ident" id="8482064">msg</span><span class="op" id="8482067">,</span>&nbsp;<span class="ident" id="8482069">err</span>&nbsp;<span class="op" id="8482073">=</span>&nbsp;<span class="ident" id="8482075">r</span><span class="op" id="8482076">.</span><span class="ident" id="8482077">ReadCodeLine</span><span class="op" id="8482089">(</span><span class="num" id="8482090">23</span><span class="op" id="8482092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482095">if</span>&nbsp;<span class="ident" id="8482098">code</span>&nbsp;<span class="op" id="8482103">!=</span>&nbsp;<span class="num" id="8482106">234</span>&nbsp;<span class="op" id="8482110">||</span>&nbsp;<span class="ident" id="8482113">msg</span>&nbsp;<span class="op" id="8482117">!=</span>&nbsp;<span class="string" id="8482120">&#34;bye&#34;</span>&nbsp;<span class="op" id="8482126">||</span>&nbsp;<span class="ident" id="8482129">err</span>&nbsp;<span class="op" id="8482133">!=</span>&nbsp;<span class="ident" id="8482136">nil</span>&nbsp;<span class="op" id="8482140">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482144">t</span><span class="op" id="8482145">.</span><span class="ident" id="8482146">Fatalf</span><span class="op" id="8482152">(</span><span class="string" id="8482153">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8482173">,</span>&nbsp;<span class="ident" id="8482175">code</span><span class="op" id="8482179">,</span>&nbsp;<span class="ident" id="8482181">msg</span><span class="op" id="8482184">,</span>&nbsp;<span class="ident" id="8482186">err</span><span class="op" id="8482189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482195">code</span><span class="op" id="8482199">,</span>&nbsp;<span class="ident" id="8482201">msg</span><span class="op" id="8482204">,</span>&nbsp;<span class="ident" id="8482206">err</span>&nbsp;<span class="op" id="8482210">=</span>&nbsp;<span class="ident" id="8482212">r</span><span class="op" id="8482213">.</span><span class="ident" id="8482214">ReadCodeLine</span><span class="op" id="8482226">(</span><span class="num" id="8482227">346</span><span class="op" id="8482230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482233">if</span>&nbsp;<span class="ident" id="8482236">code</span>&nbsp;<span class="op" id="8482241">!=</span>&nbsp;<span class="num" id="8482244">345</span>&nbsp;<span class="op" id="8482248">||</span>&nbsp;<span class="ident" id="8482251">msg</span>&nbsp;<span class="op" id="8482255">!=</span>&nbsp;<span class="string" id="8482258">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="8482267">||</span>&nbsp;<span class="ident" id="8482270">err</span>&nbsp;<span class="op" id="8482274">==</span>&nbsp;<span class="ident" id="8482277">nil</span>&nbsp;<span class="op" id="8482281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482285">t</span><span class="op" id="8482286">.</span><span class="ident" id="8482287">Fatalf</span><span class="op" id="8482293">(</span><span class="string" id="8482294">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8482314">,</span>&nbsp;<span class="ident" id="8482316">code</span><span class="op" id="8482320">,</span>&nbsp;<span class="ident" id="8482322">msg</span><span class="op" id="8482325">,</span>&nbsp;<span class="ident" id="8482327">err</span><span class="op" id="8482330">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482336">if</span>&nbsp;<span class="ident" id="8482339">e</span><span class="op" id="8482340">,</span>&nbsp;<span class="ident" id="8482342">ok</span>&nbsp;<span class="op" id="8482345">:=</span>&nbsp;<span class="ident" id="8482348">err</span><span class="op" id="8482351">.</span><span class="op" id="8482352">(</span><span class="op" id="8482353">*</span><span class="ident" id="8482354">Error</span><span class="op" id="8482359">)</span><span class="op" id="8482360">;</span>&nbsp;<span class="op" id="8482362">!</span><span class="ident" id="8482363">ok</span>&nbsp;<span class="op" id="8482366">||</span>&nbsp;<span class="ident" id="8482369">e</span><span class="op" id="8482370">.</span><span class="ident" id="8482371">Code</span>&nbsp;<span class="op" id="8482376">!=</span>&nbsp;<span class="ident" id="8482379">code</span>&nbsp;<span class="op" id="8482384">||</span>&nbsp;<span class="ident" id="8482387">e</span><span class="op" id="8482388">.</span><span class="ident" id="8482389">Msg</span>&nbsp;<span class="op" id="8482393">!=</span>&nbsp;<span class="ident" id="8482396">msg</span>&nbsp;<span class="op" id="8482400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482404">t</span><span class="op" id="8482405">.</span><span class="ident" id="8482406">Fatalf</span><span class="op" id="8482412">(</span><span class="string" id="8482413">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="8482439">,</span>&nbsp;<span class="ident" id="8482441">err</span><span class="op" id="8482444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482450">code</span><span class="op" id="8482454">,</span>&nbsp;<span class="ident" id="8482456">msg</span><span class="op" id="8482459">,</span>&nbsp;<span class="ident" id="8482461">err</span>&nbsp;<span class="op" id="8482465">=</span>&nbsp;<span class="ident" id="8482467">r</span><span class="op" id="8482468">.</span><span class="ident" id="8482469">ReadCodeLine</span><span class="op" id="8482481">(</span><span class="num" id="8482482">1</span><span class="op" id="8482483">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482486">if</span>&nbsp;<span class="ident" id="8482489">code</span>&nbsp;<span class="op" id="8482494">!=</span>&nbsp;<span class="num" id="8482497">0</span>&nbsp;<span class="op" id="8482499">||</span>&nbsp;<span class="ident" id="8482502">msg</span>&nbsp;<span class="op" id="8482506">!=</span>&nbsp;<span class="string" id="8482509">&#34;&#34;</span>&nbsp;<span class="op" id="8482512">||</span>&nbsp;<span class="ident" id="8482515">err</span>&nbsp;<span class="op" id="8482519">!=</span>&nbsp;<span class="ident" id="8482522">io</span><span class="op" id="8482524">.</span><span class="ident" id="8482525">EOF</span>&nbsp;<span class="op" id="8482529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482533">t</span><span class="op" id="8482534">.</span><span class="ident" id="8482535">Fatalf</span><span class="op" id="8482541">(</span><span class="string" id="8482542">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8482559">,</span>&nbsp;<span class="ident" id="8482561">code</span><span class="op" id="8482565">,</span>&nbsp;<span class="ident" id="8482567">msg</span><span class="op" id="8482570">,</span>&nbsp;<span class="ident" id="8482572">err</span><span class="op" id="8482575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482578">}</span><br>
<span class="lineno"></span><span class="op" id="8482580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8482583">func</span>&nbsp;<span class="ident" id="8482588">TestReadDotLines</span><span class="op" id="8482604">(</span><span class="ident" id="8482605">t</span>&nbsp;<span class="op" id="8482607">*</span><span class="ident" id="8482608">testing</span><span class="op" id="8482615">.</span><span class="ident" id="8482616">T</span><span class="op" id="8482617">)</span>&nbsp;<span class="op" id="8482619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482622">r</span>&nbsp;<span class="op" id="8482624">:=</span>&nbsp;<span class="ident" id="8482627">reader</span><span class="op" id="8482633">(</span><span class="string" id="8482634">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="8482697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482700">s</span><span class="op" id="8482701">,</span>&nbsp;<span class="ident" id="8482703">err</span>&nbsp;<span class="op" id="8482707">:=</span>&nbsp;<span class="ident" id="8482710">r</span><span class="op" id="8482711">.</span><span class="ident" id="8482712">ReadDotLines</span><span class="op" id="8482724">(</span><span class="op" id="8482725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482728">want</span>&nbsp;<span class="op" id="8482733">:=</span>&nbsp;<span class="op" id="8482736">[</span><span class="op" id="8482737">]</span><span class="builtintype" id="8482738">string</span><span class="op" id="8482744">{</span><span class="string" id="8482745">&#34;dotlines&#34;</span><span class="op" id="8482755">,</span>&nbsp;<span class="string" id="8482757">&#34;foo&#34;</span><span class="op" id="8482762">,</span>&nbsp;<span class="string" id="8482764">&#34;.bar&#34;</span><span class="op" id="8482770">,</span>&nbsp;<span class="string" id="8482772">&#34;..baz&#34;</span><span class="op" id="8482779">,</span>&nbsp;<span class="string" id="8482781">&#34;quux&#34;</span><span class="op" id="8482787">,</span>&nbsp;<span class="string" id="8482789">&#34;&#34;</span><span class="op" id="8482791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482794">if</span>&nbsp;<span class="op" id="8482797">!</span><span class="ident" id="8482798">reflect</span><span class="op" id="8482805">.</span><span class="ident" id="8482806">DeepEqual</span><span class="op" id="8482815">(</span><span class="ident" id="8482816">s</span><span class="op" id="8482817">,</span>&nbsp;<span class="ident" id="8482819">want</span><span class="op" id="8482823">)</span>&nbsp;<span class="op" id="8482825">||</span>&nbsp;<span class="ident" id="8482828">err</span>&nbsp;<span class="op" id="8482832">!=</span>&nbsp;<span class="ident" id="8482835">nil</span>&nbsp;<span class="op" id="8482839">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482843">t</span><span class="op" id="8482844">.</span><span class="ident" id="8482845">Fatalf</span><span class="op" id="8482851">(</span><span class="string" id="8482852">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8482874">,</span>&nbsp;<span class="ident" id="8482876">s</span><span class="op" id="8482877">,</span>&nbsp;<span class="ident" id="8482879">err</span><span class="op" id="8482882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482889">s</span><span class="op" id="8482890">,</span>&nbsp;<span class="ident" id="8482892">err</span>&nbsp;<span class="op" id="8482896">=</span>&nbsp;<span class="ident" id="8482898">r</span><span class="op" id="8482899">.</span><span class="ident" id="8482900">ReadDotLines</span><span class="op" id="8482912">(</span><span class="op" id="8482913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482916">want</span>&nbsp;<span class="op" id="8482921">=</span>&nbsp;<span class="op" id="8482923">[</span><span class="op" id="8482924">]</span><span class="builtintype" id="8482925">string</span><span class="op" id="8482931">{</span><span class="string" id="8482932">&#34;another&#34;</span><span class="op" id="8482941">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482944">if</span>&nbsp;<span class="op" id="8482947">!</span><span class="ident" id="8482948">reflect</span><span class="op" id="8482955">.</span><span class="ident" id="8482956">DeepEqual</span><span class="op" id="8482965">(</span><span class="ident" id="8482966">s</span><span class="op" id="8482967">,</span>&nbsp;<span class="ident" id="8482969">want</span><span class="op" id="8482973">)</span>&nbsp;<span class="op" id="8482975">||</span>&nbsp;<span class="ident" id="8482978">err</span>&nbsp;<span class="op" id="8482982">!=</span>&nbsp;<span class="ident" id="8482985">io</span><span class="op" id="8482987">.</span><span class="ident" id="8482988">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8483005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483009">t</span><span class="op" id="8483010">.</span><span class="ident" id="8483011">Fatalf</span><span class="op" id="8483017">(</span><span class="string" id="8483018">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8483041">,</span>&nbsp;<span class="ident" id="8483043">s</span><span class="op" id="8483044">,</span>&nbsp;<span class="ident" id="8483046">err</span><span class="op" id="8483049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483052">}</span><br>
<span class="lineno"></span><span class="op" id="8483054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8483057">func</span>&nbsp;<span class="ident" id="8483062">TestReadDotBytes</span><span class="op" id="8483078">(</span><span class="ident" id="8483079">t</span>&nbsp;<span class="op" id="8483081">*</span><span class="ident" id="8483082">testing</span><span class="op" id="8483089">.</span><span class="ident" id="8483090">T</span><span class="op" id="8483091">)</span>&nbsp;<span class="op" id="8483093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483096">r</span>&nbsp;<span class="op" id="8483098">:=</span>&nbsp;<span class="ident" id="8483101">reader</span><span class="op" id="8483107">(</span><span class="string" id="8483108">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="8483174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483177">b</span><span class="op" id="8483178">,</span>&nbsp;<span class="ident" id="8483180">err</span>&nbsp;<span class="op" id="8483184">:=</span>&nbsp;<span class="ident" id="8483187">r</span><span class="op" id="8483188">.</span><span class="ident" id="8483189">ReadDotBytes</span><span class="op" id="8483201">(</span><span class="op" id="8483202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483205">want</span>&nbsp;<span class="op" id="8483210">:=</span>&nbsp;<span class="op" id="8483213">[</span><span class="op" id="8483214">]</span><span class="builtintype" id="8483215">byte</span><span class="op" id="8483219">(</span><span class="string" id="8483220">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="8483258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483261">if</span>&nbsp;<span class="op" id="8483264">!</span><span class="ident" id="8483265">reflect</span><span class="op" id="8483272">.</span><span class="ident" id="8483273">DeepEqual</span><span class="op" id="8483282">(</span><span class="ident" id="8483283">b</span><span class="op" id="8483284">,</span>&nbsp;<span class="ident" id="8483286">want</span><span class="op" id="8483290">)</span>&nbsp;<span class="op" id="8483292">||</span>&nbsp;<span class="ident" id="8483295">err</span>&nbsp;<span class="op" id="8483299">!=</span>&nbsp;<span class="ident" id="8483302">nil</span>&nbsp;<span class="op" id="8483306">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483310">t</span><span class="op" id="8483311">.</span><span class="ident" id="8483312">Fatalf</span><span class="op" id="8483318">(</span><span class="string" id="8483319">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8483341">,</span>&nbsp;<span class="ident" id="8483343">b</span><span class="op" id="8483344">,</span>&nbsp;<span class="ident" id="8483346">err</span><span class="op" id="8483349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483356">b</span><span class="op" id="8483357">,</span>&nbsp;<span class="ident" id="8483359">err</span>&nbsp;<span class="op" id="8483363">=</span>&nbsp;<span class="ident" id="8483365">r</span><span class="op" id="8483366">.</span><span class="ident" id="8483367">ReadDotBytes</span><span class="op" id="8483379">(</span><span class="op" id="8483380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483383">want</span>&nbsp;<span class="op" id="8483388">=</span>&nbsp;<span class="op" id="8483390">[</span><span class="op" id="8483391">]</span><span class="builtintype" id="8483392">byte</span><span class="op" id="8483396">(</span><span class="string" id="8483397">&#34;anot.her\n&#34;</span><span class="op" id="8483409">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483412">if</span>&nbsp;<span class="op" id="8483415">!</span><span class="ident" id="8483416">reflect</span><span class="op" id="8483423">.</span><span class="ident" id="8483424">DeepEqual</span><span class="op" id="8483433">(</span><span class="ident" id="8483434">b</span><span class="op" id="8483435">,</span>&nbsp;<span class="ident" id="8483437">want</span><span class="op" id="8483441">)</span>&nbsp;<span class="op" id="8483443">||</span>&nbsp;<span class="ident" id="8483446">err</span>&nbsp;<span class="op" id="8483450">!=</span>&nbsp;<span class="ident" id="8483453">io</span><span class="op" id="8483455">.</span><span class="ident" id="8483456">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8483473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483477">t</span><span class="op" id="8483478">.</span><span class="ident" id="8483479">Fatalf</span><span class="op" id="8483485">(</span><span class="string" id="8483486">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8483509">,</span>&nbsp;<span class="ident" id="8483511">b</span><span class="op" id="8483512">,</span>&nbsp;<span class="ident" id="8483514">err</span><span class="op" id="8483517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483520">}</span><br>
<span class="lineno"></span><span class="op" id="8483522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="8483525">func</span>&nbsp;<span class="ident" id="8483530">TestReadMIMEHeader</span><span class="op" id="8483548">(</span><span class="ident" id="8483549">t</span>&nbsp;<span class="op" id="8483551">*</span><span class="ident" id="8483552">testing</span><span class="op" id="8483559">.</span><span class="ident" id="8483560">T</span><span class="op" id="8483561">)</span>&nbsp;<span class="op" id="8483563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483566">r</span>&nbsp;<span class="op" id="8483568">:=</span>&nbsp;<span class="ident" id="8483571">reader</span><span class="op" id="8483577">(</span><span class="string" id="8483578">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="8483656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483659">m</span><span class="op" id="8483660">,</span>&nbsp;<span class="ident" id="8483662">err</span>&nbsp;<span class="op" id="8483666">:=</span>&nbsp;<span class="ident" id="8483669">r</span><span class="op" id="8483670">.</span><span class="ident" id="8483671">ReadMIMEHeader</span><span class="op" id="8483685">(</span><span class="op" id="8483686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483689">want</span>&nbsp;<span class="op" id="8483694">:=</span>&nbsp;<span class="ident" id="8483697">MIMEHeader</span><span class="op" id="8483707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8483711">&#34;My-Key&#34;</span><span class="op" id="8483719">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8483723">{</span><span class="string" id="8483724">&#34;Value&nbsp;1&#34;</span><span class="op" id="8483733">,</span>&nbsp;<span class="string" id="8483735">&#34;Value&nbsp;2&#34;</span><span class="op" id="8483744">}</span><span class="op" id="8483745">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8483749">&#34;Long-Key&#34;</span><span class="op" id="8483759">:</span>&nbsp;<span class="op" id="8483761">{</span><span class="string" id="8483762">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="8483781">}</span><span class="op" id="8483782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483788">if</span>&nbsp;<span class="op" id="8483791">!</span><span class="ident" id="8483792">reflect</span><span class="op" id="8483799">.</span><span class="ident" id="8483800">DeepEqual</span><span class="op" id="8483809">(</span><span class="ident" id="8483810">m</span><span class="op" id="8483811">,</span>&nbsp;<span class="ident" id="8483813">want</span><span class="op" id="8483817">)</span>&nbsp;<span class="op" id="8483819">||</span>&nbsp;<span class="ident" id="8483822">err</span>&nbsp;<span class="op" id="8483826">!=</span>&nbsp;<span class="ident" id="8483829">nil</span>&nbsp;<span class="op" id="8483833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483837">t</span><span class="op" id="8483838">.</span><span class="ident" id="8483839">Fatalf</span><span class="op" id="8483845">(</span><span class="string" id="8483846">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8483879">,</span>&nbsp;<span class="ident" id="8483881">m</span><span class="op" id="8483882">,</span>&nbsp;<span class="ident" id="8483884">err</span><span class="op" id="8483887">,</span>&nbsp;<span class="ident" id="8483889">want</span><span class="op" id="8483893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483896">}</span><br>
<span class="lineno">145</span><span class="op" id="8483898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8483901">func</span>&nbsp;<span class="ident" id="8483906">TestReadMIMEHeaderSingle</span><span class="op" id="8483930">(</span><span class="ident" id="8483931">t</span>&nbsp;<span class="op" id="8483933">*</span><span class="ident" id="8483934">testing</span><span class="op" id="8483941">.</span><span class="ident" id="8483942">T</span><span class="op" id="8483943">)</span>&nbsp;<span class="op" id="8483945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483948">r</span>&nbsp;<span class="op" id="8483950">:=</span>&nbsp;<span class="ident" id="8483953">reader</span><span class="op" id="8483959">(</span><span class="string" id="8483960">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="8483974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483977">m</span><span class="op" id="8483978">,</span>&nbsp;<span class="ident" id="8483980">err</span>&nbsp;<span class="op" id="8483984">:=</span>&nbsp;<span class="ident" id="8483987">r</span><span class="op" id="8483988">.</span><span class="ident" id="8483989">ReadMIMEHeader</span><span class="op" id="8484003">(</span><span class="op" id="8484004">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484007">want</span>&nbsp;<span class="op" id="8484012">:=</span>&nbsp;<span class="ident" id="8484015">MIMEHeader</span><span class="op" id="8484025">{</span><span class="string" id="8484026">&#34;Foo&#34;</span><span class="op" id="8484031">:</span>&nbsp;<span class="op" id="8484033">{</span><span class="string" id="8484034">&#34;bar&#34;</span><span class="op" id="8484039">}</span><span class="op" id="8484040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484043">if</span>&nbsp;<span class="op" id="8484046">!</span><span class="ident" id="8484047">reflect</span><span class="op" id="8484054">.</span><span class="ident" id="8484055">DeepEqual</span><span class="op" id="8484064">(</span><span class="ident" id="8484065">m</span><span class="op" id="8484066">,</span>&nbsp;<span class="ident" id="8484068">want</span><span class="op" id="8484072">)</span>&nbsp;<span class="op" id="8484074">||</span>&nbsp;<span class="ident" id="8484077">err</span>&nbsp;<span class="op" id="8484081">!=</span>&nbsp;<span class="ident" id="8484084">nil</span>&nbsp;<span class="op" id="8484088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484092">t</span><span class="op" id="8484093">.</span><span class="ident" id="8484094">Fatalf</span><span class="op" id="8484100">(</span><span class="string" id="8484101">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8484134">,</span>&nbsp;<span class="ident" id="8484136">m</span><span class="op" id="8484137">,</span>&nbsp;<span class="ident" id="8484139">err</span><span class="op" id="8484142">,</span>&nbsp;<span class="ident" id="8484144">want</span><span class="op" id="8484148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484151">}</span><br>
<span class="lineno"></span><span class="op" id="8484153">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8484156">func</span>&nbsp;<span class="ident" id="8484161">TestLargeReadMIMEHeader</span><span class="op" id="8484184">(</span><span class="ident" id="8484185">t</span>&nbsp;<span class="op" id="8484187">*</span><span class="ident" id="8484188">testing</span><span class="op" id="8484195">.</span><span class="ident" id="8484196">T</span><span class="op" id="8484197">)</span>&nbsp;<span class="op" id="8484199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484202">data</span>&nbsp;<span class="op" id="8484207">:=</span>&nbsp;<span class="builtinfunc" id="8484210">make</span><span class="op" id="8484214">(</span><span class="op" id="8484215">[</span><span class="op" id="8484216">]</span><span class="builtintype" id="8484217">byte</span><span class="op" id="8484221">,</span>&nbsp;<span class="num" id="8484223">16</span><span class="op" id="8484225">*</span><span class="num" id="8484226">1024</span><span class="op" id="8484230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484233">for</span>&nbsp;<span class="ident" id="8484237">i</span>&nbsp;<span class="op" id="8484239">:=</span>&nbsp;<span class="num" id="8484242">0</span><span class="op" id="8484243">;</span>&nbsp;<span class="ident" id="8484245">i</span>&nbsp;<span class="op" id="8484247">&lt;</span>&nbsp;<span class="builtinfunc" id="8484249">len</span><span class="op" id="8484252">(</span><span class="ident" id="8484253">data</span><span class="op" id="8484257">)</span><span class="op" id="8484258">;</span>&nbsp;<span class="ident" id="8484260">i</span><span class="op" id="8484261">++</span>&nbsp;<span class="op" id="8484264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484268">data</span><span class="op" id="8484272">[</span><span class="ident" id="8484273">i</span><span class="op" id="8484274">]</span>&nbsp;<span class="op" id="8484276">=</span>&nbsp;<span class="string" id="8484278">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484286">sdata</span>&nbsp;<span class="op" id="8484292">:=</span>&nbsp;<span class="builtintype" id="8484295">string</span><span class="op" id="8484301">(</span><span class="ident" id="8484302">data</span><span class="op" id="8484306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484309">r</span>&nbsp;<span class="op" id="8484311">:=</span>&nbsp;<span class="ident" id="8484314">reader</span><span class="op" id="8484320">(</span><span class="string" id="8484321">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="8484332">+</span>&nbsp;<span class="ident" id="8484334">sdata</span>&nbsp;<span class="op" id="8484340">+</span>&nbsp;<span class="string" id="8484342">&#34;\r\n\n&#34;</span><span class="op" id="8484350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484353">m</span><span class="op" id="8484354">,</span>&nbsp;<span class="ident" id="8484356">err</span>&nbsp;<span class="op" id="8484360">:=</span>&nbsp;<span class="ident" id="8484363">r</span><span class="op" id="8484364">.</span><span class="ident" id="8484365">ReadMIMEHeader</span><span class="op" id="8484379">(</span><span class="op" id="8484380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484383">if</span>&nbsp;<span class="ident" id="8484386">err</span>&nbsp;<span class="op" id="8484390">!=</span>&nbsp;<span class="ident" id="8484393">nil</span>&nbsp;<span class="op" id="8484397">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484401">t</span><span class="op" id="8484402">.</span><span class="ident" id="8484403">Fatalf</span><span class="op" id="8484409">(</span><span class="string" id="8484410">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="8484430">,</span>&nbsp;<span class="ident" id="8484432">err</span><span class="op" id="8484435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484441">cookie</span>&nbsp;<span class="op" id="8484448">:=</span>&nbsp;<span class="ident" id="8484451">m</span><span class="op" id="8484452">.</span><span class="ident" id="8484453">Get</span><span class="op" id="8484456">(</span><span class="string" id="8484457">&#34;Cookie&#34;</span><span class="op" id="8484465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484468">if</span>&nbsp;<span class="ident" id="8484471">cookie</span>&nbsp;<span class="op" id="8484478">!=</span>&nbsp;<span class="ident" id="8484481">sdata</span>&nbsp;<span class="op" id="8484487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484491">t</span><span class="op" id="8484492">.</span><span class="ident" id="8484493">Fatalf</span><span class="op" id="8484499">(</span><span class="string" id="8484500">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="8484541">,</span>&nbsp;<span class="builtinfunc" id="8484543">len</span><span class="op" id="8484546">(</span><span class="ident" id="8484547">cookie</span><span class="op" id="8484553">)</span><span class="op" id="8484554">,</span>&nbsp;<span class="builtinfunc" id="8484556">len</span><span class="op" id="8484559">(</span><span class="ident" id="8484560">sdata</span><span class="op" id="8484565">)</span><span class="op" id="8484566">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484569">}</span><br>
<span class="lineno"></span><span class="op" id="8484571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8484574">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="8484641">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="8484691">func</span>&nbsp;<span class="ident" id="8484696">TestReadMIMEHeaderNonCompliant</span><span class="op" id="8484726">(</span><span class="ident" id="8484727">t</span>&nbsp;<span class="op" id="8484729">*</span><span class="ident" id="8484730">testing</span><span class="op" id="8484737">.</span><span class="ident" id="8484738">T</span><span class="op" id="8484739">)</span>&nbsp;<span class="op" id="8484741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8484744">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8484805">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484870">r</span>&nbsp;<span class="op" id="8484872">:=</span>&nbsp;<span class="ident" id="8484875">reader</span><span class="op" id="8484881">(</span><span class="string" id="8484882">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="8484897">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8484901">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="8484928">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8484932">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="8484946">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8484950">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="8484974">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8484978">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="8485003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485006">m</span><span class="op" id="8485007">,</span>&nbsp;<span class="ident" id="8485009">err</span>&nbsp;<span class="op" id="8485013">:=</span>&nbsp;<span class="ident" id="8485016">r</span><span class="op" id="8485017">.</span><span class="ident" id="8485018">ReadMIMEHeader</span><span class="op" id="8485032">(</span><span class="op" id="8485033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485036">want</span>&nbsp;<span class="op" id="8485041">:=</span>&nbsp;<span class="ident" id="8485044">MIMEHeader</span><span class="op" id="8485054">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485058">&#34;Foo&#34;</span><span class="op" id="8485063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485078">{</span><span class="string" id="8485079">&#34;bar&#34;</span><span class="op" id="8485084">}</span><span class="op" id="8485085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485089">&#34;Content-Language&#34;</span><span class="op" id="8485107">:</span>&nbsp;<span class="op" id="8485109">{</span><span class="string" id="8485110">&#34;en&#34;</span><span class="op" id="8485114">}</span><span class="op" id="8485115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485119">&#34;Sid&#34;</span><span class="op" id="8485124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485139">{</span><span class="string" id="8485140">&#34;0&#34;</span><span class="op" id="8485143">}</span><span class="op" id="8485144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485148">&#34;Audio-Mode&#34;</span><span class="op" id="8485160">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485168">{</span><span class="string" id="8485169">&#34;None&#34;</span><span class="op" id="8485175">}</span><span class="op" id="8485176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485180">&#34;Privilege&#34;</span><span class="op" id="8485191">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485200">{</span><span class="string" id="8485201">&#34;127&#34;</span><span class="op" id="8485206">}</span><span class="op" id="8485207">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485213">if</span>&nbsp;<span class="op" id="8485216">!</span><span class="ident" id="8485217">reflect</span><span class="op" id="8485224">.</span><span class="ident" id="8485225">DeepEqual</span><span class="op" id="8485234">(</span><span class="ident" id="8485235">m</span><span class="op" id="8485236">,</span>&nbsp;<span class="ident" id="8485238">want</span><span class="op" id="8485242">)</span>&nbsp;<span class="op" id="8485244">||</span>&nbsp;<span class="ident" id="8485247">err</span>&nbsp;<span class="op" id="8485251">!=</span>&nbsp;<span class="ident" id="8485254">nil</span>&nbsp;<span class="op" id="8485258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485262">t</span><span class="op" id="8485263">.</span><span class="ident" id="8485264">Fatalf</span><span class="op" id="8485270">(</span><span class="string" id="8485271">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="8485308">,</span>&nbsp;<span class="ident" id="8485310">m</span><span class="op" id="8485311">,</span>&nbsp;<span class="ident" id="8485313">err</span><span class="op" id="8485316">,</span>&nbsp;<span class="ident" id="8485318">want</span><span class="op" id="8485322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485325">}</span><br>
<span class="lineno"></span><span class="op" id="8485327">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="8485330">type</span>&nbsp;<span class="ident" id="8485335">readResponseTest</span>&nbsp;<span class="keyword" id="8485352">struct</span>&nbsp;<span class="op" id="8485359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485362">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8485371">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485379">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8485388">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485393">wantCode</span>&nbsp;<span class="builtintype" id="8485402">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485407">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="8485416">string</span><br>
<span class="lineno"></span><span class="op" id="8485423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8485426">var</span>&nbsp;<span class="ident" id="8485430">readResponseTests</span>&nbsp;<span class="op" id="8485448">=</span>&nbsp;<span class="op" id="8485450">[</span><span class="op" id="8485451">]</span><span class="ident" id="8485452">readResponseTest</span><span class="op" id="8485468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485471">{</span><span class="string" id="8485472">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="8485525">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485529">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="8485559">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485563">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="8485576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485580">23</span><span class="op" id="8485582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485586">230</span><span class="op" id="8485589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485593">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="8485675">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485678">}</span><span class="op" id="8485679">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485683">{</span><span class="string" id="8485684">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="8485736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485740">23</span><span class="op" id="8485742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485746">230</span><span class="op" id="8485749">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485753">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="8485799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485802">}</span><span class="op" id="8485803">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485807">{</span><span class="string" id="8485808">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="8485829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485833">4</span><span class="op" id="8485834">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485838">400</span><span class="op" id="8485841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485845">&#34;A\nB\nC&#34;</span><span class="op" id="8485854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485857">}</span><span class="op" id="8485858">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485862">{</span><span class="string" id="8485863">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="8485892">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485896">4</span><span class="op" id="8485897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8485901">400</span><span class="op" id="8485904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8485908">&#34;A\nB\nC&#34;</span><span class="op" id="8485917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485920">}</span><span class="op" id="8485921">,</span><br>
<span class="lineno"></span><span class="op" id="8485923">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="8485926">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="8485977">func</span>&nbsp;<span class="ident" id="8485982">TestRFC959Lines</span><span class="op" id="8485997">(</span><span class="ident" id="8485998">t</span>&nbsp;<span class="op" id="8486000">*</span><span class="ident" id="8486001">testing</span><span class="op" id="8486008">.</span><span class="ident" id="8486009">T</span><span class="op" id="8486010">)</span>&nbsp;<span class="op" id="8486012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486015">for</span>&nbsp;<span class="ident" id="8486019">i</span><span class="op" id="8486020">,</span>&nbsp;<span class="ident" id="8486022">tt</span>&nbsp;<span class="op" id="8486025">:=</span>&nbsp;<span class="keyword" id="8486028">range</span>&nbsp;<span class="ident" id="8486034">readResponseTests</span>&nbsp;<span class="op" id="8486052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486056">r</span>&nbsp;<span class="op" id="8486058">:=</span>&nbsp;<span class="ident" id="8486061">reader</span><span class="op" id="8486067">(</span><span class="ident" id="8486068">tt</span><span class="op" id="8486070">.</span><span class="ident" id="8486071">in</span>&nbsp;<span class="op" id="8486074">+</span>&nbsp;<span class="string" id="8486076">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="8486094">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486098">code</span><span class="op" id="8486102">,</span>&nbsp;<span class="ident" id="8486104">msg</span><span class="op" id="8486107">,</span>&nbsp;<span class="ident" id="8486109">err</span>&nbsp;<span class="op" id="8486113">:=</span>&nbsp;<span class="ident" id="8486116">r</span><span class="op" id="8486117">.</span><span class="ident" id="8486118">ReadResponse</span><span class="op" id="8486130">(</span><span class="ident" id="8486131">tt</span><span class="op" id="8486133">.</span><span class="ident" id="8486134">inCode</span><span class="op" id="8486140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486144">if</span>&nbsp;<span class="ident" id="8486147">err</span>&nbsp;<span class="op" id="8486151">!=</span>&nbsp;<span class="ident" id="8486154">nil</span>&nbsp;<span class="op" id="8486158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486163">t</span><span class="op" id="8486164">.</span><span class="ident" id="8486165">Errorf</span><span class="op" id="8486171">(</span><span class="string" id="8486172">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="8486195">,</span>&nbsp;<span class="ident" id="8486197">i</span><span class="op" id="8486198">,</span>&nbsp;<span class="ident" id="8486200">err</span><span class="op" id="8486203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486208">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486219">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486223">if</span>&nbsp;<span class="ident" id="8486226">code</span>&nbsp;<span class="op" id="8486231">!=</span>&nbsp;<span class="ident" id="8486234">tt</span><span class="op" id="8486236">.</span><span class="ident" id="8486237">wantCode</span>&nbsp;<span class="op" id="8486246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486251">t</span><span class="op" id="8486252">.</span><span class="ident" id="8486253">Errorf</span><span class="op" id="8486259">(</span><span class="string" id="8486260">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8486283">,</span>&nbsp;<span class="ident" id="8486285">i</span><span class="op" id="8486286">,</span>&nbsp;<span class="ident" id="8486288">code</span><span class="op" id="8486292">,</span>&nbsp;<span class="ident" id="8486294">tt</span><span class="op" id="8486296">.</span><span class="ident" id="8486297">wantCode</span><span class="op" id="8486305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486313">if</span>&nbsp;<span class="ident" id="8486316">msg</span>&nbsp;<span class="op" id="8486320">!=</span>&nbsp;<span class="ident" id="8486323">tt</span><span class="op" id="8486325">.</span><span class="ident" id="8486326">wantMsg</span>&nbsp;<span class="op" id="8486334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486339">t</span><span class="op" id="8486340">.</span><span class="ident" id="8486341">Errorf</span><span class="op" id="8486347">(</span><span class="string" id="8486348">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8486370">,</span>&nbsp;<span class="ident" id="8486372">i</span><span class="op" id="8486373">,</span>&nbsp;<span class="ident" id="8486375">msg</span><span class="op" id="8486378">,</span>&nbsp;<span class="ident" id="8486380">tt</span><span class="op" id="8486382">.</span><span class="ident" id="8486383">wantMsg</span><span class="op" id="8486390">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486397">}</span><br>
<span class="lineno"></span><span class="op" id="8486399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486402">func</span>&nbsp;<span class="ident" id="8486407">TestCommonHeaders</span><span class="op" id="8486424">(</span><span class="ident" id="8486425">t</span>&nbsp;<span class="op" id="8486427">*</span><span class="ident" id="8486428">testing</span><span class="op" id="8486435">.</span><span class="ident" id="8486436">T</span><span class="op" id="8486437">)</span>&nbsp;<span class="op" id="8486439">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486442">for</span>&nbsp;<span class="ident" id="8486446">h</span>&nbsp;<span class="op" id="8486448">:=</span>&nbsp;<span class="keyword" id="8486451">range</span>&nbsp;<span class="ident" id="8486457">commonHeader</span>&nbsp;<span class="op" id="8486470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486474">if</span>&nbsp;<span class="ident" id="8486477">h</span>&nbsp;<span class="op" id="8486479">!=</span>&nbsp;<span class="ident" id="8486482">CanonicalMIMEHeaderKey</span><span class="op" id="8486504">(</span><span class="ident" id="8486505">h</span><span class="op" id="8486506">)</span>&nbsp;<span class="op" id="8486508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486513">t</span><span class="op" id="8486514">.</span><span class="ident" id="8486515">Errorf</span><span class="op" id="8486521">(</span><span class="string" id="8486522">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="8486563">,</span>&nbsp;<span class="ident" id="8486565">h</span><span class="op" id="8486566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486573">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486576">b</span>&nbsp;<span class="op" id="8486578">:=</span>&nbsp;<span class="op" id="8486581">[</span><span class="op" id="8486582">]</span><span class="builtintype" id="8486583">byte</span><span class="op" id="8486587">(</span><span class="string" id="8486588">&#34;content-Length&#34;</span><span class="op" id="8486604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486607">want</span>&nbsp;<span class="op" id="8486612">:=</span>&nbsp;<span class="string" id="8486615">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486633">n</span>&nbsp;<span class="op" id="8486635">:=</span>&nbsp;<span class="ident" id="8486638">testing</span><span class="op" id="8486645">.</span><span class="ident" id="8486646">AllocsPerRun</span><span class="op" id="8486658">(</span><span class="num" id="8486659">200</span><span class="op" id="8486662">,</span>&nbsp;<span class="keyword" id="8486664">func</span><span class="op" id="8486668">(</span><span class="op" id="8486669">)</span>&nbsp;<span class="op" id="8486671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486675">if</span>&nbsp;<span class="ident" id="8486678">x</span>&nbsp;<span class="op" id="8486680">:=</span>&nbsp;<span class="ident" id="8486683">canonicalMIMEHeaderKey</span><span class="op" id="8486705">(</span><span class="ident" id="8486706">b</span><span class="op" id="8486707">)</span><span class="op" id="8486708">;</span>&nbsp;<span class="ident" id="8486710">x</span>&nbsp;<span class="op" id="8486712">!=</span>&nbsp;<span class="ident" id="8486715">want</span>&nbsp;<span class="op" id="8486720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486725">t</span><span class="op" id="8486726">.</span><span class="ident" id="8486727">Fatalf</span><span class="op" id="8486733">(</span><span class="string" id="8486734">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8486776">,</span>&nbsp;<span class="ident" id="8486778">b</span><span class="op" id="8486779">,</span>&nbsp;<span class="ident" id="8486781">x</span><span class="op" id="8486782">,</span>&nbsp;<span class="ident" id="8486784">want</span><span class="op" id="8486788">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486795">}</span><span class="op" id="8486796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486799">if</span>&nbsp;<span class="ident" id="8486802">n</span>&nbsp;<span class="op" id="8486804">&gt;</span>&nbsp;<span class="num" id="8486806">0</span>&nbsp;<span class="op" id="8486808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486812">t</span><span class="op" id="8486813">.</span><span class="ident" id="8486814">Errorf</span><span class="op" id="8486820">(</span><span class="string" id="8486821">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8486865">,</span>&nbsp;<span class="ident" id="8486867">n</span><span class="op" id="8486868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486871">}</span><br>
<span class="lineno">265</span><span class="op" id="8486873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486876">var</span>&nbsp;<span class="ident" id="8486880">clientHeaders</span>&nbsp;<span class="op" id="8486894">=</span>&nbsp;<span class="ident" id="8486896">strings</span><span class="op" id="8486903">.</span><span class="ident" id="8486904">Replace</span><span class="op" id="8486911">(</span><span class="string" id="8486912">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="8487589">,</span>&nbsp;<span class="string" id="8487591">&#34;\n&#34;</span><span class="op" id="8487595">,</span>&nbsp;<span class="string" id="8487597">&#34;\r\n&#34;</span><span class="op" id="8487603">,</span>&nbsp;<span class="op" id="8487605">-</span><span class="num" id="8487606">1</span><span class="op" id="8487607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8487610">var</span>&nbsp;<span class="ident" id="8487614">serverHeaders</span>&nbsp;<span class="op" id="8487628">=</span>&nbsp;<span class="ident" id="8487630">strings</span><span class="op" id="8487637">.</span><span class="ident" id="8487638">Replace</span><span class="op" id="8487645">(</span><span class="string" id="8487646">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="8487898">,</span>&nbsp;<span class="string" id="8487900">&#34;\n&#34;</span><span class="op" id="8487904">,</span>&nbsp;<span class="string" id="8487906">&#34;\r\n&#34;</span><span class="op" id="8487912">,</span>&nbsp;<span class="op" id="8487914">-</span><span class="num" id="8487915">1</span><span class="op" id="8487916">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487919">func</span>&nbsp;<span class="ident" id="8487924">BenchmarkReadMIMEHeader</span><span class="op" id="8487947">(</span><span class="ident" id="8487948">b</span>&nbsp;<span class="op" id="8487950">*</span><span class="ident" id="8487951">testing</span><span class="op" id="8487958">.</span><span class="ident" id="8487959">B</span><span class="op" id="8487960">)</span>&nbsp;<span class="op" id="8487962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487965">b</span><span class="op" id="8487966">.</span><span class="ident" id="8487967">ReportAllocs</span><span class="op" id="8487979">(</span><span class="op" id="8487980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8487983">var</span>&nbsp;<span class="ident" id="8487987">buf</span>&nbsp;<span class="ident" id="8487991">bytes</span><span class="op" id="8487996">.</span><span class="ident" id="8487997">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488005">br</span>&nbsp;<span class="op" id="8488008">:=</span>&nbsp;<span class="ident" id="8488011">bufio</span><span class="op" id="8488016">.</span><span class="ident" id="8488017">NewReader</span><span class="op" id="8488026">(</span><span class="op" id="8488027">&amp;</span><span class="ident" id="8488028">buf</span><span class="op" id="8488031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488034">r</span>&nbsp;<span class="op" id="8488036">:=</span>&nbsp;<span class="ident" id="8488039">NewReader</span><span class="op" id="8488048">(</span><span class="ident" id="8488049">br</span><span class="op" id="8488051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488054">for</span>&nbsp;<span class="ident" id="8488058">i</span>&nbsp;<span class="op" id="8488060">:=</span>&nbsp;<span class="num" id="8488063">0</span><span class="op" id="8488064">;</span>&nbsp;<span class="ident" id="8488066">i</span>&nbsp;<span class="op" id="8488068">&lt;</span>&nbsp;<span class="ident" id="8488070">b</span><span class="op" id="8488071">.</span><span class="ident" id="8488072">N</span><span class="op" id="8488073">;</span>&nbsp;<span class="ident" id="8488075">i</span><span class="op" id="8488076">++</span>&nbsp;<span class="op" id="8488079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488083">var</span>&nbsp;<span class="ident" id="8488087">want</span>&nbsp;<span class="builtintype" id="8488092">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488098">var</span>&nbsp;<span class="ident" id="8488102">find</span>&nbsp;<span class="builtintype" id="8488107">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488116">if</span>&nbsp;<span class="op" id="8488119">(</span><span class="ident" id="8488120">i</span>&nbsp;<span class="op" id="8488122">&amp;</span>&nbsp;<span class="num" id="8488124">1</span><span class="op" id="8488125">)</span>&nbsp;<span class="op" id="8488127">==</span>&nbsp;<span class="num" id="8488130">1</span>&nbsp;<span class="op" id="8488132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488137">buf</span><span class="op" id="8488140">.</span><span class="ident" id="8488141">WriteString</span><span class="op" id="8488152">(</span><span class="ident" id="8488153">clientHeaders</span><span class="op" id="8488166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488171">want</span>&nbsp;<span class="op" id="8488176">=</span>&nbsp;<span class="num" id="8488178">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488184">find</span>&nbsp;<span class="op" id="8488189">=</span>&nbsp;<span class="string" id="8488191">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488202">}</span>&nbsp;<span class="keyword" id="8488204">else</span>&nbsp;<span class="op" id="8488209">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488214">buf</span><span class="op" id="8488217">.</span><span class="ident" id="8488218">WriteString</span><span class="op" id="8488229">(</span><span class="ident" id="8488230">serverHeaders</span><span class="op" id="8488243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488248">want</span>&nbsp;<span class="op" id="8488253">=</span>&nbsp;<span class="num" id="8488255">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488260">find</span>&nbsp;<span class="op" id="8488265">=</span>&nbsp;<span class="string" id="8488267">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488279">h</span><span class="op" id="8488280">,</span>&nbsp;<span class="ident" id="8488282">err</span>&nbsp;<span class="op" id="8488286">:=</span>&nbsp;<span class="ident" id="8488289">r</span><span class="op" id="8488290">.</span><span class="ident" id="8488291">ReadMIMEHeader</span><span class="op" id="8488305">(</span><span class="op" id="8488306">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488310">if</span>&nbsp;<span class="ident" id="8488313">err</span>&nbsp;<span class="op" id="8488317">!=</span>&nbsp;<span class="ident" id="8488320">nil</span>&nbsp;<span class="op" id="8488324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488329">b</span><span class="op" id="8488330">.</span><span class="ident" id="8488331">Fatal</span><span class="op" id="8488336">(</span><span class="ident" id="8488337">err</span><span class="op" id="8488340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488348">if</span>&nbsp;<span class="builtinfunc" id="8488351">len</span><span class="op" id="8488354">(</span><span class="ident" id="8488355">h</span><span class="op" id="8488356">)</span>&nbsp;<span class="op" id="8488358">!=</span>&nbsp;<span class="ident" id="8488361">want</span>&nbsp;<span class="op" id="8488366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488371">b</span><span class="op" id="8488372">.</span><span class="ident" id="8488373">Fatalf</span><span class="op" id="8488379">(</span><span class="string" id="8488380">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8488422">,</span>&nbsp;<span class="builtinfunc" id="8488424">len</span><span class="op" id="8488427">(</span><span class="ident" id="8488428">h</span><span class="op" id="8488429">)</span><span class="op" id="8488430">,</span>&nbsp;<span class="ident" id="8488432">want</span><span class="op" id="8488436">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488444">if</span>&nbsp;<span class="ident" id="8488447">_</span><span class="op" id="8488448">,</span>&nbsp;<span class="ident" id="8488450">ok</span>&nbsp;<span class="op" id="8488453">:=</span>&nbsp;<span class="ident" id="8488456">h</span><span class="op" id="8488457">[</span><span class="ident" id="8488458">find</span><span class="op" id="8488462">]</span><span class="op" id="8488463">;</span>&nbsp;<span class="op" id="8488465">!</span><span class="ident" id="8488466">ok</span>&nbsp;<span class="op" id="8488469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488474">b</span><span class="op" id="8488475">.</span><span class="ident" id="8488476">Fatalf</span><span class="op" id="8488482">(</span><span class="string" id="8488483">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="8488504">,</span>&nbsp;<span class="ident" id="8488506">find</span><span class="op" id="8488510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488517">}</span><br>
<span class="lineno">320</span><span class="op" id="8488519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8488522">func</span>&nbsp;<span class="ident" id="8488527">BenchmarkUncommon</span><span class="op" id="8488544">(</span><span class="ident" id="8488545">b</span>&nbsp;<span class="op" id="8488547">*</span><span class="ident" id="8488548">testing</span><span class="op" id="8488555">.</span><span class="ident" id="8488556">B</span><span class="op" id="8488557">)</span>&nbsp;<span class="op" id="8488559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488562">b</span><span class="op" id="8488563">.</span><span class="ident" id="8488564">ReportAllocs</span><span class="op" id="8488576">(</span><span class="op" id="8488577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488580">var</span>&nbsp;<span class="ident" id="8488584">buf</span>&nbsp;<span class="ident" id="8488588">bytes</span><span class="op" id="8488593">.</span><span class="ident" id="8488594">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488602">br</span>&nbsp;<span class="op" id="8488605">:=</span>&nbsp;<span class="ident" id="8488608">bufio</span><span class="op" id="8488613">.</span><span class="ident" id="8488614">NewReader</span><span class="op" id="8488623">(</span><span class="op" id="8488624">&amp;</span><span class="ident" id="8488625">buf</span><span class="op" id="8488628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488631">r</span>&nbsp;<span class="op" id="8488633">:=</span>&nbsp;<span class="ident" id="8488636">NewReader</span><span class="op" id="8488645">(</span><span class="ident" id="8488646">br</span><span class="op" id="8488648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488651">for</span>&nbsp;<span class="ident" id="8488655">i</span>&nbsp;<span class="op" id="8488657">:=</span>&nbsp;<span class="num" id="8488660">0</span><span class="op" id="8488661">;</span>&nbsp;<span class="ident" id="8488663">i</span>&nbsp;<span class="op" id="8488665">&lt;</span>&nbsp;<span class="ident" id="8488667">b</span><span class="op" id="8488668">.</span><span class="ident" id="8488669">N</span><span class="op" id="8488670">;</span>&nbsp;<span class="ident" id="8488672">i</span><span class="op" id="8488673">++</span>&nbsp;<span class="op" id="8488676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488680">buf</span><span class="op" id="8488683">.</span><span class="ident" id="8488684">WriteString</span><span class="op" id="8488695">(</span><span class="string" id="8488696">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="8488740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488744">h</span><span class="op" id="8488745">,</span>&nbsp;<span class="ident" id="8488747">err</span>&nbsp;<span class="op" id="8488751">:=</span>&nbsp;<span class="ident" id="8488754">r</span><span class="op" id="8488755">.</span><span class="ident" id="8488756">ReadMIMEHeader</span><span class="op" id="8488770">(</span><span class="op" id="8488771">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488775">if</span>&nbsp;<span class="ident" id="8488778">err</span>&nbsp;<span class="op" id="8488782">!=</span>&nbsp;<span class="ident" id="8488785">nil</span>&nbsp;<span class="op" id="8488789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488794">b</span><span class="op" id="8488795">.</span><span class="ident" id="8488796">Fatal</span><span class="op" id="8488801">(</span><span class="ident" id="8488802">err</span><span class="op" id="8488805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8488813">if</span>&nbsp;<span class="ident" id="8488816">_</span><span class="op" id="8488817">,</span>&nbsp;<span class="ident" id="8488819">ok</span>&nbsp;<span class="op" id="8488822">:=</span>&nbsp;<span class="ident" id="8488825">h</span><span class="op" id="8488826">[</span><span class="string" id="8488827">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="8488858">]</span><span class="op" id="8488859">;</span>&nbsp;<span class="op" id="8488861">!</span><span class="ident" id="8488862">ok</span>&nbsp;<span class="op" id="8488865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488870">b</span><span class="op" id="8488871">.</span><span class="ident" id="8488872">Fatal</span><span class="op" id="8488877">(</span><span class="string" id="8488878">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="8488902">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488909">}</span><br>
<span class="lineno"></span><span class="op" id="8488911">}</span>
</div>
</body>
</html>
