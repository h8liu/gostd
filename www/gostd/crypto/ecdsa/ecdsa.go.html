<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4134023">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4134078">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4134132">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4134183">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4134262">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4134288">package</span>&nbsp;<span class="ident" id="4134296">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134303">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4134318">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4134373">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4134419">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4134443">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4134500">import</span>&nbsp;<span class="op" id="4134507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4134510">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4134520">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4134539">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4134556">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4134562">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4134573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134576">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4134621">type</span>&nbsp;<span class="ident" id="4134626">PublicKey</span>&nbsp;<span class="keyword" id="4134636">struct</span>&nbsp;<span class="op" id="4134643">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134646">elliptic</span><span class="op" id="4134654">.</span><span class="ident" id="4134655">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134662">X</span><span class="op" id="4134663">,</span>&nbsp;<span class="ident" id="4134665">Y</span>&nbsp;<span class="op" id="4134667">*</span><span class="ident" id="4134668">big</span><span class="op" id="4134671">.</span><span class="ident" id="4134672">Int</span><br>
<span class="lineno"></span><span class="op" id="4134676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134679">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4134725">type</span>&nbsp;<span class="ident" id="4134730">PrivateKey</span>&nbsp;<span class="keyword" id="4134741">struct</span>&nbsp;<span class="op" id="4134748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134751">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134762">D</span>&nbsp;<span class="op" id="4134764">*</span><span class="ident" id="4134765">big</span><span class="op" id="4134768">.</span><span class="ident" id="4134769">Int</span><br>
<span class="lineno"></span><span class="op" id="4134773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4134776">type</span>&nbsp;<span class="ident" id="4134781">ecdsaSignature</span>&nbsp;<span class="keyword" id="4134796">struct</span>&nbsp;<span class="op" id="4134803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134806">R</span><span class="op" id="4134807">,</span>&nbsp;<span class="ident" id="4134809">S</span>&nbsp;<span class="op" id="4134811">*</span><span class="ident" id="4134812">big</span><span class="op" id="4134815">.</span><span class="ident" id="4134816">Int</span><br>
<span class="lineno"></span><span class="op" id="4134820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134823">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4134879">func</span>&nbsp;<span class="op" id="4134884">(</span><span class="ident" id="4134885">priv</span>&nbsp;<span class="op" id="4134890">*</span><span class="ident" id="4134891">PrivateKey</span><span class="op" id="4134901">)</span>&nbsp;<span class="ident" id="4134903">Public</span><span class="op" id="4134909">(</span><span class="op" id="4134910">)</span>&nbsp;<span class="ident" id="4134912">crypto</span><span class="op" id="4134918">.</span><span class="ident" id="4134919">PublicKey</span>&nbsp;<span class="op" id="4134929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134932">return</span>&nbsp;<span class="op" id="4134939">&amp;</span><span class="ident" id="4134940">priv</span><span class="op" id="4134944">.</span><span class="ident" id="4134945">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4134955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134958">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4135032">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4135110">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4135187">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4135200">func</span>&nbsp;<span class="op" id="4135205">(</span><span class="ident" id="4135206">priv</span>&nbsp;<span class="op" id="4135211">*</span><span class="ident" id="4135212">PrivateKey</span><span class="op" id="4135222">)</span>&nbsp;<span class="ident" id="4135224">Sign</span><span class="op" id="4135228">(</span><span class="ident" id="4135229">rand</span>&nbsp;<span class="ident" id="4135234">io</span><span class="op" id="4135236">.</span><span class="ident" id="4135237">Reader</span><span class="op" id="4135243">,</span>&nbsp;<span class="ident" id="4135245">msg</span>&nbsp;<span class="op" id="4135249">[</span><span class="op" id="4135250">]</span><span class="builtintype" id="4135251">byte</span><span class="op" id="4135255">,</span>&nbsp;<span class="ident" id="4135257">opts</span>&nbsp;<span class="ident" id="4135262">crypto</span><span class="op" id="4135268">.</span><span class="ident" id="4135269">SignerOpts</span><span class="op" id="4135279">)</span>&nbsp;<span class="op" id="4135281">(</span><span class="op" id="4135282">[</span><span class="op" id="4135283">]</span><span class="builtintype" id="4135284">byte</span><span class="op" id="4135288">,</span>&nbsp;<span class="builtintype" id="4135290">error</span><span class="op" id="4135295">)</span>&nbsp;<span class="op" id="4135297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135300">r</span><span class="op" id="4135301">,</span>&nbsp;<span class="ident" id="4135303">s</span><span class="op" id="4135304">,</span>&nbsp;<span class="ident" id="4135306">err</span>&nbsp;<span class="op" id="4135310">:=</span>&nbsp;<span class="ident" id="4135313">Sign</span><span class="op" id="4135317">(</span><span class="ident" id="4135318">rand</span><span class="op" id="4135322">,</span>&nbsp;<span class="ident" id="4135324">priv</span><span class="op" id="4135328">,</span>&nbsp;<span class="ident" id="4135330">msg</span><span class="op" id="4135333">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135336">if</span>&nbsp;<span class="ident" id="4135339">err</span>&nbsp;<span class="op" id="4135343">!=</span>&nbsp;<span class="ident" id="4135346">nil</span>&nbsp;<span class="op" id="4135350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135354">return</span>&nbsp;<span class="ident" id="4135361">nil</span><span class="op" id="4135364">,</span>&nbsp;<span class="ident" id="4135366">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135375">return</span>&nbsp;<span class="ident" id="4135382">asn1</span><span class="op" id="4135386">.</span><span class="ident" id="4135387">Marshal</span><span class="op" id="4135394">(</span><span class="ident" id="4135395">ecdsaSignature</span><span class="op" id="4135409">{</span><span class="ident" id="4135410">r</span><span class="op" id="4135411">,</span>&nbsp;<span class="ident" id="4135413">s</span><span class="op" id="4135414">}</span><span class="op" id="4135415">)</span><br>
<span class="lineno">55</span><span class="op" id="4135417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4135420">var</span>&nbsp;<span class="ident" id="4135424">one</span>&nbsp;<span class="op" id="4135428">=</span>&nbsp;<span class="builtinfunc" id="4135430">new</span><span class="op" id="4135433">(</span><span class="ident" id="4135434">big</span><span class="op" id="4135437">.</span><span class="ident" id="4135438">Int</span><span class="op" id="4135441">)</span><span class="op" id="4135442">.</span><span class="ident" id="4135443">SetInt64</span><span class="op" id="4135451">(</span><span class="num" id="4135452">1</span><span class="op" id="4135453">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135456">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4135535">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4135586">func</span>&nbsp;<span class="ident" id="4135591">randFieldElement</span><span class="op" id="4135607">(</span><span class="ident" id="4135608">c</span>&nbsp;<span class="ident" id="4135610">elliptic</span><span class="op" id="4135618">.</span><span class="ident" id="4135619">Curve</span><span class="op" id="4135624">,</span>&nbsp;<span class="ident" id="4135626">rand</span>&nbsp;<span class="ident" id="4135631">io</span><span class="op" id="4135633">.</span><span class="ident" id="4135634">Reader</span><span class="op" id="4135640">)</span>&nbsp;<span class="op" id="4135642">(</span><span class="ident" id="4135643">k</span>&nbsp;<span class="op" id="4135645">*</span><span class="ident" id="4135646">big</span><span class="op" id="4135649">.</span><span class="ident" id="4135650">Int</span><span class="op" id="4135653">,</span>&nbsp;<span class="ident" id="4135655">err</span>&nbsp;<span class="builtintype" id="4135659">error</span><span class="op" id="4135664">)</span>&nbsp;<span class="op" id="4135666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135669">params</span>&nbsp;<span class="op" id="4135676">:=</span>&nbsp;<span class="ident" id="4135679">c</span><span class="op" id="4135680">.</span><span class="ident" id="4135681">Params</span><span class="op" id="4135687">(</span><span class="op" id="4135688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135691">b</span>&nbsp;<span class="op" id="4135693">:=</span>&nbsp;<span class="builtinfunc" id="4135696">make</span><span class="op" id="4135700">(</span><span class="op" id="4135701">[</span><span class="op" id="4135702">]</span><span class="builtintype" id="4135703">byte</span><span class="op" id="4135707">,</span>&nbsp;<span class="ident" id="4135709">params</span><span class="op" id="4135715">.</span><span class="ident" id="4135716">BitSize</span><span class="op" id="4135723">/</span><span class="num" id="4135724">8</span><span class="op" id="4135725">+</span><span class="num" id="4135726">8</span><span class="op" id="4135727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135730">_</span><span class="op" id="4135731">,</span>&nbsp;<span class="ident" id="4135733">err</span>&nbsp;<span class="op" id="4135737">=</span>&nbsp;<span class="ident" id="4135739">io</span><span class="op" id="4135741">.</span><span class="ident" id="4135742">ReadFull</span><span class="op" id="4135750">(</span><span class="ident" id="4135751">rand</span><span class="op" id="4135755">,</span>&nbsp;<span class="ident" id="4135757">b</span><span class="op" id="4135758">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135761">if</span>&nbsp;<span class="ident" id="4135764">err</span>&nbsp;<span class="op" id="4135768">!=</span>&nbsp;<span class="ident" id="4135771">nil</span>&nbsp;<span class="op" id="4135775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135779">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135791">k</span>&nbsp;<span class="op" id="4135793">=</span>&nbsp;<span class="builtinfunc" id="4135795">new</span><span class="op" id="4135798">(</span><span class="ident" id="4135799">big</span><span class="op" id="4135802">.</span><span class="ident" id="4135803">Int</span><span class="op" id="4135806">)</span><span class="op" id="4135807">.</span><span class="ident" id="4135808">SetBytes</span><span class="op" id="4135816">(</span><span class="ident" id="4135817">b</span><span class="op" id="4135818">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135821">n</span>&nbsp;<span class="op" id="4135823">:=</span>&nbsp;<span class="builtinfunc" id="4135826">new</span><span class="op" id="4135829">(</span><span class="ident" id="4135830">big</span><span class="op" id="4135833">.</span><span class="ident" id="4135834">Int</span><span class="op" id="4135837">)</span><span class="op" id="4135838">.</span><span class="ident" id="4135839">Sub</span><span class="op" id="4135842">(</span><span class="ident" id="4135843">params</span><span class="op" id="4135849">.</span><span class="ident" id="4135850">N</span><span class="op" id="4135851">,</span>&nbsp;<span class="ident" id="4135853">one</span><span class="op" id="4135856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135859">k</span><span class="op" id="4135860">.</span><span class="ident" id="4135861">Mod</span><span class="op" id="4135864">(</span><span class="ident" id="4135865">k</span><span class="op" id="4135866">,</span>&nbsp;<span class="ident" id="4135868">n</span><span class="op" id="4135869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135872">k</span><span class="op" id="4135873">.</span><span class="ident" id="4135874">Add</span><span class="op" id="4135877">(</span><span class="ident" id="4135878">k</span><span class="op" id="4135879">,</span>&nbsp;<span class="ident" id="4135881">one</span><span class="op" id="4135884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135887">return</span><br>
<span class="lineno"></span><span class="op" id="4135894">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4135897">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4135953">func</span>&nbsp;<span class="ident" id="4135958">GenerateKey</span><span class="op" id="4135969">(</span><span class="ident" id="4135970">c</span>&nbsp;<span class="ident" id="4135972">elliptic</span><span class="op" id="4135980">.</span><span class="ident" id="4135981">Curve</span><span class="op" id="4135986">,</span>&nbsp;<span class="ident" id="4135988">rand</span>&nbsp;<span class="ident" id="4135993">io</span><span class="op" id="4135995">.</span><span class="ident" id="4135996">Reader</span><span class="op" id="4136002">)</span>&nbsp;<span class="op" id="4136004">(</span><span class="ident" id="4136005">priv</span>&nbsp;<span class="op" id="4136010">*</span><span class="ident" id="4136011">PrivateKey</span><span class="op" id="4136021">,</span>&nbsp;<span class="ident" id="4136023">err</span>&nbsp;<span class="builtintype" id="4136027">error</span><span class="op" id="4136032">)</span>&nbsp;<span class="op" id="4136034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136037">k</span><span class="op" id="4136038">,</span>&nbsp;<span class="ident" id="4136040">err</span>&nbsp;<span class="op" id="4136044">:=</span>&nbsp;<span class="ident" id="4136047">randFieldElement</span><span class="op" id="4136063">(</span><span class="ident" id="4136064">c</span><span class="op" id="4136065">,</span>&nbsp;<span class="ident" id="4136067">rand</span><span class="op" id="4136071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136074">if</span>&nbsp;<span class="ident" id="4136077">err</span>&nbsp;<span class="op" id="4136081">!=</span>&nbsp;<span class="ident" id="4136084">nil</span>&nbsp;<span class="op" id="4136088">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136092">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136104">priv</span>&nbsp;<span class="op" id="4136109">=</span>&nbsp;<span class="builtinfunc" id="4136111">new</span><span class="op" id="4136114">(</span><span class="ident" id="4136115">PrivateKey</span><span class="op" id="4136125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136128">priv</span><span class="op" id="4136132">.</span><span class="ident" id="4136133">PublicKey</span><span class="op" id="4136142">.</span><span class="ident" id="4136143">Curve</span>&nbsp;<span class="op" id="4136149">=</span>&nbsp;<span class="ident" id="4136151">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136154">priv</span><span class="op" id="4136158">.</span><span class="ident" id="4136159">D</span>&nbsp;<span class="op" id="4136161">=</span>&nbsp;<span class="ident" id="4136163">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136166">priv</span><span class="op" id="4136170">.</span><span class="ident" id="4136171">PublicKey</span><span class="op" id="4136180">.</span><span class="ident" id="4136181">X</span><span class="op" id="4136182">,</span>&nbsp;<span class="ident" id="4136184">priv</span><span class="op" id="4136188">.</span><span class="ident" id="4136189">PublicKey</span><span class="op" id="4136198">.</span><span class="ident" id="4136199">Y</span>&nbsp;<span class="op" id="4136201">=</span>&nbsp;<span class="ident" id="4136203">c</span><span class="op" id="4136204">.</span><span class="ident" id="4136205">ScalarBaseMult</span><span class="op" id="4136219">(</span><span class="ident" id="4136220">k</span><span class="op" id="4136221">.</span><span class="ident" id="4136222">Bytes</span><span class="op" id="4136227">(</span><span class="op" id="4136228">)</span><span class="op" id="4136229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136232">return</span><br>
<span class="lineno"></span><span class="op" id="4136239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4136242">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4136319">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4136394">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4136472">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4136547">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4136624">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4136651">func</span>&nbsp;<span class="ident" id="4136656">hashToInt</span><span class="op" id="4136665">(</span><span class="ident" id="4136666">hash</span>&nbsp;<span class="op" id="4136671">[</span><span class="op" id="4136672">]</span><span class="builtintype" id="4136673">byte</span><span class="op" id="4136677">,</span>&nbsp;<span class="ident" id="4136679">c</span>&nbsp;<span class="ident" id="4136681">elliptic</span><span class="op" id="4136689">.</span><span class="ident" id="4136690">Curve</span><span class="op" id="4136695">)</span>&nbsp;<span class="op" id="4136697">*</span><span class="ident" id="4136698">big</span><span class="op" id="4136701">.</span><span class="ident" id="4136702">Int</span>&nbsp;<span class="op" id="4136706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136709">orderBits</span>&nbsp;<span class="op" id="4136719">:=</span>&nbsp;<span class="ident" id="4136722">c</span><span class="op" id="4136723">.</span><span class="ident" id="4136724">Params</span><span class="op" id="4136730">(</span><span class="op" id="4136731">)</span><span class="op" id="4136732">.</span><span class="ident" id="4136733">N</span><span class="op" id="4136734">.</span><span class="ident" id="4136735">BitLen</span><span class="op" id="4136741">(</span><span class="op" id="4136742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136745">orderBytes</span>&nbsp;<span class="op" id="4136756">:=</span>&nbsp;<span class="op" id="4136759">(</span><span class="ident" id="4136760">orderBits</span>&nbsp;<span class="op" id="4136770">+</span>&nbsp;<span class="num" id="4136772">7</span><span class="op" id="4136773">)</span>&nbsp;<span class="op" id="4136775">/</span>&nbsp;<span class="num" id="4136777">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136780">if</span>&nbsp;<span class="builtinfunc" id="4136783">len</span><span class="op" id="4136786">(</span><span class="ident" id="4136787">hash</span><span class="op" id="4136791">)</span>&nbsp;<span class="op" id="4136793">&gt;</span>&nbsp;<span class="ident" id="4136795">orderBytes</span>&nbsp;<span class="op" id="4136806">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136810">hash</span>&nbsp;<span class="op" id="4136815">=</span>&nbsp;<span class="ident" id="4136817">hash</span><span class="op" id="4136821">[</span><span class="op" id="4136822">:</span><span class="ident" id="4136823">orderBytes</span><span class="op" id="4136833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136840">ret</span>&nbsp;<span class="op" id="4136844">:=</span>&nbsp;<span class="builtinfunc" id="4136847">new</span><span class="op" id="4136850">(</span><span class="ident" id="4136851">big</span><span class="op" id="4136854">.</span><span class="ident" id="4136855">Int</span><span class="op" id="4136858">)</span><span class="op" id="4136859">.</span><span class="ident" id="4136860">SetBytes</span><span class="op" id="4136868">(</span><span class="ident" id="4136869">hash</span><span class="op" id="4136873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136876">excess</span>&nbsp;<span class="op" id="4136883">:=</span>&nbsp;<span class="builtinfunc" id="4136886">len</span><span class="op" id="4136889">(</span><span class="ident" id="4136890">hash</span><span class="op" id="4136894">)</span><span class="op" id="4136895">*</span><span class="num" id="4136896">8</span>&nbsp;<span class="op" id="4136898">-</span>&nbsp;<span class="ident" id="4136900">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136911">if</span>&nbsp;<span class="ident" id="4136914">excess</span>&nbsp;<span class="op" id="4136921">&gt;</span>&nbsp;<span class="num" id="4136923">0</span>&nbsp;<span class="op" id="4136925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136929">ret</span><span class="op" id="4136932">.</span><span class="ident" id="4136933">Rsh</span><span class="op" id="4136936">(</span><span class="ident" id="4136937">ret</span><span class="op" id="4136940">,</span>&nbsp;<span class="builtintype" id="4136942">uint</span><span class="op" id="4136946">(</span><span class="ident" id="4136947">excess</span><span class="op" id="4136953">)</span><span class="op" id="4136954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136960">return</span>&nbsp;<span class="ident" id="4136967">ret</span><br>
<span class="lineno"></span><span class="op" id="4136971">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4136974">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4137051">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4137129">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4137200">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4137238">func</span>&nbsp;<span class="ident" id="4137243">fermatInverse</span><span class="op" id="4137256">(</span><span class="ident" id="4137257">k</span><span class="op" id="4137258">,</span>&nbsp;<span class="ident" id="4137260">N</span>&nbsp;<span class="op" id="4137262">*</span><span class="ident" id="4137263">big</span><span class="op" id="4137266">.</span><span class="ident" id="4137267">Int</span><span class="op" id="4137270">)</span>&nbsp;<span class="op" id="4137272">*</span><span class="ident" id="4137273">big</span><span class="op" id="4137276">.</span><span class="ident" id="4137277">Int</span>&nbsp;<span class="op" id="4137281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137284">two</span>&nbsp;<span class="op" id="4137288">:=</span>&nbsp;<span class="ident" id="4137291">big</span><span class="op" id="4137294">.</span><span class="ident" id="4137295">NewInt</span><span class="op" id="4137301">(</span><span class="num" id="4137302">2</span><span class="op" id="4137303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137306">nMinus2</span>&nbsp;<span class="op" id="4137314">:=</span>&nbsp;<span class="builtinfunc" id="4137317">new</span><span class="op" id="4137320">(</span><span class="ident" id="4137321">big</span><span class="op" id="4137324">.</span><span class="ident" id="4137325">Int</span><span class="op" id="4137328">)</span><span class="op" id="4137329">.</span><span class="ident" id="4137330">Sub</span><span class="op" id="4137333">(</span><span class="ident" id="4137334">N</span><span class="op" id="4137335">,</span>&nbsp;<span class="ident" id="4137337">two</span><span class="op" id="4137340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137343">return</span>&nbsp;<span class="builtinfunc" id="4137350">new</span><span class="op" id="4137353">(</span><span class="ident" id="4137354">big</span><span class="op" id="4137357">.</span><span class="ident" id="4137358">Int</span><span class="op" id="4137361">)</span><span class="op" id="4137362">.</span><span class="ident" id="4137363">Exp</span><span class="op" id="4137366">(</span><span class="ident" id="4137367">k</span><span class="op" id="4137368">,</span>&nbsp;<span class="ident" id="4137370">nMinus2</span><span class="op" id="4137377">,</span>&nbsp;<span class="ident" id="4137379">N</span><span class="op" id="4137380">)</span><br>
<span class="lineno"></span><span class="op" id="4137382">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4137385">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4137465">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4137543">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4137622">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4137631">func</span>&nbsp;<span class="ident" id="4137636">Sign</span><span class="op" id="4137640">(</span><span class="ident" id="4137641">rand</span>&nbsp;<span class="ident" id="4137646">io</span><span class="op" id="4137648">.</span><span class="ident" id="4137649">Reader</span><span class="op" id="4137655">,</span>&nbsp;<span class="ident" id="4137657">priv</span>&nbsp;<span class="op" id="4137662">*</span><span class="ident" id="4137663">PrivateKey</span><span class="op" id="4137673">,</span>&nbsp;<span class="ident" id="4137675">hash</span>&nbsp;<span class="op" id="4137680">[</span><span class="op" id="4137681">]</span><span class="builtintype" id="4137682">byte</span><span class="op" id="4137686">)</span>&nbsp;<span class="op" id="4137688">(</span><span class="ident" id="4137689">r</span><span class="op" id="4137690">,</span>&nbsp;<span class="ident" id="4137692">s</span>&nbsp;<span class="op" id="4137694">*</span><span class="ident" id="4137695">big</span><span class="op" id="4137698">.</span><span class="ident" id="4137699">Int</span><span class="op" id="4137702">,</span>&nbsp;<span class="ident" id="4137704">err</span>&nbsp;<span class="builtintype" id="4137708">error</span><span class="op" id="4137713">)</span>&nbsp;<span class="op" id="4137715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137718">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137738">c</span>&nbsp;<span class="op" id="4137740">:=</span>&nbsp;<span class="ident" id="4137743">priv</span><span class="op" id="4137747">.</span><span class="ident" id="4137748">PublicKey</span><span class="op" id="4137757">.</span><span class="ident" id="4137758">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137765">N</span>&nbsp;<span class="op" id="4137767">:=</span>&nbsp;<span class="ident" id="4137770">c</span><span class="op" id="4137771">.</span><span class="ident" id="4137772">Params</span><span class="op" id="4137778">(</span><span class="op" id="4137779">)</span><span class="op" id="4137780">.</span><span class="ident" id="4137781">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137785">var</span>&nbsp;<span class="ident" id="4137789">k</span><span class="op" id="4137790">,</span>&nbsp;<span class="ident" id="4137792">kInv</span>&nbsp;<span class="op" id="4137797">*</span><span class="ident" id="4137798">big</span><span class="op" id="4137801">.</span><span class="ident" id="4137802">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137807">for</span>&nbsp;<span class="op" id="4137811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137815">for</span>&nbsp;<span class="op" id="4137819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137824">k</span><span class="op" id="4137825">,</span>&nbsp;<span class="ident" id="4137827">err</span>&nbsp;<span class="op" id="4137831">=</span>&nbsp;<span class="ident" id="4137833">randFieldElement</span><span class="op" id="4137849">(</span><span class="ident" id="4137850">c</span><span class="op" id="4137851">,</span>&nbsp;<span class="ident" id="4137853">rand</span><span class="op" id="4137857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137862">if</span>&nbsp;<span class="ident" id="4137865">err</span>&nbsp;<span class="op" id="4137869">!=</span>&nbsp;<span class="ident" id="4137872">nil</span>&nbsp;<span class="op" id="4137876">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137882">r</span>&nbsp;<span class="op" id="4137884">=</span>&nbsp;<span class="ident" id="4137886">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137910">kInv</span>&nbsp;<span class="op" id="4137915">=</span>&nbsp;<span class="ident" id="4137917">fermatInverse</span><span class="op" id="4137930">(</span><span class="ident" id="4137931">k</span><span class="op" id="4137932">,</span>&nbsp;<span class="ident" id="4137934">N</span><span class="op" id="4137935">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137940">r</span><span class="op" id="4137941">,</span>&nbsp;<span class="ident" id="4137943">_</span>&nbsp;<span class="op" id="4137945">=</span>&nbsp;<span class="ident" id="4137947">priv</span><span class="op" id="4137951">.</span><span class="ident" id="4137952">Curve</span><span class="op" id="4137957">.</span><span class="ident" id="4137958">ScalarBaseMult</span><span class="op" id="4137972">(</span><span class="ident" id="4137973">k</span><span class="op" id="4137974">.</span><span class="ident" id="4137975">Bytes</span><span class="op" id="4137980">(</span><span class="op" id="4137981">)</span><span class="op" id="4137982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137987">r</span><span class="op" id="4137988">.</span><span class="ident" id="4137989">Mod</span><span class="op" id="4137992">(</span><span class="ident" id="4137993">r</span><span class="op" id="4137994">,</span>&nbsp;<span class="ident" id="4137996">N</span><span class="op" id="4137997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138002">if</span>&nbsp;<span class="ident" id="4138005">r</span><span class="op" id="4138006">.</span><span class="ident" id="4138007">Sign</span><span class="op" id="4138011">(</span><span class="op" id="4138012">)</span>&nbsp;<span class="op" id="4138014">!=</span>&nbsp;<span class="num" id="4138017">0</span>&nbsp;<span class="op" id="4138019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138025">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138034">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138043">e</span>&nbsp;<span class="op" id="4138045">:=</span>&nbsp;<span class="ident" id="4138048">hashToInt</span><span class="op" id="4138057">(</span><span class="ident" id="4138058">hash</span><span class="op" id="4138062">,</span>&nbsp;<span class="ident" id="4138064">c</span><span class="op" id="4138065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138069">s</span>&nbsp;<span class="op" id="4138071">=</span>&nbsp;<span class="builtinfunc" id="4138073">new</span><span class="op" id="4138076">(</span><span class="ident" id="4138077">big</span><span class="op" id="4138080">.</span><span class="ident" id="4138081">Int</span><span class="op" id="4138084">)</span><span class="op" id="4138085">.</span><span class="ident" id="4138086">Mul</span><span class="op" id="4138089">(</span><span class="ident" id="4138090">priv</span><span class="op" id="4138094">.</span><span class="ident" id="4138095">D</span><span class="op" id="4138096">,</span>&nbsp;<span class="ident" id="4138098">r</span><span class="op" id="4138099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138103">s</span><span class="op" id="4138104">.</span><span class="ident" id="4138105">Add</span><span class="op" id="4138108">(</span><span class="ident" id="4138109">s</span><span class="op" id="4138110">,</span>&nbsp;<span class="ident" id="4138112">e</span><span class="op" id="4138113">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138117">s</span><span class="op" id="4138118">.</span><span class="ident" id="4138119">Mul</span><span class="op" id="4138122">(</span><span class="ident" id="4138123">s</span><span class="op" id="4138124">,</span>&nbsp;<span class="ident" id="4138126">kInv</span><span class="op" id="4138130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138134">s</span><span class="op" id="4138135">.</span><span class="ident" id="4138136">Mod</span><span class="op" id="4138139">(</span><span class="ident" id="4138140">s</span><span class="op" id="4138141">,</span>&nbsp;<span class="ident" id="4138143">N</span><span class="op" id="4138144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138148">if</span>&nbsp;<span class="ident" id="4138151">s</span><span class="op" id="4138152">.</span><span class="ident" id="4138153">Sign</span><span class="op" id="4138157">(</span><span class="op" id="4138158">)</span>&nbsp;<span class="op" id="4138160">!=</span>&nbsp;<span class="num" id="4138163">0</span>&nbsp;<span class="op" id="4138165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138170">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138178">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138185">return</span><br>
<span class="lineno"></span><span class="op" id="4138192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4138195">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4138275">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4138331">func</span>&nbsp;<span class="ident" id="4138336">Verify</span><span class="op" id="4138342">(</span><span class="ident" id="4138343">pub</span>&nbsp;<span class="op" id="4138347">*</span><span class="ident" id="4138348">PublicKey</span><span class="op" id="4138357">,</span>&nbsp;<span class="ident" id="4138359">hash</span>&nbsp;<span class="op" id="4138364">[</span><span class="op" id="4138365">]</span><span class="builtintype" id="4138366">byte</span><span class="op" id="4138370">,</span>&nbsp;<span class="ident" id="4138372">r</span><span class="op" id="4138373">,</span>&nbsp;<span class="ident" id="4138375">s</span>&nbsp;<span class="op" id="4138377">*</span><span class="ident" id="4138378">big</span><span class="op" id="4138381">.</span><span class="ident" id="4138382">Int</span><span class="op" id="4138385">)</span>&nbsp;<span class="builtintype" id="4138387">bool</span>&nbsp;<span class="op" id="4138392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138395">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138415">c</span>&nbsp;<span class="op" id="4138417">:=</span>&nbsp;<span class="ident" id="4138420">pub</span><span class="op" id="4138423">.</span><span class="ident" id="4138424">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138431">N</span>&nbsp;<span class="op" id="4138433">:=</span>&nbsp;<span class="ident" id="4138436">c</span><span class="op" id="4138437">.</span><span class="ident" id="4138438">Params</span><span class="op" id="4138444">(</span><span class="op" id="4138445">)</span><span class="op" id="4138446">.</span><span class="ident" id="4138447">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138451">if</span>&nbsp;<span class="ident" id="4138454">r</span><span class="op" id="4138455">.</span><span class="ident" id="4138456">Sign</span><span class="op" id="4138460">(</span><span class="op" id="4138461">)</span>&nbsp;<span class="op" id="4138463">==</span>&nbsp;<span class="num" id="4138466">0</span>&nbsp;<span class="op" id="4138468">||</span>&nbsp;<span class="ident" id="4138471">s</span><span class="op" id="4138472">.</span><span class="ident" id="4138473">Sign</span><span class="op" id="4138477">(</span><span class="op" id="4138478">)</span>&nbsp;<span class="op" id="4138480">==</span>&nbsp;<span class="num" id="4138483">0</span>&nbsp;<span class="op" id="4138485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138489">return</span>&nbsp;<span class="builtintype" id="4138496">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138503">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138506">if</span>&nbsp;<span class="ident" id="4138509">r</span><span class="op" id="4138510">.</span><span class="ident" id="4138511">Cmp</span><span class="op" id="4138514">(</span><span class="ident" id="4138515">N</span><span class="op" id="4138516">)</span>&nbsp;<span class="op" id="4138518">&gt;=</span>&nbsp;<span class="num" id="4138521">0</span>&nbsp;<span class="op" id="4138523">||</span>&nbsp;<span class="ident" id="4138526">s</span><span class="op" id="4138527">.</span><span class="ident" id="4138528">Cmp</span><span class="op" id="4138531">(</span><span class="ident" id="4138532">N</span><span class="op" id="4138533">)</span>&nbsp;<span class="op" id="4138535">&gt;=</span>&nbsp;<span class="num" id="4138538">0</span>&nbsp;<span class="op" id="4138540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138544">return</span>&nbsp;<span class="builtintype" id="4138551">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138561">e</span>&nbsp;<span class="op" id="4138563">:=</span>&nbsp;<span class="ident" id="4138566">hashToInt</span><span class="op" id="4138575">(</span><span class="ident" id="4138576">hash</span><span class="op" id="4138580">,</span>&nbsp;<span class="ident" id="4138582">c</span><span class="op" id="4138583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138586">w</span>&nbsp;<span class="op" id="4138588">:=</span>&nbsp;<span class="builtinfunc" id="4138591">new</span><span class="op" id="4138594">(</span><span class="ident" id="4138595">big</span><span class="op" id="4138598">.</span><span class="ident" id="4138599">Int</span><span class="op" id="4138602">)</span><span class="op" id="4138603">.</span><span class="ident" id="4138604">ModInverse</span><span class="op" id="4138614">(</span><span class="ident" id="4138615">s</span><span class="op" id="4138616">,</span>&nbsp;<span class="ident" id="4138618">N</span><span class="op" id="4138619">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138623">u1</span>&nbsp;<span class="op" id="4138626">:=</span>&nbsp;<span class="ident" id="4138629">e</span><span class="op" id="4138630">.</span><span class="ident" id="4138631">Mul</span><span class="op" id="4138634">(</span><span class="ident" id="4138635">e</span><span class="op" id="4138636">,</span>&nbsp;<span class="ident" id="4138638">w</span><span class="op" id="4138639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138642">u1</span><span class="op" id="4138644">.</span><span class="ident" id="4138645">Mod</span><span class="op" id="4138648">(</span><span class="ident" id="4138649">u1</span><span class="op" id="4138651">,</span>&nbsp;<span class="ident" id="4138653">N</span><span class="op" id="4138654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138657">u2</span>&nbsp;<span class="op" id="4138660">:=</span>&nbsp;<span class="ident" id="4138663">w</span><span class="op" id="4138664">.</span><span class="ident" id="4138665">Mul</span><span class="op" id="4138668">(</span><span class="ident" id="4138669">r</span><span class="op" id="4138670">,</span>&nbsp;<span class="ident" id="4138672">w</span><span class="op" id="4138673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138676">u2</span><span class="op" id="4138678">.</span><span class="ident" id="4138679">Mod</span><span class="op" id="4138682">(</span><span class="ident" id="4138683">u2</span><span class="op" id="4138685">,</span>&nbsp;<span class="ident" id="4138687">N</span><span class="op" id="4138688">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138692">x1</span><span class="op" id="4138694">,</span>&nbsp;<span class="ident" id="4138696">y1</span>&nbsp;<span class="op" id="4138699">:=</span>&nbsp;<span class="ident" id="4138702">c</span><span class="op" id="4138703">.</span><span class="ident" id="4138704">ScalarBaseMult</span><span class="op" id="4138718">(</span><span class="ident" id="4138719">u1</span><span class="op" id="4138721">.</span><span class="ident" id="4138722">Bytes</span><span class="op" id="4138727">(</span><span class="op" id="4138728">)</span><span class="op" id="4138729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138732">x2</span><span class="op" id="4138734">,</span>&nbsp;<span class="ident" id="4138736">y2</span>&nbsp;<span class="op" id="4138739">:=</span>&nbsp;<span class="ident" id="4138742">c</span><span class="op" id="4138743">.</span><span class="ident" id="4138744">ScalarMult</span><span class="op" id="4138754">(</span><span class="ident" id="4138755">pub</span><span class="op" id="4138758">.</span><span class="ident" id="4138759">X</span><span class="op" id="4138760">,</span>&nbsp;<span class="ident" id="4138762">pub</span><span class="op" id="4138765">.</span><span class="ident" id="4138766">Y</span><span class="op" id="4138767">,</span>&nbsp;<span class="ident" id="4138769">u2</span><span class="op" id="4138771">.</span><span class="ident" id="4138772">Bytes</span><span class="op" id="4138777">(</span><span class="op" id="4138778">)</span><span class="op" id="4138779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138782">x</span><span class="op" id="4138783">,</span>&nbsp;<span class="ident" id="4138785">y</span>&nbsp;<span class="op" id="4138787">:=</span>&nbsp;<span class="ident" id="4138790">c</span><span class="op" id="4138791">.</span><span class="ident" id="4138792">Add</span><span class="op" id="4138795">(</span><span class="ident" id="4138796">x1</span><span class="op" id="4138798">,</span>&nbsp;<span class="ident" id="4138800">y1</span><span class="op" id="4138802">,</span>&nbsp;<span class="ident" id="4138804">x2</span><span class="op" id="4138806">,</span>&nbsp;<span class="ident" id="4138808">y2</span><span class="op" id="4138810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138813">if</span>&nbsp;<span class="ident" id="4138816">x</span><span class="op" id="4138817">.</span><span class="ident" id="4138818">Sign</span><span class="op" id="4138822">(</span><span class="op" id="4138823">)</span>&nbsp;<span class="op" id="4138825">==</span>&nbsp;<span class="num" id="4138828">0</span>&nbsp;<span class="op" id="4138830">&amp;&amp;</span>&nbsp;<span class="ident" id="4138833">y</span><span class="op" id="4138834">.</span><span class="ident" id="4138835">Sign</span><span class="op" id="4138839">(</span><span class="op" id="4138840">)</span>&nbsp;<span class="op" id="4138842">==</span>&nbsp;<span class="num" id="4138845">0</span>&nbsp;<span class="op" id="4138847">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138851">return</span>&nbsp;<span class="builtintype" id="4138858">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138868">x</span><span class="op" id="4138869">.</span><span class="ident" id="4138870">Mod</span><span class="op" id="4138873">(</span><span class="ident" id="4138874">x</span><span class="op" id="4138875">,</span>&nbsp;<span class="ident" id="4138877">N</span><span class="op" id="4138878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138881">return</span>&nbsp;<span class="ident" id="4138888">x</span><span class="op" id="4138889">.</span><span class="ident" id="4138890">Cmp</span><span class="op" id="4138893">(</span><span class="ident" id="4138894">r</span><span class="op" id="4138895">)</span>&nbsp;<span class="op" id="4138897">==</span>&nbsp;<span class="num" id="4138900">0</span><br>
<span class="lineno"></span><span class="op" id="4138902">}</span>
</div>
</body>
</html>
