<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2052818">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2052873">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2052927">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2052978">//&nbsp;Package&nbsp;bytes&nbsp;implements&nbsp;functions&nbsp;for&nbsp;the&nbsp;manipulation&nbsp;of&nbsp;byte&nbsp;slices.</span><br>
<span class="lineno"></span><span class="comment" id="2053053">//&nbsp;It&nbsp;is&nbsp;analogous&nbsp;to&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;strings&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="2053114">package</span>&nbsp;<span class="ident" id="2053122">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2053129">import</span>&nbsp;<span class="op" id="2053136">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2053139">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2053150">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2053165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2053168">func</span>&nbsp;<span class="ident" id="2053173">equalPortable</span><span class="op" id="2053186">(</span><span class="ident" id="2053187">a</span><span class="op" id="2053188">,</span>&nbsp;<span class="ident" id="2053190">b</span>&nbsp;<span class="op" id="2053192">[</span><span class="op" id="2053193">]</span><span class="builtintype" id="2053194">byte</span><span class="op" id="2053198">)</span>&nbsp;<span class="builtintype" id="2053200">bool</span>&nbsp;<span class="op" id="2053205">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053208">if</span>&nbsp;<span class="builtinfunc" id="2053211">len</span><span class="op" id="2053214">(</span><span class="ident" id="2053215">a</span><span class="op" id="2053216">)</span>&nbsp;<span class="op" id="2053218">!=</span>&nbsp;<span class="builtinfunc" id="2053221">len</span><span class="op" id="2053224">(</span><span class="ident" id="2053225">b</span><span class="op" id="2053226">)</span>&nbsp;<span class="op" id="2053228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053232">return</span>&nbsp;<span class="builtintype" id="2053239">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053249">for</span>&nbsp;<span class="ident" id="2053253">i</span><span class="op" id="2053254">,</span>&nbsp;<span class="ident" id="2053256">c</span>&nbsp;<span class="op" id="2053258">:=</span>&nbsp;<span class="keyword" id="2053261">range</span>&nbsp;<span class="ident" id="2053267">a</span>&nbsp;<span class="op" id="2053269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053273">if</span>&nbsp;<span class="ident" id="2053276">c</span>&nbsp;<span class="op" id="2053278">!=</span>&nbsp;<span class="ident" id="2053281">b</span><span class="op" id="2053282">[</span><span class="ident" id="2053283">i</span><span class="op" id="2053284">]</span>&nbsp;<span class="op" id="2053286">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053291">return</span>&nbsp;<span class="builtintype" id="2053298">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053312">return</span>&nbsp;<span class="builtintype" id="2053319">true</span><br>
<span class="lineno"></span><span class="op" id="2053324">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="2053327">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;a&nbsp;slice&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;slices&nbsp;of&nbsp;bytes),</span><br>
<span class="lineno"></span><span class="comment" id="2053431">//&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;byte&nbsp;slices.&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;are&nbsp;chopped&nbsp;into&nbsp;individual&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="2053527">func</span>&nbsp;<span class="ident" id="2053532">explode</span><span class="op" id="2053539">(</span><span class="ident" id="2053540">s</span>&nbsp;<span class="op" id="2053542">[</span><span class="op" id="2053543">]</span><span class="builtintype" id="2053544">byte</span><span class="op" id="2053548">,</span>&nbsp;<span class="ident" id="2053550">n</span>&nbsp;<span class="builtintype" id="2053552">int</span><span class="op" id="2053555">)</span>&nbsp;<span class="op" id="2053557">[</span><span class="op" id="2053558">]</span><span class="op" id="2053559">[</span><span class="op" id="2053560">]</span><span class="builtintype" id="2053561">byte</span>&nbsp;<span class="op" id="2053566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053569">if</span>&nbsp;<span class="ident" id="2053572">n</span>&nbsp;<span class="op" id="2053574">&lt;=</span>&nbsp;<span class="num" id="2053577">0</span>&nbsp;<span class="op" id="2053579">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053583">n</span>&nbsp;<span class="op" id="2053585">=</span>&nbsp;<span class="builtinfunc" id="2053587">len</span><span class="op" id="2053590">(</span><span class="ident" id="2053591">s</span><span class="op" id="2053592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053598">a</span>&nbsp;<span class="op" id="2053600">:=</span>&nbsp;<span class="builtinfunc" id="2053603">make</span><span class="op" id="2053607">(</span><span class="op" id="2053608">[</span><span class="op" id="2053609">]</span><span class="op" id="2053610">[</span><span class="op" id="2053611">]</span><span class="builtintype" id="2053612">byte</span><span class="op" id="2053616">,</span>&nbsp;<span class="ident" id="2053618">n</span><span class="op" id="2053619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053622">var</span>&nbsp;<span class="ident" id="2053626">size</span>&nbsp;<span class="builtintype" id="2053631">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053636">na</span>&nbsp;<span class="op" id="2053639">:=</span>&nbsp;<span class="num" id="2053642">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053645">for</span>&nbsp;<span class="builtinfunc" id="2053649">len</span><span class="op" id="2053652">(</span><span class="ident" id="2053653">s</span><span class="op" id="2053654">)</span>&nbsp;<span class="op" id="2053656">&gt;</span>&nbsp;<span class="num" id="2053658">0</span>&nbsp;<span class="op" id="2053660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053664">if</span>&nbsp;<span class="ident" id="2053667">na</span><span class="op" id="2053669">+</span><span class="num" id="2053670">1</span>&nbsp;<span class="op" id="2053672">&gt;=</span>&nbsp;<span class="ident" id="2053675">n</span>&nbsp;<span class="op" id="2053677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053682">a</span><span class="op" id="2053683">[</span><span class="ident" id="2053684">na</span><span class="op" id="2053686">]</span>&nbsp;<span class="op" id="2053688">=</span>&nbsp;<span class="ident" id="2053690">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053695">na</span><span class="op" id="2053697">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053703">break</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053715">_</span><span class="op" id="2053716">,</span>&nbsp;<span class="ident" id="2053718">size</span>&nbsp;<span class="op" id="2053723">=</span>&nbsp;<span class="ident" id="2053725">utf8</span><span class="op" id="2053729">.</span><span class="ident" id="2053730">DecodeRune</span><span class="op" id="2053740">(</span><span class="ident" id="2053741">s</span><span class="op" id="2053742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053746">a</span><span class="op" id="2053747">[</span><span class="ident" id="2053748">na</span><span class="op" id="2053750">]</span>&nbsp;<span class="op" id="2053752">=</span>&nbsp;<span class="ident" id="2053754">s</span><span class="op" id="2053755">[</span><span class="num" id="2053756">0</span><span class="op" id="2053757">:</span><span class="ident" id="2053758">size</span><span class="op" id="2053762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053766">s</span>&nbsp;<span class="op" id="2053768">=</span>&nbsp;<span class="ident" id="2053770">s</span><span class="op" id="2053771">[</span><span class="ident" id="2053772">size</span><span class="op" id="2053776">:</span><span class="op" id="2053777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053781">na</span><span class="op" id="2053783">++</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053790">return</span>&nbsp;<span class="ident" id="2053797">a</span><span class="op" id="2053798">[</span><span class="num" id="2053799">0</span><span class="op" id="2053800">:</span><span class="ident" id="2053801">na</span><span class="op" id="2053803">]</span><br>
<span class="lineno"></span><span class="op" id="2053805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2053808">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno">50</span><span class="keyword" id="2053877">func</span>&nbsp;<span class="ident" id="2053882">Count</span><span class="op" id="2053887">(</span><span class="ident" id="2053888">s</span><span class="op" id="2053889">,</span>&nbsp;<span class="ident" id="2053891">sep</span>&nbsp;<span class="op" id="2053895">[</span><span class="op" id="2053896">]</span><span class="builtintype" id="2053897">byte</span><span class="op" id="2053901">)</span>&nbsp;<span class="builtintype" id="2053903">int</span>&nbsp;<span class="op" id="2053907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2053910">n</span>&nbsp;<span class="op" id="2053912">:=</span>&nbsp;<span class="builtinfunc" id="2053915">len</span><span class="op" id="2053918">(</span><span class="ident" id="2053919">sep</span><span class="op" id="2053922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053925">if</span>&nbsp;<span class="ident" id="2053928">n</span>&nbsp;<span class="op" id="2053930">==</span>&nbsp;<span class="num" id="2053933">0</span>&nbsp;<span class="op" id="2053935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053939">return</span>&nbsp;<span class="ident" id="2053946">utf8</span><span class="op" id="2053950">.</span><span class="ident" id="2053951">RuneCount</span><span class="op" id="2053960">(</span><span class="ident" id="2053961">s</span><span class="op" id="2053962">)</span>&nbsp;<span class="op" id="2053964">+</span>&nbsp;<span class="num" id="2053966">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2053969">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053972">if</span>&nbsp;<span class="ident" id="2053975">n</span>&nbsp;<span class="op" id="2053977">&gt;</span>&nbsp;<span class="builtinfunc" id="2053979">len</span><span class="op" id="2053982">(</span><span class="ident" id="2053983">s</span><span class="op" id="2053984">)</span>&nbsp;<span class="op" id="2053986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2053990">return</span>&nbsp;<span class="num" id="2053997">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054003">count</span>&nbsp;<span class="op" id="2054009">:=</span>&nbsp;<span class="num" id="2054012">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054015">c</span>&nbsp;<span class="op" id="2054017">:=</span>&nbsp;<span class="ident" id="2054020">sep</span><span class="op" id="2054023">[</span><span class="num" id="2054024">0</span><span class="op" id="2054025">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054028">i</span>&nbsp;<span class="op" id="2054030">:=</span>&nbsp;<span class="num" id="2054033">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054036">t</span>&nbsp;<span class="op" id="2054038">:=</span>&nbsp;<span class="ident" id="2054041">s</span><span class="op" id="2054042">[</span><span class="op" id="2054043">:</span><span class="builtinfunc" id="2054044">len</span><span class="op" id="2054047">(</span><span class="ident" id="2054048">s</span><span class="op" id="2054049">)</span><span class="op" id="2054050">-</span><span class="ident" id="2054051">n</span><span class="op" id="2054052">+</span><span class="num" id="2054053">1</span><span class="op" id="2054054">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054057">for</span>&nbsp;<span class="ident" id="2054061">i</span>&nbsp;<span class="op" id="2054063">&lt;</span>&nbsp;<span class="builtinfunc" id="2054065">len</span><span class="op" id="2054068">(</span><span class="ident" id="2054069">t</span><span class="op" id="2054070">)</span>&nbsp;<span class="op" id="2054072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054076">if</span>&nbsp;<span class="ident" id="2054079">t</span><span class="op" id="2054080">[</span><span class="ident" id="2054081">i</span><span class="op" id="2054082">]</span>&nbsp;<span class="op" id="2054084">!=</span>&nbsp;<span class="ident" id="2054087">c</span>&nbsp;<span class="op" id="2054089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054094">o</span>&nbsp;<span class="op" id="2054096">:=</span>&nbsp;<span class="ident" id="2054099">IndexByte</span><span class="op" id="2054108">(</span><span class="ident" id="2054109">t</span><span class="op" id="2054110">[</span><span class="ident" id="2054111">i</span><span class="op" id="2054112">:</span><span class="op" id="2054113">]</span><span class="op" id="2054114">,</span>&nbsp;<span class="ident" id="2054116">c</span><span class="op" id="2054117">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054122">if</span>&nbsp;<span class="ident" id="2054125">o</span>&nbsp;<span class="op" id="2054127">&lt;</span>&nbsp;<span class="num" id="2054129">0</span>&nbsp;<span class="op" id="2054131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054137">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054151">i</span>&nbsp;<span class="op" id="2054153">+=</span>&nbsp;<span class="ident" id="2054156">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054160">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054164">if</span>&nbsp;<span class="ident" id="2054167">n</span>&nbsp;<span class="op" id="2054169">==</span>&nbsp;<span class="num" id="2054172">1</span>&nbsp;<span class="op" id="2054174">||</span>&nbsp;<span class="ident" id="2054177">Equal</span><span class="op" id="2054182">(</span><span class="ident" id="2054183">s</span><span class="op" id="2054184">[</span><span class="ident" id="2054185">i</span><span class="op" id="2054186">:</span><span class="ident" id="2054187">i</span><span class="op" id="2054188">+</span><span class="ident" id="2054189">n</span><span class="op" id="2054190">]</span><span class="op" id="2054191">,</span>&nbsp;<span class="ident" id="2054193">sep</span><span class="op" id="2054196">)</span>&nbsp;<span class="op" id="2054198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054203">count</span><span class="op" id="2054208">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054214">i</span>&nbsp;<span class="op" id="2054216">+=</span>&nbsp;<span class="ident" id="2054219">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054224">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054235">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054239">i</span><span class="op" id="2054240">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054247">return</span>&nbsp;<span class="ident" id="2054254">count</span><br>
<span class="lineno"></span><span class="op" id="2054260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2054263">//&nbsp;Contains&nbsp;reports&nbsp;whether&nbsp;subslice&nbsp;is&nbsp;within&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2054313">func</span>&nbsp;<span class="ident" id="2054318">Contains</span><span class="op" id="2054326">(</span><span class="ident" id="2054327">b</span><span class="op" id="2054328">,</span>&nbsp;<span class="ident" id="2054330">subslice</span>&nbsp;<span class="op" id="2054339">[</span><span class="op" id="2054340">]</span><span class="builtintype" id="2054341">byte</span><span class="op" id="2054345">)</span>&nbsp;<span class="builtintype" id="2054347">bool</span>&nbsp;<span class="op" id="2054352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054355">return</span>&nbsp;<span class="ident" id="2054362">Index</span><span class="op" id="2054367">(</span><span class="ident" id="2054368">b</span><span class="op" id="2054369">,</span>&nbsp;<span class="ident" id="2054371">subslice</span><span class="op" id="2054379">)</span>&nbsp;<span class="op" id="2054381">!=</span>&nbsp;<span class="op" id="2054384">-</span><span class="num" id="2054385">1</span><br>
<span class="lineno"></span><span class="op" id="2054387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2054390">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2054486">func</span>&nbsp;<span class="ident" id="2054491">Index</span><span class="op" id="2054496">(</span><span class="ident" id="2054497">s</span><span class="op" id="2054498">,</span>&nbsp;<span class="ident" id="2054500">sep</span>&nbsp;<span class="op" id="2054504">[</span><span class="op" id="2054505">]</span><span class="builtintype" id="2054506">byte</span><span class="op" id="2054510">)</span>&nbsp;<span class="builtintype" id="2054512">int</span>&nbsp;<span class="op" id="2054516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054519">n</span>&nbsp;<span class="op" id="2054521">:=</span>&nbsp;<span class="builtinfunc" id="2054524">len</span><span class="op" id="2054527">(</span><span class="ident" id="2054528">sep</span><span class="op" id="2054531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054534">if</span>&nbsp;<span class="ident" id="2054537">n</span>&nbsp;<span class="op" id="2054539">==</span>&nbsp;<span class="num" id="2054542">0</span>&nbsp;<span class="op" id="2054544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054548">return</span>&nbsp;<span class="num" id="2054555">0</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054561">if</span>&nbsp;<span class="ident" id="2054564">n</span>&nbsp;<span class="op" id="2054566">&gt;</span>&nbsp;<span class="builtinfunc" id="2054568">len</span><span class="op" id="2054571">(</span><span class="ident" id="2054572">s</span><span class="op" id="2054573">)</span>&nbsp;<span class="op" id="2054575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054579">return</span>&nbsp;<span class="op" id="2054586">-</span><span class="num" id="2054587">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054593">c</span>&nbsp;<span class="op" id="2054595">:=</span>&nbsp;<span class="ident" id="2054598">sep</span><span class="op" id="2054601">[</span><span class="num" id="2054602">0</span><span class="op" id="2054603">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054606">if</span>&nbsp;<span class="ident" id="2054609">n</span>&nbsp;<span class="op" id="2054611">==</span>&nbsp;<span class="num" id="2054614">1</span>&nbsp;<span class="op" id="2054616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054620">return</span>&nbsp;<span class="ident" id="2054627">IndexByte</span><span class="op" id="2054636">(</span><span class="ident" id="2054637">s</span><span class="op" id="2054638">,</span>&nbsp;<span class="ident" id="2054640">c</span><span class="op" id="2054641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054647">i</span>&nbsp;<span class="op" id="2054649">:=</span>&nbsp;<span class="num" id="2054652">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054655">t</span>&nbsp;<span class="op" id="2054657">:=</span>&nbsp;<span class="ident" id="2054660">s</span><span class="op" id="2054661">[</span><span class="op" id="2054662">:</span><span class="builtinfunc" id="2054663">len</span><span class="op" id="2054666">(</span><span class="ident" id="2054667">s</span><span class="op" id="2054668">)</span><span class="op" id="2054669">-</span><span class="ident" id="2054670">n</span><span class="op" id="2054671">+</span><span class="num" id="2054672">1</span><span class="op" id="2054673">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054676">for</span>&nbsp;<span class="ident" id="2054680">i</span>&nbsp;<span class="op" id="2054682">&lt;</span>&nbsp;<span class="builtinfunc" id="2054684">len</span><span class="op" id="2054687">(</span><span class="ident" id="2054688">t</span><span class="op" id="2054689">)</span>&nbsp;<span class="op" id="2054691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054695">if</span>&nbsp;<span class="ident" id="2054698">t</span><span class="op" id="2054699">[</span><span class="ident" id="2054700">i</span><span class="op" id="2054701">]</span>&nbsp;<span class="op" id="2054703">!=</span>&nbsp;<span class="ident" id="2054706">c</span>&nbsp;<span class="op" id="2054708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054713">o</span>&nbsp;<span class="op" id="2054715">:=</span>&nbsp;<span class="ident" id="2054718">IndexByte</span><span class="op" id="2054727">(</span><span class="ident" id="2054728">t</span><span class="op" id="2054729">[</span><span class="ident" id="2054730">i</span><span class="op" id="2054731">:</span><span class="op" id="2054732">]</span><span class="op" id="2054733">,</span>&nbsp;<span class="ident" id="2054735">c</span><span class="op" id="2054736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054741">if</span>&nbsp;<span class="ident" id="2054744">o</span>&nbsp;<span class="op" id="2054746">&lt;</span>&nbsp;<span class="num" id="2054748">0</span>&nbsp;<span class="op" id="2054750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054756">break</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054770">i</span>&nbsp;<span class="op" id="2054772">+=</span>&nbsp;<span class="ident" id="2054775">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054783">if</span>&nbsp;<span class="ident" id="2054786">Equal</span><span class="op" id="2054791">(</span><span class="ident" id="2054792">s</span><span class="op" id="2054793">[</span><span class="ident" id="2054794">i</span><span class="op" id="2054795">:</span><span class="ident" id="2054796">i</span><span class="op" id="2054797">+</span><span class="ident" id="2054798">n</span><span class="op" id="2054799">]</span><span class="op" id="2054800">,</span>&nbsp;<span class="ident" id="2054802">sep</span><span class="op" id="2054805">)</span>&nbsp;<span class="op" id="2054807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054812">return</span>&nbsp;<span class="ident" id="2054819">i</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2054827">i</span><span class="op" id="2054828">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054835">return</span>&nbsp;<span class="op" id="2054842">-</span><span class="num" id="2054843">1</span><br>
<span class="lineno"></span><span class="op" id="2054845">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="2054848">func</span>&nbsp;<span class="ident" id="2054853">indexBytePortable</span><span class="op" id="2054870">(</span><span class="ident" id="2054871">s</span>&nbsp;<span class="op" id="2054873">[</span><span class="op" id="2054874">]</span><span class="builtintype" id="2054875">byte</span><span class="op" id="2054879">,</span>&nbsp;<span class="ident" id="2054881">c</span>&nbsp;<span class="builtintype" id="2054883">byte</span><span class="op" id="2054887">)</span>&nbsp;<span class="builtintype" id="2054889">int</span>&nbsp;<span class="op" id="2054893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054896">for</span>&nbsp;<span class="ident" id="2054900">i</span><span class="op" id="2054901">,</span>&nbsp;<span class="ident" id="2054903">b</span>&nbsp;<span class="op" id="2054905">:=</span>&nbsp;<span class="keyword" id="2054908">range</span>&nbsp;<span class="ident" id="2054914">s</span>&nbsp;<span class="op" id="2054916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054920">if</span>&nbsp;<span class="ident" id="2054923">b</span>&nbsp;<span class="op" id="2054925">==</span>&nbsp;<span class="ident" id="2054928">c</span>&nbsp;<span class="op" id="2054930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054935">return</span>&nbsp;<span class="ident" id="2054942">i</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2054949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2054952">return</span>&nbsp;<span class="op" id="2054959">-</span><span class="num" id="2054960">1</span><br>
<span class="lineno"></span><span class="op" id="2054962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2054965">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2055064">func</span>&nbsp;<span class="ident" id="2055069">LastIndex</span><span class="op" id="2055078">(</span><span class="ident" id="2055079">s</span><span class="op" id="2055080">,</span>&nbsp;<span class="ident" id="2055082">sep</span>&nbsp;<span class="op" id="2055086">[</span><span class="op" id="2055087">]</span><span class="builtintype" id="2055088">byte</span><span class="op" id="2055092">)</span>&nbsp;<span class="builtintype" id="2055094">int</span>&nbsp;<span class="op" id="2055098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2055101">n</span>&nbsp;<span class="op" id="2055103">:=</span>&nbsp;<span class="builtinfunc" id="2055106">len</span><span class="op" id="2055109">(</span><span class="ident" id="2055110">sep</span><span class="op" id="2055113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055116">if</span>&nbsp;<span class="ident" id="2055119">n</span>&nbsp;<span class="op" id="2055121">==</span>&nbsp;<span class="num" id="2055124">0</span>&nbsp;<span class="op" id="2055126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055130">return</span>&nbsp;<span class="builtinfunc" id="2055137">len</span><span class="op" id="2055140">(</span><span class="ident" id="2055141">s</span><span class="op" id="2055142">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2055145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2055148">c</span>&nbsp;<span class="op" id="2055150">:=</span>&nbsp;<span class="ident" id="2055153">sep</span><span class="op" id="2055156">[</span><span class="num" id="2055157">0</span><span class="op" id="2055158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055161">for</span>&nbsp;<span class="ident" id="2055165">i</span>&nbsp;<span class="op" id="2055167">:=</span>&nbsp;<span class="builtinfunc" id="2055170">len</span><span class="op" id="2055173">(</span><span class="ident" id="2055174">s</span><span class="op" id="2055175">)</span>&nbsp;<span class="op" id="2055177">-</span>&nbsp;<span class="ident" id="2055179">n</span><span class="op" id="2055180">;</span>&nbsp;<span class="ident" id="2055182">i</span>&nbsp;<span class="op" id="2055184">&gt;=</span>&nbsp;<span class="num" id="2055187">0</span><span class="op" id="2055188">;</span>&nbsp;<span class="ident" id="2055190">i</span><span class="op" id="2055191">--</span>&nbsp;<span class="op" id="2055194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055198">if</span>&nbsp;<span class="ident" id="2055201">s</span><span class="op" id="2055202">[</span><span class="ident" id="2055203">i</span><span class="op" id="2055204">]</span>&nbsp;<span class="op" id="2055206">==</span>&nbsp;<span class="ident" id="2055209">c</span>&nbsp;<span class="op" id="2055211">&amp;&amp;</span>&nbsp;<span class="op" id="2055214">(</span><span class="ident" id="2055215">n</span>&nbsp;<span class="op" id="2055217">==</span>&nbsp;<span class="num" id="2055220">1</span>&nbsp;<span class="op" id="2055222">||</span>&nbsp;<span class="ident" id="2055225">Equal</span><span class="op" id="2055230">(</span><span class="ident" id="2055231">s</span><span class="op" id="2055232">[</span><span class="ident" id="2055233">i</span><span class="op" id="2055234">:</span><span class="ident" id="2055235">i</span><span class="op" id="2055236">+</span><span class="ident" id="2055237">n</span><span class="op" id="2055238">]</span><span class="op" id="2055239">,</span>&nbsp;<span class="ident" id="2055241">sep</span><span class="op" id="2055244">)</span><span class="op" id="2055245">)</span>&nbsp;<span class="op" id="2055247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055252">return</span>&nbsp;<span class="ident" id="2055259">i</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2055263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2055266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055269">return</span>&nbsp;<span class="op" id="2055276">-</span><span class="num" id="2055277">1</span><br>
<span class="lineno"></span><span class="op" id="2055279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="2055282">//&nbsp;IndexRune&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2055360">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;given&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="2055437">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2055483">func</span>&nbsp;<span class="ident" id="2055488">IndexRune</span><span class="op" id="2055497">(</span><span class="ident" id="2055498">s</span>&nbsp;<span class="op" id="2055500">[</span><span class="op" id="2055501">]</span><span class="builtintype" id="2055502">byte</span><span class="op" id="2055506">,</span>&nbsp;<span class="ident" id="2055508">r</span>&nbsp;<span class="builtintype" id="2055510">rune</span><span class="op" id="2055514">)</span>&nbsp;<span class="builtintype" id="2055516">int</span>&nbsp;<span class="op" id="2055520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055523">for</span>&nbsp;<span class="ident" id="2055527">i</span>&nbsp;<span class="op" id="2055529">:=</span>&nbsp;<span class="num" id="2055532">0</span><span class="op" id="2055533">;</span>&nbsp;<span class="ident" id="2055535">i</span>&nbsp;<span class="op" id="2055537">&lt;</span>&nbsp;<span class="builtinfunc" id="2055539">len</span><span class="op" id="2055542">(</span><span class="ident" id="2055543">s</span><span class="op" id="2055544">)</span><span class="op" id="2055545">;</span>&nbsp;<span class="op" id="2055547">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2055551">r1</span><span class="op" id="2055553">,</span>&nbsp;<span class="ident" id="2055555">size</span>&nbsp;<span class="op" id="2055560">:=</span>&nbsp;<span class="ident" id="2055563">utf8</span><span class="op" id="2055567">.</span><span class="ident" id="2055568">DecodeRune</span><span class="op" id="2055578">(</span><span class="ident" id="2055579">s</span><span class="op" id="2055580">[</span><span class="ident" id="2055581">i</span><span class="op" id="2055582">:</span><span class="op" id="2055583">]</span><span class="op" id="2055584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055588">if</span>&nbsp;<span class="ident" id="2055591">r</span>&nbsp;<span class="op" id="2055593">==</span>&nbsp;<span class="ident" id="2055596">r1</span>&nbsp;<span class="op" id="2055599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055604">return</span>&nbsp;<span class="ident" id="2055611">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2055615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2055619">i</span>&nbsp;<span class="op" id="2055621">+=</span>&nbsp;<span class="ident" id="2055624">size</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2055630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055633">return</span>&nbsp;<span class="op" id="2055640">-</span><span class="num" id="2055641">1</span><br>
<span class="lineno"></span><span class="op" id="2055643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2055646">//&nbsp;IndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno">155</span><span class="comment" id="2055723">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="2055803">//&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2055884">//&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="2055904">func</span>&nbsp;<span class="ident" id="2055909">IndexAny</span><span class="op" id="2055917">(</span><span class="ident" id="2055918">s</span>&nbsp;<span class="op" id="2055920">[</span><span class="op" id="2055921">]</span><span class="builtintype" id="2055922">byte</span><span class="op" id="2055926">,</span>&nbsp;<span class="ident" id="2055928">chars</span>&nbsp;<span class="builtintype" id="2055934">string</span><span class="op" id="2055940">)</span>&nbsp;<span class="builtintype" id="2055942">int</span>&nbsp;<span class="op" id="2055946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055949">if</span>&nbsp;<span class="builtinfunc" id="2055952">len</span><span class="op" id="2055955">(</span><span class="ident" id="2055956">chars</span><span class="op" id="2055961">)</span>&nbsp;<span class="op" id="2055963">&gt;</span>&nbsp;<span class="num" id="2055965">0</span>&nbsp;<span class="op" id="2055967">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055971">var</span>&nbsp;<span class="ident" id="2055975">r</span>&nbsp;<span class="builtintype" id="2055977">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2055984">var</span>&nbsp;<span class="ident" id="2055988">width</span>&nbsp;<span class="builtintype" id="2055994">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056000">for</span>&nbsp;<span class="ident" id="2056004">i</span>&nbsp;<span class="op" id="2056006">:=</span>&nbsp;<span class="num" id="2056009">0</span><span class="op" id="2056010">;</span>&nbsp;<span class="ident" id="2056012">i</span>&nbsp;<span class="op" id="2056014">&lt;</span>&nbsp;<span class="builtinfunc" id="2056016">len</span><span class="op" id="2056019">(</span><span class="ident" id="2056020">s</span><span class="op" id="2056021">)</span><span class="op" id="2056022">;</span>&nbsp;<span class="ident" id="2056024">i</span>&nbsp;<span class="op" id="2056026">+=</span>&nbsp;<span class="ident" id="2056029">width</span>&nbsp;<span class="op" id="2056035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2056040">r</span>&nbsp;<span class="op" id="2056042">=</span>&nbsp;<span class="builtintype" id="2056044">rune</span><span class="op" id="2056048">(</span><span class="ident" id="2056049">s</span><span class="op" id="2056050">[</span><span class="ident" id="2056051">i</span><span class="op" id="2056052">]</span><span class="op" id="2056053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056058">if</span>&nbsp;<span class="ident" id="2056061">r</span>&nbsp;<span class="op" id="2056063">&lt;</span>&nbsp;<span class="ident" id="2056065">utf8</span><span class="op" id="2056069">.</span><span class="ident" id="2056070">RuneSelf</span>&nbsp;<span class="op" id="2056079">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2056085">width</span>&nbsp;<span class="op" id="2056091">=</span>&nbsp;<span class="num" id="2056093">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056098">}</span>&nbsp;<span class="keyword" id="2056100">else</span>&nbsp;<span class="op" id="2056105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2056111">r</span><span class="op" id="2056112">,</span>&nbsp;<span class="ident" id="2056114">width</span>&nbsp;<span class="op" id="2056120">=</span>&nbsp;<span class="ident" id="2056122">utf8</span><span class="op" id="2056126">.</span><span class="ident" id="2056127">DecodeRune</span><span class="op" id="2056137">(</span><span class="ident" id="2056138">s</span><span class="op" id="2056139">[</span><span class="ident" id="2056140">i</span><span class="op" id="2056141">:</span><span class="op" id="2056142">]</span><span class="op" id="2056143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056153">for</span>&nbsp;<span class="ident" id="2056157">_</span><span class="op" id="2056158">,</span>&nbsp;<span class="ident" id="2056160">ch</span>&nbsp;<span class="op" id="2056163">:=</span>&nbsp;<span class="keyword" id="2056166">range</span>&nbsp;<span class="ident" id="2056172">chars</span>&nbsp;<span class="op" id="2056178">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056184">if</span>&nbsp;<span class="ident" id="2056187">r</span>&nbsp;<span class="op" id="2056189">==</span>&nbsp;<span class="ident" id="2056192">ch</span>&nbsp;<span class="op" id="2056195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056202">return</span>&nbsp;<span class="ident" id="2056209">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056224">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056230">return</span>&nbsp;<span class="op" id="2056237">-</span><span class="num" id="2056238">1</span><br>
<span class="lineno"></span><span class="op" id="2056240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2056243">//&nbsp;LastIndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno">180</span><span class="comment" id="2056316">//&nbsp;points.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2056392">//&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2056468">//&nbsp;there&nbsp;is&nbsp;no&nbsp;code&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="2056505">func</span>&nbsp;<span class="ident" id="2056510">LastIndexAny</span><span class="op" id="2056522">(</span><span class="ident" id="2056523">s</span>&nbsp;<span class="op" id="2056525">[</span><span class="op" id="2056526">]</span><span class="builtintype" id="2056527">byte</span><span class="op" id="2056531">,</span>&nbsp;<span class="ident" id="2056533">chars</span>&nbsp;<span class="builtintype" id="2056539">string</span><span class="op" id="2056545">)</span>&nbsp;<span class="builtintype" id="2056547">int</span>&nbsp;<span class="op" id="2056551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056554">if</span>&nbsp;<span class="builtinfunc" id="2056557">len</span><span class="op" id="2056560">(</span><span class="ident" id="2056561">chars</span><span class="op" id="2056566">)</span>&nbsp;<span class="op" id="2056568">&gt;</span>&nbsp;<span class="num" id="2056570">0</span>&nbsp;<span class="op" id="2056572">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056576">for</span>&nbsp;<span class="ident" id="2056580">i</span>&nbsp;<span class="op" id="2056582">:=</span>&nbsp;<span class="builtinfunc" id="2056585">len</span><span class="op" id="2056588">(</span><span class="ident" id="2056589">s</span><span class="op" id="2056590">)</span><span class="op" id="2056591">;</span>&nbsp;<span class="ident" id="2056593">i</span>&nbsp;<span class="op" id="2056595">&gt;</span>&nbsp;<span class="num" id="2056597">0</span><span class="op" id="2056598">;</span>&nbsp;<span class="op" id="2056600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2056605">r</span><span class="op" id="2056606">,</span>&nbsp;<span class="ident" id="2056608">size</span>&nbsp;<span class="op" id="2056613">:=</span>&nbsp;<span class="ident" id="2056616">utf8</span><span class="op" id="2056620">.</span><span class="ident" id="2056621">DecodeLastRune</span><span class="op" id="2056635">(</span><span class="ident" id="2056636">s</span><span class="op" id="2056637">[</span><span class="num" id="2056638">0</span><span class="op" id="2056639">:</span><span class="ident" id="2056640">i</span><span class="op" id="2056641">]</span><span class="op" id="2056642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2056647">i</span>&nbsp;<span class="op" id="2056649">-=</span>&nbsp;<span class="ident" id="2056652">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056660">for</span>&nbsp;<span class="ident" id="2056664">_</span><span class="op" id="2056665">,</span>&nbsp;<span class="ident" id="2056667">ch</span>&nbsp;<span class="op" id="2056670">:=</span>&nbsp;<span class="keyword" id="2056673">range</span>&nbsp;<span class="ident" id="2056679">chars</span>&nbsp;<span class="op" id="2056685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056691">if</span>&nbsp;<span class="ident" id="2056694">r</span>&nbsp;<span class="op" id="2056696">==</span>&nbsp;<span class="ident" id="2056699">ch</span>&nbsp;<span class="op" id="2056702">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056709">return</span>&nbsp;<span class="ident" id="2056716">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056734">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056737">return</span>&nbsp;<span class="op" id="2056744">-</span><span class="num" id="2056745">1</span><br>
<span class="lineno"></span><span class="op" id="2056747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2056750">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2056803">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subslices.</span><br>
<span class="lineno">200</span><span class="keyword" id="2056855">func</span>&nbsp;<span class="ident" id="2056860">genSplit</span><span class="op" id="2056868">(</span><span class="ident" id="2056869">s</span><span class="op" id="2056870">,</span>&nbsp;<span class="ident" id="2056872">sep</span>&nbsp;<span class="op" id="2056876">[</span><span class="op" id="2056877">]</span><span class="builtintype" id="2056878">byte</span><span class="op" id="2056882">,</span>&nbsp;<span class="ident" id="2056884">sepSave</span><span class="op" id="2056891">,</span>&nbsp;<span class="ident" id="2056893">n</span>&nbsp;<span class="builtintype" id="2056895">int</span><span class="op" id="2056898">)</span>&nbsp;<span class="op" id="2056900">[</span><span class="op" id="2056901">]</span><span class="op" id="2056902">[</span><span class="op" id="2056903">]</span><span class="builtintype" id="2056904">byte</span>&nbsp;<span class="op" id="2056909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056912">if</span>&nbsp;<span class="ident" id="2056915">n</span>&nbsp;<span class="op" id="2056917">==</span>&nbsp;<span class="num" id="2056920">0</span>&nbsp;<span class="op" id="2056922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056926">return</span>&nbsp;<span class="ident" id="2056933">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056941">if</span>&nbsp;<span class="builtinfunc" id="2056944">len</span><span class="op" id="2056947">(</span><span class="ident" id="2056948">sep</span><span class="op" id="2056951">)</span>&nbsp;<span class="op" id="2056953">==</span>&nbsp;<span class="num" id="2056956">0</span>&nbsp;<span class="op" id="2056958">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056962">return</span>&nbsp;<span class="ident" id="2056969">explode</span><span class="op" id="2056976">(</span><span class="ident" id="2056977">s</span><span class="op" id="2056978">,</span>&nbsp;<span class="ident" id="2056980">n</span><span class="op" id="2056981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2056984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2056987">if</span>&nbsp;<span class="ident" id="2056990">n</span>&nbsp;<span class="op" id="2056992">&lt;</span>&nbsp;<span class="num" id="2056994">0</span>&nbsp;<span class="op" id="2056996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057000">n</span>&nbsp;<span class="op" id="2057002">=</span>&nbsp;<span class="ident" id="2057004">Count</span><span class="op" id="2057009">(</span><span class="ident" id="2057010">s</span><span class="op" id="2057011">,</span>&nbsp;<span class="ident" id="2057013">sep</span><span class="op" id="2057016">)</span>&nbsp;<span class="op" id="2057018">+</span>&nbsp;<span class="num" id="2057020">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2057023">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057026">c</span>&nbsp;<span class="op" id="2057028">:=</span>&nbsp;<span class="ident" id="2057031">sep</span><span class="op" id="2057034">[</span><span class="num" id="2057035">0</span><span class="op" id="2057036">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057039">start</span>&nbsp;<span class="op" id="2057045">:=</span>&nbsp;<span class="num" id="2057048">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057051">a</span>&nbsp;<span class="op" id="2057053">:=</span>&nbsp;<span class="builtinfunc" id="2057056">make</span><span class="op" id="2057060">(</span><span class="op" id="2057061">[</span><span class="op" id="2057062">]</span><span class="op" id="2057063">[</span><span class="op" id="2057064">]</span><span class="builtintype" id="2057065">byte</span><span class="op" id="2057069">,</span>&nbsp;<span class="ident" id="2057071">n</span><span class="op" id="2057072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057075">na</span>&nbsp;<span class="op" id="2057078">:=</span>&nbsp;<span class="num" id="2057081">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2057084">for</span>&nbsp;<span class="ident" id="2057088">i</span>&nbsp;<span class="op" id="2057090">:=</span>&nbsp;<span class="num" id="2057093">0</span><span class="op" id="2057094">;</span>&nbsp;<span class="ident" id="2057096">i</span><span class="op" id="2057097">+</span><span class="builtinfunc" id="2057098">len</span><span class="op" id="2057101">(</span><span class="ident" id="2057102">sep</span><span class="op" id="2057105">)</span>&nbsp;<span class="op" id="2057107">&lt;=</span>&nbsp;<span class="builtinfunc" id="2057110">len</span><span class="op" id="2057113">(</span><span class="ident" id="2057114">s</span><span class="op" id="2057115">)</span>&nbsp;<span class="op" id="2057117">&amp;&amp;</span>&nbsp;<span class="ident" id="2057120">na</span><span class="op" id="2057122">+</span><span class="num" id="2057123">1</span>&nbsp;<span class="op" id="2057125">&lt;</span>&nbsp;<span class="ident" id="2057127">n</span><span class="op" id="2057128">;</span>&nbsp;<span class="ident" id="2057130">i</span><span class="op" id="2057131">++</span>&nbsp;<span class="op" id="2057134">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2057138">if</span>&nbsp;<span class="ident" id="2057141">s</span><span class="op" id="2057142">[</span><span class="ident" id="2057143">i</span><span class="op" id="2057144">]</span>&nbsp;<span class="op" id="2057146">==</span>&nbsp;<span class="ident" id="2057149">c</span>&nbsp;<span class="op" id="2057151">&amp;&amp;</span>&nbsp;<span class="op" id="2057154">(</span><span class="builtinfunc" id="2057155">len</span><span class="op" id="2057158">(</span><span class="ident" id="2057159">sep</span><span class="op" id="2057162">)</span>&nbsp;<span class="op" id="2057164">==</span>&nbsp;<span class="num" id="2057167">1</span>&nbsp;<span class="op" id="2057169">||</span>&nbsp;<span class="ident" id="2057172">Equal</span><span class="op" id="2057177">(</span><span class="ident" id="2057178">s</span><span class="op" id="2057179">[</span><span class="ident" id="2057180">i</span><span class="op" id="2057181">:</span><span class="ident" id="2057182">i</span><span class="op" id="2057183">+</span><span class="builtinfunc" id="2057184">len</span><span class="op" id="2057187">(</span><span class="ident" id="2057188">sep</span><span class="op" id="2057191">)</span><span class="op" id="2057192">]</span><span class="op" id="2057193">,</span>&nbsp;<span class="ident" id="2057195">sep</span><span class="op" id="2057198">)</span><span class="op" id="2057199">)</span>&nbsp;<span class="op" id="2057201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057206">a</span><span class="op" id="2057207">[</span><span class="ident" id="2057208">na</span><span class="op" id="2057210">]</span>&nbsp;<span class="op" id="2057212">=</span>&nbsp;<span class="ident" id="2057214">s</span><span class="op" id="2057215">[</span><span class="ident" id="2057216">start</span>&nbsp;<span class="op" id="2057222">:</span>&nbsp;<span class="ident" id="2057224">i</span><span class="op" id="2057225">+</span><span class="ident" id="2057226">sepSave</span><span class="op" id="2057233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057238">na</span><span class="op" id="2057240">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057246">start</span>&nbsp;<span class="op" id="2057252">=</span>&nbsp;<span class="ident" id="2057254">i</span>&nbsp;<span class="op" id="2057256">+</span>&nbsp;<span class="builtinfunc" id="2057258">len</span><span class="op" id="2057261">(</span><span class="ident" id="2057262">sep</span><span class="op" id="2057265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057270">i</span>&nbsp;<span class="op" id="2057272">+=</span>&nbsp;<span class="builtinfunc" id="2057275">len</span><span class="op" id="2057278">(</span><span class="ident" id="2057279">sep</span><span class="op" id="2057282">)</span>&nbsp;<span class="op" id="2057284">-</span>&nbsp;<span class="num" id="2057286">1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2057290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2057293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2057296">a</span><span class="op" id="2057297">[</span><span class="ident" id="2057298">na</span><span class="op" id="2057300">]</span>&nbsp;<span class="op" id="2057302">=</span>&nbsp;<span class="ident" id="2057304">s</span><span class="op" id="2057305">[</span><span class="ident" id="2057306">start</span><span class="op" id="2057311">:</span><span class="op" id="2057312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2057315">return</span>&nbsp;<span class="ident" id="2057322">a</span><span class="op" id="2057323">[</span><span class="num" id="2057324">0</span>&nbsp;<span class="op" id="2057326">:</span>&nbsp;<span class="ident" id="2057328">na</span><span class="op" id="2057330">+</span><span class="num" id="2057331">1</span><span class="op" id="2057332">]</span><br>
<span class="lineno"></span><span class="op" id="2057334">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2057337">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2057411">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2057454">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2057515">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno">230</span><span class="comment" id="2057574">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2057656">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="2057704">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="2057730">func</span>&nbsp;<span class="ident" id="2057735">SplitN</span><span class="op" id="2057741">(</span><span class="ident" id="2057742">s</span><span class="op" id="2057743">,</span>&nbsp;<span class="ident" id="2057745">sep</span>&nbsp;<span class="op" id="2057749">[</span><span class="op" id="2057750">]</span><span class="builtintype" id="2057751">byte</span><span class="op" id="2057755">,</span>&nbsp;<span class="ident" id="2057757">n</span>&nbsp;<span class="builtintype" id="2057759">int</span><span class="op" id="2057762">)</span>&nbsp;<span class="op" id="2057764">[</span><span class="op" id="2057765">]</span><span class="op" id="2057766">[</span><span class="op" id="2057767">]</span><span class="builtintype" id="2057768">byte</span>&nbsp;<span class="op" id="2057773">{</span>&nbsp;<span class="keyword" id="2057775">return</span>&nbsp;<span class="ident" id="2057782">genSplit</span><span class="op" id="2057790">(</span><span class="ident" id="2057791">s</span><span class="op" id="2057792">,</span>&nbsp;<span class="ident" id="2057794">sep</span><span class="op" id="2057797">,</span>&nbsp;<span class="num" id="2057799">0</span><span class="op" id="2057800">,</span>&nbsp;<span class="ident" id="2057802">n</span><span class="op" id="2057803">)</span>&nbsp;<span class="op" id="2057805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="2057808">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2057878">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="2057917">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2057983">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2058042">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">240</span><span class="comment" id="2058124">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="2058172">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="2058198">func</span>&nbsp;<span class="ident" id="2058203">SplitAfterN</span><span class="op" id="2058214">(</span><span class="ident" id="2058215">s</span><span class="op" id="2058216">,</span>&nbsp;<span class="ident" id="2058218">sep</span>&nbsp;<span class="op" id="2058222">[</span><span class="op" id="2058223">]</span><span class="builtintype" id="2058224">byte</span><span class="op" id="2058228">,</span>&nbsp;<span class="ident" id="2058230">n</span>&nbsp;<span class="builtintype" id="2058232">int</span><span class="op" id="2058235">)</span>&nbsp;<span class="op" id="2058237">[</span><span class="op" id="2058238">]</span><span class="op" id="2058239">[</span><span class="op" id="2058240">]</span><span class="builtintype" id="2058241">byte</span>&nbsp;<span class="op" id="2058246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2058249">return</span>&nbsp;<span class="ident" id="2058256">genSplit</span><span class="op" id="2058264">(</span><span class="ident" id="2058265">s</span><span class="op" id="2058266">,</span>&nbsp;<span class="ident" id="2058268">sep</span><span class="op" id="2058271">,</span>&nbsp;<span class="builtinfunc" id="2058273">len</span><span class="op" id="2058276">(</span><span class="ident" id="2058277">sep</span><span class="op" id="2058280">)</span><span class="op" id="2058281">,</span>&nbsp;<span class="ident" id="2058283">n</span><span class="op" id="2058284">)</span><br>
<span class="lineno"></span><span class="op" id="2058286">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="2058289">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2058366">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2058409">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2058469">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">250</span><span class="keyword" id="2058519">func</span>&nbsp;<span class="ident" id="2058524">Split</span><span class="op" id="2058529">(</span><span class="ident" id="2058530">s</span><span class="op" id="2058531">,</span>&nbsp;<span class="ident" id="2058533">sep</span>&nbsp;<span class="op" id="2058537">[</span><span class="op" id="2058538">]</span><span class="builtintype" id="2058539">byte</span><span class="op" id="2058543">)</span>&nbsp;<span class="op" id="2058545">[</span><span class="op" id="2058546">]</span><span class="op" id="2058547">[</span><span class="op" id="2058548">]</span><span class="builtintype" id="2058549">byte</span>&nbsp;<span class="op" id="2058554">{</span>&nbsp;<span class="keyword" id="2058556">return</span>&nbsp;<span class="ident" id="2058563">genSplit</span><span class="op" id="2058571">(</span><span class="ident" id="2058572">s</span><span class="op" id="2058573">,</span>&nbsp;<span class="ident" id="2058575">sep</span><span class="op" id="2058578">,</span>&nbsp;<span class="num" id="2058580">0</span><span class="op" id="2058581">,</span>&nbsp;<span class="op" id="2058583">-</span><span class="num" id="2058584">1</span><span class="op" id="2058585">)</span>&nbsp;<span class="op" id="2058587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2058590">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2058663">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="2058702">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">255</span><span class="comment" id="2058767">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2058822">func</span>&nbsp;<span class="ident" id="2058827">SplitAfter</span><span class="op" id="2058837">(</span><span class="ident" id="2058838">s</span><span class="op" id="2058839">,</span>&nbsp;<span class="ident" id="2058841">sep</span>&nbsp;<span class="op" id="2058845">[</span><span class="op" id="2058846">]</span><span class="builtintype" id="2058847">byte</span><span class="op" id="2058851">)</span>&nbsp;<span class="op" id="2058853">[</span><span class="op" id="2058854">]</span><span class="op" id="2058855">[</span><span class="op" id="2058856">]</span><span class="builtintype" id="2058857">byte</span>&nbsp;<span class="op" id="2058862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2058865">return</span>&nbsp;<span class="ident" id="2058872">genSplit</span><span class="op" id="2058880">(</span><span class="ident" id="2058881">s</span><span class="op" id="2058882">,</span>&nbsp;<span class="ident" id="2058884">sep</span><span class="op" id="2058887">,</span>&nbsp;<span class="builtinfunc" id="2058889">len</span><span class="op" id="2058892">(</span><span class="ident" id="2058893">sep</span><span class="op" id="2058896">)</span><span class="op" id="2058897">,</span>&nbsp;<span class="op" id="2058899">-</span><span class="num" id="2058900">1</span><span class="op" id="2058901">)</span><br>
<span class="lineno"></span><span class="op" id="2058903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="2058906">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2058995">//&nbsp;characters,&nbsp;returning&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s&nbsp;or&nbsp;an&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2059095">func</span>&nbsp;<span class="ident" id="2059100">Fields</span><span class="op" id="2059106">(</span><span class="ident" id="2059107">s</span>&nbsp;<span class="op" id="2059109">[</span><span class="op" id="2059110">]</span><span class="builtintype" id="2059111">byte</span><span class="op" id="2059115">)</span>&nbsp;<span class="op" id="2059117">[</span><span class="op" id="2059118">]</span><span class="op" id="2059119">[</span><span class="op" id="2059120">]</span><span class="builtintype" id="2059121">byte</span>&nbsp;<span class="op" id="2059126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2059129">return</span>&nbsp;<span class="ident" id="2059136">FieldsFunc</span><span class="op" id="2059146">(</span><span class="ident" id="2059147">s</span><span class="op" id="2059148">,</span>&nbsp;<span class="ident" id="2059150">unicode</span><span class="op" id="2059157">.</span><span class="ident" id="2059158">IsSpace</span><span class="op" id="2059165">)</span><br>
<span class="lineno"></span><span class="op" id="2059167">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="comment" id="2059170">//&nbsp;FieldsFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2059249">//&nbsp;It&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2059323">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2059403">//&nbsp;len(s)&nbsp;==&nbsp;0,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">270</span><span class="comment" id="2059447">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2059521">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2059601">func</span>&nbsp;<span class="ident" id="2059606">FieldsFunc</span><span class="op" id="2059616">(</span><span class="ident" id="2059617">s</span>&nbsp;<span class="op" id="2059619">[</span><span class="op" id="2059620">]</span><span class="builtintype" id="2059621">byte</span><span class="op" id="2059625">,</span>&nbsp;<span class="ident" id="2059627">f</span>&nbsp;<span class="keyword" id="2059629">func</span><span class="op" id="2059633">(</span><span class="builtintype" id="2059634">rune</span><span class="op" id="2059638">)</span>&nbsp;<span class="builtintype" id="2059640">bool</span><span class="op" id="2059644">)</span>&nbsp;<span class="op" id="2059646">[</span><span class="op" id="2059647">]</span><span class="op" id="2059648">[</span><span class="op" id="2059649">]</span><span class="builtintype" id="2059650">byte</span>&nbsp;<span class="op" id="2059655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059658">n</span>&nbsp;<span class="op" id="2059660">:=</span>&nbsp;<span class="num" id="2059663">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059666">inField</span>&nbsp;<span class="op" id="2059674">:=</span>&nbsp;<span class="builtintype" id="2059677">false</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2059684">for</span>&nbsp;<span class="ident" id="2059688">i</span>&nbsp;<span class="op" id="2059690">:=</span>&nbsp;<span class="num" id="2059693">0</span><span class="op" id="2059694">;</span>&nbsp;<span class="ident" id="2059696">i</span>&nbsp;<span class="op" id="2059698">&lt;</span>&nbsp;<span class="builtinfunc" id="2059700">len</span><span class="op" id="2059703">(</span><span class="ident" id="2059704">s</span><span class="op" id="2059705">)</span><span class="op" id="2059706">;</span>&nbsp;<span class="op" id="2059708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059712">r</span><span class="op" id="2059713">,</span>&nbsp;<span class="ident" id="2059715">size</span>&nbsp;<span class="op" id="2059720">:=</span>&nbsp;<span class="ident" id="2059723">utf8</span><span class="op" id="2059727">.</span><span class="ident" id="2059728">DecodeRune</span><span class="op" id="2059738">(</span><span class="ident" id="2059739">s</span><span class="op" id="2059740">[</span><span class="ident" id="2059741">i</span><span class="op" id="2059742">:</span><span class="op" id="2059743">]</span><span class="op" id="2059744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059748">wasInField</span>&nbsp;<span class="op" id="2059759">:=</span>&nbsp;<span class="ident" id="2059762">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059772">inField</span>&nbsp;<span class="op" id="2059780">=</span>&nbsp;<span class="op" id="2059782">!</span><span class="ident" id="2059783">f</span><span class="op" id="2059784">(</span><span class="ident" id="2059785">r</span><span class="op" id="2059786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2059790">if</span>&nbsp;<span class="ident" id="2059793">inField</span>&nbsp;<span class="op" id="2059801">&amp;&amp;</span>&nbsp;<span class="op" id="2059804">!</span><span class="ident" id="2059805">wasInField</span>&nbsp;<span class="op" id="2059816">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059821">n</span><span class="op" id="2059822">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2059827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059831">i</span>&nbsp;<span class="op" id="2059833">+=</span>&nbsp;<span class="ident" id="2059836">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2059842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059846">a</span>&nbsp;<span class="op" id="2059848">:=</span>&nbsp;<span class="builtinfunc" id="2059851">make</span><span class="op" id="2059855">(</span><span class="op" id="2059856">[</span><span class="op" id="2059857">]</span><span class="op" id="2059858">[</span><span class="op" id="2059859">]</span><span class="builtintype" id="2059860">byte</span><span class="op" id="2059864">,</span>&nbsp;<span class="ident" id="2059866">n</span><span class="op" id="2059867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059870">na</span>&nbsp;<span class="op" id="2059873">:=</span>&nbsp;<span class="num" id="2059876">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059879">fieldStart</span>&nbsp;<span class="op" id="2059890">:=</span>&nbsp;<span class="op" id="2059893">-</span><span class="num" id="2059894">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2059897">for</span>&nbsp;<span class="ident" id="2059901">i</span>&nbsp;<span class="op" id="2059903">:=</span>&nbsp;<span class="num" id="2059906">0</span><span class="op" id="2059907">;</span>&nbsp;<span class="ident" id="2059909">i</span>&nbsp;<span class="op" id="2059911">&lt;=</span>&nbsp;<span class="builtinfunc" id="2059914">len</span><span class="op" id="2059917">(</span><span class="ident" id="2059918">s</span><span class="op" id="2059919">)</span>&nbsp;<span class="op" id="2059921">&amp;&amp;</span>&nbsp;<span class="ident" id="2059924">na</span>&nbsp;<span class="op" id="2059927">&lt;</span>&nbsp;<span class="ident" id="2059929">n</span><span class="op" id="2059930">;</span>&nbsp;<span class="op" id="2059932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2059936">r</span><span class="op" id="2059937">,</span>&nbsp;<span class="ident" id="2059939">size</span>&nbsp;<span class="op" id="2059944">:=</span>&nbsp;<span class="ident" id="2059947">utf8</span><span class="op" id="2059951">.</span><span class="ident" id="2059952">DecodeRune</span><span class="op" id="2059962">(</span><span class="ident" id="2059963">s</span><span class="op" id="2059964">[</span><span class="ident" id="2059965">i</span><span class="op" id="2059966">:</span><span class="op" id="2059967">]</span><span class="op" id="2059968">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2059972">if</span>&nbsp;<span class="ident" id="2059975">fieldStart</span>&nbsp;<span class="op" id="2059986">&lt;</span>&nbsp;<span class="num" id="2059988">0</span>&nbsp;<span class="op" id="2059990">&amp;&amp;</span>&nbsp;<span class="ident" id="2059993">size</span>&nbsp;<span class="op" id="2059998">&gt;</span>&nbsp;<span class="num" id="2060000">0</span>&nbsp;<span class="op" id="2060002">&amp;&amp;</span>&nbsp;<span class="op" id="2060005">!</span><span class="ident" id="2060006">f</span><span class="op" id="2060007">(</span><span class="ident" id="2060008">r</span><span class="op" id="2060009">)</span>&nbsp;<span class="op" id="2060011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060016">fieldStart</span>&nbsp;<span class="op" id="2060027">=</span>&nbsp;<span class="ident" id="2060029">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060034">i</span>&nbsp;<span class="op" id="2060036">+=</span>&nbsp;<span class="ident" id="2060039">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060047">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060058">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060062">if</span>&nbsp;<span class="ident" id="2060065">fieldStart</span>&nbsp;<span class="op" id="2060076">&gt;=</span>&nbsp;<span class="num" id="2060079">0</span>&nbsp;<span class="op" id="2060081">&amp;&amp;</span>&nbsp;<span class="op" id="2060084">(</span><span class="ident" id="2060085">size</span>&nbsp;<span class="op" id="2060090">==</span>&nbsp;<span class="num" id="2060093">0</span>&nbsp;<span class="op" id="2060095">||</span>&nbsp;<span class="ident" id="2060098">f</span><span class="op" id="2060099">(</span><span class="ident" id="2060100">r</span><span class="op" id="2060101">)</span><span class="op" id="2060102">)</span>&nbsp;<span class="op" id="2060104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060109">a</span><span class="op" id="2060110">[</span><span class="ident" id="2060111">na</span><span class="op" id="2060113">]</span>&nbsp;<span class="op" id="2060115">=</span>&nbsp;<span class="ident" id="2060117">s</span><span class="op" id="2060118">[</span><span class="ident" id="2060119">fieldStart</span><span class="op" id="2060129">:</span><span class="ident" id="2060130">i</span><span class="op" id="2060131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060136">na</span><span class="op" id="2060138">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060144">fieldStart</span>&nbsp;<span class="op" id="2060155">=</span>&nbsp;<span class="op" id="2060157">-</span><span class="num" id="2060158">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060162">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060166">if</span>&nbsp;<span class="ident" id="2060169">size</span>&nbsp;<span class="op" id="2060174">==</span>&nbsp;<span class="num" id="2060177">0</span>&nbsp;<span class="op" id="2060179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060184">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060196">i</span>&nbsp;<span class="op" id="2060198">+=</span>&nbsp;<span class="ident" id="2060201">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060207">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060210">return</span>&nbsp;<span class="ident" id="2060217">a</span><span class="op" id="2060218">[</span><span class="num" id="2060219">0</span><span class="op" id="2060220">:</span><span class="ident" id="2060221">na</span><span class="op" id="2060223">]</span><br>
<span class="lineno"></span><span class="op" id="2060225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2060228">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;s&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice.&nbsp;The&nbsp;separator</span><br>
<span class="lineno"></span><span class="comment" id="2060309">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="2060367">func</span>&nbsp;<span class="ident" id="2060372">Join</span><span class="op" id="2060376">(</span><span class="ident" id="2060377">s</span>&nbsp;<span class="op" id="2060379">[</span><span class="op" id="2060380">]</span><span class="op" id="2060381">[</span><span class="op" id="2060382">]</span><span class="builtintype" id="2060383">byte</span><span class="op" id="2060387">,</span>&nbsp;<span class="ident" id="2060389">sep</span>&nbsp;<span class="op" id="2060393">[</span><span class="op" id="2060394">]</span><span class="builtintype" id="2060395">byte</span><span class="op" id="2060399">)</span>&nbsp;<span class="op" id="2060401">[</span><span class="op" id="2060402">]</span><span class="builtintype" id="2060403">byte</span>&nbsp;<span class="op" id="2060408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060411">if</span>&nbsp;<span class="builtinfunc" id="2060414">len</span><span class="op" id="2060417">(</span><span class="ident" id="2060418">s</span><span class="op" id="2060419">)</span>&nbsp;<span class="op" id="2060421">==</span>&nbsp;<span class="num" id="2060424">0</span>&nbsp;<span class="op" id="2060426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060430">return</span>&nbsp;<span class="op" id="2060437">[</span><span class="op" id="2060438">]</span><span class="builtintype" id="2060439">byte</span><span class="op" id="2060443">{</span><span class="op" id="2060444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060450">if</span>&nbsp;<span class="builtinfunc" id="2060453">len</span><span class="op" id="2060456">(</span><span class="ident" id="2060457">s</span><span class="op" id="2060458">)</span>&nbsp;<span class="op" id="2060460">==</span>&nbsp;<span class="num" id="2060463">1</span>&nbsp;<span class="op" id="2060465">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2060469">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060494">return</span>&nbsp;<span class="builtinfunc" id="2060501">append</span><span class="op" id="2060507">(</span><span class="op" id="2060508">[</span><span class="op" id="2060509">]</span><span class="builtintype" id="2060510">byte</span><span class="op" id="2060514">(</span><span class="ident" id="2060515">nil</span><span class="op" id="2060518">)</span><span class="op" id="2060519">,</span>&nbsp;<span class="ident" id="2060521">s</span><span class="op" id="2060522">[</span><span class="num" id="2060523">0</span><span class="op" id="2060524">]</span><span class="op" id="2060525">...</span><span class="op" id="2060528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060534">n</span>&nbsp;<span class="op" id="2060536">:=</span>&nbsp;<span class="builtinfunc" id="2060539">len</span><span class="op" id="2060542">(</span><span class="ident" id="2060543">sep</span><span class="op" id="2060546">)</span>&nbsp;<span class="op" id="2060548">*</span>&nbsp;<span class="op" id="2060550">(</span><span class="builtinfunc" id="2060551">len</span><span class="op" id="2060554">(</span><span class="ident" id="2060555">s</span><span class="op" id="2060556">)</span>&nbsp;<span class="op" id="2060558">-</span>&nbsp;<span class="num" id="2060560">1</span><span class="op" id="2060561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060564">for</span>&nbsp;<span class="ident" id="2060568">_</span><span class="op" id="2060569">,</span>&nbsp;<span class="ident" id="2060571">v</span>&nbsp;<span class="op" id="2060573">:=</span>&nbsp;<span class="keyword" id="2060576">range</span>&nbsp;<span class="ident" id="2060582">s</span>&nbsp;<span class="op" id="2060584">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060588">n</span>&nbsp;<span class="op" id="2060590">+=</span>&nbsp;<span class="builtinfunc" id="2060593">len</span><span class="op" id="2060596">(</span><span class="ident" id="2060597">v</span><span class="op" id="2060598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060605">b</span>&nbsp;<span class="op" id="2060607">:=</span>&nbsp;<span class="builtinfunc" id="2060610">make</span><span class="op" id="2060614">(</span><span class="op" id="2060615">[</span><span class="op" id="2060616">]</span><span class="builtintype" id="2060617">byte</span><span class="op" id="2060621">,</span>&nbsp;<span class="ident" id="2060623">n</span><span class="op" id="2060624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060627">bp</span>&nbsp;<span class="op" id="2060630">:=</span>&nbsp;<span class="builtinfunc" id="2060633">copy</span><span class="op" id="2060637">(</span><span class="ident" id="2060638">b</span><span class="op" id="2060639">,</span>&nbsp;<span class="ident" id="2060641">s</span><span class="op" id="2060642">[</span><span class="num" id="2060643">0</span><span class="op" id="2060644">]</span><span class="op" id="2060645">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060648">for</span>&nbsp;<span class="ident" id="2060652">_</span><span class="op" id="2060653">,</span>&nbsp;<span class="ident" id="2060655">v</span>&nbsp;<span class="op" id="2060657">:=</span>&nbsp;<span class="keyword" id="2060660">range</span>&nbsp;<span class="ident" id="2060666">s</span><span class="op" id="2060667">[</span><span class="num" id="2060668">1</span><span class="op" id="2060669">:</span><span class="op" id="2060670">]</span>&nbsp;<span class="op" id="2060672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060676">bp</span>&nbsp;<span class="op" id="2060679">+=</span>&nbsp;<span class="builtinfunc" id="2060682">copy</span><span class="op" id="2060686">(</span><span class="ident" id="2060687">b</span><span class="op" id="2060688">[</span><span class="ident" id="2060689">bp</span><span class="op" id="2060691">:</span><span class="op" id="2060692">]</span><span class="op" id="2060693">,</span>&nbsp;<span class="ident" id="2060695">sep</span><span class="op" id="2060698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2060702">bp</span>&nbsp;<span class="op" id="2060705">+=</span>&nbsp;<span class="builtinfunc" id="2060708">copy</span><span class="op" id="2060712">(</span><span class="ident" id="2060713">b</span><span class="op" id="2060714">[</span><span class="ident" id="2060715">bp</span><span class="op" id="2060717">:</span><span class="op" id="2060718">]</span><span class="op" id="2060719">,</span>&nbsp;<span class="ident" id="2060721">v</span><span class="op" id="2060722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2060725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060728">return</span>&nbsp;<span class="ident" id="2060735">b</span><br>
<span class="lineno">330</span><span class="op" id="2060737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2060740">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2060804">func</span>&nbsp;<span class="ident" id="2060809">HasPrefix</span><span class="op" id="2060818">(</span><span class="ident" id="2060819">s</span><span class="op" id="2060820">,</span>&nbsp;<span class="ident" id="2060822">prefix</span>&nbsp;<span class="op" id="2060829">[</span><span class="op" id="2060830">]</span><span class="builtintype" id="2060831">byte</span><span class="op" id="2060835">)</span>&nbsp;<span class="builtintype" id="2060837">bool</span>&nbsp;<span class="op" id="2060842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2060845">return</span>&nbsp;<span class="builtinfunc" id="2060852">len</span><span class="op" id="2060855">(</span><span class="ident" id="2060856">s</span><span class="op" id="2060857">)</span>&nbsp;<span class="op" id="2060859">&gt;=</span>&nbsp;<span class="builtinfunc" id="2060862">len</span><span class="op" id="2060865">(</span><span class="ident" id="2060866">prefix</span><span class="op" id="2060872">)</span>&nbsp;<span class="op" id="2060874">&amp;&amp;</span>&nbsp;<span class="ident" id="2060877">Equal</span><span class="op" id="2060882">(</span><span class="ident" id="2060883">s</span><span class="op" id="2060884">[</span><span class="num" id="2060885">0</span><span class="op" id="2060886">:</span><span class="builtinfunc" id="2060887">len</span><span class="op" id="2060890">(</span><span class="ident" id="2060891">prefix</span><span class="op" id="2060897">)</span><span class="op" id="2060898">]</span><span class="op" id="2060899">,</span>&nbsp;<span class="ident" id="2060901">prefix</span><span class="op" id="2060907">)</span><br>
<span class="lineno">335</span><span class="op" id="2060909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2060912">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2060974">func</span>&nbsp;<span class="ident" id="2060979">HasSuffix</span><span class="op" id="2060988">(</span><span class="ident" id="2060989">s</span><span class="op" id="2060990">,</span>&nbsp;<span class="ident" id="2060992">suffix</span>&nbsp;<span class="op" id="2060999">[</span><span class="op" id="2061000">]</span><span class="builtintype" id="2061001">byte</span><span class="op" id="2061005">)</span>&nbsp;<span class="builtintype" id="2061007">bool</span>&nbsp;<span class="op" id="2061012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2061015">return</span>&nbsp;<span class="builtinfunc" id="2061022">len</span><span class="op" id="2061025">(</span><span class="ident" id="2061026">s</span><span class="op" id="2061027">)</span>&nbsp;<span class="op" id="2061029">&gt;=</span>&nbsp;<span class="builtinfunc" id="2061032">len</span><span class="op" id="2061035">(</span><span class="ident" id="2061036">suffix</span><span class="op" id="2061042">)</span>&nbsp;<span class="op" id="2061044">&amp;&amp;</span>&nbsp;<span class="ident" id="2061047">Equal</span><span class="op" id="2061052">(</span><span class="ident" id="2061053">s</span><span class="op" id="2061054">[</span><span class="builtinfunc" id="2061055">len</span><span class="op" id="2061058">(</span><span class="ident" id="2061059">s</span><span class="op" id="2061060">)</span><span class="op" id="2061061">-</span><span class="builtinfunc" id="2061062">len</span><span class="op" id="2061065">(</span><span class="ident" id="2061066">suffix</span><span class="op" id="2061072">)</span><span class="op" id="2061073">:</span><span class="op" id="2061074">]</span><span class="op" id="2061075">,</span>&nbsp;<span class="ident" id="2061077">suffix</span><span class="op" id="2061083">)</span><br>
<span class="lineno">340</span><span class="op" id="2061085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2061088">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2061163">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2061255">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.&nbsp;&nbsp;The&nbsp;characters&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno">345</span><span class="comment" id="2061332">//&nbsp;output&nbsp;are&nbsp;interpreted&nbsp;as&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="2061396">func</span>&nbsp;<span class="ident" id="2061401">Map</span><span class="op" id="2061404">(</span><span class="ident" id="2061405">mapping</span>&nbsp;<span class="keyword" id="2061413">func</span><span class="op" id="2061417">(</span><span class="ident" id="2061418">r</span>&nbsp;<span class="builtintype" id="2061420">rune</span><span class="op" id="2061424">)</span>&nbsp;<span class="builtintype" id="2061426">rune</span><span class="op" id="2061430">,</span>&nbsp;<span class="ident" id="2061432">s</span>&nbsp;<span class="op" id="2061434">[</span><span class="op" id="2061435">]</span><span class="builtintype" id="2061436">byte</span><span class="op" id="2061440">)</span>&nbsp;<span class="op" id="2061442">[</span><span class="op" id="2061443">]</span><span class="builtintype" id="2061444">byte</span>&nbsp;<span class="op" id="2061449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2061452">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;slice&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2061514">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2061581">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061643">maxbytes</span>&nbsp;<span class="op" id="2061652">:=</span>&nbsp;<span class="builtinfunc" id="2061655">len</span><span class="op" id="2061658">(</span><span class="ident" id="2061659">s</span><span class="op" id="2061660">)</span>&nbsp;<span class="comment" id="2061662">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061678">nbytes</span>&nbsp;<span class="op" id="2061685">:=</span>&nbsp;<span class="num" id="2061688">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2061697">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061730">b</span>&nbsp;<span class="op" id="2061732">:=</span>&nbsp;<span class="builtinfunc" id="2061735">make</span><span class="op" id="2061739">(</span><span class="op" id="2061740">[</span><span class="op" id="2061741">]</span><span class="builtintype" id="2061742">byte</span><span class="op" id="2061746">,</span>&nbsp;<span class="ident" id="2061748">maxbytes</span><span class="op" id="2061756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2061759">for</span>&nbsp;<span class="ident" id="2061763">i</span>&nbsp;<span class="op" id="2061765">:=</span>&nbsp;<span class="num" id="2061768">0</span><span class="op" id="2061769">;</span>&nbsp;<span class="ident" id="2061771">i</span>&nbsp;<span class="op" id="2061773">&lt;</span>&nbsp;<span class="builtinfunc" id="2061775">len</span><span class="op" id="2061778">(</span><span class="ident" id="2061779">s</span><span class="op" id="2061780">)</span><span class="op" id="2061781">;</span>&nbsp;<span class="op" id="2061783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061787">wid</span>&nbsp;<span class="op" id="2061791">:=</span>&nbsp;<span class="num" id="2061794">1</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061798">r</span>&nbsp;<span class="op" id="2061800">:=</span>&nbsp;<span class="builtintype" id="2061803">rune</span><span class="op" id="2061807">(</span><span class="ident" id="2061808">s</span><span class="op" id="2061809">[</span><span class="ident" id="2061810">i</span><span class="op" id="2061811">]</span><span class="op" id="2061812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2061816">if</span>&nbsp;<span class="ident" id="2061819">r</span>&nbsp;<span class="op" id="2061821">&gt;=</span>&nbsp;<span class="ident" id="2061824">utf8</span><span class="op" id="2061828">.</span><span class="ident" id="2061829">RuneSelf</span>&nbsp;<span class="op" id="2061838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061843">r</span><span class="op" id="2061844">,</span>&nbsp;<span class="ident" id="2061846">wid</span>&nbsp;<span class="op" id="2061850">=</span>&nbsp;<span class="ident" id="2061852">utf8</span><span class="op" id="2061856">.</span><span class="ident" id="2061857">DecodeRune</span><span class="op" id="2061867">(</span><span class="ident" id="2061868">s</span><span class="op" id="2061869">[</span><span class="ident" id="2061870">i</span><span class="op" id="2061871">:</span><span class="op" id="2061872">]</span><span class="op" id="2061873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2061877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061881">r</span>&nbsp;<span class="op" id="2061883">=</span>&nbsp;<span class="ident" id="2061885">mapping</span><span class="op" id="2061892">(</span><span class="ident" id="2061893">r</span><span class="op" id="2061894">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2061898">if</span>&nbsp;<span class="ident" id="2061901">r</span>&nbsp;<span class="op" id="2061903">&gt;=</span>&nbsp;<span class="num" id="2061906">0</span>&nbsp;<span class="op" id="2061908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061913">rl</span>&nbsp;<span class="op" id="2061916">:=</span>&nbsp;<span class="ident" id="2061919">utf8</span><span class="op" id="2061923">.</span><span class="ident" id="2061924">RuneLen</span><span class="op" id="2061931">(</span><span class="ident" id="2061932">r</span><span class="op" id="2061933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2061938">if</span>&nbsp;<span class="ident" id="2061941">rl</span>&nbsp;<span class="op" id="2061944">&lt;</span>&nbsp;<span class="num" id="2061946">0</span>&nbsp;<span class="op" id="2061948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2061954">rl</span>&nbsp;<span class="op" id="2061957">=</span>&nbsp;<span class="builtinfunc" id="2061959">len</span><span class="op" id="2061962">(</span><span class="builtintype" id="2061963">string</span><span class="op" id="2061969">(</span><span class="ident" id="2061970">utf8</span><span class="op" id="2061974">.</span><span class="ident" id="2061975">RuneError</span><span class="op" id="2061984">)</span><span class="op" id="2061985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2061990">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2061995">if</span>&nbsp;<span class="ident" id="2061998">nbytes</span><span class="op" id="2062004">+</span><span class="ident" id="2062005">rl</span>&nbsp;<span class="op" id="2062008">&gt;</span>&nbsp;<span class="ident" id="2062010">maxbytes</span>&nbsp;<span class="op" id="2062019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2062025">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062049">maxbytes</span>&nbsp;<span class="op" id="2062058">=</span>&nbsp;<span class="ident" id="2062060">maxbytes</span><span class="op" id="2062068">*</span><span class="num" id="2062069">2</span>&nbsp;<span class="op" id="2062071">+</span>&nbsp;<span class="ident" id="2062073">utf8</span><span class="op" id="2062077">.</span><span class="ident" id="2062078">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062089">nb</span>&nbsp;<span class="op" id="2062092">:=</span>&nbsp;<span class="builtinfunc" id="2062095">make</span><span class="op" id="2062099">(</span><span class="op" id="2062100">[</span><span class="op" id="2062101">]</span><span class="builtintype" id="2062102">byte</span><span class="op" id="2062106">,</span>&nbsp;<span class="ident" id="2062108">maxbytes</span><span class="op" id="2062116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2062122">copy</span><span class="op" id="2062126">(</span><span class="ident" id="2062127">nb</span><span class="op" id="2062129">,</span>&nbsp;<span class="ident" id="2062131">b</span><span class="op" id="2062132">[</span><span class="num" id="2062133">0</span><span class="op" id="2062134">:</span><span class="ident" id="2062135">nbytes</span><span class="op" id="2062141">]</span><span class="op" id="2062142">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062148">b</span>&nbsp;<span class="op" id="2062150">=</span>&nbsp;<span class="ident" id="2062152">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2062158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062163">nbytes</span>&nbsp;<span class="op" id="2062170">+=</span>&nbsp;<span class="ident" id="2062173">utf8</span><span class="op" id="2062177">.</span><span class="ident" id="2062178">EncodeRune</span><span class="op" id="2062188">(</span><span class="ident" id="2062189">b</span><span class="op" id="2062190">[</span><span class="ident" id="2062191">nbytes</span><span class="op" id="2062197">:</span><span class="ident" id="2062198">maxbytes</span><span class="op" id="2062206">]</span><span class="op" id="2062207">,</span>&nbsp;<span class="ident" id="2062209">r</span><span class="op" id="2062210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2062214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062218">i</span>&nbsp;<span class="op" id="2062220">+=</span>&nbsp;<span class="ident" id="2062223">wid</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2062228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2062231">return</span>&nbsp;<span class="ident" id="2062238">b</span><span class="op" id="2062239">[</span><span class="num" id="2062240">0</span><span class="op" id="2062241">:</span><span class="ident" id="2062242">nbytes</span><span class="op" id="2062248">]</span><br>
<span class="lineno"></span><span class="op" id="2062250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2062253">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;b.</span><br>
<span class="lineno">380</span><span class="keyword" id="2062321">func</span>&nbsp;<span class="ident" id="2062326">Repeat</span><span class="op" id="2062332">(</span><span class="ident" id="2062333">b</span>&nbsp;<span class="op" id="2062335">[</span><span class="op" id="2062336">]</span><span class="builtintype" id="2062337">byte</span><span class="op" id="2062341">,</span>&nbsp;<span class="ident" id="2062343">count</span>&nbsp;<span class="builtintype" id="2062349">int</span><span class="op" id="2062352">)</span>&nbsp;<span class="op" id="2062354">[</span><span class="op" id="2062355">]</span><span class="builtintype" id="2062356">byte</span>&nbsp;<span class="op" id="2062361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062364">nb</span>&nbsp;<span class="op" id="2062367">:=</span>&nbsp;<span class="builtinfunc" id="2062370">make</span><span class="op" id="2062374">(</span><span class="op" id="2062375">[</span><span class="op" id="2062376">]</span><span class="builtintype" id="2062377">byte</span><span class="op" id="2062381">,</span>&nbsp;<span class="builtinfunc" id="2062383">len</span><span class="op" id="2062386">(</span><span class="ident" id="2062387">b</span><span class="op" id="2062388">)</span><span class="op" id="2062389">*</span><span class="ident" id="2062390">count</span><span class="op" id="2062395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062398">bp</span>&nbsp;<span class="op" id="2062401">:=</span>&nbsp;<span class="builtinfunc" id="2062404">copy</span><span class="op" id="2062408">(</span><span class="ident" id="2062409">nb</span><span class="op" id="2062411">,</span>&nbsp;<span class="ident" id="2062413">b</span><span class="op" id="2062414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2062417">for</span>&nbsp;<span class="ident" id="2062421">bp</span>&nbsp;<span class="op" id="2062424">&lt;</span>&nbsp;<span class="builtinfunc" id="2062426">len</span><span class="op" id="2062429">(</span><span class="ident" id="2062430">nb</span><span class="op" id="2062432">)</span>&nbsp;<span class="op" id="2062434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2062438">copy</span><span class="op" id="2062442">(</span><span class="ident" id="2062443">nb</span><span class="op" id="2062445">[</span><span class="ident" id="2062446">bp</span><span class="op" id="2062448">:</span><span class="op" id="2062449">]</span><span class="op" id="2062450">,</span>&nbsp;<span class="ident" id="2062452">nb</span><span class="op" id="2062454">[</span><span class="op" id="2062455">:</span><span class="ident" id="2062456">bp</span><span class="op" id="2062458">]</span><span class="op" id="2062459">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2062463">bp</span>&nbsp;<span class="op" id="2062466">*=</span>&nbsp;<span class="num" id="2062469">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2062472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2062475">return</span>&nbsp;<span class="ident" id="2062482">nb</span><br>
<span class="lineno"></span><span class="op" id="2062485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="comment" id="2062488">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2062587">func</span>&nbsp;<span class="ident" id="2062592">ToUpper</span><span class="op" id="2062599">(</span><span class="ident" id="2062600">s</span>&nbsp;<span class="op" id="2062602">[</span><span class="op" id="2062603">]</span><span class="builtintype" id="2062604">byte</span><span class="op" id="2062608">)</span>&nbsp;<span class="op" id="2062610">[</span><span class="op" id="2062611">]</span><span class="builtintype" id="2062612">byte</span>&nbsp;<span class="op" id="2062617">{</span>&nbsp;<span class="keyword" id="2062619">return</span>&nbsp;<span class="ident" id="2062626">Map</span><span class="op" id="2062629">(</span><span class="ident" id="2062630">unicode</span><span class="op" id="2062637">.</span><span class="ident" id="2062638">ToUpper</span><span class="op" id="2062645">,</span>&nbsp;<span class="ident" id="2062647">s</span><span class="op" id="2062648">)</span>&nbsp;<span class="op" id="2062650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2062653">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2062752">func</span>&nbsp;<span class="ident" id="2062757">ToLower</span><span class="op" id="2062764">(</span><span class="ident" id="2062765">s</span>&nbsp;<span class="op" id="2062767">[</span><span class="op" id="2062768">]</span><span class="builtintype" id="2062769">byte</span><span class="op" id="2062773">)</span>&nbsp;<span class="op" id="2062775">[</span><span class="op" id="2062776">]</span><span class="builtintype" id="2062777">byte</span>&nbsp;<span class="op" id="2062782">{</span>&nbsp;<span class="keyword" id="2062784">return</span>&nbsp;<span class="ident" id="2062791">Map</span><span class="op" id="2062794">(</span><span class="ident" id="2062795">unicode</span><span class="op" id="2062802">.</span><span class="ident" id="2062803">ToLower</span><span class="op" id="2062810">,</span>&nbsp;<span class="ident" id="2062812">s</span><span class="op" id="2062813">)</span>&nbsp;<span class="op" id="2062815">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="2062818">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2062917">func</span>&nbsp;<span class="ident" id="2062922">ToTitle</span><span class="op" id="2062929">(</span><span class="ident" id="2062930">s</span>&nbsp;<span class="op" id="2062932">[</span><span class="op" id="2062933">]</span><span class="builtintype" id="2062934">byte</span><span class="op" id="2062938">)</span>&nbsp;<span class="op" id="2062940">[</span><span class="op" id="2062941">]</span><span class="builtintype" id="2062942">byte</span>&nbsp;<span class="op" id="2062947">{</span>&nbsp;<span class="keyword" id="2062949">return</span>&nbsp;<span class="ident" id="2062956">Map</span><span class="op" id="2062959">(</span><span class="ident" id="2062960">unicode</span><span class="op" id="2062967">.</span><span class="ident" id="2062968">ToTitle</span><span class="op" id="2062975">,</span>&nbsp;<span class="ident" id="2062977">s</span><span class="op" id="2062978">)</span>&nbsp;<span class="op" id="2062980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2062983">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno">400</span><span class="comment" id="2063077">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2063137">func</span>&nbsp;<span class="ident" id="2063142">ToUpperSpecial</span><span class="op" id="2063156">(</span><span class="ident" id="2063157">_case</span>&nbsp;<span class="ident" id="2063163">unicode</span><span class="op" id="2063170">.</span><span class="ident" id="2063171">SpecialCase</span><span class="op" id="2063182">,</span>&nbsp;<span class="ident" id="2063184">s</span>&nbsp;<span class="op" id="2063186">[</span><span class="op" id="2063187">]</span><span class="builtintype" id="2063188">byte</span><span class="op" id="2063192">)</span>&nbsp;<span class="op" id="2063194">[</span><span class="op" id="2063195">]</span><span class="builtintype" id="2063196">byte</span>&nbsp;<span class="op" id="2063201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2063204">return</span>&nbsp;<span class="ident" id="2063211">Map</span><span class="op" id="2063214">(</span><span class="keyword" id="2063215">func</span><span class="op" id="2063219">(</span><span class="ident" id="2063220">r</span>&nbsp;<span class="builtintype" id="2063222">rune</span><span class="op" id="2063226">)</span>&nbsp;<span class="builtintype" id="2063228">rune</span>&nbsp;<span class="op" id="2063233">{</span>&nbsp;<span class="keyword" id="2063235">return</span>&nbsp;<span class="ident" id="2063242">_case</span><span class="op" id="2063247">.</span><span class="ident" id="2063248">ToUpper</span><span class="op" id="2063255">(</span><span class="ident" id="2063256">r</span><span class="op" id="2063257">)</span>&nbsp;<span class="op" id="2063259">}</span><span class="op" id="2063260">,</span>&nbsp;<span class="ident" id="2063262">s</span><span class="op" id="2063263">)</span><br>
<span class="lineno"></span><span class="op" id="2063265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="2063268">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2063362">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2063422">func</span>&nbsp;<span class="ident" id="2063427">ToLowerSpecial</span><span class="op" id="2063441">(</span><span class="ident" id="2063442">_case</span>&nbsp;<span class="ident" id="2063448">unicode</span><span class="op" id="2063455">.</span><span class="ident" id="2063456">SpecialCase</span><span class="op" id="2063467">,</span>&nbsp;<span class="ident" id="2063469">s</span>&nbsp;<span class="op" id="2063471">[</span><span class="op" id="2063472">]</span><span class="builtintype" id="2063473">byte</span><span class="op" id="2063477">)</span>&nbsp;<span class="op" id="2063479">[</span><span class="op" id="2063480">]</span><span class="builtintype" id="2063481">byte</span>&nbsp;<span class="op" id="2063486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2063489">return</span>&nbsp;<span class="ident" id="2063496">Map</span><span class="op" id="2063499">(</span><span class="keyword" id="2063500">func</span><span class="op" id="2063504">(</span><span class="ident" id="2063505">r</span>&nbsp;<span class="builtintype" id="2063507">rune</span><span class="op" id="2063511">)</span>&nbsp;<span class="builtintype" id="2063513">rune</span>&nbsp;<span class="op" id="2063518">{</span>&nbsp;<span class="keyword" id="2063520">return</span>&nbsp;<span class="ident" id="2063527">_case</span><span class="op" id="2063532">.</span><span class="ident" id="2063533">ToLower</span><span class="op" id="2063540">(</span><span class="ident" id="2063541">r</span><span class="op" id="2063542">)</span>&nbsp;<span class="op" id="2063544">}</span><span class="op" id="2063545">,</span>&nbsp;<span class="ident" id="2063547">s</span><span class="op" id="2063548">)</span><br>
<span class="lineno"></span><span class="op" id="2063550">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="2063553">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2063647">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2063707">func</span>&nbsp;<span class="ident" id="2063712">ToTitleSpecial</span><span class="op" id="2063726">(</span><span class="ident" id="2063727">_case</span>&nbsp;<span class="ident" id="2063733">unicode</span><span class="op" id="2063740">.</span><span class="ident" id="2063741">SpecialCase</span><span class="op" id="2063752">,</span>&nbsp;<span class="ident" id="2063754">s</span>&nbsp;<span class="op" id="2063756">[</span><span class="op" id="2063757">]</span><span class="builtintype" id="2063758">byte</span><span class="op" id="2063762">)</span>&nbsp;<span class="op" id="2063764">[</span><span class="op" id="2063765">]</span><span class="builtintype" id="2063766">byte</span>&nbsp;<span class="op" id="2063771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2063774">return</span>&nbsp;<span class="ident" id="2063781">Map</span><span class="op" id="2063784">(</span><span class="keyword" id="2063785">func</span><span class="op" id="2063789">(</span><span class="ident" id="2063790">r</span>&nbsp;<span class="builtintype" id="2063792">rune</span><span class="op" id="2063796">)</span>&nbsp;<span class="builtintype" id="2063798">rune</span>&nbsp;<span class="op" id="2063803">{</span>&nbsp;<span class="keyword" id="2063805">return</span>&nbsp;<span class="ident" id="2063812">_case</span><span class="op" id="2063817">.</span><span class="ident" id="2063818">ToTitle</span><span class="op" id="2063825">(</span><span class="ident" id="2063826">r</span><span class="op" id="2063827">)</span>&nbsp;<span class="op" id="2063829">}</span><span class="op" id="2063830">,</span>&nbsp;<span class="ident" id="2063832">s</span><span class="op" id="2063833">)</span><br>
<span class="lineno">415</span><span class="op" id="2063835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2063838">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="comment" id="2063906">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2063976">func</span>&nbsp;<span class="ident" id="2063981">isSeparator</span><span class="op" id="2063992">(</span><span class="ident" id="2063993">r</span>&nbsp;<span class="builtintype" id="2063995">rune</span><span class="op" id="2063999">)</span>&nbsp;<span class="builtintype" id="2064001">bool</span>&nbsp;<span class="op" id="2064006">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064009">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064067">if</span>&nbsp;<span class="ident" id="2064070">r</span>&nbsp;<span class="op" id="2064072">&lt;=</span>&nbsp;<span class="num" id="2064075">0x7F</span>&nbsp;<span class="op" id="2064080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064084">switch</span>&nbsp;<span class="op" id="2064091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064095">case</span>&nbsp;<span class="string" id="2064100">&#39;0&#39;</span>&nbsp;<span class="op" id="2064104">&lt;=</span>&nbsp;<span class="ident" id="2064107">r</span>&nbsp;<span class="op" id="2064109">&amp;&amp;</span>&nbsp;<span class="ident" id="2064112">r</span>&nbsp;<span class="op" id="2064114">&lt;=</span>&nbsp;<span class="string" id="2064117">&#39;9&#39;</span><span class="op" id="2064120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064125">return</span>&nbsp;<span class="builtintype" id="2064132">false</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064140">case</span>&nbsp;<span class="string" id="2064145">&#39;a&#39;</span>&nbsp;<span class="op" id="2064149">&lt;=</span>&nbsp;<span class="ident" id="2064152">r</span>&nbsp;<span class="op" id="2064154">&amp;&amp;</span>&nbsp;<span class="ident" id="2064157">r</span>&nbsp;<span class="op" id="2064159">&lt;=</span>&nbsp;<span class="string" id="2064162">&#39;z&#39;</span><span class="op" id="2064165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064170">return</span>&nbsp;<span class="builtintype" id="2064177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064185">case</span>&nbsp;<span class="string" id="2064190">&#39;A&#39;</span>&nbsp;<span class="op" id="2064194">&lt;=</span>&nbsp;<span class="ident" id="2064197">r</span>&nbsp;<span class="op" id="2064199">&amp;&amp;</span>&nbsp;<span class="ident" id="2064202">r</span>&nbsp;<span class="op" id="2064204">&lt;=</span>&nbsp;<span class="string" id="2064207">&#39;Z&#39;</span><span class="op" id="2064210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064215">return</span>&nbsp;<span class="builtintype" id="2064222">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064230">case</span>&nbsp;<span class="ident" id="2064235">r</span>&nbsp;<span class="op" id="2064237">==</span>&nbsp;<span class="string" id="2064240">&#39;_&#39;</span><span class="op" id="2064243">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064248">return</span>&nbsp;<span class="builtintype" id="2064255">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064267">return</span>&nbsp;<span class="builtintype" id="2064274">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064283">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064325">if</span>&nbsp;<span class="ident" id="2064328">unicode</span><span class="op" id="2064335">.</span><span class="ident" id="2064336">IsLetter</span><span class="op" id="2064344">(</span><span class="ident" id="2064345">r</span><span class="op" id="2064346">)</span>&nbsp;<span class="op" id="2064348">||</span>&nbsp;<span class="ident" id="2064351">unicode</span><span class="op" id="2064358">.</span><span class="ident" id="2064359">IsDigit</span><span class="op" id="2064366">(</span><span class="ident" id="2064367">r</span><span class="op" id="2064368">)</span>&nbsp;<span class="op" id="2064370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064374">return</span>&nbsp;<span class="builtintype" id="2064381">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064391">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064459">return</span>&nbsp;<span class="ident" id="2064466">unicode</span><span class="op" id="2064473">.</span><span class="ident" id="2064474">IsSpace</span><span class="op" id="2064481">(</span><span class="ident" id="2064482">r</span><span class="op" id="2064483">)</span><br>
<span class="lineno">440</span><span class="op" id="2064485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2064488">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno"></span><span class="comment" id="2064559">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2064590">//</span><br>
<span class="lineno">445</span><span class="comment" id="2064593">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2064687">func</span>&nbsp;<span class="ident" id="2064692">Title</span><span class="op" id="2064697">(</span><span class="ident" id="2064698">s</span>&nbsp;<span class="op" id="2064700">[</span><span class="op" id="2064701">]</span><span class="builtintype" id="2064702">byte</span><span class="op" id="2064706">)</span>&nbsp;<span class="op" id="2064708">[</span><span class="op" id="2064709">]</span><span class="builtintype" id="2064710">byte</span>&nbsp;<span class="op" id="2064715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064718">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064760">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064832">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064863">prev</span>&nbsp;<span class="op" id="2064868">:=</span>&nbsp;<span class="string" id="2064871">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064876">return</span>&nbsp;<span class="ident" id="2064883">Map</span><span class="op" id="2064886">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064890">func</span><span class="op" id="2064894">(</span><span class="ident" id="2064895">r</span>&nbsp;<span class="builtintype" id="2064897">rune</span><span class="op" id="2064901">)</span>&nbsp;<span class="builtintype" id="2064903">rune</span>&nbsp;<span class="op" id="2064908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064913">if</span>&nbsp;<span class="ident" id="2064916">isSeparator</span><span class="op" id="2064927">(</span><span class="ident" id="2064928">prev</span><span class="op" id="2064932">)</span>&nbsp;<span class="op" id="2064934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064940">prev</span>&nbsp;<span class="op" id="2064945">=</span>&nbsp;<span class="ident" id="2064947">r</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064953">return</span>&nbsp;<span class="ident" id="2064960">unicode</span><span class="op" id="2064967">.</span><span class="ident" id="2064968">ToTitle</span><span class="op" id="2064975">(</span><span class="ident" id="2064976">r</span><span class="op" id="2064977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064987">prev</span>&nbsp;<span class="op" id="2064992">=</span>&nbsp;<span class="ident" id="2064994">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064999">return</span>&nbsp;<span class="ident" id="2065006">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065010">}</span><span class="op" id="2065011">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065015">s</span><span class="op" id="2065016">)</span><br>
<span class="lineno"></span><span class="op" id="2065018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2065021">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="2065102">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">465</span><span class="keyword" id="2065146">func</span>&nbsp;<span class="ident" id="2065151">TrimLeftFunc</span><span class="op" id="2065163">(</span><span class="ident" id="2065164">s</span>&nbsp;<span class="op" id="2065166">[</span><span class="op" id="2065167">]</span><span class="builtintype" id="2065168">byte</span><span class="op" id="2065172">,</span>&nbsp;<span class="ident" id="2065174">f</span>&nbsp;<span class="keyword" id="2065176">func</span><span class="op" id="2065180">(</span><span class="ident" id="2065181">r</span>&nbsp;<span class="builtintype" id="2065183">rune</span><span class="op" id="2065187">)</span>&nbsp;<span class="builtintype" id="2065189">bool</span><span class="op" id="2065193">)</span>&nbsp;<span class="op" id="2065195">[</span><span class="op" id="2065196">]</span><span class="builtintype" id="2065197">byte</span>&nbsp;<span class="op" id="2065202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065205">i</span>&nbsp;<span class="op" id="2065207">:=</span>&nbsp;<span class="ident" id="2065210">indexFunc</span><span class="op" id="2065219">(</span><span class="ident" id="2065220">s</span><span class="op" id="2065221">,</span>&nbsp;<span class="ident" id="2065223">f</span><span class="op" id="2065224">,</span>&nbsp;<span class="builtintype" id="2065226">false</span><span class="op" id="2065231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065234">if</span>&nbsp;<span class="ident" id="2065237">i</span>&nbsp;<span class="op" id="2065239">==</span>&nbsp;<span class="op" id="2065242">-</span><span class="num" id="2065243">1</span>&nbsp;<span class="op" id="2065245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065249">return</span>&nbsp;<span class="ident" id="2065256">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065261">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065264">return</span>&nbsp;<span class="ident" id="2065271">s</span><span class="op" id="2065272">[</span><span class="ident" id="2065273">i</span><span class="op" id="2065274">:</span><span class="op" id="2065275">]</span><br>
<span class="lineno"></span><span class="op" id="2065277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2065280">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing&nbsp;UTF-8</span><br>
<span class="lineno"></span><span class="comment" id="2065355">//&nbsp;encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">475</span><span class="keyword" id="2065407">func</span>&nbsp;<span class="ident" id="2065412">TrimRightFunc</span><span class="op" id="2065425">(</span><span class="ident" id="2065426">s</span>&nbsp;<span class="op" id="2065428">[</span><span class="op" id="2065429">]</span><span class="builtintype" id="2065430">byte</span><span class="op" id="2065434">,</span>&nbsp;<span class="ident" id="2065436">f</span>&nbsp;<span class="keyword" id="2065438">func</span><span class="op" id="2065442">(</span><span class="ident" id="2065443">r</span>&nbsp;<span class="builtintype" id="2065445">rune</span><span class="op" id="2065449">)</span>&nbsp;<span class="builtintype" id="2065451">bool</span><span class="op" id="2065455">)</span>&nbsp;<span class="op" id="2065457">[</span><span class="op" id="2065458">]</span><span class="builtintype" id="2065459">byte</span>&nbsp;<span class="op" id="2065464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065467">i</span>&nbsp;<span class="op" id="2065469">:=</span>&nbsp;<span class="ident" id="2065472">lastIndexFunc</span><span class="op" id="2065485">(</span><span class="ident" id="2065486">s</span><span class="op" id="2065487">,</span>&nbsp;<span class="ident" id="2065489">f</span><span class="op" id="2065490">,</span>&nbsp;<span class="builtintype" id="2065492">false</span><span class="op" id="2065497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065500">if</span>&nbsp;<span class="ident" id="2065503">i</span>&nbsp;<span class="op" id="2065505">&gt;=</span>&nbsp;<span class="num" id="2065508">0</span>&nbsp;<span class="op" id="2065510">&amp;&amp;</span>&nbsp;<span class="ident" id="2065513">s</span><span class="op" id="2065514">[</span><span class="ident" id="2065515">i</span><span class="op" id="2065516">]</span>&nbsp;<span class="op" id="2065518">&gt;=</span>&nbsp;<span class="ident" id="2065521">utf8</span><span class="op" id="2065525">.</span><span class="ident" id="2065526">RuneSelf</span>&nbsp;<span class="op" id="2065535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065539">_</span><span class="op" id="2065540">,</span>&nbsp;<span class="ident" id="2065542">wid</span>&nbsp;<span class="op" id="2065546">:=</span>&nbsp;<span class="ident" id="2065549">utf8</span><span class="op" id="2065553">.</span><span class="ident" id="2065554">DecodeRune</span><span class="op" id="2065564">(</span><span class="ident" id="2065565">s</span><span class="op" id="2065566">[</span><span class="ident" id="2065567">i</span><span class="op" id="2065568">:</span><span class="op" id="2065569">]</span><span class="op" id="2065570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065574">i</span>&nbsp;<span class="op" id="2065576">+=</span>&nbsp;<span class="ident" id="2065579">wid</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065584">}</span>&nbsp;<span class="keyword" id="2065586">else</span>&nbsp;<span class="op" id="2065591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065595">i</span><span class="op" id="2065596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065603">return</span>&nbsp;<span class="ident" id="2065610">s</span><span class="op" id="2065611">[</span><span class="num" id="2065612">0</span><span class="op" id="2065613">:</span><span class="ident" id="2065614">i</span><span class="op" id="2065615">]</span><br>
<span class="lineno"></span><span class="op" id="2065617">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="2065620">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2065696">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="keyword" id="2065754">func</span>&nbsp;<span class="ident" id="2065759">TrimFunc</span><span class="op" id="2065767">(</span><span class="ident" id="2065768">s</span>&nbsp;<span class="op" id="2065770">[</span><span class="op" id="2065771">]</span><span class="builtintype" id="2065772">byte</span><span class="op" id="2065776">,</span>&nbsp;<span class="ident" id="2065778">f</span>&nbsp;<span class="keyword" id="2065780">func</span><span class="op" id="2065784">(</span><span class="ident" id="2065785">r</span>&nbsp;<span class="builtintype" id="2065787">rune</span><span class="op" id="2065791">)</span>&nbsp;<span class="builtintype" id="2065793">bool</span><span class="op" id="2065797">)</span>&nbsp;<span class="op" id="2065799">[</span><span class="op" id="2065800">]</span><span class="builtintype" id="2065801">byte</span>&nbsp;<span class="op" id="2065806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065809">return</span>&nbsp;<span class="ident" id="2065816">TrimRightFunc</span><span class="op" id="2065829">(</span><span class="ident" id="2065830">TrimLeftFunc</span><span class="op" id="2065842">(</span><span class="ident" id="2065843">s</span><span class="op" id="2065844">,</span>&nbsp;<span class="ident" id="2065846">f</span><span class="op" id="2065847">)</span><span class="op" id="2065848">,</span>&nbsp;<span class="ident" id="2065850">f</span><span class="op" id="2065851">)</span><br>
<span class="lineno">490</span><span class="op" id="2065853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2065856">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2065924">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2065984">func</span>&nbsp;<span class="ident" id="2065989">TrimPrefix</span><span class="op" id="2065999">(</span><span class="ident" id="2066000">s</span><span class="op" id="2066001">,</span>&nbsp;<span class="ident" id="2066003">prefix</span>&nbsp;<span class="op" id="2066010">[</span><span class="op" id="2066011">]</span><span class="builtintype" id="2066012">byte</span><span class="op" id="2066016">)</span>&nbsp;<span class="op" id="2066018">[</span><span class="op" id="2066019">]</span><span class="builtintype" id="2066020">byte</span>&nbsp;<span class="op" id="2066025">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066028">if</span>&nbsp;<span class="ident" id="2066031">HasPrefix</span><span class="op" id="2066040">(</span><span class="ident" id="2066041">s</span><span class="op" id="2066042">,</span>&nbsp;<span class="ident" id="2066044">prefix</span><span class="op" id="2066050">)</span>&nbsp;<span class="op" id="2066052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066056">return</span>&nbsp;<span class="ident" id="2066063">s</span><span class="op" id="2066064">[</span><span class="builtinfunc" id="2066065">len</span><span class="op" id="2066068">(</span><span class="ident" id="2066069">prefix</span><span class="op" id="2066075">)</span><span class="op" id="2066076">:</span><span class="op" id="2066077">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066083">return</span>&nbsp;<span class="ident" id="2066090">s</span><br>
<span class="lineno"></span><span class="op" id="2066092">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="2066095">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2066164">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2066222">func</span>&nbsp;<span class="ident" id="2066227">TrimSuffix</span><span class="op" id="2066237">(</span><span class="ident" id="2066238">s</span><span class="op" id="2066239">,</span>&nbsp;<span class="ident" id="2066241">suffix</span>&nbsp;<span class="op" id="2066248">[</span><span class="op" id="2066249">]</span><span class="builtintype" id="2066250">byte</span><span class="op" id="2066254">)</span>&nbsp;<span class="op" id="2066256">[</span><span class="op" id="2066257">]</span><span class="builtintype" id="2066258">byte</span>&nbsp;<span class="op" id="2066263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066266">if</span>&nbsp;<span class="ident" id="2066269">HasSuffix</span><span class="op" id="2066278">(</span><span class="ident" id="2066279">s</span><span class="op" id="2066280">,</span>&nbsp;<span class="ident" id="2066282">suffix</span><span class="op" id="2066288">)</span>&nbsp;<span class="op" id="2066290">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066294">return</span>&nbsp;<span class="ident" id="2066301">s</span><span class="op" id="2066302">[</span><span class="op" id="2066303">:</span><span class="builtinfunc" id="2066304">len</span><span class="op" id="2066307">(</span><span class="ident" id="2066308">s</span><span class="op" id="2066309">)</span><span class="op" id="2066310">-</span><span class="builtinfunc" id="2066311">len</span><span class="op" id="2066314">(</span><span class="ident" id="2066315">suffix</span><span class="op" id="2066321">)</span><span class="op" id="2066322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066328">return</span>&nbsp;<span class="ident" id="2066335">s</span><br>
<span class="lineno"></span><span class="op" id="2066337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="comment" id="2066340">//&nbsp;IndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2066418">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="2066473">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2066522">func</span>&nbsp;<span class="ident" id="2066527">IndexFunc</span><span class="op" id="2066536">(</span><span class="ident" id="2066537">s</span>&nbsp;<span class="op" id="2066539">[</span><span class="op" id="2066540">]</span><span class="builtintype" id="2066541">byte</span><span class="op" id="2066545">,</span>&nbsp;<span class="ident" id="2066547">f</span>&nbsp;<span class="keyword" id="2066549">func</span><span class="op" id="2066553">(</span><span class="ident" id="2066554">r</span>&nbsp;<span class="builtintype" id="2066556">rune</span><span class="op" id="2066560">)</span>&nbsp;<span class="builtintype" id="2066562">bool</span><span class="op" id="2066566">)</span>&nbsp;<span class="builtintype" id="2066568">int</span>&nbsp;<span class="op" id="2066572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066575">return</span>&nbsp;<span class="ident" id="2066582">indexFunc</span><span class="op" id="2066591">(</span><span class="ident" id="2066592">s</span><span class="op" id="2066593">,</span>&nbsp;<span class="ident" id="2066595">f</span><span class="op" id="2066596">,</span>&nbsp;<span class="builtintype" id="2066598">true</span><span class="op" id="2066602">)</span><br>
<span class="lineno">515</span><span class="op" id="2066604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2066607">//&nbsp;LastIndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2066689">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;last&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="2066743">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno">520</span><span class="keyword" id="2066792">func</span>&nbsp;<span class="ident" id="2066797">LastIndexFunc</span><span class="op" id="2066810">(</span><span class="ident" id="2066811">s</span>&nbsp;<span class="op" id="2066813">[</span><span class="op" id="2066814">]</span><span class="builtintype" id="2066815">byte</span><span class="op" id="2066819">,</span>&nbsp;<span class="ident" id="2066821">f</span>&nbsp;<span class="keyword" id="2066823">func</span><span class="op" id="2066827">(</span><span class="ident" id="2066828">r</span>&nbsp;<span class="builtintype" id="2066830">rune</span><span class="op" id="2066834">)</span>&nbsp;<span class="builtintype" id="2066836">bool</span><span class="op" id="2066840">)</span>&nbsp;<span class="builtintype" id="2066842">int</span>&nbsp;<span class="op" id="2066846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066849">return</span>&nbsp;<span class="ident" id="2066856">lastIndexFunc</span><span class="op" id="2066869">(</span><span class="ident" id="2066870">s</span><span class="op" id="2066871">,</span>&nbsp;<span class="ident" id="2066873">f</span><span class="op" id="2066874">,</span>&nbsp;<span class="builtintype" id="2066876">true</span><span class="op" id="2066880">)</span><br>
<span class="lineno"></span><span class="op" id="2066882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2066885">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno">525</span><span class="comment" id="2066938">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2066994">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2067007">func</span>&nbsp;<span class="ident" id="2067012">indexFunc</span><span class="op" id="2067021">(</span><span class="ident" id="2067022">s</span>&nbsp;<span class="op" id="2067024">[</span><span class="op" id="2067025">]</span><span class="builtintype" id="2067026">byte</span><span class="op" id="2067030">,</span>&nbsp;<span class="ident" id="2067032">f</span>&nbsp;<span class="keyword" id="2067034">func</span><span class="op" id="2067038">(</span><span class="ident" id="2067039">r</span>&nbsp;<span class="builtintype" id="2067041">rune</span><span class="op" id="2067045">)</span>&nbsp;<span class="builtintype" id="2067047">bool</span><span class="op" id="2067051">,</span>&nbsp;<span class="ident" id="2067053">truth</span>&nbsp;<span class="builtintype" id="2067059">bool</span><span class="op" id="2067063">)</span>&nbsp;<span class="builtintype" id="2067065">int</span>&nbsp;<span class="op" id="2067069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067072">start</span>&nbsp;<span class="op" id="2067078">:=</span>&nbsp;<span class="num" id="2067081">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067084">for</span>&nbsp;<span class="ident" id="2067088">start</span>&nbsp;<span class="op" id="2067094">&lt;</span>&nbsp;<span class="builtinfunc" id="2067096">len</span><span class="op" id="2067099">(</span><span class="ident" id="2067100">s</span><span class="op" id="2067101">)</span>&nbsp;<span class="op" id="2067103">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067107">wid</span>&nbsp;<span class="op" id="2067111">:=</span>&nbsp;<span class="num" id="2067114">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067118">r</span>&nbsp;<span class="op" id="2067120">:=</span>&nbsp;<span class="builtintype" id="2067123">rune</span><span class="op" id="2067127">(</span><span class="ident" id="2067128">s</span><span class="op" id="2067129">[</span><span class="ident" id="2067130">start</span><span class="op" id="2067135">]</span><span class="op" id="2067136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067140">if</span>&nbsp;<span class="ident" id="2067143">r</span>&nbsp;<span class="op" id="2067145">&gt;=</span>&nbsp;<span class="ident" id="2067148">utf8</span><span class="op" id="2067152">.</span><span class="ident" id="2067153">RuneSelf</span>&nbsp;<span class="op" id="2067162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067167">r</span><span class="op" id="2067168">,</span>&nbsp;<span class="ident" id="2067170">wid</span>&nbsp;<span class="op" id="2067174">=</span>&nbsp;<span class="ident" id="2067176">utf8</span><span class="op" id="2067180">.</span><span class="ident" id="2067181">DecodeRune</span><span class="op" id="2067191">(</span><span class="ident" id="2067192">s</span><span class="op" id="2067193">[</span><span class="ident" id="2067194">start</span><span class="op" id="2067199">:</span><span class="op" id="2067200">]</span><span class="op" id="2067201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067205">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067209">if</span>&nbsp;<span class="ident" id="2067212">f</span><span class="op" id="2067213">(</span><span class="ident" id="2067214">r</span><span class="op" id="2067215">)</span>&nbsp;<span class="op" id="2067217">==</span>&nbsp;<span class="ident" id="2067220">truth</span>&nbsp;<span class="op" id="2067226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067231">return</span>&nbsp;<span class="ident" id="2067238">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067250">start</span>&nbsp;<span class="op" id="2067256">+=</span>&nbsp;<span class="ident" id="2067259">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067264">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067267">return</span>&nbsp;<span class="op" id="2067274">-</span><span class="num" id="2067275">1</span><br>
<span class="lineno"></span><span class="op" id="2067277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2067280">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2067341">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno">545</span><span class="comment" id="2067397">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2067410">func</span>&nbsp;<span class="ident" id="2067415">lastIndexFunc</span><span class="op" id="2067428">(</span><span class="ident" id="2067429">s</span>&nbsp;<span class="op" id="2067431">[</span><span class="op" id="2067432">]</span><span class="builtintype" id="2067433">byte</span><span class="op" id="2067437">,</span>&nbsp;<span class="ident" id="2067439">f</span>&nbsp;<span class="keyword" id="2067441">func</span><span class="op" id="2067445">(</span><span class="ident" id="2067446">r</span>&nbsp;<span class="builtintype" id="2067448">rune</span><span class="op" id="2067452">)</span>&nbsp;<span class="builtintype" id="2067454">bool</span><span class="op" id="2067458">,</span>&nbsp;<span class="ident" id="2067460">truth</span>&nbsp;<span class="builtintype" id="2067466">bool</span><span class="op" id="2067470">)</span>&nbsp;<span class="builtintype" id="2067472">int</span>&nbsp;<span class="op" id="2067476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067479">for</span>&nbsp;<span class="ident" id="2067483">i</span>&nbsp;<span class="op" id="2067485">:=</span>&nbsp;<span class="builtinfunc" id="2067488">len</span><span class="op" id="2067491">(</span><span class="ident" id="2067492">s</span><span class="op" id="2067493">)</span><span class="op" id="2067494">;</span>&nbsp;<span class="ident" id="2067496">i</span>&nbsp;<span class="op" id="2067498">&gt;</span>&nbsp;<span class="num" id="2067500">0</span><span class="op" id="2067501">;</span>&nbsp;<span class="op" id="2067503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067507">r</span><span class="op" id="2067508">,</span>&nbsp;<span class="ident" id="2067510">size</span>&nbsp;<span class="op" id="2067515">:=</span>&nbsp;<span class="builtintype" id="2067518">rune</span><span class="op" id="2067522">(</span><span class="ident" id="2067523">s</span><span class="op" id="2067524">[</span><span class="ident" id="2067525">i</span><span class="op" id="2067526">-</span><span class="num" id="2067527">1</span><span class="op" id="2067528">]</span><span class="op" id="2067529">)</span><span class="op" id="2067530">,</span>&nbsp;<span class="num" id="2067532">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067536">if</span>&nbsp;<span class="ident" id="2067539">r</span>&nbsp;<span class="op" id="2067541">&gt;=</span>&nbsp;<span class="ident" id="2067544">utf8</span><span class="op" id="2067548">.</span><span class="ident" id="2067549">RuneSelf</span>&nbsp;<span class="op" id="2067558">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067563">r</span><span class="op" id="2067564">,</span>&nbsp;<span class="ident" id="2067566">size</span>&nbsp;<span class="op" id="2067571">=</span>&nbsp;<span class="ident" id="2067573">utf8</span><span class="op" id="2067577">.</span><span class="ident" id="2067578">DecodeLastRune</span><span class="op" id="2067592">(</span><span class="ident" id="2067593">s</span><span class="op" id="2067594">[</span><span class="num" id="2067595">0</span><span class="op" id="2067596">:</span><span class="ident" id="2067597">i</span><span class="op" id="2067598">]</span><span class="op" id="2067599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067607">i</span>&nbsp;<span class="op" id="2067609">-=</span>&nbsp;<span class="ident" id="2067612">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067619">if</span>&nbsp;<span class="ident" id="2067622">f</span><span class="op" id="2067623">(</span><span class="ident" id="2067624">r</span><span class="op" id="2067625">)</span>&nbsp;<span class="op" id="2067627">==</span>&nbsp;<span class="ident" id="2067630">truth</span>&nbsp;<span class="op" id="2067636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067641">return</span>&nbsp;<span class="ident" id="2067648">i</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067658">return</span>&nbsp;<span class="op" id="2067665">-</span><span class="num" id="2067666">1</span><br>
<span class="lineno"></span><span class="op" id="2067668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="2067671">func</span>&nbsp;<span class="ident" id="2067676">makeCutsetFunc</span><span class="op" id="2067690">(</span><span class="ident" id="2067691">cutset</span>&nbsp;<span class="builtintype" id="2067698">string</span><span class="op" id="2067704">)</span>&nbsp;<span class="keyword" id="2067706">func</span><span class="op" id="2067710">(</span><span class="ident" id="2067711">r</span>&nbsp;<span class="builtintype" id="2067713">rune</span><span class="op" id="2067717">)</span>&nbsp;<span class="builtintype" id="2067719">bool</span>&nbsp;<span class="op" id="2067724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067727">return</span>&nbsp;<span class="keyword" id="2067734">func</span><span class="op" id="2067738">(</span><span class="ident" id="2067739">r</span>&nbsp;<span class="builtintype" id="2067741">rune</span><span class="op" id="2067745">)</span>&nbsp;<span class="builtintype" id="2067747">bool</span>&nbsp;<span class="op" id="2067752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067756">for</span>&nbsp;<span class="ident" id="2067760">_</span><span class="op" id="2067761">,</span>&nbsp;<span class="ident" id="2067763">c</span>&nbsp;<span class="op" id="2067765">:=</span>&nbsp;<span class="keyword" id="2067768">range</span>&nbsp;<span class="ident" id="2067774">cutset</span>&nbsp;<span class="op" id="2067781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067786">if</span>&nbsp;<span class="ident" id="2067789">c</span>&nbsp;<span class="op" id="2067791">==</span>&nbsp;<span class="ident" id="2067794">r</span>&nbsp;<span class="op" id="2067796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067802">return</span>&nbsp;<span class="builtintype" id="2067809">true</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067825">return</span>&nbsp;<span class="builtintype" id="2067832">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067839">}</span><br>
<span class="lineno"></span><span class="op" id="2067841">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="comment" id="2067844">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2067907">//&nbsp;trailing&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="2067974">func</span>&nbsp;<span class="ident" id="2067979">Trim</span><span class="op" id="2067983">(</span><span class="ident" id="2067984">s</span>&nbsp;<span class="op" id="2067986">[</span><span class="op" id="2067987">]</span><span class="builtintype" id="2067988">byte</span><span class="op" id="2067992">,</span>&nbsp;<span class="ident" id="2067994">cutset</span>&nbsp;<span class="builtintype" id="2068001">string</span><span class="op" id="2068007">)</span>&nbsp;<span class="op" id="2068009">[</span><span class="op" id="2068010">]</span><span class="builtintype" id="2068011">byte</span>&nbsp;<span class="op" id="2068016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068019">return</span>&nbsp;<span class="ident" id="2068026">TrimFunc</span><span class="op" id="2068034">(</span><span class="ident" id="2068035">s</span><span class="op" id="2068036">,</span>&nbsp;<span class="ident" id="2068038">makeCutsetFunc</span><span class="op" id="2068052">(</span><span class="ident" id="2068053">cutset</span><span class="op" id="2068059">)</span><span class="op" id="2068060">)</span><br>
<span class="lineno">575</span><span class="op" id="2068062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2068065">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2068128">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="2068186">func</span>&nbsp;<span class="ident" id="2068191">TrimLeft</span><span class="op" id="2068199">(</span><span class="ident" id="2068200">s</span>&nbsp;<span class="op" id="2068202">[</span><span class="op" id="2068203">]</span><span class="builtintype" id="2068204">byte</span><span class="op" id="2068208">,</span>&nbsp;<span class="ident" id="2068210">cutset</span>&nbsp;<span class="builtintype" id="2068217">string</span><span class="op" id="2068223">)</span>&nbsp;<span class="op" id="2068225">[</span><span class="op" id="2068226">]</span><span class="builtintype" id="2068227">byte</span>&nbsp;<span class="op" id="2068232">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068235">return</span>&nbsp;<span class="ident" id="2068242">TrimLeftFunc</span><span class="op" id="2068254">(</span><span class="ident" id="2068255">s</span><span class="op" id="2068256">,</span>&nbsp;<span class="ident" id="2068258">makeCutsetFunc</span><span class="op" id="2068272">(</span><span class="ident" id="2068273">cutset</span><span class="op" id="2068279">)</span><span class="op" id="2068280">)</span><br>
<span class="lineno"></span><span class="op" id="2068282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2068285">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2068350">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;that&nbsp;are&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno">585</span><span class="keyword" id="2068417">func</span>&nbsp;<span class="ident" id="2068422">TrimRight</span><span class="op" id="2068431">(</span><span class="ident" id="2068432">s</span>&nbsp;<span class="op" id="2068434">[</span><span class="op" id="2068435">]</span><span class="builtintype" id="2068436">byte</span><span class="op" id="2068440">,</span>&nbsp;<span class="ident" id="2068442">cutset</span>&nbsp;<span class="builtintype" id="2068449">string</span><span class="op" id="2068455">)</span>&nbsp;<span class="op" id="2068457">[</span><span class="op" id="2068458">]</span><span class="builtintype" id="2068459">byte</span>&nbsp;<span class="op" id="2068464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068467">return</span>&nbsp;<span class="ident" id="2068474">TrimRightFunc</span><span class="op" id="2068487">(</span><span class="ident" id="2068488">s</span><span class="op" id="2068489">,</span>&nbsp;<span class="ident" id="2068491">makeCutsetFunc</span><span class="op" id="2068505">(</span><span class="ident" id="2068506">cutset</span><span class="op" id="2068512">)</span><span class="op" id="2068513">)</span><br>
<span class="lineno"></span><span class="op" id="2068515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2068518">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno">590</span><span class="comment" id="2068586">//&nbsp;trailing&nbsp;white&nbsp;space,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2068634">func</span>&nbsp;<span class="ident" id="2068639">TrimSpace</span><span class="op" id="2068648">(</span><span class="ident" id="2068649">s</span>&nbsp;<span class="op" id="2068651">[</span><span class="op" id="2068652">]</span><span class="builtintype" id="2068653">byte</span><span class="op" id="2068657">)</span>&nbsp;<span class="op" id="2068659">[</span><span class="op" id="2068660">]</span><span class="builtintype" id="2068661">byte</span>&nbsp;<span class="op" id="2068666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068669">return</span>&nbsp;<span class="ident" id="2068676">TrimFunc</span><span class="op" id="2068684">(</span><span class="ident" id="2068685">s</span><span class="op" id="2068686">,</span>&nbsp;<span class="ident" id="2068688">unicode</span><span class="op" id="2068695">.</span><span class="ident" id="2068696">IsSpace</span><span class="op" id="2068703">)</span><br>
<span class="lineno"></span><span class="op" id="2068705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="2068708">//&nbsp;Runes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;runes&nbsp;(Unicode&nbsp;code&nbsp;points)&nbsp;equivalent&nbsp;to&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2068781">func</span>&nbsp;<span class="ident" id="2068786">Runes</span><span class="op" id="2068791">(</span><span class="ident" id="2068792">s</span>&nbsp;<span class="op" id="2068794">[</span><span class="op" id="2068795">]</span><span class="builtintype" id="2068796">byte</span><span class="op" id="2068800">)</span>&nbsp;<span class="op" id="2068802">[</span><span class="op" id="2068803">]</span><span class="builtintype" id="2068804">rune</span>&nbsp;<span class="op" id="2068809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068812">t</span>&nbsp;<span class="op" id="2068814">:=</span>&nbsp;<span class="builtinfunc" id="2068817">make</span><span class="op" id="2068821">(</span><span class="op" id="2068822">[</span><span class="op" id="2068823">]</span><span class="builtintype" id="2068824">rune</span><span class="op" id="2068828">,</span>&nbsp;<span class="ident" id="2068830">utf8</span><span class="op" id="2068834">.</span><span class="ident" id="2068835">RuneCount</span><span class="op" id="2068844">(</span><span class="ident" id="2068845">s</span><span class="op" id="2068846">)</span><span class="op" id="2068847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068850">i</span>&nbsp;<span class="op" id="2068852">:=</span>&nbsp;<span class="num" id="2068855">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068858">for</span>&nbsp;<span class="builtinfunc" id="2068862">len</span><span class="op" id="2068865">(</span><span class="ident" id="2068866">s</span><span class="op" id="2068867">)</span>&nbsp;<span class="op" id="2068869">&gt;</span>&nbsp;<span class="num" id="2068871">0</span>&nbsp;<span class="op" id="2068873">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068877">r</span><span class="op" id="2068878">,</span>&nbsp;<span class="ident" id="2068880">l</span>&nbsp;<span class="op" id="2068882">:=</span>&nbsp;<span class="ident" id="2068885">utf8</span><span class="op" id="2068889">.</span><span class="ident" id="2068890">DecodeRune</span><span class="op" id="2068900">(</span><span class="ident" id="2068901">s</span><span class="op" id="2068902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068906">t</span><span class="op" id="2068907">[</span><span class="ident" id="2068908">i</span><span class="op" id="2068909">]</span>&nbsp;<span class="op" id="2068911">=</span>&nbsp;<span class="ident" id="2068913">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068917">i</span><span class="op" id="2068918">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068923">s</span>&nbsp;<span class="op" id="2068925">=</span>&nbsp;<span class="ident" id="2068927">s</span><span class="op" id="2068928">[</span><span class="ident" id="2068929">l</span><span class="op" id="2068930">:</span><span class="op" id="2068931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068934">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068937">return</span>&nbsp;<span class="ident" id="2068944">t</span><br>
<span class="lineno"></span><span class="op" id="2068946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2068949">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;slice&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2069007">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno">610</span><span class="comment" id="2069060">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2069121">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2069187">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="2069210">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span><span class="keyword" id="2069272">func</span>&nbsp;<span class="ident" id="2069277">Replace</span><span class="op" id="2069284">(</span><span class="ident" id="2069285">s</span><span class="op" id="2069286">,</span>&nbsp;<span class="ident" id="2069288">old</span><span class="op" id="2069291">,</span>&nbsp;<span class="builtinfunc" id="2069293">new</span>&nbsp;<span class="op" id="2069297">[</span><span class="op" id="2069298">]</span><span class="builtintype" id="2069299">byte</span><span class="op" id="2069303">,</span>&nbsp;<span class="ident" id="2069305">n</span>&nbsp;<span class="builtintype" id="2069307">int</span><span class="op" id="2069310">)</span>&nbsp;<span class="op" id="2069312">[</span><span class="op" id="2069313">]</span><span class="builtintype" id="2069314">byte</span>&nbsp;<span class="op" id="2069319">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069322">m</span>&nbsp;<span class="op" id="2069324">:=</span>&nbsp;<span class="num" id="2069327">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069330">if</span>&nbsp;<span class="ident" id="2069333">n</span>&nbsp;<span class="op" id="2069335">!=</span>&nbsp;<span class="num" id="2069338">0</span>&nbsp;<span class="op" id="2069340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2069344">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069381">m</span>&nbsp;<span class="op" id="2069383">=</span>&nbsp;<span class="ident" id="2069385">Count</span><span class="op" id="2069390">(</span><span class="ident" id="2069391">s</span><span class="op" id="2069392">,</span>&nbsp;<span class="ident" id="2069394">old</span><span class="op" id="2069397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069400">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069403">if</span>&nbsp;<span class="ident" id="2069406">m</span>&nbsp;<span class="op" id="2069408">==</span>&nbsp;<span class="num" id="2069411">0</span>&nbsp;<span class="op" id="2069413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2069417">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069442">return</span>&nbsp;<span class="builtinfunc" id="2069449">append</span><span class="op" id="2069455">(</span><span class="op" id="2069456">[</span><span class="op" id="2069457">]</span><span class="builtintype" id="2069458">byte</span><span class="op" id="2069462">(</span><span class="ident" id="2069463">nil</span><span class="op" id="2069466">)</span><span class="op" id="2069467">,</span>&nbsp;<span class="ident" id="2069469">s</span><span class="op" id="2069470">...</span><span class="op" id="2069473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069479">if</span>&nbsp;<span class="ident" id="2069482">n</span>&nbsp;<span class="op" id="2069484">&lt;</span>&nbsp;<span class="num" id="2069486">0</span>&nbsp;<span class="op" id="2069488">||</span>&nbsp;<span class="ident" id="2069491">m</span>&nbsp;<span class="op" id="2069493">&lt;</span>&nbsp;<span class="ident" id="2069495">n</span>&nbsp;<span class="op" id="2069497">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069501">n</span>&nbsp;<span class="op" id="2069503">=</span>&nbsp;<span class="ident" id="2069505">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2069512">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069546">t</span>&nbsp;<span class="op" id="2069548">:=</span>&nbsp;<span class="builtinfunc" id="2069551">make</span><span class="op" id="2069555">(</span><span class="op" id="2069556">[</span><span class="op" id="2069557">]</span><span class="builtintype" id="2069558">byte</span><span class="op" id="2069562">,</span>&nbsp;<span class="builtinfunc" id="2069564">len</span><span class="op" id="2069567">(</span><span class="ident" id="2069568">s</span><span class="op" id="2069569">)</span><span class="op" id="2069570">+</span><span class="ident" id="2069571">n</span><span class="op" id="2069572">*</span><span class="op" id="2069573">(</span><span class="builtinfunc" id="2069574">len</span><span class="op" id="2069577">(</span><span class="builtinfunc" id="2069578">new</span><span class="op" id="2069581">)</span><span class="op" id="2069582">-</span><span class="builtinfunc" id="2069583">len</span><span class="op" id="2069586">(</span><span class="ident" id="2069587">old</span><span class="op" id="2069590">)</span><span class="op" id="2069591">)</span><span class="op" id="2069592">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069595">w</span>&nbsp;<span class="op" id="2069597">:=</span>&nbsp;<span class="num" id="2069600">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069603">start</span>&nbsp;<span class="op" id="2069609">:=</span>&nbsp;<span class="num" id="2069612">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069615">for</span>&nbsp;<span class="ident" id="2069619">i</span>&nbsp;<span class="op" id="2069621">:=</span>&nbsp;<span class="num" id="2069624">0</span><span class="op" id="2069625">;</span>&nbsp;<span class="ident" id="2069627">i</span>&nbsp;<span class="op" id="2069629">&lt;</span>&nbsp;<span class="ident" id="2069631">n</span><span class="op" id="2069632">;</span>&nbsp;<span class="ident" id="2069634">i</span><span class="op" id="2069635">++</span>&nbsp;<span class="op" id="2069638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069642">j</span>&nbsp;<span class="op" id="2069644">:=</span>&nbsp;<span class="ident" id="2069647">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069655">if</span>&nbsp;<span class="builtinfunc" id="2069658">len</span><span class="op" id="2069661">(</span><span class="ident" id="2069662">old</span><span class="op" id="2069665">)</span>&nbsp;<span class="op" id="2069667">==</span>&nbsp;<span class="num" id="2069670">0</span>&nbsp;<span class="op" id="2069672">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069677">if</span>&nbsp;<span class="ident" id="2069680">i</span>&nbsp;<span class="op" id="2069682">&gt;</span>&nbsp;<span class="num" id="2069684">0</span>&nbsp;<span class="op" id="2069686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069692">_</span><span class="op" id="2069693">,</span>&nbsp;<span class="ident" id="2069695">wid</span>&nbsp;<span class="op" id="2069699">:=</span>&nbsp;<span class="ident" id="2069702">utf8</span><span class="op" id="2069706">.</span><span class="ident" id="2069707">DecodeRune</span><span class="op" id="2069717">(</span><span class="ident" id="2069718">s</span><span class="op" id="2069719">[</span><span class="ident" id="2069720">start</span><span class="op" id="2069725">:</span><span class="op" id="2069726">]</span><span class="op" id="2069727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069733">j</span>&nbsp;<span class="op" id="2069735">+=</span>&nbsp;<span class="ident" id="2069738">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069749">}</span>&nbsp;<span class="keyword" id="2069751">else</span>&nbsp;<span class="op" id="2069756">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069761">j</span>&nbsp;<span class="op" id="2069763">+=</span>&nbsp;<span class="ident" id="2069766">Index</span><span class="op" id="2069771">(</span><span class="ident" id="2069772">s</span><span class="op" id="2069773">[</span><span class="ident" id="2069774">start</span><span class="op" id="2069779">:</span><span class="op" id="2069780">]</span><span class="op" id="2069781">,</span>&nbsp;<span class="ident" id="2069783">old</span><span class="op" id="2069786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069794">w</span>&nbsp;<span class="op" id="2069796">+=</span>&nbsp;<span class="builtinfunc" id="2069799">copy</span><span class="op" id="2069803">(</span><span class="ident" id="2069804">t</span><span class="op" id="2069805">[</span><span class="ident" id="2069806">w</span><span class="op" id="2069807">:</span><span class="op" id="2069808">]</span><span class="op" id="2069809">,</span>&nbsp;<span class="ident" id="2069811">s</span><span class="op" id="2069812">[</span><span class="ident" id="2069813">start</span><span class="op" id="2069818">:</span><span class="ident" id="2069819">j</span><span class="op" id="2069820">]</span><span class="op" id="2069821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069825">w</span>&nbsp;<span class="op" id="2069827">+=</span>&nbsp;<span class="builtinfunc" id="2069830">copy</span><span class="op" id="2069834">(</span><span class="ident" id="2069835">t</span><span class="op" id="2069836">[</span><span class="ident" id="2069837">w</span><span class="op" id="2069838">:</span><span class="op" id="2069839">]</span><span class="op" id="2069840">,</span>&nbsp;<span class="builtinfunc" id="2069842">new</span><span class="op" id="2069845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069849">start</span>&nbsp;<span class="op" id="2069855">=</span>&nbsp;<span class="ident" id="2069857">j</span>&nbsp;<span class="op" id="2069859">+</span>&nbsp;<span class="builtinfunc" id="2069861">len</span><span class="op" id="2069864">(</span><span class="ident" id="2069865">old</span><span class="op" id="2069868">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069874">w</span>&nbsp;<span class="op" id="2069876">+=</span>&nbsp;<span class="builtinfunc" id="2069879">copy</span><span class="op" id="2069883">(</span><span class="ident" id="2069884">t</span><span class="op" id="2069885">[</span><span class="ident" id="2069886">w</span><span class="op" id="2069887">:</span><span class="op" id="2069888">]</span><span class="op" id="2069889">,</span>&nbsp;<span class="ident" id="2069891">s</span><span class="op" id="2069892">[</span><span class="ident" id="2069893">start</span><span class="op" id="2069898">:</span><span class="op" id="2069899">]</span><span class="op" id="2069900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069903">return</span>&nbsp;<span class="ident" id="2069910">t</span><span class="op" id="2069911">[</span><span class="num" id="2069912">0</span><span class="op" id="2069913">:</span><span class="ident" id="2069914">w</span><span class="op" id="2069915">]</span><br>
<span class="lineno"></span><span class="op" id="2069917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="2069920">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno"></span><span class="comment" id="2069988">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2070029">func</span>&nbsp;<span class="ident" id="2070034">EqualFold</span><span class="op" id="2070043">(</span><span class="ident" id="2070044">s</span><span class="op" id="2070045">,</span>&nbsp;<span class="ident" id="2070047">t</span>&nbsp;<span class="op" id="2070049">[</span><span class="op" id="2070050">]</span><span class="builtintype" id="2070051">byte</span><span class="op" id="2070055">)</span>&nbsp;<span class="builtintype" id="2070057">bool</span>&nbsp;<span class="op" id="2070062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070065">for</span>&nbsp;<span class="builtinfunc" id="2070069">len</span><span class="op" id="2070072">(</span><span class="ident" id="2070073">s</span><span class="op" id="2070074">)</span>&nbsp;<span class="op" id="2070076">!=</span>&nbsp;<span class="num" id="2070079">0</span>&nbsp;<span class="op" id="2070081">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2070084">len</span><span class="op" id="2070087">(</span><span class="ident" id="2070088">t</span><span class="op" id="2070089">)</span>&nbsp;<span class="op" id="2070091">!=</span>&nbsp;<span class="num" id="2070094">0</span>&nbsp;<span class="op" id="2070096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070100">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070135">var</span>&nbsp;<span class="ident" id="2070139">sr</span><span class="op" id="2070141">,</span>&nbsp;<span class="ident" id="2070143">tr</span>&nbsp;<span class="builtintype" id="2070146">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070153">if</span>&nbsp;<span class="ident" id="2070156">s</span><span class="op" id="2070157">[</span><span class="num" id="2070158">0</span><span class="op" id="2070159">]</span>&nbsp;<span class="op" id="2070161">&lt;</span>&nbsp;<span class="ident" id="2070163">utf8</span><span class="op" id="2070167">.</span><span class="ident" id="2070168">RuneSelf</span>&nbsp;<span class="op" id="2070177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070182">sr</span><span class="op" id="2070184">,</span>&nbsp;<span class="ident" id="2070186">s</span>&nbsp;<span class="op" id="2070188">=</span>&nbsp;<span class="builtintype" id="2070190">rune</span><span class="op" id="2070194">(</span><span class="ident" id="2070195">s</span><span class="op" id="2070196">[</span><span class="num" id="2070197">0</span><span class="op" id="2070198">]</span><span class="op" id="2070199">)</span><span class="op" id="2070200">,</span>&nbsp;<span class="ident" id="2070202">s</span><span class="op" id="2070203">[</span><span class="num" id="2070204">1</span><span class="op" id="2070205">:</span><span class="op" id="2070206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070210">}</span>&nbsp;<span class="keyword" id="2070212">else</span>&nbsp;<span class="op" id="2070217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070222">r</span><span class="op" id="2070223">,</span>&nbsp;<span class="ident" id="2070225">size</span>&nbsp;<span class="op" id="2070230">:=</span>&nbsp;<span class="ident" id="2070233">utf8</span><span class="op" id="2070237">.</span><span class="ident" id="2070238">DecodeRune</span><span class="op" id="2070248">(</span><span class="ident" id="2070249">s</span><span class="op" id="2070250">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070255">sr</span><span class="op" id="2070257">,</span>&nbsp;<span class="ident" id="2070259">s</span>&nbsp;<span class="op" id="2070261">=</span>&nbsp;<span class="ident" id="2070263">r</span><span class="op" id="2070264">,</span>&nbsp;<span class="ident" id="2070266">s</span><span class="op" id="2070267">[</span><span class="ident" id="2070268">size</span><span class="op" id="2070272">:</span><span class="op" id="2070273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070281">if</span>&nbsp;<span class="ident" id="2070284">t</span><span class="op" id="2070285">[</span><span class="num" id="2070286">0</span><span class="op" id="2070287">]</span>&nbsp;<span class="op" id="2070289">&lt;</span>&nbsp;<span class="ident" id="2070291">utf8</span><span class="op" id="2070295">.</span><span class="ident" id="2070296">RuneSelf</span>&nbsp;<span class="op" id="2070305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070310">tr</span><span class="op" id="2070312">,</span>&nbsp;<span class="ident" id="2070314">t</span>&nbsp;<span class="op" id="2070316">=</span>&nbsp;<span class="builtintype" id="2070318">rune</span><span class="op" id="2070322">(</span><span class="ident" id="2070323">t</span><span class="op" id="2070324">[</span><span class="num" id="2070325">0</span><span class="op" id="2070326">]</span><span class="op" id="2070327">)</span><span class="op" id="2070328">,</span>&nbsp;<span class="ident" id="2070330">t</span><span class="op" id="2070331">[</span><span class="num" id="2070332">1</span><span class="op" id="2070333">:</span><span class="op" id="2070334">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070338">}</span>&nbsp;<span class="keyword" id="2070340">else</span>&nbsp;<span class="op" id="2070345">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070350">r</span><span class="op" id="2070351">,</span>&nbsp;<span class="ident" id="2070353">size</span>&nbsp;<span class="op" id="2070358">:=</span>&nbsp;<span class="ident" id="2070361">utf8</span><span class="op" id="2070365">.</span><span class="ident" id="2070366">DecodeRune</span><span class="op" id="2070376">(</span><span class="ident" id="2070377">t</span><span class="op" id="2070378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070383">tr</span><span class="op" id="2070385">,</span>&nbsp;<span class="ident" id="2070387">t</span>&nbsp;<span class="op" id="2070389">=</span>&nbsp;<span class="ident" id="2070391">r</span><span class="op" id="2070392">,</span>&nbsp;<span class="ident" id="2070394">t</span><span class="op" id="2070395">[</span><span class="ident" id="2070396">size</span><span class="op" id="2070400">:</span><span class="op" id="2070401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070410">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070465">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070481">if</span>&nbsp;<span class="ident" id="2070484">tr</span>&nbsp;<span class="op" id="2070487">==</span>&nbsp;<span class="ident" id="2070490">sr</span>&nbsp;<span class="op" id="2070493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070509">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070514">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070558">if</span>&nbsp;<span class="ident" id="2070561">tr</span>&nbsp;<span class="op" id="2070564">&lt;</span>&nbsp;<span class="ident" id="2070566">sr</span>&nbsp;<span class="op" id="2070569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070574">tr</span><span class="op" id="2070576">,</span>&nbsp;<span class="ident" id="2070578">sr</span>&nbsp;<span class="op" id="2070581">=</span>&nbsp;<span class="ident" id="2070583">sr</span><span class="op" id="2070585">,</span>&nbsp;<span class="ident" id="2070587">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070592">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070596">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070623">if</span>&nbsp;<span class="ident" id="2070626">tr</span>&nbsp;<span class="op" id="2070629">&lt;</span>&nbsp;<span class="ident" id="2070631">utf8</span><span class="op" id="2070635">.</span><span class="ident" id="2070636">RuneSelf</span>&nbsp;<span class="op" id="2070645">&amp;&amp;</span>&nbsp;<span class="string" id="2070648">&#39;A&#39;</span>&nbsp;<span class="op" id="2070652">&lt;=</span>&nbsp;<span class="ident" id="2070655">sr</span>&nbsp;<span class="op" id="2070658">&amp;&amp;</span>&nbsp;<span class="ident" id="2070661">sr</span>&nbsp;<span class="op" id="2070664">&lt;=</span>&nbsp;<span class="string" id="2070667">&#39;Z&#39;</span>&nbsp;<span class="op" id="2070671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070676">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070735">if</span>&nbsp;<span class="ident" id="2070738">tr</span>&nbsp;<span class="op" id="2070741">==</span>&nbsp;<span class="ident" id="2070744">sr</span><span class="op" id="2070746">+</span><span class="string" id="2070747">&#39;a&#39;</span><span class="op" id="2070750">-</span><span class="string" id="2070751">&#39;A&#39;</span>&nbsp;<span class="op" id="2070755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070761">continue</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070778">return</span>&nbsp;<span class="builtintype" id="2070785">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070798">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2070869">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070909">r</span>&nbsp;<span class="op" id="2070911">:=</span>&nbsp;<span class="ident" id="2070914">unicode</span><span class="op" id="2070921">.</span><span class="ident" id="2070922">SimpleFold</span><span class="op" id="2070932">(</span><span class="ident" id="2070933">sr</span><span class="op" id="2070935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070939">for</span>&nbsp;<span class="ident" id="2070943">r</span>&nbsp;<span class="op" id="2070945">!=</span>&nbsp;<span class="ident" id="2070948">sr</span>&nbsp;<span class="op" id="2070951">&amp;&amp;</span>&nbsp;<span class="ident" id="2070954">r</span>&nbsp;<span class="op" id="2070956">&lt;</span>&nbsp;<span class="ident" id="2070958">tr</span>&nbsp;<span class="op" id="2070961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070966">r</span>&nbsp;<span class="op" id="2070968">=</span>&nbsp;<span class="ident" id="2070970">unicode</span><span class="op" id="2070977">.</span><span class="ident" id="2070978">SimpleFold</span><span class="op" id="2070988">(</span><span class="ident" id="2070989">r</span><span class="op" id="2070990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070994">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070998">if</span>&nbsp;<span class="ident" id="2071001">r</span>&nbsp;<span class="op" id="2071003">==</span>&nbsp;<span class="ident" id="2071006">tr</span>&nbsp;<span class="op" id="2071009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071014">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071029">return</span>&nbsp;<span class="builtintype" id="2071036">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071043">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2071047">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071083">return</span>&nbsp;<span class="builtinfunc" id="2071090">len</span><span class="op" id="2071093">(</span><span class="ident" id="2071094">s</span><span class="op" id="2071095">)</span>&nbsp;<span class="op" id="2071097">==</span>&nbsp;<span class="builtinfunc" id="2071100">len</span><span class="op" id="2071103">(</span><span class="ident" id="2071104">t</span><span class="op" id="2071105">)</span><br>
<span class="lineno"></span><span class="op" id="2071107">}</span>
</div>
</body>
</html>
