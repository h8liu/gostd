<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1915355">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1915410">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1915464">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1915515">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1915593">package</span>&nbsp;<span class="ident" id="1915601">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1915610">import</span>&nbsp;<span class="string" id="1915617">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1915627">func</span>&nbsp;<span class="ident" id="1915632">environ</span><span class="op" id="1915639">(</span><span class="op" id="1915640">)</span>&nbsp;<span class="op" id="1915642">[</span><span class="op" id="1915643">]</span><span class="builtintype" id="1915644">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1915652">func</span>&nbsp;<span class="ident" id="1915657">getenv</span><span class="op" id="1915663">(</span><span class="ident" id="1915664">s</span>&nbsp;<span class="op" id="1915666">*</span><span class="builtintype" id="1915667">byte</span><span class="op" id="1915671">)</span>&nbsp;<span class="op" id="1915673">*</span><span class="builtintype" id="1915674">byte</span>&nbsp;<span class="op" id="1915679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915682">val</span>&nbsp;<span class="op" id="1915686">:=</span>&nbsp;<span class="ident" id="1915689"><a href="/runtime/env_posix.go.html#1915833">gogetenv</a></span><span class="op" id="1915697">(</span><span class="ident" id="1915698"><a href="/runtime/stubs.go.html#2137710">gostringnocopy</a></span><span class="op" id="1915712">(</span><span class="ident" id="1915713"><a href="/runtime/env_posix.go.html#1915664">s</a></span><span class="op" id="1915714">)</span><span class="op" id="1915715">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915718">if</span>&nbsp;<span class="ident" id="1915721"><a href="/runtime/env_posix.go.html#1915682">val</a></span>&nbsp;<span class="op" id="1915725">==</span>&nbsp;<span class="string" id="1915728">&#34;&#34;</span>&nbsp;<span class="op" id="1915731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915735">return</span>&nbsp;<span class="ident" id="1915742">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1915750">//&nbsp;Strings&nbsp;found&nbsp;in&nbsp;environment&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915803">return</span>&nbsp;<span class="op" id="1915810">&amp;</span><span class="ident" id="1915811"><a href="/runtime/print1.go.html#2057936">bytes</a></span><span class="op" id="1915816">(</span><span class="ident" id="1915817"><a href="/runtime/env_posix.go.html#1915682">val</a></span><span class="op" id="1915820">)</span><span class="op" id="1915821">[</span><span class="num" id="1915822">0</span><span class="op" id="1915823">]</span><br>
<span class="lineno">20</span><span class="op" id="1915825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1915828">func</span>&nbsp;<span class="ident" id="1915833">gogetenv</span><span class="op" id="1915841">(</span><span class="ident" id="1915842">key</span>&nbsp;<span class="builtintype" id="1915846">string</span><span class="op" id="1915852">)</span>&nbsp;<span class="builtintype" id="1915854">string</span>&nbsp;<span class="op" id="1915861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915864">env</span>&nbsp;<span class="op" id="1915868">:=</span>&nbsp;<span class="ident" id="1915871"><a href="/runtime/env_posix.go.html#1915632">environ</a></span><span class="op" id="1915878">(</span><span class="op" id="1915879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915882">if</span>&nbsp;<span class="ident" id="1915885"><a href="/runtime/env_posix.go.html#1915864">env</a></span>&nbsp;<span class="op" id="1915889">==</span>&nbsp;<span class="ident" id="1915892">nil</span>&nbsp;<span class="op" id="1915896">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915900"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1915907">(</span><span class="string" id="1915908">&#34;getenv&nbsp;before&nbsp;env&nbsp;init&#34;</span><span class="op" id="1915932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915938">for</span>&nbsp;<span class="ident" id="1915942">_</span><span class="op" id="1915943">,</span>&nbsp;<span class="ident" id="1915945">s</span>&nbsp;<span class="op" id="1915947">:=</span>&nbsp;<span class="keyword" id="1915950">range</span>&nbsp;<span class="ident" id="1915956"><a href="/runtime/env_posix.go.html#1915632">environ</a></span><span class="op" id="1915963">(</span><span class="op" id="1915964">)</span>&nbsp;<span class="op" id="1915966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915970">if</span>&nbsp;<span class="builtinfunc" id="1915973">len</span><span class="op" id="1915976">(</span><span class="ident" id="1915977"><a href="/runtime/env_posix.go.html#1915945">s</a></span><span class="op" id="1915978">)</span>&nbsp;<span class="op" id="1915980">&gt;</span>&nbsp;<span class="builtinfunc" id="1915982">len</span><span class="op" id="1915985">(</span><span class="ident" id="1915986"><a href="/runtime/env_posix.go.html#1915842">key</a></span><span class="op" id="1915989">)</span>&nbsp;<span class="op" id="1915991">&amp;&amp;</span>&nbsp;<span class="ident" id="1915994"><a href="/runtime/env_posix.go.html#1915945">s</a></span><span class="op" id="1915995">[</span><span class="builtinfunc" id="1915996">len</span><span class="op" id="1915999">(</span><span class="ident" id="1916000"><a href="/runtime/env_posix.go.html#1915842">key</a></span><span class="op" id="1916003">)</span><span class="op" id="1916004">]</span>&nbsp;<span class="op" id="1916006">==</span>&nbsp;<span class="string" id="1916009">&#39;=&#39;</span>&nbsp;<span class="op" id="1916013">&amp;&amp;</span>&nbsp;<span class="ident" id="1916016"><a href="/runtime/env_posix.go.html#1915945">s</a></span><span class="op" id="1916017">[</span><span class="op" id="1916018">:</span><span class="builtinfunc" id="1916019">len</span><span class="op" id="1916022">(</span><span class="ident" id="1916023"><a href="/runtime/env_posix.go.html#1915842">key</a></span><span class="op" id="1916026">)</span><span class="op" id="1916027">]</span>&nbsp;<span class="op" id="1916029">==</span>&nbsp;<span class="ident" id="1916032"><a href="/runtime/env_posix.go.html#1915842">key</a></span>&nbsp;<span class="op" id="1916036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916041">return</span>&nbsp;<span class="ident" id="1916048"><a href="/runtime/env_posix.go.html#1915945">s</a></span><span class="op" id="1916049">[</span><span class="builtinfunc" id="1916050">len</span><span class="op" id="1916053">(</span><span class="ident" id="1916054"><a href="/runtime/env_posix.go.html#1915842">key</a></span><span class="op" id="1916057">)</span><span class="op" id="1916058">+</span><span class="num" id="1916059">1</span><span class="op" id="1916060">:</span><span class="op" id="1916061">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1916065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1916068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916071">return</span>&nbsp;<span class="string" id="1916078">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="1916081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1916084">var</span>&nbsp;<span class="ident" id="1916088">_cgo_setenv</span>&nbsp;<span class="builtintype" id="1916100">uintptr</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1916110">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="1916135">var</span>&nbsp;<span class="ident" id="1916139">_cgo_unsetenv</span>&nbsp;<span class="builtintype" id="1916153">uintptr</span>&nbsp;<span class="comment" id="1916161">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1916187">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1916233">//&nbsp;Called&nbsp;from&nbsp;syscall.Setenv.</span><br>
<span class="lineno">40</span><span class="keyword" id="1916264">func</span>&nbsp;<span class="ident" id="1916269">syscall_setenv_c</span><span class="op" id="1916285">(</span><span class="ident" id="1916286">k</span>&nbsp;<span class="builtintype" id="1916288">string</span><span class="op" id="1916294">,</span>&nbsp;<span class="ident" id="1916296">v</span>&nbsp;<span class="builtintype" id="1916298">string</span><span class="op" id="1916304">)</span>&nbsp;<span class="op" id="1916306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916309">if</span>&nbsp;<span class="ident" id="1916312"><a href="/runtime/env_posix.go.html#1916088">_cgo_setenv</a></span>&nbsp;<span class="op" id="1916324">==</span>&nbsp;<span class="num" id="1916327">0</span>&nbsp;<span class="op" id="1916329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916333">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1916341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916344">arg</span>&nbsp;<span class="op" id="1916348">:=</span>&nbsp;<span class="op" id="1916351">[</span><span class="num" id="1916352">2</span><span class="op" id="1916353">]</span><span class="ident" id="1916354"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916360">.</span><span class="ident" id="1916361">Pointer</span><span class="op" id="1916368">{</span><span class="ident" id="1916369"><a href="/runtime/env_posix.go.html#1916722">cstring</a></span><span class="op" id="1916376">(</span><span class="ident" id="1916377"><a href="/runtime/env_posix.go.html#1916286">k</a></span><span class="op" id="1916378">)</span><span class="op" id="1916379">,</span>&nbsp;<span class="ident" id="1916381"><a href="/runtime/env_posix.go.html#1916722">cstring</a></span><span class="op" id="1916388">(</span><span class="ident" id="1916389"><a href="/runtime/env_posix.go.html#1916296">v</a></span><span class="op" id="1916390">)</span><span class="op" id="1916391">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916394"><a href="/runtime/stubs.go.html#2139621">asmcgocall</a></span><span class="op" id="1916404">(</span><span class="ident" id="1916405"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916411">.</span><span class="ident" id="1916412">Pointer</span><span class="op" id="1916419">(</span><span class="ident" id="1916420"><a href="/runtime/env_posix.go.html#1916088">_cgo_setenv</a></span><span class="op" id="1916431">)</span><span class="op" id="1916432">,</span>&nbsp;<span class="ident" id="1916434"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916440">.</span><span class="ident" id="1916441">Pointer</span><span class="op" id="1916448">(</span><span class="op" id="1916449">&amp;</span><span class="ident" id="1916450"><a href="/runtime/env_posix.go.html#1916344">arg</a></span><span class="op" id="1916453">)</span><span class="op" id="1916454">)</span><br>
<span class="lineno"></span><span class="op" id="1916456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1916459">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1916505">//&nbsp;Called&nbsp;from&nbsp;syscall.unsetenv.</span><br>
<span class="lineno">50</span><span class="keyword" id="1916538">func</span>&nbsp;<span class="ident" id="1916543">syscall_unsetenv_c</span><span class="op" id="1916561">(</span><span class="ident" id="1916562">k</span>&nbsp;<span class="builtintype" id="1916564">string</span><span class="op" id="1916570">)</span>&nbsp;<span class="op" id="1916572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916575">if</span>&nbsp;<span class="ident" id="1916578"><a href="/runtime/env_posix.go.html#1916139">_cgo_unsetenv</a></span>&nbsp;<span class="op" id="1916592">==</span>&nbsp;<span class="num" id="1916595">0</span>&nbsp;<span class="op" id="1916597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916601">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1916609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916612">arg</span>&nbsp;<span class="op" id="1916616">:=</span>&nbsp;<span class="op" id="1916619">[</span><span class="num" id="1916620">1</span><span class="op" id="1916621">]</span><span class="ident" id="1916622"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916628">.</span><span class="ident" id="1916629">Pointer</span><span class="op" id="1916636">{</span><span class="ident" id="1916637"><a href="/runtime/env_posix.go.html#1916722">cstring</a></span><span class="op" id="1916644">(</span><span class="ident" id="1916645"><a href="/runtime/env_posix.go.html#1916562">k</a></span><span class="op" id="1916646">)</span><span class="op" id="1916647">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916650"><a href="/runtime/stubs.go.html#2139621">asmcgocall</a></span><span class="op" id="1916660">(</span><span class="ident" id="1916661"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916667">.</span><span class="ident" id="1916668">Pointer</span><span class="op" id="1916675">(</span><span class="ident" id="1916676"><a href="/runtime/env_posix.go.html#1916139">_cgo_unsetenv</a></span><span class="op" id="1916689">)</span><span class="op" id="1916690">,</span>&nbsp;<span class="ident" id="1916692"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916698">.</span><span class="ident" id="1916699">Pointer</span><span class="op" id="1916706">(</span><span class="op" id="1916707">&amp;</span><span class="ident" id="1916708"><a href="/runtime/env_posix.go.html#1916612">arg</a></span><span class="op" id="1916711">)</span><span class="op" id="1916712">)</span><br>
<span class="lineno"></span><span class="op" id="1916714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1916717">func</span>&nbsp;<span class="ident" id="1916722">cstring</span><span class="op" id="1916729">(</span><span class="ident" id="1916730">s</span>&nbsp;<span class="builtintype" id="1916732">string</span><span class="op" id="1916738">)</span>&nbsp;<span class="ident" id="1916740"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916746">.</span><span class="ident" id="1916747">Pointer</span>&nbsp;<span class="op" id="1916755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916758">p</span>&nbsp;<span class="op" id="1916760">:=</span>&nbsp;<span class="builtinfunc" id="1916763">make</span><span class="op" id="1916767">(</span><span class="op" id="1916768">[</span><span class="op" id="1916769">]</span><span class="builtintype" id="1916770">byte</span><span class="op" id="1916774">,</span>&nbsp;<span class="builtinfunc" id="1916776">len</span><span class="op" id="1916779">(</span><span class="ident" id="1916780"><a href="/runtime/env_posix.go.html#1916730">s</a></span><span class="op" id="1916781">)</span><span class="op" id="1916782">+</span><span class="num" id="1916783">1</span><span class="op" id="1916784">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916787">sp</span>&nbsp;<span class="op" id="1916790">:=</span>&nbsp;<span class="op" id="1916793">(</span><span class="op" id="1916794">*</span><span class="ident" id="1916795"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179381">_string</a></span><span class="op" id="1916802">)</span><span class="op" id="1916803">(</span><span class="ident" id="1916804"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916810">.</span><span class="ident" id="1916811">Pointer</span><span class="op" id="1916818">(</span><span class="op" id="1916819">&amp;</span><span class="ident" id="1916820"><a href="/runtime/env_posix.go.html#1916730">s</a></span><span class="op" id="1916821">)</span><span class="op" id="1916822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916825"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="1916832">(</span><span class="ident" id="1916833"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916839">.</span><span class="ident" id="1916840">Pointer</span><span class="op" id="1916847">(</span><span class="op" id="1916848">&amp;</span><span class="ident" id="1916849"><a href="/runtime/env_posix.go.html#1916758">p</a></span><span class="op" id="1916850">[</span><span class="num" id="1916851">0</span><span class="op" id="1916852">]</span><span class="op" id="1916853">)</span><span class="op" id="1916854">,</span>&nbsp;<span class="ident" id="1916856"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916862">.</span><span class="ident" id="1916863">Pointer</span><span class="op" id="1916870">(</span><span class="ident" id="1916871"><a href="/runtime/env_posix.go.html#1916787">sp</a></span><span class="op" id="1916873">.</span><span class="ident" id="1916874">str</span><span class="op" id="1916877">)</span><span class="op" id="1916878">,</span>&nbsp;<span class="builtintype" id="1916880">uintptr</span><span class="op" id="1916887">(</span><span class="builtinfunc" id="1916888">len</span><span class="op" id="1916891">(</span><span class="ident" id="1916892"><a href="/runtime/env_posix.go.html#1916730">s</a></span><span class="op" id="1916893">)</span><span class="op" id="1916894">)</span><span class="op" id="1916895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916898">return</span>&nbsp;<span class="ident" id="1916905"><a href="/runtime/env_posix.go.html#1915617">unsafe</a></span><span class="op" id="1916911">.</span><span class="ident" id="1916912">Pointer</span><span class="op" id="1916919">(</span><span class="op" id="1916920">&amp;</span><span class="ident" id="1916921"><a href="/runtime/env_posix.go.html#1916758">p</a></span><span class="op" id="1916922">[</span><span class="num" id="1916923">0</span><span class="op" id="1916924">]</span><span class="op" id="1916925">)</span><br>
<span class="lineno"></span><span class="op" id="1916927">}</span>
</div>
</body>
</html>
