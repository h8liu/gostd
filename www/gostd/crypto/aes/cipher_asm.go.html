<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html" class="current">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3701021">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3701076">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3701130">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3701181">//&nbsp;+build&nbsp;amd64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3701198">package</span>&nbsp;<span class="ident" id="3701206">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701211">//&nbsp;defined&nbsp;in&nbsp;asm_$GOARCH.s</span><br>
<span class="lineno">10</span><span class="keyword" id="3701239">func</span>&nbsp;<span class="ident" id="3701244">hasAsm</span><span class="op" id="3701250">(</span><span class="op" id="3701251">)</span>&nbsp;<span class="builtintype" id="3701253">bool</span><br>
<span class="lineno"></span><span class="keyword" id="3701258">func</span>&nbsp;<span class="ident" id="3701263">encryptBlockAsm</span><span class="op" id="3701278">(</span><span class="ident" id="3701279">nr</span>&nbsp;<span class="builtintype" id="3701282">int</span><span class="op" id="3701285">,</span>&nbsp;<span class="ident" id="3701287">xk</span>&nbsp;<span class="op" id="3701290">*</span><span class="builtintype" id="3701291">uint32</span><span class="op" id="3701297">,</span>&nbsp;<span class="ident" id="3701299">dst</span><span class="op" id="3701302">,</span>&nbsp;<span class="ident" id="3701304">src</span>&nbsp;<span class="op" id="3701308">*</span><span class="builtintype" id="3701309">byte</span><span class="op" id="3701313">)</span><br>
<span class="lineno"></span><span class="keyword" id="3701315">func</span>&nbsp;<span class="ident" id="3701320">decryptBlockAsm</span><span class="op" id="3701335">(</span><span class="ident" id="3701336">nr</span>&nbsp;<span class="builtintype" id="3701339">int</span><span class="op" id="3701342">,</span>&nbsp;<span class="ident" id="3701344">xk</span>&nbsp;<span class="op" id="3701347">*</span><span class="builtintype" id="3701348">uint32</span><span class="op" id="3701354">,</span>&nbsp;<span class="ident" id="3701356">dst</span><span class="op" id="3701359">,</span>&nbsp;<span class="ident" id="3701361">src</span>&nbsp;<span class="op" id="3701365">*</span><span class="builtintype" id="3701366">byte</span><span class="op" id="3701370">)</span><br>
<span class="lineno"></span><span class="keyword" id="3701372">func</span>&nbsp;<span class="ident" id="3701377">expandKeyAsm</span><span class="op" id="3701389">(</span><span class="ident" id="3701390">nr</span>&nbsp;<span class="builtintype" id="3701393">int</span><span class="op" id="3701396">,</span>&nbsp;<span class="ident" id="3701398">key</span>&nbsp;<span class="op" id="3701402">*</span><span class="builtintype" id="3701403">byte</span><span class="op" id="3701407">,</span>&nbsp;<span class="ident" id="3701409">enc</span>&nbsp;<span class="op" id="3701413">*</span><span class="builtintype" id="3701414">uint32</span><span class="op" id="3701420">,</span>&nbsp;<span class="ident" id="3701422">dec</span>&nbsp;<span class="op" id="3701426">*</span><span class="builtintype" id="3701427">uint32</span><span class="op" id="3701433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3701436">var</span>&nbsp;<span class="ident" id="3701440">useAsm</span>&nbsp;<span class="op" id="3701447">=</span>&nbsp;<span class="ident" id="3701449">hasAsm</span><span class="op" id="3701455">(</span><span class="op" id="3701456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3701459">func</span>&nbsp;<span class="ident" id="3701464">encryptBlock</span><span class="op" id="3701476">(</span><span class="ident" id="3701477">xk</span>&nbsp;<span class="op" id="3701480">[</span><span class="op" id="3701481">]</span><span class="builtintype" id="3701482">uint32</span><span class="op" id="3701488">,</span>&nbsp;<span class="ident" id="3701490">dst</span><span class="op" id="3701493">,</span>&nbsp;<span class="ident" id="3701495">src</span>&nbsp;<span class="op" id="3701499">[</span><span class="op" id="3701500">]</span><span class="builtintype" id="3701501">byte</span><span class="op" id="3701505">)</span>&nbsp;<span class="op" id="3701507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701510">if</span>&nbsp;<span class="ident" id="3701513">useAsm</span>&nbsp;<span class="op" id="3701520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701524">encryptBlockAsm</span><span class="op" id="3701539">(</span><span class="builtinfunc" id="3701540">len</span><span class="op" id="3701543">(</span><span class="ident" id="3701544">xk</span><span class="op" id="3701546">)</span><span class="op" id="3701547">/</span><span class="num" id="3701548">4</span><span class="op" id="3701549">-</span><span class="num" id="3701550">1</span><span class="op" id="3701551">,</span>&nbsp;<span class="op" id="3701553">&amp;</span><span class="ident" id="3701554">xk</span><span class="op" id="3701556">[</span><span class="num" id="3701557">0</span><span class="op" id="3701558">]</span><span class="op" id="3701559">,</span>&nbsp;<span class="op" id="3701561">&amp;</span><span class="ident" id="3701562">dst</span><span class="op" id="3701565">[</span><span class="num" id="3701566">0</span><span class="op" id="3701567">]</span><span class="op" id="3701568">,</span>&nbsp;<span class="op" id="3701570">&amp;</span><span class="ident" id="3701571">src</span><span class="op" id="3701574">[</span><span class="num" id="3701575">0</span><span class="op" id="3701576">]</span><span class="op" id="3701577">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701580">}</span>&nbsp;<span class="keyword" id="3701582">else</span>&nbsp;<span class="op" id="3701587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701591">encryptBlockGo</span><span class="op" id="3701605">(</span><span class="ident" id="3701606">xk</span><span class="op" id="3701608">,</span>&nbsp;<span class="ident" id="3701610">dst</span><span class="op" id="3701613">,</span>&nbsp;<span class="ident" id="3701615">src</span><span class="op" id="3701618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701621">}</span><br>
<span class="lineno"></span><span class="op" id="3701623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3701626">func</span>&nbsp;<span class="ident" id="3701631">decryptBlock</span><span class="op" id="3701643">(</span><span class="ident" id="3701644">xk</span>&nbsp;<span class="op" id="3701647">[</span><span class="op" id="3701648">]</span><span class="builtintype" id="3701649">uint32</span><span class="op" id="3701655">,</span>&nbsp;<span class="ident" id="3701657">dst</span><span class="op" id="3701660">,</span>&nbsp;<span class="ident" id="3701662">src</span>&nbsp;<span class="op" id="3701666">[</span><span class="op" id="3701667">]</span><span class="builtintype" id="3701668">byte</span><span class="op" id="3701672">)</span>&nbsp;<span class="op" id="3701674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701677">if</span>&nbsp;<span class="ident" id="3701680">useAsm</span>&nbsp;<span class="op" id="3701687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701691">decryptBlockAsm</span><span class="op" id="3701706">(</span><span class="builtinfunc" id="3701707">len</span><span class="op" id="3701710">(</span><span class="ident" id="3701711">xk</span><span class="op" id="3701713">)</span><span class="op" id="3701714">/</span><span class="num" id="3701715">4</span><span class="op" id="3701716">-</span><span class="num" id="3701717">1</span><span class="op" id="3701718">,</span>&nbsp;<span class="op" id="3701720">&amp;</span><span class="ident" id="3701721">xk</span><span class="op" id="3701723">[</span><span class="num" id="3701724">0</span><span class="op" id="3701725">]</span><span class="op" id="3701726">,</span>&nbsp;<span class="op" id="3701728">&amp;</span><span class="ident" id="3701729">dst</span><span class="op" id="3701732">[</span><span class="num" id="3701733">0</span><span class="op" id="3701734">]</span><span class="op" id="3701735">,</span>&nbsp;<span class="op" id="3701737">&amp;</span><span class="ident" id="3701738">src</span><span class="op" id="3701741">[</span><span class="num" id="3701742">0</span><span class="op" id="3701743">]</span><span class="op" id="3701744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701747">}</span>&nbsp;<span class="keyword" id="3701749">else</span>&nbsp;<span class="op" id="3701754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701758">decryptBlockGo</span><span class="op" id="3701772">(</span><span class="ident" id="3701773">xk</span><span class="op" id="3701775">,</span>&nbsp;<span class="ident" id="3701777">dst</span><span class="op" id="3701780">,</span>&nbsp;<span class="ident" id="3701782">src</span><span class="op" id="3701785">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701788">}</span><br>
<span class="lineno"></span><span class="op" id="3701790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3701793">func</span>&nbsp;<span class="ident" id="3701798">expandKey</span><span class="op" id="3701807">(</span><span class="ident" id="3701808">key</span>&nbsp;<span class="op" id="3701812">[</span><span class="op" id="3701813">]</span><span class="builtintype" id="3701814">byte</span><span class="op" id="3701818">,</span>&nbsp;<span class="ident" id="3701820">enc</span><span class="op" id="3701823">,</span>&nbsp;<span class="ident" id="3701825">dec</span>&nbsp;<span class="op" id="3701829">[</span><span class="op" id="3701830">]</span><span class="builtintype" id="3701831">uint32</span><span class="op" id="3701837">)</span>&nbsp;<span class="op" id="3701839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701842">if</span>&nbsp;<span class="ident" id="3701845">useAsm</span>&nbsp;<span class="op" id="3701852">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701856">rounds</span>&nbsp;<span class="op" id="3701863">:=</span>&nbsp;<span class="num" id="3701866">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701871">switch</span>&nbsp;<span class="builtinfunc" id="3701878">len</span><span class="op" id="3701881">(</span><span class="ident" id="3701882">key</span><span class="op" id="3701885">)</span>&nbsp;<span class="op" id="3701887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701891">case</span>&nbsp;<span class="num" id="3701896">128</span>&nbsp;<span class="op" id="3701900">/</span>&nbsp;<span class="num" id="3701902">8</span><span class="op" id="3701903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701908">rounds</span>&nbsp;<span class="op" id="3701915">=</span>&nbsp;<span class="num" id="3701917">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701922">case</span>&nbsp;<span class="num" id="3701927">192</span>&nbsp;<span class="op" id="3701931">/</span>&nbsp;<span class="num" id="3701933">8</span><span class="op" id="3701934">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701939">rounds</span>&nbsp;<span class="op" id="3701946">=</span>&nbsp;<span class="num" id="3701948">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701953">case</span>&nbsp;<span class="num" id="3701958">256</span>&nbsp;<span class="op" id="3701962">/</span>&nbsp;<span class="num" id="3701964">8</span><span class="op" id="3701965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701970">rounds</span>&nbsp;<span class="op" id="3701977">=</span>&nbsp;<span class="num" id="3701979">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701988">expandKeyAsm</span><span class="op" id="3702000">(</span><span class="ident" id="3702001">rounds</span><span class="op" id="3702007">,</span>&nbsp;<span class="op" id="3702009">&amp;</span><span class="ident" id="3702010">key</span><span class="op" id="3702013">[</span><span class="num" id="3702014">0</span><span class="op" id="3702015">]</span><span class="op" id="3702016">,</span>&nbsp;<span class="op" id="3702018">&amp;</span><span class="ident" id="3702019">enc</span><span class="op" id="3702022">[</span><span class="num" id="3702023">0</span><span class="op" id="3702024">]</span><span class="op" id="3702025">,</span>&nbsp;<span class="op" id="3702027">&amp;</span><span class="ident" id="3702028">dec</span><span class="op" id="3702031">[</span><span class="num" id="3702032">0</span><span class="op" id="3702033">]</span><span class="op" id="3702034">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702037">}</span>&nbsp;<span class="keyword" id="3702039">else</span>&nbsp;<span class="op" id="3702044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702048">expandKeyGo</span><span class="op" id="3702059">(</span><span class="ident" id="3702060">key</span><span class="op" id="3702063">,</span>&nbsp;<span class="ident" id="3702065">enc</span><span class="op" id="3702068">,</span>&nbsp;<span class="ident" id="3702070">dec</span><span class="op" id="3702073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702076">}</span><br>
<span class="lineno"></span><span class="op" id="3702078">}</span>
</div>
</body>
</html>
