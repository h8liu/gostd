<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6724384">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6724439">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6724493">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6724544">package</span>&nbsp;<span class="ident" id="6724552">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6724557">import</span>&nbsp;<span class="op" id="6724564">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724567">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724576">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724583">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724589">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724596">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724607">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6724618">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6724625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6724628">var</span>&nbsp;<span class="ident" id="6724632">rsaCertPEM</span>&nbsp;<span class="op" id="6724643">=</span>&nbsp;<span class="string" id="6724645">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6725341">var</span>&nbsp;<span class="ident" id="6725345">rsaKeyPEM</span>&nbsp;<span class="op" id="6725355">=</span>&nbsp;<span class="string" id="6725357">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6725858">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6725922">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="6725993">var</span>&nbsp;<span class="ident" id="6725997">keyPEM</span>&nbsp;<span class="op" id="6726004">=</span>&nbsp;<span class="string" id="6726006">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6726499">var</span>&nbsp;<span class="ident" id="6726503">ecdsaCertPEM</span>&nbsp;<span class="op" id="6726516">=</span>&nbsp;<span class="string" id="6726518">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6727275">var</span>&nbsp;<span class="ident" id="6727279">ecdsaKeyPEM</span>&nbsp;<span class="op" id="6727291">=</span>&nbsp;<span class="string" id="6727293">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6727733">var</span>&nbsp;<span class="ident" id="6727737">keyPairTests</span>&nbsp;<span class="op" id="6727750">=</span>&nbsp;<span class="op" id="6727752">[</span><span class="op" id="6727753">]</span><span class="keyword" id="6727754">struct</span>&nbsp;<span class="op" id="6727761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727764">algo</span>&nbsp;<span class="builtintype" id="6727769">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727777">cert</span>&nbsp;<span class="builtintype" id="6727782">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727790">key</span>&nbsp;&nbsp;<span class="builtintype" id="6727795">string</span><br>
<span class="lineno"></span><span class="op" id="6727802">}</span><span class="op" id="6727803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727806">{</span><span class="string" id="6727807">&#34;ECDSA&#34;</span><span class="op" id="6727814">,</span>&nbsp;<span class="ident" id="6727816">ecdsaCertPEM</span><span class="op" id="6727828">,</span>&nbsp;<span class="ident" id="6727830">ecdsaKeyPEM</span><span class="op" id="6727841">}</span><span class="op" id="6727842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727845">{</span><span class="string" id="6727846">&#34;RSA&#34;</span><span class="op" id="6727851">,</span>&nbsp;<span class="ident" id="6727853">rsaCertPEM</span><span class="op" id="6727863">,</span>&nbsp;<span class="ident" id="6727865">rsaKeyPEM</span><span class="op" id="6727874">}</span><span class="op" id="6727875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727878">{</span><span class="string" id="6727879">&#34;RSA-untyped&#34;</span><span class="op" id="6727892">,</span>&nbsp;<span class="ident" id="6727894">rsaCertPEM</span><span class="op" id="6727904">,</span>&nbsp;<span class="ident" id="6727906">keyPEM</span><span class="op" id="6727912">}</span><span class="op" id="6727913">,</span>&nbsp;<span class="comment" id="6727915">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="6727940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6727943">func</span>&nbsp;<span class="ident" id="6727948">TestX509KeyPair</span><span class="op" id="6727963">(</span><span class="ident" id="6727964">t</span>&nbsp;<span class="op" id="6727966">*</span><span class="ident" id="6727967">testing</span><span class="op" id="6727974">.</span><span class="ident" id="6727975">T</span><span class="op" id="6727976">)</span>&nbsp;<span class="op" id="6727978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727981">var</span>&nbsp;<span class="ident" id="6727985">pem</span>&nbsp;<span class="op" id="6727989">[</span><span class="op" id="6727990">]</span><span class="builtintype" id="6727991">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727997">for</span>&nbsp;<span class="ident" id="6728001">_</span><span class="op" id="6728002">,</span>&nbsp;<span class="ident" id="6728004">test</span>&nbsp;<span class="op" id="6728009">:=</span>&nbsp;<span class="keyword" id="6728012">range</span>&nbsp;<span class="ident" id="6728018">keyPairTests</span>&nbsp;<span class="op" id="6728031">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728035">pem</span>&nbsp;<span class="op" id="6728039">=</span>&nbsp;<span class="op" id="6728041">[</span><span class="op" id="6728042">]</span><span class="builtintype" id="6728043">byte</span><span class="op" id="6728047">(</span><span class="ident" id="6728048">test</span><span class="op" id="6728052">.</span><span class="ident" id="6728053">cert</span>&nbsp;<span class="op" id="6728058">+</span>&nbsp;<span class="ident" id="6728060">test</span><span class="op" id="6728064">.</span><span class="ident" id="6728065">key</span><span class="op" id="6728068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728072">if</span>&nbsp;<span class="ident" id="6728075">_</span><span class="op" id="6728076">,</span>&nbsp;<span class="ident" id="6728078">err</span>&nbsp;<span class="op" id="6728082">:=</span>&nbsp;<span class="ident" id="6728085">X509KeyPair</span><span class="op" id="6728096">(</span><span class="ident" id="6728097">pem</span><span class="op" id="6728100">,</span>&nbsp;<span class="ident" id="6728102">pem</span><span class="op" id="6728105">)</span><span class="op" id="6728106">;</span>&nbsp;<span class="ident" id="6728108">err</span>&nbsp;<span class="op" id="6728112">!=</span>&nbsp;<span class="ident" id="6728115">nil</span>&nbsp;<span class="op" id="6728119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728124">t</span><span class="op" id="6728125">.</span><span class="ident" id="6728126">Errorf</span><span class="op" id="6728132">(</span><span class="string" id="6728133">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6728180">,</span>&nbsp;<span class="ident" id="6728182">test</span><span class="op" id="6728186">.</span><span class="ident" id="6728187">algo</span><span class="op" id="6728191">,</span>&nbsp;<span class="ident" id="6728193">test</span><span class="op" id="6728197">.</span><span class="ident" id="6728198">algo</span><span class="op" id="6728202">,</span>&nbsp;<span class="ident" id="6728204">err</span><span class="op" id="6728207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728215">pem</span>&nbsp;<span class="op" id="6728219">=</span>&nbsp;<span class="op" id="6728221">[</span><span class="op" id="6728222">]</span><span class="builtintype" id="6728223">byte</span><span class="op" id="6728227">(</span><span class="ident" id="6728228">test</span><span class="op" id="6728232">.</span><span class="ident" id="6728233">key</span>&nbsp;<span class="op" id="6728237">+</span>&nbsp;<span class="ident" id="6728239">test</span><span class="op" id="6728243">.</span><span class="ident" id="6728244">cert</span><span class="op" id="6728248">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728252">if</span>&nbsp;<span class="ident" id="6728255">_</span><span class="op" id="6728256">,</span>&nbsp;<span class="ident" id="6728258">err</span>&nbsp;<span class="op" id="6728262">:=</span>&nbsp;<span class="ident" id="6728265">X509KeyPair</span><span class="op" id="6728276">(</span><span class="ident" id="6728277">pem</span><span class="op" id="6728280">,</span>&nbsp;<span class="ident" id="6728282">pem</span><span class="op" id="6728285">)</span><span class="op" id="6728286">;</span>&nbsp;<span class="ident" id="6728288">err</span>&nbsp;<span class="op" id="6728292">!=</span>&nbsp;<span class="ident" id="6728295">nil</span>&nbsp;<span class="op" id="6728299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728304">t</span><span class="op" id="6728305">.</span><span class="ident" id="6728306">Errorf</span><span class="op" id="6728312">(</span><span class="string" id="6728313">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="6728360">,</span>&nbsp;<span class="ident" id="6728362">test</span><span class="op" id="6728366">.</span><span class="ident" id="6728367">algo</span><span class="op" id="6728371">,</span>&nbsp;<span class="ident" id="6728373">test</span><span class="op" id="6728377">.</span><span class="ident" id="6728378">algo</span><span class="op" id="6728382">,</span>&nbsp;<span class="ident" id="6728384">err</span><span class="op" id="6728387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728394">}</span><br>
<span class="lineno"></span><span class="op" id="6728396">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6728399">func</span>&nbsp;<span class="ident" id="6728404">TestX509MixedKeyPair</span><span class="op" id="6728424">(</span><span class="ident" id="6728425">t</span>&nbsp;<span class="op" id="6728427">*</span><span class="ident" id="6728428">testing</span><span class="op" id="6728435">.</span><span class="ident" id="6728436">T</span><span class="op" id="6728437">)</span>&nbsp;<span class="op" id="6728439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728442">if</span>&nbsp;<span class="ident" id="6728445">_</span><span class="op" id="6728446">,</span>&nbsp;<span class="ident" id="6728448">err</span>&nbsp;<span class="op" id="6728452">:=</span>&nbsp;<span class="ident" id="6728455">X509KeyPair</span><span class="op" id="6728466">(</span><span class="op" id="6728467">[</span><span class="op" id="6728468">]</span><span class="builtintype" id="6728469">byte</span><span class="op" id="6728473">(</span><span class="ident" id="6728474">rsaCertPEM</span><span class="op" id="6728484">)</span><span class="op" id="6728485">,</span>&nbsp;<span class="op" id="6728487">[</span><span class="op" id="6728488">]</span><span class="builtintype" id="6728489">byte</span><span class="op" id="6728493">(</span><span class="ident" id="6728494">ecdsaKeyPEM</span><span class="op" id="6728505">)</span><span class="op" id="6728506">)</span><span class="op" id="6728507">;</span>&nbsp;<span class="ident" id="6728509">err</span>&nbsp;<span class="op" id="6728513">==</span>&nbsp;<span class="ident" id="6728516">nil</span>&nbsp;<span class="op" id="6728520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728524">t</span><span class="op" id="6728525">.</span><span class="ident" id="6728526">Error</span><span class="op" id="6728531">(</span><span class="string" id="6728532">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="6728590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728593">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728596">if</span>&nbsp;<span class="ident" id="6728599">_</span><span class="op" id="6728600">,</span>&nbsp;<span class="ident" id="6728602">err</span>&nbsp;<span class="op" id="6728606">:=</span>&nbsp;<span class="ident" id="6728609">X509KeyPair</span><span class="op" id="6728620">(</span><span class="op" id="6728621">[</span><span class="op" id="6728622">]</span><span class="builtintype" id="6728623">byte</span><span class="op" id="6728627">(</span><span class="ident" id="6728628">ecdsaCertPEM</span><span class="op" id="6728640">)</span><span class="op" id="6728641">,</span>&nbsp;<span class="op" id="6728643">[</span><span class="op" id="6728644">]</span><span class="builtintype" id="6728645">byte</span><span class="op" id="6728649">(</span><span class="ident" id="6728650">rsaKeyPEM</span><span class="op" id="6728659">)</span><span class="op" id="6728660">)</span><span class="op" id="6728661">;</span>&nbsp;<span class="ident" id="6728663">err</span>&nbsp;<span class="op" id="6728667">==</span>&nbsp;<span class="ident" id="6728670">nil</span>&nbsp;<span class="op" id="6728674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728678">t</span><span class="op" id="6728679">.</span><span class="ident" id="6728680">Error</span><span class="op" id="6728685">(</span><span class="string" id="6728686">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="6728744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728747">}</span><br>
<span class="lineno"></span><span class="op" id="6728749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6728752">func</span>&nbsp;<span class="ident" id="6728757">newLocalListener</span><span class="op" id="6728773">(</span><span class="ident" id="6728774">t</span>&nbsp;<span class="op" id="6728776">*</span><span class="ident" id="6728777">testing</span><span class="op" id="6728784">.</span><span class="ident" id="6728785">T</span><span class="op" id="6728786">)</span>&nbsp;<span class="ident" id="6728788">net</span><span class="op" id="6728791">.</span><span class="ident" id="6728792">Listener</span>&nbsp;<span class="op" id="6728801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728804">ln</span><span class="op" id="6728806">,</span>&nbsp;<span class="ident" id="6728808">err</span>&nbsp;<span class="op" id="6728812">:=</span>&nbsp;<span class="ident" id="6728815">net</span><span class="op" id="6728818">.</span><span class="ident" id="6728819">Listen</span><span class="op" id="6728825">(</span><span class="string" id="6728826">&#34;tcp&#34;</span><span class="op" id="6728831">,</span>&nbsp;<span class="string" id="6728833">&#34;127.0.0.1:0&#34;</span><span class="op" id="6728846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728849">if</span>&nbsp;<span class="ident" id="6728852">err</span>&nbsp;<span class="op" id="6728856">!=</span>&nbsp;<span class="ident" id="6728859">nil</span>&nbsp;<span class="op" id="6728863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728867">ln</span><span class="op" id="6728869">,</span>&nbsp;<span class="ident" id="6728871">err</span>&nbsp;<span class="op" id="6728875">=</span>&nbsp;<span class="ident" id="6728877">net</span><span class="op" id="6728880">.</span><span class="ident" id="6728881">Listen</span><span class="op" id="6728887">(</span><span class="string" id="6728888">&#34;tcp6&#34;</span><span class="op" id="6728894">,</span>&nbsp;<span class="string" id="6728896">&#34;[::1]:0&#34;</span><span class="op" id="6728905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728908">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728911">if</span>&nbsp;<span class="ident" id="6728914">err</span>&nbsp;<span class="op" id="6728918">!=</span>&nbsp;<span class="ident" id="6728921">nil</span>&nbsp;<span class="op" id="6728925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728929">t</span><span class="op" id="6728930">.</span><span class="ident" id="6728931">Fatal</span><span class="op" id="6728936">(</span><span class="ident" id="6728937">err</span><span class="op" id="6728940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728946">return</span>&nbsp;<span class="ident" id="6728953">ln</span><br>
<span class="lineno"></span><span class="op" id="6728956">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6728959">func</span>&nbsp;<span class="ident" id="6728964">TestDialTimeout</span><span class="op" id="6728979">(</span><span class="ident" id="6728980">t</span>&nbsp;<span class="op" id="6728982">*</span><span class="ident" id="6728983">testing</span><span class="op" id="6728990">.</span><span class="ident" id="6728991">T</span><span class="op" id="6728992">)</span>&nbsp;<span class="op" id="6728994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728997">if</span>&nbsp;<span class="ident" id="6729000">testing</span><span class="op" id="6729007">.</span><span class="ident" id="6729008">Short</span><span class="op" id="6729013">(</span><span class="op" id="6729014">)</span>&nbsp;<span class="op" id="6729016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729020">t</span><span class="op" id="6729021">.</span><span class="ident" id="6729022">Skip</span><span class="op" id="6729026">(</span><span class="string" id="6729027">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6729051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729054">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729057">listener</span>&nbsp;<span class="op" id="6729066">:=</span>&nbsp;<span class="ident" id="6729069">newLocalListener</span><span class="op" id="6729085">(</span><span class="ident" id="6729086">t</span><span class="op" id="6729087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729091">addr</span>&nbsp;<span class="op" id="6729096">:=</span>&nbsp;<span class="ident" id="6729099">listener</span><span class="op" id="6729107">.</span><span class="ident" id="6729108">Addr</span><span class="op" id="6729112">(</span><span class="op" id="6729113">)</span><span class="op" id="6729114">.</span><span class="ident" id="6729115">String</span><span class="op" id="6729121">(</span><span class="op" id="6729122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729125">defer</span>&nbsp;<span class="ident" id="6729131">listener</span><span class="op" id="6729139">.</span><span class="ident" id="6729140">Close</span><span class="op" id="6729145">(</span><span class="op" id="6729146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729150">complete</span>&nbsp;<span class="op" id="6729159">:=</span>&nbsp;<span class="builtinfunc" id="6729162">make</span><span class="op" id="6729166">(</span><span class="keyword" id="6729167">chan</span>&nbsp;<span class="builtintype" id="6729172">bool</span><span class="op" id="6729176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729179">defer</span>&nbsp;<span class="builtinfunc" id="6729185">close</span><span class="op" id="6729190">(</span><span class="ident" id="6729191">complete</span><span class="op" id="6729199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729203">go</span>&nbsp;<span class="keyword" id="6729206">func</span><span class="op" id="6729210">(</span><span class="op" id="6729211">)</span>&nbsp;<span class="op" id="6729213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729217">conn</span><span class="op" id="6729221">,</span>&nbsp;<span class="ident" id="6729223">err</span>&nbsp;<span class="op" id="6729227">:=</span>&nbsp;<span class="ident" id="6729230">listener</span><span class="op" id="6729238">.</span><span class="ident" id="6729239">Accept</span><span class="op" id="6729245">(</span><span class="op" id="6729246">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729250">if</span>&nbsp;<span class="ident" id="6729253">err</span>&nbsp;<span class="op" id="6729257">!=</span>&nbsp;<span class="ident" id="6729260">nil</span>&nbsp;<span class="op" id="6729264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729269">t</span><span class="op" id="6729270">.</span><span class="ident" id="6729271">Error</span><span class="op" id="6729276">(</span><span class="ident" id="6729277">err</span><span class="op" id="6729280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729285">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729298">&lt;-</span><span class="ident" id="6729300">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729311">conn</span><span class="op" id="6729315">.</span><span class="ident" id="6729316">Close</span><span class="op" id="6729321">(</span><span class="op" id="6729322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729325">}</span><span class="op" id="6729326">(</span><span class="op" id="6729327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729331">dialer</span>&nbsp;<span class="op" id="6729338">:=</span>&nbsp;<span class="op" id="6729341">&amp;</span><span class="ident" id="6729342">net</span><span class="op" id="6729345">.</span><span class="ident" id="6729346">Dialer</span><span class="op" id="6729352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729356">Timeout</span><span class="op" id="6729363">:</span>&nbsp;<span class="num" id="6729365">10</span>&nbsp;<span class="op" id="6729368">*</span>&nbsp;<span class="ident" id="6729370">time</span><span class="op" id="6729374">.</span><span class="ident" id="6729375">Millisecond</span><span class="op" id="6729386">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729393">var</span>&nbsp;<span class="ident" id="6729397">err</span>&nbsp;<span class="builtintype" id="6729401">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729408">if</span>&nbsp;<span class="ident" id="6729411">_</span><span class="op" id="6729412">,</span>&nbsp;<span class="ident" id="6729414">err</span>&nbsp;<span class="op" id="6729418">=</span>&nbsp;<span class="ident" id="6729420">DialWithDialer</span><span class="op" id="6729434">(</span><span class="ident" id="6729435">dialer</span><span class="op" id="6729441">,</span>&nbsp;<span class="string" id="6729443">&#34;tcp&#34;</span><span class="op" id="6729448">,</span>&nbsp;<span class="ident" id="6729450">addr</span><span class="op" id="6729454">,</span>&nbsp;<span class="ident" id="6729456">nil</span><span class="op" id="6729459">)</span><span class="op" id="6729460">;</span>&nbsp;<span class="ident" id="6729462">err</span>&nbsp;<span class="op" id="6729466">==</span>&nbsp;<span class="ident" id="6729469">nil</span>&nbsp;<span class="op" id="6729473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729477">t</span><span class="op" id="6729478">.</span><span class="ident" id="6729479">Fatal</span><span class="op" id="6729484">(</span><span class="string" id="6729485">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="6729525">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729532">if</span>&nbsp;<span class="op" id="6729535">!</span><span class="ident" id="6729536">strings</span><span class="op" id="6729543">.</span><span class="ident" id="6729544">Contains</span><span class="op" id="6729552">(</span><span class="ident" id="6729553">err</span><span class="op" id="6729556">.</span><span class="ident" id="6729557">Error</span><span class="op" id="6729562">(</span><span class="op" id="6729563">)</span><span class="op" id="6729564">,</span>&nbsp;<span class="string" id="6729566">&#34;timed&nbsp;out&#34;</span><span class="op" id="6729577">)</span>&nbsp;<span class="op" id="6729579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729583">t</span><span class="op" id="6729584">.</span><span class="ident" id="6729585">Errorf</span><span class="op" id="6729591">(</span><span class="string" id="6729592">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="6729627">,</span>&nbsp;<span class="ident" id="6729629">err</span><span class="op" id="6729632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729635">}</span><br>
<span class="lineno">160</span><span class="op" id="6729637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6729640">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6729702">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="6729770">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="6729816">func</span>&nbsp;<span class="ident" id="6729821">TestConnReadNonzeroAndEOF</span><span class="op" id="6729846">(</span><span class="ident" id="6729847">t</span>&nbsp;<span class="op" id="6729849">*</span><span class="ident" id="6729850">testing</span><span class="op" id="6729857">.</span><span class="ident" id="6729858">T</span><span class="op" id="6729859">)</span>&nbsp;<span class="op" id="6729861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6729864">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6729922">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6729980">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6730043">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6730102">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6730165">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730200">if</span>&nbsp;<span class="ident" id="6730203">testing</span><span class="op" id="6730210">.</span><span class="ident" id="6730211">Short</span><span class="op" id="6730216">(</span><span class="op" id="6730217">)</span>&nbsp;<span class="op" id="6730219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730223">t</span><span class="op" id="6730224">.</span><span class="ident" id="6730225">Skip</span><span class="op" id="6730229">(</span><span class="string" id="6730230">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6730254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730257">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730260">var</span>&nbsp;<span class="ident" id="6730264">err</span>&nbsp;<span class="builtintype" id="6730268">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730275">for</span>&nbsp;<span class="ident" id="6730279">delay</span>&nbsp;<span class="op" id="6730285">:=</span>&nbsp;<span class="ident" id="6730288">time</span><span class="op" id="6730292">.</span><span class="ident" id="6730293">Millisecond</span><span class="op" id="6730304">;</span>&nbsp;<span class="ident" id="6730306">delay</span>&nbsp;<span class="op" id="6730312">&lt;=</span>&nbsp;<span class="num" id="6730315">64</span><span class="op" id="6730317">*</span><span class="ident" id="6730318">time</span><span class="op" id="6730322">.</span><span class="ident" id="6730323">Millisecond</span><span class="op" id="6730334">;</span>&nbsp;<span class="ident" id="6730336">delay</span>&nbsp;<span class="op" id="6730342">*=</span>&nbsp;<span class="num" id="6730345">2</span>&nbsp;<span class="op" id="6730347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730351">if</span>&nbsp;<span class="ident" id="6730354">err</span>&nbsp;<span class="op" id="6730358">=</span>&nbsp;<span class="ident" id="6730360">testConnReadNonzeroAndEOF</span><span class="op" id="6730385">(</span><span class="ident" id="6730386">t</span><span class="op" id="6730387">,</span>&nbsp;<span class="ident" id="6730389">delay</span><span class="op" id="6730394">)</span><span class="op" id="6730395">;</span>&nbsp;<span class="ident" id="6730397">err</span>&nbsp;<span class="op" id="6730401">==</span>&nbsp;<span class="ident" id="6730404">nil</span>&nbsp;<span class="op" id="6730408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730422">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730428">t</span><span class="op" id="6730429">.</span><span class="ident" id="6730430">Error</span><span class="op" id="6730435">(</span><span class="ident" id="6730436">err</span><span class="op" id="6730439">)</span><br>
<span class="lineno"></span><span class="op" id="6730441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6730444">func</span>&nbsp;<span class="ident" id="6730449">testConnReadNonzeroAndEOF</span><span class="op" id="6730474">(</span><span class="ident" id="6730475">t</span>&nbsp;<span class="op" id="6730477">*</span><span class="ident" id="6730478">testing</span><span class="op" id="6730485">.</span><span class="ident" id="6730486">T</span><span class="op" id="6730487">,</span>&nbsp;<span class="ident" id="6730489">delay</span>&nbsp;<span class="ident" id="6730495">time</span><span class="op" id="6730499">.</span><span class="ident" id="6730500">Duration</span><span class="op" id="6730508">)</span>&nbsp;<span class="builtintype" id="6730510">error</span>&nbsp;<span class="op" id="6730516">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730519">ln</span>&nbsp;<span class="op" id="6730522">:=</span>&nbsp;<span class="ident" id="6730525">newLocalListener</span><span class="op" id="6730541">(</span><span class="ident" id="6730542">t</span><span class="op" id="6730543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730546">defer</span>&nbsp;<span class="ident" id="6730552">ln</span><span class="op" id="6730554">.</span><span class="ident" id="6730555">Close</span><span class="op" id="6730560">(</span><span class="op" id="6730561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730565">srvCh</span>&nbsp;<span class="op" id="6730571">:=</span>&nbsp;<span class="builtinfunc" id="6730574">make</span><span class="op" id="6730578">(</span><span class="keyword" id="6730579">chan</span>&nbsp;<span class="op" id="6730584">*</span><span class="ident" id="6730585">Conn</span><span class="op" id="6730589">,</span>&nbsp;<span class="num" id="6730591">1</span><span class="op" id="6730592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730595">var</span>&nbsp;<span class="ident" id="6730599">serr</span>&nbsp;<span class="builtintype" id="6730604">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730611">go</span>&nbsp;<span class="keyword" id="6730614">func</span><span class="op" id="6730618">(</span><span class="op" id="6730619">)</span>&nbsp;<span class="op" id="6730621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730625">sconn</span><span class="op" id="6730630">,</span>&nbsp;<span class="ident" id="6730632">err</span>&nbsp;<span class="op" id="6730636">:=</span>&nbsp;<span class="ident" id="6730639">ln</span><span class="op" id="6730641">.</span><span class="ident" id="6730642">Accept</span><span class="op" id="6730648">(</span><span class="op" id="6730649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730653">if</span>&nbsp;<span class="ident" id="6730656">err</span>&nbsp;<span class="op" id="6730660">!=</span>&nbsp;<span class="ident" id="6730663">nil</span>&nbsp;<span class="op" id="6730667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730672">serr</span>&nbsp;<span class="op" id="6730677">=</span>&nbsp;<span class="ident" id="6730679">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730686">srvCh</span>&nbsp;<span class="op" id="6730692">&lt;-</span>&nbsp;<span class="ident" id="6730695">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730702">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730715">serverConfig</span>&nbsp;<span class="op" id="6730728">:=</span>&nbsp;<span class="op" id="6730731">*</span><span class="ident" id="6730732">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730745">srv</span>&nbsp;<span class="op" id="6730749">:=</span>&nbsp;<span class="ident" id="6730752">Server</span><span class="op" id="6730758">(</span><span class="ident" id="6730759">sconn</span><span class="op" id="6730764">,</span>&nbsp;<span class="op" id="6730766">&amp;</span><span class="ident" id="6730767">serverConfig</span><span class="op" id="6730779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730783">if</span>&nbsp;<span class="ident" id="6730786">err</span>&nbsp;<span class="op" id="6730790">:=</span>&nbsp;<span class="ident" id="6730793">srv</span><span class="op" id="6730796">.</span><span class="ident" id="6730797">Handshake</span><span class="op" id="6730806">(</span><span class="op" id="6730807">)</span><span class="op" id="6730808">;</span>&nbsp;<span class="ident" id="6730810">err</span>&nbsp;<span class="op" id="6730814">!=</span>&nbsp;<span class="ident" id="6730817">nil</span>&nbsp;<span class="op" id="6730821">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730826">serr</span>&nbsp;<span class="op" id="6730831">=</span>&nbsp;<span class="ident" id="6730833">fmt</span><span class="op" id="6730836">.</span><span class="ident" id="6730837">Errorf</span><span class="op" id="6730843">(</span><span class="string" id="6730844">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="6730859">,</span>&nbsp;<span class="ident" id="6730861">err</span><span class="op" id="6730864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730869">srvCh</span>&nbsp;<span class="op" id="6730875">&lt;-</span>&nbsp;<span class="ident" id="6730878">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730885">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730898">srvCh</span>&nbsp;<span class="op" id="6730904">&lt;-</span>&nbsp;<span class="ident" id="6730907">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730912">}</span><span class="op" id="6730913">(</span><span class="op" id="6730914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730918">clientConfig</span>&nbsp;<span class="op" id="6730931">:=</span>&nbsp;<span class="op" id="6730934">*</span><span class="ident" id="6730935">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730947">conn</span><span class="op" id="6730951">,</span>&nbsp;<span class="ident" id="6730953">err</span>&nbsp;<span class="op" id="6730957">:=</span>&nbsp;<span class="ident" id="6730960">Dial</span><span class="op" id="6730964">(</span><span class="string" id="6730965">&#34;tcp&#34;</span><span class="op" id="6730970">,</span>&nbsp;<span class="ident" id="6730972">ln</span><span class="op" id="6730974">.</span><span class="ident" id="6730975">Addr</span><span class="op" id="6730979">(</span><span class="op" id="6730980">)</span><span class="op" id="6730981">.</span><span class="ident" id="6730982">String</span><span class="op" id="6730988">(</span><span class="op" id="6730989">)</span><span class="op" id="6730990">,</span>&nbsp;<span class="op" id="6730992">&amp;</span><span class="ident" id="6730993">clientConfig</span><span class="op" id="6731005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731008">if</span>&nbsp;<span class="ident" id="6731011">err</span>&nbsp;<span class="op" id="6731015">!=</span>&nbsp;<span class="ident" id="6731018">nil</span>&nbsp;<span class="op" id="6731022">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731026">t</span><span class="op" id="6731027">.</span><span class="ident" id="6731028">Fatal</span><span class="op" id="6731033">(</span><span class="ident" id="6731034">err</span><span class="op" id="6731037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731043">defer</span>&nbsp;<span class="ident" id="6731049">conn</span><span class="op" id="6731053">.</span><span class="ident" id="6731054">Close</span><span class="op" id="6731059">(</span><span class="op" id="6731060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731064">srv</span>&nbsp;<span class="op" id="6731068">:=</span>&nbsp;<span class="op" id="6731071">&lt;-</span><span class="ident" id="6731073">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731080">if</span>&nbsp;<span class="ident" id="6731083">srv</span>&nbsp;<span class="op" id="6731087">==</span>&nbsp;<span class="ident" id="6731090">nil</span>&nbsp;<span class="op" id="6731094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731098">return</span>&nbsp;<span class="ident" id="6731105">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731115">buf</span>&nbsp;<span class="op" id="6731119">:=</span>&nbsp;<span class="builtinfunc" id="6731122">make</span><span class="op" id="6731126">(</span><span class="op" id="6731127">[</span><span class="op" id="6731128">]</span><span class="builtintype" id="6731129">byte</span><span class="op" id="6731133">,</span>&nbsp;<span class="num" id="6731135">6</span><span class="op" id="6731136">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731140">srv</span><span class="op" id="6731143">.</span><span class="ident" id="6731144">Write</span><span class="op" id="6731149">(</span><span class="op" id="6731150">[</span><span class="op" id="6731151">]</span><span class="builtintype" id="6731152">byte</span><span class="op" id="6731156">(</span><span class="string" id="6731157">&#34;foobar&#34;</span><span class="op" id="6731165">)</span><span class="op" id="6731166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731169">n</span><span class="op" id="6731170">,</span>&nbsp;<span class="ident" id="6731172">err</span>&nbsp;<span class="op" id="6731176">:=</span>&nbsp;<span class="ident" id="6731179">conn</span><span class="op" id="6731183">.</span><span class="ident" id="6731184">Read</span><span class="op" id="6731188">(</span><span class="ident" id="6731189">buf</span><span class="op" id="6731192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731195">if</span>&nbsp;<span class="ident" id="6731198">n</span>&nbsp;<span class="op" id="6731200">!=</span>&nbsp;<span class="num" id="6731203">6</span>&nbsp;<span class="op" id="6731205">||</span>&nbsp;<span class="ident" id="6731208">err</span>&nbsp;<span class="op" id="6731212">!=</span>&nbsp;<span class="ident" id="6731215">nil</span>&nbsp;<span class="op" id="6731219">||</span>&nbsp;<span class="builtintype" id="6731222">string</span><span class="op" id="6731228">(</span><span class="ident" id="6731229">buf</span><span class="op" id="6731232">)</span>&nbsp;<span class="op" id="6731234">!=</span>&nbsp;<span class="string" id="6731237">&#34;foobar&#34;</span>&nbsp;<span class="op" id="6731246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731250">return</span>&nbsp;<span class="ident" id="6731257">fmt</span><span class="op" id="6731260">.</span><span class="ident" id="6731261">Errorf</span><span class="op" id="6731267">(</span><span class="string" id="6731268">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="6731313">,</span>&nbsp;<span class="ident" id="6731315">n</span><span class="op" id="6731316">,</span>&nbsp;<span class="ident" id="6731318">err</span><span class="op" id="6731321">,</span>&nbsp;<span class="ident" id="6731323">buf</span><span class="op" id="6731326">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731333">srv</span><span class="op" id="6731336">.</span><span class="ident" id="6731337">Write</span><span class="op" id="6731342">(</span><span class="op" id="6731343">[</span><span class="op" id="6731344">]</span><span class="builtintype" id="6731345">byte</span><span class="op" id="6731349">(</span><span class="string" id="6731350">&#34;abcdef&#34;</span><span class="op" id="6731358">)</span><span class="op" id="6731359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731362">srv</span><span class="op" id="6731365">.</span><span class="ident" id="6731366">Close</span><span class="op" id="6731371">(</span><span class="op" id="6731372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731375">time</span><span class="op" id="6731379">.</span><span class="ident" id="6731380">Sleep</span><span class="op" id="6731385">(</span><span class="ident" id="6731386">delay</span><span class="op" id="6731391">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731394">n</span><span class="op" id="6731395">,</span>&nbsp;<span class="ident" id="6731397">err</span>&nbsp;<span class="op" id="6731401">=</span>&nbsp;<span class="ident" id="6731403">conn</span><span class="op" id="6731407">.</span><span class="ident" id="6731408">Read</span><span class="op" id="6731412">(</span><span class="ident" id="6731413">buf</span><span class="op" id="6731416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731419">if</span>&nbsp;<span class="ident" id="6731422">n</span>&nbsp;<span class="op" id="6731424">!=</span>&nbsp;<span class="num" id="6731427">6</span>&nbsp;<span class="op" id="6731429">||</span>&nbsp;<span class="builtintype" id="6731432">string</span><span class="op" id="6731438">(</span><span class="ident" id="6731439">buf</span><span class="op" id="6731442">)</span>&nbsp;<span class="op" id="6731444">!=</span>&nbsp;<span class="string" id="6731447">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="6731456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731460">return</span>&nbsp;<span class="ident" id="6731467">fmt</span><span class="op" id="6731470">.</span><span class="ident" id="6731471">Errorf</span><span class="op" id="6731477">(</span><span class="string" id="6731478">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="6731514">,</span>&nbsp;<span class="ident" id="6731516">n</span><span class="op" id="6731517">,</span>&nbsp;<span class="ident" id="6731519">buf</span><span class="op" id="6731522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731528">if</span>&nbsp;<span class="ident" id="6731531">err</span>&nbsp;<span class="op" id="6731535">!=</span>&nbsp;<span class="ident" id="6731538">io</span><span class="op" id="6731540">.</span><span class="ident" id="6731541">EOF</span>&nbsp;<span class="op" id="6731545">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731549">return</span>&nbsp;<span class="ident" id="6731556">fmt</span><span class="op" id="6731559">.</span><span class="ident" id="6731560">Errorf</span><span class="op" id="6731566">(</span><span class="string" id="6731567">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6731604">,</span>&nbsp;<span class="ident" id="6731606">err</span><span class="op" id="6731609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731615">return</span>&nbsp;<span class="ident" id="6731622">nil</span><br>
<span class="lineno"></span><span class="op" id="6731626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6731629">func</span>&nbsp;<span class="ident" id="6731634">TestTLSUniqueMatches</span><span class="op" id="6731654">(</span><span class="ident" id="6731655">t</span>&nbsp;<span class="op" id="6731657">*</span><span class="ident" id="6731658">testing</span><span class="op" id="6731665">.</span><span class="ident" id="6731666">T</span><span class="op" id="6731667">)</span>&nbsp;<span class="op" id="6731669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731672">ln</span>&nbsp;<span class="op" id="6731675">:=</span>&nbsp;<span class="ident" id="6731678">newLocalListener</span><span class="op" id="6731694">(</span><span class="ident" id="6731695">t</span><span class="op" id="6731696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731699">defer</span>&nbsp;<span class="ident" id="6731705">ln</span><span class="op" id="6731707">.</span><span class="ident" id="6731708">Close</span><span class="op" id="6731713">(</span><span class="op" id="6731714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731718">serverTLSUniques</span>&nbsp;<span class="op" id="6731735">:=</span>&nbsp;<span class="builtinfunc" id="6731738">make</span><span class="op" id="6731742">(</span><span class="keyword" id="6731743">chan</span>&nbsp;<span class="op" id="6731748">[</span><span class="op" id="6731749">]</span><span class="builtintype" id="6731750">byte</span><span class="op" id="6731754">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731757">go</span>&nbsp;<span class="keyword" id="6731760">func</span><span class="op" id="6731764">(</span><span class="op" id="6731765">)</span>&nbsp;<span class="op" id="6731767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731771">for</span>&nbsp;<span class="ident" id="6731775">i</span>&nbsp;<span class="op" id="6731777">:=</span>&nbsp;<span class="num" id="6731780">0</span><span class="op" id="6731781">;</span>&nbsp;<span class="ident" id="6731783">i</span>&nbsp;<span class="op" id="6731785">&lt;</span>&nbsp;<span class="num" id="6731787">2</span><span class="op" id="6731788">;</span>&nbsp;<span class="ident" id="6731790">i</span><span class="op" id="6731791">++</span>&nbsp;<span class="op" id="6731794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731799">sconn</span><span class="op" id="6731804">,</span>&nbsp;<span class="ident" id="6731806">err</span>&nbsp;<span class="op" id="6731810">:=</span>&nbsp;<span class="ident" id="6731813">ln</span><span class="op" id="6731815">.</span><span class="ident" id="6731816">Accept</span><span class="op" id="6731822">(</span><span class="op" id="6731823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731828">if</span>&nbsp;<span class="ident" id="6731831">err</span>&nbsp;<span class="op" id="6731835">!=</span>&nbsp;<span class="ident" id="6731838">nil</span>&nbsp;<span class="op" id="6731842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731848">t</span><span class="op" id="6731849">.</span><span class="ident" id="6731850">Fatal</span><span class="op" id="6731855">(</span><span class="ident" id="6731856">err</span><span class="op" id="6731859">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731869">serverConfig</span>&nbsp;<span class="op" id="6731882">:=</span>&nbsp;<span class="op" id="6731885">*</span><span class="ident" id="6731886">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731900">srv</span>&nbsp;<span class="op" id="6731904">:=</span>&nbsp;<span class="ident" id="6731907">Server</span><span class="op" id="6731913">(</span><span class="ident" id="6731914">sconn</span><span class="op" id="6731919">,</span>&nbsp;<span class="op" id="6731921">&amp;</span><span class="ident" id="6731922">serverConfig</span><span class="op" id="6731934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731939">if</span>&nbsp;<span class="ident" id="6731942">err</span>&nbsp;<span class="op" id="6731946">:=</span>&nbsp;<span class="ident" id="6731949">srv</span><span class="op" id="6731952">.</span><span class="ident" id="6731953">Handshake</span><span class="op" id="6731962">(</span><span class="op" id="6731963">)</span><span class="op" id="6731964">;</span>&nbsp;<span class="ident" id="6731966">err</span>&nbsp;<span class="op" id="6731970">!=</span>&nbsp;<span class="ident" id="6731973">nil</span>&nbsp;<span class="op" id="6731977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731983">t</span><span class="op" id="6731984">.</span><span class="ident" id="6731985">Fatal</span><span class="op" id="6731990">(</span><span class="ident" id="6731991">err</span><span class="op" id="6731994">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732004">serverTLSUniques</span>&nbsp;<span class="op" id="6732021">&lt;-</span>&nbsp;<span class="ident" id="6732024">srv</span><span class="op" id="6732027">.</span><span class="ident" id="6732028">ConnectionState</span><span class="op" id="6732043">(</span><span class="op" id="6732044">)</span><span class="op" id="6732045">.</span><span class="ident" id="6732046">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732061">}</span><span class="op" id="6732062">(</span><span class="op" id="6732063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732067">clientConfig</span>&nbsp;<span class="op" id="6732080">:=</span>&nbsp;<span class="op" id="6732083">*</span><span class="ident" id="6732084">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732096">clientConfig</span><span class="op" id="6732108">.</span><span class="ident" id="6732109">ClientSessionCache</span>&nbsp;<span class="op" id="6732128">=</span>&nbsp;<span class="ident" id="6732130">NewLRUClientSessionCache</span><span class="op" id="6732154">(</span><span class="num" id="6732155">1</span><span class="op" id="6732156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732159">conn</span><span class="op" id="6732163">,</span>&nbsp;<span class="ident" id="6732165">err</span>&nbsp;<span class="op" id="6732169">:=</span>&nbsp;<span class="ident" id="6732172">Dial</span><span class="op" id="6732176">(</span><span class="string" id="6732177">&#34;tcp&#34;</span><span class="op" id="6732182">,</span>&nbsp;<span class="ident" id="6732184">ln</span><span class="op" id="6732186">.</span><span class="ident" id="6732187">Addr</span><span class="op" id="6732191">(</span><span class="op" id="6732192">)</span><span class="op" id="6732193">.</span><span class="ident" id="6732194">String</span><span class="op" id="6732200">(</span><span class="op" id="6732201">)</span><span class="op" id="6732202">,</span>&nbsp;<span class="op" id="6732204">&amp;</span><span class="ident" id="6732205">clientConfig</span><span class="op" id="6732217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732220">if</span>&nbsp;<span class="ident" id="6732223">err</span>&nbsp;<span class="op" id="6732227">!=</span>&nbsp;<span class="ident" id="6732230">nil</span>&nbsp;<span class="op" id="6732234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732238">t</span><span class="op" id="6732239">.</span><span class="ident" id="6732240">Fatal</span><span class="op" id="6732245">(</span><span class="ident" id="6732246">err</span><span class="op" id="6732249">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732255">if</span>&nbsp;<span class="op" id="6732258">!</span><span class="ident" id="6732259">bytes</span><span class="op" id="6732264">.</span><span class="ident" id="6732265">Equal</span><span class="op" id="6732270">(</span><span class="ident" id="6732271">conn</span><span class="op" id="6732275">.</span><span class="ident" id="6732276">ConnectionState</span><span class="op" id="6732291">(</span><span class="op" id="6732292">)</span><span class="op" id="6732293">.</span><span class="ident" id="6732294">TLSUnique</span><span class="op" id="6732303">,</span>&nbsp;<span class="op" id="6732305">&lt;-</span><span class="ident" id="6732307">serverTLSUniques</span><span class="op" id="6732323">)</span>&nbsp;<span class="op" id="6732325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732329">t</span><span class="op" id="6732330">.</span><span class="ident" id="6732331">Error</span><span class="op" id="6732336">(</span><span class="string" id="6732337">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="6732380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732386">conn</span><span class="op" id="6732390">.</span><span class="ident" id="6732391">Close</span><span class="op" id="6732396">(</span><span class="op" id="6732397">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732401">conn</span><span class="op" id="6732405">,</span>&nbsp;<span class="ident" id="6732407">err</span>&nbsp;<span class="op" id="6732411">=</span>&nbsp;<span class="ident" id="6732413">Dial</span><span class="op" id="6732417">(</span><span class="string" id="6732418">&#34;tcp&#34;</span><span class="op" id="6732423">,</span>&nbsp;<span class="ident" id="6732425">ln</span><span class="op" id="6732427">.</span><span class="ident" id="6732428">Addr</span><span class="op" id="6732432">(</span><span class="op" id="6732433">)</span><span class="op" id="6732434">.</span><span class="ident" id="6732435">String</span><span class="op" id="6732441">(</span><span class="op" id="6732442">)</span><span class="op" id="6732443">,</span>&nbsp;<span class="op" id="6732445">&amp;</span><span class="ident" id="6732446">clientConfig</span><span class="op" id="6732458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732461">if</span>&nbsp;<span class="ident" id="6732464">err</span>&nbsp;<span class="op" id="6732468">!=</span>&nbsp;<span class="ident" id="6732471">nil</span>&nbsp;<span class="op" id="6732475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732479">t</span><span class="op" id="6732480">.</span><span class="ident" id="6732481">Fatal</span><span class="op" id="6732486">(</span><span class="ident" id="6732487">err</span><span class="op" id="6732490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732493">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732496">defer</span>&nbsp;<span class="ident" id="6732502">conn</span><span class="op" id="6732506">.</span><span class="ident" id="6732507">Close</span><span class="op" id="6732512">(</span><span class="op" id="6732513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732516">if</span>&nbsp;<span class="op" id="6732519">!</span><span class="ident" id="6732520">conn</span><span class="op" id="6732524">.</span><span class="ident" id="6732525">ConnectionState</span><span class="op" id="6732540">(</span><span class="op" id="6732541">)</span><span class="op" id="6732542">.</span><span class="ident" id="6732543">DidResume</span>&nbsp;<span class="op" id="6732553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732557">t</span><span class="op" id="6732558">.</span><span class="ident" id="6732559">Error</span><span class="op" id="6732564">(</span><span class="string" id="6732565">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="6732604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732610">if</span>&nbsp;<span class="op" id="6732613">!</span><span class="ident" id="6732614">bytes</span><span class="op" id="6732619">.</span><span class="ident" id="6732620">Equal</span><span class="op" id="6732625">(</span><span class="ident" id="6732626">conn</span><span class="op" id="6732630">.</span><span class="ident" id="6732631">ConnectionState</span><span class="op" id="6732646">(</span><span class="op" id="6732647">)</span><span class="op" id="6732648">.</span><span class="ident" id="6732649">TLSUnique</span><span class="op" id="6732658">,</span>&nbsp;<span class="op" id="6732660">&lt;-</span><span class="ident" id="6732662">serverTLSUniques</span><span class="op" id="6732678">)</span>&nbsp;<span class="op" id="6732680">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732684">t</span><span class="op" id="6732685">.</span><span class="ident" id="6732686">Error</span><span class="op" id="6732691">(</span><span class="string" id="6732692">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="6732767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732770">}</span><br>
<span class="lineno"></span><span class="op" id="6732772">}</span>
</div>
</body>
</html>
