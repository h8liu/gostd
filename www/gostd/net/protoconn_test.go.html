<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html" class="current">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6526303">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6526359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6526413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6526464">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="6526543">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6526552">package</span>&nbsp;<span class="ident" id="6526560">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6526565">import</span>&nbsp;<span class="op" id="6526572">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6526575">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6526588">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6526594">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6526605">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6526616">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6526623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6526626">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6526696">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="6526764">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="6526786">func</span>&nbsp;<span class="ident" id="6526791">testUnixAddr</span><span class="op" id="6526803">(</span><span class="op" id="6526804">)</span>&nbsp;<span class="builtintype" id="6526806">string</span>&nbsp;<span class="op" id="6526813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526816">f</span><span class="op" id="6526817">,</span>&nbsp;<span class="ident" id="6526819">err</span>&nbsp;<span class="op" id="6526823">:=</span>&nbsp;<span class="ident" id="6526826">ioutil</span><span class="op" id="6526832">.</span><span class="ident" id="6526833">TempFile</span><span class="op" id="6526841">(</span><span class="string" id="6526842">&#34;&#34;</span><span class="op" id="6526844">,</span>&nbsp;<span class="string" id="6526846">&#34;nettest&#34;</span><span class="op" id="6526855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526858">if</span>&nbsp;<span class="ident" id="6526861">err</span>&nbsp;<span class="op" id="6526865">!=</span>&nbsp;<span class="builtintype" id="6526868">nil</span>&nbsp;<span class="op" id="6526872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6526876">panic</span><span class="op" id="6526881">(</span><span class="ident" id="6526882">err</span><span class="op" id="6526885">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526891">addr</span>&nbsp;<span class="op" id="6526896">:=</span>&nbsp;<span class="ident" id="6526899">f</span><span class="op" id="6526900">.</span><span class="ident" id="6526901">Name</span><span class="op" id="6526905">(</span><span class="op" id="6526906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526909">f</span><span class="op" id="6526910">.</span><span class="ident" id="6526911">Close</span><span class="op" id="6526916">(</span><span class="op" id="6526917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526920">os</span><span class="op" id="6526922">.</span><span class="ident" id="6526923">Remove</span><span class="op" id="6526929">(</span><span class="ident" id="6526930">addr</span><span class="op" id="6526934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526937">return</span>&nbsp;<span class="ident" id="6526944">addr</span><br>
<span class="lineno">30</span><span class="op" id="6526949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6526952">var</span>&nbsp;<span class="ident" id="6526956">condFatalf</span>&nbsp;<span class="op" id="6526967">=</span>&nbsp;<span class="keyword" id="6526969">func</span><span class="op" id="6526973">(</span><span class="op" id="6526974">)</span>&nbsp;<span class="keyword" id="6526976">func</span><span class="op" id="6526980">(</span><span class="op" id="6526981">*</span><span class="ident" id="6526982">testing</span><span class="op" id="6526989">.</span><span class="ident" id="6526990">T</span><span class="op" id="6526991">,</span>&nbsp;<span class="builtintype" id="6526993">string</span><span class="op" id="6526999">,</span>&nbsp;<span class="op" id="6527001">...</span><span class="keyword" id="6527004">interface</span><span class="op" id="6527013">{</span><span class="op" id="6527014">}</span><span class="op" id="6527015">)</span>&nbsp;<span class="op" id="6527017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6527020">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527087">switch</span>&nbsp;<span class="ident" id="6527094">runtime</span><span class="op" id="6527101">.</span><span class="ident" id="6527102">GOOS</span>&nbsp;<span class="op" id="6527107">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527110">case</span>&nbsp;<span class="string" id="6527115">&#34;plan9&#34;</span><span class="op" id="6527122">,</span>&nbsp;<span class="string" id="6527124">&#34;windows&#34;</span><span class="op" id="6527133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527137">return</span>&nbsp;<span class="op" id="6527144">(</span><span class="op" id="6527145">*</span><span class="ident" id="6527146">testing</span><span class="op" id="6527153">.</span><span class="ident" id="6527154">T</span><span class="op" id="6527155">)</span><span class="op" id="6527156">.</span><span class="ident" id="6527157">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527166">return</span>&nbsp;<span class="op" id="6527173">(</span><span class="op" id="6527174">*</span><span class="ident" id="6527175">testing</span><span class="op" id="6527182">.</span><span class="ident" id="6527183">T</span><span class="op" id="6527184">)</span><span class="op" id="6527185">.</span><span class="ident" id="6527186">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="6527193">}</span><span class="op" id="6527194">(</span><span class="op" id="6527195">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6527198">func</span>&nbsp;<span class="ident" id="6527203">TestTCPListenerSpecificMethods</span><span class="op" id="6527233">(</span><span class="ident" id="6527234">t</span>&nbsp;<span class="op" id="6527236">*</span><span class="ident" id="6527237">testing</span><span class="op" id="6527244">.</span><span class="ident" id="6527245">T</span><span class="op" id="6527246">)</span>&nbsp;<span class="op" id="6527248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527251">switch</span>&nbsp;<span class="ident" id="6527258">runtime</span><span class="op" id="6527265">.</span><span class="ident" id="6527266">GOOS</span>&nbsp;<span class="op" id="6527271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527274">case</span>&nbsp;<span class="string" id="6527279">&#34;plan9&#34;</span><span class="op" id="6527286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527290">t</span><span class="op" id="6527291">.</span><span class="ident" id="6527292">Skipf</span><span class="op" id="6527297">(</span><span class="string" id="6527298">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6527319">,</span>&nbsp;<span class="ident" id="6527321">runtime</span><span class="op" id="6527328">.</span><span class="ident" id="6527329">GOOS</span><span class="op" id="6527333">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527340">la</span><span class="op" id="6527342">,</span>&nbsp;<span class="ident" id="6527344">err</span>&nbsp;<span class="op" id="6527348">:=</span>&nbsp;<span class="ident" id="6527351">ResolveTCPAddr</span><span class="op" id="6527365">(</span><span class="string" id="6527366">&#34;tcp4&#34;</span><span class="op" id="6527372">,</span>&nbsp;<span class="string" id="6527374">&#34;127.0.0.1:0&#34;</span><span class="op" id="6527387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527390">if</span>&nbsp;<span class="ident" id="6527393">err</span>&nbsp;<span class="op" id="6527397">!=</span>&nbsp;<span class="builtintype" id="6527400">nil</span>&nbsp;<span class="op" id="6527404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527408">t</span><span class="op" id="6527409">.</span><span class="ident" id="6527410">Fatalf</span><span class="op" id="6527416">(</span><span class="string" id="6527417">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6527444">,</span>&nbsp;<span class="ident" id="6527446">err</span><span class="op" id="6527449">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527455">ln</span><span class="op" id="6527457">,</span>&nbsp;<span class="ident" id="6527459">err</span>&nbsp;<span class="op" id="6527463">:=</span>&nbsp;<span class="ident" id="6527466">ListenTCP</span><span class="op" id="6527475">(</span><span class="string" id="6527476">&#34;tcp4&#34;</span><span class="op" id="6527482">,</span>&nbsp;<span class="ident" id="6527484">la</span><span class="op" id="6527486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527489">if</span>&nbsp;<span class="ident" id="6527492">err</span>&nbsp;<span class="op" id="6527496">!=</span>&nbsp;<span class="builtintype" id="6527499">nil</span>&nbsp;<span class="op" id="6527503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527507">t</span><span class="op" id="6527508">.</span><span class="ident" id="6527509">Fatalf</span><span class="op" id="6527515">(</span><span class="string" id="6527516">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6527538">,</span>&nbsp;<span class="ident" id="6527540">err</span><span class="op" id="6527543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527546">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527549">defer</span>&nbsp;<span class="ident" id="6527555">ln</span><span class="op" id="6527557">.</span><span class="ident" id="6527558">Close</span><span class="op" id="6527563">(</span><span class="op" id="6527564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527567">ln</span><span class="op" id="6527569">.</span><span class="ident" id="6527570">Addr</span><span class="op" id="6527574">(</span><span class="op" id="6527575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527578">ln</span><span class="op" id="6527580">.</span><span class="ident" id="6527581">SetDeadline</span><span class="op" id="6527592">(</span><span class="ident" id="6527593">time</span><span class="op" id="6527597">.</span><span class="ident" id="6527598">Now</span><span class="op" id="6527601">(</span><span class="op" id="6527602">)</span><span class="op" id="6527603">.</span><span class="ident" id="6527604">Add</span><span class="op" id="6527607">(</span><span class="num" id="6527608">30</span>&nbsp;<span class="op" id="6527611">*</span>&nbsp;<span class="ident" id="6527613">time</span><span class="op" id="6527617">.</span><span class="ident" id="6527618">Nanosecond</span><span class="op" id="6527628">)</span><span class="op" id="6527629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527633">if</span>&nbsp;<span class="ident" id="6527636">c</span><span class="op" id="6527637">,</span>&nbsp;<span class="ident" id="6527639">err</span>&nbsp;<span class="op" id="6527643">:=</span>&nbsp;<span class="ident" id="6527646">ln</span><span class="op" id="6527648">.</span><span class="ident" id="6527649">Accept</span><span class="op" id="6527655">(</span><span class="op" id="6527656">)</span><span class="op" id="6527657">;</span>&nbsp;<span class="ident" id="6527659">err</span>&nbsp;<span class="op" id="6527663">!=</span>&nbsp;<span class="builtintype" id="6527666">nil</span>&nbsp;<span class="op" id="6527670">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527674">if</span>&nbsp;<span class="op" id="6527677">!</span><span class="ident" id="6527678">err</span><span class="op" id="6527681">.</span><span class="op" id="6527682">(</span><span class="ident" id="6527683">Error</span><span class="op" id="6527688">)</span><span class="op" id="6527689">.</span><span class="ident" id="6527690">Timeout</span><span class="op" id="6527697">(</span><span class="op" id="6527698">)</span>&nbsp;<span class="op" id="6527700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527705">t</span><span class="op" id="6527706">.</span><span class="ident" id="6527707">Fatalf</span><span class="op" id="6527713">(</span><span class="string" id="6527714">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6527745">,</span>&nbsp;<span class="ident" id="6527747">err</span><span class="op" id="6527750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527757">}</span>&nbsp;<span class="keyword" id="6527759">else</span>&nbsp;<span class="op" id="6527764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527768">c</span><span class="op" id="6527769">.</span><span class="ident" id="6527770">Close</span><span class="op" id="6527775">(</span><span class="op" id="6527776">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527782">if</span>&nbsp;<span class="ident" id="6527785">c</span><span class="op" id="6527786">,</span>&nbsp;<span class="ident" id="6527788">err</span>&nbsp;<span class="op" id="6527792">:=</span>&nbsp;<span class="ident" id="6527795">ln</span><span class="op" id="6527797">.</span><span class="ident" id="6527798">AcceptTCP</span><span class="op" id="6527807">(</span><span class="op" id="6527808">)</span><span class="op" id="6527809">;</span>&nbsp;<span class="ident" id="6527811">err</span>&nbsp;<span class="op" id="6527815">!=</span>&nbsp;<span class="builtintype" id="6527818">nil</span>&nbsp;<span class="op" id="6527822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527826">if</span>&nbsp;<span class="op" id="6527829">!</span><span class="ident" id="6527830">err</span><span class="op" id="6527833">.</span><span class="op" id="6527834">(</span><span class="ident" id="6527835">Error</span><span class="op" id="6527840">)</span><span class="op" id="6527841">.</span><span class="ident" id="6527842">Timeout</span><span class="op" id="6527849">(</span><span class="op" id="6527850">)</span>&nbsp;<span class="op" id="6527852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527857">t</span><span class="op" id="6527858">.</span><span class="ident" id="6527859">Fatalf</span><span class="op" id="6527865">(</span><span class="string" id="6527866">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6527900">,</span>&nbsp;<span class="ident" id="6527902">err</span><span class="op" id="6527905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527909">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527912">}</span>&nbsp;<span class="keyword" id="6527914">else</span>&nbsp;<span class="op" id="6527919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527923">c</span><span class="op" id="6527924">.</span><span class="ident" id="6527925">Close</span><span class="op" id="6527930">(</span><span class="op" id="6527931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527938">if</span>&nbsp;<span class="ident" id="6527941">f</span><span class="op" id="6527942">,</span>&nbsp;<span class="ident" id="6527944">err</span>&nbsp;<span class="op" id="6527948">:=</span>&nbsp;<span class="ident" id="6527951">ln</span><span class="op" id="6527953">.</span><span class="ident" id="6527954">File</span><span class="op" id="6527958">(</span><span class="op" id="6527959">)</span><span class="op" id="6527960">;</span>&nbsp;<span class="ident" id="6527962">err</span>&nbsp;<span class="op" id="6527966">!=</span>&nbsp;<span class="builtintype" id="6527969">nil</span>&nbsp;<span class="op" id="6527973">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527977">condFatalf</span><span class="op" id="6527987">(</span><span class="ident" id="6527988">t</span><span class="op" id="6527989">,</span>&nbsp;<span class="string" id="6527991">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6528020">,</span>&nbsp;<span class="ident" id="6528022">err</span><span class="op" id="6528025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528028">}</span>&nbsp;<span class="keyword" id="6528030">else</span>&nbsp;<span class="op" id="6528035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528039">f</span><span class="op" id="6528040">.</span><span class="ident" id="6528041">Close</span><span class="op" id="6528046">(</span><span class="op" id="6528047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528050">}</span><br>
<span class="lineno"></span><span class="op" id="6528052">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6528055">func</span>&nbsp;<span class="ident" id="6528060">TestTCPConnSpecificMethods</span><span class="op" id="6528086">(</span><span class="ident" id="6528087">t</span>&nbsp;<span class="op" id="6528089">*</span><span class="ident" id="6528090">testing</span><span class="op" id="6528097">.</span><span class="ident" id="6528098">T</span><span class="op" id="6528099">)</span>&nbsp;<span class="op" id="6528101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528104">la</span><span class="op" id="6528106">,</span>&nbsp;<span class="ident" id="6528108">err</span>&nbsp;<span class="op" id="6528112">:=</span>&nbsp;<span class="ident" id="6528115">ResolveTCPAddr</span><span class="op" id="6528129">(</span><span class="string" id="6528130">&#34;tcp4&#34;</span><span class="op" id="6528136">,</span>&nbsp;<span class="string" id="6528138">&#34;127.0.0.1:0&#34;</span><span class="op" id="6528151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528154">if</span>&nbsp;<span class="ident" id="6528157">err</span>&nbsp;<span class="op" id="6528161">!=</span>&nbsp;<span class="builtintype" id="6528164">nil</span>&nbsp;<span class="op" id="6528168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528172">t</span><span class="op" id="6528173">.</span><span class="ident" id="6528174">Fatalf</span><span class="op" id="6528180">(</span><span class="string" id="6528181">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6528208">,</span>&nbsp;<span class="ident" id="6528210">err</span><span class="op" id="6528213">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528219">ln</span><span class="op" id="6528221">,</span>&nbsp;<span class="ident" id="6528223">err</span>&nbsp;<span class="op" id="6528227">:=</span>&nbsp;<span class="ident" id="6528230">ListenTCP</span><span class="op" id="6528239">(</span><span class="string" id="6528240">&#34;tcp4&#34;</span><span class="op" id="6528246">,</span>&nbsp;<span class="ident" id="6528248">la</span><span class="op" id="6528250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528253">if</span>&nbsp;<span class="ident" id="6528256">err</span>&nbsp;<span class="op" id="6528260">!=</span>&nbsp;<span class="builtintype" id="6528263">nil</span>&nbsp;<span class="op" id="6528267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528271">t</span><span class="op" id="6528272">.</span><span class="ident" id="6528273">Fatalf</span><span class="op" id="6528279">(</span><span class="string" id="6528280">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6528302">,</span>&nbsp;<span class="ident" id="6528304">err</span><span class="op" id="6528307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528310">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528313">defer</span>&nbsp;<span class="ident" id="6528319">ln</span><span class="op" id="6528321">.</span><span class="ident" id="6528322">Close</span><span class="op" id="6528327">(</span><span class="op" id="6528328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528331">ln</span><span class="op" id="6528333">.</span><span class="ident" id="6528334">Addr</span><span class="op" id="6528338">(</span><span class="op" id="6528339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528343">done</span>&nbsp;<span class="op" id="6528348">:=</span>&nbsp;<span class="builtinfunc" id="6528351">make</span><span class="op" id="6528355">(</span><span class="keyword" id="6528356">chan</span>&nbsp;<span class="builtintype" id="6528361">int</span><span class="op" id="6528364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528367">go</span>&nbsp;<span class="ident" id="6528370">transponder</span><span class="op" id="6528381">(</span><span class="ident" id="6528382">t</span><span class="op" id="6528383">,</span>&nbsp;<span class="ident" id="6528385">ln</span><span class="op" id="6528387">,</span>&nbsp;<span class="ident" id="6528389">done</span><span class="op" id="6528393">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528397">ra</span><span class="op" id="6528399">,</span>&nbsp;<span class="ident" id="6528401">err</span>&nbsp;<span class="op" id="6528405">:=</span>&nbsp;<span class="ident" id="6528408">ResolveTCPAddr</span><span class="op" id="6528422">(</span><span class="string" id="6528423">&#34;tcp4&#34;</span><span class="op" id="6528429">,</span>&nbsp;<span class="ident" id="6528431">ln</span><span class="op" id="6528433">.</span><span class="ident" id="6528434">Addr</span><span class="op" id="6528438">(</span><span class="op" id="6528439">)</span><span class="op" id="6528440">.</span><span class="ident" id="6528441">String</span><span class="op" id="6528447">(</span><span class="op" id="6528448">)</span><span class="op" id="6528449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528452">if</span>&nbsp;<span class="ident" id="6528455">err</span>&nbsp;<span class="op" id="6528459">!=</span>&nbsp;<span class="builtintype" id="6528462">nil</span>&nbsp;<span class="op" id="6528466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528470">t</span><span class="op" id="6528471">.</span><span class="ident" id="6528472">Fatalf</span><span class="op" id="6528478">(</span><span class="string" id="6528479">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6528506">,</span>&nbsp;<span class="ident" id="6528508">err</span><span class="op" id="6528511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528514">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528517">c</span><span class="op" id="6528518">,</span>&nbsp;<span class="ident" id="6528520">err</span>&nbsp;<span class="op" id="6528524">:=</span>&nbsp;<span class="ident" id="6528527">DialTCP</span><span class="op" id="6528534">(</span><span class="string" id="6528535">&#34;tcp4&#34;</span><span class="op" id="6528541">,</span>&nbsp;<span class="builtintype" id="6528543">nil</span><span class="op" id="6528546">,</span>&nbsp;<span class="ident" id="6528548">ra</span><span class="op" id="6528550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528553">if</span>&nbsp;<span class="ident" id="6528556">err</span>&nbsp;<span class="op" id="6528560">!=</span>&nbsp;<span class="builtintype" id="6528563">nil</span>&nbsp;<span class="op" id="6528567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528571">t</span><span class="op" id="6528572">.</span><span class="ident" id="6528573">Fatalf</span><span class="op" id="6528579">(</span><span class="string" id="6528580">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6528600">,</span>&nbsp;<span class="ident" id="6528602">err</span><span class="op" id="6528605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528611">defer</span>&nbsp;<span class="ident" id="6528617">c</span><span class="op" id="6528618">.</span><span class="ident" id="6528619">Close</span><span class="op" id="6528624">(</span><span class="op" id="6528625">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528628">c</span><span class="op" id="6528629">.</span><span class="ident" id="6528630">SetKeepAlive</span><span class="op" id="6528642">(</span><span class="builtintype" id="6528643">false</span><span class="op" id="6528648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528651">c</span><span class="op" id="6528652">.</span><span class="ident" id="6528653">SetKeepAlivePeriod</span><span class="op" id="6528671">(</span><span class="num" id="6528672">3</span>&nbsp;<span class="op" id="6528674">*</span>&nbsp;<span class="ident" id="6528676">time</span><span class="op" id="6528680">.</span><span class="ident" id="6528681">Second</span><span class="op" id="6528687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528690">c</span><span class="op" id="6528691">.</span><span class="ident" id="6528692">SetLinger</span><span class="op" id="6528701">(</span><span class="num" id="6528702">0</span><span class="op" id="6528703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528706">c</span><span class="op" id="6528707">.</span><span class="ident" id="6528708">SetNoDelay</span><span class="op" id="6528718">(</span><span class="builtintype" id="6528719">false</span><span class="op" id="6528724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528727">c</span><span class="op" id="6528728">.</span><span class="ident" id="6528729">LocalAddr</span><span class="op" id="6528738">(</span><span class="op" id="6528739">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528742">c</span><span class="op" id="6528743">.</span><span class="ident" id="6528744">RemoteAddr</span><span class="op" id="6528754">(</span><span class="op" id="6528755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528758">c</span><span class="op" id="6528759">.</span><span class="ident" id="6528760">SetDeadline</span><span class="op" id="6528771">(</span><span class="ident" id="6528772">time</span><span class="op" id="6528776">.</span><span class="ident" id="6528777">Now</span><span class="op" id="6528780">(</span><span class="op" id="6528781">)</span><span class="op" id="6528782">.</span><span class="ident" id="6528783">Add</span><span class="op" id="6528786">(</span><span class="ident" id="6528787">someTimeout</span><span class="op" id="6528798">)</span><span class="op" id="6528799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528802">c</span><span class="op" id="6528803">.</span><span class="ident" id="6528804">SetReadDeadline</span><span class="op" id="6528819">(</span><span class="ident" id="6528820">time</span><span class="op" id="6528824">.</span><span class="ident" id="6528825">Now</span><span class="op" id="6528828">(</span><span class="op" id="6528829">)</span><span class="op" id="6528830">.</span><span class="ident" id="6528831">Add</span><span class="op" id="6528834">(</span><span class="ident" id="6528835">someTimeout</span><span class="op" id="6528846">)</span><span class="op" id="6528847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528850">c</span><span class="op" id="6528851">.</span><span class="ident" id="6528852">SetWriteDeadline</span><span class="op" id="6528868">(</span><span class="ident" id="6528869">time</span><span class="op" id="6528873">.</span><span class="ident" id="6528874">Now</span><span class="op" id="6528877">(</span><span class="op" id="6528878">)</span><span class="op" id="6528879">.</span><span class="ident" id="6528880">Add</span><span class="op" id="6528883">(</span><span class="ident" id="6528884">someTimeout</span><span class="op" id="6528895">)</span><span class="op" id="6528896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6528900">if</span>&nbsp;<span class="ident" id="6528903">_</span><span class="op" id="6528904">,</span>&nbsp;<span class="ident" id="6528906">err</span>&nbsp;<span class="op" id="6528910">:=</span>&nbsp;<span class="ident" id="6528913">c</span><span class="op" id="6528914">.</span><span class="ident" id="6528915">Write</span><span class="op" id="6528920">(</span><span class="op" id="6528921">[</span><span class="op" id="6528922">]</span><span class="builtintype" id="6528923">byte</span><span class="op" id="6528927">(</span><span class="string" id="6528928">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="6528942">)</span><span class="op" id="6528943">)</span><span class="op" id="6528944">;</span>&nbsp;<span class="ident" id="6528946">err</span>&nbsp;<span class="op" id="6528950">!=</span>&nbsp;<span class="builtintype" id="6528953">nil</span>&nbsp;<span class="op" id="6528957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528961">t</span><span class="op" id="6528962">.</span><span class="ident" id="6528963">Fatalf</span><span class="op" id="6528969">(</span><span class="string" id="6528970">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6528996">,</span>&nbsp;<span class="ident" id="6528998">err</span><span class="op" id="6529001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529007">rb</span>&nbsp;<span class="op" id="6529010">:=</span>&nbsp;<span class="builtinfunc" id="6529013">make</span><span class="op" id="6529017">(</span><span class="op" id="6529018">[</span><span class="op" id="6529019">]</span><span class="builtintype" id="6529020">byte</span><span class="op" id="6529024">,</span>&nbsp;<span class="num" id="6529026">128</span><span class="op" id="6529029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529032">if</span>&nbsp;<span class="ident" id="6529035">_</span><span class="op" id="6529036">,</span>&nbsp;<span class="ident" id="6529038">err</span>&nbsp;<span class="op" id="6529042">:=</span>&nbsp;<span class="ident" id="6529045">c</span><span class="op" id="6529046">.</span><span class="ident" id="6529047">Read</span><span class="op" id="6529051">(</span><span class="ident" id="6529052">rb</span><span class="op" id="6529054">)</span><span class="op" id="6529055">;</span>&nbsp;<span class="ident" id="6529057">err</span>&nbsp;<span class="op" id="6529061">!=</span>&nbsp;<span class="builtintype" id="6529064">nil</span>&nbsp;<span class="op" id="6529068">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529072">t</span><span class="op" id="6529073">.</span><span class="ident" id="6529074">Fatalf</span><span class="op" id="6529080">(</span><span class="string" id="6529081">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529106">,</span>&nbsp;<span class="ident" id="6529108">err</span><span class="op" id="6529111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529118">&lt;-</span><span class="ident" id="6529120">done</span><br>
<span class="lineno"></span><span class="op" id="6529125">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6529128">func</span>&nbsp;<span class="ident" id="6529133">TestUDPConnSpecificMethods</span><span class="op" id="6529159">(</span><span class="ident" id="6529160">t</span>&nbsp;<span class="op" id="6529162">*</span><span class="ident" id="6529163">testing</span><span class="op" id="6529170">.</span><span class="ident" id="6529171">T</span><span class="op" id="6529172">)</span>&nbsp;<span class="op" id="6529174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529177">la</span><span class="op" id="6529179">,</span>&nbsp;<span class="ident" id="6529181">err</span>&nbsp;<span class="op" id="6529185">:=</span>&nbsp;<span class="ident" id="6529188">ResolveUDPAddr</span><span class="op" id="6529202">(</span><span class="string" id="6529203">&#34;udp4&#34;</span><span class="op" id="6529209">,</span>&nbsp;<span class="string" id="6529211">&#34;127.0.0.1:0&#34;</span><span class="op" id="6529224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529227">if</span>&nbsp;<span class="ident" id="6529230">err</span>&nbsp;<span class="op" id="6529234">!=</span>&nbsp;<span class="builtintype" id="6529237">nil</span>&nbsp;<span class="op" id="6529241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529245">t</span><span class="op" id="6529246">.</span><span class="ident" id="6529247">Fatalf</span><span class="op" id="6529253">(</span><span class="string" id="6529254">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529281">,</span>&nbsp;<span class="ident" id="6529283">err</span><span class="op" id="6529286">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529292">c</span><span class="op" id="6529293">,</span>&nbsp;<span class="ident" id="6529295">err</span>&nbsp;<span class="op" id="6529299">:=</span>&nbsp;<span class="ident" id="6529302">ListenUDP</span><span class="op" id="6529311">(</span><span class="string" id="6529312">&#34;udp4&#34;</span><span class="op" id="6529318">,</span>&nbsp;<span class="ident" id="6529320">la</span><span class="op" id="6529322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529325">if</span>&nbsp;<span class="ident" id="6529328">err</span>&nbsp;<span class="op" id="6529332">!=</span>&nbsp;<span class="builtintype" id="6529335">nil</span>&nbsp;<span class="op" id="6529339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529343">t</span><span class="op" id="6529344">.</span><span class="ident" id="6529345">Fatalf</span><span class="op" id="6529351">(</span><span class="string" id="6529352">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529374">,</span>&nbsp;<span class="ident" id="6529376">err</span><span class="op" id="6529379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529382">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529385">defer</span>&nbsp;<span class="ident" id="6529391">c</span><span class="op" id="6529392">.</span><span class="ident" id="6529393">Close</span><span class="op" id="6529398">(</span><span class="op" id="6529399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529402">c</span><span class="op" id="6529403">.</span><span class="ident" id="6529404">LocalAddr</span><span class="op" id="6529413">(</span><span class="op" id="6529414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529417">c</span><span class="op" id="6529418">.</span><span class="ident" id="6529419">RemoteAddr</span><span class="op" id="6529429">(</span><span class="op" id="6529430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529433">c</span><span class="op" id="6529434">.</span><span class="ident" id="6529435">SetDeadline</span><span class="op" id="6529446">(</span><span class="ident" id="6529447">time</span><span class="op" id="6529451">.</span><span class="ident" id="6529452">Now</span><span class="op" id="6529455">(</span><span class="op" id="6529456">)</span><span class="op" id="6529457">.</span><span class="ident" id="6529458">Add</span><span class="op" id="6529461">(</span><span class="ident" id="6529462">someTimeout</span><span class="op" id="6529473">)</span><span class="op" id="6529474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529477">c</span><span class="op" id="6529478">.</span><span class="ident" id="6529479">SetReadDeadline</span><span class="op" id="6529494">(</span><span class="ident" id="6529495">time</span><span class="op" id="6529499">.</span><span class="ident" id="6529500">Now</span><span class="op" id="6529503">(</span><span class="op" id="6529504">)</span><span class="op" id="6529505">.</span><span class="ident" id="6529506">Add</span><span class="op" id="6529509">(</span><span class="ident" id="6529510">someTimeout</span><span class="op" id="6529521">)</span><span class="op" id="6529522">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529525">c</span><span class="op" id="6529526">.</span><span class="ident" id="6529527">SetWriteDeadline</span><span class="op" id="6529543">(</span><span class="ident" id="6529544">time</span><span class="op" id="6529548">.</span><span class="ident" id="6529549">Now</span><span class="op" id="6529552">(</span><span class="op" id="6529553">)</span><span class="op" id="6529554">.</span><span class="ident" id="6529555">Add</span><span class="op" id="6529558">(</span><span class="ident" id="6529559">someTimeout</span><span class="op" id="6529570">)</span><span class="op" id="6529571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529574">c</span><span class="op" id="6529575">.</span><span class="ident" id="6529576">SetReadBuffer</span><span class="op" id="6529589">(</span><span class="num" id="6529590">2048</span><span class="op" id="6529594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529597">c</span><span class="op" id="6529598">.</span><span class="ident" id="6529599">SetWriteBuffer</span><span class="op" id="6529613">(</span><span class="num" id="6529614">2048</span><span class="op" id="6529618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529622">wb</span>&nbsp;<span class="op" id="6529625">:=</span>&nbsp;<span class="op" id="6529628">[</span><span class="op" id="6529629">]</span><span class="builtintype" id="6529630">byte</span><span class="op" id="6529634">(</span><span class="string" id="6529635">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="6529649">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529652">rb</span>&nbsp;<span class="op" id="6529655">:=</span>&nbsp;<span class="builtinfunc" id="6529658">make</span><span class="op" id="6529662">(</span><span class="op" id="6529663">[</span><span class="op" id="6529664">]</span><span class="builtintype" id="6529665">byte</span><span class="op" id="6529669">,</span>&nbsp;<span class="num" id="6529671">128</span><span class="op" id="6529674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529677">if</span>&nbsp;<span class="ident" id="6529680">_</span><span class="op" id="6529681">,</span>&nbsp;<span class="ident" id="6529683">err</span>&nbsp;<span class="op" id="6529687">:=</span>&nbsp;<span class="ident" id="6529690">c</span><span class="op" id="6529691">.</span><span class="ident" id="6529692">WriteToUDP</span><span class="op" id="6529702">(</span><span class="ident" id="6529703">wb</span><span class="op" id="6529705">,</span>&nbsp;<span class="ident" id="6529707">c</span><span class="op" id="6529708">.</span><span class="ident" id="6529709">LocalAddr</span><span class="op" id="6529718">(</span><span class="op" id="6529719">)</span><span class="op" id="6529720">.</span><span class="op" id="6529721">(</span><span class="op" id="6529722">*</span><span class="ident" id="6529723">UDPAddr</span><span class="op" id="6529730">)</span><span class="op" id="6529731">)</span><span class="op" id="6529732">;</span>&nbsp;<span class="ident" id="6529734">err</span>&nbsp;<span class="op" id="6529738">!=</span>&nbsp;<span class="builtintype" id="6529741">nil</span>&nbsp;<span class="op" id="6529745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529749">t</span><span class="op" id="6529750">.</span><span class="ident" id="6529751">Fatalf</span><span class="op" id="6529757">(</span><span class="string" id="6529758">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529789">,</span>&nbsp;<span class="ident" id="6529791">err</span><span class="op" id="6529794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529800">if</span>&nbsp;<span class="ident" id="6529803">_</span><span class="op" id="6529804">,</span>&nbsp;<span class="ident" id="6529806">_</span><span class="op" id="6529807">,</span>&nbsp;<span class="ident" id="6529809">err</span>&nbsp;<span class="op" id="6529813">:=</span>&nbsp;<span class="ident" id="6529816">c</span><span class="op" id="6529817">.</span><span class="ident" id="6529818">ReadFromUDP</span><span class="op" id="6529829">(</span><span class="ident" id="6529830">rb</span><span class="op" id="6529832">)</span><span class="op" id="6529833">;</span>&nbsp;<span class="ident" id="6529835">err</span>&nbsp;<span class="op" id="6529839">!=</span>&nbsp;<span class="builtintype" id="6529842">nil</span>&nbsp;<span class="op" id="6529846">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529850">t</span><span class="op" id="6529851">.</span><span class="ident" id="6529852">Fatalf</span><span class="op" id="6529858">(</span><span class="string" id="6529859">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6529891">,</span>&nbsp;<span class="ident" id="6529893">err</span><span class="op" id="6529896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529902">if</span>&nbsp;<span class="ident" id="6529905">_</span><span class="op" id="6529906">,</span>&nbsp;<span class="ident" id="6529908">_</span><span class="op" id="6529909">,</span>&nbsp;<span class="ident" id="6529911">err</span>&nbsp;<span class="op" id="6529915">:=</span>&nbsp;<span class="ident" id="6529918">c</span><span class="op" id="6529919">.</span><span class="ident" id="6529920">WriteMsgUDP</span><span class="op" id="6529931">(</span><span class="ident" id="6529932">wb</span><span class="op" id="6529934">,</span>&nbsp;<span class="builtintype" id="6529936">nil</span><span class="op" id="6529939">,</span>&nbsp;<span class="ident" id="6529941">c</span><span class="op" id="6529942">.</span><span class="ident" id="6529943">LocalAddr</span><span class="op" id="6529952">(</span><span class="op" id="6529953">)</span><span class="op" id="6529954">.</span><span class="op" id="6529955">(</span><span class="op" id="6529956">*</span><span class="ident" id="6529957">UDPAddr</span><span class="op" id="6529964">)</span><span class="op" id="6529965">)</span><span class="op" id="6529966">;</span>&nbsp;<span class="ident" id="6529968">err</span>&nbsp;<span class="op" id="6529972">!=</span>&nbsp;<span class="builtintype" id="6529975">nil</span>&nbsp;<span class="op" id="6529979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529983">condFatalf</span><span class="op" id="6529993">(</span><span class="ident" id="6529994">t</span><span class="op" id="6529995">,</span>&nbsp;<span class="string" id="6529997">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6530029">,</span>&nbsp;<span class="ident" id="6530031">err</span><span class="op" id="6530034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530037">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530040">if</span>&nbsp;<span class="ident" id="6530043">_</span><span class="op" id="6530044">,</span>&nbsp;<span class="ident" id="6530046">_</span><span class="op" id="6530047">,</span>&nbsp;<span class="ident" id="6530049">_</span><span class="op" id="6530050">,</span>&nbsp;<span class="ident" id="6530052">_</span><span class="op" id="6530053">,</span>&nbsp;<span class="ident" id="6530055">err</span>&nbsp;<span class="op" id="6530059">:=</span>&nbsp;<span class="ident" id="6530062">c</span><span class="op" id="6530063">.</span><span class="ident" id="6530064">ReadMsgUDP</span><span class="op" id="6530074">(</span><span class="ident" id="6530075">rb</span><span class="op" id="6530077">,</span>&nbsp;<span class="builtintype" id="6530079">nil</span><span class="op" id="6530082">)</span><span class="op" id="6530083">;</span>&nbsp;<span class="ident" id="6530085">err</span>&nbsp;<span class="op" id="6530089">!=</span>&nbsp;<span class="builtintype" id="6530092">nil</span>&nbsp;<span class="op" id="6530096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530100">condFatalf</span><span class="op" id="6530110">(</span><span class="ident" id="6530111">t</span><span class="op" id="6530112">,</span>&nbsp;<span class="string" id="6530114">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6530145">,</span>&nbsp;<span class="ident" id="6530147">err</span><span class="op" id="6530150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530157">if</span>&nbsp;<span class="ident" id="6530160">f</span><span class="op" id="6530161">,</span>&nbsp;<span class="ident" id="6530163">err</span>&nbsp;<span class="op" id="6530167">:=</span>&nbsp;<span class="ident" id="6530170">c</span><span class="op" id="6530171">.</span><span class="ident" id="6530172">File</span><span class="op" id="6530176">(</span><span class="op" id="6530177">)</span><span class="op" id="6530178">;</span>&nbsp;<span class="ident" id="6530180">err</span>&nbsp;<span class="op" id="6530184">!=</span>&nbsp;<span class="builtintype" id="6530187">nil</span>&nbsp;<span class="op" id="6530191">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530195">condFatalf</span><span class="op" id="6530205">(</span><span class="ident" id="6530206">t</span><span class="op" id="6530207">,</span>&nbsp;<span class="string" id="6530209">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6530234">,</span>&nbsp;<span class="ident" id="6530236">err</span><span class="op" id="6530239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530242">}</span>&nbsp;<span class="keyword" id="6530244">else</span>&nbsp;<span class="op" id="6530249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530253">f</span><span class="op" id="6530254">.</span><span class="ident" id="6530255">Close</span><span class="op" id="6530260">(</span><span class="op" id="6530261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530268">defer</span>&nbsp;<span class="keyword" id="6530274">func</span><span class="op" id="6530278">(</span><span class="op" id="6530279">)</span>&nbsp;<span class="op" id="6530281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530285">if</span>&nbsp;<span class="ident" id="6530288">p</span>&nbsp;<span class="op" id="6530290">:=</span>&nbsp;<span class="builtinfunc" id="6530293">recover</span><span class="op" id="6530300">(</span><span class="op" id="6530301">)</span><span class="op" id="6530302">;</span>&nbsp;<span class="ident" id="6530304">p</span>&nbsp;<span class="op" id="6530306">!=</span>&nbsp;<span class="builtintype" id="6530309">nil</span>&nbsp;<span class="op" id="6530313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530318">t</span><span class="op" id="6530319">.</span><span class="ident" id="6530320">Fatalf</span><span class="op" id="6530326">(</span><span class="string" id="6530327">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6530375">,</span>&nbsp;<span class="ident" id="6530377">p</span><span class="op" id="6530378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530385">}</span><span class="op" id="6530386">(</span><span class="op" id="6530387">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530391">c</span><span class="op" id="6530392">.</span><span class="ident" id="6530393">WriteToUDP</span><span class="op" id="6530403">(</span><span class="ident" id="6530404">wb</span><span class="op" id="6530406">,</span>&nbsp;<span class="builtintype" id="6530408">nil</span><span class="op" id="6530411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530414">c</span><span class="op" id="6530415">.</span><span class="ident" id="6530416">WriteMsgUDP</span><span class="op" id="6530427">(</span><span class="ident" id="6530428">wb</span><span class="op" id="6530430">,</span>&nbsp;<span class="builtintype" id="6530432">nil</span><span class="op" id="6530435">,</span>&nbsp;<span class="builtintype" id="6530437">nil</span><span class="op" id="6530440">)</span><br>
<span class="lineno"></span><span class="op" id="6530442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6530445">func</span>&nbsp;<span class="ident" id="6530450">TestIPConnSpecificMethods</span><span class="op" id="6530475">(</span><span class="ident" id="6530476">t</span>&nbsp;<span class="op" id="6530478">*</span><span class="ident" id="6530479">testing</span><span class="op" id="6530486">.</span><span class="ident" id="6530487">T</span><span class="op" id="6530488">)</span>&nbsp;<span class="op" id="6530490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530493">if</span>&nbsp;<span class="ident" id="6530496">skip</span><span class="op" id="6530500">,</span>&nbsp;<span class="ident" id="6530502">skipmsg</span>&nbsp;<span class="op" id="6530510">:=</span>&nbsp;<span class="ident" id="6530513">skipRawSocketTest</span><span class="op" id="6530530">(</span><span class="ident" id="6530531">t</span><span class="op" id="6530532">)</span><span class="op" id="6530533">;</span>&nbsp;<span class="ident" id="6530535">skip</span>&nbsp;<span class="op" id="6530540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530544">t</span><span class="op" id="6530545">.</span><span class="ident" id="6530546">Skip</span><span class="op" id="6530550">(</span><span class="ident" id="6530551">skipmsg</span><span class="op" id="6530558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530565">la</span><span class="op" id="6530567">,</span>&nbsp;<span class="ident" id="6530569">err</span>&nbsp;<span class="op" id="6530573">:=</span>&nbsp;<span class="ident" id="6530576">ResolveIPAddr</span><span class="op" id="6530589">(</span><span class="string" id="6530590">&#34;ip4&#34;</span><span class="op" id="6530595">,</span>&nbsp;<span class="string" id="6530597">&#34;127.0.0.1&#34;</span><span class="op" id="6530608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530611">if</span>&nbsp;<span class="ident" id="6530614">err</span>&nbsp;<span class="op" id="6530618">!=</span>&nbsp;<span class="builtintype" id="6530621">nil</span>&nbsp;<span class="op" id="6530625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530629">t</span><span class="op" id="6530630">.</span><span class="ident" id="6530631">Fatalf</span><span class="op" id="6530637">(</span><span class="string" id="6530638">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6530664">,</span>&nbsp;<span class="ident" id="6530666">err</span><span class="op" id="6530669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530675">c</span><span class="op" id="6530676">,</span>&nbsp;<span class="ident" id="6530678">err</span>&nbsp;<span class="op" id="6530682">:=</span>&nbsp;<span class="ident" id="6530685">ListenIP</span><span class="op" id="6530693">(</span><span class="string" id="6530694">&#34;ip4:icmp&#34;</span><span class="op" id="6530704">,</span>&nbsp;<span class="ident" id="6530706">la</span><span class="op" id="6530708">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530711">if</span>&nbsp;<span class="ident" id="6530714">err</span>&nbsp;<span class="op" id="6530718">!=</span>&nbsp;<span class="builtintype" id="6530721">nil</span>&nbsp;<span class="op" id="6530725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530729">t</span><span class="op" id="6530730">.</span><span class="ident" id="6530731">Fatalf</span><span class="op" id="6530737">(</span><span class="string" id="6530738">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6530759">,</span>&nbsp;<span class="ident" id="6530761">err</span><span class="op" id="6530764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530770">defer</span>&nbsp;<span class="ident" id="6530776">c</span><span class="op" id="6530777">.</span><span class="ident" id="6530778">Close</span><span class="op" id="6530783">(</span><span class="op" id="6530784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530787">c</span><span class="op" id="6530788">.</span><span class="ident" id="6530789">LocalAddr</span><span class="op" id="6530798">(</span><span class="op" id="6530799">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530802">c</span><span class="op" id="6530803">.</span><span class="ident" id="6530804">RemoteAddr</span><span class="op" id="6530814">(</span><span class="op" id="6530815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530818">c</span><span class="op" id="6530819">.</span><span class="ident" id="6530820">SetDeadline</span><span class="op" id="6530831">(</span><span class="ident" id="6530832">time</span><span class="op" id="6530836">.</span><span class="ident" id="6530837">Now</span><span class="op" id="6530840">(</span><span class="op" id="6530841">)</span><span class="op" id="6530842">.</span><span class="ident" id="6530843">Add</span><span class="op" id="6530846">(</span><span class="ident" id="6530847">someTimeout</span><span class="op" id="6530858">)</span><span class="op" id="6530859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530862">c</span><span class="op" id="6530863">.</span><span class="ident" id="6530864">SetReadDeadline</span><span class="op" id="6530879">(</span><span class="ident" id="6530880">time</span><span class="op" id="6530884">.</span><span class="ident" id="6530885">Now</span><span class="op" id="6530888">(</span><span class="op" id="6530889">)</span><span class="op" id="6530890">.</span><span class="ident" id="6530891">Add</span><span class="op" id="6530894">(</span><span class="ident" id="6530895">someTimeout</span><span class="op" id="6530906">)</span><span class="op" id="6530907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530910">c</span><span class="op" id="6530911">.</span><span class="ident" id="6530912">SetWriteDeadline</span><span class="op" id="6530928">(</span><span class="ident" id="6530929">time</span><span class="op" id="6530933">.</span><span class="ident" id="6530934">Now</span><span class="op" id="6530937">(</span><span class="op" id="6530938">)</span><span class="op" id="6530939">.</span><span class="ident" id="6530940">Add</span><span class="op" id="6530943">(</span><span class="ident" id="6530944">someTimeout</span><span class="op" id="6530955">)</span><span class="op" id="6530956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530959">c</span><span class="op" id="6530960">.</span><span class="ident" id="6530961">SetReadBuffer</span><span class="op" id="6530974">(</span><span class="num" id="6530975">2048</span><span class="op" id="6530979">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530982">c</span><span class="op" id="6530983">.</span><span class="ident" id="6530984">SetWriteBuffer</span><span class="op" id="6530998">(</span><span class="num" id="6530999">2048</span><span class="op" id="6531003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531007">wb</span><span class="op" id="6531009">,</span>&nbsp;<span class="ident" id="6531011">err</span>&nbsp;<span class="op" id="6531015">:=</span>&nbsp;<span class="op" id="6531018">(</span><span class="op" id="6531019">&amp;</span><span class="ident" id="6531020">icmpMessage</span><span class="op" id="6531031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531035">Type</span><span class="op" id="6531039">:</span>&nbsp;<span class="ident" id="6531041">icmpv4EchoRequest</span><span class="op" id="6531058">,</span>&nbsp;<span class="ident" id="6531060">Code</span><span class="op" id="6531064">:</span>&nbsp;<span class="num" id="6531066">0</span><span class="op" id="6531067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531071">Body</span><span class="op" id="6531075">:</span>&nbsp;<span class="op" id="6531077">&amp;</span><span class="ident" id="6531078">icmpEcho</span><span class="op" id="6531086">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531091">ID</span><span class="op" id="6531093">:</span>&nbsp;<span class="ident" id="6531095">os</span><span class="op" id="6531097">.</span><span class="ident" id="6531098">Getpid</span><span class="op" id="6531104">(</span><span class="op" id="6531105">)</span>&nbsp;<span class="op" id="6531107">&amp;</span>&nbsp;<span class="num" id="6531109">0xffff</span><span class="op" id="6531115">,</span>&nbsp;<span class="ident" id="6531117">Seq</span><span class="op" id="6531120">:</span>&nbsp;<span class="num" id="6531122">1</span><span class="op" id="6531123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531128">Data</span><span class="op" id="6531132">:</span>&nbsp;<span class="op" id="6531134">[</span><span class="op" id="6531135">]</span><span class="builtintype" id="6531136">byte</span><span class="op" id="6531140">(</span><span class="string" id="6531141">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="6531155">)</span><span class="op" id="6531156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531160">}</span><span class="op" id="6531161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531164">}</span><span class="op" id="6531165">)</span><span class="op" id="6531166">.</span><span class="ident" id="6531167">Marshal</span><span class="op" id="6531174">(</span><span class="op" id="6531175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531178">if</span>&nbsp;<span class="ident" id="6531181">err</span>&nbsp;<span class="op" id="6531185">!=</span>&nbsp;<span class="builtintype" id="6531188">nil</span>&nbsp;<span class="op" id="6531192">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531196">t</span><span class="op" id="6531197">.</span><span class="ident" id="6531198">Fatalf</span><span class="op" id="6531204">(</span><span class="string" id="6531205">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6531237">,</span>&nbsp;<span class="ident" id="6531239">err</span><span class="op" id="6531242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531248">rb</span>&nbsp;<span class="op" id="6531251">:=</span>&nbsp;<span class="builtinfunc" id="6531254">make</span><span class="op" id="6531258">(</span><span class="op" id="6531259">[</span><span class="op" id="6531260">]</span><span class="builtintype" id="6531261">byte</span><span class="op" id="6531265">,</span>&nbsp;<span class="num" id="6531267">20</span><span class="op" id="6531269">+</span><span class="builtinfunc" id="6531270">len</span><span class="op" id="6531273">(</span><span class="ident" id="6531274">wb</span><span class="op" id="6531276">)</span><span class="op" id="6531277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531280">if</span>&nbsp;<span class="ident" id="6531283">_</span><span class="op" id="6531284">,</span>&nbsp;<span class="ident" id="6531286">err</span>&nbsp;<span class="op" id="6531290">:=</span>&nbsp;<span class="ident" id="6531293">c</span><span class="op" id="6531294">.</span><span class="ident" id="6531295">WriteToIP</span><span class="op" id="6531304">(</span><span class="ident" id="6531305">wb</span><span class="op" id="6531307">,</span>&nbsp;<span class="ident" id="6531309">c</span><span class="op" id="6531310">.</span><span class="ident" id="6531311">LocalAddr</span><span class="op" id="6531320">(</span><span class="op" id="6531321">)</span><span class="op" id="6531322">.</span><span class="op" id="6531323">(</span><span class="op" id="6531324">*</span><span class="ident" id="6531325">IPAddr</span><span class="op" id="6531331">)</span><span class="op" id="6531332">)</span><span class="op" id="6531333">;</span>&nbsp;<span class="ident" id="6531335">err</span>&nbsp;<span class="op" id="6531339">!=</span>&nbsp;<span class="builtintype" id="6531342">nil</span>&nbsp;<span class="op" id="6531346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531350">t</span><span class="op" id="6531351">.</span><span class="ident" id="6531352">Fatalf</span><span class="op" id="6531358">(</span><span class="string" id="6531359">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6531388">,</span>&nbsp;<span class="ident" id="6531390">err</span><span class="op" id="6531393">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531399">if</span>&nbsp;<span class="ident" id="6531402">_</span><span class="op" id="6531403">,</span>&nbsp;<span class="ident" id="6531405">_</span><span class="op" id="6531406">,</span>&nbsp;<span class="ident" id="6531408">err</span>&nbsp;<span class="op" id="6531412">:=</span>&nbsp;<span class="ident" id="6531415">c</span><span class="op" id="6531416">.</span><span class="ident" id="6531417">ReadFromIP</span><span class="op" id="6531427">(</span><span class="ident" id="6531428">rb</span><span class="op" id="6531430">)</span><span class="op" id="6531431">;</span>&nbsp;<span class="ident" id="6531433">err</span>&nbsp;<span class="op" id="6531437">!=</span>&nbsp;<span class="builtintype" id="6531440">nil</span>&nbsp;<span class="op" id="6531444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531448">t</span><span class="op" id="6531449">.</span><span class="ident" id="6531450">Fatalf</span><span class="op" id="6531456">(</span><span class="string" id="6531457">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6531487">,</span>&nbsp;<span class="ident" id="6531489">err</span><span class="op" id="6531492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531498">if</span>&nbsp;<span class="ident" id="6531501">_</span><span class="op" id="6531502">,</span>&nbsp;<span class="ident" id="6531504">_</span><span class="op" id="6531505">,</span>&nbsp;<span class="ident" id="6531507">err</span>&nbsp;<span class="op" id="6531511">:=</span>&nbsp;<span class="ident" id="6531514">c</span><span class="op" id="6531515">.</span><span class="ident" id="6531516">WriteMsgIP</span><span class="op" id="6531526">(</span><span class="ident" id="6531527">wb</span><span class="op" id="6531529">,</span>&nbsp;<span class="builtintype" id="6531531">nil</span><span class="op" id="6531534">,</span>&nbsp;<span class="ident" id="6531536">c</span><span class="op" id="6531537">.</span><span class="ident" id="6531538">LocalAddr</span><span class="op" id="6531547">(</span><span class="op" id="6531548">)</span><span class="op" id="6531549">.</span><span class="op" id="6531550">(</span><span class="op" id="6531551">*</span><span class="ident" id="6531552">IPAddr</span><span class="op" id="6531558">)</span><span class="op" id="6531559">)</span><span class="op" id="6531560">;</span>&nbsp;<span class="ident" id="6531562">err</span>&nbsp;<span class="op" id="6531566">!=</span>&nbsp;<span class="builtintype" id="6531569">nil</span>&nbsp;<span class="op" id="6531573">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531577">condFatalf</span><span class="op" id="6531587">(</span><span class="ident" id="6531588">t</span><span class="op" id="6531589">,</span>&nbsp;<span class="string" id="6531591">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6531621">,</span>&nbsp;<span class="ident" id="6531623">err</span><span class="op" id="6531626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531632">if</span>&nbsp;<span class="ident" id="6531635">_</span><span class="op" id="6531636">,</span>&nbsp;<span class="ident" id="6531638">_</span><span class="op" id="6531639">,</span>&nbsp;<span class="ident" id="6531641">_</span><span class="op" id="6531642">,</span>&nbsp;<span class="ident" id="6531644">_</span><span class="op" id="6531645">,</span>&nbsp;<span class="ident" id="6531647">err</span>&nbsp;<span class="op" id="6531651">:=</span>&nbsp;<span class="ident" id="6531654">c</span><span class="op" id="6531655">.</span><span class="ident" id="6531656">ReadMsgIP</span><span class="op" id="6531665">(</span><span class="ident" id="6531666">rb</span><span class="op" id="6531668">,</span>&nbsp;<span class="builtintype" id="6531670">nil</span><span class="op" id="6531673">)</span><span class="op" id="6531674">;</span>&nbsp;<span class="ident" id="6531676">err</span>&nbsp;<span class="op" id="6531680">!=</span>&nbsp;<span class="builtintype" id="6531683">nil</span>&nbsp;<span class="op" id="6531687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531691">condFatalf</span><span class="op" id="6531701">(</span><span class="ident" id="6531702">t</span><span class="op" id="6531703">,</span>&nbsp;<span class="string" id="6531705">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6531734">,</span>&nbsp;<span class="ident" id="6531736">err</span><span class="op" id="6531739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531742">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531746">if</span>&nbsp;<span class="ident" id="6531749">f</span><span class="op" id="6531750">,</span>&nbsp;<span class="ident" id="6531752">err</span>&nbsp;<span class="op" id="6531756">:=</span>&nbsp;<span class="ident" id="6531759">c</span><span class="op" id="6531760">.</span><span class="ident" id="6531761">File</span><span class="op" id="6531765">(</span><span class="op" id="6531766">)</span><span class="op" id="6531767">;</span>&nbsp;<span class="ident" id="6531769">err</span>&nbsp;<span class="op" id="6531773">!=</span>&nbsp;<span class="builtintype" id="6531776">nil</span>&nbsp;<span class="op" id="6531780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531784">condFatalf</span><span class="op" id="6531794">(</span><span class="ident" id="6531795">t</span><span class="op" id="6531796">,</span>&nbsp;<span class="string" id="6531798">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6531822">,</span>&nbsp;<span class="ident" id="6531824">err</span><span class="op" id="6531827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531830">}</span>&nbsp;<span class="keyword" id="6531832">else</span>&nbsp;<span class="op" id="6531837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531841">f</span><span class="op" id="6531842">.</span><span class="ident" id="6531843">Close</span><span class="op" id="6531848">(</span><span class="op" id="6531849">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531856">defer</span>&nbsp;<span class="keyword" id="6531862">func</span><span class="op" id="6531866">(</span><span class="op" id="6531867">)</span>&nbsp;<span class="op" id="6531869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531873">if</span>&nbsp;<span class="ident" id="6531876">p</span>&nbsp;<span class="op" id="6531878">:=</span>&nbsp;<span class="builtinfunc" id="6531881">recover</span><span class="op" id="6531888">(</span><span class="op" id="6531889">)</span><span class="op" id="6531890">;</span>&nbsp;<span class="ident" id="6531892">p</span>&nbsp;<span class="op" id="6531894">!=</span>&nbsp;<span class="builtintype" id="6531897">nil</span>&nbsp;<span class="op" id="6531901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531906">t</span><span class="op" id="6531907">.</span><span class="ident" id="6531908">Fatalf</span><span class="op" id="6531914">(</span><span class="string" id="6531915">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6531960">,</span>&nbsp;<span class="ident" id="6531962">p</span><span class="op" id="6531963">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531970">}</span><span class="op" id="6531971">(</span><span class="op" id="6531972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531976">c</span><span class="op" id="6531977">.</span><span class="ident" id="6531978">WriteToIP</span><span class="op" id="6531987">(</span><span class="ident" id="6531988">wb</span><span class="op" id="6531990">,</span>&nbsp;<span class="builtintype" id="6531992">nil</span><span class="op" id="6531995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531998">c</span><span class="op" id="6531999">.</span><span class="ident" id="6532000">WriteMsgIP</span><span class="op" id="6532010">(</span><span class="ident" id="6532011">wb</span><span class="op" id="6532013">,</span>&nbsp;<span class="builtintype" id="6532015">nil</span><span class="op" id="6532018">,</span>&nbsp;<span class="builtintype" id="6532020">nil</span><span class="op" id="6532023">)</span><br>
<span class="lineno">235</span><span class="op" id="6532025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6532028">func</span>&nbsp;<span class="ident" id="6532033">TestUnixListenerSpecificMethods</span><span class="op" id="6532064">(</span><span class="ident" id="6532065">t</span>&nbsp;<span class="op" id="6532067">*</span><span class="ident" id="6532068">testing</span><span class="op" id="6532075">.</span><span class="ident" id="6532076">T</span><span class="op" id="6532077">)</span>&nbsp;<span class="op" id="6532079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532082">switch</span>&nbsp;<span class="ident" id="6532089">runtime</span><span class="op" id="6532096">.</span><span class="ident" id="6532097">GOOS</span>&nbsp;<span class="op" id="6532102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532105">case</span>&nbsp;<span class="string" id="6532110">&#34;nacl&#34;</span><span class="op" id="6532116">,</span>&nbsp;<span class="string" id="6532118">&#34;plan9&#34;</span><span class="op" id="6532125">,</span>&nbsp;<span class="string" id="6532127">&#34;windows&#34;</span><span class="op" id="6532136">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532140">t</span><span class="op" id="6532141">.</span><span class="ident" id="6532142">Skipf</span><span class="op" id="6532147">(</span><span class="string" id="6532148">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6532169">,</span>&nbsp;<span class="ident" id="6532171">runtime</span><span class="op" id="6532178">.</span><span class="ident" id="6532179">GOOS</span><span class="op" id="6532183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532190">addr</span>&nbsp;<span class="op" id="6532195">:=</span>&nbsp;<span class="ident" id="6532198">testUnixAddr</span><span class="op" id="6532210">(</span><span class="op" id="6532211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532214">la</span><span class="op" id="6532216">,</span>&nbsp;<span class="ident" id="6532218">err</span>&nbsp;<span class="op" id="6532222">:=</span>&nbsp;<span class="ident" id="6532225">ResolveUnixAddr</span><span class="op" id="6532240">(</span><span class="string" id="6532241">&#34;unix&#34;</span><span class="op" id="6532247">,</span>&nbsp;<span class="ident" id="6532249">addr</span><span class="op" id="6532253">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532256">if</span>&nbsp;<span class="ident" id="6532259">err</span>&nbsp;<span class="op" id="6532263">!=</span>&nbsp;<span class="builtintype" id="6532266">nil</span>&nbsp;<span class="op" id="6532270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532274">t</span><span class="op" id="6532275">.</span><span class="ident" id="6532276">Fatalf</span><span class="op" id="6532282">(</span><span class="string" id="6532283">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6532311">,</span>&nbsp;<span class="ident" id="6532313">err</span><span class="op" id="6532316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532322">ln</span><span class="op" id="6532324">,</span>&nbsp;<span class="ident" id="6532326">err</span>&nbsp;<span class="op" id="6532330">:=</span>&nbsp;<span class="ident" id="6532333">ListenUnix</span><span class="op" id="6532343">(</span><span class="string" id="6532344">&#34;unix&#34;</span><span class="op" id="6532350">,</span>&nbsp;<span class="ident" id="6532352">la</span><span class="op" id="6532354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532357">if</span>&nbsp;<span class="ident" id="6532360">err</span>&nbsp;<span class="op" id="6532364">!=</span>&nbsp;<span class="builtintype" id="6532367">nil</span>&nbsp;<span class="op" id="6532371">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532375">t</span><span class="op" id="6532376">.</span><span class="ident" id="6532377">Fatalf</span><span class="op" id="6532383">(</span><span class="string" id="6532384">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6532407">,</span>&nbsp;<span class="ident" id="6532409">err</span><span class="op" id="6532412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532418">defer</span>&nbsp;<span class="ident" id="6532424">ln</span><span class="op" id="6532426">.</span><span class="ident" id="6532427">Close</span><span class="op" id="6532432">(</span><span class="op" id="6532433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532436">defer</span>&nbsp;<span class="ident" id="6532442">os</span><span class="op" id="6532444">.</span><span class="ident" id="6532445">Remove</span><span class="op" id="6532451">(</span><span class="ident" id="6532452">addr</span><span class="op" id="6532456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532459">ln</span><span class="op" id="6532461">.</span><span class="ident" id="6532462">Addr</span><span class="op" id="6532466">(</span><span class="op" id="6532467">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532470">ln</span><span class="op" id="6532472">.</span><span class="ident" id="6532473">SetDeadline</span><span class="op" id="6532484">(</span><span class="ident" id="6532485">time</span><span class="op" id="6532489">.</span><span class="ident" id="6532490">Now</span><span class="op" id="6532493">(</span><span class="op" id="6532494">)</span><span class="op" id="6532495">.</span><span class="ident" id="6532496">Add</span><span class="op" id="6532499">(</span><span class="num" id="6532500">30</span>&nbsp;<span class="op" id="6532503">*</span>&nbsp;<span class="ident" id="6532505">time</span><span class="op" id="6532509">.</span><span class="ident" id="6532510">Nanosecond</span><span class="op" id="6532520">)</span><span class="op" id="6532521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532525">if</span>&nbsp;<span class="ident" id="6532528">c</span><span class="op" id="6532529">,</span>&nbsp;<span class="ident" id="6532531">err</span>&nbsp;<span class="op" id="6532535">:=</span>&nbsp;<span class="ident" id="6532538">ln</span><span class="op" id="6532540">.</span><span class="ident" id="6532541">Accept</span><span class="op" id="6532547">(</span><span class="op" id="6532548">)</span><span class="op" id="6532549">;</span>&nbsp;<span class="ident" id="6532551">err</span>&nbsp;<span class="op" id="6532555">!=</span>&nbsp;<span class="builtintype" id="6532558">nil</span>&nbsp;<span class="op" id="6532562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532566">if</span>&nbsp;<span class="op" id="6532569">!</span><span class="ident" id="6532570">err</span><span class="op" id="6532573">.</span><span class="op" id="6532574">(</span><span class="ident" id="6532575">Error</span><span class="op" id="6532580">)</span><span class="op" id="6532581">.</span><span class="ident" id="6532582">Timeout</span><span class="op" id="6532589">(</span><span class="op" id="6532590">)</span>&nbsp;<span class="op" id="6532592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532597">t</span><span class="op" id="6532598">.</span><span class="ident" id="6532599">Fatalf</span><span class="op" id="6532605">(</span><span class="string" id="6532606">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6532638">,</span>&nbsp;<span class="ident" id="6532640">err</span><span class="op" id="6532643">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532650">}</span>&nbsp;<span class="keyword" id="6532652">else</span>&nbsp;<span class="op" id="6532657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532661">c</span><span class="op" id="6532662">.</span><span class="ident" id="6532663">Close</span><span class="op" id="6532668">(</span><span class="op" id="6532669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532675">if</span>&nbsp;<span class="ident" id="6532678">c</span><span class="op" id="6532679">,</span>&nbsp;<span class="ident" id="6532681">err</span>&nbsp;<span class="op" id="6532685">:=</span>&nbsp;<span class="ident" id="6532688">ln</span><span class="op" id="6532690">.</span><span class="ident" id="6532691">AcceptUnix</span><span class="op" id="6532701">(</span><span class="op" id="6532702">)</span><span class="op" id="6532703">;</span>&nbsp;<span class="ident" id="6532705">err</span>&nbsp;<span class="op" id="6532709">!=</span>&nbsp;<span class="builtintype" id="6532712">nil</span>&nbsp;<span class="op" id="6532716">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532720">if</span>&nbsp;<span class="op" id="6532723">!</span><span class="ident" id="6532724">err</span><span class="op" id="6532727">.</span><span class="op" id="6532728">(</span><span class="ident" id="6532729">Error</span><span class="op" id="6532734">)</span><span class="op" id="6532735">.</span><span class="ident" id="6532736">Timeout</span><span class="op" id="6532743">(</span><span class="op" id="6532744">)</span>&nbsp;<span class="op" id="6532746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532751">t</span><span class="op" id="6532752">.</span><span class="ident" id="6532753">Fatalf</span><span class="op" id="6532759">(</span><span class="string" id="6532760">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6532796">,</span>&nbsp;<span class="ident" id="6532798">err</span><span class="op" id="6532801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532808">}</span>&nbsp;<span class="keyword" id="6532810">else</span>&nbsp;<span class="op" id="6532815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532819">c</span><span class="op" id="6532820">.</span><span class="ident" id="6532821">Close</span><span class="op" id="6532826">(</span><span class="op" id="6532827">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532834">if</span>&nbsp;<span class="ident" id="6532837">f</span><span class="op" id="6532838">,</span>&nbsp;<span class="ident" id="6532840">err</span>&nbsp;<span class="op" id="6532844">:=</span>&nbsp;<span class="ident" id="6532847">ln</span><span class="op" id="6532849">.</span><span class="ident" id="6532850">File</span><span class="op" id="6532854">(</span><span class="op" id="6532855">)</span><span class="op" id="6532856">;</span>&nbsp;<span class="ident" id="6532858">err</span>&nbsp;<span class="op" id="6532862">!=</span>&nbsp;<span class="builtintype" id="6532865">nil</span>&nbsp;<span class="op" id="6532869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532873">t</span><span class="op" id="6532874">.</span><span class="ident" id="6532875">Fatalf</span><span class="op" id="6532881">(</span><span class="string" id="6532882">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6532912">,</span>&nbsp;<span class="ident" id="6532914">err</span><span class="op" id="6532917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532920">}</span>&nbsp;<span class="keyword" id="6532922">else</span>&nbsp;<span class="op" id="6532927">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532931">f</span><span class="op" id="6532932">.</span><span class="ident" id="6532933">Close</span><span class="op" id="6532938">(</span><span class="op" id="6532939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532942">}</span><br>
<span class="lineno"></span><span class="op" id="6532944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6532947">func</span>&nbsp;<span class="ident" id="6532952">TestUnixConnSpecificMethods</span><span class="op" id="6532979">(</span><span class="ident" id="6532980">t</span>&nbsp;<span class="op" id="6532982">*</span><span class="ident" id="6532983">testing</span><span class="op" id="6532990">.</span><span class="ident" id="6532991">T</span><span class="op" id="6532992">)</span>&nbsp;<span class="op" id="6532994">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532997">switch</span>&nbsp;<span class="ident" id="6533004">runtime</span><span class="op" id="6533011">.</span><span class="ident" id="6533012">GOOS</span>&nbsp;<span class="op" id="6533017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533020">case</span>&nbsp;<span class="string" id="6533025">&#34;nacl&#34;</span><span class="op" id="6533031">,</span>&nbsp;<span class="string" id="6533033">&#34;plan9&#34;</span><span class="op" id="6533040">,</span>&nbsp;<span class="string" id="6533042">&#34;windows&#34;</span><span class="op" id="6533051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533055">t</span><span class="op" id="6533056">.</span><span class="ident" id="6533057">Skipf</span><span class="op" id="6533062">(</span><span class="string" id="6533063">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6533084">,</span>&nbsp;<span class="ident" id="6533086">runtime</span><span class="op" id="6533093">.</span><span class="ident" id="6533094">GOOS</span><span class="op" id="6533098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533105">addr1</span><span class="op" id="6533110">,</span>&nbsp;<span class="ident" id="6533112">addr2</span><span class="op" id="6533117">,</span>&nbsp;<span class="ident" id="6533119">addr3</span>&nbsp;<span class="op" id="6533125">:=</span>&nbsp;<span class="ident" id="6533128">testUnixAddr</span><span class="op" id="6533140">(</span><span class="op" id="6533141">)</span><span class="op" id="6533142">,</span>&nbsp;<span class="ident" id="6533144">testUnixAddr</span><span class="op" id="6533156">(</span><span class="op" id="6533157">)</span><span class="op" id="6533158">,</span>&nbsp;<span class="ident" id="6533160">testUnixAddr</span><span class="op" id="6533172">(</span><span class="op" id="6533173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533177">a1</span><span class="op" id="6533179">,</span>&nbsp;<span class="ident" id="6533181">err</span>&nbsp;<span class="op" id="6533185">:=</span>&nbsp;<span class="ident" id="6533188">ResolveUnixAddr</span><span class="op" id="6533203">(</span><span class="string" id="6533204">&#34;unixgram&#34;</span><span class="op" id="6533214">,</span>&nbsp;<span class="ident" id="6533216">addr1</span><span class="op" id="6533221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533224">if</span>&nbsp;<span class="ident" id="6533227">err</span>&nbsp;<span class="op" id="6533231">!=</span>&nbsp;<span class="builtintype" id="6533234">nil</span>&nbsp;<span class="op" id="6533238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533242">t</span><span class="op" id="6533243">.</span><span class="ident" id="6533244">Fatalf</span><span class="op" id="6533250">(</span><span class="string" id="6533251">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6533279">,</span>&nbsp;<span class="ident" id="6533281">err</span><span class="op" id="6533284">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533290">c1</span><span class="op" id="6533292">,</span>&nbsp;<span class="ident" id="6533294">err</span>&nbsp;<span class="op" id="6533298">:=</span>&nbsp;<span class="ident" id="6533301">DialUnix</span><span class="op" id="6533309">(</span><span class="string" id="6533310">&#34;unixgram&#34;</span><span class="op" id="6533320">,</span>&nbsp;<span class="ident" id="6533322">a1</span><span class="op" id="6533324">,</span>&nbsp;<span class="builtintype" id="6533326">nil</span><span class="op" id="6533329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533332">if</span>&nbsp;<span class="ident" id="6533335">err</span>&nbsp;<span class="op" id="6533339">!=</span>&nbsp;<span class="builtintype" id="6533342">nil</span>&nbsp;<span class="op" id="6533346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533350">t</span><span class="op" id="6533351">.</span><span class="ident" id="6533352">Fatalf</span><span class="op" id="6533358">(</span><span class="string" id="6533359">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6533380">,</span>&nbsp;<span class="ident" id="6533382">err</span><span class="op" id="6533385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533388">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533391">defer</span>&nbsp;<span class="ident" id="6533397">c1</span><span class="op" id="6533399">.</span><span class="ident" id="6533400">Close</span><span class="op" id="6533405">(</span><span class="op" id="6533406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533409">defer</span>&nbsp;<span class="ident" id="6533415">os</span><span class="op" id="6533417">.</span><span class="ident" id="6533418">Remove</span><span class="op" id="6533424">(</span><span class="ident" id="6533425">addr1</span><span class="op" id="6533430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533433">c1</span><span class="op" id="6533435">.</span><span class="ident" id="6533436">LocalAddr</span><span class="op" id="6533445">(</span><span class="op" id="6533446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533449">c1</span><span class="op" id="6533451">.</span><span class="ident" id="6533452">RemoteAddr</span><span class="op" id="6533462">(</span><span class="op" id="6533463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533466">c1</span><span class="op" id="6533468">.</span><span class="ident" id="6533469">SetDeadline</span><span class="op" id="6533480">(</span><span class="ident" id="6533481">time</span><span class="op" id="6533485">.</span><span class="ident" id="6533486">Now</span><span class="op" id="6533489">(</span><span class="op" id="6533490">)</span><span class="op" id="6533491">.</span><span class="ident" id="6533492">Add</span><span class="op" id="6533495">(</span><span class="ident" id="6533496">someTimeout</span><span class="op" id="6533507">)</span><span class="op" id="6533508">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533511">c1</span><span class="op" id="6533513">.</span><span class="ident" id="6533514">SetReadDeadline</span><span class="op" id="6533529">(</span><span class="ident" id="6533530">time</span><span class="op" id="6533534">.</span><span class="ident" id="6533535">Now</span><span class="op" id="6533538">(</span><span class="op" id="6533539">)</span><span class="op" id="6533540">.</span><span class="ident" id="6533541">Add</span><span class="op" id="6533544">(</span><span class="ident" id="6533545">someTimeout</span><span class="op" id="6533556">)</span><span class="op" id="6533557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533560">c1</span><span class="op" id="6533562">.</span><span class="ident" id="6533563">SetWriteDeadline</span><span class="op" id="6533579">(</span><span class="ident" id="6533580">time</span><span class="op" id="6533584">.</span><span class="ident" id="6533585">Now</span><span class="op" id="6533588">(</span><span class="op" id="6533589">)</span><span class="op" id="6533590">.</span><span class="ident" id="6533591">Add</span><span class="op" id="6533594">(</span><span class="ident" id="6533595">someTimeout</span><span class="op" id="6533606">)</span><span class="op" id="6533607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533610">c1</span><span class="op" id="6533612">.</span><span class="ident" id="6533613">SetReadBuffer</span><span class="op" id="6533626">(</span><span class="num" id="6533627">2048</span><span class="op" id="6533631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533634">c1</span><span class="op" id="6533636">.</span><span class="ident" id="6533637">SetWriteBuffer</span><span class="op" id="6533651">(</span><span class="num" id="6533652">2048</span><span class="op" id="6533656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533660">a2</span><span class="op" id="6533662">,</span>&nbsp;<span class="ident" id="6533664">err</span>&nbsp;<span class="op" id="6533668">:=</span>&nbsp;<span class="ident" id="6533671">ResolveUnixAddr</span><span class="op" id="6533686">(</span><span class="string" id="6533687">&#34;unixgram&#34;</span><span class="op" id="6533697">,</span>&nbsp;<span class="ident" id="6533699">addr2</span><span class="op" id="6533704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533707">if</span>&nbsp;<span class="ident" id="6533710">err</span>&nbsp;<span class="op" id="6533714">!=</span>&nbsp;<span class="builtintype" id="6533717">nil</span>&nbsp;<span class="op" id="6533721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533725">t</span><span class="op" id="6533726">.</span><span class="ident" id="6533727">Fatalf</span><span class="op" id="6533733">(</span><span class="string" id="6533734">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6533762">,</span>&nbsp;<span class="ident" id="6533764">err</span><span class="op" id="6533767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533773">c2</span><span class="op" id="6533775">,</span>&nbsp;<span class="ident" id="6533777">err</span>&nbsp;<span class="op" id="6533781">:=</span>&nbsp;<span class="ident" id="6533784">DialUnix</span><span class="op" id="6533792">(</span><span class="string" id="6533793">&#34;unixgram&#34;</span><span class="op" id="6533803">,</span>&nbsp;<span class="ident" id="6533805">a2</span><span class="op" id="6533807">,</span>&nbsp;<span class="builtintype" id="6533809">nil</span><span class="op" id="6533812">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533815">if</span>&nbsp;<span class="ident" id="6533818">err</span>&nbsp;<span class="op" id="6533822">!=</span>&nbsp;<span class="builtintype" id="6533825">nil</span>&nbsp;<span class="op" id="6533829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533833">t</span><span class="op" id="6533834">.</span><span class="ident" id="6533835">Fatalf</span><span class="op" id="6533841">(</span><span class="string" id="6533842">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6533863">,</span>&nbsp;<span class="ident" id="6533865">err</span><span class="op" id="6533868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533874">defer</span>&nbsp;<span class="ident" id="6533880">c2</span><span class="op" id="6533882">.</span><span class="ident" id="6533883">Close</span><span class="op" id="6533888">(</span><span class="op" id="6533889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6533892">defer</span>&nbsp;<span class="ident" id="6533898">os</span><span class="op" id="6533900">.</span><span class="ident" id="6533901">Remove</span><span class="op" id="6533907">(</span><span class="ident" id="6533908">addr2</span><span class="op" id="6533913">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533916">c2</span><span class="op" id="6533918">.</span><span class="ident" id="6533919">LocalAddr</span><span class="op" id="6533928">(</span><span class="op" id="6533929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533932">c2</span><span class="op" id="6533934">.</span><span class="ident" id="6533935">RemoteAddr</span><span class="op" id="6533945">(</span><span class="op" id="6533946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533949">c2</span><span class="op" id="6533951">.</span><span class="ident" id="6533952">SetDeadline</span><span class="op" id="6533963">(</span><span class="ident" id="6533964">time</span><span class="op" id="6533968">.</span><span class="ident" id="6533969">Now</span><span class="op" id="6533972">(</span><span class="op" id="6533973">)</span><span class="op" id="6533974">.</span><span class="ident" id="6533975">Add</span><span class="op" id="6533978">(</span><span class="ident" id="6533979">someTimeout</span><span class="op" id="6533990">)</span><span class="op" id="6533991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533994">c2</span><span class="op" id="6533996">.</span><span class="ident" id="6533997">SetReadDeadline</span><span class="op" id="6534012">(</span><span class="ident" id="6534013">time</span><span class="op" id="6534017">.</span><span class="ident" id="6534018">Now</span><span class="op" id="6534021">(</span><span class="op" id="6534022">)</span><span class="op" id="6534023">.</span><span class="ident" id="6534024">Add</span><span class="op" id="6534027">(</span><span class="ident" id="6534028">someTimeout</span><span class="op" id="6534039">)</span><span class="op" id="6534040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534043">c2</span><span class="op" id="6534045">.</span><span class="ident" id="6534046">SetWriteDeadline</span><span class="op" id="6534062">(</span><span class="ident" id="6534063">time</span><span class="op" id="6534067">.</span><span class="ident" id="6534068">Now</span><span class="op" id="6534071">(</span><span class="op" id="6534072">)</span><span class="op" id="6534073">.</span><span class="ident" id="6534074">Add</span><span class="op" id="6534077">(</span><span class="ident" id="6534078">someTimeout</span><span class="op" id="6534089">)</span><span class="op" id="6534090">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534093">c2</span><span class="op" id="6534095">.</span><span class="ident" id="6534096">SetReadBuffer</span><span class="op" id="6534109">(</span><span class="num" id="6534110">2048</span><span class="op" id="6534114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534117">c2</span><span class="op" id="6534119">.</span><span class="ident" id="6534120">SetWriteBuffer</span><span class="op" id="6534134">(</span><span class="num" id="6534135">2048</span><span class="op" id="6534139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534143">a3</span><span class="op" id="6534145">,</span>&nbsp;<span class="ident" id="6534147">err</span>&nbsp;<span class="op" id="6534151">:=</span>&nbsp;<span class="ident" id="6534154">ResolveUnixAddr</span><span class="op" id="6534169">(</span><span class="string" id="6534170">&#34;unixgram&#34;</span><span class="op" id="6534180">,</span>&nbsp;<span class="ident" id="6534182">addr3</span><span class="op" id="6534187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534190">if</span>&nbsp;<span class="ident" id="6534193">err</span>&nbsp;<span class="op" id="6534197">!=</span>&nbsp;<span class="builtintype" id="6534200">nil</span>&nbsp;<span class="op" id="6534204">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534208">t</span><span class="op" id="6534209">.</span><span class="ident" id="6534210">Fatalf</span><span class="op" id="6534216">(</span><span class="string" id="6534217">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6534245">,</span>&nbsp;<span class="ident" id="6534247">err</span><span class="op" id="6534250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534256">c3</span><span class="op" id="6534258">,</span>&nbsp;<span class="ident" id="6534260">err</span>&nbsp;<span class="op" id="6534264">:=</span>&nbsp;<span class="ident" id="6534267">ListenUnixgram</span><span class="op" id="6534281">(</span><span class="string" id="6534282">&#34;unixgram&#34;</span><span class="op" id="6534292">,</span>&nbsp;<span class="ident" id="6534294">a3</span><span class="op" id="6534296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534299">if</span>&nbsp;<span class="ident" id="6534302">err</span>&nbsp;<span class="op" id="6534306">!=</span>&nbsp;<span class="builtintype" id="6534309">nil</span>&nbsp;<span class="op" id="6534313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534317">t</span><span class="op" id="6534318">.</span><span class="ident" id="6534319">Fatalf</span><span class="op" id="6534325">(</span><span class="string" id="6534326">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6534353">,</span>&nbsp;<span class="ident" id="6534355">err</span><span class="op" id="6534358">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534364">defer</span>&nbsp;<span class="ident" id="6534370">c3</span><span class="op" id="6534372">.</span><span class="ident" id="6534373">Close</span><span class="op" id="6534378">(</span><span class="op" id="6534379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534382">defer</span>&nbsp;<span class="ident" id="6534388">os</span><span class="op" id="6534390">.</span><span class="ident" id="6534391">Remove</span><span class="op" id="6534397">(</span><span class="ident" id="6534398">addr3</span><span class="op" id="6534403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534406">c3</span><span class="op" id="6534408">.</span><span class="ident" id="6534409">LocalAddr</span><span class="op" id="6534418">(</span><span class="op" id="6534419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534422">c3</span><span class="op" id="6534424">.</span><span class="ident" id="6534425">RemoteAddr</span><span class="op" id="6534435">(</span><span class="op" id="6534436">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534439">c3</span><span class="op" id="6534441">.</span><span class="ident" id="6534442">SetDeadline</span><span class="op" id="6534453">(</span><span class="ident" id="6534454">time</span><span class="op" id="6534458">.</span><span class="ident" id="6534459">Now</span><span class="op" id="6534462">(</span><span class="op" id="6534463">)</span><span class="op" id="6534464">.</span><span class="ident" id="6534465">Add</span><span class="op" id="6534468">(</span><span class="ident" id="6534469">someTimeout</span><span class="op" id="6534480">)</span><span class="op" id="6534481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534484">c3</span><span class="op" id="6534486">.</span><span class="ident" id="6534487">SetReadDeadline</span><span class="op" id="6534502">(</span><span class="ident" id="6534503">time</span><span class="op" id="6534507">.</span><span class="ident" id="6534508">Now</span><span class="op" id="6534511">(</span><span class="op" id="6534512">)</span><span class="op" id="6534513">.</span><span class="ident" id="6534514">Add</span><span class="op" id="6534517">(</span><span class="ident" id="6534518">someTimeout</span><span class="op" id="6534529">)</span><span class="op" id="6534530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534533">c3</span><span class="op" id="6534535">.</span><span class="ident" id="6534536">SetWriteDeadline</span><span class="op" id="6534552">(</span><span class="ident" id="6534553">time</span><span class="op" id="6534557">.</span><span class="ident" id="6534558">Now</span><span class="op" id="6534561">(</span><span class="op" id="6534562">)</span><span class="op" id="6534563">.</span><span class="ident" id="6534564">Add</span><span class="op" id="6534567">(</span><span class="ident" id="6534568">someTimeout</span><span class="op" id="6534579">)</span><span class="op" id="6534580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534583">c3</span><span class="op" id="6534585">.</span><span class="ident" id="6534586">SetReadBuffer</span><span class="op" id="6534599">(</span><span class="num" id="6534600">2048</span><span class="op" id="6534604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534607">c3</span><span class="op" id="6534609">.</span><span class="ident" id="6534610">SetWriteBuffer</span><span class="op" id="6534624">(</span><span class="num" id="6534625">2048</span><span class="op" id="6534629">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534633">wb</span>&nbsp;<span class="op" id="6534636">:=</span>&nbsp;<span class="op" id="6534639">[</span><span class="op" id="6534640">]</span><span class="builtintype" id="6534641">byte</span><span class="op" id="6534645">(</span><span class="string" id="6534646">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="6534661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534664">rb1</span>&nbsp;<span class="op" id="6534668">:=</span>&nbsp;<span class="builtinfunc" id="6534671">make</span><span class="op" id="6534675">(</span><span class="op" id="6534676">[</span><span class="op" id="6534677">]</span><span class="builtintype" id="6534678">byte</span><span class="op" id="6534682">,</span>&nbsp;<span class="num" id="6534684">128</span><span class="op" id="6534687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534690">rb2</span>&nbsp;<span class="op" id="6534694">:=</span>&nbsp;<span class="builtinfunc" id="6534697">make</span><span class="op" id="6534701">(</span><span class="op" id="6534702">[</span><span class="op" id="6534703">]</span><span class="builtintype" id="6534704">byte</span><span class="op" id="6534708">,</span>&nbsp;<span class="num" id="6534710">128</span><span class="op" id="6534713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534716">rb3</span>&nbsp;<span class="op" id="6534720">:=</span>&nbsp;<span class="builtinfunc" id="6534723">make</span><span class="op" id="6534727">(</span><span class="op" id="6534728">[</span><span class="op" id="6534729">]</span><span class="builtintype" id="6534730">byte</span><span class="op" id="6534734">,</span>&nbsp;<span class="num" id="6534736">128</span><span class="op" id="6534739">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534742">if</span>&nbsp;<span class="ident" id="6534745">_</span><span class="op" id="6534746">,</span>&nbsp;<span class="ident" id="6534748">_</span><span class="op" id="6534749">,</span>&nbsp;<span class="ident" id="6534751">err</span>&nbsp;<span class="op" id="6534755">:=</span>&nbsp;<span class="ident" id="6534758">c1</span><span class="op" id="6534760">.</span><span class="ident" id="6534761">WriteMsgUnix</span><span class="op" id="6534773">(</span><span class="ident" id="6534774">wb</span><span class="op" id="6534776">,</span>&nbsp;<span class="builtintype" id="6534778">nil</span><span class="op" id="6534781">,</span>&nbsp;<span class="ident" id="6534783">a2</span><span class="op" id="6534785">)</span><span class="op" id="6534786">;</span>&nbsp;<span class="ident" id="6534788">err</span>&nbsp;<span class="op" id="6534792">!=</span>&nbsp;<span class="builtintype" id="6534795">nil</span>&nbsp;<span class="op" id="6534799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534803">t</span><span class="op" id="6534804">.</span><span class="ident" id="6534805">Fatalf</span><span class="op" id="6534811">(</span><span class="string" id="6534812">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6534846">,</span>&nbsp;<span class="ident" id="6534848">err</span><span class="op" id="6534851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534857">if</span>&nbsp;<span class="ident" id="6534860">_</span><span class="op" id="6534861">,</span>&nbsp;<span class="ident" id="6534863">_</span><span class="op" id="6534864">,</span>&nbsp;<span class="ident" id="6534866">_</span><span class="op" id="6534867">,</span>&nbsp;<span class="ident" id="6534869">_</span><span class="op" id="6534870">,</span>&nbsp;<span class="ident" id="6534872">err</span>&nbsp;<span class="op" id="6534876">:=</span>&nbsp;<span class="ident" id="6534879">c2</span><span class="op" id="6534881">.</span><span class="ident" id="6534882">ReadMsgUnix</span><span class="op" id="6534893">(</span><span class="ident" id="6534894">rb2</span><span class="op" id="6534897">,</span>&nbsp;<span class="builtintype" id="6534899">nil</span><span class="op" id="6534902">)</span><span class="op" id="6534903">;</span>&nbsp;<span class="ident" id="6534905">err</span>&nbsp;<span class="op" id="6534909">!=</span>&nbsp;<span class="builtintype" id="6534912">nil</span>&nbsp;<span class="op" id="6534916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534920">t</span><span class="op" id="6534921">.</span><span class="ident" id="6534922">Fatalf</span><span class="op" id="6534928">(</span><span class="string" id="6534929">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6534962">,</span>&nbsp;<span class="ident" id="6534964">err</span><span class="op" id="6534967">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534973">if</span>&nbsp;<span class="ident" id="6534976">_</span><span class="op" id="6534977">,</span>&nbsp;<span class="ident" id="6534979">err</span>&nbsp;<span class="op" id="6534983">:=</span>&nbsp;<span class="ident" id="6534986">c2</span><span class="op" id="6534988">.</span><span class="ident" id="6534989">WriteToUnix</span><span class="op" id="6535000">(</span><span class="ident" id="6535001">wb</span><span class="op" id="6535003">,</span>&nbsp;<span class="ident" id="6535005">a1</span><span class="op" id="6535007">)</span><span class="op" id="6535008">;</span>&nbsp;<span class="ident" id="6535010">err</span>&nbsp;<span class="op" id="6535014">!=</span>&nbsp;<span class="builtintype" id="6535017">nil</span>&nbsp;<span class="op" id="6535021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535025">t</span><span class="op" id="6535026">.</span><span class="ident" id="6535027">Fatalf</span><span class="op" id="6535033">(</span><span class="string" id="6535034">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535067">,</span>&nbsp;<span class="ident" id="6535069">err</span><span class="op" id="6535072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535078">if</span>&nbsp;<span class="ident" id="6535081">_</span><span class="op" id="6535082">,</span>&nbsp;<span class="ident" id="6535084">_</span><span class="op" id="6535085">,</span>&nbsp;<span class="ident" id="6535087">err</span>&nbsp;<span class="op" id="6535091">:=</span>&nbsp;<span class="ident" id="6535094">c1</span><span class="op" id="6535096">.</span><span class="ident" id="6535097">ReadFromUnix</span><span class="op" id="6535109">(</span><span class="ident" id="6535110">rb1</span><span class="op" id="6535113">)</span><span class="op" id="6535114">;</span>&nbsp;<span class="ident" id="6535116">err</span>&nbsp;<span class="op" id="6535120">!=</span>&nbsp;<span class="builtintype" id="6535123">nil</span>&nbsp;<span class="op" id="6535127">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535131">t</span><span class="op" id="6535132">.</span><span class="ident" id="6535133">Fatalf</span><span class="op" id="6535139">(</span><span class="string" id="6535140">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535174">,</span>&nbsp;<span class="ident" id="6535176">err</span><span class="op" id="6535179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535185">if</span>&nbsp;<span class="ident" id="6535188">_</span><span class="op" id="6535189">,</span>&nbsp;<span class="ident" id="6535191">err</span>&nbsp;<span class="op" id="6535195">:=</span>&nbsp;<span class="ident" id="6535198">c3</span><span class="op" id="6535200">.</span><span class="ident" id="6535201">WriteToUnix</span><span class="op" id="6535212">(</span><span class="ident" id="6535213">wb</span><span class="op" id="6535215">,</span>&nbsp;<span class="ident" id="6535217">a1</span><span class="op" id="6535219">)</span><span class="op" id="6535220">;</span>&nbsp;<span class="ident" id="6535222">err</span>&nbsp;<span class="op" id="6535226">!=</span>&nbsp;<span class="builtintype" id="6535229">nil</span>&nbsp;<span class="op" id="6535233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535237">t</span><span class="op" id="6535238">.</span><span class="ident" id="6535239">Fatalf</span><span class="op" id="6535245">(</span><span class="string" id="6535246">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535279">,</span>&nbsp;<span class="ident" id="6535281">err</span><span class="op" id="6535284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535287">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535290">if</span>&nbsp;<span class="ident" id="6535293">_</span><span class="op" id="6535294">,</span>&nbsp;<span class="ident" id="6535296">_</span><span class="op" id="6535297">,</span>&nbsp;<span class="ident" id="6535299">err</span>&nbsp;<span class="op" id="6535303">:=</span>&nbsp;<span class="ident" id="6535306">c1</span><span class="op" id="6535308">.</span><span class="ident" id="6535309">ReadFromUnix</span><span class="op" id="6535321">(</span><span class="ident" id="6535322">rb1</span><span class="op" id="6535325">)</span><span class="op" id="6535326">;</span>&nbsp;<span class="ident" id="6535328">err</span>&nbsp;<span class="op" id="6535332">!=</span>&nbsp;<span class="builtintype" id="6535335">nil</span>&nbsp;<span class="op" id="6535339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535343">t</span><span class="op" id="6535344">.</span><span class="ident" id="6535345">Fatalf</span><span class="op" id="6535351">(</span><span class="string" id="6535352">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535386">,</span>&nbsp;<span class="ident" id="6535388">err</span><span class="op" id="6535391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535397">if</span>&nbsp;<span class="ident" id="6535400">_</span><span class="op" id="6535401">,</span>&nbsp;<span class="ident" id="6535403">err</span>&nbsp;<span class="op" id="6535407">:=</span>&nbsp;<span class="ident" id="6535410">c2</span><span class="op" id="6535412">.</span><span class="ident" id="6535413">WriteToUnix</span><span class="op" id="6535424">(</span><span class="ident" id="6535425">wb</span><span class="op" id="6535427">,</span>&nbsp;<span class="ident" id="6535429">a3</span><span class="op" id="6535431">)</span><span class="op" id="6535432">;</span>&nbsp;<span class="ident" id="6535434">err</span>&nbsp;<span class="op" id="6535438">!=</span>&nbsp;<span class="builtintype" id="6535441">nil</span>&nbsp;<span class="op" id="6535445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535449">t</span><span class="op" id="6535450">.</span><span class="ident" id="6535451">Fatalf</span><span class="op" id="6535457">(</span><span class="string" id="6535458">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535491">,</span>&nbsp;<span class="ident" id="6535493">err</span><span class="op" id="6535496">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535502">if</span>&nbsp;<span class="ident" id="6535505">_</span><span class="op" id="6535506">,</span>&nbsp;<span class="ident" id="6535508">_</span><span class="op" id="6535509">,</span>&nbsp;<span class="ident" id="6535511">err</span>&nbsp;<span class="op" id="6535515">:=</span>&nbsp;<span class="ident" id="6535518">c3</span><span class="op" id="6535520">.</span><span class="ident" id="6535521">ReadFromUnix</span><span class="op" id="6535533">(</span><span class="ident" id="6535534">rb3</span><span class="op" id="6535537">)</span><span class="op" id="6535538">;</span>&nbsp;<span class="ident" id="6535540">err</span>&nbsp;<span class="op" id="6535544">!=</span>&nbsp;<span class="builtintype" id="6535547">nil</span>&nbsp;<span class="op" id="6535551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535555">t</span><span class="op" id="6535556">.</span><span class="ident" id="6535557">Fatalf</span><span class="op" id="6535563">(</span><span class="string" id="6535564">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535598">,</span>&nbsp;<span class="ident" id="6535600">err</span><span class="op" id="6535603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535610">if</span>&nbsp;<span class="ident" id="6535613">f</span><span class="op" id="6535614">,</span>&nbsp;<span class="ident" id="6535616">err</span>&nbsp;<span class="op" id="6535620">:=</span>&nbsp;<span class="ident" id="6535623">c1</span><span class="op" id="6535625">.</span><span class="ident" id="6535626">File</span><span class="op" id="6535630">(</span><span class="op" id="6535631">)</span><span class="op" id="6535632">;</span>&nbsp;<span class="ident" id="6535634">err</span>&nbsp;<span class="op" id="6535638">!=</span>&nbsp;<span class="builtintype" id="6535641">nil</span>&nbsp;<span class="op" id="6535645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535649">t</span><span class="op" id="6535650">.</span><span class="ident" id="6535651">Fatalf</span><span class="op" id="6535657">(</span><span class="string" id="6535658">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6535684">,</span>&nbsp;<span class="ident" id="6535686">err</span><span class="op" id="6535689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535692">}</span>&nbsp;<span class="keyword" id="6535694">else</span>&nbsp;<span class="op" id="6535699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535703">f</span><span class="op" id="6535704">.</span><span class="ident" id="6535705">Close</span><span class="op" id="6535710">(</span><span class="op" id="6535711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535714">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535718">defer</span>&nbsp;<span class="keyword" id="6535724">func</span><span class="op" id="6535728">(</span><span class="op" id="6535729">)</span>&nbsp;<span class="op" id="6535731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6535735">if</span>&nbsp;<span class="ident" id="6535738">p</span>&nbsp;<span class="op" id="6535740">:=</span>&nbsp;<span class="builtinfunc" id="6535743">recover</span><span class="op" id="6535750">(</span><span class="op" id="6535751">)</span><span class="op" id="6535752">;</span>&nbsp;<span class="ident" id="6535754">p</span>&nbsp;<span class="op" id="6535756">!=</span>&nbsp;<span class="builtintype" id="6535759">nil</span>&nbsp;<span class="op" id="6535763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535768">t</span><span class="op" id="6535769">.</span><span class="ident" id="6535770">Fatalf</span><span class="op" id="6535776">(</span><span class="string" id="6535777">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6535828">,</span>&nbsp;<span class="ident" id="6535830">p</span><span class="op" id="6535831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535835">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535838">}</span><span class="op" id="6535839">(</span><span class="op" id="6535840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535844">c1</span><span class="op" id="6535846">.</span><span class="ident" id="6535847">WriteToUnix</span><span class="op" id="6535858">(</span><span class="ident" id="6535859">wb</span><span class="op" id="6535861">,</span>&nbsp;<span class="builtintype" id="6535863">nil</span><span class="op" id="6535866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535869">c1</span><span class="op" id="6535871">.</span><span class="ident" id="6535872">WriteMsgUnix</span><span class="op" id="6535884">(</span><span class="ident" id="6535885">wb</span><span class="op" id="6535887">,</span>&nbsp;<span class="builtintype" id="6535889">nil</span><span class="op" id="6535892">,</span>&nbsp;<span class="builtintype" id="6535894">nil</span><span class="op" id="6535897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535900">c3</span><span class="op" id="6535902">.</span><span class="ident" id="6535903">WriteToUnix</span><span class="op" id="6535914">(</span><span class="ident" id="6535915">wb</span><span class="op" id="6535917">,</span>&nbsp;<span class="builtintype" id="6535919">nil</span><span class="op" id="6535922">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535925">c3</span><span class="op" id="6535927">.</span><span class="ident" id="6535928">WriteMsgUnix</span><span class="op" id="6535940">(</span><span class="ident" id="6535941">wb</span><span class="op" id="6535943">,</span>&nbsp;<span class="builtintype" id="6535945">nil</span><span class="op" id="6535948">,</span>&nbsp;<span class="builtintype" id="6535950">nil</span><span class="op" id="6535953">)</span><br>
<span class="lineno"></span><span class="op" id="6535955">}</span>
</div>
</body>
</html>
