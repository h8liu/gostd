<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html" class="current">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4527793">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4527848">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4527902">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4527953">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes;&nbsp;specifically</span><br>
<span class="lineno"></span><span class="comment" id="4528013">//&nbsp;expressions,&nbsp;statements,&nbsp;declarations,&nbsp;and&nbsp;files.&nbsp;It&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="4528074">//&nbsp;the&nbsp;print&nbsp;functionality&nbsp;implemented&nbsp;in&nbsp;printer.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4528129">package</span>&nbsp;<span class="ident" id="4528137">printer</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4528146">import</span>&nbsp;<span class="op" id="4528153">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528156">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528165">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528175">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4528187">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4528202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4528205">//&nbsp;Formatting&nbsp;issues:</span><br>
<span class="lineno"></span><span class="comment" id="4528227">//&nbsp;-&nbsp;better&nbsp;comment&nbsp;formatting&nbsp;for&nbsp;/*-style&nbsp;comments&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;(e.g.&nbsp;a&nbsp;declaration)</span><br>
<span class="lineno">20</span><span class="comment" id="4528322">//&nbsp;&nbsp;&nbsp;when&nbsp;the&nbsp;comment&nbsp;spans&nbsp;multiple&nbsp;lines;&nbsp;if&nbsp;such&nbsp;a&nbsp;comment&nbsp;is&nbsp;just&nbsp;two&nbsp;lines,&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4528417">//&nbsp;&nbsp;&nbsp;not&nbsp;idempotent</span><br>
<span class="lineno"></span><span class="comment" id="4528437">//&nbsp;-&nbsp;formatting&nbsp;of&nbsp;expression&nbsp;lists</span><br>
<span class="lineno"></span><span class="comment" id="4528473">//&nbsp;-&nbsp;should&nbsp;use&nbsp;blank&nbsp;instead&nbsp;of&nbsp;tab&nbsp;to&nbsp;separate&nbsp;one-line&nbsp;function&nbsp;bodies&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4528552">//&nbsp;&nbsp;&nbsp;the&nbsp;function&nbsp;header&nbsp;unless&nbsp;there&nbsp;is&nbsp;a&nbsp;group&nbsp;of&nbsp;consecutive&nbsp;one-liners</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4528628">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4528708">//&nbsp;Common&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4528730">//&nbsp;Print&nbsp;as&nbsp;many&nbsp;newlines&nbsp;as&nbsp;necessary&nbsp;(but&nbsp;at&nbsp;least&nbsp;min&nbsp;newlines)&nbsp;to&nbsp;get&nbsp;to</span><br>
<span class="lineno">30</span><span class="comment" id="4528807">//&nbsp;the&nbsp;current&nbsp;line.&nbsp;ws&nbsp;is&nbsp;printed&nbsp;before&nbsp;the&nbsp;first&nbsp;line&nbsp;break.&nbsp;If&nbsp;newSection</span><br>
<span class="lineno"></span><span class="comment" id="4528885">//&nbsp;is&nbsp;set,&nbsp;the&nbsp;first&nbsp;line&nbsp;break&nbsp;is&nbsp;printed&nbsp;as&nbsp;formfeed.&nbsp;Returns&nbsp;true&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4528961">//&nbsp;line&nbsp;break&nbsp;was&nbsp;printed;&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4529013">//</span><br>
<span class="lineno"></span><span class="comment" id="4529016">//&nbsp;TODO(gri):&nbsp;linebreak&nbsp;may&nbsp;add&nbsp;too&nbsp;many&nbsp;lines&nbsp;if&nbsp;the&nbsp;next&nbsp;statement&nbsp;at&nbsp;&#34;line&#34;</span><br>
<span class="lineno">35</span><span class="comment" id="4529095">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;preceded&nbsp;by&nbsp;comments&nbsp;because&nbsp;the&nbsp;computation&nbsp;of&nbsp;n&nbsp;assumes</span><br>
<span class="lineno"></span><span class="comment" id="4529170">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;position&nbsp;before&nbsp;the&nbsp;comment&nbsp;and&nbsp;the&nbsp;target&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4529248">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;the&nbsp;comment.&nbsp;Thus,&nbsp;after&nbsp;interspersing&nbsp;such&nbsp;comments,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4529326">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;space&nbsp;taken&nbsp;up&nbsp;by&nbsp;them&nbsp;is&nbsp;not&nbsp;considered&nbsp;to&nbsp;reduce&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4529405">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linebreaks.&nbsp;At&nbsp;the&nbsp;moment&nbsp;there&nbsp;is&nbsp;no&nbsp;easy&nbsp;way&nbsp;to&nbsp;know&nbsp;about</span><br>
<span class="lineno">40</span><span class="comment" id="4529480">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;(not&nbsp;yet&nbsp;interspersed)&nbsp;comments&nbsp;in&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4529551">//</span><br>
<span class="lineno"></span><span class="keyword" id="4529554">func</span>&nbsp;<span class="op" id="4529559">(</span><span class="ident" id="4529560">p</span>&nbsp;<span class="op" id="4529562">*</span><span class="ident" id="4529563">printer</span><span class="op" id="4529570">)</span>&nbsp;<span class="ident" id="4529572">linebreak</span><span class="op" id="4529581">(</span><span class="ident" id="4529582">line</span><span class="op" id="4529586">,</span>&nbsp;<span class="ident" id="4529588">min</span>&nbsp;<span class="builtintype" id="4529592">int</span><span class="op" id="4529595">,</span>&nbsp;<span class="ident" id="4529597">ws</span>&nbsp;<span class="ident" id="4529600">whiteSpace</span><span class="op" id="4529610">,</span>&nbsp;<span class="ident" id="4529612">newSection</span>&nbsp;<span class="builtintype" id="4529623">bool</span><span class="op" id="4529627">)</span>&nbsp;<span class="op" id="4529629">(</span><span class="ident" id="4529630">printedBreak</span>&nbsp;<span class="builtintype" id="4529643">bool</span><span class="op" id="4529647">)</span>&nbsp;<span class="op" id="4529649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529652">n</span>&nbsp;<span class="op" id="4529654">:=</span>&nbsp;<span class="ident" id="4529657">nlimit</span><span class="op" id="4529663">(</span><span class="ident" id="4529664">line</span>&nbsp;<span class="op" id="4529669">-</span>&nbsp;<span class="ident" id="4529671">p</span><span class="op" id="4529672">.</span><span class="ident" id="4529673">pos</span><span class="op" id="4529676">.</span><span class="ident" id="4529677">Line</span><span class="op" id="4529681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4529684">if</span>&nbsp;<span class="ident" id="4529687">n</span>&nbsp;<span class="op" id="4529689">&lt;</span>&nbsp;<span class="ident" id="4529691">min</span>&nbsp;<span class="op" id="4529695">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529699">n</span>&nbsp;<span class="op" id="4529701">=</span>&nbsp;<span class="ident" id="4529703">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4529708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4529711">if</span>&nbsp;<span class="ident" id="4529714">n</span>&nbsp;<span class="op" id="4529716">&gt;</span>&nbsp;<span class="num" id="4529718">0</span>&nbsp;<span class="op" id="4529720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529724">p</span><span class="op" id="4529725">.</span><span class="builtinfunc" id="4529726">print</span><span class="op" id="4529731">(</span><span class="ident" id="4529732">ws</span><span class="op" id="4529734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4529738">if</span>&nbsp;<span class="ident" id="4529741">newSection</span>&nbsp;<span class="op" id="4529752">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529757">p</span><span class="op" id="4529758">.</span><span class="builtinfunc" id="4529759">print</span><span class="op" id="4529764">(</span><span class="ident" id="4529765">formfeed</span><span class="op" id="4529773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529778">n</span><span class="op" id="4529779">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4529784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4529788">for</span>&nbsp;<span class="op" id="4529792">;</span>&nbsp;<span class="ident" id="4529794">n</span>&nbsp;<span class="op" id="4529796">&gt;</span>&nbsp;<span class="num" id="4529798">0</span><span class="op" id="4529799">;</span>&nbsp;<span class="ident" id="4529801">n</span><span class="op" id="4529802">--</span>&nbsp;<span class="op" id="4529805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529810">p</span><span class="op" id="4529811">.</span><span class="builtinfunc" id="4529812">print</span><span class="op" id="4529817">(</span><span class="ident" id="4529818">newline</span><span class="op" id="4529825">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4529829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4529833">printedBreak</span>&nbsp;<span class="op" id="4529846">=</span>&nbsp;<span class="builtintype" id="4529848">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4529854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4529857">return</span><br>
<span class="lineno"></span><span class="op" id="4529864">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="4529867">//&nbsp;setComment&nbsp;sets&nbsp;g&nbsp;as&nbsp;the&nbsp;next&nbsp;comment&nbsp;if&nbsp;g&nbsp;!=&nbsp;nil&nbsp;and&nbsp;if&nbsp;node&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="4529941">//&nbsp;are&nbsp;enabled&nbsp;-&nbsp;this&nbsp;mode&nbsp;is&nbsp;used&nbsp;when&nbsp;printing&nbsp;source&nbsp;code&nbsp;fragments&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="4530017">//&nbsp;as&nbsp;exports&nbsp;only.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;pending&nbsp;comment&nbsp;in&nbsp;p.comments</span><br>
<span class="lineno"></span><span class="comment" id="4530095">//&nbsp;and&nbsp;at&nbsp;most&nbsp;one&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache.</span><br>
<span class="lineno">65</span><span class="keyword" id="4530154">func</span>&nbsp;<span class="op" id="4530159">(</span><span class="ident" id="4530160">p</span>&nbsp;<span class="op" id="4530162">*</span><span class="ident" id="4530163">printer</span><span class="op" id="4530170">)</span>&nbsp;<span class="ident" id="4530172">setComment</span><span class="op" id="4530182">(</span><span class="ident" id="4530183">g</span>&nbsp;<span class="op" id="4530185">*</span><span class="ident" id="4530186">ast</span><span class="op" id="4530189">.</span><span class="ident" id="4530190">CommentGroup</span><span class="op" id="4530202">)</span>&nbsp;<span class="op" id="4530204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4530207">if</span>&nbsp;<span class="ident" id="4530210">g</span>&nbsp;<span class="op" id="4530212">==</span>&nbsp;<span class="ident" id="4530215">nil</span>&nbsp;<span class="op" id="4530219">||</span>&nbsp;<span class="op" id="4530222">!</span><span class="ident" id="4530223">p</span><span class="op" id="4530224">.</span><span class="ident" id="4530225">useNodeComments</span>&nbsp;<span class="op" id="4530241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4530245">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4530253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4530256">if</span>&nbsp;<span class="ident" id="4530259">p</span><span class="op" id="4530260">.</span><span class="ident" id="4530261">comments</span>&nbsp;<span class="op" id="4530270">==</span>&nbsp;<span class="ident" id="4530273">nil</span>&nbsp;<span class="op" id="4530277">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530281">//&nbsp;initialize&nbsp;p.comments&nbsp;lazily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4530315">p</span><span class="op" id="4530316">.</span><span class="ident" id="4530317">comments</span>&nbsp;<span class="op" id="4530326">=</span>&nbsp;<span class="builtinfunc" id="4530328">make</span><span class="op" id="4530332">(</span><span class="op" id="4530333">[</span><span class="op" id="4530334">]</span><span class="op" id="4530335">*</span><span class="ident" id="4530336">ast</span><span class="op" id="4530339">.</span><span class="ident" id="4530340">CommentGroup</span><span class="op" id="4530352">,</span>&nbsp;<span class="num" id="4530354">1</span><span class="op" id="4530355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4530358">}</span>&nbsp;<span class="keyword" id="4530360">else</span>&nbsp;<span class="keyword" id="4530365">if</span>&nbsp;<span class="ident" id="4530368">p</span><span class="op" id="4530369">.</span><span class="ident" id="4530370">cindex</span>&nbsp;<span class="op" id="4530377">&lt;</span>&nbsp;<span class="builtinfunc" id="4530379">len</span><span class="op" id="4530382">(</span><span class="ident" id="4530383">p</span><span class="op" id="4530384">.</span><span class="ident" id="4530385">comments</span><span class="op" id="4530393">)</span>&nbsp;<span class="op" id="4530395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530399">//&nbsp;for&nbsp;some&nbsp;reason&nbsp;there&nbsp;are&nbsp;pending&nbsp;comments;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530453">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;-&nbsp;handle&nbsp;gracefully&nbsp;and&nbsp;flush</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530508">//&nbsp;all&nbsp;comments&nbsp;up&nbsp;to&nbsp;g,&nbsp;ignore&nbsp;anything&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4530562">p</span><span class="op" id="4530563">.</span><span class="ident" id="4530564">flush</span><span class="op" id="4530569">(</span><span class="ident" id="4530570">p</span><span class="op" id="4530571">.</span><span class="ident" id="4530572">posFor</span><span class="op" id="4530578">(</span><span class="ident" id="4530579">g</span><span class="op" id="4530580">.</span><span class="ident" id="4530581">List</span><span class="op" id="4530585">[</span><span class="num" id="4530586">0</span><span class="op" id="4530587">]</span><span class="op" id="4530588">.</span><span class="ident" id="4530589">Pos</span><span class="op" id="4530592">(</span><span class="op" id="4530593">)</span><span class="op" id="4530594">)</span><span class="op" id="4530595">,</span>&nbsp;<span class="ident" id="4530597">token</span><span class="op" id="4530602">.</span><span class="ident" id="4530603">ILLEGAL</span><span class="op" id="4530610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4530614">p</span><span class="op" id="4530615">.</span><span class="ident" id="4530616">comments</span>&nbsp;<span class="op" id="4530625">=</span>&nbsp;<span class="ident" id="4530627">p</span><span class="op" id="4530628">.</span><span class="ident" id="4530629">comments</span><span class="op" id="4530637">[</span><span class="num" id="4530638">0</span><span class="op" id="4530639">:</span><span class="num" id="4530640">1</span><span class="op" id="4530641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530645">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;report&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4530678">p</span><span class="op" id="4530679">.</span><span class="ident" id="4530680">internalError</span><span class="op" id="4530693">(</span><span class="string" id="4530694">&#34;setComment&nbsp;found&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="4530729">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4530732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4530735">p</span><span class="op" id="4530736">.</span><span class="ident" id="4530737">comments</span><span class="op" id="4530745">[</span><span class="num" id="4530746">0</span><span class="op" id="4530747">]</span>&nbsp;<span class="op" id="4530749">=</span>&nbsp;<span class="ident" id="4530751">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4530754">p</span><span class="op" id="4530755">.</span><span class="ident" id="4530756">cindex</span>&nbsp;<span class="op" id="4530763">=</span>&nbsp;<span class="num" id="4530765">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530768">//&nbsp;don&#39;t&nbsp;overwrite&nbsp;any&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530831">//&nbsp;(there&nbsp;may&nbsp;be&nbsp;a&nbsp;pending&nbsp;comment&nbsp;when&nbsp;a&nbsp;line&nbsp;comment&nbsp;is</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530890">//&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;lead&nbsp;comment&nbsp;with&nbsp;no&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4530947">//&nbsp;tokens&nbsp;between)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4530967">if</span>&nbsp;<span class="ident" id="4530970">p</span><span class="op" id="4530971">.</span><span class="ident" id="4530972">commentOffset</span>&nbsp;<span class="op" id="4530986">==</span>&nbsp;<span class="ident" id="4530989">infinity</span>&nbsp;<span class="op" id="4530998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531002">p</span><span class="op" id="4531003">.</span><span class="ident" id="4531004">nextComment</span><span class="op" id="4531015">(</span><span class="op" id="4531016">)</span>&nbsp;<span class="comment" id="4531018">//&nbsp;get&nbsp;comment&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4531048">}</span><br>
<span class="lineno">90</span><span class="op" id="4531050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4531053">type</span>&nbsp;<span class="ident" id="4531058">exprListMode</span>&nbsp;<span class="builtintype" id="4531071">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4531077">const</span>&nbsp;<span class="op" id="4531083">(</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531086">commaTerm</span>&nbsp;<span class="ident" id="4531096">exprListMode</span>&nbsp;<span class="op" id="4531109">=</span>&nbsp;<span class="num" id="4531111">1</span>&nbsp;<span class="op" id="4531113">&lt;&lt;</span>&nbsp;<span class="ident" id="4531116">iota</span>&nbsp;<span class="comment" id="4531121">//&nbsp;list&nbsp;is&nbsp;optionally&nbsp;terminated&nbsp;by&nbsp;a&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531166">noIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4531201">//&nbsp;no&nbsp;extra&nbsp;indentation&nbsp;in&nbsp;multi-line&nbsp;lists</span><br>
<span class="lineno"></span><span class="op" id="4531245">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531248">//&nbsp;If&nbsp;indent&nbsp;is&nbsp;set,&nbsp;a&nbsp;multi-line&nbsp;identifier&nbsp;list&nbsp;is&nbsp;indented&nbsp;after&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="4531320">//&nbsp;first&nbsp;linebreak&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="4531352">func</span>&nbsp;<span class="op" id="4531357">(</span><span class="ident" id="4531358">p</span>&nbsp;<span class="op" id="4531360">*</span><span class="ident" id="4531361">printer</span><span class="op" id="4531368">)</span>&nbsp;<span class="ident" id="4531370">identList</span><span class="op" id="4531379">(</span><span class="ident" id="4531380">list</span>&nbsp;<span class="op" id="4531385">[</span><span class="op" id="4531386">]</span><span class="op" id="4531387">*</span><span class="ident" id="4531388">ast</span><span class="op" id="4531391">.</span><span class="ident" id="4531392">Ident</span><span class="op" id="4531397">,</span>&nbsp;<span class="ident" id="4531399">indent</span>&nbsp;<span class="builtintype" id="4531406">bool</span><span class="op" id="4531410">)</span>&nbsp;<span class="op" id="4531412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4531415">//&nbsp;convert&nbsp;into&nbsp;an&nbsp;expression&nbsp;list&nbsp;so&nbsp;we&nbsp;can&nbsp;re-use&nbsp;exprList&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531488">xlist</span>&nbsp;<span class="op" id="4531494">:=</span>&nbsp;<span class="builtinfunc" id="4531497">make</span><span class="op" id="4531501">(</span><span class="op" id="4531502">[</span><span class="op" id="4531503">]</span><span class="ident" id="4531504">ast</span><span class="op" id="4531507">.</span><span class="ident" id="4531508">Expr</span><span class="op" id="4531512">,</span>&nbsp;<span class="builtinfunc" id="4531514">len</span><span class="op" id="4531517">(</span><span class="ident" id="4531518">list</span><span class="op" id="4531522">)</span><span class="op" id="4531523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4531526">for</span>&nbsp;<span class="ident" id="4531530">i</span><span class="op" id="4531531">,</span>&nbsp;<span class="ident" id="4531533">x</span>&nbsp;<span class="op" id="4531535">:=</span>&nbsp;<span class="keyword" id="4531538">range</span>&nbsp;<span class="ident" id="4531544">list</span>&nbsp;<span class="op" id="4531549">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531553">xlist</span><span class="op" id="4531558">[</span><span class="ident" id="4531559">i</span><span class="op" id="4531560">]</span>&nbsp;<span class="op" id="4531562">=</span>&nbsp;<span class="ident" id="4531564">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4531567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4531570">var</span>&nbsp;<span class="ident" id="4531574">mode</span>&nbsp;<span class="ident" id="4531579">exprListMode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4531593">if</span>&nbsp;<span class="op" id="4531596">!</span><span class="ident" id="4531597">indent</span>&nbsp;<span class="op" id="4531604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531608">mode</span>&nbsp;<span class="op" id="4531613">=</span>&nbsp;<span class="ident" id="4531615">noIndent</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4531625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4531628">p</span><span class="op" id="4531629">.</span><span class="ident" id="4531630">exprList</span><span class="op" id="4531638">(</span><span class="ident" id="4531639">token</span><span class="op" id="4531644">.</span><span class="ident" id="4531645">NoPos</span><span class="op" id="4531650">,</span>&nbsp;<span class="ident" id="4531652">xlist</span><span class="op" id="4531657">,</span>&nbsp;<span class="num" id="4531659">1</span><span class="op" id="4531660">,</span>&nbsp;<span class="ident" id="4531662">mode</span><span class="op" id="4531666">,</span>&nbsp;<span class="ident" id="4531668">token</span><span class="op" id="4531673">.</span><span class="ident" id="4531674">NoPos</span><span class="op" id="4531679">)</span><br>
<span class="lineno"></span><span class="op" id="4531681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531684">//&nbsp;Print&nbsp;a&nbsp;list&nbsp;of&nbsp;expressions.&nbsp;If&nbsp;the&nbsp;list&nbsp;spans&nbsp;multiple</span><br>
<span class="lineno">115</span><span class="comment" id="4531743">//&nbsp;source&nbsp;lines,&nbsp;the&nbsp;original&nbsp;line&nbsp;breaks&nbsp;are&nbsp;respected&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="4531807">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="4531823">//</span><br>
<span class="lineno"></span><span class="comment" id="4531826">//&nbsp;TODO(gri)&nbsp;Consider&nbsp;rewriting&nbsp;this&nbsp;to&nbsp;be&nbsp;independent&nbsp;of&nbsp;[]ast.Expr</span><br>
<span class="lineno"></span><span class="comment" id="4531895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;the&nbsp;algorithm&nbsp;for&nbsp;any&nbsp;kind&nbsp;of&nbsp;list</span><br>
<span class="lineno">120</span><span class="comment" id="4531962">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.,&nbsp;pass&nbsp;list&nbsp;via&nbsp;a&nbsp;channel&nbsp;over&nbsp;which&nbsp;to&nbsp;range).</span><br>
<span class="lineno"></span><span class="keyword" id="4532028">func</span>&nbsp;<span class="op" id="4532033">(</span><span class="ident" id="4532034">p</span>&nbsp;<span class="op" id="4532036">*</span><span class="ident" id="4532037">printer</span><span class="op" id="4532044">)</span>&nbsp;<span class="ident" id="4532046">exprList</span><span class="op" id="4532054">(</span><span class="ident" id="4532055">prev0</span>&nbsp;<span class="ident" id="4532061">token</span><span class="op" id="4532066">.</span><span class="ident" id="4532067">Pos</span><span class="op" id="4532070">,</span>&nbsp;<span class="ident" id="4532072">list</span>&nbsp;<span class="op" id="4532077">[</span><span class="op" id="4532078">]</span><span class="ident" id="4532079">ast</span><span class="op" id="4532082">.</span><span class="ident" id="4532083">Expr</span><span class="op" id="4532087">,</span>&nbsp;<span class="ident" id="4532089">depth</span>&nbsp;<span class="builtintype" id="4532095">int</span><span class="op" id="4532098">,</span>&nbsp;<span class="ident" id="4532100">mode</span>&nbsp;<span class="ident" id="4532105">exprListMode</span><span class="op" id="4532117">,</span>&nbsp;<span class="ident" id="4532119">next0</span>&nbsp;<span class="ident" id="4532125">token</span><span class="op" id="4532130">.</span><span class="ident" id="4532131">Pos</span><span class="op" id="4532134">)</span>&nbsp;<span class="op" id="4532136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532139">if</span>&nbsp;<span class="builtinfunc" id="4532142">len</span><span class="op" id="4532145">(</span><span class="ident" id="4532146">list</span><span class="op" id="4532150">)</span>&nbsp;<span class="op" id="4532152">==</span>&nbsp;<span class="num" id="4532155">0</span>&nbsp;<span class="op" id="4532157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532161">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4532169">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532173">prev</span>&nbsp;<span class="op" id="4532178">:=</span>&nbsp;<span class="ident" id="4532181">p</span><span class="op" id="4532182">.</span><span class="ident" id="4532183">posFor</span><span class="op" id="4532189">(</span><span class="ident" id="4532190">prev0</span><span class="op" id="4532195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532198">next</span>&nbsp;<span class="op" id="4532203">:=</span>&nbsp;<span class="ident" id="4532206">p</span><span class="op" id="4532207">.</span><span class="ident" id="4532208">posFor</span><span class="op" id="4532214">(</span><span class="ident" id="4532215">next0</span><span class="op" id="4532220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532223">line</span>&nbsp;<span class="op" id="4532228">:=</span>&nbsp;<span class="ident" id="4532231">p</span><span class="op" id="4532232">.</span><span class="ident" id="4532233">lineFor</span><span class="op" id="4532240">(</span><span class="ident" id="4532241">list</span><span class="op" id="4532245">[</span><span class="num" id="4532246">0</span><span class="op" id="4532247">]</span><span class="op" id="4532248">.</span><span class="ident" id="4532249">Pos</span><span class="op" id="4532252">(</span><span class="op" id="4532253">)</span><span class="op" id="4532254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532257">endLine</span>&nbsp;<span class="op" id="4532265">:=</span>&nbsp;<span class="ident" id="4532268">p</span><span class="op" id="4532269">.</span><span class="ident" id="4532270">lineFor</span><span class="op" id="4532277">(</span><span class="ident" id="4532278">list</span><span class="op" id="4532282">[</span><span class="builtinfunc" id="4532283">len</span><span class="op" id="4532286">(</span><span class="ident" id="4532287">list</span><span class="op" id="4532291">)</span><span class="op" id="4532292">-</span><span class="num" id="4532293">1</span><span class="op" id="4532294">]</span><span class="op" id="4532295">.</span><span class="ident" id="4532296">End</span><span class="op" id="4532299">(</span><span class="op" id="4532300">)</span><span class="op" id="4532301">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532305">if</span>&nbsp;<span class="ident" id="4532308">prev</span><span class="op" id="4532312">.</span><span class="ident" id="4532313">IsValid</span><span class="op" id="4532320">(</span><span class="op" id="4532321">)</span>&nbsp;<span class="op" id="4532323">&amp;&amp;</span>&nbsp;<span class="ident" id="4532326">prev</span><span class="op" id="4532330">.</span><span class="ident" id="4532331">Line</span>&nbsp;<span class="op" id="4532336">==</span>&nbsp;<span class="ident" id="4532339">line</span>&nbsp;<span class="op" id="4532344">&amp;&amp;</span>&nbsp;<span class="ident" id="4532347">line</span>&nbsp;<span class="op" id="4532352">==</span>&nbsp;<span class="ident" id="4532355">endLine</span>&nbsp;<span class="op" id="4532363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532367">//&nbsp;all&nbsp;list&nbsp;entries&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532406">for</span>&nbsp;<span class="ident" id="4532410">i</span><span class="op" id="4532411">,</span>&nbsp;<span class="ident" id="4532413">x</span>&nbsp;<span class="op" id="4532415">:=</span>&nbsp;<span class="keyword" id="4532418">range</span>&nbsp;<span class="ident" id="4532424">list</span>&nbsp;<span class="op" id="4532429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532434">if</span>&nbsp;<span class="ident" id="4532437">i</span>&nbsp;<span class="op" id="4532439">&gt;</span>&nbsp;<span class="num" id="4532441">0</span>&nbsp;<span class="op" id="4532443">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532449">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532506">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532558">p</span><span class="op" id="4532559">.</span><span class="builtinfunc" id="4532560">print</span><span class="op" id="4532565">(</span><span class="ident" id="4532566">x</span><span class="op" id="4532567">.</span><span class="ident" id="4532568">Pos</span><span class="op" id="4532571">(</span><span class="op" id="4532572">)</span><span class="op" id="4532573">,</span>&nbsp;<span class="ident" id="4532575">token</span><span class="op" id="4532580">.</span><span class="ident" id="4532581">COMMA</span><span class="op" id="4532586">,</span>&nbsp;<span class="ident" id="4532588">blank</span><span class="op" id="4532593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4532598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532603">p</span><span class="op" id="4532604">.</span><span class="ident" id="4532605">expr0</span><span class="op" id="4532610">(</span><span class="ident" id="4532611">x</span><span class="op" id="4532612">,</span>&nbsp;<span class="ident" id="4532614">depth</span><span class="op" id="4532619">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4532623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4532635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532639">//&nbsp;list&nbsp;entries&nbsp;span&nbsp;multiple&nbsp;lines;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532677">//&nbsp;use&nbsp;source&nbsp;code&nbsp;positions&nbsp;to&nbsp;guide&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532729">//&nbsp;don&#39;t&nbsp;add&nbsp;extra&nbsp;indentation&nbsp;if&nbsp;noIndent&nbsp;is&nbsp;set;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532781">//&nbsp;i.e.,&nbsp;pretend&nbsp;that&nbsp;the&nbsp;first&nbsp;line&nbsp;is&nbsp;already&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532839">ws</span>&nbsp;<span class="op" id="4532842">:=</span>&nbsp;<span class="ident" id="4532845">ignore</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4532853">if</span>&nbsp;<span class="ident" id="4532856">mode</span><span class="op" id="4532860">&amp;</span><span class="ident" id="4532861">noIndent</span>&nbsp;<span class="op" id="4532870">==</span>&nbsp;<span class="num" id="4532873">0</span>&nbsp;<span class="op" id="4532875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4532879">ws</span>&nbsp;<span class="op" id="4532882">=</span>&nbsp;<span class="ident" id="4532884">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4532892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532896">//&nbsp;the&nbsp;first&nbsp;linebreak&nbsp;is&nbsp;always&nbsp;a&nbsp;formfeed&nbsp;since&nbsp;this&nbsp;section&nbsp;must&nbsp;not</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4532969">//&nbsp;depend&nbsp;on&nbsp;any&nbsp;previous&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533007">prevBreak</span>&nbsp;<span class="op" id="4533017">:=</span>&nbsp;<span class="op" id="4533020">-</span><span class="num" id="4533021">1</span>&nbsp;<span class="comment" id="4533023">//&nbsp;index&nbsp;of&nbsp;last&nbsp;expression&nbsp;that&nbsp;was&nbsp;followed&nbsp;by&nbsp;a&nbsp;linebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4533085">if</span>&nbsp;<span class="ident" id="4533088">prev</span><span class="op" id="4533092">.</span><span class="ident" id="4533093">IsValid</span><span class="op" id="4533100">(</span><span class="op" id="4533101">)</span>&nbsp;<span class="op" id="4533103">&amp;&amp;</span>&nbsp;<span class="ident" id="4533106">prev</span><span class="op" id="4533110">.</span><span class="ident" id="4533111">Line</span>&nbsp;<span class="op" id="4533116">&lt;</span>&nbsp;<span class="ident" id="4533118">line</span>&nbsp;<span class="op" id="4533123">&amp;&amp;</span>&nbsp;<span class="ident" id="4533126">p</span><span class="op" id="4533127">.</span><span class="ident" id="4533128">linebreak</span><span class="op" id="4533137">(</span><span class="ident" id="4533138">line</span><span class="op" id="4533142">,</span>&nbsp;<span class="num" id="4533144">0</span><span class="op" id="4533145">,</span>&nbsp;<span class="ident" id="4533147">ws</span><span class="op" id="4533149">,</span>&nbsp;<span class="builtintype" id="4533151">true</span><span class="op" id="4533155">)</span>&nbsp;<span class="op" id="4533157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533161">ws</span>&nbsp;<span class="op" id="4533164">=</span>&nbsp;<span class="ident" id="4533166">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533175">prevBreak</span>&nbsp;<span class="op" id="4533185">=</span>&nbsp;<span class="num" id="4533187">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4533190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533194">//&nbsp;initialize&nbsp;expression/key&nbsp;size:&nbsp;a&nbsp;zero&nbsp;value&nbsp;indicates&nbsp;expr/key&nbsp;doesn&#39;t&nbsp;fit&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533291">size</span>&nbsp;<span class="op" id="4533296">:=</span>&nbsp;<span class="num" id="4533299">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533303">//&nbsp;print&nbsp;all&nbsp;list&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533331">prevLine</span>&nbsp;<span class="op" id="4533340">:=</span>&nbsp;<span class="ident" id="4533343">prev</span><span class="op" id="4533347">.</span><span class="ident" id="4533348">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4533354">for</span>&nbsp;<span class="ident" id="4533358">i</span><span class="op" id="4533359">,</span>&nbsp;<span class="ident" id="4533361">x</span>&nbsp;<span class="op" id="4533363">:=</span>&nbsp;<span class="keyword" id="4533366">range</span>&nbsp;<span class="ident" id="4533372">list</span>&nbsp;<span class="op" id="4533377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533381">line</span>&nbsp;<span class="op" id="4533386">=</span>&nbsp;<span class="ident" id="4533388">p</span><span class="op" id="4533389">.</span><span class="ident" id="4533390">lineFor</span><span class="op" id="4533397">(</span><span class="ident" id="4533398">x</span><span class="op" id="4533399">.</span><span class="ident" id="4533400">Pos</span><span class="op" id="4533403">(</span><span class="op" id="4533404">)</span><span class="op" id="4533405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533410">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;next&nbsp;linebreak,&nbsp;if&nbsp;any,&nbsp;needs&nbsp;to&nbsp;use&nbsp;formfeed:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533479">//&nbsp;in&nbsp;general,&nbsp;use&nbsp;the&nbsp;entire&nbsp;node&nbsp;size&nbsp;to&nbsp;make&nbsp;the&nbsp;decision;&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533547">//&nbsp;key:value&nbsp;expressions,&nbsp;use&nbsp;the&nbsp;key&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533592">//&nbsp;TODO(gri)&nbsp;for&nbsp;a&nbsp;better&nbsp;result,&nbsp;should&nbsp;probably&nbsp;incorporate&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533661">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;key&nbsp;and&nbsp;the&nbsp;node&nbsp;size&nbsp;into&nbsp;the&nbsp;decision&nbsp;process</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533728">useFF</span>&nbsp;<span class="op" id="4533734">:=</span>&nbsp;<span class="builtintype" id="4533737">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533745">//&nbsp;determine&nbsp;element&nbsp;size:&nbsp;all&nbsp;bets&nbsp;are&nbsp;off&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533808">//&nbsp;position&nbsp;information&nbsp;for&nbsp;the&nbsp;previous&nbsp;and&nbsp;next&nbsp;token&nbsp;(likely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533874">//&nbsp;generated&nbsp;code&nbsp;-&nbsp;simply&nbsp;ignore&nbsp;the&nbsp;size&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;setting</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4533943">//&nbsp;it&nbsp;to&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4533957">prevSize</span>&nbsp;<span class="op" id="4533966">:=</span>&nbsp;<span class="ident" id="4533969">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4533976">const</span>&nbsp;<span class="ident" id="4533982">infinity</span>&nbsp;<span class="op" id="4533991">=</span>&nbsp;<span class="num" id="4533993">1e6</span>&nbsp;<span class="comment" id="4533997">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;source&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534030">size</span>&nbsp;<span class="op" id="4534035">=</span>&nbsp;<span class="ident" id="4534037">p</span><span class="op" id="4534038">.</span><span class="ident" id="4534039">nodeSize</span><span class="op" id="4534047">(</span><span class="ident" id="4534048">x</span><span class="op" id="4534049">,</span>&nbsp;<span class="ident" id="4534051">infinity</span><span class="op" id="4534059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534063">pair</span><span class="op" id="4534067">,</span>&nbsp;<span class="ident" id="4534069">isPair</span>&nbsp;<span class="op" id="4534076">:=</span>&nbsp;<span class="ident" id="4534079">x</span><span class="op" id="4534080">.</span><span class="op" id="4534081">(</span><span class="op" id="4534082">*</span><span class="ident" id="4534083">ast</span><span class="op" id="4534086">.</span><span class="ident" id="4534087">KeyValueExpr</span><span class="op" id="4534099">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534103">if</span>&nbsp;<span class="ident" id="4534106">size</span>&nbsp;<span class="op" id="4534111">&lt;=</span>&nbsp;<span class="ident" id="4534114">infinity</span>&nbsp;<span class="op" id="4534123">&amp;&amp;</span>&nbsp;<span class="ident" id="4534126">prev</span><span class="op" id="4534130">.</span><span class="ident" id="4534131">IsValid</span><span class="op" id="4534138">(</span><span class="op" id="4534139">)</span>&nbsp;<span class="op" id="4534141">&amp;&amp;</span>&nbsp;<span class="ident" id="4534144">next</span><span class="op" id="4534148">.</span><span class="ident" id="4534149">IsValid</span><span class="op" id="4534156">(</span><span class="op" id="4534157">)</span>&nbsp;<span class="op" id="4534159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534164">//&nbsp;x&nbsp;fits&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534194">if</span>&nbsp;<span class="ident" id="4534197">isPair</span>&nbsp;<span class="op" id="4534204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534210">size</span>&nbsp;<span class="op" id="4534215">=</span>&nbsp;<span class="ident" id="4534217">p</span><span class="op" id="4534218">.</span><span class="ident" id="4534219">nodeSize</span><span class="op" id="4534227">(</span><span class="ident" id="4534228">pair</span><span class="op" id="4534232">.</span><span class="ident" id="4534233">Key</span><span class="op" id="4534236">,</span>&nbsp;<span class="ident" id="4534238">infinity</span><span class="op" id="4534246">)</span>&nbsp;<span class="comment" id="4534248">//&nbsp;size&nbsp;&lt;=&nbsp;infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4534271">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4534275">}</span>&nbsp;<span class="keyword" id="4534277">else</span>&nbsp;<span class="op" id="4534282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534287">//&nbsp;size&nbsp;too&nbsp;large&nbsp;or&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;good&nbsp;layout&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534349">size</span>&nbsp;<span class="op" id="4534354">=</span>&nbsp;<span class="num" id="4534356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4534360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534365">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;line&nbsp;and&nbsp;the&nbsp;current&nbsp;line&nbsp;had&nbsp;single-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534424">//&nbsp;line-expressions&nbsp;and&nbsp;the&nbsp;key&nbsp;sizes&nbsp;are&nbsp;small&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534481">//&nbsp;the&nbsp;ratio&nbsp;between&nbsp;the&nbsp;key&nbsp;sizes&nbsp;does&nbsp;not&nbsp;exceed&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534536">//&nbsp;threshold,&nbsp;align&nbsp;columns&nbsp;and&nbsp;do&nbsp;not&nbsp;use&nbsp;formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534590">if</span>&nbsp;<span class="ident" id="4534593">prevSize</span>&nbsp;<span class="op" id="4534602">&gt;</span>&nbsp;<span class="num" id="4534604">0</span>&nbsp;<span class="op" id="4534606">&amp;&amp;</span>&nbsp;<span class="ident" id="4534609">size</span>&nbsp;<span class="op" id="4534614">&gt;</span>&nbsp;<span class="num" id="4534616">0</span>&nbsp;<span class="op" id="4534618">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534623">const</span>&nbsp;<span class="ident" id="4534629">smallSize</span>&nbsp;<span class="op" id="4534639">=</span>&nbsp;<span class="num" id="4534641">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534647">if</span>&nbsp;<span class="ident" id="4534650">prevSize</span>&nbsp;<span class="op" id="4534659">&lt;=</span>&nbsp;<span class="ident" id="4534662">smallSize</span>&nbsp;<span class="op" id="4534672">&amp;&amp;</span>&nbsp;<span class="ident" id="4534675">size</span>&nbsp;<span class="op" id="4534680">&lt;=</span>&nbsp;<span class="ident" id="4534683">smallSize</span>&nbsp;<span class="op" id="4534693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534699">useFF</span>&nbsp;<span class="op" id="4534705">=</span>&nbsp;<span class="builtintype" id="4534707">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4534716">}</span>&nbsp;<span class="keyword" id="4534718">else</span>&nbsp;<span class="op" id="4534723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534729">const</span>&nbsp;<span class="ident" id="4534735">r</span>&nbsp;<span class="op" id="4534737">=</span>&nbsp;<span class="num" id="4534739">4</span>&nbsp;<span class="comment" id="4534741">//&nbsp;threshold</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534758">ratio</span>&nbsp;<span class="op" id="4534764">:=</span>&nbsp;<span class="builtintype" id="4534767">float64</span><span class="op" id="4534774">(</span><span class="ident" id="4534775">size</span><span class="op" id="4534779">)</span>&nbsp;<span class="op" id="4534781">/</span>&nbsp;<span class="builtintype" id="4534783">float64</span><span class="op" id="4534790">(</span><span class="ident" id="4534791">prevSize</span><span class="op" id="4534799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534805">useFF</span>&nbsp;<span class="op" id="4534811">=</span>&nbsp;<span class="ident" id="4534813">ratio</span>&nbsp;<span class="op" id="4534819">&lt;=</span>&nbsp;<span class="num" id="4534822">1.0</span><span class="op" id="4534825">/</span><span class="ident" id="4534826">r</span>&nbsp;<span class="op" id="4534828">||</span>&nbsp;<span class="ident" id="4534831">r</span>&nbsp;<span class="op" id="4534833">&lt;=</span>&nbsp;<span class="ident" id="4534836">ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4534845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4534849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4534854">needsLinebreak</span>&nbsp;<span class="op" id="4534869">:=</span>&nbsp;<span class="num" id="4534872">0</span>&nbsp;<span class="op" id="4534874">&lt;</span>&nbsp;<span class="ident" id="4534876">prevLine</span>&nbsp;<span class="op" id="4534885">&amp;&amp;</span>&nbsp;<span class="ident" id="4534888">prevLine</span>&nbsp;<span class="op" id="4534897">&lt;</span>&nbsp;<span class="ident" id="4534899">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4534906">if</span>&nbsp;<span class="ident" id="4534909">i</span>&nbsp;<span class="op" id="4534911">&gt;</span>&nbsp;<span class="num" id="4534913">0</span>&nbsp;<span class="op" id="4534915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534920">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534976">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535032">//&nbsp;only&nbsp;if&nbsp;the&nbsp;expression&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4535081">if</span>&nbsp;<span class="op" id="4535084">!</span><span class="ident" id="4535085">needsLinebreak</span>&nbsp;<span class="op" id="4535100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535106">p</span><span class="op" id="4535107">.</span><span class="builtinfunc" id="4535108">print</span><span class="op" id="4535113">(</span><span class="ident" id="4535114">x</span><span class="op" id="4535115">.</span><span class="ident" id="4535116">Pos</span><span class="op" id="4535119">(</span><span class="op" id="4535120">)</span><span class="op" id="4535121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4535126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535131">p</span><span class="op" id="4535132">.</span><span class="builtinfunc" id="4535133">print</span><span class="op" id="4535138">(</span><span class="ident" id="4535139">token</span><span class="op" id="4535144">.</span><span class="ident" id="4535145">COMMA</span><span class="op" id="4535150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535155">needsBlank</span>&nbsp;<span class="op" id="4535166">:=</span>&nbsp;<span class="builtintype" id="4535169">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4535177">if</span>&nbsp;<span class="ident" id="4535180">needsLinebreak</span>&nbsp;<span class="op" id="4535195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535201">//&nbsp;lines&nbsp;are&nbsp;broken&nbsp;using&nbsp;newlines&nbsp;so&nbsp;comments&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535267">//&nbsp;unless&nbsp;forceFF&nbsp;is&nbsp;set&nbsp;or&nbsp;there&nbsp;are&nbsp;multiple&nbsp;expressions&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535333">//&nbsp;the&nbsp;same&nbsp;line&nbsp;in&nbsp;which&nbsp;case&nbsp;formfeed&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4535385">if</span>&nbsp;<span class="ident" id="4535388">p</span><span class="op" id="4535389">.</span><span class="ident" id="4535390">linebreak</span><span class="op" id="4535399">(</span><span class="ident" id="4535400">line</span><span class="op" id="4535404">,</span>&nbsp;<span class="num" id="4535406">0</span><span class="op" id="4535407">,</span>&nbsp;<span class="ident" id="4535409">ws</span><span class="op" id="4535411">,</span>&nbsp;<span class="ident" id="4535413">useFF</span>&nbsp;<span class="op" id="4535419">||</span>&nbsp;<span class="ident" id="4535422">prevBreak</span><span class="op" id="4535431">+</span><span class="num" id="4535432">1</span>&nbsp;<span class="op" id="4535434">&lt;</span>&nbsp;<span class="ident" id="4535436">i</span><span class="op" id="4535437">)</span>&nbsp;<span class="op" id="4535439">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535446">ws</span>&nbsp;<span class="op" id="4535449">=</span>&nbsp;<span class="ident" id="4535451">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535463">prevBreak</span>&nbsp;<span class="op" id="4535473">=</span>&nbsp;<span class="ident" id="4535475">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535482">needsBlank</span>&nbsp;<span class="op" id="4535493">=</span>&nbsp;<span class="builtintype" id="4535495">false</span>&nbsp;<span class="comment" id="4535501">//&nbsp;we&nbsp;got&nbsp;a&nbsp;line&nbsp;break&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4535536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4535541">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4535546">if</span>&nbsp;<span class="ident" id="4535549">needsBlank</span>&nbsp;<span class="op" id="4535560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535566">p</span><span class="op" id="4535567">.</span><span class="builtinfunc" id="4535568">print</span><span class="op" id="4535573">(</span><span class="ident" id="4535574">blank</span><span class="op" id="4535579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4535584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4535588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4535593">if</span>&nbsp;<span class="builtinfunc" id="4535596">len</span><span class="op" id="4535599">(</span><span class="ident" id="4535600">list</span><span class="op" id="4535604">)</span>&nbsp;<span class="op" id="4535606">&gt;</span>&nbsp;<span class="num" id="4535608">1</span>&nbsp;<span class="op" id="4535610">&amp;&amp;</span>&nbsp;<span class="ident" id="4535613">isPair</span>&nbsp;<span class="op" id="4535620">&amp;&amp;</span>&nbsp;<span class="ident" id="4535623">size</span>&nbsp;<span class="op" id="4535628">&gt;</span>&nbsp;<span class="num" id="4535630">0</span>&nbsp;<span class="op" id="4535632">&amp;&amp;</span>&nbsp;<span class="ident" id="4535635">needsLinebreak</span>&nbsp;<span class="op" id="4535650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535655">//&nbsp;we&nbsp;have&nbsp;a&nbsp;key:value&nbsp;expression&nbsp;that&nbsp;fits&nbsp;onto&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535716">//&nbsp;and&nbsp;it&#39;s&nbsp;not&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;prior&nbsp;expression:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535777">//&nbsp;use&nbsp;a&nbsp;column&nbsp;for&nbsp;the&nbsp;key&nbsp;such&nbsp;that&nbsp;consecutive&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535838">//&nbsp;can&nbsp;align&nbsp;if&nbsp;possible</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4535866">//&nbsp;(needsLinebreak&nbsp;is&nbsp;set&nbsp;if&nbsp;we&nbsp;started&nbsp;a&nbsp;new&nbsp;line&nbsp;before)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535928">p</span><span class="op" id="4535929">.</span><span class="ident" id="4535930">expr</span><span class="op" id="4535934">(</span><span class="ident" id="4535935">pair</span><span class="op" id="4535939">.</span><span class="ident" id="4535940">Key</span><span class="op" id="4535943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535948">p</span><span class="op" id="4535949">.</span><span class="builtinfunc" id="4535950">print</span><span class="op" id="4535955">(</span><span class="ident" id="4535956">pair</span><span class="op" id="4535960">.</span><span class="ident" id="4535961">Colon</span><span class="op" id="4535966">,</span>&nbsp;<span class="ident" id="4535968">token</span><span class="op" id="4535973">.</span><span class="ident" id="4535974">COLON</span><span class="op" id="4535979">,</span>&nbsp;<span class="ident" id="4535981">vtab</span><span class="op" id="4535985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535990">p</span><span class="op" id="4535991">.</span><span class="ident" id="4535992">expr</span><span class="op" id="4535996">(</span><span class="ident" id="4535997">pair</span><span class="op" id="4536001">.</span><span class="ident" id="4536002">Value</span><span class="op" id="4536007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536011">}</span>&nbsp;<span class="keyword" id="4536013">else</span>&nbsp;<span class="op" id="4536018">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536023">p</span><span class="op" id="4536024">.</span><span class="ident" id="4536025">expr0</span><span class="op" id="4536030">(</span><span class="ident" id="4536031">x</span><span class="op" id="4536032">,</span>&nbsp;<span class="ident" id="4536034">depth</span><span class="op" id="4536039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536048">prevLine</span>&nbsp;<span class="op" id="4536057">=</span>&nbsp;<span class="ident" id="4536059">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536065">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536069">if</span>&nbsp;<span class="ident" id="4536072">mode</span><span class="op" id="4536076">&amp;</span><span class="ident" id="4536077">commaTerm</span>&nbsp;<span class="op" id="4536087">!=</span>&nbsp;<span class="num" id="4536090">0</span>&nbsp;<span class="op" id="4536092">&amp;&amp;</span>&nbsp;<span class="ident" id="4536095">next</span><span class="op" id="4536099">.</span><span class="ident" id="4536100">IsValid</span><span class="op" id="4536107">(</span><span class="op" id="4536108">)</span>&nbsp;<span class="op" id="4536110">&amp;&amp;</span>&nbsp;<span class="ident" id="4536113">p</span><span class="op" id="4536114">.</span><span class="ident" id="4536115">pos</span><span class="op" id="4536118">.</span><span class="ident" id="4536119">Line</span>&nbsp;<span class="op" id="4536124">&lt;</span>&nbsp;<span class="ident" id="4536126">next</span><span class="op" id="4536130">.</span><span class="ident" id="4536131">Line</span>&nbsp;<span class="op" id="4536136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4536140">//&nbsp;print&nbsp;a&nbsp;terminating&nbsp;comma&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536206">p</span><span class="op" id="4536207">.</span><span class="builtinfunc" id="4536208">print</span><span class="op" id="4536213">(</span><span class="ident" id="4536214">token</span><span class="op" id="4536219">.</span><span class="ident" id="4536220">COMMA</span><span class="op" id="4536225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536229">if</span>&nbsp;<span class="ident" id="4536232">ws</span>&nbsp;<span class="op" id="4536235">==</span>&nbsp;<span class="ident" id="4536238">ignore</span>&nbsp;<span class="op" id="4536245">&amp;&amp;</span>&nbsp;<span class="ident" id="4536248">mode</span><span class="op" id="4536252">&amp;</span><span class="ident" id="4536253">noIndent</span>&nbsp;<span class="op" id="4536262">==</span>&nbsp;<span class="num" id="4536265">0</span>&nbsp;<span class="op" id="4536267">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4536272">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536302">p</span><span class="op" id="4536303">.</span><span class="builtinfunc" id="4536304">print</span><span class="op" id="4536309">(</span><span class="ident" id="4536310">unindent</span><span class="op" id="4536318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536326">p</span><span class="op" id="4536327">.</span><span class="builtinfunc" id="4536328">print</span><span class="op" id="4536333">(</span><span class="ident" id="4536334">formfeed</span><span class="op" id="4536342">)</span>&nbsp;<span class="comment" id="4536344">//&nbsp;terminating&nbsp;comma&nbsp;needs&nbsp;a&nbsp;line&nbsp;break&nbsp;to&nbsp;look&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536399">return</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536411">if</span>&nbsp;<span class="ident" id="4536414">ws</span>&nbsp;<span class="op" id="4536417">==</span>&nbsp;<span class="ident" id="4536420">ignore</span>&nbsp;<span class="op" id="4536427">&amp;&amp;</span>&nbsp;<span class="ident" id="4536430">mode</span><span class="op" id="4536434">&amp;</span><span class="ident" id="4536435">noIndent</span>&nbsp;<span class="op" id="4536444">==</span>&nbsp;<span class="num" id="4536447">0</span>&nbsp;<span class="op" id="4536449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4536453">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536482">p</span><span class="op" id="4536483">.</span><span class="builtinfunc" id="4536484">print</span><span class="op" id="4536489">(</span><span class="ident" id="4536490">unindent</span><span class="op" id="4536498">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536501">}</span><br>
<span class="lineno"></span><span class="op" id="4536503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4536506">func</span>&nbsp;<span class="op" id="4536511">(</span><span class="ident" id="4536512">p</span>&nbsp;<span class="op" id="4536514">*</span><span class="ident" id="4536515">printer</span><span class="op" id="4536522">)</span>&nbsp;<span class="ident" id="4536524">parameters</span><span class="op" id="4536534">(</span><span class="ident" id="4536535">fields</span>&nbsp;<span class="op" id="4536542">*</span><span class="ident" id="4536543">ast</span><span class="op" id="4536546">.</span><span class="ident" id="4536547">FieldList</span><span class="op" id="4536556">)</span>&nbsp;<span class="op" id="4536558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536561">p</span><span class="op" id="4536562">.</span><span class="builtinfunc" id="4536563">print</span><span class="op" id="4536568">(</span><span class="ident" id="4536569">fields</span><span class="op" id="4536575">.</span><span class="ident" id="4536576">Opening</span><span class="op" id="4536583">,</span>&nbsp;<span class="ident" id="4536585">token</span><span class="op" id="4536590">.</span><span class="ident" id="4536591">LPAREN</span><span class="op" id="4536597">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536600">if</span>&nbsp;<span class="builtinfunc" id="4536603">len</span><span class="op" id="4536606">(</span><span class="ident" id="4536607">fields</span><span class="op" id="4536613">.</span><span class="ident" id="4536614">List</span><span class="op" id="4536618">)</span>&nbsp;<span class="op" id="4536620">&gt;</span>&nbsp;<span class="num" id="4536622">0</span>&nbsp;<span class="op" id="4536624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536628">prevLine</span>&nbsp;<span class="op" id="4536637">:=</span>&nbsp;<span class="ident" id="4536640">p</span><span class="op" id="4536641">.</span><span class="ident" id="4536642">lineFor</span><span class="op" id="4536649">(</span><span class="ident" id="4536650">fields</span><span class="op" id="4536656">.</span><span class="ident" id="4536657">Opening</span><span class="op" id="4536664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536668">ws</span>&nbsp;<span class="op" id="4536671">:=</span>&nbsp;<span class="ident" id="4536674">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536683">for</span>&nbsp;<span class="ident" id="4536687">i</span><span class="op" id="4536688">,</span>&nbsp;<span class="ident" id="4536690">par</span>&nbsp;<span class="op" id="4536694">:=</span>&nbsp;<span class="keyword" id="4536697">range</span>&nbsp;<span class="ident" id="4536703">fields</span><span class="op" id="4536709">.</span><span class="ident" id="4536710">List</span>&nbsp;<span class="op" id="4536715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4536720">//&nbsp;determine&nbsp;par&nbsp;begin&nbsp;and&nbsp;end&nbsp;line&nbsp;(may&nbsp;be&nbsp;different</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4536777">//&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;parameter&nbsp;names&nbsp;for&nbsp;this&nbsp;par</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4536834">//&nbsp;or&nbsp;the&nbsp;type&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536875">var</span>&nbsp;<span class="ident" id="4536879">parLineBeg</span>&nbsp;<span class="builtintype" id="4536890">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4536897">if</span>&nbsp;<span class="builtinfunc" id="4536900">len</span><span class="op" id="4536903">(</span><span class="ident" id="4536904">par</span><span class="op" id="4536907">.</span><span class="ident" id="4536908">Names</span><span class="op" id="4536913">)</span>&nbsp;<span class="op" id="4536915">&gt;</span>&nbsp;<span class="num" id="4536917">0</span>&nbsp;<span class="op" id="4536919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536925">parLineBeg</span>&nbsp;<span class="op" id="4536936">=</span>&nbsp;<span class="ident" id="4536938">p</span><span class="op" id="4536939">.</span><span class="ident" id="4536940">lineFor</span><span class="op" id="4536947">(</span><span class="ident" id="4536948">par</span><span class="op" id="4536951">.</span><span class="ident" id="4536952">Names</span><span class="op" id="4536957">[</span><span class="num" id="4536958">0</span><span class="op" id="4536959">]</span><span class="op" id="4536960">.</span><span class="ident" id="4536961">Pos</span><span class="op" id="4536964">(</span><span class="op" id="4536965">)</span><span class="op" id="4536966">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4536971">}</span>&nbsp;<span class="keyword" id="4536973">else</span>&nbsp;<span class="op" id="4536978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4536984">parLineBeg</span>&nbsp;<span class="op" id="4536995">=</span>&nbsp;<span class="ident" id="4536997">p</span><span class="op" id="4536998">.</span><span class="ident" id="4536999">lineFor</span><span class="op" id="4537006">(</span><span class="ident" id="4537007">par</span><span class="op" id="4537010">.</span><span class="ident" id="4537011">Type</span><span class="op" id="4537015">.</span><span class="ident" id="4537016">Pos</span><span class="op" id="4537019">(</span><span class="op" id="4537020">)</span><span class="op" id="4537021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4537026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4537031">var</span>&nbsp;<span class="ident" id="4537035">parLineEnd</span>&nbsp;<span class="op" id="4537046">=</span>&nbsp;<span class="ident" id="4537048">p</span><span class="op" id="4537049">.</span><span class="ident" id="4537050">lineFor</span><span class="op" id="4537057">(</span><span class="ident" id="4537058">par</span><span class="op" id="4537061">.</span><span class="ident" id="4537062">Type</span><span class="op" id="4537066">.</span><span class="ident" id="4537067">End</span><span class="op" id="4537070">(</span><span class="op" id="4537071">)</span><span class="op" id="4537072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537077">//&nbsp;separating&nbsp;&#34;,&#34;&nbsp;if&nbsp;needed</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4537108">needsLinebreak</span>&nbsp;<span class="op" id="4537123">:=</span>&nbsp;<span class="num" id="4537126">0</span>&nbsp;<span class="op" id="4537128">&lt;</span>&nbsp;<span class="ident" id="4537130">prevLine</span>&nbsp;<span class="op" id="4537139">&amp;&amp;</span>&nbsp;<span class="ident" id="4537142">prevLine</span>&nbsp;<span class="op" id="4537151">&lt;</span>&nbsp;<span class="ident" id="4537153">parLineBeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4537167">if</span>&nbsp;<span class="ident" id="4537170">i</span>&nbsp;<span class="op" id="4537172">&gt;</span>&nbsp;<span class="num" id="4537174">0</span>&nbsp;<span class="op" id="4537176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537182">//&nbsp;use&nbsp;position&nbsp;of&nbsp;parameter&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537238">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comma&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537293">//&nbsp;only&nbsp;if&nbsp;the&nbsp;next&nbsp;parameter&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4537347">if</span>&nbsp;<span class="op" id="4537350">!</span><span class="ident" id="4537351">needsLinebreak</span>&nbsp;<span class="op" id="4537366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4537373">p</span><span class="op" id="4537374">.</span><span class="builtinfunc" id="4537375">print</span><span class="op" id="4537380">(</span><span class="ident" id="4537381">par</span><span class="op" id="4537384">.</span><span class="ident" id="4537385">Pos</span><span class="op" id="4537388">(</span><span class="op" id="4537389">)</span><span class="op" id="4537390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4537396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4537402">p</span><span class="op" id="4537403">.</span><span class="builtinfunc" id="4537404">print</span><span class="op" id="4537409">(</span><span class="ident" id="4537410">token</span><span class="op" id="4537415">.</span><span class="ident" id="4537416">COMMA</span><span class="op" id="4537421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4537426">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537431">//&nbsp;separator&nbsp;if&nbsp;needed&nbsp;(linebreak&nbsp;or&nbsp;blank)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4537478">if</span>&nbsp;<span class="ident" id="4537481">needsLinebreak</span>&nbsp;<span class="op" id="4537496">&amp;&amp;</span>&nbsp;<span class="ident" id="4537499">p</span><span class="op" id="4537500">.</span><span class="ident" id="4537501">linebreak</span><span class="op" id="4537510">(</span><span class="ident" id="4537511">parLineBeg</span><span class="op" id="4537521">,</span>&nbsp;<span class="num" id="4537523">0</span><span class="op" id="4537524">,</span>&nbsp;<span class="ident" id="4537526">ws</span><span class="op" id="4537528">,</span>&nbsp;<span class="builtintype" id="4537530">true</span><span class="op" id="4537534">)</span>&nbsp;<span class="op" id="4537536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537542">//&nbsp;break&nbsp;line&nbsp;if&nbsp;the&nbsp;opening&nbsp;&#34;(&#34;&nbsp;or&nbsp;previous&nbsp;parameter&nbsp;ended&nbsp;on&nbsp;a&nbsp;different&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4537627">ws</span>&nbsp;<span class="op" id="4537630">=</span>&nbsp;<span class="ident" id="4537632">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4537642">}</span>&nbsp;<span class="keyword" id="4537644">else</span>&nbsp;<span class="keyword" id="4537649">if</span>&nbsp;<span class="ident" id="4537652">i</span>&nbsp;<span class="op" id="4537654">&gt;</span>&nbsp;<span class="num" id="4537656">0</span>&nbsp;<span class="op" id="4537658">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4537664">p</span><span class="op" id="4537665">.</span><span class="builtinfunc" id="4537666">print</span><span class="op" id="4537671">(</span><span class="ident" id="4537672">blank</span><span class="op" id="4537677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4537682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537687">//&nbsp;parameter&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4537709">if</span>&nbsp;<span class="builtinfunc" id="4537712">len</span><span class="op" id="4537715">(</span><span class="ident" id="4537716">par</span><span class="op" id="4537719">.</span><span class="ident" id="4537720">Names</span><span class="op" id="4537725">)</span>&nbsp;<span class="op" id="4537727">&gt;</span>&nbsp;<span class="num" id="4537729">0</span>&nbsp;<span class="op" id="4537731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537737">//&nbsp;Very&nbsp;subtle:&nbsp;If&nbsp;we&nbsp;indented&nbsp;before&nbsp;(ws&nbsp;==&nbsp;ignore),&nbsp;identList</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537805">//&nbsp;won&#39;t&nbsp;indent&nbsp;again.&nbsp;If&nbsp;we&nbsp;didn&#39;t&nbsp;(ws&nbsp;==&nbsp;indent),&nbsp;identList&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537876">//&nbsp;indent&nbsp;if&nbsp;the&nbsp;identList&nbsp;spans&nbsp;multiple&nbsp;lines,&nbsp;and&nbsp;it&nbsp;will&nbsp;outdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4537949">//&nbsp;again&nbsp;at&nbsp;the&nbsp;end&nbsp;(and&nbsp;still&nbsp;ws&nbsp;==&nbsp;indent).&nbsp;Thus,&nbsp;a&nbsp;subsequent&nbsp;indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538025">//&nbsp;by&nbsp;a&nbsp;linebreak&nbsp;call&nbsp;after&nbsp;a&nbsp;type,&nbsp;or&nbsp;in&nbsp;the&nbsp;next&nbsp;multi-line&nbsp;identList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538102">//&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538134">p</span><span class="op" id="4538135">.</span><span class="ident" id="4538136">identList</span><span class="op" id="4538145">(</span><span class="ident" id="4538146">par</span><span class="op" id="4538149">.</span><span class="ident" id="4538150">Names</span><span class="op" id="4538155">,</span>&nbsp;<span class="ident" id="4538157">ws</span>&nbsp;<span class="op" id="4538160">==</span>&nbsp;<span class="ident" id="4538163">indent</span><span class="op" id="4538169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538175">p</span><span class="op" id="4538176">.</span><span class="builtinfunc" id="4538177">print</span><span class="op" id="4538182">(</span><span class="ident" id="4538183">blank</span><span class="op" id="4538188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538198">//&nbsp;parameter&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538219">p</span><span class="op" id="4538220">.</span><span class="ident" id="4538221">expr</span><span class="op" id="4538225">(</span><span class="ident" id="4538226">stripParensAlways</span><span class="op" id="4538243">(</span><span class="ident" id="4538244">par</span><span class="op" id="4538247">.</span><span class="ident" id="4538248">Type</span><span class="op" id="4538252">)</span><span class="op" id="4538253">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538258">prevLine</span>&nbsp;<span class="op" id="4538267">=</span>&nbsp;<span class="ident" id="4538269">parLineEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538286">//&nbsp;if&nbsp;the&nbsp;closing&nbsp;&#34;)&#34;&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line&nbsp;from&nbsp;the&nbsp;last&nbsp;parameter,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538357">//&nbsp;print&nbsp;an&nbsp;additional&nbsp;&#34;,&#34;&nbsp;and&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4538401">if</span>&nbsp;<span class="ident" id="4538404">closing</span>&nbsp;<span class="op" id="4538412">:=</span>&nbsp;<span class="ident" id="4538415">p</span><span class="op" id="4538416">.</span><span class="ident" id="4538417">lineFor</span><span class="op" id="4538424">(</span><span class="ident" id="4538425">fields</span><span class="op" id="4538431">.</span><span class="ident" id="4538432">Closing</span><span class="op" id="4538439">)</span><span class="op" id="4538440">;</span>&nbsp;<span class="num" id="4538442">0</span>&nbsp;<span class="op" id="4538444">&lt;</span>&nbsp;<span class="ident" id="4538446">prevLine</span>&nbsp;<span class="op" id="4538455">&amp;&amp;</span>&nbsp;<span class="ident" id="4538458">prevLine</span>&nbsp;<span class="op" id="4538467">&lt;</span>&nbsp;<span class="ident" id="4538469">closing</span>&nbsp;<span class="op" id="4538477">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538482">p</span><span class="op" id="4538483">.</span><span class="builtinfunc" id="4538484">print</span><span class="op" id="4538489">(</span><span class="ident" id="4538490">token</span><span class="op" id="4538495">.</span><span class="ident" id="4538496">COMMA</span><span class="op" id="4538501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538506">p</span><span class="op" id="4538507">.</span><span class="ident" id="4538508">linebreak</span><span class="op" id="4538517">(</span><span class="ident" id="4538518">closing</span><span class="op" id="4538525">,</span>&nbsp;<span class="num" id="4538527">0</span><span class="op" id="4538528">,</span>&nbsp;<span class="ident" id="4538530">ignore</span><span class="op" id="4538536">,</span>&nbsp;<span class="builtintype" id="4538538">true</span><span class="op" id="4538542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538550">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4538579">if</span>&nbsp;<span class="ident" id="4538582">ws</span>&nbsp;<span class="op" id="4538585">==</span>&nbsp;<span class="ident" id="4538588">ignore</span>&nbsp;<span class="op" id="4538595">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538600">p</span><span class="op" id="4538601">.</span><span class="builtinfunc" id="4538602">print</span><span class="op" id="4538607">(</span><span class="ident" id="4538608">unindent</span><span class="op" id="4538616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538626">p</span><span class="op" id="4538627">.</span><span class="builtinfunc" id="4538628">print</span><span class="op" id="4538633">(</span><span class="ident" id="4538634">fields</span><span class="op" id="4538640">.</span><span class="ident" id="4538641">Closing</span><span class="op" id="4538648">,</span>&nbsp;<span class="ident" id="4538650">token</span><span class="op" id="4538655">.</span><span class="ident" id="4538656">RPAREN</span><span class="op" id="4538662">)</span><br>
<span class="lineno"></span><span class="op" id="4538664">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4538667">func</span>&nbsp;<span class="op" id="4538672">(</span><span class="ident" id="4538673">p</span>&nbsp;<span class="op" id="4538675">*</span><span class="ident" id="4538676">printer</span><span class="op" id="4538683">)</span>&nbsp;<span class="ident" id="4538685">signature</span><span class="op" id="4538694">(</span><span class="ident" id="4538695">params</span><span class="op" id="4538701">,</span>&nbsp;<span class="ident" id="4538703">result</span>&nbsp;<span class="op" id="4538710">*</span><span class="ident" id="4538711">ast</span><span class="op" id="4538714">.</span><span class="ident" id="4538715">FieldList</span><span class="op" id="4538724">)</span>&nbsp;<span class="op" id="4538726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4538729">if</span>&nbsp;<span class="ident" id="4538732">params</span>&nbsp;<span class="op" id="4538739">!=</span>&nbsp;<span class="ident" id="4538742">nil</span>&nbsp;<span class="op" id="4538746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538750">p</span><span class="op" id="4538751">.</span><span class="ident" id="4538752">parameters</span><span class="op" id="4538762">(</span><span class="ident" id="4538763">params</span><span class="op" id="4538769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538772">}</span>&nbsp;<span class="keyword" id="4538774">else</span>&nbsp;<span class="op" id="4538779">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538783">p</span><span class="op" id="4538784">.</span><span class="builtinfunc" id="4538785">print</span><span class="op" id="4538790">(</span><span class="ident" id="4538791">token</span><span class="op" id="4538796">.</span><span class="ident" id="4538797">LPAREN</span><span class="op" id="4538803">,</span>&nbsp;<span class="ident" id="4538805">token</span><span class="op" id="4538810">.</span><span class="ident" id="4538811">RPAREN</span><span class="op" id="4538817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538823">n</span>&nbsp;<span class="op" id="4538825">:=</span>&nbsp;<span class="ident" id="4538828">result</span><span class="op" id="4538834">.</span><span class="ident" id="4538835">NumFields</span><span class="op" id="4538844">(</span><span class="op" id="4538845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4538848">if</span>&nbsp;<span class="ident" id="4538851">n</span>&nbsp;<span class="op" id="4538853">&gt;</span>&nbsp;<span class="num" id="4538855">0</span>&nbsp;<span class="op" id="4538857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538861">//&nbsp;result&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538880">p</span><span class="op" id="4538881">.</span><span class="builtinfunc" id="4538882">print</span><span class="op" id="4538887">(</span><span class="ident" id="4538888">blank</span><span class="op" id="4538893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4538897">if</span>&nbsp;<span class="ident" id="4538900">n</span>&nbsp;<span class="op" id="4538902">==</span>&nbsp;<span class="num" id="4538905">1</span>&nbsp;<span class="op" id="4538907">&amp;&amp;</span>&nbsp;<span class="ident" id="4538910">result</span><span class="op" id="4538916">.</span><span class="ident" id="4538917">List</span><span class="op" id="4538921">[</span><span class="num" id="4538922">0</span><span class="op" id="4538923">]</span><span class="op" id="4538924">.</span><span class="ident" id="4538925">Names</span>&nbsp;<span class="op" id="4538931">==</span>&nbsp;<span class="ident" id="4538934">nil</span>&nbsp;<span class="op" id="4538938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4538943">//&nbsp;single&nbsp;anonymous&nbsp;result;&nbsp;no&nbsp;()&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538982">p</span><span class="op" id="4538983">.</span><span class="ident" id="4538984">expr</span><span class="op" id="4538988">(</span><span class="ident" id="4538989">stripParensAlways</span><span class="op" id="4539006">(</span><span class="ident" id="4539007">result</span><span class="op" id="4539013">.</span><span class="ident" id="4539014">List</span><span class="op" id="4539018">[</span><span class="num" id="4539019">0</span><span class="op" id="4539020">]</span><span class="op" id="4539021">.</span><span class="ident" id="4539022">Type</span><span class="op" id="4539026">)</span><span class="op" id="4539027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539032">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539045">p</span><span class="op" id="4539046">.</span><span class="ident" id="4539047">parameters</span><span class="op" id="4539057">(</span><span class="ident" id="4539058">result</span><span class="op" id="4539064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539067">}</span><br>
<span class="lineno"></span><span class="op" id="4539069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4539072">func</span>&nbsp;<span class="ident" id="4539077">identListSize</span><span class="op" id="4539090">(</span><span class="ident" id="4539091">list</span>&nbsp;<span class="op" id="4539096">[</span><span class="op" id="4539097">]</span><span class="op" id="4539098">*</span><span class="ident" id="4539099">ast</span><span class="op" id="4539102">.</span><span class="ident" id="4539103">Ident</span><span class="op" id="4539108">,</span>&nbsp;<span class="ident" id="4539110">maxSize</span>&nbsp;<span class="builtintype" id="4539118">int</span><span class="op" id="4539121">)</span>&nbsp;<span class="op" id="4539123">(</span><span class="ident" id="4539124">size</span>&nbsp;<span class="builtintype" id="4539129">int</span><span class="op" id="4539132">)</span>&nbsp;<span class="op" id="4539134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539137">for</span>&nbsp;<span class="ident" id="4539141">i</span><span class="op" id="4539142">,</span>&nbsp;<span class="ident" id="4539144">x</span>&nbsp;<span class="op" id="4539146">:=</span>&nbsp;<span class="keyword" id="4539149">range</span>&nbsp;<span class="ident" id="4539155">list</span>&nbsp;<span class="op" id="4539160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539164">if</span>&nbsp;<span class="ident" id="4539167">i</span>&nbsp;<span class="op" id="4539169">&gt;</span>&nbsp;<span class="num" id="4539171">0</span>&nbsp;<span class="op" id="4539173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539178">size</span>&nbsp;<span class="op" id="4539183">+=</span>&nbsp;<span class="builtinfunc" id="4539186">len</span><span class="op" id="4539189">(</span><span class="string" id="4539190">&#34;,&nbsp;&#34;</span><span class="op" id="4539194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539198">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539202">size</span>&nbsp;<span class="op" id="4539207">+=</span>&nbsp;<span class="ident" id="4539210">utf8</span><span class="op" id="4539214">.</span><span class="ident" id="4539215">RuneCountInString</span><span class="op" id="4539232">(</span><span class="ident" id="4539233">x</span><span class="op" id="4539234">.</span><span class="ident" id="4539235">Name</span><span class="op" id="4539239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539243">if</span>&nbsp;<span class="ident" id="4539246">size</span>&nbsp;<span class="op" id="4539251">&gt;=</span>&nbsp;<span class="ident" id="4539254">maxSize</span>&nbsp;<span class="op" id="4539262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539267">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539278">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539281">return</span><br>
<span class="lineno"></span><span class="op" id="4539288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4539291">func</span>&nbsp;<span class="op" id="4539296">(</span><span class="ident" id="4539297">p</span>&nbsp;<span class="op" id="4539299">*</span><span class="ident" id="4539300">printer</span><span class="op" id="4539307">)</span>&nbsp;<span class="ident" id="4539309">isOneLineFieldList</span><span class="op" id="4539327">(</span><span class="ident" id="4539328">list</span>&nbsp;<span class="op" id="4539333">[</span><span class="op" id="4539334">]</span><span class="op" id="4539335">*</span><span class="ident" id="4539336">ast</span><span class="op" id="4539339">.</span><span class="ident" id="4539340">Field</span><span class="op" id="4539345">)</span>&nbsp;<span class="builtintype" id="4539347">bool</span>&nbsp;<span class="op" id="4539352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539355">if</span>&nbsp;<span class="builtinfunc" id="4539358">len</span><span class="op" id="4539361">(</span><span class="ident" id="4539362">list</span><span class="op" id="4539366">)</span>&nbsp;<span class="op" id="4539368">!=</span>&nbsp;<span class="num" id="4539371">1</span>&nbsp;<span class="op" id="4539373">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539377">return</span>&nbsp;<span class="builtintype" id="4539384">false</span>&nbsp;<span class="comment" id="4539390">//&nbsp;allow&nbsp;only&nbsp;one&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539418">f</span>&nbsp;<span class="op" id="4539420">:=</span>&nbsp;<span class="ident" id="4539423">list</span><span class="op" id="4539427">[</span><span class="num" id="4539428">0</span><span class="op" id="4539429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539432">if</span>&nbsp;<span class="ident" id="4539435">f</span><span class="op" id="4539436">.</span><span class="ident" id="4539437">Tag</span>&nbsp;<span class="op" id="4539441">!=</span>&nbsp;<span class="ident" id="4539444">nil</span>&nbsp;<span class="op" id="4539448">||</span>&nbsp;<span class="ident" id="4539451">f</span><span class="op" id="4539452">.</span><span class="ident" id="4539453">Comment</span>&nbsp;<span class="op" id="4539461">!=</span>&nbsp;<span class="ident" id="4539464">nil</span>&nbsp;<span class="op" id="4539468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539472">return</span>&nbsp;<span class="builtintype" id="4539479">false</span>&nbsp;<span class="comment" id="4539485">//&nbsp;don&#39;t&nbsp;allow&nbsp;tags&nbsp;or&nbsp;comments</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4539521">//&nbsp;only&nbsp;name(s)&nbsp;and&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539547">const</span>&nbsp;<span class="ident" id="4539553">maxSize</span>&nbsp;<span class="op" id="4539561">=</span>&nbsp;<span class="num" id="4539563">30</span>&nbsp;<span class="comment" id="4539566">//&nbsp;adjust&nbsp;as&nbsp;appropriate,&nbsp;this&nbsp;is&nbsp;an&nbsp;approximate&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539622">namesSize</span>&nbsp;<span class="op" id="4539632">:=</span>&nbsp;<span class="ident" id="4539635">identListSize</span><span class="op" id="4539648">(</span><span class="ident" id="4539649">f</span><span class="op" id="4539650">.</span><span class="ident" id="4539651">Names</span><span class="op" id="4539656">,</span>&nbsp;<span class="ident" id="4539658">maxSize</span><span class="op" id="4539665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539668">if</span>&nbsp;<span class="ident" id="4539671">namesSize</span>&nbsp;<span class="op" id="4539681">&gt;</span>&nbsp;<span class="num" id="4539683">0</span>&nbsp;<span class="op" id="4539685">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539689">namesSize</span>&nbsp;<span class="op" id="4539699">=</span>&nbsp;<span class="num" id="4539701">1</span>&nbsp;<span class="comment" id="4539703">//&nbsp;blank&nbsp;between&nbsp;names&nbsp;and&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539740">typeSize</span>&nbsp;<span class="op" id="4539749">:=</span>&nbsp;<span class="ident" id="4539752">p</span><span class="op" id="4539753">.</span><span class="ident" id="4539754">nodeSize</span><span class="op" id="4539762">(</span><span class="ident" id="4539763">f</span><span class="op" id="4539764">.</span><span class="ident" id="4539765">Type</span><span class="op" id="4539769">,</span>&nbsp;<span class="ident" id="4539771">maxSize</span><span class="op" id="4539778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539781">return</span>&nbsp;<span class="ident" id="4539788">namesSize</span><span class="op" id="4539797">+</span><span class="ident" id="4539798">typeSize</span>&nbsp;<span class="op" id="4539807">&lt;=</span>&nbsp;<span class="ident" id="4539810">maxSize</span><br>
<span class="lineno"></span><span class="op" id="4539818">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="4539821">func</span>&nbsp;<span class="op" id="4539826">(</span><span class="ident" id="4539827">p</span>&nbsp;<span class="op" id="4539829">*</span><span class="ident" id="4539830">printer</span><span class="op" id="4539837">)</span>&nbsp;<span class="ident" id="4539839">setLineComment</span><span class="op" id="4539853">(</span><span class="ident" id="4539854">text</span>&nbsp;<span class="builtintype" id="4539859">string</span><span class="op" id="4539865">)</span>&nbsp;<span class="op" id="4539867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539870">p</span><span class="op" id="4539871">.</span><span class="ident" id="4539872">setComment</span><span class="op" id="4539882">(</span><span class="op" id="4539883">&amp;</span><span class="ident" id="4539884">ast</span><span class="op" id="4539887">.</span><span class="ident" id="4539888">CommentGroup</span><span class="op" id="4539900">{</span><span class="ident" id="4539901">List</span><span class="op" id="4539905">:</span>&nbsp;<span class="op" id="4539907">[</span><span class="op" id="4539908">]</span><span class="op" id="4539909">*</span><span class="ident" id="4539910">ast</span><span class="op" id="4539913">.</span><span class="ident" id="4539914">Comment</span><span class="op" id="4539921">{</span><span class="op" id="4539922">{</span><span class="ident" id="4539923">Slash</span><span class="op" id="4539928">:</span>&nbsp;<span class="ident" id="4539930">token</span><span class="op" id="4539935">.</span><span class="ident" id="4539936">NoPos</span><span class="op" id="4539941">,</span>&nbsp;<span class="ident" id="4539943">Text</span><span class="op" id="4539947">:</span>&nbsp;<span class="ident" id="4539949">text</span><span class="op" id="4539953">}</span><span class="op" id="4539954">}</span><span class="op" id="4539955">}</span><span class="op" id="4539956">)</span><br>
<span class="lineno"></span><span class="op" id="4539958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4539961">func</span>&nbsp;<span class="op" id="4539966">(</span><span class="ident" id="4539967">p</span>&nbsp;<span class="op" id="4539969">*</span><span class="ident" id="4539970">printer</span><span class="op" id="4539977">)</span>&nbsp;<span class="ident" id="4539979">fieldList</span><span class="op" id="4539988">(</span><span class="ident" id="4539989">fields</span>&nbsp;<span class="op" id="4539996">*</span><span class="ident" id="4539997">ast</span><span class="op" id="4540000">.</span><span class="ident" id="4540001">FieldList</span><span class="op" id="4540010">,</span>&nbsp;<span class="ident" id="4540012">isStruct</span><span class="op" id="4540020">,</span>&nbsp;<span class="ident" id="4540022">isIncomplete</span>&nbsp;<span class="builtintype" id="4540035">bool</span><span class="op" id="4540039">)</span>&nbsp;<span class="op" id="4540041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540044">lbrace</span>&nbsp;<span class="op" id="4540051">:=</span>&nbsp;<span class="ident" id="4540054">fields</span><span class="op" id="4540060">.</span><span class="ident" id="4540061">Opening</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540070">list</span>&nbsp;<span class="op" id="4540075">:=</span>&nbsp;<span class="ident" id="4540078">fields</span><span class="op" id="4540084">.</span><span class="ident" id="4540085">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540091">rbrace</span>&nbsp;<span class="op" id="4540098">:=</span>&nbsp;<span class="ident" id="4540101">fields</span><span class="op" id="4540107">.</span><span class="ident" id="4540108">Closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540117">hasComments</span>&nbsp;<span class="op" id="4540129">:=</span>&nbsp;<span class="ident" id="4540132">isIncomplete</span>&nbsp;<span class="op" id="4540145">||</span>&nbsp;<span class="ident" id="4540148">p</span><span class="op" id="4540149">.</span><span class="ident" id="4540150">commentBefore</span><span class="op" id="4540163">(</span><span class="ident" id="4540164">p</span><span class="op" id="4540165">.</span><span class="ident" id="4540166">posFor</span><span class="op" id="4540172">(</span><span class="ident" id="4540173">rbrace</span><span class="op" id="4540179">)</span><span class="op" id="4540180">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540183">srcIsOneLine</span>&nbsp;<span class="op" id="4540196">:=</span>&nbsp;<span class="ident" id="4540199">lbrace</span><span class="op" id="4540205">.</span><span class="ident" id="4540206">IsValid</span><span class="op" id="4540213">(</span><span class="op" id="4540214">)</span>&nbsp;<span class="op" id="4540216">&amp;&amp;</span>&nbsp;<span class="ident" id="4540219">rbrace</span><span class="op" id="4540225">.</span><span class="ident" id="4540226">IsValid</span><span class="op" id="4540233">(</span><span class="op" id="4540234">)</span>&nbsp;<span class="op" id="4540236">&amp;&amp;</span>&nbsp;<span class="ident" id="4540239">p</span><span class="op" id="4540240">.</span><span class="ident" id="4540241">lineFor</span><span class="op" id="4540248">(</span><span class="ident" id="4540249">lbrace</span><span class="op" id="4540255">)</span>&nbsp;<span class="op" id="4540257">==</span>&nbsp;<span class="ident" id="4540260">p</span><span class="op" id="4540261">.</span><span class="ident" id="4540262">lineFor</span><span class="op" id="4540269">(</span><span class="ident" id="4540270">rbrace</span><span class="op" id="4540276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540280">if</span>&nbsp;<span class="op" id="4540283">!</span><span class="ident" id="4540284">hasComments</span>&nbsp;<span class="op" id="4540296">&amp;&amp;</span>&nbsp;<span class="ident" id="4540299">srcIsOneLine</span>&nbsp;<span class="op" id="4540312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540316">//&nbsp;possibly&nbsp;a&nbsp;one-line&nbsp;struct/interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540358">if</span>&nbsp;<span class="builtinfunc" id="4540361">len</span><span class="op" id="4540364">(</span><span class="ident" id="4540365">list</span><span class="op" id="4540369">)</span>&nbsp;<span class="op" id="4540371">==</span>&nbsp;<span class="num" id="4540374">0</span>&nbsp;<span class="op" id="4540376">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540381">//&nbsp;no&nbsp;blank&nbsp;between&nbsp;keyword&nbsp;and&nbsp;{}&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540432">p</span><span class="op" id="4540433">.</span><span class="builtinfunc" id="4540434">print</span><span class="op" id="4540439">(</span><span class="ident" id="4540440">lbrace</span><span class="op" id="4540446">,</span>&nbsp;<span class="ident" id="4540448">token</span><span class="op" id="4540453">.</span><span class="ident" id="4540454">LBRACE</span><span class="op" id="4540460">,</span>&nbsp;<span class="ident" id="4540462">rbrace</span><span class="op" id="4540468">,</span>&nbsp;<span class="ident" id="4540470">token</span><span class="op" id="4540475">.</span><span class="ident" id="4540476">RBRACE</span><span class="op" id="4540482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540496">}</span>&nbsp;<span class="keyword" id="4540498">else</span>&nbsp;<span class="keyword" id="4540503">if</span>&nbsp;<span class="ident" id="4540506">isStruct</span>&nbsp;<span class="op" id="4540515">&amp;&amp;</span>&nbsp;<span class="ident" id="4540518">p</span><span class="op" id="4540519">.</span><span class="ident" id="4540520">isOneLineFieldList</span><span class="op" id="4540538">(</span><span class="ident" id="4540539">list</span><span class="op" id="4540543">)</span>&nbsp;<span class="op" id="4540545">{</span>&nbsp;<span class="comment" id="4540547">//&nbsp;for&nbsp;now&nbsp;ignore&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540579">//&nbsp;small&nbsp;enough&nbsp;-&nbsp;print&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540618">//&nbsp;(don&#39;t&nbsp;use&nbsp;identList&nbsp;and&nbsp;ignore&nbsp;source&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540676">p</span><span class="op" id="4540677">.</span><span class="builtinfunc" id="4540678">print</span><span class="op" id="4540683">(</span><span class="ident" id="4540684">lbrace</span><span class="op" id="4540690">,</span>&nbsp;<span class="ident" id="4540692">token</span><span class="op" id="4540697">.</span><span class="ident" id="4540698">LBRACE</span><span class="op" id="4540704">,</span>&nbsp;<span class="ident" id="4540706">blank</span><span class="op" id="4540711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540716">f</span>&nbsp;<span class="op" id="4540718">:=</span>&nbsp;<span class="ident" id="4540721">list</span><span class="op" id="4540725">[</span><span class="num" id="4540726">0</span><span class="op" id="4540727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540732">for</span>&nbsp;<span class="ident" id="4540736">i</span><span class="op" id="4540737">,</span>&nbsp;<span class="ident" id="4540739">x</span>&nbsp;<span class="op" id="4540741">:=</span>&nbsp;<span class="keyword" id="4540744">range</span>&nbsp;<span class="ident" id="4540750">f</span><span class="op" id="4540751">.</span><span class="ident" id="4540752">Names</span>&nbsp;<span class="op" id="4540758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540764">if</span>&nbsp;<span class="ident" id="4540767">i</span>&nbsp;<span class="op" id="4540769">&gt;</span>&nbsp;<span class="num" id="4540771">0</span>&nbsp;<span class="op" id="4540773">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540780">//&nbsp;no&nbsp;comments&nbsp;so&nbsp;no&nbsp;need&nbsp;for&nbsp;comma&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540830">p</span><span class="op" id="4540831">.</span><span class="builtinfunc" id="4540832">print</span><span class="op" id="4540837">(</span><span class="ident" id="4540838">token</span><span class="op" id="4540843">.</span><span class="ident" id="4540844">COMMA</span><span class="op" id="4540849">,</span>&nbsp;<span class="ident" id="4540851">blank</span><span class="op" id="4540856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540868">p</span><span class="op" id="4540869">.</span><span class="ident" id="4540870">expr</span><span class="op" id="4540874">(</span><span class="ident" id="4540875">x</span><span class="op" id="4540876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540881">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540886">if</span>&nbsp;<span class="builtinfunc" id="4540889">len</span><span class="op" id="4540892">(</span><span class="ident" id="4540893">f</span><span class="op" id="4540894">.</span><span class="ident" id="4540895">Names</span><span class="op" id="4540900">)</span>&nbsp;<span class="op" id="4540902">&gt;</span>&nbsp;<span class="num" id="4540904">0</span>&nbsp;<span class="op" id="4540906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540912">p</span><span class="op" id="4540913">.</span><span class="builtinfunc" id="4540914">print</span><span class="op" id="4540919">(</span><span class="ident" id="4540920">blank</span><span class="op" id="4540925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540935">p</span><span class="op" id="4540936">.</span><span class="ident" id="4540937">expr</span><span class="op" id="4540941">(</span><span class="ident" id="4540942">f</span><span class="op" id="4540943">.</span><span class="ident" id="4540944">Type</span><span class="op" id="4540948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540953">p</span><span class="op" id="4540954">.</span><span class="builtinfunc" id="4540955">print</span><span class="op" id="4540960">(</span><span class="ident" id="4540961">blank</span><span class="op" id="4540966">,</span>&nbsp;<span class="ident" id="4540968">rbrace</span><span class="op" id="4540974">,</span>&nbsp;<span class="ident" id="4540976">token</span><span class="op" id="4540981">.</span><span class="ident" id="4540982">RBRACE</span><span class="op" id="4540988">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540993">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4541008">//&nbsp;hasComments&nbsp;||&nbsp;!srcIsOneLine</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541042">p</span><span class="op" id="4541043">.</span><span class="builtinfunc" id="4541044">print</span><span class="op" id="4541049">(</span><span class="ident" id="4541050">blank</span><span class="op" id="4541055">,</span>&nbsp;<span class="ident" id="4541057">lbrace</span><span class="op" id="4541063">,</span>&nbsp;<span class="ident" id="4541065">token</span><span class="op" id="4541070">.</span><span class="ident" id="4541071">LBRACE</span><span class="op" id="4541077">,</span>&nbsp;<span class="ident" id="4541079">indent</span><span class="op" id="4541085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541088">if</span>&nbsp;<span class="ident" id="4541091">hasComments</span>&nbsp;<span class="op" id="4541103">||</span>&nbsp;<span class="builtinfunc" id="4541106">len</span><span class="op" id="4541109">(</span><span class="ident" id="4541110">list</span><span class="op" id="4541114">)</span>&nbsp;<span class="op" id="4541116">&gt;</span>&nbsp;<span class="num" id="4541118">0</span>&nbsp;<span class="op" id="4541120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541124">p</span><span class="op" id="4541125">.</span><span class="builtinfunc" id="4541126">print</span><span class="op" id="4541131">(</span><span class="ident" id="4541132">formfeed</span><span class="op" id="4541140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541147">if</span>&nbsp;<span class="ident" id="4541150">isStruct</span>&nbsp;<span class="op" id="4541159">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541164">sep</span>&nbsp;<span class="op" id="4541168">:=</span>&nbsp;<span class="ident" id="4541171">vtab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541178">if</span>&nbsp;<span class="builtinfunc" id="4541181">len</span><span class="op" id="4541184">(</span><span class="ident" id="4541185">list</span><span class="op" id="4541189">)</span>&nbsp;<span class="op" id="4541191">==</span>&nbsp;<span class="num" id="4541194">1</span>&nbsp;<span class="op" id="4541196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541201">sep</span>&nbsp;<span class="op" id="4541205">=</span>&nbsp;<span class="ident" id="4541207">blank</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541219">var</span>&nbsp;<span class="ident" id="4541223">line</span>&nbsp;<span class="builtintype" id="4541228">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541234">for</span>&nbsp;<span class="ident" id="4541238">i</span><span class="op" id="4541239">,</span>&nbsp;<span class="ident" id="4541241">f</span>&nbsp;<span class="op" id="4541243">:=</span>&nbsp;<span class="keyword" id="4541246">range</span>&nbsp;<span class="ident" id="4541252">list</span>&nbsp;<span class="op" id="4541257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541262">if</span>&nbsp;<span class="ident" id="4541265">i</span>&nbsp;<span class="op" id="4541267">&gt;</span>&nbsp;<span class="num" id="4541269">0</span>&nbsp;<span class="op" id="4541271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541277">p</span><span class="op" id="4541278">.</span><span class="ident" id="4541279">linebreak</span><span class="op" id="4541288">(</span><span class="ident" id="4541289">p</span><span class="op" id="4541290">.</span><span class="ident" id="4541291">lineFor</span><span class="op" id="4541298">(</span><span class="ident" id="4541299">f</span><span class="op" id="4541300">.</span><span class="ident" id="4541301">Pos</span><span class="op" id="4541304">(</span><span class="op" id="4541305">)</span><span class="op" id="4541306">)</span><span class="op" id="4541307">,</span>&nbsp;<span class="num" id="4541309">1</span><span class="op" id="4541310">,</span>&nbsp;<span class="ident" id="4541312">ignore</span><span class="op" id="4541318">,</span>&nbsp;<span class="ident" id="4541320">p</span><span class="op" id="4541321">.</span><span class="ident" id="4541322">linesFrom</span><span class="op" id="4541331">(</span><span class="ident" id="4541332">line</span><span class="op" id="4541336">)</span>&nbsp;<span class="op" id="4541338">&gt;</span>&nbsp;<span class="num" id="4541340">0</span><span class="op" id="4541341">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541351">extraTabs</span>&nbsp;<span class="op" id="4541361">:=</span>&nbsp;<span class="num" id="4541364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541369">p</span><span class="op" id="4541370">.</span><span class="ident" id="4541371">setComment</span><span class="op" id="4541381">(</span><span class="ident" id="4541382">f</span><span class="op" id="4541383">.</span><span class="ident" id="4541384">Doc</span><span class="op" id="4541387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541392">p</span><span class="op" id="4541393">.</span><span class="ident" id="4541394">recordLine</span><span class="op" id="4541404">(</span><span class="op" id="4541405">&amp;</span><span class="ident" id="4541406">line</span><span class="op" id="4541410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541415">if</span>&nbsp;<span class="builtinfunc" id="4541418">len</span><span class="op" id="4541421">(</span><span class="ident" id="4541422">f</span><span class="op" id="4541423">.</span><span class="ident" id="4541424">Names</span><span class="op" id="4541429">)</span>&nbsp;<span class="op" id="4541431">&gt;</span>&nbsp;<span class="num" id="4541433">0</span>&nbsp;<span class="op" id="4541435">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4541441">//&nbsp;named&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541461">p</span><span class="op" id="4541462">.</span><span class="ident" id="4541463">identList</span><span class="op" id="4541472">(</span><span class="ident" id="4541473">f</span><span class="op" id="4541474">.</span><span class="ident" id="4541475">Names</span><span class="op" id="4541480">,</span>&nbsp;<span class="builtintype" id="4541482">false</span><span class="op" id="4541487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541493">p</span><span class="op" id="4541494">.</span><span class="builtinfunc" id="4541495">print</span><span class="op" id="4541500">(</span><span class="ident" id="4541501">sep</span><span class="op" id="4541504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541510">p</span><span class="op" id="4541511">.</span><span class="ident" id="4541512">expr</span><span class="op" id="4541516">(</span><span class="ident" id="4541517">f</span><span class="op" id="4541518">.</span><span class="ident" id="4541519">Type</span><span class="op" id="4541523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541529">extraTabs</span>&nbsp;<span class="op" id="4541539">=</span>&nbsp;<span class="num" id="4541541">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541546">}</span>&nbsp;<span class="keyword" id="4541548">else</span>&nbsp;<span class="op" id="4541553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4541559">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541582">p</span><span class="op" id="4541583">.</span><span class="ident" id="4541584">expr</span><span class="op" id="4541588">(</span><span class="ident" id="4541589">f</span><span class="op" id="4541590">.</span><span class="ident" id="4541591">Type</span><span class="op" id="4541595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541601">extraTabs</span>&nbsp;<span class="op" id="4541611">=</span>&nbsp;<span class="num" id="4541613">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541618">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541623">if</span>&nbsp;<span class="ident" id="4541626">f</span><span class="op" id="4541627">.</span><span class="ident" id="4541628">Tag</span>&nbsp;<span class="op" id="4541632">!=</span>&nbsp;<span class="ident" id="4541635">nil</span>&nbsp;<span class="op" id="4541639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541645">if</span>&nbsp;<span class="builtinfunc" id="4541648">len</span><span class="op" id="4541651">(</span><span class="ident" id="4541652">f</span><span class="op" id="4541653">.</span><span class="ident" id="4541654">Names</span><span class="op" id="4541659">)</span>&nbsp;<span class="op" id="4541661">&gt;</span>&nbsp;<span class="num" id="4541663">0</span>&nbsp;<span class="op" id="4541665">&amp;&amp;</span>&nbsp;<span class="ident" id="4541668">sep</span>&nbsp;<span class="op" id="4541672">==</span>&nbsp;<span class="ident" id="4541675">vtab</span>&nbsp;<span class="op" id="4541680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541687">p</span><span class="op" id="4541688">.</span><span class="builtinfunc" id="4541689">print</span><span class="op" id="4541694">(</span><span class="ident" id="4541695">sep</span><span class="op" id="4541698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541710">p</span><span class="op" id="4541711">.</span><span class="builtinfunc" id="4541712">print</span><span class="op" id="4541717">(</span><span class="ident" id="4541718">sep</span><span class="op" id="4541721">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541727">p</span><span class="op" id="4541728">.</span><span class="ident" id="4541729">expr</span><span class="op" id="4541733">(</span><span class="ident" id="4541734">f</span><span class="op" id="4541735">.</span><span class="ident" id="4541736">Tag</span><span class="op" id="4541739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541745">extraTabs</span>&nbsp;<span class="op" id="4541755">=</span>&nbsp;<span class="num" id="4541757">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541767">if</span>&nbsp;<span class="ident" id="4541770">f</span><span class="op" id="4541771">.</span><span class="ident" id="4541772">Comment</span>&nbsp;<span class="op" id="4541780">!=</span>&nbsp;<span class="ident" id="4541783">nil</span>&nbsp;<span class="op" id="4541787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541793">for</span>&nbsp;<span class="op" id="4541797">;</span>&nbsp;<span class="ident" id="4541799">extraTabs</span>&nbsp;<span class="op" id="4541809">&gt;</span>&nbsp;<span class="num" id="4541811">0</span><span class="op" id="4541812">;</span>&nbsp;<span class="ident" id="4541814">extraTabs</span><span class="op" id="4541823">--</span>&nbsp;<span class="op" id="4541826">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541833">p</span><span class="op" id="4541834">.</span><span class="builtinfunc" id="4541835">print</span><span class="op" id="4541840">(</span><span class="ident" id="4541841">sep</span><span class="op" id="4541844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541856">p</span><span class="op" id="4541857">.</span><span class="ident" id="4541858">setComment</span><span class="op" id="4541868">(</span><span class="ident" id="4541869">f</span><span class="op" id="4541870">.</span><span class="ident" id="4541871">Comment</span><span class="op" id="4541878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541887">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541891">if</span>&nbsp;<span class="ident" id="4541894">isIncomplete</span>&nbsp;<span class="op" id="4541907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541912">if</span>&nbsp;<span class="builtinfunc" id="4541915">len</span><span class="op" id="4541918">(</span><span class="ident" id="4541919">list</span><span class="op" id="4541923">)</span>&nbsp;<span class="op" id="4541925">&gt;</span>&nbsp;<span class="num" id="4541927">0</span>&nbsp;<span class="op" id="4541929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541935">p</span><span class="op" id="4541936">.</span><span class="builtinfunc" id="4541937">print</span><span class="op" id="4541942">(</span><span class="ident" id="4541943">formfeed</span><span class="op" id="4541951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541961">p</span><span class="op" id="4541962">.</span><span class="ident" id="4541963">flush</span><span class="op" id="4541968">(</span><span class="ident" id="4541969">p</span><span class="op" id="4541970">.</span><span class="ident" id="4541971">posFor</span><span class="op" id="4541977">(</span><span class="ident" id="4541978">rbrace</span><span class="op" id="4541984">)</span><span class="op" id="4541985">,</span>&nbsp;<span class="ident" id="4541987">token</span><span class="op" id="4541992">.</span><span class="ident" id="4541993">RBRACE</span><span class="op" id="4541999">)</span>&nbsp;<span class="comment" id="4542001">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542053">p</span><span class="op" id="4542054">.</span><span class="ident" id="4542055">setLineComment</span><span class="op" id="4542069">(</span><span class="string" id="4542070">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;fields&#34;</span><span class="op" id="4542113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542121">}</span>&nbsp;<span class="keyword" id="4542123">else</span>&nbsp;<span class="op" id="4542128">{</span>&nbsp;<span class="comment" id="4542130">//&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542146">var</span>&nbsp;<span class="ident" id="4542150">line</span>&nbsp;<span class="builtintype" id="4542155">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542161">for</span>&nbsp;<span class="ident" id="4542165">i</span><span class="op" id="4542166">,</span>&nbsp;<span class="ident" id="4542168">f</span>&nbsp;<span class="op" id="4542170">:=</span>&nbsp;<span class="keyword" id="4542173">range</span>&nbsp;<span class="ident" id="4542179">list</span>&nbsp;<span class="op" id="4542184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542189">if</span>&nbsp;<span class="ident" id="4542192">i</span>&nbsp;<span class="op" id="4542194">&gt;</span>&nbsp;<span class="num" id="4542196">0</span>&nbsp;<span class="op" id="4542198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542204">p</span><span class="op" id="4542205">.</span><span class="ident" id="4542206">linebreak</span><span class="op" id="4542215">(</span><span class="ident" id="4542216">p</span><span class="op" id="4542217">.</span><span class="ident" id="4542218">lineFor</span><span class="op" id="4542225">(</span><span class="ident" id="4542226">f</span><span class="op" id="4542227">.</span><span class="ident" id="4542228">Pos</span><span class="op" id="4542231">(</span><span class="op" id="4542232">)</span><span class="op" id="4542233">)</span><span class="op" id="4542234">,</span>&nbsp;<span class="num" id="4542236">1</span><span class="op" id="4542237">,</span>&nbsp;<span class="ident" id="4542239">ignore</span><span class="op" id="4542245">,</span>&nbsp;<span class="ident" id="4542247">p</span><span class="op" id="4542248">.</span><span class="ident" id="4542249">linesFrom</span><span class="op" id="4542258">(</span><span class="ident" id="4542259">line</span><span class="op" id="4542263">)</span>&nbsp;<span class="op" id="4542265">&gt;</span>&nbsp;<span class="num" id="4542267">0</span><span class="op" id="4542268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542273">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542278">p</span><span class="op" id="4542279">.</span><span class="ident" id="4542280">setComment</span><span class="op" id="4542290">(</span><span class="ident" id="4542291">f</span><span class="op" id="4542292">.</span><span class="ident" id="4542293">Doc</span><span class="op" id="4542296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542301">p</span><span class="op" id="4542302">.</span><span class="ident" id="4542303">recordLine</span><span class="op" id="4542313">(</span><span class="op" id="4542314">&amp;</span><span class="ident" id="4542315">line</span><span class="op" id="4542319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542324">if</span>&nbsp;<span class="ident" id="4542327">ftyp</span><span class="op" id="4542331">,</span>&nbsp;<span class="ident" id="4542333">isFtyp</span>&nbsp;<span class="op" id="4542340">:=</span>&nbsp;<span class="ident" id="4542343">f</span><span class="op" id="4542344">.</span><span class="ident" id="4542345">Type</span><span class="op" id="4542349">.</span><span class="op" id="4542350">(</span><span class="op" id="4542351">*</span><span class="ident" id="4542352">ast</span><span class="op" id="4542355">.</span><span class="ident" id="4542356">FuncType</span><span class="op" id="4542364">)</span><span class="op" id="4542365">;</span>&nbsp;<span class="ident" id="4542367">isFtyp</span>&nbsp;<span class="op" id="4542374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4542380">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542394">p</span><span class="op" id="4542395">.</span><span class="ident" id="4542396">expr</span><span class="op" id="4542400">(</span><span class="ident" id="4542401">f</span><span class="op" id="4542402">.</span><span class="ident" id="4542403">Names</span><span class="op" id="4542408">[</span><span class="num" id="4542409">0</span><span class="op" id="4542410">]</span><span class="op" id="4542411">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542417">p</span><span class="op" id="4542418">.</span><span class="ident" id="4542419">signature</span><span class="op" id="4542428">(</span><span class="ident" id="4542429">ftyp</span><span class="op" id="4542433">.</span><span class="ident" id="4542434">Params</span><span class="op" id="4542440">,</span>&nbsp;<span class="ident" id="4542442">ftyp</span><span class="op" id="4542446">.</span><span class="ident" id="4542447">Results</span><span class="op" id="4542454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542459">}</span>&nbsp;<span class="keyword" id="4542461">else</span>&nbsp;<span class="op" id="4542466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4542472">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542498">p</span><span class="op" id="4542499">.</span><span class="ident" id="4542500">expr</span><span class="op" id="4542504">(</span><span class="ident" id="4542505">f</span><span class="op" id="4542506">.</span><span class="ident" id="4542507">Type</span><span class="op" id="4542511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542516">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542521">p</span><span class="op" id="4542522">.</span><span class="ident" id="4542523">setComment</span><span class="op" id="4542533">(</span><span class="ident" id="4542534">f</span><span class="op" id="4542535">.</span><span class="ident" id="4542536">Comment</span><span class="op" id="4542543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542551">if</span>&nbsp;<span class="ident" id="4542554">isIncomplete</span>&nbsp;<span class="op" id="4542567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542572">if</span>&nbsp;<span class="builtinfunc" id="4542575">len</span><span class="op" id="4542578">(</span><span class="ident" id="4542579">list</span><span class="op" id="4542583">)</span>&nbsp;<span class="op" id="4542585">&gt;</span>&nbsp;<span class="num" id="4542587">0</span>&nbsp;<span class="op" id="4542589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542595">p</span><span class="op" id="4542596">.</span><span class="builtinfunc" id="4542597">print</span><span class="op" id="4542602">(</span><span class="ident" id="4542603">formfeed</span><span class="op" id="4542611">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542621">p</span><span class="op" id="4542622">.</span><span class="ident" id="4542623">flush</span><span class="op" id="4542628">(</span><span class="ident" id="4542629">p</span><span class="op" id="4542630">.</span><span class="ident" id="4542631">posFor</span><span class="op" id="4542637">(</span><span class="ident" id="4542638">rbrace</span><span class="op" id="4542644">)</span><span class="op" id="4542645">,</span>&nbsp;<span class="ident" id="4542647">token</span><span class="op" id="4542652">.</span><span class="ident" id="4542653">RBRACE</span><span class="op" id="4542659">)</span>&nbsp;<span class="comment" id="4542661">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542713">p</span><span class="op" id="4542714">.</span><span class="ident" id="4542715">setLineComment</span><span class="op" id="4542729">(</span><span class="string" id="4542730">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;methods&#34;</span><span class="op" id="4542774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542785">p</span><span class="op" id="4542786">.</span><span class="builtinfunc" id="4542787">print</span><span class="op" id="4542792">(</span><span class="ident" id="4542793">unindent</span><span class="op" id="4542801">,</span>&nbsp;<span class="ident" id="4542803">formfeed</span><span class="op" id="4542811">,</span>&nbsp;<span class="ident" id="4542813">rbrace</span><span class="op" id="4542819">,</span>&nbsp;<span class="ident" id="4542821">token</span><span class="op" id="4542826">.</span><span class="ident" id="4542827">RBRACE</span><span class="op" id="4542833">)</span><br>
<span class="lineno"></span><span class="op" id="4542835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4542838">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">505</span><span class="comment" id="4542918">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4542934">func</span>&nbsp;<span class="ident" id="4542939">walkBinary</span><span class="op" id="4542949">(</span><span class="ident" id="4542950">e</span>&nbsp;<span class="op" id="4542952">*</span><span class="ident" id="4542953">ast</span><span class="op" id="4542956">.</span><span class="ident" id="4542957">BinaryExpr</span><span class="op" id="4542967">)</span>&nbsp;<span class="op" id="4542969">(</span><span class="ident" id="4542970">has4</span><span class="op" id="4542974">,</span>&nbsp;<span class="ident" id="4542976">has5</span>&nbsp;<span class="builtintype" id="4542981">bool</span><span class="op" id="4542985">,</span>&nbsp;<span class="ident" id="4542987">maxProblem</span>&nbsp;<span class="builtintype" id="4542998">int</span><span class="op" id="4543001">)</span>&nbsp;<span class="op" id="4543003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543006">switch</span>&nbsp;<span class="ident" id="4543013">e</span><span class="op" id="4543014">.</span><span class="ident" id="4543015">Op</span><span class="op" id="4543017">.</span><span class="ident" id="4543018">Precedence</span><span class="op" id="4543028">(</span><span class="op" id="4543029">)</span>&nbsp;<span class="op" id="4543031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543034">case</span>&nbsp;<span class="num" id="4543039">4</span><span class="op" id="4543040">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543044">has4</span>&nbsp;<span class="op" id="4543049">=</span>&nbsp;<span class="builtintype" id="4543051">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543057">case</span>&nbsp;<span class="num" id="4543062">5</span><span class="op" id="4543063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543067">has5</span>&nbsp;<span class="op" id="4543072">=</span>&nbsp;<span class="builtintype" id="4543074">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543084">switch</span>&nbsp;<span class="ident" id="4543091">l</span>&nbsp;<span class="op" id="4543093">:=</span>&nbsp;<span class="ident" id="4543096">e</span><span class="op" id="4543097">.</span><span class="ident" id="4543098">X</span><span class="op" id="4543099">.</span><span class="op" id="4543100">(</span><span class="keyword" id="4543101">type</span><span class="op" id="4543105">)</span>&nbsp;<span class="op" id="4543107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543110">case</span>&nbsp;<span class="op" id="4543115">*</span><span class="ident" id="4543116">ast</span><span class="op" id="4543119">.</span><span class="ident" id="4543120">BinaryExpr</span><span class="op" id="4543130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543134">if</span>&nbsp;<span class="ident" id="4543137">l</span><span class="op" id="4543138">.</span><span class="ident" id="4543139">Op</span><span class="op" id="4543141">.</span><span class="ident" id="4543142">Precedence</span><span class="op" id="4543152">(</span><span class="op" id="4543153">)</span>&nbsp;<span class="op" id="4543155">&lt;</span>&nbsp;<span class="ident" id="4543157">e</span><span class="op" id="4543158">.</span><span class="ident" id="4543159">Op</span><span class="op" id="4543161">.</span><span class="ident" id="4543162">Precedence</span><span class="op" id="4543172">(</span><span class="op" id="4543173">)</span>&nbsp;<span class="op" id="4543175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4543180">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4543211">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543267">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543279">h4</span><span class="op" id="4543281">,</span>&nbsp;<span class="ident" id="4543283">h5</span><span class="op" id="4543285">,</span>&nbsp;<span class="ident" id="4543287">mp</span>&nbsp;<span class="op" id="4543290">:=</span>&nbsp;<span class="ident" id="4543293">walkBinary</span><span class="op" id="4543303">(</span><span class="ident" id="4543304">l</span><span class="op" id="4543305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543309">has4</span>&nbsp;<span class="op" id="4543314">=</span>&nbsp;<span class="ident" id="4543316">has4</span>&nbsp;<span class="op" id="4543321">||</span>&nbsp;<span class="ident" id="4543324">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543329">has5</span>&nbsp;<span class="op" id="4543334">=</span>&nbsp;<span class="ident" id="4543336">has5</span>&nbsp;<span class="op" id="4543341">||</span>&nbsp;<span class="ident" id="4543344">h5</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543349">if</span>&nbsp;<span class="ident" id="4543352">maxProblem</span>&nbsp;<span class="op" id="4543363">&lt;</span>&nbsp;<span class="ident" id="4543365">mp</span>&nbsp;<span class="op" id="4543368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543373">maxProblem</span>&nbsp;<span class="op" id="4543384">=</span>&nbsp;<span class="ident" id="4543386">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543398">switch</span>&nbsp;<span class="ident" id="4543405">r</span>&nbsp;<span class="op" id="4543407">:=</span>&nbsp;<span class="ident" id="4543410">e</span><span class="op" id="4543411">.</span><span class="ident" id="4543412">Y</span><span class="op" id="4543413">.</span><span class="op" id="4543414">(</span><span class="keyword" id="4543415">type</span><span class="op" id="4543419">)</span>&nbsp;<span class="op" id="4543421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543424">case</span>&nbsp;<span class="op" id="4543429">*</span><span class="ident" id="4543430">ast</span><span class="op" id="4543433">.</span><span class="ident" id="4543434">BinaryExpr</span><span class="op" id="4543444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543448">if</span>&nbsp;<span class="ident" id="4543451">r</span><span class="op" id="4543452">.</span><span class="ident" id="4543453">Op</span><span class="op" id="4543455">.</span><span class="ident" id="4543456">Precedence</span><span class="op" id="4543466">(</span><span class="op" id="4543467">)</span>&nbsp;<span class="op" id="4543469">&lt;=</span>&nbsp;<span class="ident" id="4543472">e</span><span class="op" id="4543473">.</span><span class="ident" id="4543474">Op</span><span class="op" id="4543476">.</span><span class="ident" id="4543477">Precedence</span><span class="op" id="4543487">(</span><span class="op" id="4543488">)</span>&nbsp;<span class="op" id="4543490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4543495">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4543526">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543582">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543594">h4</span><span class="op" id="4543596">,</span>&nbsp;<span class="ident" id="4543598">h5</span><span class="op" id="4543600">,</span>&nbsp;<span class="ident" id="4543602">mp</span>&nbsp;<span class="op" id="4543605">:=</span>&nbsp;<span class="ident" id="4543608">walkBinary</span><span class="op" id="4543618">(</span><span class="ident" id="4543619">r</span><span class="op" id="4543620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543624">has4</span>&nbsp;<span class="op" id="4543629">=</span>&nbsp;<span class="ident" id="4543631">has4</span>&nbsp;<span class="op" id="4543636">||</span>&nbsp;<span class="ident" id="4543639">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543644">has5</span>&nbsp;<span class="op" id="4543649">=</span>&nbsp;<span class="ident" id="4543651">has5</span>&nbsp;<span class="op" id="4543656">||</span>&nbsp;<span class="ident" id="4543659">h5</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543664">if</span>&nbsp;<span class="ident" id="4543667">maxProblem</span>&nbsp;<span class="op" id="4543678">&lt;</span>&nbsp;<span class="ident" id="4543680">mp</span>&nbsp;<span class="op" id="4543683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543688">maxProblem</span>&nbsp;<span class="op" id="4543699">=</span>&nbsp;<span class="ident" id="4543701">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543710">case</span>&nbsp;<span class="op" id="4543715">*</span><span class="ident" id="4543716">ast</span><span class="op" id="4543719">.</span><span class="ident" id="4543720">StarExpr</span><span class="op" id="4543728">:</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543732">if</span>&nbsp;<span class="ident" id="4543735">e</span><span class="op" id="4543736">.</span><span class="ident" id="4543737">Op</span>&nbsp;<span class="op" id="4543740">==</span>&nbsp;<span class="ident" id="4543743">token</span><span class="op" id="4543748">.</span><span class="ident" id="4543749">QUO</span>&nbsp;<span class="op" id="4543753">{</span>&nbsp;<span class="comment" id="4543755">//&nbsp;`*/`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543766">maxProblem</span>&nbsp;<span class="op" id="4543777">=</span>&nbsp;<span class="num" id="4543779">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543787">case</span>&nbsp;<span class="op" id="4543792">*</span><span class="ident" id="4543793">ast</span><span class="op" id="4543796">.</span><span class="ident" id="4543797">UnaryExpr</span><span class="op" id="4543806">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543810">switch</span>&nbsp;<span class="ident" id="4543817">e</span><span class="op" id="4543818">.</span><span class="ident" id="4543819">Op</span><span class="op" id="4543821">.</span><span class="ident" id="4543822">String</span><span class="op" id="4543828">(</span><span class="op" id="4543829">)</span>&nbsp;<span class="op" id="4543831">+</span>&nbsp;<span class="ident" id="4543833">r</span><span class="op" id="4543834">.</span><span class="ident" id="4543835">Op</span><span class="op" id="4543837">.</span><span class="ident" id="4543838">String</span><span class="op" id="4543844">(</span><span class="op" id="4543845">)</span>&nbsp;<span class="op" id="4543847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543851">case</span>&nbsp;<span class="string" id="4543856">&#34;/*&#34;</span><span class="op" id="4543860">,</span>&nbsp;<span class="string" id="4543862">&#34;&amp;&amp;&#34;</span><span class="op" id="4543866">,</span>&nbsp;<span class="string" id="4543868">&#34;&amp;^&#34;</span><span class="op" id="4543872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543877">maxProblem</span>&nbsp;<span class="op" id="4543888">=</span>&nbsp;<span class="num" id="4543890">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543894">case</span>&nbsp;<span class="string" id="4543899">&#34;++&#34;</span><span class="op" id="4543903">,</span>&nbsp;<span class="string" id="4543905">&#34;--&#34;</span><span class="op" id="4543909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543914">if</span>&nbsp;<span class="ident" id="4543917">maxProblem</span>&nbsp;<span class="op" id="4543928">&lt;</span>&nbsp;<span class="num" id="4543930">4</span>&nbsp;<span class="op" id="4543932">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543938">maxProblem</span>&nbsp;<span class="op" id="4543949">=</span>&nbsp;<span class="num" id="4543951">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543966">return</span><br>
<span class="lineno">560</span><span class="op" id="4543973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4543976">func</span>&nbsp;<span class="ident" id="4543981">cutoff</span><span class="op" id="4543987">(</span><span class="ident" id="4543988">e</span>&nbsp;<span class="op" id="4543990">*</span><span class="ident" id="4543991">ast</span><span class="op" id="4543994">.</span><span class="ident" id="4543995">BinaryExpr</span><span class="op" id="4544005">,</span>&nbsp;<span class="ident" id="4544007">depth</span>&nbsp;<span class="builtintype" id="4544013">int</span><span class="op" id="4544016">)</span>&nbsp;<span class="builtintype" id="4544018">int</span>&nbsp;<span class="op" id="4544022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544025">has4</span><span class="op" id="4544029">,</span>&nbsp;<span class="ident" id="4544031">has5</span><span class="op" id="4544035">,</span>&nbsp;<span class="ident" id="4544037">maxProblem</span>&nbsp;<span class="op" id="4544048">:=</span>&nbsp;<span class="ident" id="4544051">walkBinary</span><span class="op" id="4544061">(</span><span class="ident" id="4544062">e</span><span class="op" id="4544063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544066">if</span>&nbsp;<span class="ident" id="4544069">maxProblem</span>&nbsp;<span class="op" id="4544080">&gt;</span>&nbsp;<span class="num" id="4544082">0</span>&nbsp;<span class="op" id="4544084">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544088">return</span>&nbsp;<span class="ident" id="4544095">maxProblem</span>&nbsp;<span class="op" id="4544106">+</span>&nbsp;<span class="num" id="4544108">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544114">if</span>&nbsp;<span class="ident" id="4544117">has4</span>&nbsp;<span class="op" id="4544122">&amp;&amp;</span>&nbsp;<span class="ident" id="4544125">has5</span>&nbsp;<span class="op" id="4544130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544134">if</span>&nbsp;<span class="ident" id="4544137">depth</span>&nbsp;<span class="op" id="4544143">==</span>&nbsp;<span class="num" id="4544146">1</span>&nbsp;<span class="op" id="4544148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544153">return</span>&nbsp;<span class="num" id="4544160">5</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544168">return</span>&nbsp;<span class="num" id="4544175">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544181">if</span>&nbsp;<span class="ident" id="4544184">depth</span>&nbsp;<span class="op" id="4544190">==</span>&nbsp;<span class="num" id="4544193">1</span>&nbsp;<span class="op" id="4544195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544199">return</span>&nbsp;<span class="num" id="4544206">6</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544212">return</span>&nbsp;<span class="num" id="4544219">4</span><br>
<span class="lineno"></span><span class="op" id="4544221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4544224">func</span>&nbsp;<span class="ident" id="4544229">diffPrec</span><span class="op" id="4544237">(</span><span class="ident" id="4544238">expr</span>&nbsp;<span class="ident" id="4544243">ast</span><span class="op" id="4544246">.</span><span class="ident" id="4544247">Expr</span><span class="op" id="4544251">,</span>&nbsp;<span class="ident" id="4544253">prec</span>&nbsp;<span class="builtintype" id="4544258">int</span><span class="op" id="4544261">)</span>&nbsp;<span class="builtintype" id="4544263">int</span>&nbsp;<span class="op" id="4544267">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544270">x</span><span class="op" id="4544271">,</span>&nbsp;<span class="ident" id="4544273">ok</span>&nbsp;<span class="op" id="4544276">:=</span>&nbsp;<span class="ident" id="4544279">expr</span><span class="op" id="4544283">.</span><span class="op" id="4544284">(</span><span class="op" id="4544285">*</span><span class="ident" id="4544286">ast</span><span class="op" id="4544289">.</span><span class="ident" id="4544290">BinaryExpr</span><span class="op" id="4544300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544303">if</span>&nbsp;<span class="op" id="4544306">!</span><span class="ident" id="4544307">ok</span>&nbsp;<span class="op" id="4544310">||</span>&nbsp;<span class="ident" id="4544313">prec</span>&nbsp;<span class="op" id="4544318">!=</span>&nbsp;<span class="ident" id="4544321">x</span><span class="op" id="4544322">.</span><span class="ident" id="4544323">Op</span><span class="op" id="4544325">.</span><span class="ident" id="4544326">Precedence</span><span class="op" id="4544336">(</span><span class="op" id="4544337">)</span>&nbsp;<span class="op" id="4544339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544343">return</span>&nbsp;<span class="num" id="4544350">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544356">return</span>&nbsp;<span class="num" id="4544363">0</span><br>
<span class="lineno">585</span><span class="op" id="4544365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4544368">func</span>&nbsp;<span class="ident" id="4544373">reduceDepth</span><span class="op" id="4544384">(</span><span class="ident" id="4544385">depth</span>&nbsp;<span class="builtintype" id="4544391">int</span><span class="op" id="4544394">)</span>&nbsp;<span class="builtintype" id="4544396">int</span>&nbsp;<span class="op" id="4544400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544403">depth</span><span class="op" id="4544408">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544412">if</span>&nbsp;<span class="ident" id="4544415">depth</span>&nbsp;<span class="op" id="4544421">&lt;</span>&nbsp;<span class="num" id="4544423">1</span>&nbsp;<span class="op" id="4544425">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544429">depth</span>&nbsp;<span class="op" id="4544435">=</span>&nbsp;<span class="num" id="4544437">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544443">return</span>&nbsp;<span class="ident" id="4544450">depth</span><br>
<span class="lineno"></span><span class="op" id="4544456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="4544459">//&nbsp;Format&nbsp;the&nbsp;binary&nbsp;expression:&nbsp;decide&nbsp;the&nbsp;cutoff&nbsp;and&nbsp;then&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="4544527">//&nbsp;Let&#39;s&nbsp;call&nbsp;depth&nbsp;==&nbsp;1&nbsp;Normal&nbsp;mode,&nbsp;and&nbsp;depth&nbsp;&gt;&nbsp;1&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="4544593">//&nbsp;(Algorithm&nbsp;suggestion&nbsp;by&nbsp;Russ&nbsp;Cox.)</span><br>
<span class="lineno"></span><span class="comment" id="4544632">//</span><br>
<span class="lineno"></span><span class="comment" id="4544635">//&nbsp;The&nbsp;precedences&nbsp;are:</span><br>
<span class="lineno">600</span><span class="comment" id="4544659">//&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;/&nbsp;&nbsp;%&nbsp;&nbsp;&lt;&lt;&nbsp;&nbsp;&gt;&gt;&nbsp;&nbsp;&amp;&nbsp;&nbsp;&amp;^</span><br>
<span class="lineno"></span><span class="comment" id="4544699">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;-&nbsp;&nbsp;|&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4544727">//&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==&nbsp;&nbsp;!=&nbsp;&nbsp;&lt;&nbsp;&nbsp;&lt;=&nbsp;&nbsp;&gt;&nbsp;&nbsp;&gt;=</span><br>
<span class="lineno"></span><span class="comment" id="4544765">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;</span><br>
<span class="lineno"></span><span class="comment" id="4544785">//&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||</span><br>
<span class="lineno">605</span><span class="comment" id="4544805">//</span><br>
<span class="lineno"></span><span class="comment" id="4544808">//&nbsp;The&nbsp;only&nbsp;decision&nbsp;is&nbsp;whether&nbsp;there&nbsp;will&nbsp;be&nbsp;spaces&nbsp;around&nbsp;levels&nbsp;4&nbsp;and&nbsp;5.</span><br>
<span class="lineno"></span><span class="comment" id="4544884">//&nbsp;There&nbsp;are&nbsp;never&nbsp;spaces&nbsp;at&nbsp;level&nbsp;6&nbsp;(unary),&nbsp;and&nbsp;always&nbsp;spaces&nbsp;at&nbsp;levels&nbsp;3&nbsp;and&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="4544971">//</span><br>
<span class="lineno"></span><span class="comment" id="4544974">//&nbsp;To&nbsp;choose&nbsp;the&nbsp;cutoff,&nbsp;look&nbsp;at&nbsp;the&nbsp;whole&nbsp;expression&nbsp;but&nbsp;excluding&nbsp;primary</span><br>
<span class="lineno">610</span><span class="comment" id="4545050">//&nbsp;expressions&nbsp;(function&nbsp;calls,&nbsp;parenthesized&nbsp;exprs),&nbsp;and&nbsp;apply&nbsp;these&nbsp;rules:</span><br>
<span class="lineno"></span><span class="comment" id="4545127">//</span><br>
<span class="lineno"></span><span class="comment" id="4545130">//&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;binary&nbsp;operator&nbsp;with&nbsp;a&nbsp;right&nbsp;side&nbsp;unary&nbsp;operand</span><br>
<span class="lineno"></span><span class="comment" id="4545198">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;would&nbsp;clash&nbsp;without&nbsp;a&nbsp;space,&nbsp;the&nbsp;cutoff&nbsp;must&nbsp;be&nbsp;(in&nbsp;order):</span><br>
<span class="lineno"></span><span class="comment" id="4545269">//</span><br>
<span class="lineno">615</span><span class="comment" id="4545272">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;6</span><br>
<span class="lineno"></span><span class="comment" id="4545281">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;6</span><br>
<span class="lineno"></span><span class="comment" id="4545290">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;^&nbsp;&nbsp;&nbsp;&nbsp;6</span><br>
<span class="lineno"></span><span class="comment" id="4545299">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++&nbsp;&nbsp;&nbsp;&nbsp;5</span><br>
<span class="lineno"></span><span class="comment" id="4545308">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;&nbsp;&nbsp;5</span><br>
<span class="lineno">620</span><span class="comment" id="4545317">//</span><br>
<span class="lineno"></span><span class="comment" id="4545320">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Comparison&nbsp;operators&nbsp;always&nbsp;have&nbsp;spaces&nbsp;around&nbsp;them.)</span><br>
<span class="lineno"></span><span class="comment" id="4545386">//</span><br>
<span class="lineno"></span><span class="comment" id="4545389">//&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;mix&nbsp;of&nbsp;level&nbsp;5&nbsp;and&nbsp;level&nbsp;4&nbsp;operators,&nbsp;then&nbsp;the&nbsp;cutoff</span><br>
<span class="lineno"></span><span class="comment" id="4545463">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;5&nbsp;(use&nbsp;spaces&nbsp;to&nbsp;distinguish&nbsp;precedence)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno">625</span><span class="comment" id="4545528">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="4545576">//</span><br>
<span class="lineno"></span><span class="comment" id="4545579">//&nbsp;&nbsp;&nbsp;&nbsp;3)&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;level&nbsp;4&nbsp;operators&nbsp;or&nbsp;no&nbsp;level&nbsp;5&nbsp;operators,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4545653">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cutoff&nbsp;is&nbsp;6&nbsp;(always&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno"></span><span class="comment" id="4545706">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno">630</span><span class="comment" id="4545754">//</span><br>
<span class="lineno"></span><span class="keyword" id="4545757">func</span>&nbsp;<span class="op" id="4545762">(</span><span class="ident" id="4545763">p</span>&nbsp;<span class="op" id="4545765">*</span><span class="ident" id="4545766">printer</span><span class="op" id="4545773">)</span>&nbsp;<span class="ident" id="4545775">binaryExpr</span><span class="op" id="4545785">(</span><span class="ident" id="4545786">x</span>&nbsp;<span class="op" id="4545788">*</span><span class="ident" id="4545789">ast</span><span class="op" id="4545792">.</span><span class="ident" id="4545793">BinaryExpr</span><span class="op" id="4545803">,</span>&nbsp;<span class="ident" id="4545805">prec1</span><span class="op" id="4545810">,</span>&nbsp;<span class="ident" id="4545812">cutoff</span><span class="op" id="4545818">,</span>&nbsp;<span class="ident" id="4545820">depth</span>&nbsp;<span class="builtintype" id="4545826">int</span><span class="op" id="4545829">)</span>&nbsp;<span class="op" id="4545831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545834">prec</span>&nbsp;<span class="op" id="4545839">:=</span>&nbsp;<span class="ident" id="4545842">x</span><span class="op" id="4545843">.</span><span class="ident" id="4545844">Op</span><span class="op" id="4545846">.</span><span class="ident" id="4545847">Precedence</span><span class="op" id="4545857">(</span><span class="op" id="4545858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545861">if</span>&nbsp;<span class="ident" id="4545864">prec</span>&nbsp;<span class="op" id="4545869">&lt;</span>&nbsp;<span class="ident" id="4545871">prec1</span>&nbsp;<span class="op" id="4545877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4545881">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4545905">//&nbsp;Note:&nbsp;The&nbsp;parser&nbsp;inserts&nbsp;an&nbsp;ast.ParenExpr&nbsp;node;&nbsp;thus&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4545973">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;only&nbsp;occur&nbsp;if&nbsp;the&nbsp;AST&nbsp;is&nbsp;created&nbsp;in&nbsp;a&nbsp;different&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546041">p</span><span class="op" id="4546042">.</span><span class="builtinfunc" id="4546043">print</span><span class="op" id="4546048">(</span><span class="ident" id="4546049">token</span><span class="op" id="4546054">.</span><span class="ident" id="4546055">LPAREN</span><span class="op" id="4546061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546065">p</span><span class="op" id="4546066">.</span><span class="ident" id="4546067">expr0</span><span class="op" id="4546072">(</span><span class="ident" id="4546073">x</span><span class="op" id="4546074">,</span>&nbsp;<span class="ident" id="4546076">reduceDepth</span><span class="op" id="4546087">(</span><span class="ident" id="4546088">depth</span><span class="op" id="4546093">)</span><span class="op" id="4546094">)</span>&nbsp;<span class="comment" id="4546096">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546137">p</span><span class="op" id="4546138">.</span><span class="builtinfunc" id="4546139">print</span><span class="op" id="4546144">(</span><span class="ident" id="4546145">token</span><span class="op" id="4546150">.</span><span class="ident" id="4546151">RPAREN</span><span class="op" id="4546157">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546161">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546173">printBlank</span>&nbsp;<span class="op" id="4546184">:=</span>&nbsp;<span class="ident" id="4546187">prec</span>&nbsp;<span class="op" id="4546192">&lt;</span>&nbsp;<span class="ident" id="4546194">cutoff</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546203">ws</span>&nbsp;<span class="op" id="4546206">:=</span>&nbsp;<span class="ident" id="4546209">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546217">p</span><span class="op" id="4546218">.</span><span class="ident" id="4546219">expr1</span><span class="op" id="4546224">(</span><span class="ident" id="4546225">x</span><span class="op" id="4546226">.</span><span class="ident" id="4546227">X</span><span class="op" id="4546228">,</span>&nbsp;<span class="ident" id="4546230">prec</span><span class="op" id="4546234">,</span>&nbsp;<span class="ident" id="4546236">depth</span><span class="op" id="4546241">+</span><span class="ident" id="4546242">diffPrec</span><span class="op" id="4546250">(</span><span class="ident" id="4546251">x</span><span class="op" id="4546252">.</span><span class="ident" id="4546253">X</span><span class="op" id="4546254">,</span>&nbsp;<span class="ident" id="4546256">prec</span><span class="op" id="4546260">)</span><span class="op" id="4546261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546264">if</span>&nbsp;<span class="ident" id="4546267">printBlank</span>&nbsp;<span class="op" id="4546278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546282">p</span><span class="op" id="4546283">.</span><span class="builtinfunc" id="4546284">print</span><span class="op" id="4546289">(</span><span class="ident" id="4546290">blank</span><span class="op" id="4546295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546298">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546301">xline</span>&nbsp;<span class="op" id="4546307">:=</span>&nbsp;<span class="ident" id="4546310">p</span><span class="op" id="4546311">.</span><span class="ident" id="4546312">pos</span><span class="op" id="4546315">.</span><span class="ident" id="4546316">Line</span>&nbsp;<span class="comment" id="4546321">//&nbsp;before&nbsp;the&nbsp;operator&nbsp;(it&nbsp;may&nbsp;be&nbsp;on&nbsp;the&nbsp;next&nbsp;line!)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546375">yline</span>&nbsp;<span class="op" id="4546381">:=</span>&nbsp;<span class="ident" id="4546384">p</span><span class="op" id="4546385">.</span><span class="ident" id="4546386">lineFor</span><span class="op" id="4546393">(</span><span class="ident" id="4546394">x</span><span class="op" id="4546395">.</span><span class="ident" id="4546396">Y</span><span class="op" id="4546397">.</span><span class="ident" id="4546398">Pos</span><span class="op" id="4546401">(</span><span class="op" id="4546402">)</span><span class="op" id="4546403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546406">p</span><span class="op" id="4546407">.</span><span class="builtinfunc" id="4546408">print</span><span class="op" id="4546413">(</span><span class="ident" id="4546414">x</span><span class="op" id="4546415">.</span><span class="ident" id="4546416">OpPos</span><span class="op" id="4546421">,</span>&nbsp;<span class="ident" id="4546423">x</span><span class="op" id="4546424">.</span><span class="ident" id="4546425">Op</span><span class="op" id="4546427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546430">if</span>&nbsp;<span class="ident" id="4546433">xline</span>&nbsp;<span class="op" id="4546439">!=</span>&nbsp;<span class="ident" id="4546442">yline</span>&nbsp;<span class="op" id="4546448">&amp;&amp;</span>&nbsp;<span class="ident" id="4546451">xline</span>&nbsp;<span class="op" id="4546457">&gt;</span>&nbsp;<span class="num" id="4546459">0</span>&nbsp;<span class="op" id="4546461">&amp;&amp;</span>&nbsp;<span class="ident" id="4546464">yline</span>&nbsp;<span class="op" id="4546470">&gt;</span>&nbsp;<span class="num" id="4546472">0</span>&nbsp;<span class="op" id="4546474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4546478">//&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break,&nbsp;but&nbsp;respect&nbsp;an&nbsp;extra&nbsp;empty&nbsp;line</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4546540">//&nbsp;in&nbsp;the&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546559">if</span>&nbsp;<span class="ident" id="4546562">p</span><span class="op" id="4546563">.</span><span class="ident" id="4546564">linebreak</span><span class="op" id="4546573">(</span><span class="ident" id="4546574">yline</span><span class="op" id="4546579">,</span>&nbsp;<span class="num" id="4546581">1</span><span class="op" id="4546582">,</span>&nbsp;<span class="ident" id="4546584">ws</span><span class="op" id="4546586">,</span>&nbsp;<span class="builtintype" id="4546588">true</span><span class="op" id="4546592">)</span>&nbsp;<span class="op" id="4546594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546599">ws</span>&nbsp;<span class="op" id="4546602">=</span>&nbsp;<span class="ident" id="4546604">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546614">printBlank</span>&nbsp;<span class="op" id="4546625">=</span>&nbsp;<span class="builtintype" id="4546627">false</span>&nbsp;<span class="comment" id="4546633">//&nbsp;no&nbsp;blank&nbsp;after&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546664">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546670">if</span>&nbsp;<span class="ident" id="4546673">printBlank</span>&nbsp;<span class="op" id="4546684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546688">p</span><span class="op" id="4546689">.</span><span class="builtinfunc" id="4546690">print</span><span class="op" id="4546695">(</span><span class="ident" id="4546696">blank</span><span class="op" id="4546701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546707">p</span><span class="op" id="4546708">.</span><span class="ident" id="4546709">expr1</span><span class="op" id="4546714">(</span><span class="ident" id="4546715">x</span><span class="op" id="4546716">.</span><span class="ident" id="4546717">Y</span><span class="op" id="4546718">,</span>&nbsp;<span class="ident" id="4546720">prec</span><span class="op" id="4546724">+</span><span class="num" id="4546725">1</span><span class="op" id="4546726">,</span>&nbsp;<span class="ident" id="4546728">depth</span><span class="op" id="4546733">+</span><span class="num" id="4546734">1</span><span class="op" id="4546735">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546738">if</span>&nbsp;<span class="ident" id="4546741">ws</span>&nbsp;<span class="op" id="4546744">==</span>&nbsp;<span class="ident" id="4546747">ignore</span>&nbsp;<span class="op" id="4546754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546758">p</span><span class="op" id="4546759">.</span><span class="builtinfunc" id="4546760">print</span><span class="op" id="4546765">(</span><span class="ident" id="4546766">unindent</span><span class="op" id="4546774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546777">}</span><br>
<span class="lineno"></span><span class="op" id="4546779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">670</span><span class="keyword" id="4546782">func</span>&nbsp;<span class="ident" id="4546787">isBinary</span><span class="op" id="4546795">(</span><span class="ident" id="4546796">expr</span>&nbsp;<span class="ident" id="4546801">ast</span><span class="op" id="4546804">.</span><span class="ident" id="4546805">Expr</span><span class="op" id="4546809">)</span>&nbsp;<span class="builtintype" id="4546811">bool</span>&nbsp;<span class="op" id="4546816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546819">_</span><span class="op" id="4546820">,</span>&nbsp;<span class="ident" id="4546822">ok</span>&nbsp;<span class="op" id="4546825">:=</span>&nbsp;<span class="ident" id="4546828">expr</span><span class="op" id="4546832">.</span><span class="op" id="4546833">(</span><span class="op" id="4546834">*</span><span class="ident" id="4546835">ast</span><span class="op" id="4546838">.</span><span class="ident" id="4546839">BinaryExpr</span><span class="op" id="4546849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546852">return</span>&nbsp;<span class="ident" id="4546859">ok</span><br>
<span class="lineno"></span><span class="op" id="4546862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="4546865">func</span>&nbsp;<span class="op" id="4546870">(</span><span class="ident" id="4546871">p</span>&nbsp;<span class="op" id="4546873">*</span><span class="ident" id="4546874">printer</span><span class="op" id="4546881">)</span>&nbsp;<span class="ident" id="4546883">expr1</span><span class="op" id="4546888">(</span><span class="ident" id="4546889">expr</span>&nbsp;<span class="ident" id="4546894">ast</span><span class="op" id="4546897">.</span><span class="ident" id="4546898">Expr</span><span class="op" id="4546902">,</span>&nbsp;<span class="ident" id="4546904">prec1</span><span class="op" id="4546909">,</span>&nbsp;<span class="ident" id="4546911">depth</span>&nbsp;<span class="builtintype" id="4546917">int</span><span class="op" id="4546920">)</span>&nbsp;<span class="op" id="4546922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546925">p</span><span class="op" id="4546926">.</span><span class="builtinfunc" id="4546927">print</span><span class="op" id="4546932">(</span><span class="ident" id="4546933">expr</span><span class="op" id="4546937">.</span><span class="ident" id="4546938">Pos</span><span class="op" id="4546941">(</span><span class="op" id="4546942">)</span><span class="op" id="4546943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546947">switch</span>&nbsp;<span class="ident" id="4546954">x</span>&nbsp;<span class="op" id="4546956">:=</span>&nbsp;<span class="ident" id="4546959">expr</span><span class="op" id="4546963">.</span><span class="op" id="4546964">(</span><span class="keyword" id="4546965">type</span><span class="op" id="4546969">)</span>&nbsp;<span class="op" id="4546971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546974">case</span>&nbsp;<span class="op" id="4546979">*</span><span class="ident" id="4546980">ast</span><span class="op" id="4546983">.</span><span class="ident" id="4546984">BadExpr</span><span class="op" id="4546991">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546995">p</span><span class="op" id="4546996">.</span><span class="builtinfunc" id="4546997">print</span><span class="op" id="4547002">(</span><span class="string" id="4547003">&#34;BadExpr&#34;</span><span class="op" id="4547012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547016">case</span>&nbsp;<span class="op" id="4547021">*</span><span class="ident" id="4547022">ast</span><span class="op" id="4547025">.</span><span class="ident" id="4547026">Ident</span><span class="op" id="4547031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547035">p</span><span class="op" id="4547036">.</span><span class="builtinfunc" id="4547037">print</span><span class="op" id="4547042">(</span><span class="ident" id="4547043">x</span><span class="op" id="4547044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547048">case</span>&nbsp;<span class="op" id="4547053">*</span><span class="ident" id="4547054">ast</span><span class="op" id="4547057">.</span><span class="ident" id="4547058">BinaryExpr</span><span class="op" id="4547068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547072">if</span>&nbsp;<span class="ident" id="4547075">depth</span>&nbsp;<span class="op" id="4547081">&lt;</span>&nbsp;<span class="num" id="4547083">1</span>&nbsp;<span class="op" id="4547085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547090">p</span><span class="op" id="4547091">.</span><span class="ident" id="4547092">internalError</span><span class="op" id="4547105">(</span><span class="string" id="4547106">&#34;depth&nbsp;&lt;&nbsp;1:&#34;</span><span class="op" id="4547118">,</span>&nbsp;<span class="ident" id="4547120">depth</span><span class="op" id="4547125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547130">depth</span>&nbsp;<span class="op" id="4547136">=</span>&nbsp;<span class="num" id="4547138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547142">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547146">p</span><span class="op" id="4547147">.</span><span class="ident" id="4547148">binaryExpr</span><span class="op" id="4547158">(</span><span class="ident" id="4547159">x</span><span class="op" id="4547160">,</span>&nbsp;<span class="ident" id="4547162">prec1</span><span class="op" id="4547167">,</span>&nbsp;<span class="ident" id="4547169">cutoff</span><span class="op" id="4547175">(</span><span class="ident" id="4547176">x</span><span class="op" id="4547177">,</span>&nbsp;<span class="ident" id="4547179">depth</span><span class="op" id="4547184">)</span><span class="op" id="4547185">,</span>&nbsp;<span class="ident" id="4547187">depth</span><span class="op" id="4547192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547196">case</span>&nbsp;<span class="op" id="4547201">*</span><span class="ident" id="4547202">ast</span><span class="op" id="4547205">.</span><span class="ident" id="4547206">KeyValueExpr</span><span class="op" id="4547218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547222">p</span><span class="op" id="4547223">.</span><span class="ident" id="4547224">expr</span><span class="op" id="4547228">(</span><span class="ident" id="4547229">x</span><span class="op" id="4547230">.</span><span class="ident" id="4547231">Key</span><span class="op" id="4547234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547238">p</span><span class="op" id="4547239">.</span><span class="builtinfunc" id="4547240">print</span><span class="op" id="4547245">(</span><span class="ident" id="4547246">x</span><span class="op" id="4547247">.</span><span class="ident" id="4547248">Colon</span><span class="op" id="4547253">,</span>&nbsp;<span class="ident" id="4547255">token</span><span class="op" id="4547260">.</span><span class="ident" id="4547261">COLON</span><span class="op" id="4547266">,</span>&nbsp;<span class="ident" id="4547268">blank</span><span class="op" id="4547273">)</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547277">p</span><span class="op" id="4547278">.</span><span class="ident" id="4547279">expr</span><span class="op" id="4547283">(</span><span class="ident" id="4547284">x</span><span class="op" id="4547285">.</span><span class="ident" id="4547286">Value</span><span class="op" id="4547291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547295">case</span>&nbsp;<span class="op" id="4547300">*</span><span class="ident" id="4547301">ast</span><span class="op" id="4547304">.</span><span class="ident" id="4547305">StarExpr</span><span class="op" id="4547313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547317">const</span>&nbsp;<span class="ident" id="4547323">prec</span>&nbsp;<span class="op" id="4547328">=</span>&nbsp;<span class="ident" id="4547330">token</span><span class="op" id="4547335">.</span><span class="ident" id="4547336">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547348">if</span>&nbsp;<span class="ident" id="4547351">prec</span>&nbsp;<span class="op" id="4547356">&lt;</span>&nbsp;<span class="ident" id="4547358">prec1</span>&nbsp;<span class="op" id="4547364">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4547369">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547394">p</span><span class="op" id="4547395">.</span><span class="builtinfunc" id="4547396">print</span><span class="op" id="4547401">(</span><span class="ident" id="4547402">token</span><span class="op" id="4547407">.</span><span class="ident" id="4547408">LPAREN</span><span class="op" id="4547414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547419">p</span><span class="op" id="4547420">.</span><span class="builtinfunc" id="4547421">print</span><span class="op" id="4547426">(</span><span class="ident" id="4547427">token</span><span class="op" id="4547432">.</span><span class="ident" id="4547433">MUL</span><span class="op" id="4547436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547441">p</span><span class="op" id="4547442">.</span><span class="ident" id="4547443">expr</span><span class="op" id="4547447">(</span><span class="ident" id="4547448">x</span><span class="op" id="4547449">.</span><span class="ident" id="4547450">X</span><span class="op" id="4547451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547456">p</span><span class="op" id="4547457">.</span><span class="builtinfunc" id="4547458">print</span><span class="op" id="4547463">(</span><span class="ident" id="4547464">token</span><span class="op" id="4547469">.</span><span class="ident" id="4547470">RPAREN</span><span class="op" id="4547476">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547480">}</span>&nbsp;<span class="keyword" id="4547482">else</span>&nbsp;<span class="op" id="4547487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4547492">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547520">p</span><span class="op" id="4547521">.</span><span class="builtinfunc" id="4547522">print</span><span class="op" id="4547527">(</span><span class="ident" id="4547528">token</span><span class="op" id="4547533">.</span><span class="ident" id="4547534">MUL</span><span class="op" id="4547537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547542">p</span><span class="op" id="4547543">.</span><span class="ident" id="4547544">expr</span><span class="op" id="4547548">(</span><span class="ident" id="4547549">x</span><span class="op" id="4547550">.</span><span class="ident" id="4547551">X</span><span class="op" id="4547552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547556">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547560">case</span>&nbsp;<span class="op" id="4547565">*</span><span class="ident" id="4547566">ast</span><span class="op" id="4547569">.</span><span class="ident" id="4547570">UnaryExpr</span><span class="op" id="4547579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547583">const</span>&nbsp;<span class="ident" id="4547589">prec</span>&nbsp;<span class="op" id="4547594">=</span>&nbsp;<span class="ident" id="4547596">token</span><span class="op" id="4547601">.</span><span class="ident" id="4547602">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547614">if</span>&nbsp;<span class="ident" id="4547617">prec</span>&nbsp;<span class="op" id="4547622">&lt;</span>&nbsp;<span class="ident" id="4547624">prec1</span>&nbsp;<span class="op" id="4547630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4547635">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547660">p</span><span class="op" id="4547661">.</span><span class="builtinfunc" id="4547662">print</span><span class="op" id="4547667">(</span><span class="ident" id="4547668">token</span><span class="op" id="4547673">.</span><span class="ident" id="4547674">LPAREN</span><span class="op" id="4547680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547685">p</span><span class="op" id="4547686">.</span><span class="ident" id="4547687">expr</span><span class="op" id="4547691">(</span><span class="ident" id="4547692">x</span><span class="op" id="4547693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547698">p</span><span class="op" id="4547699">.</span><span class="builtinfunc" id="4547700">print</span><span class="op" id="4547705">(</span><span class="ident" id="4547706">token</span><span class="op" id="4547711">.</span><span class="ident" id="4547712">RPAREN</span><span class="op" id="4547718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547722">}</span>&nbsp;<span class="keyword" id="4547724">else</span>&nbsp;<span class="op" id="4547729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4547734">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547762">p</span><span class="op" id="4547763">.</span><span class="builtinfunc" id="4547764">print</span><span class="op" id="4547769">(</span><span class="ident" id="4547770">x</span><span class="op" id="4547771">.</span><span class="ident" id="4547772">Op</span><span class="op" id="4547774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547779">if</span>&nbsp;<span class="ident" id="4547782">x</span><span class="op" id="4547783">.</span><span class="ident" id="4547784">Op</span>&nbsp;<span class="op" id="4547787">==</span>&nbsp;<span class="ident" id="4547790">token</span><span class="op" id="4547795">.</span><span class="ident" id="4547796">RANGE</span>&nbsp;<span class="op" id="4547802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4547808">//&nbsp;TODO(gri)&nbsp;Remove&nbsp;this&nbsp;code&nbsp;if&nbsp;it&nbsp;cannot&nbsp;be&nbsp;reached.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547867">p</span><span class="op" id="4547868">.</span><span class="builtinfunc" id="4547869">print</span><span class="op" id="4547874">(</span><span class="ident" id="4547875">blank</span><span class="op" id="4547880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547885">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547890">p</span><span class="op" id="4547891">.</span><span class="ident" id="4547892">expr1</span><span class="op" id="4547897">(</span><span class="ident" id="4547898">x</span><span class="op" id="4547899">.</span><span class="ident" id="4547900">X</span><span class="op" id="4547901">,</span>&nbsp;<span class="ident" id="4547903">prec</span><span class="op" id="4547907">,</span>&nbsp;<span class="ident" id="4547909">depth</span><span class="op" id="4547914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547922">case</span>&nbsp;<span class="op" id="4547927">*</span><span class="ident" id="4547928">ast</span><span class="op" id="4547931">.</span><span class="ident" id="4547932">BasicLit</span><span class="op" id="4547940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547944">p</span><span class="op" id="4547945">.</span><span class="builtinfunc" id="4547946">print</span><span class="op" id="4547951">(</span><span class="ident" id="4547952">x</span><span class="op" id="4547953">)</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547957">case</span>&nbsp;<span class="op" id="4547962">*</span><span class="ident" id="4547963">ast</span><span class="op" id="4547966">.</span><span class="ident" id="4547967">FuncLit</span><span class="op" id="4547974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547978">p</span><span class="op" id="4547979">.</span><span class="ident" id="4547980">expr</span><span class="op" id="4547984">(</span><span class="ident" id="4547985">x</span><span class="op" id="4547986">.</span><span class="ident" id="4547987">Type</span><span class="op" id="4547991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547995">p</span><span class="op" id="4547996">.</span><span class="ident" id="4547997">adjBlock</span><span class="op" id="4548005">(</span><span class="ident" id="4548006">p</span><span class="op" id="4548007">.</span><span class="ident" id="4548008">distanceFrom</span><span class="op" id="4548020">(</span><span class="ident" id="4548021">x</span><span class="op" id="4548022">.</span><span class="ident" id="4548023">Type</span><span class="op" id="4548027">.</span><span class="ident" id="4548028">Pos</span><span class="op" id="4548031">(</span><span class="op" id="4548032">)</span><span class="op" id="4548033">)</span><span class="op" id="4548034">,</span>&nbsp;<span class="ident" id="4548036">blank</span><span class="op" id="4548041">,</span>&nbsp;<span class="ident" id="4548043">x</span><span class="op" id="4548044">.</span><span class="ident" id="4548045">Body</span><span class="op" id="4548049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548053">case</span>&nbsp;<span class="op" id="4548058">*</span><span class="ident" id="4548059">ast</span><span class="op" id="4548062">.</span><span class="ident" id="4548063">ParenExpr</span><span class="op" id="4548072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548076">if</span>&nbsp;<span class="ident" id="4548079">_</span><span class="op" id="4548080">,</span>&nbsp;<span class="ident" id="4548082">hasParens</span>&nbsp;<span class="op" id="4548092">:=</span>&nbsp;<span class="ident" id="4548095">x</span><span class="op" id="4548096">.</span><span class="ident" id="4548097">X</span><span class="op" id="4548098">.</span><span class="op" id="4548099">(</span><span class="op" id="4548100">*</span><span class="ident" id="4548101">ast</span><span class="op" id="4548104">.</span><span class="ident" id="4548105">ParenExpr</span><span class="op" id="4548114">)</span><span class="op" id="4548115">;</span>&nbsp;<span class="ident" id="4548117">hasParens</span>&nbsp;<span class="op" id="4548127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548132">//&nbsp;don&#39;t&nbsp;print&nbsp;parentheses&nbsp;around&nbsp;an&nbsp;already&nbsp;parenthesized&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548205">//&nbsp;TODO(gri)&nbsp;consider&nbsp;making&nbsp;this&nbsp;more&nbsp;general&nbsp;and&nbsp;incorporate&nbsp;precedence&nbsp;levels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548289">p</span><span class="op" id="4548290">.</span><span class="ident" id="4548291">expr0</span><span class="op" id="4548296">(</span><span class="ident" id="4548297">x</span><span class="op" id="4548298">.</span><span class="ident" id="4548299">X</span><span class="op" id="4548300">,</span>&nbsp;<span class="ident" id="4548302">depth</span><span class="op" id="4548307">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548311">}</span>&nbsp;<span class="keyword" id="4548313">else</span>&nbsp;<span class="op" id="4548318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548323">p</span><span class="op" id="4548324">.</span><span class="builtinfunc" id="4548325">print</span><span class="op" id="4548330">(</span><span class="ident" id="4548331">token</span><span class="op" id="4548336">.</span><span class="ident" id="4548337">LPAREN</span><span class="op" id="4548343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548348">p</span><span class="op" id="4548349">.</span><span class="ident" id="4548350">expr0</span><span class="op" id="4548355">(</span><span class="ident" id="4548356">x</span><span class="op" id="4548357">.</span><span class="ident" id="4548358">X</span><span class="op" id="4548359">,</span>&nbsp;<span class="ident" id="4548361">reduceDepth</span><span class="op" id="4548372">(</span><span class="ident" id="4548373">depth</span><span class="op" id="4548378">)</span><span class="op" id="4548379">)</span>&nbsp;<span class="comment" id="4548381">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548423">p</span><span class="op" id="4548424">.</span><span class="builtinfunc" id="4548425">print</span><span class="op" id="4548430">(</span><span class="ident" id="4548431">x</span><span class="op" id="4548432">.</span><span class="ident" id="4548433">Rparen</span><span class="op" id="4548439">,</span>&nbsp;<span class="ident" id="4548441">token</span><span class="op" id="4548446">.</span><span class="ident" id="4548447">RPAREN</span><span class="op" id="4548453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548457">}</span><br>
<span class="lineno">745</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548461">case</span>&nbsp;<span class="op" id="4548466">*</span><span class="ident" id="4548467">ast</span><span class="op" id="4548470">.</span><span class="ident" id="4548471">SelectorExpr</span><span class="op" id="4548483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548487">p</span><span class="op" id="4548488">.</span><span class="ident" id="4548489">expr1</span><span class="op" id="4548494">(</span><span class="ident" id="4548495">x</span><span class="op" id="4548496">.</span><span class="ident" id="4548497">X</span><span class="op" id="4548498">,</span>&nbsp;<span class="ident" id="4548500">token</span><span class="op" id="4548505">.</span><span class="ident" id="4548506">HighestPrec</span><span class="op" id="4548517">,</span>&nbsp;<span class="ident" id="4548519">depth</span><span class="op" id="4548524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548528">p</span><span class="op" id="4548529">.</span><span class="builtinfunc" id="4548530">print</span><span class="op" id="4548535">(</span><span class="ident" id="4548536">token</span><span class="op" id="4548541">.</span><span class="ident" id="4548542">PERIOD</span><span class="op" id="4548548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548552">if</span>&nbsp;<span class="ident" id="4548555">line</span>&nbsp;<span class="op" id="4548560">:=</span>&nbsp;<span class="ident" id="4548563">p</span><span class="op" id="4548564">.</span><span class="ident" id="4548565">lineFor</span><span class="op" id="4548572">(</span><span class="ident" id="4548573">x</span><span class="op" id="4548574">.</span><span class="ident" id="4548575">Sel</span><span class="op" id="4548578">.</span><span class="ident" id="4548579">Pos</span><span class="op" id="4548582">(</span><span class="op" id="4548583">)</span><span class="op" id="4548584">)</span><span class="op" id="4548585">;</span>&nbsp;<span class="ident" id="4548587">p</span><span class="op" id="4548588">.</span><span class="ident" id="4548589">pos</span><span class="op" id="4548592">.</span><span class="ident" id="4548593">IsValid</span><span class="op" id="4548600">(</span><span class="op" id="4548601">)</span>&nbsp;<span class="op" id="4548603">&amp;&amp;</span>&nbsp;<span class="ident" id="4548606">p</span><span class="op" id="4548607">.</span><span class="ident" id="4548608">pos</span><span class="op" id="4548611">.</span><span class="ident" id="4548612">Line</span>&nbsp;<span class="op" id="4548617">&lt;</span>&nbsp;<span class="ident" id="4548619">line</span>&nbsp;<span class="op" id="4548624">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548629">p</span><span class="op" id="4548630">.</span><span class="builtinfunc" id="4548631">print</span><span class="op" id="4548636">(</span><span class="ident" id="4548637">indent</span><span class="op" id="4548643">,</span>&nbsp;<span class="ident" id="4548645">newline</span><span class="op" id="4548652">,</span>&nbsp;<span class="ident" id="4548654">x</span><span class="op" id="4548655">.</span><span class="ident" id="4548656">Sel</span><span class="op" id="4548659">.</span><span class="ident" id="4548660">Pos</span><span class="op" id="4548663">(</span><span class="op" id="4548664">)</span><span class="op" id="4548665">,</span>&nbsp;<span class="ident" id="4548667">x</span><span class="op" id="4548668">.</span><span class="ident" id="4548669">Sel</span><span class="op" id="4548672">,</span>&nbsp;<span class="ident" id="4548674">unindent</span><span class="op" id="4548682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548686">}</span>&nbsp;<span class="keyword" id="4548688">else</span>&nbsp;<span class="op" id="4548693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548698">p</span><span class="op" id="4548699">.</span><span class="builtinfunc" id="4548700">print</span><span class="op" id="4548705">(</span><span class="ident" id="4548706">x</span><span class="op" id="4548707">.</span><span class="ident" id="4548708">Sel</span><span class="op" id="4548711">.</span><span class="ident" id="4548712">Pos</span><span class="op" id="4548715">(</span><span class="op" id="4548716">)</span><span class="op" id="4548717">,</span>&nbsp;<span class="ident" id="4548719">x</span><span class="op" id="4548720">.</span><span class="ident" id="4548721">Sel</span><span class="op" id="4548724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548732">case</span>&nbsp;<span class="op" id="4548737">*</span><span class="ident" id="4548738">ast</span><span class="op" id="4548741">.</span><span class="ident" id="4548742">TypeAssertExpr</span><span class="op" id="4548756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548760">p</span><span class="op" id="4548761">.</span><span class="ident" id="4548762">expr1</span><span class="op" id="4548767">(</span><span class="ident" id="4548768">x</span><span class="op" id="4548769">.</span><span class="ident" id="4548770">X</span><span class="op" id="4548771">,</span>&nbsp;<span class="ident" id="4548773">token</span><span class="op" id="4548778">.</span><span class="ident" id="4548779">HighestPrec</span><span class="op" id="4548790">,</span>&nbsp;<span class="ident" id="4548792">depth</span><span class="op" id="4548797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548801">p</span><span class="op" id="4548802">.</span><span class="builtinfunc" id="4548803">print</span><span class="op" id="4548808">(</span><span class="ident" id="4548809">token</span><span class="op" id="4548814">.</span><span class="ident" id="4548815">PERIOD</span><span class="op" id="4548821">,</span>&nbsp;<span class="ident" id="4548823">x</span><span class="op" id="4548824">.</span><span class="ident" id="4548825">Lparen</span><span class="op" id="4548831">,</span>&nbsp;<span class="ident" id="4548833">token</span><span class="op" id="4548838">.</span><span class="ident" id="4548839">LPAREN</span><span class="op" id="4548845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548849">if</span>&nbsp;<span class="ident" id="4548852">x</span><span class="op" id="4548853">.</span><span class="ident" id="4548854">Type</span>&nbsp;<span class="op" id="4548859">!=</span>&nbsp;<span class="ident" id="4548862">nil</span>&nbsp;<span class="op" id="4548866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548871">p</span><span class="op" id="4548872">.</span><span class="ident" id="4548873">expr</span><span class="op" id="4548877">(</span><span class="ident" id="4548878">x</span><span class="op" id="4548879">.</span><span class="ident" id="4548880">Type</span><span class="op" id="4548884">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548888">}</span>&nbsp;<span class="keyword" id="4548890">else</span>&nbsp;<span class="op" id="4548895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548900">p</span><span class="op" id="4548901">.</span><span class="builtinfunc" id="4548902">print</span><span class="op" id="4548907">(</span><span class="ident" id="4548908">token</span><span class="op" id="4548913">.</span><span class="ident" id="4548914">TYPE</span><span class="op" id="4548918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548926">p</span><span class="op" id="4548927">.</span><span class="builtinfunc" id="4548928">print</span><span class="op" id="4548933">(</span><span class="ident" id="4548934">x</span><span class="op" id="4548935">.</span><span class="ident" id="4548936">Rparen</span><span class="op" id="4548942">,</span>&nbsp;<span class="ident" id="4548944">token</span><span class="op" id="4548949">.</span><span class="ident" id="4548950">RPAREN</span><span class="op" id="4548956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548960">case</span>&nbsp;<span class="op" id="4548965">*</span><span class="ident" id="4548966">ast</span><span class="op" id="4548969">.</span><span class="ident" id="4548970">IndexExpr</span><span class="op" id="4548979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548983">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549059">p</span><span class="op" id="4549060">.</span><span class="ident" id="4549061">expr1</span><span class="op" id="4549066">(</span><span class="ident" id="4549067">x</span><span class="op" id="4549068">.</span><span class="ident" id="4549069">X</span><span class="op" id="4549070">,</span>&nbsp;<span class="ident" id="4549072">token</span><span class="op" id="4549077">.</span><span class="ident" id="4549078">HighestPrec</span><span class="op" id="4549089">,</span>&nbsp;<span class="num" id="4549091">1</span><span class="op" id="4549092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549096">p</span><span class="op" id="4549097">.</span><span class="builtinfunc" id="4549098">print</span><span class="op" id="4549103">(</span><span class="ident" id="4549104">x</span><span class="op" id="4549105">.</span><span class="ident" id="4549106">Lbrack</span><span class="op" id="4549112">,</span>&nbsp;<span class="ident" id="4549114">token</span><span class="op" id="4549119">.</span><span class="ident" id="4549120">LBRACK</span><span class="op" id="4549126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549130">p</span><span class="op" id="4549131">.</span><span class="ident" id="4549132">expr0</span><span class="op" id="4549137">(</span><span class="ident" id="4549138">x</span><span class="op" id="4549139">.</span><span class="ident" id="4549140">Index</span><span class="op" id="4549145">,</span>&nbsp;<span class="ident" id="4549147">depth</span><span class="op" id="4549152">+</span><span class="num" id="4549153">1</span><span class="op" id="4549154">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549158">p</span><span class="op" id="4549159">.</span><span class="builtinfunc" id="4549160">print</span><span class="op" id="4549165">(</span><span class="ident" id="4549166">x</span><span class="op" id="4549167">.</span><span class="ident" id="4549168">Rbrack</span><span class="op" id="4549174">,</span>&nbsp;<span class="ident" id="4549176">token</span><span class="op" id="4549181">.</span><span class="ident" id="4549182">RBRACK</span><span class="op" id="4549188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549192">case</span>&nbsp;<span class="op" id="4549197">*</span><span class="ident" id="4549198">ast</span><span class="op" id="4549201">.</span><span class="ident" id="4549202">SliceExpr</span><span class="op" id="4549211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549215">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549291">p</span><span class="op" id="4549292">.</span><span class="ident" id="4549293">expr1</span><span class="op" id="4549298">(</span><span class="ident" id="4549299">x</span><span class="op" id="4549300">.</span><span class="ident" id="4549301">X</span><span class="op" id="4549302">,</span>&nbsp;<span class="ident" id="4549304">token</span><span class="op" id="4549309">.</span><span class="ident" id="4549310">HighestPrec</span><span class="op" id="4549321">,</span>&nbsp;<span class="num" id="4549323">1</span><span class="op" id="4549324">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549328">p</span><span class="op" id="4549329">.</span><span class="builtinfunc" id="4549330">print</span><span class="op" id="4549335">(</span><span class="ident" id="4549336">x</span><span class="op" id="4549337">.</span><span class="ident" id="4549338">Lbrack</span><span class="op" id="4549344">,</span>&nbsp;<span class="ident" id="4549346">token</span><span class="op" id="4549351">.</span><span class="ident" id="4549352">LBRACK</span><span class="op" id="4549358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549362">indices</span>&nbsp;<span class="op" id="4549370">:=</span>&nbsp;<span class="op" id="4549373">[</span><span class="op" id="4549374">]</span><span class="ident" id="4549375">ast</span><span class="op" id="4549378">.</span><span class="ident" id="4549379">Expr</span><span class="op" id="4549383">{</span><span class="ident" id="4549384">x</span><span class="op" id="4549385">.</span><span class="ident" id="4549386">Low</span><span class="op" id="4549389">,</span>&nbsp;<span class="ident" id="4549391">x</span><span class="op" id="4549392">.</span><span class="ident" id="4549393">High</span><span class="op" id="4549397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549401">if</span>&nbsp;<span class="ident" id="4549404">x</span><span class="op" id="4549405">.</span><span class="ident" id="4549406">Max</span>&nbsp;<span class="op" id="4549410">!=</span>&nbsp;<span class="ident" id="4549413">nil</span>&nbsp;<span class="op" id="4549417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549422">indices</span>&nbsp;<span class="op" id="4549430">=</span>&nbsp;<span class="builtinfunc" id="4549432">append</span><span class="op" id="4549438">(</span><span class="ident" id="4549439">indices</span><span class="op" id="4549446">,</span>&nbsp;<span class="ident" id="4549448">x</span><span class="op" id="4549449">.</span><span class="ident" id="4549450">Max</span><span class="op" id="4549453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549457">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549461">for</span>&nbsp;<span class="ident" id="4549465">i</span><span class="op" id="4549466">,</span>&nbsp;<span class="ident" id="4549468">y</span>&nbsp;<span class="op" id="4549470">:=</span>&nbsp;<span class="keyword" id="4549473">range</span>&nbsp;<span class="ident" id="4549479">indices</span>&nbsp;<span class="op" id="4549487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549492">if</span>&nbsp;<span class="ident" id="4549495">i</span>&nbsp;<span class="op" id="4549497">&gt;</span>&nbsp;<span class="num" id="4549499">0</span>&nbsp;<span class="op" id="4549501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549507">//&nbsp;blanks&nbsp;around&nbsp;&#34;:&#34;&nbsp;if&nbsp;both&nbsp;sides&nbsp;exist&nbsp;and&nbsp;either&nbsp;side&nbsp;is&nbsp;a&nbsp;binary&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549591">//&nbsp;TODO(gri)&nbsp;once&nbsp;we&nbsp;have&nbsp;committed&nbsp;a&nbsp;variant&nbsp;of&nbsp;a[i:j:k]&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;fine-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549674">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tune&nbsp;the&nbsp;formatting&nbsp;here</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549716">x</span>&nbsp;<span class="op" id="4549718">:=</span>&nbsp;<span class="ident" id="4549721">indices</span><span class="op" id="4549728">[</span><span class="ident" id="4549729">i</span><span class="op" id="4549730">-</span><span class="num" id="4549731">1</span><span class="op" id="4549732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549738">if</span>&nbsp;<span class="ident" id="4549741">depth</span>&nbsp;<span class="op" id="4549747">&lt;=</span>&nbsp;<span class="num" id="4549750">1</span>&nbsp;<span class="op" id="4549752">&amp;&amp;</span>&nbsp;<span class="ident" id="4549755">x</span>&nbsp;<span class="op" id="4549757">!=</span>&nbsp;<span class="ident" id="4549760">nil</span>&nbsp;<span class="op" id="4549764">&amp;&amp;</span>&nbsp;<span class="ident" id="4549767">y</span>&nbsp;<span class="op" id="4549769">!=</span>&nbsp;<span class="ident" id="4549772">nil</span>&nbsp;<span class="op" id="4549776">&amp;&amp;</span>&nbsp;<span class="op" id="4549779">(</span><span class="ident" id="4549780">isBinary</span><span class="op" id="4549788">(</span><span class="ident" id="4549789">x</span><span class="op" id="4549790">)</span>&nbsp;<span class="op" id="4549792">||</span>&nbsp;<span class="ident" id="4549795">isBinary</span><span class="op" id="4549803">(</span><span class="ident" id="4549804">y</span><span class="op" id="4549805">)</span><span class="op" id="4549806">)</span>&nbsp;<span class="op" id="4549808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549815">p</span><span class="op" id="4549816">.</span><span class="builtinfunc" id="4549817">print</span><span class="op" id="4549822">(</span><span class="ident" id="4549823">blank</span><span class="op" id="4549828">,</span>&nbsp;<span class="ident" id="4549830">token</span><span class="op" id="4549835">.</span><span class="ident" id="4549836">COLON</span><span class="op" id="4549841">,</span>&nbsp;<span class="ident" id="4549843">blank</span><span class="op" id="4549848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549854">}</span>&nbsp;<span class="keyword" id="4549856">else</span>&nbsp;<span class="op" id="4549861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549868">p</span><span class="op" id="4549869">.</span><span class="builtinfunc" id="4549870">print</span><span class="op" id="4549875">(</span><span class="ident" id="4549876">token</span><span class="op" id="4549881">.</span><span class="ident" id="4549882">COLON</span><span class="op" id="4549887">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549903">if</span>&nbsp;<span class="ident" id="4549906">y</span>&nbsp;<span class="op" id="4549908">!=</span>&nbsp;<span class="ident" id="4549911">nil</span>&nbsp;<span class="op" id="4549915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549921">p</span><span class="op" id="4549922">.</span><span class="ident" id="4549923">expr0</span><span class="op" id="4549928">(</span><span class="ident" id="4549929">y</span><span class="op" id="4549930">,</span>&nbsp;<span class="ident" id="4549932">depth</span><span class="op" id="4549937">+</span><span class="num" id="4549938">1</span><span class="op" id="4549939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549944">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549952">p</span><span class="op" id="4549953">.</span><span class="builtinfunc" id="4549954">print</span><span class="op" id="4549959">(</span><span class="ident" id="4549960">x</span><span class="op" id="4549961">.</span><span class="ident" id="4549962">Rbrack</span><span class="op" id="4549968">,</span>&nbsp;<span class="ident" id="4549970">token</span><span class="op" id="4549975">.</span><span class="ident" id="4549976">RBRACK</span><span class="op" id="4549982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549986">case</span>&nbsp;<span class="op" id="4549991">*</span><span class="ident" id="4549992">ast</span><span class="op" id="4549995">.</span><span class="ident" id="4549996">CallExpr</span><span class="op" id="4550004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550008">if</span>&nbsp;<span class="builtinfunc" id="4550011">len</span><span class="op" id="4550014">(</span><span class="ident" id="4550015">x</span><span class="op" id="4550016">.</span><span class="ident" id="4550017">Args</span><span class="op" id="4550021">)</span>&nbsp;<span class="op" id="4550023">&gt;</span>&nbsp;<span class="num" id="4550025">1</span>&nbsp;<span class="op" id="4550027">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550032">depth</span><span class="op" id="4550037">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550046">if</span>&nbsp;<span class="ident" id="4550049">_</span><span class="op" id="4550050">,</span>&nbsp;<span class="ident" id="4550052">ok</span>&nbsp;<span class="op" id="4550055">:=</span>&nbsp;<span class="ident" id="4550058">x</span><span class="op" id="4550059">.</span><span class="ident" id="4550060">Fun</span><span class="op" id="4550063">.</span><span class="op" id="4550064">(</span><span class="op" id="4550065">*</span><span class="ident" id="4550066">ast</span><span class="op" id="4550069">.</span><span class="ident" id="4550070">FuncType</span><span class="op" id="4550078">)</span><span class="op" id="4550079">;</span>&nbsp;<span class="ident" id="4550081">ok</span>&nbsp;<span class="op" id="4550084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550089">//&nbsp;conversions&nbsp;to&nbsp;literal&nbsp;function&nbsp;types&nbsp;require&nbsp;parentheses&nbsp;around&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550169">p</span><span class="op" id="4550170">.</span><span class="builtinfunc" id="4550171">print</span><span class="op" id="4550176">(</span><span class="ident" id="4550177">token</span><span class="op" id="4550182">.</span><span class="ident" id="4550183">LPAREN</span><span class="op" id="4550189">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550194">p</span><span class="op" id="4550195">.</span><span class="ident" id="4550196">expr1</span><span class="op" id="4550201">(</span><span class="ident" id="4550202">x</span><span class="op" id="4550203">.</span><span class="ident" id="4550204">Fun</span><span class="op" id="4550207">,</span>&nbsp;<span class="ident" id="4550209">token</span><span class="op" id="4550214">.</span><span class="ident" id="4550215">HighestPrec</span><span class="op" id="4550226">,</span>&nbsp;<span class="ident" id="4550228">depth</span><span class="op" id="4550233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550238">p</span><span class="op" id="4550239">.</span><span class="builtinfunc" id="4550240">print</span><span class="op" id="4550245">(</span><span class="ident" id="4550246">token</span><span class="op" id="4550251">.</span><span class="ident" id="4550252">RPAREN</span><span class="op" id="4550258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550262">}</span>&nbsp;<span class="keyword" id="4550264">else</span>&nbsp;<span class="op" id="4550269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550274">p</span><span class="op" id="4550275">.</span><span class="ident" id="4550276">expr1</span><span class="op" id="4550281">(</span><span class="ident" id="4550282">x</span><span class="op" id="4550283">.</span><span class="ident" id="4550284">Fun</span><span class="op" id="4550287">,</span>&nbsp;<span class="ident" id="4550289">token</span><span class="op" id="4550294">.</span><span class="ident" id="4550295">HighestPrec</span><span class="op" id="4550306">,</span>&nbsp;<span class="ident" id="4550308">depth</span><span class="op" id="4550313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550317">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550321">p</span><span class="op" id="4550322">.</span><span class="builtinfunc" id="4550323">print</span><span class="op" id="4550328">(</span><span class="ident" id="4550329">x</span><span class="op" id="4550330">.</span><span class="ident" id="4550331">Lparen</span><span class="op" id="4550337">,</span>&nbsp;<span class="ident" id="4550339">token</span><span class="op" id="4550344">.</span><span class="ident" id="4550345">LPAREN</span><span class="op" id="4550351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550355">if</span>&nbsp;<span class="ident" id="4550358">x</span><span class="op" id="4550359">.</span><span class="ident" id="4550360">Ellipsis</span><span class="op" id="4550368">.</span><span class="ident" id="4550369">IsValid</span><span class="op" id="4550376">(</span><span class="op" id="4550377">)</span>&nbsp;<span class="op" id="4550379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550384">p</span><span class="op" id="4550385">.</span><span class="ident" id="4550386">exprList</span><span class="op" id="4550394">(</span><span class="ident" id="4550395">x</span><span class="op" id="4550396">.</span><span class="ident" id="4550397">Lparen</span><span class="op" id="4550403">,</span>&nbsp;<span class="ident" id="4550405">x</span><span class="op" id="4550406">.</span><span class="ident" id="4550407">Args</span><span class="op" id="4550411">,</span>&nbsp;<span class="ident" id="4550413">depth</span><span class="op" id="4550418">,</span>&nbsp;<span class="num" id="4550420">0</span><span class="op" id="4550421">,</span>&nbsp;<span class="ident" id="4550423">x</span><span class="op" id="4550424">.</span><span class="ident" id="4550425">Ellipsis</span><span class="op" id="4550433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550438">p</span><span class="op" id="4550439">.</span><span class="builtinfunc" id="4550440">print</span><span class="op" id="4550445">(</span><span class="ident" id="4550446">x</span><span class="op" id="4550447">.</span><span class="ident" id="4550448">Ellipsis</span><span class="op" id="4550456">,</span>&nbsp;<span class="ident" id="4550458">token</span><span class="op" id="4550463">.</span><span class="ident" id="4550464">ELLIPSIS</span><span class="op" id="4550472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550477">if</span>&nbsp;<span class="ident" id="4550480">x</span><span class="op" id="4550481">.</span><span class="ident" id="4550482">Rparen</span><span class="op" id="4550488">.</span><span class="ident" id="4550489">IsValid</span><span class="op" id="4550496">(</span><span class="op" id="4550497">)</span>&nbsp;<span class="op" id="4550499">&amp;&amp;</span>&nbsp;<span class="ident" id="4550502">p</span><span class="op" id="4550503">.</span><span class="ident" id="4550504">lineFor</span><span class="op" id="4550511">(</span><span class="ident" id="4550512">x</span><span class="op" id="4550513">.</span><span class="ident" id="4550514">Ellipsis</span><span class="op" id="4550522">)</span>&nbsp;<span class="op" id="4550524">&lt;</span>&nbsp;<span class="ident" id="4550526">p</span><span class="op" id="4550527">.</span><span class="ident" id="4550528">lineFor</span><span class="op" id="4550535">(</span><span class="ident" id="4550536">x</span><span class="op" id="4550537">.</span><span class="ident" id="4550538">Rparen</span><span class="op" id="4550544">)</span>&nbsp;<span class="op" id="4550546">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550552">p</span><span class="op" id="4550553">.</span><span class="builtinfunc" id="4550554">print</span><span class="op" id="4550559">(</span><span class="ident" id="4550560">token</span><span class="op" id="4550565">.</span><span class="ident" id="4550566">COMMA</span><span class="op" id="4550571">,</span>&nbsp;<span class="ident" id="4550573">formfeed</span><span class="op" id="4550581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550590">}</span>&nbsp;<span class="keyword" id="4550592">else</span>&nbsp;<span class="op" id="4550597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550602">p</span><span class="op" id="4550603">.</span><span class="ident" id="4550604">exprList</span><span class="op" id="4550612">(</span><span class="ident" id="4550613">x</span><span class="op" id="4550614">.</span><span class="ident" id="4550615">Lparen</span><span class="op" id="4550621">,</span>&nbsp;<span class="ident" id="4550623">x</span><span class="op" id="4550624">.</span><span class="ident" id="4550625">Args</span><span class="op" id="4550629">,</span>&nbsp;<span class="ident" id="4550631">depth</span><span class="op" id="4550636">,</span>&nbsp;<span class="ident" id="4550638">commaTerm</span><span class="op" id="4550647">,</span>&nbsp;<span class="ident" id="4550649">x</span><span class="op" id="4550650">.</span><span class="ident" id="4550651">Rparen</span><span class="op" id="4550657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550661">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550665">p</span><span class="op" id="4550666">.</span><span class="builtinfunc" id="4550667">print</span><span class="op" id="4550672">(</span><span class="ident" id="4550673">x</span><span class="op" id="4550674">.</span><span class="ident" id="4550675">Rparen</span><span class="op" id="4550681">,</span>&nbsp;<span class="ident" id="4550683">token</span><span class="op" id="4550688">.</span><span class="ident" id="4550689">RPAREN</span><span class="op" id="4550695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550699">case</span>&nbsp;<span class="op" id="4550704">*</span><span class="ident" id="4550705">ast</span><span class="op" id="4550708">.</span><span class="ident" id="4550709">CompositeLit</span><span class="op" id="4550721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550725">//&nbsp;composite&nbsp;literal&nbsp;elements&nbsp;that&nbsp;are&nbsp;composite&nbsp;literals&nbsp;themselves&nbsp;may&nbsp;have&nbsp;the&nbsp;type&nbsp;omitted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550822">if</span>&nbsp;<span class="ident" id="4550825">x</span><span class="op" id="4550826">.</span><span class="ident" id="4550827">Type</span>&nbsp;<span class="op" id="4550832">!=</span>&nbsp;<span class="ident" id="4550835">nil</span>&nbsp;<span class="op" id="4550839">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550844">p</span><span class="op" id="4550845">.</span><span class="ident" id="4550846">expr1</span><span class="op" id="4550851">(</span><span class="ident" id="4550852">x</span><span class="op" id="4550853">.</span><span class="ident" id="4550854">Type</span><span class="op" id="4550858">,</span>&nbsp;<span class="ident" id="4550860">token</span><span class="op" id="4550865">.</span><span class="ident" id="4550866">HighestPrec</span><span class="op" id="4550877">,</span>&nbsp;<span class="ident" id="4550879">depth</span><span class="op" id="4550884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550892">p</span><span class="op" id="4550893">.</span><span class="builtinfunc" id="4550894">print</span><span class="op" id="4550899">(</span><span class="ident" id="4550900">x</span><span class="op" id="4550901">.</span><span class="ident" id="4550902">Lbrace</span><span class="op" id="4550908">,</span>&nbsp;<span class="ident" id="4550910">token</span><span class="op" id="4550915">.</span><span class="ident" id="4550916">LBRACE</span><span class="op" id="4550922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550926">p</span><span class="op" id="4550927">.</span><span class="ident" id="4550928">exprList</span><span class="op" id="4550936">(</span><span class="ident" id="4550937">x</span><span class="op" id="4550938">.</span><span class="ident" id="4550939">Lbrace</span><span class="op" id="4550945">,</span>&nbsp;<span class="ident" id="4550947">x</span><span class="op" id="4550948">.</span><span class="ident" id="4550949">Elts</span><span class="op" id="4550953">,</span>&nbsp;<span class="num" id="4550955">1</span><span class="op" id="4550956">,</span>&nbsp;<span class="ident" id="4550958">commaTerm</span><span class="op" id="4550967">,</span>&nbsp;<span class="ident" id="4550969">x</span><span class="op" id="4550970">.</span><span class="ident" id="4550971">Rbrace</span><span class="op" id="4550977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550981">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;line&nbsp;break&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4551046">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;as&nbsp;it&nbsp;might&nbsp;break&nbsp;the&nbsp;code&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4551110">//&nbsp;is&nbsp;no&nbsp;trailing&nbsp;&#39;,&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551134">mode</span>&nbsp;<span class="op" id="4551139">:=</span>&nbsp;<span class="ident" id="4551142">noExtraLinebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4551161">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;blank&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4551221">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;the&nbsp;literal&nbsp;is&nbsp;empty</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551277">if</span>&nbsp;<span class="builtinfunc" id="4551280">len</span><span class="op" id="4551283">(</span><span class="ident" id="4551284">x</span><span class="op" id="4551285">.</span><span class="ident" id="4551286">Elts</span><span class="op" id="4551290">)</span>&nbsp;<span class="op" id="4551292">&gt;</span>&nbsp;<span class="num" id="4551294">0</span>&nbsp;<span class="op" id="4551296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551301">mode</span>&nbsp;<span class="op" id="4551306">|=</span>&nbsp;<span class="ident" id="4551309">noExtraBlank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551328">p</span><span class="op" id="4551329">.</span><span class="builtinfunc" id="4551330">print</span><span class="op" id="4551335">(</span><span class="ident" id="4551336">mode</span><span class="op" id="4551340">,</span>&nbsp;<span class="ident" id="4551342">x</span><span class="op" id="4551343">.</span><span class="ident" id="4551344">Rbrace</span><span class="op" id="4551350">,</span>&nbsp;<span class="ident" id="4551352">token</span><span class="op" id="4551357">.</span><span class="ident" id="4551358">RBRACE</span><span class="op" id="4551364">,</span>&nbsp;<span class="ident" id="4551366">mode</span><span class="op" id="4551370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551374">case</span>&nbsp;<span class="op" id="4551379">*</span><span class="ident" id="4551380">ast</span><span class="op" id="4551383">.</span><span class="ident" id="4551384">Ellipsis</span><span class="op" id="4551392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551396">p</span><span class="op" id="4551397">.</span><span class="builtinfunc" id="4551398">print</span><span class="op" id="4551403">(</span><span class="ident" id="4551404">token</span><span class="op" id="4551409">.</span><span class="ident" id="4551410">ELLIPSIS</span><span class="op" id="4551418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551422">if</span>&nbsp;<span class="ident" id="4551425">x</span><span class="op" id="4551426">.</span><span class="ident" id="4551427">Elt</span>&nbsp;<span class="op" id="4551431">!=</span>&nbsp;<span class="ident" id="4551434">nil</span>&nbsp;<span class="op" id="4551438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551443">p</span><span class="op" id="4551444">.</span><span class="ident" id="4551445">expr</span><span class="op" id="4551449">(</span><span class="ident" id="4551450">x</span><span class="op" id="4551451">.</span><span class="ident" id="4551452">Elt</span><span class="op" id="4551455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551459">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551463">case</span>&nbsp;<span class="op" id="4551468">*</span><span class="ident" id="4551469">ast</span><span class="op" id="4551472">.</span><span class="ident" id="4551473">ArrayType</span><span class="op" id="4551482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551486">p</span><span class="op" id="4551487">.</span><span class="builtinfunc" id="4551488">print</span><span class="op" id="4551493">(</span><span class="ident" id="4551494">token</span><span class="op" id="4551499">.</span><span class="ident" id="4551500">LBRACK</span><span class="op" id="4551506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551510">if</span>&nbsp;<span class="ident" id="4551513">x</span><span class="op" id="4551514">.</span><span class="ident" id="4551515">Len</span>&nbsp;<span class="op" id="4551519">!=</span>&nbsp;<span class="ident" id="4551522">nil</span>&nbsp;<span class="op" id="4551526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551531">p</span><span class="op" id="4551532">.</span><span class="ident" id="4551533">expr</span><span class="op" id="4551537">(</span><span class="ident" id="4551538">x</span><span class="op" id="4551539">.</span><span class="ident" id="4551540">Len</span><span class="op" id="4551543">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551551">p</span><span class="op" id="4551552">.</span><span class="builtinfunc" id="4551553">print</span><span class="op" id="4551558">(</span><span class="ident" id="4551559">token</span><span class="op" id="4551564">.</span><span class="ident" id="4551565">RBRACK</span><span class="op" id="4551571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551575">p</span><span class="op" id="4551576">.</span><span class="ident" id="4551577">expr</span><span class="op" id="4551581">(</span><span class="ident" id="4551582">x</span><span class="op" id="4551583">.</span><span class="ident" id="4551584">Elt</span><span class="op" id="4551587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551591">case</span>&nbsp;<span class="op" id="4551596">*</span><span class="ident" id="4551597">ast</span><span class="op" id="4551600">.</span><span class="ident" id="4551601">StructType</span><span class="op" id="4551611">:</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551615">p</span><span class="op" id="4551616">.</span><span class="builtinfunc" id="4551617">print</span><span class="op" id="4551622">(</span><span class="ident" id="4551623">token</span><span class="op" id="4551628">.</span><span class="ident" id="4551629">STRUCT</span><span class="op" id="4551635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551639">p</span><span class="op" id="4551640">.</span><span class="ident" id="4551641">fieldList</span><span class="op" id="4551650">(</span><span class="ident" id="4551651">x</span><span class="op" id="4551652">.</span><span class="ident" id="4551653">Fields</span><span class="op" id="4551659">,</span>&nbsp;<span class="builtintype" id="4551661">true</span><span class="op" id="4551665">,</span>&nbsp;<span class="ident" id="4551667">x</span><span class="op" id="4551668">.</span><span class="ident" id="4551669">Incomplete</span><span class="op" id="4551679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551683">case</span>&nbsp;<span class="op" id="4551688">*</span><span class="ident" id="4551689">ast</span><span class="op" id="4551692">.</span><span class="ident" id="4551693">FuncType</span><span class="op" id="4551701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551705">p</span><span class="op" id="4551706">.</span><span class="builtinfunc" id="4551707">print</span><span class="op" id="4551712">(</span><span class="ident" id="4551713">token</span><span class="op" id="4551718">.</span><span class="ident" id="4551719">FUNC</span><span class="op" id="4551723">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551727">p</span><span class="op" id="4551728">.</span><span class="ident" id="4551729">signature</span><span class="op" id="4551738">(</span><span class="ident" id="4551739">x</span><span class="op" id="4551740">.</span><span class="ident" id="4551741">Params</span><span class="op" id="4551747">,</span>&nbsp;<span class="ident" id="4551749">x</span><span class="op" id="4551750">.</span><span class="ident" id="4551751">Results</span><span class="op" id="4551758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551762">case</span>&nbsp;<span class="op" id="4551767">*</span><span class="ident" id="4551768">ast</span><span class="op" id="4551771">.</span><span class="ident" id="4551772">InterfaceType</span><span class="op" id="4551785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551789">p</span><span class="op" id="4551790">.</span><span class="builtinfunc" id="4551791">print</span><span class="op" id="4551796">(</span><span class="ident" id="4551797">token</span><span class="op" id="4551802">.</span><span class="ident" id="4551803">INTERFACE</span><span class="op" id="4551812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551816">p</span><span class="op" id="4551817">.</span><span class="ident" id="4551818">fieldList</span><span class="op" id="4551827">(</span><span class="ident" id="4551828">x</span><span class="op" id="4551829">.</span><span class="ident" id="4551830">Methods</span><span class="op" id="4551837">,</span>&nbsp;<span class="builtintype" id="4551839">false</span><span class="op" id="4551844">,</span>&nbsp;<span class="ident" id="4551846">x</span><span class="op" id="4551847">.</span><span class="ident" id="4551848">Incomplete</span><span class="op" id="4551858">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551862">case</span>&nbsp;<span class="op" id="4551867">*</span><span class="ident" id="4551868">ast</span><span class="op" id="4551871">.</span><span class="ident" id="4551872">MapType</span><span class="op" id="4551879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551883">p</span><span class="op" id="4551884">.</span><span class="builtinfunc" id="4551885">print</span><span class="op" id="4551890">(</span><span class="ident" id="4551891">token</span><span class="op" id="4551896">.</span><span class="ident" id="4551897">MAP</span><span class="op" id="4551900">,</span>&nbsp;<span class="ident" id="4551902">token</span><span class="op" id="4551907">.</span><span class="ident" id="4551908">LBRACK</span><span class="op" id="4551914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551918">p</span><span class="op" id="4551919">.</span><span class="ident" id="4551920">expr</span><span class="op" id="4551924">(</span><span class="ident" id="4551925">x</span><span class="op" id="4551926">.</span><span class="ident" id="4551927">Key</span><span class="op" id="4551930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551934">p</span><span class="op" id="4551935">.</span><span class="builtinfunc" id="4551936">print</span><span class="op" id="4551941">(</span><span class="ident" id="4551942">token</span><span class="op" id="4551947">.</span><span class="ident" id="4551948">RBRACK</span><span class="op" id="4551954">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551958">p</span><span class="op" id="4551959">.</span><span class="ident" id="4551960">expr</span><span class="op" id="4551964">(</span><span class="ident" id="4551965">x</span><span class="op" id="4551966">.</span><span class="ident" id="4551967">Value</span><span class="op" id="4551972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551976">case</span>&nbsp;<span class="op" id="4551981">*</span><span class="ident" id="4551982">ast</span><span class="op" id="4551985">.</span><span class="ident" id="4551986">ChanType</span><span class="op" id="4551994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551998">switch</span>&nbsp;<span class="ident" id="4552005">x</span><span class="op" id="4552006">.</span><span class="ident" id="4552007">Dir</span>&nbsp;<span class="op" id="4552011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552015">case</span>&nbsp;<span class="ident" id="4552020">ast</span><span class="op" id="4552023">.</span><span class="ident" id="4552024">SEND</span>&nbsp;<span class="op" id="4552029">|</span>&nbsp;<span class="ident" id="4552031">ast</span><span class="op" id="4552034">.</span><span class="ident" id="4552035">RECV</span><span class="op" id="4552039">:</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552044">p</span><span class="op" id="4552045">.</span><span class="builtinfunc" id="4552046">print</span><span class="op" id="4552051">(</span><span class="ident" id="4552052">token</span><span class="op" id="4552057">.</span><span class="ident" id="4552058">CHAN</span><span class="op" id="4552062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552066">case</span>&nbsp;<span class="ident" id="4552071">ast</span><span class="op" id="4552074">.</span><span class="ident" id="4552075">RECV</span><span class="op" id="4552079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552084">p</span><span class="op" id="4552085">.</span><span class="builtinfunc" id="4552086">print</span><span class="op" id="4552091">(</span><span class="ident" id="4552092">token</span><span class="op" id="4552097">.</span><span class="ident" id="4552098">ARROW</span><span class="op" id="4552103">,</span>&nbsp;<span class="ident" id="4552105">token</span><span class="op" id="4552110">.</span><span class="ident" id="4552111">CHAN</span><span class="op" id="4552115">)</span>&nbsp;<span class="comment" id="4552117">//&nbsp;x.Arrow&nbsp;and&nbsp;x.Pos()&nbsp;are&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552155">case</span>&nbsp;<span class="ident" id="4552160">ast</span><span class="op" id="4552163">.</span><span class="ident" id="4552164">SEND</span><span class="op" id="4552168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552173">p</span><span class="op" id="4552174">.</span><span class="builtinfunc" id="4552175">print</span><span class="op" id="4552180">(</span><span class="ident" id="4552181">token</span><span class="op" id="4552186">.</span><span class="ident" id="4552187">CHAN</span><span class="op" id="4552191">,</span>&nbsp;<span class="ident" id="4552193">x</span><span class="op" id="4552194">.</span><span class="ident" id="4552195">Arrow</span><span class="op" id="4552200">,</span>&nbsp;<span class="ident" id="4552202">token</span><span class="op" id="4552207">.</span><span class="ident" id="4552208">ARROW</span><span class="op" id="4552213">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552221">p</span><span class="op" id="4552222">.</span><span class="builtinfunc" id="4552223">print</span><span class="op" id="4552228">(</span><span class="ident" id="4552229">blank</span><span class="op" id="4552234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552238">p</span><span class="op" id="4552239">.</span><span class="ident" id="4552240">expr</span><span class="op" id="4552244">(</span><span class="ident" id="4552245">x</span><span class="op" id="4552246">.</span><span class="ident" id="4552247">Value</span><span class="op" id="4552252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552256">default</span><span class="op" id="4552263">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4552267">panic</span><span class="op" id="4552272">(</span><span class="string" id="4552273">&#34;unreachable&#34;</span><span class="op" id="4552286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552293">return</span><br>
<span class="lineno"></span><span class="op" id="4552300">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="keyword" id="4552303">func</span>&nbsp;<span class="op" id="4552308">(</span><span class="ident" id="4552309">p</span>&nbsp;<span class="op" id="4552311">*</span><span class="ident" id="4552312">printer</span><span class="op" id="4552319">)</span>&nbsp;<span class="ident" id="4552321">expr0</span><span class="op" id="4552326">(</span><span class="ident" id="4552327">x</span>&nbsp;<span class="ident" id="4552329">ast</span><span class="op" id="4552332">.</span><span class="ident" id="4552333">Expr</span><span class="op" id="4552337">,</span>&nbsp;<span class="ident" id="4552339">depth</span>&nbsp;<span class="builtintype" id="4552345">int</span><span class="op" id="4552348">)</span>&nbsp;<span class="op" id="4552350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552353">p</span><span class="op" id="4552354">.</span><span class="ident" id="4552355">expr1</span><span class="op" id="4552360">(</span><span class="ident" id="4552361">x</span><span class="op" id="4552362">,</span>&nbsp;<span class="ident" id="4552364">token</span><span class="op" id="4552369">.</span><span class="ident" id="4552370">LowestPrec</span><span class="op" id="4552380">,</span>&nbsp;<span class="ident" id="4552382">depth</span><span class="op" id="4552387">)</span><br>
<span class="lineno"></span><span class="op" id="4552389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">895</span><span class="keyword" id="4552392">func</span>&nbsp;<span class="op" id="4552397">(</span><span class="ident" id="4552398">p</span>&nbsp;<span class="op" id="4552400">*</span><span class="ident" id="4552401">printer</span><span class="op" id="4552408">)</span>&nbsp;<span class="ident" id="4552410">expr</span><span class="op" id="4552414">(</span><span class="ident" id="4552415">x</span>&nbsp;<span class="ident" id="4552417">ast</span><span class="op" id="4552420">.</span><span class="ident" id="4552421">Expr</span><span class="op" id="4552425">)</span>&nbsp;<span class="op" id="4552427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552430">const</span>&nbsp;<span class="ident" id="4552436">depth</span>&nbsp;<span class="op" id="4552442">=</span>&nbsp;<span class="num" id="4552444">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552447">p</span><span class="op" id="4552448">.</span><span class="ident" id="4552449">expr1</span><span class="op" id="4552454">(</span><span class="ident" id="4552455">x</span><span class="op" id="4552456">,</span>&nbsp;<span class="ident" id="4552458">token</span><span class="op" id="4552463">.</span><span class="ident" id="4552464">LowestPrec</span><span class="op" id="4552474">,</span>&nbsp;<span class="ident" id="4552476">depth</span><span class="op" id="4552481">)</span><br>
<span class="lineno"></span><span class="op" id="4552483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span><span class="comment" id="4552486">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4552566">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4552581">//&nbsp;Print&nbsp;the&nbsp;statement&nbsp;list&nbsp;indented,&nbsp;but&nbsp;without&nbsp;a&nbsp;newline&nbsp;after&nbsp;the&nbsp;last&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4552667">//&nbsp;Extra&nbsp;line&nbsp;breaks&nbsp;between&nbsp;statements&nbsp;in&nbsp;the&nbsp;source&nbsp;are&nbsp;respected&nbsp;but&nbsp;at&nbsp;most&nbsp;one</span><br>
<span class="lineno">905</span><span class="comment" id="4552751">//&nbsp;empty&nbsp;line&nbsp;is&nbsp;printed&nbsp;between&nbsp;statements.</span><br>
<span class="lineno"></span><span class="keyword" id="4552796">func</span>&nbsp;<span class="op" id="4552801">(</span><span class="ident" id="4552802">p</span>&nbsp;<span class="op" id="4552804">*</span><span class="ident" id="4552805">printer</span><span class="op" id="4552812">)</span>&nbsp;<span class="ident" id="4552814">stmtList</span><span class="op" id="4552822">(</span><span class="ident" id="4552823">list</span>&nbsp;<span class="op" id="4552828">[</span><span class="op" id="4552829">]</span><span class="ident" id="4552830">ast</span><span class="op" id="4552833">.</span><span class="ident" id="4552834">Stmt</span><span class="op" id="4552838">,</span>&nbsp;<span class="ident" id="4552840">nindent</span>&nbsp;<span class="builtintype" id="4552848">int</span><span class="op" id="4552851">,</span>&nbsp;<span class="ident" id="4552853">nextIsRBrace</span>&nbsp;<span class="builtintype" id="4552866">bool</span><span class="op" id="4552870">)</span>&nbsp;<span class="op" id="4552872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552875">if</span>&nbsp;<span class="ident" id="4552878">nindent</span>&nbsp;<span class="op" id="4552886">&gt;</span>&nbsp;<span class="num" id="4552888">0</span>&nbsp;<span class="op" id="4552890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552894">p</span><span class="op" id="4552895">.</span><span class="builtinfunc" id="4552896">print</span><span class="op" id="4552901">(</span><span class="ident" id="4552902">indent</span><span class="op" id="4552908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552911">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552914">var</span>&nbsp;<span class="ident" id="4552918">line</span>&nbsp;<span class="builtintype" id="4552923">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552928">i</span>&nbsp;<span class="op" id="4552930">:=</span>&nbsp;<span class="num" id="4552933">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552936">for</span>&nbsp;<span class="ident" id="4552940">_</span><span class="op" id="4552941">,</span>&nbsp;<span class="ident" id="4552943">s</span>&nbsp;<span class="op" id="4552945">:=</span>&nbsp;<span class="keyword" id="4552948">range</span>&nbsp;<span class="ident" id="4552954">list</span>&nbsp;<span class="op" id="4552959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4552963">//&nbsp;ignore&nbsp;empty&nbsp;statements&nbsp;(was&nbsp;issue&nbsp;3466)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553009">if</span>&nbsp;<span class="ident" id="4553012">_</span><span class="op" id="4553013">,</span>&nbsp;<span class="ident" id="4553015">isEmpty</span>&nbsp;<span class="op" id="4553023">:=</span>&nbsp;<span class="ident" id="4553026">s</span><span class="op" id="4553027">.</span><span class="op" id="4553028">(</span><span class="op" id="4553029">*</span><span class="ident" id="4553030">ast</span><span class="op" id="4553033">.</span><span class="ident" id="4553034">EmptyStmt</span><span class="op" id="4553043">)</span><span class="op" id="4553044">;</span>&nbsp;<span class="op" id="4553046">!</span><span class="ident" id="4553047">isEmpty</span>&nbsp;<span class="op" id="4553055">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553060">//&nbsp;nindent&nbsp;==&nbsp;0&nbsp;only&nbsp;for&nbsp;lists&nbsp;of&nbsp;switch/select&nbsp;case&nbsp;clauses;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553125">//&nbsp;in&nbsp;those&nbsp;cases&nbsp;each&nbsp;clause&nbsp;is&nbsp;a&nbsp;new&nbsp;section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553175">if</span>&nbsp;<span class="builtinfunc" id="4553178">len</span><span class="op" id="4553181">(</span><span class="ident" id="4553182">p</span><span class="op" id="4553183">.</span><span class="ident" id="4553184">output</span><span class="op" id="4553190">)</span>&nbsp;<span class="op" id="4553192">&gt;</span>&nbsp;<span class="num" id="4553194">0</span>&nbsp;<span class="op" id="4553196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553202">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553276">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553334">p</span><span class="op" id="4553335">.</span><span class="ident" id="4553336">linebreak</span><span class="op" id="4553345">(</span><span class="ident" id="4553346">p</span><span class="op" id="4553347">.</span><span class="ident" id="4553348">lineFor</span><span class="op" id="4553355">(</span><span class="ident" id="4553356">s</span><span class="op" id="4553357">.</span><span class="ident" id="4553358">Pos</span><span class="op" id="4553361">(</span><span class="op" id="4553362">)</span><span class="op" id="4553363">)</span><span class="op" id="4553364">,</span>&nbsp;<span class="num" id="4553366">1</span><span class="op" id="4553367">,</span>&nbsp;<span class="ident" id="4553369">ignore</span><span class="op" id="4553375">,</span>&nbsp;<span class="ident" id="4553377">i</span>&nbsp;<span class="op" id="4553379">==</span>&nbsp;<span class="num" id="4553382">0</span>&nbsp;<span class="op" id="4553384">||</span>&nbsp;<span class="ident" id="4553387">nindent</span>&nbsp;<span class="op" id="4553395">==</span>&nbsp;<span class="num" id="4553398">0</span>&nbsp;<span class="op" id="4553400">||</span>&nbsp;<span class="ident" id="4553403">p</span><span class="op" id="4553404">.</span><span class="ident" id="4553405">linesFrom</span><span class="op" id="4553414">(</span><span class="ident" id="4553415">line</span><span class="op" id="4553419">)</span>&nbsp;<span class="op" id="4553421">&gt;</span>&nbsp;<span class="num" id="4553423">0</span><span class="op" id="4553424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553434">p</span><span class="op" id="4553435">.</span><span class="ident" id="4553436">recordLine</span><span class="op" id="4553446">(</span><span class="op" id="4553447">&amp;</span><span class="ident" id="4553448">line</span><span class="op" id="4553452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553457">p</span><span class="op" id="4553458">.</span><span class="ident" id="4553459">stmt</span><span class="op" id="4553463">(</span><span class="ident" id="4553464">s</span><span class="op" id="4553465">,</span>&nbsp;<span class="ident" id="4553467">nextIsRBrace</span>&nbsp;<span class="op" id="4553480">&amp;&amp;</span>&nbsp;<span class="ident" id="4553483">i</span>&nbsp;<span class="op" id="4553485">==</span>&nbsp;<span class="builtinfunc" id="4553488">len</span><span class="op" id="4553491">(</span><span class="ident" id="4553492">list</span><span class="op" id="4553496">)</span><span class="op" id="4553497">-</span><span class="num" id="4553498">1</span><span class="op" id="4553499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553504">//&nbsp;labeled&nbsp;statements&nbsp;put&nbsp;labels&nbsp;on&nbsp;a&nbsp;separate&nbsp;line,&nbsp;but&nbsp;here</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553569">//&nbsp;we&nbsp;only&nbsp;care&nbsp;about&nbsp;the&nbsp;start&nbsp;line&nbsp;of&nbsp;the&nbsp;actual&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553633">//&nbsp;without&nbsp;label&nbsp;-&nbsp;correct&nbsp;line&nbsp;for&nbsp;each&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553683">for</span>&nbsp;<span class="ident" id="4553687">t</span>&nbsp;<span class="op" id="4553689">:=</span>&nbsp;<span class="ident" id="4553692">s</span><span class="op" id="4553693">;</span>&nbsp;<span class="op" id="4553695">;</span>&nbsp;<span class="op" id="4553697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553703">lt</span><span class="op" id="4553705">,</span>&nbsp;<span class="ident" id="4553707">_</span>&nbsp;<span class="op" id="4553709">:=</span>&nbsp;<span class="ident" id="4553712">t</span><span class="op" id="4553713">.</span><span class="op" id="4553714">(</span><span class="op" id="4553715">*</span><span class="ident" id="4553716">ast</span><span class="op" id="4553719">.</span><span class="ident" id="4553720">LabeledStmt</span><span class="op" id="4553731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553737">if</span>&nbsp;<span class="ident" id="4553740">lt</span>&nbsp;<span class="op" id="4553743">==</span>&nbsp;<span class="ident" id="4553746">nil</span>&nbsp;<span class="op" id="4553750">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553757">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553773">line</span><span class="op" id="4553777">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553784">t</span>&nbsp;<span class="op" id="4553786">=</span>&nbsp;<span class="ident" id="4553788">lt</span><span class="op" id="4553790">.</span><span class="ident" id="4553791">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553799">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553804">i</span><span class="op" id="4553805">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553816">if</span>&nbsp;<span class="ident" id="4553819">nindent</span>&nbsp;<span class="op" id="4553827">&gt;</span>&nbsp;<span class="num" id="4553829">0</span>&nbsp;<span class="op" id="4553831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553835">p</span><span class="op" id="4553836">.</span><span class="builtinfunc" id="4553837">print</span><span class="op" id="4553842">(</span><span class="ident" id="4553843">unindent</span><span class="op" id="4553851">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553854">}</span><br>
<span class="lineno"></span><span class="op" id="4553856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4553859">//&nbsp;block&nbsp;prints&nbsp;an&nbsp;*ast.BlockStmt;&nbsp;it&nbsp;always&nbsp;spans&nbsp;at&nbsp;least&nbsp;two&nbsp;lines.</span><br>
<span class="lineno"></span><span class="keyword" id="4553930">func</span>&nbsp;<span class="op" id="4553935">(</span><span class="ident" id="4553936">p</span>&nbsp;<span class="op" id="4553938">*</span><span class="ident" id="4553939">printer</span><span class="op" id="4553946">)</span>&nbsp;<span class="ident" id="4553948">block</span><span class="op" id="4553953">(</span><span class="ident" id="4553954">b</span>&nbsp;<span class="op" id="4553956">*</span><span class="ident" id="4553957">ast</span><span class="op" id="4553960">.</span><span class="ident" id="4553961">BlockStmt</span><span class="op" id="4553970">,</span>&nbsp;<span class="ident" id="4553972">nindent</span>&nbsp;<span class="builtintype" id="4553980">int</span><span class="op" id="4553983">)</span>&nbsp;<span class="op" id="4553985">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553988">p</span><span class="op" id="4553989">.</span><span class="builtinfunc" id="4553990">print</span><span class="op" id="4553995">(</span><span class="ident" id="4553996">b</span><span class="op" id="4553997">.</span><span class="ident" id="4553998">Lbrace</span><span class="op" id="4554004">,</span>&nbsp;<span class="ident" id="4554006">token</span><span class="op" id="4554011">.</span><span class="ident" id="4554012">LBRACE</span><span class="op" id="4554018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554021">p</span><span class="op" id="4554022">.</span><span class="ident" id="4554023">stmtList</span><span class="op" id="4554031">(</span><span class="ident" id="4554032">b</span><span class="op" id="4554033">.</span><span class="ident" id="4554034">List</span><span class="op" id="4554038">,</span>&nbsp;<span class="ident" id="4554040">nindent</span><span class="op" id="4554047">,</span>&nbsp;<span class="builtintype" id="4554049">true</span><span class="op" id="4554053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554056">p</span><span class="op" id="4554057">.</span><span class="ident" id="4554058">linebreak</span><span class="op" id="4554067">(</span><span class="ident" id="4554068">p</span><span class="op" id="4554069">.</span><span class="ident" id="4554070">lineFor</span><span class="op" id="4554077">(</span><span class="ident" id="4554078">b</span><span class="op" id="4554079">.</span><span class="ident" id="4554080">Rbrace</span><span class="op" id="4554086">)</span><span class="op" id="4554087">,</span>&nbsp;<span class="num" id="4554089">1</span><span class="op" id="4554090">,</span>&nbsp;<span class="ident" id="4554092">ignore</span><span class="op" id="4554098">,</span>&nbsp;<span class="builtintype" id="4554100">true</span><span class="op" id="4554104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554107">p</span><span class="op" id="4554108">.</span><span class="builtinfunc" id="4554109">print</span><span class="op" id="4554114">(</span><span class="ident" id="4554115">b</span><span class="op" id="4554116">.</span><span class="ident" id="4554117">Rbrace</span><span class="op" id="4554123">,</span>&nbsp;<span class="ident" id="4554125">token</span><span class="op" id="4554130">.</span><span class="ident" id="4554131">RBRACE</span><span class="op" id="4554137">)</span><br>
<span class="lineno"></span><span class="op" id="4554139">}</span><br>
<span class="lineno">950</span><br>
<span class="lineno"></span><span class="keyword" id="4554142">func</span>&nbsp;<span class="ident" id="4554147">isTypeName</span><span class="op" id="4554157">(</span><span class="ident" id="4554158">x</span>&nbsp;<span class="ident" id="4554160">ast</span><span class="op" id="4554163">.</span><span class="ident" id="4554164">Expr</span><span class="op" id="4554168">)</span>&nbsp;<span class="builtintype" id="4554170">bool</span>&nbsp;<span class="op" id="4554175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554178">switch</span>&nbsp;<span class="ident" id="4554185">t</span>&nbsp;<span class="op" id="4554187">:=</span>&nbsp;<span class="ident" id="4554190">x</span><span class="op" id="4554191">.</span><span class="op" id="4554192">(</span><span class="keyword" id="4554193">type</span><span class="op" id="4554197">)</span>&nbsp;<span class="op" id="4554199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554202">case</span>&nbsp;<span class="op" id="4554207">*</span><span class="ident" id="4554208">ast</span><span class="op" id="4554211">.</span><span class="ident" id="4554212">Ident</span><span class="op" id="4554217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554221">return</span>&nbsp;<span class="builtintype" id="4554228">true</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554234">case</span>&nbsp;<span class="op" id="4554239">*</span><span class="ident" id="4554240">ast</span><span class="op" id="4554243">.</span><span class="ident" id="4554244">SelectorExpr</span><span class="op" id="4554256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554260">return</span>&nbsp;<span class="ident" id="4554267">isTypeName</span><span class="op" id="4554277">(</span><span class="ident" id="4554278">t</span><span class="op" id="4554279">.</span><span class="ident" id="4554280">X</span><span class="op" id="4554281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554287">return</span>&nbsp;<span class="builtintype" id="4554294">false</span><br>
<span class="lineno"></span><span class="op" id="4554300">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span><span class="keyword" id="4554303">func</span>&nbsp;<span class="ident" id="4554308">stripParens</span><span class="op" id="4554319">(</span><span class="ident" id="4554320">x</span>&nbsp;<span class="ident" id="4554322">ast</span><span class="op" id="4554325">.</span><span class="ident" id="4554326">Expr</span><span class="op" id="4554330">)</span>&nbsp;<span class="ident" id="4554332">ast</span><span class="op" id="4554335">.</span><span class="ident" id="4554336">Expr</span>&nbsp;<span class="op" id="4554341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554344">if</span>&nbsp;<span class="ident" id="4554347">px</span><span class="op" id="4554349">,</span>&nbsp;<span class="ident" id="4554351">strip</span>&nbsp;<span class="op" id="4554357">:=</span>&nbsp;<span class="ident" id="4554360">x</span><span class="op" id="4554361">.</span><span class="op" id="4554362">(</span><span class="op" id="4554363">*</span><span class="ident" id="4554364">ast</span><span class="op" id="4554367">.</span><span class="ident" id="4554368">ParenExpr</span><span class="op" id="4554377">)</span><span class="op" id="4554378">;</span>&nbsp;<span class="ident" id="4554380">strip</span>&nbsp;<span class="op" id="4554386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554390">//&nbsp;parentheses&nbsp;must&nbsp;not&nbsp;be&nbsp;stripped&nbsp;if&nbsp;there&nbsp;are&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554445">//&nbsp;unparenthesized&nbsp;composite&nbsp;literals&nbsp;starting&nbsp;with</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554499">//&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554516">ast</span><span class="op" id="4554519">.</span><span class="ident" id="4554520">Inspect</span><span class="op" id="4554527">(</span><span class="ident" id="4554528">px</span><span class="op" id="4554530">.</span><span class="ident" id="4554531">X</span><span class="op" id="4554532">,</span>&nbsp;<span class="keyword" id="4554534">func</span><span class="op" id="4554538">(</span><span class="ident" id="4554539">node</span>&nbsp;<span class="ident" id="4554544">ast</span><span class="op" id="4554547">.</span><span class="ident" id="4554548">Node</span><span class="op" id="4554552">)</span>&nbsp;<span class="builtintype" id="4554554">bool</span>&nbsp;<span class="op" id="4554559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554564">switch</span>&nbsp;<span class="ident" id="4554571">x</span>&nbsp;<span class="op" id="4554573">:=</span>&nbsp;<span class="ident" id="4554576">node</span><span class="op" id="4554580">.</span><span class="op" id="4554581">(</span><span class="keyword" id="4554582">type</span><span class="op" id="4554586">)</span>&nbsp;<span class="op" id="4554588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554593">case</span>&nbsp;<span class="op" id="4554598">*</span><span class="ident" id="4554599">ast</span><span class="op" id="4554602">.</span><span class="ident" id="4554603">ParenExpr</span><span class="op" id="4554612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554618">//&nbsp;parentheses&nbsp;protect&nbsp;enclosed&nbsp;composite&nbsp;literals</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554673">return</span>&nbsp;<span class="builtintype" id="4554680">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554689">case</span>&nbsp;<span class="op" id="4554694">*</span><span class="ident" id="4554695">ast</span><span class="op" id="4554698">.</span><span class="ident" id="4554699">CompositeLit</span><span class="op" id="4554711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554717">if</span>&nbsp;<span class="ident" id="4554720">isTypeName</span><span class="op" id="4554730">(</span><span class="ident" id="4554731">x</span><span class="op" id="4554732">.</span><span class="ident" id="4554733">Type</span><span class="op" id="4554737">)</span>&nbsp;<span class="op" id="4554739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554746">strip</span>&nbsp;<span class="op" id="4554752">=</span>&nbsp;<span class="builtintype" id="4554754">false</span>&nbsp;<span class="comment" id="4554760">//&nbsp;do&nbsp;not&nbsp;strip&nbsp;parentheses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554792">}</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554798">return</span>&nbsp;<span class="builtintype" id="4554805">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554819">//&nbsp;in&nbsp;all&nbsp;other&nbsp;cases,&nbsp;keep&nbsp;inspecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554861">return</span>&nbsp;<span class="builtintype" id="4554868">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554875">}</span><span class="op" id="4554876">)</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554880">if</span>&nbsp;<span class="ident" id="4554883">strip</span>&nbsp;<span class="op" id="4554889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554894">return</span>&nbsp;<span class="ident" id="4554901">stripParens</span><span class="op" id="4554912">(</span><span class="ident" id="4554913">px</span><span class="op" id="4554915">.</span><span class="ident" id="4554916">X</span><span class="op" id="4554917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554927">return</span>&nbsp;<span class="ident" id="4554934">x</span><br>
<span class="lineno">985</span><span class="op" id="4554936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4554939">func</span>&nbsp;<span class="ident" id="4554944">stripParensAlways</span><span class="op" id="4554961">(</span><span class="ident" id="4554962">x</span>&nbsp;<span class="ident" id="4554964">ast</span><span class="op" id="4554967">.</span><span class="ident" id="4554968">Expr</span><span class="op" id="4554972">)</span>&nbsp;<span class="ident" id="4554974">ast</span><span class="op" id="4554977">.</span><span class="ident" id="4554978">Expr</span>&nbsp;<span class="op" id="4554983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554986">if</span>&nbsp;<span class="ident" id="4554989">x</span><span class="op" id="4554990">,</span>&nbsp;<span class="ident" id="4554992">ok</span>&nbsp;<span class="op" id="4554995">:=</span>&nbsp;<span class="ident" id="4554998">x</span><span class="op" id="4554999">.</span><span class="op" id="4555000">(</span><span class="op" id="4555001">*</span><span class="ident" id="4555002">ast</span><span class="op" id="4555005">.</span><span class="ident" id="4555006">ParenExpr</span><span class="op" id="4555015">)</span><span class="op" id="4555016">;</span>&nbsp;<span class="ident" id="4555018">ok</span>&nbsp;<span class="op" id="4555021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555025">return</span>&nbsp;<span class="ident" id="4555032">stripParensAlways</span><span class="op" id="4555049">(</span><span class="ident" id="4555050">x</span><span class="op" id="4555051">.</span><span class="ident" id="4555052">X</span><span class="op" id="4555053">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555059">return</span>&nbsp;<span class="ident" id="4555066">x</span><br>
<span class="lineno"></span><span class="op" id="4555068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4555071">func</span>&nbsp;<span class="op" id="4555076">(</span><span class="ident" id="4555077">p</span>&nbsp;<span class="op" id="4555079">*</span><span class="ident" id="4555080">printer</span><span class="op" id="4555087">)</span>&nbsp;<span class="ident" id="4555089">controlClause</span><span class="op" id="4555102">(</span><span class="ident" id="4555103">isForStmt</span>&nbsp;<span class="builtintype" id="4555113">bool</span><span class="op" id="4555117">,</span>&nbsp;<span class="ident" id="4555119">init</span>&nbsp;<span class="ident" id="4555124">ast</span><span class="op" id="4555127">.</span><span class="ident" id="4555128">Stmt</span><span class="op" id="4555132">,</span>&nbsp;<span class="ident" id="4555134">expr</span>&nbsp;<span class="ident" id="4555139">ast</span><span class="op" id="4555142">.</span><span class="ident" id="4555143">Expr</span><span class="op" id="4555147">,</span>&nbsp;<span class="ident" id="4555149">post</span>&nbsp;<span class="ident" id="4555154">ast</span><span class="op" id="4555157">.</span><span class="ident" id="4555158">Stmt</span><span class="op" id="4555162">)</span>&nbsp;<span class="op" id="4555164">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555167">p</span><span class="op" id="4555168">.</span><span class="builtinfunc" id="4555169">print</span><span class="op" id="4555174">(</span><span class="ident" id="4555175">blank</span><span class="op" id="4555180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555183">needsBlank</span>&nbsp;<span class="op" id="4555194">:=</span>&nbsp;<span class="builtintype" id="4555197">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555204">if</span>&nbsp;<span class="ident" id="4555207">init</span>&nbsp;<span class="op" id="4555212">==</span>&nbsp;<span class="ident" id="4555215">nil</span>&nbsp;<span class="op" id="4555219">&amp;&amp;</span>&nbsp;<span class="ident" id="4555222">post</span>&nbsp;<span class="op" id="4555227">==</span>&nbsp;<span class="ident" id="4555230">nil</span>&nbsp;<span class="op" id="4555234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4555238">//&nbsp;no&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555266">if</span>&nbsp;<span class="ident" id="4555269">expr</span>&nbsp;<span class="op" id="4555274">!=</span>&nbsp;<span class="ident" id="4555277">nil</span>&nbsp;<span class="op" id="4555281">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555286">p</span><span class="op" id="4555287">.</span><span class="ident" id="4555288">expr</span><span class="op" id="4555292">(</span><span class="ident" id="4555293">stripParens</span><span class="op" id="4555304">(</span><span class="ident" id="4555305">expr</span><span class="op" id="4555309">)</span><span class="op" id="4555310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555315">needsBlank</span>&nbsp;<span class="op" id="4555326">=</span>&nbsp;<span class="builtintype" id="4555328">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555338">}</span>&nbsp;<span class="keyword" id="4555340">else</span>&nbsp;<span class="op" id="4555345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4555349">//&nbsp;all&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4555378">//&nbsp;(they&nbsp;are&nbsp;not&nbsp;separators,&nbsp;print&nbsp;them&nbsp;explicitly)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555432">if</span>&nbsp;<span class="ident" id="4555435">init</span>&nbsp;<span class="op" id="4555440">!=</span>&nbsp;<span class="ident" id="4555443">nil</span>&nbsp;<span class="op" id="4555447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555452">p</span><span class="op" id="4555453">.</span><span class="ident" id="4555454">stmt</span><span class="op" id="4555458">(</span><span class="ident" id="4555459">init</span><span class="op" id="4555463">,</span>&nbsp;<span class="builtintype" id="4555465">false</span><span class="op" id="4555470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555478">p</span><span class="op" id="4555479">.</span><span class="builtinfunc" id="4555480">print</span><span class="op" id="4555485">(</span><span class="ident" id="4555486">token</span><span class="op" id="4555491">.</span><span class="ident" id="4555492">SEMICOLON</span><span class="op" id="4555501">,</span>&nbsp;<span class="ident" id="4555503">blank</span><span class="op" id="4555508">)</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555512">if</span>&nbsp;<span class="ident" id="4555515">expr</span>&nbsp;<span class="op" id="4555520">!=</span>&nbsp;<span class="ident" id="4555523">nil</span>&nbsp;<span class="op" id="4555527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555532">p</span><span class="op" id="4555533">.</span><span class="ident" id="4555534">expr</span><span class="op" id="4555538">(</span><span class="ident" id="4555539">stripParens</span><span class="op" id="4555550">(</span><span class="ident" id="4555551">expr</span><span class="op" id="4555555">)</span><span class="op" id="4555556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555561">needsBlank</span>&nbsp;<span class="op" id="4555572">=</span>&nbsp;<span class="builtintype" id="4555574">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555585">if</span>&nbsp;<span class="ident" id="4555588">isForStmt</span>&nbsp;<span class="op" id="4555598">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555603">p</span><span class="op" id="4555604">.</span><span class="builtinfunc" id="4555605">print</span><span class="op" id="4555610">(</span><span class="ident" id="4555611">token</span><span class="op" id="4555616">.</span><span class="ident" id="4555617">SEMICOLON</span><span class="op" id="4555626">,</span>&nbsp;<span class="ident" id="4555628">blank</span><span class="op" id="4555633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555638">needsBlank</span>&nbsp;<span class="op" id="4555649">=</span>&nbsp;<span class="builtintype" id="4555651">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555660">if</span>&nbsp;<span class="ident" id="4555663">post</span>&nbsp;<span class="op" id="4555668">!=</span>&nbsp;<span class="ident" id="4555671">nil</span>&nbsp;<span class="op" id="4555675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555681">p</span><span class="op" id="4555682">.</span><span class="ident" id="4555683">stmt</span><span class="op" id="4555687">(</span><span class="ident" id="4555688">post</span><span class="op" id="4555692">,</span>&nbsp;<span class="builtintype" id="4555694">false</span><span class="op" id="4555699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555705">needsBlank</span>&nbsp;<span class="op" id="4555716">=</span>&nbsp;<span class="builtintype" id="4555718">true</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555736">if</span>&nbsp;<span class="ident" id="4555739">needsBlank</span>&nbsp;<span class="op" id="4555750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555754">p</span><span class="op" id="4555755">.</span><span class="builtinfunc" id="4555756">print</span><span class="op" id="4555761">(</span><span class="ident" id="4555762">blank</span><span class="op" id="4555767">)</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555770">}</span><br>
<span class="lineno"></span><span class="op" id="4555772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4555775">//&nbsp;indentList&nbsp;reports&nbsp;whether&nbsp;an&nbsp;expression&nbsp;list&nbsp;would&nbsp;look&nbsp;better&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4555848">//&nbsp;were&nbsp;indented&nbsp;wholesale&nbsp;(starting&nbsp;with&nbsp;the&nbsp;very&nbsp;first&nbsp;element,&nbsp;rather</span><br>
<span class="lineno">1030</span><span class="comment" id="4555921">//&nbsp;than&nbsp;starting&nbsp;at&nbsp;the&nbsp;first&nbsp;line&nbsp;break).</span><br>
<span class="lineno"></span><span class="comment" id="4555964">//</span><br>
<span class="lineno"></span><span class="keyword" id="4555967">func</span>&nbsp;<span class="op" id="4555972">(</span><span class="ident" id="4555973">p</span>&nbsp;<span class="op" id="4555975">*</span><span class="ident" id="4555976">printer</span><span class="op" id="4555983">)</span>&nbsp;<span class="ident" id="4555985">indentList</span><span class="op" id="4555995">(</span><span class="ident" id="4555996">list</span>&nbsp;<span class="op" id="4556001">[</span><span class="op" id="4556002">]</span><span class="ident" id="4556003">ast</span><span class="op" id="4556006">.</span><span class="ident" id="4556007">Expr</span><span class="op" id="4556011">)</span>&nbsp;<span class="builtintype" id="4556013">bool</span>&nbsp;<span class="op" id="4556018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556021">//&nbsp;Heuristic:&nbsp;indentList&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;one&nbsp;multi-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556094">//&nbsp;line&nbsp;element&nbsp;in&nbsp;the&nbsp;list,&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;element&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556163">//&nbsp;starting&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ends.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556219">if</span>&nbsp;<span class="builtinfunc" id="4556222">len</span><span class="op" id="4556225">(</span><span class="ident" id="4556226">list</span><span class="op" id="4556230">)</span>&nbsp;<span class="op" id="4556232">&gt;=</span>&nbsp;<span class="num" id="4556235">2</span>&nbsp;<span class="op" id="4556237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556241">var</span>&nbsp;<span class="ident" id="4556245">b</span>&nbsp;<span class="op" id="4556247">=</span>&nbsp;<span class="ident" id="4556249">p</span><span class="op" id="4556250">.</span><span class="ident" id="4556251">lineFor</span><span class="op" id="4556258">(</span><span class="ident" id="4556259">list</span><span class="op" id="4556263">[</span><span class="num" id="4556264">0</span><span class="op" id="4556265">]</span><span class="op" id="4556266">.</span><span class="ident" id="4556267">Pos</span><span class="op" id="4556270">(</span><span class="op" id="4556271">)</span><span class="op" id="4556272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556276">var</span>&nbsp;<span class="ident" id="4556280">e</span>&nbsp;<span class="op" id="4556282">=</span>&nbsp;<span class="ident" id="4556284">p</span><span class="op" id="4556285">.</span><span class="ident" id="4556286">lineFor</span><span class="op" id="4556293">(</span><span class="ident" id="4556294">list</span><span class="op" id="4556298">[</span><span class="builtinfunc" id="4556299">len</span><span class="op" id="4556302">(</span><span class="ident" id="4556303">list</span><span class="op" id="4556307">)</span><span class="op" id="4556308">-</span><span class="num" id="4556309">1</span><span class="op" id="4556310">]</span><span class="op" id="4556311">.</span><span class="ident" id="4556312">End</span><span class="op" id="4556315">(</span><span class="op" id="4556316">)</span><span class="op" id="4556317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556321">if</span>&nbsp;<span class="num" id="4556324">0</span>&nbsp;<span class="op" id="4556326">&lt;</span>&nbsp;<span class="ident" id="4556328">b</span>&nbsp;<span class="op" id="4556330">&amp;&amp;</span>&nbsp;<span class="ident" id="4556333">b</span>&nbsp;<span class="op" id="4556335">&lt;</span>&nbsp;<span class="ident" id="4556337">e</span>&nbsp;<span class="op" id="4556339">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556344">//&nbsp;list&nbsp;spans&nbsp;multiple&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556376">n</span>&nbsp;<span class="op" id="4556378">:=</span>&nbsp;<span class="num" id="4556381">0</span>&nbsp;<span class="comment" id="4556383">//&nbsp;multi-line&nbsp;element&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556414">line</span>&nbsp;<span class="op" id="4556419">:=</span>&nbsp;<span class="ident" id="4556422">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556427">for</span>&nbsp;<span class="ident" id="4556431">_</span><span class="op" id="4556432">,</span>&nbsp;<span class="ident" id="4556434">x</span>&nbsp;<span class="op" id="4556436">:=</span>&nbsp;<span class="keyword" id="4556439">range</span>&nbsp;<span class="ident" id="4556445">list</span>&nbsp;<span class="op" id="4556450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556456">xb</span>&nbsp;<span class="op" id="4556459">:=</span>&nbsp;<span class="ident" id="4556462">p</span><span class="op" id="4556463">.</span><span class="ident" id="4556464">lineFor</span><span class="op" id="4556471">(</span><span class="ident" id="4556472">x</span><span class="op" id="4556473">.</span><span class="ident" id="4556474">Pos</span><span class="op" id="4556477">(</span><span class="op" id="4556478">)</span><span class="op" id="4556479">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556485">xe</span>&nbsp;<span class="op" id="4556488">:=</span>&nbsp;<span class="ident" id="4556491">p</span><span class="op" id="4556492">.</span><span class="ident" id="4556493">lineFor</span><span class="op" id="4556500">(</span><span class="ident" id="4556501">x</span><span class="op" id="4556502">.</span><span class="ident" id="4556503">End</span><span class="op" id="4556506">(</span><span class="op" id="4556507">)</span><span class="op" id="4556508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556514">if</span>&nbsp;<span class="ident" id="4556517">line</span>&nbsp;<span class="op" id="4556522">&lt;</span>&nbsp;<span class="ident" id="4556524">xb</span>&nbsp;<span class="op" id="4556527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556534">//&nbsp;x&nbsp;is&nbsp;not&nbsp;starting&nbsp;on&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556572">//&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ended</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556611">return</span>&nbsp;<span class="builtintype" id="4556618">true</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556633">if</span>&nbsp;<span class="ident" id="4556636">xb</span>&nbsp;<span class="op" id="4556639">&lt;</span>&nbsp;<span class="ident" id="4556641">xe</span>&nbsp;<span class="op" id="4556644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556651">//&nbsp;x&nbsp;is&nbsp;a&nbsp;multi-line&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556685">n</span><span class="op" id="4556686">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556693">}</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556699">line</span>&nbsp;<span class="op" id="4556704">=</span>&nbsp;<span class="ident" id="4556706">xe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556717">return</span>&nbsp;<span class="ident" id="4556724">n</span>&nbsp;<span class="op" id="4556726">&gt;</span>&nbsp;<span class="num" id="4556728">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556735">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556738">return</span>&nbsp;<span class="builtintype" id="4556745">false</span><br>
<span class="lineno"></span><span class="op" id="4556751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4556754">func</span>&nbsp;<span class="op" id="4556759">(</span><span class="ident" id="4556760">p</span>&nbsp;<span class="op" id="4556762">*</span><span class="ident" id="4556763">printer</span><span class="op" id="4556770">)</span>&nbsp;<span class="ident" id="4556772">stmt</span><span class="op" id="4556776">(</span><span class="ident" id="4556777">stmt</span>&nbsp;<span class="ident" id="4556782">ast</span><span class="op" id="4556785">.</span><span class="ident" id="4556786">Stmt</span><span class="op" id="4556790">,</span>&nbsp;<span class="ident" id="4556792">nextIsRBrace</span>&nbsp;<span class="builtintype" id="4556805">bool</span><span class="op" id="4556809">)</span>&nbsp;<span class="op" id="4556811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556814">p</span><span class="op" id="4556815">.</span><span class="builtinfunc" id="4556816">print</span><span class="op" id="4556821">(</span><span class="ident" id="4556822">stmt</span><span class="op" id="4556826">.</span><span class="ident" id="4556827">Pos</span><span class="op" id="4556830">(</span><span class="op" id="4556831">)</span><span class="op" id="4556832">)</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556836">switch</span>&nbsp;<span class="ident" id="4556843">s</span>&nbsp;<span class="op" id="4556845">:=</span>&nbsp;<span class="ident" id="4556848">stmt</span><span class="op" id="4556852">.</span><span class="op" id="4556853">(</span><span class="keyword" id="4556854">type</span><span class="op" id="4556858">)</span>&nbsp;<span class="op" id="4556860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556863">case</span>&nbsp;<span class="op" id="4556868">*</span><span class="ident" id="4556869">ast</span><span class="op" id="4556872">.</span><span class="ident" id="4556873">BadStmt</span><span class="op" id="4556880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556884">p</span><span class="op" id="4556885">.</span><span class="builtinfunc" id="4556886">print</span><span class="op" id="4556891">(</span><span class="string" id="4556892">&#34;BadStmt&#34;</span><span class="op" id="4556901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556905">case</span>&nbsp;<span class="op" id="4556910">*</span><span class="ident" id="4556911">ast</span><span class="op" id="4556914">.</span><span class="ident" id="4556915">DeclStmt</span><span class="op" id="4556923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556927">p</span><span class="op" id="4556928">.</span><span class="ident" id="4556929">decl</span><span class="op" id="4556933">(</span><span class="ident" id="4556934">s</span><span class="op" id="4556935">.</span><span class="ident" id="4556936">Decl</span><span class="op" id="4556940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556944">case</span>&nbsp;<span class="op" id="4556949">*</span><span class="ident" id="4556950">ast</span><span class="op" id="4556953">.</span><span class="ident" id="4556954">EmptyStmt</span><span class="op" id="4556963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4556967">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556986">case</span>&nbsp;<span class="op" id="4556991">*</span><span class="ident" id="4556992">ast</span><span class="op" id="4556995">.</span><span class="ident" id="4556996">LabeledStmt</span><span class="op" id="4557007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4557011">//&nbsp;a&nbsp;&#34;correcting&#34;&nbsp;unindent&nbsp;immediately&nbsp;following&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4557075">//&nbsp;is&nbsp;applied&nbsp;before&nbsp;the&nbsp;line&nbsp;break&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4557136">//&nbsp;between&nbsp;(see&nbsp;writeWhitespace)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557171">p</span><span class="op" id="4557172">.</span><span class="builtinfunc" id="4557173">print</span><span class="op" id="4557178">(</span><span class="ident" id="4557179">unindent</span><span class="op" id="4557187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557191">p</span><span class="op" id="4557192">.</span><span class="ident" id="4557193">expr</span><span class="op" id="4557197">(</span><span class="ident" id="4557198">s</span><span class="op" id="4557199">.</span><span class="ident" id="4557200">Label</span><span class="op" id="4557205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557209">p</span><span class="op" id="4557210">.</span><span class="builtinfunc" id="4557211">print</span><span class="op" id="4557216">(</span><span class="ident" id="4557217">s</span><span class="op" id="4557218">.</span><span class="ident" id="4557219">Colon</span><span class="op" id="4557224">,</span>&nbsp;<span class="ident" id="4557226">token</span><span class="op" id="4557231">.</span><span class="ident" id="4557232">COLON</span><span class="op" id="4557237">,</span>&nbsp;<span class="ident" id="4557239">indent</span><span class="op" id="4557245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557249">if</span>&nbsp;<span class="ident" id="4557252">e</span><span class="op" id="4557253">,</span>&nbsp;<span class="ident" id="4557255">isEmpty</span>&nbsp;<span class="op" id="4557263">:=</span>&nbsp;<span class="ident" id="4557266">s</span><span class="op" id="4557267">.</span><span class="ident" id="4557268">Stmt</span><span class="op" id="4557272">.</span><span class="op" id="4557273">(</span><span class="op" id="4557274">*</span><span class="ident" id="4557275">ast</span><span class="op" id="4557278">.</span><span class="ident" id="4557279">EmptyStmt</span><span class="op" id="4557288">)</span><span class="op" id="4557289">;</span>&nbsp;<span class="ident" id="4557291">isEmpty</span>&nbsp;<span class="op" id="4557299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557304">if</span>&nbsp;<span class="op" id="4557307">!</span><span class="ident" id="4557308">nextIsRBrace</span>&nbsp;<span class="op" id="4557321">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557327">p</span><span class="op" id="4557328">.</span><span class="builtinfunc" id="4557329">print</span><span class="op" id="4557334">(</span><span class="ident" id="4557335">newline</span><span class="op" id="4557342">,</span>&nbsp;<span class="ident" id="4557344">e</span><span class="op" id="4557345">.</span><span class="ident" id="4557346">Pos</span><span class="op" id="4557349">(</span><span class="op" id="4557350">)</span><span class="op" id="4557351">,</span>&nbsp;<span class="ident" id="4557353">token</span><span class="op" id="4557358">.</span><span class="ident" id="4557359">SEMICOLON</span><span class="op" id="4557368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557374">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557387">}</span>&nbsp;<span class="keyword" id="4557389">else</span>&nbsp;<span class="op" id="4557394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557399">p</span><span class="op" id="4557400">.</span><span class="ident" id="4557401">linebreak</span><span class="op" id="4557410">(</span><span class="ident" id="4557411">p</span><span class="op" id="4557412">.</span><span class="ident" id="4557413">lineFor</span><span class="op" id="4557420">(</span><span class="ident" id="4557421">s</span><span class="op" id="4557422">.</span><span class="ident" id="4557423">Stmt</span><span class="op" id="4557427">.</span><span class="ident" id="4557428">Pos</span><span class="op" id="4557431">(</span><span class="op" id="4557432">)</span><span class="op" id="4557433">)</span><span class="op" id="4557434">,</span>&nbsp;<span class="num" id="4557436">1</span><span class="op" id="4557437">,</span>&nbsp;<span class="ident" id="4557439">ignore</span><span class="op" id="4557445">,</span>&nbsp;<span class="builtintype" id="4557447">true</span><span class="op" id="4557451">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557459">p</span><span class="op" id="4557460">.</span><span class="ident" id="4557461">stmt</span><span class="op" id="4557465">(</span><span class="ident" id="4557466">s</span><span class="op" id="4557467">.</span><span class="ident" id="4557468">Stmt</span><span class="op" id="4557472">,</span>&nbsp;<span class="ident" id="4557474">nextIsRBrace</span><span class="op" id="4557486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557490">case</span>&nbsp;<span class="op" id="4557495">*</span><span class="ident" id="4557496">ast</span><span class="op" id="4557499">.</span><span class="ident" id="4557500">ExprStmt</span><span class="op" id="4557508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557512">const</span>&nbsp;<span class="ident" id="4557518">depth</span>&nbsp;<span class="op" id="4557524">=</span>&nbsp;<span class="num" id="4557526">1</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557530">p</span><span class="op" id="4557531">.</span><span class="ident" id="4557532">expr0</span><span class="op" id="4557537">(</span><span class="ident" id="4557538">s</span><span class="op" id="4557539">.</span><span class="ident" id="4557540">X</span><span class="op" id="4557541">,</span>&nbsp;<span class="ident" id="4557543">depth</span><span class="op" id="4557548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557552">case</span>&nbsp;<span class="op" id="4557557">*</span><span class="ident" id="4557558">ast</span><span class="op" id="4557561">.</span><span class="ident" id="4557562">SendStmt</span><span class="op" id="4557570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557574">const</span>&nbsp;<span class="ident" id="4557580">depth</span>&nbsp;<span class="op" id="4557586">=</span>&nbsp;<span class="num" id="4557588">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557592">p</span><span class="op" id="4557593">.</span><span class="ident" id="4557594">expr0</span><span class="op" id="4557599">(</span><span class="ident" id="4557600">s</span><span class="op" id="4557601">.</span><span class="ident" id="4557602">Chan</span><span class="op" id="4557606">,</span>&nbsp;<span class="ident" id="4557608">depth</span><span class="op" id="4557613">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557617">p</span><span class="op" id="4557618">.</span><span class="builtinfunc" id="4557619">print</span><span class="op" id="4557624">(</span><span class="ident" id="4557625">blank</span><span class="op" id="4557630">,</span>&nbsp;<span class="ident" id="4557632">s</span><span class="op" id="4557633">.</span><span class="ident" id="4557634">Arrow</span><span class="op" id="4557639">,</span>&nbsp;<span class="ident" id="4557641">token</span><span class="op" id="4557646">.</span><span class="ident" id="4557647">ARROW</span><span class="op" id="4557652">,</span>&nbsp;<span class="ident" id="4557654">blank</span><span class="op" id="4557659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557663">p</span><span class="op" id="4557664">.</span><span class="ident" id="4557665">expr0</span><span class="op" id="4557670">(</span><span class="ident" id="4557671">s</span><span class="op" id="4557672">.</span><span class="ident" id="4557673">Value</span><span class="op" id="4557678">,</span>&nbsp;<span class="ident" id="4557680">depth</span><span class="op" id="4557685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557689">case</span>&nbsp;<span class="op" id="4557694">*</span><span class="ident" id="4557695">ast</span><span class="op" id="4557698">.</span><span class="ident" id="4557699">IncDecStmt</span><span class="op" id="4557709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557713">const</span>&nbsp;<span class="ident" id="4557719">depth</span>&nbsp;<span class="op" id="4557725">=</span>&nbsp;<span class="num" id="4557727">1</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557731">p</span><span class="op" id="4557732">.</span><span class="ident" id="4557733">expr0</span><span class="op" id="4557738">(</span><span class="ident" id="4557739">s</span><span class="op" id="4557740">.</span><span class="ident" id="4557741">X</span><span class="op" id="4557742">,</span>&nbsp;<span class="ident" id="4557744">depth</span><span class="op" id="4557749">+</span><span class="num" id="4557750">1</span><span class="op" id="4557751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557755">p</span><span class="op" id="4557756">.</span><span class="builtinfunc" id="4557757">print</span><span class="op" id="4557762">(</span><span class="ident" id="4557763">s</span><span class="op" id="4557764">.</span><span class="ident" id="4557765">TokPos</span><span class="op" id="4557771">,</span>&nbsp;<span class="ident" id="4557773">s</span><span class="op" id="4557774">.</span><span class="ident" id="4557775">Tok</span><span class="op" id="4557778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557782">case</span>&nbsp;<span class="op" id="4557787">*</span><span class="ident" id="4557788">ast</span><span class="op" id="4557791">.</span><span class="ident" id="4557792">AssignStmt</span><span class="op" id="4557802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557806">var</span>&nbsp;<span class="ident" id="4557810">depth</span>&nbsp;<span class="op" id="4557816">=</span>&nbsp;<span class="num" id="4557818">1</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557822">if</span>&nbsp;<span class="builtinfunc" id="4557825">len</span><span class="op" id="4557828">(</span><span class="ident" id="4557829">s</span><span class="op" id="4557830">.</span><span class="ident" id="4557831">Lhs</span><span class="op" id="4557834">)</span>&nbsp;<span class="op" id="4557836">&gt;</span>&nbsp;<span class="num" id="4557838">1</span>&nbsp;<span class="op" id="4557840">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4557843">len</span><span class="op" id="4557846">(</span><span class="ident" id="4557847">s</span><span class="op" id="4557848">.</span><span class="ident" id="4557849">Rhs</span><span class="op" id="4557852">)</span>&nbsp;<span class="op" id="4557854">&gt;</span>&nbsp;<span class="num" id="4557856">1</span>&nbsp;<span class="op" id="4557858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557863">depth</span><span class="op" id="4557868">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557877">p</span><span class="op" id="4557878">.</span><span class="ident" id="4557879">exprList</span><span class="op" id="4557887">(</span><span class="ident" id="4557888">s</span><span class="op" id="4557889">.</span><span class="ident" id="4557890">Pos</span><span class="op" id="4557893">(</span><span class="op" id="4557894">)</span><span class="op" id="4557895">,</span>&nbsp;<span class="ident" id="4557897">s</span><span class="op" id="4557898">.</span><span class="ident" id="4557899">Lhs</span><span class="op" id="4557902">,</span>&nbsp;<span class="ident" id="4557904">depth</span><span class="op" id="4557909">,</span>&nbsp;<span class="num" id="4557911">0</span><span class="op" id="4557912">,</span>&nbsp;<span class="ident" id="4557914">s</span><span class="op" id="4557915">.</span><span class="ident" id="4557916">TokPos</span><span class="op" id="4557922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557926">p</span><span class="op" id="4557927">.</span><span class="builtinfunc" id="4557928">print</span><span class="op" id="4557933">(</span><span class="ident" id="4557934">blank</span><span class="op" id="4557939">,</span>&nbsp;<span class="ident" id="4557941">s</span><span class="op" id="4557942">.</span><span class="ident" id="4557943">TokPos</span><span class="op" id="4557949">,</span>&nbsp;<span class="ident" id="4557951">s</span><span class="op" id="4557952">.</span><span class="ident" id="4557953">Tok</span><span class="op" id="4557956">,</span>&nbsp;<span class="ident" id="4557958">blank</span><span class="op" id="4557963">)</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557967">p</span><span class="op" id="4557968">.</span><span class="ident" id="4557969">exprList</span><span class="op" id="4557977">(</span><span class="ident" id="4557978">s</span><span class="op" id="4557979">.</span><span class="ident" id="4557980">TokPos</span><span class="op" id="4557986">,</span>&nbsp;<span class="ident" id="4557988">s</span><span class="op" id="4557989">.</span><span class="ident" id="4557990">Rhs</span><span class="op" id="4557993">,</span>&nbsp;<span class="ident" id="4557995">depth</span><span class="op" id="4558000">,</span>&nbsp;<span class="num" id="4558002">0</span><span class="op" id="4558003">,</span>&nbsp;<span class="ident" id="4558005">token</span><span class="op" id="4558010">.</span><span class="ident" id="4558011">NoPos</span><span class="op" id="4558016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558020">case</span>&nbsp;<span class="op" id="4558025">*</span><span class="ident" id="4558026">ast</span><span class="op" id="4558029">.</span><span class="ident" id="4558030">GoStmt</span><span class="op" id="4558036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558040">p</span><span class="op" id="4558041">.</span><span class="builtinfunc" id="4558042">print</span><span class="op" id="4558047">(</span><span class="ident" id="4558048">token</span><span class="op" id="4558053">.</span><span class="ident" id="4558054">GO</span><span class="op" id="4558056">,</span>&nbsp;<span class="ident" id="4558058">blank</span><span class="op" id="4558063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558067">p</span><span class="op" id="4558068">.</span><span class="ident" id="4558069">expr</span><span class="op" id="4558073">(</span><span class="ident" id="4558074">s</span><span class="op" id="4558075">.</span><span class="ident" id="4558076">Call</span><span class="op" id="4558080">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558084">case</span>&nbsp;<span class="op" id="4558089">*</span><span class="ident" id="4558090">ast</span><span class="op" id="4558093">.</span><span class="ident" id="4558094">DeferStmt</span><span class="op" id="4558103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558107">p</span><span class="op" id="4558108">.</span><span class="builtinfunc" id="4558109">print</span><span class="op" id="4558114">(</span><span class="ident" id="4558115">token</span><span class="op" id="4558120">.</span><span class="ident" id="4558121">DEFER</span><span class="op" id="4558126">,</span>&nbsp;<span class="ident" id="4558128">blank</span><span class="op" id="4558133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558137">p</span><span class="op" id="4558138">.</span><span class="ident" id="4558139">expr</span><span class="op" id="4558143">(</span><span class="ident" id="4558144">s</span><span class="op" id="4558145">.</span><span class="ident" id="4558146">Call</span><span class="op" id="4558150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558154">case</span>&nbsp;<span class="op" id="4558159">*</span><span class="ident" id="4558160">ast</span><span class="op" id="4558163">.</span><span class="ident" id="4558164">ReturnStmt</span><span class="op" id="4558174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558178">p</span><span class="op" id="4558179">.</span><span class="builtinfunc" id="4558180">print</span><span class="op" id="4558185">(</span><span class="ident" id="4558186">token</span><span class="op" id="4558191">.</span><span class="ident" id="4558192">RETURN</span><span class="op" id="4558198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558202">if</span>&nbsp;<span class="ident" id="4558205">s</span><span class="op" id="4558206">.</span><span class="ident" id="4558207">Results</span>&nbsp;<span class="op" id="4558215">!=</span>&nbsp;<span class="ident" id="4558218">nil</span>&nbsp;<span class="op" id="4558222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558227">p</span><span class="op" id="4558228">.</span><span class="builtinfunc" id="4558229">print</span><span class="op" id="4558234">(</span><span class="ident" id="4558235">blank</span><span class="op" id="4558240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4558245">//&nbsp;Use&nbsp;indentList&nbsp;heuristic&nbsp;to&nbsp;make&nbsp;corner&nbsp;cases&nbsp;look</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4558302">//&nbsp;better&nbsp;(issue&nbsp;1207).&nbsp;A&nbsp;more&nbsp;systematic&nbsp;approach&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4558362">//&nbsp;always&nbsp;indent,&nbsp;but&nbsp;this&nbsp;would&nbsp;cause&nbsp;significant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4558416">//&nbsp;reformatting&nbsp;of&nbsp;the&nbsp;code&nbsp;base&nbsp;and&nbsp;not&nbsp;necessarily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4558472">//&nbsp;lead&nbsp;to&nbsp;more&nbsp;nicely&nbsp;formatted&nbsp;code&nbsp;in&nbsp;general.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558525">if</span>&nbsp;<span class="ident" id="4558528">p</span><span class="op" id="4558529">.</span><span class="ident" id="4558530">indentList</span><span class="op" id="4558540">(</span><span class="ident" id="4558541">s</span><span class="op" id="4558542">.</span><span class="ident" id="4558543">Results</span><span class="op" id="4558550">)</span>&nbsp;<span class="op" id="4558552">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558558">p</span><span class="op" id="4558559">.</span><span class="builtinfunc" id="4558560">print</span><span class="op" id="4558565">(</span><span class="ident" id="4558566">indent</span><span class="op" id="4558572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558578">p</span><span class="op" id="4558579">.</span><span class="ident" id="4558580">exprList</span><span class="op" id="4558588">(</span><span class="ident" id="4558589">s</span><span class="op" id="4558590">.</span><span class="ident" id="4558591">Pos</span><span class="op" id="4558594">(</span><span class="op" id="4558595">)</span><span class="op" id="4558596">,</span>&nbsp;<span class="ident" id="4558598">s</span><span class="op" id="4558599">.</span><span class="ident" id="4558600">Results</span><span class="op" id="4558607">,</span>&nbsp;<span class="num" id="4558609">1</span><span class="op" id="4558610">,</span>&nbsp;<span class="ident" id="4558612">noIndent</span><span class="op" id="4558620">,</span>&nbsp;<span class="ident" id="4558622">token</span><span class="op" id="4558627">.</span><span class="ident" id="4558628">NoPos</span><span class="op" id="4558633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558639">p</span><span class="op" id="4558640">.</span><span class="builtinfunc" id="4558641">print</span><span class="op" id="4558646">(</span><span class="ident" id="4558647">unindent</span><span class="op" id="4558655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558660">}</span>&nbsp;<span class="keyword" id="4558662">else</span>&nbsp;<span class="op" id="4558667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558673">p</span><span class="op" id="4558674">.</span><span class="ident" id="4558675">exprList</span><span class="op" id="4558683">(</span><span class="ident" id="4558684">s</span><span class="op" id="4558685">.</span><span class="ident" id="4558686">Pos</span><span class="op" id="4558689">(</span><span class="op" id="4558690">)</span><span class="op" id="4558691">,</span>&nbsp;<span class="ident" id="4558693">s</span><span class="op" id="4558694">.</span><span class="ident" id="4558695">Results</span><span class="op" id="4558702">,</span>&nbsp;<span class="num" id="4558704">1</span><span class="op" id="4558705">,</span>&nbsp;<span class="num" id="4558707">0</span><span class="op" id="4558708">,</span>&nbsp;<span class="ident" id="4558710">token</span><span class="op" id="4558715">.</span><span class="ident" id="4558716">NoPos</span><span class="op" id="4558721">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558734">case</span>&nbsp;<span class="op" id="4558739">*</span><span class="ident" id="4558740">ast</span><span class="op" id="4558743">.</span><span class="ident" id="4558744">BranchStmt</span><span class="op" id="4558754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558758">p</span><span class="op" id="4558759">.</span><span class="builtinfunc" id="4558760">print</span><span class="op" id="4558765">(</span><span class="ident" id="4558766">s</span><span class="op" id="4558767">.</span><span class="ident" id="4558768">Tok</span><span class="op" id="4558771">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558775">if</span>&nbsp;<span class="ident" id="4558778">s</span><span class="op" id="4558779">.</span><span class="ident" id="4558780">Label</span>&nbsp;<span class="op" id="4558786">!=</span>&nbsp;<span class="ident" id="4558789">nil</span>&nbsp;<span class="op" id="4558793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558798">p</span><span class="op" id="4558799">.</span><span class="builtinfunc" id="4558800">print</span><span class="op" id="4558805">(</span><span class="ident" id="4558806">blank</span><span class="op" id="4558811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558816">p</span><span class="op" id="4558817">.</span><span class="ident" id="4558818">expr</span><span class="op" id="4558822">(</span><span class="ident" id="4558823">s</span><span class="op" id="4558824">.</span><span class="ident" id="4558825">Label</span><span class="op" id="4558830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558838">case</span>&nbsp;<span class="op" id="4558843">*</span><span class="ident" id="4558844">ast</span><span class="op" id="4558847">.</span><span class="ident" id="4558848">BlockStmt</span><span class="op" id="4558857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558861">p</span><span class="op" id="4558862">.</span><span class="ident" id="4558863">block</span><span class="op" id="4558868">(</span><span class="ident" id="4558869">s</span><span class="op" id="4558870">,</span>&nbsp;<span class="num" id="4558872">1</span><span class="op" id="4558873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558877">case</span>&nbsp;<span class="op" id="4558882">*</span><span class="ident" id="4558883">ast</span><span class="op" id="4558886">.</span><span class="ident" id="4558887">IfStmt</span><span class="op" id="4558893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558897">p</span><span class="op" id="4558898">.</span><span class="builtinfunc" id="4558899">print</span><span class="op" id="4558904">(</span><span class="ident" id="4558905">token</span><span class="op" id="4558910">.</span><span class="ident" id="4558911">IF</span><span class="op" id="4558913">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558917">p</span><span class="op" id="4558918">.</span><span class="ident" id="4558919">controlClause</span><span class="op" id="4558932">(</span><span class="builtintype" id="4558933">false</span><span class="op" id="4558938">,</span>&nbsp;<span class="ident" id="4558940">s</span><span class="op" id="4558941">.</span><span class="ident" id="4558942">Init</span><span class="op" id="4558946">,</span>&nbsp;<span class="ident" id="4558948">s</span><span class="op" id="4558949">.</span><span class="ident" id="4558950">Cond</span><span class="op" id="4558954">,</span>&nbsp;<span class="ident" id="4558956">nil</span><span class="op" id="4558959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558963">p</span><span class="op" id="4558964">.</span><span class="ident" id="4558965">block</span><span class="op" id="4558970">(</span><span class="ident" id="4558971">s</span><span class="op" id="4558972">.</span><span class="ident" id="4558973">Body</span><span class="op" id="4558977">,</span>&nbsp;<span class="num" id="4558979">1</span><span class="op" id="4558980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558984">if</span>&nbsp;<span class="ident" id="4558987">s</span><span class="op" id="4558988">.</span><span class="ident" id="4558989">Else</span>&nbsp;<span class="op" id="4558994">!=</span>&nbsp;<span class="ident" id="4558997">nil</span>&nbsp;<span class="op" id="4559001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559006">p</span><span class="op" id="4559007">.</span><span class="builtinfunc" id="4559008">print</span><span class="op" id="4559013">(</span><span class="ident" id="4559014">blank</span><span class="op" id="4559019">,</span>&nbsp;<span class="ident" id="4559021">token</span><span class="op" id="4559026">.</span><span class="ident" id="4559027">ELSE</span><span class="op" id="4559031">,</span>&nbsp;<span class="ident" id="4559033">blank</span><span class="op" id="4559038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559043">switch</span>&nbsp;<span class="ident" id="4559050">s</span><span class="op" id="4559051">.</span><span class="ident" id="4559052">Else</span><span class="op" id="4559056">.</span><span class="op" id="4559057">(</span><span class="keyword" id="4559058">type</span><span class="op" id="4559062">)</span>&nbsp;<span class="op" id="4559064">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559069">case</span>&nbsp;<span class="op" id="4559074">*</span><span class="ident" id="4559075">ast</span><span class="op" id="4559078">.</span><span class="ident" id="4559079">BlockStmt</span><span class="op" id="4559088">,</span>&nbsp;<span class="op" id="4559090">*</span><span class="ident" id="4559091">ast</span><span class="op" id="4559094">.</span><span class="ident" id="4559095">IfStmt</span><span class="op" id="4559101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559107">p</span><span class="op" id="4559108">.</span><span class="ident" id="4559109">stmt</span><span class="op" id="4559113">(</span><span class="ident" id="4559114">s</span><span class="op" id="4559115">.</span><span class="ident" id="4559116">Else</span><span class="op" id="4559120">,</span>&nbsp;<span class="ident" id="4559122">nextIsRBrace</span><span class="op" id="4559134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559139">default</span><span class="op" id="4559146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559152">p</span><span class="op" id="4559153">.</span><span class="builtinfunc" id="4559154">print</span><span class="op" id="4559159">(</span><span class="ident" id="4559160">token</span><span class="op" id="4559165">.</span><span class="ident" id="4559166">LBRACE</span><span class="op" id="4559172">,</span>&nbsp;<span class="ident" id="4559174">indent</span><span class="op" id="4559180">,</span>&nbsp;<span class="ident" id="4559182">formfeed</span><span class="op" id="4559190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559196">p</span><span class="op" id="4559197">.</span><span class="ident" id="4559198">stmt</span><span class="op" id="4559202">(</span><span class="ident" id="4559203">s</span><span class="op" id="4559204">.</span><span class="ident" id="4559205">Else</span><span class="op" id="4559209">,</span>&nbsp;<span class="builtintype" id="4559211">true</span><span class="op" id="4559215">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559221">p</span><span class="op" id="4559222">.</span><span class="builtinfunc" id="4559223">print</span><span class="op" id="4559228">(</span><span class="ident" id="4559229">unindent</span><span class="op" id="4559237">,</span>&nbsp;<span class="ident" id="4559239">formfeed</span><span class="op" id="4559247">,</span>&nbsp;<span class="ident" id="4559249">token</span><span class="op" id="4559254">.</span><span class="ident" id="4559255">RBRACE</span><span class="op" id="4559261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559274">case</span>&nbsp;<span class="op" id="4559279">*</span><span class="ident" id="4559280">ast</span><span class="op" id="4559283">.</span><span class="ident" id="4559284">CaseClause</span><span class="op" id="4559294">:</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559298">if</span>&nbsp;<span class="ident" id="4559301">s</span><span class="op" id="4559302">.</span><span class="ident" id="4559303">List</span>&nbsp;<span class="op" id="4559308">!=</span>&nbsp;<span class="ident" id="4559311">nil</span>&nbsp;<span class="op" id="4559315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559320">p</span><span class="op" id="4559321">.</span><span class="builtinfunc" id="4559322">print</span><span class="op" id="4559327">(</span><span class="ident" id="4559328">token</span><span class="op" id="4559333">.</span><span class="ident" id="4559334">CASE</span><span class="op" id="4559338">,</span>&nbsp;<span class="ident" id="4559340">blank</span><span class="op" id="4559345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559350">p</span><span class="op" id="4559351">.</span><span class="ident" id="4559352">exprList</span><span class="op" id="4559360">(</span><span class="ident" id="4559361">s</span><span class="op" id="4559362">.</span><span class="ident" id="4559363">Pos</span><span class="op" id="4559366">(</span><span class="op" id="4559367">)</span><span class="op" id="4559368">,</span>&nbsp;<span class="ident" id="4559370">s</span><span class="op" id="4559371">.</span><span class="ident" id="4559372">List</span><span class="op" id="4559376">,</span>&nbsp;<span class="num" id="4559378">1</span><span class="op" id="4559379">,</span>&nbsp;<span class="num" id="4559381">0</span><span class="op" id="4559382">,</span>&nbsp;<span class="ident" id="4559384">s</span><span class="op" id="4559385">.</span><span class="ident" id="4559386">Colon</span><span class="op" id="4559391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559395">}</span>&nbsp;<span class="keyword" id="4559397">else</span>&nbsp;<span class="op" id="4559402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559407">p</span><span class="op" id="4559408">.</span><span class="builtinfunc" id="4559409">print</span><span class="op" id="4559414">(</span><span class="ident" id="4559415">token</span><span class="op" id="4559420">.</span><span class="ident" id="4559421">DEFAULT</span><span class="op" id="4559428">)</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559436">p</span><span class="op" id="4559437">.</span><span class="builtinfunc" id="4559438">print</span><span class="op" id="4559443">(</span><span class="ident" id="4559444">s</span><span class="op" id="4559445">.</span><span class="ident" id="4559446">Colon</span><span class="op" id="4559451">,</span>&nbsp;<span class="ident" id="4559453">token</span><span class="op" id="4559458">.</span><span class="ident" id="4559459">COLON</span><span class="op" id="4559464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559468">p</span><span class="op" id="4559469">.</span><span class="ident" id="4559470">stmtList</span><span class="op" id="4559478">(</span><span class="ident" id="4559479">s</span><span class="op" id="4559480">.</span><span class="ident" id="4559481">Body</span><span class="op" id="4559485">,</span>&nbsp;<span class="num" id="4559487">1</span><span class="op" id="4559488">,</span>&nbsp;<span class="ident" id="4559490">nextIsRBrace</span><span class="op" id="4559502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559506">case</span>&nbsp;<span class="op" id="4559511">*</span><span class="ident" id="4559512">ast</span><span class="op" id="4559515">.</span><span class="ident" id="4559516">SwitchStmt</span><span class="op" id="4559526">:</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559530">p</span><span class="op" id="4559531">.</span><span class="builtinfunc" id="4559532">print</span><span class="op" id="4559537">(</span><span class="ident" id="4559538">token</span><span class="op" id="4559543">.</span><span class="ident" id="4559544">SWITCH</span><span class="op" id="4559550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559554">p</span><span class="op" id="4559555">.</span><span class="ident" id="4559556">controlClause</span><span class="op" id="4559569">(</span><span class="builtintype" id="4559570">false</span><span class="op" id="4559575">,</span>&nbsp;<span class="ident" id="4559577">s</span><span class="op" id="4559578">.</span><span class="ident" id="4559579">Init</span><span class="op" id="4559583">,</span>&nbsp;<span class="ident" id="4559585">s</span><span class="op" id="4559586">.</span><span class="ident" id="4559587">Tag</span><span class="op" id="4559590">,</span>&nbsp;<span class="ident" id="4559592">nil</span><span class="op" id="4559595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559599">p</span><span class="op" id="4559600">.</span><span class="ident" id="4559601">block</span><span class="op" id="4559606">(</span><span class="ident" id="4559607">s</span><span class="op" id="4559608">.</span><span class="ident" id="4559609">Body</span><span class="op" id="4559613">,</span>&nbsp;<span class="num" id="4559615">0</span><span class="op" id="4559616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559620">case</span>&nbsp;<span class="op" id="4559625">*</span><span class="ident" id="4559626">ast</span><span class="op" id="4559629">.</span><span class="ident" id="4559630">TypeSwitchStmt</span><span class="op" id="4559644">:</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559648">p</span><span class="op" id="4559649">.</span><span class="builtinfunc" id="4559650">print</span><span class="op" id="4559655">(</span><span class="ident" id="4559656">token</span><span class="op" id="4559661">.</span><span class="ident" id="4559662">SWITCH</span><span class="op" id="4559668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559672">if</span>&nbsp;<span class="ident" id="4559675">s</span><span class="op" id="4559676">.</span><span class="ident" id="4559677">Init</span>&nbsp;<span class="op" id="4559682">!=</span>&nbsp;<span class="ident" id="4559685">nil</span>&nbsp;<span class="op" id="4559689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559694">p</span><span class="op" id="4559695">.</span><span class="builtinfunc" id="4559696">print</span><span class="op" id="4559701">(</span><span class="ident" id="4559702">blank</span><span class="op" id="4559707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559712">p</span><span class="op" id="4559713">.</span><span class="ident" id="4559714">stmt</span><span class="op" id="4559718">(</span><span class="ident" id="4559719">s</span><span class="op" id="4559720">.</span><span class="ident" id="4559721">Init</span><span class="op" id="4559725">,</span>&nbsp;<span class="builtintype" id="4559727">false</span><span class="op" id="4559732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559737">p</span><span class="op" id="4559738">.</span><span class="builtinfunc" id="4559739">print</span><span class="op" id="4559744">(</span><span class="ident" id="4559745">token</span><span class="op" id="4559750">.</span><span class="ident" id="4559751">SEMICOLON</span><span class="op" id="4559760">)</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559768">p</span><span class="op" id="4559769">.</span><span class="builtinfunc" id="4559770">print</span><span class="op" id="4559775">(</span><span class="ident" id="4559776">blank</span><span class="op" id="4559781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559785">p</span><span class="op" id="4559786">.</span><span class="ident" id="4559787">stmt</span><span class="op" id="4559791">(</span><span class="ident" id="4559792">s</span><span class="op" id="4559793">.</span><span class="ident" id="4559794">Assign</span><span class="op" id="4559800">,</span>&nbsp;<span class="builtintype" id="4559802">false</span><span class="op" id="4559807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559811">p</span><span class="op" id="4559812">.</span><span class="builtinfunc" id="4559813">print</span><span class="op" id="4559818">(</span><span class="ident" id="4559819">blank</span><span class="op" id="4559824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559828">p</span><span class="op" id="4559829">.</span><span class="ident" id="4559830">block</span><span class="op" id="4559835">(</span><span class="ident" id="4559836">s</span><span class="op" id="4559837">.</span><span class="ident" id="4559838">Body</span><span class="op" id="4559842">,</span>&nbsp;<span class="num" id="4559844">0</span><span class="op" id="4559845">)</span><br>
<span class="lineno">1195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559849">case</span>&nbsp;<span class="op" id="4559854">*</span><span class="ident" id="4559855">ast</span><span class="op" id="4559858">.</span><span class="ident" id="4559859">CommClause</span><span class="op" id="4559869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559873">if</span>&nbsp;<span class="ident" id="4559876">s</span><span class="op" id="4559877">.</span><span class="ident" id="4559878">Comm</span>&nbsp;<span class="op" id="4559883">!=</span>&nbsp;<span class="ident" id="4559886">nil</span>&nbsp;<span class="op" id="4559890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559895">p</span><span class="op" id="4559896">.</span><span class="builtinfunc" id="4559897">print</span><span class="op" id="4559902">(</span><span class="ident" id="4559903">token</span><span class="op" id="4559908">.</span><span class="ident" id="4559909">CASE</span><span class="op" id="4559913">,</span>&nbsp;<span class="ident" id="4559915">blank</span><span class="op" id="4559920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559925">p</span><span class="op" id="4559926">.</span><span class="ident" id="4559927">stmt</span><span class="op" id="4559931">(</span><span class="ident" id="4559932">s</span><span class="op" id="4559933">.</span><span class="ident" id="4559934">Comm</span><span class="op" id="4559938">,</span>&nbsp;<span class="builtintype" id="4559940">false</span><span class="op" id="4559945">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559949">}</span>&nbsp;<span class="keyword" id="4559951">else</span>&nbsp;<span class="op" id="4559956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559961">p</span><span class="op" id="4559962">.</span><span class="builtinfunc" id="4559963">print</span><span class="op" id="4559968">(</span><span class="ident" id="4559969">token</span><span class="op" id="4559974">.</span><span class="ident" id="4559975">DEFAULT</span><span class="op" id="4559982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559990">p</span><span class="op" id="4559991">.</span><span class="builtinfunc" id="4559992">print</span><span class="op" id="4559997">(</span><span class="ident" id="4559998">s</span><span class="op" id="4559999">.</span><span class="ident" id="4560000">Colon</span><span class="op" id="4560005">,</span>&nbsp;<span class="ident" id="4560007">token</span><span class="op" id="4560012">.</span><span class="ident" id="4560013">COLON</span><span class="op" id="4560018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560022">p</span><span class="op" id="4560023">.</span><span class="ident" id="4560024">stmtList</span><span class="op" id="4560032">(</span><span class="ident" id="4560033">s</span><span class="op" id="4560034">.</span><span class="ident" id="4560035">Body</span><span class="op" id="4560039">,</span>&nbsp;<span class="num" id="4560041">1</span><span class="op" id="4560042">,</span>&nbsp;<span class="ident" id="4560044">nextIsRBrace</span><span class="op" id="4560056">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560060">case</span>&nbsp;<span class="op" id="4560065">*</span><span class="ident" id="4560066">ast</span><span class="op" id="4560069">.</span><span class="ident" id="4560070">SelectStmt</span><span class="op" id="4560080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560084">p</span><span class="op" id="4560085">.</span><span class="builtinfunc" id="4560086">print</span><span class="op" id="4560091">(</span><span class="ident" id="4560092">token</span><span class="op" id="4560097">.</span><span class="ident" id="4560098">SELECT</span><span class="op" id="4560104">,</span>&nbsp;<span class="ident" id="4560106">blank</span><span class="op" id="4560111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560115">body</span>&nbsp;<span class="op" id="4560120">:=</span>&nbsp;<span class="ident" id="4560123">s</span><span class="op" id="4560124">.</span><span class="ident" id="4560125">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560132">if</span>&nbsp;<span class="builtinfunc" id="4560135">len</span><span class="op" id="4560138">(</span><span class="ident" id="4560139">body</span><span class="op" id="4560143">.</span><span class="ident" id="4560144">List</span><span class="op" id="4560148">)</span>&nbsp;<span class="op" id="4560150">==</span>&nbsp;<span class="num" id="4560153">0</span>&nbsp;<span class="op" id="4560155">&amp;&amp;</span>&nbsp;<span class="op" id="4560158">!</span><span class="ident" id="4560159">p</span><span class="op" id="4560160">.</span><span class="ident" id="4560161">commentBefore</span><span class="op" id="4560174">(</span><span class="ident" id="4560175">p</span><span class="op" id="4560176">.</span><span class="ident" id="4560177">posFor</span><span class="op" id="4560183">(</span><span class="ident" id="4560184">body</span><span class="op" id="4560188">.</span><span class="ident" id="4560189">Rbrace</span><span class="op" id="4560195">)</span><span class="op" id="4560196">)</span>&nbsp;<span class="op" id="4560198">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4560203">//&nbsp;print&nbsp;empty&nbsp;select&nbsp;statement&nbsp;w/o&nbsp;comments&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560263">p</span><span class="op" id="4560264">.</span><span class="builtinfunc" id="4560265">print</span><span class="op" id="4560270">(</span><span class="ident" id="4560271">body</span><span class="op" id="4560275">.</span><span class="ident" id="4560276">Lbrace</span><span class="op" id="4560282">,</span>&nbsp;<span class="ident" id="4560284">token</span><span class="op" id="4560289">.</span><span class="ident" id="4560290">LBRACE</span><span class="op" id="4560296">,</span>&nbsp;<span class="ident" id="4560298">body</span><span class="op" id="4560302">.</span><span class="ident" id="4560303">Rbrace</span><span class="op" id="4560309">,</span>&nbsp;<span class="ident" id="4560311">token</span><span class="op" id="4560316">.</span><span class="ident" id="4560317">RBRACE</span><span class="op" id="4560323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560327">}</span>&nbsp;<span class="keyword" id="4560329">else</span>&nbsp;<span class="op" id="4560334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560339">p</span><span class="op" id="4560340">.</span><span class="ident" id="4560341">block</span><span class="op" id="4560346">(</span><span class="ident" id="4560347">body</span><span class="op" id="4560351">,</span>&nbsp;<span class="num" id="4560353">0</span><span class="op" id="4560354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560358">}</span><br>
<span class="lineno">1215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560362">case</span>&nbsp;<span class="op" id="4560367">*</span><span class="ident" id="4560368">ast</span><span class="op" id="4560371">.</span><span class="ident" id="4560372">ForStmt</span><span class="op" id="4560379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560383">p</span><span class="op" id="4560384">.</span><span class="builtinfunc" id="4560385">print</span><span class="op" id="4560390">(</span><span class="ident" id="4560391">token</span><span class="op" id="4560396">.</span><span class="ident" id="4560397">FOR</span><span class="op" id="4560400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560404">p</span><span class="op" id="4560405">.</span><span class="ident" id="4560406">controlClause</span><span class="op" id="4560419">(</span><span class="builtintype" id="4560420">true</span><span class="op" id="4560424">,</span>&nbsp;<span class="ident" id="4560426">s</span><span class="op" id="4560427">.</span><span class="ident" id="4560428">Init</span><span class="op" id="4560432">,</span>&nbsp;<span class="ident" id="4560434">s</span><span class="op" id="4560435">.</span><span class="ident" id="4560436">Cond</span><span class="op" id="4560440">,</span>&nbsp;<span class="ident" id="4560442">s</span><span class="op" id="4560443">.</span><span class="ident" id="4560444">Post</span><span class="op" id="4560448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560452">p</span><span class="op" id="4560453">.</span><span class="ident" id="4560454">block</span><span class="op" id="4560459">(</span><span class="ident" id="4560460">s</span><span class="op" id="4560461">.</span><span class="ident" id="4560462">Body</span><span class="op" id="4560466">,</span>&nbsp;<span class="num" id="4560468">1</span><span class="op" id="4560469">)</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560473">case</span>&nbsp;<span class="op" id="4560478">*</span><span class="ident" id="4560479">ast</span><span class="op" id="4560482">.</span><span class="ident" id="4560483">RangeStmt</span><span class="op" id="4560492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560496">p</span><span class="op" id="4560497">.</span><span class="builtinfunc" id="4560498">print</span><span class="op" id="4560503">(</span><span class="ident" id="4560504">token</span><span class="op" id="4560509">.</span><span class="ident" id="4560510">FOR</span><span class="op" id="4560513">,</span>&nbsp;<span class="ident" id="4560515">blank</span><span class="op" id="4560520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560524">if</span>&nbsp;<span class="ident" id="4560527">s</span><span class="op" id="4560528">.</span><span class="ident" id="4560529">Key</span>&nbsp;<span class="op" id="4560533">!=</span>&nbsp;<span class="ident" id="4560536">nil</span>&nbsp;<span class="op" id="4560540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560545">p</span><span class="op" id="4560546">.</span><span class="ident" id="4560547">expr</span><span class="op" id="4560551">(</span><span class="ident" id="4560552">s</span><span class="op" id="4560553">.</span><span class="ident" id="4560554">Key</span><span class="op" id="4560557">)</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560562">if</span>&nbsp;<span class="ident" id="4560565">s</span><span class="op" id="4560566">.</span><span class="ident" id="4560567">Value</span>&nbsp;<span class="op" id="4560573">!=</span>&nbsp;<span class="ident" id="4560576">nil</span>&nbsp;<span class="op" id="4560580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4560586">//&nbsp;use&nbsp;position&nbsp;of&nbsp;value&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4560638">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560690">p</span><span class="op" id="4560691">.</span><span class="builtinfunc" id="4560692">print</span><span class="op" id="4560697">(</span><span class="ident" id="4560698">s</span><span class="op" id="4560699">.</span><span class="ident" id="4560700">Value</span><span class="op" id="4560705">.</span><span class="ident" id="4560706">Pos</span><span class="op" id="4560709">(</span><span class="op" id="4560710">)</span><span class="op" id="4560711">,</span>&nbsp;<span class="ident" id="4560713">token</span><span class="op" id="4560718">.</span><span class="ident" id="4560719">COMMA</span><span class="op" id="4560724">,</span>&nbsp;<span class="ident" id="4560726">blank</span><span class="op" id="4560731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560737">p</span><span class="op" id="4560738">.</span><span class="ident" id="4560739">expr</span><span class="op" id="4560743">(</span><span class="ident" id="4560744">s</span><span class="op" id="4560745">.</span><span class="ident" id="4560746">Value</span><span class="op" id="4560751">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560761">p</span><span class="op" id="4560762">.</span><span class="builtinfunc" id="4560763">print</span><span class="op" id="4560768">(</span><span class="ident" id="4560769">blank</span><span class="op" id="4560774">,</span>&nbsp;<span class="ident" id="4560776">s</span><span class="op" id="4560777">.</span><span class="ident" id="4560778">TokPos</span><span class="op" id="4560784">,</span>&nbsp;<span class="ident" id="4560786">s</span><span class="op" id="4560787">.</span><span class="ident" id="4560788">Tok</span><span class="op" id="4560791">,</span>&nbsp;<span class="ident" id="4560793">blank</span><span class="op" id="4560798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560806">p</span><span class="op" id="4560807">.</span><span class="builtinfunc" id="4560808">print</span><span class="op" id="4560813">(</span><span class="ident" id="4560814">token</span><span class="op" id="4560819">.</span><span class="ident" id="4560820">RANGE</span><span class="op" id="4560825">,</span>&nbsp;<span class="ident" id="4560827">blank</span><span class="op" id="4560832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560836">p</span><span class="op" id="4560837">.</span><span class="ident" id="4560838">expr</span><span class="op" id="4560842">(</span><span class="ident" id="4560843">stripParens</span><span class="op" id="4560854">(</span><span class="ident" id="4560855">s</span><span class="op" id="4560856">.</span><span class="ident" id="4560857">X</span><span class="op" id="4560858">)</span><span class="op" id="4560859">)</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560863">p</span><span class="op" id="4560864">.</span><span class="builtinfunc" id="4560865">print</span><span class="op" id="4560870">(</span><span class="ident" id="4560871">blank</span><span class="op" id="4560876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560880">p</span><span class="op" id="4560881">.</span><span class="ident" id="4560882">block</span><span class="op" id="4560887">(</span><span class="ident" id="4560888">s</span><span class="op" id="4560889">.</span><span class="ident" id="4560890">Body</span><span class="op" id="4560894">,</span>&nbsp;<span class="num" id="4560896">1</span><span class="op" id="4560897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560901">default</span><span class="op" id="4560908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4560912">panic</span><span class="op" id="4560917">(</span><span class="string" id="4560918">&#34;unreachable&#34;</span><span class="op" id="4560931">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560938">return</span><br>
<span class="lineno"></span><span class="op" id="4560945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1245</span><span class="comment" id="4560948">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4561028">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4561045">//&nbsp;The&nbsp;keepTypeColumn&nbsp;function&nbsp;determines&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;of&nbsp;a&nbsp;series&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4561121">//&nbsp;consecutive&nbsp;const&nbsp;or&nbsp;var&nbsp;declarations&nbsp;must&nbsp;be&nbsp;kept,&nbsp;or&nbsp;if&nbsp;initialization</span><br>
<span class="lineno">1250</span><span class="comment" id="4561197">//&nbsp;values&nbsp;(V)&nbsp;can&nbsp;be&nbsp;placed&nbsp;in&nbsp;the&nbsp;type&nbsp;column&nbsp;(T)&nbsp;instead.&nbsp;The&nbsp;i&#39;th&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="4561272">//&nbsp;in&nbsp;the&nbsp;result&nbsp;slice&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;in&nbsp;spec[i]&nbsp;must&nbsp;be&nbsp;kept.</span><br>
<span class="lineno"></span><span class="comment" id="4561347">//</span><br>
<span class="lineno"></span><span class="comment" id="4561350">//&nbsp;For&nbsp;example,&nbsp;the&nbsp;declaration:</span><br>
<span class="lineno"></span><span class="comment" id="4561383">//</span><br>
<span class="lineno">1255</span><span class="comment" id="4561386">//&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;(</span><br>
<span class="lineno"></span><span class="comment" id="4561397">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foobar&nbsp;int&nbsp;=&nbsp;42&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="4561428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7&nbsp;&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="4561459">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="4561467">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bar&nbsp;=&nbsp;991</span><br>
<span class="lineno">1260</span><span class="comment" id="4561493">//&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="4561498">//</span><br>
<span class="lineno"></span><span class="comment" id="4561501">//&nbsp;leads&nbsp;to&nbsp;the&nbsp;type/values&nbsp;matrix&nbsp;below.&nbsp;A&nbsp;run&nbsp;of&nbsp;value&nbsp;columns&nbsp;(V)&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4561574">//&nbsp;be&nbsp;moved&nbsp;into&nbsp;the&nbsp;type&nbsp;column&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;type&nbsp;for&nbsp;any&nbsp;of&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4561649">//&nbsp;in&nbsp;that&nbsp;column&nbsp;(we&nbsp;only&nbsp;move&nbsp;entire&nbsp;columns&nbsp;so&nbsp;that&nbsp;they&nbsp;align&nbsp;properly).</span><br>
<span class="lineno">1265</span><span class="comment" id="4561726">//</span><br>
<span class="lineno"></span><span class="comment" id="4561729">//&nbsp;&nbsp;&nbsp;&nbsp;matrix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatted&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="4561767">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix</span><br>
<span class="lineno"></span><span class="comment" id="4561796">//&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;is&nbsp;a&nbsp;T&nbsp;and&nbsp;so&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4561866">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno">1270</span><span class="comment" id="4561927">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="4561964">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;is&nbsp;moved&nbsp;into&nbsp;T&nbsp;column</span><br>
<span class="lineno"></span><span class="comment" id="4562030">//</span><br>
<span class="lineno"></span><span class="keyword" id="4562033">func</span>&nbsp;<span class="ident" id="4562038">keepTypeColumn</span><span class="op" id="4562052">(</span><span class="ident" id="4562053">specs</span>&nbsp;<span class="op" id="4562059">[</span><span class="op" id="4562060">]</span><span class="ident" id="4562061">ast</span><span class="op" id="4562064">.</span><span class="ident" id="4562065">Spec</span><span class="op" id="4562069">)</span>&nbsp;<span class="op" id="4562071">[</span><span class="op" id="4562072">]</span><span class="builtintype" id="4562073">bool</span>&nbsp;<span class="op" id="4562078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562081">m</span>&nbsp;<span class="op" id="4562083">:=</span>&nbsp;<span class="builtinfunc" id="4562086">make</span><span class="op" id="4562090">(</span><span class="op" id="4562091">[</span><span class="op" id="4562092">]</span><span class="builtintype" id="4562093">bool</span><span class="op" id="4562097">,</span>&nbsp;<span class="builtinfunc" id="4562099">len</span><span class="op" id="4562102">(</span><span class="ident" id="4562103">specs</span><span class="op" id="4562108">)</span><span class="op" id="4562109">)</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562113">populate</span>&nbsp;<span class="op" id="4562122">:=</span>&nbsp;<span class="keyword" id="4562125">func</span><span class="op" id="4562129">(</span><span class="ident" id="4562130">i</span><span class="op" id="4562131">,</span>&nbsp;<span class="ident" id="4562133">j</span>&nbsp;<span class="builtintype" id="4562135">int</span><span class="op" id="4562138">,</span>&nbsp;<span class="ident" id="4562140">keepType</span>&nbsp;<span class="builtintype" id="4562149">bool</span><span class="op" id="4562153">)</span>&nbsp;<span class="op" id="4562155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562159">if</span>&nbsp;<span class="ident" id="4562162">keepType</span>&nbsp;<span class="op" id="4562171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562176">for</span>&nbsp;<span class="op" id="4562180">;</span>&nbsp;<span class="ident" id="4562182">i</span>&nbsp;<span class="op" id="4562184">&lt;</span>&nbsp;<span class="ident" id="4562186">j</span><span class="op" id="4562187">;</span>&nbsp;<span class="ident" id="4562189">i</span><span class="op" id="4562190">++</span>&nbsp;<span class="op" id="4562193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562199">m</span><span class="op" id="4562200">[</span><span class="ident" id="4562201">i</span><span class="op" id="4562202">]</span>&nbsp;<span class="op" id="4562204">=</span>&nbsp;<span class="builtintype" id="4562206">true</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562225">i0</span>&nbsp;<span class="op" id="4562228">:=</span>&nbsp;<span class="op" id="4562231">-</span><span class="num" id="4562232">1</span>&nbsp;<span class="comment" id="4562234">//&nbsp;if&nbsp;i0&nbsp;&gt;=&nbsp;0&nbsp;we&nbsp;are&nbsp;in&nbsp;a&nbsp;run&nbsp;and&nbsp;i0&nbsp;is&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;run</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562296">var</span>&nbsp;<span class="ident" id="4562300">keepType</span>&nbsp;<span class="builtintype" id="4562309">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562315">for</span>&nbsp;<span class="ident" id="4562319">i</span><span class="op" id="4562320">,</span>&nbsp;<span class="ident" id="4562322">s</span>&nbsp;<span class="op" id="4562324">:=</span>&nbsp;<span class="keyword" id="4562327">range</span>&nbsp;<span class="ident" id="4562333">specs</span>&nbsp;<span class="op" id="4562339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562343">t</span>&nbsp;<span class="op" id="4562345">:=</span>&nbsp;<span class="ident" id="4562348">s</span><span class="op" id="4562349">.</span><span class="op" id="4562350">(</span><span class="op" id="4562351">*</span><span class="ident" id="4562352">ast</span><span class="op" id="4562355">.</span><span class="ident" id="4562356">ValueSpec</span><span class="op" id="4562365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562369">if</span>&nbsp;<span class="ident" id="4562372">t</span><span class="op" id="4562373">.</span><span class="ident" id="4562374">Values</span>&nbsp;<span class="op" id="4562381">!=</span>&nbsp;<span class="ident" id="4562384">nil</span>&nbsp;<span class="op" id="4562388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562393">if</span>&nbsp;<span class="ident" id="4562396">i0</span>&nbsp;<span class="op" id="4562399">&lt;</span>&nbsp;<span class="num" id="4562401">0</span>&nbsp;<span class="op" id="4562403">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4562409">//&nbsp;start&nbsp;of&nbsp;a&nbsp;run&nbsp;of&nbsp;ValueSpecs&nbsp;with&nbsp;non-nil&nbsp;Values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562465">i0</span>&nbsp;<span class="op" id="4562468">=</span>&nbsp;<span class="ident" id="4562470">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562476">keepType</span>&nbsp;<span class="op" id="4562485">=</span>&nbsp;<span class="builtintype" id="4562487">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562500">}</span>&nbsp;<span class="keyword" id="4562502">else</span>&nbsp;<span class="op" id="4562507">{</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562512">if</span>&nbsp;<span class="ident" id="4562515">i0</span>&nbsp;<span class="op" id="4562518">&gt;=</span>&nbsp;<span class="num" id="4562521">0</span>&nbsp;<span class="op" id="4562523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4562529">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562549">populate</span><span class="op" id="4562557">(</span><span class="ident" id="4562558">i0</span><span class="op" id="4562560">,</span>&nbsp;<span class="ident" id="4562562">i</span><span class="op" id="4562563">,</span>&nbsp;<span class="ident" id="4562565">keepType</span><span class="op" id="4562573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562579">i0</span>&nbsp;<span class="op" id="4562582">=</span>&nbsp;<span class="op" id="4562584">-</span><span class="num" id="4562585">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562590">}</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562598">if</span>&nbsp;<span class="ident" id="4562601">t</span><span class="op" id="4562602">.</span><span class="ident" id="4562603">Type</span>&nbsp;<span class="op" id="4562608">!=</span>&nbsp;<span class="ident" id="4562611">nil</span>&nbsp;<span class="op" id="4562615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562620">keepType</span>&nbsp;<span class="op" id="4562629">=</span>&nbsp;<span class="builtintype" id="4562631">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562641">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562644">if</span>&nbsp;<span class="ident" id="4562647">i0</span>&nbsp;<span class="op" id="4562650">&gt;=</span>&nbsp;<span class="num" id="4562653">0</span>&nbsp;<span class="op" id="4562655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4562659">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562677">populate</span><span class="op" id="4562685">(</span><span class="ident" id="4562686">i0</span><span class="op" id="4562688">,</span>&nbsp;<span class="builtinfunc" id="4562690">len</span><span class="op" id="4562693">(</span><span class="ident" id="4562694">specs</span><span class="op" id="4562699">)</span><span class="op" id="4562700">,</span>&nbsp;<span class="ident" id="4562702">keepType</span><span class="op" id="4562710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562717">return</span>&nbsp;<span class="ident" id="4562724">m</span><br>
<span class="lineno"></span><span class="op" id="4562726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4562729">func</span>&nbsp;<span class="op" id="4562734">(</span><span class="ident" id="4562735">p</span>&nbsp;<span class="op" id="4562737">*</span><span class="ident" id="4562738">printer</span><span class="op" id="4562745">)</span>&nbsp;<span class="ident" id="4562747">valueSpec</span><span class="op" id="4562756">(</span><span class="ident" id="4562757">s</span>&nbsp;<span class="op" id="4562759">*</span><span class="ident" id="4562760">ast</span><span class="op" id="4562763">.</span><span class="ident" id="4562764">ValueSpec</span><span class="op" id="4562773">,</span>&nbsp;<span class="ident" id="4562775">keepType</span>&nbsp;<span class="builtintype" id="4562784">bool</span><span class="op" id="4562788">)</span>&nbsp;<span class="op" id="4562790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562793">p</span><span class="op" id="4562794">.</span><span class="ident" id="4562795">setComment</span><span class="op" id="4562805">(</span><span class="ident" id="4562806">s</span><span class="op" id="4562807">.</span><span class="ident" id="4562808">Doc</span><span class="op" id="4562811">)</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562814">p</span><span class="op" id="4562815">.</span><span class="ident" id="4562816">identList</span><span class="op" id="4562825">(</span><span class="ident" id="4562826">s</span><span class="op" id="4562827">.</span><span class="ident" id="4562828">Names</span><span class="op" id="4562833">,</span>&nbsp;<span class="builtintype" id="4562835">false</span><span class="op" id="4562840">)</span>&nbsp;<span class="comment" id="4562842">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562861">extraTabs</span>&nbsp;<span class="op" id="4562871">:=</span>&nbsp;<span class="num" id="4562874">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562877">if</span>&nbsp;<span class="ident" id="4562880">s</span><span class="op" id="4562881">.</span><span class="ident" id="4562882">Type</span>&nbsp;<span class="op" id="4562887">!=</span>&nbsp;<span class="ident" id="4562890">nil</span>&nbsp;<span class="op" id="4562894">||</span>&nbsp;<span class="ident" id="4562897">keepType</span>&nbsp;<span class="op" id="4562906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562910">p</span><span class="op" id="4562911">.</span><span class="builtinfunc" id="4562912">print</span><span class="op" id="4562917">(</span><span class="ident" id="4562918">vtab</span><span class="op" id="4562922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562926">extraTabs</span><span class="op" id="4562935">--</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562942">if</span>&nbsp;<span class="ident" id="4562945">s</span><span class="op" id="4562946">.</span><span class="ident" id="4562947">Type</span>&nbsp;<span class="op" id="4562952">!=</span>&nbsp;<span class="ident" id="4562955">nil</span>&nbsp;<span class="op" id="4562959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4562963">p</span><span class="op" id="4562964">.</span><span class="ident" id="4562965">expr</span><span class="op" id="4562969">(</span><span class="ident" id="4562970">s</span><span class="op" id="4562971">.</span><span class="ident" id="4562972">Type</span><span class="op" id="4562976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562982">if</span>&nbsp;<span class="ident" id="4562985">s</span><span class="op" id="4562986">.</span><span class="ident" id="4562987">Values</span>&nbsp;<span class="op" id="4562994">!=</span>&nbsp;<span class="ident" id="4562997">nil</span>&nbsp;<span class="op" id="4563001">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563005">p</span><span class="op" id="4563006">.</span><span class="builtinfunc" id="4563007">print</span><span class="op" id="4563012">(</span><span class="ident" id="4563013">vtab</span><span class="op" id="4563017">,</span>&nbsp;<span class="ident" id="4563019">token</span><span class="op" id="4563024">.</span><span class="ident" id="4563025">ASSIGN</span><span class="op" id="4563031">,</span>&nbsp;<span class="ident" id="4563033">blank</span><span class="op" id="4563038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563042">p</span><span class="op" id="4563043">.</span><span class="ident" id="4563044">exprList</span><span class="op" id="4563052">(</span><span class="ident" id="4563053">token</span><span class="op" id="4563058">.</span><span class="ident" id="4563059">NoPos</span><span class="op" id="4563064">,</span>&nbsp;<span class="ident" id="4563066">s</span><span class="op" id="4563067">.</span><span class="ident" id="4563068">Values</span><span class="op" id="4563074">,</span>&nbsp;<span class="num" id="4563076">1</span><span class="op" id="4563077">,</span>&nbsp;<span class="num" id="4563079">0</span><span class="op" id="4563080">,</span>&nbsp;<span class="ident" id="4563082">token</span><span class="op" id="4563087">.</span><span class="ident" id="4563088">NoPos</span><span class="op" id="4563093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563097">extraTabs</span><span class="op" id="4563106">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563113">if</span>&nbsp;<span class="ident" id="4563116">s</span><span class="op" id="4563117">.</span><span class="ident" id="4563118">Comment</span>&nbsp;<span class="op" id="4563126">!=</span>&nbsp;<span class="ident" id="4563129">nil</span>&nbsp;<span class="op" id="4563133">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563137">for</span>&nbsp;<span class="op" id="4563141">;</span>&nbsp;<span class="ident" id="4563143">extraTabs</span>&nbsp;<span class="op" id="4563153">&gt;</span>&nbsp;<span class="num" id="4563155">0</span><span class="op" id="4563156">;</span>&nbsp;<span class="ident" id="4563158">extraTabs</span><span class="op" id="4563167">--</span>&nbsp;<span class="op" id="4563170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563175">p</span><span class="op" id="4563176">.</span><span class="builtinfunc" id="4563177">print</span><span class="op" id="4563182">(</span><span class="ident" id="4563183">vtab</span><span class="op" id="4563187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563195">p</span><span class="op" id="4563196">.</span><span class="ident" id="4563197">setComment</span><span class="op" id="4563207">(</span><span class="ident" id="4563208">s</span><span class="op" id="4563209">.</span><span class="ident" id="4563210">Comment</span><span class="op" id="4563217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563220">}</span><br>
<span class="lineno">1335</span><span class="op" id="4563222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4563225">//&nbsp;The&nbsp;parameter&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;specs&nbsp;in&nbsp;the&nbsp;group.&nbsp;If&nbsp;doIndent&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="4563301">//&nbsp;multi-line&nbsp;identifier&nbsp;lists&nbsp;in&nbsp;the&nbsp;spec&nbsp;are&nbsp;indented&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4563372">//&nbsp;linebreak&nbsp;is&nbsp;encountered.</span><br>
<span class="lineno">1340</span><span class="comment" id="4563401">//</span><br>
<span class="lineno"></span><span class="keyword" id="4563404">func</span>&nbsp;<span class="op" id="4563409">(</span><span class="ident" id="4563410">p</span>&nbsp;<span class="op" id="4563412">*</span><span class="ident" id="4563413">printer</span><span class="op" id="4563420">)</span>&nbsp;<span class="ident" id="4563422">spec</span><span class="op" id="4563426">(</span><span class="ident" id="4563427">spec</span>&nbsp;<span class="ident" id="4563432">ast</span><span class="op" id="4563435">.</span><span class="ident" id="4563436">Spec</span><span class="op" id="4563440">,</span>&nbsp;<span class="ident" id="4563442">n</span>&nbsp;<span class="builtintype" id="4563444">int</span><span class="op" id="4563447">,</span>&nbsp;<span class="ident" id="4563449">doIndent</span>&nbsp;<span class="builtintype" id="4563458">bool</span><span class="op" id="4563462">)</span>&nbsp;<span class="op" id="4563464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563467">switch</span>&nbsp;<span class="ident" id="4563474">s</span>&nbsp;<span class="op" id="4563476">:=</span>&nbsp;<span class="ident" id="4563479">spec</span><span class="op" id="4563483">.</span><span class="op" id="4563484">(</span><span class="keyword" id="4563485">type</span><span class="op" id="4563489">)</span>&nbsp;<span class="op" id="4563491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563494">case</span>&nbsp;<span class="op" id="4563499">*</span><span class="ident" id="4563500">ast</span><span class="op" id="4563503">.</span><span class="ident" id="4563504">ImportSpec</span><span class="op" id="4563514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563518">p</span><span class="op" id="4563519">.</span><span class="ident" id="4563520">setComment</span><span class="op" id="4563530">(</span><span class="ident" id="4563531">s</span><span class="op" id="4563532">.</span><span class="ident" id="4563533">Doc</span><span class="op" id="4563536">)</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563540">if</span>&nbsp;<span class="ident" id="4563543">s</span><span class="op" id="4563544">.</span><span class="ident" id="4563545">Name</span>&nbsp;<span class="op" id="4563550">!=</span>&nbsp;<span class="ident" id="4563553">nil</span>&nbsp;<span class="op" id="4563557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563562">p</span><span class="op" id="4563563">.</span><span class="ident" id="4563564">expr</span><span class="op" id="4563568">(</span><span class="ident" id="4563569">s</span><span class="op" id="4563570">.</span><span class="ident" id="4563571">Name</span><span class="op" id="4563575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563580">p</span><span class="op" id="4563581">.</span><span class="builtinfunc" id="4563582">print</span><span class="op" id="4563587">(</span><span class="ident" id="4563588">blank</span><span class="op" id="4563593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563601">p</span><span class="op" id="4563602">.</span><span class="ident" id="4563603">expr</span><span class="op" id="4563607">(</span><span class="ident" id="4563608">s</span><span class="op" id="4563609">.</span><span class="ident" id="4563610">Path</span><span class="op" id="4563614">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563618">p</span><span class="op" id="4563619">.</span><span class="ident" id="4563620">setComment</span><span class="op" id="4563630">(</span><span class="ident" id="4563631">s</span><span class="op" id="4563632">.</span><span class="ident" id="4563633">Comment</span><span class="op" id="4563640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563644">p</span><span class="op" id="4563645">.</span><span class="builtinfunc" id="4563646">print</span><span class="op" id="4563651">(</span><span class="ident" id="4563652">s</span><span class="op" id="4563653">.</span><span class="ident" id="4563654">EndPos</span><span class="op" id="4563660">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563664">case</span>&nbsp;<span class="op" id="4563669">*</span><span class="ident" id="4563670">ast</span><span class="op" id="4563673">.</span><span class="ident" id="4563674">ValueSpec</span><span class="op" id="4563683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563687">if</span>&nbsp;<span class="ident" id="4563690">n</span>&nbsp;<span class="op" id="4563692">!=</span>&nbsp;<span class="num" id="4563695">1</span>&nbsp;<span class="op" id="4563697">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563702">p</span><span class="op" id="4563703">.</span><span class="ident" id="4563704">internalError</span><span class="op" id="4563717">(</span><span class="string" id="4563718">&#34;expected&nbsp;n&nbsp;=&nbsp;1;&nbsp;got&#34;</span><span class="op" id="4563739">,</span>&nbsp;<span class="ident" id="4563741">n</span><span class="op" id="4563742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563750">p</span><span class="op" id="4563751">.</span><span class="ident" id="4563752">setComment</span><span class="op" id="4563762">(</span><span class="ident" id="4563763">s</span><span class="op" id="4563764">.</span><span class="ident" id="4563765">Doc</span><span class="op" id="4563768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563772">p</span><span class="op" id="4563773">.</span><span class="ident" id="4563774">identList</span><span class="op" id="4563783">(</span><span class="ident" id="4563784">s</span><span class="op" id="4563785">.</span><span class="ident" id="4563786">Names</span><span class="op" id="4563791">,</span>&nbsp;<span class="ident" id="4563793">doIndent</span><span class="op" id="4563801">)</span>&nbsp;<span class="comment" id="4563803">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563823">if</span>&nbsp;<span class="ident" id="4563826">s</span><span class="op" id="4563827">.</span><span class="ident" id="4563828">Type</span>&nbsp;<span class="op" id="4563833">!=</span>&nbsp;<span class="ident" id="4563836">nil</span>&nbsp;<span class="op" id="4563840">{</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563845">p</span><span class="op" id="4563846">.</span><span class="builtinfunc" id="4563847">print</span><span class="op" id="4563852">(</span><span class="ident" id="4563853">blank</span><span class="op" id="4563858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563863">p</span><span class="op" id="4563864">.</span><span class="ident" id="4563865">expr</span><span class="op" id="4563869">(</span><span class="ident" id="4563870">s</span><span class="op" id="4563871">.</span><span class="ident" id="4563872">Type</span><span class="op" id="4563876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563884">if</span>&nbsp;<span class="ident" id="4563887">s</span><span class="op" id="4563888">.</span><span class="ident" id="4563889">Values</span>&nbsp;<span class="op" id="4563896">!=</span>&nbsp;<span class="ident" id="4563899">nil</span>&nbsp;<span class="op" id="4563903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563908">p</span><span class="op" id="4563909">.</span><span class="builtinfunc" id="4563910">print</span><span class="op" id="4563915">(</span><span class="ident" id="4563916">blank</span><span class="op" id="4563921">,</span>&nbsp;<span class="ident" id="4563923">token</span><span class="op" id="4563928">.</span><span class="ident" id="4563929">ASSIGN</span><span class="op" id="4563935">,</span>&nbsp;<span class="ident" id="4563937">blank</span><span class="op" id="4563942">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563947">p</span><span class="op" id="4563948">.</span><span class="ident" id="4563949">exprList</span><span class="op" id="4563957">(</span><span class="ident" id="4563958">token</span><span class="op" id="4563963">.</span><span class="ident" id="4563964">NoPos</span><span class="op" id="4563969">,</span>&nbsp;<span class="ident" id="4563971">s</span><span class="op" id="4563972">.</span><span class="ident" id="4563973">Values</span><span class="op" id="4563979">,</span>&nbsp;<span class="num" id="4563981">1</span><span class="op" id="4563982">,</span>&nbsp;<span class="num" id="4563984">0</span><span class="op" id="4563985">,</span>&nbsp;<span class="ident" id="4563987">token</span><span class="op" id="4563992">.</span><span class="ident" id="4563993">NoPos</span><span class="op" id="4563998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564006">p</span><span class="op" id="4564007">.</span><span class="ident" id="4564008">setComment</span><span class="op" id="4564018">(</span><span class="ident" id="4564019">s</span><span class="op" id="4564020">.</span><span class="ident" id="4564021">Comment</span><span class="op" id="4564028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564032">case</span>&nbsp;<span class="op" id="4564037">*</span><span class="ident" id="4564038">ast</span><span class="op" id="4564041">.</span><span class="ident" id="4564042">TypeSpec</span><span class="op" id="4564050">:</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564054">p</span><span class="op" id="4564055">.</span><span class="ident" id="4564056">setComment</span><span class="op" id="4564066">(</span><span class="ident" id="4564067">s</span><span class="op" id="4564068">.</span><span class="ident" id="4564069">Doc</span><span class="op" id="4564072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564076">p</span><span class="op" id="4564077">.</span><span class="ident" id="4564078">expr</span><span class="op" id="4564082">(</span><span class="ident" id="4564083">s</span><span class="op" id="4564084">.</span><span class="ident" id="4564085">Name</span><span class="op" id="4564089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564093">if</span>&nbsp;<span class="ident" id="4564096">n</span>&nbsp;<span class="op" id="4564098">==</span>&nbsp;<span class="num" id="4564101">1</span>&nbsp;<span class="op" id="4564103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564108">p</span><span class="op" id="4564109">.</span><span class="builtinfunc" id="4564110">print</span><span class="op" id="4564115">(</span><span class="ident" id="4564116">blank</span><span class="op" id="4564121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564125">}</span>&nbsp;<span class="keyword" id="4564127">else</span>&nbsp;<span class="op" id="4564132">{</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564137">p</span><span class="op" id="4564138">.</span><span class="builtinfunc" id="4564139">print</span><span class="op" id="4564144">(</span><span class="ident" id="4564145">vtab</span><span class="op" id="4564149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564157">p</span><span class="op" id="4564158">.</span><span class="ident" id="4564159">expr</span><span class="op" id="4564163">(</span><span class="ident" id="4564164">s</span><span class="op" id="4564165">.</span><span class="ident" id="4564166">Type</span><span class="op" id="4564170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564174">p</span><span class="op" id="4564175">.</span><span class="ident" id="4564176">setComment</span><span class="op" id="4564186">(</span><span class="ident" id="4564187">s</span><span class="op" id="4564188">.</span><span class="ident" id="4564189">Comment</span><span class="op" id="4564196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564200">default</span><span class="op" id="4564207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4564211">panic</span><span class="op" id="4564216">(</span><span class="string" id="4564217">&#34;unreachable&#34;</span><span class="op" id="4564230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564233">}</span><br>
<span class="lineno"></span><span class="op" id="4564235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1385</span><span class="keyword" id="4564238">func</span>&nbsp;<span class="op" id="4564243">(</span><span class="ident" id="4564244">p</span>&nbsp;<span class="op" id="4564246">*</span><span class="ident" id="4564247">printer</span><span class="op" id="4564254">)</span>&nbsp;<span class="ident" id="4564256">genDecl</span><span class="op" id="4564263">(</span><span class="ident" id="4564264">d</span>&nbsp;<span class="op" id="4564266">*</span><span class="ident" id="4564267">ast</span><span class="op" id="4564270">.</span><span class="ident" id="4564271">GenDecl</span><span class="op" id="4564278">)</span>&nbsp;<span class="op" id="4564280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564283">p</span><span class="op" id="4564284">.</span><span class="ident" id="4564285">setComment</span><span class="op" id="4564295">(</span><span class="ident" id="4564296">d</span><span class="op" id="4564297">.</span><span class="ident" id="4564298">Doc</span><span class="op" id="4564301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564304">p</span><span class="op" id="4564305">.</span><span class="builtinfunc" id="4564306">print</span><span class="op" id="4564311">(</span><span class="ident" id="4564312">d</span><span class="op" id="4564313">.</span><span class="ident" id="4564314">Pos</span><span class="op" id="4564317">(</span><span class="op" id="4564318">)</span><span class="op" id="4564319">,</span>&nbsp;<span class="ident" id="4564321">d</span><span class="op" id="4564322">.</span><span class="ident" id="4564323">Tok</span><span class="op" id="4564326">,</span>&nbsp;<span class="ident" id="4564328">blank</span><span class="op" id="4564333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564337">if</span>&nbsp;<span class="ident" id="4564340">d</span><span class="op" id="4564341">.</span><span class="ident" id="4564342">Lparen</span><span class="op" id="4564348">.</span><span class="ident" id="4564349">IsValid</span><span class="op" id="4564356">(</span><span class="op" id="4564357">)</span>&nbsp;<span class="op" id="4564359">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4564363">//&nbsp;group&nbsp;of&nbsp;parenthesized&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564404">p</span><span class="op" id="4564405">.</span><span class="builtinfunc" id="4564406">print</span><span class="op" id="4564411">(</span><span class="ident" id="4564412">d</span><span class="op" id="4564413">.</span><span class="ident" id="4564414">Lparen</span><span class="op" id="4564420">,</span>&nbsp;<span class="ident" id="4564422">token</span><span class="op" id="4564427">.</span><span class="ident" id="4564428">LPAREN</span><span class="op" id="4564434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564438">if</span>&nbsp;<span class="ident" id="4564441">n</span>&nbsp;<span class="op" id="4564443">:=</span>&nbsp;<span class="builtinfunc" id="4564446">len</span><span class="op" id="4564449">(</span><span class="ident" id="4564450">d</span><span class="op" id="4564451">.</span><span class="ident" id="4564452">Specs</span><span class="op" id="4564457">)</span><span class="op" id="4564458">;</span>&nbsp;<span class="ident" id="4564460">n</span>&nbsp;<span class="op" id="4564462">&gt;</span>&nbsp;<span class="num" id="4564464">0</span>&nbsp;<span class="op" id="4564466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564471">p</span><span class="op" id="4564472">.</span><span class="builtinfunc" id="4564473">print</span><span class="op" id="4564478">(</span><span class="ident" id="4564479">indent</span><span class="op" id="4564485">,</span>&nbsp;<span class="ident" id="4564487">formfeed</span><span class="op" id="4564495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564500">if</span>&nbsp;<span class="ident" id="4564503">n</span>&nbsp;<span class="op" id="4564505">&gt;</span>&nbsp;<span class="num" id="4564507">1</span>&nbsp;<span class="op" id="4564509">&amp;&amp;</span>&nbsp;<span class="op" id="4564512">(</span><span class="ident" id="4564513">d</span><span class="op" id="4564514">.</span><span class="ident" id="4564515">Tok</span>&nbsp;<span class="op" id="4564519">==</span>&nbsp;<span class="ident" id="4564522">token</span><span class="op" id="4564527">.</span><span class="ident" id="4564528">CONST</span>&nbsp;<span class="op" id="4564534">||</span>&nbsp;<span class="ident" id="4564537">d</span><span class="op" id="4564538">.</span><span class="ident" id="4564539">Tok</span>&nbsp;<span class="op" id="4564543">==</span>&nbsp;<span class="ident" id="4564546">token</span><span class="op" id="4564551">.</span><span class="ident" id="4564552">VAR</span><span class="op" id="4564555">)</span>&nbsp;<span class="op" id="4564557">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4564563">//&nbsp;two&nbsp;or&nbsp;more&nbsp;grouped&nbsp;const/var&nbsp;declarations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4564614">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564663">keepType</span>&nbsp;<span class="op" id="4564672">:=</span>&nbsp;<span class="ident" id="4564675">keepTypeColumn</span><span class="op" id="4564689">(</span><span class="ident" id="4564690">d</span><span class="op" id="4564691">.</span><span class="ident" id="4564692">Specs</span><span class="op" id="4564697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564703">var</span>&nbsp;<span class="ident" id="4564707">line</span>&nbsp;<span class="builtintype" id="4564712">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564720">for</span>&nbsp;<span class="ident" id="4564724">i</span><span class="op" id="4564725">,</span>&nbsp;<span class="ident" id="4564727">s</span>&nbsp;<span class="op" id="4564729">:=</span>&nbsp;<span class="keyword" id="4564732">range</span>&nbsp;<span class="ident" id="4564738">d</span><span class="op" id="4564739">.</span><span class="ident" id="4564740">Specs</span>&nbsp;<span class="op" id="4564746">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564753">if</span>&nbsp;<span class="ident" id="4564756">i</span>&nbsp;<span class="op" id="4564758">&gt;</span>&nbsp;<span class="num" id="4564760">0</span>&nbsp;<span class="op" id="4564762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564770">p</span><span class="op" id="4564771">.</span><span class="ident" id="4564772">linebreak</span><span class="op" id="4564781">(</span><span class="ident" id="4564782">p</span><span class="op" id="4564783">.</span><span class="ident" id="4564784">lineFor</span><span class="op" id="4564791">(</span><span class="ident" id="4564792">s</span><span class="op" id="4564793">.</span><span class="ident" id="4564794">Pos</span><span class="op" id="4564797">(</span><span class="op" id="4564798">)</span><span class="op" id="4564799">)</span><span class="op" id="4564800">,</span>&nbsp;<span class="num" id="4564802">1</span><span class="op" id="4564803">,</span>&nbsp;<span class="ident" id="4564805">ignore</span><span class="op" id="4564811">,</span>&nbsp;<span class="ident" id="4564813">p</span><span class="op" id="4564814">.</span><span class="ident" id="4564815">linesFrom</span><span class="op" id="4564824">(</span><span class="ident" id="4564825">line</span><span class="op" id="4564829">)</span>&nbsp;<span class="op" id="4564831">&gt;</span>&nbsp;<span class="num" id="4564833">0</span><span class="op" id="4564834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564848">p</span><span class="op" id="4564849">.</span><span class="ident" id="4564850">recordLine</span><span class="op" id="4564860">(</span><span class="op" id="4564861">&amp;</span><span class="ident" id="4564862">line</span><span class="op" id="4564866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564873">p</span><span class="op" id="4564874">.</span><span class="ident" id="4564875">valueSpec</span><span class="op" id="4564884">(</span><span class="ident" id="4564885">s</span><span class="op" id="4564886">.</span><span class="op" id="4564887">(</span><span class="op" id="4564888">*</span><span class="ident" id="4564889">ast</span><span class="op" id="4564892">.</span><span class="ident" id="4564893">ValueSpec</span><span class="op" id="4564902">)</span><span class="op" id="4564903">,</span>&nbsp;<span class="ident" id="4564905">keepType</span><span class="op" id="4564913">[</span><span class="ident" id="4564914">i</span><span class="op" id="4564915">]</span><span class="op" id="4564916">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564927">}</span>&nbsp;<span class="keyword" id="4564929">else</span>&nbsp;<span class="op" id="4564934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564940">var</span>&nbsp;<span class="ident" id="4564944">line</span>&nbsp;<span class="builtintype" id="4564949">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564957">for</span>&nbsp;<span class="ident" id="4564961">i</span><span class="op" id="4564962">,</span>&nbsp;<span class="ident" id="4564964">s</span>&nbsp;<span class="op" id="4564966">:=</span>&nbsp;<span class="keyword" id="4564969">range</span>&nbsp;<span class="ident" id="4564975">d</span><span class="op" id="4564976">.</span><span class="ident" id="4564977">Specs</span>&nbsp;<span class="op" id="4564983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564990">if</span>&nbsp;<span class="ident" id="4564993">i</span>&nbsp;<span class="op" id="4564995">&gt;</span>&nbsp;<span class="num" id="4564997">0</span>&nbsp;<span class="op" id="4564999">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565007">p</span><span class="op" id="4565008">.</span><span class="ident" id="4565009">linebreak</span><span class="op" id="4565018">(</span><span class="ident" id="4565019">p</span><span class="op" id="4565020">.</span><span class="ident" id="4565021">lineFor</span><span class="op" id="4565028">(</span><span class="ident" id="4565029">s</span><span class="op" id="4565030">.</span><span class="ident" id="4565031">Pos</span><span class="op" id="4565034">(</span><span class="op" id="4565035">)</span><span class="op" id="4565036">)</span><span class="op" id="4565037">,</span>&nbsp;<span class="num" id="4565039">1</span><span class="op" id="4565040">,</span>&nbsp;<span class="ident" id="4565042">ignore</span><span class="op" id="4565048">,</span>&nbsp;<span class="ident" id="4565050">p</span><span class="op" id="4565051">.</span><span class="ident" id="4565052">linesFrom</span><span class="op" id="4565061">(</span><span class="ident" id="4565062">line</span><span class="op" id="4565066">)</span>&nbsp;<span class="op" id="4565068">&gt;</span>&nbsp;<span class="num" id="4565070">0</span><span class="op" id="4565071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565085">p</span><span class="op" id="4565086">.</span><span class="ident" id="4565087">recordLine</span><span class="op" id="4565097">(</span><span class="op" id="4565098">&amp;</span><span class="ident" id="4565099">line</span><span class="op" id="4565103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565110">p</span><span class="op" id="4565111">.</span><span class="ident" id="4565112">spec</span><span class="op" id="4565116">(</span><span class="ident" id="4565117">s</span><span class="op" id="4565118">,</span>&nbsp;<span class="ident" id="4565120">n</span><span class="op" id="4565121">,</span>&nbsp;<span class="builtintype" id="4565123">false</span><span class="op" id="4565128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565134">}</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565144">p</span><span class="op" id="4565145">.</span><span class="builtinfunc" id="4565146">print</span><span class="op" id="4565151">(</span><span class="ident" id="4565152">unindent</span><span class="op" id="4565160">,</span>&nbsp;<span class="ident" id="4565162">formfeed</span><span class="op" id="4565170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565178">p</span><span class="op" id="4565179">.</span><span class="builtinfunc" id="4565180">print</span><span class="op" id="4565185">(</span><span class="ident" id="4565186">d</span><span class="op" id="4565187">.</span><span class="ident" id="4565188">Rparen</span><span class="op" id="4565194">,</span>&nbsp;<span class="ident" id="4565196">token</span><span class="op" id="4565201">.</span><span class="ident" id="4565202">RPAREN</span><span class="op" id="4565208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565212">}</span>&nbsp;<span class="keyword" id="4565214">else</span>&nbsp;<span class="op" id="4565219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4565223">//&nbsp;single&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565247">p</span><span class="op" id="4565248">.</span><span class="ident" id="4565249">spec</span><span class="op" id="4565253">(</span><span class="ident" id="4565254">d</span><span class="op" id="4565255">.</span><span class="ident" id="4565256">Specs</span><span class="op" id="4565261">[</span><span class="num" id="4565262">0</span><span class="op" id="4565263">]</span><span class="op" id="4565264">,</span>&nbsp;<span class="num" id="4565266">1</span><span class="op" id="4565267">,</span>&nbsp;<span class="builtintype" id="4565269">true</span><span class="op" id="4565273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565276">}</span><br>
<span class="lineno"></span><span class="op" id="4565278">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="4565281">//&nbsp;nodeSize&nbsp;determines&nbsp;the&nbsp;size&nbsp;of&nbsp;n&nbsp;in&nbsp;chars&nbsp;after&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="comment" id="4565345">//&nbsp;The&nbsp;result&nbsp;is&nbsp;&lt;=&nbsp;maxSize&nbsp;if&nbsp;the&nbsp;node&nbsp;fits&nbsp;on&nbsp;one&nbsp;line&nbsp;with&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4565410">//&nbsp;most&nbsp;maxSize&nbsp;chars&nbsp;and&nbsp;the&nbsp;formatted&nbsp;output&nbsp;doesn&#39;t&nbsp;contain</span><br>
<span class="lineno"></span><span class="comment" id="4565473">//&nbsp;any&nbsp;control&nbsp;chars.&nbsp;Otherwise,&nbsp;the&nbsp;result&nbsp;is&nbsp;&gt;&nbsp;maxSize.</span><br>
<span class="lineno">1430</span><span class="comment" id="4565531">//</span><br>
<span class="lineno"></span><span class="keyword" id="4565534">func</span>&nbsp;<span class="op" id="4565539">(</span><span class="ident" id="4565540">p</span>&nbsp;<span class="op" id="4565542">*</span><span class="ident" id="4565543">printer</span><span class="op" id="4565550">)</span>&nbsp;<span class="ident" id="4565552">nodeSize</span><span class="op" id="4565560">(</span><span class="ident" id="4565561">n</span>&nbsp;<span class="ident" id="4565563">ast</span><span class="op" id="4565566">.</span><span class="ident" id="4565567">Node</span><span class="op" id="4565571">,</span>&nbsp;<span class="ident" id="4565573">maxSize</span>&nbsp;<span class="builtintype" id="4565581">int</span><span class="op" id="4565584">)</span>&nbsp;<span class="op" id="4565586">(</span><span class="ident" id="4565587">size</span>&nbsp;<span class="builtintype" id="4565592">int</span><span class="op" id="4565595">)</span>&nbsp;<span class="op" id="4565597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4565600">//&nbsp;nodeSize&nbsp;invokes&nbsp;the&nbsp;printer,&nbsp;which&nbsp;may&nbsp;invoke&nbsp;nodeSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4565660">//&nbsp;recursively.&nbsp;For&nbsp;deep&nbsp;composite&nbsp;literal&nbsp;nests,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4565720">//&nbsp;lead&nbsp;to&nbsp;an&nbsp;exponential&nbsp;algorithm.&nbsp;Remember&nbsp;previous</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4565776">//&nbsp;results&nbsp;to&nbsp;prune&nbsp;the&nbsp;recursion&nbsp;(was&nbsp;issue&nbsp;1628).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565829">if</span>&nbsp;<span class="ident" id="4565832">size</span><span class="op" id="4565836">,</span>&nbsp;<span class="ident" id="4565838">found</span>&nbsp;<span class="op" id="4565844">:=</span>&nbsp;<span class="ident" id="4565847">p</span><span class="op" id="4565848">.</span><span class="ident" id="4565849">nodeSizes</span><span class="op" id="4565858">[</span><span class="ident" id="4565859">n</span><span class="op" id="4565860">]</span><span class="op" id="4565861">;</span>&nbsp;<span class="ident" id="4565863">found</span>&nbsp;<span class="op" id="4565869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565873">return</span>&nbsp;<span class="ident" id="4565880">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565890">size</span>&nbsp;<span class="op" id="4565895">=</span>&nbsp;<span class="ident" id="4565897">maxSize</span>&nbsp;<span class="op" id="4565905">+</span>&nbsp;<span class="num" id="4565907">1</span>&nbsp;<span class="comment" id="4565909">//&nbsp;assume&nbsp;n&nbsp;doesn&#39;t&nbsp;fit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565934">p</span><span class="op" id="4565935">.</span><span class="ident" id="4565936">nodeSizes</span><span class="op" id="4565945">[</span><span class="ident" id="4565946">n</span><span class="op" id="4565947">]</span>&nbsp;<span class="op" id="4565949">=</span>&nbsp;<span class="ident" id="4565951">size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4565958">//&nbsp;nodeSize&nbsp;computation&nbsp;must&nbsp;be&nbsp;independent&nbsp;of&nbsp;particular</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4566017">//&nbsp;style&nbsp;so&nbsp;that&nbsp;we&nbsp;always&nbsp;get&nbsp;the&nbsp;same&nbsp;decision;&nbsp;print</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4566074">//&nbsp;in&nbsp;RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566091">cfg</span>&nbsp;<span class="op" id="4566095">:=</span>&nbsp;<span class="ident" id="4566098">Config</span><span class="op" id="4566104">{</span><span class="ident" id="4566105">Mode</span><span class="op" id="4566109">:</span>&nbsp;<span class="ident" id="4566111">RawFormat</span><span class="op" id="4566120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566123">var</span>&nbsp;<span class="ident" id="4566127">buf</span>&nbsp;<span class="ident" id="4566131">bytes</span><span class="op" id="4566136">.</span><span class="ident" id="4566137">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566145">if</span>&nbsp;<span class="ident" id="4566148">err</span>&nbsp;<span class="op" id="4566152">:=</span>&nbsp;<span class="ident" id="4566155">cfg</span><span class="op" id="4566158">.</span><span class="ident" id="4566159">fprint</span><span class="op" id="4566165">(</span><span class="op" id="4566166">&amp;</span><span class="ident" id="4566167">buf</span><span class="op" id="4566170">,</span>&nbsp;<span class="ident" id="4566172">p</span><span class="op" id="4566173">.</span><span class="ident" id="4566174">fset</span><span class="op" id="4566178">,</span>&nbsp;<span class="ident" id="4566180">n</span><span class="op" id="4566181">,</span>&nbsp;<span class="ident" id="4566183">p</span><span class="op" id="4566184">.</span><span class="ident" id="4566185">nodeSizes</span><span class="op" id="4566194">)</span><span class="op" id="4566195">;</span>&nbsp;<span class="ident" id="4566197">err</span>&nbsp;<span class="op" id="4566201">!=</span>&nbsp;<span class="ident" id="4566204">nil</span>&nbsp;<span class="op" id="4566208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566212">return</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566223">if</span>&nbsp;<span class="ident" id="4566226">buf</span><span class="op" id="4566229">.</span><span class="ident" id="4566230">Len</span><span class="op" id="4566233">(</span><span class="op" id="4566234">)</span>&nbsp;<span class="op" id="4566236">&lt;=</span>&nbsp;<span class="ident" id="4566239">maxSize</span>&nbsp;<span class="op" id="4566247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566251">for</span>&nbsp;<span class="ident" id="4566255">_</span><span class="op" id="4566256">,</span>&nbsp;<span class="ident" id="4566258">ch</span>&nbsp;<span class="op" id="4566261">:=</span>&nbsp;<span class="keyword" id="4566264">range</span>&nbsp;<span class="ident" id="4566270">buf</span><span class="op" id="4566273">.</span><span class="ident" id="4566274">Bytes</span><span class="op" id="4566279">(</span><span class="op" id="4566280">)</span>&nbsp;<span class="op" id="4566282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566287">if</span>&nbsp;<span class="ident" id="4566290">ch</span>&nbsp;<span class="op" id="4566293">&lt;</span>&nbsp;<span class="string" id="4566295">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4566299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566305">return</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566323">size</span>&nbsp;<span class="op" id="4566328">=</span>&nbsp;<span class="ident" id="4566330">buf</span><span class="op" id="4566333">.</span><span class="ident" id="4566334">Len</span><span class="op" id="4566337">(</span><span class="op" id="4566338">)</span>&nbsp;<span class="comment" id="4566340">//&nbsp;n&nbsp;fits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566352">p</span><span class="op" id="4566353">.</span><span class="ident" id="4566354">nodeSizes</span><span class="op" id="4566363">[</span><span class="ident" id="4566364">n</span><span class="op" id="4566365">]</span>&nbsp;<span class="op" id="4566367">=</span>&nbsp;<span class="ident" id="4566369">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566375">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566378">return</span><br>
<span class="lineno"></span><span class="op" id="4566385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4566388">//&nbsp;bodySize&nbsp;is&nbsp;like&nbsp;nodeSize&nbsp;but&nbsp;it&nbsp;is&nbsp;specialized&nbsp;for&nbsp;*ast.BlockStmt&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4566461">func</span>&nbsp;<span class="op" id="4566466">(</span><span class="ident" id="4566467">p</span>&nbsp;<span class="op" id="4566469">*</span><span class="ident" id="4566470">printer</span><span class="op" id="4566477">)</span>&nbsp;<span class="ident" id="4566479">bodySize</span><span class="op" id="4566487">(</span><span class="ident" id="4566488">b</span>&nbsp;<span class="op" id="4566490">*</span><span class="ident" id="4566491">ast</span><span class="op" id="4566494">.</span><span class="ident" id="4566495">BlockStmt</span><span class="op" id="4566504">,</span>&nbsp;<span class="ident" id="4566506">maxSize</span>&nbsp;<span class="builtintype" id="4566514">int</span><span class="op" id="4566517">)</span>&nbsp;<span class="builtintype" id="4566519">int</span>&nbsp;<span class="op" id="4566523">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566526">pos1</span>&nbsp;<span class="op" id="4566531">:=</span>&nbsp;<span class="ident" id="4566534">b</span><span class="op" id="4566535">.</span><span class="ident" id="4566536">Pos</span><span class="op" id="4566539">(</span><span class="op" id="4566540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566543">pos2</span>&nbsp;<span class="op" id="4566548">:=</span>&nbsp;<span class="ident" id="4566551">b</span><span class="op" id="4566552">.</span><span class="ident" id="4566553">Rbrace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566561">if</span>&nbsp;<span class="ident" id="4566564">pos1</span><span class="op" id="4566568">.</span><span class="ident" id="4566569">IsValid</span><span class="op" id="4566576">(</span><span class="op" id="4566577">)</span>&nbsp;<span class="op" id="4566579">&amp;&amp;</span>&nbsp;<span class="ident" id="4566582">pos2</span><span class="op" id="4566586">.</span><span class="ident" id="4566587">IsValid</span><span class="op" id="4566594">(</span><span class="op" id="4566595">)</span>&nbsp;<span class="op" id="4566597">&amp;&amp;</span>&nbsp;<span class="ident" id="4566600">p</span><span class="op" id="4566601">.</span><span class="ident" id="4566602">lineFor</span><span class="op" id="4566609">(</span><span class="ident" id="4566610">pos1</span><span class="op" id="4566614">)</span>&nbsp;<span class="op" id="4566616">!=</span>&nbsp;<span class="ident" id="4566619">p</span><span class="op" id="4566620">.</span><span class="ident" id="4566621">lineFor</span><span class="op" id="4566628">(</span><span class="ident" id="4566629">pos2</span><span class="op" id="4566633">)</span>&nbsp;<span class="op" id="4566635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4566639">//&nbsp;opening&nbsp;and&nbsp;closing&nbsp;brace&nbsp;are&nbsp;on&nbsp;different&nbsp;lines&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566721">return</span>&nbsp;<span class="ident" id="4566728">maxSize</span>&nbsp;<span class="op" id="4566736">+</span>&nbsp;<span class="num" id="4566738">1</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566744">if</span>&nbsp;<span class="builtinfunc" id="4566747">len</span><span class="op" id="4566750">(</span><span class="ident" id="4566751">b</span><span class="op" id="4566752">.</span><span class="ident" id="4566753">List</span><span class="op" id="4566757">)</span>&nbsp;<span class="op" id="4566759">&gt;</span>&nbsp;<span class="num" id="4566761">5</span>&nbsp;<span class="op" id="4566763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4566767">//&nbsp;too&nbsp;many&nbsp;statements&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566820">return</span>&nbsp;<span class="ident" id="4566827">maxSize</span>&nbsp;<span class="op" id="4566835">+</span>&nbsp;<span class="num" id="4566837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566840">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4566843">//&nbsp;otherwise,&nbsp;estimate&nbsp;body&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566877">bodySize</span>&nbsp;<span class="op" id="4566886">:=</span>&nbsp;<span class="ident" id="4566889">p</span><span class="op" id="4566890">.</span><span class="ident" id="4566891">commentSizeBefore</span><span class="op" id="4566908">(</span><span class="ident" id="4566909">p</span><span class="op" id="4566910">.</span><span class="ident" id="4566911">posFor</span><span class="op" id="4566917">(</span><span class="ident" id="4566918">pos2</span><span class="op" id="4566922">)</span><span class="op" id="4566923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566926">for</span>&nbsp;<span class="ident" id="4566930">i</span><span class="op" id="4566931">,</span>&nbsp;<span class="ident" id="4566933">s</span>&nbsp;<span class="op" id="4566935">:=</span>&nbsp;<span class="keyword" id="4566938">range</span>&nbsp;<span class="ident" id="4566944">b</span><span class="op" id="4566945">.</span><span class="ident" id="4566946">List</span>&nbsp;<span class="op" id="4566951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566955">if</span>&nbsp;<span class="ident" id="4566958">bodySize</span>&nbsp;<span class="op" id="4566967">&gt;</span>&nbsp;<span class="ident" id="4566969">maxSize</span>&nbsp;<span class="op" id="4566977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566982">break</span>&nbsp;<span class="comment" id="4566988">//&nbsp;no&nbsp;need&nbsp;to&nbsp;continue</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567017">if</span>&nbsp;<span class="ident" id="4567020">i</span>&nbsp;<span class="op" id="4567022">&gt;</span>&nbsp;<span class="num" id="4567024">0</span>&nbsp;<span class="op" id="4567026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567031">bodySize</span>&nbsp;<span class="op" id="4567040">+=</span>&nbsp;<span class="num" id="4567043">2</span>&nbsp;<span class="comment" id="4567045">//&nbsp;space&nbsp;for&nbsp;a&nbsp;semicolon&nbsp;and&nbsp;blank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567086">bodySize</span>&nbsp;<span class="op" id="4567095">+=</span>&nbsp;<span class="ident" id="4567098">p</span><span class="op" id="4567099">.</span><span class="ident" id="4567100">nodeSize</span><span class="op" id="4567108">(</span><span class="ident" id="4567109">s</span><span class="op" id="4567110">,</span>&nbsp;<span class="ident" id="4567112">maxSize</span><span class="op" id="4567119">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567125">return</span>&nbsp;<span class="ident" id="4567132">bodySize</span><br>
<span class="lineno"></span><span class="op" id="4567141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4567144">//&nbsp;adjBlock&nbsp;prints&nbsp;an&nbsp;&#34;adjacent&#34;&nbsp;block&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;or&nbsp;function&nbsp;body)&nbsp;following</span><br>
<span class="lineno">1490</span><span class="comment" id="4567229">//&nbsp;a&nbsp;header&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;control&nbsp;clause&nbsp;or&nbsp;function&nbsp;signature)&nbsp;of&nbsp;given&nbsp;headerSize.</span><br>
<span class="lineno"></span><span class="comment" id="4567318">//&nbsp;If&nbsp;the&nbsp;header&#39;s&nbsp;and&nbsp;block&#39;s&nbsp;size&nbsp;are&nbsp;&#34;small&nbsp;enough&#34;&nbsp;and&nbsp;the&nbsp;block&nbsp;is&nbsp;&#34;simple&nbsp;enough&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4567407">//&nbsp;the&nbsp;block&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;without&nbsp;line&nbsp;breaks,&nbsp;spaced&nbsp;from&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4567496">//&nbsp;by&nbsp;sep.&nbsp;Otherwise&nbsp;the&nbsp;block&#39;s&nbsp;opening&nbsp;&#34;{&#34;&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4567585">//&nbsp;lines&nbsp;for&nbsp;the&nbsp;block&#39;s&nbsp;statements&nbsp;and&nbsp;its&nbsp;closing&nbsp;&#34;}&#34;.</span><br>
<span class="lineno">1495</span><span class="comment" id="4567642">//</span><br>
<span class="lineno"></span><span class="keyword" id="4567645">func</span>&nbsp;<span class="op" id="4567650">(</span><span class="ident" id="4567651">p</span>&nbsp;<span class="op" id="4567653">*</span><span class="ident" id="4567654">printer</span><span class="op" id="4567661">)</span>&nbsp;<span class="ident" id="4567663">adjBlock</span><span class="op" id="4567671">(</span><span class="ident" id="4567672">headerSize</span>&nbsp;<span class="builtintype" id="4567683">int</span><span class="op" id="4567686">,</span>&nbsp;<span class="ident" id="4567688">sep</span>&nbsp;<span class="ident" id="4567692">whiteSpace</span><span class="op" id="4567702">,</span>&nbsp;<span class="ident" id="4567704">b</span>&nbsp;<span class="op" id="4567706">*</span><span class="ident" id="4567707">ast</span><span class="op" id="4567710">.</span><span class="ident" id="4567711">BlockStmt</span><span class="op" id="4567720">)</span>&nbsp;<span class="op" id="4567722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567725">if</span>&nbsp;<span class="ident" id="4567728">b</span>&nbsp;<span class="op" id="4567730">==</span>&nbsp;<span class="ident" id="4567733">nil</span>&nbsp;<span class="op" id="4567737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567741">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567749">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567753">const</span>&nbsp;<span class="ident" id="4567759">maxSize</span>&nbsp;<span class="op" id="4567767">=</span>&nbsp;<span class="num" id="4567769">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567774">if</span>&nbsp;<span class="ident" id="4567777">headerSize</span><span class="op" id="4567787">+</span><span class="ident" id="4567788">p</span><span class="op" id="4567789">.</span><span class="ident" id="4567790">bodySize</span><span class="op" id="4567798">(</span><span class="ident" id="4567799">b</span><span class="op" id="4567800">,</span>&nbsp;<span class="ident" id="4567802">maxSize</span><span class="op" id="4567809">)</span>&nbsp;<span class="op" id="4567811">&lt;=</span>&nbsp;<span class="ident" id="4567814">maxSize</span>&nbsp;<span class="op" id="4567822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567826">p</span><span class="op" id="4567827">.</span><span class="builtinfunc" id="4567828">print</span><span class="op" id="4567833">(</span><span class="ident" id="4567834">sep</span><span class="op" id="4567837">,</span>&nbsp;<span class="ident" id="4567839">b</span><span class="op" id="4567840">.</span><span class="ident" id="4567841">Lbrace</span><span class="op" id="4567847">,</span>&nbsp;<span class="ident" id="4567849">token</span><span class="op" id="4567854">.</span><span class="ident" id="4567855">LBRACE</span><span class="op" id="4567861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567865">if</span>&nbsp;<span class="builtinfunc" id="4567868">len</span><span class="op" id="4567871">(</span><span class="ident" id="4567872">b</span><span class="op" id="4567873">.</span><span class="ident" id="4567874">List</span><span class="op" id="4567878">)</span>&nbsp;<span class="op" id="4567880">&gt;</span>&nbsp;<span class="num" id="4567882">0</span>&nbsp;<span class="op" id="4567884">{</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567889">p</span><span class="op" id="4567890">.</span><span class="builtinfunc" id="4567891">print</span><span class="op" id="4567896">(</span><span class="ident" id="4567897">blank</span><span class="op" id="4567902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567907">for</span>&nbsp;<span class="ident" id="4567911">i</span><span class="op" id="4567912">,</span>&nbsp;<span class="ident" id="4567914">s</span>&nbsp;<span class="op" id="4567916">:=</span>&nbsp;<span class="keyword" id="4567919">range</span>&nbsp;<span class="ident" id="4567925">b</span><span class="op" id="4567926">.</span><span class="ident" id="4567927">List</span>&nbsp;<span class="op" id="4567932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567938">if</span>&nbsp;<span class="ident" id="4567941">i</span>&nbsp;<span class="op" id="4567943">&gt;</span>&nbsp;<span class="num" id="4567945">0</span>&nbsp;<span class="op" id="4567947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567954">p</span><span class="op" id="4567955">.</span><span class="builtinfunc" id="4567956">print</span><span class="op" id="4567961">(</span><span class="ident" id="4567962">token</span><span class="op" id="4567967">.</span><span class="ident" id="4567968">SEMICOLON</span><span class="op" id="4567977">,</span>&nbsp;<span class="ident" id="4567979">blank</span><span class="op" id="4567984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567990">}</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567996">p</span><span class="op" id="4567997">.</span><span class="ident" id="4567998">stmt</span><span class="op" id="4568002">(</span><span class="ident" id="4568003">s</span><span class="op" id="4568004">,</span>&nbsp;<span class="ident" id="4568006">i</span>&nbsp;<span class="op" id="4568008">==</span>&nbsp;<span class="builtinfunc" id="4568011">len</span><span class="op" id="4568014">(</span><span class="ident" id="4568015">b</span><span class="op" id="4568016">.</span><span class="ident" id="4568017">List</span><span class="op" id="4568021">)</span><span class="op" id="4568022">-</span><span class="num" id="4568023">1</span><span class="op" id="4568024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568034">p</span><span class="op" id="4568035">.</span><span class="builtinfunc" id="4568036">print</span><span class="op" id="4568041">(</span><span class="ident" id="4568042">blank</span><span class="op" id="4568047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568055">p</span><span class="op" id="4568056">.</span><span class="builtinfunc" id="4568057">print</span><span class="op" id="4568062">(</span><span class="ident" id="4568063">noExtraLinebreak</span><span class="op" id="4568079">,</span>&nbsp;<span class="ident" id="4568081">b</span><span class="op" id="4568082">.</span><span class="ident" id="4568083">Rbrace</span><span class="op" id="4568089">,</span>&nbsp;<span class="ident" id="4568091">token</span><span class="op" id="4568096">.</span><span class="ident" id="4568097">RBRACE</span><span class="op" id="4568103">,</span>&nbsp;<span class="ident" id="4568105">noExtraLinebreak</span><span class="op" id="4568121">)</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568125">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568137">if</span>&nbsp;<span class="ident" id="4568140">sep</span>&nbsp;<span class="op" id="4568144">!=</span>&nbsp;<span class="ident" id="4568147">ignore</span>&nbsp;<span class="op" id="4568154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568158">p</span><span class="op" id="4568159">.</span><span class="builtinfunc" id="4568160">print</span><span class="op" id="4568165">(</span><span class="ident" id="4568166">blank</span><span class="op" id="4568171">)</span>&nbsp;<span class="comment" id="4568173">//&nbsp;always&nbsp;use&nbsp;blank</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568197">p</span><span class="op" id="4568198">.</span><span class="ident" id="4568199">block</span><span class="op" id="4568204">(</span><span class="ident" id="4568205">b</span><span class="op" id="4568206">,</span>&nbsp;<span class="num" id="4568208">1</span><span class="op" id="4568209">)</span><br>
<span class="lineno"></span><span class="op" id="4568211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4568214">//&nbsp;distanceFrom&nbsp;returns&nbsp;the&nbsp;column&nbsp;difference&nbsp;between&nbsp;from&nbsp;and&nbsp;p.pos&nbsp;(the&nbsp;current</span><br>
<span class="lineno">1525</span><span class="comment" id="4568296">//&nbsp;estimated&nbsp;position)&nbsp;if&nbsp;both&nbsp;are&nbsp;on&nbsp;the&nbsp;same&nbsp;line;&nbsp;if&nbsp;they&nbsp;are&nbsp;on&nbsp;different&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4568380">//&nbsp;(or&nbsp;unknown)&nbsp;the&nbsp;result&nbsp;is&nbsp;infinity.</span><br>
<span class="lineno"></span><span class="keyword" id="4568420">func</span>&nbsp;<span class="op" id="4568425">(</span><span class="ident" id="4568426">p</span>&nbsp;<span class="op" id="4568428">*</span><span class="ident" id="4568429">printer</span><span class="op" id="4568436">)</span>&nbsp;<span class="ident" id="4568438">distanceFrom</span><span class="op" id="4568450">(</span><span class="ident" id="4568451">from</span>&nbsp;<span class="ident" id="4568456">token</span><span class="op" id="4568461">.</span><span class="ident" id="4568462">Pos</span><span class="op" id="4568465">)</span>&nbsp;<span class="builtintype" id="4568467">int</span>&nbsp;<span class="op" id="4568471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568474">if</span>&nbsp;<span class="ident" id="4568477">from</span><span class="op" id="4568481">.</span><span class="ident" id="4568482">IsValid</span><span class="op" id="4568489">(</span><span class="op" id="4568490">)</span>&nbsp;<span class="op" id="4568492">&amp;&amp;</span>&nbsp;<span class="ident" id="4568495">p</span><span class="op" id="4568496">.</span><span class="ident" id="4568497">pos</span><span class="op" id="4568500">.</span><span class="ident" id="4568501">IsValid</span><span class="op" id="4568508">(</span><span class="op" id="4568509">)</span>&nbsp;<span class="op" id="4568511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568515">if</span>&nbsp;<span class="ident" id="4568518">f</span>&nbsp;<span class="op" id="4568520">:=</span>&nbsp;<span class="ident" id="4568523">p</span><span class="op" id="4568524">.</span><span class="ident" id="4568525">posFor</span><span class="op" id="4568531">(</span><span class="ident" id="4568532">from</span><span class="op" id="4568536">)</span><span class="op" id="4568537">;</span>&nbsp;<span class="ident" id="4568539">f</span><span class="op" id="4568540">.</span><span class="ident" id="4568541">Line</span>&nbsp;<span class="op" id="4568546">==</span>&nbsp;<span class="ident" id="4568549">p</span><span class="op" id="4568550">.</span><span class="ident" id="4568551">pos</span><span class="op" id="4568554">.</span><span class="ident" id="4568555">Line</span>&nbsp;<span class="op" id="4568560">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568565">return</span>&nbsp;<span class="ident" id="4568572">p</span><span class="op" id="4568573">.</span><span class="ident" id="4568574">pos</span><span class="op" id="4568577">.</span><span class="ident" id="4568578">Column</span>&nbsp;<span class="op" id="4568585">-</span>&nbsp;<span class="ident" id="4568587">f</span><span class="op" id="4568588">.</span><span class="ident" id="4568589">Column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568604">return</span>&nbsp;<span class="ident" id="4568611">infinity</span><br>
<span class="lineno"></span><span class="op" id="4568620">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span><span class="keyword" id="4568623">func</span>&nbsp;<span class="op" id="4568628">(</span><span class="ident" id="4568629">p</span>&nbsp;<span class="op" id="4568631">*</span><span class="ident" id="4568632">printer</span><span class="op" id="4568639">)</span>&nbsp;<span class="ident" id="4568641">funcDecl</span><span class="op" id="4568649">(</span><span class="ident" id="4568650">d</span>&nbsp;<span class="op" id="4568652">*</span><span class="ident" id="4568653">ast</span><span class="op" id="4568656">.</span><span class="ident" id="4568657">FuncDecl</span><span class="op" id="4568665">)</span>&nbsp;<span class="op" id="4568667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568670">p</span><span class="op" id="4568671">.</span><span class="ident" id="4568672">setComment</span><span class="op" id="4568682">(</span><span class="ident" id="4568683">d</span><span class="op" id="4568684">.</span><span class="ident" id="4568685">Doc</span><span class="op" id="4568688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568691">p</span><span class="op" id="4568692">.</span><span class="builtinfunc" id="4568693">print</span><span class="op" id="4568698">(</span><span class="ident" id="4568699">d</span><span class="op" id="4568700">.</span><span class="ident" id="4568701">Pos</span><span class="op" id="4568704">(</span><span class="op" id="4568705">)</span><span class="op" id="4568706">,</span>&nbsp;<span class="ident" id="4568708">token</span><span class="op" id="4568713">.</span><span class="ident" id="4568714">FUNC</span><span class="op" id="4568718">,</span>&nbsp;<span class="ident" id="4568720">blank</span><span class="op" id="4568725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568728">if</span>&nbsp;<span class="ident" id="4568731">d</span><span class="op" id="4568732">.</span><span class="ident" id="4568733">Recv</span>&nbsp;<span class="op" id="4568738">!=</span>&nbsp;<span class="ident" id="4568741">nil</span>&nbsp;<span class="op" id="4568745">{</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568749">p</span><span class="op" id="4568750">.</span><span class="ident" id="4568751">parameters</span><span class="op" id="4568761">(</span><span class="ident" id="4568762">d</span><span class="op" id="4568763">.</span><span class="ident" id="4568764">Recv</span><span class="op" id="4568768">)</span>&nbsp;<span class="comment" id="4568770">//&nbsp;method:&nbsp;print&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568798">p</span><span class="op" id="4568799">.</span><span class="builtinfunc" id="4568800">print</span><span class="op" id="4568805">(</span><span class="ident" id="4568806">blank</span><span class="op" id="4568811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568817">p</span><span class="op" id="4568818">.</span><span class="ident" id="4568819">expr</span><span class="op" id="4568823">(</span><span class="ident" id="4568824">d</span><span class="op" id="4568825">.</span><span class="ident" id="4568826">Name</span><span class="op" id="4568830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568833">p</span><span class="op" id="4568834">.</span><span class="ident" id="4568835">signature</span><span class="op" id="4568844">(</span><span class="ident" id="4568845">d</span><span class="op" id="4568846">.</span><span class="ident" id="4568847">Type</span><span class="op" id="4568851">.</span><span class="ident" id="4568852">Params</span><span class="op" id="4568858">,</span>&nbsp;<span class="ident" id="4568860">d</span><span class="op" id="4568861">.</span><span class="ident" id="4568862">Type</span><span class="op" id="4568866">.</span><span class="ident" id="4568867">Results</span><span class="op" id="4568874">)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568877">p</span><span class="op" id="4568878">.</span><span class="ident" id="4568879">adjBlock</span><span class="op" id="4568887">(</span><span class="ident" id="4568888">p</span><span class="op" id="4568889">.</span><span class="ident" id="4568890">distanceFrom</span><span class="op" id="4568902">(</span><span class="ident" id="4568903">d</span><span class="op" id="4568904">.</span><span class="ident" id="4568905">Pos</span><span class="op" id="4568908">(</span><span class="op" id="4568909">)</span><span class="op" id="4568910">)</span><span class="op" id="4568911">,</span>&nbsp;<span class="ident" id="4568913">vtab</span><span class="op" id="4568917">,</span>&nbsp;<span class="ident" id="4568919">d</span><span class="op" id="4568920">.</span><span class="ident" id="4568921">Body</span><span class="op" id="4568925">)</span><br>
<span class="lineno"></span><span class="op" id="4568927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4568930">func</span>&nbsp;<span class="op" id="4568935">(</span><span class="ident" id="4568936">p</span>&nbsp;<span class="op" id="4568938">*</span><span class="ident" id="4568939">printer</span><span class="op" id="4568946">)</span>&nbsp;<span class="ident" id="4568948">decl</span><span class="op" id="4568952">(</span><span class="ident" id="4568953">decl</span>&nbsp;<span class="ident" id="4568958">ast</span><span class="op" id="4568961">.</span><span class="ident" id="4568962">Decl</span><span class="op" id="4568966">)</span>&nbsp;<span class="op" id="4568968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568971">switch</span>&nbsp;<span class="ident" id="4568978">d</span>&nbsp;<span class="op" id="4568980">:=</span>&nbsp;<span class="ident" id="4568983">decl</span><span class="op" id="4568987">.</span><span class="op" id="4568988">(</span><span class="keyword" id="4568989">type</span><span class="op" id="4568993">)</span>&nbsp;<span class="op" id="4568995">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568998">case</span>&nbsp;<span class="op" id="4569003">*</span><span class="ident" id="4569004">ast</span><span class="op" id="4569007">.</span><span class="ident" id="4569008">BadDecl</span><span class="op" id="4569015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569019">p</span><span class="op" id="4569020">.</span><span class="builtinfunc" id="4569021">print</span><span class="op" id="4569026">(</span><span class="ident" id="4569027">d</span><span class="op" id="4569028">.</span><span class="ident" id="4569029">Pos</span><span class="op" id="4569032">(</span><span class="op" id="4569033">)</span><span class="op" id="4569034">,</span>&nbsp;<span class="string" id="4569036">&#34;BadDecl&#34;</span><span class="op" id="4569045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569048">case</span>&nbsp;<span class="op" id="4569053">*</span><span class="ident" id="4569054">ast</span><span class="op" id="4569057">.</span><span class="ident" id="4569058">GenDecl</span><span class="op" id="4569065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569069">p</span><span class="op" id="4569070">.</span><span class="ident" id="4569071">genDecl</span><span class="op" id="4569078">(</span><span class="ident" id="4569079">d</span><span class="op" id="4569080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569083">case</span>&nbsp;<span class="op" id="4569088">*</span><span class="ident" id="4569089">ast</span><span class="op" id="4569092">.</span><span class="ident" id="4569093">FuncDecl</span><span class="op" id="4569101">:</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569105">p</span><span class="op" id="4569106">.</span><span class="ident" id="4569107">funcDecl</span><span class="op" id="4569115">(</span><span class="ident" id="4569116">d</span><span class="op" id="4569117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569120">default</span><span class="op" id="4569127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4569131">panic</span><span class="op" id="4569136">(</span><span class="string" id="4569137">&#34;unreachable&#34;</span><span class="op" id="4569150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569153">}</span><br>
<span class="lineno"></span><span class="op" id="4569155">}</span><br>
<span class="lineno">1560</span><br>
<span class="lineno"></span><span class="comment" id="4569158">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4569238">//&nbsp;Files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4569248">func</span>&nbsp;<span class="ident" id="4569253">declToken</span><span class="op" id="4569262">(</span><span class="ident" id="4569263">decl</span>&nbsp;<span class="ident" id="4569268">ast</span><span class="op" id="4569271">.</span><span class="ident" id="4569272">Decl</span><span class="op" id="4569276">)</span>&nbsp;<span class="op" id="4569278">(</span><span class="ident" id="4569279">tok</span>&nbsp;<span class="ident" id="4569283">token</span><span class="op" id="4569288">.</span><span class="ident" id="4569289">Token</span><span class="op" id="4569294">)</span>&nbsp;<span class="op" id="4569296">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569299">tok</span>&nbsp;<span class="op" id="4569303">=</span>&nbsp;<span class="ident" id="4569305">token</span><span class="op" id="4569310">.</span><span class="ident" id="4569311">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569320">switch</span>&nbsp;<span class="ident" id="4569327">d</span>&nbsp;<span class="op" id="4569329">:=</span>&nbsp;<span class="ident" id="4569332">decl</span><span class="op" id="4569336">.</span><span class="op" id="4569337">(</span><span class="keyword" id="4569338">type</span><span class="op" id="4569342">)</span>&nbsp;<span class="op" id="4569344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569347">case</span>&nbsp;<span class="op" id="4569352">*</span><span class="ident" id="4569353">ast</span><span class="op" id="4569356">.</span><span class="ident" id="4569357">GenDecl</span><span class="op" id="4569364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569368">tok</span>&nbsp;<span class="op" id="4569372">=</span>&nbsp;<span class="ident" id="4569374">d</span><span class="op" id="4569375">.</span><span class="ident" id="4569376">Tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569381">case</span>&nbsp;<span class="op" id="4569386">*</span><span class="ident" id="4569387">ast</span><span class="op" id="4569390">.</span><span class="ident" id="4569391">FuncDecl</span><span class="op" id="4569399">:</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569403">tok</span>&nbsp;<span class="op" id="4569407">=</span>&nbsp;<span class="ident" id="4569409">token</span><span class="op" id="4569414">.</span><span class="ident" id="4569415">FUNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569424">return</span><br>
<span class="lineno"></span><span class="op" id="4569431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span><span class="keyword" id="4569434">func</span>&nbsp;<span class="op" id="4569439">(</span><span class="ident" id="4569440">p</span>&nbsp;<span class="op" id="4569442">*</span><span class="ident" id="4569443">printer</span><span class="op" id="4569450">)</span>&nbsp;<span class="ident" id="4569452">declList</span><span class="op" id="4569460">(</span><span class="ident" id="4569461">list</span>&nbsp;<span class="op" id="4569466">[</span><span class="op" id="4569467">]</span><span class="ident" id="4569468">ast</span><span class="op" id="4569471">.</span><span class="ident" id="4569472">Decl</span><span class="op" id="4569476">)</span>&nbsp;<span class="op" id="4569478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569481">tok</span>&nbsp;<span class="op" id="4569485">:=</span>&nbsp;<span class="ident" id="4569488">token</span><span class="op" id="4569493">.</span><span class="ident" id="4569494">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569503">for</span>&nbsp;<span class="ident" id="4569507">_</span><span class="op" id="4569508">,</span>&nbsp;<span class="ident" id="4569510">d</span>&nbsp;<span class="op" id="4569512">:=</span>&nbsp;<span class="keyword" id="4569515">range</span>&nbsp;<span class="ident" id="4569521">list</span>&nbsp;<span class="op" id="4569526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569530">prev</span>&nbsp;<span class="op" id="4569535">:=</span>&nbsp;<span class="ident" id="4569538">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569544">tok</span>&nbsp;<span class="op" id="4569548">=</span>&nbsp;<span class="ident" id="4569550">declToken</span><span class="op" id="4569559">(</span><span class="ident" id="4569560">d</span><span class="op" id="4569561">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569565">//&nbsp;If&nbsp;the&nbsp;declaration&nbsp;token&nbsp;changed&nbsp;(e.g.,&nbsp;from&nbsp;CONST&nbsp;to&nbsp;TYPE)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569630">//&nbsp;or&nbsp;the&nbsp;next&nbsp;declaration&nbsp;has&nbsp;documentation&nbsp;associated&nbsp;with&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569697">//&nbsp;print&nbsp;an&nbsp;empty&nbsp;line&nbsp;between&nbsp;top-level&nbsp;declarations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569754">//&nbsp;(because&nbsp;p.linebreak&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;position&nbsp;of&nbsp;d,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569820">//&nbsp;is&nbsp;past&nbsp;any&nbsp;documentation,&nbsp;the&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;satisfied</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569889">//&nbsp;even&nbsp;w/o&nbsp;the&nbsp;extra&nbsp;getDoc(d)&nbsp;nil-check&nbsp;-&nbsp;leave&nbsp;it&nbsp;in&nbsp;case&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4569956">//&nbsp;linebreak&nbsp;logic&nbsp;improves&nbsp;-&nbsp;there&#39;s&nbsp;already&nbsp;a&nbsp;TODO).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4570013">if</span>&nbsp;<span class="builtinfunc" id="4570016">len</span><span class="op" id="4570019">(</span><span class="ident" id="4570020">p</span><span class="op" id="4570021">.</span><span class="ident" id="4570022">output</span><span class="op" id="4570028">)</span>&nbsp;<span class="op" id="4570030">&gt;</span>&nbsp;<span class="num" id="4570032">0</span>&nbsp;<span class="op" id="4570034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4570039">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4570112">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570169">min</span>&nbsp;<span class="op" id="4570173">:=</span>&nbsp;<span class="num" id="4570176">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4570181">if</span>&nbsp;<span class="ident" id="4570184">prev</span>&nbsp;<span class="op" id="4570189">!=</span>&nbsp;<span class="ident" id="4570192">tok</span>&nbsp;<span class="op" id="4570196">||</span>&nbsp;<span class="ident" id="4570199">getDoc</span><span class="op" id="4570205">(</span><span class="ident" id="4570206">d</span><span class="op" id="4570207">)</span>&nbsp;<span class="op" id="4570209">!=</span>&nbsp;<span class="ident" id="4570212">nil</span>&nbsp;<span class="op" id="4570216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570222">min</span>&nbsp;<span class="op" id="4570226">=</span>&nbsp;<span class="num" id="4570228">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570238">p</span><span class="op" id="4570239">.</span><span class="ident" id="4570240">linebreak</span><span class="op" id="4570249">(</span><span class="ident" id="4570250">p</span><span class="op" id="4570251">.</span><span class="ident" id="4570252">lineFor</span><span class="op" id="4570259">(</span><span class="ident" id="4570260">d</span><span class="op" id="4570261">.</span><span class="ident" id="4570262">Pos</span><span class="op" id="4570265">(</span><span class="op" id="4570266">)</span><span class="op" id="4570267">)</span><span class="op" id="4570268">,</span>&nbsp;<span class="ident" id="4570270">min</span><span class="op" id="4570273">,</span>&nbsp;<span class="ident" id="4570275">ignore</span><span class="op" id="4570281">,</span>&nbsp;<span class="builtintype" id="4570283">false</span><span class="op" id="4570288">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570296">p</span><span class="op" id="4570297">.</span><span class="ident" id="4570298">decl</span><span class="op" id="4570302">(</span><span class="ident" id="4570303">d</span><span class="op" id="4570304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570307">}</span><br>
<span class="lineno"></span><span class="op" id="4570309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="keyword" id="4570312">func</span>&nbsp;<span class="op" id="4570317">(</span><span class="ident" id="4570318">p</span>&nbsp;<span class="op" id="4570320">*</span><span class="ident" id="4570321">printer</span><span class="op" id="4570328">)</span>&nbsp;<span class="ident" id="4570330">file</span><span class="op" id="4570334">(</span><span class="ident" id="4570335">src</span>&nbsp;<span class="op" id="4570339">*</span><span class="ident" id="4570340">ast</span><span class="op" id="4570343">.</span><span class="ident" id="4570344">File</span><span class="op" id="4570348">)</span>&nbsp;<span class="op" id="4570350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570353">p</span><span class="op" id="4570354">.</span><span class="ident" id="4570355">setComment</span><span class="op" id="4570365">(</span><span class="ident" id="4570366">src</span><span class="op" id="4570369">.</span><span class="ident" id="4570370">Doc</span><span class="op" id="4570373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570376">p</span><span class="op" id="4570377">.</span><span class="builtinfunc" id="4570378">print</span><span class="op" id="4570383">(</span><span class="ident" id="4570384">src</span><span class="op" id="4570387">.</span><span class="ident" id="4570388">Pos</span><span class="op" id="4570391">(</span><span class="op" id="4570392">)</span><span class="op" id="4570393">,</span>&nbsp;<span class="ident" id="4570395">token</span><span class="op" id="4570400">.</span><span class="ident" id="4570401">PACKAGE</span><span class="op" id="4570408">,</span>&nbsp;<span class="ident" id="4570410">blank</span><span class="op" id="4570415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570418">p</span><span class="op" id="4570419">.</span><span class="ident" id="4570420">expr</span><span class="op" id="4570424">(</span><span class="ident" id="4570425">src</span><span class="op" id="4570428">.</span><span class="ident" id="4570429">Name</span><span class="op" id="4570433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570436">p</span><span class="op" id="4570437">.</span><span class="ident" id="4570438">declList</span><span class="op" id="4570446">(</span><span class="ident" id="4570447">src</span><span class="op" id="4570450">.</span><span class="ident" id="4570451">Decls</span><span class="op" id="4570456">)</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570459">p</span><span class="op" id="4570460">.</span><span class="builtinfunc" id="4570461">print</span><span class="op" id="4570466">(</span><span class="ident" id="4570467">newline</span><span class="op" id="4570474">)</span><br>
<span class="lineno"></span><span class="op" id="4570476">}</span>
</div>
</body>
</html>
