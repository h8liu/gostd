<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3314628">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3314683">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3314737">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3314788">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3314846">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3314863">package</span>&nbsp;<span class="ident" id="3314871">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3314876">import</span>&nbsp;<span class="op" id="3314883">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314886">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314895">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314905">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314913">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3314924">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3314934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314937">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3315005">type</span>&nbsp;<span class="ident" id="3315010">Error</span>&nbsp;<span class="keyword" id="3315016">struct</span>&nbsp;<span class="op" id="3315023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315026">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3315030">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315038">URL</span>&nbsp;<span class="builtintype" id="3315042">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315050">Err</span>&nbsp;<span class="builtintype" id="3315054">error</span><br>
<span class="lineno"></span><span class="op" id="3315060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3315063">func</span>&nbsp;<span class="op" id="3315068">(</span><span class="ident" id="3315069">e</span>&nbsp;<span class="op" id="3315071">*</span><span class="ident" id="3315072">Error</span><span class="op" id="3315077">)</span>&nbsp;<span class="ident" id="3315079">Error</span><span class="op" id="3315084">(</span><span class="op" id="3315085">)</span>&nbsp;<span class="builtintype" id="3315087">string</span>&nbsp;<span class="op" id="3315094">{</span>&nbsp;<span class="keyword" id="3315096">return</span>&nbsp;<span class="ident" id="3315103">e</span><span class="op" id="3315104">.</span><span class="ident" id="3315105">Op</span>&nbsp;<span class="op" id="3315108">+</span>&nbsp;<span class="string" id="3315110">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3315114">+</span>&nbsp;<span class="ident" id="3315116">e</span><span class="op" id="3315117">.</span><span class="ident" id="3315118">URL</span>&nbsp;<span class="op" id="3315122">+</span>&nbsp;<span class="string" id="3315124">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3315129">+</span>&nbsp;<span class="ident" id="3315131">e</span><span class="op" id="3315132">.</span><span class="ident" id="3315133">Err</span><span class="op" id="3315136">.</span><span class="ident" id="3315137">Error</span><span class="op" id="3315142">(</span><span class="op" id="3315143">)</span>&nbsp;<span class="op" id="3315145">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3315148">func</span>&nbsp;<span class="ident" id="3315153">ishex</span><span class="op" id="3315158">(</span><span class="ident" id="3315159">c</span>&nbsp;<span class="builtintype" id="3315161">byte</span><span class="op" id="3315165">)</span>&nbsp;<span class="builtintype" id="3315167">bool</span>&nbsp;<span class="op" id="3315172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315175">switch</span>&nbsp;<span class="op" id="3315182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315185">case</span>&nbsp;<span class="string" id="3315190">&#39;0&#39;</span>&nbsp;<span class="op" id="3315194">&lt;=</span>&nbsp;<span class="ident" id="3315197">c</span>&nbsp;<span class="op" id="3315199">&amp;&amp;</span>&nbsp;<span class="ident" id="3315202">c</span>&nbsp;<span class="op" id="3315204">&lt;=</span>&nbsp;<span class="string" id="3315207">&#39;9&#39;</span><span class="op" id="3315210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315214">return</span>&nbsp;<span class="builtintype" id="3315221">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315227">case</span>&nbsp;<span class="string" id="3315232">&#39;a&#39;</span>&nbsp;<span class="op" id="3315236">&lt;=</span>&nbsp;<span class="ident" id="3315239">c</span>&nbsp;<span class="op" id="3315241">&amp;&amp;</span>&nbsp;<span class="ident" id="3315244">c</span>&nbsp;<span class="op" id="3315246">&lt;=</span>&nbsp;<span class="string" id="3315249">&#39;f&#39;</span><span class="op" id="3315252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315256">return</span>&nbsp;<span class="builtintype" id="3315263">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315269">case</span>&nbsp;<span class="string" id="3315274">&#39;A&#39;</span>&nbsp;<span class="op" id="3315278">&lt;=</span>&nbsp;<span class="ident" id="3315281">c</span>&nbsp;<span class="op" id="3315283">&amp;&amp;</span>&nbsp;<span class="ident" id="3315286">c</span>&nbsp;<span class="op" id="3315288">&lt;=</span>&nbsp;<span class="string" id="3315291">&#39;F&#39;</span><span class="op" id="3315294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315298">return</span>&nbsp;<span class="builtintype" id="3315305">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315311">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315314">return</span>&nbsp;<span class="builtintype" id="3315321">false</span><br>
<span class="lineno"></span><span class="op" id="3315327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3315330">func</span>&nbsp;<span class="ident" id="3315335">unhex</span><span class="op" id="3315340">(</span><span class="ident" id="3315341">c</span>&nbsp;<span class="builtintype" id="3315343">byte</span><span class="op" id="3315347">)</span>&nbsp;<span class="builtintype" id="3315349">byte</span>&nbsp;<span class="op" id="3315354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315357">switch</span>&nbsp;<span class="op" id="3315364">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315367">case</span>&nbsp;<span class="string" id="3315372">&#39;0&#39;</span>&nbsp;<span class="op" id="3315376">&lt;=</span>&nbsp;<span class="ident" id="3315379">c</span>&nbsp;<span class="op" id="3315381">&amp;&amp;</span>&nbsp;<span class="ident" id="3315384">c</span>&nbsp;<span class="op" id="3315386">&lt;=</span>&nbsp;<span class="string" id="3315389">&#39;9&#39;</span><span class="op" id="3315392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315396">return</span>&nbsp;<span class="ident" id="3315403">c</span>&nbsp;<span class="op" id="3315405">-</span>&nbsp;<span class="string" id="3315407">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315412">case</span>&nbsp;<span class="string" id="3315417">&#39;a&#39;</span>&nbsp;<span class="op" id="3315421">&lt;=</span>&nbsp;<span class="ident" id="3315424">c</span>&nbsp;<span class="op" id="3315426">&amp;&amp;</span>&nbsp;<span class="ident" id="3315429">c</span>&nbsp;<span class="op" id="3315431">&lt;=</span>&nbsp;<span class="string" id="3315434">&#39;f&#39;</span><span class="op" id="3315437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315441">return</span>&nbsp;<span class="ident" id="3315448">c</span>&nbsp;<span class="op" id="3315450">-</span>&nbsp;<span class="string" id="3315452">&#39;a&#39;</span>&nbsp;<span class="op" id="3315456">+</span>&nbsp;<span class="num" id="3315458">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315462">case</span>&nbsp;<span class="string" id="3315467">&#39;A&#39;</span>&nbsp;<span class="op" id="3315471">&lt;=</span>&nbsp;<span class="ident" id="3315474">c</span>&nbsp;<span class="op" id="3315476">&amp;&amp;</span>&nbsp;<span class="ident" id="3315479">c</span>&nbsp;<span class="op" id="3315481">&lt;=</span>&nbsp;<span class="string" id="3315484">&#39;F&#39;</span><span class="op" id="3315487">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315491">return</span>&nbsp;<span class="ident" id="3315498">c</span>&nbsp;<span class="op" id="3315500">-</span>&nbsp;<span class="string" id="3315502">&#39;A&#39;</span>&nbsp;<span class="op" id="3315506">+</span>&nbsp;<span class="num" id="3315508">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315515">return</span>&nbsp;<span class="num" id="3315522">0</span><br>
<span class="lineno"></span><span class="op" id="3315524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3315527">type</span>&nbsp;<span class="ident" id="3315532">encoding</span>&nbsp;<span class="builtintype" id="3315541">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3315546">const</span>&nbsp;<span class="op" id="3315552">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315555">encodePath</span>&nbsp;<span class="ident" id="3315566">encoding</span>&nbsp;<span class="op" id="3315575">=</span>&nbsp;<span class="num" id="3315577">1</span>&nbsp;<span class="op" id="3315579">+</span>&nbsp;<span class="ident" id="3315581">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315587">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315607">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315629">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3315644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3315647">type</span>&nbsp;<span class="ident" id="3315652">EscapeError</span>&nbsp;<span class="builtintype" id="3315664">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3315672">func</span>&nbsp;<span class="op" id="3315677">(</span><span class="ident" id="3315678">e</span>&nbsp;<span class="ident" id="3315680">EscapeError</span><span class="op" id="3315691">)</span>&nbsp;<span class="ident" id="3315693">Error</span><span class="op" id="3315698">(</span><span class="op" id="3315699">)</span>&nbsp;<span class="builtintype" id="3315701">string</span>&nbsp;<span class="op" id="3315708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315711">return</span>&nbsp;<span class="string" id="3315718">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3315740">+</span>&nbsp;<span class="ident" id="3315742">strconv</span><span class="op" id="3315749">.</span><span class="ident" id="3315750">Quote</span><span class="op" id="3315755">(</span><span class="builtintype" id="3315756">string</span><span class="op" id="3315762">(</span><span class="ident" id="3315763">e</span><span class="op" id="3315764">)</span><span class="op" id="3315765">)</span><br>
<span class="lineno"></span><span class="op" id="3315767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3315770">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3315835">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3315888">func</span>&nbsp;<span class="ident" id="3315893">shouldEscape</span><span class="op" id="3315905">(</span><span class="ident" id="3315906">c</span>&nbsp;<span class="builtintype" id="3315908">byte</span><span class="op" id="3315912">,</span>&nbsp;<span class="ident" id="3315914">mode</span>&nbsp;<span class="ident" id="3315919">encoding</span><span class="op" id="3315927">)</span>&nbsp;<span class="builtintype" id="3315929">bool</span>&nbsp;<span class="op" id="3315934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3315937">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315980">if</span>&nbsp;<span class="string" id="3315983">&#39;A&#39;</span>&nbsp;<span class="op" id="3315987">&lt;=</span>&nbsp;<span class="ident" id="3315990">c</span>&nbsp;<span class="op" id="3315992">&amp;&amp;</span>&nbsp;<span class="ident" id="3315995">c</span>&nbsp;<span class="op" id="3315997">&lt;=</span>&nbsp;<span class="string" id="3316000">&#39;Z&#39;</span>&nbsp;<span class="op" id="3316004">||</span>&nbsp;<span class="string" id="3316007">&#39;a&#39;</span>&nbsp;<span class="op" id="3316011">&lt;=</span>&nbsp;<span class="ident" id="3316014">c</span>&nbsp;<span class="op" id="3316016">&amp;&amp;</span>&nbsp;<span class="ident" id="3316019">c</span>&nbsp;<span class="op" id="3316021">&lt;=</span>&nbsp;<span class="string" id="3316024">&#39;z&#39;</span>&nbsp;<span class="op" id="3316028">||</span>&nbsp;<span class="string" id="3316031">&#39;0&#39;</span>&nbsp;<span class="op" id="3316035">&lt;=</span>&nbsp;<span class="ident" id="3316038">c</span>&nbsp;<span class="op" id="3316040">&amp;&amp;</span>&nbsp;<span class="ident" id="3316043">c</span>&nbsp;<span class="op" id="3316045">&lt;=</span>&nbsp;<span class="string" id="3316048">&#39;9&#39;</span>&nbsp;<span class="op" id="3316052">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316056">return</span>&nbsp;<span class="builtintype" id="3316063">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316074">switch</span>&nbsp;<span class="ident" id="3316081">c</span>&nbsp;<span class="op" id="3316083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316086">case</span>&nbsp;<span class="string" id="3316091">&#39;-&#39;</span><span class="op" id="3316094">,</span>&nbsp;<span class="string" id="3316096">&#39;_&#39;</span><span class="op" id="3316099">,</span>&nbsp;<span class="string" id="3316101">&#39;.&#39;</span><span class="op" id="3316104">,</span>&nbsp;<span class="string" id="3316106">&#39;~&#39;</span><span class="op" id="3316109">:</span>&nbsp;<span class="comment" id="3316111">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316151">return</span>&nbsp;<span class="builtintype" id="3316158">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316166">case</span>&nbsp;<span class="string" id="3316171">&#39;$&#39;</span><span class="op" id="3316174">,</span>&nbsp;<span class="string" id="3316176">&#39;&amp;&#39;</span><span class="op" id="3316179">,</span>&nbsp;<span class="string" id="3316181">&#39;+&#39;</span><span class="op" id="3316184">,</span>&nbsp;<span class="string" id="3316186">&#39;,&#39;</span><span class="op" id="3316189">,</span>&nbsp;<span class="string" id="3316191">&#39;/&#39;</span><span class="op" id="3316194">,</span>&nbsp;<span class="string" id="3316196">&#39;:&#39;</span><span class="op" id="3316199">,</span>&nbsp;<span class="string" id="3316201">&#39;;&#39;</span><span class="op" id="3316204">,</span>&nbsp;<span class="string" id="3316206">&#39;=&#39;</span><span class="op" id="3316209">,</span>&nbsp;<span class="string" id="3316211">&#39;?&#39;</span><span class="op" id="3316214">,</span>&nbsp;<span class="string" id="3316216">&#39;@&#39;</span><span class="op" id="3316219">:</span>&nbsp;<span class="comment" id="3316221">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316263">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316313">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316363">switch</span>&nbsp;<span class="ident" id="3316370">mode</span>&nbsp;<span class="op" id="3316375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316379">case</span>&nbsp;<span class="ident" id="3316384">encodePath</span><span class="op" id="3316394">:</span>&nbsp;<span class="comment" id="3316396">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316408">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316471">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316527">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316589">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316643">return</span>&nbsp;<span class="ident" id="3316650">c</span>&nbsp;<span class="op" id="3316652">==</span>&nbsp;<span class="string" id="3316655">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316662">case</span>&nbsp;<span class="ident" id="3316667">encodeUserPassword</span><span class="op" id="3316685">:</span>&nbsp;<span class="comment" id="3316687">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316701">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316763">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316821">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316891">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316907">return</span>&nbsp;<span class="ident" id="3316914">c</span>&nbsp;<span class="op" id="3316916">==</span>&nbsp;<span class="string" id="3316919">&#39;@&#39;</span>&nbsp;<span class="op" id="3316923">||</span>&nbsp;<span class="ident" id="3316926">c</span>&nbsp;<span class="op" id="3316928">==</span>&nbsp;<span class="string" id="3316931">&#39;/&#39;</span>&nbsp;<span class="op" id="3316935">||</span>&nbsp;<span class="ident" id="3316938">c</span>&nbsp;<span class="op" id="3316940">==</span>&nbsp;<span class="string" id="3316943">&#39;?&#39;</span>&nbsp;<span class="op" id="3316947">||</span>&nbsp;<span class="ident" id="3316950">c</span>&nbsp;<span class="op" id="3316952">==</span>&nbsp;<span class="string" id="3316955">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316962">case</span>&nbsp;<span class="ident" id="3316967">encodeQueryComponent</span><span class="op" id="3316987">:</span>&nbsp;<span class="comment" id="3316989">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317001">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317056">return</span>&nbsp;<span class="builtintype" id="3317063">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317071">case</span>&nbsp;<span class="ident" id="3317076">encodeFragment</span><span class="op" id="3317090">:</span>&nbsp;<span class="comment" id="3317092">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317104">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317156">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317193">return</span>&nbsp;<span class="builtintype" id="3317200">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317211">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317215">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317252">return</span>&nbsp;<span class="builtintype" id="3317259">true</span><br>
<span class="lineno"></span><span class="op" id="3317264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3317267">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3317343">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3317418">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3317470">func</span>&nbsp;<span class="ident" id="3317475">QueryUnescape</span><span class="op" id="3317488">(</span><span class="ident" id="3317489">s</span>&nbsp;<span class="builtintype" id="3317491">string</span><span class="op" id="3317497">)</span>&nbsp;<span class="op" id="3317499">(</span><span class="builtintype" id="3317500">string</span><span class="op" id="3317506">,</span>&nbsp;<span class="builtintype" id="3317508">error</span><span class="op" id="3317513">)</span>&nbsp;<span class="op" id="3317515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317518">return</span>&nbsp;<span class="ident" id="3317525">unescape</span><span class="op" id="3317533">(</span><span class="ident" id="3317534">s</span><span class="op" id="3317535">,</span>&nbsp;<span class="ident" id="3317537">encodeQueryComponent</span><span class="op" id="3317557">)</span><br>
<span class="lineno">115</span><span class="op" id="3317559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317562">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3317613">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3317668">func</span>&nbsp;<span class="ident" id="3317673">unescape</span><span class="op" id="3317681">(</span><span class="ident" id="3317682">s</span>&nbsp;<span class="builtintype" id="3317684">string</span><span class="op" id="3317690">,</span>&nbsp;<span class="ident" id="3317692">mode</span>&nbsp;<span class="ident" id="3317697">encoding</span><span class="op" id="3317705">)</span>&nbsp;<span class="op" id="3317707">(</span><span class="builtintype" id="3317708">string</span><span class="op" id="3317714">,</span>&nbsp;<span class="builtintype" id="3317716">error</span><span class="op" id="3317721">)</span>&nbsp;<span class="op" id="3317723">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317726">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317771">n</span>&nbsp;<span class="op" id="3317773">:=</span>&nbsp;<span class="num" id="3317776">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317779">hasPlus</span>&nbsp;<span class="op" id="3317787">:=</span>&nbsp;<span class="builtintype" id="3317790">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317797">for</span>&nbsp;<span class="ident" id="3317801">i</span>&nbsp;<span class="op" id="3317803">:=</span>&nbsp;<span class="num" id="3317806">0</span><span class="op" id="3317807">;</span>&nbsp;<span class="ident" id="3317809">i</span>&nbsp;<span class="op" id="3317811">&lt;</span>&nbsp;<span class="builtinfunc" id="3317813">len</span><span class="op" id="3317816">(</span><span class="ident" id="3317817">s</span><span class="op" id="3317818">)</span><span class="op" id="3317819">;</span>&nbsp;<span class="op" id="3317821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317825">switch</span>&nbsp;<span class="ident" id="3317832">s</span><span class="op" id="3317833">[</span><span class="ident" id="3317834">i</span><span class="op" id="3317835">]</span>&nbsp;<span class="op" id="3317837">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317841">case</span>&nbsp;<span class="string" id="3317846">&#39;%&#39;</span><span class="op" id="3317849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317854">n</span><span class="op" id="3317855">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317861">if</span>&nbsp;<span class="ident" id="3317864">i</span><span class="op" id="3317865">+</span><span class="num" id="3317866">2</span>&nbsp;<span class="op" id="3317868">&gt;=</span>&nbsp;<span class="builtinfunc" id="3317871">len</span><span class="op" id="3317874">(</span><span class="ident" id="3317875">s</span><span class="op" id="3317876">)</span>&nbsp;<span class="op" id="3317878">||</span>&nbsp;<span class="op" id="3317881">!</span><span class="ident" id="3317882">ishex</span><span class="op" id="3317887">(</span><span class="ident" id="3317888">s</span><span class="op" id="3317889">[</span><span class="ident" id="3317890">i</span><span class="op" id="3317891">+</span><span class="num" id="3317892">1</span><span class="op" id="3317893">]</span><span class="op" id="3317894">)</span>&nbsp;<span class="op" id="3317896">||</span>&nbsp;<span class="op" id="3317899">!</span><span class="ident" id="3317900">ishex</span><span class="op" id="3317905">(</span><span class="ident" id="3317906">s</span><span class="op" id="3317907">[</span><span class="ident" id="3317908">i</span><span class="op" id="3317909">+</span><span class="num" id="3317910">2</span><span class="op" id="3317911">]</span><span class="op" id="3317912">)</span>&nbsp;<span class="op" id="3317914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317920">s</span>&nbsp;<span class="op" id="3317922">=</span>&nbsp;<span class="ident" id="3317924">s</span><span class="op" id="3317925">[</span><span class="ident" id="3317926">i</span><span class="op" id="3317927">:</span><span class="op" id="3317928">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317934">if</span>&nbsp;<span class="builtinfunc" id="3317937">len</span><span class="op" id="3317940">(</span><span class="ident" id="3317941">s</span><span class="op" id="3317942">)</span>&nbsp;<span class="op" id="3317944">&gt;</span>&nbsp;<span class="num" id="3317946">3</span>&nbsp;<span class="op" id="3317948">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317955">s</span>&nbsp;<span class="op" id="3317957">=</span>&nbsp;<span class="ident" id="3317959">s</span><span class="op" id="3317960">[</span><span class="num" id="3317961">0</span><span class="op" id="3317962">:</span><span class="num" id="3317963">3</span><span class="op" id="3317964">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317976">return</span>&nbsp;<span class="string" id="3317983">&#34;&#34;</span><span class="op" id="3317985">,</span>&nbsp;<span class="ident" id="3317987">EscapeError</span><span class="op" id="3317998">(</span><span class="ident" id="3317999">s</span><span class="op" id="3318000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318010">i</span>&nbsp;<span class="op" id="3318012">+=</span>&nbsp;<span class="num" id="3318015">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318019">case</span>&nbsp;<span class="string" id="3318024">&#39;+&#39;</span><span class="op" id="3318027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318032">hasPlus</span>&nbsp;<span class="op" id="3318040">=</span>&nbsp;<span class="ident" id="3318042">mode</span>&nbsp;<span class="op" id="3318047">==</span>&nbsp;<span class="ident" id="3318050">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318074">i</span><span class="op" id="3318075">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318080">default</span><span class="op" id="3318087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318092">i</span><span class="op" id="3318093">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318105">if</span>&nbsp;<span class="ident" id="3318108">n</span>&nbsp;<span class="op" id="3318110">==</span>&nbsp;<span class="num" id="3318113">0</span>&nbsp;<span class="op" id="3318115">&amp;&amp;</span>&nbsp;<span class="op" id="3318118">!</span><span class="ident" id="3318119">hasPlus</span>&nbsp;<span class="op" id="3318127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318131">return</span>&nbsp;<span class="ident" id="3318138">s</span><span class="op" id="3318139">,</span>&nbsp;<span class="ident" id="3318141">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318150">t</span>&nbsp;<span class="op" id="3318152">:=</span>&nbsp;<span class="builtinfunc" id="3318155">make</span><span class="op" id="3318159">(</span><span class="op" id="3318160">[</span><span class="op" id="3318161">]</span><span class="builtintype" id="3318162">byte</span><span class="op" id="3318166">,</span>&nbsp;<span class="builtinfunc" id="3318168">len</span><span class="op" id="3318171">(</span><span class="ident" id="3318172">s</span><span class="op" id="3318173">)</span><span class="op" id="3318174">-</span><span class="num" id="3318175">2</span><span class="op" id="3318176">*</span><span class="ident" id="3318177">n</span><span class="op" id="3318178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318181">j</span>&nbsp;<span class="op" id="3318183">:=</span>&nbsp;<span class="num" id="3318186">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318189">for</span>&nbsp;<span class="ident" id="3318193">i</span>&nbsp;<span class="op" id="3318195">:=</span>&nbsp;<span class="num" id="3318198">0</span><span class="op" id="3318199">;</span>&nbsp;<span class="ident" id="3318201">i</span>&nbsp;<span class="op" id="3318203">&lt;</span>&nbsp;<span class="builtinfunc" id="3318205">len</span><span class="op" id="3318208">(</span><span class="ident" id="3318209">s</span><span class="op" id="3318210">)</span><span class="op" id="3318211">;</span>&nbsp;<span class="op" id="3318213">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318217">switch</span>&nbsp;<span class="ident" id="3318224">s</span><span class="op" id="3318225">[</span><span class="ident" id="3318226">i</span><span class="op" id="3318227">]</span>&nbsp;<span class="op" id="3318229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318233">case</span>&nbsp;<span class="string" id="3318238">&#39;%&#39;</span><span class="op" id="3318241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318246">t</span><span class="op" id="3318247">[</span><span class="ident" id="3318248">j</span><span class="op" id="3318249">]</span>&nbsp;<span class="op" id="3318251">=</span>&nbsp;<span class="ident" id="3318253">unhex</span><span class="op" id="3318258">(</span><span class="ident" id="3318259">s</span><span class="op" id="3318260">[</span><span class="ident" id="3318261">i</span><span class="op" id="3318262">+</span><span class="num" id="3318263">1</span><span class="op" id="3318264">]</span><span class="op" id="3318265">)</span><span class="op" id="3318266">&lt;&lt;</span><span class="num" id="3318268">4</span>&nbsp;<span class="op" id="3318270">|</span>&nbsp;<span class="ident" id="3318272">unhex</span><span class="op" id="3318277">(</span><span class="ident" id="3318278">s</span><span class="op" id="3318279">[</span><span class="ident" id="3318280">i</span><span class="op" id="3318281">+</span><span class="num" id="3318282">2</span><span class="op" id="3318283">]</span><span class="op" id="3318284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318289">j</span><span class="op" id="3318290">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318296">i</span>&nbsp;<span class="op" id="3318298">+=</span>&nbsp;<span class="num" id="3318301">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318305">case</span>&nbsp;<span class="string" id="3318310">&#39;+&#39;</span><span class="op" id="3318313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318318">if</span>&nbsp;<span class="ident" id="3318321">mode</span>&nbsp;<span class="op" id="3318326">==</span>&nbsp;<span class="ident" id="3318329">encodeQueryComponent</span>&nbsp;<span class="op" id="3318350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318356">t</span><span class="op" id="3318357">[</span><span class="ident" id="3318358">j</span><span class="op" id="3318359">]</span>&nbsp;<span class="op" id="3318361">=</span>&nbsp;<span class="string" id="3318363">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318370">}</span>&nbsp;<span class="keyword" id="3318372">else</span>&nbsp;<span class="op" id="3318377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318383">t</span><span class="op" id="3318384">[</span><span class="ident" id="3318385">j</span><span class="op" id="3318386">]</span>&nbsp;<span class="op" id="3318388">=</span>&nbsp;<span class="string" id="3318390">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318402">j</span><span class="op" id="3318403">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318409">i</span><span class="op" id="3318410">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318415">default</span><span class="op" id="3318422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318427">t</span><span class="op" id="3318428">[</span><span class="ident" id="3318429">j</span><span class="op" id="3318430">]</span>&nbsp;<span class="op" id="3318432">=</span>&nbsp;<span class="ident" id="3318434">s</span><span class="op" id="3318435">[</span><span class="ident" id="3318436">i</span><span class="op" id="3318437">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318442">j</span><span class="op" id="3318443">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318449">i</span><span class="op" id="3318450">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318461">return</span>&nbsp;<span class="builtintype" id="3318468">string</span><span class="op" id="3318474">(</span><span class="ident" id="3318475">t</span><span class="op" id="3318476">)</span><span class="op" id="3318477">,</span>&nbsp;<span class="ident" id="3318479">nil</span><br>
<span class="lineno">170</span><span class="op" id="3318483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3318486">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3318547">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3318570">func</span>&nbsp;<span class="ident" id="3318575">QueryEscape</span><span class="op" id="3318586">(</span><span class="ident" id="3318587">s</span>&nbsp;<span class="builtintype" id="3318589">string</span><span class="op" id="3318595">)</span>&nbsp;<span class="builtintype" id="3318597">string</span>&nbsp;<span class="op" id="3318604">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318607">return</span>&nbsp;<span class="ident" id="3318614">escape</span><span class="op" id="3318620">(</span><span class="ident" id="3318621">s</span><span class="op" id="3318622">,</span>&nbsp;<span class="ident" id="3318624">encodeQueryComponent</span><span class="op" id="3318644">)</span><br>
<span class="lineno"></span><span class="op" id="3318646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3318649">func</span>&nbsp;<span class="ident" id="3318654">escape</span><span class="op" id="3318660">(</span><span class="ident" id="3318661">s</span>&nbsp;<span class="builtintype" id="3318663">string</span><span class="op" id="3318669">,</span>&nbsp;<span class="ident" id="3318671">mode</span>&nbsp;<span class="ident" id="3318676">encoding</span><span class="op" id="3318684">)</span>&nbsp;<span class="builtintype" id="3318686">string</span>&nbsp;<span class="op" id="3318693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318696">spaceCount</span><span class="op" id="3318706">,</span>&nbsp;<span class="ident" id="3318708">hexCount</span>&nbsp;<span class="op" id="3318717">:=</span>&nbsp;<span class="num" id="3318720">0</span><span class="op" id="3318721">,</span>&nbsp;<span class="num" id="3318723">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318726">for</span>&nbsp;<span class="ident" id="3318730">i</span>&nbsp;<span class="op" id="3318732">:=</span>&nbsp;<span class="num" id="3318735">0</span><span class="op" id="3318736">;</span>&nbsp;<span class="ident" id="3318738">i</span>&nbsp;<span class="op" id="3318740">&lt;</span>&nbsp;<span class="builtinfunc" id="3318742">len</span><span class="op" id="3318745">(</span><span class="ident" id="3318746">s</span><span class="op" id="3318747">)</span><span class="op" id="3318748">;</span>&nbsp;<span class="ident" id="3318750">i</span><span class="op" id="3318751">++</span>&nbsp;<span class="op" id="3318754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318758">c</span>&nbsp;<span class="op" id="3318760">:=</span>&nbsp;<span class="ident" id="3318763">s</span><span class="op" id="3318764">[</span><span class="ident" id="3318765">i</span><span class="op" id="3318766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318770">if</span>&nbsp;<span class="ident" id="3318773">shouldEscape</span><span class="op" id="3318785">(</span><span class="ident" id="3318786">c</span><span class="op" id="3318787">,</span>&nbsp;<span class="ident" id="3318789">mode</span><span class="op" id="3318793">)</span>&nbsp;<span class="op" id="3318795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318800">if</span>&nbsp;<span class="ident" id="3318803">c</span>&nbsp;<span class="op" id="3318805">==</span>&nbsp;<span class="string" id="3318808">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3318812">&amp;&amp;</span>&nbsp;<span class="ident" id="3318815">mode</span>&nbsp;<span class="op" id="3318820">==</span>&nbsp;<span class="ident" id="3318823">encodeQueryComponent</span>&nbsp;<span class="op" id="3318844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318850">spaceCount</span><span class="op" id="3318860">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318866">}</span>&nbsp;<span class="keyword" id="3318868">else</span>&nbsp;<span class="op" id="3318873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318879">hexCount</span><span class="op" id="3318887">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318900">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318904">if</span>&nbsp;<span class="ident" id="3318907">spaceCount</span>&nbsp;<span class="op" id="3318918">==</span>&nbsp;<span class="num" id="3318921">0</span>&nbsp;<span class="op" id="3318923">&amp;&amp;</span>&nbsp;<span class="ident" id="3318926">hexCount</span>&nbsp;<span class="op" id="3318935">==</span>&nbsp;<span class="num" id="3318938">0</span>&nbsp;<span class="op" id="3318940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318944">return</span>&nbsp;<span class="ident" id="3318951">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318958">t</span>&nbsp;<span class="op" id="3318960">:=</span>&nbsp;<span class="builtinfunc" id="3318963">make</span><span class="op" id="3318967">(</span><span class="op" id="3318968">[</span><span class="op" id="3318969">]</span><span class="builtintype" id="3318970">byte</span><span class="op" id="3318974">,</span>&nbsp;<span class="builtinfunc" id="3318976">len</span><span class="op" id="3318979">(</span><span class="ident" id="3318980">s</span><span class="op" id="3318981">)</span><span class="op" id="3318982">+</span><span class="num" id="3318983">2</span><span class="op" id="3318984">*</span><span class="ident" id="3318985">hexCount</span><span class="op" id="3318993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318996">j</span>&nbsp;<span class="op" id="3318998">:=</span>&nbsp;<span class="num" id="3319001">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319004">for</span>&nbsp;<span class="ident" id="3319008">i</span>&nbsp;<span class="op" id="3319010">:=</span>&nbsp;<span class="num" id="3319013">0</span><span class="op" id="3319014">;</span>&nbsp;<span class="ident" id="3319016">i</span>&nbsp;<span class="op" id="3319018">&lt;</span>&nbsp;<span class="builtinfunc" id="3319020">len</span><span class="op" id="3319023">(</span><span class="ident" id="3319024">s</span><span class="op" id="3319025">)</span><span class="op" id="3319026">;</span>&nbsp;<span class="ident" id="3319028">i</span><span class="op" id="3319029">++</span>&nbsp;<span class="op" id="3319032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319036">switch</span>&nbsp;<span class="ident" id="3319043">c</span>&nbsp;<span class="op" id="3319045">:=</span>&nbsp;<span class="ident" id="3319048">s</span><span class="op" id="3319049">[</span><span class="ident" id="3319050">i</span><span class="op" id="3319051">]</span><span class="op" id="3319052">;</span>&nbsp;<span class="op" id="3319054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319058">case</span>&nbsp;<span class="ident" id="3319063">c</span>&nbsp;<span class="op" id="3319065">==</span>&nbsp;<span class="string" id="3319068">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3319072">&amp;&amp;</span>&nbsp;<span class="ident" id="3319075">mode</span>&nbsp;<span class="op" id="3319080">==</span>&nbsp;<span class="ident" id="3319083">encodeQueryComponent</span><span class="op" id="3319103">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319108">t</span><span class="op" id="3319109">[</span><span class="ident" id="3319110">j</span><span class="op" id="3319111">]</span>&nbsp;<span class="op" id="3319113">=</span>&nbsp;<span class="string" id="3319115">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319122">j</span><span class="op" id="3319123">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319128">case</span>&nbsp;<span class="ident" id="3319133">shouldEscape</span><span class="op" id="3319145">(</span><span class="ident" id="3319146">c</span><span class="op" id="3319147">,</span>&nbsp;<span class="ident" id="3319149">mode</span><span class="op" id="3319153">)</span><span class="op" id="3319154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319159">t</span><span class="op" id="3319160">[</span><span class="ident" id="3319161">j</span><span class="op" id="3319162">]</span>&nbsp;<span class="op" id="3319164">=</span>&nbsp;<span class="string" id="3319166">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319173">t</span><span class="op" id="3319174">[</span><span class="ident" id="3319175">j</span><span class="op" id="3319176">+</span><span class="num" id="3319177">1</span><span class="op" id="3319178">]</span>&nbsp;<span class="op" id="3319180">=</span>&nbsp;<span class="string" id="3319182">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3319200">[</span><span class="ident" id="3319201">c</span><span class="op" id="3319202">&gt;&gt;</span><span class="num" id="3319204">4</span><span class="op" id="3319205">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319210">t</span><span class="op" id="3319211">[</span><span class="ident" id="3319212">j</span><span class="op" id="3319213">+</span><span class="num" id="3319214">2</span><span class="op" id="3319215">]</span>&nbsp;<span class="op" id="3319217">=</span>&nbsp;<span class="string" id="3319219">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3319237">[</span><span class="ident" id="3319238">c</span><span class="op" id="3319239">&amp;</span><span class="num" id="3319240">15</span><span class="op" id="3319242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319247">j</span>&nbsp;<span class="op" id="3319249">+=</span>&nbsp;<span class="num" id="3319252">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319256">default</span><span class="op" id="3319263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319268">t</span><span class="op" id="3319269">[</span><span class="ident" id="3319270">j</span><span class="op" id="3319271">]</span>&nbsp;<span class="op" id="3319273">=</span>&nbsp;<span class="ident" id="3319275">s</span><span class="op" id="3319276">[</span><span class="ident" id="3319277">i</span><span class="op" id="3319278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319283">j</span><span class="op" id="3319284">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319295">return</span>&nbsp;<span class="builtintype" id="3319302">string</span><span class="op" id="3319308">(</span><span class="ident" id="3319309">t</span><span class="op" id="3319310">)</span><br>
<span class="lineno"></span><span class="op" id="3319312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3319315">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3319380">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3319416">//</span><br>
<span class="lineno"></span><span class="comment" id="3319419">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3319471">//</span><br>
<span class="lineno">220</span><span class="comment" id="3319474">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3319550">//</span><br>
<span class="lineno"></span><span class="comment" id="3319553">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3319589">//</span><br>
<span class="lineno"></span><span class="comment" id="3319592">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3319672">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3319753">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3319837">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3319922">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3320001">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3320083">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3320137">type</span>&nbsp;<span class="ident" id="3320142">URL</span>&nbsp;<span class="keyword" id="3320146">struct</span>&nbsp;<span class="op" id="3320153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320156">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3320165">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320173">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3320182">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320192">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320216">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320225">*</span><span class="ident" id="3320226">Userinfo</span>&nbsp;<span class="comment" id="3320235">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320273">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3320282">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320292">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320314">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3320323">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320331">RawQuery</span>&nbsp;<span class="builtintype" id="3320340">string</span>&nbsp;<span class="comment" id="3320347">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320385">Fragment</span>&nbsp;<span class="builtintype" id="3320394">string</span>&nbsp;<span class="comment" id="3320401">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3320441">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3320444">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3320504">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3320528">func</span>&nbsp;<span class="ident" id="3320533">User</span><span class="op" id="3320537">(</span><span class="ident" id="3320538">username</span>&nbsp;<span class="builtintype" id="3320547">string</span><span class="op" id="3320553">)</span>&nbsp;<span class="op" id="3320555">*</span><span class="ident" id="3320556">Userinfo</span>&nbsp;<span class="op" id="3320565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320568">return</span>&nbsp;<span class="op" id="3320575">&amp;</span><span class="ident" id="3320576">Userinfo</span><span class="op" id="3320584">{</span><span class="ident" id="3320585">username</span><span class="op" id="3320593">,</span>&nbsp;<span class="string" id="3320595">&#34;&#34;</span><span class="op" id="3320597">,</span>&nbsp;<span class="builtintype" id="3320599">false</span><span class="op" id="3320604">}</span><br>
<span class="lineno">245</span><span class="op" id="3320606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3320609">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3320677">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3320694">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3320759">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3320813">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3320876">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3320938">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3321002">func</span>&nbsp;<span class="ident" id="3321007">UserPassword</span><span class="op" id="3321019">(</span><span class="ident" id="3321020">username</span><span class="op" id="3321028">,</span>&nbsp;<span class="ident" id="3321030">password</span>&nbsp;<span class="builtintype" id="3321039">string</span><span class="op" id="3321045">)</span>&nbsp;<span class="op" id="3321047">*</span><span class="ident" id="3321048">Userinfo</span>&nbsp;<span class="op" id="3321057">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321060">return</span>&nbsp;<span class="op" id="3321067">&amp;</span><span class="ident" id="3321068">Userinfo</span><span class="op" id="3321076">{</span><span class="ident" id="3321077">username</span><span class="op" id="3321085">,</span>&nbsp;<span class="ident" id="3321087">password</span><span class="op" id="3321095">,</span>&nbsp;<span class="builtintype" id="3321097">true</span><span class="op" id="3321101">}</span><br>
<span class="lineno"></span><span class="op" id="3321103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321106">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3321173">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3321245">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3321316">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3321346">type</span>&nbsp;<span class="ident" id="3321351">Userinfo</span>&nbsp;<span class="keyword" id="3321360">struct</span>&nbsp;<span class="op" id="3321367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321370">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3321382">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321390">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3321402">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321410">passwordSet</span>&nbsp;<span class="builtintype" id="3321422">bool</span><br>
<span class="lineno"></span><span class="op" id="3321427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321430">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3321464">func</span>&nbsp;<span class="op" id="3321469">(</span><span class="ident" id="3321470">u</span>&nbsp;<span class="op" id="3321472">*</span><span class="ident" id="3321473">Userinfo</span><span class="op" id="3321481">)</span>&nbsp;<span class="ident" id="3321483">Username</span><span class="op" id="3321491">(</span><span class="op" id="3321492">)</span>&nbsp;<span class="builtintype" id="3321494">string</span>&nbsp;<span class="op" id="3321501">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321504">return</span>&nbsp;<span class="ident" id="3321511">u</span><span class="op" id="3321512">.</span><span class="ident" id="3321513">username</span><br>
<span class="lineno"></span><span class="op" id="3321522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321525">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3321600">func</span>&nbsp;<span class="op" id="3321605">(</span><span class="ident" id="3321606">u</span>&nbsp;<span class="op" id="3321608">*</span><span class="ident" id="3321609">Userinfo</span><span class="op" id="3321617">)</span>&nbsp;<span class="ident" id="3321619">Password</span><span class="op" id="3321627">(</span><span class="op" id="3321628">)</span>&nbsp;<span class="op" id="3321630">(</span><span class="builtintype" id="3321631">string</span><span class="op" id="3321637">,</span>&nbsp;<span class="builtintype" id="3321639">bool</span><span class="op" id="3321643">)</span>&nbsp;<span class="op" id="3321645">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321648">if</span>&nbsp;<span class="ident" id="3321651">u</span><span class="op" id="3321652">.</span><span class="ident" id="3321653">passwordSet</span>&nbsp;<span class="op" id="3321665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321669">return</span>&nbsp;<span class="ident" id="3321676">u</span><span class="op" id="3321677">.</span><span class="ident" id="3321678">password</span><span class="op" id="3321686">,</span>&nbsp;<span class="builtintype" id="3321688">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321697">return</span>&nbsp;<span class="string" id="3321704">&#34;&#34;</span><span class="op" id="3321706">,</span>&nbsp;<span class="builtintype" id="3321708">false</span><br>
<span class="lineno"></span><span class="op" id="3321714">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3321717">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3321789">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3321818">func</span>&nbsp;<span class="op" id="3321823">(</span><span class="ident" id="3321824">u</span>&nbsp;<span class="op" id="3321826">*</span><span class="ident" id="3321827">Userinfo</span><span class="op" id="3321835">)</span>&nbsp;<span class="ident" id="3321837">String</span><span class="op" id="3321843">(</span><span class="op" id="3321844">)</span>&nbsp;<span class="builtintype" id="3321846">string</span>&nbsp;<span class="op" id="3321853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321856">s</span>&nbsp;<span class="op" id="3321858">:=</span>&nbsp;<span class="ident" id="3321861">escape</span><span class="op" id="3321867">(</span><span class="ident" id="3321868">u</span><span class="op" id="3321869">.</span><span class="ident" id="3321870">username</span><span class="op" id="3321878">,</span>&nbsp;<span class="ident" id="3321880">encodeUserPassword</span><span class="op" id="3321898">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321901">if</span>&nbsp;<span class="ident" id="3321904">u</span><span class="op" id="3321905">.</span><span class="ident" id="3321906">passwordSet</span>&nbsp;<span class="op" id="3321918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321922">s</span>&nbsp;<span class="op" id="3321924">+=</span>&nbsp;<span class="string" id="3321927">&#34;:&#34;</span>&nbsp;<span class="op" id="3321931">+</span>&nbsp;<span class="ident" id="3321933">escape</span><span class="op" id="3321939">(</span><span class="ident" id="3321940">u</span><span class="op" id="3321941">.</span><span class="ident" id="3321942">password</span><span class="op" id="3321950">,</span>&nbsp;<span class="ident" id="3321952">encodeUserPassword</span><span class="op" id="3321970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321976">return</span>&nbsp;<span class="ident" id="3321983">s</span><br>
<span class="lineno"></span><span class="op" id="3321985">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3321988">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3322032">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3322076">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3322131">func</span>&nbsp;<span class="ident" id="3322136">getscheme</span><span class="op" id="3322145">(</span><span class="ident" id="3322146">rawurl</span>&nbsp;<span class="builtintype" id="3322153">string</span><span class="op" id="3322159">)</span>&nbsp;<span class="op" id="3322161">(</span><span class="ident" id="3322162">scheme</span><span class="op" id="3322168">,</span>&nbsp;<span class="ident" id="3322170">path</span>&nbsp;<span class="builtintype" id="3322175">string</span><span class="op" id="3322181">,</span>&nbsp;<span class="ident" id="3322183">err</span>&nbsp;<span class="builtintype" id="3322187">error</span><span class="op" id="3322192">)</span>&nbsp;<span class="op" id="3322194">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322197">for</span>&nbsp;<span class="ident" id="3322201">i</span>&nbsp;<span class="op" id="3322203">:=</span>&nbsp;<span class="num" id="3322206">0</span><span class="op" id="3322207">;</span>&nbsp;<span class="ident" id="3322209">i</span>&nbsp;<span class="op" id="3322211">&lt;</span>&nbsp;<span class="builtinfunc" id="3322213">len</span><span class="op" id="3322216">(</span><span class="ident" id="3322217">rawurl</span><span class="op" id="3322223">)</span><span class="op" id="3322224">;</span>&nbsp;<span class="ident" id="3322226">i</span><span class="op" id="3322227">++</span>&nbsp;<span class="op" id="3322230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322234">c</span>&nbsp;<span class="op" id="3322236">:=</span>&nbsp;<span class="ident" id="3322239">rawurl</span><span class="op" id="3322245">[</span><span class="ident" id="3322246">i</span><span class="op" id="3322247">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322251">switch</span>&nbsp;<span class="op" id="3322258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322262">case</span>&nbsp;<span class="string" id="3322267">&#39;a&#39;</span>&nbsp;<span class="op" id="3322271">&lt;=</span>&nbsp;<span class="ident" id="3322274">c</span>&nbsp;<span class="op" id="3322276">&amp;&amp;</span>&nbsp;<span class="ident" id="3322279">c</span>&nbsp;<span class="op" id="3322281">&lt;=</span>&nbsp;<span class="string" id="3322284">&#39;z&#39;</span>&nbsp;<span class="op" id="3322288">||</span>&nbsp;<span class="string" id="3322291">&#39;A&#39;</span>&nbsp;<span class="op" id="3322295">&lt;=</span>&nbsp;<span class="ident" id="3322298">c</span>&nbsp;<span class="op" id="3322300">&amp;&amp;</span>&nbsp;<span class="ident" id="3322303">c</span>&nbsp;<span class="op" id="3322305">&lt;=</span>&nbsp;<span class="string" id="3322308">&#39;Z&#39;</span><span class="op" id="3322311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322315">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322331">case</span>&nbsp;<span class="string" id="3322336">&#39;0&#39;</span>&nbsp;<span class="op" id="3322340">&lt;=</span>&nbsp;<span class="ident" id="3322343">c</span>&nbsp;<span class="op" id="3322345">&amp;&amp;</span>&nbsp;<span class="ident" id="3322348">c</span>&nbsp;<span class="op" id="3322350">&lt;=</span>&nbsp;<span class="string" id="3322353">&#39;9&#39;</span>&nbsp;<span class="op" id="3322357">||</span>&nbsp;<span class="ident" id="3322360">c</span>&nbsp;<span class="op" id="3322362">==</span>&nbsp;<span class="string" id="3322365">&#39;+&#39;</span>&nbsp;<span class="op" id="3322369">||</span>&nbsp;<span class="ident" id="3322372">c</span>&nbsp;<span class="op" id="3322374">==</span>&nbsp;<span class="string" id="3322377">&#39;-&#39;</span>&nbsp;<span class="op" id="3322381">||</span>&nbsp;<span class="ident" id="3322384">c</span>&nbsp;<span class="op" id="3322386">==</span>&nbsp;<span class="string" id="3322389">&#39;.&#39;</span><span class="op" id="3322392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322397">if</span>&nbsp;<span class="ident" id="3322400">i</span>&nbsp;<span class="op" id="3322402">==</span>&nbsp;<span class="num" id="3322405">0</span>&nbsp;<span class="op" id="3322407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322413">return</span>&nbsp;<span class="string" id="3322420">&#34;&#34;</span><span class="op" id="3322422">,</span>&nbsp;<span class="ident" id="3322424">rawurl</span><span class="op" id="3322430">,</span>&nbsp;<span class="ident" id="3322432">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322443">case</span>&nbsp;<span class="ident" id="3322448">c</span>&nbsp;<span class="op" id="3322450">==</span>&nbsp;<span class="string" id="3322453">&#39;:&#39;</span><span class="op" id="3322456">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322461">if</span>&nbsp;<span class="ident" id="3322464">i</span>&nbsp;<span class="op" id="3322466">==</span>&nbsp;<span class="num" id="3322469">0</span>&nbsp;<span class="op" id="3322471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322477">return</span>&nbsp;<span class="string" id="3322484">&#34;&#34;</span><span class="op" id="3322486">,</span>&nbsp;<span class="string" id="3322488">&#34;&#34;</span><span class="op" id="3322490">,</span>&nbsp;<span class="ident" id="3322492">errors</span><span class="op" id="3322498">.</span><span class="ident" id="3322499">New</span><span class="op" id="3322502">(</span><span class="string" id="3322503">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3322528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322538">return</span>&nbsp;<span class="ident" id="3322545">rawurl</span><span class="op" id="3322551">[</span><span class="num" id="3322552">0</span><span class="op" id="3322553">:</span><span class="ident" id="3322554">i</span><span class="op" id="3322555">]</span><span class="op" id="3322556">,</span>&nbsp;<span class="ident" id="3322558">rawurl</span><span class="op" id="3322564">[</span><span class="ident" id="3322565">i</span><span class="op" id="3322566">+</span><span class="num" id="3322567">1</span><span class="op" id="3322568">:</span><span class="op" id="3322569">]</span><span class="op" id="3322570">,</span>&nbsp;<span class="ident" id="3322572">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322578">default</span><span class="op" id="3322585">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322590">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322638">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322672">return</span>&nbsp;<span class="string" id="3322679">&#34;&#34;</span><span class="op" id="3322681">,</span>&nbsp;<span class="ident" id="3322683">rawurl</span><span class="op" id="3322689">,</span>&nbsp;<span class="ident" id="3322691">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322700">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322703">return</span>&nbsp;<span class="string" id="3322710">&#34;&#34;</span><span class="op" id="3322712">,</span>&nbsp;<span class="ident" id="3322714">rawurl</span><span class="op" id="3322720">,</span>&nbsp;<span class="ident" id="3322722">nil</span><br>
<span class="lineno"></span><span class="op" id="3322726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3322729">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3322762">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3322813">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3322838">func</span>&nbsp;<span class="ident" id="3322843">split</span><span class="op" id="3322848">(</span><span class="ident" id="3322849">s</span>&nbsp;<span class="builtintype" id="3322851">string</span><span class="op" id="3322857">,</span>&nbsp;<span class="ident" id="3322859">c</span>&nbsp;<span class="builtintype" id="3322861">string</span><span class="op" id="3322867">,</span>&nbsp;<span class="ident" id="3322869">cutc</span>&nbsp;<span class="builtintype" id="3322874">bool</span><span class="op" id="3322878">)</span>&nbsp;<span class="op" id="3322880">(</span><span class="builtintype" id="3322881">string</span><span class="op" id="3322887">,</span>&nbsp;<span class="builtintype" id="3322889">string</span><span class="op" id="3322895">)</span>&nbsp;<span class="op" id="3322897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322900">i</span>&nbsp;<span class="op" id="3322902">:=</span>&nbsp;<span class="ident" id="3322905">strings</span><span class="op" id="3322912">.</span><span class="ident" id="3322913">Index</span><span class="op" id="3322918">(</span><span class="ident" id="3322919">s</span><span class="op" id="3322920">,</span>&nbsp;<span class="ident" id="3322922">c</span><span class="op" id="3322923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322926">if</span>&nbsp;<span class="ident" id="3322929">i</span>&nbsp;<span class="op" id="3322931">&lt;</span>&nbsp;<span class="num" id="3322933">0</span>&nbsp;<span class="op" id="3322935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322939">return</span>&nbsp;<span class="ident" id="3322946">s</span><span class="op" id="3322947">,</span>&nbsp;<span class="string" id="3322949">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322956">if</span>&nbsp;<span class="ident" id="3322959">cutc</span>&nbsp;<span class="op" id="3322964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322968">return</span>&nbsp;<span class="ident" id="3322975">s</span><span class="op" id="3322976">[</span><span class="num" id="3322977">0</span><span class="op" id="3322978">:</span><span class="ident" id="3322979">i</span><span class="op" id="3322980">]</span><span class="op" id="3322981">,</span>&nbsp;<span class="ident" id="3322983">s</span><span class="op" id="3322984">[</span><span class="ident" id="3322985">i</span><span class="op" id="3322986">+</span><span class="builtinfunc" id="3322987">len</span><span class="op" id="3322990">(</span><span class="ident" id="3322991">c</span><span class="op" id="3322992">)</span><span class="op" id="3322993">:</span><span class="op" id="3322994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323000">return</span>&nbsp;<span class="ident" id="3323007">s</span><span class="op" id="3323008">[</span><span class="num" id="3323009">0</span><span class="op" id="3323010">:</span><span class="ident" id="3323011">i</span><span class="op" id="3323012">]</span><span class="op" id="3323013">,</span>&nbsp;<span class="ident" id="3323015">s</span><span class="op" id="3323016">[</span><span class="ident" id="3323017">i</span><span class="op" id="3323018">:</span><span class="op" id="3323019">]</span><br>
<span class="lineno">330</span><span class="op" id="3323021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3323024">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3323069">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3323112">func</span>&nbsp;<span class="ident" id="3323117">Parse</span><span class="op" id="3323122">(</span><span class="ident" id="3323123">rawurl</span>&nbsp;<span class="builtintype" id="3323130">string</span><span class="op" id="3323136">)</span>&nbsp;<span class="op" id="3323138">(</span><span class="ident" id="3323139">url</span>&nbsp;<span class="op" id="3323143">*</span><span class="ident" id="3323144">URL</span><span class="op" id="3323147">,</span>&nbsp;<span class="ident" id="3323149">err</span>&nbsp;<span class="builtintype" id="3323153">error</span><span class="op" id="3323158">)</span>&nbsp;<span class="op" id="3323160">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323163">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323181">u</span><span class="op" id="3323182">,</span>&nbsp;<span class="ident" id="3323184">frag</span>&nbsp;<span class="op" id="3323189">:=</span>&nbsp;<span class="ident" id="3323192">split</span><span class="op" id="3323197">(</span><span class="ident" id="3323198">rawurl</span><span class="op" id="3323204">,</span>&nbsp;<span class="string" id="3323206">&#34;#&#34;</span><span class="op" id="3323209">,</span>&nbsp;<span class="builtintype" id="3323211">true</span><span class="op" id="3323215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323218">if</span>&nbsp;<span class="ident" id="3323221">url</span><span class="op" id="3323224">,</span>&nbsp;<span class="ident" id="3323226">err</span>&nbsp;<span class="op" id="3323230">=</span>&nbsp;<span class="ident" id="3323232">parse</span><span class="op" id="3323237">(</span><span class="ident" id="3323238">u</span><span class="op" id="3323239">,</span>&nbsp;<span class="builtintype" id="3323241">false</span><span class="op" id="3323246">)</span><span class="op" id="3323247">;</span>&nbsp;<span class="ident" id="3323249">err</span>&nbsp;<span class="op" id="3323253">!=</span>&nbsp;<span class="ident" id="3323256">nil</span>&nbsp;<span class="op" id="3323260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323264">return</span>&nbsp;<span class="ident" id="3323271">nil</span><span class="op" id="3323274">,</span>&nbsp;<span class="ident" id="3323276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323281">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323284">if</span>&nbsp;<span class="ident" id="3323287">frag</span>&nbsp;<span class="op" id="3323292">==</span>&nbsp;<span class="string" id="3323295">&#34;&#34;</span>&nbsp;<span class="op" id="3323298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323302">return</span>&nbsp;<span class="ident" id="3323309">url</span><span class="op" id="3323312">,</span>&nbsp;<span class="ident" id="3323314">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323322">if</span>&nbsp;<span class="ident" id="3323325">url</span><span class="op" id="3323328">.</span><span class="ident" id="3323329">Fragment</span><span class="op" id="3323337">,</span>&nbsp;<span class="ident" id="3323339">err</span>&nbsp;<span class="op" id="3323343">=</span>&nbsp;<span class="ident" id="3323345">unescape</span><span class="op" id="3323353">(</span><span class="ident" id="3323354">frag</span><span class="op" id="3323358">,</span>&nbsp;<span class="ident" id="3323360">encodeFragment</span><span class="op" id="3323374">)</span><span class="op" id="3323375">;</span>&nbsp;<span class="ident" id="3323377">err</span>&nbsp;<span class="op" id="3323381">!=</span>&nbsp;<span class="ident" id="3323384">nil</span>&nbsp;<span class="op" id="3323388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323392">return</span>&nbsp;<span class="ident" id="3323399">nil</span><span class="op" id="3323402">,</span>&nbsp;<span class="op" id="3323404">&amp;</span><span class="ident" id="3323405">Error</span><span class="op" id="3323410">{</span><span class="string" id="3323411">&#34;parse&#34;</span><span class="op" id="3323418">,</span>&nbsp;<span class="ident" id="3323420">rawurl</span><span class="op" id="3323426">,</span>&nbsp;<span class="ident" id="3323428">err</span><span class="op" id="3323431">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323437">return</span>&nbsp;<span class="ident" id="3323444">url</span><span class="op" id="3323447">,</span>&nbsp;<span class="ident" id="3323449">nil</span><br>
<span class="lineno"></span><span class="op" id="3323453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3323456">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3323528">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3323600">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3323648">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3323712">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3323786">func</span>&nbsp;<span class="ident" id="3323791">ParseRequestURI</span><span class="op" id="3323806">(</span><span class="ident" id="3323807">rawurl</span>&nbsp;<span class="builtintype" id="3323814">string</span><span class="op" id="3323820">)</span>&nbsp;<span class="op" id="3323822">(</span><span class="ident" id="3323823">url</span>&nbsp;<span class="op" id="3323827">*</span><span class="ident" id="3323828">URL</span><span class="op" id="3323831">,</span>&nbsp;<span class="ident" id="3323833">err</span>&nbsp;<span class="builtintype" id="3323837">error</span><span class="op" id="3323842">)</span>&nbsp;<span class="op" id="3323844">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323847">return</span>&nbsp;<span class="ident" id="3323854">parse</span><span class="op" id="3323859">(</span><span class="ident" id="3323860">rawurl</span><span class="op" id="3323866">,</span>&nbsp;<span class="builtintype" id="3323868">true</span><span class="op" id="3323872">)</span><br>
<span class="lineno"></span><span class="op" id="3323874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3323877">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3323941">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3324020">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3324100">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3324167">func</span>&nbsp;<span class="ident" id="3324172">parse</span><span class="op" id="3324177">(</span><span class="ident" id="3324178">rawurl</span>&nbsp;<span class="builtintype" id="3324185">string</span><span class="op" id="3324191">,</span>&nbsp;<span class="ident" id="3324193">viaRequest</span>&nbsp;<span class="builtintype" id="3324204">bool</span><span class="op" id="3324208">)</span>&nbsp;<span class="op" id="3324210">(</span><span class="ident" id="3324211">url</span>&nbsp;<span class="op" id="3324215">*</span><span class="ident" id="3324216">URL</span><span class="op" id="3324219">,</span>&nbsp;<span class="ident" id="3324221">err</span>&nbsp;<span class="builtintype" id="3324225">error</span><span class="op" id="3324230">)</span>&nbsp;<span class="op" id="3324232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324235">var</span>&nbsp;<span class="ident" id="3324239">rest</span>&nbsp;<span class="builtintype" id="3324244">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324253">if</span>&nbsp;<span class="ident" id="3324256">rawurl</span>&nbsp;<span class="op" id="3324263">==</span>&nbsp;<span class="string" id="3324266">&#34;&#34;</span>&nbsp;<span class="op" id="3324269">&amp;&amp;</span>&nbsp;<span class="ident" id="3324272">viaRequest</span>&nbsp;<span class="op" id="3324283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324287">err</span>&nbsp;<span class="op" id="3324291">=</span>&nbsp;<span class="ident" id="3324293">errors</span><span class="op" id="3324299">.</span><span class="ident" id="3324300">New</span><span class="op" id="3324303">(</span><span class="string" id="3324304">&#34;empty&nbsp;url&#34;</span><span class="op" id="3324315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324319">goto</span>&nbsp;<span class="ident" id="3324324">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324334">url</span>&nbsp;<span class="op" id="3324338">=</span>&nbsp;<span class="builtinfunc" id="3324340">new</span><span class="op" id="3324343">(</span><span class="ident" id="3324344">URL</span><span class="op" id="3324347">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324351">if</span>&nbsp;<span class="ident" id="3324354">rawurl</span>&nbsp;<span class="op" id="3324361">==</span>&nbsp;<span class="string" id="3324364">&#34;*&#34;</span>&nbsp;<span class="op" id="3324368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324372">url</span><span class="op" id="3324375">.</span><span class="ident" id="3324376">Path</span>&nbsp;<span class="op" id="3324381">=</span>&nbsp;<span class="string" id="3324383">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324397">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3324401">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3324457">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324496">if</span>&nbsp;<span class="ident" id="3324499">url</span><span class="op" id="3324502">.</span><span class="ident" id="3324503">Scheme</span><span class="op" id="3324509">,</span>&nbsp;<span class="ident" id="3324511">rest</span><span class="op" id="3324515">,</span>&nbsp;<span class="ident" id="3324517">err</span>&nbsp;<span class="op" id="3324521">=</span>&nbsp;<span class="ident" id="3324523">getscheme</span><span class="op" id="3324532">(</span><span class="ident" id="3324533">rawurl</span><span class="op" id="3324539">)</span><span class="op" id="3324540">;</span>&nbsp;<span class="ident" id="3324542">err</span>&nbsp;<span class="op" id="3324546">!=</span>&nbsp;<span class="ident" id="3324549">nil</span>&nbsp;<span class="op" id="3324553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324557">goto</span>&nbsp;<span class="ident" id="3324562">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324572">url</span><span class="op" id="3324575">.</span><span class="ident" id="3324576">Scheme</span>&nbsp;<span class="op" id="3324583">=</span>&nbsp;<span class="ident" id="3324585">strings</span><span class="op" id="3324592">.</span><span class="ident" id="3324593">ToLower</span><span class="op" id="3324600">(</span><span class="ident" id="3324601">url</span><span class="op" id="3324604">.</span><span class="ident" id="3324605">Scheme</span><span class="op" id="3324611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324615">rest</span><span class="op" id="3324619">,</span>&nbsp;<span class="ident" id="3324621">url</span><span class="op" id="3324624">.</span><span class="ident" id="3324625">RawQuery</span>&nbsp;<span class="op" id="3324634">=</span>&nbsp;<span class="ident" id="3324636">split</span><span class="op" id="3324641">(</span><span class="ident" id="3324642">rest</span><span class="op" id="3324646">,</span>&nbsp;<span class="string" id="3324648">&#34;?&#34;</span><span class="op" id="3324651">,</span>&nbsp;<span class="builtintype" id="3324653">true</span><span class="op" id="3324657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324661">if</span>&nbsp;<span class="op" id="3324664">!</span><span class="ident" id="3324665">strings</span><span class="op" id="3324672">.</span><span class="ident" id="3324673">HasPrefix</span><span class="op" id="3324682">(</span><span class="ident" id="3324683">rest</span><span class="op" id="3324687">,</span>&nbsp;<span class="string" id="3324689">&#34;/&#34;</span><span class="op" id="3324692">)</span>&nbsp;<span class="op" id="3324694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324698">if</span>&nbsp;<span class="ident" id="3324701">url</span><span class="op" id="3324704">.</span><span class="ident" id="3324705">Scheme</span>&nbsp;<span class="op" id="3324712">!=</span>&nbsp;<span class="string" id="3324715">&#34;&#34;</span>&nbsp;<span class="op" id="3324718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3324723">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324780">url</span><span class="op" id="3324783">.</span><span class="ident" id="3324784">Opaque</span>&nbsp;<span class="op" id="3324791">=</span>&nbsp;<span class="ident" id="3324793">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324801">return</span>&nbsp;<span class="ident" id="3324808">url</span><span class="op" id="3324811">,</span>&nbsp;<span class="ident" id="3324813">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324823">if</span>&nbsp;<span class="ident" id="3324826">viaRequest</span>&nbsp;<span class="op" id="3324837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324842">err</span>&nbsp;<span class="op" id="3324846">=</span>&nbsp;<span class="ident" id="3324848">errors</span><span class="op" id="3324854">.</span><span class="ident" id="3324855">New</span><span class="op" id="3324858">(</span><span class="string" id="3324859">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3324884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324889">goto</span>&nbsp;<span class="ident" id="3324894">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324902">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324909">if</span>&nbsp;<span class="op" id="3324912">(</span><span class="ident" id="3324913">url</span><span class="op" id="3324916">.</span><span class="ident" id="3324917">Scheme</span>&nbsp;<span class="op" id="3324924">!=</span>&nbsp;<span class="string" id="3324927">&#34;&#34;</span>&nbsp;<span class="op" id="3324930">||</span>&nbsp;<span class="op" id="3324933">!</span><span class="ident" id="3324934">viaRequest</span>&nbsp;<span class="op" id="3324945">&amp;&amp;</span>&nbsp;<span class="op" id="3324948">!</span><span class="ident" id="3324949">strings</span><span class="op" id="3324956">.</span><span class="ident" id="3324957">HasPrefix</span><span class="op" id="3324966">(</span><span class="ident" id="3324967">rest</span><span class="op" id="3324971">,</span>&nbsp;<span class="string" id="3324973">&#34;///&#34;</span><span class="op" id="3324978">)</span><span class="op" id="3324979">)</span>&nbsp;<span class="op" id="3324981">&amp;&amp;</span>&nbsp;<span class="ident" id="3324984">strings</span><span class="op" id="3324991">.</span><span class="ident" id="3324992">HasPrefix</span><span class="op" id="3325001">(</span><span class="ident" id="3325002">rest</span><span class="op" id="3325006">,</span>&nbsp;<span class="string" id="3325008">&#34;//&#34;</span><span class="op" id="3325012">)</span>&nbsp;<span class="op" id="3325014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325018">var</span>&nbsp;<span class="ident" id="3325022">authority</span>&nbsp;<span class="builtintype" id="3325032">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325041">authority</span><span class="op" id="3325050">,</span>&nbsp;<span class="ident" id="3325052">rest</span>&nbsp;<span class="op" id="3325057">=</span>&nbsp;<span class="ident" id="3325059">split</span><span class="op" id="3325064">(</span><span class="ident" id="3325065">rest</span><span class="op" id="3325069">[</span><span class="num" id="3325070">2</span><span class="op" id="3325071">:</span><span class="op" id="3325072">]</span><span class="op" id="3325073">,</span>&nbsp;<span class="string" id="3325075">&#34;/&#34;</span><span class="op" id="3325078">,</span>&nbsp;<span class="builtintype" id="3325080">false</span><span class="op" id="3325085">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325089">url</span><span class="op" id="3325092">.</span><span class="ident" id="3325093">User</span><span class="op" id="3325097">,</span>&nbsp;<span class="ident" id="3325099">url</span><span class="op" id="3325102">.</span><span class="ident" id="3325103">Host</span><span class="op" id="3325107">,</span>&nbsp;<span class="ident" id="3325109">err</span>&nbsp;<span class="op" id="3325113">=</span>&nbsp;<span class="ident" id="3325115">parseAuthority</span><span class="op" id="3325129">(</span><span class="ident" id="3325130">authority</span><span class="op" id="3325139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325143">if</span>&nbsp;<span class="ident" id="3325146">err</span>&nbsp;<span class="op" id="3325150">!=</span>&nbsp;<span class="ident" id="3325153">nil</span>&nbsp;<span class="op" id="3325157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325162">goto</span>&nbsp;<span class="ident" id="3325167">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325179">if</span>&nbsp;<span class="ident" id="3325182">strings</span><span class="op" id="3325189">.</span><span class="ident" id="3325190">Contains</span><span class="op" id="3325198">(</span><span class="ident" id="3325199">url</span><span class="op" id="3325202">.</span><span class="ident" id="3325203">Host</span><span class="op" id="3325207">,</span>&nbsp;<span class="string" id="3325209">&#34;%&#34;</span><span class="op" id="3325212">)</span>&nbsp;<span class="op" id="3325214">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325219">err</span>&nbsp;<span class="op" id="3325223">=</span>&nbsp;<span class="ident" id="3325225">errors</span><span class="op" id="3325231">.</span><span class="ident" id="3325232">New</span><span class="op" id="3325235">(</span><span class="string" id="3325236">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3325264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325269">goto</span>&nbsp;<span class="ident" id="3325274">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325288">if</span>&nbsp;<span class="ident" id="3325291">url</span><span class="op" id="3325294">.</span><span class="ident" id="3325295">Path</span><span class="op" id="3325299">,</span>&nbsp;<span class="ident" id="3325301">err</span>&nbsp;<span class="op" id="3325305">=</span>&nbsp;<span class="ident" id="3325307">unescape</span><span class="op" id="3325315">(</span><span class="ident" id="3325316">rest</span><span class="op" id="3325320">,</span>&nbsp;<span class="ident" id="3325322">encodePath</span><span class="op" id="3325332">)</span><span class="op" id="3325333">;</span>&nbsp;<span class="ident" id="3325335">err</span>&nbsp;<span class="op" id="3325339">!=</span>&nbsp;<span class="ident" id="3325342">nil</span>&nbsp;<span class="op" id="3325346">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325350">goto</span>&nbsp;<span class="ident" id="3325355">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325365">return</span>&nbsp;<span class="ident" id="3325372">url</span><span class="op" id="3325375">,</span>&nbsp;<span class="ident" id="3325377">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3325382">Error</span><span class="op" id="3325387">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325390">return</span>&nbsp;<span class="ident" id="3325397">nil</span><span class="op" id="3325400">,</span>&nbsp;<span class="op" id="3325402">&amp;</span><span class="ident" id="3325403">Error</span><span class="op" id="3325408">{</span><span class="string" id="3325409">&#34;parse&#34;</span><span class="op" id="3325416">,</span>&nbsp;<span class="ident" id="3325418">rawurl</span><span class="op" id="3325424">,</span>&nbsp;<span class="ident" id="3325426">err</span><span class="op" id="3325429">}</span><br>
<span class="lineno"></span><span class="op" id="3325431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3325434">func</span>&nbsp;<span class="ident" id="3325439">parseAuthority</span><span class="op" id="3325453">(</span><span class="ident" id="3325454">authority</span>&nbsp;<span class="builtintype" id="3325464">string</span><span class="op" id="3325470">)</span>&nbsp;<span class="op" id="3325472">(</span><span class="ident" id="3325473">user</span>&nbsp;<span class="op" id="3325478">*</span><span class="ident" id="3325479">Userinfo</span><span class="op" id="3325487">,</span>&nbsp;<span class="ident" id="3325489">host</span>&nbsp;<span class="builtintype" id="3325494">string</span><span class="op" id="3325500">,</span>&nbsp;<span class="ident" id="3325502">err</span>&nbsp;<span class="builtintype" id="3325506">error</span><span class="op" id="3325511">)</span>&nbsp;<span class="op" id="3325513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325516">i</span>&nbsp;<span class="op" id="3325518">:=</span>&nbsp;<span class="ident" id="3325521">strings</span><span class="op" id="3325528">.</span><span class="ident" id="3325529">LastIndex</span><span class="op" id="3325538">(</span><span class="ident" id="3325539">authority</span><span class="op" id="3325548">,</span>&nbsp;<span class="string" id="3325550">&#34;@&#34;</span><span class="op" id="3325553">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325556">if</span>&nbsp;<span class="ident" id="3325559">i</span>&nbsp;<span class="op" id="3325561">&lt;</span>&nbsp;<span class="num" id="3325563">0</span>&nbsp;<span class="op" id="3325565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325569">host</span>&nbsp;<span class="op" id="3325574">=</span>&nbsp;<span class="ident" id="3325576">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325588">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325599">userinfo</span><span class="op" id="3325607">,</span>&nbsp;<span class="ident" id="3325609">host</span>&nbsp;<span class="op" id="3325614">:=</span>&nbsp;<span class="ident" id="3325617">authority</span><span class="op" id="3325626">[</span><span class="op" id="3325627">:</span><span class="ident" id="3325628">i</span><span class="op" id="3325629">]</span><span class="op" id="3325630">,</span>&nbsp;<span class="ident" id="3325632">authority</span><span class="op" id="3325641">[</span><span class="ident" id="3325642">i</span><span class="op" id="3325643">+</span><span class="num" id="3325644">1</span><span class="op" id="3325645">:</span><span class="op" id="3325646">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325649">if</span>&nbsp;<span class="ident" id="3325652">strings</span><span class="op" id="3325659">.</span><span class="ident" id="3325660">Index</span><span class="op" id="3325665">(</span><span class="ident" id="3325666">userinfo</span><span class="op" id="3325674">,</span>&nbsp;<span class="string" id="3325676">&#34;:&#34;</span><span class="op" id="3325679">)</span>&nbsp;<span class="op" id="3325681">&lt;</span>&nbsp;<span class="num" id="3325683">0</span>&nbsp;<span class="op" id="3325685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325689">if</span>&nbsp;<span class="ident" id="3325692">userinfo</span><span class="op" id="3325700">,</span>&nbsp;<span class="ident" id="3325702">err</span>&nbsp;<span class="op" id="3325706">=</span>&nbsp;<span class="ident" id="3325708">unescape</span><span class="op" id="3325716">(</span><span class="ident" id="3325717">userinfo</span><span class="op" id="3325725">,</span>&nbsp;<span class="ident" id="3325727">encodeUserPassword</span><span class="op" id="3325745">)</span><span class="op" id="3325746">;</span>&nbsp;<span class="ident" id="3325748">err</span>&nbsp;<span class="op" id="3325752">!=</span>&nbsp;<span class="ident" id="3325755">nil</span>&nbsp;<span class="op" id="3325759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325777">user</span>&nbsp;<span class="op" id="3325782">=</span>&nbsp;<span class="ident" id="3325784">User</span><span class="op" id="3325788">(</span><span class="ident" id="3325789">userinfo</span><span class="op" id="3325797">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325800">}</span>&nbsp;<span class="keyword" id="3325802">else</span>&nbsp;<span class="op" id="3325807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325811">username</span><span class="op" id="3325819">,</span>&nbsp;<span class="ident" id="3325821">password</span>&nbsp;<span class="op" id="3325830">:=</span>&nbsp;<span class="ident" id="3325833">split</span><span class="op" id="3325838">(</span><span class="ident" id="3325839">userinfo</span><span class="op" id="3325847">,</span>&nbsp;<span class="string" id="3325849">&#34;:&#34;</span><span class="op" id="3325852">,</span>&nbsp;<span class="builtintype" id="3325854">true</span><span class="op" id="3325858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325862">if</span>&nbsp;<span class="ident" id="3325865">username</span><span class="op" id="3325873">,</span>&nbsp;<span class="ident" id="3325875">err</span>&nbsp;<span class="op" id="3325879">=</span>&nbsp;<span class="ident" id="3325881">unescape</span><span class="op" id="3325889">(</span><span class="ident" id="3325890">username</span><span class="op" id="3325898">,</span>&nbsp;<span class="ident" id="3325900">encodeUserPassword</span><span class="op" id="3325918">)</span><span class="op" id="3325919">;</span>&nbsp;<span class="ident" id="3325921">err</span>&nbsp;<span class="op" id="3325925">!=</span>&nbsp;<span class="ident" id="3325928">nil</span>&nbsp;<span class="op" id="3325932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325937">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325946">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325950">if</span>&nbsp;<span class="ident" id="3325953">password</span><span class="op" id="3325961">,</span>&nbsp;<span class="ident" id="3325963">err</span>&nbsp;<span class="op" id="3325967">=</span>&nbsp;<span class="ident" id="3325969">unescape</span><span class="op" id="3325977">(</span><span class="ident" id="3325978">password</span><span class="op" id="3325986">,</span>&nbsp;<span class="ident" id="3325988">encodeUserPassword</span><span class="op" id="3326006">)</span><span class="op" id="3326007">;</span>&nbsp;<span class="ident" id="3326009">err</span>&nbsp;<span class="op" id="3326013">!=</span>&nbsp;<span class="ident" id="3326016">nil</span>&nbsp;<span class="op" id="3326020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326025">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326038">user</span>&nbsp;<span class="op" id="3326043">=</span>&nbsp;<span class="ident" id="3326045">UserPassword</span><span class="op" id="3326057">(</span><span class="ident" id="3326058">username</span><span class="op" id="3326066">,</span>&nbsp;<span class="ident" id="3326068">password</span><span class="op" id="3326076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326079">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326082">return</span><br>
<span class="lineno"></span><span class="op" id="3326089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3326092">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3326147">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3326192">//</span><br>
<span class="lineno"></span><span class="comment" id="3326195">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3326212">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3326258">//</span><br>
<span class="lineno"></span><span class="comment" id="3326261">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3326318">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3326356">//</span><br>
<span class="lineno"></span><span class="comment" id="3326359">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3326409">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3326456">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3326501">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3326544">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3326601">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3326654">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3326710">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3326759">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3326807">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3326858">func</span>&nbsp;<span class="op" id="3326863">(</span><span class="ident" id="3326864">u</span>&nbsp;<span class="op" id="3326866">*</span><span class="ident" id="3326867">URL</span><span class="op" id="3326870">)</span>&nbsp;<span class="ident" id="3326872">String</span><span class="op" id="3326878">(</span><span class="op" id="3326879">)</span>&nbsp;<span class="builtintype" id="3326881">string</span>&nbsp;<span class="op" id="3326888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326891">var</span>&nbsp;<span class="ident" id="3326895">buf</span>&nbsp;<span class="ident" id="3326899">bytes</span><span class="op" id="3326904">.</span><span class="ident" id="3326905">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326913">if</span>&nbsp;<span class="ident" id="3326916">u</span><span class="op" id="3326917">.</span><span class="ident" id="3326918">Scheme</span>&nbsp;<span class="op" id="3326925">!=</span>&nbsp;<span class="string" id="3326928">&#34;&#34;</span>&nbsp;<span class="op" id="3326931">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326935">buf</span><span class="op" id="3326938">.</span><span class="ident" id="3326939">WriteString</span><span class="op" id="3326950">(</span><span class="ident" id="3326951">u</span><span class="op" id="3326952">.</span><span class="ident" id="3326953">Scheme</span><span class="op" id="3326959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326963">buf</span><span class="op" id="3326966">.</span><span class="ident" id="3326967">WriteByte</span><span class="op" id="3326976">(</span><span class="string" id="3326977">&#39;:&#39;</span><span class="op" id="3326980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326986">if</span>&nbsp;<span class="ident" id="3326989">u</span><span class="op" id="3326990">.</span><span class="ident" id="3326991">Opaque</span>&nbsp;<span class="op" id="3326998">!=</span>&nbsp;<span class="string" id="3327001">&#34;&#34;</span>&nbsp;<span class="op" id="3327004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327008">buf</span><span class="op" id="3327011">.</span><span class="ident" id="3327012">WriteString</span><span class="op" id="3327023">(</span><span class="ident" id="3327024">u</span><span class="op" id="3327025">.</span><span class="ident" id="3327026">Opaque</span><span class="op" id="3327032">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327035">}</span>&nbsp;<span class="keyword" id="3327037">else</span>&nbsp;<span class="op" id="3327042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327046">if</span>&nbsp;<span class="ident" id="3327049">u</span><span class="op" id="3327050">.</span><span class="ident" id="3327051">Scheme</span>&nbsp;<span class="op" id="3327058">!=</span>&nbsp;<span class="string" id="3327061">&#34;&#34;</span>&nbsp;<span class="op" id="3327064">||</span>&nbsp;<span class="ident" id="3327067">u</span><span class="op" id="3327068">.</span><span class="ident" id="3327069">Host</span>&nbsp;<span class="op" id="3327074">!=</span>&nbsp;<span class="string" id="3327077">&#34;&#34;</span>&nbsp;<span class="op" id="3327080">||</span>&nbsp;<span class="ident" id="3327083">u</span><span class="op" id="3327084">.</span><span class="ident" id="3327085">User</span>&nbsp;<span class="op" id="3327090">!=</span>&nbsp;<span class="ident" id="3327093">nil</span>&nbsp;<span class="op" id="3327097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327102">buf</span><span class="op" id="3327105">.</span><span class="ident" id="3327106">WriteString</span><span class="op" id="3327117">(</span><span class="string" id="3327118">&#34;//&#34;</span><span class="op" id="3327122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327127">if</span>&nbsp;<span class="ident" id="3327130">ui</span>&nbsp;<span class="op" id="3327133">:=</span>&nbsp;<span class="ident" id="3327136">u</span><span class="op" id="3327137">.</span><span class="ident" id="3327138">User</span><span class="op" id="3327142">;</span>&nbsp;<span class="ident" id="3327144">ui</span>&nbsp;<span class="op" id="3327147">!=</span>&nbsp;<span class="ident" id="3327150">nil</span>&nbsp;<span class="op" id="3327154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327160">buf</span><span class="op" id="3327163">.</span><span class="ident" id="3327164">WriteString</span><span class="op" id="3327175">(</span><span class="ident" id="3327176">ui</span><span class="op" id="3327178">.</span><span class="ident" id="3327179">String</span><span class="op" id="3327185">(</span><span class="op" id="3327186">)</span><span class="op" id="3327187">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327193">buf</span><span class="op" id="3327196">.</span><span class="ident" id="3327197">WriteByte</span><span class="op" id="3327206">(</span><span class="string" id="3327207">&#39;@&#39;</span><span class="op" id="3327210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327220">if</span>&nbsp;<span class="ident" id="3327223">h</span>&nbsp;<span class="op" id="3327225">:=</span>&nbsp;<span class="ident" id="3327228">u</span><span class="op" id="3327229">.</span><span class="ident" id="3327230">Host</span><span class="op" id="3327234">;</span>&nbsp;<span class="ident" id="3327236">h</span>&nbsp;<span class="op" id="3327238">!=</span>&nbsp;<span class="string" id="3327241">&#34;&#34;</span>&nbsp;<span class="op" id="3327244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327250">buf</span><span class="op" id="3327253">.</span><span class="ident" id="3327254">WriteString</span><span class="op" id="3327265">(</span><span class="ident" id="3327266">h</span><span class="op" id="3327267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327272">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327280">if</span>&nbsp;<span class="ident" id="3327283">u</span><span class="op" id="3327284">.</span><span class="ident" id="3327285">Path</span>&nbsp;<span class="op" id="3327290">!=</span>&nbsp;<span class="string" id="3327293">&#34;&#34;</span>&nbsp;<span class="op" id="3327296">&amp;&amp;</span>&nbsp;<span class="ident" id="3327299">u</span><span class="op" id="3327300">.</span><span class="ident" id="3327301">Path</span><span class="op" id="3327305">[</span><span class="num" id="3327306">0</span><span class="op" id="3327307">]</span>&nbsp;<span class="op" id="3327309">!=</span>&nbsp;<span class="string" id="3327312">&#39;/&#39;</span>&nbsp;<span class="op" id="3327316">&amp;&amp;</span>&nbsp;<span class="ident" id="3327319">u</span><span class="op" id="3327320">.</span><span class="ident" id="3327321">Host</span>&nbsp;<span class="op" id="3327326">!=</span>&nbsp;<span class="string" id="3327329">&#34;&#34;</span>&nbsp;<span class="op" id="3327332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327337">buf</span><span class="op" id="3327340">.</span><span class="ident" id="3327341">WriteByte</span><span class="op" id="3327350">(</span><span class="string" id="3327351">&#39;/&#39;</span><span class="op" id="3327354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327362">buf</span><span class="op" id="3327365">.</span><span class="ident" id="3327366">WriteString</span><span class="op" id="3327377">(</span><span class="ident" id="3327378">escape</span><span class="op" id="3327384">(</span><span class="ident" id="3327385">u</span><span class="op" id="3327386">.</span><span class="ident" id="3327387">Path</span><span class="op" id="3327391">,</span>&nbsp;<span class="ident" id="3327393">encodePath</span><span class="op" id="3327403">)</span><span class="op" id="3327404">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327410">if</span>&nbsp;<span class="ident" id="3327413">u</span><span class="op" id="3327414">.</span><span class="ident" id="3327415">RawQuery</span>&nbsp;<span class="op" id="3327424">!=</span>&nbsp;<span class="string" id="3327427">&#34;&#34;</span>&nbsp;<span class="op" id="3327430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327434">buf</span><span class="op" id="3327437">.</span><span class="ident" id="3327438">WriteByte</span><span class="op" id="3327447">(</span><span class="string" id="3327448">&#39;?&#39;</span><span class="op" id="3327451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327455">buf</span><span class="op" id="3327458">.</span><span class="ident" id="3327459">WriteString</span><span class="op" id="3327470">(</span><span class="ident" id="3327471">u</span><span class="op" id="3327472">.</span><span class="ident" id="3327473">RawQuery</span><span class="op" id="3327481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327484">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327487">if</span>&nbsp;<span class="ident" id="3327490">u</span><span class="op" id="3327491">.</span><span class="ident" id="3327492">Fragment</span>&nbsp;<span class="op" id="3327501">!=</span>&nbsp;<span class="string" id="3327504">&#34;&#34;</span>&nbsp;<span class="op" id="3327507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327511">buf</span><span class="op" id="3327514">.</span><span class="ident" id="3327515">WriteByte</span><span class="op" id="3327524">(</span><span class="string" id="3327525">&#39;#&#39;</span><span class="op" id="3327528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327532">buf</span><span class="op" id="3327535">.</span><span class="ident" id="3327536">WriteString</span><span class="op" id="3327547">(</span><span class="ident" id="3327548">escape</span><span class="op" id="3327554">(</span><span class="ident" id="3327555">u</span><span class="op" id="3327556">.</span><span class="ident" id="3327557">Fragment</span><span class="op" id="3327565">,</span>&nbsp;<span class="ident" id="3327567">encodeFragment</span><span class="op" id="3327581">)</span><span class="op" id="3327582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327588">return</span>&nbsp;<span class="ident" id="3327595">buf</span><span class="op" id="3327598">.</span><span class="ident" id="3327599">String</span><span class="op" id="3327605">(</span><span class="op" id="3327606">)</span><br>
<span class="lineno">495</span><span class="op" id="3327608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3327611">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3327660">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3327722">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3327781">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3327804">type</span>&nbsp;<span class="ident" id="3327809">Values</span>&nbsp;<span class="keyword" id="3327816">map</span><span class="op" id="3327819">[</span><span class="builtintype" id="3327820">string</span><span class="op" id="3327826">]</span><span class="op" id="3327827">[</span><span class="op" id="3327828">]</span><span class="builtintype" id="3327829">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3327837">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3327896">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3327959">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3328019">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3328032">func</span>&nbsp;<span class="op" id="3328037">(</span><span class="ident" id="3328038">v</span>&nbsp;<span class="ident" id="3328040">Values</span><span class="op" id="3328046">)</span>&nbsp;<span class="ident" id="3328048">Get</span><span class="op" id="3328051">(</span><span class="ident" id="3328052">key</span>&nbsp;<span class="builtintype" id="3328056">string</span><span class="op" id="3328062">)</span>&nbsp;<span class="builtintype" id="3328064">string</span>&nbsp;<span class="op" id="3328071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328074">if</span>&nbsp;<span class="ident" id="3328077">v</span>&nbsp;<span class="op" id="3328079">==</span>&nbsp;<span class="ident" id="3328082">nil</span>&nbsp;<span class="op" id="3328086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328090">return</span>&nbsp;<span class="string" id="3328097">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3328101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328104">vs</span><span class="op" id="3328106">,</span>&nbsp;<span class="ident" id="3328108">ok</span>&nbsp;<span class="op" id="3328111">:=</span>&nbsp;<span class="ident" id="3328114">v</span><span class="op" id="3328115">[</span><span class="ident" id="3328116">key</span><span class="op" id="3328119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328122">if</span>&nbsp;<span class="op" id="3328125">!</span><span class="ident" id="3328126">ok</span>&nbsp;<span class="op" id="3328129">||</span>&nbsp;<span class="builtinfunc" id="3328132">len</span><span class="op" id="3328135">(</span><span class="ident" id="3328136">vs</span><span class="op" id="3328138">)</span>&nbsp;<span class="op" id="3328140">==</span>&nbsp;<span class="num" id="3328143">0</span>&nbsp;<span class="op" id="3328145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328149">return</span>&nbsp;<span class="string" id="3328156">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3328160">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328163">return</span>&nbsp;<span class="ident" id="3328170">vs</span><span class="op" id="3328172">[</span><span class="num" id="3328173">0</span><span class="op" id="3328174">]</span><br>
<span class="lineno"></span><span class="op" id="3328176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3328179">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3328234">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3328245">func</span>&nbsp;<span class="op" id="3328250">(</span><span class="ident" id="3328251">v</span>&nbsp;<span class="ident" id="3328253">Values</span><span class="op" id="3328259">)</span>&nbsp;<span class="ident" id="3328261">Set</span><span class="op" id="3328264">(</span><span class="ident" id="3328265">key</span><span class="op" id="3328268">,</span>&nbsp;<span class="ident" id="3328270">value</span>&nbsp;<span class="builtintype" id="3328276">string</span><span class="op" id="3328282">)</span>&nbsp;<span class="op" id="3328284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328287">v</span><span class="op" id="3328288">[</span><span class="ident" id="3328289">key</span><span class="op" id="3328292">]</span>&nbsp;<span class="op" id="3328294">=</span>&nbsp;<span class="op" id="3328296">[</span><span class="op" id="3328297">]</span><span class="builtintype" id="3328298">string</span><span class="op" id="3328304">{</span><span class="ident" id="3328305">value</span><span class="op" id="3328310">}</span><br>
<span class="lineno"></span><span class="op" id="3328312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3328315">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3328372">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3328403">func</span>&nbsp;<span class="op" id="3328408">(</span><span class="ident" id="3328409">v</span>&nbsp;<span class="ident" id="3328411">Values</span><span class="op" id="3328417">)</span>&nbsp;<span class="ident" id="3328419">Add</span><span class="op" id="3328422">(</span><span class="ident" id="3328423">key</span><span class="op" id="3328426">,</span>&nbsp;<span class="ident" id="3328428">value</span>&nbsp;<span class="builtintype" id="3328434">string</span><span class="op" id="3328440">)</span>&nbsp;<span class="op" id="3328442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328445">v</span><span class="op" id="3328446">[</span><span class="ident" id="3328447">key</span><span class="op" id="3328450">]</span>&nbsp;<span class="op" id="3328452">=</span>&nbsp;<span class="builtinfunc" id="3328454">append</span><span class="op" id="3328460">(</span><span class="ident" id="3328461">v</span><span class="op" id="3328462">[</span><span class="ident" id="3328463">key</span><span class="op" id="3328466">]</span><span class="op" id="3328467">,</span>&nbsp;<span class="ident" id="3328469">value</span><span class="op" id="3328474">)</span><br>
<span class="lineno"></span><span class="op" id="3328476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3328479">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3328526">func</span>&nbsp;<span class="op" id="3328531">(</span><span class="ident" id="3328532">v</span>&nbsp;<span class="ident" id="3328534">Values</span><span class="op" id="3328540">)</span>&nbsp;<span class="ident" id="3328542">Del</span><span class="op" id="3328545">(</span><span class="ident" id="3328546">key</span>&nbsp;<span class="builtintype" id="3328550">string</span><span class="op" id="3328556">)</span>&nbsp;<span class="op" id="3328558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3328561">delete</span><span class="op" id="3328567">(</span><span class="ident" id="3328568">v</span><span class="op" id="3328569">,</span>&nbsp;<span class="ident" id="3328571">key</span><span class="op" id="3328574">)</span><br>
<span class="lineno"></span><span class="op" id="3328576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3328579">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3328641">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3328693">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3328755">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3328827">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3328851">func</span>&nbsp;<span class="ident" id="3328856">ParseQuery</span><span class="op" id="3328866">(</span><span class="ident" id="3328867">query</span>&nbsp;<span class="builtintype" id="3328873">string</span><span class="op" id="3328879">)</span>&nbsp;<span class="op" id="3328881">(</span><span class="ident" id="3328882">m</span>&nbsp;<span class="ident" id="3328884">Values</span><span class="op" id="3328890">,</span>&nbsp;<span class="ident" id="3328892">err</span>&nbsp;<span class="builtintype" id="3328896">error</span><span class="op" id="3328901">)</span>&nbsp;<span class="op" id="3328903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328906">m</span>&nbsp;<span class="op" id="3328908">=</span>&nbsp;<span class="builtinfunc" id="3328910">make</span><span class="op" id="3328914">(</span><span class="ident" id="3328915">Values</span><span class="op" id="3328921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328924">err</span>&nbsp;<span class="op" id="3328928">=</span>&nbsp;<span class="ident" id="3328930">parseQuery</span><span class="op" id="3328940">(</span><span class="ident" id="3328941">m</span><span class="op" id="3328942">,</span>&nbsp;<span class="ident" id="3328944">query</span><span class="op" id="3328949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328952">return</span><br>
<span class="lineno"></span><span class="op" id="3328959">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3328962">func</span>&nbsp;<span class="ident" id="3328967">parseQuery</span><span class="op" id="3328977">(</span><span class="ident" id="3328978">m</span>&nbsp;<span class="ident" id="3328980">Values</span><span class="op" id="3328986">,</span>&nbsp;<span class="ident" id="3328988">query</span>&nbsp;<span class="builtintype" id="3328994">string</span><span class="op" id="3329000">)</span>&nbsp;<span class="op" id="3329002">(</span><span class="ident" id="3329003">err</span>&nbsp;<span class="builtintype" id="3329007">error</span><span class="op" id="3329012">)</span>&nbsp;<span class="op" id="3329014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329017">for</span>&nbsp;<span class="ident" id="3329021">query</span>&nbsp;<span class="op" id="3329027">!=</span>&nbsp;<span class="string" id="3329030">&#34;&#34;</span>&nbsp;<span class="op" id="3329033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329037">key</span>&nbsp;<span class="op" id="3329041">:=</span>&nbsp;<span class="ident" id="3329044">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329052">if</span>&nbsp;<span class="ident" id="3329055">i</span>&nbsp;<span class="op" id="3329057">:=</span>&nbsp;<span class="ident" id="3329060">strings</span><span class="op" id="3329067">.</span><span class="ident" id="3329068">IndexAny</span><span class="op" id="3329076">(</span><span class="ident" id="3329077">key</span><span class="op" id="3329080">,</span>&nbsp;<span class="string" id="3329082">&#34;&amp;;&#34;</span><span class="op" id="3329086">)</span><span class="op" id="3329087">;</span>&nbsp;<span class="ident" id="3329089">i</span>&nbsp;<span class="op" id="3329091">&gt;=</span>&nbsp;<span class="num" id="3329094">0</span>&nbsp;<span class="op" id="3329096">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329101">key</span><span class="op" id="3329104">,</span>&nbsp;<span class="ident" id="3329106">query</span>&nbsp;<span class="op" id="3329112">=</span>&nbsp;<span class="ident" id="3329114">key</span><span class="op" id="3329117">[</span><span class="op" id="3329118">:</span><span class="ident" id="3329119">i</span><span class="op" id="3329120">]</span><span class="op" id="3329121">,</span>&nbsp;<span class="ident" id="3329123">key</span><span class="op" id="3329126">[</span><span class="ident" id="3329127">i</span><span class="op" id="3329128">+</span><span class="num" id="3329129">1</span><span class="op" id="3329130">:</span><span class="op" id="3329131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329135">}</span>&nbsp;<span class="keyword" id="3329137">else</span>&nbsp;<span class="op" id="3329142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329147">query</span>&nbsp;<span class="op" id="3329153">=</span>&nbsp;<span class="string" id="3329155">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329164">if</span>&nbsp;<span class="ident" id="3329167">key</span>&nbsp;<span class="op" id="3329171">==</span>&nbsp;<span class="string" id="3329174">&#34;&#34;</span>&nbsp;<span class="op" id="3329177">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329182">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329197">value</span>&nbsp;<span class="op" id="3329203">:=</span>&nbsp;<span class="string" id="3329206">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329211">if</span>&nbsp;<span class="ident" id="3329214">i</span>&nbsp;<span class="op" id="3329216">:=</span>&nbsp;<span class="ident" id="3329219">strings</span><span class="op" id="3329226">.</span><span class="ident" id="3329227">Index</span><span class="op" id="3329232">(</span><span class="ident" id="3329233">key</span><span class="op" id="3329236">,</span>&nbsp;<span class="string" id="3329238">&#34;=&#34;</span><span class="op" id="3329241">)</span><span class="op" id="3329242">;</span>&nbsp;<span class="ident" id="3329244">i</span>&nbsp;<span class="op" id="3329246">&gt;=</span>&nbsp;<span class="num" id="3329249">0</span>&nbsp;<span class="op" id="3329251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329256">key</span><span class="op" id="3329259">,</span>&nbsp;<span class="ident" id="3329261">value</span>&nbsp;<span class="op" id="3329267">=</span>&nbsp;<span class="ident" id="3329269">key</span><span class="op" id="3329272">[</span><span class="op" id="3329273">:</span><span class="ident" id="3329274">i</span><span class="op" id="3329275">]</span><span class="op" id="3329276">,</span>&nbsp;<span class="ident" id="3329278">key</span><span class="op" id="3329281">[</span><span class="ident" id="3329282">i</span><span class="op" id="3329283">+</span><span class="num" id="3329284">1</span><span class="op" id="3329285">:</span><span class="op" id="3329286">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329294">key</span><span class="op" id="3329297">,</span>&nbsp;<span class="ident" id="3329299">err1</span>&nbsp;<span class="op" id="3329304">:=</span>&nbsp;<span class="ident" id="3329307">QueryUnescape</span><span class="op" id="3329320">(</span><span class="ident" id="3329321">key</span><span class="op" id="3329324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329328">if</span>&nbsp;<span class="ident" id="3329331">err1</span>&nbsp;<span class="op" id="3329336">!=</span>&nbsp;<span class="ident" id="3329339">nil</span>&nbsp;<span class="op" id="3329343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329348">if</span>&nbsp;<span class="ident" id="3329351">err</span>&nbsp;<span class="op" id="3329355">==</span>&nbsp;<span class="ident" id="3329358">nil</span>&nbsp;<span class="op" id="3329362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329368">err</span>&nbsp;<span class="op" id="3329372">=</span>&nbsp;<span class="ident" id="3329374">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329387">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329402">value</span><span class="op" id="3329407">,</span>&nbsp;<span class="ident" id="3329409">err1</span>&nbsp;<span class="op" id="3329414">=</span>&nbsp;<span class="ident" id="3329416">QueryUnescape</span><span class="op" id="3329429">(</span><span class="ident" id="3329430">value</span><span class="op" id="3329435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329439">if</span>&nbsp;<span class="ident" id="3329442">err1</span>&nbsp;<span class="op" id="3329447">!=</span>&nbsp;<span class="ident" id="3329450">nil</span>&nbsp;<span class="op" id="3329454">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329459">if</span>&nbsp;<span class="ident" id="3329462">err</span>&nbsp;<span class="op" id="3329466">==</span>&nbsp;<span class="ident" id="3329469">nil</span>&nbsp;<span class="op" id="3329473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329479">err</span>&nbsp;<span class="op" id="3329483">=</span>&nbsp;<span class="ident" id="3329485">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329509">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329513">m</span><span class="op" id="3329514">[</span><span class="ident" id="3329515">key</span><span class="op" id="3329518">]</span>&nbsp;<span class="op" id="3329520">=</span>&nbsp;<span class="builtinfunc" id="3329522">append</span><span class="op" id="3329528">(</span><span class="ident" id="3329529">m</span><span class="op" id="3329530">[</span><span class="ident" id="3329531">key</span><span class="op" id="3329534">]</span><span class="op" id="3329535">,</span>&nbsp;<span class="ident" id="3329537">value</span><span class="op" id="3329542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329548">return</span>&nbsp;<span class="ident" id="3329555">err</span><br>
<span class="lineno"></span><span class="op" id="3329559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3329562">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3329617">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3329656">func</span>&nbsp;<span class="op" id="3329661">(</span><span class="ident" id="3329662">v</span>&nbsp;<span class="ident" id="3329664">Values</span><span class="op" id="3329670">)</span>&nbsp;<span class="ident" id="3329672">Encode</span><span class="op" id="3329678">(</span><span class="op" id="3329679">)</span>&nbsp;<span class="builtintype" id="3329681">string</span>&nbsp;<span class="op" id="3329688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329691">if</span>&nbsp;<span class="ident" id="3329694">v</span>&nbsp;<span class="op" id="3329696">==</span>&nbsp;<span class="ident" id="3329699">nil</span>&nbsp;<span class="op" id="3329703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329707">return</span>&nbsp;<span class="string" id="3329714">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329721">var</span>&nbsp;<span class="ident" id="3329725">buf</span>&nbsp;<span class="ident" id="3329729">bytes</span><span class="op" id="3329734">.</span><span class="ident" id="3329735">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329743">keys</span>&nbsp;<span class="op" id="3329748">:=</span>&nbsp;<span class="builtinfunc" id="3329751">make</span><span class="op" id="3329755">(</span><span class="op" id="3329756">[</span><span class="op" id="3329757">]</span><span class="builtintype" id="3329758">string</span><span class="op" id="3329764">,</span>&nbsp;<span class="num" id="3329766">0</span><span class="op" id="3329767">,</span>&nbsp;<span class="builtinfunc" id="3329769">len</span><span class="op" id="3329772">(</span><span class="ident" id="3329773">v</span><span class="op" id="3329774">)</span><span class="op" id="3329775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329778">for</span>&nbsp;<span class="ident" id="3329782">k</span>&nbsp;<span class="op" id="3329784">:=</span>&nbsp;<span class="keyword" id="3329787">range</span>&nbsp;<span class="ident" id="3329793">v</span>&nbsp;<span class="op" id="3329795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329799">keys</span>&nbsp;<span class="op" id="3329804">=</span>&nbsp;<span class="builtinfunc" id="3329806">append</span><span class="op" id="3329812">(</span><span class="ident" id="3329813">keys</span><span class="op" id="3329817">,</span>&nbsp;<span class="ident" id="3329819">k</span><span class="op" id="3329820">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329826">sort</span><span class="op" id="3329830">.</span><span class="ident" id="3329831">Strings</span><span class="op" id="3329838">(</span><span class="ident" id="3329839">keys</span><span class="op" id="3329843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329846">for</span>&nbsp;<span class="ident" id="3329850">_</span><span class="op" id="3329851">,</span>&nbsp;<span class="ident" id="3329853">k</span>&nbsp;<span class="op" id="3329855">:=</span>&nbsp;<span class="keyword" id="3329858">range</span>&nbsp;<span class="ident" id="3329864">keys</span>&nbsp;<span class="op" id="3329869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329873">vs</span>&nbsp;<span class="op" id="3329876">:=</span>&nbsp;<span class="ident" id="3329879">v</span><span class="op" id="3329880">[</span><span class="ident" id="3329881">k</span><span class="op" id="3329882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329886">prefix</span>&nbsp;<span class="op" id="3329893">:=</span>&nbsp;<span class="ident" id="3329896">QueryEscape</span><span class="op" id="3329907">(</span><span class="ident" id="3329908">k</span><span class="op" id="3329909">)</span>&nbsp;<span class="op" id="3329911">+</span>&nbsp;<span class="string" id="3329913">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329919">for</span>&nbsp;<span class="ident" id="3329923">_</span><span class="op" id="3329924">,</span>&nbsp;<span class="ident" id="3329926">v</span>&nbsp;<span class="op" id="3329928">:=</span>&nbsp;<span class="keyword" id="3329931">range</span>&nbsp;<span class="ident" id="3329937">vs</span>&nbsp;<span class="op" id="3329940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329945">if</span>&nbsp;<span class="ident" id="3329948">buf</span><span class="op" id="3329951">.</span><span class="ident" id="3329952">Len</span><span class="op" id="3329955">(</span><span class="op" id="3329956">)</span>&nbsp;<span class="op" id="3329958">&gt;</span>&nbsp;<span class="num" id="3329960">0</span>&nbsp;<span class="op" id="3329962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329968">buf</span><span class="op" id="3329971">.</span><span class="ident" id="3329972">WriteByte</span><span class="op" id="3329981">(</span><span class="string" id="3329982">&#39;&amp;&#39;</span><span class="op" id="3329985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329995">buf</span><span class="op" id="3329998">.</span><span class="ident" id="3329999">WriteString</span><span class="op" id="3330010">(</span><span class="ident" id="3330011">prefix</span><span class="op" id="3330017">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330022">buf</span><span class="op" id="3330025">.</span><span class="ident" id="3330026">WriteString</span><span class="op" id="3330037">(</span><span class="ident" id="3330038">QueryEscape</span><span class="op" id="3330049">(</span><span class="ident" id="3330050">v</span><span class="op" id="3330051">)</span><span class="op" id="3330052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330062">return</span>&nbsp;<span class="ident" id="3330069">buf</span><span class="op" id="3330072">.</span><span class="ident" id="3330073">String</span><span class="op" id="3330079">(</span><span class="op" id="3330080">)</span><br>
<span class="lineno"></span><span class="op" id="3330082">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3330085">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3330152">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3330183">func</span>&nbsp;<span class="ident" id="3330188">resolvePath</span><span class="op" id="3330199">(</span><span class="ident" id="3330200">base</span><span class="op" id="3330204">,</span>&nbsp;<span class="ident" id="3330206">ref</span>&nbsp;<span class="builtintype" id="3330210">string</span><span class="op" id="3330216">)</span>&nbsp;<span class="builtintype" id="3330218">string</span>&nbsp;<span class="op" id="3330225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330228">var</span>&nbsp;<span class="ident" id="3330232">full</span>&nbsp;<span class="builtintype" id="3330237">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330245">if</span>&nbsp;<span class="ident" id="3330248">ref</span>&nbsp;<span class="op" id="3330252">==</span>&nbsp;<span class="string" id="3330255">&#34;&#34;</span>&nbsp;<span class="op" id="3330258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330262">full</span>&nbsp;<span class="op" id="3330267">=</span>&nbsp;<span class="ident" id="3330269">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330275">}</span>&nbsp;<span class="keyword" id="3330277">else</span>&nbsp;<span class="keyword" id="3330282">if</span>&nbsp;<span class="ident" id="3330285">ref</span><span class="op" id="3330288">[</span><span class="num" id="3330289">0</span><span class="op" id="3330290">]</span>&nbsp;<span class="op" id="3330292">!=</span>&nbsp;<span class="string" id="3330295">&#39;/&#39;</span>&nbsp;<span class="op" id="3330299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330303">i</span>&nbsp;<span class="op" id="3330305">:=</span>&nbsp;<span class="ident" id="3330308">strings</span><span class="op" id="3330315">.</span><span class="ident" id="3330316">LastIndex</span><span class="op" id="3330325">(</span><span class="ident" id="3330326">base</span><span class="op" id="3330330">,</span>&nbsp;<span class="string" id="3330332">&#34;/&#34;</span><span class="op" id="3330335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330339">full</span>&nbsp;<span class="op" id="3330344">=</span>&nbsp;<span class="ident" id="3330346">base</span><span class="op" id="3330350">[</span><span class="op" id="3330351">:</span><span class="ident" id="3330352">i</span><span class="op" id="3330353">+</span><span class="num" id="3330354">1</span><span class="op" id="3330355">]</span>&nbsp;<span class="op" id="3330357">+</span>&nbsp;<span class="ident" id="3330359">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330364">}</span>&nbsp;<span class="keyword" id="3330366">else</span>&nbsp;<span class="op" id="3330371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330375">full</span>&nbsp;<span class="op" id="3330380">=</span>&nbsp;<span class="ident" id="3330382">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330390">if</span>&nbsp;<span class="ident" id="3330393">full</span>&nbsp;<span class="op" id="3330398">==</span>&nbsp;<span class="string" id="3330401">&#34;&#34;</span>&nbsp;<span class="op" id="3330404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330408">return</span>&nbsp;<span class="string" id="3330415">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330422">var</span>&nbsp;<span class="ident" id="3330426">dst</span>&nbsp;<span class="op" id="3330430">[</span><span class="op" id="3330431">]</span><span class="builtintype" id="3330432">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330440">src</span>&nbsp;<span class="op" id="3330444">:=</span>&nbsp;<span class="ident" id="3330447">strings</span><span class="op" id="3330454">.</span><span class="ident" id="3330455">Split</span><span class="op" id="3330460">(</span><span class="ident" id="3330461">full</span><span class="op" id="3330465">,</span>&nbsp;<span class="string" id="3330467">&#34;/&#34;</span><span class="op" id="3330470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330473">for</span>&nbsp;<span class="ident" id="3330477">_</span><span class="op" id="3330478">,</span>&nbsp;<span class="ident" id="3330480">elem</span>&nbsp;<span class="op" id="3330485">:=</span>&nbsp;<span class="keyword" id="3330488">range</span>&nbsp;<span class="ident" id="3330494">src</span>&nbsp;<span class="op" id="3330498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330502">switch</span>&nbsp;<span class="ident" id="3330509">elem</span>&nbsp;<span class="op" id="3330514">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330518">case</span>&nbsp;<span class="string" id="3330523">&#34;.&#34;</span><span class="op" id="3330526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3330531">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330541">case</span>&nbsp;<span class="string" id="3330546">&#34;..&#34;</span><span class="op" id="3330550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330555">if</span>&nbsp;<span class="builtinfunc" id="3330558">len</span><span class="op" id="3330561">(</span><span class="ident" id="3330562">dst</span><span class="op" id="3330565">)</span>&nbsp;<span class="op" id="3330567">&gt;</span>&nbsp;<span class="num" id="3330569">0</span>&nbsp;<span class="op" id="3330571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330577">dst</span>&nbsp;<span class="op" id="3330581">=</span>&nbsp;<span class="ident" id="3330583">dst</span><span class="op" id="3330586">[</span><span class="op" id="3330587">:</span><span class="builtinfunc" id="3330588">len</span><span class="op" id="3330591">(</span><span class="ident" id="3330592">dst</span><span class="op" id="3330595">)</span><span class="op" id="3330596">-</span><span class="num" id="3330597">1</span><span class="op" id="3330598">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330607">default</span><span class="op" id="3330614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330619">dst</span>&nbsp;<span class="op" id="3330623">=</span>&nbsp;<span class="builtinfunc" id="3330625">append</span><span class="op" id="3330631">(</span><span class="ident" id="3330632">dst</span><span class="op" id="3330635">,</span>&nbsp;<span class="ident" id="3330637">elem</span><span class="op" id="3330641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330648">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330651">if</span>&nbsp;<span class="ident" id="3330654">last</span>&nbsp;<span class="op" id="3330659">:=</span>&nbsp;<span class="ident" id="3330662">src</span><span class="op" id="3330665">[</span><span class="builtinfunc" id="3330666">len</span><span class="op" id="3330669">(</span><span class="ident" id="3330670">src</span><span class="op" id="3330673">)</span><span class="op" id="3330674">-</span><span class="num" id="3330675">1</span><span class="op" id="3330676">]</span><span class="op" id="3330677">;</span>&nbsp;<span class="ident" id="3330679">last</span>&nbsp;<span class="op" id="3330684">==</span>&nbsp;<span class="string" id="3330687">&#34;.&#34;</span>&nbsp;<span class="op" id="3330691">||</span>&nbsp;<span class="ident" id="3330694">last</span>&nbsp;<span class="op" id="3330699">==</span>&nbsp;<span class="string" id="3330702">&#34;..&#34;</span>&nbsp;<span class="op" id="3330707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3330711">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330752">dst</span>&nbsp;<span class="op" id="3330756">=</span>&nbsp;<span class="builtinfunc" id="3330758">append</span><span class="op" id="3330764">(</span><span class="ident" id="3330765">dst</span><span class="op" id="3330768">,</span>&nbsp;<span class="string" id="3330770">&#34;&#34;</span><span class="op" id="3330772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3330775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330778">return</span>&nbsp;<span class="string" id="3330785">&#34;/&#34;</span>&nbsp;<span class="op" id="3330789">+</span>&nbsp;<span class="ident" id="3330791">strings</span><span class="op" id="3330798">.</span><span class="ident" id="3330799">TrimLeft</span><span class="op" id="3330807">(</span><span class="ident" id="3330808">strings</span><span class="op" id="3330815">.</span><span class="ident" id="3330816">Join</span><span class="op" id="3330820">(</span><span class="ident" id="3330821">dst</span><span class="op" id="3330824">,</span>&nbsp;<span class="string" id="3330826">&#34;/&#34;</span><span class="op" id="3330829">)</span><span class="op" id="3330830">,</span>&nbsp;<span class="string" id="3330832">&#34;/&#34;</span><span class="op" id="3330835">)</span><br>
<span class="lineno">640</span><span class="op" id="3330837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3330840">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3330886">func</span>&nbsp;<span class="op" id="3330891">(</span><span class="ident" id="3330892">u</span>&nbsp;<span class="op" id="3330894">*</span><span class="ident" id="3330895">URL</span><span class="op" id="3330898">)</span>&nbsp;<span class="ident" id="3330900">IsAbs</span><span class="op" id="3330905">(</span><span class="op" id="3330906">)</span>&nbsp;<span class="builtintype" id="3330908">bool</span>&nbsp;<span class="op" id="3330913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330916">return</span>&nbsp;<span class="ident" id="3330923">u</span><span class="op" id="3330924">.</span><span class="ident" id="3330925">Scheme</span>&nbsp;<span class="op" id="3330932">!=</span>&nbsp;<span class="string" id="3330935">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3330938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3330941">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3331013">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3331078">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3331150">func</span>&nbsp;<span class="op" id="3331155">(</span><span class="ident" id="3331156">u</span>&nbsp;<span class="op" id="3331158">*</span><span class="ident" id="3331159">URL</span><span class="op" id="3331162">)</span>&nbsp;<span class="ident" id="3331164">Parse</span><span class="op" id="3331169">(</span><span class="ident" id="3331170">ref</span>&nbsp;<span class="builtintype" id="3331174">string</span><span class="op" id="3331180">)</span>&nbsp;<span class="op" id="3331182">(</span><span class="op" id="3331183">*</span><span class="ident" id="3331184">URL</span><span class="op" id="3331187">,</span>&nbsp;<span class="builtintype" id="3331189">error</span><span class="op" id="3331194">)</span>&nbsp;<span class="op" id="3331196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331199">refurl</span><span class="op" id="3331205">,</span>&nbsp;<span class="ident" id="3331207">err</span>&nbsp;<span class="op" id="3331211">:=</span>&nbsp;<span class="ident" id="3331214">Parse</span><span class="op" id="3331219">(</span><span class="ident" id="3331220">ref</span><span class="op" id="3331223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331226">if</span>&nbsp;<span class="ident" id="3331229">err</span>&nbsp;<span class="op" id="3331233">!=</span>&nbsp;<span class="ident" id="3331236">nil</span>&nbsp;<span class="op" id="3331240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331244">return</span>&nbsp;<span class="ident" id="3331251">nil</span><span class="op" id="3331254">,</span>&nbsp;<span class="ident" id="3331256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331261">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331264">return</span>&nbsp;<span class="ident" id="3331271">u</span><span class="op" id="3331272">.</span><span class="ident" id="3331273">ResolveReference</span><span class="op" id="3331289">(</span><span class="ident" id="3331290">refurl</span><span class="op" id="3331296">)</span><span class="op" id="3331297">,</span>&nbsp;<span class="ident" id="3331299">nil</span><br>
<span class="lineno"></span><span class="op" id="3331303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3331306">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3331375">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3331445">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3331516">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3331585">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3331656">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3331699">func</span>&nbsp;<span class="op" id="3331704">(</span><span class="ident" id="3331705">u</span>&nbsp;<span class="op" id="3331707">*</span><span class="ident" id="3331708">URL</span><span class="op" id="3331711">)</span>&nbsp;<span class="ident" id="3331713">ResolveReference</span><span class="op" id="3331729">(</span><span class="ident" id="3331730">ref</span>&nbsp;<span class="op" id="3331734">*</span><span class="ident" id="3331735">URL</span><span class="op" id="3331738">)</span>&nbsp;<span class="op" id="3331740">*</span><span class="ident" id="3331741">URL</span>&nbsp;<span class="op" id="3331745">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331748">url</span>&nbsp;<span class="op" id="3331752">:=</span>&nbsp;<span class="op" id="3331755">*</span><span class="ident" id="3331756">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331761">if</span>&nbsp;<span class="ident" id="3331764">ref</span><span class="op" id="3331767">.</span><span class="ident" id="3331768">Scheme</span>&nbsp;<span class="op" id="3331775">==</span>&nbsp;<span class="string" id="3331778">&#34;&#34;</span>&nbsp;<span class="op" id="3331781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331785">url</span><span class="op" id="3331788">.</span><span class="ident" id="3331789">Scheme</span>&nbsp;<span class="op" id="3331796">=</span>&nbsp;<span class="ident" id="3331798">u</span><span class="op" id="3331799">.</span><span class="ident" id="3331800">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331811">if</span>&nbsp;<span class="ident" id="3331814">ref</span><span class="op" id="3331817">.</span><span class="ident" id="3331818">Scheme</span>&nbsp;<span class="op" id="3331825">!=</span>&nbsp;<span class="string" id="3331828">&#34;&#34;</span>&nbsp;<span class="op" id="3331831">||</span>&nbsp;<span class="ident" id="3331834">ref</span><span class="op" id="3331837">.</span><span class="ident" id="3331838">Host</span>&nbsp;<span class="op" id="3331843">!=</span>&nbsp;<span class="string" id="3331846">&#34;&#34;</span>&nbsp;<span class="op" id="3331849">||</span>&nbsp;<span class="ident" id="3331852">ref</span><span class="op" id="3331855">.</span><span class="ident" id="3331856">User</span>&nbsp;<span class="op" id="3331861">!=</span>&nbsp;<span class="ident" id="3331864">nil</span>&nbsp;<span class="op" id="3331868">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3331872">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331916">url</span><span class="op" id="3331919">.</span><span class="ident" id="3331920">Path</span>&nbsp;<span class="op" id="3331925">=</span>&nbsp;<span class="ident" id="3331927">resolvePath</span><span class="op" id="3331938">(</span><span class="ident" id="3331939">ref</span><span class="op" id="3331942">.</span><span class="ident" id="3331943">Path</span><span class="op" id="3331947">,</span>&nbsp;<span class="string" id="3331949">&#34;&#34;</span><span class="op" id="3331951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331955">return</span>&nbsp;<span class="op" id="3331962">&amp;</span><span class="ident" id="3331963">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331971">if</span>&nbsp;<span class="ident" id="3331974">ref</span><span class="op" id="3331977">.</span><span class="ident" id="3331978">Opaque</span>&nbsp;<span class="op" id="3331985">!=</span>&nbsp;<span class="string" id="3331988">&#34;&#34;</span>&nbsp;<span class="op" id="3331991">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331995">url</span><span class="op" id="3331998">.</span><span class="ident" id="3331999">User</span>&nbsp;<span class="op" id="3332004">=</span>&nbsp;<span class="ident" id="3332006">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332012">url</span><span class="op" id="3332015">.</span><span class="ident" id="3332016">Host</span>&nbsp;<span class="op" id="3332021">=</span>&nbsp;<span class="string" id="3332023">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332028">url</span><span class="op" id="3332031">.</span><span class="ident" id="3332032">Path</span>&nbsp;<span class="op" id="3332037">=</span>&nbsp;<span class="string" id="3332039">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332044">return</span>&nbsp;<span class="op" id="3332051">&amp;</span><span class="ident" id="3332052">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332057">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332060">if</span>&nbsp;<span class="ident" id="3332063">ref</span><span class="op" id="3332066">.</span><span class="ident" id="3332067">Path</span>&nbsp;<span class="op" id="3332072">==</span>&nbsp;<span class="string" id="3332075">&#34;&#34;</span>&nbsp;<span class="op" id="3332078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332082">if</span>&nbsp;<span class="ident" id="3332085">ref</span><span class="op" id="3332088">.</span><span class="ident" id="3332089">RawQuery</span>&nbsp;<span class="op" id="3332098">==</span>&nbsp;<span class="string" id="3332101">&#34;&#34;</span>&nbsp;<span class="op" id="3332104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332109">url</span><span class="op" id="3332112">.</span><span class="ident" id="3332113">RawQuery</span>&nbsp;<span class="op" id="3332122">=</span>&nbsp;<span class="ident" id="3332124">u</span><span class="op" id="3332125">.</span><span class="ident" id="3332126">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332138">if</span>&nbsp;<span class="ident" id="3332141">ref</span><span class="op" id="3332144">.</span><span class="ident" id="3332145">Fragment</span>&nbsp;<span class="op" id="3332154">==</span>&nbsp;<span class="string" id="3332157">&#34;&#34;</span>&nbsp;<span class="op" id="3332160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332166">url</span><span class="op" id="3332169">.</span><span class="ident" id="3332170">Fragment</span>&nbsp;<span class="op" id="3332179">=</span>&nbsp;<span class="ident" id="3332181">u</span><span class="op" id="3332182">.</span><span class="ident" id="3332183">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3332205">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332245">url</span><span class="op" id="3332248">.</span><span class="ident" id="3332249">Host</span>&nbsp;<span class="op" id="3332254">=</span>&nbsp;<span class="ident" id="3332256">u</span><span class="op" id="3332257">.</span><span class="ident" id="3332258">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332264">url</span><span class="op" id="3332267">.</span><span class="ident" id="3332268">User</span>&nbsp;<span class="op" id="3332273">=</span>&nbsp;<span class="ident" id="3332275">u</span><span class="op" id="3332276">.</span><span class="ident" id="3332277">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332283">url</span><span class="op" id="3332286">.</span><span class="ident" id="3332287">Path</span>&nbsp;<span class="op" id="3332292">=</span>&nbsp;<span class="ident" id="3332294">resolvePath</span><span class="op" id="3332305">(</span><span class="ident" id="3332306">u</span><span class="op" id="3332307">.</span><span class="ident" id="3332308">Path</span><span class="op" id="3332312">,</span>&nbsp;<span class="ident" id="3332314">ref</span><span class="op" id="3332317">.</span><span class="ident" id="3332318">Path</span><span class="op" id="3332322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332325">return</span>&nbsp;<span class="op" id="3332332">&amp;</span><span class="ident" id="3332333">url</span><br>
<span class="lineno"></span><span class="op" id="3332337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3332340">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3332403">func</span>&nbsp;<span class="op" id="3332408">(</span><span class="ident" id="3332409">u</span>&nbsp;<span class="op" id="3332411">*</span><span class="ident" id="3332412">URL</span><span class="op" id="3332415">)</span>&nbsp;<span class="ident" id="3332417">Query</span><span class="op" id="3332422">(</span><span class="op" id="3332423">)</span>&nbsp;<span class="ident" id="3332425">Values</span>&nbsp;<span class="op" id="3332432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332435">v</span><span class="op" id="3332436">,</span>&nbsp;<span class="ident" id="3332438">_</span>&nbsp;<span class="op" id="3332440">:=</span>&nbsp;<span class="ident" id="3332443">ParseQuery</span><span class="op" id="3332453">(</span><span class="ident" id="3332454">u</span><span class="op" id="3332455">.</span><span class="ident" id="3332456">RawQuery</span><span class="op" id="3332464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332467">return</span>&nbsp;<span class="ident" id="3332474">v</span><br>
<span class="lineno"></span><span class="op" id="3332476">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3332479">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3332540">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3332595">func</span>&nbsp;<span class="op" id="3332600">(</span><span class="ident" id="3332601">u</span>&nbsp;<span class="op" id="3332603">*</span><span class="ident" id="3332604">URL</span><span class="op" id="3332607">)</span>&nbsp;<span class="ident" id="3332609">RequestURI</span><span class="op" id="3332619">(</span><span class="op" id="3332620">)</span>&nbsp;<span class="builtintype" id="3332622">string</span>&nbsp;<span class="op" id="3332629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332632">result</span>&nbsp;<span class="op" id="3332639">:=</span>&nbsp;<span class="ident" id="3332642">u</span><span class="op" id="3332643">.</span><span class="ident" id="3332644">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332652">if</span>&nbsp;<span class="ident" id="3332655">result</span>&nbsp;<span class="op" id="3332662">==</span>&nbsp;<span class="string" id="3332665">&#34;&#34;</span>&nbsp;<span class="op" id="3332668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332672">result</span>&nbsp;<span class="op" id="3332679">=</span>&nbsp;<span class="ident" id="3332681">escape</span><span class="op" id="3332687">(</span><span class="ident" id="3332688">u</span><span class="op" id="3332689">.</span><span class="ident" id="3332690">Path</span><span class="op" id="3332694">,</span>&nbsp;<span class="ident" id="3332696">encodePath</span><span class="op" id="3332706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332710">if</span>&nbsp;<span class="ident" id="3332713">result</span>&nbsp;<span class="op" id="3332720">==</span>&nbsp;<span class="string" id="3332723">&#34;&#34;</span>&nbsp;<span class="op" id="3332726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332731">result</span>&nbsp;<span class="op" id="3332738">=</span>&nbsp;<span class="string" id="3332740">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332746">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332749">}</span>&nbsp;<span class="keyword" id="3332751">else</span>&nbsp;<span class="op" id="3332756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332760">if</span>&nbsp;<span class="ident" id="3332763">strings</span><span class="op" id="3332770">.</span><span class="ident" id="3332771">HasPrefix</span><span class="op" id="3332780">(</span><span class="ident" id="3332781">result</span><span class="op" id="3332787">,</span>&nbsp;<span class="string" id="3332789">&#34;//&#34;</span><span class="op" id="3332793">)</span>&nbsp;<span class="op" id="3332795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332800">result</span>&nbsp;<span class="op" id="3332807">=</span>&nbsp;<span class="ident" id="3332809">u</span><span class="op" id="3332810">.</span><span class="ident" id="3332811">Scheme</span>&nbsp;<span class="op" id="3332818">+</span>&nbsp;<span class="string" id="3332820">&#34;:&#34;</span>&nbsp;<span class="op" id="3332824">+</span>&nbsp;<span class="ident" id="3332826">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332838">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332841">if</span>&nbsp;<span class="ident" id="3332844">u</span><span class="op" id="3332845">.</span><span class="ident" id="3332846">RawQuery</span>&nbsp;<span class="op" id="3332855">!=</span>&nbsp;<span class="string" id="3332858">&#34;&#34;</span>&nbsp;<span class="op" id="3332861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332865">result</span>&nbsp;<span class="op" id="3332872">+=</span>&nbsp;<span class="string" id="3332875">&#34;?&#34;</span>&nbsp;<span class="op" id="3332879">+</span>&nbsp;<span class="ident" id="3332881">u</span><span class="op" id="3332882">.</span><span class="ident" id="3332883">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332896">return</span>&nbsp;<span class="ident" id="3332903">result</span><br>
<span class="lineno"></span><span class="op" id="3332910">}</span>
</div>
</body>
</html>
