<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync</h2>
<ul>
<li><a href="/gostd/sync/cond.go.html">cond.go</a></li>
<li><a href="/gostd/sync/cond_test.go.html">cond_test.go</a></li>
<li><a href="/gostd/sync/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/sync/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/sync/mutex.go.html">mutex.go</a></li>
<li><a href="/gostd/sync/mutex_test.go.html">mutex_test.go</a></li>
<li><a href="/gostd/sync/once.go.html">once.go</a></li>
<li><a href="/gostd/sync/once_test.go.html">once_test.go</a></li>
<li><a href="/gostd/sync/pool.go.html">pool.go</a></li>
<li><a href="/gostd/sync/pool_test.go.html">pool_test.go</a></li>
<li><a href="/gostd/sync/race0.go.html">race0.go</a></li>
<li><a href="/gostd/sync/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/sync/runtime_sema_test.go.html">runtime_sema_test.go</a></li>
<li><a href="/gostd/sync/rwmutex.go.html">rwmutex.go</a></li>
<li><a href="/gostd/sync/rwmutex_test.go.html">rwmutex_test.go</a></li>
<li><a href="/gostd/sync/waitgroup.go.html">waitgroup.go</a></li>
<li><a href="/gostd/sync/waitgroup_test.go.html">waitgroup_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1130195">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1130250">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1130304">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1130355">//&nbsp;Pool&nbsp;is&nbsp;no-op&nbsp;under&nbsp;race&nbsp;detector,&nbsp;so&nbsp;all&nbsp;these&nbsp;tests&nbsp;do&nbsp;not&nbsp;work.</span><br>
<span class="lineno"></span><span class="comment" id="1130425">//&nbsp;+build&nbsp;!race</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1130442">package</span>&nbsp;<span class="ident" id="1130450">sync_test</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1130461">import</span>&nbsp;<span class="op" id="1130468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1130471">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1130482">&#34;runtime/debug&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1130499">.</span>&nbsp;<span class="string" id="1130501">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1130509">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1130524">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1130535">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="1130542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1130545">func</span>&nbsp;<span class="ident" id="1130550">TestPool</span><span class="op" id="1130558">(</span><span class="ident" id="1130559">t</span>&nbsp;<span class="op" id="1130561">*</span><span class="ident" id="1130562">testing</span><span class="op" id="1130569">.</span><span class="ident" id="1130570">T</span><span class="op" id="1130571">)</span>&nbsp;<span class="op" id="1130573">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1130576">//&nbsp;disable&nbsp;GC&nbsp;so&nbsp;we&nbsp;can&nbsp;control&nbsp;when&nbsp;it&nbsp;happens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1130626">defer</span>&nbsp;<span class="ident" id="1130632">debug</span><span class="op" id="1130637">.</span><span class="ident" id="1130638">SetGCPercent</span><span class="op" id="1130650">(</span><span class="ident" id="1130651">debug</span><span class="op" id="1130656">.</span><span class="ident" id="1130657">SetGCPercent</span><span class="op" id="1130669">(</span><span class="op" id="1130670">-</span><span class="num" id="1130671">1</span><span class="op" id="1130672">)</span><span class="op" id="1130673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1130676">var</span>&nbsp;<span class="ident" id="1130680">p</span>&nbsp;<span class="ident" id="1130682">Pool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1130688">if</span>&nbsp;<span class="ident" id="1130691">p</span><span class="op" id="1130692">.</span><span class="ident" id="1130693">Get</span><span class="op" id="1130696">(</span><span class="op" id="1130697">)</span>&nbsp;<span class="op" id="1130699">!=</span>&nbsp;<span class="ident" id="1130702">nil</span>&nbsp;<span class="op" id="1130706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130710">t</span><span class="op" id="1130711">.</span><span class="ident" id="1130712">Fatal</span><span class="op" id="1130717">(</span><span class="string" id="1130718">&#34;expected&nbsp;empty&#34;</span><span class="op" id="1130734">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1130737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130740">p</span><span class="op" id="1130741">.</span><span class="ident" id="1130742">Put</span><span class="op" id="1130745">(</span><span class="string" id="1130746">&#34;a&#34;</span><span class="op" id="1130749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130752">p</span><span class="op" id="1130753">.</span><span class="ident" id="1130754">Put</span><span class="op" id="1130757">(</span><span class="string" id="1130758">&#34;b&#34;</span><span class="op" id="1130761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1130764">if</span>&nbsp;<span class="ident" id="1130767">g</span>&nbsp;<span class="op" id="1130769">:=</span>&nbsp;<span class="ident" id="1130772">p</span><span class="op" id="1130773">.</span><span class="ident" id="1130774">Get</span><span class="op" id="1130777">(</span><span class="op" id="1130778">)</span><span class="op" id="1130779">;</span>&nbsp;<span class="ident" id="1130781">g</span>&nbsp;<span class="op" id="1130783">!=</span>&nbsp;<span class="string" id="1130786">&#34;a&#34;</span>&nbsp;<span class="op" id="1130790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130794">t</span><span class="op" id="1130795">.</span><span class="ident" id="1130796">Fatalf</span><span class="op" id="1130802">(</span><span class="string" id="1130803">&#34;got&nbsp;%#v;&nbsp;want&nbsp;a&#34;</span><span class="op" id="1130820">,</span>&nbsp;<span class="ident" id="1130822">g</span><span class="op" id="1130823">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1130826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1130829">if</span>&nbsp;<span class="ident" id="1130832">g</span>&nbsp;<span class="op" id="1130834">:=</span>&nbsp;<span class="ident" id="1130837">p</span><span class="op" id="1130838">.</span><span class="ident" id="1130839">Get</span><span class="op" id="1130842">(</span><span class="op" id="1130843">)</span><span class="op" id="1130844">;</span>&nbsp;<span class="ident" id="1130846">g</span>&nbsp;<span class="op" id="1130848">!=</span>&nbsp;<span class="string" id="1130851">&#34;b&#34;</span>&nbsp;<span class="op" id="1130855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130859">t</span><span class="op" id="1130860">.</span><span class="ident" id="1130861">Fatalf</span><span class="op" id="1130867">(</span><span class="string" id="1130868">&#34;got&nbsp;%#v;&nbsp;want&nbsp;b&#34;</span><span class="op" id="1130885">,</span>&nbsp;<span class="ident" id="1130887">g</span><span class="op" id="1130888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1130891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1130894">if</span>&nbsp;<span class="ident" id="1130897">g</span>&nbsp;<span class="op" id="1130899">:=</span>&nbsp;<span class="ident" id="1130902">p</span><span class="op" id="1130903">.</span><span class="ident" id="1130904">Get</span><span class="op" id="1130907">(</span><span class="op" id="1130908">)</span><span class="op" id="1130909">;</span>&nbsp;<span class="ident" id="1130911">g</span>&nbsp;<span class="op" id="1130913">!=</span>&nbsp;<span class="ident" id="1130916">nil</span>&nbsp;<span class="op" id="1130920">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130924">t</span><span class="op" id="1130925">.</span><span class="ident" id="1130926">Fatalf</span><span class="op" id="1130932">(</span><span class="string" id="1130933">&#34;got&nbsp;%#v;&nbsp;want&nbsp;nil&#34;</span><span class="op" id="1130952">,</span>&nbsp;<span class="ident" id="1130954">g</span><span class="op" id="1130955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1130958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130962">p</span><span class="op" id="1130963">.</span><span class="ident" id="1130964">Put</span><span class="op" id="1130967">(</span><span class="string" id="1130968">&#34;c&#34;</span><span class="op" id="1130971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1130974">debug</span><span class="op" id="1130979">.</span><span class="ident" id="1130980">SetGCPercent</span><span class="op" id="1130992">(</span><span class="num" id="1130993">100</span><span class="op" id="1130996">)</span>&nbsp;<span class="comment" id="1130998">//&nbsp;to&nbsp;allow&nbsp;following&nbsp;GC&nbsp;to&nbsp;actually&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131040">runtime</span><span class="op" id="1131047">.</span><span class="ident" id="1131048">GC</span><span class="op" id="1131050">(</span><span class="op" id="1131051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131054">if</span>&nbsp;<span class="ident" id="1131057">g</span>&nbsp;<span class="op" id="1131059">:=</span>&nbsp;<span class="ident" id="1131062">p</span><span class="op" id="1131063">.</span><span class="ident" id="1131064">Get</span><span class="op" id="1131067">(</span><span class="op" id="1131068">)</span><span class="op" id="1131069">;</span>&nbsp;<span class="ident" id="1131071">g</span>&nbsp;<span class="op" id="1131073">!=</span>&nbsp;<span class="ident" id="1131076">nil</span>&nbsp;<span class="op" id="1131080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131084">t</span><span class="op" id="1131085">.</span><span class="ident" id="1131086">Fatalf</span><span class="op" id="1131092">(</span><span class="string" id="1131093">&#34;got&nbsp;%#v;&nbsp;want&nbsp;nil&nbsp;after&nbsp;GC&#34;</span><span class="op" id="1131121">,</span>&nbsp;<span class="ident" id="1131123">g</span><span class="op" id="1131124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131127">}</span><br>
<span class="lineno"></span><span class="op" id="1131129">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="1131132">func</span>&nbsp;<span class="ident" id="1131137">TestPoolNew</span><span class="op" id="1131148">(</span><span class="ident" id="1131149">t</span>&nbsp;<span class="op" id="1131151">*</span><span class="ident" id="1131152">testing</span><span class="op" id="1131159">.</span><span class="ident" id="1131160">T</span><span class="op" id="1131161">)</span>&nbsp;<span class="op" id="1131163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1131166">//&nbsp;disable&nbsp;GC&nbsp;so&nbsp;we&nbsp;can&nbsp;control&nbsp;when&nbsp;it&nbsp;happens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131216">defer</span>&nbsp;<span class="ident" id="1131222">debug</span><span class="op" id="1131227">.</span><span class="ident" id="1131228">SetGCPercent</span><span class="op" id="1131240">(</span><span class="ident" id="1131241">debug</span><span class="op" id="1131246">.</span><span class="ident" id="1131247">SetGCPercent</span><span class="op" id="1131259">(</span><span class="op" id="1131260">-</span><span class="num" id="1131261">1</span><span class="op" id="1131262">)</span><span class="op" id="1131263">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131267">i</span>&nbsp;<span class="op" id="1131269">:=</span>&nbsp;<span class="num" id="1131272">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131275">p</span>&nbsp;<span class="op" id="1131277">:=</span>&nbsp;<span class="ident" id="1131280">Pool</span><span class="op" id="1131284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131288">New</span><span class="op" id="1131291">:</span>&nbsp;<span class="keyword" id="1131293">func</span><span class="op" id="1131297">(</span><span class="op" id="1131298">)</span>&nbsp;<span class="keyword" id="1131300">interface</span><span class="op" id="1131309">{</span><span class="op" id="1131310">}</span>&nbsp;<span class="op" id="1131312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131317">i</span><span class="op" id="1131318">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131324">return</span>&nbsp;<span class="ident" id="1131331">i</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131335">}</span><span class="op" id="1131336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131342">if</span>&nbsp;<span class="ident" id="1131345">v</span>&nbsp;<span class="op" id="1131347">:=</span>&nbsp;<span class="ident" id="1131350">p</span><span class="op" id="1131351">.</span><span class="ident" id="1131352">Get</span><span class="op" id="1131355">(</span><span class="op" id="1131356">)</span><span class="op" id="1131357">;</span>&nbsp;<span class="ident" id="1131359">v</span>&nbsp;<span class="op" id="1131361">!=</span>&nbsp;<span class="num" id="1131364">1</span>&nbsp;<span class="op" id="1131366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131370">t</span><span class="op" id="1131371">.</span><span class="ident" id="1131372">Fatalf</span><span class="op" id="1131378">(</span><span class="string" id="1131379">&#34;got&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="1131395">,</span>&nbsp;<span class="ident" id="1131397">v</span><span class="op" id="1131398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131401">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131404">if</span>&nbsp;<span class="ident" id="1131407">v</span>&nbsp;<span class="op" id="1131409">:=</span>&nbsp;<span class="ident" id="1131412">p</span><span class="op" id="1131413">.</span><span class="ident" id="1131414">Get</span><span class="op" id="1131417">(</span><span class="op" id="1131418">)</span><span class="op" id="1131419">;</span>&nbsp;<span class="ident" id="1131421">v</span>&nbsp;<span class="op" id="1131423">!=</span>&nbsp;<span class="num" id="1131426">2</span>&nbsp;<span class="op" id="1131428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131432">t</span><span class="op" id="1131433">.</span><span class="ident" id="1131434">Fatalf</span><span class="op" id="1131440">(</span><span class="string" id="1131441">&#34;got&nbsp;%v;&nbsp;want&nbsp;2&#34;</span><span class="op" id="1131457">,</span>&nbsp;<span class="ident" id="1131459">v</span><span class="op" id="1131460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131466">p</span><span class="op" id="1131467">.</span><span class="ident" id="1131468">Put</span><span class="op" id="1131471">(</span><span class="num" id="1131472">42</span><span class="op" id="1131474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131477">if</span>&nbsp;<span class="ident" id="1131480">v</span>&nbsp;<span class="op" id="1131482">:=</span>&nbsp;<span class="ident" id="1131485">p</span><span class="op" id="1131486">.</span><span class="ident" id="1131487">Get</span><span class="op" id="1131490">(</span><span class="op" id="1131491">)</span><span class="op" id="1131492">;</span>&nbsp;<span class="ident" id="1131494">v</span>&nbsp;<span class="op" id="1131496">!=</span>&nbsp;<span class="num" id="1131499">42</span>&nbsp;<span class="op" id="1131502">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131506">t</span><span class="op" id="1131507">.</span><span class="ident" id="1131508">Fatalf</span><span class="op" id="1131514">(</span><span class="string" id="1131515">&#34;got&nbsp;%v;&nbsp;want&nbsp;42&#34;</span><span class="op" id="1131532">,</span>&nbsp;<span class="ident" id="1131534">v</span><span class="op" id="1131535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131541">if</span>&nbsp;<span class="ident" id="1131544">v</span>&nbsp;<span class="op" id="1131546">:=</span>&nbsp;<span class="ident" id="1131549">p</span><span class="op" id="1131550">.</span><span class="ident" id="1131551">Get</span><span class="op" id="1131554">(</span><span class="op" id="1131555">)</span><span class="op" id="1131556">;</span>&nbsp;<span class="ident" id="1131558">v</span>&nbsp;<span class="op" id="1131560">!=</span>&nbsp;<span class="num" id="1131563">3</span>&nbsp;<span class="op" id="1131565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131569">t</span><span class="op" id="1131570">.</span><span class="ident" id="1131571">Fatalf</span><span class="op" id="1131577">(</span><span class="string" id="1131578">&#34;got&nbsp;%v;&nbsp;want&nbsp;3&#34;</span><span class="op" id="1131594">,</span>&nbsp;<span class="ident" id="1131596">v</span><span class="op" id="1131597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1131600">}</span><br>
<span class="lineno">70</span><span class="op" id="1131602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1131605">//&nbsp;Test&nbsp;that&nbsp;Pool&nbsp;does&nbsp;not&nbsp;hold&nbsp;pointers&nbsp;to&nbsp;previously&nbsp;cached&nbsp;resources.</span><br>
<span class="lineno"></span><span class="keyword" id="1131678">func</span>&nbsp;<span class="ident" id="1131683">TestPoolGC</span><span class="op" id="1131693">(</span><span class="ident" id="1131694">t</span>&nbsp;<span class="op" id="1131696">*</span><span class="ident" id="1131697">testing</span><span class="op" id="1131704">.</span><span class="ident" id="1131705">T</span><span class="op" id="1131706">)</span>&nbsp;<span class="op" id="1131708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131711">testPool</span><span class="op" id="1131719">(</span><span class="ident" id="1131720">t</span><span class="op" id="1131721">,</span>&nbsp;<span class="builtintype" id="1131723">true</span><span class="op" id="1131727">)</span><br>
<span class="lineno">75</span><span class="op" id="1131729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1131732">//&nbsp;Test&nbsp;that&nbsp;Pool&nbsp;releases&nbsp;resources&nbsp;on&nbsp;GC.</span><br>
<span class="lineno"></span><span class="keyword" id="1131776">func</span>&nbsp;<span class="ident" id="1131781">TestPoolRelease</span><span class="op" id="1131796">(</span><span class="ident" id="1131797">t</span>&nbsp;<span class="op" id="1131799">*</span><span class="ident" id="1131800">testing</span><span class="op" id="1131807">.</span><span class="ident" id="1131808">T</span><span class="op" id="1131809">)</span>&nbsp;<span class="op" id="1131811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131814">testPool</span><span class="op" id="1131822">(</span><span class="ident" id="1131823">t</span><span class="op" id="1131824">,</span>&nbsp;<span class="builtintype" id="1131826">false</span><span class="op" id="1131831">)</span><br>
<span class="lineno">80</span><span class="op" id="1131833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1131836">func</span>&nbsp;<span class="ident" id="1131841">testPool</span><span class="op" id="1131849">(</span><span class="ident" id="1131850">t</span>&nbsp;<span class="op" id="1131852">*</span><span class="ident" id="1131853">testing</span><span class="op" id="1131860">.</span><span class="ident" id="1131861">T</span><span class="op" id="1131862">,</span>&nbsp;<span class="ident" id="1131864">drain</span>&nbsp;<span class="builtintype" id="1131870">bool</span><span class="op" id="1131874">)</span>&nbsp;<span class="op" id="1131876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131879">var</span>&nbsp;<span class="ident" id="1131883">p</span>&nbsp;<span class="ident" id="1131885">Pool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131891">const</span>&nbsp;<span class="ident" id="1131897">N</span>&nbsp;<span class="op" id="1131899">=</span>&nbsp;<span class="num" id="1131901">100</span><br>
<span class="lineno">85</span><span class="ident" id="1131905">loop</span><span class="op" id="1131909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131912">for</span>&nbsp;<span class="ident" id="1131916">try</span>&nbsp;<span class="op" id="1131920">:=</span>&nbsp;<span class="num" id="1131923">0</span><span class="op" id="1131924">;</span>&nbsp;<span class="ident" id="1131926">try</span>&nbsp;<span class="op" id="1131930">&lt;</span>&nbsp;<span class="num" id="1131932">3</span><span class="op" id="1131933">;</span>&nbsp;<span class="ident" id="1131935">try</span><span class="op" id="1131938">++</span>&nbsp;<span class="op" id="1131941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131945">var</span>&nbsp;<span class="ident" id="1131949">fin</span><span class="op" id="1131952">,</span>&nbsp;<span class="ident" id="1131954">fin1</span>&nbsp;<span class="builtintype" id="1131959">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1131968">for</span>&nbsp;<span class="ident" id="1131972">i</span>&nbsp;<span class="op" id="1131974">:=</span>&nbsp;<span class="num" id="1131977">0</span><span class="op" id="1131978">;</span>&nbsp;<span class="ident" id="1131980">i</span>&nbsp;<span class="op" id="1131982">&lt;</span>&nbsp;<span class="ident" id="1131984">N</span><span class="op" id="1131985">;</span>&nbsp;<span class="ident" id="1131987">i</span><span class="op" id="1131988">++</span>&nbsp;<span class="op" id="1131991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1131996">v</span>&nbsp;<span class="op" id="1131998">:=</span>&nbsp;<span class="builtinfunc" id="1132001">new</span><span class="op" id="1132004">(</span><span class="builtintype" id="1132005">string</span><span class="op" id="1132011">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132016">runtime</span><span class="op" id="1132023">.</span><span class="ident" id="1132024">SetFinalizer</span><span class="op" id="1132036">(</span><span class="ident" id="1132037">v</span><span class="op" id="1132038">,</span>&nbsp;<span class="keyword" id="1132040">func</span><span class="op" id="1132044">(</span><span class="ident" id="1132045">vv</span>&nbsp;<span class="op" id="1132048">*</span><span class="builtintype" id="1132049">string</span><span class="op" id="1132055">)</span>&nbsp;<span class="op" id="1132057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132063">atomic</span><span class="op" id="1132069">.</span><span class="ident" id="1132070">AddUint32</span><span class="op" id="1132079">(</span><span class="op" id="1132080">&amp;</span><span class="ident" id="1132081">fin</span><span class="op" id="1132084">,</span>&nbsp;<span class="num" id="1132086">1</span><span class="op" id="1132087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132092">}</span><span class="op" id="1132093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132098">p</span><span class="op" id="1132099">.</span><span class="ident" id="1132100">Put</span><span class="op" id="1132103">(</span><span class="ident" id="1132104">v</span><span class="op" id="1132105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132109">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132113">if</span>&nbsp;<span class="ident" id="1132116">drain</span>&nbsp;<span class="op" id="1132122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132127">for</span>&nbsp;<span class="ident" id="1132131">i</span>&nbsp;<span class="op" id="1132133">:=</span>&nbsp;<span class="num" id="1132136">0</span><span class="op" id="1132137">;</span>&nbsp;<span class="ident" id="1132139">i</span>&nbsp;<span class="op" id="1132141">&lt;</span>&nbsp;<span class="ident" id="1132143">N</span><span class="op" id="1132144">;</span>&nbsp;<span class="ident" id="1132146">i</span><span class="op" id="1132147">++</span>&nbsp;<span class="op" id="1132150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132156">p</span><span class="op" id="1132157">.</span><span class="ident" id="1132158">Get</span><span class="op" id="1132161">(</span><span class="op" id="1132162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132171">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132175">for</span>&nbsp;<span class="ident" id="1132179">i</span>&nbsp;<span class="op" id="1132181">:=</span>&nbsp;<span class="num" id="1132184">0</span><span class="op" id="1132185">;</span>&nbsp;<span class="ident" id="1132187">i</span>&nbsp;<span class="op" id="1132189">&lt;</span>&nbsp;<span class="num" id="1132191">5</span><span class="op" id="1132192">;</span>&nbsp;<span class="ident" id="1132194">i</span><span class="op" id="1132195">++</span>&nbsp;<span class="op" id="1132198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132203">runtime</span><span class="op" id="1132210">.</span><span class="ident" id="1132211">GC</span><span class="op" id="1132213">(</span><span class="op" id="1132214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132219">time</span><span class="op" id="1132223">.</span><span class="ident" id="1132224">Sleep</span><span class="op" id="1132229">(</span><span class="ident" id="1132230">time</span><span class="op" id="1132234">.</span><span class="ident" id="1132235">Duration</span><span class="op" id="1132243">(</span><span class="ident" id="1132244">i</span><span class="op" id="1132245">*</span><span class="num" id="1132246">100</span><span class="op" id="1132249">+</span><span class="num" id="1132250">10</span><span class="op" id="1132252">)</span>&nbsp;<span class="op" id="1132254">*</span>&nbsp;<span class="ident" id="1132256">time</span><span class="op" id="1132260">.</span><span class="ident" id="1132261">Millisecond</span><span class="op" id="1132272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1132277">//&nbsp;1&nbsp;pointer&nbsp;can&nbsp;remain&nbsp;on&nbsp;stack&nbsp;or&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132326">if</span>&nbsp;<span class="ident" id="1132329">fin1</span>&nbsp;<span class="op" id="1132334">=</span>&nbsp;<span class="ident" id="1132336">atomic</span><span class="op" id="1132342">.</span><span class="ident" id="1132343">LoadUint32</span><span class="op" id="1132353">(</span><span class="op" id="1132354">&amp;</span><span class="ident" id="1132355">fin</span><span class="op" id="1132358">)</span><span class="op" id="1132359">;</span>&nbsp;<span class="ident" id="1132361">fin1</span>&nbsp;<span class="op" id="1132366">&gt;=</span>&nbsp;<span class="ident" id="1132369">N</span><span class="op" id="1132370">-</span><span class="num" id="1132371">1</span>&nbsp;<span class="op" id="1132373">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132379">continue</span>&nbsp;<span class="ident" id="1132388">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132404">t</span><span class="op" id="1132405">.</span><span class="ident" id="1132406">Fatalf</span><span class="op" id="1132412">(</span><span class="string" id="1132413">&#34;only&nbsp;%v&nbsp;out&nbsp;of&nbsp;%v&nbsp;resources&nbsp;are&nbsp;finalized&nbsp;on&nbsp;try&nbsp;%v&#34;</span><span class="op" id="1132466">,</span>&nbsp;<span class="ident" id="1132468">fin1</span><span class="op" id="1132472">,</span>&nbsp;<span class="ident" id="1132474">N</span><span class="op" id="1132475">,</span>&nbsp;<span class="ident" id="1132477">try</span><span class="op" id="1132480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132483">}</span><br>
<span class="lineno">110</span><span class="op" id="1132485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1132488">func</span>&nbsp;<span class="ident" id="1132493">TestPoolStress</span><span class="op" id="1132507">(</span><span class="ident" id="1132508">t</span>&nbsp;<span class="op" id="1132510">*</span><span class="ident" id="1132511">testing</span><span class="op" id="1132518">.</span><span class="ident" id="1132519">T</span><span class="op" id="1132520">)</span>&nbsp;<span class="op" id="1132522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132525">const</span>&nbsp;<span class="ident" id="1132531">P</span>&nbsp;<span class="op" id="1132533">=</span>&nbsp;<span class="num" id="1132535">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132539">N</span>&nbsp;<span class="op" id="1132541">:=</span>&nbsp;<span class="builtintype" id="1132544">int</span><span class="op" id="1132547">(</span><span class="num" id="1132548">1e6</span><span class="op" id="1132551">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132554">if</span>&nbsp;<span class="ident" id="1132557">testing</span><span class="op" id="1132564">.</span><span class="ident" id="1132565">Short</span><span class="op" id="1132570">(</span><span class="op" id="1132571">)</span>&nbsp;<span class="op" id="1132573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132577">N</span>&nbsp;<span class="op" id="1132579">/=</span>&nbsp;<span class="num" id="1132582">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132590">var</span>&nbsp;<span class="ident" id="1132594">p</span>&nbsp;<span class="ident" id="1132596">Pool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132602">done</span>&nbsp;<span class="op" id="1132607">:=</span>&nbsp;<span class="builtinfunc" id="1132610">make</span><span class="op" id="1132614">(</span><span class="keyword" id="1132615">chan</span>&nbsp;<span class="builtintype" id="1132620">bool</span><span class="op" id="1132624">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132627">for</span>&nbsp;<span class="ident" id="1132631">i</span>&nbsp;<span class="op" id="1132633">:=</span>&nbsp;<span class="num" id="1132636">0</span><span class="op" id="1132637">;</span>&nbsp;<span class="ident" id="1132639">i</span>&nbsp;<span class="op" id="1132641">&lt;</span>&nbsp;<span class="ident" id="1132643">P</span><span class="op" id="1132644">;</span>&nbsp;<span class="ident" id="1132646">i</span><span class="op" id="1132647">++</span>&nbsp;<span class="op" id="1132650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132654">go</span>&nbsp;<span class="keyword" id="1132657">func</span><span class="op" id="1132661">(</span><span class="op" id="1132662">)</span>&nbsp;<span class="op" id="1132664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132669">var</span>&nbsp;<span class="ident" id="1132673">v</span>&nbsp;<span class="keyword" id="1132675">interface</span><span class="op" id="1132684">{</span><span class="op" id="1132685">}</span>&nbsp;<span class="op" id="1132687">=</span>&nbsp;<span class="num" id="1132689">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132694">for</span>&nbsp;<span class="ident" id="1132698">j</span>&nbsp;<span class="op" id="1132700">:=</span>&nbsp;<span class="num" id="1132703">0</span><span class="op" id="1132704">;</span>&nbsp;<span class="ident" id="1132706">j</span>&nbsp;<span class="op" id="1132708">&lt;</span>&nbsp;<span class="ident" id="1132710">N</span><span class="op" id="1132711">;</span>&nbsp;<span class="ident" id="1132713">j</span><span class="op" id="1132714">++</span>&nbsp;<span class="op" id="1132717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132723">if</span>&nbsp;<span class="ident" id="1132726">v</span>&nbsp;<span class="op" id="1132728">==</span>&nbsp;<span class="ident" id="1132731">nil</span>&nbsp;<span class="op" id="1132735">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132742">v</span>&nbsp;<span class="op" id="1132744">=</span>&nbsp;<span class="num" id="1132746">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132758">p</span><span class="op" id="1132759">.</span><span class="ident" id="1132760">Put</span><span class="op" id="1132763">(</span><span class="ident" id="1132764">v</span><span class="op" id="1132765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132771">v</span>&nbsp;<span class="op" id="1132773">=</span>&nbsp;<span class="ident" id="1132775">p</span><span class="op" id="1132776">.</span><span class="ident" id="1132777">Get</span><span class="op" id="1132780">(</span><span class="op" id="1132781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132787">if</span>&nbsp;<span class="ident" id="1132790">v</span>&nbsp;<span class="op" id="1132792">!=</span>&nbsp;<span class="ident" id="1132795">nil</span>&nbsp;<span class="op" id="1132799">&amp;&amp;</span>&nbsp;<span class="ident" id="1132802">v</span><span class="op" id="1132803">.</span><span class="op" id="1132804">(</span><span class="builtintype" id="1132805">int</span><span class="op" id="1132808">)</span>&nbsp;<span class="op" id="1132810">!=</span>&nbsp;<span class="num" id="1132813">0</span>&nbsp;<span class="op" id="1132815">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132822">t</span><span class="op" id="1132823">.</span><span class="ident" id="1132824">Fatalf</span><span class="op" id="1132830">(</span><span class="string" id="1132831">&#34;expect&nbsp;0,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="1132849">,</span>&nbsp;<span class="ident" id="1132851">v</span><span class="op" id="1132852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132868">done</span>&nbsp;<span class="op" id="1132873">&lt;-</span>&nbsp;<span class="builtintype" id="1132876">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132883">}</span><span class="op" id="1132884">(</span><span class="op" id="1132885">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132891">for</span>&nbsp;<span class="ident" id="1132895">i</span>&nbsp;<span class="op" id="1132897">:=</span>&nbsp;<span class="num" id="1132900">0</span><span class="op" id="1132901">;</span>&nbsp;<span class="ident" id="1132903">i</span>&nbsp;<span class="op" id="1132905">&lt;</span>&nbsp;<span class="ident" id="1132907">P</span><span class="op" id="1132908">;</span>&nbsp;<span class="ident" id="1132910">i</span><span class="op" id="1132911">++</span>&nbsp;<span class="op" id="1132914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132918">&lt;-</span><span class="ident" id="1132920">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1132926">}</span><br>
<span class="lineno"></span><span class="op" id="1132928">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="1132931">func</span>&nbsp;<span class="ident" id="1132936">BenchmarkPool</span><span class="op" id="1132949">(</span><span class="ident" id="1132950">b</span>&nbsp;<span class="op" id="1132952">*</span><span class="ident" id="1132953">testing</span><span class="op" id="1132960">.</span><span class="ident" id="1132961">B</span><span class="op" id="1132962">)</span>&nbsp;<span class="op" id="1132964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1132967">var</span>&nbsp;<span class="ident" id="1132971">p</span>&nbsp;<span class="ident" id="1132973">Pool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1132979">b</span><span class="op" id="1132980">.</span><span class="ident" id="1132981">RunParallel</span><span class="op" id="1132992">(</span><span class="keyword" id="1132993">func</span><span class="op" id="1132997">(</span><span class="ident" id="1132998">pb</span>&nbsp;<span class="op" id="1133001">*</span><span class="ident" id="1133002">testing</span><span class="op" id="1133009">.</span><span class="ident" id="1133010">PB</span><span class="op" id="1133012">)</span>&nbsp;<span class="op" id="1133014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1133018">for</span>&nbsp;<span class="ident" id="1133022">pb</span><span class="op" id="1133024">.</span><span class="ident" id="1133025">Next</span><span class="op" id="1133029">(</span><span class="op" id="1133030">)</span>&nbsp;<span class="op" id="1133032">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1133037">p</span><span class="op" id="1133038">.</span><span class="ident" id="1133039">Put</span><span class="op" id="1133042">(</span><span class="num" id="1133043">1</span><span class="op" id="1133044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1133049">p</span><span class="op" id="1133050">.</span><span class="ident" id="1133051">Get</span><span class="op" id="1133054">(</span><span class="op" id="1133055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1133059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1133062">}</span><span class="op" id="1133063">)</span><br>
<span class="lineno"></span><span class="op" id="1133065">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="1133068">func</span>&nbsp;<span class="ident" id="1133073">BenchmarkPoolOverflow</span><span class="op" id="1133094">(</span><span class="ident" id="1133095">b</span>&nbsp;<span class="op" id="1133097">*</span><span class="ident" id="1133098">testing</span><span class="op" id="1133105">.</span><span class="ident" id="1133106">B</span><span class="op" id="1133107">)</span>&nbsp;<span class="op" id="1133109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1133112">var</span>&nbsp;<span class="ident" id="1133116">p</span>&nbsp;<span class="ident" id="1133118">Pool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1133124">b</span><span class="op" id="1133125">.</span><span class="ident" id="1133126">RunParallel</span><span class="op" id="1133137">(</span><span class="keyword" id="1133138">func</span><span class="op" id="1133142">(</span><span class="ident" id="1133143">pb</span>&nbsp;<span class="op" id="1133146">*</span><span class="ident" id="1133147">testing</span><span class="op" id="1133154">.</span><span class="ident" id="1133155">PB</span><span class="op" id="1133157">)</span>&nbsp;<span class="op" id="1133159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1133163">for</span>&nbsp;<span class="ident" id="1133167">pb</span><span class="op" id="1133169">.</span><span class="ident" id="1133170">Next</span><span class="op" id="1133174">(</span><span class="op" id="1133175">)</span>&nbsp;<span class="op" id="1133177">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1133182">for</span>&nbsp;<span class="ident" id="1133186">b</span>&nbsp;<span class="op" id="1133188">:=</span>&nbsp;<span class="num" id="1133191">0</span><span class="op" id="1133192">;</span>&nbsp;<span class="ident" id="1133194">b</span>&nbsp;<span class="op" id="1133196">&lt;</span>&nbsp;<span class="num" id="1133198">100</span><span class="op" id="1133201">;</span>&nbsp;<span class="ident" id="1133203">b</span><span class="op" id="1133204">++</span>&nbsp;<span class="op" id="1133207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1133213">p</span><span class="op" id="1133214">.</span><span class="ident" id="1133215">Put</span><span class="op" id="1133218">(</span><span class="num" id="1133219">1</span><span class="op" id="1133220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1133225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1133230">for</span>&nbsp;<span class="ident" id="1133234">b</span>&nbsp;<span class="op" id="1133236">:=</span>&nbsp;<span class="num" id="1133239">0</span><span class="op" id="1133240">;</span>&nbsp;<span class="ident" id="1133242">b</span>&nbsp;<span class="op" id="1133244">&lt;</span>&nbsp;<span class="num" id="1133246">100</span><span class="op" id="1133249">;</span>&nbsp;<span class="ident" id="1133251">b</span><span class="op" id="1133252">++</span>&nbsp;<span class="op" id="1133255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1133261">p</span><span class="op" id="1133262">.</span><span class="ident" id="1133263">Get</span><span class="op" id="1133266">(</span><span class="op" id="1133267">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1133272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1133276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1133279">}</span><span class="op" id="1133280">)</span><br>
<span class="lineno"></span><span class="op" id="1133282">}</span>
</div>
</body>
</html>
