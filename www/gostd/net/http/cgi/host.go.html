<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6309620">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6309675">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6309729">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6309780">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="6309846">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6309867">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="6309937">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="6309953">//</span><br>
<span class="lineno"></span><span class="comment" id="6309956">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="6310023">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6310082">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6310146">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="6310186">package</span>&nbsp;<span class="ident" id="6310194">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310199">import</span>&nbsp;<span class="op" id="6310206">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310209">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310218">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310225">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310231">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310238">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310250">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310256">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310267">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310284">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310294">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310305">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310316">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="6310326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310329">var</span>&nbsp;<span class="ident" id="6310333">trailingPort</span>&nbsp;<span class="op" id="6310346">=</span>&nbsp;<span class="ident" id="6310348">regexp</span><span class="op" id="6310354">.</span><span class="ident" id="6310355">MustCompile</span><span class="op" id="6310366">(</span><span class="string" id="6310367">`:([0-9]+)$`</span><span class="op" id="6310379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310382">var</span>&nbsp;<span class="ident" id="6310386">osDefaultInheritEnv</span>&nbsp;<span class="op" id="6310406">=</span>&nbsp;<span class="keyword" id="6310408">map</span><span class="op" id="6310411">[</span><span class="builtintype" id="6310412">string</span><span class="op" id="6310418">]</span><span class="op" id="6310419">[</span><span class="op" id="6310420">]</span><span class="builtintype" id="6310421">string</span><span class="op" id="6310427">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310430">&#34;darwin&#34;</span><span class="op" id="6310438">:</span>&nbsp;&nbsp;<span class="op" id="6310441">{</span><span class="string" id="6310442">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="6310461">}</span><span class="op" id="6310462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310465">&#34;freebsd&#34;</span><span class="op" id="6310474">:</span>&nbsp;<span class="op" id="6310476">{</span><span class="string" id="6310477">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6310494">}</span><span class="op" id="6310495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310498">&#34;hpux&#34;</span><span class="op" id="6310504">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310509">{</span><span class="string" id="6310510">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6310527">,</span>&nbsp;<span class="string" id="6310529">&#34;SHLIB_PATH&#34;</span><span class="op" id="6310541">}</span><span class="op" id="6310542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310545">&#34;irix&#34;</span><span class="op" id="6310551">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6310556">{</span><span class="string" id="6310557">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6310574">,</span>&nbsp;<span class="string" id="6310576">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="6310596">,</span>&nbsp;<span class="string" id="6310598">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="6310617">}</span><span class="op" id="6310618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310621">&#34;linux&#34;</span><span class="op" id="6310628">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6310632">{</span><span class="string" id="6310633">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6310650">}</span><span class="op" id="6310651">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310654">&#34;openbsd&#34;</span><span class="op" id="6310663">:</span>&nbsp;<span class="op" id="6310665">{</span><span class="string" id="6310666">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6310683">}</span><span class="op" id="6310684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310687">&#34;solaris&#34;</span><span class="op" id="6310696">:</span>&nbsp;<span class="op" id="6310698">{</span><span class="string" id="6310699">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6310716">,</span>&nbsp;<span class="string" id="6310718">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="6310738">,</span>&nbsp;<span class="string" id="6310740">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="6310760">}</span><span class="op" id="6310761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6310764">&#34;windows&#34;</span><span class="op" id="6310773">:</span>&nbsp;<span class="op" id="6310775">{</span><span class="string" id="6310776">&#34;SystemRoot&#34;</span><span class="op" id="6310788">,</span>&nbsp;<span class="string" id="6310790">&#34;COMSPEC&#34;</span><span class="op" id="6310799">,</span>&nbsp;<span class="string" id="6310801">&#34;PATHEXT&#34;</span><span class="op" id="6310810">,</span>&nbsp;<span class="string" id="6310812">&#34;WINDIR&#34;</span><span class="op" id="6310820">}</span><span class="op" id="6310821">,</span><br>
<span class="lineno"></span><span class="op" id="6310823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6310826">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="6310896">type</span>&nbsp;<span class="ident" id="6310901">Handler</span>&nbsp;<span class="keyword" id="6310909">struct</span>&nbsp;<span class="op" id="6310916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310919">Path</span>&nbsp;<span class="builtintype" id="6310924">string</span>&nbsp;<span class="comment" id="6310931">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310962">Root</span>&nbsp;<span class="builtintype" id="6310967">string</span>&nbsp;<span class="comment" id="6310974">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311023">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311081">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311138">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311193">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311216">Dir</span>&nbsp;<span class="builtintype" id="6311220">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311229">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311240">[</span><span class="op" id="6311241">]</span><span class="builtintype" id="6311242">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311252">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311315">InheritEnv</span>&nbsp;<span class="op" id="6311326">[</span><span class="op" id="6311327">]</span><span class="builtintype" id="6311328">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311338">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311395">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311406">*</span><span class="ident" id="6311407">log</span><span class="op" id="6311410">.</span><span class="ident" id="6311411">Logger</span>&nbsp;<span class="comment" id="6311418">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311470">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6311481">[</span><span class="op" id="6311482">]</span><span class="builtintype" id="6311483">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311493">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311542">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311603">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311661">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311721">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;§&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311777">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311803">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311807">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311872">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311926">PathLocationHandler</span>&nbsp;<span class="ident" id="6311946">http</span><span class="op" id="6311950">.</span><span class="ident" id="6311951">Handler</span><br>
<span class="lineno">70</span><span class="op" id="6311959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6311962">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="6312031">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="6312088">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="6312107">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6312119">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="6312169">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="6312177">func</span>&nbsp;<span class="ident" id="6312182">removeLeadingDuplicates</span><span class="op" id="6312205">(</span><span class="ident" id="6312206">env</span>&nbsp;<span class="op" id="6312210">[</span><span class="op" id="6312211">]</span><span class="builtintype" id="6312212">string</span><span class="op" id="6312218">)</span>&nbsp;<span class="op" id="6312220">(</span><span class="ident" id="6312221">ret</span>&nbsp;<span class="op" id="6312225">[</span><span class="op" id="6312226">]</span><span class="builtintype" id="6312227">string</span><span class="op" id="6312233">)</span>&nbsp;<span class="op" id="6312235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312238">n</span>&nbsp;<span class="op" id="6312240">:=</span>&nbsp;<span class="builtinfunc" id="6312243">len</span><span class="op" id="6312246">(</span><span class="ident" id="6312247">env</span><span class="op" id="6312250">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312253">for</span>&nbsp;<span class="ident" id="6312257">i</span>&nbsp;<span class="op" id="6312259">:=</span>&nbsp;<span class="num" id="6312262">0</span><span class="op" id="6312263">;</span>&nbsp;<span class="ident" id="6312265">i</span>&nbsp;<span class="op" id="6312267">&lt;</span>&nbsp;<span class="ident" id="6312269">n</span><span class="op" id="6312270">;</span>&nbsp;<span class="ident" id="6312272">i</span><span class="op" id="6312273">++</span>&nbsp;<span class="op" id="6312276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312280">e</span>&nbsp;<span class="op" id="6312282">:=</span>&nbsp;<span class="ident" id="6312285">env</span><span class="op" id="6312288">[</span><span class="ident" id="6312289">i</span><span class="op" id="6312290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312294">s</span>&nbsp;<span class="op" id="6312296">:=</span>&nbsp;<span class="ident" id="6312299">strings</span><span class="op" id="6312306">.</span><span class="ident" id="6312307">SplitN</span><span class="op" id="6312313">(</span><span class="ident" id="6312314">e</span><span class="op" id="6312315">,</span>&nbsp;<span class="string" id="6312317">&#34;=&#34;</span><span class="op" id="6312320">,</span>&nbsp;<span class="num" id="6312322">2</span><span class="op" id="6312323">)</span><span class="op" id="6312324">[</span><span class="num" id="6312325">0</span><span class="op" id="6312326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312330">found</span>&nbsp;<span class="op" id="6312336">:=</span>&nbsp;<span class="builtintype" id="6312339">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312347">for</span>&nbsp;<span class="ident" id="6312351">j</span>&nbsp;<span class="op" id="6312353">:=</span>&nbsp;<span class="ident" id="6312356">i</span>&nbsp;<span class="op" id="6312358">+</span>&nbsp;<span class="num" id="6312360">1</span><span class="op" id="6312361">;</span>&nbsp;<span class="ident" id="6312363">j</span>&nbsp;<span class="op" id="6312365">&lt;</span>&nbsp;<span class="ident" id="6312367">n</span><span class="op" id="6312368">;</span>&nbsp;<span class="ident" id="6312370">j</span><span class="op" id="6312371">++</span>&nbsp;<span class="op" id="6312374">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312379">if</span>&nbsp;<span class="ident" id="6312382">s</span>&nbsp;<span class="op" id="6312384">==</span>&nbsp;<span class="ident" id="6312387">strings</span><span class="op" id="6312394">.</span><span class="ident" id="6312395">SplitN</span><span class="op" id="6312401">(</span><span class="ident" id="6312402">env</span><span class="op" id="6312405">[</span><span class="ident" id="6312406">j</span><span class="op" id="6312407">]</span><span class="op" id="6312408">,</span>&nbsp;<span class="string" id="6312410">&#34;=&#34;</span><span class="op" id="6312413">,</span>&nbsp;<span class="num" id="6312415">2</span><span class="op" id="6312416">)</span><span class="op" id="6312417">[</span><span class="num" id="6312418">0</span><span class="op" id="6312419">]</span>&nbsp;<span class="op" id="6312421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312427">found</span>&nbsp;<span class="op" id="6312433">=</span>&nbsp;<span class="builtintype" id="6312435">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312444">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312457">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312461">if</span>&nbsp;<span class="op" id="6312464">!</span><span class="ident" id="6312465">found</span>&nbsp;<span class="op" id="6312471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312476">ret</span>&nbsp;<span class="op" id="6312480">=</span>&nbsp;<span class="builtinfunc" id="6312482">append</span><span class="op" id="6312488">(</span><span class="ident" id="6312489">ret</span><span class="op" id="6312492">,</span>&nbsp;<span class="ident" id="6312494">e</span><span class="op" id="6312495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312505">return</span><br>
<span class="lineno">95</span><span class="op" id="6312512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6312515">func</span>&nbsp;<span class="op" id="6312520">(</span><span class="ident" id="6312521">h</span>&nbsp;<span class="op" id="6312523">*</span><span class="ident" id="6312524">Handler</span><span class="op" id="6312531">)</span>&nbsp;<span class="ident" id="6312533">ServeHTTP</span><span class="op" id="6312542">(</span><span class="ident" id="6312543">rw</span>&nbsp;<span class="ident" id="6312546">http</span><span class="op" id="6312550">.</span><span class="ident" id="6312551">ResponseWriter</span><span class="op" id="6312565">,</span>&nbsp;<span class="ident" id="6312567">req</span>&nbsp;<span class="op" id="6312571">*</span><span class="ident" id="6312572">http</span><span class="op" id="6312576">.</span><span class="ident" id="6312577">Request</span><span class="op" id="6312584">)</span>&nbsp;<span class="op" id="6312586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312589">root</span>&nbsp;<span class="op" id="6312594">:=</span>&nbsp;<span class="ident" id="6312597">h</span><span class="op" id="6312598">.</span><span class="ident" id="6312599">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312605">if</span>&nbsp;<span class="ident" id="6312608">root</span>&nbsp;<span class="op" id="6312613">==</span>&nbsp;<span class="string" id="6312616">&#34;&#34;</span>&nbsp;<span class="op" id="6312619">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312623">root</span>&nbsp;<span class="op" id="6312628">=</span>&nbsp;<span class="string" id="6312630">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312639">if</span>&nbsp;<span class="builtinfunc" id="6312642">len</span><span class="op" id="6312645">(</span><span class="ident" id="6312646">req</span><span class="op" id="6312649">.</span><span class="ident" id="6312650">TransferEncoding</span><span class="op" id="6312666">)</span>&nbsp;<span class="op" id="6312668">&gt;</span>&nbsp;<span class="num" id="6312670">0</span>&nbsp;<span class="op" id="6312672">&amp;&amp;</span>&nbsp;<span class="ident" id="6312675">req</span><span class="op" id="6312678">.</span><span class="ident" id="6312679">TransferEncoding</span><span class="op" id="6312695">[</span><span class="num" id="6312696">0</span><span class="op" id="6312697">]</span>&nbsp;<span class="op" id="6312699">==</span>&nbsp;<span class="string" id="6312702">&#34;chunked&#34;</span>&nbsp;<span class="op" id="6312712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312716">rw</span><span class="op" id="6312718">.</span><span class="ident" id="6312719">WriteHeader</span><span class="op" id="6312730">(</span><span class="ident" id="6312731">http</span><span class="op" id="6312735">.</span><span class="ident" id="6312736">StatusBadRequest</span><span class="op" id="6312752">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312756">rw</span><span class="op" id="6312758">.</span><span class="ident" id="6312759">Write</span><span class="op" id="6312764">(</span><span class="op" id="6312765">[</span><span class="op" id="6312766">]</span><span class="builtintype" id="6312767">byte</span><span class="op" id="6312771">(</span><span class="string" id="6312772">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="6312822">)</span><span class="op" id="6312823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312827">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312839">pathInfo</span>&nbsp;<span class="op" id="6312848">:=</span>&nbsp;<span class="ident" id="6312851">req</span><span class="op" id="6312854">.</span><span class="ident" id="6312855">URL</span><span class="op" id="6312858">.</span><span class="ident" id="6312859">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312865">if</span>&nbsp;<span class="ident" id="6312868">root</span>&nbsp;<span class="op" id="6312873">!=</span>&nbsp;<span class="string" id="6312876">&#34;/&#34;</span>&nbsp;<span class="op" id="6312880">&amp;&amp;</span>&nbsp;<span class="ident" id="6312883">strings</span><span class="op" id="6312890">.</span><span class="ident" id="6312891">HasPrefix</span><span class="op" id="6312900">(</span><span class="ident" id="6312901">pathInfo</span><span class="op" id="6312909">,</span>&nbsp;<span class="ident" id="6312911">root</span><span class="op" id="6312915">)</span>&nbsp;<span class="op" id="6312917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312921">pathInfo</span>&nbsp;<span class="op" id="6312930">=</span>&nbsp;<span class="ident" id="6312932">pathInfo</span><span class="op" id="6312940">[</span><span class="builtinfunc" id="6312941">len</span><span class="op" id="6312944">(</span><span class="ident" id="6312945">root</span><span class="op" id="6312949">)</span><span class="op" id="6312950">:</span><span class="op" id="6312951">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312958">port</span>&nbsp;<span class="op" id="6312963">:=</span>&nbsp;<span class="string" id="6312966">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312972">if</span>&nbsp;<span class="ident" id="6312975">matches</span>&nbsp;<span class="op" id="6312983">:=</span>&nbsp;<span class="ident" id="6312986">trailingPort</span><span class="op" id="6312998">.</span><span class="ident" id="6312999">FindStringSubmatch</span><span class="op" id="6313017">(</span><span class="ident" id="6313018">req</span><span class="op" id="6313021">.</span><span class="ident" id="6313022">Host</span><span class="op" id="6313026">)</span><span class="op" id="6313027">;</span>&nbsp;<span class="builtinfunc" id="6313029">len</span><span class="op" id="6313032">(</span><span class="ident" id="6313033">matches</span><span class="op" id="6313040">)</span>&nbsp;<span class="op" id="6313042">!=</span>&nbsp;<span class="num" id="6313045">0</span>&nbsp;<span class="op" id="6313047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313051">port</span>&nbsp;<span class="op" id="6313056">=</span>&nbsp;<span class="ident" id="6313058">matches</span><span class="op" id="6313065">[</span><span class="num" id="6313066">1</span><span class="op" id="6313067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313074">env</span>&nbsp;<span class="op" id="6313078">:=</span>&nbsp;<span class="op" id="6313081">[</span><span class="op" id="6313082">]</span><span class="builtintype" id="6313083">string</span><span class="op" id="6313089">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313093">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="6313113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313117">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="6313132">+</span>&nbsp;<span class="ident" id="6313134">req</span><span class="op" id="6313137">.</span><span class="ident" id="6313138">Host</span><span class="op" id="6313142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313146">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="6313172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313176">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="6313189">+</span>&nbsp;<span class="ident" id="6313191">req</span><span class="op" id="6313194">.</span><span class="ident" id="6313195">Host</span><span class="op" id="6313199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313203">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="6313230">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313234">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="6313252">+</span>&nbsp;<span class="ident" id="6313254">req</span><span class="op" id="6313257">.</span><span class="ident" id="6313258">Method</span><span class="op" id="6313264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313268">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="6313284">+</span>&nbsp;<span class="ident" id="6313286">req</span><span class="op" id="6313289">.</span><span class="ident" id="6313290">URL</span><span class="op" id="6313293">.</span><span class="ident" id="6313294">RawQuery</span><span class="op" id="6313302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313306">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="6313321">+</span>&nbsp;<span class="ident" id="6313323">req</span><span class="op" id="6313326">.</span><span class="ident" id="6313327">URL</span><span class="op" id="6313330">.</span><span class="ident" id="6313331">RequestURI</span><span class="op" id="6313341">(</span><span class="op" id="6313342">)</span><span class="op" id="6313343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313347">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="6313360">+</span>&nbsp;<span class="ident" id="6313362">pathInfo</span><span class="op" id="6313370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313374">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="6313389">+</span>&nbsp;<span class="ident" id="6313391">root</span><span class="op" id="6313395">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313399">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="6313418">+</span>&nbsp;<span class="ident" id="6313420">h</span><span class="op" id="6313421">.</span><span class="ident" id="6313422">Path</span><span class="op" id="6313426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313430">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="6313445">+</span>&nbsp;<span class="ident" id="6313447">req</span><span class="op" id="6313450">.</span><span class="ident" id="6313451">RemoteAddr</span><span class="op" id="6313461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313465">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="6313480">+</span>&nbsp;<span class="ident" id="6313482">req</span><span class="op" id="6313485">.</span><span class="ident" id="6313486">RemoteAddr</span><span class="op" id="6313496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6313500">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="6313515">+</span>&nbsp;<span class="ident" id="6313517">port</span><span class="op" id="6313521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313524">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313528">if</span>&nbsp;<span class="ident" id="6313531">req</span><span class="op" id="6313534">.</span><span class="ident" id="6313535">TLS</span>&nbsp;<span class="op" id="6313539">!=</span>&nbsp;<span class="ident" id="6313542">nil</span>&nbsp;<span class="op" id="6313546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313550">env</span>&nbsp;<span class="op" id="6313554">=</span>&nbsp;<span class="builtinfunc" id="6313556">append</span><span class="op" id="6313562">(</span><span class="ident" id="6313563">env</span><span class="op" id="6313566">,</span>&nbsp;<span class="string" id="6313568">&#34;HTTPS=on&#34;</span><span class="op" id="6313578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313585">for</span>&nbsp;<span class="ident" id="6313589">k</span><span class="op" id="6313590">,</span>&nbsp;<span class="ident" id="6313592">v</span>&nbsp;<span class="op" id="6313594">:=</span>&nbsp;<span class="keyword" id="6313597">range</span>&nbsp;<span class="ident" id="6313603">req</span><span class="op" id="6313606">.</span><span class="ident" id="6313607">Header</span>&nbsp;<span class="op" id="6313614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313618">k</span>&nbsp;<span class="op" id="6313620">=</span>&nbsp;<span class="ident" id="6313622">strings</span><span class="op" id="6313629">.</span><span class="ident" id="6313630">Map</span><span class="op" id="6313633">(</span><span class="ident" id="6313634">upperCaseAndUnderscore</span><span class="op" id="6313656">,</span>&nbsp;<span class="ident" id="6313658">k</span><span class="op" id="6313659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313663">joinStr</span>&nbsp;<span class="op" id="6313671">:=</span>&nbsp;<span class="string" id="6313674">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313681">if</span>&nbsp;<span class="ident" id="6313684">k</span>&nbsp;<span class="op" id="6313686">==</span>&nbsp;<span class="string" id="6313689">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="6313698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313703">joinStr</span>&nbsp;<span class="op" id="6313711">=</span>&nbsp;<span class="string" id="6313713">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313724">env</span>&nbsp;<span class="op" id="6313728">=</span>&nbsp;<span class="builtinfunc" id="6313730">append</span><span class="op" id="6313736">(</span><span class="ident" id="6313737">env</span><span class="op" id="6313740">,</span>&nbsp;<span class="string" id="6313742">&#34;HTTP_&#34;</span><span class="op" id="6313749">+</span><span class="ident" id="6313750">k</span><span class="op" id="6313751">+</span><span class="string" id="6313752">&#34;=&#34;</span><span class="op" id="6313755">+</span><span class="ident" id="6313756">strings</span><span class="op" id="6313763">.</span><span class="ident" id="6313764">Join</span><span class="op" id="6313768">(</span><span class="ident" id="6313769">v</span><span class="op" id="6313770">,</span>&nbsp;<span class="ident" id="6313772">joinStr</span><span class="op" id="6313779">)</span><span class="op" id="6313780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313787">if</span>&nbsp;<span class="ident" id="6313790">req</span><span class="op" id="6313793">.</span><span class="ident" id="6313794">ContentLength</span>&nbsp;<span class="op" id="6313808">&gt;</span>&nbsp;<span class="num" id="6313810">0</span>&nbsp;<span class="op" id="6313812">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313816">env</span>&nbsp;<span class="op" id="6313820">=</span>&nbsp;<span class="builtinfunc" id="6313822">append</span><span class="op" id="6313828">(</span><span class="ident" id="6313829">env</span><span class="op" id="6313832">,</span>&nbsp;<span class="ident" id="6313834">fmt</span><span class="op" id="6313837">.</span><span class="ident" id="6313838">Sprintf</span><span class="op" id="6313845">(</span><span class="string" id="6313846">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="6313865">,</span>&nbsp;<span class="ident" id="6313867">req</span><span class="op" id="6313870">.</span><span class="ident" id="6313871">ContentLength</span><span class="op" id="6313884">)</span><span class="op" id="6313885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313891">if</span>&nbsp;<span class="ident" id="6313894">ctype</span>&nbsp;<span class="op" id="6313900">:=</span>&nbsp;<span class="ident" id="6313903">req</span><span class="op" id="6313906">.</span><span class="ident" id="6313907">Header</span><span class="op" id="6313913">.</span><span class="ident" id="6313914">Get</span><span class="op" id="6313917">(</span><span class="string" id="6313918">&#34;Content-Type&#34;</span><span class="op" id="6313932">)</span><span class="op" id="6313933">;</span>&nbsp;<span class="ident" id="6313935">ctype</span>&nbsp;<span class="op" id="6313941">!=</span>&nbsp;<span class="string" id="6313944">&#34;&#34;</span>&nbsp;<span class="op" id="6313947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313951">env</span>&nbsp;<span class="op" id="6313955">=</span>&nbsp;<span class="builtinfunc" id="6313957">append</span><span class="op" id="6313963">(</span><span class="ident" id="6313964">env</span><span class="op" id="6313967">,</span>&nbsp;<span class="string" id="6313969">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="6313984">+</span><span class="ident" id="6313985">ctype</span><span class="op" id="6313990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313993">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313997">if</span>&nbsp;<span class="ident" id="6314000">h</span><span class="op" id="6314001">.</span><span class="ident" id="6314002">Env</span>&nbsp;<span class="op" id="6314006">!=</span>&nbsp;<span class="ident" id="6314009">nil</span>&nbsp;<span class="op" id="6314013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314017">env</span>&nbsp;<span class="op" id="6314021">=</span>&nbsp;<span class="builtinfunc" id="6314023">append</span><span class="op" id="6314029">(</span><span class="ident" id="6314030">env</span><span class="op" id="6314033">,</span>&nbsp;<span class="ident" id="6314035">h</span><span class="op" id="6314036">.</span><span class="ident" id="6314037">Env</span><span class="op" id="6314040">...</span><span class="op" id="6314043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314050">envPath</span>&nbsp;<span class="op" id="6314058">:=</span>&nbsp;<span class="ident" id="6314061">os</span><span class="op" id="6314063">.</span><span class="ident" id="6314064">Getenv</span><span class="op" id="6314070">(</span><span class="string" id="6314071">&#34;PATH&#34;</span><span class="op" id="6314077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314080">if</span>&nbsp;<span class="ident" id="6314083">envPath</span>&nbsp;<span class="op" id="6314091">==</span>&nbsp;<span class="string" id="6314094">&#34;&#34;</span>&nbsp;<span class="op" id="6314097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314101">envPath</span>&nbsp;<span class="op" id="6314109">=</span>&nbsp;<span class="string" id="6314111">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314164">env</span>&nbsp;<span class="op" id="6314168">=</span>&nbsp;<span class="builtinfunc" id="6314170">append</span><span class="op" id="6314176">(</span><span class="ident" id="6314177">env</span><span class="op" id="6314180">,</span>&nbsp;<span class="string" id="6314182">&#34;PATH=&#34;</span><span class="op" id="6314189">+</span><span class="ident" id="6314190">envPath</span><span class="op" id="6314197">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314201">for</span>&nbsp;<span class="ident" id="6314205">_</span><span class="op" id="6314206">,</span>&nbsp;<span class="ident" id="6314208">e</span>&nbsp;<span class="op" id="6314210">:=</span>&nbsp;<span class="keyword" id="6314213">range</span>&nbsp;<span class="ident" id="6314219">h</span><span class="op" id="6314220">.</span><span class="ident" id="6314221">InheritEnv</span>&nbsp;<span class="op" id="6314232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314236">if</span>&nbsp;<span class="ident" id="6314239">v</span>&nbsp;<span class="op" id="6314241">:=</span>&nbsp;<span class="ident" id="6314244">os</span><span class="op" id="6314246">.</span><span class="ident" id="6314247">Getenv</span><span class="op" id="6314253">(</span><span class="ident" id="6314254">e</span><span class="op" id="6314255">)</span><span class="op" id="6314256">;</span>&nbsp;<span class="ident" id="6314258">v</span>&nbsp;<span class="op" id="6314260">!=</span>&nbsp;<span class="string" id="6314263">&#34;&#34;</span>&nbsp;<span class="op" id="6314266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314271">env</span>&nbsp;<span class="op" id="6314275">=</span>&nbsp;<span class="builtinfunc" id="6314277">append</span><span class="op" id="6314283">(</span><span class="ident" id="6314284">env</span><span class="op" id="6314287">,</span>&nbsp;<span class="ident" id="6314289">e</span><span class="op" id="6314290">+</span><span class="string" id="6314291">&#34;=&#34;</span><span class="op" id="6314294">+</span><span class="ident" id="6314295">v</span><span class="op" id="6314296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314300">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314307">for</span>&nbsp;<span class="ident" id="6314311">_</span><span class="op" id="6314312">,</span>&nbsp;<span class="ident" id="6314314">e</span>&nbsp;<span class="op" id="6314316">:=</span>&nbsp;<span class="keyword" id="6314319">range</span>&nbsp;<span class="ident" id="6314325">osDefaultInheritEnv</span><span class="op" id="6314344">[</span><span class="ident" id="6314345">runtime</span><span class="op" id="6314352">.</span><span class="ident" id="6314353">GOOS</span><span class="op" id="6314357">]</span>&nbsp;<span class="op" id="6314359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314363">if</span>&nbsp;<span class="ident" id="6314366">v</span>&nbsp;<span class="op" id="6314368">:=</span>&nbsp;<span class="ident" id="6314371">os</span><span class="op" id="6314373">.</span><span class="ident" id="6314374">Getenv</span><span class="op" id="6314380">(</span><span class="ident" id="6314381">e</span><span class="op" id="6314382">)</span><span class="op" id="6314383">;</span>&nbsp;<span class="ident" id="6314385">v</span>&nbsp;<span class="op" id="6314387">!=</span>&nbsp;<span class="string" id="6314390">&#34;&#34;</span>&nbsp;<span class="op" id="6314393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314398">env</span>&nbsp;<span class="op" id="6314402">=</span>&nbsp;<span class="builtinfunc" id="6314404">append</span><span class="op" id="6314410">(</span><span class="ident" id="6314411">env</span><span class="op" id="6314414">,</span>&nbsp;<span class="ident" id="6314416">e</span><span class="op" id="6314417">+</span><span class="string" id="6314418">&#34;=&#34;</span><span class="op" id="6314421">+</span><span class="ident" id="6314422">v</span><span class="op" id="6314423">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314434">env</span>&nbsp;<span class="op" id="6314438">=</span>&nbsp;<span class="ident" id="6314440">removeLeadingDuplicates</span><span class="op" id="6314463">(</span><span class="ident" id="6314464">env</span><span class="op" id="6314467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314471">var</span>&nbsp;<span class="ident" id="6314475">cwd</span><span class="op" id="6314478">,</span>&nbsp;<span class="ident" id="6314480">path</span>&nbsp;<span class="builtintype" id="6314485">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314493">if</span>&nbsp;<span class="ident" id="6314496">h</span><span class="op" id="6314497">.</span><span class="ident" id="6314498">Dir</span>&nbsp;<span class="op" id="6314502">!=</span>&nbsp;<span class="string" id="6314505">&#34;&#34;</span>&nbsp;<span class="op" id="6314508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314512">path</span>&nbsp;<span class="op" id="6314517">=</span>&nbsp;<span class="ident" id="6314519">h</span><span class="op" id="6314520">.</span><span class="ident" id="6314521">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314528">cwd</span>&nbsp;<span class="op" id="6314532">=</span>&nbsp;<span class="ident" id="6314534">h</span><span class="op" id="6314535">.</span><span class="ident" id="6314536">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314541">}</span>&nbsp;<span class="keyword" id="6314543">else</span>&nbsp;<span class="op" id="6314548">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314552">cwd</span><span class="op" id="6314555">,</span>&nbsp;<span class="ident" id="6314557">path</span>&nbsp;<span class="op" id="6314562">=</span>&nbsp;<span class="ident" id="6314564">filepath</span><span class="op" id="6314572">.</span><span class="ident" id="6314573">Split</span><span class="op" id="6314578">(</span><span class="ident" id="6314579">h</span><span class="op" id="6314580">.</span><span class="ident" id="6314581">Path</span><span class="op" id="6314585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314591">if</span>&nbsp;<span class="ident" id="6314594">cwd</span>&nbsp;<span class="op" id="6314598">==</span>&nbsp;<span class="string" id="6314601">&#34;&#34;</span>&nbsp;<span class="op" id="6314604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314608">cwd</span>&nbsp;<span class="op" id="6314612">=</span>&nbsp;<span class="string" id="6314614">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314619">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314623">internalError</span>&nbsp;<span class="op" id="6314637">:=</span>&nbsp;<span class="keyword" id="6314640">func</span><span class="op" id="6314644">(</span><span class="ident" id="6314645">err</span>&nbsp;<span class="builtintype" id="6314649">error</span><span class="op" id="6314654">)</span>&nbsp;<span class="op" id="6314656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314660">rw</span><span class="op" id="6314662">.</span><span class="ident" id="6314663">WriteHeader</span><span class="op" id="6314674">(</span><span class="ident" id="6314675">http</span><span class="op" id="6314679">.</span><span class="ident" id="6314680">StatusInternalServerError</span><span class="op" id="6314705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314709">h</span><span class="op" id="6314710">.</span><span class="ident" id="6314711">printf</span><span class="op" id="6314717">(</span><span class="string" id="6314718">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6314733">,</span>&nbsp;<span class="ident" id="6314735">err</span><span class="op" id="6314738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314741">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314745">cmd</span>&nbsp;<span class="op" id="6314749">:=</span>&nbsp;<span class="op" id="6314752">&amp;</span><span class="ident" id="6314753">exec</span><span class="op" id="6314757">.</span><span class="ident" id="6314758">Cmd</span><span class="op" id="6314761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314765">Path</span><span class="op" id="6314769">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6314773">path</span><span class="op" id="6314777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314781">Args</span><span class="op" id="6314785">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6314789">append</span><span class="op" id="6314795">(</span><span class="op" id="6314796">[</span><span class="op" id="6314797">]</span><span class="builtintype" id="6314798">string</span><span class="op" id="6314804">{</span><span class="ident" id="6314805">h</span><span class="op" id="6314806">.</span><span class="ident" id="6314807">Path</span><span class="op" id="6314811">}</span><span class="op" id="6314812">,</span>&nbsp;<span class="ident" id="6314814">h</span><span class="op" id="6314815">.</span><span class="ident" id="6314816">Args</span><span class="op" id="6314820">...</span><span class="op" id="6314823">)</span><span class="op" id="6314824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314828">Dir</span><span class="op" id="6314831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314836">cwd</span><span class="op" id="6314839">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314843">Env</span><span class="op" id="6314846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314851">env</span><span class="op" id="6314854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314858">Stderr</span><span class="op" id="6314864">:</span>&nbsp;<span class="ident" id="6314866">os</span><span class="op" id="6314868">.</span><span class="ident" id="6314869">Stderr</span><span class="op" id="6314875">,</span>&nbsp;<span class="comment" id="6314877">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314892">if</span>&nbsp;<span class="ident" id="6314895">req</span><span class="op" id="6314898">.</span><span class="ident" id="6314899">ContentLength</span>&nbsp;<span class="op" id="6314913">!=</span>&nbsp;<span class="num" id="6314916">0</span>&nbsp;<span class="op" id="6314918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314922">cmd</span><span class="op" id="6314925">.</span><span class="ident" id="6314926">Stdin</span>&nbsp;<span class="op" id="6314932">=</span>&nbsp;<span class="ident" id="6314934">req</span><span class="op" id="6314937">.</span><span class="ident" id="6314938">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314947">stdoutRead</span><span class="op" id="6314957">,</span>&nbsp;<span class="ident" id="6314959">err</span>&nbsp;<span class="op" id="6314963">:=</span>&nbsp;<span class="ident" id="6314966">cmd</span><span class="op" id="6314969">.</span><span class="ident" id="6314970">StdoutPipe</span><span class="op" id="6314980">(</span><span class="op" id="6314981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314984">if</span>&nbsp;<span class="ident" id="6314987">err</span>&nbsp;<span class="op" id="6314991">!=</span>&nbsp;<span class="ident" id="6314994">nil</span>&nbsp;<span class="op" id="6314998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315002">internalError</span><span class="op" id="6315015">(</span><span class="ident" id="6315016">err</span><span class="op" id="6315019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315023">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315035">err</span>&nbsp;<span class="op" id="6315039">=</span>&nbsp;<span class="ident" id="6315041">cmd</span><span class="op" id="6315044">.</span><span class="ident" id="6315045">Start</span><span class="op" id="6315050">(</span><span class="op" id="6315051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315054">if</span>&nbsp;<span class="ident" id="6315057">err</span>&nbsp;<span class="op" id="6315061">!=</span>&nbsp;<span class="ident" id="6315064">nil</span>&nbsp;<span class="op" id="6315068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315072">internalError</span><span class="op" id="6315085">(</span><span class="ident" id="6315086">err</span><span class="op" id="6315089">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315104">if</span>&nbsp;<span class="ident" id="6315107">hook</span>&nbsp;<span class="op" id="6315112">:=</span>&nbsp;<span class="ident" id="6315115">testHookStartProcess</span><span class="op" id="6315135">;</span>&nbsp;<span class="ident" id="6315137">hook</span>&nbsp;<span class="op" id="6315142">!=</span>&nbsp;<span class="ident" id="6315145">nil</span>&nbsp;<span class="op" id="6315149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315153">hook</span><span class="op" id="6315157">(</span><span class="ident" id="6315158">cmd</span><span class="op" id="6315161">.</span><span class="ident" id="6315162">Process</span><span class="op" id="6315169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315172">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315175">defer</span>&nbsp;<span class="ident" id="6315181">cmd</span><span class="op" id="6315184">.</span><span class="ident" id="6315185">Wait</span><span class="op" id="6315189">(</span><span class="op" id="6315190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315193">defer</span>&nbsp;<span class="ident" id="6315199">stdoutRead</span><span class="op" id="6315209">.</span><span class="ident" id="6315210">Close</span><span class="op" id="6315215">(</span><span class="op" id="6315216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315220">linebody</span>&nbsp;<span class="op" id="6315229">:=</span>&nbsp;<span class="ident" id="6315232">bufio</span><span class="op" id="6315237">.</span><span class="ident" id="6315238">NewReaderSize</span><span class="op" id="6315251">(</span><span class="ident" id="6315252">stdoutRead</span><span class="op" id="6315262">,</span>&nbsp;<span class="num" id="6315264">1024</span><span class="op" id="6315268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315271">headers</span>&nbsp;<span class="op" id="6315279">:=</span>&nbsp;<span class="builtinfunc" id="6315282">make</span><span class="op" id="6315286">(</span><span class="ident" id="6315287">http</span><span class="op" id="6315291">.</span><span class="ident" id="6315292">Header</span><span class="op" id="6315298">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315301">statusCode</span>&nbsp;<span class="op" id="6315312">:=</span>&nbsp;<span class="num" id="6315315">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315318">headerLines</span>&nbsp;<span class="op" id="6315330">:=</span>&nbsp;<span class="num" id="6315333">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315336">sawBlankLine</span>&nbsp;<span class="op" id="6315349">:=</span>&nbsp;<span class="builtintype" id="6315352">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315359">for</span>&nbsp;<span class="op" id="6315363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315367">line</span><span class="op" id="6315371">,</span>&nbsp;<span class="ident" id="6315373">isPrefix</span><span class="op" id="6315381">,</span>&nbsp;<span class="ident" id="6315383">err</span>&nbsp;<span class="op" id="6315387">:=</span>&nbsp;<span class="ident" id="6315390">linebody</span><span class="op" id="6315398">.</span><span class="ident" id="6315399">ReadLine</span><span class="op" id="6315407">(</span><span class="op" id="6315408">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315412">if</span>&nbsp;<span class="ident" id="6315415">isPrefix</span>&nbsp;<span class="op" id="6315424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315429">rw</span><span class="op" id="6315431">.</span><span class="ident" id="6315432">WriteHeader</span><span class="op" id="6315443">(</span><span class="ident" id="6315444">http</span><span class="op" id="6315448">.</span><span class="ident" id="6315449">StatusInternalServerError</span><span class="op" id="6315474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315479">h</span><span class="op" id="6315480">.</span><span class="ident" id="6315481">printf</span><span class="op" id="6315487">(</span><span class="string" id="6315488">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="6315528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315533">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315542">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315546">if</span>&nbsp;<span class="ident" id="6315549">err</span>&nbsp;<span class="op" id="6315553">==</span>&nbsp;<span class="ident" id="6315556">io</span><span class="op" id="6315558">.</span><span class="ident" id="6315559">EOF</span>&nbsp;<span class="op" id="6315563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315568">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315580">if</span>&nbsp;<span class="ident" id="6315583">err</span>&nbsp;<span class="op" id="6315587">!=</span>&nbsp;<span class="ident" id="6315590">nil</span>&nbsp;<span class="op" id="6315594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315599">rw</span><span class="op" id="6315601">.</span><span class="ident" id="6315602">WriteHeader</span><span class="op" id="6315613">(</span><span class="ident" id="6315614">http</span><span class="op" id="6315618">.</span><span class="ident" id="6315619">StatusInternalServerError</span><span class="op" id="6315644">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315649">h</span><span class="op" id="6315650">.</span><span class="ident" id="6315651">printf</span><span class="op" id="6315657">(</span><span class="string" id="6315658">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="6315690">,</span>&nbsp;<span class="ident" id="6315692">err</span><span class="op" id="6315695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315713">if</span>&nbsp;<span class="builtinfunc" id="6315716">len</span><span class="op" id="6315719">(</span><span class="ident" id="6315720">line</span><span class="op" id="6315724">)</span>&nbsp;<span class="op" id="6315726">==</span>&nbsp;<span class="num" id="6315729">0</span>&nbsp;<span class="op" id="6315731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315736">sawBlankLine</span>&nbsp;<span class="op" id="6315749">=</span>&nbsp;<span class="builtintype" id="6315751">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315759">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315771">headerLines</span><span class="op" id="6315782">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315787">parts</span>&nbsp;<span class="op" id="6315793">:=</span>&nbsp;<span class="ident" id="6315796">strings</span><span class="op" id="6315803">.</span><span class="ident" id="6315804">SplitN</span><span class="op" id="6315810">(</span><span class="builtintype" id="6315811">string</span><span class="op" id="6315817">(</span><span class="ident" id="6315818">line</span><span class="op" id="6315822">)</span><span class="op" id="6315823">,</span>&nbsp;<span class="string" id="6315825">&#34;:&#34;</span><span class="op" id="6315828">,</span>&nbsp;<span class="num" id="6315830">2</span><span class="op" id="6315831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315835">if</span>&nbsp;<span class="builtinfunc" id="6315838">len</span><span class="op" id="6315841">(</span><span class="ident" id="6315842">parts</span><span class="op" id="6315847">)</span>&nbsp;<span class="op" id="6315849">&lt;</span>&nbsp;<span class="num" id="6315851">2</span>&nbsp;<span class="op" id="6315853">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315858">h</span><span class="op" id="6315859">.</span><span class="ident" id="6315860">printf</span><span class="op" id="6315866">(</span><span class="string" id="6315867">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="6315895">,</span>&nbsp;<span class="builtintype" id="6315897">string</span><span class="op" id="6315903">(</span><span class="ident" id="6315904">line</span><span class="op" id="6315908">)</span><span class="op" id="6315909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315914">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315929">header</span><span class="op" id="6315935">,</span>&nbsp;<span class="ident" id="6315937">val</span>&nbsp;<span class="op" id="6315941">:=</span>&nbsp;<span class="ident" id="6315944">parts</span><span class="op" id="6315949">[</span><span class="num" id="6315950">0</span><span class="op" id="6315951">]</span><span class="op" id="6315952">,</span>&nbsp;<span class="ident" id="6315954">parts</span><span class="op" id="6315959">[</span><span class="num" id="6315960">1</span><span class="op" id="6315961">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315965">header</span>&nbsp;<span class="op" id="6315972">=</span>&nbsp;<span class="ident" id="6315974">strings</span><span class="op" id="6315981">.</span><span class="ident" id="6315982">TrimSpace</span><span class="op" id="6315991">(</span><span class="ident" id="6315992">header</span><span class="op" id="6315998">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316002">val</span>&nbsp;<span class="op" id="6316006">=</span>&nbsp;<span class="ident" id="6316008">strings</span><span class="op" id="6316015">.</span><span class="ident" id="6316016">TrimSpace</span><span class="op" id="6316025">(</span><span class="ident" id="6316026">val</span><span class="op" id="6316029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316033">switch</span>&nbsp;<span class="op" id="6316040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316044">case</span>&nbsp;<span class="ident" id="6316049">header</span>&nbsp;<span class="op" id="6316056">==</span>&nbsp;<span class="string" id="6316059">&#34;Status&#34;</span><span class="op" id="6316067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316072">if</span>&nbsp;<span class="builtinfunc" id="6316075">len</span><span class="op" id="6316078">(</span><span class="ident" id="6316079">val</span><span class="op" id="6316082">)</span>&nbsp;<span class="op" id="6316084">&lt;</span>&nbsp;<span class="num" id="6316086">3</span>&nbsp;<span class="op" id="6316088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316094">h</span><span class="op" id="6316095">.</span><span class="ident" id="6316096">printf</span><span class="op" id="6316102">(</span><span class="string" id="6316103">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="6316134">,</span>&nbsp;<span class="ident" id="6316136">val</span><span class="op" id="6316139">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316160">code</span><span class="op" id="6316164">,</span>&nbsp;<span class="ident" id="6316166">err</span>&nbsp;<span class="op" id="6316170">:=</span>&nbsp;<span class="ident" id="6316173">strconv</span><span class="op" id="6316180">.</span><span class="ident" id="6316181">Atoi</span><span class="op" id="6316185">(</span><span class="ident" id="6316186">val</span><span class="op" id="6316189">[</span><span class="num" id="6316190">0</span><span class="op" id="6316191">:</span><span class="num" id="6316192">3</span><span class="op" id="6316193">]</span><span class="op" id="6316194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316199">if</span>&nbsp;<span class="ident" id="6316202">err</span>&nbsp;<span class="op" id="6316206">!=</span>&nbsp;<span class="ident" id="6316209">nil</span>&nbsp;<span class="op" id="6316213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316219">h</span><span class="op" id="6316220">.</span><span class="ident" id="6316221">printf</span><span class="op" id="6316227">(</span><span class="string" id="6316228">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="6316251">,</span>&nbsp;<span class="ident" id="6316253">val</span><span class="op" id="6316256">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316262">h</span><span class="op" id="6316263">.</span><span class="ident" id="6316264">printf</span><span class="op" id="6316270">(</span><span class="string" id="6316271">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="6316289">,</span>&nbsp;<span class="ident" id="6316291">line</span><span class="op" id="6316295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316301">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316316">statusCode</span>&nbsp;<span class="op" id="6316327">=</span>&nbsp;<span class="ident" id="6316329">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316336">default</span><span class="op" id="6316343">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316348">headers</span><span class="op" id="6316355">.</span><span class="ident" id="6316356">Add</span><span class="op" id="6316359">(</span><span class="ident" id="6316360">header</span><span class="op" id="6316366">,</span>&nbsp;<span class="ident" id="6316368">val</span><span class="op" id="6316371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316381">if</span>&nbsp;<span class="ident" id="6316384">headerLines</span>&nbsp;<span class="op" id="6316396">==</span>&nbsp;<span class="num" id="6316399">0</span>&nbsp;<span class="op" id="6316401">||</span>&nbsp;<span class="op" id="6316404">!</span><span class="ident" id="6316405">sawBlankLine</span>&nbsp;<span class="op" id="6316418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316422">rw</span><span class="op" id="6316424">.</span><span class="ident" id="6316425">WriteHeader</span><span class="op" id="6316436">(</span><span class="ident" id="6316437">http</span><span class="op" id="6316441">.</span><span class="ident" id="6316442">StatusInternalServerError</span><span class="op" id="6316467">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316471">h</span><span class="op" id="6316472">.</span><span class="ident" id="6316473">printf</span><span class="op" id="6316479">(</span><span class="string" id="6316480">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="6316497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316501">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316513">if</span>&nbsp;<span class="ident" id="6316516">loc</span>&nbsp;<span class="op" id="6316520">:=</span>&nbsp;<span class="ident" id="6316523">headers</span><span class="op" id="6316530">.</span><span class="ident" id="6316531">Get</span><span class="op" id="6316534">(</span><span class="string" id="6316535">&#34;Location&#34;</span><span class="op" id="6316545">)</span><span class="op" id="6316546">;</span>&nbsp;<span class="ident" id="6316548">loc</span>&nbsp;<span class="op" id="6316552">!=</span>&nbsp;<span class="string" id="6316555">&#34;&#34;</span>&nbsp;<span class="op" id="6316558">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316562">if</span>&nbsp;<span class="ident" id="6316565">strings</span><span class="op" id="6316572">.</span><span class="ident" id="6316573">HasPrefix</span><span class="op" id="6316582">(</span><span class="ident" id="6316583">loc</span><span class="op" id="6316586">,</span>&nbsp;<span class="string" id="6316588">&#34;/&#34;</span><span class="op" id="6316591">)</span>&nbsp;<span class="op" id="6316593">&amp;&amp;</span>&nbsp;<span class="ident" id="6316596">h</span><span class="op" id="6316597">.</span><span class="ident" id="6316598">PathLocationHandler</span>&nbsp;<span class="op" id="6316618">!=</span>&nbsp;<span class="ident" id="6316621">nil</span>&nbsp;<span class="op" id="6316625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316630">h</span><span class="op" id="6316631">.</span><span class="ident" id="6316632">handleInternalRedirect</span><span class="op" id="6316654">(</span><span class="ident" id="6316655">rw</span><span class="op" id="6316657">,</span>&nbsp;<span class="ident" id="6316659">req</span><span class="op" id="6316662">,</span>&nbsp;<span class="ident" id="6316664">loc</span><span class="op" id="6316667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316685">if</span>&nbsp;<span class="ident" id="6316688">statusCode</span>&nbsp;<span class="op" id="6316699">==</span>&nbsp;<span class="num" id="6316702">0</span>&nbsp;<span class="op" id="6316704">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316709">statusCode</span>&nbsp;<span class="op" id="6316720">=</span>&nbsp;<span class="ident" id="6316722">http</span><span class="op" id="6316726">.</span><span class="ident" id="6316727">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316748">if</span>&nbsp;<span class="ident" id="6316751">statusCode</span>&nbsp;<span class="op" id="6316762">==</span>&nbsp;<span class="num" id="6316765">0</span>&nbsp;<span class="op" id="6316767">&amp;&amp;</span>&nbsp;<span class="ident" id="6316770">headers</span><span class="op" id="6316777">.</span><span class="ident" id="6316778">Get</span><span class="op" id="6316781">(</span><span class="string" id="6316782">&#34;Content-Type&#34;</span><span class="op" id="6316796">)</span>&nbsp;<span class="op" id="6316798">==</span>&nbsp;<span class="string" id="6316801">&#34;&#34;</span>&nbsp;<span class="op" id="6316804">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316808">rw</span><span class="op" id="6316810">.</span><span class="ident" id="6316811">WriteHeader</span><span class="op" id="6316822">(</span><span class="ident" id="6316823">http</span><span class="op" id="6316827">.</span><span class="ident" id="6316828">StatusInternalServerError</span><span class="op" id="6316853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316857">h</span><span class="op" id="6316858">.</span><span class="ident" id="6316859">printf</span><span class="op" id="6316865">(</span><span class="string" id="6316866">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="6316913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316929">if</span>&nbsp;<span class="ident" id="6316932">statusCode</span>&nbsp;<span class="op" id="6316943">==</span>&nbsp;<span class="num" id="6316946">0</span>&nbsp;<span class="op" id="6316948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316952">statusCode</span>&nbsp;<span class="op" id="6316963">=</span>&nbsp;<span class="ident" id="6316965">http</span><span class="op" id="6316969">.</span><span class="ident" id="6316970">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316984">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317045">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317105">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317139">for</span>&nbsp;<span class="ident" id="6317143">k</span><span class="op" id="6317144">,</span>&nbsp;<span class="ident" id="6317146">vv</span>&nbsp;<span class="op" id="6317149">:=</span>&nbsp;<span class="keyword" id="6317152">range</span>&nbsp;<span class="ident" id="6317158">headers</span>&nbsp;<span class="op" id="6317166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317170">for</span>&nbsp;<span class="ident" id="6317174">_</span><span class="op" id="6317175">,</span>&nbsp;<span class="ident" id="6317177">v</span>&nbsp;<span class="op" id="6317179">:=</span>&nbsp;<span class="keyword" id="6317182">range</span>&nbsp;<span class="ident" id="6317188">vv</span>&nbsp;<span class="op" id="6317191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317196">rw</span><span class="op" id="6317198">.</span><span class="ident" id="6317199">Header</span><span class="op" id="6317205">(</span><span class="op" id="6317206">)</span><span class="op" id="6317207">.</span><span class="ident" id="6317208">Add</span><span class="op" id="6317211">(</span><span class="ident" id="6317212">k</span><span class="op" id="6317213">,</span>&nbsp;<span class="ident" id="6317215">v</span><span class="op" id="6317216">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317227">rw</span><span class="op" id="6317229">.</span><span class="ident" id="6317230">WriteHeader</span><span class="op" id="6317241">(</span><span class="ident" id="6317242">statusCode</span><span class="op" id="6317252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317256">_</span><span class="op" id="6317257">,</span>&nbsp;<span class="ident" id="6317259">err</span>&nbsp;<span class="op" id="6317263">=</span>&nbsp;<span class="ident" id="6317265">io</span><span class="op" id="6317267">.</span><span class="ident" id="6317268">Copy</span><span class="op" id="6317272">(</span><span class="ident" id="6317273">rw</span><span class="op" id="6317275">,</span>&nbsp;<span class="ident" id="6317277">linebody</span><span class="op" id="6317285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317288">if</span>&nbsp;<span class="ident" id="6317291">err</span>&nbsp;<span class="op" id="6317295">!=</span>&nbsp;<span class="ident" id="6317298">nil</span>&nbsp;<span class="op" id="6317302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317306">h</span><span class="op" id="6317307">.</span><span class="ident" id="6317308">printf</span><span class="op" id="6317314">(</span><span class="string" id="6317315">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6317336">,</span>&nbsp;<span class="ident" id="6317338">err</span><span class="op" id="6317341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317345">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317401">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317456">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317512">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317565">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317623">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317667">cmd</span><span class="op" id="6317670">.</span><span class="ident" id="6317671">Process</span><span class="op" id="6317678">.</span><span class="ident" id="6317679">Kill</span><span class="op" id="6317683">(</span><span class="op" id="6317684">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317687">}</span><br>
<span class="lineno"></span><span class="op" id="6317689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317692">func</span>&nbsp;<span class="op" id="6317697">(</span><span class="ident" id="6317698">h</span>&nbsp;<span class="op" id="6317700">*</span><span class="ident" id="6317701">Handler</span><span class="op" id="6317708">)</span>&nbsp;<span class="ident" id="6317710">printf</span><span class="op" id="6317716">(</span><span class="ident" id="6317717">format</span>&nbsp;<span class="builtintype" id="6317724">string</span><span class="op" id="6317730">,</span>&nbsp;<span class="ident" id="6317732">v</span>&nbsp;<span class="op" id="6317734">...</span><span class="keyword" id="6317737">interface</span><span class="op" id="6317746">{</span><span class="op" id="6317747">}</span><span class="op" id="6317748">)</span>&nbsp;<span class="op" id="6317750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317753">if</span>&nbsp;<span class="ident" id="6317756">h</span><span class="op" id="6317757">.</span><span class="ident" id="6317758">Logger</span>&nbsp;<span class="op" id="6317765">!=</span>&nbsp;<span class="ident" id="6317768">nil</span>&nbsp;<span class="op" id="6317772">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317776">h</span><span class="op" id="6317777">.</span><span class="ident" id="6317778">Logger</span><span class="op" id="6317784">.</span><span class="ident" id="6317785">Printf</span><span class="op" id="6317791">(</span><span class="ident" id="6317792">format</span><span class="op" id="6317798">,</span>&nbsp;<span class="ident" id="6317800">v</span><span class="op" id="6317801">...</span><span class="op" id="6317804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317807">}</span>&nbsp;<span class="keyword" id="6317809">else</span>&nbsp;<span class="op" id="6317814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317818">log</span><span class="op" id="6317821">.</span><span class="ident" id="6317822">Printf</span><span class="op" id="6317828">(</span><span class="ident" id="6317829">format</span><span class="op" id="6317835">,</span>&nbsp;<span class="ident" id="6317837">v</span><span class="op" id="6317838">...</span><span class="op" id="6317841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317844">}</span><br>
<span class="lineno"></span><span class="op" id="6317846">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="6317849">func</span>&nbsp;<span class="op" id="6317854">(</span><span class="ident" id="6317855">h</span>&nbsp;<span class="op" id="6317857">*</span><span class="ident" id="6317858">Handler</span><span class="op" id="6317865">)</span>&nbsp;<span class="ident" id="6317867">handleInternalRedirect</span><span class="op" id="6317889">(</span><span class="ident" id="6317890">rw</span>&nbsp;<span class="ident" id="6317893">http</span><span class="op" id="6317897">.</span><span class="ident" id="6317898">ResponseWriter</span><span class="op" id="6317912">,</span>&nbsp;<span class="ident" id="6317914">req</span>&nbsp;<span class="op" id="6317918">*</span><span class="ident" id="6317919">http</span><span class="op" id="6317923">.</span><span class="ident" id="6317924">Request</span><span class="op" id="6317931">,</span>&nbsp;<span class="ident" id="6317933">path</span>&nbsp;<span class="builtintype" id="6317938">string</span><span class="op" id="6317944">)</span>&nbsp;<span class="op" id="6317946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317949">url</span><span class="op" id="6317952">,</span>&nbsp;<span class="ident" id="6317954">err</span>&nbsp;<span class="op" id="6317958">:=</span>&nbsp;<span class="ident" id="6317961">req</span><span class="op" id="6317964">.</span><span class="ident" id="6317965">URL</span><span class="op" id="6317968">.</span><span class="ident" id="6317969">Parse</span><span class="op" id="6317974">(</span><span class="ident" id="6317975">path</span><span class="op" id="6317979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317982">if</span>&nbsp;<span class="ident" id="6317985">err</span>&nbsp;<span class="op" id="6317989">!=</span>&nbsp;<span class="ident" id="6317992">nil</span>&nbsp;<span class="op" id="6317996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318000">rw</span><span class="op" id="6318002">.</span><span class="ident" id="6318003">WriteHeader</span><span class="op" id="6318014">(</span><span class="ident" id="6318015">http</span><span class="op" id="6318019">.</span><span class="ident" id="6318020">StatusInternalServerError</span><span class="op" id="6318045">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318049">h</span><span class="op" id="6318050">.</span><span class="ident" id="6318051">printf</span><span class="op" id="6318057">(</span><span class="string" id="6318058">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="6318102">,</span>&nbsp;<span class="ident" id="6318104">path</span><span class="op" id="6318108">,</span>&nbsp;<span class="ident" id="6318110">err</span><span class="op" id="6318113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318128">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318192">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318253">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318315">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318376">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318438">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318499">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318552">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318614">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318634">newReq</span>&nbsp;<span class="op" id="6318641">:=</span>&nbsp;<span class="op" id="6318644">&amp;</span><span class="ident" id="6318645">http</span><span class="op" id="6318649">.</span><span class="ident" id="6318650">Request</span><span class="op" id="6318657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318661">Method</span><span class="op" id="6318667">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6318673">&#34;GET&#34;</span><span class="op" id="6318678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318682">URL</span><span class="op" id="6318685">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318694">url</span><span class="op" id="6318697">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318701">Proto</span><span class="op" id="6318706">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6318713">&#34;HTTP/1.1&#34;</span><span class="op" id="6318723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318727">ProtoMajor</span><span class="op" id="6318737">:</span>&nbsp;<span class="num" id="6318739">1</span><span class="op" id="6318740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318744">ProtoMinor</span><span class="op" id="6318754">:</span>&nbsp;<span class="num" id="6318756">1</span><span class="op" id="6318757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318761">Header</span><span class="op" id="6318767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6318773">make</span><span class="op" id="6318777">(</span><span class="ident" id="6318778">http</span><span class="op" id="6318782">.</span><span class="ident" id="6318783">Header</span><span class="op" id="6318789">)</span><span class="op" id="6318790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318794">Host</span><span class="op" id="6318798">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318806">url</span><span class="op" id="6318809">.</span><span class="ident" id="6318810">Host</span><span class="op" id="6318814">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318818">RemoteAddr</span><span class="op" id="6318828">:</span>&nbsp;<span class="ident" id="6318830">req</span><span class="op" id="6318833">.</span><span class="ident" id="6318834">RemoteAddr</span><span class="op" id="6318844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318848">TLS</span><span class="op" id="6318851">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318860">req</span><span class="op" id="6318863">.</span><span class="ident" id="6318864">TLS</span><span class="op" id="6318867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318873">h</span><span class="op" id="6318874">.</span><span class="ident" id="6318875">PathLocationHandler</span><span class="op" id="6318894">.</span><span class="ident" id="6318895">ServeHTTP</span><span class="op" id="6318904">(</span><span class="ident" id="6318905">rw</span><span class="op" id="6318907">,</span>&nbsp;<span class="ident" id="6318909">newReq</span><span class="op" id="6318915">)</span><br>
<span class="lineno"></span><span class="op" id="6318917">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="6318920">func</span>&nbsp;<span class="ident" id="6318925">upperCaseAndUnderscore</span><span class="op" id="6318947">(</span><span class="ident" id="6318948">r</span>&nbsp;<span class="builtintype" id="6318950">rune</span><span class="op" id="6318954">)</span>&nbsp;<span class="builtintype" id="6318956">rune</span>&nbsp;<span class="op" id="6318961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318964">switch</span>&nbsp;<span class="op" id="6318971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318974">case</span>&nbsp;<span class="ident" id="6318979">r</span>&nbsp;<span class="op" id="6318981">&gt;=</span>&nbsp;<span class="string" id="6318984">&#39;a&#39;</span>&nbsp;<span class="op" id="6318988">&amp;&amp;</span>&nbsp;<span class="ident" id="6318991">r</span>&nbsp;<span class="op" id="6318993">&lt;=</span>&nbsp;<span class="string" id="6318996">&#39;z&#39;</span><span class="op" id="6318999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319003">return</span>&nbsp;<span class="ident" id="6319010">r</span>&nbsp;<span class="op" id="6319012">-</span>&nbsp;<span class="op" id="6319014">(</span><span class="string" id="6319015">&#39;a&#39;</span>&nbsp;<span class="op" id="6319019">-</span>&nbsp;<span class="string" id="6319021">&#39;A&#39;</span><span class="op" id="6319024">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319027">case</span>&nbsp;<span class="ident" id="6319032">r</span>&nbsp;<span class="op" id="6319034">==</span>&nbsp;<span class="string" id="6319037">&#39;-&#39;</span><span class="op" id="6319040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319044">return</span>&nbsp;<span class="string" id="6319051">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319056">case</span>&nbsp;<span class="ident" id="6319061">r</span>&nbsp;<span class="op" id="6319063">==</span>&nbsp;<span class="string" id="6319066">&#39;=&#39;</span><span class="op" id="6319069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319073">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319129">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319184">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319236">return</span>&nbsp;<span class="string" id="6319243">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319251">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319304">return</span>&nbsp;<span class="ident" id="6319311">r</span><br>
<span class="lineno">375</span><span class="op" id="6319313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6319316">var</span>&nbsp;<span class="ident" id="6319320">testHookStartProcess</span>&nbsp;<span class="keyword" id="6319341">func</span><span class="op" id="6319345">(</span><span class="op" id="6319346">*</span><span class="ident" id="6319347">os</span><span class="op" id="6319349">.</span><span class="ident" id="6319350">Process</span><span class="op" id="6319357">)</span>&nbsp;<span class="comment" id="6319359">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
