<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1862129">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1862184">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1862238">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1862289">package</span>&nbsp;<span class="ident" id="1862297">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1862305">import</span>&nbsp;<span class="op" id="1862312">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1862315">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1862324">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1862327">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1862403">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1862462">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1862515">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1862574">type</span>&nbsp;<span class="ident" id="1862579">Value</span>&nbsp;<span class="keyword" id="1862585">struct</span>&nbsp;<span class="op" id="1862592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862595">v</span>&nbsp;<span class="keyword" id="1862597">interface</span><span class="op" id="1862606">{</span><span class="op" id="1862607">}</span><br>
<span class="lineno"></span><span class="op" id="1862609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1862612">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1862666">type</span>&nbsp;<span class="ident" id="1862671">ifaceWords</span>&nbsp;<span class="keyword" id="1862682">struct</span>&nbsp;<span class="op" id="1862689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862692">typ</span>&nbsp;&nbsp;<span class="ident" id="1862697"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1862703">.</span><span class="ident" id="1862704">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862713">data</span>&nbsp;<span class="ident" id="1862718"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1862724">.</span><span class="ident" id="1862725">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1862733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1862736">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1862792">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1862861">func</span>&nbsp;<span class="op" id="1862866">(</span><span class="ident" id="1862867">v</span>&nbsp;<span class="op" id="1862869">*</span><span class="ident" id="1862870"><a href="/sync/atomic/value.go.html#1862579">Value</a></span><span class="op" id="1862875">)</span>&nbsp;<span class="ident" id="1862877">Load</span><span class="op" id="1862881">(</span><span class="op" id="1862882">)</span>&nbsp;<span class="op" id="1862884">(</span><span class="ident" id="1862885">x</span>&nbsp;<span class="keyword" id="1862887">interface</span><span class="op" id="1862896">{</span><span class="op" id="1862897">}</span><span class="op" id="1862898">)</span>&nbsp;<span class="op" id="1862900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862903">vp</span>&nbsp;<span class="op" id="1862906">:=</span>&nbsp;<span class="op" id="1862909">(</span><span class="op" id="1862910">*</span><span class="ident" id="1862911"><a href="/sync/atomic/value.go.html#1862671">ifaceWords</a></span><span class="op" id="1862921">)</span><span class="op" id="1862922">(</span><span class="ident" id="1862923"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1862929">.</span><span class="ident" id="1862930">Pointer</span><span class="op" id="1862937">(</span><span class="ident" id="1862938"><a href="/sync/atomic/value.go.html#1862867">v</a></span><span class="op" id="1862939">)</span><span class="op" id="1862940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862943">typ</span>&nbsp;<span class="op" id="1862947">:=</span>&nbsp;<span class="ident" id="1862950"><a href="/sync/atomic/doc.go.html#1861356">LoadPointer</a></span><span class="op" id="1862961">(</span><span class="op" id="1862962">&amp;</span><span class="ident" id="1862963"><a href="/sync/atomic/value.go.html#1862903">vp</a></span><span class="op" id="1862965">.</span><span class="ident" id="1862966">typ</span><span class="op" id="1862969">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862972">if</span>&nbsp;<span class="ident" id="1862975"><a href="/sync/atomic/value.go.html#1862943">typ</a></span>&nbsp;<span class="op" id="1862979">==</span>&nbsp;<span class="ident" id="1862982">nil</span>&nbsp;<span class="op" id="1862986">||</span>&nbsp;<span class="builtintype" id="1862989">uintptr</span><span class="op" id="1862996">(</span><span class="ident" id="1862997"><a href="/sync/atomic/value.go.html#1862943">typ</a></span><span class="op" id="1863000">)</span>&nbsp;<span class="op" id="1863002">==</span>&nbsp;<span class="op" id="1863005">^</span><span class="builtintype" id="1863006">uintptr</span><span class="op" id="1863013">(</span><span class="num" id="1863014">0</span><span class="op" id="1863015">)</span>&nbsp;<span class="op" id="1863017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863021">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863057">return</span>&nbsp;<span class="ident" id="1863064">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863072">data</span>&nbsp;<span class="op" id="1863077">:=</span>&nbsp;<span class="ident" id="1863080"><a href="/sync/atomic/doc.go.html#1861356">LoadPointer</a></span><span class="op" id="1863091">(</span><span class="op" id="1863092">&amp;</span><span class="ident" id="1863093"><a href="/sync/atomic/value.go.html#1862903">vp</a></span><span class="op" id="1863095">.</span><span class="ident" id="1863096">data</span><span class="op" id="1863100">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863103">xp</span>&nbsp;<span class="op" id="1863106">:=</span>&nbsp;<span class="op" id="1863109">(</span><span class="op" id="1863110">*</span><span class="ident" id="1863111"><a href="/sync/atomic/value.go.html#1862671">ifaceWords</a></span><span class="op" id="1863121">)</span><span class="op" id="1863122">(</span><span class="ident" id="1863123"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1863129">.</span><span class="ident" id="1863130">Pointer</span><span class="op" id="1863137">(</span><span class="op" id="1863138">&amp;</span><span class="ident" id="1863139"><a href="/sync/atomic/value.go.html#1862885">x</a></span><span class="op" id="1863140">)</span><span class="op" id="1863141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863144"><a href="/sync/atomic/value.go.html#1863103">xp</a></span><span class="op" id="1863146">.</span><span class="ident" id="1863147">typ</span>&nbsp;<span class="op" id="1863151">=</span>&nbsp;<span class="ident" id="1863153"><a href="/sync/atomic/value.go.html#1862943">typ</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863158"><a href="/sync/atomic/value.go.html#1863103">xp</a></span><span class="op" id="1863160">.</span><span class="ident" id="1863161">data</span>&nbsp;<span class="op" id="1863166">=</span>&nbsp;<span class="ident" id="1863168"><a href="/sync/atomic/value.go.html#1863072">data</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863174">return</span><br>
<span class="lineno"></span><span class="op" id="1863181">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1863184">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1863227">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1863310">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1863371">func</span>&nbsp;<span class="op" id="1863376">(</span><span class="ident" id="1863377">v</span>&nbsp;<span class="op" id="1863379">*</span><span class="ident" id="1863380"><a href="/sync/atomic/value.go.html#1862579">Value</a></span><span class="op" id="1863385">)</span>&nbsp;<span class="ident" id="1863387">Store</span><span class="op" id="1863392">(</span><span class="ident" id="1863393">x</span>&nbsp;<span class="keyword" id="1863395">interface</span><span class="op" id="1863404">{</span><span class="op" id="1863405">}</span><span class="op" id="1863406">)</span>&nbsp;<span class="op" id="1863408">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863411">if</span>&nbsp;<span class="ident" id="1863414"><a href="/sync/atomic/value.go.html#1863393">x</a></span>&nbsp;<span class="op" id="1863416">==</span>&nbsp;<span class="ident" id="1863419">nil</span>&nbsp;<span class="op" id="1863423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1863427">panic</span><span class="op" id="1863432">(</span><span class="string" id="1863433">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1863477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863483">vp</span>&nbsp;<span class="op" id="1863486">:=</span>&nbsp;<span class="op" id="1863489">(</span><span class="op" id="1863490">*</span><span class="ident" id="1863491"><a href="/sync/atomic/value.go.html#1862671">ifaceWords</a></span><span class="op" id="1863501">)</span><span class="op" id="1863502">(</span><span class="ident" id="1863503"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1863509">.</span><span class="ident" id="1863510">Pointer</span><span class="op" id="1863517">(</span><span class="ident" id="1863518"><a href="/sync/atomic/value.go.html#1863377">v</a></span><span class="op" id="1863519">)</span><span class="op" id="1863520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863523">xp</span>&nbsp;<span class="op" id="1863526">:=</span>&nbsp;<span class="op" id="1863529">(</span><span class="op" id="1863530">*</span><span class="ident" id="1863531"><a href="/sync/atomic/value.go.html#1862671">ifaceWords</a></span><span class="op" id="1863541">)</span><span class="op" id="1863542">(</span><span class="ident" id="1863543"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1863549">.</span><span class="ident" id="1863550">Pointer</span><span class="op" id="1863557">(</span><span class="op" id="1863558">&amp;</span><span class="ident" id="1863559"><a href="/sync/atomic/value.go.html#1863393">x</a></span><span class="op" id="1863560">)</span><span class="op" id="1863561">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863564">for</span>&nbsp;<span class="op" id="1863568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863572">typ</span>&nbsp;<span class="op" id="1863576">:=</span>&nbsp;<span class="ident" id="1863579"><a href="/sync/atomic/doc.go.html#1861356">LoadPointer</a></span><span class="op" id="1863590">(</span><span class="op" id="1863591">&amp;</span><span class="ident" id="1863592"><a href="/sync/atomic/value.go.html#1863483">vp</a></span><span class="op" id="1863594">.</span><span class="ident" id="1863595">typ</span><span class="op" id="1863598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863602">if</span>&nbsp;<span class="ident" id="1863605"><a href="/sync/atomic/value.go.html#1863572">typ</a></span>&nbsp;<span class="op" id="1863609">==</span>&nbsp;<span class="ident" id="1863612">nil</span>&nbsp;<span class="op" id="1863616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863621">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863657">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863715">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863774">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863824"><a href="/sync/atomic/value.go.html#1864541">runtime_procPin</a></span><span class="op" id="1863839">(</span><span class="op" id="1863840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863845">if</span>&nbsp;<span class="op" id="1863848">!</span><span class="ident" id="1863849"><a href="/sync/atomic/doc.go.html#1859878">CompareAndSwapPointer</a></span><span class="op" id="1863870">(</span><span class="op" id="1863871">&amp;</span><span class="ident" id="1863872"><a href="/sync/atomic/value.go.html#1863483">vp</a></span><span class="op" id="1863874">.</span><span class="ident" id="1863875">typ</span><span class="op" id="1863878">,</span>&nbsp;<span class="ident" id="1863880">nil</span><span class="op" id="1863883">,</span>&nbsp;<span class="ident" id="1863885"><a href="/sync/atomic/value.go.html#1862315">unsafe</a></span><span class="op" id="1863891">.</span><span class="ident" id="1863892">Pointer</span><span class="op" id="1863899">(</span><span class="op" id="1863900">^</span><span class="builtintype" id="1863901">uintptr</span><span class="op" id="1863908">(</span><span class="num" id="1863909">0</span><span class="op" id="1863910">)</span><span class="op" id="1863911">)</span><span class="op" id="1863912">)</span>&nbsp;<span class="op" id="1863914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863920"><a href="/sync/atomic/value.go.html#1864564">runtime_procUnpin</a></span><span class="op" id="1863937">(</span><span class="op" id="1863938">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863944">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863961">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863989"><a href="/sync/atomic/doc.go.html#1861928">StorePointer</a></span><span class="op" id="1864001">(</span><span class="op" id="1864002">&amp;</span><span class="ident" id="1864003"><a href="/sync/atomic/value.go.html#1863483">vp</a></span><span class="op" id="1864005">.</span><span class="ident" id="1864006">data</span><span class="op" id="1864010">,</span>&nbsp;<span class="ident" id="1864012"><a href="/sync/atomic/value.go.html#1863523">xp</a></span><span class="op" id="1864014">.</span><span class="ident" id="1864015">data</span><span class="op" id="1864019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864024"><a href="/sync/atomic/doc.go.html#1861928">StorePointer</a></span><span class="op" id="1864036">(</span><span class="op" id="1864037">&amp;</span><span class="ident" id="1864038"><a href="/sync/atomic/value.go.html#1863483">vp</a></span><span class="op" id="1864040">.</span><span class="ident" id="1864041">typ</span><span class="op" id="1864044">,</span>&nbsp;<span class="ident" id="1864046"><a href="/sync/atomic/value.go.html#1863523">xp</a></span><span class="op" id="1864048">.</span><span class="ident" id="1864049">typ</span><span class="op" id="1864052">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864057"><a href="/sync/atomic/value.go.html#1864564">runtime_procUnpin</a></span><span class="op" id="1864074">(</span><span class="op" id="1864075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864093">if</span>&nbsp;<span class="builtintype" id="1864096">uintptr</span><span class="op" id="1864103">(</span><span class="ident" id="1864104"><a href="/sync/atomic/value.go.html#1863572">typ</a></span><span class="op" id="1864107">)</span>&nbsp;<span class="op" id="1864109">==</span>&nbsp;<span class="op" id="1864112">^</span><span class="builtintype" id="1864113">uintptr</span><span class="op" id="1864120">(</span><span class="num" id="1864121">0</span><span class="op" id="1864122">)</span>&nbsp;<span class="op" id="1864124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1864129">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1864166">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1864224">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864264">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1864279">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864338">if</span>&nbsp;<span class="ident" id="1864341"><a href="/sync/atomic/value.go.html#1863572">typ</a></span>&nbsp;<span class="op" id="1864345">!=</span>&nbsp;<span class="ident" id="1864348"><a href="/sync/atomic/value.go.html#1863523">xp</a></span><span class="op" id="1864350">.</span><span class="ident" id="1864351">typ</span>&nbsp;<span class="op" id="1864355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1864360">panic</span><span class="op" id="1864365">(</span><span class="string" id="1864366">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1864427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864435"><a href="/sync/atomic/doc.go.html#1861928">StorePointer</a></span><span class="op" id="1864447">(</span><span class="op" id="1864448">&amp;</span><span class="ident" id="1864449"><a href="/sync/atomic/value.go.html#1863483">vp</a></span><span class="op" id="1864451">.</span><span class="ident" id="1864452">data</span><span class="op" id="1864456">,</span>&nbsp;<span class="ident" id="1864458"><a href="/sync/atomic/value.go.html#1863523">xp</a></span><span class="op" id="1864460">.</span><span class="ident" id="1864461">data</span><span class="op" id="1864465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864469">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864477">}</span><br>
<span class="lineno"></span><span class="op" id="1864479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1864482">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1864536">func</span>&nbsp;<span class="ident" id="1864541">runtime_procPin</span><span class="op" id="1864556">(</span><span class="op" id="1864557">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1864559">func</span>&nbsp;<span class="ident" id="1864564">runtime_procUnpin</span><span class="op" id="1864581">(</span><span class="op" id="1864582">)</span>
</div>
</body>
</html>
