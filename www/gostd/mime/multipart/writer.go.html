<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3941399">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3941454">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3941508">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3941559">package</span>&nbsp;<span class="ident" id="3941567">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3941578">import</span>&nbsp;<span class="op" id="3941585">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941588">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941597">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941612">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941622">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941629">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941635">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3941652">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3941662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3941665">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3941707">type</span>&nbsp;<span class="ident" id="3941712">Writer</span>&nbsp;<span class="keyword" id="3941719">struct</span>&nbsp;<span class="op" id="3941726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941729">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941738">io</span><span class="op" id="3941740">.</span><span class="ident" id="3941741">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941749">boundary</span>&nbsp;<span class="builtintype" id="3941758">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941766">lastpart</span>&nbsp;<span class="op" id="3941775">*</span><span class="ident" id="3941776">part</span><br>
<span class="lineno"></span><span class="op" id="3941781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3941784">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3941852">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3941869">func</span>&nbsp;<span class="ident" id="3941874">NewWriter</span><span class="op" id="3941883">(</span><span class="ident" id="3941884">w</span>&nbsp;<span class="ident" id="3941886">io</span><span class="op" id="3941888">.</span><span class="ident" id="3941889">Writer</span><span class="op" id="3941895">)</span>&nbsp;<span class="op" id="3941897">*</span><span class="ident" id="3941898">Writer</span>&nbsp;<span class="op" id="3941905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941908">return</span>&nbsp;<span class="op" id="3941915">&amp;</span><span class="ident" id="3941916">Writer</span><span class="op" id="3941922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941926">w</span><span class="op" id="3941927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941936">w</span><span class="op" id="3941937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941941">boundary</span><span class="op" id="3941949">:</span>&nbsp;<span class="ident" id="3941951">randomBoundary</span><span class="op" id="3941965">(</span><span class="op" id="3941966">)</span><span class="op" id="3941967">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3941970">}</span><br>
<span class="lineno"></span><span class="op" id="3941972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3941975">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3942018">func</span>&nbsp;<span class="op" id="3942023">(</span><span class="ident" id="3942024">w</span>&nbsp;<span class="op" id="3942026">*</span><span class="ident" id="3942027">Writer</span><span class="op" id="3942033">)</span>&nbsp;<span class="ident" id="3942035">Boundary</span><span class="op" id="3942043">(</span><span class="op" id="3942044">)</span>&nbsp;<span class="builtintype" id="3942046">string</span>&nbsp;<span class="op" id="3942053">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942056">return</span>&nbsp;<span class="ident" id="3942063">w</span><span class="op" id="3942064">.</span><span class="ident" id="3942065">boundary</span><br>
<span class="lineno"></span><span class="op" id="3942074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3942077">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3942142">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3942188">//</span><br>
<span class="lineno"></span><span class="comment" id="3942191">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3942260">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3942326">func</span>&nbsp;<span class="op" id="3942331">(</span><span class="ident" id="3942332">w</span>&nbsp;<span class="op" id="3942334">*</span><span class="ident" id="3942335">Writer</span><span class="op" id="3942341">)</span>&nbsp;<span class="ident" id="3942343">SetBoundary</span><span class="op" id="3942354">(</span><span class="ident" id="3942355">boundary</span>&nbsp;<span class="builtintype" id="3942364">string</span><span class="op" id="3942370">)</span>&nbsp;<span class="builtintype" id="3942372">error</span>&nbsp;<span class="op" id="3942378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942381">if</span>&nbsp;<span class="ident" id="3942384">w</span><span class="op" id="3942385">.</span><span class="ident" id="3942386">lastpart</span>&nbsp;<span class="op" id="3942395">!=</span>&nbsp;<span class="builtintype" id="3942398">nil</span>&nbsp;<span class="op" id="3942402">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942406">return</span>&nbsp;<span class="ident" id="3942413">errors</span><span class="op" id="3942419">.</span><span class="ident" id="3942420">New</span><span class="op" id="3942423">(</span><span class="string" id="3942424">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3942462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3942465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3942468">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942494">if</span>&nbsp;<span class="builtinfunc" id="3942497">len</span><span class="op" id="3942500">(</span><span class="ident" id="3942501">boundary</span><span class="op" id="3942509">)</span>&nbsp;<span class="op" id="3942511">&lt;</span>&nbsp;<span class="num" id="3942513">1</span>&nbsp;<span class="op" id="3942515">||</span>&nbsp;<span class="builtinfunc" id="3942518">len</span><span class="op" id="3942521">(</span><span class="ident" id="3942522">boundary</span><span class="op" id="3942530">)</span>&nbsp;<span class="op" id="3942532">&gt;</span>&nbsp;<span class="num" id="3942534">69</span>&nbsp;<span class="op" id="3942537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942541">return</span>&nbsp;<span class="ident" id="3942548">errors</span><span class="op" id="3942554">.</span><span class="ident" id="3942555">New</span><span class="op" id="3942558">(</span><span class="string" id="3942559">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3942590">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3942593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942596">for</span>&nbsp;<span class="ident" id="3942600">_</span><span class="op" id="3942601">,</span>&nbsp;<span class="ident" id="3942603">b</span>&nbsp;<span class="op" id="3942605">:=</span>&nbsp;<span class="keyword" id="3942608">range</span>&nbsp;<span class="ident" id="3942614">boundary</span>&nbsp;<span class="op" id="3942623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942627">if</span>&nbsp;<span class="string" id="3942630">&#39;A&#39;</span>&nbsp;<span class="op" id="3942634">&lt;=</span>&nbsp;<span class="ident" id="3942637">b</span>&nbsp;<span class="op" id="3942639">&amp;&amp;</span>&nbsp;<span class="ident" id="3942642">b</span>&nbsp;<span class="op" id="3942644">&lt;=</span>&nbsp;<span class="string" id="3942647">&#39;Z&#39;</span>&nbsp;<span class="op" id="3942651">||</span>&nbsp;<span class="string" id="3942654">&#39;a&#39;</span>&nbsp;<span class="op" id="3942658">&lt;=</span>&nbsp;<span class="ident" id="3942661">b</span>&nbsp;<span class="op" id="3942663">&amp;&amp;</span>&nbsp;<span class="ident" id="3942666">b</span>&nbsp;<span class="op" id="3942668">&lt;=</span>&nbsp;<span class="string" id="3942671">&#39;z&#39;</span>&nbsp;<span class="op" id="3942675">||</span>&nbsp;<span class="string" id="3942678">&#39;0&#39;</span>&nbsp;<span class="op" id="3942682">&lt;=</span>&nbsp;<span class="ident" id="3942685">b</span>&nbsp;<span class="op" id="3942687">&amp;&amp;</span>&nbsp;<span class="ident" id="3942690">b</span>&nbsp;<span class="op" id="3942692">&lt;=</span>&nbsp;<span class="string" id="3942695">&#39;9&#39;</span>&nbsp;<span class="op" id="3942699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942704">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3942715">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942719">switch</span>&nbsp;<span class="ident" id="3942726">b</span>&nbsp;<span class="op" id="3942728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942732">case</span>&nbsp;<span class="string" id="3942737">&#39;\&#39;&#39;</span><span class="op" id="3942741">,</span>&nbsp;<span class="string" id="3942743">&#39;(&#39;</span><span class="op" id="3942746">,</span>&nbsp;<span class="string" id="3942748">&#39;)&#39;</span><span class="op" id="3942751">,</span>&nbsp;<span class="string" id="3942753">&#39;+&#39;</span><span class="op" id="3942756">,</span>&nbsp;<span class="string" id="3942758">&#39;_&#39;</span><span class="op" id="3942761">,</span>&nbsp;<span class="string" id="3942763">&#39;,&#39;</span><span class="op" id="3942766">,</span>&nbsp;<span class="string" id="3942768">&#39;-&#39;</span><span class="op" id="3942771">,</span>&nbsp;<span class="string" id="3942773">&#39;.&#39;</span><span class="op" id="3942776">,</span>&nbsp;<span class="string" id="3942778">&#39;/&#39;</span><span class="op" id="3942781">,</span>&nbsp;<span class="string" id="3942783">&#39;:&#39;</span><span class="op" id="3942786">,</span>&nbsp;<span class="string" id="3942788">&#39;=&#39;</span><span class="op" id="3942791">,</span>&nbsp;<span class="string" id="3942793">&#39;?&#39;</span><span class="op" id="3942796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942801">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3942812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942816">return</span>&nbsp;<span class="ident" id="3942823">errors</span><span class="op" id="3942829">.</span><span class="ident" id="3942830">New</span><span class="op" id="3942833">(</span><span class="string" id="3942834">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3942868">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3942871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3942874">w</span><span class="op" id="3942875">.</span><span class="ident" id="3942876">boundary</span>&nbsp;<span class="op" id="3942885">=</span>&nbsp;<span class="ident" id="3942887">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3942897">return</span>&nbsp;<span class="builtintype" id="3942904">nil</span><br>
<span class="lineno"></span><span class="op" id="3942908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3942911">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3942971">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3943023">func</span>&nbsp;<span class="op" id="3943028">(</span><span class="ident" id="3943029">w</span>&nbsp;<span class="op" id="3943031">*</span><span class="ident" id="3943032">Writer</span><span class="op" id="3943038">)</span>&nbsp;<span class="ident" id="3943040">FormDataContentType</span><span class="op" id="3943059">(</span><span class="op" id="3943060">)</span>&nbsp;<span class="builtintype" id="3943062">string</span>&nbsp;<span class="op" id="3943069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943072">return</span>&nbsp;<span class="string" id="3943079">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3943112">+</span>&nbsp;<span class="ident" id="3943114">w</span><span class="op" id="3943115">.</span><span class="ident" id="3943116">boundary</span><br>
<span class="lineno"></span><span class="op" id="3943125">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3943128">func</span>&nbsp;<span class="ident" id="3943133">randomBoundary</span><span class="op" id="3943147">(</span><span class="op" id="3943148">)</span>&nbsp;<span class="builtintype" id="3943150">string</span>&nbsp;<span class="op" id="3943157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943160">var</span>&nbsp;<span class="ident" id="3943164">buf</span>&nbsp;<span class="op" id="3943168">[</span><span class="num" id="3943169">30</span><span class="op" id="3943171">]</span><span class="builtintype" id="3943172">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943178">_</span><span class="op" id="3943179">,</span>&nbsp;<span class="ident" id="3943181">err</span>&nbsp;<span class="op" id="3943185">:=</span>&nbsp;<span class="ident" id="3943188">io</span><span class="op" id="3943190">.</span><span class="ident" id="3943191">ReadFull</span><span class="op" id="3943199">(</span><span class="ident" id="3943200">rand</span><span class="op" id="3943204">.</span><span class="ident" id="3943205">Reader</span><span class="op" id="3943211">,</span>&nbsp;<span class="ident" id="3943213">buf</span><span class="op" id="3943216">[</span><span class="op" id="3943217">:</span><span class="op" id="3943218">]</span><span class="op" id="3943219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943222">if</span>&nbsp;<span class="ident" id="3943225">err</span>&nbsp;<span class="op" id="3943229">!=</span>&nbsp;<span class="builtintype" id="3943232">nil</span>&nbsp;<span class="op" id="3943236">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3943240">panic</span><span class="op" id="3943245">(</span><span class="ident" id="3943246">err</span><span class="op" id="3943249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3943252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943255">return</span>&nbsp;<span class="ident" id="3943262">fmt</span><span class="op" id="3943265">.</span><span class="ident" id="3943266">Sprintf</span><span class="op" id="3943273">(</span><span class="string" id="3943274">&#34;%x&#34;</span><span class="op" id="3943278">,</span>&nbsp;<span class="ident" id="3943280">buf</span><span class="op" id="3943283">[</span><span class="op" id="3943284">:</span><span class="op" id="3943285">]</span><span class="op" id="3943286">)</span><br>
<span class="lineno"></span><span class="op" id="3943288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3943291">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3943355">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3943421">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3943490">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3943508">func</span>&nbsp;<span class="op" id="3943513">(</span><span class="ident" id="3943514">w</span>&nbsp;<span class="op" id="3943516">*</span><span class="ident" id="3943517">Writer</span><span class="op" id="3943523">)</span>&nbsp;<span class="ident" id="3943525">CreatePart</span><span class="op" id="3943535">(</span><span class="ident" id="3943536">header</span>&nbsp;<span class="ident" id="3943543">textproto</span><span class="op" id="3943552">.</span><span class="ident" id="3943553">MIMEHeader</span><span class="op" id="3943563">)</span>&nbsp;<span class="op" id="3943565">(</span><span class="ident" id="3943566">io</span><span class="op" id="3943568">.</span><span class="ident" id="3943569">Writer</span><span class="op" id="3943575">,</span>&nbsp;<span class="builtintype" id="3943577">error</span><span class="op" id="3943582">)</span>&nbsp;<span class="op" id="3943584">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943587">if</span>&nbsp;<span class="ident" id="3943590">w</span><span class="op" id="3943591">.</span><span class="ident" id="3943592">lastpart</span>&nbsp;<span class="op" id="3943601">!=</span>&nbsp;<span class="builtintype" id="3943604">nil</span>&nbsp;<span class="op" id="3943608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943612">if</span>&nbsp;<span class="ident" id="3943615">err</span>&nbsp;<span class="op" id="3943619">:=</span>&nbsp;<span class="ident" id="3943622">w</span><span class="op" id="3943623">.</span><span class="ident" id="3943624">lastpart</span><span class="op" id="3943632">.</span><span class="builtinfunc" id="3943633">close</span><span class="op" id="3943638">(</span><span class="op" id="3943639">)</span><span class="op" id="3943640">;</span>&nbsp;<span class="ident" id="3943642">err</span>&nbsp;<span class="op" id="3943646">!=</span>&nbsp;<span class="builtintype" id="3943649">nil</span>&nbsp;<span class="op" id="3943653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943658">return</span>&nbsp;<span class="builtintype" id="3943665">nil</span><span class="op" id="3943668">,</span>&nbsp;<span class="ident" id="3943670">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3943676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3943679">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943682">var</span>&nbsp;<span class="ident" id="3943686">b</span>&nbsp;<span class="ident" id="3943688">bytes</span><span class="op" id="3943693">.</span><span class="ident" id="3943694">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943702">if</span>&nbsp;<span class="ident" id="3943705">w</span><span class="op" id="3943706">.</span><span class="ident" id="3943707">lastpart</span>&nbsp;<span class="op" id="3943716">!=</span>&nbsp;<span class="builtintype" id="3943719">nil</span>&nbsp;<span class="op" id="3943723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943727">fmt</span><span class="op" id="3943730">.</span><span class="ident" id="3943731">Fprintf</span><span class="op" id="3943738">(</span><span class="op" id="3943739">&amp;</span><span class="ident" id="3943740">b</span><span class="op" id="3943741">,</span>&nbsp;<span class="string" id="3943743">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3943757">,</span>&nbsp;<span class="ident" id="3943759">w</span><span class="op" id="3943760">.</span><span class="ident" id="3943761">boundary</span><span class="op" id="3943769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3943772">}</span>&nbsp;<span class="keyword" id="3943774">else</span>&nbsp;<span class="op" id="3943779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943783">fmt</span><span class="op" id="3943786">.</span><span class="ident" id="3943787">Fprintf</span><span class="op" id="3943794">(</span><span class="op" id="3943795">&amp;</span><span class="ident" id="3943796">b</span><span class="op" id="3943797">,</span>&nbsp;<span class="string" id="3943799">&#34;--%s\r\n&#34;</span><span class="op" id="3943809">,</span>&nbsp;<span class="ident" id="3943811">w</span><span class="op" id="3943812">.</span><span class="ident" id="3943813">boundary</span><span class="op" id="3943821">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3943824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3943827">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3943904">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943951">for</span>&nbsp;<span class="ident" id="3943955">k</span><span class="op" id="3943956">,</span>&nbsp;<span class="ident" id="3943958">vv</span>&nbsp;<span class="op" id="3943961">:=</span>&nbsp;<span class="keyword" id="3943964">range</span>&nbsp;<span class="ident" id="3943970">header</span>&nbsp;<span class="op" id="3943977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3943981">for</span>&nbsp;<span class="ident" id="3943985">_</span><span class="op" id="3943986">,</span>&nbsp;<span class="ident" id="3943988">v</span>&nbsp;<span class="op" id="3943990">:=</span>&nbsp;<span class="keyword" id="3943993">range</span>&nbsp;<span class="ident" id="3943999">vv</span>&nbsp;<span class="op" id="3944002">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944007">fmt</span><span class="op" id="3944010">.</span><span class="ident" id="3944011">Fprintf</span><span class="op" id="3944018">(</span><span class="op" id="3944019">&amp;</span><span class="ident" id="3944020">b</span><span class="op" id="3944021">,</span>&nbsp;<span class="string" id="3944023">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3944035">,</span>&nbsp;<span class="ident" id="3944037">k</span><span class="op" id="3944038">,</span>&nbsp;<span class="ident" id="3944040">v</span><span class="op" id="3944041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3944045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3944048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944051">fmt</span><span class="op" id="3944054">.</span><span class="ident" id="3944055">Fprintf</span><span class="op" id="3944062">(</span><span class="op" id="3944063">&amp;</span><span class="ident" id="3944064">b</span><span class="op" id="3944065">,</span>&nbsp;<span class="string" id="3944067">&#34;\r\n&#34;</span><span class="op" id="3944073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944076">_</span><span class="op" id="3944077">,</span>&nbsp;<span class="ident" id="3944079">err</span>&nbsp;<span class="op" id="3944083">:=</span>&nbsp;<span class="ident" id="3944086">io</span><span class="op" id="3944088">.</span><span class="ident" id="3944089">Copy</span><span class="op" id="3944093">(</span><span class="ident" id="3944094">w</span><span class="op" id="3944095">.</span><span class="ident" id="3944096">w</span><span class="op" id="3944097">,</span>&nbsp;<span class="op" id="3944099">&amp;</span><span class="ident" id="3944100">b</span><span class="op" id="3944101">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3944104">if</span>&nbsp;<span class="ident" id="3944107">err</span>&nbsp;<span class="op" id="3944111">!=</span>&nbsp;<span class="builtintype" id="3944114">nil</span>&nbsp;<span class="op" id="3944118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3944122">return</span>&nbsp;<span class="builtintype" id="3944129">nil</span><span class="op" id="3944132">,</span>&nbsp;<span class="ident" id="3944134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3944139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944142">p</span>&nbsp;<span class="op" id="3944144">:=</span>&nbsp;<span class="op" id="3944147">&amp;</span><span class="ident" id="3944148">part</span><span class="op" id="3944152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944156">mw</span><span class="op" id="3944158">:</span>&nbsp;<span class="ident" id="3944160">w</span><span class="op" id="3944161">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3944164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944167">w</span><span class="op" id="3944168">.</span><span class="ident" id="3944169">lastpart</span>&nbsp;<span class="op" id="3944178">=</span>&nbsp;<span class="ident" id="3944180">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3944183">return</span>&nbsp;<span class="ident" id="3944190">p</span><span class="op" id="3944191">,</span>&nbsp;<span class="builtintype" id="3944193">nil</span><br>
<span class="lineno"></span><span class="op" id="3944197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3944200">var</span>&nbsp;<span class="ident" id="3944204">quoteEscaper</span>&nbsp;<span class="op" id="3944217">=</span>&nbsp;<span class="ident" id="3944219">strings</span><span class="op" id="3944226">.</span><span class="ident" id="3944227">NewReplacer</span><span class="op" id="3944238">(</span><span class="string" id="3944239">&#34;\\&#34;</span><span class="op" id="3944243">,</span>&nbsp;<span class="string" id="3944245">&#34;\\\\&#34;</span><span class="op" id="3944251">,</span>&nbsp;<span class="string" id="3944253">`&#34;`</span><span class="op" id="3944256">,</span>&nbsp;<span class="string" id="3944258">&#34;\\\&#34;&#34;</span><span class="op" id="3944264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3944267">func</span>&nbsp;<span class="ident" id="3944272">escapeQuotes</span><span class="op" id="3944284">(</span><span class="ident" id="3944285">s</span>&nbsp;<span class="builtintype" id="3944287">string</span><span class="op" id="3944293">)</span>&nbsp;<span class="builtintype" id="3944295">string</span>&nbsp;<span class="op" id="3944302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3944305">return</span>&nbsp;<span class="ident" id="3944312">quoteEscaper</span><span class="op" id="3944324">.</span><span class="ident" id="3944325">Replace</span><span class="op" id="3944332">(</span><span class="ident" id="3944333">s</span><span class="op" id="3944334">)</span><br>
<span class="lineno"></span><span class="op" id="3944336">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3944339">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3944412">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3944482">func</span>&nbsp;<span class="op" id="3944487">(</span><span class="ident" id="3944488">w</span>&nbsp;<span class="op" id="3944490">*</span><span class="ident" id="3944491">Writer</span><span class="op" id="3944497">)</span>&nbsp;<span class="ident" id="3944499">CreateFormFile</span><span class="op" id="3944513">(</span><span class="ident" id="3944514">fieldname</span><span class="op" id="3944523">,</span>&nbsp;<span class="ident" id="3944525">filename</span>&nbsp;<span class="builtintype" id="3944534">string</span><span class="op" id="3944540">)</span>&nbsp;<span class="op" id="3944542">(</span><span class="ident" id="3944543">io</span><span class="op" id="3944545">.</span><span class="ident" id="3944546">Writer</span><span class="op" id="3944552">,</span>&nbsp;<span class="builtintype" id="3944554">error</span><span class="op" id="3944559">)</span>&nbsp;<span class="op" id="3944561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944564">h</span>&nbsp;<span class="op" id="3944566">:=</span>&nbsp;<span class="builtinfunc" id="3944569">make</span><span class="op" id="3944573">(</span><span class="ident" id="3944574">textproto</span><span class="op" id="3944583">.</span><span class="ident" id="3944584">MIMEHeader</span><span class="op" id="3944594">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944597">h</span><span class="op" id="3944598">.</span><span class="ident" id="3944599">Set</span><span class="op" id="3944602">(</span><span class="string" id="3944603">&#34;Content-Disposition&#34;</span><span class="op" id="3944624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944628">fmt</span><span class="op" id="3944631">.</span><span class="ident" id="3944632">Sprintf</span><span class="op" id="3944639">(</span><span class="string" id="3944640">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3944677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944682">escapeQuotes</span><span class="op" id="3944694">(</span><span class="ident" id="3944695">fieldname</span><span class="op" id="3944704">)</span><span class="op" id="3944705">,</span>&nbsp;<span class="ident" id="3944707">escapeQuotes</span><span class="op" id="3944719">(</span><span class="ident" id="3944720">filename</span><span class="op" id="3944728">)</span><span class="op" id="3944729">)</span><span class="op" id="3944730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944733">h</span><span class="op" id="3944734">.</span><span class="ident" id="3944735">Set</span><span class="op" id="3944738">(</span><span class="string" id="3944739">&#34;Content-Type&#34;</span><span class="op" id="3944753">,</span>&nbsp;<span class="string" id="3944755">&#34;application/octet-stream&#34;</span><span class="op" id="3944781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3944784">return</span>&nbsp;<span class="ident" id="3944791">w</span><span class="op" id="3944792">.</span><span class="ident" id="3944793">CreatePart</span><span class="op" id="3944803">(</span><span class="ident" id="3944804">h</span><span class="op" id="3944805">)</span><br>
<span class="lineno">130</span><span class="op" id="3944807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3944810">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3944870">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3944891">func</span>&nbsp;<span class="op" id="3944896">(</span><span class="ident" id="3944897">w</span>&nbsp;<span class="op" id="3944899">*</span><span class="ident" id="3944900">Writer</span><span class="op" id="3944906">)</span>&nbsp;<span class="ident" id="3944908">CreateFormField</span><span class="op" id="3944923">(</span><span class="ident" id="3944924">fieldname</span>&nbsp;<span class="builtintype" id="3944934">string</span><span class="op" id="3944940">)</span>&nbsp;<span class="op" id="3944942">(</span><span class="ident" id="3944943">io</span><span class="op" id="3944945">.</span><span class="ident" id="3944946">Writer</span><span class="op" id="3944952">,</span>&nbsp;<span class="builtintype" id="3944954">error</span><span class="op" id="3944959">)</span>&nbsp;<span class="op" id="3944961">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944964">h</span>&nbsp;<span class="op" id="3944966">:=</span>&nbsp;<span class="builtinfunc" id="3944969">make</span><span class="op" id="3944973">(</span><span class="ident" id="3944974">textproto</span><span class="op" id="3944983">.</span><span class="ident" id="3944984">MIMEHeader</span><span class="op" id="3944994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944997">h</span><span class="op" id="3944998">.</span><span class="ident" id="3944999">Set</span><span class="op" id="3945002">(</span><span class="string" id="3945003">&#34;Content-Disposition&#34;</span><span class="op" id="3945024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945028">fmt</span><span class="op" id="3945031">.</span><span class="ident" id="3945032">Sprintf</span><span class="op" id="3945039">(</span><span class="string" id="3945040">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3945062">,</span>&nbsp;<span class="ident" id="3945064">escapeQuotes</span><span class="op" id="3945076">(</span><span class="ident" id="3945077">fieldname</span><span class="op" id="3945086">)</span><span class="op" id="3945087">)</span><span class="op" id="3945088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945091">return</span>&nbsp;<span class="ident" id="3945098">w</span><span class="op" id="3945099">.</span><span class="ident" id="3945100">CreatePart</span><span class="op" id="3945110">(</span><span class="ident" id="3945111">h</span><span class="op" id="3945112">)</span><br>
<span class="lineno"></span><span class="op" id="3945114">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3945117">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3945186">func</span>&nbsp;<span class="op" id="3945191">(</span><span class="ident" id="3945192">w</span>&nbsp;<span class="op" id="3945194">*</span><span class="ident" id="3945195">Writer</span><span class="op" id="3945201">)</span>&nbsp;<span class="ident" id="3945203">WriteField</span><span class="op" id="3945213">(</span><span class="ident" id="3945214">fieldname</span><span class="op" id="3945223">,</span>&nbsp;<span class="ident" id="3945225">value</span>&nbsp;<span class="builtintype" id="3945231">string</span><span class="op" id="3945237">)</span>&nbsp;<span class="builtintype" id="3945239">error</span>&nbsp;<span class="op" id="3945245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945248">p</span><span class="op" id="3945249">,</span>&nbsp;<span class="ident" id="3945251">err</span>&nbsp;<span class="op" id="3945255">:=</span>&nbsp;<span class="ident" id="3945258">w</span><span class="op" id="3945259">.</span><span class="ident" id="3945260">CreateFormField</span><span class="op" id="3945275">(</span><span class="ident" id="3945276">fieldname</span><span class="op" id="3945285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945288">if</span>&nbsp;<span class="ident" id="3945291">err</span>&nbsp;<span class="op" id="3945295">!=</span>&nbsp;<span class="builtintype" id="3945298">nil</span>&nbsp;<span class="op" id="3945302">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945306">return</span>&nbsp;<span class="ident" id="3945313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3945318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945321">_</span><span class="op" id="3945322">,</span>&nbsp;<span class="ident" id="3945324">err</span>&nbsp;<span class="op" id="3945328">=</span>&nbsp;<span class="ident" id="3945330">p</span><span class="op" id="3945331">.</span><span class="ident" id="3945332">Write</span><span class="op" id="3945337">(</span><span class="op" id="3945338">[</span><span class="op" id="3945339">]</span><span class="builtintype" id="3945340">byte</span><span class="op" id="3945344">(</span><span class="ident" id="3945345">value</span><span class="op" id="3945350">)</span><span class="op" id="3945351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945354">return</span>&nbsp;<span class="ident" id="3945361">err</span><br>
<span class="lineno"></span><span class="op" id="3945365">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3945368">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3945432">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3945468">func</span>&nbsp;<span class="op" id="3945473">(</span><span class="ident" id="3945474">w</span>&nbsp;<span class="op" id="3945476">*</span><span class="ident" id="3945477">Writer</span><span class="op" id="3945483">)</span>&nbsp;<span class="ident" id="3945485">Close</span><span class="op" id="3945490">(</span><span class="op" id="3945491">)</span>&nbsp;<span class="builtintype" id="3945493">error</span>&nbsp;<span class="op" id="3945499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945502">if</span>&nbsp;<span class="ident" id="3945505">w</span><span class="op" id="3945506">.</span><span class="ident" id="3945507">lastpart</span>&nbsp;<span class="op" id="3945516">!=</span>&nbsp;<span class="builtintype" id="3945519">nil</span>&nbsp;<span class="op" id="3945523">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945527">if</span>&nbsp;<span class="ident" id="3945530">err</span>&nbsp;<span class="op" id="3945534">:=</span>&nbsp;<span class="ident" id="3945537">w</span><span class="op" id="3945538">.</span><span class="ident" id="3945539">lastpart</span><span class="op" id="3945547">.</span><span class="builtinfunc" id="3945548">close</span><span class="op" id="3945553">(</span><span class="op" id="3945554">)</span><span class="op" id="3945555">;</span>&nbsp;<span class="ident" id="3945557">err</span>&nbsp;<span class="op" id="3945561">!=</span>&nbsp;<span class="builtintype" id="3945564">nil</span>&nbsp;<span class="op" id="3945568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945573">return</span>&nbsp;<span class="ident" id="3945580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3945586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945590">w</span><span class="op" id="3945591">.</span><span class="ident" id="3945592">lastpart</span>&nbsp;<span class="op" id="3945601">=</span>&nbsp;<span class="builtintype" id="3945603">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3945608">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945611">_</span><span class="op" id="3945612">,</span>&nbsp;<span class="ident" id="3945614">err</span>&nbsp;<span class="op" id="3945618">:=</span>&nbsp;<span class="ident" id="3945621">fmt</span><span class="op" id="3945624">.</span><span class="ident" id="3945625">Fprintf</span><span class="op" id="3945632">(</span><span class="ident" id="3945633">w</span><span class="op" id="3945634">.</span><span class="ident" id="3945635">w</span><span class="op" id="3945636">,</span>&nbsp;<span class="string" id="3945638">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3945654">,</span>&nbsp;<span class="ident" id="3945656">w</span><span class="op" id="3945657">.</span><span class="ident" id="3945658">boundary</span><span class="op" id="3945666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945669">return</span>&nbsp;<span class="ident" id="3945676">err</span><br>
<span class="lineno"></span><span class="op" id="3945680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3945683">type</span>&nbsp;<span class="ident" id="3945688">part</span>&nbsp;<span class="keyword" id="3945693">struct</span>&nbsp;<span class="op" id="3945700">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945703">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3945710">*</span><span class="ident" id="3945711">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945719">closed</span>&nbsp;<span class="builtintype" id="3945726">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945732">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3945739">error</span>&nbsp;<span class="comment" id="3945745">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3945781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3945784">func</span>&nbsp;<span class="op" id="3945789">(</span><span class="ident" id="3945790">p</span>&nbsp;<span class="op" id="3945792">*</span><span class="ident" id="3945793">part</span><span class="op" id="3945797">)</span>&nbsp;<span class="builtinfunc" id="3945799">close</span><span class="op" id="3945804">(</span><span class="op" id="3945805">)</span>&nbsp;<span class="builtintype" id="3945807">error</span>&nbsp;<span class="op" id="3945813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945816">p</span><span class="op" id="3945817">.</span><span class="ident" id="3945818">closed</span>&nbsp;<span class="op" id="3945825">=</span>&nbsp;<span class="builtintype" id="3945827">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945833">return</span>&nbsp;<span class="ident" id="3945840">p</span><span class="op" id="3945841">.</span><span class="ident" id="3945842">we</span><br>
<span class="lineno"></span><span class="op" id="3945845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3945848">func</span>&nbsp;<span class="op" id="3945853">(</span><span class="ident" id="3945854">p</span>&nbsp;<span class="op" id="3945856">*</span><span class="ident" id="3945857">part</span><span class="op" id="3945861">)</span>&nbsp;<span class="ident" id="3945863">Write</span><span class="op" id="3945868">(</span><span class="ident" id="3945869">d</span>&nbsp;<span class="op" id="3945871">[</span><span class="op" id="3945872">]</span><span class="builtintype" id="3945873">byte</span><span class="op" id="3945877">)</span>&nbsp;<span class="op" id="3945879">(</span><span class="ident" id="3945880">n</span>&nbsp;<span class="builtintype" id="3945882">int</span><span class="op" id="3945885">,</span>&nbsp;<span class="ident" id="3945887">err</span>&nbsp;<span class="builtintype" id="3945891">error</span><span class="op" id="3945896">)</span>&nbsp;<span class="op" id="3945898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945901">if</span>&nbsp;<span class="ident" id="3945904">p</span><span class="op" id="3945905">.</span><span class="ident" id="3945906">closed</span>&nbsp;<span class="op" id="3945913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945917">return</span>&nbsp;<span class="num" id="3945924">0</span><span class="op" id="3945925">,</span>&nbsp;<span class="ident" id="3945927">errors</span><span class="op" id="3945933">.</span><span class="ident" id="3945934">New</span><span class="op" id="3945937">(</span><span class="string" id="3945938">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3945979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3945982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945985">n</span><span class="op" id="3945986">,</span>&nbsp;<span class="ident" id="3945988">err</span>&nbsp;<span class="op" id="3945992">=</span>&nbsp;<span class="ident" id="3945994">p</span><span class="op" id="3945995">.</span><span class="ident" id="3945996">mw</span><span class="op" id="3945998">.</span><span class="ident" id="3945999">w</span><span class="op" id="3946000">.</span><span class="ident" id="3946001">Write</span><span class="op" id="3946006">(</span><span class="ident" id="3946007">d</span><span class="op" id="3946008">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946011">if</span>&nbsp;<span class="ident" id="3946014">err</span>&nbsp;<span class="op" id="3946018">!=</span>&nbsp;<span class="builtintype" id="3946021">nil</span>&nbsp;<span class="op" id="3946025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946029">p</span><span class="op" id="3946030">.</span><span class="ident" id="3946031">we</span>&nbsp;<span class="op" id="3946034">=</span>&nbsp;<span class="ident" id="3946036">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946044">return</span><br>
<span class="lineno"></span><span class="op" id="3946051">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
