<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4265400">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4265455">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4265509">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4265560">package</span>&nbsp;<span class="ident" id="4265568">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4265575">import</span>&nbsp;<span class="op" id="4265582">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4265585">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4265591">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4265598">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4265601">const</span>&nbsp;<span class="op" id="4265607">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265610">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265639">offsetCodeCount</span>&nbsp;<span class="op" id="4265655">=</span>&nbsp;<span class="num" id="4265657">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265662">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265716">endBlockMarker</span>&nbsp;<span class="op" id="4265731">=</span>&nbsp;<span class="num" id="4265733">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265739">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265766">lengthCodesStart</span>&nbsp;<span class="op" id="4265783">=</span>&nbsp;<span class="num" id="4265785">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265791">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265824">codegenCodeCount</span>&nbsp;<span class="op" id="4265841">=</span>&nbsp;<span class="num" id="4265843">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265847">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265864">=</span>&nbsp;<span class="num" id="4265866">255</span><br>
<span class="lineno">25</span><span class="op" id="4265870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4265873">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4265947">var</span>&nbsp;<span class="ident" id="4265951">lengthExtraBits</span>&nbsp;<span class="op" id="4265967">=</span>&nbsp;<span class="op" id="4265969">[</span><span class="op" id="4265970">]</span><span class="builtintype" id="4265971">int8</span><span class="op" id="4265975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265978">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4265988">0</span><span class="op" id="4265989">,</span>&nbsp;<span class="num" id="4265991">0</span><span class="op" id="4265992">,</span>&nbsp;<span class="num" id="4265994">0</span><span class="op" id="4265995">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265998">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4266008">0</span><span class="op" id="4266009">,</span>&nbsp;<span class="num" id="4266011">0</span><span class="op" id="4266012">,</span>&nbsp;<span class="num" id="4266014">0</span><span class="op" id="4266015">,</span>&nbsp;<span class="num" id="4266017">0</span><span class="op" id="4266018">,</span>&nbsp;<span class="num" id="4266020">0</span><span class="op" id="4266021">,</span>&nbsp;<span class="num" id="4266023">1</span><span class="op" id="4266024">,</span>&nbsp;<span class="num" id="4266026">1</span><span class="op" id="4266027">,</span>&nbsp;<span class="num" id="4266029">1</span><span class="op" id="4266030">,</span>&nbsp;<span class="num" id="4266032">1</span><span class="op" id="4266033">,</span>&nbsp;<span class="num" id="4266035">2</span><span class="op" id="4266036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266039">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4266049">2</span><span class="op" id="4266050">,</span>&nbsp;<span class="num" id="4266052">2</span><span class="op" id="4266053">,</span>&nbsp;<span class="num" id="4266055">2</span><span class="op" id="4266056">,</span>&nbsp;<span class="num" id="4266058">3</span><span class="op" id="4266059">,</span>&nbsp;<span class="num" id="4266061">3</span><span class="op" id="4266062">,</span>&nbsp;<span class="num" id="4266064">3</span><span class="op" id="4266065">,</span>&nbsp;<span class="num" id="4266067">3</span><span class="op" id="4266068">,</span>&nbsp;<span class="num" id="4266070">4</span><span class="op" id="4266071">,</span>&nbsp;<span class="num" id="4266073">4</span><span class="op" id="4266074">,</span>&nbsp;<span class="num" id="4266076">4</span><span class="op" id="4266077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266080">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4266090">4</span><span class="op" id="4266091">,</span>&nbsp;<span class="num" id="4266093">5</span><span class="op" id="4266094">,</span>&nbsp;<span class="num" id="4266096">5</span><span class="op" id="4266097">,</span>&nbsp;<span class="num" id="4266099">5</span><span class="op" id="4266100">,</span>&nbsp;<span class="num" id="4266102">5</span><span class="op" id="4266103">,</span>&nbsp;<span class="num" id="4266105">0</span><span class="op" id="4266106">,</span><br>
<span class="lineno"></span><span class="op" id="4266108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4266111">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4266174">var</span>&nbsp;<span class="ident" id="4266178">lengthBase</span>&nbsp;<span class="op" id="4266189">=</span>&nbsp;<span class="op" id="4266191">[</span><span class="op" id="4266192">]</span><span class="builtintype" id="4266193">uint32</span><span class="op" id="4266199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266202">0</span><span class="op" id="4266203">,</span>&nbsp;<span class="num" id="4266205">1</span><span class="op" id="4266206">,</span>&nbsp;<span class="num" id="4266208">2</span><span class="op" id="4266209">,</span>&nbsp;<span class="num" id="4266211">3</span><span class="op" id="4266212">,</span>&nbsp;<span class="num" id="4266214">4</span><span class="op" id="4266215">,</span>&nbsp;<span class="num" id="4266217">5</span><span class="op" id="4266218">,</span>&nbsp;<span class="num" id="4266220">6</span><span class="op" id="4266221">,</span>&nbsp;<span class="num" id="4266223">7</span><span class="op" id="4266224">,</span>&nbsp;<span class="num" id="4266226">8</span><span class="op" id="4266227">,</span>&nbsp;<span class="num" id="4266229">10</span><span class="op" id="4266231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266234">12</span><span class="op" id="4266236">,</span>&nbsp;<span class="num" id="4266238">14</span><span class="op" id="4266240">,</span>&nbsp;<span class="num" id="4266242">16</span><span class="op" id="4266244">,</span>&nbsp;<span class="num" id="4266246">20</span><span class="op" id="4266248">,</span>&nbsp;<span class="num" id="4266250">24</span><span class="op" id="4266252">,</span>&nbsp;<span class="num" id="4266254">28</span><span class="op" id="4266256">,</span>&nbsp;<span class="num" id="4266258">32</span><span class="op" id="4266260">,</span>&nbsp;<span class="num" id="4266262">40</span><span class="op" id="4266264">,</span>&nbsp;<span class="num" id="4266266">48</span><span class="op" id="4266268">,</span>&nbsp;<span class="num" id="4266270">56</span><span class="op" id="4266272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266275">64</span><span class="op" id="4266277">,</span>&nbsp;<span class="num" id="4266279">80</span><span class="op" id="4266281">,</span>&nbsp;<span class="num" id="4266283">96</span><span class="op" id="4266285">,</span>&nbsp;<span class="num" id="4266287">112</span><span class="op" id="4266290">,</span>&nbsp;<span class="num" id="4266292">128</span><span class="op" id="4266295">,</span>&nbsp;<span class="num" id="4266297">160</span><span class="op" id="4266300">,</span>&nbsp;<span class="num" id="4266302">192</span><span class="op" id="4266305">,</span>&nbsp;<span class="num" id="4266307">224</span><span class="op" id="4266310">,</span>&nbsp;<span class="num" id="4266312">255</span><span class="op" id="4266315">,</span><br>
<span class="lineno">40</span><span class="op" id="4266317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4266320">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4266352">var</span>&nbsp;<span class="ident" id="4266356">offsetExtraBits</span>&nbsp;<span class="op" id="4266372">=</span>&nbsp;<span class="op" id="4266374">[</span><span class="op" id="4266375">]</span><span class="builtintype" id="4266376">int8</span><span class="op" id="4266380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266383">0</span><span class="op" id="4266384">,</span>&nbsp;<span class="num" id="4266386">0</span><span class="op" id="4266387">,</span>&nbsp;<span class="num" id="4266389">0</span><span class="op" id="4266390">,</span>&nbsp;<span class="num" id="4266392">0</span><span class="op" id="4266393">,</span>&nbsp;<span class="num" id="4266395">1</span><span class="op" id="4266396">,</span>&nbsp;<span class="num" id="4266398">1</span><span class="op" id="4266399">,</span>&nbsp;<span class="num" id="4266401">2</span><span class="op" id="4266402">,</span>&nbsp;<span class="num" id="4266404">2</span><span class="op" id="4266405">,</span>&nbsp;<span class="num" id="4266407">3</span><span class="op" id="4266408">,</span>&nbsp;<span class="num" id="4266410">3</span><span class="op" id="4266411">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266414">4</span><span class="op" id="4266415">,</span>&nbsp;<span class="num" id="4266417">4</span><span class="op" id="4266418">,</span>&nbsp;<span class="num" id="4266420">5</span><span class="op" id="4266421">,</span>&nbsp;<span class="num" id="4266423">5</span><span class="op" id="4266424">,</span>&nbsp;<span class="num" id="4266426">6</span><span class="op" id="4266427">,</span>&nbsp;<span class="num" id="4266429">6</span><span class="op" id="4266430">,</span>&nbsp;<span class="num" id="4266432">7</span><span class="op" id="4266433">,</span>&nbsp;<span class="num" id="4266435">7</span><span class="op" id="4266436">,</span>&nbsp;<span class="num" id="4266438">8</span><span class="op" id="4266439">,</span>&nbsp;<span class="num" id="4266441">8</span><span class="op" id="4266442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266445">9</span><span class="op" id="4266446">,</span>&nbsp;<span class="num" id="4266448">9</span><span class="op" id="4266449">,</span>&nbsp;<span class="num" id="4266451">10</span><span class="op" id="4266453">,</span>&nbsp;<span class="num" id="4266455">10</span><span class="op" id="4266457">,</span>&nbsp;<span class="num" id="4266459">11</span><span class="op" id="4266461">,</span>&nbsp;<span class="num" id="4266463">11</span><span class="op" id="4266465">,</span>&nbsp;<span class="num" id="4266467">12</span><span class="op" id="4266469">,</span>&nbsp;<span class="num" id="4266471">12</span><span class="op" id="4266473">,</span>&nbsp;<span class="num" id="4266475">13</span><span class="op" id="4266477">,</span>&nbsp;<span class="num" id="4266479">13</span><span class="op" id="4266481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266484">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266507">14</span><span class="op" id="4266509">,</span>&nbsp;<span class="num" id="4266511">14</span><span class="op" id="4266513">,</span>&nbsp;<span class="num" id="4266515">15</span><span class="op" id="4266517">,</span>&nbsp;<span class="num" id="4266519">15</span><span class="op" id="4266521">,</span>&nbsp;<span class="num" id="4266523">16</span><span class="op" id="4266525">,</span>&nbsp;<span class="num" id="4266527">16</span><span class="op" id="4266529">,</span>&nbsp;<span class="num" id="4266531">17</span><span class="op" id="4266533">,</span>&nbsp;<span class="num" id="4266535">17</span><span class="op" id="4266537">,</span>&nbsp;<span class="num" id="4266539">18</span><span class="op" id="4266541">,</span>&nbsp;<span class="num" id="4266543">18</span><span class="op" id="4266545">,</span>&nbsp;<span class="num" id="4266547">19</span><span class="op" id="4266549">,</span>&nbsp;<span class="num" id="4266551">19</span><span class="op" id="4266553">,</span>&nbsp;<span class="num" id="4266555">20</span><span class="op" id="4266557">,</span>&nbsp;<span class="num" id="4266559">20</span><span class="op" id="4266561">,</span><br>
<span class="lineno"></span><span class="op" id="4266563">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4266566">var</span>&nbsp;<span class="ident" id="4266570">offsetBase</span>&nbsp;<span class="op" id="4266581">=</span>&nbsp;<span class="op" id="4266583">[</span><span class="op" id="4266584">]</span><span class="builtintype" id="4266585">uint32</span><span class="op" id="4266591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266594">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266616">0x000000</span><span class="op" id="4266624">,</span>&nbsp;<span class="num" id="4266626">0x000001</span><span class="op" id="4266634">,</span>&nbsp;<span class="num" id="4266636">0x000002</span><span class="op" id="4266644">,</span>&nbsp;<span class="num" id="4266646">0x000003</span><span class="op" id="4266654">,</span>&nbsp;<span class="num" id="4266656">0x000004</span><span class="op" id="4266664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266667">0x000006</span><span class="op" id="4266675">,</span>&nbsp;<span class="num" id="4266677">0x000008</span><span class="op" id="4266685">,</span>&nbsp;<span class="num" id="4266687">0x00000c</span><span class="op" id="4266695">,</span>&nbsp;<span class="num" id="4266697">0x000010</span><span class="op" id="4266705">,</span>&nbsp;<span class="num" id="4266707">0x000018</span><span class="op" id="4266715">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266718">0x000020</span><span class="op" id="4266726">,</span>&nbsp;<span class="num" id="4266728">0x000030</span><span class="op" id="4266736">,</span>&nbsp;<span class="num" id="4266738">0x000040</span><span class="op" id="4266746">,</span>&nbsp;<span class="num" id="4266748">0x000060</span><span class="op" id="4266756">,</span>&nbsp;<span class="num" id="4266758">0x000080</span><span class="op" id="4266766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266769">0x0000c0</span><span class="op" id="4266777">,</span>&nbsp;<span class="num" id="4266779">0x000100</span><span class="op" id="4266787">,</span>&nbsp;<span class="num" id="4266789">0x000180</span><span class="op" id="4266797">,</span>&nbsp;<span class="num" id="4266799">0x000200</span><span class="op" id="4266807">,</span>&nbsp;<span class="num" id="4266809">0x000300</span><span class="op" id="4266817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266820">0x000400</span><span class="op" id="4266828">,</span>&nbsp;<span class="num" id="4266830">0x000600</span><span class="op" id="4266838">,</span>&nbsp;<span class="num" id="4266840">0x000800</span><span class="op" id="4266848">,</span>&nbsp;<span class="num" id="4266850">0x000c00</span><span class="op" id="4266858">,</span>&nbsp;<span class="num" id="4266860">0x001000</span><span class="op" id="4266868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266871">0x001800</span><span class="op" id="4266879">,</span>&nbsp;<span class="num" id="4266881">0x002000</span><span class="op" id="4266889">,</span>&nbsp;<span class="num" id="4266891">0x003000</span><span class="op" id="4266899">,</span>&nbsp;<span class="num" id="4266901">0x004000</span><span class="op" id="4266909">,</span>&nbsp;<span class="num" id="4266911">0x006000</span><span class="op" id="4266919">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266923">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266946">0x008000</span><span class="op" id="4266954">,</span>&nbsp;<span class="num" id="4266956">0x00c000</span><span class="op" id="4266964">,</span>&nbsp;<span class="num" id="4266966">0x010000</span><span class="op" id="4266974">,</span>&nbsp;<span class="num" id="4266976">0x018000</span><span class="op" id="4266984">,</span>&nbsp;<span class="num" id="4266986">0x020000</span><span class="op" id="4266994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4266997">0x030000</span><span class="op" id="4267005">,</span>&nbsp;<span class="num" id="4267007">0x040000</span><span class="op" id="4267015">,</span>&nbsp;<span class="num" id="4267017">0x060000</span><span class="op" id="4267025">,</span>&nbsp;<span class="num" id="4267027">0x080000</span><span class="op" id="4267035">,</span>&nbsp;<span class="num" id="4267037">0x0c0000</span><span class="op" id="4267045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4267048">0x100000</span><span class="op" id="4267056">,</span>&nbsp;<span class="num" id="4267058">0x180000</span><span class="op" id="4267066">,</span>&nbsp;<span class="num" id="4267068">0x200000</span><span class="op" id="4267076">,</span>&nbsp;<span class="num" id="4267078">0x300000</span><span class="op" id="4267086">,</span><br>
<span class="lineno"></span><span class="op" id="4267088">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4267091">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4267153">var</span>&nbsp;<span class="ident" id="4267157">codegenOrder</span>&nbsp;<span class="op" id="4267170">=</span>&nbsp;<span class="op" id="4267172">[</span><span class="op" id="4267173">]</span><span class="builtintype" id="4267174">uint32</span><span class="op" id="4267180">{</span><span class="num" id="4267181">16</span><span class="op" id="4267183">,</span>&nbsp;<span class="num" id="4267185">17</span><span class="op" id="4267187">,</span>&nbsp;<span class="num" id="4267189">18</span><span class="op" id="4267191">,</span>&nbsp;<span class="num" id="4267193">0</span><span class="op" id="4267194">,</span>&nbsp;<span class="num" id="4267196">8</span><span class="op" id="4267197">,</span>&nbsp;<span class="num" id="4267199">7</span><span class="op" id="4267200">,</span>&nbsp;<span class="num" id="4267202">9</span><span class="op" id="4267203">,</span>&nbsp;<span class="num" id="4267205">6</span><span class="op" id="4267206">,</span>&nbsp;<span class="num" id="4267208">10</span><span class="op" id="4267210">,</span>&nbsp;<span class="num" id="4267212">5</span><span class="op" id="4267213">,</span>&nbsp;<span class="num" id="4267215">11</span><span class="op" id="4267217">,</span>&nbsp;<span class="num" id="4267219">4</span><span class="op" id="4267220">,</span>&nbsp;<span class="num" id="4267222">12</span><span class="op" id="4267224">,</span>&nbsp;<span class="num" id="4267226">3</span><span class="op" id="4267227">,</span>&nbsp;<span class="num" id="4267229">13</span><span class="op" id="4267231">,</span>&nbsp;<span class="num" id="4267233">2</span><span class="op" id="4267234">,</span>&nbsp;<span class="num" id="4267236">14</span><span class="op" id="4267238">,</span>&nbsp;<span class="num" id="4267240">1</span><span class="op" id="4267241">,</span>&nbsp;<span class="num" id="4267243">15</span><span class="op" id="4267245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4267248">type</span>&nbsp;<span class="ident" id="4267253">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4267270">struct</span>&nbsp;<span class="op" id="4267277">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267280">w</span>&nbsp;<span class="ident" id="4267282">io</span><span class="op" id="4267284">.</span><span class="ident" id="4267285">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4267293">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4267343">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267379">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4267395">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267403">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4267419">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267427">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267443">[</span><span class="num" id="4267444">64</span><span class="op" id="4267446">]</span><span class="builtintype" id="4267447">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267453">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4267469">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267474">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267490">[</span><span class="op" id="4267491">]</span><span class="builtintype" id="4267492">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267499">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267515">[</span><span class="op" id="4267516">]</span><span class="builtintype" id="4267517">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267524">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267540">[</span><span class="op" id="4267541">]</span><span class="builtintype" id="4267542">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267549">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267565">[</span><span class="op" id="4267566">]</span><span class="builtintype" id="4267567">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267574">literalEncoding</span>&nbsp;<span class="op" id="4267590">*</span><span class="ident" id="4267591">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267607">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4267623">*</span><span class="ident" id="4267624">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267640">codegenEncoding</span>&nbsp;<span class="op" id="4267656">*</span><span class="ident" id="4267657">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267673">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4267689">error</span><br>
<span class="lineno">85</span><span class="op" id="4267695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4267698">func</span>&nbsp;<span class="ident" id="4267703">newHuffmanBitWriter</span><span class="op" id="4267722">(</span><span class="ident" id="4267723">w</span>&nbsp;<span class="ident" id="4267725">io</span><span class="op" id="4267727">.</span><span class="ident" id="4267728">Writer</span><span class="op" id="4267734">)</span>&nbsp;<span class="op" id="4267736">*</span><span class="ident" id="4267737">huffmanBitWriter</span>&nbsp;<span class="op" id="4267754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267757">return</span>&nbsp;<span class="op" id="4267764">&amp;</span><span class="ident" id="4267765">huffmanBitWriter</span><span class="op" id="4267781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267785">w</span><span class="op" id="4267786">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267802">w</span><span class="op" id="4267803">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267807">literalFreq</span><span class="op" id="4267818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4267824">make</span><span class="op" id="4267828">(</span><span class="op" id="4267829">[</span><span class="op" id="4267830">]</span><span class="builtintype" id="4267831">int32</span><span class="op" id="4267836">,</span>&nbsp;<span class="ident" id="4267838">maxLit</span><span class="op" id="4267844">)</span><span class="op" id="4267845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267849">offsetFreq</span><span class="op" id="4267859">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4267866">make</span><span class="op" id="4267870">(</span><span class="op" id="4267871">[</span><span class="op" id="4267872">]</span><span class="builtintype" id="4267873">int32</span><span class="op" id="4267878">,</span>&nbsp;<span class="ident" id="4267880">offsetCodeCount</span><span class="op" id="4267895">)</span><span class="op" id="4267896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267900">codegen</span><span class="op" id="4267907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4267917">make</span><span class="op" id="4267921">(</span><span class="op" id="4267922">[</span><span class="op" id="4267923">]</span><span class="builtintype" id="4267924">uint8</span><span class="op" id="4267929">,</span>&nbsp;<span class="ident" id="4267931">maxLit</span><span class="op" id="4267937">+</span><span class="ident" id="4267938">offsetCodeCount</span><span class="op" id="4267953">+</span><span class="num" id="4267954">1</span><span class="op" id="4267955">)</span><span class="op" id="4267956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267960">codegenFreq</span><span class="op" id="4267971">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4267977">make</span><span class="op" id="4267981">(</span><span class="op" id="4267982">[</span><span class="op" id="4267983">]</span><span class="builtintype" id="4267984">int32</span><span class="op" id="4267989">,</span>&nbsp;<span class="ident" id="4267991">codegenCodeCount</span><span class="op" id="4268007">)</span><span class="op" id="4268008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268012">literalEncoding</span><span class="op" id="4268027">:</span>&nbsp;<span class="ident" id="4268029">newHuffmanEncoder</span><span class="op" id="4268046">(</span><span class="ident" id="4268047">maxLit</span><span class="op" id="4268053">)</span><span class="op" id="4268054">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268058">offsetEncoding</span><span class="op" id="4268072">:</span>&nbsp;&nbsp;<span class="ident" id="4268075">newHuffmanEncoder</span><span class="op" id="4268092">(</span><span class="ident" id="4268093">offsetCodeCount</span><span class="op" id="4268108">)</span><span class="op" id="4268109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268113">codegenEncoding</span><span class="op" id="4268128">:</span>&nbsp;<span class="ident" id="4268130">newHuffmanEncoder</span><span class="op" id="4268147">(</span><span class="ident" id="4268148">codegenCodeCount</span><span class="op" id="4268164">)</span><span class="op" id="4268165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268168">}</span><br>
<span class="lineno"></span><span class="op" id="4268170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4268173">func</span>&nbsp;<span class="op" id="4268178">(</span><span class="ident" id="4268179">w</span>&nbsp;<span class="op" id="4268181">*</span><span class="ident" id="4268182">huffmanBitWriter</span><span class="op" id="4268198">)</span>&nbsp;<span class="ident" id="4268200">reset</span><span class="op" id="4268205">(</span><span class="ident" id="4268206">writer</span>&nbsp;<span class="ident" id="4268213">io</span><span class="op" id="4268215">.</span><span class="ident" id="4268216">Writer</span><span class="op" id="4268222">)</span>&nbsp;<span class="op" id="4268224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268227">w</span><span class="op" id="4268228">.</span><span class="ident" id="4268229">w</span>&nbsp;<span class="op" id="4268231">=</span>&nbsp;<span class="ident" id="4268233">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268241">w</span><span class="op" id="4268242">.</span><span class="ident" id="4268243">bits</span><span class="op" id="4268247">,</span>&nbsp;<span class="ident" id="4268249">w</span><span class="op" id="4268250">.</span><span class="ident" id="4268251">nbits</span><span class="op" id="4268256">,</span>&nbsp;<span class="ident" id="4268258">w</span><span class="op" id="4268259">.</span><span class="ident" id="4268260">nbytes</span><span class="op" id="4268266">,</span>&nbsp;<span class="ident" id="4268268">w</span><span class="op" id="4268269">.</span><span class="ident" id="4268270">err</span>&nbsp;<span class="op" id="4268274">=</span>&nbsp;<span class="num" id="4268276">0</span><span class="op" id="4268277">,</span>&nbsp;<span class="num" id="4268279">0</span><span class="op" id="4268280">,</span>&nbsp;<span class="num" id="4268282">0</span><span class="op" id="4268283">,</span>&nbsp;<span class="ident" id="4268285">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268290">w</span><span class="op" id="4268291">.</span><span class="ident" id="4268292">bytes</span>&nbsp;<span class="op" id="4268298">=</span>&nbsp;<span class="op" id="4268300">[</span><span class="num" id="4268301">64</span><span class="op" id="4268303">]</span><span class="builtintype" id="4268304">byte</span><span class="op" id="4268308">{</span><span class="op" id="4268309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268312">for</span>&nbsp;<span class="ident" id="4268316">i</span>&nbsp;<span class="op" id="4268318">:=</span>&nbsp;<span class="keyword" id="4268321">range</span>&nbsp;<span class="ident" id="4268327">w</span><span class="op" id="4268328">.</span><span class="ident" id="4268329">codegen</span>&nbsp;<span class="op" id="4268337">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268341">w</span><span class="op" id="4268342">.</span><span class="ident" id="4268343">codegen</span><span class="op" id="4268350">[</span><span class="ident" id="4268351">i</span><span class="op" id="4268352">]</span>&nbsp;<span class="op" id="4268354">=</span>&nbsp;<span class="num" id="4268356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268362">for</span>&nbsp;<span class="ident" id="4268366">_</span><span class="op" id="4268367">,</span>&nbsp;<span class="ident" id="4268369">s</span>&nbsp;<span class="op" id="4268371">:=</span>&nbsp;<span class="keyword" id="4268374">range</span>&nbsp;<span class="op" id="4268380">[</span><span class="op" id="4268381">...</span><span class="op" id="4268384">]</span><span class="op" id="4268385">[</span><span class="op" id="4268386">]</span><span class="builtintype" id="4268387">int32</span><span class="op" id="4268392">{</span><span class="ident" id="4268393">w</span><span class="op" id="4268394">.</span><span class="ident" id="4268395">literalFreq</span><span class="op" id="4268406">,</span>&nbsp;<span class="ident" id="4268408">w</span><span class="op" id="4268409">.</span><span class="ident" id="4268410">offsetFreq</span><span class="op" id="4268420">,</span>&nbsp;<span class="ident" id="4268422">w</span><span class="op" id="4268423">.</span><span class="ident" id="4268424">codegenFreq</span><span class="op" id="4268435">}</span>&nbsp;<span class="op" id="4268437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268441">for</span>&nbsp;<span class="ident" id="4268445">i</span>&nbsp;<span class="op" id="4268447">:=</span>&nbsp;<span class="keyword" id="4268450">range</span>&nbsp;<span class="ident" id="4268456">s</span>&nbsp;<span class="op" id="4268458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268463">s</span><span class="op" id="4268464">[</span><span class="ident" id="4268465">i</span><span class="op" id="4268466">]</span>&nbsp;<span class="op" id="4268468">=</span>&nbsp;<span class="num" id="4268470">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268480">for</span>&nbsp;<span class="ident" id="4268484">_</span><span class="op" id="4268485">,</span>&nbsp;<span class="ident" id="4268487">enc</span>&nbsp;<span class="op" id="4268491">:=</span>&nbsp;<span class="keyword" id="4268494">range</span>&nbsp;<span class="op" id="4268500">[</span><span class="op" id="4268501">...</span><span class="op" id="4268504">]</span><span class="op" id="4268505">*</span><span class="ident" id="4268506">huffmanEncoder</span><span class="op" id="4268520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268524">w</span><span class="op" id="4268525">.</span><span class="ident" id="4268526">literalEncoding</span><span class="op" id="4268541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268545">w</span><span class="op" id="4268546">.</span><span class="ident" id="4268547">offsetEncoding</span><span class="op" id="4268561">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268565">w</span><span class="op" id="4268566">.</span><span class="ident" id="4268567">codegenEncoding</span><span class="op" id="4268582">}</span>&nbsp;<span class="op" id="4268584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268588">for</span>&nbsp;<span class="ident" id="4268592">i</span>&nbsp;<span class="op" id="4268594">:=</span>&nbsp;<span class="keyword" id="4268597">range</span>&nbsp;<span class="ident" id="4268603">enc</span><span class="op" id="4268606">.</span><span class="ident" id="4268607">code</span>&nbsp;<span class="op" id="4268612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268617">enc</span><span class="op" id="4268620">.</span><span class="ident" id="4268621">code</span><span class="op" id="4268625">[</span><span class="ident" id="4268626">i</span><span class="op" id="4268627">]</span>&nbsp;<span class="op" id="4268629">=</span>&nbsp;<span class="num" id="4268631">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268639">for</span>&nbsp;<span class="ident" id="4268643">i</span>&nbsp;<span class="op" id="4268645">:=</span>&nbsp;<span class="keyword" id="4268648">range</span>&nbsp;<span class="ident" id="4268654">enc</span><span class="op" id="4268657">.</span><span class="ident" id="4268658">codeBits</span>&nbsp;<span class="op" id="4268667">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268672">enc</span><span class="op" id="4268675">.</span><span class="ident" id="4268676">codeBits</span><span class="op" id="4268684">[</span><span class="ident" id="4268685">i</span><span class="op" id="4268686">]</span>&nbsp;<span class="op" id="4268688">=</span>&nbsp;<span class="num" id="4268690">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268697">}</span><br>
<span class="lineno"></span><span class="op" id="4268699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4268702">func</span>&nbsp;<span class="op" id="4268707">(</span><span class="ident" id="4268708">w</span>&nbsp;<span class="op" id="4268710">*</span><span class="ident" id="4268711">huffmanBitWriter</span><span class="op" id="4268727">)</span>&nbsp;<span class="ident" id="4268729">flushBits</span><span class="op" id="4268738">(</span><span class="op" id="4268739">)</span>&nbsp;<span class="op" id="4268741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268744">if</span>&nbsp;<span class="ident" id="4268747">w</span><span class="op" id="4268748">.</span><span class="ident" id="4268749">err</span>&nbsp;<span class="op" id="4268753">!=</span>&nbsp;<span class="ident" id="4268756">nil</span>&nbsp;<span class="op" id="4268760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268764">w</span><span class="op" id="4268765">.</span><span class="ident" id="4268766">nbits</span>&nbsp;<span class="op" id="4268772">=</span>&nbsp;<span class="num" id="4268774">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268778">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268786">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268789">bits</span>&nbsp;<span class="op" id="4268794">:=</span>&nbsp;<span class="ident" id="4268797">w</span><span class="op" id="4268798">.</span><span class="ident" id="4268799">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268805">w</span><span class="op" id="4268806">.</span><span class="ident" id="4268807">bits</span>&nbsp;<span class="op" id="4268812">&gt;&gt;=</span>&nbsp;<span class="num" id="4268816">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268820">w</span><span class="op" id="4268821">.</span><span class="ident" id="4268822">nbits</span>&nbsp;<span class="op" id="4268828">-=</span>&nbsp;<span class="num" id="4268831">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268835">n</span>&nbsp;<span class="op" id="4268837">:=</span>&nbsp;<span class="ident" id="4268840">w</span><span class="op" id="4268841">.</span><span class="ident" id="4268842">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268850">w</span><span class="op" id="4268851">.</span><span class="ident" id="4268852">bytes</span><span class="op" id="4268857">[</span><span class="ident" id="4268858">n</span><span class="op" id="4268859">]</span>&nbsp;<span class="op" id="4268861">=</span>&nbsp;<span class="builtintype" id="4268863">byte</span><span class="op" id="4268867">(</span><span class="ident" id="4268868">bits</span><span class="op" id="4268872">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268875">w</span><span class="op" id="4268876">.</span><span class="ident" id="4268877">bytes</span><span class="op" id="4268882">[</span><span class="ident" id="4268883">n</span><span class="op" id="4268884">+</span><span class="num" id="4268885">1</span><span class="op" id="4268886">]</span>&nbsp;<span class="op" id="4268888">=</span>&nbsp;<span class="builtintype" id="4268890">byte</span><span class="op" id="4268894">(</span><span class="ident" id="4268895">bits</span>&nbsp;<span class="op" id="4268900">&gt;&gt;</span>&nbsp;<span class="num" id="4268903">8</span><span class="op" id="4268904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268907">if</span>&nbsp;<span class="ident" id="4268910">n</span>&nbsp;<span class="op" id="4268912">+=</span>&nbsp;<span class="num" id="4268915">2</span><span class="op" id="4268916">;</span>&nbsp;<span class="ident" id="4268918">n</span>&nbsp;<span class="op" id="4268920">&gt;=</span>&nbsp;<span class="builtinfunc" id="4268923">len</span><span class="op" id="4268926">(</span><span class="ident" id="4268927">w</span><span class="op" id="4268928">.</span><span class="ident" id="4268929">bytes</span><span class="op" id="4268934">)</span>&nbsp;<span class="op" id="4268936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268940">_</span><span class="op" id="4268941">,</span>&nbsp;<span class="ident" id="4268943">w</span><span class="op" id="4268944">.</span><span class="ident" id="4268945">err</span>&nbsp;<span class="op" id="4268949">=</span>&nbsp;<span class="ident" id="4268951">w</span><span class="op" id="4268952">.</span><span class="ident" id="4268953">w</span><span class="op" id="4268954">.</span><span class="ident" id="4268955">Write</span><span class="op" id="4268960">(</span><span class="ident" id="4268961">w</span><span class="op" id="4268962">.</span><span class="ident" id="4268963">bytes</span><span class="op" id="4268968">[</span><span class="num" id="4268969">0</span><span class="op" id="4268970">:</span><span class="op" id="4268971">]</span><span class="op" id="4268972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268976">n</span>&nbsp;<span class="op" id="4268978">=</span>&nbsp;<span class="num" id="4268980">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268983">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268986">w</span><span class="op" id="4268987">.</span><span class="ident" id="4268988">nbytes</span>&nbsp;<span class="op" id="4268995">=</span>&nbsp;<span class="ident" id="4268997">n</span><br>
<span class="lineno"></span><span class="op" id="4268999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4269002">func</span>&nbsp;<span class="op" id="4269007">(</span><span class="ident" id="4269008">w</span>&nbsp;<span class="op" id="4269010">*</span><span class="ident" id="4269011">huffmanBitWriter</span><span class="op" id="4269027">)</span>&nbsp;<span class="ident" id="4269029">flush</span><span class="op" id="4269034">(</span><span class="op" id="4269035">)</span>&nbsp;<span class="op" id="4269037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269040">if</span>&nbsp;<span class="ident" id="4269043">w</span><span class="op" id="4269044">.</span><span class="ident" id="4269045">err</span>&nbsp;<span class="op" id="4269049">!=</span>&nbsp;<span class="ident" id="4269052">nil</span>&nbsp;<span class="op" id="4269056">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269060">w</span><span class="op" id="4269061">.</span><span class="ident" id="4269062">nbits</span>&nbsp;<span class="op" id="4269068">=</span>&nbsp;<span class="num" id="4269070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269074">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269085">n</span>&nbsp;<span class="op" id="4269087">:=</span>&nbsp;<span class="ident" id="4269090">w</span><span class="op" id="4269091">.</span><span class="ident" id="4269092">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269100">if</span>&nbsp;<span class="ident" id="4269103">w</span><span class="op" id="4269104">.</span><span class="ident" id="4269105">nbits</span>&nbsp;<span class="op" id="4269111">&gt;</span>&nbsp;<span class="num" id="4269113">8</span>&nbsp;<span class="op" id="4269115">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269119">w</span><span class="op" id="4269120">.</span><span class="ident" id="4269121">bytes</span><span class="op" id="4269126">[</span><span class="ident" id="4269127">n</span><span class="op" id="4269128">]</span>&nbsp;<span class="op" id="4269130">=</span>&nbsp;<span class="builtintype" id="4269132">byte</span><span class="op" id="4269136">(</span><span class="ident" id="4269137">w</span><span class="op" id="4269138">.</span><span class="ident" id="4269139">bits</span><span class="op" id="4269143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269147">w</span><span class="op" id="4269148">.</span><span class="ident" id="4269149">bits</span>&nbsp;<span class="op" id="4269154">&gt;&gt;=</span>&nbsp;<span class="num" id="4269158">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269162">w</span><span class="op" id="4269163">.</span><span class="ident" id="4269164">nbits</span>&nbsp;<span class="op" id="4269170">-=</span>&nbsp;<span class="num" id="4269173">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269177">n</span><span class="op" id="4269178">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269182">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269185">if</span>&nbsp;<span class="ident" id="4269188">w</span><span class="op" id="4269189">.</span><span class="ident" id="4269190">nbits</span>&nbsp;<span class="op" id="4269196">&gt;</span>&nbsp;<span class="num" id="4269198">0</span>&nbsp;<span class="op" id="4269200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269204">w</span><span class="op" id="4269205">.</span><span class="ident" id="4269206">bytes</span><span class="op" id="4269211">[</span><span class="ident" id="4269212">n</span><span class="op" id="4269213">]</span>&nbsp;<span class="op" id="4269215">=</span>&nbsp;<span class="builtintype" id="4269217">byte</span><span class="op" id="4269221">(</span><span class="ident" id="4269222">w</span><span class="op" id="4269223">.</span><span class="ident" id="4269224">bits</span><span class="op" id="4269228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269232">w</span><span class="op" id="4269233">.</span><span class="ident" id="4269234">nbits</span>&nbsp;<span class="op" id="4269240">=</span>&nbsp;<span class="num" id="4269242">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269246">n</span><span class="op" id="4269247">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269251">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269254">w</span><span class="op" id="4269255">.</span><span class="ident" id="4269256">bits</span>&nbsp;<span class="op" id="4269261">=</span>&nbsp;<span class="num" id="4269263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269266">_</span><span class="op" id="4269267">,</span>&nbsp;<span class="ident" id="4269269">w</span><span class="op" id="4269270">.</span><span class="ident" id="4269271">err</span>&nbsp;<span class="op" id="4269275">=</span>&nbsp;<span class="ident" id="4269277">w</span><span class="op" id="4269278">.</span><span class="ident" id="4269279">w</span><span class="op" id="4269280">.</span><span class="ident" id="4269281">Write</span><span class="op" id="4269286">(</span><span class="ident" id="4269287">w</span><span class="op" id="4269288">.</span><span class="ident" id="4269289">bytes</span><span class="op" id="4269294">[</span><span class="num" id="4269295">0</span><span class="op" id="4269296">:</span><span class="ident" id="4269297">n</span><span class="op" id="4269298">]</span><span class="op" id="4269299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269302">w</span><span class="op" id="4269303">.</span><span class="ident" id="4269304">nbytes</span>&nbsp;<span class="op" id="4269311">=</span>&nbsp;<span class="num" id="4269313">0</span><br>
<span class="lineno"></span><span class="op" id="4269315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4269318">func</span>&nbsp;<span class="op" id="4269323">(</span><span class="ident" id="4269324">w</span>&nbsp;<span class="op" id="4269326">*</span><span class="ident" id="4269327">huffmanBitWriter</span><span class="op" id="4269343">)</span>&nbsp;<span class="ident" id="4269345">writeBits</span><span class="op" id="4269354">(</span><span class="ident" id="4269355">b</span><span class="op" id="4269356">,</span>&nbsp;<span class="ident" id="4269358">nb</span>&nbsp;<span class="builtintype" id="4269361">int32</span><span class="op" id="4269366">)</span>&nbsp;<span class="op" id="4269368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269371">w</span><span class="op" id="4269372">.</span><span class="ident" id="4269373">bits</span>&nbsp;<span class="op" id="4269378">|=</span>&nbsp;<span class="builtintype" id="4269381">uint32</span><span class="op" id="4269387">(</span><span class="ident" id="4269388">b</span><span class="op" id="4269389">)</span>&nbsp;<span class="op" id="4269391">&lt;&lt;</span>&nbsp;<span class="ident" id="4269394">w</span><span class="op" id="4269395">.</span><span class="ident" id="4269396">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269403">if</span>&nbsp;<span class="ident" id="4269406">w</span><span class="op" id="4269407">.</span><span class="ident" id="4269408">nbits</span>&nbsp;<span class="op" id="4269414">+=</span>&nbsp;<span class="builtintype" id="4269417">uint32</span><span class="op" id="4269423">(</span><span class="ident" id="4269424">nb</span><span class="op" id="4269426">)</span><span class="op" id="4269427">;</span>&nbsp;<span class="ident" id="4269429">w</span><span class="op" id="4269430">.</span><span class="ident" id="4269431">nbits</span>&nbsp;<span class="op" id="4269437">&gt;=</span>&nbsp;<span class="num" id="4269440">16</span>&nbsp;<span class="op" id="4269443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269447">w</span><span class="op" id="4269448">.</span><span class="ident" id="4269449">flushBits</span><span class="op" id="4269458">(</span><span class="op" id="4269459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269462">}</span><br>
<span class="lineno">170</span><span class="op" id="4269464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4269467">func</span>&nbsp;<span class="op" id="4269472">(</span><span class="ident" id="4269473">w</span>&nbsp;<span class="op" id="4269475">*</span><span class="ident" id="4269476">huffmanBitWriter</span><span class="op" id="4269492">)</span>&nbsp;<span class="ident" id="4269494">writeBytes</span><span class="op" id="4269504">(</span><span class="ident" id="4269505">bytes</span>&nbsp;<span class="op" id="4269511">[</span><span class="op" id="4269512">]</span><span class="builtintype" id="4269513">byte</span><span class="op" id="4269517">)</span>&nbsp;<span class="op" id="4269519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269522">if</span>&nbsp;<span class="ident" id="4269525">w</span><span class="op" id="4269526">.</span><span class="ident" id="4269527">err</span>&nbsp;<span class="op" id="4269531">!=</span>&nbsp;<span class="ident" id="4269534">nil</span>&nbsp;<span class="op" id="4269538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269542">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269553">n</span>&nbsp;<span class="op" id="4269555">:=</span>&nbsp;<span class="ident" id="4269558">w</span><span class="op" id="4269559">.</span><span class="ident" id="4269560">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269568">if</span>&nbsp;<span class="ident" id="4269571">w</span><span class="op" id="4269572">.</span><span class="ident" id="4269573">nbits</span>&nbsp;<span class="op" id="4269579">==</span>&nbsp;<span class="num" id="4269582">8</span>&nbsp;<span class="op" id="4269584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269588">w</span><span class="op" id="4269589">.</span><span class="ident" id="4269590">bytes</span><span class="op" id="4269595">[</span><span class="ident" id="4269596">n</span><span class="op" id="4269597">]</span>&nbsp;<span class="op" id="4269599">=</span>&nbsp;<span class="builtintype" id="4269601">byte</span><span class="op" id="4269605">(</span><span class="ident" id="4269606">w</span><span class="op" id="4269607">.</span><span class="ident" id="4269608">bits</span><span class="op" id="4269612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269616">w</span><span class="op" id="4269617">.</span><span class="ident" id="4269618">nbits</span>&nbsp;<span class="op" id="4269624">=</span>&nbsp;<span class="num" id="4269626">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269630">n</span><span class="op" id="4269631">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269638">if</span>&nbsp;<span class="ident" id="4269641">w</span><span class="op" id="4269642">.</span><span class="ident" id="4269643">nbits</span>&nbsp;<span class="op" id="4269649">!=</span>&nbsp;<span class="num" id="4269652">0</span>&nbsp;<span class="op" id="4269654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269658">w</span><span class="op" id="4269659">.</span><span class="ident" id="4269660">err</span>&nbsp;<span class="op" id="4269664">=</span>&nbsp;<span class="ident" id="4269666">InternalError</span><span class="op" id="4269679">(</span><span class="string" id="4269680">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4269713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269717">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269728">if</span>&nbsp;<span class="ident" id="4269731">n</span>&nbsp;<span class="op" id="4269733">!=</span>&nbsp;<span class="num" id="4269736">0</span>&nbsp;<span class="op" id="4269738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269742">_</span><span class="op" id="4269743">,</span>&nbsp;<span class="ident" id="4269745">w</span><span class="op" id="4269746">.</span><span class="ident" id="4269747">err</span>&nbsp;<span class="op" id="4269751">=</span>&nbsp;<span class="ident" id="4269753">w</span><span class="op" id="4269754">.</span><span class="ident" id="4269755">w</span><span class="op" id="4269756">.</span><span class="ident" id="4269757">Write</span><span class="op" id="4269762">(</span><span class="ident" id="4269763">w</span><span class="op" id="4269764">.</span><span class="ident" id="4269765">bytes</span><span class="op" id="4269770">[</span><span class="num" id="4269771">0</span><span class="op" id="4269772">:</span><span class="ident" id="4269773">n</span><span class="op" id="4269774">]</span><span class="op" id="4269775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269779">if</span>&nbsp;<span class="ident" id="4269782">w</span><span class="op" id="4269783">.</span><span class="ident" id="4269784">err</span>&nbsp;<span class="op" id="4269788">!=</span>&nbsp;<span class="ident" id="4269791">nil</span>&nbsp;<span class="op" id="4269795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269800">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269815">w</span><span class="op" id="4269816">.</span><span class="ident" id="4269817">nbytes</span>&nbsp;<span class="op" id="4269824">=</span>&nbsp;<span class="num" id="4269826">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269829">_</span><span class="op" id="4269830">,</span>&nbsp;<span class="ident" id="4269832">w</span><span class="op" id="4269833">.</span><span class="ident" id="4269834">err</span>&nbsp;<span class="op" id="4269838">=</span>&nbsp;<span class="ident" id="4269840">w</span><span class="op" id="4269841">.</span><span class="ident" id="4269842">w</span><span class="op" id="4269843">.</span><span class="ident" id="4269844">Write</span><span class="op" id="4269849">(</span><span class="ident" id="4269850">bytes</span><span class="op" id="4269855">)</span><br>
<span class="lineno"></span><span class="op" id="4269857">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4269860">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4269933">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4270012">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4270072">//</span><br>
<span class="lineno">200</span><span class="comment" id="4270075">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4270144">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4270199">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4270275">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4270322">//</span><br>
<span class="lineno">205</span><span class="comment" id="4270325">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4270388">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4270449">func</span>&nbsp;<span class="op" id="4270454">(</span><span class="ident" id="4270455">w</span>&nbsp;<span class="op" id="4270457">*</span><span class="ident" id="4270458">huffmanBitWriter</span><span class="op" id="4270474">)</span>&nbsp;<span class="ident" id="4270476">generateCodegen</span><span class="op" id="4270491">(</span><span class="ident" id="4270492">numLiterals</span>&nbsp;<span class="builtintype" id="4270504">int</span><span class="op" id="4270507">,</span>&nbsp;<span class="ident" id="4270509">numOffsets</span>&nbsp;<span class="builtintype" id="4270520">int</span><span class="op" id="4270523">)</span>&nbsp;<span class="op" id="4270525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270528">for</span>&nbsp;<span class="ident" id="4270532">i</span>&nbsp;<span class="op" id="4270534">:=</span>&nbsp;<span class="keyword" id="4270537">range</span>&nbsp;<span class="ident" id="4270543">w</span><span class="op" id="4270544">.</span><span class="ident" id="4270545">codegenFreq</span>&nbsp;<span class="op" id="4270557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270561">w</span><span class="op" id="4270562">.</span><span class="ident" id="4270563">codegenFreq</span><span class="op" id="4270574">[</span><span class="ident" id="4270575">i</span><span class="op" id="4270576">]</span>&nbsp;<span class="op" id="4270578">=</span>&nbsp;<span class="num" id="4270580">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270586">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270662">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270735">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270809">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270821">codegen</span>&nbsp;<span class="op" id="4270829">:=</span>&nbsp;<span class="ident" id="4270832">w</span><span class="op" id="4270833">.</span><span class="ident" id="4270834">codegen</span>&nbsp;<span class="comment" id="4270842">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270852">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4270927">copy</span><span class="op" id="4270931">(</span><span class="ident" id="4270932">codegen</span><span class="op" id="4270939">[</span><span class="num" id="4270940">0</span><span class="op" id="4270941">:</span><span class="ident" id="4270942">numLiterals</span><span class="op" id="4270953">]</span><span class="op" id="4270954">,</span>&nbsp;<span class="ident" id="4270956">w</span><span class="op" id="4270957">.</span><span class="ident" id="4270958">literalEncoding</span><span class="op" id="4270973">.</span><span class="ident" id="4270974">codeBits</span><span class="op" id="4270982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4270985">copy</span><span class="op" id="4270989">(</span><span class="ident" id="4270990">codegen</span><span class="op" id="4270997">[</span><span class="ident" id="4270998">numLiterals</span><span class="op" id="4271009">:</span><span class="ident" id="4271010">numLiterals</span><span class="op" id="4271021">+</span><span class="ident" id="4271022">numOffsets</span><span class="op" id="4271032">]</span><span class="op" id="4271033">,</span>&nbsp;<span class="ident" id="4271035">w</span><span class="op" id="4271036">.</span><span class="ident" id="4271037">offsetEncoding</span><span class="op" id="4271051">.</span><span class="ident" id="4271052">codeBits</span><span class="op" id="4271060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271063">codegen</span><span class="op" id="4271070">[</span><span class="ident" id="4271071">numLiterals</span><span class="op" id="4271082">+</span><span class="ident" id="4271083">numOffsets</span><span class="op" id="4271093">]</span>&nbsp;<span class="op" id="4271095">=</span>&nbsp;<span class="ident" id="4271097">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271107">size</span>&nbsp;<span class="op" id="4271112">:=</span>&nbsp;<span class="ident" id="4271115">codegen</span><span class="op" id="4271122">[</span><span class="num" id="4271123">0</span><span class="op" id="4271124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271127">count</span>&nbsp;<span class="op" id="4271133">:=</span>&nbsp;<span class="num" id="4271136">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271139">outIndex</span>&nbsp;<span class="op" id="4271148">:=</span>&nbsp;<span class="num" id="4271151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271154">for</span>&nbsp;<span class="ident" id="4271158">inIndex</span>&nbsp;<span class="op" id="4271166">:=</span>&nbsp;<span class="num" id="4271169">1</span><span class="op" id="4271170">;</span>&nbsp;<span class="ident" id="4271172">size</span>&nbsp;<span class="op" id="4271177">!=</span>&nbsp;<span class="ident" id="4271180">badCode</span><span class="op" id="4271187">;</span>&nbsp;<span class="ident" id="4271189">inIndex</span><span class="op" id="4271196">++</span>&nbsp;<span class="op" id="4271199">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271203">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271273">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271309">nextSize</span>&nbsp;<span class="op" id="4271318">:=</span>&nbsp;<span class="ident" id="4271321">codegen</span><span class="op" id="4271328">[</span><span class="ident" id="4271329">inIndex</span><span class="op" id="4271336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271340">if</span>&nbsp;<span class="ident" id="4271343">nextSize</span>&nbsp;<span class="op" id="4271352">==</span>&nbsp;<span class="ident" id="4271355">size</span>&nbsp;<span class="op" id="4271360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271365">count</span><span class="op" id="4271370">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271376">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271391">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271452">if</span>&nbsp;<span class="ident" id="4271455">size</span>&nbsp;<span class="op" id="4271460">!=</span>&nbsp;<span class="num" id="4271463">0</span>&nbsp;<span class="op" id="4271465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271470">codegen</span><span class="op" id="4271477">[</span><span class="ident" id="4271478">outIndex</span><span class="op" id="4271486">]</span>&nbsp;<span class="op" id="4271488">=</span>&nbsp;<span class="ident" id="4271490">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271498">outIndex</span><span class="op" id="4271506">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271512">w</span><span class="op" id="4271513">.</span><span class="ident" id="4271514">codegenFreq</span><span class="op" id="4271525">[</span><span class="ident" id="4271526">size</span><span class="op" id="4271530">]</span><span class="op" id="4271531">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271537">count</span><span class="op" id="4271542">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271548">for</span>&nbsp;<span class="ident" id="4271552">count</span>&nbsp;<span class="op" id="4271558">&gt;=</span>&nbsp;<span class="num" id="4271561">3</span>&nbsp;<span class="op" id="4271563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271569">n</span>&nbsp;<span class="op" id="4271571">:=</span>&nbsp;<span class="num" id="4271574">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271580">if</span>&nbsp;<span class="ident" id="4271583">n</span>&nbsp;<span class="op" id="4271585">&gt;</span>&nbsp;<span class="ident" id="4271587">count</span>&nbsp;<span class="op" id="4271593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271600">n</span>&nbsp;<span class="op" id="4271602">=</span>&nbsp;<span class="ident" id="4271604">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271620">codegen</span><span class="op" id="4271627">[</span><span class="ident" id="4271628">outIndex</span><span class="op" id="4271636">]</span>&nbsp;<span class="op" id="4271638">=</span>&nbsp;<span class="num" id="4271640">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271647">outIndex</span><span class="op" id="4271655">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271662">codegen</span><span class="op" id="4271669">[</span><span class="ident" id="4271670">outIndex</span><span class="op" id="4271678">]</span>&nbsp;<span class="op" id="4271680">=</span>&nbsp;<span class="builtintype" id="4271682">uint8</span><span class="op" id="4271687">(</span><span class="ident" id="4271688">n</span>&nbsp;<span class="op" id="4271690">-</span>&nbsp;<span class="num" id="4271692">3</span><span class="op" id="4271693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271699">outIndex</span><span class="op" id="4271707">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271714">w</span><span class="op" id="4271715">.</span><span class="ident" id="4271716">codegenFreq</span><span class="op" id="4271727">[</span><span class="num" id="4271728">16</span><span class="op" id="4271730">]</span><span class="op" id="4271731">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271738">count</span>&nbsp;<span class="op" id="4271744">-=</span>&nbsp;<span class="ident" id="4271747">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271752">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271756">}</span>&nbsp;<span class="keyword" id="4271758">else</span>&nbsp;<span class="op" id="4271763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271768">for</span>&nbsp;<span class="ident" id="4271772">count</span>&nbsp;<span class="op" id="4271778">&gt;=</span>&nbsp;<span class="num" id="4271781">11</span>&nbsp;<span class="op" id="4271784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271790">n</span>&nbsp;<span class="op" id="4271792">:=</span>&nbsp;<span class="num" id="4271795">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271803">if</span>&nbsp;<span class="ident" id="4271806">n</span>&nbsp;<span class="op" id="4271808">&gt;</span>&nbsp;<span class="ident" id="4271810">count</span>&nbsp;<span class="op" id="4271816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271823">n</span>&nbsp;<span class="op" id="4271825">=</span>&nbsp;<span class="ident" id="4271827">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271843">codegen</span><span class="op" id="4271850">[</span><span class="ident" id="4271851">outIndex</span><span class="op" id="4271859">]</span>&nbsp;<span class="op" id="4271861">=</span>&nbsp;<span class="num" id="4271863">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271870">outIndex</span><span class="op" id="4271878">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271885">codegen</span><span class="op" id="4271892">[</span><span class="ident" id="4271893">outIndex</span><span class="op" id="4271901">]</span>&nbsp;<span class="op" id="4271903">=</span>&nbsp;<span class="builtintype" id="4271905">uint8</span><span class="op" id="4271910">(</span><span class="ident" id="4271911">n</span>&nbsp;<span class="op" id="4271913">-</span>&nbsp;<span class="num" id="4271915">11</span><span class="op" id="4271917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271923">outIndex</span><span class="op" id="4271931">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271938">w</span><span class="op" id="4271939">.</span><span class="ident" id="4271940">codegenFreq</span><span class="op" id="4271951">[</span><span class="num" id="4271952">18</span><span class="op" id="4271954">]</span><span class="op" id="4271955">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271962">count</span>&nbsp;<span class="op" id="4271968">-=</span>&nbsp;<span class="ident" id="4271971">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271981">if</span>&nbsp;<span class="ident" id="4271984">count</span>&nbsp;<span class="op" id="4271990">&gt;=</span>&nbsp;<span class="num" id="4271993">3</span>&nbsp;<span class="op" id="4271995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272001">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272034">codegen</span><span class="op" id="4272041">[</span><span class="ident" id="4272042">outIndex</span><span class="op" id="4272050">]</span>&nbsp;<span class="op" id="4272052">=</span>&nbsp;<span class="num" id="4272054">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272061">outIndex</span><span class="op" id="4272069">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272076">codegen</span><span class="op" id="4272083">[</span><span class="ident" id="4272084">outIndex</span><span class="op" id="4272092">]</span>&nbsp;<span class="op" id="4272094">=</span>&nbsp;<span class="builtintype" id="4272096">uint8</span><span class="op" id="4272101">(</span><span class="ident" id="4272102">count</span>&nbsp;<span class="op" id="4272108">-</span>&nbsp;<span class="num" id="4272110">3</span><span class="op" id="4272111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272117">outIndex</span><span class="op" id="4272125">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272132">w</span><span class="op" id="4272133">.</span><span class="ident" id="4272134">codegenFreq</span><span class="op" id="4272145">[</span><span class="num" id="4272146">17</span><span class="op" id="4272148">]</span><span class="op" id="4272149">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272156">count</span>&nbsp;<span class="op" id="4272162">=</span>&nbsp;<span class="num" id="4272164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272177">count</span><span class="op" id="4272182">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272187">for</span>&nbsp;<span class="op" id="4272191">;</span>&nbsp;<span class="ident" id="4272193">count</span>&nbsp;<span class="op" id="4272199">&gt;=</span>&nbsp;<span class="num" id="4272202">0</span><span class="op" id="4272203">;</span>&nbsp;<span class="ident" id="4272205">count</span><span class="op" id="4272210">--</span>&nbsp;<span class="op" id="4272213">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272218">codegen</span><span class="op" id="4272225">[</span><span class="ident" id="4272226">outIndex</span><span class="op" id="4272234">]</span>&nbsp;<span class="op" id="4272236">=</span>&nbsp;<span class="ident" id="4272238">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272246">outIndex</span><span class="op" id="4272254">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272260">w</span><span class="op" id="4272261">.</span><span class="ident" id="4272262">codegenFreq</span><span class="op" id="4272273">[</span><span class="ident" id="4272274">size</span><span class="op" id="4272278">]</span><span class="op" id="4272279">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272288">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272342">size</span>&nbsp;<span class="op" id="4272347">=</span>&nbsp;<span class="ident" id="4272349">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272360">count</span>&nbsp;<span class="op" id="4272366">=</span>&nbsp;<span class="num" id="4272368">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272374">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272420">codegen</span><span class="op" id="4272427">[</span><span class="ident" id="4272428">outIndex</span><span class="op" id="4272436">]</span>&nbsp;<span class="op" id="4272438">=</span>&nbsp;<span class="ident" id="4272440">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4272448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4272451">func</span>&nbsp;<span class="op" id="4272456">(</span><span class="ident" id="4272457">w</span>&nbsp;<span class="op" id="4272459">*</span><span class="ident" id="4272460">huffmanBitWriter</span><span class="op" id="4272476">)</span>&nbsp;<span class="ident" id="4272478">writeCode</span><span class="op" id="4272487">(</span><span class="ident" id="4272488">code</span>&nbsp;<span class="op" id="4272493">*</span><span class="ident" id="4272494">huffmanEncoder</span><span class="op" id="4272508">,</span>&nbsp;<span class="ident" id="4272510">literal</span>&nbsp;<span class="builtintype" id="4272518">uint32</span><span class="op" id="4272524">)</span>&nbsp;<span class="op" id="4272526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272529">if</span>&nbsp;<span class="ident" id="4272532">w</span><span class="op" id="4272533">.</span><span class="ident" id="4272534">err</span>&nbsp;<span class="op" id="4272538">!=</span>&nbsp;<span class="ident" id="4272541">nil</span>&nbsp;<span class="op" id="4272545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272549">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272560">w</span><span class="op" id="4272561">.</span><span class="ident" id="4272562">writeBits</span><span class="op" id="4272571">(</span><span class="builtintype" id="4272572">int32</span><span class="op" id="4272577">(</span><span class="ident" id="4272578">code</span><span class="op" id="4272582">.</span><span class="ident" id="4272583">code</span><span class="op" id="4272587">[</span><span class="ident" id="4272588">literal</span><span class="op" id="4272595">]</span><span class="op" id="4272596">)</span><span class="op" id="4272597">,</span>&nbsp;<span class="builtintype" id="4272599">int32</span><span class="op" id="4272604">(</span><span class="ident" id="4272605">code</span><span class="op" id="4272609">.</span><span class="ident" id="4272610">codeBits</span><span class="op" id="4272618">[</span><span class="ident" id="4272619">literal</span><span class="op" id="4272626">]</span><span class="op" id="4272627">)</span><span class="op" id="4272628">)</span><br>
<span class="lineno"></span><span class="op" id="4272630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4272633">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4272702">//</span><br>
<span class="lineno"></span><span class="comment" id="4272705">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4272766">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4272826">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4272882">func</span>&nbsp;<span class="op" id="4272887">(</span><span class="ident" id="4272888">w</span>&nbsp;<span class="op" id="4272890">*</span><span class="ident" id="4272891">huffmanBitWriter</span><span class="op" id="4272907">)</span>&nbsp;<span class="ident" id="4272909">writeDynamicHeader</span><span class="op" id="4272927">(</span><span class="ident" id="4272928">numLiterals</span>&nbsp;<span class="builtintype" id="4272940">int</span><span class="op" id="4272943">,</span>&nbsp;<span class="ident" id="4272945">numOffsets</span>&nbsp;<span class="builtintype" id="4272956">int</span><span class="op" id="4272959">,</span>&nbsp;<span class="ident" id="4272961">numCodegens</span>&nbsp;<span class="builtintype" id="4272973">int</span><span class="op" id="4272976">,</span>&nbsp;<span class="ident" id="4272978">isEof</span>&nbsp;<span class="builtintype" id="4272984">bool</span><span class="op" id="4272988">)</span>&nbsp;<span class="op" id="4272990">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272993">if</span>&nbsp;<span class="ident" id="4272996">w</span><span class="op" id="4272997">.</span><span class="ident" id="4272998">err</span>&nbsp;<span class="op" id="4273002">!=</span>&nbsp;<span class="ident" id="4273005">nil</span>&nbsp;<span class="op" id="4273009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273013">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273024">var</span>&nbsp;<span class="ident" id="4273028">firstBits</span>&nbsp;<span class="builtintype" id="4273038">int32</span>&nbsp;<span class="op" id="4273044">=</span>&nbsp;<span class="num" id="4273046">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273049">if</span>&nbsp;<span class="ident" id="4273052">isEof</span>&nbsp;<span class="op" id="4273058">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273062">firstBits</span>&nbsp;<span class="op" id="4273072">=</span>&nbsp;<span class="num" id="4273074">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273080">w</span><span class="op" id="4273081">.</span><span class="ident" id="4273082">writeBits</span><span class="op" id="4273091">(</span><span class="ident" id="4273092">firstBits</span><span class="op" id="4273101">,</span>&nbsp;<span class="num" id="4273103">3</span><span class="op" id="4273104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273107">w</span><span class="op" id="4273108">.</span><span class="ident" id="4273109">writeBits</span><span class="op" id="4273118">(</span><span class="builtintype" id="4273119">int32</span><span class="op" id="4273124">(</span><span class="ident" id="4273125">numLiterals</span><span class="op" id="4273136">-</span><span class="num" id="4273137">257</span><span class="op" id="4273140">)</span><span class="op" id="4273141">,</span>&nbsp;<span class="num" id="4273143">5</span><span class="op" id="4273144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273147">w</span><span class="op" id="4273148">.</span><span class="ident" id="4273149">writeBits</span><span class="op" id="4273158">(</span><span class="builtintype" id="4273159">int32</span><span class="op" id="4273164">(</span><span class="ident" id="4273165">numOffsets</span><span class="op" id="4273175">-</span><span class="num" id="4273176">1</span><span class="op" id="4273177">)</span><span class="op" id="4273178">,</span>&nbsp;<span class="num" id="4273180">5</span><span class="op" id="4273181">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273184">w</span><span class="op" id="4273185">.</span><span class="ident" id="4273186">writeBits</span><span class="op" id="4273195">(</span><span class="builtintype" id="4273196">int32</span><span class="op" id="4273201">(</span><span class="ident" id="4273202">numCodegens</span><span class="op" id="4273213">-</span><span class="num" id="4273214">4</span><span class="op" id="4273215">)</span><span class="op" id="4273216">,</span>&nbsp;<span class="num" id="4273218">4</span><span class="op" id="4273219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273223">for</span>&nbsp;<span class="ident" id="4273227">i</span>&nbsp;<span class="op" id="4273229">:=</span>&nbsp;<span class="num" id="4273232">0</span><span class="op" id="4273233">;</span>&nbsp;<span class="ident" id="4273235">i</span>&nbsp;<span class="op" id="4273237">&lt;</span>&nbsp;<span class="ident" id="4273239">numCodegens</span><span class="op" id="4273250">;</span>&nbsp;<span class="ident" id="4273252">i</span><span class="op" id="4273253">++</span>&nbsp;<span class="op" id="4273256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273260">value</span>&nbsp;<span class="op" id="4273266">:=</span>&nbsp;<span class="ident" id="4273269">w</span><span class="op" id="4273270">.</span><span class="ident" id="4273271">codegenEncoding</span><span class="op" id="4273286">.</span><span class="ident" id="4273287">codeBits</span><span class="op" id="4273295">[</span><span class="ident" id="4273296">codegenOrder</span><span class="op" id="4273308">[</span><span class="ident" id="4273309">i</span><span class="op" id="4273310">]</span><span class="op" id="4273311">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273315">w</span><span class="op" id="4273316">.</span><span class="ident" id="4273317">writeBits</span><span class="op" id="4273326">(</span><span class="builtintype" id="4273327">int32</span><span class="op" id="4273332">(</span><span class="ident" id="4273333">value</span><span class="op" id="4273338">)</span><span class="op" id="4273339">,</span>&nbsp;<span class="num" id="4273341">3</span><span class="op" id="4273342">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273349">i</span>&nbsp;<span class="op" id="4273351">:=</span>&nbsp;<span class="num" id="4273354">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273357">for</span>&nbsp;<span class="op" id="4273361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273365">var</span>&nbsp;<span class="ident" id="4273369">codeWord</span>&nbsp;<span class="builtintype" id="4273378">int</span>&nbsp;<span class="op" id="4273382">=</span>&nbsp;<span class="builtintype" id="4273384">int</span><span class="op" id="4273387">(</span><span class="ident" id="4273388">w</span><span class="op" id="4273389">.</span><span class="ident" id="4273390">codegen</span><span class="op" id="4273397">[</span><span class="ident" id="4273398">i</span><span class="op" id="4273399">]</span><span class="op" id="4273400">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273404">i</span><span class="op" id="4273405">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273410">if</span>&nbsp;<span class="ident" id="4273413">codeWord</span>&nbsp;<span class="op" id="4273422">==</span>&nbsp;<span class="ident" id="4273425">badCode</span>&nbsp;<span class="op" id="4273433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273438">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273450">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273506">w</span><span class="op" id="4273507">.</span><span class="ident" id="4273508">writeCode</span><span class="op" id="4273517">(</span><span class="ident" id="4273518">w</span><span class="op" id="4273519">.</span><span class="ident" id="4273520">codegenEncoding</span><span class="op" id="4273535">,</span>&nbsp;<span class="builtintype" id="4273537">uint32</span><span class="op" id="4273543">(</span><span class="ident" id="4273544">codeWord</span><span class="op" id="4273552">)</span><span class="op" id="4273553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273558">switch</span>&nbsp;<span class="ident" id="4273565">codeWord</span>&nbsp;<span class="op" id="4273574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273578">case</span>&nbsp;<span class="num" id="4273583">16</span><span class="op" id="4273585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273590">w</span><span class="op" id="4273591">.</span><span class="ident" id="4273592">writeBits</span><span class="op" id="4273601">(</span><span class="builtintype" id="4273602">int32</span><span class="op" id="4273607">(</span><span class="ident" id="4273608">w</span><span class="op" id="4273609">.</span><span class="ident" id="4273610">codegen</span><span class="op" id="4273617">[</span><span class="ident" id="4273618">i</span><span class="op" id="4273619">]</span><span class="op" id="4273620">)</span><span class="op" id="4273621">,</span>&nbsp;<span class="num" id="4273623">2</span><span class="op" id="4273624">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273629">i</span><span class="op" id="4273630">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273636">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273644">case</span>&nbsp;<span class="num" id="4273649">17</span><span class="op" id="4273651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273656">w</span><span class="op" id="4273657">.</span><span class="ident" id="4273658">writeBits</span><span class="op" id="4273667">(</span><span class="builtintype" id="4273668">int32</span><span class="op" id="4273673">(</span><span class="ident" id="4273674">w</span><span class="op" id="4273675">.</span><span class="ident" id="4273676">codegen</span><span class="op" id="4273683">[</span><span class="ident" id="4273684">i</span><span class="op" id="4273685">]</span><span class="op" id="4273686">)</span><span class="op" id="4273687">,</span>&nbsp;<span class="num" id="4273689">3</span><span class="op" id="4273690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273695">i</span><span class="op" id="4273696">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273702">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273710">case</span>&nbsp;<span class="num" id="4273715">18</span><span class="op" id="4273717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273722">w</span><span class="op" id="4273723">.</span><span class="ident" id="4273724">writeBits</span><span class="op" id="4273733">(</span><span class="builtintype" id="4273734">int32</span><span class="op" id="4273739">(</span><span class="ident" id="4273740">w</span><span class="op" id="4273741">.</span><span class="ident" id="4273742">codegen</span><span class="op" id="4273749">[</span><span class="ident" id="4273750">i</span><span class="op" id="4273751">]</span><span class="op" id="4273752">)</span><span class="op" id="4273753">,</span>&nbsp;<span class="num" id="4273755">7</span><span class="op" id="4273756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273761">i</span><span class="op" id="4273762">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273768">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273779">}</span><br>
<span class="lineno"></span><span class="op" id="4273781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4273784">func</span>&nbsp;<span class="op" id="4273789">(</span><span class="ident" id="4273790">w</span>&nbsp;<span class="op" id="4273792">*</span><span class="ident" id="4273793">huffmanBitWriter</span><span class="op" id="4273809">)</span>&nbsp;<span class="ident" id="4273811">writeStoredHeader</span><span class="op" id="4273828">(</span><span class="ident" id="4273829">length</span>&nbsp;<span class="builtintype" id="4273836">int</span><span class="op" id="4273839">,</span>&nbsp;<span class="ident" id="4273841">isEof</span>&nbsp;<span class="builtintype" id="4273847">bool</span><span class="op" id="4273851">)</span>&nbsp;<span class="op" id="4273853">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273856">if</span>&nbsp;<span class="ident" id="4273859">w</span><span class="op" id="4273860">.</span><span class="ident" id="4273861">err</span>&nbsp;<span class="op" id="4273865">!=</span>&nbsp;<span class="ident" id="4273868">nil</span>&nbsp;<span class="op" id="4273872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273876">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273887">var</span>&nbsp;<span class="ident" id="4273891">flag</span>&nbsp;<span class="builtintype" id="4273896">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273903">if</span>&nbsp;<span class="ident" id="4273906">isEof</span>&nbsp;<span class="op" id="4273912">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273916">flag</span>&nbsp;<span class="op" id="4273921">=</span>&nbsp;<span class="num" id="4273923">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273929">w</span><span class="op" id="4273930">.</span><span class="ident" id="4273931">writeBits</span><span class="op" id="4273940">(</span><span class="ident" id="4273941">flag</span><span class="op" id="4273945">,</span>&nbsp;<span class="num" id="4273947">3</span><span class="op" id="4273948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273951">w</span><span class="op" id="4273952">.</span><span class="ident" id="4273953">flush</span><span class="op" id="4273958">(</span><span class="op" id="4273959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273962">w</span><span class="op" id="4273963">.</span><span class="ident" id="4273964">writeBits</span><span class="op" id="4273973">(</span><span class="builtintype" id="4273974">int32</span><span class="op" id="4273979">(</span><span class="ident" id="4273980">length</span><span class="op" id="4273986">)</span><span class="op" id="4273987">,</span>&nbsp;<span class="num" id="4273989">16</span><span class="op" id="4273991">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273994">w</span><span class="op" id="4273995">.</span><span class="ident" id="4273996">writeBits</span><span class="op" id="4274005">(</span><span class="builtintype" id="4274006">int32</span><span class="op" id="4274011">(</span><span class="op" id="4274012">^</span><span class="builtintype" id="4274013">uint16</span><span class="op" id="4274019">(</span><span class="ident" id="4274020">length</span><span class="op" id="4274026">)</span><span class="op" id="4274027">)</span><span class="op" id="4274028">,</span>&nbsp;<span class="num" id="4274030">16</span><span class="op" id="4274032">)</span><br>
<span class="lineno"></span><span class="op" id="4274034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4274037">func</span>&nbsp;<span class="op" id="4274042">(</span><span class="ident" id="4274043">w</span>&nbsp;<span class="op" id="4274045">*</span><span class="ident" id="4274046">huffmanBitWriter</span><span class="op" id="4274062">)</span>&nbsp;<span class="ident" id="4274064">writeFixedHeader</span><span class="op" id="4274080">(</span><span class="ident" id="4274081">isEof</span>&nbsp;<span class="builtintype" id="4274087">bool</span><span class="op" id="4274091">)</span>&nbsp;<span class="op" id="4274093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274096">if</span>&nbsp;<span class="ident" id="4274099">w</span><span class="op" id="4274100">.</span><span class="ident" id="4274101">err</span>&nbsp;<span class="op" id="4274105">!=</span>&nbsp;<span class="ident" id="4274108">nil</span>&nbsp;<span class="op" id="4274112">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274116">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274127">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274174">var</span>&nbsp;<span class="ident" id="4274178">value</span>&nbsp;<span class="builtintype" id="4274184">int32</span>&nbsp;<span class="op" id="4274190">=</span>&nbsp;<span class="num" id="4274192">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274195">if</span>&nbsp;<span class="ident" id="4274198">isEof</span>&nbsp;<span class="op" id="4274204">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274208">value</span>&nbsp;<span class="op" id="4274214">=</span>&nbsp;<span class="num" id="4274216">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274222">w</span><span class="op" id="4274223">.</span><span class="ident" id="4274224">writeBits</span><span class="op" id="4274233">(</span><span class="ident" id="4274234">value</span><span class="op" id="4274239">,</span>&nbsp;<span class="num" id="4274241">3</span><span class="op" id="4274242">)</span><br>
<span class="lineno"></span><span class="op" id="4274244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4274247">func</span>&nbsp;<span class="op" id="4274252">(</span><span class="ident" id="4274253">w</span>&nbsp;<span class="op" id="4274255">*</span><span class="ident" id="4274256">huffmanBitWriter</span><span class="op" id="4274272">)</span>&nbsp;<span class="ident" id="4274274">writeBlock</span><span class="op" id="4274284">(</span><span class="ident" id="4274285">tokens</span>&nbsp;<span class="op" id="4274292">[</span><span class="op" id="4274293">]</span><span class="ident" id="4274294">token</span><span class="op" id="4274299">,</span>&nbsp;<span class="ident" id="4274301">eof</span>&nbsp;<span class="builtintype" id="4274305">bool</span><span class="op" id="4274309">,</span>&nbsp;<span class="ident" id="4274311">input</span>&nbsp;<span class="op" id="4274317">[</span><span class="op" id="4274318">]</span><span class="builtintype" id="4274319">byte</span><span class="op" id="4274323">)</span>&nbsp;<span class="op" id="4274325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274328">if</span>&nbsp;<span class="ident" id="4274331">w</span><span class="op" id="4274332">.</span><span class="ident" id="4274333">err</span>&nbsp;<span class="op" id="4274337">!=</span>&nbsp;<span class="ident" id="4274340">nil</span>&nbsp;<span class="op" id="4274344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274359">for</span>&nbsp;<span class="ident" id="4274363">i</span>&nbsp;<span class="op" id="4274365">:=</span>&nbsp;<span class="keyword" id="4274368">range</span>&nbsp;<span class="ident" id="4274374">w</span><span class="op" id="4274375">.</span><span class="ident" id="4274376">literalFreq</span>&nbsp;<span class="op" id="4274388">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274392">w</span><span class="op" id="4274393">.</span><span class="ident" id="4274394">literalFreq</span><span class="op" id="4274405">[</span><span class="ident" id="4274406">i</span><span class="op" id="4274407">]</span>&nbsp;<span class="op" id="4274409">=</span>&nbsp;<span class="num" id="4274411">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274417">for</span>&nbsp;<span class="ident" id="4274421">i</span>&nbsp;<span class="op" id="4274423">:=</span>&nbsp;<span class="keyword" id="4274426">range</span>&nbsp;<span class="ident" id="4274432">w</span><span class="op" id="4274433">.</span><span class="ident" id="4274434">offsetFreq</span>&nbsp;<span class="op" id="4274445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274449">w</span><span class="op" id="4274450">.</span><span class="ident" id="4274451">offsetFreq</span><span class="op" id="4274461">[</span><span class="ident" id="4274462">i</span><span class="op" id="4274463">]</span>&nbsp;<span class="op" id="4274465">=</span>&nbsp;<span class="num" id="4274467">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274470">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274474">n</span>&nbsp;<span class="op" id="4274476">:=</span>&nbsp;<span class="builtinfunc" id="4274479">len</span><span class="op" id="4274482">(</span><span class="ident" id="4274483">tokens</span><span class="op" id="4274489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274492">tokens</span>&nbsp;<span class="op" id="4274499">=</span>&nbsp;<span class="ident" id="4274501">tokens</span><span class="op" id="4274507">[</span><span class="num" id="4274508">0</span>&nbsp;<span class="op" id="4274510">:</span>&nbsp;<span class="ident" id="4274512">n</span><span class="op" id="4274513">+</span><span class="num" id="4274514">1</span><span class="op" id="4274515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274518">tokens</span><span class="op" id="4274524">[</span><span class="ident" id="4274525">n</span><span class="op" id="4274526">]</span>&nbsp;<span class="op" id="4274528">=</span>&nbsp;<span class="ident" id="4274530">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274547">for</span>&nbsp;<span class="ident" id="4274551">_</span><span class="op" id="4274552">,</span>&nbsp;<span class="ident" id="4274554">t</span>&nbsp;<span class="op" id="4274556">:=</span>&nbsp;<span class="keyword" id="4274559">range</span>&nbsp;<span class="ident" id="4274565">tokens</span>&nbsp;<span class="op" id="4274572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274576">switch</span>&nbsp;<span class="ident" id="4274583">t</span><span class="op" id="4274584">.</span><span class="ident" id="4274585">typ</span><span class="op" id="4274588">(</span><span class="op" id="4274589">)</span>&nbsp;<span class="op" id="4274591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274595">case</span>&nbsp;<span class="ident" id="4274600">literalType</span><span class="op" id="4274611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274616">w</span><span class="op" id="4274617">.</span><span class="ident" id="4274618">literalFreq</span><span class="op" id="4274629">[</span><span class="ident" id="4274630">t</span><span class="op" id="4274631">.</span><span class="ident" id="4274632">literal</span><span class="op" id="4274639">(</span><span class="op" id="4274640">)</span><span class="op" id="4274641">]</span><span class="op" id="4274642">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274647">case</span>&nbsp;<span class="ident" id="4274652">matchType</span><span class="op" id="4274661">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274666">length</span>&nbsp;<span class="op" id="4274673">:=</span>&nbsp;<span class="ident" id="4274676">t</span><span class="op" id="4274677">.</span><span class="ident" id="4274678">length</span><span class="op" id="4274684">(</span><span class="op" id="4274685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274690">offset</span>&nbsp;<span class="op" id="4274697">:=</span>&nbsp;<span class="ident" id="4274700">t</span><span class="op" id="4274701">.</span><span class="ident" id="4274702">offset</span><span class="op" id="4274708">(</span><span class="op" id="4274709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274714">w</span><span class="op" id="4274715">.</span><span class="ident" id="4274716">literalFreq</span><span class="op" id="4274727">[</span><span class="ident" id="4274728">lengthCodesStart</span><span class="op" id="4274744">+</span><span class="ident" id="4274745">lengthCode</span><span class="op" id="4274755">(</span><span class="ident" id="4274756">length</span><span class="op" id="4274762">)</span><span class="op" id="4274763">]</span><span class="op" id="4274764">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274770">w</span><span class="op" id="4274771">.</span><span class="ident" id="4274772">offsetFreq</span><span class="op" id="4274782">[</span><span class="ident" id="4274783">offsetCode</span><span class="op" id="4274793">(</span><span class="ident" id="4274794">offset</span><span class="op" id="4274800">)</span><span class="op" id="4274801">]</span><span class="op" id="4274802">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274807">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274814">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274845">numLiterals</span>&nbsp;<span class="op" id="4274857">:=</span>&nbsp;<span class="builtinfunc" id="4274860">len</span><span class="op" id="4274863">(</span><span class="ident" id="4274864">w</span><span class="op" id="4274865">.</span><span class="ident" id="4274866">literalFreq</span><span class="op" id="4274877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274880">for</span>&nbsp;<span class="ident" id="4274884">w</span><span class="op" id="4274885">.</span><span class="ident" id="4274886">literalFreq</span><span class="op" id="4274897">[</span><span class="ident" id="4274898">numLiterals</span><span class="op" id="4274909">-</span><span class="num" id="4274910">1</span><span class="op" id="4274911">]</span>&nbsp;<span class="op" id="4274913">==</span>&nbsp;<span class="num" id="4274916">0</span>&nbsp;<span class="op" id="4274918">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274922">numLiterals</span><span class="op" id="4274933">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274940">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274970">numOffsets</span>&nbsp;<span class="op" id="4274981">:=</span>&nbsp;<span class="builtinfunc" id="4274984">len</span><span class="op" id="4274987">(</span><span class="ident" id="4274988">w</span><span class="op" id="4274989">.</span><span class="ident" id="4274990">offsetFreq</span><span class="op" id="4275000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275003">for</span>&nbsp;<span class="ident" id="4275007">numOffsets</span>&nbsp;<span class="op" id="4275018">&gt;</span>&nbsp;<span class="num" id="4275020">0</span>&nbsp;<span class="op" id="4275022">&amp;&amp;</span>&nbsp;<span class="ident" id="4275025">w</span><span class="op" id="4275026">.</span><span class="ident" id="4275027">offsetFreq</span><span class="op" id="4275037">[</span><span class="ident" id="4275038">numOffsets</span><span class="op" id="4275048">-</span><span class="num" id="4275049">1</span><span class="op" id="4275050">]</span>&nbsp;<span class="op" id="4275052">==</span>&nbsp;<span class="num" id="4275055">0</span>&nbsp;<span class="op" id="4275057">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275061">numOffsets</span><span class="op" id="4275071">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275078">if</span>&nbsp;<span class="ident" id="4275081">numOffsets</span>&nbsp;<span class="op" id="4275092">==</span>&nbsp;<span class="num" id="4275095">0</span>&nbsp;<span class="op" id="4275097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275101">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275183">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275282">w</span><span class="op" id="4275283">.</span><span class="ident" id="4275284">offsetFreq</span><span class="op" id="4275294">[</span><span class="num" id="4275295">0</span><span class="op" id="4275296">]</span>&nbsp;<span class="op" id="4275298">=</span>&nbsp;<span class="num" id="4275300">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275304">numOffsets</span>&nbsp;<span class="op" id="4275315">=</span>&nbsp;<span class="num" id="4275317">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275324">w</span><span class="op" id="4275325">.</span><span class="ident" id="4275326">literalEncoding</span><span class="op" id="4275341">.</span><span class="ident" id="4275342">generate</span><span class="op" id="4275350">(</span><span class="ident" id="4275351">w</span><span class="op" id="4275352">.</span><span class="ident" id="4275353">literalFreq</span><span class="op" id="4275364">,</span>&nbsp;<span class="num" id="4275366">15</span><span class="op" id="4275368">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275371">w</span><span class="op" id="4275372">.</span><span class="ident" id="4275373">offsetEncoding</span><span class="op" id="4275387">.</span><span class="ident" id="4275388">generate</span><span class="op" id="4275396">(</span><span class="ident" id="4275397">w</span><span class="op" id="4275398">.</span><span class="ident" id="4275399">offsetFreq</span><span class="op" id="4275409">,</span>&nbsp;<span class="num" id="4275411">15</span><span class="op" id="4275413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275417">storedBytes</span>&nbsp;<span class="op" id="4275429">:=</span>&nbsp;<span class="num" id="4275432">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275435">if</span>&nbsp;<span class="ident" id="4275438">input</span>&nbsp;<span class="op" id="4275444">!=</span>&nbsp;<span class="ident" id="4275447">nil</span>&nbsp;<span class="op" id="4275451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275455">storedBytes</span>&nbsp;<span class="op" id="4275467">=</span>&nbsp;<span class="builtinfunc" id="4275469">len</span><span class="op" id="4275472">(</span><span class="ident" id="4275473">input</span><span class="op" id="4275478">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275484">var</span>&nbsp;<span class="ident" id="4275488">extraBits</span>&nbsp;<span class="ident" id="4275498">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275505">var</span>&nbsp;<span class="ident" id="4275509">storedSize</span>&nbsp;<span class="ident" id="4275520">int64</span>&nbsp;<span class="op" id="4275526">=</span>&nbsp;<span class="ident" id="4275528">math</span><span class="op" id="4275532">.</span><span class="ident" id="4275533">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275543">if</span>&nbsp;<span class="ident" id="4275546">storedBytes</span>&nbsp;<span class="op" id="4275558">&lt;=</span>&nbsp;<span class="ident" id="4275561">maxStoreBlockSize</span>&nbsp;<span class="op" id="4275579">&amp;&amp;</span>&nbsp;<span class="ident" id="4275582">input</span>&nbsp;<span class="op" id="4275588">!=</span>&nbsp;<span class="ident" id="4275591">nil</span>&nbsp;<span class="op" id="4275595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275599">storedSize</span>&nbsp;<span class="op" id="4275610">=</span>&nbsp;<span class="ident" id="4275612">int64</span><span class="op" id="4275617">(</span><span class="op" id="4275618">(</span><span class="ident" id="4275619">storedBytes</span>&nbsp;<span class="op" id="4275631">+</span>&nbsp;<span class="num" id="4275633">5</span><span class="op" id="4275634">)</span>&nbsp;<span class="op" id="4275636">*</span>&nbsp;<span class="num" id="4275638">8</span><span class="op" id="4275639">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275643">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275715">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275787">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275857">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275887">for</span>&nbsp;<span class="ident" id="4275891">lengthCode</span>&nbsp;<span class="op" id="4275902">:=</span>&nbsp;<span class="ident" id="4275905">lengthCodesStart</span>&nbsp;<span class="op" id="4275922">+</span>&nbsp;<span class="num" id="4275924">8</span><span class="op" id="4275925">;</span>&nbsp;<span class="ident" id="4275927">lengthCode</span>&nbsp;<span class="op" id="4275938">&lt;</span>&nbsp;<span class="ident" id="4275940">numLiterals</span><span class="op" id="4275951">;</span>&nbsp;<span class="ident" id="4275953">lengthCode</span><span class="op" id="4275963">++</span>&nbsp;<span class="op" id="4275966">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275971">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276023">extraBits</span>&nbsp;<span class="op" id="4276033">+=</span>&nbsp;<span class="ident" id="4276036">int64</span><span class="op" id="4276041">(</span><span class="ident" id="4276042">w</span><span class="op" id="4276043">.</span><span class="ident" id="4276044">literalFreq</span><span class="op" id="4276055">[</span><span class="ident" id="4276056">lengthCode</span><span class="op" id="4276066">]</span><span class="op" id="4276067">)</span>&nbsp;<span class="op" id="4276069">*</span>&nbsp;<span class="ident" id="4276071">int64</span><span class="op" id="4276076">(</span><span class="ident" id="4276077">lengthExtraBits</span><span class="op" id="4276092">[</span><span class="ident" id="4276093">lengthCode</span><span class="op" id="4276103">-</span><span class="ident" id="4276104">lengthCodesStart</span><span class="op" id="4276120">]</span><span class="op" id="4276121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276129">for</span>&nbsp;<span class="ident" id="4276133">offsetCode</span>&nbsp;<span class="op" id="4276144">:=</span>&nbsp;<span class="num" id="4276147">4</span><span class="op" id="4276148">;</span>&nbsp;<span class="ident" id="4276150">offsetCode</span>&nbsp;<span class="op" id="4276161">&lt;</span>&nbsp;<span class="ident" id="4276163">numOffsets</span><span class="op" id="4276173">;</span>&nbsp;<span class="ident" id="4276175">offsetCode</span><span class="op" id="4276185">++</span>&nbsp;<span class="op" id="4276188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276193">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276244">extraBits</span>&nbsp;<span class="op" id="4276254">+=</span>&nbsp;<span class="ident" id="4276257">int64</span><span class="op" id="4276262">(</span><span class="ident" id="4276263">w</span><span class="op" id="4276264">.</span><span class="ident" id="4276265">offsetFreq</span><span class="op" id="4276275">[</span><span class="ident" id="4276276">offsetCode</span><span class="op" id="4276286">]</span><span class="op" id="4276287">)</span>&nbsp;<span class="op" id="4276289">*</span>&nbsp;<span class="ident" id="4276291">int64</span><span class="op" id="4276296">(</span><span class="ident" id="4276297">offsetExtraBits</span><span class="op" id="4276312">[</span><span class="ident" id="4276313">offsetCode</span><span class="op" id="4276323">]</span><span class="op" id="4276324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276335">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276365">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276393">var</span>&nbsp;<span class="ident" id="4276397">size</span>&nbsp;<span class="op" id="4276402">=</span>&nbsp;<span class="ident" id="4276404">int64</span><span class="op" id="4276409">(</span><span class="num" id="4276410">3</span><span class="op" id="4276411">)</span>&nbsp;<span class="op" id="4276413">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276417">fixedLiteralEncoding</span><span class="op" id="4276437">.</span><span class="ident" id="4276438">bitLength</span><span class="op" id="4276447">(</span><span class="ident" id="4276448">w</span><span class="op" id="4276449">.</span><span class="ident" id="4276450">literalFreq</span><span class="op" id="4276461">)</span>&nbsp;<span class="op" id="4276463">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276467">fixedOffsetEncoding</span><span class="op" id="4276486">.</span><span class="ident" id="4276487">bitLength</span><span class="op" id="4276496">(</span><span class="ident" id="4276497">w</span><span class="op" id="4276498">.</span><span class="ident" id="4276499">offsetFreq</span><span class="op" id="4276509">)</span>&nbsp;<span class="op" id="4276511">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276515">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276526">var</span>&nbsp;<span class="ident" id="4276530">literalEncoding</span>&nbsp;<span class="op" id="4276546">=</span>&nbsp;<span class="ident" id="4276548">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276570">var</span>&nbsp;<span class="ident" id="4276574">offsetEncoding</span>&nbsp;<span class="op" id="4276589">=</span>&nbsp;<span class="ident" id="4276591">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276613">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276634">var</span>&nbsp;<span class="ident" id="4276638">numCodegens</span>&nbsp;<span class="builtintype" id="4276650">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276656">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276731">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276779">w</span><span class="op" id="4276780">.</span><span class="ident" id="4276781">generateCodegen</span><span class="op" id="4276796">(</span><span class="ident" id="4276797">numLiterals</span><span class="op" id="4276808">,</span>&nbsp;<span class="ident" id="4276810">numOffsets</span><span class="op" id="4276820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276823">w</span><span class="op" id="4276824">.</span><span class="ident" id="4276825">codegenEncoding</span><span class="op" id="4276840">.</span><span class="ident" id="4276841">generate</span><span class="op" id="4276849">(</span><span class="ident" id="4276850">w</span><span class="op" id="4276851">.</span><span class="ident" id="4276852">codegenFreq</span><span class="op" id="4276863">,</span>&nbsp;<span class="num" id="4276865">7</span><span class="op" id="4276866">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276869">numCodegens</span>&nbsp;<span class="op" id="4276881">=</span>&nbsp;<span class="builtinfunc" id="4276883">len</span><span class="op" id="4276886">(</span><span class="ident" id="4276887">w</span><span class="op" id="4276888">.</span><span class="ident" id="4276889">codegenFreq</span><span class="op" id="4276900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276903">for</span>&nbsp;<span class="ident" id="4276907">numCodegens</span>&nbsp;<span class="op" id="4276919">&gt;</span>&nbsp;<span class="num" id="4276921">4</span>&nbsp;<span class="op" id="4276923">&amp;&amp;</span>&nbsp;<span class="ident" id="4276926">w</span><span class="op" id="4276927">.</span><span class="ident" id="4276928">codegenFreq</span><span class="op" id="4276939">[</span><span class="ident" id="4276940">codegenOrder</span><span class="op" id="4276952">[</span><span class="ident" id="4276953">numCodegens</span><span class="op" id="4276964">-</span><span class="num" id="4276965">1</span><span class="op" id="4276966">]</span><span class="op" id="4276967">]</span>&nbsp;<span class="op" id="4276969">==</span>&nbsp;<span class="num" id="4276972">0</span>&nbsp;<span class="op" id="4276974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276978">numCodegens</span><span class="op" id="4276989">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276996">dynamicHeader</span>&nbsp;<span class="op" id="4277010">:=</span>&nbsp;<span class="ident" id="4277013">int64</span><span class="op" id="4277018">(</span><span class="num" id="4277019">3</span><span class="op" id="4277020">+</span><span class="num" id="4277021">5</span><span class="op" id="4277022">+</span><span class="num" id="4277023">5</span><span class="op" id="4277024">+</span><span class="num" id="4277025">4</span><span class="op" id="4277026">+</span><span class="op" id="4277027">(</span><span class="num" id="4277028">3</span><span class="op" id="4277029">*</span><span class="ident" id="4277030">numCodegens</span><span class="op" id="4277041">)</span><span class="op" id="4277042">)</span>&nbsp;<span class="op" id="4277044">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277048">w</span><span class="op" id="4277049">.</span><span class="ident" id="4277050">codegenEncoding</span><span class="op" id="4277065">.</span><span class="ident" id="4277066">bitLength</span><span class="op" id="4277075">(</span><span class="ident" id="4277076">w</span><span class="op" id="4277077">.</span><span class="ident" id="4277078">codegenFreq</span><span class="op" id="4277089">)</span>&nbsp;<span class="op" id="4277091">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277095">int64</span><span class="op" id="4277100">(</span><span class="ident" id="4277101">extraBits</span><span class="op" id="4277110">)</span>&nbsp;<span class="op" id="4277112">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277116">int64</span><span class="op" id="4277121">(</span><span class="ident" id="4277122">w</span><span class="op" id="4277123">.</span><span class="ident" id="4277124">codegenFreq</span><span class="op" id="4277135">[</span><span class="num" id="4277136">16</span><span class="op" id="4277138">]</span><span class="op" id="4277139">*</span><span class="num" id="4277140">2</span><span class="op" id="4277141">)</span>&nbsp;<span class="op" id="4277143">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277147">int64</span><span class="op" id="4277152">(</span><span class="ident" id="4277153">w</span><span class="op" id="4277154">.</span><span class="ident" id="4277155">codegenFreq</span><span class="op" id="4277166">[</span><span class="num" id="4277167">17</span><span class="op" id="4277169">]</span><span class="op" id="4277170">*</span><span class="num" id="4277171">3</span><span class="op" id="4277172">)</span>&nbsp;<span class="op" id="4277174">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277178">int64</span><span class="op" id="4277183">(</span><span class="ident" id="4277184">w</span><span class="op" id="4277185">.</span><span class="ident" id="4277186">codegenFreq</span><span class="op" id="4277197">[</span><span class="num" id="4277198">18</span><span class="op" id="4277200">]</span><span class="op" id="4277201">*</span><span class="num" id="4277202">7</span><span class="op" id="4277203">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277206">dynamicSize</span>&nbsp;<span class="op" id="4277218">:=</span>&nbsp;<span class="ident" id="4277221">dynamicHeader</span>&nbsp;<span class="op" id="4277235">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277239">w</span><span class="op" id="4277240">.</span><span class="ident" id="4277241">literalEncoding</span><span class="op" id="4277256">.</span><span class="ident" id="4277257">bitLength</span><span class="op" id="4277266">(</span><span class="ident" id="4277267">w</span><span class="op" id="4277268">.</span><span class="ident" id="4277269">literalFreq</span><span class="op" id="4277280">)</span>&nbsp;<span class="op" id="4277282">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277286">w</span><span class="op" id="4277287">.</span><span class="ident" id="4277288">offsetEncoding</span><span class="op" id="4277302">.</span><span class="ident" id="4277303">bitLength</span><span class="op" id="4277312">(</span><span class="ident" id="4277313">w</span><span class="op" id="4277314">.</span><span class="ident" id="4277315">offsetFreq</span><span class="op" id="4277325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277329">if</span>&nbsp;<span class="ident" id="4277332">dynamicSize</span>&nbsp;<span class="op" id="4277344">&lt;</span>&nbsp;<span class="ident" id="4277346">size</span>&nbsp;<span class="op" id="4277351">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277355">size</span>&nbsp;<span class="op" id="4277360">=</span>&nbsp;<span class="ident" id="4277362">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277376">literalEncoding</span>&nbsp;<span class="op" id="4277392">=</span>&nbsp;<span class="ident" id="4277394">w</span><span class="op" id="4277395">.</span><span class="ident" id="4277396">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277414">offsetEncoding</span>&nbsp;<span class="op" id="4277429">=</span>&nbsp;<span class="ident" id="4277431">w</span><span class="op" id="4277432">.</span><span class="ident" id="4277433">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277453">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277471">if</span>&nbsp;<span class="ident" id="4277474">storedSize</span>&nbsp;<span class="op" id="4277485">&lt;</span>&nbsp;<span class="ident" id="4277487">size</span>&nbsp;<span class="op" id="4277492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277496">w</span><span class="op" id="4277497">.</span><span class="ident" id="4277498">writeStoredHeader</span><span class="op" id="4277515">(</span><span class="ident" id="4277516">storedBytes</span><span class="op" id="4277527">,</span>&nbsp;<span class="ident" id="4277529">eof</span><span class="op" id="4277532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277536">w</span><span class="op" id="4277537">.</span><span class="ident" id="4277538">writeBytes</span><span class="op" id="4277548">(</span><span class="ident" id="4277549">input</span><span class="op" id="4277554">[</span><span class="num" id="4277555">0</span><span class="op" id="4277556">:</span><span class="ident" id="4277557">storedBytes</span><span class="op" id="4277568">]</span><span class="op" id="4277569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277573">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277585">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277598">if</span>&nbsp;<span class="ident" id="4277601">literalEncoding</span>&nbsp;<span class="op" id="4277617">==</span>&nbsp;<span class="ident" id="4277620">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4277641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277645">w</span><span class="op" id="4277646">.</span><span class="ident" id="4277647">writeFixedHeader</span><span class="op" id="4277663">(</span><span class="ident" id="4277664">eof</span><span class="op" id="4277667">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277670">}</span>&nbsp;<span class="keyword" id="4277672">else</span>&nbsp;<span class="op" id="4277677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277681">w</span><span class="op" id="4277682">.</span><span class="ident" id="4277683">writeDynamicHeader</span><span class="op" id="4277701">(</span><span class="ident" id="4277702">numLiterals</span><span class="op" id="4277713">,</span>&nbsp;<span class="ident" id="4277715">numOffsets</span><span class="op" id="4277725">,</span>&nbsp;<span class="ident" id="4277727">numCodegens</span><span class="op" id="4277738">,</span>&nbsp;<span class="ident" id="4277740">eof</span><span class="op" id="4277743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277749">for</span>&nbsp;<span class="ident" id="4277753">_</span><span class="op" id="4277754">,</span>&nbsp;<span class="ident" id="4277756">t</span>&nbsp;<span class="op" id="4277758">:=</span>&nbsp;<span class="keyword" id="4277761">range</span>&nbsp;<span class="ident" id="4277767">tokens</span>&nbsp;<span class="op" id="4277774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277778">switch</span>&nbsp;<span class="ident" id="4277785">t</span><span class="op" id="4277786">.</span><span class="ident" id="4277787">typ</span><span class="op" id="4277790">(</span><span class="op" id="4277791">)</span>&nbsp;<span class="op" id="4277793">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277797">case</span>&nbsp;<span class="ident" id="4277802">literalType</span><span class="op" id="4277813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277818">w</span><span class="op" id="4277819">.</span><span class="ident" id="4277820">writeCode</span><span class="op" id="4277829">(</span><span class="ident" id="4277830">literalEncoding</span><span class="op" id="4277845">,</span>&nbsp;<span class="ident" id="4277847">t</span><span class="op" id="4277848">.</span><span class="ident" id="4277849">literal</span><span class="op" id="4277856">(</span><span class="op" id="4277857">)</span><span class="op" id="4277858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277863">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277871">case</span>&nbsp;<span class="ident" id="4277876">matchType</span><span class="op" id="4277885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277890">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277913">length</span>&nbsp;<span class="op" id="4277920">:=</span>&nbsp;<span class="ident" id="4277923">t</span><span class="op" id="4277924">.</span><span class="ident" id="4277925">length</span><span class="op" id="4277931">(</span><span class="op" id="4277932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277937">lengthCode</span>&nbsp;<span class="op" id="4277948">:=</span>&nbsp;<span class="ident" id="4277951">lengthCode</span><span class="op" id="4277961">(</span><span class="ident" id="4277962">length</span><span class="op" id="4277968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277973">w</span><span class="op" id="4277974">.</span><span class="ident" id="4277975">writeCode</span><span class="op" id="4277984">(</span><span class="ident" id="4277985">literalEncoding</span><span class="op" id="4278000">,</span>&nbsp;<span class="ident" id="4278002">lengthCode</span><span class="op" id="4278012">+</span><span class="ident" id="4278013">lengthCodesStart</span><span class="op" id="4278029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278034">extraLengthBits</span>&nbsp;<span class="op" id="4278050">:=</span>&nbsp;<span class="builtintype" id="4278053">int32</span><span class="op" id="4278058">(</span><span class="ident" id="4278059">lengthExtraBits</span><span class="op" id="4278074">[</span><span class="ident" id="4278075">lengthCode</span><span class="op" id="4278085">]</span><span class="op" id="4278086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278091">if</span>&nbsp;<span class="ident" id="4278094">extraLengthBits</span>&nbsp;<span class="op" id="4278110">&gt;</span>&nbsp;<span class="num" id="4278112">0</span>&nbsp;<span class="op" id="4278114">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278120">extraLength</span>&nbsp;<span class="op" id="4278132">:=</span>&nbsp;<span class="builtintype" id="4278135">int32</span><span class="op" id="4278140">(</span><span class="ident" id="4278141">length</span>&nbsp;<span class="op" id="4278148">-</span>&nbsp;<span class="ident" id="4278150">lengthBase</span><span class="op" id="4278160">[</span><span class="ident" id="4278161">lengthCode</span><span class="op" id="4278171">]</span><span class="op" id="4278172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278178">w</span><span class="op" id="4278179">.</span><span class="ident" id="4278180">writeBits</span><span class="op" id="4278189">(</span><span class="ident" id="4278190">extraLength</span><span class="op" id="4278201">,</span>&nbsp;<span class="ident" id="4278203">extraLengthBits</span><span class="op" id="4278218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278228">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278251">offset</span>&nbsp;<span class="op" id="4278258">:=</span>&nbsp;<span class="ident" id="4278261">t</span><span class="op" id="4278262">.</span><span class="ident" id="4278263">offset</span><span class="op" id="4278269">(</span><span class="op" id="4278270">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278275">offsetCode</span>&nbsp;<span class="op" id="4278286">:=</span>&nbsp;<span class="ident" id="4278289">offsetCode</span><span class="op" id="4278299">(</span><span class="ident" id="4278300">offset</span><span class="op" id="4278306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278311">w</span><span class="op" id="4278312">.</span><span class="ident" id="4278313">writeCode</span><span class="op" id="4278322">(</span><span class="ident" id="4278323">offsetEncoding</span><span class="op" id="4278337">,</span>&nbsp;<span class="ident" id="4278339">offsetCode</span><span class="op" id="4278349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278354">extraOffsetBits</span>&nbsp;<span class="op" id="4278370">:=</span>&nbsp;<span class="builtintype" id="4278373">int32</span><span class="op" id="4278378">(</span><span class="ident" id="4278379">offsetExtraBits</span><span class="op" id="4278394">[</span><span class="ident" id="4278395">offsetCode</span><span class="op" id="4278405">]</span><span class="op" id="4278406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278411">if</span>&nbsp;<span class="ident" id="4278414">extraOffsetBits</span>&nbsp;<span class="op" id="4278430">&gt;</span>&nbsp;<span class="num" id="4278432">0</span>&nbsp;<span class="op" id="4278434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278440">extraOffset</span>&nbsp;<span class="op" id="4278452">:=</span>&nbsp;<span class="builtintype" id="4278455">int32</span><span class="op" id="4278460">(</span><span class="ident" id="4278461">offset</span>&nbsp;<span class="op" id="4278468">-</span>&nbsp;<span class="ident" id="4278470">offsetBase</span><span class="op" id="4278480">[</span><span class="ident" id="4278481">offsetCode</span><span class="op" id="4278491">]</span><span class="op" id="4278492">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278498">w</span><span class="op" id="4278499">.</span><span class="ident" id="4278500">writeBits</span><span class="op" id="4278509">(</span><span class="ident" id="4278510">extraOffset</span><span class="op" id="4278521">,</span>&nbsp;<span class="ident" id="4278523">extraOffsetBits</span><span class="op" id="4278538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278548">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278556">default</span><span class="op" id="4278563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4278568">panic</span><span class="op" id="4278573">(</span><span class="string" id="4278574">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4278597">+</span>&nbsp;<span class="builtintype" id="4278599">string</span><span class="op" id="4278605">(</span><span class="ident" id="4278606">t</span><span class="op" id="4278607">)</span><span class="op" id="4278608">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278615">}</span><br>
<span class="lineno"></span><span class="op" id="4278617">}</span>
</div>
</body>
</html>
