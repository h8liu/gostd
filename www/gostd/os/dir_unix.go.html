<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2443226">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2443281">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2443335">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2443386">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443456">package</span>&nbsp;<span class="ident" id="2443464">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443468">import</span>&nbsp;<span class="op" id="2443475">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2443478">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2443484">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2443494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443497">const</span>&nbsp;<span class="op" id="2443503">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443506">blockSize</span>&nbsp;<span class="op" id="2443516">=</span>&nbsp;<span class="num" id="2443518">4096</span><br>
<span class="lineno"></span><span class="op" id="2443523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443526">func</span>&nbsp;<span class="op" id="2443531">(</span><span class="ident" id="2443532">f</span>&nbsp;<span class="op" id="2443534">*</span><span class="ident" id="2443535">File</span><span class="op" id="2443539">)</span>&nbsp;<span class="ident" id="2443541">readdirnames</span><span class="op" id="2443553">(</span><span class="ident" id="2443554">n</span>&nbsp;<span class="builtintype" id="2443556">int</span><span class="op" id="2443559">)</span>&nbsp;<span class="op" id="2443561">(</span><span class="ident" id="2443562">names</span>&nbsp;<span class="op" id="2443568">[</span><span class="op" id="2443569">]</span><span class="builtintype" id="2443570">string</span><span class="op" id="2443576">,</span>&nbsp;<span class="ident" id="2443578">err</span>&nbsp;<span class="builtintype" id="2443582">error</span><span class="op" id="2443587">)</span>&nbsp;<span class="op" id="2443589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2443592">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2443637">if</span>&nbsp;<span class="ident" id="2443640">f</span><span class="op" id="2443641">.</span><span class="ident" id="2443642">dirinfo</span>&nbsp;<span class="op" id="2443650">==</span>&nbsp;<span class="ident" id="2443653">nil</span>&nbsp;<span class="op" id="2443657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443661">f</span><span class="op" id="2443662">.</span><span class="ident" id="2443663">dirinfo</span>&nbsp;<span class="op" id="2443671">=</span>&nbsp;<span class="builtinfunc" id="2443673">new</span><span class="op" id="2443676">(</span><span class="ident" id="2443677">dirInfo</span><span class="op" id="2443684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2443688">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443735">f</span><span class="op" id="2443736">.</span><span class="ident" id="2443737">dirinfo</span><span class="op" id="2443744">.</span><span class="ident" id="2443745">buf</span>&nbsp;<span class="op" id="2443749">=</span>&nbsp;<span class="builtinfunc" id="2443751">make</span><span class="op" id="2443755">(</span><span class="op" id="2443756">[</span><span class="op" id="2443757">]</span><span class="builtintype" id="2443758">byte</span><span class="op" id="2443762">,</span>&nbsp;<span class="ident" id="2443764">blockSize</span><span class="op" id="2443773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2443776">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443779">d</span>&nbsp;<span class="op" id="2443781">:=</span>&nbsp;<span class="ident" id="2443784">f</span><span class="op" id="2443785">.</span><span class="ident" id="2443786">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443796">size</span>&nbsp;<span class="op" id="2443801">:=</span>&nbsp;<span class="ident" id="2443804">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2443807">if</span>&nbsp;<span class="ident" id="2443810">size</span>&nbsp;<span class="op" id="2443815">&lt;=</span>&nbsp;<span class="num" id="2443818">0</span>&nbsp;<span class="op" id="2443820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443824">size</span>&nbsp;<span class="op" id="2443829">=</span>&nbsp;<span class="num" id="2443831">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443837">n</span>&nbsp;<span class="op" id="2443839">=</span>&nbsp;<span class="op" id="2443841">-</span><span class="num" id="2443842">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2443845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443849">names</span>&nbsp;<span class="op" id="2443855">=</span>&nbsp;<span class="builtinfunc" id="2443857">make</span><span class="op" id="2443861">(</span><span class="op" id="2443862">[</span><span class="op" id="2443863">]</span><span class="builtintype" id="2443864">string</span><span class="op" id="2443870">,</span>&nbsp;<span class="num" id="2443872">0</span><span class="op" id="2443873">,</span>&nbsp;<span class="ident" id="2443875">size</span><span class="op" id="2443879">)</span>&nbsp;<span class="comment" id="2443881">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2443910">for</span>&nbsp;<span class="ident" id="2443914">n</span>&nbsp;<span class="op" id="2443916">!=</span>&nbsp;<span class="num" id="2443919">0</span>&nbsp;<span class="op" id="2443921">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2443925">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2443961">if</span>&nbsp;<span class="ident" id="2443964">d</span><span class="op" id="2443965">.</span><span class="ident" id="2443966">bufp</span>&nbsp;<span class="op" id="2443971">&gt;=</span>&nbsp;<span class="ident" id="2443974">d</span><span class="op" id="2443975">.</span><span class="ident" id="2443976">nbuf</span>&nbsp;<span class="op" id="2443981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2443986">d</span><span class="op" id="2443987">.</span><span class="ident" id="2443988">bufp</span>&nbsp;<span class="op" id="2443993">=</span>&nbsp;<span class="num" id="2443995">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444000">var</span>&nbsp;<span class="ident" id="2444004">errno</span>&nbsp;<span class="builtintype" id="2444010">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2444019">d</span><span class="op" id="2444020">.</span><span class="ident" id="2444021">nbuf</span><span class="op" id="2444025">,</span>&nbsp;<span class="ident" id="2444027">errno</span>&nbsp;<span class="op" id="2444033">=</span>&nbsp;<span class="ident" id="2444035">fixCount</span><span class="op" id="2444043">(</span><span class="ident" id="2444044">syscall</span><span class="op" id="2444051">.</span><span class="ident" id="2444052">ReadDirent</span><span class="op" id="2444062">(</span><span class="ident" id="2444063">f</span><span class="op" id="2444064">.</span><span class="ident" id="2444065">fd</span><span class="op" id="2444067">,</span>&nbsp;<span class="ident" id="2444069">d</span><span class="op" id="2444070">.</span><span class="ident" id="2444071">buf</span><span class="op" id="2444074">)</span><span class="op" id="2444075">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444080">if</span>&nbsp;<span class="ident" id="2444083">errno</span>&nbsp;<span class="op" id="2444089">!=</span>&nbsp;<span class="ident" id="2444092">nil</span>&nbsp;<span class="op" id="2444096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444102">return</span>&nbsp;<span class="ident" id="2444109">names</span><span class="op" id="2444114">,</span>&nbsp;<span class="ident" id="2444116">NewSyscallError</span><span class="op" id="2444131">(</span><span class="string" id="2444132">&#34;readdirent&#34;</span><span class="op" id="2444144">,</span>&nbsp;<span class="ident" id="2444146">errno</span><span class="op" id="2444151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2444156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444161">if</span>&nbsp;<span class="ident" id="2444164">d</span><span class="op" id="2444165">.</span><span class="ident" id="2444166">nbuf</span>&nbsp;<span class="op" id="2444171">&lt;=</span>&nbsp;<span class="num" id="2444174">0</span>&nbsp;<span class="op" id="2444176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444182">break</span>&nbsp;<span class="comment" id="2444188">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2444198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2444202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2444207">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444229">var</span>&nbsp;<span class="ident" id="2444233">nb</span><span class="op" id="2444235">,</span>&nbsp;<span class="ident" id="2444237">nc</span>&nbsp;<span class="builtintype" id="2444240">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2444246">nb</span><span class="op" id="2444248">,</span>&nbsp;<span class="ident" id="2444250">nc</span><span class="op" id="2444252">,</span>&nbsp;<span class="ident" id="2444254">names</span>&nbsp;<span class="op" id="2444260">=</span>&nbsp;<span class="ident" id="2444262">syscall</span><span class="op" id="2444269">.</span><span class="ident" id="2444270">ParseDirent</span><span class="op" id="2444281">(</span><span class="ident" id="2444282">d</span><span class="op" id="2444283">.</span><span class="ident" id="2444284">buf</span><span class="op" id="2444287">[</span><span class="ident" id="2444288">d</span><span class="op" id="2444289">.</span><span class="ident" id="2444290">bufp</span><span class="op" id="2444294">:</span><span class="ident" id="2444295">d</span><span class="op" id="2444296">.</span><span class="ident" id="2444297">nbuf</span><span class="op" id="2444301">]</span><span class="op" id="2444302">,</span>&nbsp;<span class="ident" id="2444304">n</span><span class="op" id="2444305">,</span>&nbsp;<span class="ident" id="2444307">names</span><span class="op" id="2444312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2444316">d</span><span class="op" id="2444317">.</span><span class="ident" id="2444318">bufp</span>&nbsp;<span class="op" id="2444323">+=</span>&nbsp;<span class="ident" id="2444326">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2444331">n</span>&nbsp;<span class="op" id="2444333">-=</span>&nbsp;<span class="ident" id="2444336">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2444340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444343">if</span>&nbsp;<span class="ident" id="2444346">n</span>&nbsp;<span class="op" id="2444348">&gt;=</span>&nbsp;<span class="num" id="2444351">0</span>&nbsp;<span class="op" id="2444353">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2444356">len</span><span class="op" id="2444359">(</span><span class="ident" id="2444360">names</span><span class="op" id="2444365">)</span>&nbsp;<span class="op" id="2444367">==</span>&nbsp;<span class="num" id="2444370">0</span>&nbsp;<span class="op" id="2444372">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444376">return</span>&nbsp;<span class="ident" id="2444383">names</span><span class="op" id="2444388">,</span>&nbsp;<span class="ident" id="2444390">io</span><span class="op" id="2444392">.</span><span class="ident" id="2444393">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2444398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2444401">return</span>&nbsp;<span class="ident" id="2444408">names</span><span class="op" id="2444413">,</span>&nbsp;<span class="ident" id="2444415">nil</span><br>
<span class="lineno"></span><span class="op" id="2444419">}</span>
</div>
</body>
</html>
