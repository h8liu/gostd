<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html" class="current">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4038619">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4038674">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4038728">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4038779">package</span>&nbsp;<span class="ident" id="4038787">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4038793">import</span>&nbsp;<span class="op" id="4038800">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4038803">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4038818">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4038821">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4038859">type</span>&nbsp;<span class="ident" id="4038864">CertPool</span>&nbsp;<span class="keyword" id="4038873">struct</span>&nbsp;<span class="op" id="4038880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038883">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4038898">map</span><span class="op" id="4038901">[</span><span class="builtintype" id="4038902">string</span><span class="op" id="4038908">]</span><span class="op" id="4038909">[</span><span class="op" id="4038910">]</span><span class="builtintype" id="4038911">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038916">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038931">map</span><span class="op" id="4038934">[</span><span class="builtintype" id="4038935">string</span><span class="op" id="4038941">]</span><span class="op" id="4038942">[</span><span class="op" id="4038943">]</span><span class="builtintype" id="4038944">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038949">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038964">[</span><span class="op" id="4038965">]</span><span class="op" id="4038966">*</span><span class="ident" id="4038967">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4038979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4038982">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4039028">func</span>&nbsp;<span class="ident" id="4039033">NewCertPool</span><span class="op" id="4039044">(</span><span class="op" id="4039045">)</span>&nbsp;<span class="op" id="4039047">*</span><span class="ident" id="4039048">CertPool</span>&nbsp;<span class="op" id="4039057">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039060">return</span>&nbsp;<span class="op" id="4039067">&amp;</span><span class="ident" id="4039068">CertPool</span><span class="op" id="4039076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4039080">make</span><span class="op" id="4039084">(</span><span class="keyword" id="4039085">map</span><span class="op" id="4039088">[</span><span class="builtintype" id="4039089">string</span><span class="op" id="4039095">]</span><span class="op" id="4039096">[</span><span class="op" id="4039097">]</span><span class="builtintype" id="4039098">int</span><span class="op" id="4039101">)</span><span class="op" id="4039102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4039106">make</span><span class="op" id="4039110">(</span><span class="keyword" id="4039111">map</span><span class="op" id="4039114">[</span><span class="builtintype" id="4039115">string</span><span class="op" id="4039121">]</span><span class="op" id="4039122">[</span><span class="op" id="4039123">]</span><span class="builtintype" id="4039124">int</span><span class="op" id="4039127">)</span><span class="op" id="4039128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039132">nil</span><span class="op" id="4039135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039138">}</span><br>
<span class="lineno">25</span><span class="op" id="4039140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4039143">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4039223">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4039302">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4039378">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4039391">func</span>&nbsp;<span class="op" id="4039396">(</span><span class="ident" id="4039397">s</span>&nbsp;<span class="op" id="4039399">*</span><span class="ident" id="4039400">CertPool</span><span class="op" id="4039408">)</span>&nbsp;<span class="ident" id="4039410">findVerifiedParents</span><span class="op" id="4039429">(</span><span class="ident" id="4039430">cert</span>&nbsp;<span class="op" id="4039435">*</span><span class="ident" id="4039436">Certificate</span><span class="op" id="4039447">)</span>&nbsp;<span class="op" id="4039449">(</span><span class="ident" id="4039450">parents</span>&nbsp;<span class="op" id="4039458">[</span><span class="op" id="4039459">]</span><span class="builtintype" id="4039460">int</span><span class="op" id="4039463">,</span>&nbsp;<span class="ident" id="4039465">errCert</span>&nbsp;<span class="op" id="4039473">*</span><span class="ident" id="4039474">Certificate</span><span class="op" id="4039485">,</span>&nbsp;<span class="ident" id="4039487">err</span>&nbsp;<span class="builtintype" id="4039491">error</span><span class="op" id="4039496">)</span>&nbsp;<span class="op" id="4039498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039501">if</span>&nbsp;<span class="ident" id="4039504">s</span>&nbsp;<span class="op" id="4039506">==</span>&nbsp;<span class="ident" id="4039509">nil</span>&nbsp;<span class="op" id="4039513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039517">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039525">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039528">var</span>&nbsp;<span class="ident" id="4039532">candidates</span>&nbsp;<span class="op" id="4039543">[</span><span class="op" id="4039544">]</span><span class="builtintype" id="4039545">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039551">if</span>&nbsp;<span class="builtinfunc" id="4039554">len</span><span class="op" id="4039557">(</span><span class="ident" id="4039558">cert</span><span class="op" id="4039562">.</span><span class="ident" id="4039563">AuthorityKeyId</span><span class="op" id="4039577">)</span>&nbsp;<span class="op" id="4039579">&gt;</span>&nbsp;<span class="num" id="4039581">0</span>&nbsp;<span class="op" id="4039583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039587">candidates</span>&nbsp;<span class="op" id="4039598">=</span>&nbsp;<span class="ident" id="4039600">s</span><span class="op" id="4039601">.</span><span class="ident" id="4039602">bySubjectKeyId</span><span class="op" id="4039616">[</span><span class="builtintype" id="4039617">string</span><span class="op" id="4039623">(</span><span class="ident" id="4039624">cert</span><span class="op" id="4039628">.</span><span class="ident" id="4039629">AuthorityKeyId</span><span class="op" id="4039643">)</span><span class="op" id="4039644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039647">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039650">if</span>&nbsp;<span class="builtinfunc" id="4039653">len</span><span class="op" id="4039656">(</span><span class="ident" id="4039657">candidates</span><span class="op" id="4039667">)</span>&nbsp;<span class="op" id="4039669">==</span>&nbsp;<span class="num" id="4039672">0</span>&nbsp;<span class="op" id="4039674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039678">candidates</span>&nbsp;<span class="op" id="4039689">=</span>&nbsp;<span class="ident" id="4039691">s</span><span class="op" id="4039692">.</span><span class="ident" id="4039693">byName</span><span class="op" id="4039699">[</span><span class="builtintype" id="4039700">string</span><span class="op" id="4039706">(</span><span class="ident" id="4039707">cert</span><span class="op" id="4039711">.</span><span class="ident" id="4039712">RawIssuer</span><span class="op" id="4039721">)</span><span class="op" id="4039722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039729">for</span>&nbsp;<span class="ident" id="4039733">_</span><span class="op" id="4039734">,</span>&nbsp;<span class="ident" id="4039736">c</span>&nbsp;<span class="op" id="4039738">:=</span>&nbsp;<span class="keyword" id="4039741">range</span>&nbsp;<span class="ident" id="4039747">candidates</span>&nbsp;<span class="op" id="4039758">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039762">if</span>&nbsp;<span class="ident" id="4039765">err</span>&nbsp;<span class="op" id="4039769">=</span>&nbsp;<span class="ident" id="4039771">cert</span><span class="op" id="4039775">.</span><span class="ident" id="4039776">CheckSignatureFrom</span><span class="op" id="4039794">(</span><span class="ident" id="4039795">s</span><span class="op" id="4039796">.</span><span class="ident" id="4039797">certs</span><span class="op" id="4039802">[</span><span class="ident" id="4039803">c</span><span class="op" id="4039804">]</span><span class="op" id="4039805">)</span><span class="op" id="4039806">;</span>&nbsp;<span class="ident" id="4039808">err</span>&nbsp;<span class="op" id="4039812">==</span>&nbsp;<span class="ident" id="4039815">nil</span>&nbsp;<span class="op" id="4039819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039824">parents</span>&nbsp;<span class="op" id="4039832">=</span>&nbsp;<span class="builtinfunc" id="4039834">append</span><span class="op" id="4039840">(</span><span class="ident" id="4039841">parents</span><span class="op" id="4039848">,</span>&nbsp;<span class="ident" id="4039850">c</span><span class="op" id="4039851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039855">}</span>&nbsp;<span class="keyword" id="4039857">else</span>&nbsp;<span class="op" id="4039862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039867">errCert</span>&nbsp;<span class="op" id="4039875">=</span>&nbsp;<span class="ident" id="4039877">s</span><span class="op" id="4039878">.</span><span class="ident" id="4039879">certs</span><span class="op" id="4039884">[</span><span class="ident" id="4039885">c</span><span class="op" id="4039886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039890">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039897">return</span><br>
<span class="lineno"></span><span class="op" id="4039904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4039907">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4039948">func</span>&nbsp;<span class="op" id="4039953">(</span><span class="ident" id="4039954">s</span>&nbsp;<span class="op" id="4039956">*</span><span class="ident" id="4039957">CertPool</span><span class="op" id="4039965">)</span>&nbsp;<span class="ident" id="4039967">AddCert</span><span class="op" id="4039974">(</span><span class="ident" id="4039975">cert</span>&nbsp;<span class="op" id="4039980">*</span><span class="ident" id="4039981">Certificate</span><span class="op" id="4039992">)</span>&nbsp;<span class="op" id="4039994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039997">if</span>&nbsp;<span class="ident" id="4040000">cert</span>&nbsp;<span class="op" id="4040005">==</span>&nbsp;<span class="ident" id="4040008">nil</span>&nbsp;<span class="op" id="4040012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4040016">panic</span><span class="op" id="4040021">(</span><span class="string" id="4040022">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4040058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040061">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4040065">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040121">for</span>&nbsp;<span class="ident" id="4040125">_</span><span class="op" id="4040126">,</span>&nbsp;<span class="ident" id="4040128">c</span>&nbsp;<span class="op" id="4040130">:=</span>&nbsp;<span class="keyword" id="4040133">range</span>&nbsp;<span class="ident" id="4040139">s</span><span class="op" id="4040140">.</span><span class="ident" id="4040141">certs</span>&nbsp;<span class="op" id="4040147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040151">if</span>&nbsp;<span class="ident" id="4040154">c</span><span class="op" id="4040155">.</span><span class="ident" id="4040156">Equal</span><span class="op" id="4040161">(</span><span class="ident" id="4040162">cert</span><span class="op" id="4040166">)</span>&nbsp;<span class="op" id="4040168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040173">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040189">n</span>&nbsp;<span class="op" id="4040191">:=</span>&nbsp;<span class="builtinfunc" id="4040194">len</span><span class="op" id="4040197">(</span><span class="ident" id="4040198">s</span><span class="op" id="4040199">.</span><span class="ident" id="4040200">certs</span><span class="op" id="4040205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040208">s</span><span class="op" id="4040209">.</span><span class="ident" id="4040210">certs</span>&nbsp;<span class="op" id="4040216">=</span>&nbsp;<span class="builtinfunc" id="4040218">append</span><span class="op" id="4040224">(</span><span class="ident" id="4040225">s</span><span class="op" id="4040226">.</span><span class="ident" id="4040227">certs</span><span class="op" id="4040232">,</span>&nbsp;<span class="ident" id="4040234">cert</span><span class="op" id="4040238">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040242">if</span>&nbsp;<span class="builtinfunc" id="4040245">len</span><span class="op" id="4040248">(</span><span class="ident" id="4040249">cert</span><span class="op" id="4040253">.</span><span class="ident" id="4040254">SubjectKeyId</span><span class="op" id="4040266">)</span>&nbsp;<span class="op" id="4040268">&gt;</span>&nbsp;<span class="num" id="4040270">0</span>&nbsp;<span class="op" id="4040272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040276">keyId</span>&nbsp;<span class="op" id="4040282">:=</span>&nbsp;<span class="builtintype" id="4040285">string</span><span class="op" id="4040291">(</span><span class="ident" id="4040292">cert</span><span class="op" id="4040296">.</span><span class="ident" id="4040297">SubjectKeyId</span><span class="op" id="4040309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040313">s</span><span class="op" id="4040314">.</span><span class="ident" id="4040315">bySubjectKeyId</span><span class="op" id="4040329">[</span><span class="ident" id="4040330">keyId</span><span class="op" id="4040335">]</span>&nbsp;<span class="op" id="4040337">=</span>&nbsp;<span class="builtinfunc" id="4040339">append</span><span class="op" id="4040345">(</span><span class="ident" id="4040346">s</span><span class="op" id="4040347">.</span><span class="ident" id="4040348">bySubjectKeyId</span><span class="op" id="4040362">[</span><span class="ident" id="4040363">keyId</span><span class="op" id="4040368">]</span><span class="op" id="4040369">,</span>&nbsp;<span class="ident" id="4040371">n</span><span class="op" id="4040372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040375">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040378">name</span>&nbsp;<span class="op" id="4040383">:=</span>&nbsp;<span class="builtintype" id="4040386">string</span><span class="op" id="4040392">(</span><span class="ident" id="4040393">cert</span><span class="op" id="4040397">.</span><span class="ident" id="4040398">RawSubject</span><span class="op" id="4040408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040411">s</span><span class="op" id="4040412">.</span><span class="ident" id="4040413">byName</span><span class="op" id="4040419">[</span><span class="ident" id="4040420">name</span><span class="op" id="4040424">]</span>&nbsp;<span class="op" id="4040426">=</span>&nbsp;<span class="builtinfunc" id="4040428">append</span><span class="op" id="4040434">(</span><span class="ident" id="4040435">s</span><span class="op" id="4040436">.</span><span class="ident" id="4040437">byName</span><span class="op" id="4040443">[</span><span class="ident" id="4040444">name</span><span class="op" id="4040448">]</span><span class="op" id="4040449">,</span>&nbsp;<span class="ident" id="4040451">n</span><span class="op" id="4040452">)</span><br>
<span class="lineno"></span><span class="op" id="4040454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4040457">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4040535">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4040614">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4040643">//</span><br>
<span class="lineno"></span><span class="comment" id="4040646">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4040723">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4040778">func</span>&nbsp;<span class="op" id="4040783">(</span><span class="ident" id="4040784">s</span>&nbsp;<span class="op" id="4040786">*</span><span class="ident" id="4040787">CertPool</span><span class="op" id="4040795">)</span>&nbsp;<span class="ident" id="4040797">AppendCertsFromPEM</span><span class="op" id="4040815">(</span><span class="ident" id="4040816">pemCerts</span>&nbsp;<span class="op" id="4040825">[</span><span class="op" id="4040826">]</span><span class="builtintype" id="4040827">byte</span><span class="op" id="4040831">)</span>&nbsp;<span class="op" id="4040833">(</span><span class="ident" id="4040834">ok</span>&nbsp;<span class="builtintype" id="4040837">bool</span><span class="op" id="4040841">)</span>&nbsp;<span class="op" id="4040843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040846">for</span>&nbsp;<span class="builtinfunc" id="4040850">len</span><span class="op" id="4040853">(</span><span class="ident" id="4040854">pemCerts</span><span class="op" id="4040862">)</span>&nbsp;<span class="op" id="4040864">&gt;</span>&nbsp;<span class="num" id="4040866">0</span>&nbsp;<span class="op" id="4040868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040872">var</span>&nbsp;<span class="ident" id="4040876">block</span>&nbsp;<span class="op" id="4040882">*</span><span class="ident" id="4040883">pem</span><span class="op" id="4040886">.</span><span class="ident" id="4040887">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040895">block</span><span class="op" id="4040900">,</span>&nbsp;<span class="ident" id="4040902">pemCerts</span>&nbsp;<span class="op" id="4040911">=</span>&nbsp;<span class="ident" id="4040913">pem</span><span class="op" id="4040916">.</span><span class="ident" id="4040917">Decode</span><span class="op" id="4040923">(</span><span class="ident" id="4040924">pemCerts</span><span class="op" id="4040932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040936">if</span>&nbsp;<span class="ident" id="4040939">block</span>&nbsp;<span class="op" id="4040945">==</span>&nbsp;<span class="ident" id="4040948">nil</span>&nbsp;<span class="op" id="4040952">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040957">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040969">if</span>&nbsp;<span class="ident" id="4040972">block</span><span class="op" id="4040977">.</span><span class="ident" id="4040978">Type</span>&nbsp;<span class="op" id="4040983">!=</span>&nbsp;<span class="string" id="4040986">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4041000">||</span>&nbsp;<span class="builtinfunc" id="4041003">len</span><span class="op" id="4041006">(</span><span class="ident" id="4041007">block</span><span class="op" id="4041012">.</span><span class="ident" id="4041013">Headers</span><span class="op" id="4041020">)</span>&nbsp;<span class="op" id="4041022">!=</span>&nbsp;<span class="num" id="4041025">0</span>&nbsp;<span class="op" id="4041027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041032">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041043">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041048">cert</span><span class="op" id="4041052">,</span>&nbsp;<span class="ident" id="4041054">err</span>&nbsp;<span class="op" id="4041058">:=</span>&nbsp;<span class="ident" id="4041061">ParseCertificate</span><span class="op" id="4041077">(</span><span class="ident" id="4041078">block</span><span class="op" id="4041083">.</span><span class="ident" id="4041084">Bytes</span><span class="op" id="4041089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041093">if</span>&nbsp;<span class="ident" id="4041096">err</span>&nbsp;<span class="op" id="4041100">!=</span>&nbsp;<span class="ident" id="4041103">nil</span>&nbsp;<span class="op" id="4041107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041112">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041123">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041128">s</span><span class="op" id="4041129">.</span><span class="ident" id="4041130">AddCert</span><span class="op" id="4041137">(</span><span class="ident" id="4041138">cert</span><span class="op" id="4041142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041146">ok</span>&nbsp;<span class="op" id="4041149">=</span>&nbsp;<span class="builtintype" id="4041151">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041161">return</span><br>
<span class="lineno"></span><span class="op" id="4041168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4041171">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4041229">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4041269">func</span>&nbsp;<span class="op" id="4041274">(</span><span class="ident" id="4041275">s</span>&nbsp;<span class="op" id="4041277">*</span><span class="ident" id="4041278">CertPool</span><span class="op" id="4041286">)</span>&nbsp;<span class="ident" id="4041288">Subjects</span><span class="op" id="4041296">(</span><span class="op" id="4041297">)</span>&nbsp;<span class="op" id="4041299">(</span><span class="ident" id="4041300">res</span>&nbsp;<span class="op" id="4041304">[</span><span class="op" id="4041305">]</span><span class="op" id="4041306">[</span><span class="op" id="4041307">]</span><span class="builtintype" id="4041308">byte</span><span class="op" id="4041312">)</span>&nbsp;<span class="op" id="4041314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041317">res</span>&nbsp;<span class="op" id="4041321">=</span>&nbsp;<span class="builtinfunc" id="4041323">make</span><span class="op" id="4041327">(</span><span class="op" id="4041328">[</span><span class="op" id="4041329">]</span><span class="op" id="4041330">[</span><span class="op" id="4041331">]</span><span class="builtintype" id="4041332">byte</span><span class="op" id="4041336">,</span>&nbsp;<span class="builtinfunc" id="4041338">len</span><span class="op" id="4041341">(</span><span class="ident" id="4041342">s</span><span class="op" id="4041343">.</span><span class="ident" id="4041344">certs</span><span class="op" id="4041349">)</span><span class="op" id="4041350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041353">for</span>&nbsp;<span class="ident" id="4041357">i</span><span class="op" id="4041358">,</span>&nbsp;<span class="ident" id="4041360">c</span>&nbsp;<span class="op" id="4041362">:=</span>&nbsp;<span class="keyword" id="4041365">range</span>&nbsp;<span class="ident" id="4041371">s</span><span class="op" id="4041372">.</span><span class="ident" id="4041373">certs</span>&nbsp;<span class="op" id="4041379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041383">res</span><span class="op" id="4041386">[</span><span class="ident" id="4041387">i</span><span class="op" id="4041388">]</span>&nbsp;<span class="op" id="4041390">=</span>&nbsp;<span class="ident" id="4041392">c</span><span class="op" id="4041393">.</span><span class="ident" id="4041394">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041406">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041409">return</span><br>
<span class="lineno"></span><span class="op" id="4041416">}</span>
</div>
</body>
</html>
