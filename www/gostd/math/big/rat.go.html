<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3792933">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3792988">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3793042">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3793093">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3793152">package</span>&nbsp;<span class="ident" id="3793160">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3793165">import</span>&nbsp;<span class="op" id="3793172">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3793175">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3793194">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3793204">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3793211">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3793219">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3793229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3793232">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3793291">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3793343">type</span>&nbsp;<span class="ident" id="3793348">Rat</span>&nbsp;<span class="keyword" id="3793352">struct</span>&nbsp;<span class="op" id="3793359">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793362">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793419">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793473">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793533">a</span><span class="op" id="3793534">,</span>&nbsp;<span class="ident" id="3793536">b</span>&nbsp;<span class="ident" id="3793538">Int</span><br>
<span class="lineno"></span><span class="op" id="3793542">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3793545">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3793609">func</span>&nbsp;<span class="ident" id="3793614">NewRat</span><span class="op" id="3793620">(</span><span class="ident" id="3793621">a</span><span class="op" id="3793622">,</span>&nbsp;<span class="ident" id="3793624">b</span>&nbsp;<span class="ident" id="3793626">int64</span><span class="op" id="3793631">)</span>&nbsp;<span class="op" id="3793633">*</span><span class="ident" id="3793634">Rat</span>&nbsp;<span class="op" id="3793638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793641">return</span>&nbsp;<span class="builtinfunc" id="3793648">new</span><span class="op" id="3793651">(</span><span class="ident" id="3793652">Rat</span><span class="op" id="3793655">)</span><span class="op" id="3793656">.</span><span class="ident" id="3793657">SetFrac64</span><span class="op" id="3793666">(</span><span class="ident" id="3793667">a</span><span class="op" id="3793668">,</span>&nbsp;<span class="ident" id="3793670">b</span><span class="op" id="3793671">)</span><br>
<span class="lineno"></span><span class="op" id="3793673">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3793676">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3793725">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3793770">func</span>&nbsp;<span class="op" id="3793775">(</span><span class="ident" id="3793776">z</span>&nbsp;<span class="op" id="3793778">*</span><span class="ident" id="3793779">Rat</span><span class="op" id="3793782">)</span>&nbsp;<span class="ident" id="3793784">SetFloat64</span><span class="op" id="3793794">(</span><span class="ident" id="3793795">f</span>&nbsp;<span class="builtintype" id="3793797">float64</span><span class="op" id="3793804">)</span>&nbsp;<span class="op" id="3793806">*</span><span class="ident" id="3793807">Rat</span>&nbsp;<span class="op" id="3793811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793814">const</span>&nbsp;<span class="ident" id="3793820">expMask</span>&nbsp;<span class="op" id="3793828">=</span>&nbsp;<span class="num" id="3793830">1</span><span class="op" id="3793831">&lt;&lt;</span><span class="num" id="3793833">11</span>&nbsp;<span class="op" id="3793836">-</span>&nbsp;<span class="num" id="3793838">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793841">bits</span>&nbsp;<span class="op" id="3793846">:=</span>&nbsp;<span class="ident" id="3793849">math</span><span class="op" id="3793853">.</span><span class="ident" id="3793854">Float64bits</span><span class="op" id="3793865">(</span><span class="ident" id="3793866">f</span><span class="op" id="3793867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793870">mantissa</span>&nbsp;<span class="op" id="3793879">:=</span>&nbsp;<span class="ident" id="3793882">bits</span>&nbsp;<span class="op" id="3793887">&amp;</span>&nbsp;<span class="op" id="3793889">(</span><span class="num" id="3793890">1</span><span class="op" id="3793891">&lt;&lt;</span><span class="num" id="3793893">52</span>&nbsp;<span class="op" id="3793896">-</span>&nbsp;<span class="num" id="3793898">1</span><span class="op" id="3793899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793902">exp</span>&nbsp;<span class="op" id="3793906">:=</span>&nbsp;<span class="builtintype" id="3793909">int</span><span class="op" id="3793912">(</span><span class="op" id="3793913">(</span><span class="ident" id="3793914">bits</span>&nbsp;<span class="op" id="3793919">&gt;&gt;</span>&nbsp;<span class="num" id="3793922">52</span><span class="op" id="3793924">)</span>&nbsp;<span class="op" id="3793926">&amp;</span>&nbsp;<span class="ident" id="3793928">expMask</span><span class="op" id="3793935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793938">switch</span>&nbsp;<span class="ident" id="3793945">exp</span>&nbsp;<span class="op" id="3793949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793952">case</span>&nbsp;<span class="ident" id="3793957">expMask</span><span class="op" id="3793964">:</span>&nbsp;<span class="comment" id="3793966">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793982">return</span>&nbsp;<span class="ident" id="3793989">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793994">case</span>&nbsp;<span class="num" id="3793999">0</span><span class="op" id="3794000">:</span>&nbsp;<span class="comment" id="3794002">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794016">exp</span>&nbsp;<span class="op" id="3794020">-=</span>&nbsp;<span class="num" id="3794023">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794029">default</span><span class="op" id="3794036">:</span>&nbsp;<span class="comment" id="3794038">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794050">mantissa</span>&nbsp;<span class="op" id="3794059">|=</span>&nbsp;<span class="num" id="3794062">1</span>&nbsp;<span class="op" id="3794064">&lt;&lt;</span>&nbsp;<span class="num" id="3794067">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794072">exp</span>&nbsp;<span class="op" id="3794076">-=</span>&nbsp;<span class="num" id="3794079">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794089">shift</span>&nbsp;<span class="op" id="3794095">:=</span>&nbsp;<span class="num" id="3794098">52</span>&nbsp;<span class="op" id="3794101">-</span>&nbsp;<span class="ident" id="3794103">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794109">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794156">for</span>&nbsp;<span class="ident" id="3794160">mantissa</span><span class="op" id="3794168">&amp;</span><span class="num" id="3794169">1</span>&nbsp;<span class="op" id="3794171">==</span>&nbsp;<span class="num" id="3794174">0</span>&nbsp;<span class="op" id="3794176">&amp;&amp;</span>&nbsp;<span class="ident" id="3794179">shift</span>&nbsp;<span class="op" id="3794185">&gt;</span>&nbsp;<span class="num" id="3794187">0</span>&nbsp;<span class="op" id="3794189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794193">mantissa</span>&nbsp;<span class="op" id="3794202">&gt;&gt;=</span>&nbsp;<span class="num" id="3794206">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794210">shift</span><span class="op" id="3794215">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794219">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794223">z</span><span class="op" id="3794224">.</span><span class="ident" id="3794225">a</span><span class="op" id="3794226">.</span><span class="ident" id="3794227">SetUint64</span><span class="op" id="3794236">(</span><span class="ident" id="3794237">mantissa</span><span class="op" id="3794245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794248">z</span><span class="op" id="3794249">.</span><span class="ident" id="3794250">a</span><span class="op" id="3794251">.</span><span class="ident" id="3794252">neg</span>&nbsp;<span class="op" id="3794256">=</span>&nbsp;<span class="ident" id="3794258">f</span>&nbsp;<span class="op" id="3794260">&lt;</span>&nbsp;<span class="num" id="3794262">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794265">z</span><span class="op" id="3794266">.</span><span class="ident" id="3794267">b</span><span class="op" id="3794268">.</span><span class="ident" id="3794269">Set</span><span class="op" id="3794272">(</span><span class="ident" id="3794273">intOne</span><span class="op" id="3794279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794282">if</span>&nbsp;<span class="ident" id="3794285">shift</span>&nbsp;<span class="op" id="3794291">&gt;</span>&nbsp;<span class="num" id="3794293">0</span>&nbsp;<span class="op" id="3794295">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794299">z</span><span class="op" id="3794300">.</span><span class="ident" id="3794301">b</span><span class="op" id="3794302">.</span><span class="ident" id="3794303">Lsh</span><span class="op" id="3794306">(</span><span class="op" id="3794307">&amp;</span><span class="ident" id="3794308">z</span><span class="op" id="3794309">.</span><span class="ident" id="3794310">b</span><span class="op" id="3794311">,</span>&nbsp;<span class="builtintype" id="3794313">uint</span><span class="op" id="3794317">(</span><span class="ident" id="3794318">shift</span><span class="op" id="3794323">)</span><span class="op" id="3794324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794327">}</span>&nbsp;<span class="keyword" id="3794329">else</span>&nbsp;<span class="op" id="3794334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794338">z</span><span class="op" id="3794339">.</span><span class="ident" id="3794340">a</span><span class="op" id="3794341">.</span><span class="ident" id="3794342">Lsh</span><span class="op" id="3794345">(</span><span class="op" id="3794346">&amp;</span><span class="ident" id="3794347">z</span><span class="op" id="3794348">.</span><span class="ident" id="3794349">a</span><span class="op" id="3794350">,</span>&nbsp;<span class="builtintype" id="3794352">uint</span><span class="op" id="3794356">(</span><span class="op" id="3794357">-</span><span class="ident" id="3794358">shift</span><span class="op" id="3794363">)</span><span class="op" id="3794364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794370">return</span>&nbsp;<span class="ident" id="3794377">z</span><span class="op" id="3794378">.</span><span class="ident" id="3794379">norm</span><span class="op" id="3794383">(</span><span class="op" id="3794384">)</span><br>
<span class="lineno">65</span><span class="op" id="3794386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3794389">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3794445">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3794500">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3794553">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3794618">func</span>&nbsp;<span class="ident" id="3794623">quotToFloat32</span><span class="op" id="3794636">(</span><span class="ident" id="3794637">a</span><span class="op" id="3794638">,</span>&nbsp;<span class="ident" id="3794640">b</span>&nbsp;<span class="ident" id="3794642">nat</span><span class="op" id="3794645">)</span>&nbsp;<span class="op" id="3794647">(</span><span class="ident" id="3794648">f</span>&nbsp;<span class="builtintype" id="3794650">float32</span><span class="op" id="3794657">,</span>&nbsp;<span class="ident" id="3794659">exact</span>&nbsp;<span class="builtintype" id="3794665">bool</span><span class="op" id="3794669">)</span>&nbsp;<span class="op" id="3794671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794674">const</span>&nbsp;<span class="op" id="3794680">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794684">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794708">Fsize</span>&nbsp;<span class="op" id="3794714">=</span>&nbsp;<span class="num" id="3794716">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794722">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794736">Msize</span>&nbsp;&nbsp;<span class="op" id="3794743">=</span>&nbsp;<span class="num" id="3794745">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794750">Msize1</span>&nbsp;<span class="op" id="3794757">=</span>&nbsp;<span class="ident" id="3794759">Msize</span>&nbsp;<span class="op" id="3794765">+</span>&nbsp;<span class="num" id="3794767">1</span>&nbsp;<span class="comment" id="3794769">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794791">Msize2</span>&nbsp;<span class="op" id="3794798">=</span>&nbsp;<span class="ident" id="3794800">Msize1</span>&nbsp;<span class="op" id="3794807">+</span>&nbsp;<span class="num" id="3794809">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794814">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794828">Esize</span>&nbsp;<span class="op" id="3794834">=</span>&nbsp;<span class="ident" id="3794836">Fsize</span>&nbsp;<span class="op" id="3794842">-</span>&nbsp;<span class="ident" id="3794844">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794853">Ebias</span>&nbsp;<span class="op" id="3794859">=</span>&nbsp;<span class="num" id="3794861">1</span><span class="op" id="3794862">&lt;&lt;</span><span class="op" id="3794864">(</span><span class="ident" id="3794865">Esize</span><span class="op" id="3794870">-</span><span class="num" id="3794871">1</span><span class="op" id="3794872">)</span>&nbsp;<span class="op" id="3794874">-</span>&nbsp;<span class="num" id="3794876">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794880">Emin</span>&nbsp;&nbsp;<span class="op" id="3794886">=</span>&nbsp;<span class="num" id="3794888">1</span>&nbsp;<span class="op" id="3794890">-</span>&nbsp;<span class="ident" id="3794892">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794900">Emax</span>&nbsp;&nbsp;<span class="op" id="3794906">=</span>&nbsp;<span class="ident" id="3794908">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794915">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794919">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794990">alen</span>&nbsp;<span class="op" id="3794995">:=</span>&nbsp;<span class="ident" id="3794998">a</span><span class="op" id="3794999">.</span><span class="ident" id="3795000">bitLen</span><span class="op" id="3795006">(</span><span class="op" id="3795007">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795010">if</span>&nbsp;<span class="ident" id="3795013">alen</span>&nbsp;<span class="op" id="3795018">==</span>&nbsp;<span class="num" id="3795021">0</span>&nbsp;<span class="op" id="3795023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795027">return</span>&nbsp;<span class="num" id="3795034">0</span><span class="op" id="3795035">,</span>&nbsp;<span class="builtintype" id="3795037">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795046">blen</span>&nbsp;<span class="op" id="3795051">:=</span>&nbsp;<span class="ident" id="3795054">b</span><span class="op" id="3795055">.</span><span class="ident" id="3795056">bitLen</span><span class="op" id="3795062">(</span><span class="op" id="3795063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795066">if</span>&nbsp;<span class="ident" id="3795069">blen</span>&nbsp;<span class="op" id="3795074">==</span>&nbsp;<span class="num" id="3795077">0</span>&nbsp;<span class="op" id="3795079">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3795083">panic</span><span class="op" id="3795088">(</span><span class="string" id="3795089">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3795107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795114">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795194">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795274">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795346">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795408">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795470">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795537">exp</span>&nbsp;<span class="op" id="3795541">:=</span>&nbsp;<span class="ident" id="3795544">alen</span>&nbsp;<span class="op" id="3795549">-</span>&nbsp;<span class="ident" id="3795551">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795557">var</span>&nbsp;<span class="ident" id="3795561">a2</span><span class="op" id="3795563">,</span>&nbsp;<span class="ident" id="3795565">b2</span>&nbsp;<span class="ident" id="3795568">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795573">a2</span>&nbsp;<span class="op" id="3795576">=</span>&nbsp;<span class="ident" id="3795578">a2</span><span class="op" id="3795580">.</span><span class="ident" id="3795581">set</span><span class="op" id="3795584">(</span><span class="ident" id="3795585">a</span><span class="op" id="3795586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795589">b2</span>&nbsp;<span class="op" id="3795592">=</span>&nbsp;<span class="ident" id="3795594">b2</span><span class="op" id="3795596">.</span><span class="ident" id="3795597">set</span><span class="op" id="3795600">(</span><span class="ident" id="3795601">b</span><span class="op" id="3795602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795605">if</span>&nbsp;<span class="ident" id="3795608">shift</span>&nbsp;<span class="op" id="3795614">:=</span>&nbsp;<span class="ident" id="3795617">Msize2</span>&nbsp;<span class="op" id="3795624">-</span>&nbsp;<span class="ident" id="3795626">exp</span><span class="op" id="3795629">;</span>&nbsp;<span class="ident" id="3795631">shift</span>&nbsp;<span class="op" id="3795637">&gt;</span>&nbsp;<span class="num" id="3795639">0</span>&nbsp;<span class="op" id="3795641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795645">a2</span>&nbsp;<span class="op" id="3795648">=</span>&nbsp;<span class="ident" id="3795650">a2</span><span class="op" id="3795652">.</span><span class="ident" id="3795653">shl</span><span class="op" id="3795656">(</span><span class="ident" id="3795657">a2</span><span class="op" id="3795659">,</span>&nbsp;<span class="builtintype" id="3795661">uint</span><span class="op" id="3795665">(</span><span class="ident" id="3795666">shift</span><span class="op" id="3795671">)</span><span class="op" id="3795672">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795675">}</span>&nbsp;<span class="keyword" id="3795677">else</span>&nbsp;<span class="keyword" id="3795682">if</span>&nbsp;<span class="ident" id="3795685">shift</span>&nbsp;<span class="op" id="3795691">&lt;</span>&nbsp;<span class="num" id="3795693">0</span>&nbsp;<span class="op" id="3795695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795699">b2</span>&nbsp;<span class="op" id="3795702">=</span>&nbsp;<span class="ident" id="3795704">b2</span><span class="op" id="3795706">.</span><span class="ident" id="3795707">shl</span><span class="op" id="3795710">(</span><span class="ident" id="3795711">b2</span><span class="op" id="3795713">,</span>&nbsp;<span class="builtintype" id="3795715">uint</span><span class="op" id="3795719">(</span><span class="op" id="3795720">-</span><span class="ident" id="3795721">shift</span><span class="op" id="3795726">)</span><span class="op" id="3795727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795734">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795796">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795853">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795878">var</span>&nbsp;<span class="ident" id="3795882">q</span>&nbsp;<span class="ident" id="3795884">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795889">q</span><span class="op" id="3795890">,</span>&nbsp;<span class="ident" id="3795892">r</span>&nbsp;<span class="op" id="3795894">:=</span>&nbsp;<span class="ident" id="3795897">q</span><span class="op" id="3795898">.</span><span class="ident" id="3795899">div</span><span class="op" id="3795902">(</span><span class="ident" id="3795903">a2</span><span class="op" id="3795905">,</span>&nbsp;<span class="ident" id="3795907">a2</span><span class="op" id="3795909">,</span>&nbsp;<span class="ident" id="3795911">b2</span><span class="op" id="3795913">)</span>&nbsp;<span class="comment" id="3795915">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795932">mantissa</span>&nbsp;<span class="op" id="3795941">:=</span>&nbsp;<span class="ident" id="3795944">low32</span><span class="op" id="3795949">(</span><span class="ident" id="3795950">q</span><span class="op" id="3795951">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795954">haveRem</span>&nbsp;<span class="op" id="3795962">:=</span>&nbsp;<span class="builtinfunc" id="3795965">len</span><span class="op" id="3795968">(</span><span class="ident" id="3795969">r</span><span class="op" id="3795970">)</span>&nbsp;<span class="op" id="3795972">&gt;</span>&nbsp;<span class="num" id="3795974">0</span>&nbsp;<span class="comment" id="3795976">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796033">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796102">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796154">if</span>&nbsp;<span class="ident" id="3796157">mantissa</span><span class="op" id="3796165">&gt;&gt;</span><span class="ident" id="3796167">Msize2</span>&nbsp;<span class="op" id="3796174">==</span>&nbsp;<span class="num" id="3796177">1</span>&nbsp;<span class="op" id="3796179">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796183">if</span>&nbsp;<span class="ident" id="3796186">mantissa</span><span class="op" id="3796194">&amp;</span><span class="num" id="3796195">1</span>&nbsp;<span class="op" id="3796197">==</span>&nbsp;<span class="num" id="3796200">1</span>&nbsp;<span class="op" id="3796202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796207">haveRem</span>&nbsp;<span class="op" id="3796215">=</span>&nbsp;<span class="builtintype" id="3796217">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796228">mantissa</span>&nbsp;<span class="op" id="3796237">&gt;&gt;=</span>&nbsp;<span class="num" id="3796241">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796245">exp</span><span class="op" id="3796248">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796255">if</span>&nbsp;<span class="ident" id="3796258">mantissa</span><span class="op" id="3796266">&gt;&gt;</span><span class="ident" id="3796268">Msize1</span>&nbsp;<span class="op" id="3796275">!=</span>&nbsp;<span class="num" id="3796278">1</span>&nbsp;<span class="op" id="3796280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3796284">panic</span><span class="op" id="3796289">(</span><span class="ident" id="3796290">fmt</span><span class="op" id="3796293">.</span><span class="ident" id="3796294">Sprintf</span><span class="op" id="3796301">(</span><span class="string" id="3796302">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3796338">,</span>&nbsp;<span class="ident" id="3796340">Msize2</span><span class="op" id="3796346">)</span><span class="op" id="3796347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796354">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796371">if</span>&nbsp;<span class="ident" id="3796374">Emin</span><span class="op" id="3796378">-</span><span class="ident" id="3796379">Msize</span>&nbsp;<span class="op" id="3796385">&lt;=</span>&nbsp;<span class="ident" id="3796388">exp</span>&nbsp;<span class="op" id="3796392">&amp;&amp;</span>&nbsp;<span class="ident" id="3796395">exp</span>&nbsp;<span class="op" id="3796399">&lt;=</span>&nbsp;<span class="ident" id="3796402">Emin</span>&nbsp;<span class="op" id="3796407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796411">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796463">shift</span>&nbsp;<span class="op" id="3796469">:=</span>&nbsp;<span class="builtintype" id="3796472">uint</span><span class="op" id="3796476">(</span><span class="ident" id="3796477">Emin</span>&nbsp;<span class="op" id="3796482">-</span>&nbsp;<span class="op" id="3796484">(</span><span class="ident" id="3796485">exp</span>&nbsp;<span class="op" id="3796489">-</span>&nbsp;<span class="num" id="3796491">1</span><span class="op" id="3796492">)</span><span class="op" id="3796493">)</span>&nbsp;<span class="comment" id="3796495">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796512">lostbits</span>&nbsp;<span class="op" id="3796521">:=</span>&nbsp;<span class="ident" id="3796524">mantissa</span>&nbsp;<span class="op" id="3796533">&amp;</span>&nbsp;<span class="op" id="3796535">(</span><span class="num" id="3796536">1</span><span class="op" id="3796537">&lt;&lt;</span><span class="ident" id="3796539">shift</span>&nbsp;<span class="op" id="3796545">-</span>&nbsp;<span class="num" id="3796547">1</span><span class="op" id="3796548">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796552">haveRem</span>&nbsp;<span class="op" id="3796560">=</span>&nbsp;<span class="ident" id="3796562">haveRem</span>&nbsp;<span class="op" id="3796570">||</span>&nbsp;<span class="ident" id="3796573">lostbits</span>&nbsp;<span class="op" id="3796582">!=</span>&nbsp;<span class="num" id="3796585">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796589">mantissa</span>&nbsp;<span class="op" id="3796598">&gt;&gt;=</span>&nbsp;<span class="ident" id="3796602">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796610">exp</span>&nbsp;<span class="op" id="3796614">=</span>&nbsp;<span class="num" id="3796616">2</span>&nbsp;<span class="op" id="3796618">-</span>&nbsp;<span class="ident" id="3796620">Ebias</span>&nbsp;<span class="comment" id="3796626">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796648">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796686">exact</span>&nbsp;<span class="op" id="3796692">=</span>&nbsp;<span class="op" id="3796694">!</span><span class="ident" id="3796695">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796704">if</span>&nbsp;<span class="ident" id="3796707">mantissa</span><span class="op" id="3796715">&amp;</span><span class="num" id="3796716">1</span>&nbsp;<span class="op" id="3796718">!=</span>&nbsp;<span class="num" id="3796721">0</span>&nbsp;<span class="op" id="3796723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796727">exact</span>&nbsp;<span class="op" id="3796733">=</span>&nbsp;<span class="builtintype" id="3796735">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796743">if</span>&nbsp;<span class="ident" id="3796746">haveRem</span>&nbsp;<span class="op" id="3796754">||</span>&nbsp;<span class="ident" id="3796757">mantissa</span><span class="op" id="3796765">&amp;</span><span class="num" id="3796766">2</span>&nbsp;<span class="op" id="3796768">!=</span>&nbsp;<span class="num" id="3796771">0</span>&nbsp;<span class="op" id="3796773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796778">if</span>&nbsp;<span class="ident" id="3796781">mantissa</span><span class="op" id="3796789">++</span><span class="op" id="3796791">;</span>&nbsp;<span class="ident" id="3796793">mantissa</span>&nbsp;<span class="op" id="3796802">&gt;=</span>&nbsp;<span class="num" id="3796805">1</span><span class="op" id="3796806">&lt;&lt;</span><span class="ident" id="3796808">Msize2</span>&nbsp;<span class="op" id="3796815">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796821">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796882">mantissa</span>&nbsp;<span class="op" id="3796891">&gt;&gt;=</span>&nbsp;<span class="num" id="3796895">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796901">exp</span><span class="op" id="3796904">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796914">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796920">mantissa</span>&nbsp;<span class="op" id="3796929">&gt;&gt;=</span>&nbsp;<span class="num" id="3796933">1</span>&nbsp;<span class="comment" id="3796935">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796997">f</span>&nbsp;<span class="op" id="3796999">=</span>&nbsp;<span class="builtintype" id="3797001">float32</span><span class="op" id="3797008">(</span><span class="ident" id="3797009">math</span><span class="op" id="3797013">.</span><span class="ident" id="3797014">Ldexp</span><span class="op" id="3797019">(</span><span class="builtintype" id="3797020">float64</span><span class="op" id="3797027">(</span><span class="ident" id="3797028">mantissa</span><span class="op" id="3797036">)</span><span class="op" id="3797037">,</span>&nbsp;<span class="ident" id="3797039">exp</span><span class="op" id="3797042">-</span><span class="ident" id="3797043">Msize1</span><span class="op" id="3797049">)</span><span class="op" id="3797050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797053">if</span>&nbsp;<span class="ident" id="3797056">math</span><span class="op" id="3797060">.</span><span class="ident" id="3797061">IsInf</span><span class="op" id="3797066">(</span><span class="builtintype" id="3797067">float64</span><span class="op" id="3797074">(</span><span class="ident" id="3797075">f</span><span class="op" id="3797076">)</span><span class="op" id="3797077">,</span>&nbsp;<span class="num" id="3797079">0</span><span class="op" id="3797080">)</span>&nbsp;<span class="op" id="3797082">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797086">exact</span>&nbsp;<span class="op" id="3797092">=</span>&nbsp;<span class="builtintype" id="3797094">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797104">return</span><br>
<span class="lineno"></span><span class="op" id="3797111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3797114">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3797170">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3797225">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3797278">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3797343">func</span>&nbsp;<span class="ident" id="3797348">quotToFloat64</span><span class="op" id="3797361">(</span><span class="ident" id="3797362">a</span><span class="op" id="3797363">,</span>&nbsp;<span class="ident" id="3797365">b</span>&nbsp;<span class="ident" id="3797367">nat</span><span class="op" id="3797370">)</span>&nbsp;<span class="op" id="3797372">(</span><span class="ident" id="3797373">f</span>&nbsp;<span class="builtintype" id="3797375">float64</span><span class="op" id="3797382">,</span>&nbsp;<span class="ident" id="3797384">exact</span>&nbsp;<span class="builtintype" id="3797390">bool</span><span class="op" id="3797394">)</span>&nbsp;<span class="op" id="3797396">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797399">const</span>&nbsp;<span class="op" id="3797405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797409">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797433">Fsize</span>&nbsp;<span class="op" id="3797439">=</span>&nbsp;<span class="num" id="3797441">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797447">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797461">Msize</span>&nbsp;&nbsp;<span class="op" id="3797468">=</span>&nbsp;<span class="num" id="3797470">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797475">Msize1</span>&nbsp;<span class="op" id="3797482">=</span>&nbsp;<span class="ident" id="3797484">Msize</span>&nbsp;<span class="op" id="3797490">+</span>&nbsp;<span class="num" id="3797492">1</span>&nbsp;<span class="comment" id="3797494">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797516">Msize2</span>&nbsp;<span class="op" id="3797523">=</span>&nbsp;<span class="ident" id="3797525">Msize1</span>&nbsp;<span class="op" id="3797532">+</span>&nbsp;<span class="num" id="3797534">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797539">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797553">Esize</span>&nbsp;<span class="op" id="3797559">=</span>&nbsp;<span class="ident" id="3797561">Fsize</span>&nbsp;<span class="op" id="3797567">-</span>&nbsp;<span class="ident" id="3797569">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797578">Ebias</span>&nbsp;<span class="op" id="3797584">=</span>&nbsp;<span class="num" id="3797586">1</span><span class="op" id="3797587">&lt;&lt;</span><span class="op" id="3797589">(</span><span class="ident" id="3797590">Esize</span><span class="op" id="3797595">-</span><span class="num" id="3797596">1</span><span class="op" id="3797597">)</span>&nbsp;<span class="op" id="3797599">-</span>&nbsp;<span class="num" id="3797601">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797605">Emin</span>&nbsp;&nbsp;<span class="op" id="3797611">=</span>&nbsp;<span class="num" id="3797613">1</span>&nbsp;<span class="op" id="3797615">-</span>&nbsp;<span class="ident" id="3797617">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797625">Emax</span>&nbsp;&nbsp;<span class="op" id="3797631">=</span>&nbsp;<span class="ident" id="3797633">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797640">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797644">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797715">alen</span>&nbsp;<span class="op" id="3797720">:=</span>&nbsp;<span class="ident" id="3797723">a</span><span class="op" id="3797724">.</span><span class="ident" id="3797725">bitLen</span><span class="op" id="3797731">(</span><span class="op" id="3797732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797735">if</span>&nbsp;<span class="ident" id="3797738">alen</span>&nbsp;<span class="op" id="3797743">==</span>&nbsp;<span class="num" id="3797746">0</span>&nbsp;<span class="op" id="3797748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797752">return</span>&nbsp;<span class="num" id="3797759">0</span><span class="op" id="3797760">,</span>&nbsp;<span class="builtintype" id="3797762">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797771">blen</span>&nbsp;<span class="op" id="3797776">:=</span>&nbsp;<span class="ident" id="3797779">b</span><span class="op" id="3797780">.</span><span class="ident" id="3797781">bitLen</span><span class="op" id="3797787">(</span><span class="op" id="3797788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797791">if</span>&nbsp;<span class="ident" id="3797794">blen</span>&nbsp;<span class="op" id="3797799">==</span>&nbsp;<span class="num" id="3797802">0</span>&nbsp;<span class="op" id="3797804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3797808">panic</span><span class="op" id="3797813">(</span><span class="string" id="3797814">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3797832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797835">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797839">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797919">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797999">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798071">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798133">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798195">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798262">exp</span>&nbsp;<span class="op" id="3798266">:=</span>&nbsp;<span class="ident" id="3798269">alen</span>&nbsp;<span class="op" id="3798274">-</span>&nbsp;<span class="ident" id="3798276">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798282">var</span>&nbsp;<span class="ident" id="3798286">a2</span><span class="op" id="3798288">,</span>&nbsp;<span class="ident" id="3798290">b2</span>&nbsp;<span class="ident" id="3798293">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798298">a2</span>&nbsp;<span class="op" id="3798301">=</span>&nbsp;<span class="ident" id="3798303">a2</span><span class="op" id="3798305">.</span><span class="ident" id="3798306">set</span><span class="op" id="3798309">(</span><span class="ident" id="3798310">a</span><span class="op" id="3798311">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798314">b2</span>&nbsp;<span class="op" id="3798317">=</span>&nbsp;<span class="ident" id="3798319">b2</span><span class="op" id="3798321">.</span><span class="ident" id="3798322">set</span><span class="op" id="3798325">(</span><span class="ident" id="3798326">b</span><span class="op" id="3798327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798330">if</span>&nbsp;<span class="ident" id="3798333">shift</span>&nbsp;<span class="op" id="3798339">:=</span>&nbsp;<span class="ident" id="3798342">Msize2</span>&nbsp;<span class="op" id="3798349">-</span>&nbsp;<span class="ident" id="3798351">exp</span><span class="op" id="3798354">;</span>&nbsp;<span class="ident" id="3798356">shift</span>&nbsp;<span class="op" id="3798362">&gt;</span>&nbsp;<span class="num" id="3798364">0</span>&nbsp;<span class="op" id="3798366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798370">a2</span>&nbsp;<span class="op" id="3798373">=</span>&nbsp;<span class="ident" id="3798375">a2</span><span class="op" id="3798377">.</span><span class="ident" id="3798378">shl</span><span class="op" id="3798381">(</span><span class="ident" id="3798382">a2</span><span class="op" id="3798384">,</span>&nbsp;<span class="builtintype" id="3798386">uint</span><span class="op" id="3798390">(</span><span class="ident" id="3798391">shift</span><span class="op" id="3798396">)</span><span class="op" id="3798397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798400">}</span>&nbsp;<span class="keyword" id="3798402">else</span>&nbsp;<span class="keyword" id="3798407">if</span>&nbsp;<span class="ident" id="3798410">shift</span>&nbsp;<span class="op" id="3798416">&lt;</span>&nbsp;<span class="num" id="3798418">0</span>&nbsp;<span class="op" id="3798420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798424">b2</span>&nbsp;<span class="op" id="3798427">=</span>&nbsp;<span class="ident" id="3798429">b2</span><span class="op" id="3798431">.</span><span class="ident" id="3798432">shl</span><span class="op" id="3798435">(</span><span class="ident" id="3798436">b2</span><span class="op" id="3798438">,</span>&nbsp;<span class="builtintype" id="3798440">uint</span><span class="op" id="3798444">(</span><span class="op" id="3798445">-</span><span class="ident" id="3798446">shift</span><span class="op" id="3798451">)</span><span class="op" id="3798452">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798459">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798521">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798578">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798603">var</span>&nbsp;<span class="ident" id="3798607">q</span>&nbsp;<span class="ident" id="3798609">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798614">q</span><span class="op" id="3798615">,</span>&nbsp;<span class="ident" id="3798617">r</span>&nbsp;<span class="op" id="3798619">:=</span>&nbsp;<span class="ident" id="3798622">q</span><span class="op" id="3798623">.</span><span class="ident" id="3798624">div</span><span class="op" id="3798627">(</span><span class="ident" id="3798628">a2</span><span class="op" id="3798630">,</span>&nbsp;<span class="ident" id="3798632">a2</span><span class="op" id="3798634">,</span>&nbsp;<span class="ident" id="3798636">b2</span><span class="op" id="3798638">)</span>&nbsp;<span class="comment" id="3798640">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798657">mantissa</span>&nbsp;<span class="op" id="3798666">:=</span>&nbsp;<span class="ident" id="3798669">low64</span><span class="op" id="3798674">(</span><span class="ident" id="3798675">q</span><span class="op" id="3798676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798679">haveRem</span>&nbsp;<span class="op" id="3798687">:=</span>&nbsp;<span class="builtinfunc" id="3798690">len</span><span class="op" id="3798693">(</span><span class="ident" id="3798694">r</span><span class="op" id="3798695">)</span>&nbsp;<span class="op" id="3798697">&gt;</span>&nbsp;<span class="num" id="3798699">0</span>&nbsp;<span class="comment" id="3798701">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798758">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798827">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798879">if</span>&nbsp;<span class="ident" id="3798882">mantissa</span><span class="op" id="3798890">&gt;&gt;</span><span class="ident" id="3798892">Msize2</span>&nbsp;<span class="op" id="3798899">==</span>&nbsp;<span class="num" id="3798902">1</span>&nbsp;<span class="op" id="3798904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798908">if</span>&nbsp;<span class="ident" id="3798911">mantissa</span><span class="op" id="3798919">&amp;</span><span class="num" id="3798920">1</span>&nbsp;<span class="op" id="3798922">==</span>&nbsp;<span class="num" id="3798925">1</span>&nbsp;<span class="op" id="3798927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798932">haveRem</span>&nbsp;<span class="op" id="3798940">=</span>&nbsp;<span class="builtintype" id="3798942">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798953">mantissa</span>&nbsp;<span class="op" id="3798962">&gt;&gt;=</span>&nbsp;<span class="num" id="3798966">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798970">exp</span><span class="op" id="3798973">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798980">if</span>&nbsp;<span class="ident" id="3798983">mantissa</span><span class="op" id="3798991">&gt;&gt;</span><span class="ident" id="3798993">Msize1</span>&nbsp;<span class="op" id="3799000">!=</span>&nbsp;<span class="num" id="3799003">1</span>&nbsp;<span class="op" id="3799005">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3799009">panic</span><span class="op" id="3799014">(</span><span class="ident" id="3799015">fmt</span><span class="op" id="3799018">.</span><span class="ident" id="3799019">Sprintf</span><span class="op" id="3799026">(</span><span class="string" id="3799027">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3799063">,</span>&nbsp;<span class="ident" id="3799065">Msize2</span><span class="op" id="3799071">)</span><span class="op" id="3799072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799079">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799096">if</span>&nbsp;<span class="ident" id="3799099">Emin</span><span class="op" id="3799103">-</span><span class="ident" id="3799104">Msize</span>&nbsp;<span class="op" id="3799110">&lt;=</span>&nbsp;<span class="ident" id="3799113">exp</span>&nbsp;<span class="op" id="3799117">&amp;&amp;</span>&nbsp;<span class="ident" id="3799120">exp</span>&nbsp;<span class="op" id="3799124">&lt;=</span>&nbsp;<span class="ident" id="3799127">Emin</span>&nbsp;<span class="op" id="3799132">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799136">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799188">shift</span>&nbsp;<span class="op" id="3799194">:=</span>&nbsp;<span class="builtintype" id="3799197">uint</span><span class="op" id="3799201">(</span><span class="ident" id="3799202">Emin</span>&nbsp;<span class="op" id="3799207">-</span>&nbsp;<span class="op" id="3799209">(</span><span class="ident" id="3799210">exp</span>&nbsp;<span class="op" id="3799214">-</span>&nbsp;<span class="num" id="3799216">1</span><span class="op" id="3799217">)</span><span class="op" id="3799218">)</span>&nbsp;<span class="comment" id="3799220">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799237">lostbits</span>&nbsp;<span class="op" id="3799246">:=</span>&nbsp;<span class="ident" id="3799249">mantissa</span>&nbsp;<span class="op" id="3799258">&amp;</span>&nbsp;<span class="op" id="3799260">(</span><span class="num" id="3799261">1</span><span class="op" id="3799262">&lt;&lt;</span><span class="ident" id="3799264">shift</span>&nbsp;<span class="op" id="3799270">-</span>&nbsp;<span class="num" id="3799272">1</span><span class="op" id="3799273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799277">haveRem</span>&nbsp;<span class="op" id="3799285">=</span>&nbsp;<span class="ident" id="3799287">haveRem</span>&nbsp;<span class="op" id="3799295">||</span>&nbsp;<span class="ident" id="3799298">lostbits</span>&nbsp;<span class="op" id="3799307">!=</span>&nbsp;<span class="num" id="3799310">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799314">mantissa</span>&nbsp;<span class="op" id="3799323">&gt;&gt;=</span>&nbsp;<span class="ident" id="3799327">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799335">exp</span>&nbsp;<span class="op" id="3799339">=</span>&nbsp;<span class="num" id="3799341">2</span>&nbsp;<span class="op" id="3799343">-</span>&nbsp;<span class="ident" id="3799345">Ebias</span>&nbsp;<span class="comment" id="3799351">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799373">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799411">exact</span>&nbsp;<span class="op" id="3799417">=</span>&nbsp;<span class="op" id="3799419">!</span><span class="ident" id="3799420">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799429">if</span>&nbsp;<span class="ident" id="3799432">mantissa</span><span class="op" id="3799440">&amp;</span><span class="num" id="3799441">1</span>&nbsp;<span class="op" id="3799443">!=</span>&nbsp;<span class="num" id="3799446">0</span>&nbsp;<span class="op" id="3799448">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799452">exact</span>&nbsp;<span class="op" id="3799458">=</span>&nbsp;<span class="builtintype" id="3799460">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799468">if</span>&nbsp;<span class="ident" id="3799471">haveRem</span>&nbsp;<span class="op" id="3799479">||</span>&nbsp;<span class="ident" id="3799482">mantissa</span><span class="op" id="3799490">&amp;</span><span class="num" id="3799491">2</span>&nbsp;<span class="op" id="3799493">!=</span>&nbsp;<span class="num" id="3799496">0</span>&nbsp;<span class="op" id="3799498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799503">if</span>&nbsp;<span class="ident" id="3799506">mantissa</span><span class="op" id="3799514">++</span><span class="op" id="3799516">;</span>&nbsp;<span class="ident" id="3799518">mantissa</span>&nbsp;<span class="op" id="3799527">&gt;=</span>&nbsp;<span class="num" id="3799530">1</span><span class="op" id="3799531">&lt;&lt;</span><span class="ident" id="3799533">Msize2</span>&nbsp;<span class="op" id="3799540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799546">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799607">mantissa</span>&nbsp;<span class="op" id="3799616">&gt;&gt;=</span>&nbsp;<span class="num" id="3799620">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799626">exp</span><span class="op" id="3799629">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799645">mantissa</span>&nbsp;<span class="op" id="3799654">&gt;&gt;=</span>&nbsp;<span class="num" id="3799658">1</span>&nbsp;<span class="comment" id="3799660">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799722">f</span>&nbsp;<span class="op" id="3799724">=</span>&nbsp;<span class="ident" id="3799726">math</span><span class="op" id="3799730">.</span><span class="ident" id="3799731">Ldexp</span><span class="op" id="3799736">(</span><span class="builtintype" id="3799737">float64</span><span class="op" id="3799744">(</span><span class="ident" id="3799745">mantissa</span><span class="op" id="3799753">)</span><span class="op" id="3799754">,</span>&nbsp;<span class="ident" id="3799756">exp</span><span class="op" id="3799759">-</span><span class="ident" id="3799760">Msize1</span><span class="op" id="3799766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799769">if</span>&nbsp;<span class="ident" id="3799772">math</span><span class="op" id="3799776">.</span><span class="ident" id="3799777">IsInf</span><span class="op" id="3799782">(</span><span class="ident" id="3799783">f</span><span class="op" id="3799784">,</span>&nbsp;<span class="num" id="3799786">0</span><span class="op" id="3799787">)</span>&nbsp;<span class="op" id="3799789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799793">exact</span>&nbsp;<span class="op" id="3799799">=</span>&nbsp;<span class="builtintype" id="3799801">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799808">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799811">return</span><br>
<span class="lineno"></span><span class="op" id="3799818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799821">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3799894">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3799967">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3800036">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3800099">func</span>&nbsp;<span class="op" id="3800104">(</span><span class="ident" id="3800105">x</span>&nbsp;<span class="op" id="3800107">*</span><span class="ident" id="3800108">Rat</span><span class="op" id="3800111">)</span>&nbsp;<span class="ident" id="3800113">Float32</span><span class="op" id="3800120">(</span><span class="op" id="3800121">)</span>&nbsp;<span class="op" id="3800123">(</span><span class="ident" id="3800124">f</span>&nbsp;<span class="builtintype" id="3800126">float32</span><span class="op" id="3800133">,</span>&nbsp;<span class="ident" id="3800135">exact</span>&nbsp;<span class="builtintype" id="3800141">bool</span><span class="op" id="3800145">)</span>&nbsp;<span class="op" id="3800147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800150">b</span>&nbsp;<span class="op" id="3800152">:=</span>&nbsp;<span class="ident" id="3800155">x</span><span class="op" id="3800156">.</span><span class="ident" id="3800157">b</span><span class="op" id="3800158">.</span><span class="ident" id="3800159">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800164">if</span>&nbsp;<span class="builtinfunc" id="3800167">len</span><span class="op" id="3800170">(</span><span class="ident" id="3800171">b</span><span class="op" id="3800172">)</span>&nbsp;<span class="op" id="3800174">==</span>&nbsp;<span class="num" id="3800177">0</span>&nbsp;<span class="op" id="3800179">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800183">b</span>&nbsp;<span class="op" id="3800185">=</span>&nbsp;<span class="ident" id="3800187">b</span><span class="op" id="3800188">.</span><span class="ident" id="3800189">set</span><span class="op" id="3800192">(</span><span class="ident" id="3800193">natOne</span><span class="op" id="3800199">)</span>&nbsp;<span class="comment" id="3800201">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800232">f</span><span class="op" id="3800233">,</span>&nbsp;<span class="ident" id="3800235">exact</span>&nbsp;<span class="op" id="3800241">=</span>&nbsp;<span class="ident" id="3800243">quotToFloat32</span><span class="op" id="3800256">(</span><span class="ident" id="3800257">x</span><span class="op" id="3800258">.</span><span class="ident" id="3800259">a</span><span class="op" id="3800260">.</span><span class="ident" id="3800261">abs</span><span class="op" id="3800264">,</span>&nbsp;<span class="ident" id="3800266">b</span><span class="op" id="3800267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800270">if</span>&nbsp;<span class="ident" id="3800273">x</span><span class="op" id="3800274">.</span><span class="ident" id="3800275">a</span><span class="op" id="3800276">.</span><span class="ident" id="3800277">neg</span>&nbsp;<span class="op" id="3800281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800285">f</span>&nbsp;<span class="op" id="3800287">=</span>&nbsp;<span class="op" id="3800289">-</span><span class="ident" id="3800290">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800296">return</span><br>
<span class="lineno"></span><span class="op" id="3800303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800306">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3800379">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3800452">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3800521">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3800584">func</span>&nbsp;<span class="op" id="3800589">(</span><span class="ident" id="3800590">x</span>&nbsp;<span class="op" id="3800592">*</span><span class="ident" id="3800593">Rat</span><span class="op" id="3800596">)</span>&nbsp;<span class="ident" id="3800598">Float64</span><span class="op" id="3800605">(</span><span class="op" id="3800606">)</span>&nbsp;<span class="op" id="3800608">(</span><span class="ident" id="3800609">f</span>&nbsp;<span class="builtintype" id="3800611">float64</span><span class="op" id="3800618">,</span>&nbsp;<span class="ident" id="3800620">exact</span>&nbsp;<span class="builtintype" id="3800626">bool</span><span class="op" id="3800630">)</span>&nbsp;<span class="op" id="3800632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800635">b</span>&nbsp;<span class="op" id="3800637">:=</span>&nbsp;<span class="ident" id="3800640">x</span><span class="op" id="3800641">.</span><span class="ident" id="3800642">b</span><span class="op" id="3800643">.</span><span class="ident" id="3800644">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800649">if</span>&nbsp;<span class="builtinfunc" id="3800652">len</span><span class="op" id="3800655">(</span><span class="ident" id="3800656">b</span><span class="op" id="3800657">)</span>&nbsp;<span class="op" id="3800659">==</span>&nbsp;<span class="num" id="3800662">0</span>&nbsp;<span class="op" id="3800664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800668">b</span>&nbsp;<span class="op" id="3800670">=</span>&nbsp;<span class="ident" id="3800672">b</span><span class="op" id="3800673">.</span><span class="ident" id="3800674">set</span><span class="op" id="3800677">(</span><span class="ident" id="3800678">natOne</span><span class="op" id="3800684">)</span>&nbsp;<span class="comment" id="3800686">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800717">f</span><span class="op" id="3800718">,</span>&nbsp;<span class="ident" id="3800720">exact</span>&nbsp;<span class="op" id="3800726">=</span>&nbsp;<span class="ident" id="3800728">quotToFloat64</span><span class="op" id="3800741">(</span><span class="ident" id="3800742">x</span><span class="op" id="3800743">.</span><span class="ident" id="3800744">a</span><span class="op" id="3800745">.</span><span class="ident" id="3800746">abs</span><span class="op" id="3800749">,</span>&nbsp;<span class="ident" id="3800751">b</span><span class="op" id="3800752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800755">if</span>&nbsp;<span class="ident" id="3800758">x</span><span class="op" id="3800759">.</span><span class="ident" id="3800760">a</span><span class="op" id="3800761">.</span><span class="ident" id="3800762">neg</span>&nbsp;<span class="op" id="3800766">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800770">f</span>&nbsp;<span class="op" id="3800772">=</span>&nbsp;<span class="op" id="3800774">-</span><span class="ident" id="3800775">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800781">return</span><br>
<span class="lineno"></span><span class="op" id="3800788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3800791">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3800831">func</span>&nbsp;<span class="op" id="3800836">(</span><span class="ident" id="3800837">z</span>&nbsp;<span class="op" id="3800839">*</span><span class="ident" id="3800840">Rat</span><span class="op" id="3800843">)</span>&nbsp;<span class="ident" id="3800845">SetFrac</span><span class="op" id="3800852">(</span><span class="ident" id="3800853">a</span><span class="op" id="3800854">,</span>&nbsp;<span class="ident" id="3800856">b</span>&nbsp;<span class="op" id="3800858">*</span><span class="ident" id="3800859">Int</span><span class="op" id="3800862">)</span>&nbsp;<span class="op" id="3800864">*</span><span class="ident" id="3800865">Rat</span>&nbsp;<span class="op" id="3800869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800872">z</span><span class="op" id="3800873">.</span><span class="ident" id="3800874">a</span><span class="op" id="3800875">.</span><span class="ident" id="3800876">neg</span>&nbsp;<span class="op" id="3800880">=</span>&nbsp;<span class="ident" id="3800882">a</span><span class="op" id="3800883">.</span><span class="ident" id="3800884">neg</span>&nbsp;<span class="op" id="3800888">!=</span>&nbsp;<span class="ident" id="3800891">b</span><span class="op" id="3800892">.</span><span class="ident" id="3800893">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800898">babs</span>&nbsp;<span class="op" id="3800903">:=</span>&nbsp;<span class="ident" id="3800906">b</span><span class="op" id="3800907">.</span><span class="ident" id="3800908">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800913">if</span>&nbsp;<span class="builtinfunc" id="3800916">len</span><span class="op" id="3800919">(</span><span class="ident" id="3800920">babs</span><span class="op" id="3800924">)</span>&nbsp;<span class="op" id="3800926">==</span>&nbsp;<span class="num" id="3800929">0</span>&nbsp;<span class="op" id="3800931">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3800935">panic</span><span class="op" id="3800940">(</span><span class="string" id="3800941">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3800959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800965">if</span>&nbsp;<span class="op" id="3800968">&amp;</span><span class="ident" id="3800969">z</span><span class="op" id="3800970">.</span><span class="ident" id="3800971">a</span>&nbsp;<span class="op" id="3800973">==</span>&nbsp;<span class="ident" id="3800976">b</span>&nbsp;<span class="op" id="3800978">||</span>&nbsp;<span class="ident" id="3800981">alias</span><span class="op" id="3800986">(</span><span class="ident" id="3800987">z</span><span class="op" id="3800988">.</span><span class="ident" id="3800989">a</span><span class="op" id="3800990">.</span><span class="ident" id="3800991">abs</span><span class="op" id="3800994">,</span>&nbsp;<span class="ident" id="3800996">babs</span><span class="op" id="3801000">)</span>&nbsp;<span class="op" id="3801002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801006">babs</span>&nbsp;<span class="op" id="3801011">=</span>&nbsp;<span class="ident" id="3801013">nat</span><span class="op" id="3801016">(</span><span class="ident" id="3801017">nil</span><span class="op" id="3801020">)</span><span class="op" id="3801021">.</span><span class="ident" id="3801022">set</span><span class="op" id="3801025">(</span><span class="ident" id="3801026">babs</span><span class="op" id="3801030">)</span>&nbsp;<span class="comment" id="3801032">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801048">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801051">z</span><span class="op" id="3801052">.</span><span class="ident" id="3801053">a</span><span class="op" id="3801054">.</span><span class="ident" id="3801055">abs</span>&nbsp;<span class="op" id="3801059">=</span>&nbsp;<span class="ident" id="3801061">z</span><span class="op" id="3801062">.</span><span class="ident" id="3801063">a</span><span class="op" id="3801064">.</span><span class="ident" id="3801065">abs</span><span class="op" id="3801068">.</span><span class="ident" id="3801069">set</span><span class="op" id="3801072">(</span><span class="ident" id="3801073">a</span><span class="op" id="3801074">.</span><span class="ident" id="3801075">abs</span><span class="op" id="3801078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801081">z</span><span class="op" id="3801082">.</span><span class="ident" id="3801083">b</span><span class="op" id="3801084">.</span><span class="ident" id="3801085">abs</span>&nbsp;<span class="op" id="3801089">=</span>&nbsp;<span class="ident" id="3801091">z</span><span class="op" id="3801092">.</span><span class="ident" id="3801093">b</span><span class="op" id="3801094">.</span><span class="ident" id="3801095">abs</span><span class="op" id="3801098">.</span><span class="ident" id="3801099">set</span><span class="op" id="3801102">(</span><span class="ident" id="3801103">babs</span><span class="op" id="3801107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801110">return</span>&nbsp;<span class="ident" id="3801117">z</span><span class="op" id="3801118">.</span><span class="ident" id="3801119">norm</span><span class="op" id="3801123">(</span><span class="op" id="3801124">)</span><br>
<span class="lineno"></span><span class="op" id="3801126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3801129">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3801171">func</span>&nbsp;<span class="op" id="3801176">(</span><span class="ident" id="3801177">z</span>&nbsp;<span class="op" id="3801179">*</span><span class="ident" id="3801180">Rat</span><span class="op" id="3801183">)</span>&nbsp;<span class="ident" id="3801185">SetFrac64</span><span class="op" id="3801194">(</span><span class="ident" id="3801195">a</span><span class="op" id="3801196">,</span>&nbsp;<span class="ident" id="3801198">b</span>&nbsp;<span class="ident" id="3801200">int64</span><span class="op" id="3801205">)</span>&nbsp;<span class="op" id="3801207">*</span><span class="ident" id="3801208">Rat</span>&nbsp;<span class="op" id="3801212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801215">z</span><span class="op" id="3801216">.</span><span class="ident" id="3801217">a</span><span class="op" id="3801218">.</span><span class="ident" id="3801219">SetInt64</span><span class="op" id="3801227">(</span><span class="ident" id="3801228">a</span><span class="op" id="3801229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801232">if</span>&nbsp;<span class="ident" id="3801235">b</span>&nbsp;<span class="op" id="3801237">==</span>&nbsp;<span class="num" id="3801240">0</span>&nbsp;<span class="op" id="3801242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3801246">panic</span><span class="op" id="3801251">(</span><span class="string" id="3801252">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3801270">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801276">if</span>&nbsp;<span class="ident" id="3801279">b</span>&nbsp;<span class="op" id="3801281">&lt;</span>&nbsp;<span class="num" id="3801283">0</span>&nbsp;<span class="op" id="3801285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801289">b</span>&nbsp;<span class="op" id="3801291">=</span>&nbsp;<span class="op" id="3801293">-</span><span class="ident" id="3801294">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801298">z</span><span class="op" id="3801299">.</span><span class="ident" id="3801300">a</span><span class="op" id="3801301">.</span><span class="ident" id="3801302">neg</span>&nbsp;<span class="op" id="3801306">=</span>&nbsp;<span class="op" id="3801308">!</span><span class="ident" id="3801309">z</span><span class="op" id="3801310">.</span><span class="ident" id="3801311">a</span><span class="op" id="3801312">.</span><span class="ident" id="3801313">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801318">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801321">z</span><span class="op" id="3801322">.</span><span class="ident" id="3801323">b</span><span class="op" id="3801324">.</span><span class="ident" id="3801325">abs</span>&nbsp;<span class="op" id="3801329">=</span>&nbsp;<span class="ident" id="3801331">z</span><span class="op" id="3801332">.</span><span class="ident" id="3801333">b</span><span class="op" id="3801334">.</span><span class="ident" id="3801335">abs</span><span class="op" id="3801338">.</span><span class="ident" id="3801339">setUint64</span><span class="op" id="3801348">(</span><span class="ident" id="3801349">uint64</span><span class="op" id="3801355">(</span><span class="ident" id="3801356">b</span><span class="op" id="3801357">)</span><span class="op" id="3801358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801361">return</span>&nbsp;<span class="ident" id="3801368">z</span><span class="op" id="3801369">.</span><span class="ident" id="3801370">norm</span><span class="op" id="3801374">(</span><span class="op" id="3801375">)</span><br>
<span class="lineno"></span><span class="op" id="3801377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801380">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3801441">func</span>&nbsp;<span class="op" id="3801446">(</span><span class="ident" id="3801447">z</span>&nbsp;<span class="op" id="3801449">*</span><span class="ident" id="3801450">Rat</span><span class="op" id="3801453">)</span>&nbsp;<span class="ident" id="3801455">SetInt</span><span class="op" id="3801461">(</span><span class="ident" id="3801462">x</span>&nbsp;<span class="op" id="3801464">*</span><span class="ident" id="3801465">Int</span><span class="op" id="3801468">)</span>&nbsp;<span class="op" id="3801470">*</span><span class="ident" id="3801471">Rat</span>&nbsp;<span class="op" id="3801475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801478">z</span><span class="op" id="3801479">.</span><span class="ident" id="3801480">a</span><span class="op" id="3801481">.</span><span class="ident" id="3801482">Set</span><span class="op" id="3801485">(</span><span class="ident" id="3801486">x</span><span class="op" id="3801487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801490">z</span><span class="op" id="3801491">.</span><span class="ident" id="3801492">b</span><span class="op" id="3801493">.</span><span class="ident" id="3801494">abs</span>&nbsp;<span class="op" id="3801498">=</span>&nbsp;<span class="ident" id="3801500">z</span><span class="op" id="3801501">.</span><span class="ident" id="3801502">b</span><span class="op" id="3801503">.</span><span class="ident" id="3801504">abs</span><span class="op" id="3801507">.</span><span class="builtinfunc" id="3801508">make</span><span class="op" id="3801512">(</span><span class="num" id="3801513">0</span><span class="op" id="3801514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801517">return</span>&nbsp;<span class="ident" id="3801524">z</span><br>
<span class="lineno"></span><span class="op" id="3801526">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3801529">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3801568">func</span>&nbsp;<span class="op" id="3801573">(</span><span class="ident" id="3801574">z</span>&nbsp;<span class="op" id="3801576">*</span><span class="ident" id="3801577">Rat</span><span class="op" id="3801580">)</span>&nbsp;<span class="ident" id="3801582">SetInt64</span><span class="op" id="3801590">(</span><span class="ident" id="3801591">x</span>&nbsp;<span class="ident" id="3801593">int64</span><span class="op" id="3801598">)</span>&nbsp;<span class="op" id="3801600">*</span><span class="ident" id="3801601">Rat</span>&nbsp;<span class="op" id="3801605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801608">z</span><span class="op" id="3801609">.</span><span class="ident" id="3801610">a</span><span class="op" id="3801611">.</span><span class="ident" id="3801612">SetInt64</span><span class="op" id="3801620">(</span><span class="ident" id="3801621">x</span><span class="op" id="3801622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801625">z</span><span class="op" id="3801626">.</span><span class="ident" id="3801627">b</span><span class="op" id="3801628">.</span><span class="ident" id="3801629">abs</span>&nbsp;<span class="op" id="3801633">=</span>&nbsp;<span class="ident" id="3801635">z</span><span class="op" id="3801636">.</span><span class="ident" id="3801637">b</span><span class="op" id="3801638">.</span><span class="ident" id="3801639">abs</span><span class="op" id="3801642">.</span><span class="builtinfunc" id="3801643">make</span><span class="op" id="3801647">(</span><span class="num" id="3801648">0</span><span class="op" id="3801649">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801652">return</span>&nbsp;<span class="ident" id="3801659">z</span><br>
<span class="lineno"></span><span class="op" id="3801661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801664">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3801722">func</span>&nbsp;<span class="op" id="3801727">(</span><span class="ident" id="3801728">z</span>&nbsp;<span class="op" id="3801730">*</span><span class="ident" id="3801731">Rat</span><span class="op" id="3801734">)</span>&nbsp;<span class="ident" id="3801736">Set</span><span class="op" id="3801739">(</span><span class="ident" id="3801740">x</span>&nbsp;<span class="op" id="3801742">*</span><span class="ident" id="3801743">Rat</span><span class="op" id="3801746">)</span>&nbsp;<span class="op" id="3801748">*</span><span class="ident" id="3801749">Rat</span>&nbsp;<span class="op" id="3801753">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801756">if</span>&nbsp;<span class="ident" id="3801759">z</span>&nbsp;<span class="op" id="3801761">!=</span>&nbsp;<span class="ident" id="3801764">x</span>&nbsp;<span class="op" id="3801766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801770">z</span><span class="op" id="3801771">.</span><span class="ident" id="3801772">a</span><span class="op" id="3801773">.</span><span class="ident" id="3801774">Set</span><span class="op" id="3801777">(</span><span class="op" id="3801778">&amp;</span><span class="ident" id="3801779">x</span><span class="op" id="3801780">.</span><span class="ident" id="3801781">a</span><span class="op" id="3801782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801786">z</span><span class="op" id="3801787">.</span><span class="ident" id="3801788">b</span><span class="op" id="3801789">.</span><span class="ident" id="3801790">Set</span><span class="op" id="3801793">(</span><span class="op" id="3801794">&amp;</span><span class="ident" id="3801795">x</span><span class="op" id="3801796">.</span><span class="ident" id="3801797">b</span><span class="op" id="3801798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801804">return</span>&nbsp;<span class="ident" id="3801811">z</span><br>
<span class="lineno">345</span><span class="op" id="3801813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801816">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3801878">func</span>&nbsp;<span class="op" id="3801883">(</span><span class="ident" id="3801884">z</span>&nbsp;<span class="op" id="3801886">*</span><span class="ident" id="3801887">Rat</span><span class="op" id="3801890">)</span>&nbsp;<span class="ident" id="3801892">Abs</span><span class="op" id="3801895">(</span><span class="ident" id="3801896">x</span>&nbsp;<span class="op" id="3801898">*</span><span class="ident" id="3801899">Rat</span><span class="op" id="3801902">)</span>&nbsp;<span class="op" id="3801904">*</span><span class="ident" id="3801905">Rat</span>&nbsp;<span class="op" id="3801909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801912">z</span><span class="op" id="3801913">.</span><span class="ident" id="3801914">Set</span><span class="op" id="3801917">(</span><span class="ident" id="3801918">x</span><span class="op" id="3801919">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801922">z</span><span class="op" id="3801923">.</span><span class="ident" id="3801924">a</span><span class="op" id="3801925">.</span><span class="ident" id="3801926">neg</span>&nbsp;<span class="op" id="3801930">=</span>&nbsp;<span class="builtintype" id="3801932">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801939">return</span>&nbsp;<span class="ident" id="3801946">z</span><br>
<span class="lineno"></span><span class="op" id="3801948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801951">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3801986">func</span>&nbsp;<span class="op" id="3801991">(</span><span class="ident" id="3801992">z</span>&nbsp;<span class="op" id="3801994">*</span><span class="ident" id="3801995">Rat</span><span class="op" id="3801998">)</span>&nbsp;<span class="ident" id="3802000">Neg</span><span class="op" id="3802003">(</span><span class="ident" id="3802004">x</span>&nbsp;<span class="op" id="3802006">*</span><span class="ident" id="3802007">Rat</span><span class="op" id="3802010">)</span>&nbsp;<span class="op" id="3802012">*</span><span class="ident" id="3802013">Rat</span>&nbsp;<span class="op" id="3802017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802020">z</span><span class="op" id="3802021">.</span><span class="ident" id="3802022">Set</span><span class="op" id="3802025">(</span><span class="ident" id="3802026">x</span><span class="op" id="3802027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802030">z</span><span class="op" id="3802031">.</span><span class="ident" id="3802032">a</span><span class="op" id="3802033">.</span><span class="ident" id="3802034">neg</span>&nbsp;<span class="op" id="3802038">=</span>&nbsp;<span class="builtinfunc" id="3802040">len</span><span class="op" id="3802043">(</span><span class="ident" id="3802044">z</span><span class="op" id="3802045">.</span><span class="ident" id="3802046">a</span><span class="op" id="3802047">.</span><span class="ident" id="3802048">abs</span><span class="op" id="3802051">)</span>&nbsp;<span class="op" id="3802053">&gt;</span>&nbsp;<span class="num" id="3802055">0</span>&nbsp;<span class="op" id="3802057">&amp;&amp;</span>&nbsp;<span class="op" id="3802060">!</span><span class="ident" id="3802061">z</span><span class="op" id="3802062">.</span><span class="ident" id="3802063">a</span><span class="op" id="3802064">.</span><span class="ident" id="3802065">neg</span>&nbsp;<span class="comment" id="3802069">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802087">return</span>&nbsp;<span class="ident" id="3802094">z</span><br>
<span class="lineno"></span><span class="op" id="3802096">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3802099">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3802135">func</span>&nbsp;<span class="op" id="3802140">(</span><span class="ident" id="3802141">z</span>&nbsp;<span class="op" id="3802143">*</span><span class="ident" id="3802144">Rat</span><span class="op" id="3802147">)</span>&nbsp;<span class="ident" id="3802149">Inv</span><span class="op" id="3802152">(</span><span class="ident" id="3802153">x</span>&nbsp;<span class="op" id="3802155">*</span><span class="ident" id="3802156">Rat</span><span class="op" id="3802159">)</span>&nbsp;<span class="op" id="3802161">*</span><span class="ident" id="3802162">Rat</span>&nbsp;<span class="op" id="3802166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802169">if</span>&nbsp;<span class="builtinfunc" id="3802172">len</span><span class="op" id="3802175">(</span><span class="ident" id="3802176">x</span><span class="op" id="3802177">.</span><span class="ident" id="3802178">a</span><span class="op" id="3802179">.</span><span class="ident" id="3802180">abs</span><span class="op" id="3802183">)</span>&nbsp;<span class="op" id="3802185">==</span>&nbsp;<span class="num" id="3802188">0</span>&nbsp;<span class="op" id="3802190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3802194">panic</span><span class="op" id="3802199">(</span><span class="string" id="3802200">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3802218">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802224">z</span><span class="op" id="3802225">.</span><span class="ident" id="3802226">Set</span><span class="op" id="3802229">(</span><span class="ident" id="3802230">x</span><span class="op" id="3802231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802234">a</span>&nbsp;<span class="op" id="3802236">:=</span>&nbsp;<span class="ident" id="3802239">z</span><span class="op" id="3802240">.</span><span class="ident" id="3802241">b</span><span class="op" id="3802242">.</span><span class="ident" id="3802243">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802248">if</span>&nbsp;<span class="builtinfunc" id="3802251">len</span><span class="op" id="3802254">(</span><span class="ident" id="3802255">a</span><span class="op" id="3802256">)</span>&nbsp;<span class="op" id="3802258">==</span>&nbsp;<span class="num" id="3802261">0</span>&nbsp;<span class="op" id="3802263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802267">a</span>&nbsp;<span class="op" id="3802269">=</span>&nbsp;<span class="ident" id="3802271">a</span><span class="op" id="3802272">.</span><span class="ident" id="3802273">set</span><span class="op" id="3802276">(</span><span class="ident" id="3802277">natOne</span><span class="op" id="3802283">)</span>&nbsp;<span class="comment" id="3802285">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802314">b</span>&nbsp;<span class="op" id="3802316">:=</span>&nbsp;<span class="ident" id="3802319">z</span><span class="op" id="3802320">.</span><span class="ident" id="3802321">a</span><span class="op" id="3802322">.</span><span class="ident" id="3802323">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802328">if</span>&nbsp;<span class="ident" id="3802331">b</span><span class="op" id="3802332">.</span><span class="ident" id="3802333">cmp</span><span class="op" id="3802336">(</span><span class="ident" id="3802337">natOne</span><span class="op" id="3802343">)</span>&nbsp;<span class="op" id="3802345">==</span>&nbsp;<span class="num" id="3802348">0</span>&nbsp;<span class="op" id="3802350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802354">b</span>&nbsp;<span class="op" id="3802356">=</span>&nbsp;<span class="ident" id="3802358">b</span><span class="op" id="3802359">.</span><span class="builtinfunc" id="3802360">make</span><span class="op" id="3802364">(</span><span class="num" id="3802365">0</span><span class="op" id="3802366">)</span>&nbsp;<span class="comment" id="3802368">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802394">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802397">z</span><span class="op" id="3802398">.</span><span class="ident" id="3802399">a</span><span class="op" id="3802400">.</span><span class="ident" id="3802401">abs</span><span class="op" id="3802404">,</span>&nbsp;<span class="ident" id="3802406">z</span><span class="op" id="3802407">.</span><span class="ident" id="3802408">b</span><span class="op" id="3802409">.</span><span class="ident" id="3802410">abs</span>&nbsp;<span class="op" id="3802414">=</span>&nbsp;<span class="ident" id="3802416">a</span><span class="op" id="3802417">,</span>&nbsp;<span class="ident" id="3802419">b</span>&nbsp;<span class="comment" id="3802421">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802445">return</span>&nbsp;<span class="ident" id="3802452">z</span><br>
<span class="lineno"></span><span class="op" id="3802454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802457">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3802474">//</span><br>
<span class="lineno"></span><span class="comment" id="3802477">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3802493">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3802509">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3802525">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3802528">func</span>&nbsp;<span class="op" id="3802533">(</span><span class="ident" id="3802534">x</span>&nbsp;<span class="op" id="3802536">*</span><span class="ident" id="3802537">Rat</span><span class="op" id="3802540">)</span>&nbsp;<span class="ident" id="3802542">Sign</span><span class="op" id="3802546">(</span><span class="op" id="3802547">)</span>&nbsp;<span class="builtintype" id="3802549">int</span>&nbsp;<span class="op" id="3802553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802556">return</span>&nbsp;<span class="ident" id="3802563">x</span><span class="op" id="3802564">.</span><span class="ident" id="3802565">a</span><span class="op" id="3802566">.</span><span class="ident" id="3802567">Sign</span><span class="op" id="3802571">(</span><span class="op" id="3802572">)</span><br>
<span class="lineno"></span><span class="op" id="3802574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802577">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3802629">func</span>&nbsp;<span class="op" id="3802634">(</span><span class="ident" id="3802635">x</span>&nbsp;<span class="op" id="3802637">*</span><span class="ident" id="3802638">Rat</span><span class="op" id="3802641">)</span>&nbsp;<span class="ident" id="3802643">IsInt</span><span class="op" id="3802648">(</span><span class="op" id="3802649">)</span>&nbsp;<span class="builtintype" id="3802651">bool</span>&nbsp;<span class="op" id="3802656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802659">return</span>&nbsp;<span class="builtinfunc" id="3802666">len</span><span class="op" id="3802669">(</span><span class="ident" id="3802670">x</span><span class="op" id="3802671">.</span><span class="ident" id="3802672">b</span><span class="op" id="3802673">.</span><span class="ident" id="3802674">abs</span><span class="op" id="3802677">)</span>&nbsp;<span class="op" id="3802679">==</span>&nbsp;<span class="num" id="3802682">0</span>&nbsp;<span class="op" id="3802684">||</span>&nbsp;<span class="ident" id="3802687">x</span><span class="op" id="3802688">.</span><span class="ident" id="3802689">b</span><span class="op" id="3802690">.</span><span class="ident" id="3802691">abs</span><span class="op" id="3802694">.</span><span class="ident" id="3802695">cmp</span><span class="op" id="3802698">(</span><span class="ident" id="3802699">natOne</span><span class="op" id="3802705">)</span>&nbsp;<span class="op" id="3802707">==</span>&nbsp;<span class="num" id="3802710">0</span><br>
<span class="lineno"></span><span class="op" id="3802712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802715">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3802766">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3802816">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3802879">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3802938">func</span>&nbsp;<span class="op" id="3802943">(</span><span class="ident" id="3802944">x</span>&nbsp;<span class="op" id="3802946">*</span><span class="ident" id="3802947">Rat</span><span class="op" id="3802950">)</span>&nbsp;<span class="ident" id="3802952">Num</span><span class="op" id="3802955">(</span><span class="op" id="3802956">)</span>&nbsp;<span class="op" id="3802958">*</span><span class="ident" id="3802959">Int</span>&nbsp;<span class="op" id="3802963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802966">return</span>&nbsp;<span class="op" id="3802973">&amp;</span><span class="ident" id="3802974">x</span><span class="op" id="3802975">.</span><span class="ident" id="3802976">a</span><br>
<span class="lineno">400</span><span class="op" id="3802978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802981">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3803038">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3803090">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3803153">func</span>&nbsp;<span class="op" id="3803158">(</span><span class="ident" id="3803159">x</span>&nbsp;<span class="op" id="3803161">*</span><span class="ident" id="3803162">Rat</span><span class="op" id="3803165">)</span>&nbsp;<span class="ident" id="3803167">Denom</span><span class="op" id="3803172">(</span><span class="op" id="3803173">)</span>&nbsp;<span class="op" id="3803175">*</span><span class="ident" id="3803176">Int</span>&nbsp;<span class="op" id="3803180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803183">x</span><span class="op" id="3803184">.</span><span class="ident" id="3803185">b</span><span class="op" id="3803186">.</span><span class="ident" id="3803187">neg</span>&nbsp;<span class="op" id="3803191">=</span>&nbsp;<span class="builtintype" id="3803193">false</span>&nbsp;<span class="comment" id="3803199">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803229">if</span>&nbsp;<span class="builtinfunc" id="3803232">len</span><span class="op" id="3803235">(</span><span class="ident" id="3803236">x</span><span class="op" id="3803237">.</span><span class="ident" id="3803238">b</span><span class="op" id="3803239">.</span><span class="ident" id="3803240">abs</span><span class="op" id="3803243">)</span>&nbsp;<span class="op" id="3803245">==</span>&nbsp;<span class="num" id="3803248">0</span>&nbsp;<span class="op" id="3803250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803254">x</span><span class="op" id="3803255">.</span><span class="ident" id="3803256">b</span><span class="op" id="3803257">.</span><span class="ident" id="3803258">abs</span>&nbsp;<span class="op" id="3803262">=</span>&nbsp;<span class="ident" id="3803264">x</span><span class="op" id="3803265">.</span><span class="ident" id="3803266">b</span><span class="op" id="3803267">.</span><span class="ident" id="3803268">abs</span><span class="op" id="3803271">.</span><span class="ident" id="3803272">set</span><span class="op" id="3803275">(</span><span class="ident" id="3803276">natOne</span><span class="op" id="3803282">)</span>&nbsp;<span class="comment" id="3803284">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803312">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803315">return</span>&nbsp;<span class="op" id="3803322">&amp;</span><span class="ident" id="3803323">x</span><span class="op" id="3803324">.</span><span class="ident" id="3803325">b</span><br>
<span class="lineno"></span><span class="op" id="3803327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803330">func</span>&nbsp;<span class="op" id="3803335">(</span><span class="ident" id="3803336">z</span>&nbsp;<span class="op" id="3803338">*</span><span class="ident" id="3803339">Rat</span><span class="op" id="3803342">)</span>&nbsp;<span class="ident" id="3803344">norm</span><span class="op" id="3803348">(</span><span class="op" id="3803349">)</span>&nbsp;<span class="op" id="3803351">*</span><span class="ident" id="3803352">Rat</span>&nbsp;<span class="op" id="3803356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803359">switch</span>&nbsp;<span class="op" id="3803366">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803369">case</span>&nbsp;<span class="builtinfunc" id="3803374">len</span><span class="op" id="3803377">(</span><span class="ident" id="3803378">z</span><span class="op" id="3803379">.</span><span class="ident" id="3803380">a</span><span class="op" id="3803381">.</span><span class="ident" id="3803382">abs</span><span class="op" id="3803385">)</span>&nbsp;<span class="op" id="3803387">==</span>&nbsp;<span class="num" id="3803390">0</span><span class="op" id="3803391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3803395">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803440">z</span><span class="op" id="3803441">.</span><span class="ident" id="3803442">a</span><span class="op" id="3803443">.</span><span class="ident" id="3803444">neg</span>&nbsp;<span class="op" id="3803448">=</span>&nbsp;<span class="builtintype" id="3803450">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803458">z</span><span class="op" id="3803459">.</span><span class="ident" id="3803460">b</span><span class="op" id="3803461">.</span><span class="ident" id="3803462">abs</span>&nbsp;<span class="op" id="3803466">=</span>&nbsp;<span class="ident" id="3803468">z</span><span class="op" id="3803469">.</span><span class="ident" id="3803470">b</span><span class="op" id="3803471">.</span><span class="ident" id="3803472">abs</span><span class="op" id="3803475">.</span><span class="builtinfunc" id="3803476">make</span><span class="op" id="3803480">(</span><span class="num" id="3803481">0</span><span class="op" id="3803482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803485">case</span>&nbsp;<span class="builtinfunc" id="3803490">len</span><span class="op" id="3803493">(</span><span class="ident" id="3803494">z</span><span class="op" id="3803495">.</span><span class="ident" id="3803496">b</span><span class="op" id="3803497">.</span><span class="ident" id="3803498">abs</span><span class="op" id="3803501">)</span>&nbsp;<span class="op" id="3803503">==</span>&nbsp;<span class="num" id="3803506">0</span><span class="op" id="3803507">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3803511">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803551">case</span>&nbsp;<span class="ident" id="3803556">z</span><span class="op" id="3803557">.</span><span class="ident" id="3803558">b</span><span class="op" id="3803559">.</span><span class="ident" id="3803560">abs</span><span class="op" id="3803563">.</span><span class="ident" id="3803564">cmp</span><span class="op" id="3803567">(</span><span class="ident" id="3803568">natOne</span><span class="op" id="3803574">)</span>&nbsp;<span class="op" id="3803576">==</span>&nbsp;<span class="num" id="3803579">0</span><span class="op" id="3803580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3803584">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803622">z</span><span class="op" id="3803623">.</span><span class="ident" id="3803624">b</span><span class="op" id="3803625">.</span><span class="ident" id="3803626">abs</span>&nbsp;<span class="op" id="3803630">=</span>&nbsp;<span class="ident" id="3803632">z</span><span class="op" id="3803633">.</span><span class="ident" id="3803634">b</span><span class="op" id="3803635">.</span><span class="ident" id="3803636">abs</span><span class="op" id="3803639">.</span><span class="builtinfunc" id="3803640">make</span><span class="op" id="3803644">(</span><span class="num" id="3803645">0</span><span class="op" id="3803646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803649">default</span><span class="op" id="3803656">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803660">neg</span>&nbsp;<span class="op" id="3803664">:=</span>&nbsp;<span class="ident" id="3803667">z</span><span class="op" id="3803668">.</span><span class="ident" id="3803669">a</span><span class="op" id="3803670">.</span><span class="ident" id="3803671">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803677">z</span><span class="op" id="3803678">.</span><span class="ident" id="3803679">a</span><span class="op" id="3803680">.</span><span class="ident" id="3803681">neg</span>&nbsp;<span class="op" id="3803685">=</span>&nbsp;<span class="builtintype" id="3803687">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803695">z</span><span class="op" id="3803696">.</span><span class="ident" id="3803697">b</span><span class="op" id="3803698">.</span><span class="ident" id="3803699">neg</span>&nbsp;<span class="op" id="3803703">=</span>&nbsp;<span class="builtintype" id="3803705">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803713">if</span>&nbsp;<span class="ident" id="3803716">f</span>&nbsp;<span class="op" id="3803718">:=</span>&nbsp;<span class="ident" id="3803721">NewInt</span><span class="op" id="3803727">(</span><span class="num" id="3803728">0</span><span class="op" id="3803729">)</span><span class="op" id="3803730">.</span><span class="ident" id="3803731">binaryGCD</span><span class="op" id="3803740">(</span><span class="op" id="3803741">&amp;</span><span class="ident" id="3803742">z</span><span class="op" id="3803743">.</span><span class="ident" id="3803744">a</span><span class="op" id="3803745">,</span>&nbsp;<span class="op" id="3803747">&amp;</span><span class="ident" id="3803748">z</span><span class="op" id="3803749">.</span><span class="ident" id="3803750">b</span><span class="op" id="3803751">)</span><span class="op" id="3803752">;</span>&nbsp;<span class="ident" id="3803754">f</span><span class="op" id="3803755">.</span><span class="ident" id="3803756">Cmp</span><span class="op" id="3803759">(</span><span class="ident" id="3803760">intOne</span><span class="op" id="3803766">)</span>&nbsp;<span class="op" id="3803768">!=</span>&nbsp;<span class="num" id="3803771">0</span>&nbsp;<span class="op" id="3803773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803778">z</span><span class="op" id="3803779">.</span><span class="ident" id="3803780">a</span><span class="op" id="3803781">.</span><span class="ident" id="3803782">abs</span><span class="op" id="3803785">,</span>&nbsp;<span class="ident" id="3803787">_</span>&nbsp;<span class="op" id="3803789">=</span>&nbsp;<span class="ident" id="3803791">z</span><span class="op" id="3803792">.</span><span class="ident" id="3803793">a</span><span class="op" id="3803794">.</span><span class="ident" id="3803795">abs</span><span class="op" id="3803798">.</span><span class="ident" id="3803799">div</span><span class="op" id="3803802">(</span><span class="ident" id="3803803">nil</span><span class="op" id="3803806">,</span>&nbsp;<span class="ident" id="3803808">z</span><span class="op" id="3803809">.</span><span class="ident" id="3803810">a</span><span class="op" id="3803811">.</span><span class="ident" id="3803812">abs</span><span class="op" id="3803815">,</span>&nbsp;<span class="ident" id="3803817">f</span><span class="op" id="3803818">.</span><span class="ident" id="3803819">abs</span><span class="op" id="3803822">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803827">z</span><span class="op" id="3803828">.</span><span class="ident" id="3803829">b</span><span class="op" id="3803830">.</span><span class="ident" id="3803831">abs</span><span class="op" id="3803834">,</span>&nbsp;<span class="ident" id="3803836">_</span>&nbsp;<span class="op" id="3803838">=</span>&nbsp;<span class="ident" id="3803840">z</span><span class="op" id="3803841">.</span><span class="ident" id="3803842">b</span><span class="op" id="3803843">.</span><span class="ident" id="3803844">abs</span><span class="op" id="3803847">.</span><span class="ident" id="3803848">div</span><span class="op" id="3803851">(</span><span class="ident" id="3803852">nil</span><span class="op" id="3803855">,</span>&nbsp;<span class="ident" id="3803857">z</span><span class="op" id="3803858">.</span><span class="ident" id="3803859">b</span><span class="op" id="3803860">.</span><span class="ident" id="3803861">abs</span><span class="op" id="3803864">,</span>&nbsp;<span class="ident" id="3803866">f</span><span class="op" id="3803867">.</span><span class="ident" id="3803868">abs</span><span class="op" id="3803871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803876">if</span>&nbsp;<span class="ident" id="3803879">z</span><span class="op" id="3803880">.</span><span class="ident" id="3803881">b</span><span class="op" id="3803882">.</span><span class="ident" id="3803883">abs</span><span class="op" id="3803886">.</span><span class="ident" id="3803887">cmp</span><span class="op" id="3803890">(</span><span class="ident" id="3803891">natOne</span><span class="op" id="3803897">)</span>&nbsp;<span class="op" id="3803899">==</span>&nbsp;<span class="num" id="3803902">0</span>&nbsp;<span class="op" id="3803904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3803910">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803950">z</span><span class="op" id="3803951">.</span><span class="ident" id="3803952">b</span><span class="op" id="3803953">.</span><span class="ident" id="3803954">abs</span>&nbsp;<span class="op" id="3803958">=</span>&nbsp;<span class="ident" id="3803960">z</span><span class="op" id="3803961">.</span><span class="ident" id="3803962">b</span><span class="op" id="3803963">.</span><span class="ident" id="3803964">abs</span><span class="op" id="3803967">.</span><span class="builtinfunc" id="3803968">make</span><span class="op" id="3803972">(</span><span class="num" id="3803973">0</span><span class="op" id="3803974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803979">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803987">z</span><span class="op" id="3803988">.</span><span class="ident" id="3803989">a</span><span class="op" id="3803990">.</span><span class="ident" id="3803991">neg</span>&nbsp;<span class="op" id="3803995">=</span>&nbsp;<span class="ident" id="3803997">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804005">return</span>&nbsp;<span class="ident" id="3804012">z</span><br>
<span class="lineno"></span><span class="op" id="3804014">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3804017">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3804083">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3804149">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3804163">func</span>&nbsp;<span class="ident" id="3804168">mulDenom</span><span class="op" id="3804176">(</span><span class="ident" id="3804177">z</span><span class="op" id="3804178">,</span>&nbsp;<span class="ident" id="3804180">x</span><span class="op" id="3804181">,</span>&nbsp;<span class="ident" id="3804183">y</span>&nbsp;<span class="ident" id="3804185">nat</span><span class="op" id="3804188">)</span>&nbsp;<span class="ident" id="3804190">nat</span>&nbsp;<span class="op" id="3804194">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804197">switch</span>&nbsp;<span class="op" id="3804204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804207">case</span>&nbsp;<span class="builtinfunc" id="3804212">len</span><span class="op" id="3804215">(</span><span class="ident" id="3804216">x</span><span class="op" id="3804217">)</span>&nbsp;<span class="op" id="3804219">==</span>&nbsp;<span class="num" id="3804222">0</span><span class="op" id="3804223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804227">return</span>&nbsp;<span class="ident" id="3804234">z</span><span class="op" id="3804235">.</span><span class="ident" id="3804236">set</span><span class="op" id="3804239">(</span><span class="ident" id="3804240">y</span><span class="op" id="3804241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804244">case</span>&nbsp;<span class="builtinfunc" id="3804249">len</span><span class="op" id="3804252">(</span><span class="ident" id="3804253">y</span><span class="op" id="3804254">)</span>&nbsp;<span class="op" id="3804256">==</span>&nbsp;<span class="num" id="3804259">0</span><span class="op" id="3804260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804264">return</span>&nbsp;<span class="ident" id="3804271">z</span><span class="op" id="3804272">.</span><span class="ident" id="3804273">set</span><span class="op" id="3804276">(</span><span class="ident" id="3804277">x</span><span class="op" id="3804278">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804284">return</span>&nbsp;<span class="ident" id="3804291">z</span><span class="op" id="3804292">.</span><span class="ident" id="3804293">mul</span><span class="op" id="3804296">(</span><span class="ident" id="3804297">x</span><span class="op" id="3804298">,</span>&nbsp;<span class="ident" id="3804300">y</span><span class="op" id="3804301">)</span><br>
<span class="lineno"></span><span class="op" id="3804303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3804306">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3804334">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3804405">func</span>&nbsp;<span class="ident" id="3804410">scaleDenom</span><span class="op" id="3804420">(</span><span class="ident" id="3804421">x</span>&nbsp;<span class="op" id="3804423">*</span><span class="ident" id="3804424">Int</span><span class="op" id="3804427">,</span>&nbsp;<span class="ident" id="3804429">f</span>&nbsp;<span class="ident" id="3804431">nat</span><span class="op" id="3804434">)</span>&nbsp;<span class="op" id="3804436">*</span><span class="ident" id="3804437">Int</span>&nbsp;<span class="op" id="3804441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804444">var</span>&nbsp;<span class="ident" id="3804448">z</span>&nbsp;<span class="ident" id="3804450">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804455">if</span>&nbsp;<span class="builtinfunc" id="3804458">len</span><span class="op" id="3804461">(</span><span class="ident" id="3804462">f</span><span class="op" id="3804463">)</span>&nbsp;<span class="op" id="3804465">==</span>&nbsp;<span class="num" id="3804468">0</span>&nbsp;<span class="op" id="3804470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804474">return</span>&nbsp;<span class="ident" id="3804481">z</span><span class="op" id="3804482">.</span><span class="ident" id="3804483">Set</span><span class="op" id="3804486">(</span><span class="ident" id="3804487">x</span><span class="op" id="3804488">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804494">z</span><span class="op" id="3804495">.</span><span class="ident" id="3804496">abs</span>&nbsp;<span class="op" id="3804500">=</span>&nbsp;<span class="ident" id="3804502">z</span><span class="op" id="3804503">.</span><span class="ident" id="3804504">abs</span><span class="op" id="3804507">.</span><span class="ident" id="3804508">mul</span><span class="op" id="3804511">(</span><span class="ident" id="3804512">x</span><span class="op" id="3804513">.</span><span class="ident" id="3804514">abs</span><span class="op" id="3804517">,</span>&nbsp;<span class="ident" id="3804519">f</span><span class="op" id="3804520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804523">z</span><span class="op" id="3804524">.</span><span class="ident" id="3804525">neg</span>&nbsp;<span class="op" id="3804529">=</span>&nbsp;<span class="ident" id="3804531">x</span><span class="op" id="3804532">.</span><span class="ident" id="3804533">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804538">return</span>&nbsp;<span class="op" id="3804545">&amp;</span><span class="ident" id="3804546">z</span><br>
<span class="lineno"></span><span class="op" id="3804548">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3804551">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3804588">//</span><br>
<span class="lineno"></span><span class="comment" id="3804591">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3804609">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3804627">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3804645">//</span><br>
<span class="lineno"></span><span class="keyword" id="3804648">func</span>&nbsp;<span class="op" id="3804653">(</span><span class="ident" id="3804654">x</span>&nbsp;<span class="op" id="3804656">*</span><span class="ident" id="3804657">Rat</span><span class="op" id="3804660">)</span>&nbsp;<span class="ident" id="3804662">Cmp</span><span class="op" id="3804665">(</span><span class="ident" id="3804666">y</span>&nbsp;<span class="op" id="3804668">*</span><span class="ident" id="3804669">Rat</span><span class="op" id="3804672">)</span>&nbsp;<span class="builtintype" id="3804674">int</span>&nbsp;<span class="op" id="3804678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804681">return</span>&nbsp;<span class="ident" id="3804688">scaleDenom</span><span class="op" id="3804698">(</span><span class="op" id="3804699">&amp;</span><span class="ident" id="3804700">x</span><span class="op" id="3804701">.</span><span class="ident" id="3804702">a</span><span class="op" id="3804703">,</span>&nbsp;<span class="ident" id="3804705">y</span><span class="op" id="3804706">.</span><span class="ident" id="3804707">b</span><span class="op" id="3804708">.</span><span class="ident" id="3804709">abs</span><span class="op" id="3804712">)</span><span class="op" id="3804713">.</span><span class="ident" id="3804714">Cmp</span><span class="op" id="3804717">(</span><span class="ident" id="3804718">scaleDenom</span><span class="op" id="3804728">(</span><span class="op" id="3804729">&amp;</span><span class="ident" id="3804730">y</span><span class="op" id="3804731">.</span><span class="ident" id="3804732">a</span><span class="op" id="3804733">,</span>&nbsp;<span class="ident" id="3804735">x</span><span class="op" id="3804736">.</span><span class="ident" id="3804737">b</span><span class="op" id="3804738">.</span><span class="ident" id="3804739">abs</span><span class="op" id="3804742">)</span><span class="op" id="3804743">)</span><br>
<span class="lineno"></span><span class="op" id="3804745">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3804748">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3804792">func</span>&nbsp;<span class="op" id="3804797">(</span><span class="ident" id="3804798">z</span>&nbsp;<span class="op" id="3804800">*</span><span class="ident" id="3804801">Rat</span><span class="op" id="3804804">)</span>&nbsp;<span class="ident" id="3804806">Add</span><span class="op" id="3804809">(</span><span class="ident" id="3804810">x</span><span class="op" id="3804811">,</span>&nbsp;<span class="ident" id="3804813">y</span>&nbsp;<span class="op" id="3804815">*</span><span class="ident" id="3804816">Rat</span><span class="op" id="3804819">)</span>&nbsp;<span class="op" id="3804821">*</span><span class="ident" id="3804822">Rat</span>&nbsp;<span class="op" id="3804826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804829">a1</span>&nbsp;<span class="op" id="3804832">:=</span>&nbsp;<span class="ident" id="3804835">scaleDenom</span><span class="op" id="3804845">(</span><span class="op" id="3804846">&amp;</span><span class="ident" id="3804847">x</span><span class="op" id="3804848">.</span><span class="ident" id="3804849">a</span><span class="op" id="3804850">,</span>&nbsp;<span class="ident" id="3804852">y</span><span class="op" id="3804853">.</span><span class="ident" id="3804854">b</span><span class="op" id="3804855">.</span><span class="ident" id="3804856">abs</span><span class="op" id="3804859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804862">a2</span>&nbsp;<span class="op" id="3804865">:=</span>&nbsp;<span class="ident" id="3804868">scaleDenom</span><span class="op" id="3804878">(</span><span class="op" id="3804879">&amp;</span><span class="ident" id="3804880">y</span><span class="op" id="3804881">.</span><span class="ident" id="3804882">a</span><span class="op" id="3804883">,</span>&nbsp;<span class="ident" id="3804885">x</span><span class="op" id="3804886">.</span><span class="ident" id="3804887">b</span><span class="op" id="3804888">.</span><span class="ident" id="3804889">abs</span><span class="op" id="3804892">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804895">z</span><span class="op" id="3804896">.</span><span class="ident" id="3804897">a</span><span class="op" id="3804898">.</span><span class="ident" id="3804899">Add</span><span class="op" id="3804902">(</span><span class="ident" id="3804903">a1</span><span class="op" id="3804905">,</span>&nbsp;<span class="ident" id="3804907">a2</span><span class="op" id="3804909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804912">z</span><span class="op" id="3804913">.</span><span class="ident" id="3804914">b</span><span class="op" id="3804915">.</span><span class="ident" id="3804916">abs</span>&nbsp;<span class="op" id="3804920">=</span>&nbsp;<span class="ident" id="3804922">mulDenom</span><span class="op" id="3804930">(</span><span class="ident" id="3804931">z</span><span class="op" id="3804932">.</span><span class="ident" id="3804933">b</span><span class="op" id="3804934">.</span><span class="ident" id="3804935">abs</span><span class="op" id="3804938">,</span>&nbsp;<span class="ident" id="3804940">x</span><span class="op" id="3804941">.</span><span class="ident" id="3804942">b</span><span class="op" id="3804943">.</span><span class="ident" id="3804944">abs</span><span class="op" id="3804947">,</span>&nbsp;<span class="ident" id="3804949">y</span><span class="op" id="3804950">.</span><span class="ident" id="3804951">b</span><span class="op" id="3804952">.</span><span class="ident" id="3804953">abs</span><span class="op" id="3804956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804959">return</span>&nbsp;<span class="ident" id="3804966">z</span><span class="op" id="3804967">.</span><span class="ident" id="3804968">norm</span><span class="op" id="3804972">(</span><span class="op" id="3804973">)</span><br>
<span class="lineno"></span><span class="op" id="3804975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3804978">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3805029">func</span>&nbsp;<span class="op" id="3805034">(</span><span class="ident" id="3805035">z</span>&nbsp;<span class="op" id="3805037">*</span><span class="ident" id="3805038">Rat</span><span class="op" id="3805041">)</span>&nbsp;<span class="ident" id="3805043">Sub</span><span class="op" id="3805046">(</span><span class="ident" id="3805047">x</span><span class="op" id="3805048">,</span>&nbsp;<span class="ident" id="3805050">y</span>&nbsp;<span class="op" id="3805052">*</span><span class="ident" id="3805053">Rat</span><span class="op" id="3805056">)</span>&nbsp;<span class="op" id="3805058">*</span><span class="ident" id="3805059">Rat</span>&nbsp;<span class="op" id="3805063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805066">a1</span>&nbsp;<span class="op" id="3805069">:=</span>&nbsp;<span class="ident" id="3805072">scaleDenom</span><span class="op" id="3805082">(</span><span class="op" id="3805083">&amp;</span><span class="ident" id="3805084">x</span><span class="op" id="3805085">.</span><span class="ident" id="3805086">a</span><span class="op" id="3805087">,</span>&nbsp;<span class="ident" id="3805089">y</span><span class="op" id="3805090">.</span><span class="ident" id="3805091">b</span><span class="op" id="3805092">.</span><span class="ident" id="3805093">abs</span><span class="op" id="3805096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805099">a2</span>&nbsp;<span class="op" id="3805102">:=</span>&nbsp;<span class="ident" id="3805105">scaleDenom</span><span class="op" id="3805115">(</span><span class="op" id="3805116">&amp;</span><span class="ident" id="3805117">y</span><span class="op" id="3805118">.</span><span class="ident" id="3805119">a</span><span class="op" id="3805120">,</span>&nbsp;<span class="ident" id="3805122">x</span><span class="op" id="3805123">.</span><span class="ident" id="3805124">b</span><span class="op" id="3805125">.</span><span class="ident" id="3805126">abs</span><span class="op" id="3805129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805132">z</span><span class="op" id="3805133">.</span><span class="ident" id="3805134">a</span><span class="op" id="3805135">.</span><span class="ident" id="3805136">Sub</span><span class="op" id="3805139">(</span><span class="ident" id="3805140">a1</span><span class="op" id="3805142">,</span>&nbsp;<span class="ident" id="3805144">a2</span><span class="op" id="3805146">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805149">z</span><span class="op" id="3805150">.</span><span class="ident" id="3805151">b</span><span class="op" id="3805152">.</span><span class="ident" id="3805153">abs</span>&nbsp;<span class="op" id="3805157">=</span>&nbsp;<span class="ident" id="3805159">mulDenom</span><span class="op" id="3805167">(</span><span class="ident" id="3805168">z</span><span class="op" id="3805169">.</span><span class="ident" id="3805170">b</span><span class="op" id="3805171">.</span><span class="ident" id="3805172">abs</span><span class="op" id="3805175">,</span>&nbsp;<span class="ident" id="3805177">x</span><span class="op" id="3805178">.</span><span class="ident" id="3805179">b</span><span class="op" id="3805180">.</span><span class="ident" id="3805181">abs</span><span class="op" id="3805184">,</span>&nbsp;<span class="ident" id="3805186">y</span><span class="op" id="3805187">.</span><span class="ident" id="3805188">b</span><span class="op" id="3805189">.</span><span class="ident" id="3805190">abs</span><span class="op" id="3805193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805196">return</span>&nbsp;<span class="ident" id="3805203">z</span><span class="op" id="3805204">.</span><span class="ident" id="3805205">norm</span><span class="op" id="3805209">(</span><span class="op" id="3805210">)</span><br>
<span class="lineno"></span><span class="op" id="3805212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3805215">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3805263">func</span>&nbsp;<span class="op" id="3805268">(</span><span class="ident" id="3805269">z</span>&nbsp;<span class="op" id="3805271">*</span><span class="ident" id="3805272">Rat</span><span class="op" id="3805275">)</span>&nbsp;<span class="ident" id="3805277">Mul</span><span class="op" id="3805280">(</span><span class="ident" id="3805281">x</span><span class="op" id="3805282">,</span>&nbsp;<span class="ident" id="3805284">y</span>&nbsp;<span class="op" id="3805286">*</span><span class="ident" id="3805287">Rat</span><span class="op" id="3805290">)</span>&nbsp;<span class="op" id="3805292">*</span><span class="ident" id="3805293">Rat</span>&nbsp;<span class="op" id="3805297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805300">z</span><span class="op" id="3805301">.</span><span class="ident" id="3805302">a</span><span class="op" id="3805303">.</span><span class="ident" id="3805304">Mul</span><span class="op" id="3805307">(</span><span class="op" id="3805308">&amp;</span><span class="ident" id="3805309">x</span><span class="op" id="3805310">.</span><span class="ident" id="3805311">a</span><span class="op" id="3805312">,</span>&nbsp;<span class="op" id="3805314">&amp;</span><span class="ident" id="3805315">y</span><span class="op" id="3805316">.</span><span class="ident" id="3805317">a</span><span class="op" id="3805318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805321">z</span><span class="op" id="3805322">.</span><span class="ident" id="3805323">b</span><span class="op" id="3805324">.</span><span class="ident" id="3805325">abs</span>&nbsp;<span class="op" id="3805329">=</span>&nbsp;<span class="ident" id="3805331">mulDenom</span><span class="op" id="3805339">(</span><span class="ident" id="3805340">z</span><span class="op" id="3805341">.</span><span class="ident" id="3805342">b</span><span class="op" id="3805343">.</span><span class="ident" id="3805344">abs</span><span class="op" id="3805347">,</span>&nbsp;<span class="ident" id="3805349">x</span><span class="op" id="3805350">.</span><span class="ident" id="3805351">b</span><span class="op" id="3805352">.</span><span class="ident" id="3805353">abs</span><span class="op" id="3805356">,</span>&nbsp;<span class="ident" id="3805358">y</span><span class="op" id="3805359">.</span><span class="ident" id="3805360">b</span><span class="op" id="3805361">.</span><span class="ident" id="3805362">abs</span><span class="op" id="3805365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805368">return</span>&nbsp;<span class="ident" id="3805375">z</span><span class="op" id="3805376">.</span><span class="ident" id="3805377">norm</span><span class="op" id="3805381">(</span><span class="op" id="3805382">)</span><br>
<span class="lineno"></span><span class="op" id="3805384">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3805387">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3805436">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3805492">func</span>&nbsp;<span class="op" id="3805497">(</span><span class="ident" id="3805498">z</span>&nbsp;<span class="op" id="3805500">*</span><span class="ident" id="3805501">Rat</span><span class="op" id="3805504">)</span>&nbsp;<span class="ident" id="3805506">Quo</span><span class="op" id="3805509">(</span><span class="ident" id="3805510">x</span><span class="op" id="3805511">,</span>&nbsp;<span class="ident" id="3805513">y</span>&nbsp;<span class="op" id="3805515">*</span><span class="ident" id="3805516">Rat</span><span class="op" id="3805519">)</span>&nbsp;<span class="op" id="3805521">*</span><span class="ident" id="3805522">Rat</span>&nbsp;<span class="op" id="3805526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805529">if</span>&nbsp;<span class="builtinfunc" id="3805532">len</span><span class="op" id="3805535">(</span><span class="ident" id="3805536">y</span><span class="op" id="3805537">.</span><span class="ident" id="3805538">a</span><span class="op" id="3805539">.</span><span class="ident" id="3805540">abs</span><span class="op" id="3805543">)</span>&nbsp;<span class="op" id="3805545">==</span>&nbsp;<span class="num" id="3805548">0</span>&nbsp;<span class="op" id="3805550">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3805554">panic</span><span class="op" id="3805559">(</span><span class="string" id="3805560">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3805578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805584">a</span>&nbsp;<span class="op" id="3805586">:=</span>&nbsp;<span class="ident" id="3805589">scaleDenom</span><span class="op" id="3805599">(</span><span class="op" id="3805600">&amp;</span><span class="ident" id="3805601">x</span><span class="op" id="3805602">.</span><span class="ident" id="3805603">a</span><span class="op" id="3805604">,</span>&nbsp;<span class="ident" id="3805606">y</span><span class="op" id="3805607">.</span><span class="ident" id="3805608">b</span><span class="op" id="3805609">.</span><span class="ident" id="3805610">abs</span><span class="op" id="3805613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805616">b</span>&nbsp;<span class="op" id="3805618">:=</span>&nbsp;<span class="ident" id="3805621">scaleDenom</span><span class="op" id="3805631">(</span><span class="op" id="3805632">&amp;</span><span class="ident" id="3805633">y</span><span class="op" id="3805634">.</span><span class="ident" id="3805635">a</span><span class="op" id="3805636">,</span>&nbsp;<span class="ident" id="3805638">x</span><span class="op" id="3805639">.</span><span class="ident" id="3805640">b</span><span class="op" id="3805641">.</span><span class="ident" id="3805642">abs</span><span class="op" id="3805645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805648">z</span><span class="op" id="3805649">.</span><span class="ident" id="3805650">a</span><span class="op" id="3805651">.</span><span class="ident" id="3805652">abs</span>&nbsp;<span class="op" id="3805656">=</span>&nbsp;<span class="ident" id="3805658">a</span><span class="op" id="3805659">.</span><span class="ident" id="3805660">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805665">z</span><span class="op" id="3805666">.</span><span class="ident" id="3805667">b</span><span class="op" id="3805668">.</span><span class="ident" id="3805669">abs</span>&nbsp;<span class="op" id="3805673">=</span>&nbsp;<span class="ident" id="3805675">b</span><span class="op" id="3805676">.</span><span class="ident" id="3805677">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805682">z</span><span class="op" id="3805683">.</span><span class="ident" id="3805684">a</span><span class="op" id="3805685">.</span><span class="ident" id="3805686">neg</span>&nbsp;<span class="op" id="3805690">=</span>&nbsp;<span class="ident" id="3805692">a</span><span class="op" id="3805693">.</span><span class="ident" id="3805694">neg</span>&nbsp;<span class="op" id="3805698">!=</span>&nbsp;<span class="ident" id="3805701">b</span><span class="op" id="3805702">.</span><span class="ident" id="3805703">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805708">return</span>&nbsp;<span class="ident" id="3805715">z</span><span class="op" id="3805716">.</span><span class="ident" id="3805717">norm</span><span class="op" id="3805721">(</span><span class="op" id="3805722">)</span><br>
<span class="lineno"></span><span class="op" id="3805724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3805727">func</span>&nbsp;<span class="ident" id="3805732">ratTok</span><span class="op" id="3805738">(</span><span class="ident" id="3805739">ch</span>&nbsp;<span class="builtintype" id="3805742">rune</span><span class="op" id="3805746">)</span>&nbsp;<span class="builtintype" id="3805748">bool</span>&nbsp;<span class="op" id="3805753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805756">return</span>&nbsp;<span class="ident" id="3805763">strings</span><span class="op" id="3805770">.</span><span class="ident" id="3805771">IndexRune</span><span class="op" id="3805780">(</span><span class="string" id="3805781">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3805799">,</span>&nbsp;<span class="ident" id="3805801">ch</span><span class="op" id="3805803">)</span>&nbsp;<span class="op" id="3805805">&gt;=</span>&nbsp;<span class="num" id="3805808">0</span><br>
<span class="lineno"></span><span class="op" id="3805810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3805813">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3805882">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3805952">func</span>&nbsp;<span class="op" id="3805957">(</span><span class="ident" id="3805958">z</span>&nbsp;<span class="op" id="3805960">*</span><span class="ident" id="3805961">Rat</span><span class="op" id="3805964">)</span>&nbsp;<span class="ident" id="3805966">Scan</span><span class="op" id="3805970">(</span><span class="ident" id="3805971">s</span>&nbsp;<span class="ident" id="3805973">fmt</span><span class="op" id="3805976">.</span><span class="ident" id="3805977">ScanState</span><span class="op" id="3805986">,</span>&nbsp;<span class="ident" id="3805988">ch</span>&nbsp;<span class="builtintype" id="3805991">rune</span><span class="op" id="3805995">)</span>&nbsp;<span class="builtintype" id="3805997">error</span>&nbsp;<span class="op" id="3806003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806006">tok</span><span class="op" id="3806009">,</span>&nbsp;<span class="ident" id="3806011">err</span>&nbsp;<span class="op" id="3806015">:=</span>&nbsp;<span class="ident" id="3806018">s</span><span class="op" id="3806019">.</span><span class="ident" id="3806020">Token</span><span class="op" id="3806025">(</span><span class="builtintype" id="3806026">true</span><span class="op" id="3806030">,</span>&nbsp;<span class="ident" id="3806032">ratTok</span><span class="op" id="3806038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806041">if</span>&nbsp;<span class="ident" id="3806044">err</span>&nbsp;<span class="op" id="3806048">!=</span>&nbsp;<span class="ident" id="3806051">nil</span>&nbsp;<span class="op" id="3806055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806059">return</span>&nbsp;<span class="ident" id="3806066">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806074">if</span>&nbsp;<span class="ident" id="3806077">strings</span><span class="op" id="3806084">.</span><span class="ident" id="3806085">IndexRune</span><span class="op" id="3806094">(</span><span class="string" id="3806095">&#34;efgEFGv&#34;</span><span class="op" id="3806104">,</span>&nbsp;<span class="ident" id="3806106">ch</span><span class="op" id="3806108">)</span>&nbsp;<span class="op" id="3806110">&lt;</span>&nbsp;<span class="num" id="3806112">0</span>&nbsp;<span class="op" id="3806114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806118">return</span>&nbsp;<span class="ident" id="3806125">errors</span><span class="op" id="3806131">.</span><span class="ident" id="3806132">New</span><span class="op" id="3806135">(</span><span class="string" id="3806136">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3806160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806166">if</span>&nbsp;<span class="ident" id="3806169">_</span><span class="op" id="3806170">,</span>&nbsp;<span class="ident" id="3806172">ok</span>&nbsp;<span class="op" id="3806175">:=</span>&nbsp;<span class="ident" id="3806178">z</span><span class="op" id="3806179">.</span><span class="ident" id="3806180">SetString</span><span class="op" id="3806189">(</span><span class="builtintype" id="3806190">string</span><span class="op" id="3806196">(</span><span class="ident" id="3806197">tok</span><span class="op" id="3806200">)</span><span class="op" id="3806201">)</span><span class="op" id="3806202">;</span>&nbsp;<span class="op" id="3806204">!</span><span class="ident" id="3806205">ok</span>&nbsp;<span class="op" id="3806208">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806212">return</span>&nbsp;<span class="ident" id="3806219">errors</span><span class="op" id="3806225">.</span><span class="ident" id="3806226">New</span><span class="op" id="3806229">(</span><span class="string" id="3806230">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3806256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806262">return</span>&nbsp;<span class="ident" id="3806269">nil</span><br>
<span class="lineno"></span><span class="op" id="3806273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3806276">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3806353">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3806430">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3806507">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3806556">func</span>&nbsp;<span class="op" id="3806561">(</span><span class="ident" id="3806562">z</span>&nbsp;<span class="op" id="3806564">*</span><span class="ident" id="3806565">Rat</span><span class="op" id="3806568">)</span>&nbsp;<span class="ident" id="3806570">SetString</span><span class="op" id="3806579">(</span><span class="ident" id="3806580">s</span>&nbsp;<span class="builtintype" id="3806582">string</span><span class="op" id="3806588">)</span>&nbsp;<span class="op" id="3806590">(</span><span class="op" id="3806591">*</span><span class="ident" id="3806592">Rat</span><span class="op" id="3806595">,</span>&nbsp;<span class="builtintype" id="3806597">bool</span><span class="op" id="3806601">)</span>&nbsp;<span class="op" id="3806603">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806606">if</span>&nbsp;<span class="builtinfunc" id="3806609">len</span><span class="op" id="3806612">(</span><span class="ident" id="3806613">s</span><span class="op" id="3806614">)</span>&nbsp;<span class="op" id="3806616">==</span>&nbsp;<span class="num" id="3806619">0</span>&nbsp;<span class="op" id="3806621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806625">return</span>&nbsp;<span class="ident" id="3806632">nil</span><span class="op" id="3806635">,</span>&nbsp;<span class="builtintype" id="3806637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806648">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806673">sep</span>&nbsp;<span class="op" id="3806677">:=</span>&nbsp;<span class="ident" id="3806680">strings</span><span class="op" id="3806687">.</span><span class="ident" id="3806688">Index</span><span class="op" id="3806693">(</span><span class="ident" id="3806694">s</span><span class="op" id="3806695">,</span>&nbsp;<span class="string" id="3806697">&#34;/&#34;</span><span class="op" id="3806700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806703">if</span>&nbsp;<span class="ident" id="3806706">sep</span>&nbsp;<span class="op" id="3806710">&gt;=</span>&nbsp;<span class="num" id="3806713">0</span>&nbsp;<span class="op" id="3806715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806719">if</span>&nbsp;<span class="ident" id="3806722">_</span><span class="op" id="3806723">,</span>&nbsp;<span class="ident" id="3806725">ok</span>&nbsp;<span class="op" id="3806728">:=</span>&nbsp;<span class="ident" id="3806731">z</span><span class="op" id="3806732">.</span><span class="ident" id="3806733">a</span><span class="op" id="3806734">.</span><span class="ident" id="3806735">SetString</span><span class="op" id="3806744">(</span><span class="ident" id="3806745">s</span><span class="op" id="3806746">[</span><span class="num" id="3806747">0</span><span class="op" id="3806748">:</span><span class="ident" id="3806749">sep</span><span class="op" id="3806752">]</span><span class="op" id="3806753">,</span>&nbsp;<span class="num" id="3806755">10</span><span class="op" id="3806757">)</span><span class="op" id="3806758">;</span>&nbsp;<span class="op" id="3806760">!</span><span class="ident" id="3806761">ok</span>&nbsp;<span class="op" id="3806764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806769">return</span>&nbsp;<span class="ident" id="3806776">nil</span><span class="op" id="3806779">,</span>&nbsp;<span class="builtintype" id="3806781">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806789">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806793">s</span>&nbsp;<span class="op" id="3806795">=</span>&nbsp;<span class="ident" id="3806797">s</span><span class="op" id="3806798">[</span><span class="ident" id="3806799">sep</span><span class="op" id="3806802">+</span><span class="num" id="3806803">1</span><span class="op" id="3806804">:</span><span class="op" id="3806805">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806809">var</span>&nbsp;<span class="ident" id="3806813">err</span>&nbsp;<span class="builtintype" id="3806817">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806825">if</span>&nbsp;<span class="ident" id="3806828">z</span><span class="op" id="3806829">.</span><span class="ident" id="3806830">b</span><span class="op" id="3806831">.</span><span class="ident" id="3806832">abs</span><span class="op" id="3806835">,</span>&nbsp;<span class="ident" id="3806837">_</span><span class="op" id="3806838">,</span>&nbsp;<span class="ident" id="3806840">err</span>&nbsp;<span class="op" id="3806844">=</span>&nbsp;<span class="ident" id="3806846">z</span><span class="op" id="3806847">.</span><span class="ident" id="3806848">b</span><span class="op" id="3806849">.</span><span class="ident" id="3806850">abs</span><span class="op" id="3806853">.</span><span class="ident" id="3806854">scan</span><span class="op" id="3806858">(</span><span class="ident" id="3806859">strings</span><span class="op" id="3806866">.</span><span class="ident" id="3806867">NewReader</span><span class="op" id="3806876">(</span><span class="ident" id="3806877">s</span><span class="op" id="3806878">)</span><span class="op" id="3806879">,</span>&nbsp;<span class="num" id="3806881">10</span><span class="op" id="3806883">)</span><span class="op" id="3806884">;</span>&nbsp;<span class="ident" id="3806886">err</span>&nbsp;<span class="op" id="3806890">!=</span>&nbsp;<span class="ident" id="3806893">nil</span>&nbsp;<span class="op" id="3806897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806902">return</span>&nbsp;<span class="ident" id="3806909">nil</span><span class="op" id="3806912">,</span>&nbsp;<span class="builtintype" id="3806914">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806922">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806926">if</span>&nbsp;<span class="builtinfunc" id="3806929">len</span><span class="op" id="3806932">(</span><span class="ident" id="3806933">z</span><span class="op" id="3806934">.</span><span class="ident" id="3806935">b</span><span class="op" id="3806936">.</span><span class="ident" id="3806937">abs</span><span class="op" id="3806940">)</span>&nbsp;<span class="op" id="3806942">==</span>&nbsp;<span class="num" id="3806945">0</span>&nbsp;<span class="op" id="3806947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806952">return</span>&nbsp;<span class="ident" id="3806959">nil</span><span class="op" id="3806962">,</span>&nbsp;<span class="builtintype" id="3806964">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806976">return</span>&nbsp;<span class="ident" id="3806983">z</span><span class="op" id="3806984">.</span><span class="ident" id="3806985">norm</span><span class="op" id="3806989">(</span><span class="op" id="3806990">)</span><span class="op" id="3806991">,</span>&nbsp;<span class="builtintype" id="3806993">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806999">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3807003">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807033">sep</span>&nbsp;<span class="op" id="3807037">=</span>&nbsp;<span class="ident" id="3807039">strings</span><span class="op" id="3807046">.</span><span class="ident" id="3807047">Index</span><span class="op" id="3807052">(</span><span class="ident" id="3807053">s</span><span class="op" id="3807054">,</span>&nbsp;<span class="string" id="3807056">&#34;.&#34;</span><span class="op" id="3807059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3807062">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807088">e</span>&nbsp;<span class="op" id="3807090">:=</span>&nbsp;<span class="ident" id="3807093">strings</span><span class="op" id="3807100">.</span><span class="ident" id="3807101">IndexAny</span><span class="op" id="3807109">(</span><span class="ident" id="3807110">s</span><span class="op" id="3807111">,</span>&nbsp;<span class="string" id="3807113">&#34;eE&#34;</span><span class="op" id="3807117">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807120">var</span>&nbsp;<span class="ident" id="3807124">exp</span>&nbsp;<span class="ident" id="3807128">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807133">if</span>&nbsp;<span class="ident" id="3807136">e</span>&nbsp;<span class="op" id="3807138">&gt;=</span>&nbsp;<span class="num" id="3807141">0</span>&nbsp;<span class="op" id="3807143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807147">if</span>&nbsp;<span class="ident" id="3807150">e</span>&nbsp;<span class="op" id="3807152">&lt;</span>&nbsp;<span class="ident" id="3807154">sep</span>&nbsp;<span class="op" id="3807158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3807163">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807210">return</span>&nbsp;<span class="ident" id="3807217">nil</span><span class="op" id="3807220">,</span>&nbsp;<span class="builtintype" id="3807222">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807234">if</span>&nbsp;<span class="ident" id="3807237">_</span><span class="op" id="3807238">,</span>&nbsp;<span class="ident" id="3807240">ok</span>&nbsp;<span class="op" id="3807243">:=</span>&nbsp;<span class="ident" id="3807246">exp</span><span class="op" id="3807249">.</span><span class="ident" id="3807250">SetString</span><span class="op" id="3807259">(</span><span class="ident" id="3807260">s</span><span class="op" id="3807261">[</span><span class="ident" id="3807262">e</span><span class="op" id="3807263">+</span><span class="num" id="3807264">1</span><span class="op" id="3807265">:</span><span class="op" id="3807266">]</span><span class="op" id="3807267">,</span>&nbsp;<span class="num" id="3807269">10</span><span class="op" id="3807271">)</span><span class="op" id="3807272">;</span>&nbsp;<span class="op" id="3807274">!</span><span class="ident" id="3807275">ok</span>&nbsp;<span class="op" id="3807278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807283">return</span>&nbsp;<span class="ident" id="3807290">nil</span><span class="op" id="3807293">,</span>&nbsp;<span class="builtintype" id="3807295">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807307">s</span>&nbsp;<span class="op" id="3807309">=</span>&nbsp;<span class="ident" id="3807311">s</span><span class="op" id="3807312">[</span><span class="num" id="3807313">0</span><span class="op" id="3807314">:</span><span class="ident" id="3807315">e</span><span class="op" id="3807316">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807322">if</span>&nbsp;<span class="ident" id="3807325">sep</span>&nbsp;<span class="op" id="3807329">&gt;=</span>&nbsp;<span class="num" id="3807332">0</span>&nbsp;<span class="op" id="3807334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807338">s</span>&nbsp;<span class="op" id="3807340">=</span>&nbsp;<span class="ident" id="3807342">s</span><span class="op" id="3807343">[</span><span class="num" id="3807344">0</span><span class="op" id="3807345">:</span><span class="ident" id="3807346">sep</span><span class="op" id="3807349">]</span>&nbsp;<span class="op" id="3807351">+</span>&nbsp;<span class="ident" id="3807353">s</span><span class="op" id="3807354">[</span><span class="ident" id="3807355">sep</span><span class="op" id="3807358">+</span><span class="num" id="3807359">1</span><span class="op" id="3807360">:</span><span class="op" id="3807361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807365">exp</span><span class="op" id="3807368">.</span><span class="ident" id="3807369">Sub</span><span class="op" id="3807372">(</span><span class="op" id="3807373">&amp;</span><span class="ident" id="3807374">exp</span><span class="op" id="3807377">,</span>&nbsp;<span class="ident" id="3807379">NewInt</span><span class="op" id="3807385">(</span><span class="ident" id="3807386">int64</span><span class="op" id="3807391">(</span><span class="builtinfunc" id="3807392">len</span><span class="op" id="3807395">(</span><span class="ident" id="3807396">s</span><span class="op" id="3807397">)</span><span class="op" id="3807398">-</span><span class="ident" id="3807399">sep</span><span class="op" id="3807402">)</span><span class="op" id="3807403">)</span><span class="op" id="3807404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807407">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807411">if</span>&nbsp;<span class="ident" id="3807414">_</span><span class="op" id="3807415">,</span>&nbsp;<span class="ident" id="3807417">ok</span>&nbsp;<span class="op" id="3807420">:=</span>&nbsp;<span class="ident" id="3807423">z</span><span class="op" id="3807424">.</span><span class="ident" id="3807425">a</span><span class="op" id="3807426">.</span><span class="ident" id="3807427">SetString</span><span class="op" id="3807436">(</span><span class="ident" id="3807437">s</span><span class="op" id="3807438">,</span>&nbsp;<span class="num" id="3807440">10</span><span class="op" id="3807442">)</span><span class="op" id="3807443">;</span>&nbsp;<span class="op" id="3807445">!</span><span class="ident" id="3807446">ok</span>&nbsp;<span class="op" id="3807449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807453">return</span>&nbsp;<span class="ident" id="3807460">nil</span><span class="op" id="3807463">,</span>&nbsp;<span class="builtintype" id="3807465">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807475">powTen</span>&nbsp;<span class="op" id="3807482">:=</span>&nbsp;<span class="ident" id="3807485">nat</span><span class="op" id="3807488">(</span><span class="ident" id="3807489">nil</span><span class="op" id="3807492">)</span><span class="op" id="3807493">.</span><span class="ident" id="3807494">expNN</span><span class="op" id="3807499">(</span><span class="ident" id="3807500">natTen</span><span class="op" id="3807506">,</span>&nbsp;<span class="ident" id="3807508">exp</span><span class="op" id="3807511">.</span><span class="ident" id="3807512">abs</span><span class="op" id="3807515">,</span>&nbsp;<span class="ident" id="3807517">nil</span><span class="op" id="3807520">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807523">if</span>&nbsp;<span class="ident" id="3807526">exp</span><span class="op" id="3807529">.</span><span class="ident" id="3807530">neg</span>&nbsp;<span class="op" id="3807534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807538">z</span><span class="op" id="3807539">.</span><span class="ident" id="3807540">b</span><span class="op" id="3807541">.</span><span class="ident" id="3807542">abs</span>&nbsp;<span class="op" id="3807546">=</span>&nbsp;<span class="ident" id="3807548">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807557">z</span><span class="op" id="3807558">.</span><span class="ident" id="3807559">norm</span><span class="op" id="3807563">(</span><span class="op" id="3807564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807567">}</span>&nbsp;<span class="keyword" id="3807569">else</span>&nbsp;<span class="op" id="3807574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807578">z</span><span class="op" id="3807579">.</span><span class="ident" id="3807580">a</span><span class="op" id="3807581">.</span><span class="ident" id="3807582">abs</span>&nbsp;<span class="op" id="3807586">=</span>&nbsp;<span class="ident" id="3807588">z</span><span class="op" id="3807589">.</span><span class="ident" id="3807590">a</span><span class="op" id="3807591">.</span><span class="ident" id="3807592">abs</span><span class="op" id="3807595">.</span><span class="ident" id="3807596">mul</span><span class="op" id="3807599">(</span><span class="ident" id="3807600">z</span><span class="op" id="3807601">.</span><span class="ident" id="3807602">a</span><span class="op" id="3807603">.</span><span class="ident" id="3807604">abs</span><span class="op" id="3807607">,</span>&nbsp;<span class="ident" id="3807609">powTen</span><span class="op" id="3807615">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807619">z</span><span class="op" id="3807620">.</span><span class="ident" id="3807621">b</span><span class="op" id="3807622">.</span><span class="ident" id="3807623">abs</span>&nbsp;<span class="op" id="3807627">=</span>&nbsp;<span class="ident" id="3807629">z</span><span class="op" id="3807630">.</span><span class="ident" id="3807631">b</span><span class="op" id="3807632">.</span><span class="ident" id="3807633">abs</span><span class="op" id="3807636">.</span><span class="builtinfunc" id="3807637">make</span><span class="op" id="3807641">(</span><span class="num" id="3807642">0</span><span class="op" id="3807643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807650">return</span>&nbsp;<span class="ident" id="3807657">z</span><span class="op" id="3807658">,</span>&nbsp;<span class="builtintype" id="3807660">true</span><br>
<span class="lineno"></span><span class="op" id="3807665">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3807668">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3807751">func</span>&nbsp;<span class="op" id="3807756">(</span><span class="ident" id="3807757">x</span>&nbsp;<span class="op" id="3807759">*</span><span class="ident" id="3807760">Rat</span><span class="op" id="3807763">)</span>&nbsp;<span class="ident" id="3807765">String</span><span class="op" id="3807771">(</span><span class="op" id="3807772">)</span>&nbsp;<span class="builtintype" id="3807774">string</span>&nbsp;<span class="op" id="3807781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807784">s</span>&nbsp;<span class="op" id="3807786">:=</span>&nbsp;<span class="string" id="3807789">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807795">if</span>&nbsp;<span class="builtinfunc" id="3807798">len</span><span class="op" id="3807801">(</span><span class="ident" id="3807802">x</span><span class="op" id="3807803">.</span><span class="ident" id="3807804">b</span><span class="op" id="3807805">.</span><span class="ident" id="3807806">abs</span><span class="op" id="3807809">)</span>&nbsp;<span class="op" id="3807811">!=</span>&nbsp;<span class="num" id="3807814">0</span>&nbsp;<span class="op" id="3807816">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807820">s</span>&nbsp;<span class="op" id="3807822">=</span>&nbsp;<span class="string" id="3807824">&#34;/&#34;</span>&nbsp;<span class="op" id="3807828">+</span>&nbsp;<span class="ident" id="3807830">x</span><span class="op" id="3807831">.</span><span class="ident" id="3807832">b</span><span class="op" id="3807833">.</span><span class="ident" id="3807834">abs</span><span class="op" id="3807837">.</span><span class="ident" id="3807838">decimalString</span><span class="op" id="3807851">(</span><span class="op" id="3807852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807858">return</span>&nbsp;<span class="ident" id="3807865">x</span><span class="op" id="3807866">.</span><span class="ident" id="3807867">a</span><span class="op" id="3807868">.</span><span class="ident" id="3807869">String</span><span class="op" id="3807875">(</span><span class="op" id="3807876">)</span>&nbsp;<span class="op" id="3807878">+</span>&nbsp;<span class="ident" id="3807880">s</span><br>
<span class="lineno"></span><span class="op" id="3807882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3807885">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3807964">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3807998">func</span>&nbsp;<span class="op" id="3808003">(</span><span class="ident" id="3808004">x</span>&nbsp;<span class="op" id="3808006">*</span><span class="ident" id="3808007">Rat</span><span class="op" id="3808010">)</span>&nbsp;<span class="ident" id="3808012">RatString</span><span class="op" id="3808021">(</span><span class="op" id="3808022">)</span>&nbsp;<span class="builtintype" id="3808024">string</span>&nbsp;<span class="op" id="3808031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808034">if</span>&nbsp;<span class="ident" id="3808037">x</span><span class="op" id="3808038">.</span><span class="ident" id="3808039">IsInt</span><span class="op" id="3808044">(</span><span class="op" id="3808045">)</span>&nbsp;<span class="op" id="3808047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808051">return</span>&nbsp;<span class="ident" id="3808058">x</span><span class="op" id="3808059">.</span><span class="ident" id="3808060">a</span><span class="op" id="3808061">.</span><span class="ident" id="3808062">String</span><span class="op" id="3808068">(</span><span class="op" id="3808069">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808075">return</span>&nbsp;<span class="ident" id="3808082">x</span><span class="op" id="3808083">.</span><span class="ident" id="3808084">String</span><span class="op" id="3808090">(</span><span class="op" id="3808091">)</span><br>
<span class="lineno"></span><span class="op" id="3808093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3808096">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3808174">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3808249">func</span>&nbsp;<span class="op" id="3808254">(</span><span class="ident" id="3808255">x</span>&nbsp;<span class="op" id="3808257">*</span><span class="ident" id="3808258">Rat</span><span class="op" id="3808261">)</span>&nbsp;<span class="ident" id="3808263">FloatString</span><span class="op" id="3808274">(</span><span class="ident" id="3808275">prec</span>&nbsp;<span class="builtintype" id="3808280">int</span><span class="op" id="3808283">)</span>&nbsp;<span class="builtintype" id="3808285">string</span>&nbsp;<span class="op" id="3808292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808295">if</span>&nbsp;<span class="ident" id="3808298">x</span><span class="op" id="3808299">.</span><span class="ident" id="3808300">IsInt</span><span class="op" id="3808305">(</span><span class="op" id="3808306">)</span>&nbsp;<span class="op" id="3808308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808312">s</span>&nbsp;<span class="op" id="3808314">:=</span>&nbsp;<span class="ident" id="3808317">x</span><span class="op" id="3808318">.</span><span class="ident" id="3808319">a</span><span class="op" id="3808320">.</span><span class="ident" id="3808321">String</span><span class="op" id="3808327">(</span><span class="op" id="3808328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808332">if</span>&nbsp;<span class="ident" id="3808335">prec</span>&nbsp;<span class="op" id="3808340">&gt;</span>&nbsp;<span class="num" id="3808342">0</span>&nbsp;<span class="op" id="3808344">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808349">s</span>&nbsp;<span class="op" id="3808351">+=</span>&nbsp;<span class="string" id="3808354">&#34;.&#34;</span>&nbsp;<span class="op" id="3808358">+</span>&nbsp;<span class="ident" id="3808360">strings</span><span class="op" id="3808367">.</span><span class="ident" id="3808368">Repeat</span><span class="op" id="3808374">(</span><span class="string" id="3808375">&#34;0&#34;</span><span class="op" id="3808378">,</span>&nbsp;<span class="ident" id="3808380">prec</span><span class="op" id="3808384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808392">return</span>&nbsp;<span class="ident" id="3808399">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3808405">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808423">q</span><span class="op" id="3808424">,</span>&nbsp;<span class="ident" id="3808426">r</span>&nbsp;<span class="op" id="3808428">:=</span>&nbsp;<span class="ident" id="3808431">nat</span><span class="op" id="3808434">(</span><span class="ident" id="3808435">nil</span><span class="op" id="3808438">)</span><span class="op" id="3808439">.</span><span class="ident" id="3808440">div</span><span class="op" id="3808443">(</span><span class="ident" id="3808444">nat</span><span class="op" id="3808447">(</span><span class="ident" id="3808448">nil</span><span class="op" id="3808451">)</span><span class="op" id="3808452">,</span>&nbsp;<span class="ident" id="3808454">x</span><span class="op" id="3808455">.</span><span class="ident" id="3808456">a</span><span class="op" id="3808457">.</span><span class="ident" id="3808458">abs</span><span class="op" id="3808461">,</span>&nbsp;<span class="ident" id="3808463">x</span><span class="op" id="3808464">.</span><span class="ident" id="3808465">b</span><span class="op" id="3808466">.</span><span class="ident" id="3808467">abs</span><span class="op" id="3808470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808474">p</span>&nbsp;<span class="op" id="3808476">:=</span>&nbsp;<span class="ident" id="3808479">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808487">if</span>&nbsp;<span class="ident" id="3808490">prec</span>&nbsp;<span class="op" id="3808495">&gt;</span>&nbsp;<span class="num" id="3808497">0</span>&nbsp;<span class="op" id="3808499">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808503">p</span>&nbsp;<span class="op" id="3808505">=</span>&nbsp;<span class="ident" id="3808507">nat</span><span class="op" id="3808510">(</span><span class="ident" id="3808511">nil</span><span class="op" id="3808514">)</span><span class="op" id="3808515">.</span><span class="ident" id="3808516">expNN</span><span class="op" id="3808521">(</span><span class="ident" id="3808522">natTen</span><span class="op" id="3808528">,</span>&nbsp;<span class="ident" id="3808530">nat</span><span class="op" id="3808533">(</span><span class="ident" id="3808534">nil</span><span class="op" id="3808537">)</span><span class="op" id="3808538">.</span><span class="ident" id="3808539">setUint64</span><span class="op" id="3808548">(</span><span class="ident" id="3808549">uint64</span><span class="op" id="3808555">(</span><span class="ident" id="3808556">prec</span><span class="op" id="3808560">)</span><span class="op" id="3808561">)</span><span class="op" id="3808562">,</span>&nbsp;<span class="ident" id="3808564">nil</span><span class="op" id="3808567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808574">r</span>&nbsp;<span class="op" id="3808576">=</span>&nbsp;<span class="ident" id="3808578">r</span><span class="op" id="3808579">.</span><span class="ident" id="3808580">mul</span><span class="op" id="3808583">(</span><span class="ident" id="3808584">r</span><span class="op" id="3808585">,</span>&nbsp;<span class="ident" id="3808587">p</span><span class="op" id="3808588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808591">r</span><span class="op" id="3808592">,</span>&nbsp;<span class="ident" id="3808594">r2</span>&nbsp;<span class="op" id="3808597">:=</span>&nbsp;<span class="ident" id="3808600">r</span><span class="op" id="3808601">.</span><span class="ident" id="3808602">div</span><span class="op" id="3808605">(</span><span class="ident" id="3808606">nat</span><span class="op" id="3808609">(</span><span class="ident" id="3808610">nil</span><span class="op" id="3808613">)</span><span class="op" id="3808614">,</span>&nbsp;<span class="ident" id="3808616">r</span><span class="op" id="3808617">,</span>&nbsp;<span class="ident" id="3808619">x</span><span class="op" id="3808620">.</span><span class="ident" id="3808621">b</span><span class="op" id="3808622">.</span><span class="ident" id="3808623">abs</span><span class="op" id="3808626">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3808630">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808661">r2</span>&nbsp;<span class="op" id="3808664">=</span>&nbsp;<span class="ident" id="3808666">r2</span><span class="op" id="3808668">.</span><span class="ident" id="3808669">add</span><span class="op" id="3808672">(</span><span class="ident" id="3808673">r2</span><span class="op" id="3808675">,</span>&nbsp;<span class="ident" id="3808677">r2</span><span class="op" id="3808679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808682">if</span>&nbsp;<span class="ident" id="3808685">x</span><span class="op" id="3808686">.</span><span class="ident" id="3808687">b</span><span class="op" id="3808688">.</span><span class="ident" id="3808689">abs</span><span class="op" id="3808692">.</span><span class="ident" id="3808693">cmp</span><span class="op" id="3808696">(</span><span class="ident" id="3808697">r2</span><span class="op" id="3808699">)</span>&nbsp;<span class="op" id="3808701">&lt;=</span>&nbsp;<span class="num" id="3808704">0</span>&nbsp;<span class="op" id="3808706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808710">r</span>&nbsp;<span class="op" id="3808712">=</span>&nbsp;<span class="ident" id="3808714">r</span><span class="op" id="3808715">.</span><span class="ident" id="3808716">add</span><span class="op" id="3808719">(</span><span class="ident" id="3808720">r</span><span class="op" id="3808721">,</span>&nbsp;<span class="ident" id="3808723">natOne</span><span class="op" id="3808729">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808733">if</span>&nbsp;<span class="ident" id="3808736">r</span><span class="op" id="3808737">.</span><span class="ident" id="3808738">cmp</span><span class="op" id="3808741">(</span><span class="ident" id="3808742">p</span><span class="op" id="3808743">)</span>&nbsp;<span class="op" id="3808745">&gt;=</span>&nbsp;<span class="num" id="3808748">0</span>&nbsp;<span class="op" id="3808750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808755">q</span>&nbsp;<span class="op" id="3808757">=</span>&nbsp;<span class="ident" id="3808759">nat</span><span class="op" id="3808762">(</span><span class="ident" id="3808763">nil</span><span class="op" id="3808766">)</span><span class="op" id="3808767">.</span><span class="ident" id="3808768">add</span><span class="op" id="3808771">(</span><span class="ident" id="3808772">q</span><span class="op" id="3808773">,</span>&nbsp;<span class="ident" id="3808775">natOne</span><span class="op" id="3808781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808786">r</span>&nbsp;<span class="op" id="3808788">=</span>&nbsp;<span class="ident" id="3808790">nat</span><span class="op" id="3808793">(</span><span class="ident" id="3808794">nil</span><span class="op" id="3808797">)</span><span class="op" id="3808798">.</span><span class="ident" id="3808799">sub</span><span class="op" id="3808802">(</span><span class="ident" id="3808803">r</span><span class="op" id="3808804">,</span>&nbsp;<span class="ident" id="3808806">p</span><span class="op" id="3808807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808814">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808818">s</span>&nbsp;<span class="op" id="3808820">:=</span>&nbsp;<span class="ident" id="3808823">q</span><span class="op" id="3808824">.</span><span class="ident" id="3808825">decimalString</span><span class="op" id="3808838">(</span><span class="op" id="3808839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808842">if</span>&nbsp;<span class="ident" id="3808845">x</span><span class="op" id="3808846">.</span><span class="ident" id="3808847">a</span><span class="op" id="3808848">.</span><span class="ident" id="3808849">neg</span>&nbsp;<span class="op" id="3808853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808857">s</span>&nbsp;<span class="op" id="3808859">=</span>&nbsp;<span class="string" id="3808861">&#34;-&#34;</span>&nbsp;<span class="op" id="3808865">+</span>&nbsp;<span class="ident" id="3808867">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808870">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808874">if</span>&nbsp;<span class="ident" id="3808877">prec</span>&nbsp;<span class="op" id="3808882">&gt;</span>&nbsp;<span class="num" id="3808884">0</span>&nbsp;<span class="op" id="3808886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808890">rs</span>&nbsp;<span class="op" id="3808893">:=</span>&nbsp;<span class="ident" id="3808896">r</span><span class="op" id="3808897">.</span><span class="ident" id="3808898">decimalString</span><span class="op" id="3808911">(</span><span class="op" id="3808912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808916">leadingZeros</span>&nbsp;<span class="op" id="3808929">:=</span>&nbsp;<span class="ident" id="3808932">prec</span>&nbsp;<span class="op" id="3808937">-</span>&nbsp;<span class="builtinfunc" id="3808939">len</span><span class="op" id="3808942">(</span><span class="ident" id="3808943">rs</span><span class="op" id="3808945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808949">s</span>&nbsp;<span class="op" id="3808951">+=</span>&nbsp;<span class="string" id="3808954">&#34;.&#34;</span>&nbsp;<span class="op" id="3808958">+</span>&nbsp;<span class="ident" id="3808960">strings</span><span class="op" id="3808967">.</span><span class="ident" id="3808968">Repeat</span><span class="op" id="3808974">(</span><span class="string" id="3808975">&#34;0&#34;</span><span class="op" id="3808978">,</span>&nbsp;<span class="ident" id="3808980">leadingZeros</span><span class="op" id="3808992">)</span>&nbsp;<span class="op" id="3808994">+</span>&nbsp;<span class="ident" id="3808996">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809004">return</span>&nbsp;<span class="ident" id="3809011">s</span><br>
<span class="lineno"></span><span class="op" id="3809013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3809016">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3809091">const</span>&nbsp;<span class="ident" id="3809097">ratGobVersion</span>&nbsp;<span class="builtintype" id="3809111">byte</span>&nbsp;<span class="op" id="3809116">=</span>&nbsp;<span class="num" id="3809118">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3809121">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3809175">func</span>&nbsp;<span class="op" id="3809180">(</span><span class="ident" id="3809181">x</span>&nbsp;<span class="op" id="3809183">*</span><span class="ident" id="3809184">Rat</span><span class="op" id="3809187">)</span>&nbsp;<span class="ident" id="3809189">GobEncode</span><span class="op" id="3809198">(</span><span class="op" id="3809199">)</span>&nbsp;<span class="op" id="3809201">(</span><span class="op" id="3809202">[</span><span class="op" id="3809203">]</span><span class="builtintype" id="3809204">byte</span><span class="op" id="3809208">,</span>&nbsp;<span class="builtintype" id="3809210">error</span><span class="op" id="3809215">)</span>&nbsp;<span class="op" id="3809217">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809220">if</span>&nbsp;<span class="ident" id="3809223">x</span>&nbsp;<span class="op" id="3809225">==</span>&nbsp;<span class="ident" id="3809228">nil</span>&nbsp;<span class="op" id="3809232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809236">return</span>&nbsp;<span class="ident" id="3809243">nil</span><span class="op" id="3809246">,</span>&nbsp;<span class="ident" id="3809248">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809256">buf</span>&nbsp;<span class="op" id="3809260">:=</span>&nbsp;<span class="builtinfunc" id="3809263">make</span><span class="op" id="3809267">(</span><span class="op" id="3809268">[</span><span class="op" id="3809269">]</span><span class="builtintype" id="3809270">byte</span><span class="op" id="3809274">,</span>&nbsp;<span class="num" id="3809276">1</span><span class="op" id="3809277">+</span><span class="num" id="3809278">4</span><span class="op" id="3809279">+</span><span class="op" id="3809280">(</span><span class="builtinfunc" id="3809281">len</span><span class="op" id="3809284">(</span><span class="ident" id="3809285">x</span><span class="op" id="3809286">.</span><span class="ident" id="3809287">a</span><span class="op" id="3809288">.</span><span class="ident" id="3809289">abs</span><span class="op" id="3809292">)</span><span class="op" id="3809293">+</span><span class="builtinfunc" id="3809294">len</span><span class="op" id="3809297">(</span><span class="ident" id="3809298">x</span><span class="op" id="3809299">.</span><span class="ident" id="3809300">b</span><span class="op" id="3809301">.</span><span class="ident" id="3809302">abs</span><span class="op" id="3809305">)</span><span class="op" id="3809306">)</span><span class="op" id="3809307">*</span><span class="ident" id="3809308">_S</span><span class="op" id="3809310">)</span>&nbsp;<span class="comment" id="3809312">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809383">i</span>&nbsp;<span class="op" id="3809385">:=</span>&nbsp;<span class="ident" id="3809388">x</span><span class="op" id="3809389">.</span><span class="ident" id="3809390">b</span><span class="op" id="3809391">.</span><span class="ident" id="3809392">abs</span><span class="op" id="3809395">.</span><span class="ident" id="3809396">bytes</span><span class="op" id="3809401">(</span><span class="ident" id="3809402">buf</span><span class="op" id="3809405">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809408">j</span>&nbsp;<span class="op" id="3809410">:=</span>&nbsp;<span class="ident" id="3809413">x</span><span class="op" id="3809414">.</span><span class="ident" id="3809415">a</span><span class="op" id="3809416">.</span><span class="ident" id="3809417">abs</span><span class="op" id="3809420">.</span><span class="ident" id="3809421">bytes</span><span class="op" id="3809426">(</span><span class="ident" id="3809427">buf</span><span class="op" id="3809430">[</span><span class="num" id="3809431">0</span><span class="op" id="3809432">:</span><span class="ident" id="3809433">i</span><span class="op" id="3809434">]</span><span class="op" id="3809435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809438">n</span>&nbsp;<span class="op" id="3809440">:=</span>&nbsp;<span class="ident" id="3809443">i</span>&nbsp;<span class="op" id="3809445">-</span>&nbsp;<span class="ident" id="3809447">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809450">if</span>&nbsp;<span class="builtintype" id="3809453">int</span><span class="op" id="3809456">(</span><span class="builtintype" id="3809457">uint32</span><span class="op" id="3809463">(</span><span class="ident" id="3809464">n</span><span class="op" id="3809465">)</span><span class="op" id="3809466">)</span>&nbsp;<span class="op" id="3809468">!=</span>&nbsp;<span class="ident" id="3809471">n</span>&nbsp;<span class="op" id="3809473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809477">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809507">return</span>&nbsp;<span class="ident" id="3809514">nil</span><span class="op" id="3809517">,</span>&nbsp;<span class="ident" id="3809519">errors</span><span class="op" id="3809525">.</span><span class="ident" id="3809526">New</span><span class="op" id="3809529">(</span><span class="string" id="3809530">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3809566">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809572">binary</span><span class="op" id="3809578">.</span><span class="ident" id="3809579">BigEndian</span><span class="op" id="3809588">.</span><span class="ident" id="3809589">PutUint32</span><span class="op" id="3809598">(</span><span class="ident" id="3809599">buf</span><span class="op" id="3809602">[</span><span class="ident" id="3809603">j</span><span class="op" id="3809604">-</span><span class="num" id="3809605">4</span><span class="op" id="3809606">:</span><span class="ident" id="3809607">j</span><span class="op" id="3809608">]</span><span class="op" id="3809609">,</span>&nbsp;<span class="builtintype" id="3809611">uint32</span><span class="op" id="3809617">(</span><span class="ident" id="3809618">n</span><span class="op" id="3809619">)</span><span class="op" id="3809620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809623">j</span>&nbsp;<span class="op" id="3809625">-=</span>&nbsp;<span class="num" id="3809628">1</span>&nbsp;<span class="op" id="3809630">+</span>&nbsp;<span class="num" id="3809632">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809635">b</span>&nbsp;<span class="op" id="3809637">:=</span>&nbsp;<span class="ident" id="3809640">ratGobVersion</span>&nbsp;<span class="op" id="3809654">&lt;&lt;</span>&nbsp;<span class="num" id="3809657">1</span>&nbsp;<span class="comment" id="3809659">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809687">if</span>&nbsp;<span class="ident" id="3809690">x</span><span class="op" id="3809691">.</span><span class="ident" id="3809692">a</span><span class="op" id="3809693">.</span><span class="ident" id="3809694">neg</span>&nbsp;<span class="op" id="3809698">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809702">b</span>&nbsp;<span class="op" id="3809704">|=</span>&nbsp;<span class="num" id="3809707">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809713">buf</span><span class="op" id="3809716">[</span><span class="ident" id="3809717">j</span><span class="op" id="3809718">]</span>&nbsp;<span class="op" id="3809720">=</span>&nbsp;<span class="ident" id="3809722">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809725">return</span>&nbsp;<span class="ident" id="3809732">buf</span><span class="op" id="3809735">[</span><span class="ident" id="3809736">j</span><span class="op" id="3809737">:</span><span class="op" id="3809738">]</span><span class="op" id="3809739">,</span>&nbsp;<span class="ident" id="3809741">nil</span><br>
<span class="lineno"></span><span class="op" id="3809745">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3809748">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3809802">func</span>&nbsp;<span class="op" id="3809807">(</span><span class="ident" id="3809808">z</span>&nbsp;<span class="op" id="3809810">*</span><span class="ident" id="3809811">Rat</span><span class="op" id="3809814">)</span>&nbsp;<span class="ident" id="3809816">GobDecode</span><span class="op" id="3809825">(</span><span class="ident" id="3809826">buf</span>&nbsp;<span class="op" id="3809830">[</span><span class="op" id="3809831">]</span><span class="builtintype" id="3809832">byte</span><span class="op" id="3809836">)</span>&nbsp;<span class="builtintype" id="3809838">error</span>&nbsp;<span class="op" id="3809844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809847">if</span>&nbsp;<span class="builtinfunc" id="3809850">len</span><span class="op" id="3809853">(</span><span class="ident" id="3809854">buf</span><span class="op" id="3809857">)</span>&nbsp;<span class="op" id="3809859">==</span>&nbsp;<span class="num" id="3809862">0</span>&nbsp;<span class="op" id="3809864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809868">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809913">*</span><span class="ident" id="3809914">z</span>&nbsp;<span class="op" id="3809916">=</span>&nbsp;<span class="ident" id="3809918">Rat</span><span class="op" id="3809921">{</span><span class="op" id="3809922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809926">return</span>&nbsp;<span class="ident" id="3809933">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809941">b</span>&nbsp;<span class="op" id="3809943">:=</span>&nbsp;<span class="ident" id="3809946">buf</span><span class="op" id="3809949">[</span><span class="num" id="3809950">0</span><span class="op" id="3809951">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809954">if</span>&nbsp;<span class="ident" id="3809957">b</span><span class="op" id="3809958">&gt;&gt;</span><span class="num" id="3809960">1</span>&nbsp;<span class="op" id="3809962">!=</span>&nbsp;<span class="ident" id="3809965">ratGobVersion</span>&nbsp;<span class="op" id="3809979">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809983">return</span>&nbsp;<span class="ident" id="3809990">errors</span><span class="op" id="3809996">.</span><span class="ident" id="3809997">New</span><span class="op" id="3810000">(</span><span class="ident" id="3810001">fmt</span><span class="op" id="3810004">.</span><span class="ident" id="3810005">Sprintf</span><span class="op" id="3810012">(</span><span class="string" id="3810013">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3810063">,</span>&nbsp;<span class="ident" id="3810065">b</span><span class="op" id="3810066">&gt;&gt;</span><span class="num" id="3810068">1</span><span class="op" id="3810069">)</span><span class="op" id="3810070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810076">const</span>&nbsp;<span class="ident" id="3810082">j</span>&nbsp;<span class="op" id="3810084">=</span>&nbsp;<span class="num" id="3810086">1</span>&nbsp;<span class="op" id="3810088">+</span>&nbsp;<span class="num" id="3810090">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810093">i</span>&nbsp;<span class="op" id="3810095">:=</span>&nbsp;<span class="ident" id="3810098">j</span>&nbsp;<span class="op" id="3810100">+</span>&nbsp;<span class="ident" id="3810102">binary</span><span class="op" id="3810108">.</span><span class="ident" id="3810109">BigEndian</span><span class="op" id="3810118">.</span><span class="ident" id="3810119">Uint32</span><span class="op" id="3810125">(</span><span class="ident" id="3810126">buf</span><span class="op" id="3810129">[</span><span class="ident" id="3810130">j</span><span class="op" id="3810131">-</span><span class="num" id="3810132">4</span><span class="op" id="3810133">:</span><span class="ident" id="3810134">j</span><span class="op" id="3810135">]</span><span class="op" id="3810136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810139">z</span><span class="op" id="3810140">.</span><span class="ident" id="3810141">a</span><span class="op" id="3810142">.</span><span class="ident" id="3810143">neg</span>&nbsp;<span class="op" id="3810147">=</span>&nbsp;<span class="ident" id="3810149">b</span><span class="op" id="3810150">&amp;</span><span class="num" id="3810151">1</span>&nbsp;<span class="op" id="3810153">!=</span>&nbsp;<span class="num" id="3810156">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810159">z</span><span class="op" id="3810160">.</span><span class="ident" id="3810161">a</span><span class="op" id="3810162">.</span><span class="ident" id="3810163">abs</span>&nbsp;<span class="op" id="3810167">=</span>&nbsp;<span class="ident" id="3810169">z</span><span class="op" id="3810170">.</span><span class="ident" id="3810171">a</span><span class="op" id="3810172">.</span><span class="ident" id="3810173">abs</span><span class="op" id="3810176">.</span><span class="ident" id="3810177">setBytes</span><span class="op" id="3810185">(</span><span class="ident" id="3810186">buf</span><span class="op" id="3810189">[</span><span class="ident" id="3810190">j</span><span class="op" id="3810191">:</span><span class="ident" id="3810192">i</span><span class="op" id="3810193">]</span><span class="op" id="3810194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810197">z</span><span class="op" id="3810198">.</span><span class="ident" id="3810199">b</span><span class="op" id="3810200">.</span><span class="ident" id="3810201">abs</span>&nbsp;<span class="op" id="3810205">=</span>&nbsp;<span class="ident" id="3810207">z</span><span class="op" id="3810208">.</span><span class="ident" id="3810209">b</span><span class="op" id="3810210">.</span><span class="ident" id="3810211">abs</span><span class="op" id="3810214">.</span><span class="ident" id="3810215">setBytes</span><span class="op" id="3810223">(</span><span class="ident" id="3810224">buf</span><span class="op" id="3810227">[</span><span class="ident" id="3810228">i</span><span class="op" id="3810229">:</span><span class="op" id="3810230">]</span><span class="op" id="3810231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810234">return</span>&nbsp;<span class="ident" id="3810241">nil</span><br>
<span class="lineno"></span><span class="op" id="3810245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3810248">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3810312">func</span>&nbsp;<span class="op" id="3810317">(</span><span class="ident" id="3810318">r</span>&nbsp;<span class="op" id="3810320">*</span><span class="ident" id="3810321">Rat</span><span class="op" id="3810324">)</span>&nbsp;<span class="ident" id="3810326">MarshalText</span><span class="op" id="3810337">(</span><span class="op" id="3810338">)</span>&nbsp;<span class="op" id="3810340">(</span><span class="ident" id="3810341">text</span>&nbsp;<span class="op" id="3810346">[</span><span class="op" id="3810347">]</span><span class="builtintype" id="3810348">byte</span><span class="op" id="3810352">,</span>&nbsp;<span class="ident" id="3810354">err</span>&nbsp;<span class="builtintype" id="3810358">error</span><span class="op" id="3810363">)</span>&nbsp;<span class="op" id="3810365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810368">return</span>&nbsp;<span class="op" id="3810375">[</span><span class="op" id="3810376">]</span><span class="builtintype" id="3810377">byte</span><span class="op" id="3810381">(</span><span class="ident" id="3810382">r</span><span class="op" id="3810383">.</span><span class="ident" id="3810384">RatString</span><span class="op" id="3810393">(</span><span class="op" id="3810394">)</span><span class="op" id="3810395">)</span><span class="op" id="3810396">,</span>&nbsp;<span class="ident" id="3810398">nil</span><br>
<span class="lineno"></span><span class="op" id="3810402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3810405">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3810473">func</span>&nbsp;<span class="op" id="3810478">(</span><span class="ident" id="3810479">r</span>&nbsp;<span class="op" id="3810481">*</span><span class="ident" id="3810482">Rat</span><span class="op" id="3810485">)</span>&nbsp;<span class="ident" id="3810487">UnmarshalText</span><span class="op" id="3810500">(</span><span class="ident" id="3810501">text</span>&nbsp;<span class="op" id="3810506">[</span><span class="op" id="3810507">]</span><span class="builtintype" id="3810508">byte</span><span class="op" id="3810512">)</span>&nbsp;<span class="builtintype" id="3810514">error</span>&nbsp;<span class="op" id="3810520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810523">if</span>&nbsp;<span class="ident" id="3810526">_</span><span class="op" id="3810527">,</span>&nbsp;<span class="ident" id="3810529">ok</span>&nbsp;<span class="op" id="3810532">:=</span>&nbsp;<span class="ident" id="3810535">r</span><span class="op" id="3810536">.</span><span class="ident" id="3810537">SetString</span><span class="op" id="3810546">(</span><span class="builtintype" id="3810547">string</span><span class="op" id="3810553">(</span><span class="ident" id="3810554">text</span><span class="op" id="3810558">)</span><span class="op" id="3810559">)</span><span class="op" id="3810560">;</span>&nbsp;<span class="op" id="3810562">!</span><span class="ident" id="3810563">ok</span>&nbsp;<span class="op" id="3810566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810570">return</span>&nbsp;<span class="ident" id="3810577">fmt</span><span class="op" id="3810580">.</span><span class="ident" id="3810581">Errorf</span><span class="op" id="3810587">(</span><span class="string" id="3810588">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3810635">,</span>&nbsp;<span class="ident" id="3810637">text</span><span class="op" id="3810641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810644">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810647">return</span>&nbsp;<span class="ident" id="3810654">nil</span><br>
<span class="lineno"></span><span class="op" id="3810658">}</span>
</div>
</body>
</html>
