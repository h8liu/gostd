<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2855263">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2855318">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2855372">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2855423">package</span>&nbsp;<span class="ident" id="2855431">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2855441">import</span>&nbsp;<span class="op" id="2855448">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2855451">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2855460">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2855467">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2855478">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2855493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2855496">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="2855570">func</span>&nbsp;<span class="ident" id="2855575">htmlNospaceEscaper</span><span class="op" id="2855593">(</span><span class="ident" id="2855594">args</span>&nbsp;<span class="op" id="2855599">...</span><span class="keyword" id="2855602">interface</span><span class="op" id="2855611">{</span><span class="op" id="2855612">}</span><span class="op" id="2855613">)</span>&nbsp;<span class="builtintype" id="2855615">string</span>&nbsp;<span class="op" id="2855622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2855625">s</span><span class="op" id="2855626">,</span>&nbsp;<span class="ident" id="2855628">t</span>&nbsp;<span class="op" id="2855630">:=</span>&nbsp;<span class="ident" id="2855633">stringify</span><span class="op" id="2855642">(</span><span class="ident" id="2855643">args</span><span class="op" id="2855647">...</span><span class="op" id="2855650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2855653">if</span>&nbsp;<span class="ident" id="2855656">t</span>&nbsp;<span class="op" id="2855658">==</span>&nbsp;<span class="ident" id="2855661">contentTypeHTML</span>&nbsp;<span class="op" id="2855677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2855681">return</span>&nbsp;<span class="ident" id="2855688">htmlReplacer</span><span class="op" id="2855700">(</span><span class="ident" id="2855701">stripTags</span><span class="op" id="2855710">(</span><span class="ident" id="2855711">s</span><span class="op" id="2855712">)</span><span class="op" id="2855713">,</span>&nbsp;<span class="ident" id="2855715">htmlNospaceNormReplacementTable</span><span class="op" id="2855746">,</span>&nbsp;<span class="builtintype" id="2855748">false</span><span class="op" id="2855753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2855756">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2855759">return</span>&nbsp;<span class="ident" id="2855766">htmlReplacer</span><span class="op" id="2855778">(</span><span class="ident" id="2855779">s</span><span class="op" id="2855780">,</span>&nbsp;<span class="ident" id="2855782">htmlNospaceReplacementTable</span><span class="op" id="2855809">,</span>&nbsp;<span class="builtintype" id="2855811">false</span><span class="op" id="2855816">)</span><br>
<span class="lineno"></span><span class="op" id="2855818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2855821">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="2855886">func</span>&nbsp;<span class="ident" id="2855891">attrEscaper</span><span class="op" id="2855902">(</span><span class="ident" id="2855903">args</span>&nbsp;<span class="op" id="2855908">...</span><span class="keyword" id="2855911">interface</span><span class="op" id="2855920">{</span><span class="op" id="2855921">}</span><span class="op" id="2855922">)</span>&nbsp;<span class="builtintype" id="2855924">string</span>&nbsp;<span class="op" id="2855931">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2855934">s</span><span class="op" id="2855935">,</span>&nbsp;<span class="ident" id="2855937">t</span>&nbsp;<span class="op" id="2855939">:=</span>&nbsp;<span class="ident" id="2855942">stringify</span><span class="op" id="2855951">(</span><span class="ident" id="2855952">args</span><span class="op" id="2855956">...</span><span class="op" id="2855959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2855962">if</span>&nbsp;<span class="ident" id="2855965">t</span>&nbsp;<span class="op" id="2855967">==</span>&nbsp;<span class="ident" id="2855970">contentTypeHTML</span>&nbsp;<span class="op" id="2855986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2855990">return</span>&nbsp;<span class="ident" id="2855997">htmlReplacer</span><span class="op" id="2856009">(</span><span class="ident" id="2856010">stripTags</span><span class="op" id="2856019">(</span><span class="ident" id="2856020">s</span><span class="op" id="2856021">)</span><span class="op" id="2856022">,</span>&nbsp;<span class="ident" id="2856024">htmlNormReplacementTable</span><span class="op" id="2856048">,</span>&nbsp;<span class="builtintype" id="2856050">true</span><span class="op" id="2856054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2856057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856060">return</span>&nbsp;<span class="ident" id="2856067">htmlReplacer</span><span class="op" id="2856079">(</span><span class="ident" id="2856080">s</span><span class="op" id="2856081">,</span>&nbsp;<span class="ident" id="2856083">htmlReplacementTable</span><span class="op" id="2856103">,</span>&nbsp;<span class="builtintype" id="2856105">true</span><span class="op" id="2856109">)</span><br>
<span class="lineno">30</span><span class="op" id="2856111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2856114">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="2856180">func</span>&nbsp;<span class="ident" id="2856185">rcdataEscaper</span><span class="op" id="2856198">(</span><span class="ident" id="2856199">args</span>&nbsp;<span class="op" id="2856204">...</span><span class="keyword" id="2856207">interface</span><span class="op" id="2856216">{</span><span class="op" id="2856217">}</span><span class="op" id="2856218">)</span>&nbsp;<span class="builtintype" id="2856220">string</span>&nbsp;<span class="op" id="2856227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2856230">s</span><span class="op" id="2856231">,</span>&nbsp;<span class="ident" id="2856233">t</span>&nbsp;<span class="op" id="2856235">:=</span>&nbsp;<span class="ident" id="2856238">stringify</span><span class="op" id="2856247">(</span><span class="ident" id="2856248">args</span><span class="op" id="2856252">...</span><span class="op" id="2856255">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856258">if</span>&nbsp;<span class="ident" id="2856261">t</span>&nbsp;<span class="op" id="2856263">==</span>&nbsp;<span class="ident" id="2856266">contentTypeHTML</span>&nbsp;<span class="op" id="2856282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856286">return</span>&nbsp;<span class="ident" id="2856293">htmlReplacer</span><span class="op" id="2856305">(</span><span class="ident" id="2856306">s</span><span class="op" id="2856307">,</span>&nbsp;<span class="ident" id="2856309">htmlNormReplacementTable</span><span class="op" id="2856333">,</span>&nbsp;<span class="builtintype" id="2856335">true</span><span class="op" id="2856339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2856342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856345">return</span>&nbsp;<span class="ident" id="2856352">htmlReplacer</span><span class="op" id="2856364">(</span><span class="ident" id="2856365">s</span><span class="op" id="2856366">,</span>&nbsp;<span class="ident" id="2856368">htmlReplacementTable</span><span class="op" id="2856388">,</span>&nbsp;<span class="builtintype" id="2856390">true</span><span class="op" id="2856394">)</span><br>
<span class="lineno"></span><span class="op" id="2856396">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="2856399">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="2856450">func</span>&nbsp;<span class="ident" id="2856455">htmlEscaper</span><span class="op" id="2856466">(</span><span class="ident" id="2856467">args</span>&nbsp;<span class="op" id="2856472">...</span><span class="keyword" id="2856475">interface</span><span class="op" id="2856484">{</span><span class="op" id="2856485">}</span><span class="op" id="2856486">)</span>&nbsp;<span class="builtintype" id="2856488">string</span>&nbsp;<span class="op" id="2856495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2856498">s</span><span class="op" id="2856499">,</span>&nbsp;<span class="ident" id="2856501">t</span>&nbsp;<span class="op" id="2856503">:=</span>&nbsp;<span class="ident" id="2856506">stringify</span><span class="op" id="2856515">(</span><span class="ident" id="2856516">args</span><span class="op" id="2856520">...</span><span class="op" id="2856523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856526">if</span>&nbsp;<span class="ident" id="2856529">t</span>&nbsp;<span class="op" id="2856531">==</span>&nbsp;<span class="ident" id="2856534">contentTypeHTML</span>&nbsp;<span class="op" id="2856550">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856554">return</span>&nbsp;<span class="ident" id="2856561">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2856564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2856567">return</span>&nbsp;<span class="ident" id="2856574">htmlReplacer</span><span class="op" id="2856586">(</span><span class="ident" id="2856587">s</span><span class="op" id="2856588">,</span>&nbsp;<span class="ident" id="2856590">htmlReplacementTable</span><span class="op" id="2856610">,</span>&nbsp;<span class="builtintype" id="2856612">true</span><span class="op" id="2856616">)</span><br>
<span class="lineno"></span><span class="op" id="2856618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2856621">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="2856688">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="2856742">var</span>&nbsp;<span class="ident" id="2856746">htmlReplacementTable</span>&nbsp;<span class="op" id="2856767">=</span>&nbsp;<span class="op" id="2856769">[</span><span class="op" id="2856770">]</span><span class="builtintype" id="2856771">string</span><span class="op" id="2856777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2856780">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2856856">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2856913">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2856971">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2856977">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2856995">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2857067">0</span><span class="op" id="2857068">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2857073">&#34;\uFFFD&#34;</span><span class="op" id="2857081">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857084">&#39;&#34;&#39;</span><span class="op" id="2857087">:</span>&nbsp;&nbsp;<span class="string" id="2857090">&#34;&amp;#34;&#34;</span><span class="op" id="2857097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857100">&#39;&amp;&#39;</span><span class="op" id="2857103">:</span>&nbsp;&nbsp;<span class="string" id="2857106">&#34;&amp;amp;&#34;</span><span class="op" id="2857113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857116">&#39;\&#39;&#39;</span><span class="op" id="2857120">:</span>&nbsp;<span class="string" id="2857122">&#34;&amp;#39;&#34;</span><span class="op" id="2857129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857132">&#39;+&#39;</span><span class="op" id="2857135">:</span>&nbsp;&nbsp;<span class="string" id="2857138">&#34;&amp;#43;&#34;</span><span class="op" id="2857145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857148">&#39;&lt;&#39;</span><span class="op" id="2857151">:</span>&nbsp;&nbsp;<span class="string" id="2857154">&#34;&amp;lt;&#34;</span><span class="op" id="2857160">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857163">&#39;&gt;&#39;</span><span class="op" id="2857166">:</span>&nbsp;&nbsp;<span class="string" id="2857169">&#34;&amp;gt;&#34;</span><span class="op" id="2857175">,</span><br>
<span class="lineno"></span><span class="op" id="2857177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2857180">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2857256">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="2857298">var</span>&nbsp;<span class="ident" id="2857302">htmlNormReplacementTable</span>&nbsp;<span class="op" id="2857327">=</span>&nbsp;<span class="op" id="2857329">[</span><span class="op" id="2857330">]</span><span class="builtintype" id="2857331">string</span><span class="op" id="2857337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2857340">0</span><span class="op" id="2857341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2857346">&#34;\uFFFD&#34;</span><span class="op" id="2857354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857357">&#39;&#34;&#39;</span><span class="op" id="2857360">:</span>&nbsp;&nbsp;<span class="string" id="2857363">&#34;&amp;#34;&#34;</span><span class="op" id="2857370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857373">&#39;\&#39;&#39;</span><span class="op" id="2857377">:</span>&nbsp;<span class="string" id="2857379">&#34;&amp;#39;&#34;</span><span class="op" id="2857386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857389">&#39;+&#39;</span><span class="op" id="2857392">:</span>&nbsp;&nbsp;<span class="string" id="2857395">&#34;&amp;#43;&#34;</span><span class="op" id="2857402">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857405">&#39;&lt;&#39;</span><span class="op" id="2857408">:</span>&nbsp;&nbsp;<span class="string" id="2857411">&#34;&amp;lt;&#34;</span><span class="op" id="2857417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2857420">&#39;&gt;&#39;</span><span class="op" id="2857423">:</span>&nbsp;&nbsp;<span class="string" id="2857426">&#34;&amp;gt;&#34;</span><span class="op" id="2857432">,</span><br>
<span class="lineno"></span><span class="op" id="2857434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2857437">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="2857511">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="2857550">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2857616">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="2857673">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="2857693">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="2857719">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="2857777">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2857812">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="2857845">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2857907">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="2857951">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="2858020">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="2858025">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="2858058">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="2858075">var</span>&nbsp;<span class="ident" id="2858079">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="2858107">=</span>&nbsp;<span class="op" id="2858109">[</span><span class="op" id="2858110">]</span><span class="builtintype" id="2858111">string</span><span class="op" id="2858117">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2858120">0</span><span class="op" id="2858121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2858126">&#34;&amp;#xfffd;&#34;</span><span class="op" id="2858136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858139">&#39;\t&#39;</span><span class="op" id="2858143">:</span>&nbsp;<span class="string" id="2858145">&#34;&amp;#9;&#34;</span><span class="op" id="2858151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858154">&#39;\n&#39;</span><span class="op" id="2858158">:</span>&nbsp;<span class="string" id="2858160">&#34;&amp;#10;&#34;</span><span class="op" id="2858167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858170">&#39;\v&#39;</span><span class="op" id="2858174">:</span>&nbsp;<span class="string" id="2858176">&#34;&amp;#11;&#34;</span><span class="op" id="2858183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858186">&#39;\f&#39;</span><span class="op" id="2858190">:</span>&nbsp;<span class="string" id="2858192">&#34;&amp;#12;&#34;</span><span class="op" id="2858199">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858202">&#39;\r&#39;</span><span class="op" id="2858206">:</span>&nbsp;<span class="string" id="2858208">&#34;&amp;#13;&#34;</span><span class="op" id="2858215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858218">&#39;&nbsp;&#39;</span><span class="op" id="2858221">:</span>&nbsp;&nbsp;<span class="string" id="2858224">&#34;&amp;#32;&#34;</span><span class="op" id="2858231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858234">&#39;&#34;&#39;</span><span class="op" id="2858237">:</span>&nbsp;&nbsp;<span class="string" id="2858240">&#34;&amp;#34;&#34;</span><span class="op" id="2858247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858250">&#39;&amp;&#39;</span><span class="op" id="2858253">:</span>&nbsp;&nbsp;<span class="string" id="2858256">&#34;&amp;amp;&#34;</span><span class="op" id="2858263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858266">&#39;\&#39;&#39;</span><span class="op" id="2858270">:</span>&nbsp;<span class="string" id="2858272">&#34;&amp;#39;&#34;</span><span class="op" id="2858279">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858282">&#39;+&#39;</span><span class="op" id="2858285">:</span>&nbsp;&nbsp;<span class="string" id="2858288">&#34;&amp;#43;&#34;</span><span class="op" id="2858295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858298">&#39;&lt;&#39;</span><span class="op" id="2858301">:</span>&nbsp;&nbsp;<span class="string" id="2858304">&#34;&amp;lt;&#34;</span><span class="op" id="2858310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858313">&#39;=&#39;</span><span class="op" id="2858316">:</span>&nbsp;&nbsp;<span class="string" id="2858319">&#34;&amp;#61;&#34;</span><span class="op" id="2858326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858329">&#39;&gt;&#39;</span><span class="op" id="2858332">:</span>&nbsp;&nbsp;<span class="string" id="2858335">&#34;&amp;gt;&#34;</span><span class="op" id="2858341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2858344">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2858400">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2858435">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858477">&#39;`&#39;</span><span class="op" id="2858480">:</span>&nbsp;<span class="string" id="2858482">&#34;&amp;#96;&#34;</span><span class="op" id="2858489">,</span><br>
<span class="lineno"></span><span class="op" id="2858491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="2858494">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="2858569">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="2858626">var</span>&nbsp;<span class="ident" id="2858630">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="2858662">=</span>&nbsp;<span class="op" id="2858664">[</span><span class="op" id="2858665">]</span><span class="builtintype" id="2858666">string</span><span class="op" id="2858672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2858675">0</span><span class="op" id="2858676">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2858681">&#34;&amp;#xfffd;&#34;</span><span class="op" id="2858691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858694">&#39;\t&#39;</span><span class="op" id="2858698">:</span>&nbsp;<span class="string" id="2858700">&#34;&amp;#9;&#34;</span><span class="op" id="2858706">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858709">&#39;\n&#39;</span><span class="op" id="2858713">:</span>&nbsp;<span class="string" id="2858715">&#34;&amp;#10;&#34;</span><span class="op" id="2858722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858725">&#39;\v&#39;</span><span class="op" id="2858729">:</span>&nbsp;<span class="string" id="2858731">&#34;&amp;#11;&#34;</span><span class="op" id="2858738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858741">&#39;\f&#39;</span><span class="op" id="2858745">:</span>&nbsp;<span class="string" id="2858747">&#34;&amp;#12;&#34;</span><span class="op" id="2858754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858757">&#39;\r&#39;</span><span class="op" id="2858761">:</span>&nbsp;<span class="string" id="2858763">&#34;&amp;#13;&#34;</span><span class="op" id="2858770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858773">&#39;&nbsp;&#39;</span><span class="op" id="2858776">:</span>&nbsp;&nbsp;<span class="string" id="2858779">&#34;&amp;#32;&#34;</span><span class="op" id="2858786">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858789">&#39;&#34;&#39;</span><span class="op" id="2858792">:</span>&nbsp;&nbsp;<span class="string" id="2858795">&#34;&amp;#34;&#34;</span><span class="op" id="2858802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858805">&#39;\&#39;&#39;</span><span class="op" id="2858809">:</span>&nbsp;<span class="string" id="2858811">&#34;&amp;#39;&#34;</span><span class="op" id="2858818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858821">&#39;+&#39;</span><span class="op" id="2858824">:</span>&nbsp;&nbsp;<span class="string" id="2858827">&#34;&amp;#43;&#34;</span><span class="op" id="2858834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858837">&#39;&lt;&#39;</span><span class="op" id="2858840">:</span>&nbsp;&nbsp;<span class="string" id="2858843">&#34;&amp;lt;&#34;</span><span class="op" id="2858849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858852">&#39;=&#39;</span><span class="op" id="2858855">:</span>&nbsp;&nbsp;<span class="string" id="2858858">&#34;&amp;#61;&#34;</span><span class="op" id="2858865">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2858868">&#39;&gt;&#39;</span><span class="op" id="2858871">:</span>&nbsp;&nbsp;<span class="string" id="2858874">&#34;&amp;gt;&#34;</span><span class="op" id="2858880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2858883">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2858939">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2858974">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2859016">&#39;`&#39;</span><span class="op" id="2859019">:</span>&nbsp;<span class="string" id="2859021">&#34;&amp;#96;&#34;</span><span class="op" id="2859028">,</span><br>
<span class="lineno">135</span><span class="op" id="2859030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2859033">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="2859109">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="2859188">func</span>&nbsp;<span class="ident" id="2859193">htmlReplacer</span><span class="op" id="2859205">(</span><span class="ident" id="2859206">s</span>&nbsp;<span class="builtintype" id="2859208">string</span><span class="op" id="2859214">,</span>&nbsp;<span class="ident" id="2859216">replacementTable</span>&nbsp;<span class="op" id="2859233">[</span><span class="op" id="2859234">]</span><span class="builtintype" id="2859235">string</span><span class="op" id="2859241">,</span>&nbsp;<span class="ident" id="2859243">badRunes</span>&nbsp;<span class="builtintype" id="2859252">bool</span><span class="op" id="2859256">)</span>&nbsp;<span class="builtintype" id="2859258">string</span>&nbsp;<span class="op" id="2859265">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859268">written</span><span class="op" id="2859275">,</span>&nbsp;<span class="ident" id="2859277">b</span>&nbsp;<span class="op" id="2859279">:=</span>&nbsp;<span class="num" id="2859282">0</span><span class="op" id="2859283">,</span>&nbsp;<span class="builtinfunc" id="2859285">new</span><span class="op" id="2859288">(</span><span class="ident" id="2859289">bytes</span><span class="op" id="2859294">.</span><span class="ident" id="2859295">Buffer</span><span class="op" id="2859301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2859304">for</span>&nbsp;<span class="ident" id="2859308">i</span><span class="op" id="2859309">,</span>&nbsp;<span class="ident" id="2859311">r</span>&nbsp;<span class="op" id="2859313">:=</span>&nbsp;<span class="keyword" id="2859316">range</span>&nbsp;<span class="ident" id="2859322">s</span>&nbsp;<span class="op" id="2859324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2859328">if</span>&nbsp;<span class="builtintype" id="2859331">int</span><span class="op" id="2859334">(</span><span class="ident" id="2859335">r</span><span class="op" id="2859336">)</span>&nbsp;<span class="op" id="2859338">&lt;</span>&nbsp;<span class="builtinfunc" id="2859340">len</span><span class="op" id="2859343">(</span><span class="ident" id="2859344">replacementTable</span><span class="op" id="2859360">)</span>&nbsp;<span class="op" id="2859362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2859367">if</span>&nbsp;<span class="ident" id="2859370">repl</span>&nbsp;<span class="op" id="2859375">:=</span>&nbsp;<span class="ident" id="2859378">replacementTable</span><span class="op" id="2859394">[</span><span class="ident" id="2859395">r</span><span class="op" id="2859396">]</span><span class="op" id="2859397">;</span>&nbsp;<span class="builtinfunc" id="2859399">len</span><span class="op" id="2859402">(</span><span class="ident" id="2859403">repl</span><span class="op" id="2859407">)</span>&nbsp;<span class="op" id="2859409">!=</span>&nbsp;<span class="num" id="2859412">0</span>&nbsp;<span class="op" id="2859414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859420">b</span><span class="op" id="2859421">.</span><span class="ident" id="2859422">WriteString</span><span class="op" id="2859433">(</span><span class="ident" id="2859434">s</span><span class="op" id="2859435">[</span><span class="ident" id="2859436">written</span><span class="op" id="2859443">:</span><span class="ident" id="2859444">i</span><span class="op" id="2859445">]</span><span class="op" id="2859446">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859452">b</span><span class="op" id="2859453">.</span><span class="ident" id="2859454">WriteString</span><span class="op" id="2859465">(</span><span class="ident" id="2859466">repl</span><span class="op" id="2859470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2859476">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2859525">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859561">written</span>&nbsp;<span class="op" id="2859569">=</span>&nbsp;<span class="ident" id="2859571">i</span>&nbsp;<span class="op" id="2859573">+</span>&nbsp;<span class="ident" id="2859575">utf8</span><span class="op" id="2859579">.</span><span class="ident" id="2859580">RuneLen</span><span class="op" id="2859587">(</span><span class="ident" id="2859588">r</span><span class="op" id="2859589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2859594">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2859598">}</span>&nbsp;<span class="keyword" id="2859600">else</span>&nbsp;<span class="keyword" id="2859605">if</span>&nbsp;<span class="ident" id="2859608">badRunes</span>&nbsp;<span class="op" id="2859617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2859622">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2859635">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2859690">}</span>&nbsp;<span class="keyword" id="2859692">else</span>&nbsp;<span class="keyword" id="2859697">if</span>&nbsp;<span class="num" id="2859700">0xfdd0</span>&nbsp;<span class="op" id="2859707">&lt;=</span>&nbsp;<span class="ident" id="2859710">r</span>&nbsp;<span class="op" id="2859712">&amp;&amp;</span>&nbsp;<span class="ident" id="2859715">r</span>&nbsp;<span class="op" id="2859717">&lt;=</span>&nbsp;<span class="num" id="2859720">0xfdef</span>&nbsp;<span class="op" id="2859727">||</span>&nbsp;<span class="num" id="2859730">0xfff0</span>&nbsp;<span class="op" id="2859737">&lt;=</span>&nbsp;<span class="ident" id="2859740">r</span>&nbsp;<span class="op" id="2859742">&amp;&amp;</span>&nbsp;<span class="ident" id="2859745">r</span>&nbsp;<span class="op" id="2859747">&lt;=</span>&nbsp;<span class="num" id="2859750">0xffff</span>&nbsp;<span class="op" id="2859757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859762">fmt</span><span class="op" id="2859765">.</span><span class="ident" id="2859766">Fprintf</span><span class="op" id="2859773">(</span><span class="ident" id="2859774">b</span><span class="op" id="2859775">,</span>&nbsp;<span class="string" id="2859777">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="2859787">,</span>&nbsp;<span class="ident" id="2859789">s</span><span class="op" id="2859790">[</span><span class="ident" id="2859791">written</span><span class="op" id="2859798">:</span><span class="ident" id="2859799">i</span><span class="op" id="2859800">]</span><span class="op" id="2859801">,</span>&nbsp;<span class="ident" id="2859803">r</span><span class="op" id="2859804">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859809">written</span>&nbsp;<span class="op" id="2859817">=</span>&nbsp;<span class="ident" id="2859819">i</span>&nbsp;<span class="op" id="2859821">+</span>&nbsp;<span class="ident" id="2859823">utf8</span><span class="op" id="2859827">.</span><span class="ident" id="2859828">RuneLen</span><span class="op" id="2859835">(</span><span class="ident" id="2859836">r</span><span class="op" id="2859837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2859841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2859844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2859847">if</span>&nbsp;<span class="ident" id="2859850">written</span>&nbsp;<span class="op" id="2859858">==</span>&nbsp;<span class="num" id="2859861">0</span>&nbsp;<span class="op" id="2859863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2859867">return</span>&nbsp;<span class="ident" id="2859874">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2859877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2859880">b</span><span class="op" id="2859881">.</span><span class="ident" id="2859882">WriteString</span><span class="op" id="2859893">(</span><span class="ident" id="2859894">s</span><span class="op" id="2859895">[</span><span class="ident" id="2859896">written</span><span class="op" id="2859903">:</span><span class="op" id="2859904">]</span><span class="op" id="2859905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2859908">return</span>&nbsp;<span class="ident" id="2859915">b</span><span class="op" id="2859916">.</span><span class="ident" id="2859917">String</span><span class="op" id="2859923">(</span><span class="op" id="2859924">)</span><br>
<span class="lineno"></span><span class="op" id="2859926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="2859929">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="2860001">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="2860076">func</span>&nbsp;<span class="ident" id="2860081">stripTags</span><span class="op" id="2860090">(</span><span class="ident" id="2860091">html</span>&nbsp;<span class="builtintype" id="2860096">string</span><span class="op" id="2860102">)</span>&nbsp;<span class="builtintype" id="2860104">string</span>&nbsp;<span class="op" id="2860111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860114">var</span>&nbsp;<span class="ident" id="2860118">b</span>&nbsp;<span class="ident" id="2860120">bytes</span><span class="op" id="2860125">.</span><span class="ident" id="2860126">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860134">s</span><span class="op" id="2860135">,</span>&nbsp;<span class="ident" id="2860137">c</span><span class="op" id="2860138">,</span>&nbsp;<span class="ident" id="2860140">i</span><span class="op" id="2860141">,</span>&nbsp;<span class="ident" id="2860143">allText</span>&nbsp;<span class="op" id="2860151">:=</span>&nbsp;<span class="op" id="2860154">[</span><span class="op" id="2860155">]</span><span class="builtintype" id="2860156">byte</span><span class="op" id="2860160">(</span><span class="ident" id="2860161">html</span><span class="op" id="2860165">)</span><span class="op" id="2860166">,</span>&nbsp;<span class="ident" id="2860168">context</span><span class="op" id="2860175">{</span><span class="op" id="2860176">}</span><span class="op" id="2860177">,</span>&nbsp;<span class="num" id="2860179">0</span><span class="op" id="2860180">,</span>&nbsp;<span class="builtintype" id="2860182">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2860188">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2860243">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860286">for</span>&nbsp;<span class="ident" id="2860290">i</span>&nbsp;<span class="op" id="2860292">!=</span>&nbsp;<span class="builtinfunc" id="2860295">len</span><span class="op" id="2860298">(</span><span class="ident" id="2860299">s</span><span class="op" id="2860300">)</span>&nbsp;<span class="op" id="2860302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860306">if</span>&nbsp;<span class="ident" id="2860309">c</span><span class="op" id="2860310">.</span><span class="ident" id="2860311">delim</span>&nbsp;<span class="op" id="2860317">==</span>&nbsp;<span class="ident" id="2860320">delimNone</span>&nbsp;<span class="op" id="2860330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860335">st</span>&nbsp;<span class="op" id="2860338">:=</span>&nbsp;<span class="ident" id="2860341">c</span><span class="op" id="2860342">.</span><span class="ident" id="2860343">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2860352">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860411">if</span>&nbsp;<span class="ident" id="2860414">c</span><span class="op" id="2860415">.</span><span class="ident" id="2860416">element</span>&nbsp;<span class="op" id="2860424">!=</span>&nbsp;<span class="ident" id="2860427">elementNone</span>&nbsp;<span class="op" id="2860439">&amp;&amp;</span>&nbsp;<span class="op" id="2860442">!</span><span class="ident" id="2860443">isInTag</span><span class="op" id="2860450">(</span><span class="ident" id="2860451">st</span><span class="op" id="2860453">)</span>&nbsp;<span class="op" id="2860455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860461">st</span>&nbsp;<span class="op" id="2860464">=</span>&nbsp;<span class="ident" id="2860466">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860486">d</span><span class="op" id="2860487">,</span>&nbsp;<span class="ident" id="2860489">nread</span>&nbsp;<span class="op" id="2860495">:=</span>&nbsp;<span class="ident" id="2860498">transitionFunc</span><span class="op" id="2860512">[</span><span class="ident" id="2860513">st</span><span class="op" id="2860515">]</span><span class="op" id="2860516">(</span><span class="ident" id="2860517">c</span><span class="op" id="2860518">,</span>&nbsp;<span class="ident" id="2860520">s</span><span class="op" id="2860521">[</span><span class="ident" id="2860522">i</span><span class="op" id="2860523">:</span><span class="op" id="2860524">]</span><span class="op" id="2860525">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860530">i1</span>&nbsp;<span class="op" id="2860533">:=</span>&nbsp;<span class="ident" id="2860536">i</span>&nbsp;<span class="op" id="2860538">+</span>&nbsp;<span class="ident" id="2860540">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860549">if</span>&nbsp;<span class="ident" id="2860552">c</span><span class="op" id="2860553">.</span><span class="ident" id="2860554">state</span>&nbsp;<span class="op" id="2860560">==</span>&nbsp;<span class="ident" id="2860563">stateText</span>&nbsp;<span class="op" id="2860573">||</span>&nbsp;<span class="ident" id="2860576">c</span><span class="op" id="2860577">.</span><span class="ident" id="2860578">state</span>&nbsp;<span class="op" id="2860584">==</span>&nbsp;<span class="ident" id="2860587">stateRCDATA</span>&nbsp;<span class="op" id="2860599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2860605">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860661">j</span>&nbsp;<span class="op" id="2860663">:=</span>&nbsp;<span class="ident" id="2860666">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860673">if</span>&nbsp;<span class="ident" id="2860676">d</span><span class="op" id="2860677">.</span><span class="ident" id="2860678">state</span>&nbsp;<span class="op" id="2860684">!=</span>&nbsp;<span class="ident" id="2860687">c</span><span class="op" id="2860688">.</span><span class="ident" id="2860689">state</span>&nbsp;<span class="op" id="2860695">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860702">for</span>&nbsp;<span class="ident" id="2860706">j1</span>&nbsp;<span class="op" id="2860709">:=</span>&nbsp;<span class="ident" id="2860712">j</span>&nbsp;<span class="op" id="2860714">-</span>&nbsp;<span class="num" id="2860716">1</span><span class="op" id="2860717">;</span>&nbsp;<span class="ident" id="2860719">j1</span>&nbsp;<span class="op" id="2860722">&gt;=</span>&nbsp;<span class="ident" id="2860725">i</span><span class="op" id="2860726">;</span>&nbsp;<span class="ident" id="2860728">j1</span><span class="op" id="2860730">--</span>&nbsp;<span class="op" id="2860733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860741">if</span>&nbsp;<span class="ident" id="2860744">s</span><span class="op" id="2860745">[</span><span class="ident" id="2860746">j1</span><span class="op" id="2860748">]</span>&nbsp;<span class="op" id="2860750">==</span>&nbsp;<span class="string" id="2860753">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="2860757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860766">j</span>&nbsp;<span class="op" id="2860768">=</span>&nbsp;<span class="ident" id="2860770">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860792">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860811">b</span><span class="op" id="2860812">.</span><span class="ident" id="2860813">Write</span><span class="op" id="2860818">(</span><span class="ident" id="2860819">s</span><span class="op" id="2860820">[</span><span class="ident" id="2860821">i</span><span class="op" id="2860822">:</span><span class="ident" id="2860823">j</span><span class="op" id="2860824">]</span><span class="op" id="2860825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860830">}</span>&nbsp;<span class="keyword" id="2860832">else</span>&nbsp;<span class="op" id="2860837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860843">allText</span>&nbsp;<span class="op" id="2860851">=</span>&nbsp;<span class="builtintype" id="2860853">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860867">c</span><span class="op" id="2860868">,</span>&nbsp;<span class="ident" id="2860870">i</span>&nbsp;<span class="op" id="2860872">=</span>&nbsp;<span class="ident" id="2860874">d</span><span class="op" id="2860875">,</span>&nbsp;<span class="ident" id="2860877">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860883">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2860898">i1</span>&nbsp;<span class="op" id="2860901">:=</span>&nbsp;<span class="ident" id="2860904">i</span>&nbsp;<span class="op" id="2860906">+</span>&nbsp;<span class="ident" id="2860908">bytes</span><span class="op" id="2860913">.</span><span class="ident" id="2860914">IndexAny</span><span class="op" id="2860922">(</span><span class="ident" id="2860923">s</span><span class="op" id="2860924">[</span><span class="ident" id="2860925">i</span><span class="op" id="2860926">:</span><span class="op" id="2860927">]</span><span class="op" id="2860928">,</span>&nbsp;<span class="ident" id="2860930">delimEnds</span><span class="op" id="2860939">[</span><span class="ident" id="2860940">c</span><span class="op" id="2860941">.</span><span class="ident" id="2860942">delim</span><span class="op" id="2860947">]</span><span class="op" id="2860948">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860952">if</span>&nbsp;<span class="ident" id="2860955">i1</span>&nbsp;<span class="op" id="2860958">&lt;</span>&nbsp;<span class="ident" id="2860960">i</span>&nbsp;<span class="op" id="2860962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860967">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2860975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2860979">if</span>&nbsp;<span class="ident" id="2860982">c</span><span class="op" id="2860983">.</span><span class="ident" id="2860984">delim</span>&nbsp;<span class="op" id="2860990">!=</span>&nbsp;<span class="ident" id="2860993">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="2861012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861017">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2861042">i1</span><span class="op" id="2861044">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2861053">c</span><span class="op" id="2861054">,</span>&nbsp;<span class="ident" id="2861056">i</span>&nbsp;<span class="op" id="2861058">=</span>&nbsp;<span class="ident" id="2861060">context</span><span class="op" id="2861067">{</span><span class="ident" id="2861068">state</span><span class="op" id="2861073">:</span>&nbsp;<span class="ident" id="2861075">stateTag</span><span class="op" id="2861083">,</span>&nbsp;<span class="ident" id="2861085">element</span><span class="op" id="2861092">:</span>&nbsp;<span class="ident" id="2861094">c</span><span class="op" id="2861095">.</span><span class="ident" id="2861096">element</span><span class="op" id="2861103">}</span><span class="op" id="2861104">,</span>&nbsp;<span class="ident" id="2861106">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861113">if</span>&nbsp;<span class="ident" id="2861116">allText</span>&nbsp;<span class="op" id="2861124">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861128">return</span>&nbsp;<span class="ident" id="2861135">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861141">}</span>&nbsp;<span class="keyword" id="2861143">else</span>&nbsp;<span class="keyword" id="2861148">if</span>&nbsp;<span class="ident" id="2861151">c</span><span class="op" id="2861152">.</span><span class="ident" id="2861153">state</span>&nbsp;<span class="op" id="2861159">==</span>&nbsp;<span class="ident" id="2861162">stateText</span>&nbsp;<span class="op" id="2861172">||</span>&nbsp;<span class="ident" id="2861175">c</span><span class="op" id="2861176">.</span><span class="ident" id="2861177">state</span>&nbsp;<span class="op" id="2861183">==</span>&nbsp;<span class="ident" id="2861186">stateRCDATA</span>&nbsp;<span class="op" id="2861198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2861202">b</span><span class="op" id="2861203">.</span><span class="ident" id="2861204">Write</span><span class="op" id="2861209">(</span><span class="ident" id="2861210">s</span><span class="op" id="2861211">[</span><span class="ident" id="2861212">i</span><span class="op" id="2861213">:</span><span class="op" id="2861214">]</span><span class="op" id="2861215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861221">return</span>&nbsp;<span class="ident" id="2861228">b</span><span class="op" id="2861229">.</span><span class="ident" id="2861230">String</span><span class="op" id="2861236">(</span><span class="op" id="2861237">)</span><br>
<span class="lineno">215</span><span class="op" id="2861239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2861242">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2861316">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2861348">func</span>&nbsp;<span class="ident" id="2861353">htmlNameFilter</span><span class="op" id="2861367">(</span><span class="ident" id="2861368">args</span>&nbsp;<span class="op" id="2861373">...</span><span class="keyword" id="2861376">interface</span><span class="op" id="2861385">{</span><span class="op" id="2861386">}</span><span class="op" id="2861387">)</span>&nbsp;<span class="builtintype" id="2861389">string</span>&nbsp;<span class="op" id="2861396">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2861399">s</span><span class="op" id="2861400">,</span>&nbsp;<span class="ident" id="2861402">t</span>&nbsp;<span class="op" id="2861404">:=</span>&nbsp;<span class="ident" id="2861407">stringify</span><span class="op" id="2861416">(</span><span class="ident" id="2861417">args</span><span class="op" id="2861421">...</span><span class="op" id="2861424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861427">if</span>&nbsp;<span class="ident" id="2861430">t</span>&nbsp;<span class="op" id="2861432">==</span>&nbsp;<span class="ident" id="2861435">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="2861455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861459">return</span>&nbsp;<span class="ident" id="2861466">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861472">if</span>&nbsp;<span class="builtinfunc" id="2861475">len</span><span class="op" id="2861478">(</span><span class="ident" id="2861479">s</span><span class="op" id="2861480">)</span>&nbsp;<span class="op" id="2861482">==</span>&nbsp;<span class="num" id="2861485">0</span>&nbsp;<span class="op" id="2861487">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861491">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861539">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861575">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861633">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861694">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861709">return</span>&nbsp;<span class="ident" id="2861716">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2861735">s</span>&nbsp;<span class="op" id="2861737">=</span>&nbsp;<span class="ident" id="2861739">strings</span><span class="op" id="2861746">.</span><span class="ident" id="2861747">ToLower</span><span class="op" id="2861754">(</span><span class="ident" id="2861755">s</span><span class="op" id="2861756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861759">if</span>&nbsp;<span class="ident" id="2861762">t</span>&nbsp;<span class="op" id="2861764">:=</span>&nbsp;<span class="ident" id="2861767">attrType</span><span class="op" id="2861775">(</span><span class="ident" id="2861776">s</span><span class="op" id="2861777">)</span><span class="op" id="2861778">;</span>&nbsp;<span class="ident" id="2861780">t</span>&nbsp;<span class="op" id="2861782">!=</span>&nbsp;<span class="ident" id="2861785">contentTypePlain</span>&nbsp;<span class="op" id="2861802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861806">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2861878">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861895">return</span>&nbsp;<span class="ident" id="2861902">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2861918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861921">for</span>&nbsp;<span class="ident" id="2861925">_</span><span class="op" id="2861926">,</span>&nbsp;<span class="ident" id="2861928">r</span>&nbsp;<span class="op" id="2861930">:=</span>&nbsp;<span class="keyword" id="2861933">range</span>&nbsp;<span class="ident" id="2861939">s</span>&nbsp;<span class="op" id="2861941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861945">switch</span>&nbsp;<span class="op" id="2861952">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861956">case</span>&nbsp;<span class="string" id="2861961">&#39;0&#39;</span>&nbsp;<span class="op" id="2861965">&lt;=</span>&nbsp;<span class="ident" id="2861968">r</span>&nbsp;<span class="op" id="2861970">&amp;&amp;</span>&nbsp;<span class="ident" id="2861973">r</span>&nbsp;<span class="op" id="2861975">&lt;=</span>&nbsp;<span class="string" id="2861978">&#39;9&#39;</span><span class="op" id="2861981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2861985">case</span>&nbsp;<span class="string" id="2861990">&#39;a&#39;</span>&nbsp;<span class="op" id="2861994">&lt;=</span>&nbsp;<span class="ident" id="2861997">r</span>&nbsp;<span class="op" id="2861999">&amp;&amp;</span>&nbsp;<span class="ident" id="2862002">r</span>&nbsp;<span class="op" id="2862004">&lt;=</span>&nbsp;<span class="string" id="2862007">&#39;z&#39;</span><span class="op" id="2862010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2862014">default</span><span class="op" id="2862021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2862026">return</span>&nbsp;<span class="ident" id="2862033">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2862050">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2862053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2862056">return</span>&nbsp;<span class="ident" id="2862063">s</span><br>
<span class="lineno"></span><span class="op" id="2862065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2862068">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="2862132">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2862198">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="2862275">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="2862314">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2862389">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="2862419">func</span>&nbsp;<span class="ident" id="2862424">commentEscaper</span><span class="op" id="2862438">(</span><span class="ident" id="2862439">args</span>&nbsp;<span class="op" id="2862444">...</span><span class="keyword" id="2862447">interface</span><span class="op" id="2862456">{</span><span class="op" id="2862457">}</span><span class="op" id="2862458">)</span>&nbsp;<span class="builtintype" id="2862460">string</span>&nbsp;<span class="op" id="2862467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2862470">return</span>&nbsp;<span class="string" id="2862477">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="2862480">}</span>
</div>
</body>
</html>
