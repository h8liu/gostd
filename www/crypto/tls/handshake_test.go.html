<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7858122">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7858177">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7858231">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7858282">package</span>&nbsp;<span class="ident" id="7858290">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7858295">import</span>&nbsp;<span class="op" id="7858302">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858305">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858314">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858330">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858340">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858348">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858355">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858361">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858374">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858381">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858392">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7858403">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7858410">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7858413">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7858488">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7858565">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7858644">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7858703">//</span><br>
<span class="lineno"></span><span class="comment" id="7858706">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7858780">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7858858">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7858934">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7859001">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7859020">//</span><br>
<span class="lineno"></span><span class="comment" id="7859023">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7859102">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7859182">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7859260">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7859339">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7859358">var</span>&nbsp;<span class="ident" id="7859362">update</span>&nbsp;<span class="op" id="7859369">=</span>&nbsp;<span class="ident" id="7859371">flag</span><span class="op" id="7859375">.</span><span class="ident" id="7859376">Bool</span><span class="op" id="7859380">(</span><span class="string" id="7859381">&#34;update&#34;</span><span class="op" id="7859389">,</span>&nbsp;<span class="ident" id="7859391">false</span><span class="op" id="7859396">,</span>&nbsp;<span class="string" id="7859398">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7859427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7859430">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7859510">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7859584">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7859602">type</span>&nbsp;<span class="ident" id="7859607">recordingConn</span>&nbsp;<span class="keyword" id="7859621">struct</span>&nbsp;<span class="op" id="7859628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859631">net</span><span class="op" id="7859634">.</span><span class="ident" id="7859635">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859641">sync</span><span class="op" id="7859645">.</span><span class="ident" id="7859646">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859653">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7859661">[</span><span class="op" id="7859662">]</span><span class="op" id="7859663">[</span><span class="op" id="7859664">]</span><span class="builtintype" id="7859665">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859671">reading</span>&nbsp;<span class="builtintype" id="7859679">bool</span><br>
<span class="lineno"></span><span class="op" id="7859684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7859687">func</span>&nbsp;<span class="op" id="7859692">(</span><span class="ident" id="7859693">r</span>&nbsp;<span class="op" id="7859695">*</span><span class="ident" id="7859696">recordingConn</span><span class="op" id="7859709">)</span>&nbsp;<span class="ident" id="7859711">Read</span><span class="op" id="7859715">(</span><span class="ident" id="7859716">b</span>&nbsp;<span class="op" id="7859718">[</span><span class="op" id="7859719">]</span><span class="builtintype" id="7859720">byte</span><span class="op" id="7859724">)</span>&nbsp;<span class="op" id="7859726">(</span><span class="ident" id="7859727">n</span>&nbsp;<span class="builtintype" id="7859729">int</span><span class="op" id="7859732">,</span>&nbsp;<span class="ident" id="7859734">err</span>&nbsp;<span class="builtintype" id="7859738">error</span><span class="op" id="7859743">)</span>&nbsp;<span class="op" id="7859745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859748">if</span>&nbsp;<span class="ident" id="7859751">n</span><span class="op" id="7859752">,</span>&nbsp;<span class="ident" id="7859754">err</span>&nbsp;<span class="op" id="7859758">=</span>&nbsp;<span class="ident" id="7859760">r</span><span class="op" id="7859761">.</span><span class="ident" id="7859762">Conn</span><span class="op" id="7859766">.</span><span class="ident" id="7859767">Read</span><span class="op" id="7859771">(</span><span class="ident" id="7859772">b</span><span class="op" id="7859773">)</span><span class="op" id="7859774">;</span>&nbsp;<span class="ident" id="7859776">n</span>&nbsp;<span class="op" id="7859778">==</span>&nbsp;<span class="num" id="7859781">0</span>&nbsp;<span class="op" id="7859783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859798">b</span>&nbsp;<span class="op" id="7859800">=</span>&nbsp;<span class="ident" id="7859802">b</span><span class="op" id="7859803">[</span><span class="op" id="7859804">:</span><span class="ident" id="7859805">n</span><span class="op" id="7859806">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859810">r</span><span class="op" id="7859811">.</span><span class="ident" id="7859812">Lock</span><span class="op" id="7859816">(</span><span class="op" id="7859817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859820">defer</span>&nbsp;<span class="ident" id="7859826">r</span><span class="op" id="7859827">.</span><span class="ident" id="7859828">Unlock</span><span class="op" id="7859834">(</span><span class="op" id="7859835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859839">if</span>&nbsp;<span class="ident" id="7859842">l</span>&nbsp;<span class="op" id="7859844">:=</span>&nbsp;<span class="builtinfunc" id="7859847">len</span><span class="op" id="7859850">(</span><span class="ident" id="7859851">r</span><span class="op" id="7859852">.</span><span class="ident" id="7859853">flows</span><span class="op" id="7859858">)</span><span class="op" id="7859859">;</span>&nbsp;<span class="ident" id="7859861">l</span>&nbsp;<span class="op" id="7859863">==</span>&nbsp;<span class="num" id="7859866">0</span>&nbsp;<span class="op" id="7859868">||</span>&nbsp;<span class="op" id="7859871">!</span><span class="ident" id="7859872">r</span><span class="op" id="7859873">.</span><span class="ident" id="7859874">reading</span>&nbsp;<span class="op" id="7859882">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859886">buf</span>&nbsp;<span class="op" id="7859890">:=</span>&nbsp;<span class="builtinfunc" id="7859893">make</span><span class="op" id="7859897">(</span><span class="op" id="7859898">[</span><span class="op" id="7859899">]</span><span class="builtintype" id="7859900">byte</span><span class="op" id="7859904">,</span>&nbsp;<span class="builtinfunc" id="7859906">len</span><span class="op" id="7859909">(</span><span class="ident" id="7859910">b</span><span class="op" id="7859911">)</span><span class="op" id="7859912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7859916">copy</span><span class="op" id="7859920">(</span><span class="ident" id="7859921">buf</span><span class="op" id="7859924">,</span>&nbsp;<span class="ident" id="7859926">b</span><span class="op" id="7859927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859931">r</span><span class="op" id="7859932">.</span><span class="ident" id="7859933">flows</span>&nbsp;<span class="op" id="7859939">=</span>&nbsp;<span class="builtinfunc" id="7859941">append</span><span class="op" id="7859947">(</span><span class="ident" id="7859948">r</span><span class="op" id="7859949">.</span><span class="ident" id="7859950">flows</span><span class="op" id="7859955">,</span>&nbsp;<span class="ident" id="7859957">buf</span><span class="op" id="7859960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859963">}</span>&nbsp;<span class="keyword" id="7859965">else</span>&nbsp;<span class="op" id="7859970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859974">r</span><span class="op" id="7859975">.</span><span class="ident" id="7859976">flows</span><span class="op" id="7859981">[</span><span class="ident" id="7859982">l</span><span class="op" id="7859983">-</span><span class="num" id="7859984">1</span><span class="op" id="7859985">]</span>&nbsp;<span class="op" id="7859987">=</span>&nbsp;<span class="builtinfunc" id="7859989">append</span><span class="op" id="7859995">(</span><span class="ident" id="7859996">r</span><span class="op" id="7859997">.</span><span class="ident" id="7859998">flows</span><span class="op" id="7860003">[</span><span class="ident" id="7860004">l</span><span class="op" id="7860005">-</span><span class="num" id="7860006">1</span><span class="op" id="7860007">]</span><span class="op" id="7860008">,</span>&nbsp;<span class="ident" id="7860010">b</span><span class="op" id="7860011">[</span><span class="op" id="7860012">:</span><span class="ident" id="7860013">n</span><span class="op" id="7860014">]</span><span class="op" id="7860015">...</span><span class="op" id="7860018">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860024">r</span><span class="op" id="7860025">.</span><span class="ident" id="7860026">reading</span>&nbsp;<span class="op" id="7860034">=</span>&nbsp;<span class="ident" id="7860036">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860042">return</span><br>
<span class="lineno"></span><span class="op" id="7860049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7860052">func</span>&nbsp;<span class="op" id="7860057">(</span><span class="ident" id="7860058">r</span>&nbsp;<span class="op" id="7860060">*</span><span class="ident" id="7860061">recordingConn</span><span class="op" id="7860074">)</span>&nbsp;<span class="ident" id="7860076">Write</span><span class="op" id="7860081">(</span><span class="ident" id="7860082">b</span>&nbsp;<span class="op" id="7860084">[</span><span class="op" id="7860085">]</span><span class="builtintype" id="7860086">byte</span><span class="op" id="7860090">)</span>&nbsp;<span class="op" id="7860092">(</span><span class="ident" id="7860093">n</span>&nbsp;<span class="builtintype" id="7860095">int</span><span class="op" id="7860098">,</span>&nbsp;<span class="ident" id="7860100">err</span>&nbsp;<span class="builtintype" id="7860104">error</span><span class="op" id="7860109">)</span>&nbsp;<span class="op" id="7860111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860114">if</span>&nbsp;<span class="ident" id="7860117">n</span><span class="op" id="7860118">,</span>&nbsp;<span class="ident" id="7860120">err</span>&nbsp;<span class="op" id="7860124">=</span>&nbsp;<span class="ident" id="7860126">r</span><span class="op" id="7860127">.</span><span class="ident" id="7860128">Conn</span><span class="op" id="7860132">.</span><span class="ident" id="7860133">Write</span><span class="op" id="7860138">(</span><span class="ident" id="7860139">b</span><span class="op" id="7860140">)</span><span class="op" id="7860141">;</span>&nbsp;<span class="ident" id="7860143">n</span>&nbsp;<span class="op" id="7860145">==</span>&nbsp;<span class="num" id="7860148">0</span>&nbsp;<span class="op" id="7860150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860154">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860165">b</span>&nbsp;<span class="op" id="7860167">=</span>&nbsp;<span class="ident" id="7860169">b</span><span class="op" id="7860170">[</span><span class="op" id="7860171">:</span><span class="ident" id="7860172">n</span><span class="op" id="7860173">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860177">r</span><span class="op" id="7860178">.</span><span class="ident" id="7860179">Lock</span><span class="op" id="7860183">(</span><span class="op" id="7860184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860187">defer</span>&nbsp;<span class="ident" id="7860193">r</span><span class="op" id="7860194">.</span><span class="ident" id="7860195">Unlock</span><span class="op" id="7860201">(</span><span class="op" id="7860202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860206">if</span>&nbsp;<span class="ident" id="7860209">l</span>&nbsp;<span class="op" id="7860211">:=</span>&nbsp;<span class="builtinfunc" id="7860214">len</span><span class="op" id="7860217">(</span><span class="ident" id="7860218">r</span><span class="op" id="7860219">.</span><span class="ident" id="7860220">flows</span><span class="op" id="7860225">)</span><span class="op" id="7860226">;</span>&nbsp;<span class="ident" id="7860228">l</span>&nbsp;<span class="op" id="7860230">==</span>&nbsp;<span class="num" id="7860233">0</span>&nbsp;<span class="op" id="7860235">||</span>&nbsp;<span class="ident" id="7860238">r</span><span class="op" id="7860239">.</span><span class="ident" id="7860240">reading</span>&nbsp;<span class="op" id="7860248">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860252">buf</span>&nbsp;<span class="op" id="7860256">:=</span>&nbsp;<span class="builtinfunc" id="7860259">make</span><span class="op" id="7860263">(</span><span class="op" id="7860264">[</span><span class="op" id="7860265">]</span><span class="builtintype" id="7860266">byte</span><span class="op" id="7860270">,</span>&nbsp;<span class="builtinfunc" id="7860272">len</span><span class="op" id="7860275">(</span><span class="ident" id="7860276">b</span><span class="op" id="7860277">)</span><span class="op" id="7860278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7860282">copy</span><span class="op" id="7860286">(</span><span class="ident" id="7860287">buf</span><span class="op" id="7860290">,</span>&nbsp;<span class="ident" id="7860292">b</span><span class="op" id="7860293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860297">r</span><span class="op" id="7860298">.</span><span class="ident" id="7860299">flows</span>&nbsp;<span class="op" id="7860305">=</span>&nbsp;<span class="builtinfunc" id="7860307">append</span><span class="op" id="7860313">(</span><span class="ident" id="7860314">r</span><span class="op" id="7860315">.</span><span class="ident" id="7860316">flows</span><span class="op" id="7860321">,</span>&nbsp;<span class="ident" id="7860323">buf</span><span class="op" id="7860326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860329">}</span>&nbsp;<span class="keyword" id="7860331">else</span>&nbsp;<span class="op" id="7860336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860340">r</span><span class="op" id="7860341">.</span><span class="ident" id="7860342">flows</span><span class="op" id="7860347">[</span><span class="ident" id="7860348">l</span><span class="op" id="7860349">-</span><span class="num" id="7860350">1</span><span class="op" id="7860351">]</span>&nbsp;<span class="op" id="7860353">=</span>&nbsp;<span class="builtinfunc" id="7860355">append</span><span class="op" id="7860361">(</span><span class="ident" id="7860362">r</span><span class="op" id="7860363">.</span><span class="ident" id="7860364">flows</span><span class="op" id="7860369">[</span><span class="ident" id="7860370">l</span><span class="op" id="7860371">-</span><span class="num" id="7860372">1</span><span class="op" id="7860373">]</span><span class="op" id="7860374">,</span>&nbsp;<span class="ident" id="7860376">b</span><span class="op" id="7860377">[</span><span class="op" id="7860378">:</span><span class="ident" id="7860379">n</span><span class="op" id="7860380">]</span><span class="op" id="7860381">...</span><span class="op" id="7860384">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860390">r</span><span class="op" id="7860391">.</span><span class="ident" id="7860392">reading</span>&nbsp;<span class="op" id="7860400">=</span>&nbsp;<span class="ident" id="7860402">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860409">return</span><br>
<span class="lineno"></span><span class="op" id="7860416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7860419">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7860493">func</span>&nbsp;<span class="op" id="7860498">(</span><span class="ident" id="7860499">r</span>&nbsp;<span class="op" id="7860501">*</span><span class="ident" id="7860502">recordingConn</span><span class="op" id="7860515">)</span>&nbsp;<span class="ident" id="7860517">WriteTo</span><span class="op" id="7860524">(</span><span class="ident" id="7860525">w</span>&nbsp;<span class="ident" id="7860527">io</span><span class="op" id="7860529">.</span><span class="ident" id="7860530">Writer</span><span class="op" id="7860536">)</span>&nbsp;<span class="op" id="7860538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7860541">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860593">clientToServer</span>&nbsp;<span class="op" id="7860608">:=</span>&nbsp;<span class="ident" id="7860611">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860618">for</span>&nbsp;<span class="ident" id="7860622">i</span><span class="op" id="7860623">,</span>&nbsp;<span class="ident" id="7860625">flow</span>&nbsp;<span class="op" id="7860630">:=</span>&nbsp;<span class="keyword" id="7860633">range</span>&nbsp;<span class="ident" id="7860639">r</span><span class="op" id="7860640">.</span><span class="ident" id="7860641">flows</span>&nbsp;<span class="op" id="7860647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860651">source</span><span class="op" id="7860657">,</span>&nbsp;<span class="ident" id="7860659">dest</span>&nbsp;<span class="op" id="7860664">:=</span>&nbsp;<span class="string" id="7860667">&#34;client&#34;</span><span class="op" id="7860675">,</span>&nbsp;<span class="string" id="7860677">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860688">if</span>&nbsp;<span class="op" id="7860691">!</span><span class="ident" id="7860692">clientToServer</span>&nbsp;<span class="op" id="7860707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860712">source</span><span class="op" id="7860718">,</span>&nbsp;<span class="ident" id="7860720">dest</span>&nbsp;<span class="op" id="7860725">=</span>&nbsp;<span class="ident" id="7860727">dest</span><span class="op" id="7860731">,</span>&nbsp;<span class="ident" id="7860733">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860742">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860746">fmt</span><span class="op" id="7860749">.</span><span class="ident" id="7860750">Fprintf</span><span class="op" id="7860757">(</span><span class="ident" id="7860758">w</span><span class="op" id="7860759">,</span>&nbsp;<span class="string" id="7860761">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7860787">,</span>&nbsp;<span class="ident" id="7860789">i</span><span class="op" id="7860790">+</span><span class="num" id="7860791">1</span><span class="op" id="7860792">,</span>&nbsp;<span class="ident" id="7860794">source</span><span class="op" id="7860800">,</span>&nbsp;<span class="ident" id="7860802">dest</span><span class="op" id="7860806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860810">dumper</span>&nbsp;<span class="op" id="7860817">:=</span>&nbsp;<span class="ident" id="7860820">hex</span><span class="op" id="7860823">.</span><span class="ident" id="7860824">Dumper</span><span class="op" id="7860830">(</span><span class="ident" id="7860831">w</span><span class="op" id="7860832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860836">dumper</span><span class="op" id="7860842">.</span><span class="ident" id="7860843">Write</span><span class="op" id="7860848">(</span><span class="ident" id="7860849">flow</span><span class="op" id="7860853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860857">dumper</span><span class="op" id="7860863">.</span><span class="ident" id="7860864">Close</span><span class="op" id="7860869">(</span><span class="op" id="7860870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860874">clientToServer</span>&nbsp;<span class="op" id="7860889">=</span>&nbsp;<span class="op" id="7860891">!</span><span class="ident" id="7860892">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860908">}</span><br>
<span class="lineno"></span><span class="op" id="7860910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7860913">func</span>&nbsp;<span class="ident" id="7860918">parseTestData</span><span class="op" id="7860931">(</span><span class="ident" id="7860932">r</span>&nbsp;<span class="ident" id="7860934">io</span><span class="op" id="7860936">.</span><span class="ident" id="7860937">Reader</span><span class="op" id="7860943">)</span>&nbsp;<span class="op" id="7860945">(</span><span class="ident" id="7860946">flows</span>&nbsp;<span class="op" id="7860952">[</span><span class="op" id="7860953">]</span><span class="op" id="7860954">[</span><span class="op" id="7860955">]</span><span class="builtintype" id="7860956">byte</span><span class="op" id="7860960">,</span>&nbsp;<span class="ident" id="7860962">err</span>&nbsp;<span class="builtintype" id="7860966">error</span><span class="op" id="7860971">)</span>&nbsp;<span class="op" id="7860973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860976">var</span>&nbsp;<span class="ident" id="7860980">currentFlow</span>&nbsp;<span class="op" id="7860992">[</span><span class="op" id="7860993">]</span><span class="builtintype" id="7860994">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861001">scanner</span>&nbsp;<span class="op" id="7861009">:=</span>&nbsp;<span class="ident" id="7861012">bufio</span><span class="op" id="7861017">.</span><span class="ident" id="7861018">NewScanner</span><span class="op" id="7861028">(</span><span class="ident" id="7861029">r</span><span class="op" id="7861030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861033">for</span>&nbsp;<span class="ident" id="7861037">scanner</span><span class="op" id="7861044">.</span><span class="ident" id="7861045">Scan</span><span class="op" id="7861049">(</span><span class="op" id="7861050">)</span>&nbsp;<span class="op" id="7861052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861056">line</span>&nbsp;<span class="op" id="7861061">:=</span>&nbsp;<span class="ident" id="7861064">scanner</span><span class="op" id="7861071">.</span><span class="ident" id="7861072">Text</span><span class="op" id="7861076">(</span><span class="op" id="7861077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7861081">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7861145">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861165">if</span>&nbsp;<span class="ident" id="7861168">strings</span><span class="op" id="7861175">.</span><span class="ident" id="7861176">HasPrefix</span><span class="op" id="7861185">(</span><span class="ident" id="7861186">line</span><span class="op" id="7861190">,</span>&nbsp;<span class="string" id="7861192">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7861198">)</span>&nbsp;<span class="op" id="7861200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861205">if</span>&nbsp;<span class="builtinfunc" id="7861208">len</span><span class="op" id="7861211">(</span><span class="ident" id="7861212">currentFlow</span><span class="op" id="7861223">)</span>&nbsp;<span class="op" id="7861225">&gt;</span>&nbsp;<span class="num" id="7861227">0</span>&nbsp;<span class="op" id="7861229">||</span>&nbsp;<span class="builtinfunc" id="7861232">len</span><span class="op" id="7861235">(</span><span class="ident" id="7861236">flows</span><span class="op" id="7861241">)</span>&nbsp;<span class="op" id="7861243">&gt;</span>&nbsp;<span class="num" id="7861245">0</span>&nbsp;<span class="op" id="7861247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861253">flows</span>&nbsp;<span class="op" id="7861259">=</span>&nbsp;<span class="builtinfunc" id="7861261">append</span><span class="op" id="7861267">(</span><span class="ident" id="7861268">flows</span><span class="op" id="7861273">,</span>&nbsp;<span class="ident" id="7861275">currentFlow</span><span class="op" id="7861286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861292">currentFlow</span>&nbsp;<span class="op" id="7861304">=</span>&nbsp;<span class="ident" id="7861306">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861318">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7861334">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7861397">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7861450">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861512">if</span>&nbsp;<span class="ident" id="7861515">i</span>&nbsp;<span class="op" id="7861517">:=</span>&nbsp;<span class="ident" id="7861520">strings</span><span class="op" id="7861527">.</span><span class="ident" id="7861528">IndexByte</span><span class="op" id="7861537">(</span><span class="ident" id="7861538">line</span><span class="op" id="7861542">,</span>&nbsp;<span class="string" id="7861544">&#39;&nbsp;&#39;</span><span class="op" id="7861547">)</span><span class="op" id="7861548">;</span>&nbsp;<span class="ident" id="7861550">i</span>&nbsp;<span class="op" id="7861552">&gt;=</span>&nbsp;<span class="num" id="7861555">0</span>&nbsp;<span class="op" id="7861557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861562">line</span>&nbsp;<span class="op" id="7861567">=</span>&nbsp;<span class="ident" id="7861569">line</span><span class="op" id="7861573">[</span><span class="ident" id="7861574">i</span><span class="op" id="7861575">:</span><span class="op" id="7861576">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861580">}</span>&nbsp;<span class="keyword" id="7861582">else</span>&nbsp;<span class="op" id="7861587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861592">return</span>&nbsp;<span class="ident" id="7861599">nil</span><span class="op" id="7861602">,</span>&nbsp;<span class="ident" id="7861604">errors</span><span class="op" id="7861610">.</span><span class="ident" id="7861611">New</span><span class="op" id="7861614">(</span><span class="string" id="7861615">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7861634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861643">if</span>&nbsp;<span class="ident" id="7861646">i</span>&nbsp;<span class="op" id="7861648">:=</span>&nbsp;<span class="ident" id="7861651">strings</span><span class="op" id="7861658">.</span><span class="ident" id="7861659">IndexByte</span><span class="op" id="7861668">(</span><span class="ident" id="7861669">line</span><span class="op" id="7861673">,</span>&nbsp;<span class="string" id="7861675">&#39;|&#39;</span><span class="op" id="7861678">)</span><span class="op" id="7861679">;</span>&nbsp;<span class="ident" id="7861681">i</span>&nbsp;<span class="op" id="7861683">&gt;=</span>&nbsp;<span class="num" id="7861686">0</span>&nbsp;<span class="op" id="7861688">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861693">line</span>&nbsp;<span class="op" id="7861698">=</span>&nbsp;<span class="ident" id="7861700">line</span><span class="op" id="7861704">[</span><span class="op" id="7861705">:</span><span class="ident" id="7861706">i</span><span class="op" id="7861707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861711">}</span>&nbsp;<span class="keyword" id="7861713">else</span>&nbsp;<span class="op" id="7861718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861723">return</span>&nbsp;<span class="ident" id="7861730">nil</span><span class="op" id="7861733">,</span>&nbsp;<span class="ident" id="7861735">errors</span><span class="op" id="7861741">.</span><span class="ident" id="7861742">New</span><span class="op" id="7861745">(</span><span class="string" id="7861746">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7861765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861774">hexBytes</span>&nbsp;<span class="op" id="7861783">:=</span>&nbsp;<span class="ident" id="7861786">strings</span><span class="op" id="7861793">.</span><span class="ident" id="7861794">Fields</span><span class="op" id="7861800">(</span><span class="ident" id="7861801">line</span><span class="op" id="7861805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861809">for</span>&nbsp;<span class="ident" id="7861813">_</span><span class="op" id="7861814">,</span>&nbsp;<span class="ident" id="7861816">hexByte</span>&nbsp;<span class="op" id="7861824">:=</span>&nbsp;<span class="keyword" id="7861827">range</span>&nbsp;<span class="ident" id="7861833">hexBytes</span>&nbsp;<span class="op" id="7861842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861847">val</span><span class="op" id="7861850">,</span>&nbsp;<span class="ident" id="7861852">err</span>&nbsp;<span class="op" id="7861856">:=</span>&nbsp;<span class="ident" id="7861859">strconv</span><span class="op" id="7861866">.</span><span class="ident" id="7861867">ParseUint</span><span class="op" id="7861876">(</span><span class="ident" id="7861877">hexByte</span><span class="op" id="7861884">,</span>&nbsp;<span class="num" id="7861886">16</span><span class="op" id="7861888">,</span>&nbsp;<span class="num" id="7861890">8</span><span class="op" id="7861891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861896">if</span>&nbsp;<span class="ident" id="7861899">err</span>&nbsp;<span class="op" id="7861903">!=</span>&nbsp;<span class="ident" id="7861906">nil</span>&nbsp;<span class="op" id="7861910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861916">return</span>&nbsp;<span class="ident" id="7861923">nil</span><span class="op" id="7861926">,</span>&nbsp;<span class="ident" id="7861928">errors</span><span class="op" id="7861934">.</span><span class="ident" id="7861935">New</span><span class="op" id="7861938">(</span><span class="string" id="7861939">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7861973">+</span>&nbsp;<span class="ident" id="7861975">err</span><span class="op" id="7861978">.</span><span class="ident" id="7861979">Error</span><span class="op" id="7861984">(</span><span class="op" id="7861985">)</span><span class="op" id="7861986">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861996">currentFlow</span>&nbsp;<span class="op" id="7862008">=</span>&nbsp;<span class="builtinfunc" id="7862010">append</span><span class="op" id="7862016">(</span><span class="ident" id="7862017">currentFlow</span><span class="op" id="7862028">,</span>&nbsp;<span class="builtintype" id="7862030">byte</span><span class="op" id="7862034">(</span><span class="ident" id="7862035">val</span><span class="op" id="7862038">)</span><span class="op" id="7862039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862050">if</span>&nbsp;<span class="builtinfunc" id="7862053">len</span><span class="op" id="7862056">(</span><span class="ident" id="7862057">currentFlow</span><span class="op" id="7862068">)</span>&nbsp;<span class="op" id="7862070">&gt;</span>&nbsp;<span class="num" id="7862072">0</span>&nbsp;<span class="op" id="7862074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862078">flows</span>&nbsp;<span class="op" id="7862084">=</span>&nbsp;<span class="builtinfunc" id="7862086">append</span><span class="op" id="7862092">(</span><span class="ident" id="7862093">flows</span><span class="op" id="7862098">,</span>&nbsp;<span class="ident" id="7862100">currentFlow</span><span class="op" id="7862111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862118">return</span>&nbsp;<span class="ident" id="7862125">flows</span><span class="op" id="7862130">,</span>&nbsp;<span class="ident" id="7862132">nil</span><br>
<span class="lineno">155</span><span class="op" id="7862136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7862139">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7862213">func</span>&nbsp;<span class="ident" id="7862218">tempFile</span><span class="op" id="7862226">(</span><span class="ident" id="7862227">contents</span>&nbsp;<span class="builtintype" id="7862236">string</span><span class="op" id="7862242">)</span>&nbsp;<span class="builtintype" id="7862244">string</span>&nbsp;<span class="op" id="7862251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862254">file</span><span class="op" id="7862258">,</span>&nbsp;<span class="ident" id="7862260">err</span>&nbsp;<span class="op" id="7862264">:=</span>&nbsp;<span class="ident" id="7862267">ioutil</span><span class="op" id="7862273">.</span><span class="ident" id="7862274">TempFile</span><span class="op" id="7862282">(</span><span class="string" id="7862283">&#34;&#34;</span><span class="op" id="7862285">,</span>&nbsp;<span class="string" id="7862287">&#34;go-tls-test&#34;</span><span class="op" id="7862300">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862303">if</span>&nbsp;<span class="ident" id="7862306">err</span>&nbsp;<span class="op" id="7862310">!=</span>&nbsp;<span class="ident" id="7862313">nil</span>&nbsp;<span class="op" id="7862317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7862321">panic</span><span class="op" id="7862326">(</span><span class="string" id="7862327">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7862358">+</span>&nbsp;<span class="ident" id="7862360">err</span><span class="op" id="7862363">.</span><span class="ident" id="7862364">Error</span><span class="op" id="7862369">(</span><span class="op" id="7862370">)</span><span class="op" id="7862371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862377">path</span>&nbsp;<span class="op" id="7862382">:=</span>&nbsp;<span class="ident" id="7862385">file</span><span class="op" id="7862389">.</span><span class="ident" id="7862390">Name</span><span class="op" id="7862394">(</span><span class="op" id="7862395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862398">file</span><span class="op" id="7862402">.</span><span class="ident" id="7862403">WriteString</span><span class="op" id="7862414">(</span><span class="ident" id="7862415">contents</span><span class="op" id="7862423">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862426">file</span><span class="op" id="7862430">.</span><span class="ident" id="7862431">Close</span><span class="op" id="7862436">(</span><span class="op" id="7862437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862440">return</span>&nbsp;<span class="ident" id="7862447">path</span><br>
<span class="lineno"></span><span class="op" id="7862452">}</span>
</div>
</body>
</html>
