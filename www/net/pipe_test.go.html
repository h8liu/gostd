<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7942607">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7942663">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7942717">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7942768">package</span>&nbsp;<span class="ident" id="7942776">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942781">import</span>&nbsp;<span class="op" id="7942788">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942791">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942800">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942806">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7942816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942819">func</span>&nbsp;<span class="ident" id="7942824">checkWrite</span><span class="op" id="7942834">(</span><span class="ident" id="7942835">t</span>&nbsp;<span class="op" id="7942837">*</span><span class="ident" id="7942838"><a href="/net/pipe_test.go.html#7942806">testing</a></span><span class="op" id="7942845">.</span><span class="ident" id="7942846">T</span><span class="op" id="7942847">,</span>&nbsp;<span class="ident" id="7942849">w</span>&nbsp;<span class="ident" id="7942851"><a href="/net/pipe_test.go.html#7942800">io</a></span><span class="op" id="7942853">.</span><span class="ident" id="7942854">Writer</span><span class="op" id="7942860">,</span>&nbsp;<span class="ident" id="7942862">data</span>&nbsp;<span class="op" id="7942867">[</span><span class="op" id="7942868">]</span><span class="builtintype" id="7942869">byte</span><span class="op" id="7942873">,</span>&nbsp;<span class="ident" id="7942875">c</span>&nbsp;<span class="keyword" id="7942877">chan</span>&nbsp;<span class="builtintype" id="7942882">int</span><span class="op" id="7942885">)</span>&nbsp;<span class="op" id="7942887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942890">n</span><span class="op" id="7942891">,</span>&nbsp;<span class="ident" id="7942893">err</span>&nbsp;<span class="op" id="7942897">:=</span>&nbsp;<span class="ident" id="7942900"><a href="/net/pipe_test.go.html#7942849">w</a></span><span class="op" id="7942901">.</span><span class="ident" id="7942902">Write</span><span class="op" id="7942907">(</span><span class="ident" id="7942908"><a href="/net/pipe_test.go.html#7942862">data</a></span><span class="op" id="7942912">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942915">if</span>&nbsp;<span class="ident" id="7942918"><a href="/net/pipe_test.go.html#7942893">err</a></span>&nbsp;<span class="op" id="7942922">!=</span>&nbsp;<span class="ident" id="7942925">nil</span>&nbsp;<span class="op" id="7942929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942933"><a href="/net/pipe_test.go.html#7942835">t</a></span><span class="op" id="7942934">.</span><span class="ident" id="7942935">Errorf</span><span class="op" id="7942941">(</span><span class="string" id="7942942">&#34;write:&nbsp;%v&#34;</span><span class="op" id="7942953">,</span>&nbsp;<span class="ident" id="7942955"><a href="/net/pipe_test.go.html#7942893">err</a></span><span class="op" id="7942958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942964">if</span>&nbsp;<span class="ident" id="7942967"><a href="/net/pipe_test.go.html#7942890">n</a></span>&nbsp;<span class="op" id="7942969">!=</span>&nbsp;<span class="builtinfunc" id="7942972">len</span><span class="op" id="7942975">(</span><span class="ident" id="7942976"><a href="/net/pipe_test.go.html#7942862">data</a></span><span class="op" id="7942980">)</span>&nbsp;<span class="op" id="7942982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942986"><a href="/net/pipe_test.go.html#7942835">t</a></span><span class="op" id="7942987">.</span><span class="ident" id="7942988">Errorf</span><span class="op" id="7942994">(</span><span class="string" id="7942995">&#34;short&nbsp;write:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7943018">,</span>&nbsp;<span class="ident" id="7943020"><a href="/net/pipe_test.go.html#7942890">n</a></span><span class="op" id="7943021">,</span>&nbsp;<span class="builtinfunc" id="7943023">len</span><span class="op" id="7943026">(</span><span class="ident" id="7943027"><a href="/net/pipe_test.go.html#7942862">data</a></span><span class="op" id="7943031">)</span><span class="op" id="7943032">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943038"><a href="/net/pipe_test.go.html#7942875">c</a></span>&nbsp;<span class="op" id="7943040">&lt;-</span>&nbsp;<span class="num" id="7943043">0</span><br>
<span class="lineno"></span><span class="op" id="7943045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7943048">func</span>&nbsp;<span class="ident" id="7943053">checkRead</span><span class="op" id="7943062">(</span><span class="ident" id="7943063">t</span>&nbsp;<span class="op" id="7943065">*</span><span class="ident" id="7943066"><a href="/net/pipe_test.go.html#7942806">testing</a></span><span class="op" id="7943073">.</span><span class="ident" id="7943074">T</span><span class="op" id="7943075">,</span>&nbsp;<span class="ident" id="7943077">r</span>&nbsp;<span class="ident" id="7943079"><a href="/net/pipe_test.go.html#7942800">io</a></span><span class="op" id="7943081">.</span><span class="ident" id="7943082">Reader</span><span class="op" id="7943088">,</span>&nbsp;<span class="ident" id="7943090">data</span>&nbsp;<span class="op" id="7943095">[</span><span class="op" id="7943096">]</span><span class="builtintype" id="7943097">byte</span><span class="op" id="7943101">,</span>&nbsp;<span class="ident" id="7943103">wantErr</span>&nbsp;<span class="builtintype" id="7943111">error</span><span class="op" id="7943116">)</span>&nbsp;<span class="op" id="7943118">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943121">buf</span>&nbsp;<span class="op" id="7943125">:=</span>&nbsp;<span class="builtinfunc" id="7943128">make</span><span class="op" id="7943132">(</span><span class="op" id="7943133">[</span><span class="op" id="7943134">]</span><span class="builtintype" id="7943135">byte</span><span class="op" id="7943139">,</span>&nbsp;<span class="builtinfunc" id="7943141">len</span><span class="op" id="7943144">(</span><span class="ident" id="7943145"><a href="/net/pipe_test.go.html#7943090">data</a></span><span class="op" id="7943149">)</span><span class="op" id="7943150">+</span><span class="num" id="7943151">10</span><span class="op" id="7943153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943156">n</span><span class="op" id="7943157">,</span>&nbsp;<span class="ident" id="7943159">err</span>&nbsp;<span class="op" id="7943163">:=</span>&nbsp;<span class="ident" id="7943166"><a href="/net/pipe_test.go.html#7943077">r</a></span><span class="op" id="7943167">.</span><span class="ident" id="7943168">Read</span><span class="op" id="7943172">(</span><span class="ident" id="7943173"><a href="/net/pipe_test.go.html#7943121">buf</a></span><span class="op" id="7943176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943179">if</span>&nbsp;<span class="ident" id="7943182"><a href="/net/pipe_test.go.html#7943159">err</a></span>&nbsp;<span class="op" id="7943186">!=</span>&nbsp;<span class="ident" id="7943189"><a href="/net/pipe_test.go.html#7943103">wantErr</a></span>&nbsp;<span class="op" id="7943197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943201"><a href="/net/pipe_test.go.html#7943063">t</a></span><span class="op" id="7943202">.</span><span class="ident" id="7943203">Errorf</span><span class="op" id="7943209">(</span><span class="string" id="7943210">&#34;read:&nbsp;%v&#34;</span><span class="op" id="7943220">,</span>&nbsp;<span class="ident" id="7943222"><a href="/net/pipe_test.go.html#7943159">err</a></span><span class="op" id="7943225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943229">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943240">if</span>&nbsp;<span class="ident" id="7943243"><a href="/net/pipe_test.go.html#7943156">n</a></span>&nbsp;<span class="op" id="7943245">!=</span>&nbsp;<span class="builtinfunc" id="7943248">len</span><span class="op" id="7943251">(</span><span class="ident" id="7943252"><a href="/net/pipe_test.go.html#7943090">data</a></span><span class="op" id="7943256">)</span>&nbsp;<span class="op" id="7943258">||</span>&nbsp;<span class="op" id="7943261">!</span><span class="ident" id="7943262"><a href="/net/pipe_test.go.html#7942791">bytes</a></span><span class="op" id="7943267">.</span><span class="ident" id="7943268">Equal</span><span class="op" id="7943273">(</span><span class="ident" id="7943274"><a href="/net/pipe_test.go.html#7943121">buf</a></span><span class="op" id="7943277">[</span><span class="num" id="7943278">0</span><span class="op" id="7943279">:</span><span class="ident" id="7943280"><a href="/net/pipe_test.go.html#7943156">n</a></span><span class="op" id="7943281">]</span><span class="op" id="7943282">,</span>&nbsp;<span class="ident" id="7943284"><a href="/net/pipe_test.go.html#7943090">data</a></span><span class="op" id="7943288">)</span>&nbsp;<span class="op" id="7943290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943294"><a href="/net/pipe_test.go.html#7943063">t</a></span><span class="op" id="7943295">.</span><span class="ident" id="7943296">Errorf</span><span class="op" id="7943302">(</span><span class="string" id="7943303">&#34;bad&nbsp;read:&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7943321">,</span>&nbsp;<span class="ident" id="7943323"><a href="/net/pipe_test.go.html#7943121">buf</a></span><span class="op" id="7943326">[</span><span class="num" id="7943327">0</span><span class="op" id="7943328">:</span><span class="ident" id="7943329"><a href="/net/pipe_test.go.html#7943156">n</a></span><span class="op" id="7943330">]</span><span class="op" id="7943331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943335">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943343">}</span><br>
<span class="lineno">35</span><span class="op" id="7943345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7943348">//&nbsp;Test&nbsp;a&nbsp;simple&nbsp;read/write/close&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="7943392">//&nbsp;Assumes&nbsp;that&nbsp;the&nbsp;underlying&nbsp;io.Pipe&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7943446">//&nbsp;is&nbsp;solid&nbsp;and&nbsp;we&#39;re&nbsp;just&nbsp;testing&nbsp;the&nbsp;net&nbsp;wrapping.</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7943500">func</span>&nbsp;<span class="ident" id="7943505">TestPipe</span><span class="op" id="7943513">(</span><span class="ident" id="7943514">t</span>&nbsp;<span class="op" id="7943516">*</span><span class="ident" id="7943517"><a href="/net/pipe_test.go.html#7942806">testing</a></span><span class="op" id="7943524">.</span><span class="ident" id="7943525">T</span><span class="op" id="7943526">)</span>&nbsp;<span class="op" id="7943528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943531">c</span>&nbsp;<span class="op" id="7943533">:=</span>&nbsp;<span class="builtinfunc" id="7943536">make</span><span class="op" id="7943540">(</span><span class="keyword" id="7943541">chan</span>&nbsp;<span class="builtintype" id="7943546">int</span><span class="op" id="7943549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943552">cli</span><span class="op" id="7943555">,</span>&nbsp;<span class="ident" id="7943557">srv</span>&nbsp;<span class="op" id="7943561">:=</span>&nbsp;<span class="ident" id="7943564"><a href="/net/pipe.go.html#1480637">Pipe</a></span><span class="op" id="7943568">(</span><span class="op" id="7943569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943572">go</span>&nbsp;<span class="ident" id="7943575"><a href="/net/pipe_test.go.html#7942824">checkWrite</a></span><span class="op" id="7943585">(</span><span class="ident" id="7943586"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943587">,</span>&nbsp;<span class="ident" id="7943589"><a href="/net/pipe_test.go.html#7943552">cli</a></span><span class="op" id="7943592">,</span>&nbsp;<span class="op" id="7943594">[</span><span class="op" id="7943595">]</span><span class="builtintype" id="7943596">byte</span><span class="op" id="7943600">(</span><span class="string" id="7943601">&#34;hello,&nbsp;world&#34;</span><span class="op" id="7943615">)</span><span class="op" id="7943616">,</span>&nbsp;<span class="ident" id="7943618"><a href="/net/pipe_test.go.html#7943531">c</a></span><span class="op" id="7943619">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943622"><a href="/net/pipe_test.go.html#7943053">checkRead</a></span><span class="op" id="7943631">(</span><span class="ident" id="7943632"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943633">,</span>&nbsp;<span class="ident" id="7943635"><a href="/net/pipe_test.go.html#7943557">srv</a></span><span class="op" id="7943638">,</span>&nbsp;<span class="op" id="7943640">[</span><span class="op" id="7943641">]</span><span class="builtintype" id="7943642">byte</span><span class="op" id="7943646">(</span><span class="string" id="7943647">&#34;hello,&nbsp;world&#34;</span><span class="op" id="7943661">)</span><span class="op" id="7943662">,</span>&nbsp;<span class="ident" id="7943664">nil</span><span class="op" id="7943667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943670">&lt;-</span><span class="ident" id="7943672"><a href="/net/pipe_test.go.html#7943531">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943675">go</span>&nbsp;<span class="ident" id="7943678"><a href="/net/pipe_test.go.html#7942824">checkWrite</a></span><span class="op" id="7943688">(</span><span class="ident" id="7943689"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943690">,</span>&nbsp;<span class="ident" id="7943692"><a href="/net/pipe_test.go.html#7943557">srv</a></span><span class="op" id="7943695">,</span>&nbsp;<span class="op" id="7943697">[</span><span class="op" id="7943698">]</span><span class="builtintype" id="7943699">byte</span><span class="op" id="7943703">(</span><span class="string" id="7943704">&#34;line&nbsp;2&#34;</span><span class="op" id="7943712">)</span><span class="op" id="7943713">,</span>&nbsp;<span class="ident" id="7943715"><a href="/net/pipe_test.go.html#7943531">c</a></span><span class="op" id="7943716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943719"><a href="/net/pipe_test.go.html#7943053">checkRead</a></span><span class="op" id="7943728">(</span><span class="ident" id="7943729"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943730">,</span>&nbsp;<span class="ident" id="7943732"><a href="/net/pipe_test.go.html#7943552">cli</a></span><span class="op" id="7943735">,</span>&nbsp;<span class="op" id="7943737">[</span><span class="op" id="7943738">]</span><span class="builtintype" id="7943739">byte</span><span class="op" id="7943743">(</span><span class="string" id="7943744">&#34;line&nbsp;2&#34;</span><span class="op" id="7943752">)</span><span class="op" id="7943753">,</span>&nbsp;<span class="ident" id="7943755">nil</span><span class="op" id="7943758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943761">&lt;-</span><span class="ident" id="7943763"><a href="/net/pipe_test.go.html#7943531">c</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943766">go</span>&nbsp;<span class="ident" id="7943769"><a href="/net/pipe_test.go.html#7942824">checkWrite</a></span><span class="op" id="7943779">(</span><span class="ident" id="7943780"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943781">,</span>&nbsp;<span class="ident" id="7943783"><a href="/net/pipe_test.go.html#7943552">cli</a></span><span class="op" id="7943786">,</span>&nbsp;<span class="op" id="7943788">[</span><span class="op" id="7943789">]</span><span class="builtintype" id="7943790">byte</span><span class="op" id="7943794">(</span><span class="string" id="7943795">&#34;a&nbsp;third&nbsp;line&#34;</span><span class="op" id="7943809">)</span><span class="op" id="7943810">,</span>&nbsp;<span class="ident" id="7943812"><a href="/net/pipe_test.go.html#7943531">c</a></span><span class="op" id="7943813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943816"><a href="/net/pipe_test.go.html#7943053">checkRead</a></span><span class="op" id="7943825">(</span><span class="ident" id="7943826"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943827">,</span>&nbsp;<span class="ident" id="7943829"><a href="/net/pipe_test.go.html#7943557">srv</a></span><span class="op" id="7943832">,</span>&nbsp;<span class="op" id="7943834">[</span><span class="op" id="7943835">]</span><span class="builtintype" id="7943836">byte</span><span class="op" id="7943840">(</span><span class="string" id="7943841">&#34;a&nbsp;third&nbsp;line&#34;</span><span class="op" id="7943855">)</span><span class="op" id="7943856">,</span>&nbsp;<span class="ident" id="7943858">nil</span><span class="op" id="7943861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943864">&lt;-</span><span class="ident" id="7943866"><a href="/net/pipe_test.go.html#7943531">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943869">go</span>&nbsp;<span class="ident" id="7943872"><a href="/net/pipe_test.go.html#7943557">srv</a></span><span class="op" id="7943875">.</span><span class="ident" id="7943876">Close</span><span class="op" id="7943881">(</span><span class="op" id="7943882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943885"><a href="/net/pipe_test.go.html#7943053">checkRead</a></span><span class="op" id="7943894">(</span><span class="ident" id="7943895"><a href="/net/pipe_test.go.html#7943514">t</a></span><span class="op" id="7943896">,</span>&nbsp;<span class="ident" id="7943898"><a href="/net/pipe_test.go.html#7943552">cli</a></span><span class="op" id="7943901">,</span>&nbsp;<span class="ident" id="7943903">nil</span><span class="op" id="7943906">,</span>&nbsp;<span class="ident" id="7943908"><a href="/net/pipe_test.go.html#7942800">io</a></span><span class="op" id="7943910">.</span><span class="ident" id="7943911">EOF</span><span class="op" id="7943914">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943917"><a href="/net/pipe_test.go.html#7943552">cli</a></span><span class="op" id="7943920">.</span><span class="ident" id="7943921">Close</span><span class="op" id="7943926">(</span><span class="op" id="7943927">)</span><br>
<span class="lineno"></span><span class="op" id="7943929">}</span>
</div>
</body>
</html>
