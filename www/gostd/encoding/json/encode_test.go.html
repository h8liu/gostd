<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html" class="current">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7061636">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7061691">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7061745">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7061796">package</span>&nbsp;<span class="ident" id="7061804">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7061810">import</span>&nbsp;<span class="op" id="7061817">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7061820">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7061829">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7061837">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7061848">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7061859">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="7061869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7061872">type</span>&nbsp;<span class="ident" id="7061877">Optionals</span>&nbsp;<span class="keyword" id="7061887">struct</span>&nbsp;<span class="op" id="7061894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7061897">Sr</span>&nbsp;<span class="builtintype" id="7061900">string</span>&nbsp;<span class="string" id="7061907">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7061920">So</span>&nbsp;<span class="builtintype" id="7061923">string</span>&nbsp;<span class="string" id="7061930">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7061953">Sw</span>&nbsp;<span class="builtintype" id="7061956">string</span>&nbsp;<span class="string" id="7061963">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7061976">Ir</span>&nbsp;<span class="builtintype" id="7061979">int</span>&nbsp;<span class="string" id="7061983">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="7062002">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062046">Io</span>&nbsp;<span class="builtintype" id="7062049">int</span>&nbsp;<span class="string" id="7062053">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062077">Slr</span>&nbsp;<span class="op" id="7062081">[</span><span class="op" id="7062082">]</span><span class="builtintype" id="7062083">string</span>&nbsp;<span class="string" id="7062090">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062111">Slo</span>&nbsp;<span class="op" id="7062115">[</span><span class="op" id="7062116">]</span><span class="builtintype" id="7062117">string</span>&nbsp;<span class="string" id="7062124">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062149">Mr</span>&nbsp;<span class="keyword" id="7062152">map</span><span class="op" id="7062155">[</span><span class="builtintype" id="7062156">string</span><span class="op" id="7062162">]</span><span class="keyword" id="7062163">interface</span><span class="op" id="7062172">{</span><span class="op" id="7062173">}</span>&nbsp;<span class="string" id="7062175">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062188">Mo</span>&nbsp;<span class="keyword" id="7062191">map</span><span class="op" id="7062194">[</span><span class="builtintype" id="7062195">string</span><span class="op" id="7062201">]</span><span class="keyword" id="7062202">interface</span><span class="op" id="7062211">{</span><span class="op" id="7062212">}</span>&nbsp;<span class="string" id="7062214">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062236">Fr</span>&nbsp;<span class="builtintype" id="7062239">float64</span>&nbsp;<span class="string" id="7062247">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062260">Fo</span>&nbsp;<span class="builtintype" id="7062263">float64</span>&nbsp;<span class="string" id="7062271">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062295">Br</span>&nbsp;<span class="builtintype" id="7062298">bool</span>&nbsp;<span class="string" id="7062303">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062316">Bo</span>&nbsp;<span class="builtintype" id="7062319">bool</span>&nbsp;<span class="string" id="7062324">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062348">Ur</span>&nbsp;<span class="builtintype" id="7062351">uint</span>&nbsp;<span class="string" id="7062356">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062369">Uo</span>&nbsp;<span class="builtintype" id="7062372">uint</span>&nbsp;<span class="string" id="7062377">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062401">Str</span>&nbsp;<span class="keyword" id="7062405">struct</span><span class="op" id="7062411">{</span><span class="op" id="7062412">}</span>&nbsp;<span class="string" id="7062414">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062428">Sto</span>&nbsp;<span class="keyword" id="7062432">struct</span><span class="op" id="7062438">{</span><span class="op" id="7062439">}</span>&nbsp;<span class="string" id="7062441">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="7062464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7062467">var</span>&nbsp;<span class="ident" id="7062471">optionalsExpected</span>&nbsp;<span class="op" id="7062489">=</span>&nbsp;<span class="string" id="7062491">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7062608">func</span>&nbsp;<span class="ident" id="7062613">TestOmitEmpty</span><span class="op" id="7062626">(</span><span class="ident" id="7062627">t</span>&nbsp;<span class="op" id="7062629">*</span><span class="ident" id="7062630">testing</span><span class="op" id="7062637">.</span><span class="ident" id="7062638">T</span><span class="op" id="7062639">)</span>&nbsp;<span class="op" id="7062641">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7062644">var</span>&nbsp;<span class="ident" id="7062648">o</span>&nbsp;<span class="ident" id="7062650">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062661">o</span><span class="op" id="7062662">.</span><span class="ident" id="7062663">Sw</span>&nbsp;<span class="op" id="7062666">=</span>&nbsp;<span class="string" id="7062668">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062681">o</span><span class="op" id="7062682">.</span><span class="ident" id="7062683">Mr</span>&nbsp;<span class="op" id="7062686">=</span>&nbsp;<span class="keyword" id="7062688">map</span><span class="op" id="7062691">[</span><span class="builtintype" id="7062692">string</span><span class="op" id="7062698">]</span><span class="keyword" id="7062699">interface</span><span class="op" id="7062708">{</span><span class="op" id="7062709">}</span><span class="op" id="7062710">{</span><span class="op" id="7062711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062714">o</span><span class="op" id="7062715">.</span><span class="ident" id="7062716">Mo</span>&nbsp;<span class="op" id="7062719">=</span>&nbsp;<span class="keyword" id="7062721">map</span><span class="op" id="7062724">[</span><span class="builtintype" id="7062725">string</span><span class="op" id="7062731">]</span><span class="keyword" id="7062732">interface</span><span class="op" id="7062741">{</span><span class="op" id="7062742">}</span><span class="op" id="7062743">{</span><span class="op" id="7062744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062748">got</span><span class="op" id="7062751">,</span>&nbsp;<span class="ident" id="7062753">err</span>&nbsp;<span class="op" id="7062757">:=</span>&nbsp;<span class="ident" id="7062760">MarshalIndent</span><span class="op" id="7062773">(</span><span class="op" id="7062774">&amp;</span><span class="ident" id="7062775">o</span><span class="op" id="7062776">,</span>&nbsp;<span class="string" id="7062778">&#34;&#34;</span><span class="op" id="7062780">,</span>&nbsp;<span class="string" id="7062782">&#34;&nbsp;&#34;</span><span class="op" id="7062785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7062788">if</span>&nbsp;<span class="ident" id="7062791">err</span>&nbsp;<span class="op" id="7062795">!=</span>&nbsp;<span class="builtintype" id="7062798">nil</span>&nbsp;<span class="op" id="7062802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062806">t</span><span class="op" id="7062807">.</span><span class="ident" id="7062808">Fatal</span><span class="op" id="7062813">(</span><span class="ident" id="7062814">err</span><span class="op" id="7062817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7062820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7062823">if</span>&nbsp;<span class="ident" id="7062826">got</span>&nbsp;<span class="op" id="7062830">:=</span>&nbsp;<span class="builtintype" id="7062833">string</span><span class="op" id="7062839">(</span><span class="ident" id="7062840">got</span><span class="op" id="7062843">)</span><span class="op" id="7062844">;</span>&nbsp;<span class="ident" id="7062846">got</span>&nbsp;<span class="op" id="7062850">!=</span>&nbsp;<span class="ident" id="7062853">optionalsExpected</span>&nbsp;<span class="op" id="7062871">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062875">t</span><span class="op" id="7062876">.</span><span class="ident" id="7062877">Errorf</span><span class="op" id="7062883">(</span><span class="string" id="7062884">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="7062906">,</span>&nbsp;<span class="ident" id="7062908">got</span><span class="op" id="7062911">,</span>&nbsp;<span class="ident" id="7062913">optionalsExpected</span><span class="op" id="7062930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7062933">}</span><br>
<span class="lineno"></span><span class="op" id="7062935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7062938">type</span>&nbsp;<span class="ident" id="7062943">StringTag</span>&nbsp;<span class="keyword" id="7062953">struct</span>&nbsp;<span class="op" id="7062960">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062963">BoolStr</span>&nbsp;<span class="builtintype" id="7062971">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7062978">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7062996">IntStr</span>&nbsp;&nbsp;<span class="builtintype" id="7063004">int64</span>&nbsp;&nbsp;<span class="string" id="7063011">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063029">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="7063037">string</span>&nbsp;<span class="string" id="7063044">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7063061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7063064">var</span>&nbsp;<span class="ident" id="7063068">stringTagExpected</span>&nbsp;<span class="op" id="7063086">=</span>&nbsp;<span class="string" id="7063088">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7063155">func</span>&nbsp;<span class="ident" id="7063160">TestStringTag</span><span class="op" id="7063173">(</span><span class="ident" id="7063174">t</span>&nbsp;<span class="op" id="7063176">*</span><span class="ident" id="7063177">testing</span><span class="op" id="7063184">.</span><span class="ident" id="7063185">T</span><span class="op" id="7063186">)</span>&nbsp;<span class="op" id="7063188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063191">var</span>&nbsp;<span class="ident" id="7063195">s</span>&nbsp;<span class="ident" id="7063197">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063208">s</span><span class="op" id="7063209">.</span><span class="ident" id="7063210">BoolStr</span>&nbsp;<span class="op" id="7063218">=</span>&nbsp;<span class="builtintype" id="7063220">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063226">s</span><span class="op" id="7063227">.</span><span class="ident" id="7063228">IntStr</span>&nbsp;<span class="op" id="7063235">=</span>&nbsp;<span class="num" id="7063237">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063241">s</span><span class="op" id="7063242">.</span><span class="ident" id="7063243">StrStr</span>&nbsp;<span class="op" id="7063250">=</span>&nbsp;<span class="string" id="7063252">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063261">got</span><span class="op" id="7063264">,</span>&nbsp;<span class="ident" id="7063266">err</span>&nbsp;<span class="op" id="7063270">:=</span>&nbsp;<span class="ident" id="7063273">MarshalIndent</span><span class="op" id="7063286">(</span><span class="op" id="7063287">&amp;</span><span class="ident" id="7063288">s</span><span class="op" id="7063289">,</span>&nbsp;<span class="string" id="7063291">&#34;&#34;</span><span class="op" id="7063293">,</span>&nbsp;<span class="string" id="7063295">&#34;&nbsp;&#34;</span><span class="op" id="7063298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063301">if</span>&nbsp;<span class="ident" id="7063304">err</span>&nbsp;<span class="op" id="7063308">!=</span>&nbsp;<span class="builtintype" id="7063311">nil</span>&nbsp;<span class="op" id="7063315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063319">t</span><span class="op" id="7063320">.</span><span class="ident" id="7063321">Fatal</span><span class="op" id="7063326">(</span><span class="ident" id="7063327">err</span><span class="op" id="7063330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063333">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063336">if</span>&nbsp;<span class="ident" id="7063339">got</span>&nbsp;<span class="op" id="7063343">:=</span>&nbsp;<span class="builtintype" id="7063346">string</span><span class="op" id="7063352">(</span><span class="ident" id="7063353">got</span><span class="op" id="7063356">)</span><span class="op" id="7063357">;</span>&nbsp;<span class="ident" id="7063359">got</span>&nbsp;<span class="op" id="7063363">!=</span>&nbsp;<span class="ident" id="7063366">stringTagExpected</span>&nbsp;<span class="op" id="7063384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063388">t</span><span class="op" id="7063389">.</span><span class="ident" id="7063390">Fatalf</span><span class="op" id="7063396">(</span><span class="string" id="7063397">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="7063419">,</span>&nbsp;<span class="ident" id="7063421">got</span><span class="op" id="7063424">,</span>&nbsp;<span class="ident" id="7063426">stringTagExpected</span><span class="op" id="7063443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7063450">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063482">var</span>&nbsp;<span class="ident" id="7063486">s2</span>&nbsp;<span class="ident" id="7063489">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063500">err</span>&nbsp;<span class="op" id="7063504">=</span>&nbsp;<span class="ident" id="7063506">NewDecoder</span><span class="op" id="7063516">(</span><span class="ident" id="7063517">bytes</span><span class="op" id="7063522">.</span><span class="ident" id="7063523">NewReader</span><span class="op" id="7063532">(</span><span class="ident" id="7063533">got</span><span class="op" id="7063536">)</span><span class="op" id="7063537">)</span><span class="op" id="7063538">.</span><span class="ident" id="7063539">Decode</span><span class="op" id="7063545">(</span><span class="op" id="7063546">&amp;</span><span class="ident" id="7063547">s2</span><span class="op" id="7063549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063552">if</span>&nbsp;<span class="ident" id="7063555">err</span>&nbsp;<span class="op" id="7063559">!=</span>&nbsp;<span class="builtintype" id="7063562">nil</span>&nbsp;<span class="op" id="7063566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063570">t</span><span class="op" id="7063571">.</span><span class="ident" id="7063572">Fatalf</span><span class="op" id="7063578">(</span><span class="string" id="7063579">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7063591">,</span>&nbsp;<span class="ident" id="7063593">err</span><span class="op" id="7063596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063599">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063602">if</span>&nbsp;<span class="op" id="7063605">!</span><span class="ident" id="7063606">reflect</span><span class="op" id="7063613">.</span><span class="ident" id="7063614">DeepEqual</span><span class="op" id="7063623">(</span><span class="ident" id="7063624">s</span><span class="op" id="7063625">,</span>&nbsp;<span class="ident" id="7063627">s2</span><span class="op" id="7063629">)</span>&nbsp;<span class="op" id="7063631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063635">t</span><span class="op" id="7063636">.</span><span class="ident" id="7063637">Fatalf</span><span class="op" id="7063643">(</span><span class="string" id="7063644">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="7063709">,</span>&nbsp;<span class="ident" id="7063711">s</span><span class="op" id="7063712">,</span>&nbsp;<span class="builtintype" id="7063714">string</span><span class="op" id="7063720">(</span><span class="ident" id="7063721">got</span><span class="op" id="7063724">)</span><span class="op" id="7063725">,</span>&nbsp;<span class="ident" id="7063727">s2</span><span class="op" id="7063729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063732">}</span><br>
<span class="lineno"></span><span class="op" id="7063734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="7063737">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="7063795">type</span>&nbsp;<span class="ident" id="7063800">renamedByte</span>&nbsp;<span class="builtintype" id="7063812">byte</span><br>
<span class="lineno"></span><span class="keyword" id="7063817">type</span>&nbsp;<span class="ident" id="7063822">renamedByteSlice</span>&nbsp;<span class="op" id="7063839">[</span><span class="op" id="7063840">]</span><span class="builtintype" id="7063841">byte</span><br>
<span class="lineno"></span><span class="keyword" id="7063846">type</span>&nbsp;<span class="ident" id="7063851">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="7063875">[</span><span class="op" id="7063876">]</span><span class="ident" id="7063877">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7063890">func</span>&nbsp;<span class="ident" id="7063895">TestEncodeRenamedByteSlice</span><span class="op" id="7063921">(</span><span class="ident" id="7063922">t</span>&nbsp;<span class="op" id="7063924">*</span><span class="ident" id="7063925">testing</span><span class="op" id="7063932">.</span><span class="ident" id="7063933">T</span><span class="op" id="7063934">)</span>&nbsp;<span class="op" id="7063936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063939">s</span>&nbsp;<span class="op" id="7063941">:=</span>&nbsp;<span class="ident" id="7063944">renamedByteSlice</span><span class="op" id="7063960">(</span><span class="string" id="7063961">&#34;abc&#34;</span><span class="op" id="7063966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7063969">result</span><span class="op" id="7063975">,</span>&nbsp;<span class="ident" id="7063977">err</span>&nbsp;<span class="op" id="7063981">:=</span>&nbsp;<span class="ident" id="7063984">Marshal</span><span class="op" id="7063991">(</span><span class="ident" id="7063992">s</span><span class="op" id="7063993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7063996">if</span>&nbsp;<span class="ident" id="7063999">err</span>&nbsp;<span class="op" id="7064003">!=</span>&nbsp;<span class="builtintype" id="7064006">nil</span>&nbsp;<span class="op" id="7064010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064014">t</span><span class="op" id="7064015">.</span><span class="ident" id="7064016">Fatal</span><span class="op" id="7064021">(</span><span class="ident" id="7064022">err</span><span class="op" id="7064025">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064031">expect</span>&nbsp;<span class="op" id="7064038">:=</span>&nbsp;<span class="string" id="7064041">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064051">if</span>&nbsp;<span class="builtintype" id="7064054">string</span><span class="op" id="7064060">(</span><span class="ident" id="7064061">result</span><span class="op" id="7064067">)</span>&nbsp;<span class="op" id="7064069">!=</span>&nbsp;<span class="ident" id="7064072">expect</span>&nbsp;<span class="op" id="7064079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064083">t</span><span class="op" id="7064084">.</span><span class="ident" id="7064085">Errorf</span><span class="op" id="7064091">(</span><span class="string" id="7064092">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7064109">,</span>&nbsp;<span class="ident" id="7064111">result</span><span class="op" id="7064117">,</span>&nbsp;<span class="ident" id="7064119">expect</span><span class="op" id="7064125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064128">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064131">r</span>&nbsp;<span class="op" id="7064133">:=</span>&nbsp;<span class="ident" id="7064136">renamedRenamedByteSlice</span><span class="op" id="7064159">(</span><span class="string" id="7064160">&#34;abc&#34;</span><span class="op" id="7064165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064168">result</span><span class="op" id="7064174">,</span>&nbsp;<span class="ident" id="7064176">err</span>&nbsp;<span class="op" id="7064180">=</span>&nbsp;<span class="ident" id="7064182">Marshal</span><span class="op" id="7064189">(</span><span class="ident" id="7064190">r</span><span class="op" id="7064191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064194">if</span>&nbsp;<span class="ident" id="7064197">err</span>&nbsp;<span class="op" id="7064201">!=</span>&nbsp;<span class="builtintype" id="7064204">nil</span>&nbsp;<span class="op" id="7064208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064212">t</span><span class="op" id="7064213">.</span><span class="ident" id="7064214">Fatal</span><span class="op" id="7064219">(</span><span class="ident" id="7064220">err</span><span class="op" id="7064223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064226">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064229">if</span>&nbsp;<span class="builtintype" id="7064232">string</span><span class="op" id="7064238">(</span><span class="ident" id="7064239">result</span><span class="op" id="7064245">)</span>&nbsp;<span class="op" id="7064247">!=</span>&nbsp;<span class="ident" id="7064250">expect</span>&nbsp;<span class="op" id="7064257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064261">t</span><span class="op" id="7064262">.</span><span class="ident" id="7064263">Errorf</span><span class="op" id="7064269">(</span><span class="string" id="7064270">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7064287">,</span>&nbsp;<span class="ident" id="7064289">result</span><span class="op" id="7064295">,</span>&nbsp;<span class="ident" id="7064297">expect</span><span class="op" id="7064303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064306">}</span><br>
<span class="lineno"></span><span class="op" id="7064308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7064311">var</span>&nbsp;<span class="ident" id="7064315">unsupportedValues</span>&nbsp;<span class="op" id="7064333">=</span>&nbsp;<span class="op" id="7064335">[</span><span class="op" id="7064336">]</span><span class="keyword" id="7064337">interface</span><span class="op" id="7064346">{</span><span class="op" id="7064347">}</span><span class="op" id="7064348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064351">math</span><span class="op" id="7064355">.</span><span class="ident" id="7064356">NaN</span><span class="op" id="7064359">(</span><span class="op" id="7064360">)</span><span class="op" id="7064361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064364">math</span><span class="op" id="7064368">.</span><span class="ident" id="7064369">Inf</span><span class="op" id="7064372">(</span><span class="op" id="7064373">-</span><span class="num" id="7064374">1</span><span class="op" id="7064375">)</span><span class="op" id="7064376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064379">math</span><span class="op" id="7064383">.</span><span class="ident" id="7064384">Inf</span><span class="op" id="7064387">(</span><span class="num" id="7064388">1</span><span class="op" id="7064389">)</span><span class="op" id="7064390">,</span><br>
<span class="lineno"></span><span class="op" id="7064392">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="7064395">func</span>&nbsp;<span class="ident" id="7064400">TestUnsupportedValues</span><span class="op" id="7064421">(</span><span class="ident" id="7064422">t</span>&nbsp;<span class="op" id="7064424">*</span><span class="ident" id="7064425">testing</span><span class="op" id="7064432">.</span><span class="ident" id="7064433">T</span><span class="op" id="7064434">)</span>&nbsp;<span class="op" id="7064436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064439">for</span>&nbsp;<span class="ident" id="7064443">_</span><span class="op" id="7064444">,</span>&nbsp;<span class="ident" id="7064446">v</span>&nbsp;<span class="op" id="7064448">:=</span>&nbsp;<span class="keyword" id="7064451">range</span>&nbsp;<span class="ident" id="7064457">unsupportedValues</span>&nbsp;<span class="op" id="7064475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064479">if</span>&nbsp;<span class="ident" id="7064482">_</span><span class="op" id="7064483">,</span>&nbsp;<span class="ident" id="7064485">err</span>&nbsp;<span class="op" id="7064489">:=</span>&nbsp;<span class="ident" id="7064492">Marshal</span><span class="op" id="7064499">(</span><span class="ident" id="7064500">v</span><span class="op" id="7064501">)</span><span class="op" id="7064502">;</span>&nbsp;<span class="ident" id="7064504">err</span>&nbsp;<span class="op" id="7064508">!=</span>&nbsp;<span class="builtintype" id="7064511">nil</span>&nbsp;<span class="op" id="7064515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064520">if</span>&nbsp;<span class="ident" id="7064523">_</span><span class="op" id="7064524">,</span>&nbsp;<span class="ident" id="7064526">ok</span>&nbsp;<span class="op" id="7064529">:=</span>&nbsp;<span class="ident" id="7064532">err</span><span class="op" id="7064535">.</span><span class="op" id="7064536">(</span><span class="op" id="7064537">*</span><span class="ident" id="7064538">UnsupportedValueError</span><span class="op" id="7064559">)</span><span class="op" id="7064560">;</span>&nbsp;<span class="op" id="7064562">!</span><span class="ident" id="7064563">ok</span>&nbsp;<span class="op" id="7064566">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064572">t</span><span class="op" id="7064573">.</span><span class="ident" id="7064574">Errorf</span><span class="op" id="7064580">(</span><span class="string" id="7064581">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="7064624">,</span>&nbsp;<span class="ident" id="7064626">v</span><span class="op" id="7064627">,</span>&nbsp;<span class="ident" id="7064629">err</span><span class="op" id="7064632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064641">}</span>&nbsp;<span class="keyword" id="7064643">else</span>&nbsp;<span class="op" id="7064648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7064653">t</span><span class="op" id="7064654">.</span><span class="ident" id="7064655">Errorf</span><span class="op" id="7064661">(</span><span class="string" id="7064662">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7064686">,</span>&nbsp;<span class="ident" id="7064688">v</span><span class="op" id="7064689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064693">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064696">}</span><br>
<span class="lineno"></span><span class="op" id="7064698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7064701">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7064769">type</span>&nbsp;<span class="ident" id="7064774">Ref</span>&nbsp;<span class="builtintype" id="7064778">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7064783">func</span>&nbsp;<span class="op" id="7064788">(</span><span class="op" id="7064789">*</span><span class="ident" id="7064790">Ref</span><span class="op" id="7064793">)</span>&nbsp;<span class="ident" id="7064795">MarshalJSON</span><span class="op" id="7064806">(</span><span class="op" id="7064807">)</span>&nbsp;<span class="op" id="7064809">(</span><span class="op" id="7064810">[</span><span class="op" id="7064811">]</span><span class="builtintype" id="7064812">byte</span><span class="op" id="7064816">,</span>&nbsp;<span class="builtintype" id="7064818">error</span><span class="op" id="7064823">)</span>&nbsp;<span class="op" id="7064825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064828">return</span>&nbsp;<span class="op" id="7064835">[</span><span class="op" id="7064836">]</span><span class="builtintype" id="7064837">byte</span><span class="op" id="7064841">(</span><span class="string" id="7064842">`&#34;ref&#34;`</span><span class="op" id="7064849">)</span><span class="op" id="7064850">,</span>&nbsp;<span class="builtintype" id="7064852">nil</span><br>
<span class="lineno"></span><span class="op" id="7064856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="7064859">func</span>&nbsp;<span class="op" id="7064864">(</span><span class="ident" id="7064865">r</span>&nbsp;<span class="op" id="7064867">*</span><span class="ident" id="7064868">Ref</span><span class="op" id="7064871">)</span>&nbsp;<span class="ident" id="7064873">UnmarshalJSON</span><span class="op" id="7064886">(</span><span class="op" id="7064887">[</span><span class="op" id="7064888">]</span><span class="builtintype" id="7064889">byte</span><span class="op" id="7064893">)</span>&nbsp;<span class="builtintype" id="7064895">error</span>&nbsp;<span class="op" id="7064901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7064904">*</span><span class="ident" id="7064905">r</span>&nbsp;<span class="op" id="7064907">=</span>&nbsp;<span class="num" id="7064909">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7064913">return</span>&nbsp;<span class="builtintype" id="7064920">nil</span><br>
<span class="lineno"></span><span class="op" id="7064924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="7064927">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7064977">type</span>&nbsp;<span class="ident" id="7064982">Val</span>&nbsp;<span class="builtintype" id="7064986">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7064991">func</span>&nbsp;<span class="op" id="7064996">(</span><span class="ident" id="7064997">Val</span><span class="op" id="7065000">)</span>&nbsp;<span class="ident" id="7065002">MarshalJSON</span><span class="op" id="7065013">(</span><span class="op" id="7065014">)</span>&nbsp;<span class="op" id="7065016">(</span><span class="op" id="7065017">[</span><span class="op" id="7065018">]</span><span class="builtintype" id="7065019">byte</span><span class="op" id="7065023">,</span>&nbsp;<span class="builtintype" id="7065025">error</span><span class="op" id="7065030">)</span>&nbsp;<span class="op" id="7065032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065035">return</span>&nbsp;<span class="op" id="7065042">[</span><span class="op" id="7065043">]</span><span class="builtintype" id="7065044">byte</span><span class="op" id="7065048">(</span><span class="string" id="7065049">`&#34;val&#34;`</span><span class="op" id="7065056">)</span><span class="op" id="7065057">,</span>&nbsp;<span class="builtintype" id="7065059">nil</span><br>
<span class="lineno">165</span><span class="op" id="7065063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7065066">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7065138">type</span>&nbsp;<span class="ident" id="7065143">RefText</span>&nbsp;<span class="builtintype" id="7065151">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7065156">func</span>&nbsp;<span class="op" id="7065161">(</span><span class="op" id="7065162">*</span><span class="ident" id="7065163">RefText</span><span class="op" id="7065170">)</span>&nbsp;<span class="ident" id="7065172">MarshalText</span><span class="op" id="7065183">(</span><span class="op" id="7065184">)</span>&nbsp;<span class="op" id="7065186">(</span><span class="op" id="7065187">[</span><span class="op" id="7065188">]</span><span class="builtintype" id="7065189">byte</span><span class="op" id="7065193">,</span>&nbsp;<span class="builtintype" id="7065195">error</span><span class="op" id="7065200">)</span>&nbsp;<span class="op" id="7065202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065205">return</span>&nbsp;<span class="op" id="7065212">[</span><span class="op" id="7065213">]</span><span class="builtintype" id="7065214">byte</span><span class="op" id="7065218">(</span><span class="string" id="7065219">`&#34;ref&#34;`</span><span class="op" id="7065226">)</span><span class="op" id="7065227">,</span>&nbsp;<span class="builtintype" id="7065229">nil</span><br>
<span class="lineno"></span><span class="op" id="7065233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7065236">func</span>&nbsp;<span class="op" id="7065241">(</span><span class="ident" id="7065242">r</span>&nbsp;<span class="op" id="7065244">*</span><span class="ident" id="7065245">RefText</span><span class="op" id="7065252">)</span>&nbsp;<span class="ident" id="7065254">UnmarshalText</span><span class="op" id="7065267">(</span><span class="op" id="7065268">[</span><span class="op" id="7065269">]</span><span class="builtintype" id="7065270">byte</span><span class="op" id="7065274">)</span>&nbsp;<span class="builtintype" id="7065276">error</span>&nbsp;<span class="op" id="7065282">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7065285">*</span><span class="ident" id="7065286">r</span>&nbsp;<span class="op" id="7065288">=</span>&nbsp;<span class="num" id="7065290">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065294">return</span>&nbsp;<span class="builtintype" id="7065301">nil</span><br>
<span class="lineno"></span><span class="op" id="7065305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7065308">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="7065362">type</span>&nbsp;<span class="ident" id="7065367">ValText</span>&nbsp;<span class="builtintype" id="7065375">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7065380">func</span>&nbsp;<span class="op" id="7065385">(</span><span class="ident" id="7065386">ValText</span><span class="op" id="7065393">)</span>&nbsp;<span class="ident" id="7065395">MarshalText</span><span class="op" id="7065406">(</span><span class="op" id="7065407">)</span>&nbsp;<span class="op" id="7065409">(</span><span class="op" id="7065410">[</span><span class="op" id="7065411">]</span><span class="builtintype" id="7065412">byte</span><span class="op" id="7065416">,</span>&nbsp;<span class="builtintype" id="7065418">error</span><span class="op" id="7065423">)</span>&nbsp;<span class="op" id="7065425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065428">return</span>&nbsp;<span class="op" id="7065435">[</span><span class="op" id="7065436">]</span><span class="builtintype" id="7065437">byte</span><span class="op" id="7065441">(</span><span class="string" id="7065442">`&#34;val&#34;`</span><span class="op" id="7065449">)</span><span class="op" id="7065450">,</span>&nbsp;<span class="builtintype" id="7065452">nil</span><br>
<span class="lineno"></span><span class="op" id="7065456">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7065459">func</span>&nbsp;<span class="ident" id="7065464">TestRefValMarshal</span><span class="op" id="7065481">(</span><span class="ident" id="7065482">t</span>&nbsp;<span class="op" id="7065484">*</span><span class="ident" id="7065485">testing</span><span class="op" id="7065492">.</span><span class="ident" id="7065493">T</span><span class="op" id="7065494">)</span>&nbsp;<span class="op" id="7065496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065499">var</span>&nbsp;<span class="ident" id="7065503">s</span>&nbsp;<span class="op" id="7065505">=</span>&nbsp;<span class="keyword" id="7065507">struct</span>&nbsp;<span class="op" id="7065514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065518">R0</span>&nbsp;<span class="ident" id="7065521">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065527">R1</span>&nbsp;<span class="op" id="7065530">*</span><span class="ident" id="7065531">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065537">R2</span>&nbsp;<span class="ident" id="7065540">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065550">R3</span>&nbsp;<span class="op" id="7065553">*</span><span class="ident" id="7065554">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065564">V0</span>&nbsp;<span class="ident" id="7065567">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065573">V1</span>&nbsp;<span class="op" id="7065576">*</span><span class="ident" id="7065577">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065583">V2</span>&nbsp;<span class="ident" id="7065586">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065596">V3</span>&nbsp;<span class="op" id="7065599">*</span><span class="ident" id="7065600">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7065609">}</span><span class="op" id="7065610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065614">R0</span><span class="op" id="7065616">:</span>&nbsp;<span class="num" id="7065618">12</span><span class="op" id="7065620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065624">R1</span><span class="op" id="7065626">:</span>&nbsp;<span class="builtinfunc" id="7065628">new</span><span class="op" id="7065631">(</span><span class="ident" id="7065632">Ref</span><span class="op" id="7065635">)</span><span class="op" id="7065636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065640">R2</span><span class="op" id="7065642">:</span>&nbsp;<span class="num" id="7065644">14</span><span class="op" id="7065646">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065650">R3</span><span class="op" id="7065652">:</span>&nbsp;<span class="builtinfunc" id="7065654">new</span><span class="op" id="7065657">(</span><span class="ident" id="7065658">RefText</span><span class="op" id="7065665">)</span><span class="op" id="7065666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065670">V0</span><span class="op" id="7065672">:</span>&nbsp;<span class="num" id="7065674">13</span><span class="op" id="7065676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065680">V1</span><span class="op" id="7065682">:</span>&nbsp;<span class="builtinfunc" id="7065684">new</span><span class="op" id="7065687">(</span><span class="ident" id="7065688">Val</span><span class="op" id="7065691">)</span><span class="op" id="7065692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065696">V2</span><span class="op" id="7065698">:</span>&nbsp;<span class="num" id="7065700">15</span><span class="op" id="7065702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065706">V3</span><span class="op" id="7065708">:</span>&nbsp;<span class="builtinfunc" id="7065710">new</span><span class="op" id="7065713">(</span><span class="ident" id="7065714">ValText</span><span class="op" id="7065721">)</span><span class="op" id="7065722">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7065725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065728">const</span>&nbsp;<span class="ident" id="7065734">want</span>&nbsp;<span class="op" id="7065739">=</span>&nbsp;<span class="string" id="7065741">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065850">b</span><span class="op" id="7065851">,</span>&nbsp;<span class="ident" id="7065853">err</span>&nbsp;<span class="op" id="7065857">:=</span>&nbsp;<span class="ident" id="7065860">Marshal</span><span class="op" id="7065867">(</span><span class="op" id="7065868">&amp;</span><span class="ident" id="7065869">s</span><span class="op" id="7065870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065873">if</span>&nbsp;<span class="ident" id="7065876">err</span>&nbsp;<span class="op" id="7065880">!=</span>&nbsp;<span class="builtintype" id="7065883">nil</span>&nbsp;<span class="op" id="7065887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065891">t</span><span class="op" id="7065892">.</span><span class="ident" id="7065893">Fatalf</span><span class="op" id="7065899">(</span><span class="string" id="7065900">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7065913">,</span>&nbsp;<span class="ident" id="7065915">err</span><span class="op" id="7065918">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7065921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7065924">if</span>&nbsp;<span class="ident" id="7065927">got</span>&nbsp;<span class="op" id="7065931">:=</span>&nbsp;<span class="builtintype" id="7065934">string</span><span class="op" id="7065940">(</span><span class="ident" id="7065941">b</span><span class="op" id="7065942">)</span><span class="op" id="7065943">;</span>&nbsp;<span class="ident" id="7065945">got</span>&nbsp;<span class="op" id="7065949">!=</span>&nbsp;<span class="ident" id="7065952">want</span>&nbsp;<span class="op" id="7065957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7065961">t</span><span class="op" id="7065962">.</span><span class="ident" id="7065963">Errorf</span><span class="op" id="7065969">(</span><span class="string" id="7065970">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7065987">,</span>&nbsp;<span class="ident" id="7065989">got</span><span class="op" id="7065992">,</span>&nbsp;<span class="ident" id="7065994">want</span><span class="op" id="7065998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7066001">}</span><br>
<span class="lineno"></span><span class="op" id="7066003">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="7066006">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="7066060">type</span>&nbsp;<span class="ident" id="7066065">C</span>&nbsp;<span class="builtintype" id="7066067">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7066072">func</span>&nbsp;<span class="op" id="7066077">(</span><span class="ident" id="7066078">C</span><span class="op" id="7066079">)</span>&nbsp;<span class="ident" id="7066081">MarshalJSON</span><span class="op" id="7066092">(</span><span class="op" id="7066093">)</span>&nbsp;<span class="op" id="7066095">(</span><span class="op" id="7066096">[</span><span class="op" id="7066097">]</span><span class="builtintype" id="7066098">byte</span><span class="op" id="7066102">,</span>&nbsp;<span class="builtintype" id="7066104">error</span><span class="op" id="7066109">)</span>&nbsp;<span class="op" id="7066111">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066114">return</span>&nbsp;<span class="op" id="7066121">[</span><span class="op" id="7066122">]</span><span class="builtintype" id="7066123">byte</span><span class="op" id="7066127">(</span><span class="string" id="7066128">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="7066135">)</span><span class="op" id="7066136">,</span>&nbsp;<span class="builtintype" id="7066138">nil</span><br>
<span class="lineno"></span><span class="op" id="7066142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7066145">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="7066203">type</span>&nbsp;<span class="ident" id="7066208">CText</span>&nbsp;<span class="builtintype" id="7066214">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="7066219">func</span>&nbsp;<span class="op" id="7066224">(</span><span class="ident" id="7066225">CText</span><span class="op" id="7066230">)</span>&nbsp;<span class="ident" id="7066232">MarshalText</span><span class="op" id="7066243">(</span><span class="op" id="7066244">)</span>&nbsp;<span class="op" id="7066246">(</span><span class="op" id="7066247">[</span><span class="op" id="7066248">]</span><span class="builtintype" id="7066249">byte</span><span class="op" id="7066253">,</span>&nbsp;<span class="builtintype" id="7066255">error</span><span class="op" id="7066260">)</span>&nbsp;<span class="op" id="7066262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066265">return</span>&nbsp;<span class="op" id="7066272">[</span><span class="op" id="7066273">]</span><span class="builtintype" id="7066274">byte</span><span class="op" id="7066278">(</span><span class="string" id="7066279">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="7066286">)</span><span class="op" id="7066287">,</span>&nbsp;<span class="builtintype" id="7066289">nil</span><br>
<span class="lineno"></span><span class="op" id="7066293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7066296">func</span>&nbsp;<span class="ident" id="7066301">TestMarshalerEscaping</span><span class="op" id="7066322">(</span><span class="ident" id="7066323">t</span>&nbsp;<span class="op" id="7066325">*</span><span class="ident" id="7066326">testing</span><span class="op" id="7066333">.</span><span class="ident" id="7066334">T</span><span class="op" id="7066335">)</span>&nbsp;<span class="op" id="7066337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066340">var</span>&nbsp;<span class="ident" id="7066344">c</span>&nbsp;<span class="ident" id="7066346">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066349">want</span>&nbsp;<span class="op" id="7066354">:=</span>&nbsp;<span class="string" id="7066357">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066381">b</span><span class="op" id="7066382">,</span>&nbsp;<span class="ident" id="7066384">err</span>&nbsp;<span class="op" id="7066388">:=</span>&nbsp;<span class="ident" id="7066391">Marshal</span><span class="op" id="7066398">(</span><span class="ident" id="7066399">c</span><span class="op" id="7066400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066403">if</span>&nbsp;<span class="ident" id="7066406">err</span>&nbsp;<span class="op" id="7066410">!=</span>&nbsp;<span class="builtintype" id="7066413">nil</span>&nbsp;<span class="op" id="7066417">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066421">t</span><span class="op" id="7066422">.</span><span class="ident" id="7066423">Fatalf</span><span class="op" id="7066429">(</span><span class="string" id="7066430">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="7066446">,</span>&nbsp;<span class="ident" id="7066448">err</span><span class="op" id="7066451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7066454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066457">if</span>&nbsp;<span class="ident" id="7066460">got</span>&nbsp;<span class="op" id="7066464">:=</span>&nbsp;<span class="builtintype" id="7066467">string</span><span class="op" id="7066473">(</span><span class="ident" id="7066474">b</span><span class="op" id="7066475">)</span><span class="op" id="7066476">;</span>&nbsp;<span class="ident" id="7066478">got</span>&nbsp;<span class="op" id="7066482">!=</span>&nbsp;<span class="ident" id="7066485">want</span>&nbsp;<span class="op" id="7066490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066494">t</span><span class="op" id="7066495">.</span><span class="ident" id="7066496">Errorf</span><span class="op" id="7066502">(</span><span class="string" id="7066503">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7066531">,</span>&nbsp;<span class="ident" id="7066533">got</span><span class="op" id="7066536">,</span>&nbsp;<span class="ident" id="7066538">want</span><span class="op" id="7066542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7066545">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066549">var</span>&nbsp;<span class="ident" id="7066553">ct</span>&nbsp;<span class="ident" id="7066556">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066563">want</span>&nbsp;<span class="op" id="7066568">=</span>&nbsp;<span class="string" id="7066570">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066598">b</span><span class="op" id="7066599">,</span>&nbsp;<span class="ident" id="7066601">err</span>&nbsp;<span class="op" id="7066605">=</span>&nbsp;<span class="ident" id="7066607">Marshal</span><span class="op" id="7066614">(</span><span class="ident" id="7066615">ct</span><span class="op" id="7066617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066620">if</span>&nbsp;<span class="ident" id="7066623">err</span>&nbsp;<span class="op" id="7066627">!=</span>&nbsp;<span class="builtintype" id="7066630">nil</span>&nbsp;<span class="op" id="7066634">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066638">t</span><span class="op" id="7066639">.</span><span class="ident" id="7066640">Fatalf</span><span class="op" id="7066646">(</span><span class="string" id="7066647">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="7066664">,</span>&nbsp;<span class="ident" id="7066666">err</span><span class="op" id="7066669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7066672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066675">if</span>&nbsp;<span class="ident" id="7066678">got</span>&nbsp;<span class="op" id="7066682">:=</span>&nbsp;<span class="builtintype" id="7066685">string</span><span class="op" id="7066691">(</span><span class="ident" id="7066692">b</span><span class="op" id="7066693">)</span><span class="op" id="7066694">;</span>&nbsp;<span class="ident" id="7066696">got</span>&nbsp;<span class="op" id="7066700">!=</span>&nbsp;<span class="ident" id="7066703">want</span>&nbsp;<span class="op" id="7066708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066712">t</span><span class="op" id="7066713">.</span><span class="ident" id="7066714">Errorf</span><span class="op" id="7066720">(</span><span class="string" id="7066721">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7066750">,</span>&nbsp;<span class="ident" id="7066752">got</span><span class="op" id="7066755">,</span>&nbsp;<span class="ident" id="7066757">want</span><span class="op" id="7066761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7066764">}</span><br>
<span class="lineno">250</span><span class="op" id="7066766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7066769">type</span>&nbsp;<span class="ident" id="7066774">IntType</span>&nbsp;<span class="builtintype" id="7066782">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7066787">type</span>&nbsp;<span class="ident" id="7066792">MyStruct</span>&nbsp;<span class="keyword" id="7066801">struct</span>&nbsp;<span class="op" id="7066808">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066811">IntType</span><br>
<span class="lineno"></span><span class="op" id="7066819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7066822">func</span>&nbsp;<span class="ident" id="7066827">TestAnonymousNonstruct</span><span class="op" id="7066849">(</span><span class="ident" id="7066850">t</span>&nbsp;<span class="op" id="7066852">*</span><span class="ident" id="7066853">testing</span><span class="op" id="7066860">.</span><span class="ident" id="7066861">T</span><span class="op" id="7066862">)</span>&nbsp;<span class="op" id="7066864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066867">var</span>&nbsp;<span class="ident" id="7066871">i</span>&nbsp;<span class="ident" id="7066873">IntType</span>&nbsp;<span class="op" id="7066881">=</span>&nbsp;<span class="num" id="7066883">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066887">a</span>&nbsp;<span class="op" id="7066889">:=</span>&nbsp;<span class="ident" id="7066892">MyStruct</span><span class="op" id="7066900">{</span><span class="ident" id="7066901">i</span><span class="op" id="7066902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066905">const</span>&nbsp;<span class="ident" id="7066911">want</span>&nbsp;<span class="op" id="7066916">=</span>&nbsp;<span class="string" id="7066918">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066937">b</span><span class="op" id="7066938">,</span>&nbsp;<span class="ident" id="7066940">err</span>&nbsp;<span class="op" id="7066944">:=</span>&nbsp;<span class="ident" id="7066947">Marshal</span><span class="op" id="7066954">(</span><span class="ident" id="7066955">a</span><span class="op" id="7066956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7066959">if</span>&nbsp;<span class="ident" id="7066962">err</span>&nbsp;<span class="op" id="7066966">!=</span>&nbsp;<span class="builtintype" id="7066969">nil</span>&nbsp;<span class="op" id="7066973">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7066977">t</span><span class="op" id="7066978">.</span><span class="ident" id="7066979">Fatalf</span><span class="op" id="7066985">(</span><span class="string" id="7066986">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7066999">,</span>&nbsp;<span class="ident" id="7067001">err</span><span class="op" id="7067004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7067010">if</span>&nbsp;<span class="ident" id="7067013">got</span>&nbsp;<span class="op" id="7067017">:=</span>&nbsp;<span class="builtintype" id="7067020">string</span><span class="op" id="7067026">(</span><span class="ident" id="7067027">b</span><span class="op" id="7067028">)</span><span class="op" id="7067029">;</span>&nbsp;<span class="ident" id="7067031">got</span>&nbsp;<span class="op" id="7067035">!=</span>&nbsp;<span class="ident" id="7067038">want</span>&nbsp;<span class="op" id="7067043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067047">t</span><span class="op" id="7067048">.</span><span class="ident" id="7067049">Errorf</span><span class="op" id="7067055">(</span><span class="string" id="7067056">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7067073">,</span>&nbsp;<span class="ident" id="7067075">got</span><span class="op" id="7067078">,</span>&nbsp;<span class="ident" id="7067080">want</span><span class="op" id="7067084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067087">}</span><br>
<span class="lineno">270</span><span class="op" id="7067089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7067092">type</span>&nbsp;<span class="ident" id="7067097">BugA</span>&nbsp;<span class="keyword" id="7067102">struct</span>&nbsp;<span class="op" id="7067109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067112">S</span>&nbsp;<span class="builtintype" id="7067114">string</span><br>
<span class="lineno"></span><span class="op" id="7067121">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="7067124">type</span>&nbsp;<span class="ident" id="7067129">BugB</span>&nbsp;<span class="keyword" id="7067134">struct</span>&nbsp;<span class="op" id="7067141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067144">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067150">S</span>&nbsp;<span class="builtintype" id="7067152">string</span><br>
<span class="lineno"></span><span class="op" id="7067159">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7067162">type</span>&nbsp;<span class="ident" id="7067167">BugC</span>&nbsp;<span class="keyword" id="7067172">struct</span>&nbsp;<span class="op" id="7067179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067182">S</span>&nbsp;<span class="builtintype" id="7067184">string</span><br>
<span class="lineno"></span><span class="op" id="7067191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="7067194">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="7067253">type</span>&nbsp;<span class="ident" id="7067258">BugX</span>&nbsp;<span class="keyword" id="7067263">struct</span>&nbsp;<span class="op" id="7067270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067273">A</span>&nbsp;<span class="builtintype" id="7067275">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067280">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067286">BugB</span><br>
<span class="lineno">290</span><span class="op" id="7067291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7067294">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="7067309">func</span>&nbsp;<span class="ident" id="7067314">TestEmbeddedBug</span><span class="op" id="7067329">(</span><span class="ident" id="7067330">t</span>&nbsp;<span class="op" id="7067332">*</span><span class="ident" id="7067333">testing</span><span class="op" id="7067340">.</span><span class="ident" id="7067341">T</span><span class="op" id="7067342">)</span>&nbsp;<span class="op" id="7067344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067347">v</span>&nbsp;<span class="op" id="7067349">:=</span>&nbsp;<span class="ident" id="7067352">BugB</span><span class="op" id="7067356">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067360">BugA</span><span class="op" id="7067364">{</span><span class="string" id="7067365">&#34;A&#34;</span><span class="op" id="7067368">}</span><span class="op" id="7067369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7067373">&#34;B&#34;</span><span class="op" id="7067376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067382">b</span><span class="op" id="7067383">,</span>&nbsp;<span class="ident" id="7067385">err</span>&nbsp;<span class="op" id="7067389">:=</span>&nbsp;<span class="ident" id="7067392">Marshal</span><span class="op" id="7067399">(</span><span class="ident" id="7067400">v</span><span class="op" id="7067401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7067404">if</span>&nbsp;<span class="ident" id="7067407">err</span>&nbsp;<span class="op" id="7067411">!=</span>&nbsp;<span class="builtintype" id="7067414">nil</span>&nbsp;<span class="op" id="7067418">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067422">t</span><span class="op" id="7067423">.</span><span class="ident" id="7067424">Fatal</span><span class="op" id="7067429">(</span><span class="string" id="7067430">&#34;Marshal:&#34;</span><span class="op" id="7067440">,</span>&nbsp;<span class="ident" id="7067442">err</span><span class="op" id="7067445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067451">want</span>&nbsp;<span class="op" id="7067456">:=</span>&nbsp;<span class="string" id="7067459">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067472">got</span>&nbsp;<span class="op" id="7067476">:=</span>&nbsp;<span class="builtintype" id="7067479">string</span><span class="op" id="7067485">(</span><span class="ident" id="7067486">b</span><span class="op" id="7067487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7067490">if</span>&nbsp;<span class="ident" id="7067493">got</span>&nbsp;<span class="op" id="7067497">!=</span>&nbsp;<span class="ident" id="7067500">want</span>&nbsp;<span class="op" id="7067505">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067509">t</span><span class="op" id="7067510">.</span><span class="ident" id="7067511">Fatalf</span><span class="op" id="7067517">(</span><span class="string" id="7067518">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7067543">,</span>&nbsp;<span class="ident" id="7067545">got</span><span class="op" id="7067548">,</span>&nbsp;<span class="ident" id="7067550">want</span><span class="op" id="7067554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7067560">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067620">x</span>&nbsp;<span class="op" id="7067622">:=</span>&nbsp;<span class="ident" id="7067625">BugX</span><span class="op" id="7067629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067633">A</span><span class="op" id="7067634">:</span>&nbsp;<span class="num" id="7067636">23</span><span class="op" id="7067638">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067644">b</span><span class="op" id="7067645">,</span>&nbsp;<span class="ident" id="7067647">err</span>&nbsp;<span class="op" id="7067651">=</span>&nbsp;<span class="ident" id="7067653">Marshal</span><span class="op" id="7067660">(</span><span class="ident" id="7067661">x</span><span class="op" id="7067662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7067665">if</span>&nbsp;<span class="ident" id="7067668">err</span>&nbsp;<span class="op" id="7067672">!=</span>&nbsp;<span class="builtintype" id="7067675">nil</span>&nbsp;<span class="op" id="7067679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067683">t</span><span class="op" id="7067684">.</span><span class="ident" id="7067685">Fatal</span><span class="op" id="7067690">(</span><span class="string" id="7067691">&#34;Marshal:&#34;</span><span class="op" id="7067701">,</span>&nbsp;<span class="ident" id="7067703">err</span><span class="op" id="7067706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067709">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067712">want</span>&nbsp;<span class="op" id="7067717">=</span>&nbsp;<span class="string" id="7067719">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067731">got</span>&nbsp;<span class="op" id="7067735">=</span>&nbsp;<span class="builtintype" id="7067737">string</span><span class="op" id="7067743">(</span><span class="ident" id="7067744">b</span><span class="op" id="7067745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7067748">if</span>&nbsp;<span class="ident" id="7067751">got</span>&nbsp;<span class="op" id="7067755">!=</span>&nbsp;<span class="ident" id="7067758">want</span>&nbsp;<span class="op" id="7067763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067767">t</span><span class="op" id="7067768">.</span><span class="ident" id="7067769">Fatalf</span><span class="op" id="7067775">(</span><span class="string" id="7067776">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7067801">,</span>&nbsp;<span class="ident" id="7067803">got</span><span class="op" id="7067806">,</span>&nbsp;<span class="ident" id="7067808">want</span><span class="op" id="7067812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7067815">}</span><br>
<span class="lineno">320</span><span class="op" id="7067817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7067820">type</span>&nbsp;<span class="ident" id="7067825">BugD</span>&nbsp;<span class="keyword" id="7067830">struct</span>&nbsp;<span class="op" id="7067837">{</span>&nbsp;<span class="comment" id="7067839">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067871">XXX</span>&nbsp;<span class="builtintype" id="7067875">string</span>&nbsp;<span class="string" id="7067882">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7067893">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="7067896">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="7067945">type</span>&nbsp;<span class="ident" id="7067950">BugY</span>&nbsp;<span class="keyword" id="7067955">struct</span>&nbsp;<span class="op" id="7067962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067965">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7067971">BugD</span><br>
<span class="lineno">330</span><span class="op" id="7067976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7067979">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="7068038">func</span>&nbsp;<span class="ident" id="7068043">TestTaggedFieldDominates</span><span class="op" id="7068067">(</span><span class="ident" id="7068068">t</span>&nbsp;<span class="op" id="7068070">*</span><span class="ident" id="7068071">testing</span><span class="op" id="7068078">.</span><span class="ident" id="7068079">T</span><span class="op" id="7068080">)</span>&nbsp;<span class="op" id="7068082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068085">v</span>&nbsp;<span class="op" id="7068087">:=</span>&nbsp;<span class="ident" id="7068090">BugY</span><span class="op" id="7068094">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068098">BugA</span><span class="op" id="7068102">{</span><span class="string" id="7068103">&#34;BugA&#34;</span><span class="op" id="7068109">}</span><span class="op" id="7068110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068114">BugD</span><span class="op" id="7068118">{</span><span class="string" id="7068119">&#34;BugD&#34;</span><span class="op" id="7068125">}</span><span class="op" id="7068126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068132">b</span><span class="op" id="7068133">,</span>&nbsp;<span class="ident" id="7068135">err</span>&nbsp;<span class="op" id="7068139">:=</span>&nbsp;<span class="ident" id="7068142">Marshal</span><span class="op" id="7068149">(</span><span class="ident" id="7068150">v</span><span class="op" id="7068151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7068154">if</span>&nbsp;<span class="ident" id="7068157">err</span>&nbsp;<span class="op" id="7068161">!=</span>&nbsp;<span class="builtintype" id="7068164">nil</span>&nbsp;<span class="op" id="7068168">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068172">t</span><span class="op" id="7068173">.</span><span class="ident" id="7068174">Fatal</span><span class="op" id="7068179">(</span><span class="string" id="7068180">&#34;Marshal:&#34;</span><span class="op" id="7068190">,</span>&nbsp;<span class="ident" id="7068192">err</span><span class="op" id="7068195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068201">want</span>&nbsp;<span class="op" id="7068206">:=</span>&nbsp;<span class="string" id="7068209">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068225">got</span>&nbsp;<span class="op" id="7068229">:=</span>&nbsp;<span class="builtintype" id="7068232">string</span><span class="op" id="7068238">(</span><span class="ident" id="7068239">b</span><span class="op" id="7068240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7068243">if</span>&nbsp;<span class="ident" id="7068246">got</span>&nbsp;<span class="op" id="7068250">!=</span>&nbsp;<span class="ident" id="7068253">want</span>&nbsp;<span class="op" id="7068258">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068262">t</span><span class="op" id="7068263">.</span><span class="ident" id="7068264">Fatalf</span><span class="op" id="7068270">(</span><span class="string" id="7068271">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7068296">,</span>&nbsp;<span class="ident" id="7068298">got</span><span class="op" id="7068301">,</span>&nbsp;<span class="ident" id="7068303">want</span><span class="op" id="7068307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068310">}</span><br>
<span class="lineno"></span><span class="op" id="7068312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7068315">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="7068366">type</span>&nbsp;<span class="ident" id="7068371">BugZ</span>&nbsp;<span class="keyword" id="7068376">struct</span>&nbsp;<span class="op" id="7068383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068386">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068392">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068398">BugY</span>&nbsp;<span class="comment" id="7068403">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="7068467">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7068470">func</span>&nbsp;<span class="ident" id="7068475">TestDuplicatedFieldDisappears</span><span class="op" id="7068504">(</span><span class="ident" id="7068505">t</span>&nbsp;<span class="op" id="7068507">*</span><span class="ident" id="7068508">testing</span><span class="op" id="7068515">.</span><span class="ident" id="7068516">T</span><span class="op" id="7068517">)</span>&nbsp;<span class="op" id="7068519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068522">v</span>&nbsp;<span class="op" id="7068524">:=</span>&nbsp;<span class="ident" id="7068527">BugZ</span><span class="op" id="7068531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068535">BugA</span><span class="op" id="7068539">{</span><span class="string" id="7068540">&#34;BugA&#34;</span><span class="op" id="7068546">}</span><span class="op" id="7068547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068551">BugC</span><span class="op" id="7068555">{</span><span class="string" id="7068556">&#34;BugC&#34;</span><span class="op" id="7068562">}</span><span class="op" id="7068563">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068567">BugY</span><span class="op" id="7068571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068576">BugA</span><span class="op" id="7068580">{</span><span class="string" id="7068581">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="7068594">}</span><span class="op" id="7068595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068600">BugD</span><span class="op" id="7068604">{</span><span class="string" id="7068605">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="7068618">}</span><span class="op" id="7068619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068623">}</span><span class="op" id="7068624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068627">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068630">b</span><span class="op" id="7068631">,</span>&nbsp;<span class="ident" id="7068633">err</span>&nbsp;<span class="op" id="7068637">:=</span>&nbsp;<span class="ident" id="7068640">Marshal</span><span class="op" id="7068647">(</span><span class="ident" id="7068648">v</span><span class="op" id="7068649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7068652">if</span>&nbsp;<span class="ident" id="7068655">err</span>&nbsp;<span class="op" id="7068659">!=</span>&nbsp;<span class="builtintype" id="7068662">nil</span>&nbsp;<span class="op" id="7068666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068670">t</span><span class="op" id="7068671">.</span><span class="ident" id="7068672">Fatal</span><span class="op" id="7068677">(</span><span class="string" id="7068678">&#34;Marshal:&#34;</span><span class="op" id="7068688">,</span>&nbsp;<span class="ident" id="7068690">err</span><span class="op" id="7068693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068699">want</span>&nbsp;<span class="op" id="7068704">:=</span>&nbsp;<span class="string" id="7068707">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068713">got</span>&nbsp;<span class="op" id="7068717">:=</span>&nbsp;<span class="builtintype" id="7068720">string</span><span class="op" id="7068726">(</span><span class="ident" id="7068727">b</span><span class="op" id="7068728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7068731">if</span>&nbsp;<span class="ident" id="7068734">got</span>&nbsp;<span class="op" id="7068738">!=</span>&nbsp;<span class="ident" id="7068741">want</span>&nbsp;<span class="op" id="7068746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068750">t</span><span class="op" id="7068751">.</span><span class="ident" id="7068752">Fatalf</span><span class="op" id="7068758">(</span><span class="string" id="7068759">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7068784">,</span>&nbsp;<span class="ident" id="7068786">got</span><span class="op" id="7068789">,</span>&nbsp;<span class="ident" id="7068791">want</span><span class="op" id="7068795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7068798">}</span><br>
<span class="lineno"></span><span class="op" id="7068800">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="7068803">func</span>&nbsp;<span class="ident" id="7068808">TestStringBytes</span><span class="op" id="7068823">(</span><span class="ident" id="7068824">t</span>&nbsp;<span class="op" id="7068826">*</span><span class="ident" id="7068827">testing</span><span class="op" id="7068834">.</span><span class="ident" id="7068835">T</span><span class="op" id="7068836">)</span>&nbsp;<span class="op" id="7068838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7068841">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7068925">es</span>&nbsp;<span class="op" id="7068928">:=</span>&nbsp;<span class="op" id="7068931">&amp;</span><span class="ident" id="7068932">encodeState</span><span class="op" id="7068943">{</span><span class="op" id="7068944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7068947">var</span>&nbsp;<span class="ident" id="7068951">r</span>&nbsp;<span class="op" id="7068953">[</span><span class="op" id="7068954">]</span><span class="builtintype" id="7068955">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7068961">for</span>&nbsp;<span class="ident" id="7068965">i</span>&nbsp;<span class="op" id="7068967">:=</span>&nbsp;<span class="string" id="7068970">&#39;\u0000&#39;</span><span class="op" id="7068978">;</span>&nbsp;<span class="ident" id="7068980">i</span>&nbsp;<span class="op" id="7068982">&lt;=</span>&nbsp;<span class="ident" id="7068985">unicode</span><span class="op" id="7068992">.</span><span class="ident" id="7068993">MaxRune</span><span class="op" id="7069000">;</span>&nbsp;<span class="ident" id="7069002">i</span><span class="op" id="7069003">++</span>&nbsp;<span class="op" id="7069006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069010">r</span>&nbsp;<span class="op" id="7069012">=</span>&nbsp;<span class="builtinfunc" id="7069014">append</span><span class="op" id="7069020">(</span><span class="ident" id="7069021">r</span><span class="op" id="7069022">,</span>&nbsp;<span class="ident" id="7069024">i</span><span class="op" id="7069025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069031">s</span>&nbsp;<span class="op" id="7069033">:=</span>&nbsp;<span class="builtintype" id="7069036">string</span><span class="op" id="7069042">(</span><span class="ident" id="7069043">r</span><span class="op" id="7069044">)</span>&nbsp;<span class="op" id="7069046">+</span>&nbsp;<span class="string" id="7069048">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="7069068">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069095">_</span><span class="op" id="7069096">,</span>&nbsp;<span class="ident" id="7069098">err</span>&nbsp;<span class="op" id="7069102">:=</span>&nbsp;<span class="ident" id="7069105">es</span><span class="op" id="7069107">.</span><span class="builtintype" id="7069108">string</span><span class="op" id="7069114">(</span><span class="ident" id="7069115">s</span><span class="op" id="7069116">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069119">if</span>&nbsp;<span class="ident" id="7069122">err</span>&nbsp;<span class="op" id="7069126">!=</span>&nbsp;<span class="builtintype" id="7069129">nil</span>&nbsp;<span class="op" id="7069133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069137">t</span><span class="op" id="7069138">.</span><span class="ident" id="7069139">Fatal</span><span class="op" id="7069144">(</span><span class="ident" id="7069145">err</span><span class="op" id="7069148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069155">esBytes</span>&nbsp;<span class="op" id="7069163">:=</span>&nbsp;<span class="op" id="7069166">&amp;</span><span class="ident" id="7069167">encodeState</span><span class="op" id="7069178">{</span><span class="op" id="7069179">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069182">_</span><span class="op" id="7069183">,</span>&nbsp;<span class="ident" id="7069185">err</span>&nbsp;<span class="op" id="7069189">=</span>&nbsp;<span class="ident" id="7069191">esBytes</span><span class="op" id="7069198">.</span><span class="ident" id="7069199">stringBytes</span><span class="op" id="7069210">(</span><span class="op" id="7069211">[</span><span class="op" id="7069212">]</span><span class="builtintype" id="7069213">byte</span><span class="op" id="7069217">(</span><span class="ident" id="7069218">s</span><span class="op" id="7069219">)</span><span class="op" id="7069220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069223">if</span>&nbsp;<span class="ident" id="7069226">err</span>&nbsp;<span class="op" id="7069230">!=</span>&nbsp;<span class="builtintype" id="7069233">nil</span>&nbsp;<span class="op" id="7069237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069241">t</span><span class="op" id="7069242">.</span><span class="ident" id="7069243">Fatal</span><span class="op" id="7069248">(</span><span class="ident" id="7069249">err</span><span class="op" id="7069252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069259">enc</span>&nbsp;<span class="op" id="7069263">:=</span>&nbsp;<span class="ident" id="7069266">es</span><span class="op" id="7069268">.</span><span class="ident" id="7069269">Buffer</span><span class="op" id="7069275">.</span><span class="ident" id="7069276">String</span><span class="op" id="7069282">(</span><span class="op" id="7069283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069286">encBytes</span>&nbsp;<span class="op" id="7069295">:=</span>&nbsp;<span class="ident" id="7069298">esBytes</span><span class="op" id="7069305">.</span><span class="ident" id="7069306">Buffer</span><span class="op" id="7069312">.</span><span class="ident" id="7069313">String</span><span class="op" id="7069319">(</span><span class="op" id="7069320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069323">if</span>&nbsp;<span class="ident" id="7069326">enc</span>&nbsp;<span class="op" id="7069330">!=</span>&nbsp;<span class="ident" id="7069333">encBytes</span>&nbsp;<span class="op" id="7069342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069346">i</span>&nbsp;<span class="op" id="7069348">:=</span>&nbsp;<span class="num" id="7069351">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069355">for</span>&nbsp;<span class="ident" id="7069359">i</span>&nbsp;<span class="op" id="7069361">&lt;</span>&nbsp;<span class="builtinfunc" id="7069363">len</span><span class="op" id="7069366">(</span><span class="ident" id="7069367">enc</span><span class="op" id="7069370">)</span>&nbsp;<span class="op" id="7069372">&amp;&amp;</span>&nbsp;<span class="ident" id="7069375">i</span>&nbsp;<span class="op" id="7069377">&lt;</span>&nbsp;<span class="builtinfunc" id="7069379">len</span><span class="op" id="7069382">(</span><span class="ident" id="7069383">encBytes</span><span class="op" id="7069391">)</span>&nbsp;<span class="op" id="7069393">&amp;&amp;</span>&nbsp;<span class="ident" id="7069396">enc</span><span class="op" id="7069399">[</span><span class="ident" id="7069400">i</span><span class="op" id="7069401">]</span>&nbsp;<span class="op" id="7069403">==</span>&nbsp;<span class="ident" id="7069406">encBytes</span><span class="op" id="7069414">[</span><span class="ident" id="7069415">i</span><span class="op" id="7069416">]</span>&nbsp;<span class="op" id="7069418">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069423">i</span><span class="op" id="7069424">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069433">enc</span>&nbsp;<span class="op" id="7069437">=</span>&nbsp;<span class="ident" id="7069439">enc</span><span class="op" id="7069442">[</span><span class="ident" id="7069443">i</span><span class="op" id="7069444">:</span><span class="op" id="7069445">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069449">encBytes</span>&nbsp;<span class="op" id="7069458">=</span>&nbsp;<span class="ident" id="7069460">encBytes</span><span class="op" id="7069468">[</span><span class="ident" id="7069469">i</span><span class="op" id="7069470">:</span><span class="op" id="7069471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069475">i</span>&nbsp;<span class="op" id="7069477">=</span>&nbsp;<span class="num" id="7069479">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069483">for</span>&nbsp;<span class="ident" id="7069487">i</span>&nbsp;<span class="op" id="7069489">&lt;</span>&nbsp;<span class="builtinfunc" id="7069491">len</span><span class="op" id="7069494">(</span><span class="ident" id="7069495">enc</span><span class="op" id="7069498">)</span>&nbsp;<span class="op" id="7069500">&amp;&amp;</span>&nbsp;<span class="ident" id="7069503">i</span>&nbsp;<span class="op" id="7069505">&lt;</span>&nbsp;<span class="builtinfunc" id="7069507">len</span><span class="op" id="7069510">(</span><span class="ident" id="7069511">encBytes</span><span class="op" id="7069519">)</span>&nbsp;<span class="op" id="7069521">&amp;&amp;</span>&nbsp;<span class="ident" id="7069524">enc</span><span class="op" id="7069527">[</span><span class="builtinfunc" id="7069528">len</span><span class="op" id="7069531">(</span><span class="ident" id="7069532">enc</span><span class="op" id="7069535">)</span><span class="op" id="7069536">-</span><span class="ident" id="7069537">i</span><span class="op" id="7069538">-</span><span class="num" id="7069539">1</span><span class="op" id="7069540">]</span>&nbsp;<span class="op" id="7069542">==</span>&nbsp;<span class="ident" id="7069545">encBytes</span><span class="op" id="7069553">[</span><span class="builtinfunc" id="7069554">len</span><span class="op" id="7069557">(</span><span class="ident" id="7069558">encBytes</span><span class="op" id="7069566">)</span><span class="op" id="7069567">-</span><span class="ident" id="7069568">i</span><span class="op" id="7069569">-</span><span class="num" id="7069570">1</span><span class="op" id="7069571">]</span>&nbsp;<span class="op" id="7069573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069578">i</span><span class="op" id="7069579">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069588">enc</span>&nbsp;<span class="op" id="7069592">=</span>&nbsp;<span class="ident" id="7069594">enc</span><span class="op" id="7069597">[</span><span class="op" id="7069598">:</span><span class="builtinfunc" id="7069599">len</span><span class="op" id="7069602">(</span><span class="ident" id="7069603">enc</span><span class="op" id="7069606">)</span><span class="op" id="7069607">-</span><span class="ident" id="7069608">i</span><span class="op" id="7069609">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069613">encBytes</span>&nbsp;<span class="op" id="7069622">=</span>&nbsp;<span class="ident" id="7069624">encBytes</span><span class="op" id="7069632">[</span><span class="op" id="7069633">:</span><span class="builtinfunc" id="7069634">len</span><span class="op" id="7069637">(</span><span class="ident" id="7069638">encBytes</span><span class="op" id="7069646">)</span><span class="op" id="7069647">-</span><span class="ident" id="7069648">i</span><span class="op" id="7069649">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069654">if</span>&nbsp;<span class="builtinfunc" id="7069657">len</span><span class="op" id="7069660">(</span><span class="ident" id="7069661">enc</span><span class="op" id="7069664">)</span>&nbsp;<span class="op" id="7069666">&gt;</span>&nbsp;<span class="num" id="7069668">20</span>&nbsp;<span class="op" id="7069671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069676">enc</span>&nbsp;<span class="op" id="7069680">=</span>&nbsp;<span class="ident" id="7069682">enc</span><span class="op" id="7069685">[</span><span class="op" id="7069686">:</span><span class="num" id="7069687">20</span><span class="op" id="7069689">]</span>&nbsp;<span class="op" id="7069691">+</span>&nbsp;<span class="string" id="7069693">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069705">if</span>&nbsp;<span class="builtinfunc" id="7069708">len</span><span class="op" id="7069711">(</span><span class="ident" id="7069712">encBytes</span><span class="op" id="7069720">)</span>&nbsp;<span class="op" id="7069722">&gt;</span>&nbsp;<span class="num" id="7069724">20</span>&nbsp;<span class="op" id="7069727">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069732">encBytes</span>&nbsp;<span class="op" id="7069741">=</span>&nbsp;<span class="ident" id="7069743">encBytes</span><span class="op" id="7069751">[</span><span class="op" id="7069752">:</span><span class="num" id="7069753">20</span><span class="op" id="7069755">]</span>&nbsp;<span class="op" id="7069757">+</span>&nbsp;<span class="string" id="7069759">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069772">t</span><span class="op" id="7069773">.</span><span class="ident" id="7069774">Errorf</span><span class="op" id="7069780">(</span><span class="string" id="7069781">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="7069813">,</span>&nbsp;<span class="ident" id="7069815">enc</span><span class="op" id="7069818">,</span>&nbsp;<span class="ident" id="7069820">encBytes</span><span class="op" id="7069828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069831">}</span><br>
<span class="lineno">420</span><span class="op" id="7069833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7069836">func</span>&nbsp;<span class="ident" id="7069841">TestIssue6458</span><span class="op" id="7069854">(</span><span class="ident" id="7069855">t</span>&nbsp;<span class="op" id="7069857">*</span><span class="ident" id="7069858">testing</span><span class="op" id="7069865">.</span><span class="ident" id="7069866">T</span><span class="op" id="7069867">)</span>&nbsp;<span class="op" id="7069869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069872">type</span>&nbsp;<span class="ident" id="7069877">Foo</span>&nbsp;<span class="keyword" id="7069881">struct</span>&nbsp;<span class="op" id="7069888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069892">M</span>&nbsp;<span class="ident" id="7069894">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069909">x</span>&nbsp;<span class="op" id="7069911">:=</span>&nbsp;<span class="ident" id="7069914">Foo</span><span class="op" id="7069917">{</span><span class="ident" id="7069918">RawMessage</span><span class="op" id="7069928">(</span><span class="string" id="7069929">`&#34;foo&#34;`</span><span class="op" id="7069936">)</span><span class="op" id="7069937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069941">b</span><span class="op" id="7069942">,</span>&nbsp;<span class="ident" id="7069944">err</span>&nbsp;<span class="op" id="7069948">:=</span>&nbsp;<span class="ident" id="7069951">Marshal</span><span class="op" id="7069958">(</span><span class="op" id="7069959">&amp;</span><span class="ident" id="7069960">x</span><span class="op" id="7069961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069964">if</span>&nbsp;<span class="ident" id="7069967">err</span>&nbsp;<span class="op" id="7069971">!=</span>&nbsp;<span class="builtintype" id="7069974">nil</span>&nbsp;<span class="op" id="7069978">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7069982">t</span><span class="op" id="7069983">.</span><span class="ident" id="7069984">Fatal</span><span class="op" id="7069989">(</span><span class="ident" id="7069990">err</span><span class="op" id="7069993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7069996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7069999">if</span>&nbsp;<span class="ident" id="7070002">want</span>&nbsp;<span class="op" id="7070007">:=</span>&nbsp;<span class="string" id="7070010">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="7070023">;</span>&nbsp;<span class="builtintype" id="7070025">string</span><span class="op" id="7070031">(</span><span class="ident" id="7070032">b</span><span class="op" id="7070033">)</span>&nbsp;<span class="op" id="7070035">!=</span>&nbsp;<span class="ident" id="7070038">want</span>&nbsp;<span class="op" id="7070043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070047">t</span><span class="op" id="7070048">.</span><span class="ident" id="7070049">Errorf</span><span class="op" id="7070055">(</span><span class="string" id="7070056">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7070085">,</span>&nbsp;<span class="ident" id="7070087">b</span><span class="op" id="7070088">,</span>&nbsp;<span class="ident" id="7070090">want</span><span class="op" id="7070094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070097">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070101">b</span><span class="op" id="7070102">,</span>&nbsp;<span class="ident" id="7070104">err</span>&nbsp;<span class="op" id="7070108">=</span>&nbsp;<span class="ident" id="7070110">Marshal</span><span class="op" id="7070117">(</span><span class="ident" id="7070118">x</span><span class="op" id="7070119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070122">if</span>&nbsp;<span class="ident" id="7070125">err</span>&nbsp;<span class="op" id="7070129">!=</span>&nbsp;<span class="builtintype" id="7070132">nil</span>&nbsp;<span class="op" id="7070136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070140">t</span><span class="op" id="7070141">.</span><span class="ident" id="7070142">Fatal</span><span class="op" id="7070147">(</span><span class="ident" id="7070148">err</span><span class="op" id="7070151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070154">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070158">if</span>&nbsp;<span class="ident" id="7070161">want</span>&nbsp;<span class="op" id="7070166">:=</span>&nbsp;<span class="string" id="7070169">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="7070187">;</span>&nbsp;<span class="builtintype" id="7070189">string</span><span class="op" id="7070195">(</span><span class="ident" id="7070196">b</span><span class="op" id="7070197">)</span>&nbsp;<span class="op" id="7070199">!=</span>&nbsp;<span class="ident" id="7070202">want</span>&nbsp;<span class="op" id="7070207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070211">t</span><span class="op" id="7070212">.</span><span class="ident" id="7070213">Errorf</span><span class="op" id="7070219">(</span><span class="string" id="7070220">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7070248">,</span>&nbsp;<span class="ident" id="7070250">b</span><span class="op" id="7070251">,</span>&nbsp;<span class="ident" id="7070253">want</span><span class="op" id="7070257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070260">}</span><br>
<span class="lineno"></span><span class="op" id="7070262">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7070265">func</span>&nbsp;<span class="ident" id="7070270">TestHTMLEscape</span><span class="op" id="7070284">(</span><span class="ident" id="7070285">t</span>&nbsp;<span class="op" id="7070287">*</span><span class="ident" id="7070288">testing</span><span class="op" id="7070295">.</span><span class="ident" id="7070296">T</span><span class="op" id="7070297">)</span>&nbsp;<span class="op" id="7070299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070302">var</span>&nbsp;<span class="ident" id="7070306">b</span><span class="op" id="7070307">,</span>&nbsp;<span class="ident" id="7070309">want</span>&nbsp;<span class="ident" id="7070314">bytes</span><span class="op" id="7070319">.</span><span class="ident" id="7070320">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070328">m</span>&nbsp;<span class="op" id="7070330">:=</span>&nbsp;<span class="string" id="7070333">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="7070353">+</span>&nbsp;<span class="string" id="7070355">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="7070383">+</span>&nbsp;<span class="string" id="7070385">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070398">want</span><span class="op" id="7070402">.</span><span class="ident" id="7070403">Write</span><span class="op" id="7070408">(</span><span class="op" id="7070409">[</span><span class="op" id="7070410">]</span><span class="builtintype" id="7070411">byte</span><span class="op" id="7070415">(</span><span class="string" id="7070416">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="7070482">)</span><span class="op" id="7070483">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070486">HTMLEscape</span><span class="op" id="7070496">(</span><span class="op" id="7070497">&amp;</span><span class="ident" id="7070498">b</span><span class="op" id="7070499">,</span>&nbsp;<span class="op" id="7070501">[</span><span class="op" id="7070502">]</span><span class="builtintype" id="7070503">byte</span><span class="op" id="7070507">(</span><span class="ident" id="7070508">m</span><span class="op" id="7070509">)</span><span class="op" id="7070510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070513">if</span>&nbsp;<span class="op" id="7070516">!</span><span class="ident" id="7070517">bytes</span><span class="op" id="7070522">.</span><span class="ident" id="7070523">Equal</span><span class="op" id="7070528">(</span><span class="ident" id="7070529">b</span><span class="op" id="7070530">.</span><span class="ident" id="7070531">Bytes</span><span class="op" id="7070536">(</span><span class="op" id="7070537">)</span><span class="op" id="7070538">,</span>&nbsp;<span class="ident" id="7070540">want</span><span class="op" id="7070544">.</span><span class="ident" id="7070545">Bytes</span><span class="op" id="7070550">(</span><span class="op" id="7070551">)</span><span class="op" id="7070552">)</span>&nbsp;<span class="op" id="7070554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070558">t</span><span class="op" id="7070559">.</span><span class="ident" id="7070560">Errorf</span><span class="op" id="7070566">(</span><span class="string" id="7070567">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7070608">,</span>&nbsp;<span class="ident" id="7070610">b</span><span class="op" id="7070611">.</span><span class="ident" id="7070612">Bytes</span><span class="op" id="7070617">(</span><span class="op" id="7070618">)</span><span class="op" id="7070619">,</span>&nbsp;<span class="ident" id="7070621">want</span><span class="op" id="7070625">.</span><span class="ident" id="7070626">Bytes</span><span class="op" id="7070631">(</span><span class="op" id="7070632">)</span><span class="op" id="7070633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070636">}</span><br>
<span class="lineno"></span><span class="op" id="7070638">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="7070641">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="7070666">func</span>&nbsp;<span class="ident" id="7070671">TestEncodePointerString</span><span class="op" id="7070694">(</span><span class="ident" id="7070695">t</span>&nbsp;<span class="op" id="7070697">*</span><span class="ident" id="7070698">testing</span><span class="op" id="7070705">.</span><span class="ident" id="7070706">T</span><span class="op" id="7070707">)</span>&nbsp;<span class="op" id="7070709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070712">type</span>&nbsp;<span class="ident" id="7070717">stringPointer</span>&nbsp;<span class="keyword" id="7070731">struct</span>&nbsp;<span class="op" id="7070738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070742">N</span>&nbsp;<span class="op" id="7070744">*</span><span class="builtintype" id="7070745">int64</span>&nbsp;<span class="string" id="7070751">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070773">var</span>&nbsp;<span class="ident" id="7070777">n</span>&nbsp;<span class="builtintype" id="7070779">int64</span>&nbsp;<span class="op" id="7070785">=</span>&nbsp;<span class="num" id="7070787">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070791">b</span><span class="op" id="7070792">,</span>&nbsp;<span class="ident" id="7070794">err</span>&nbsp;<span class="op" id="7070798">:=</span>&nbsp;<span class="ident" id="7070801">Marshal</span><span class="op" id="7070808">(</span><span class="ident" id="7070809">stringPointer</span><span class="op" id="7070822">{</span><span class="ident" id="7070823">N</span><span class="op" id="7070824">:</span>&nbsp;<span class="op" id="7070826">&amp;</span><span class="ident" id="7070827">n</span><span class="op" id="7070828">}</span><span class="op" id="7070829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070832">if</span>&nbsp;<span class="ident" id="7070835">err</span>&nbsp;<span class="op" id="7070839">!=</span>&nbsp;<span class="builtintype" id="7070842">nil</span>&nbsp;<span class="op" id="7070846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070850">t</span><span class="op" id="7070851">.</span><span class="ident" id="7070852">Fatalf</span><span class="op" id="7070858">(</span><span class="string" id="7070859">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7070872">,</span>&nbsp;<span class="ident" id="7070874">err</span><span class="op" id="7070877">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070883">if</span>&nbsp;<span class="ident" id="7070886">got</span><span class="op" id="7070889">,</span>&nbsp;<span class="ident" id="7070891">want</span>&nbsp;<span class="op" id="7070896">:=</span>&nbsp;<span class="builtintype" id="7070899">string</span><span class="op" id="7070905">(</span><span class="ident" id="7070906">b</span><span class="op" id="7070907">)</span><span class="op" id="7070908">,</span>&nbsp;<span class="string" id="7070910">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="7070922">;</span>&nbsp;<span class="ident" id="7070924">got</span>&nbsp;<span class="op" id="7070928">!=</span>&nbsp;<span class="ident" id="7070931">want</span>&nbsp;<span class="op" id="7070936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7070940">t</span><span class="op" id="7070941">.</span><span class="ident" id="7070942">Errorf</span><span class="op" id="7070948">(</span><span class="string" id="7070949">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7070972">,</span>&nbsp;<span class="ident" id="7070974">got</span><span class="op" id="7070977">,</span>&nbsp;<span class="ident" id="7070979">want</span><span class="op" id="7070983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7070986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7070989">var</span>&nbsp;<span class="ident" id="7070993">back</span>&nbsp;<span class="ident" id="7070998">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7071013">err</span>&nbsp;<span class="op" id="7071017">=</span>&nbsp;<span class="ident" id="7071019">Unmarshal</span><span class="op" id="7071028">(</span><span class="ident" id="7071029">b</span><span class="op" id="7071030">,</span>&nbsp;<span class="op" id="7071032">&amp;</span><span class="ident" id="7071033">back</span><span class="op" id="7071037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7071040">if</span>&nbsp;<span class="ident" id="7071043">err</span>&nbsp;<span class="op" id="7071047">!=</span>&nbsp;<span class="builtintype" id="7071050">nil</span>&nbsp;<span class="op" id="7071054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7071058">t</span><span class="op" id="7071059">.</span><span class="ident" id="7071060">Fatalf</span><span class="op" id="7071066">(</span><span class="string" id="7071067">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="7071082">,</span>&nbsp;<span class="ident" id="7071084">err</span><span class="op" id="7071087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7071093">if</span>&nbsp;<span class="ident" id="7071096">back</span><span class="op" id="7071100">.</span><span class="ident" id="7071101">N</span>&nbsp;<span class="op" id="7071103">==</span>&nbsp;<span class="builtintype" id="7071106">nil</span>&nbsp;<span class="op" id="7071110">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7071114">t</span><span class="op" id="7071115">.</span><span class="ident" id="7071116">Fatalf</span><span class="op" id="7071122">(</span><span class="string" id="7071123">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="7071149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7071155">if</span>&nbsp;<span class="op" id="7071158">*</span><span class="ident" id="7071159">back</span><span class="op" id="7071163">.</span><span class="ident" id="7071164">N</span>&nbsp;<span class="op" id="7071166">!=</span>&nbsp;<span class="num" id="7071169">42</span>&nbsp;<span class="op" id="7071172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7071176">t</span><span class="op" id="7071177">.</span><span class="ident" id="7071178">Fatalf</span><span class="op" id="7071184">(</span><span class="string" id="7071185">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="7071203">,</span>&nbsp;<span class="op" id="7071205">*</span><span class="ident" id="7071206">back</span><span class="op" id="7071210">.</span><span class="ident" id="7071211">N</span><span class="op" id="7071212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071215">}</span><br>
<span class="lineno">480</span><span class="op" id="7071217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7071220">var</span>&nbsp;<span class="ident" id="7071224">encodeStringTests</span>&nbsp;<span class="op" id="7071242">=</span>&nbsp;<span class="op" id="7071244">[</span><span class="op" id="7071245">]</span><span class="keyword" id="7071246">struct</span>&nbsp;<span class="op" id="7071253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7071256">in</span>&nbsp;&nbsp;<span class="builtintype" id="7071260">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7071268">out</span>&nbsp;<span class="builtintype" id="7071272">string</span><br>
<span class="lineno">485</span><span class="op" id="7071279">}</span><span class="op" id="7071280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071283">{</span><span class="string" id="7071284">&#34;\x00&#34;</span><span class="op" id="7071290">,</span>&nbsp;<span class="string" id="7071292">`&#34;\u0000&#34;`</span><span class="op" id="7071302">}</span><span class="op" id="7071303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071306">{</span><span class="string" id="7071307">&#34;\x01&#34;</span><span class="op" id="7071313">,</span>&nbsp;<span class="string" id="7071315">`&#34;\u0001&#34;`</span><span class="op" id="7071325">}</span><span class="op" id="7071326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071329">{</span><span class="string" id="7071330">&#34;\x02&#34;</span><span class="op" id="7071336">,</span>&nbsp;<span class="string" id="7071338">`&#34;\u0002&#34;`</span><span class="op" id="7071348">}</span><span class="op" id="7071349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071352">{</span><span class="string" id="7071353">&#34;\x03&#34;</span><span class="op" id="7071359">,</span>&nbsp;<span class="string" id="7071361">`&#34;\u0003&#34;`</span><span class="op" id="7071371">}</span><span class="op" id="7071372">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071375">{</span><span class="string" id="7071376">&#34;\x04&#34;</span><span class="op" id="7071382">,</span>&nbsp;<span class="string" id="7071384">`&#34;\u0004&#34;`</span><span class="op" id="7071394">}</span><span class="op" id="7071395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071398">{</span><span class="string" id="7071399">&#34;\x05&#34;</span><span class="op" id="7071405">,</span>&nbsp;<span class="string" id="7071407">`&#34;\u0005&#34;`</span><span class="op" id="7071417">}</span><span class="op" id="7071418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071421">{</span><span class="string" id="7071422">&#34;\x06&#34;</span><span class="op" id="7071428">,</span>&nbsp;<span class="string" id="7071430">`&#34;\u0006&#34;`</span><span class="op" id="7071440">}</span><span class="op" id="7071441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071444">{</span><span class="string" id="7071445">&#34;\x07&#34;</span><span class="op" id="7071451">,</span>&nbsp;<span class="string" id="7071453">`&#34;\u0007&#34;`</span><span class="op" id="7071463">}</span><span class="op" id="7071464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071467">{</span><span class="string" id="7071468">&#34;\x08&#34;</span><span class="op" id="7071474">,</span>&nbsp;<span class="string" id="7071476">`&#34;\u0008&#34;`</span><span class="op" id="7071486">}</span><span class="op" id="7071487">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071490">{</span><span class="string" id="7071491">&#34;\x09&#34;</span><span class="op" id="7071497">,</span>&nbsp;<span class="string" id="7071499">`&#34;\t&#34;`</span><span class="op" id="7071505">}</span><span class="op" id="7071506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071509">{</span><span class="string" id="7071510">&#34;\x0a&#34;</span><span class="op" id="7071516">,</span>&nbsp;<span class="string" id="7071518">`&#34;\n&#34;`</span><span class="op" id="7071524">}</span><span class="op" id="7071525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071528">{</span><span class="string" id="7071529">&#34;\x0b&#34;</span><span class="op" id="7071535">,</span>&nbsp;<span class="string" id="7071537">`&#34;\u000b&#34;`</span><span class="op" id="7071547">}</span><span class="op" id="7071548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071551">{</span><span class="string" id="7071552">&#34;\x0c&#34;</span><span class="op" id="7071558">,</span>&nbsp;<span class="string" id="7071560">`&#34;\u000c&#34;`</span><span class="op" id="7071570">}</span><span class="op" id="7071571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071574">{</span><span class="string" id="7071575">&#34;\x0d&#34;</span><span class="op" id="7071581">,</span>&nbsp;<span class="string" id="7071583">`&#34;\r&#34;`</span><span class="op" id="7071589">}</span><span class="op" id="7071590">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071593">{</span><span class="string" id="7071594">&#34;\x0e&#34;</span><span class="op" id="7071600">,</span>&nbsp;<span class="string" id="7071602">`&#34;\u000e&#34;`</span><span class="op" id="7071612">}</span><span class="op" id="7071613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071616">{</span><span class="string" id="7071617">&#34;\x0f&#34;</span><span class="op" id="7071623">,</span>&nbsp;<span class="string" id="7071625">`&#34;\u000f&#34;`</span><span class="op" id="7071635">}</span><span class="op" id="7071636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071639">{</span><span class="string" id="7071640">&#34;\x10&#34;</span><span class="op" id="7071646">,</span>&nbsp;<span class="string" id="7071648">`&#34;\u0010&#34;`</span><span class="op" id="7071658">}</span><span class="op" id="7071659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071662">{</span><span class="string" id="7071663">&#34;\x11&#34;</span><span class="op" id="7071669">,</span>&nbsp;<span class="string" id="7071671">`&#34;\u0011&#34;`</span><span class="op" id="7071681">}</span><span class="op" id="7071682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071685">{</span><span class="string" id="7071686">&#34;\x12&#34;</span><span class="op" id="7071692">,</span>&nbsp;<span class="string" id="7071694">`&#34;\u0012&#34;`</span><span class="op" id="7071704">}</span><span class="op" id="7071705">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071708">{</span><span class="string" id="7071709">&#34;\x13&#34;</span><span class="op" id="7071715">,</span>&nbsp;<span class="string" id="7071717">`&#34;\u0013&#34;`</span><span class="op" id="7071727">}</span><span class="op" id="7071728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071731">{</span><span class="string" id="7071732">&#34;\x14&#34;</span><span class="op" id="7071738">,</span>&nbsp;<span class="string" id="7071740">`&#34;\u0014&#34;`</span><span class="op" id="7071750">}</span><span class="op" id="7071751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071754">{</span><span class="string" id="7071755">&#34;\x15&#34;</span><span class="op" id="7071761">,</span>&nbsp;<span class="string" id="7071763">`&#34;\u0015&#34;`</span><span class="op" id="7071773">}</span><span class="op" id="7071774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071777">{</span><span class="string" id="7071778">&#34;\x16&#34;</span><span class="op" id="7071784">,</span>&nbsp;<span class="string" id="7071786">`&#34;\u0016&#34;`</span><span class="op" id="7071796">}</span><span class="op" id="7071797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071800">{</span><span class="string" id="7071801">&#34;\x17&#34;</span><span class="op" id="7071807">,</span>&nbsp;<span class="string" id="7071809">`&#34;\u0017&#34;`</span><span class="op" id="7071819">}</span><span class="op" id="7071820">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071823">{</span><span class="string" id="7071824">&#34;\x18&#34;</span><span class="op" id="7071830">,</span>&nbsp;<span class="string" id="7071832">`&#34;\u0018&#34;`</span><span class="op" id="7071842">}</span><span class="op" id="7071843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071846">{</span><span class="string" id="7071847">&#34;\x19&#34;</span><span class="op" id="7071853">,</span>&nbsp;<span class="string" id="7071855">`&#34;\u0019&#34;`</span><span class="op" id="7071865">}</span><span class="op" id="7071866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071869">{</span><span class="string" id="7071870">&#34;\x1a&#34;</span><span class="op" id="7071876">,</span>&nbsp;<span class="string" id="7071878">`&#34;\u001a&#34;`</span><span class="op" id="7071888">}</span><span class="op" id="7071889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071892">{</span><span class="string" id="7071893">&#34;\x1b&#34;</span><span class="op" id="7071899">,</span>&nbsp;<span class="string" id="7071901">`&#34;\u001b&#34;`</span><span class="op" id="7071911">}</span><span class="op" id="7071912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071915">{</span><span class="string" id="7071916">&#34;\x1c&#34;</span><span class="op" id="7071922">,</span>&nbsp;<span class="string" id="7071924">`&#34;\u001c&#34;`</span><span class="op" id="7071934">}</span><span class="op" id="7071935">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071938">{</span><span class="string" id="7071939">&#34;\x1d&#34;</span><span class="op" id="7071945">,</span>&nbsp;<span class="string" id="7071947">`&#34;\u001d&#34;`</span><span class="op" id="7071957">}</span><span class="op" id="7071958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071961">{</span><span class="string" id="7071962">&#34;\x1e&#34;</span><span class="op" id="7071968">,</span>&nbsp;<span class="string" id="7071970">`&#34;\u001e&#34;`</span><span class="op" id="7071980">}</span><span class="op" id="7071981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7071984">{</span><span class="string" id="7071985">&#34;\x1f&#34;</span><span class="op" id="7071991">,</span>&nbsp;<span class="string" id="7071993">`&#34;\u001f&#34;`</span><span class="op" id="7072003">}</span><span class="op" id="7072004">,</span><br>
<span class="lineno"></span><span class="op" id="7072006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="7072009">func</span>&nbsp;<span class="ident" id="7072014">TestEncodeString</span><span class="op" id="7072030">(</span><span class="ident" id="7072031">t</span>&nbsp;<span class="op" id="7072033">*</span><span class="ident" id="7072034">testing</span><span class="op" id="7072041">.</span><span class="ident" id="7072042">T</span><span class="op" id="7072043">)</span>&nbsp;<span class="op" id="7072045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7072048">for</span>&nbsp;<span class="ident" id="7072052">_</span><span class="op" id="7072053">,</span>&nbsp;<span class="ident" id="7072055">tt</span>&nbsp;<span class="op" id="7072058">:=</span>&nbsp;<span class="keyword" id="7072061">range</span>&nbsp;<span class="ident" id="7072067">encodeStringTests</span>&nbsp;<span class="op" id="7072085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7072089">b</span><span class="op" id="7072090">,</span>&nbsp;<span class="ident" id="7072092">err</span>&nbsp;<span class="op" id="7072096">:=</span>&nbsp;<span class="ident" id="7072099">Marshal</span><span class="op" id="7072106">(</span><span class="ident" id="7072107">tt</span><span class="op" id="7072109">.</span><span class="ident" id="7072110">in</span><span class="op" id="7072112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7072116">if</span>&nbsp;<span class="ident" id="7072119">err</span>&nbsp;<span class="op" id="7072123">!=</span>&nbsp;<span class="builtintype" id="7072126">nil</span>&nbsp;<span class="op" id="7072130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7072135">t</span><span class="op" id="7072136">.</span><span class="ident" id="7072137">Errorf</span><span class="op" id="7072143">(</span><span class="string" id="7072144">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="7072161">,</span>&nbsp;<span class="ident" id="7072163">tt</span><span class="op" id="7072165">.</span><span class="ident" id="7072166">in</span><span class="op" id="7072168">,</span>&nbsp;<span class="ident" id="7072170">err</span><span class="op" id="7072173">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7072178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7072189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7072193">out</span>&nbsp;<span class="op" id="7072197">:=</span>&nbsp;<span class="builtintype" id="7072200">string</span><span class="op" id="7072206">(</span><span class="ident" id="7072207">b</span><span class="op" id="7072208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7072212">if</span>&nbsp;<span class="ident" id="7072215">out</span>&nbsp;<span class="op" id="7072219">!=</span>&nbsp;<span class="ident" id="7072222">tt</span><span class="op" id="7072224">.</span><span class="ident" id="7072225">out</span>&nbsp;<span class="op" id="7072229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7072234">t</span><span class="op" id="7072235">.</span><span class="ident" id="7072236">Errorf</span><span class="op" id="7072242">(</span><span class="string" id="7072243">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7072272">,</span>&nbsp;<span class="ident" id="7072274">tt</span><span class="op" id="7072276">.</span><span class="ident" id="7072277">in</span><span class="op" id="7072279">,</span>&nbsp;<span class="ident" id="7072281">out</span><span class="op" id="7072284">,</span>&nbsp;<span class="ident" id="7072286">tt</span><span class="op" id="7072288">.</span><span class="ident" id="7072289">out</span><span class="op" id="7072292">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7072296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7072299">}</span><br>
<span class="lineno"></span><span class="op" id="7072301">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
