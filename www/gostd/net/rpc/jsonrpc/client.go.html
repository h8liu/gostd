<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5273100">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5273156">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5273210">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5273261">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="5273330">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5273354">package</span>&nbsp;<span class="ident" id="5273362">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5273371">import</span>&nbsp;<span class="op" id="5273378">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5273381">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5273398">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5273405">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5273411">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5273418">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5273429">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5273436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5273439">type</span>&nbsp;<span class="ident" id="5273444">clientCodec</span>&nbsp;<span class="keyword" id="5273456">struct</span>&nbsp;<span class="op" id="5273463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273466">dec</span>&nbsp;<span class="op" id="5273470">*</span><span class="ident" id="5273471">json</span><span class="op" id="5273475">.</span><span class="ident" id="5273476">Decoder</span>&nbsp;<span class="comment" id="5273484">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273512">enc</span>&nbsp;<span class="op" id="5273516">*</span><span class="ident" id="5273517">json</span><span class="op" id="5273521">.</span><span class="ident" id="5273522">Encoder</span>&nbsp;<span class="comment" id="5273530">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273558">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5273562">io</span><span class="op" id="5273564">.</span><span class="ident" id="5273565">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5273574">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273599">req</span>&nbsp;&nbsp;<span class="ident" id="5273604">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273619">resp</span>&nbsp;<span class="ident" id="5273624">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5273641">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5273715">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5273745">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5273810">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273883">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5273891">sync</span><span class="op" id="5273895">.</span><span class="ident" id="5273896">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5273909">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273930">pending</span>&nbsp;<span class="keyword" id="5273938">map</span><span class="op" id="5273941">[</span><span class="ident" id="5273942">uint64</span><span class="op" id="5273948">]</span><span class="builtintype" id="5273949">string</span>&nbsp;<span class="comment" id="5273956">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="5273989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5273992">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="5274064">func</span>&nbsp;<span class="ident" id="5274069">NewClientCodec</span><span class="op" id="5274083">(</span><span class="ident" id="5274084">conn</span>&nbsp;<span class="ident" id="5274089">io</span><span class="op" id="5274091">.</span><span class="ident" id="5274092">ReadWriteCloser</span><span class="op" id="5274107">)</span>&nbsp;<span class="ident" id="5274109">rpc</span><span class="op" id="5274112">.</span><span class="ident" id="5274113">ClientCodec</span>&nbsp;<span class="op" id="5274125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274128">return</span>&nbsp;<span class="op" id="5274135">&amp;</span><span class="ident" id="5274136">clientCodec</span><span class="op" id="5274147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274151">dec</span><span class="op" id="5274154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274160">json</span><span class="op" id="5274164">.</span><span class="ident" id="5274165">NewDecoder</span><span class="op" id="5274175">(</span><span class="ident" id="5274176">conn</span><span class="op" id="5274180">)</span><span class="op" id="5274181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274185">enc</span><span class="op" id="5274188">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274194">json</span><span class="op" id="5274198">.</span><span class="ident" id="5274199">NewEncoder</span><span class="op" id="5274209">(</span><span class="ident" id="5274210">conn</span><span class="op" id="5274214">)</span><span class="op" id="5274215">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274219">c</span><span class="op" id="5274220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274228">conn</span><span class="op" id="5274232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274236">pending</span><span class="op" id="5274243">:</span>&nbsp;<span class="builtinfunc" id="5274245">make</span><span class="op" id="5274249">(</span><span class="keyword" id="5274250">map</span><span class="op" id="5274253">[</span><span class="ident" id="5274254">uint64</span><span class="op" id="5274260">]</span><span class="builtintype" id="5274261">string</span><span class="op" id="5274267">)</span><span class="op" id="5274268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5274271">}</span><br>
<span class="lineno"></span><span class="op" id="5274273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5274276">type</span>&nbsp;<span class="ident" id="5274281">clientRequest</span>&nbsp;<span class="keyword" id="5274295">struct</span>&nbsp;<span class="op" id="5274302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274305">Method</span>&nbsp;<span class="builtintype" id="5274312">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5274327">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274344">Params</span>&nbsp;<span class="op" id="5274351">[</span><span class="num" id="5274352">1</span><span class="op" id="5274353">]</span><span class="keyword" id="5274354">interface</span><span class="op" id="5274363">{</span><span class="op" id="5274364">}</span>&nbsp;<span class="string" id="5274366">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274383">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274390">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5274405">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="5274417">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5274420">func</span>&nbsp;<span class="op" id="5274425">(</span><span class="ident" id="5274426">c</span>&nbsp;<span class="op" id="5274428">*</span><span class="ident" id="5274429">clientCodec</span><span class="op" id="5274440">)</span>&nbsp;<span class="ident" id="5274442">WriteRequest</span><span class="op" id="5274454">(</span><span class="ident" id="5274455">r</span>&nbsp;<span class="op" id="5274457">*</span><span class="ident" id="5274458">rpc</span><span class="op" id="5274461">.</span><span class="ident" id="5274462">Request</span><span class="op" id="5274469">,</span>&nbsp;<span class="ident" id="5274471">param</span>&nbsp;<span class="keyword" id="5274477">interface</span><span class="op" id="5274486">{</span><span class="op" id="5274487">}</span><span class="op" id="5274488">)</span>&nbsp;<span class="builtintype" id="5274490">error</span>&nbsp;<span class="op" id="5274496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274499">c</span><span class="op" id="5274500">.</span><span class="ident" id="5274501">mutex</span><span class="op" id="5274506">.</span><span class="ident" id="5274507">Lock</span><span class="op" id="5274511">(</span><span class="op" id="5274512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274515">c</span><span class="op" id="5274516">.</span><span class="ident" id="5274517">pending</span><span class="op" id="5274524">[</span><span class="ident" id="5274525">r</span><span class="op" id="5274526">.</span><span class="ident" id="5274527">Seq</span><span class="op" id="5274530">]</span>&nbsp;<span class="op" id="5274532">=</span>&nbsp;<span class="ident" id="5274534">r</span><span class="op" id="5274535">.</span><span class="ident" id="5274536">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274551">c</span><span class="op" id="5274552">.</span><span class="ident" id="5274553">mutex</span><span class="op" id="5274558">.</span><span class="ident" id="5274559">Unlock</span><span class="op" id="5274565">(</span><span class="op" id="5274566">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274569">c</span><span class="op" id="5274570">.</span><span class="ident" id="5274571">req</span><span class="op" id="5274574">.</span><span class="ident" id="5274575">Method</span>&nbsp;<span class="op" id="5274582">=</span>&nbsp;<span class="ident" id="5274584">r</span><span class="op" id="5274585">.</span><span class="ident" id="5274586">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274601">c</span><span class="op" id="5274602">.</span><span class="ident" id="5274603">req</span><span class="op" id="5274606">.</span><span class="ident" id="5274607">Params</span><span class="op" id="5274613">[</span><span class="num" id="5274614">0</span><span class="op" id="5274615">]</span>&nbsp;<span class="op" id="5274617">=</span>&nbsp;<span class="ident" id="5274619">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274626">c</span><span class="op" id="5274627">.</span><span class="ident" id="5274628">req</span><span class="op" id="5274631">.</span><span class="ident" id="5274632">Id</span>&nbsp;<span class="op" id="5274635">=</span>&nbsp;<span class="ident" id="5274637">r</span><span class="op" id="5274638">.</span><span class="ident" id="5274639">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274644">return</span>&nbsp;<span class="ident" id="5274651">c</span><span class="op" id="5274652">.</span><span class="ident" id="5274653">enc</span><span class="op" id="5274656">.</span><span class="ident" id="5274657">Encode</span><span class="op" id="5274663">(</span><span class="op" id="5274664">&amp;</span><span class="ident" id="5274665">c</span><span class="op" id="5274666">.</span><span class="ident" id="5274667">req</span><span class="op" id="5274670">)</span><br>
<span class="lineno"></span><span class="op" id="5274672">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5274675">type</span>&nbsp;<span class="ident" id="5274680">clientResponse</span>&nbsp;<span class="keyword" id="5274695">struct</span>&nbsp;<span class="op" id="5274702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274705">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274712">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5274729">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274742">Result</span>&nbsp;<span class="op" id="5274749">*</span><span class="ident" id="5274750">json</span><span class="op" id="5274754">.</span><span class="ident" id="5274755">RawMessage</span>&nbsp;<span class="string" id="5274766">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274783">Error</span>&nbsp;&nbsp;<span class="keyword" id="5274790">interface</span><span class="op" id="5274799">{</span><span class="op" id="5274800">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5274807">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="5274822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5274825">func</span>&nbsp;<span class="op" id="5274830">(</span><span class="ident" id="5274831">r</span>&nbsp;<span class="op" id="5274833">*</span><span class="ident" id="5274834">clientResponse</span><span class="op" id="5274848">)</span>&nbsp;<span class="ident" id="5274850">reset</span><span class="op" id="5274855">(</span><span class="op" id="5274856">)</span>&nbsp;<span class="op" id="5274858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274861">r</span><span class="op" id="5274862">.</span><span class="ident" id="5274863">Id</span>&nbsp;<span class="op" id="5274866">=</span>&nbsp;<span class="num" id="5274868">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274871">r</span><span class="op" id="5274872">.</span><span class="ident" id="5274873">Result</span>&nbsp;<span class="op" id="5274880">=</span>&nbsp;<span class="ident" id="5274882">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274887">r</span><span class="op" id="5274888">.</span><span class="ident" id="5274889">Error</span>&nbsp;<span class="op" id="5274895">=</span>&nbsp;<span class="ident" id="5274897">nil</span><br>
<span class="lineno"></span><span class="op" id="5274901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5274904">func</span>&nbsp;<span class="op" id="5274909">(</span><span class="ident" id="5274910">c</span>&nbsp;<span class="op" id="5274912">*</span><span class="ident" id="5274913">clientCodec</span><span class="op" id="5274924">)</span>&nbsp;<span class="ident" id="5274926">ReadResponseHeader</span><span class="op" id="5274944">(</span><span class="ident" id="5274945">r</span>&nbsp;<span class="op" id="5274947">*</span><span class="ident" id="5274948">rpc</span><span class="op" id="5274951">.</span><span class="ident" id="5274952">Response</span><span class="op" id="5274960">)</span>&nbsp;<span class="builtintype" id="5274962">error</span>&nbsp;<span class="op" id="5274968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274971">c</span><span class="op" id="5274972">.</span><span class="ident" id="5274973">resp</span><span class="op" id="5274977">.</span><span class="ident" id="5274978">reset</span><span class="op" id="5274983">(</span><span class="op" id="5274984">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274987">if</span>&nbsp;<span class="ident" id="5274990">err</span>&nbsp;<span class="op" id="5274994">:=</span>&nbsp;<span class="ident" id="5274997">c</span><span class="op" id="5274998">.</span><span class="ident" id="5274999">dec</span><span class="op" id="5275002">.</span><span class="ident" id="5275003">Decode</span><span class="op" id="5275009">(</span><span class="op" id="5275010">&amp;</span><span class="ident" id="5275011">c</span><span class="op" id="5275012">.</span><span class="ident" id="5275013">resp</span><span class="op" id="5275017">)</span><span class="op" id="5275018">;</span>&nbsp;<span class="ident" id="5275020">err</span>&nbsp;<span class="op" id="5275024">!=</span>&nbsp;<span class="ident" id="5275027">nil</span>&nbsp;<span class="op" id="5275031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275035">return</span>&nbsp;<span class="ident" id="5275042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5275047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275051">c</span><span class="op" id="5275052">.</span><span class="ident" id="5275053">mutex</span><span class="op" id="5275058">.</span><span class="ident" id="5275059">Lock</span><span class="op" id="5275063">(</span><span class="op" id="5275064">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275067">r</span><span class="op" id="5275068">.</span><span class="ident" id="5275069">ServiceMethod</span>&nbsp;<span class="op" id="5275083">=</span>&nbsp;<span class="ident" id="5275085">c</span><span class="op" id="5275086">.</span><span class="ident" id="5275087">pending</span><span class="op" id="5275094">[</span><span class="ident" id="5275095">c</span><span class="op" id="5275096">.</span><span class="ident" id="5275097">resp</span><span class="op" id="5275101">.</span><span class="ident" id="5275102">Id</span><span class="op" id="5275104">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5275107">delete</span><span class="op" id="5275113">(</span><span class="ident" id="5275114">c</span><span class="op" id="5275115">.</span><span class="ident" id="5275116">pending</span><span class="op" id="5275123">,</span>&nbsp;<span class="ident" id="5275125">c</span><span class="op" id="5275126">.</span><span class="ident" id="5275127">resp</span><span class="op" id="5275131">.</span><span class="ident" id="5275132">Id</span><span class="op" id="5275134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275137">c</span><span class="op" id="5275138">.</span><span class="ident" id="5275139">mutex</span><span class="op" id="5275144">.</span><span class="ident" id="5275145">Unlock</span><span class="op" id="5275151">(</span><span class="op" id="5275152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275156">r</span><span class="op" id="5275157">.</span><span class="ident" id="5275158">Error</span>&nbsp;<span class="op" id="5275164">=</span>&nbsp;<span class="string" id="5275166">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275170">r</span><span class="op" id="5275171">.</span><span class="ident" id="5275172">Seq</span>&nbsp;<span class="op" id="5275176">=</span>&nbsp;<span class="ident" id="5275178">c</span><span class="op" id="5275179">.</span><span class="ident" id="5275180">resp</span><span class="op" id="5275184">.</span><span class="ident" id="5275185">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275189">if</span>&nbsp;<span class="ident" id="5275192">c</span><span class="op" id="5275193">.</span><span class="ident" id="5275194">resp</span><span class="op" id="5275198">.</span><span class="ident" id="5275199">Error</span>&nbsp;<span class="op" id="5275205">!=</span>&nbsp;<span class="ident" id="5275208">nil</span>&nbsp;<span class="op" id="5275212">||</span>&nbsp;<span class="ident" id="5275215">c</span><span class="op" id="5275216">.</span><span class="ident" id="5275217">resp</span><span class="op" id="5275221">.</span><span class="ident" id="5275222">Result</span>&nbsp;<span class="op" id="5275229">==</span>&nbsp;<span class="ident" id="5275232">nil</span>&nbsp;<span class="op" id="5275236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275240">x</span><span class="op" id="5275241">,</span>&nbsp;<span class="ident" id="5275243">ok</span>&nbsp;<span class="op" id="5275246">:=</span>&nbsp;<span class="ident" id="5275249">c</span><span class="op" id="5275250">.</span><span class="ident" id="5275251">resp</span><span class="op" id="5275255">.</span><span class="ident" id="5275256">Error</span><span class="op" id="5275261">.</span><span class="op" id="5275262">(</span><span class="builtintype" id="5275263">string</span><span class="op" id="5275269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275273">if</span>&nbsp;<span class="op" id="5275276">!</span><span class="ident" id="5275277">ok</span>&nbsp;<span class="op" id="5275280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275285">return</span>&nbsp;<span class="ident" id="5275292">fmt</span><span class="op" id="5275295">.</span><span class="ident" id="5275296">Errorf</span><span class="op" id="5275302">(</span><span class="string" id="5275303">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="5275321">,</span>&nbsp;<span class="ident" id="5275323">c</span><span class="op" id="5275324">.</span><span class="ident" id="5275325">resp</span><span class="op" id="5275329">.</span><span class="ident" id="5275330">Error</span><span class="op" id="5275335">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5275339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275343">if</span>&nbsp;<span class="ident" id="5275346">x</span>&nbsp;<span class="op" id="5275348">==</span>&nbsp;<span class="string" id="5275351">&#34;&#34;</span>&nbsp;<span class="op" id="5275354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275359">x</span>&nbsp;<span class="op" id="5275361">=</span>&nbsp;<span class="string" id="5275363">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5275385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275389">r</span><span class="op" id="5275390">.</span><span class="ident" id="5275391">Error</span>&nbsp;<span class="op" id="5275397">=</span>&nbsp;<span class="ident" id="5275399">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5275402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275405">return</span>&nbsp;<span class="ident" id="5275412">nil</span><br>
<span class="lineno"></span><span class="op" id="5275416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5275419">func</span>&nbsp;<span class="op" id="5275424">(</span><span class="ident" id="5275425">c</span>&nbsp;<span class="op" id="5275427">*</span><span class="ident" id="5275428">clientCodec</span><span class="op" id="5275439">)</span>&nbsp;<span class="ident" id="5275441">ReadResponseBody</span><span class="op" id="5275457">(</span><span class="ident" id="5275458">x</span>&nbsp;<span class="keyword" id="5275460">interface</span><span class="op" id="5275469">{</span><span class="op" id="5275470">}</span><span class="op" id="5275471">)</span>&nbsp;<span class="builtintype" id="5275473">error</span>&nbsp;<span class="op" id="5275479">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275482">if</span>&nbsp;<span class="ident" id="5275485">x</span>&nbsp;<span class="op" id="5275487">==</span>&nbsp;<span class="ident" id="5275490">nil</span>&nbsp;<span class="op" id="5275494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275498">return</span>&nbsp;<span class="ident" id="5275505">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5275510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275513">return</span>&nbsp;<span class="ident" id="5275520">json</span><span class="op" id="5275524">.</span><span class="ident" id="5275525">Unmarshal</span><span class="op" id="5275534">(</span><span class="op" id="5275535">*</span><span class="ident" id="5275536">c</span><span class="op" id="5275537">.</span><span class="ident" id="5275538">resp</span><span class="op" id="5275542">.</span><span class="ident" id="5275543">Result</span><span class="op" id="5275549">,</span>&nbsp;<span class="ident" id="5275551">x</span><span class="op" id="5275552">)</span><br>
<span class="lineno"></span><span class="op" id="5275554">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5275557">func</span>&nbsp;<span class="op" id="5275562">(</span><span class="ident" id="5275563">c</span>&nbsp;<span class="op" id="5275565">*</span><span class="ident" id="5275566">clientCodec</span><span class="op" id="5275577">)</span>&nbsp;<span class="ident" id="5275579">Close</span><span class="op" id="5275584">(</span><span class="op" id="5275585">)</span>&nbsp;<span class="builtintype" id="5275587">error</span>&nbsp;<span class="op" id="5275593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275596">return</span>&nbsp;<span class="ident" id="5275603">c</span><span class="op" id="5275604">.</span><span class="ident" id="5275605">c</span><span class="op" id="5275606">.</span><span class="ident" id="5275607">Close</span><span class="op" id="5275612">(</span><span class="op" id="5275613">)</span><br>
<span class="lineno"></span><span class="op" id="5275615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5275618">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5275682">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5275737">func</span>&nbsp;<span class="ident" id="5275742">NewClient</span><span class="op" id="5275751">(</span><span class="ident" id="5275752">conn</span>&nbsp;<span class="ident" id="5275757">io</span><span class="op" id="5275759">.</span><span class="ident" id="5275760">ReadWriteCloser</span><span class="op" id="5275775">)</span>&nbsp;<span class="op" id="5275777">*</span><span class="ident" id="5275778">rpc</span><span class="op" id="5275781">.</span><span class="ident" id="5275782">Client</span>&nbsp;<span class="op" id="5275789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275792">return</span>&nbsp;<span class="ident" id="5275799">rpc</span><span class="op" id="5275802">.</span><span class="ident" id="5275803">NewClientWithCodec</span><span class="op" id="5275821">(</span><span class="ident" id="5275822">NewClientCodec</span><span class="op" id="5275836">(</span><span class="ident" id="5275837">conn</span><span class="op" id="5275841">)</span><span class="op" id="5275842">)</span><br>
<span class="lineno"></span><span class="op" id="5275844">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5275847">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5275919">func</span>&nbsp;<span class="ident" id="5275924">Dial</span><span class="op" id="5275928">(</span><span class="ident" id="5275929">network</span><span class="op" id="5275936">,</span>&nbsp;<span class="ident" id="5275938">address</span>&nbsp;<span class="builtintype" id="5275946">string</span><span class="op" id="5275952">)</span>&nbsp;<span class="op" id="5275954">(</span><span class="op" id="5275955">*</span><span class="ident" id="5275956">rpc</span><span class="op" id="5275959">.</span><span class="ident" id="5275960">Client</span><span class="op" id="5275966">,</span>&nbsp;<span class="builtintype" id="5275968">error</span><span class="op" id="5275973">)</span>&nbsp;<span class="op" id="5275975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275978">conn</span><span class="op" id="5275982">,</span>&nbsp;<span class="ident" id="5275984">err</span>&nbsp;<span class="op" id="5275988">:=</span>&nbsp;<span class="ident" id="5275991">net</span><span class="op" id="5275994">.</span><span class="ident" id="5275995">Dial</span><span class="op" id="5275999">(</span><span class="ident" id="5276000">network</span><span class="op" id="5276007">,</span>&nbsp;<span class="ident" id="5276009">address</span><span class="op" id="5276016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276019">if</span>&nbsp;<span class="ident" id="5276022">err</span>&nbsp;<span class="op" id="5276026">!=</span>&nbsp;<span class="ident" id="5276029">nil</span>&nbsp;<span class="op" id="5276033">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276037">return</span>&nbsp;<span class="ident" id="5276044">nil</span><span class="op" id="5276047">,</span>&nbsp;<span class="ident" id="5276049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276057">return</span>&nbsp;<span class="ident" id="5276064">NewClient</span><span class="op" id="5276073">(</span><span class="ident" id="5276074">conn</span><span class="op" id="5276078">)</span><span class="op" id="5276079">,</span>&nbsp;<span class="ident" id="5276081">err</span><br>
<span class="lineno"></span><span class="op" id="5276085">}</span>
</div>
</body>
</html>
