<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7392788">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7392843">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7392897">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7392948">package</span>&nbsp;<span class="ident" id="7392956">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7392963">import</span>&nbsp;<span class="op" id="7392970">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7392973">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7392982">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7392989">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7392995">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7393008">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7393019">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7393027">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7393037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7393040">type</span>&nbsp;<span class="ident" id="7393045">deflateTest</span>&nbsp;<span class="keyword" id="7393057">struct</span>&nbsp;<span class="op" id="7393064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393067">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393073">[</span><span class="op" id="7393074">]</span><span class="builtintype" id="7393075">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393081">level</span>&nbsp;<span class="builtintype" id="7393087">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393092">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7393098">[</span><span class="op" id="7393099">]</span><span class="builtintype" id="7393100">byte</span><br>
<span class="lineno"></span><span class="op" id="7393105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7393108">type</span>&nbsp;<span class="ident" id="7393113">deflateInflateTest</span>&nbsp;<span class="keyword" id="7393132">struct</span>&nbsp;<span class="op" id="7393139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393142">in</span>&nbsp;<span class="op" id="7393145">[</span><span class="op" id="7393146">]</span><span class="builtintype" id="7393147">byte</span><br>
<span class="lineno">25</span><span class="op" id="7393152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7393155">type</span>&nbsp;<span class="ident" id="7393160">reverseBitsTest</span>&nbsp;<span class="keyword" id="7393176">struct</span>&nbsp;<span class="op" id="7393183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393186">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7393195">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393203">bitCount</span>&nbsp;<span class="builtintype" id="7393212">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7393219">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7393228">uint16</span><br>
<span class="lineno"></span><span class="op" id="7393235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7393238">var</span>&nbsp;<span class="ident" id="7393242">deflateTests</span>&nbsp;<span class="op" id="7393255">=</span>&nbsp;<span class="op" id="7393257">[</span><span class="op" id="7393258">]</span><span class="op" id="7393259">*</span><span class="ident" id="7393260">deflateTest</span><span class="op" id="7393271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393274">{</span><span class="op" id="7393275">[</span><span class="op" id="7393276">]</span><span class="builtintype" id="7393277">byte</span><span class="op" id="7393281">{</span><span class="op" id="7393282">}</span><span class="op" id="7393283">,</span>&nbsp;<span class="num" id="7393285">0</span><span class="op" id="7393286">,</span>&nbsp;<span class="op" id="7393288">[</span><span class="op" id="7393289">]</span><span class="builtintype" id="7393290">byte</span><span class="op" id="7393294">{</span><span class="num" id="7393295">1</span><span class="op" id="7393296">,</span>&nbsp;<span class="num" id="7393298">0</span><span class="op" id="7393299">,</span>&nbsp;<span class="num" id="7393301">0</span><span class="op" id="7393302">,</span>&nbsp;<span class="num" id="7393304">255</span><span class="op" id="7393307">,</span>&nbsp;<span class="num" id="7393309">255</span><span class="op" id="7393312">}</span><span class="op" id="7393313">}</span><span class="op" id="7393314">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393317">{</span><span class="op" id="7393318">[</span><span class="op" id="7393319">]</span><span class="builtintype" id="7393320">byte</span><span class="op" id="7393324">{</span><span class="num" id="7393325">0x11</span><span class="op" id="7393329">}</span><span class="op" id="7393330">,</span>&nbsp;<span class="op" id="7393332">-</span><span class="num" id="7393333">1</span><span class="op" id="7393334">,</span>&nbsp;<span class="op" id="7393336">[</span><span class="op" id="7393337">]</span><span class="builtintype" id="7393338">byte</span><span class="op" id="7393342">{</span><span class="num" id="7393343">18</span><span class="op" id="7393345">,</span>&nbsp;<span class="num" id="7393347">4</span><span class="op" id="7393348">,</span>&nbsp;<span class="num" id="7393350">4</span><span class="op" id="7393351">,</span>&nbsp;<span class="num" id="7393353">0</span><span class="op" id="7393354">,</span>&nbsp;<span class="num" id="7393356">0</span><span class="op" id="7393357">,</span>&nbsp;<span class="num" id="7393359">255</span><span class="op" id="7393362">,</span>&nbsp;<span class="num" id="7393364">255</span><span class="op" id="7393367">}</span><span class="op" id="7393368">}</span><span class="op" id="7393369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393372">{</span><span class="op" id="7393373">[</span><span class="op" id="7393374">]</span><span class="builtintype" id="7393375">byte</span><span class="op" id="7393379">{</span><span class="num" id="7393380">0x11</span><span class="op" id="7393384">}</span><span class="op" id="7393385">,</span>&nbsp;<span class="ident" id="7393387">DefaultCompression</span><span class="op" id="7393405">,</span>&nbsp;<span class="op" id="7393407">[</span><span class="op" id="7393408">]</span><span class="builtintype" id="7393409">byte</span><span class="op" id="7393413">{</span><span class="num" id="7393414">18</span><span class="op" id="7393416">,</span>&nbsp;<span class="num" id="7393418">4</span><span class="op" id="7393419">,</span>&nbsp;<span class="num" id="7393421">4</span><span class="op" id="7393422">,</span>&nbsp;<span class="num" id="7393424">0</span><span class="op" id="7393425">,</span>&nbsp;<span class="num" id="7393427">0</span><span class="op" id="7393428">,</span>&nbsp;<span class="num" id="7393430">255</span><span class="op" id="7393433">,</span>&nbsp;<span class="num" id="7393435">255</span><span class="op" id="7393438">}</span><span class="op" id="7393439">}</span><span class="op" id="7393440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393443">{</span><span class="op" id="7393444">[</span><span class="op" id="7393445">]</span><span class="builtintype" id="7393446">byte</span><span class="op" id="7393450">{</span><span class="num" id="7393451">0x11</span><span class="op" id="7393455">}</span><span class="op" id="7393456">,</span>&nbsp;<span class="num" id="7393458">4</span><span class="op" id="7393459">,</span>&nbsp;<span class="op" id="7393461">[</span><span class="op" id="7393462">]</span><span class="builtintype" id="7393463">byte</span><span class="op" id="7393467">{</span><span class="num" id="7393468">18</span><span class="op" id="7393470">,</span>&nbsp;<span class="num" id="7393472">4</span><span class="op" id="7393473">,</span>&nbsp;<span class="num" id="7393475">4</span><span class="op" id="7393476">,</span>&nbsp;<span class="num" id="7393478">0</span><span class="op" id="7393479">,</span>&nbsp;<span class="num" id="7393481">0</span><span class="op" id="7393482">,</span>&nbsp;<span class="num" id="7393484">255</span><span class="op" id="7393487">,</span>&nbsp;<span class="num" id="7393489">255</span><span class="op" id="7393492">}</span><span class="op" id="7393493">}</span><span class="op" id="7393494">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393498">{</span><span class="op" id="7393499">[</span><span class="op" id="7393500">]</span><span class="builtintype" id="7393501">byte</span><span class="op" id="7393505">{</span><span class="num" id="7393506">0x11</span><span class="op" id="7393510">}</span><span class="op" id="7393511">,</span>&nbsp;<span class="num" id="7393513">0</span><span class="op" id="7393514">,</span>&nbsp;<span class="op" id="7393516">[</span><span class="op" id="7393517">]</span><span class="builtintype" id="7393518">byte</span><span class="op" id="7393522">{</span><span class="num" id="7393523">0</span><span class="op" id="7393524">,</span>&nbsp;<span class="num" id="7393526">1</span><span class="op" id="7393527">,</span>&nbsp;<span class="num" id="7393529">0</span><span class="op" id="7393530">,</span>&nbsp;<span class="num" id="7393532">254</span><span class="op" id="7393535">,</span>&nbsp;<span class="num" id="7393537">255</span><span class="op" id="7393540">,</span>&nbsp;<span class="num" id="7393542">17</span><span class="op" id="7393544">,</span>&nbsp;<span class="num" id="7393546">1</span><span class="op" id="7393547">,</span>&nbsp;<span class="num" id="7393549">0</span><span class="op" id="7393550">,</span>&nbsp;<span class="num" id="7393552">0</span><span class="op" id="7393553">,</span>&nbsp;<span class="num" id="7393555">255</span><span class="op" id="7393558">,</span>&nbsp;<span class="num" id="7393560">255</span><span class="op" id="7393563">}</span><span class="op" id="7393564">}</span><span class="op" id="7393565">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393568">{</span><span class="op" id="7393569">[</span><span class="op" id="7393570">]</span><span class="builtintype" id="7393571">byte</span><span class="op" id="7393575">{</span><span class="num" id="7393576">0x11</span><span class="op" id="7393580">,</span>&nbsp;<span class="num" id="7393582">0x12</span><span class="op" id="7393586">}</span><span class="op" id="7393587">,</span>&nbsp;<span class="num" id="7393589">0</span><span class="op" id="7393590">,</span>&nbsp;<span class="op" id="7393592">[</span><span class="op" id="7393593">]</span><span class="builtintype" id="7393594">byte</span><span class="op" id="7393598">{</span><span class="num" id="7393599">0</span><span class="op" id="7393600">,</span>&nbsp;<span class="num" id="7393602">2</span><span class="op" id="7393603">,</span>&nbsp;<span class="num" id="7393605">0</span><span class="op" id="7393606">,</span>&nbsp;<span class="num" id="7393608">253</span><span class="op" id="7393611">,</span>&nbsp;<span class="num" id="7393613">255</span><span class="op" id="7393616">,</span>&nbsp;<span class="num" id="7393618">17</span><span class="op" id="7393620">,</span>&nbsp;<span class="num" id="7393622">18</span><span class="op" id="7393624">,</span>&nbsp;<span class="num" id="7393626">1</span><span class="op" id="7393627">,</span>&nbsp;<span class="num" id="7393629">0</span><span class="op" id="7393630">,</span>&nbsp;<span class="num" id="7393632">0</span><span class="op" id="7393633">,</span>&nbsp;<span class="num" id="7393635">255</span><span class="op" id="7393638">,</span>&nbsp;<span class="num" id="7393640">255</span><span class="op" id="7393643">}</span><span class="op" id="7393644">}</span><span class="op" id="7393645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393648">{</span><span class="op" id="7393649">[</span><span class="op" id="7393650">]</span><span class="builtintype" id="7393651">byte</span><span class="op" id="7393655">{</span><span class="num" id="7393656">0x11</span><span class="op" id="7393660">,</span>&nbsp;<span class="num" id="7393662">0x11</span><span class="op" id="7393666">,</span>&nbsp;<span class="num" id="7393668">0x11</span><span class="op" id="7393672">,</span>&nbsp;<span class="num" id="7393674">0x11</span><span class="op" id="7393678">,</span>&nbsp;<span class="num" id="7393680">0x11</span><span class="op" id="7393684">,</span>&nbsp;<span class="num" id="7393686">0x11</span><span class="op" id="7393690">,</span>&nbsp;<span class="num" id="7393692">0x11</span><span class="op" id="7393696">,</span>&nbsp;<span class="num" id="7393698">0x11</span><span class="op" id="7393702">}</span><span class="op" id="7393703">,</span>&nbsp;<span class="num" id="7393705">0</span><span class="op" id="7393706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393710">[</span><span class="op" id="7393711">]</span><span class="builtintype" id="7393712">byte</span><span class="op" id="7393716">{</span><span class="num" id="7393717">0</span><span class="op" id="7393718">,</span>&nbsp;<span class="num" id="7393720">8</span><span class="op" id="7393721">,</span>&nbsp;<span class="num" id="7393723">0</span><span class="op" id="7393724">,</span>&nbsp;<span class="num" id="7393726">247</span><span class="op" id="7393729">,</span>&nbsp;<span class="num" id="7393731">255</span><span class="op" id="7393734">,</span>&nbsp;<span class="num" id="7393736">17</span><span class="op" id="7393738">,</span>&nbsp;<span class="num" id="7393740">17</span><span class="op" id="7393742">,</span>&nbsp;<span class="num" id="7393744">17</span><span class="op" id="7393746">,</span>&nbsp;<span class="num" id="7393748">17</span><span class="op" id="7393750">,</span>&nbsp;<span class="num" id="7393752">17</span><span class="op" id="7393754">,</span>&nbsp;<span class="num" id="7393756">17</span><span class="op" id="7393758">,</span>&nbsp;<span class="num" id="7393760">17</span><span class="op" id="7393762">,</span>&nbsp;<span class="num" id="7393764">17</span><span class="op" id="7393766">,</span>&nbsp;<span class="num" id="7393768">1</span><span class="op" id="7393769">,</span>&nbsp;<span class="num" id="7393771">0</span><span class="op" id="7393772">,</span>&nbsp;<span class="num" id="7393774">0</span><span class="op" id="7393775">,</span>&nbsp;<span class="num" id="7393777">255</span><span class="op" id="7393780">,</span>&nbsp;<span class="num" id="7393782">255</span><span class="op" id="7393785">}</span><span class="op" id="7393786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393789">}</span><span class="op" id="7393790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393793">{</span><span class="op" id="7393794">[</span><span class="op" id="7393795">]</span><span class="builtintype" id="7393796">byte</span><span class="op" id="7393800">{</span><span class="op" id="7393801">}</span><span class="op" id="7393802">,</span>&nbsp;<span class="num" id="7393804">1</span><span class="op" id="7393805">,</span>&nbsp;<span class="op" id="7393807">[</span><span class="op" id="7393808">]</span><span class="builtintype" id="7393809">byte</span><span class="op" id="7393813">{</span><span class="num" id="7393814">1</span><span class="op" id="7393815">,</span>&nbsp;<span class="num" id="7393817">0</span><span class="op" id="7393818">,</span>&nbsp;<span class="num" id="7393820">0</span><span class="op" id="7393821">,</span>&nbsp;<span class="num" id="7393823">255</span><span class="op" id="7393826">,</span>&nbsp;<span class="num" id="7393828">255</span><span class="op" id="7393831">}</span><span class="op" id="7393832">}</span><span class="op" id="7393833">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393836">{</span><span class="op" id="7393837">[</span><span class="op" id="7393838">]</span><span class="builtintype" id="7393839">byte</span><span class="op" id="7393843">{</span><span class="num" id="7393844">0x11</span><span class="op" id="7393848">}</span><span class="op" id="7393849">,</span>&nbsp;<span class="num" id="7393851">1</span><span class="op" id="7393852">,</span>&nbsp;<span class="op" id="7393854">[</span><span class="op" id="7393855">]</span><span class="builtintype" id="7393856">byte</span><span class="op" id="7393860">{</span><span class="num" id="7393861">18</span><span class="op" id="7393863">,</span>&nbsp;<span class="num" id="7393865">4</span><span class="op" id="7393866">,</span>&nbsp;<span class="num" id="7393868">4</span><span class="op" id="7393869">,</span>&nbsp;<span class="num" id="7393871">0</span><span class="op" id="7393872">,</span>&nbsp;<span class="num" id="7393874">0</span><span class="op" id="7393875">,</span>&nbsp;<span class="num" id="7393877">255</span><span class="op" id="7393880">,</span>&nbsp;<span class="num" id="7393882">255</span><span class="op" id="7393885">}</span><span class="op" id="7393886">}</span><span class="op" id="7393887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393890">{</span><span class="op" id="7393891">[</span><span class="op" id="7393892">]</span><span class="builtintype" id="7393893">byte</span><span class="op" id="7393897">{</span><span class="num" id="7393898">0x11</span><span class="op" id="7393902">,</span>&nbsp;<span class="num" id="7393904">0x12</span><span class="op" id="7393908">}</span><span class="op" id="7393909">,</span>&nbsp;<span class="num" id="7393911">1</span><span class="op" id="7393912">,</span>&nbsp;<span class="op" id="7393914">[</span><span class="op" id="7393915">]</span><span class="builtintype" id="7393916">byte</span><span class="op" id="7393920">{</span><span class="num" id="7393921">18</span><span class="op" id="7393923">,</span>&nbsp;<span class="num" id="7393925">20</span><span class="op" id="7393927">,</span>&nbsp;<span class="num" id="7393929">2</span><span class="op" id="7393930">,</span>&nbsp;<span class="num" id="7393932">4</span><span class="op" id="7393933">,</span>&nbsp;<span class="num" id="7393935">0</span><span class="op" id="7393936">,</span>&nbsp;<span class="num" id="7393938">0</span><span class="op" id="7393939">,</span>&nbsp;<span class="num" id="7393941">255</span><span class="op" id="7393944">,</span>&nbsp;<span class="num" id="7393946">255</span><span class="op" id="7393949">}</span><span class="op" id="7393950">}</span><span class="op" id="7393951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7393954">{</span><span class="op" id="7393955">[</span><span class="op" id="7393956">]</span><span class="builtintype" id="7393957">byte</span><span class="op" id="7393961">{</span><span class="num" id="7393962">0x11</span><span class="op" id="7393966">,</span>&nbsp;<span class="num" id="7393968">0x11</span><span class="op" id="7393972">,</span>&nbsp;<span class="num" id="7393974">0x11</span><span class="op" id="7393978">,</span>&nbsp;<span class="num" id="7393980">0x11</span><span class="op" id="7393984">,</span>&nbsp;<span class="num" id="7393986">0x11</span><span class="op" id="7393990">,</span>&nbsp;<span class="num" id="7393992">0x11</span><span class="op" id="7393996">,</span>&nbsp;<span class="num" id="7393998">0x11</span><span class="op" id="7394002">,</span>&nbsp;<span class="num" id="7394004">0x11</span><span class="op" id="7394008">}</span><span class="op" id="7394009">,</span>&nbsp;<span class="num" id="7394011">1</span><span class="op" id="7394012">,</span>&nbsp;<span class="op" id="7394014">[</span><span class="op" id="7394015">]</span><span class="builtintype" id="7394016">byte</span><span class="op" id="7394020">{</span><span class="num" id="7394021">18</span><span class="op" id="7394023">,</span>&nbsp;<span class="num" id="7394025">132</span><span class="op" id="7394028">,</span>&nbsp;<span class="num" id="7394030">2</span><span class="op" id="7394031">,</span>&nbsp;<span class="num" id="7394033">64</span><span class="op" id="7394035">,</span>&nbsp;<span class="num" id="7394037">0</span><span class="op" id="7394038">,</span>&nbsp;<span class="num" id="7394040">0</span><span class="op" id="7394041">,</span>&nbsp;<span class="num" id="7394043">0</span><span class="op" id="7394044">,</span>&nbsp;<span class="num" id="7394046">255</span><span class="op" id="7394049">,</span>&nbsp;<span class="num" id="7394051">255</span><span class="op" id="7394054">}</span><span class="op" id="7394055">}</span><span class="op" id="7394056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394059">{</span><span class="op" id="7394060">[</span><span class="op" id="7394061">]</span><span class="builtintype" id="7394062">byte</span><span class="op" id="7394066">{</span><span class="op" id="7394067">}</span><span class="op" id="7394068">,</span>&nbsp;<span class="num" id="7394070">9</span><span class="op" id="7394071">,</span>&nbsp;<span class="op" id="7394073">[</span><span class="op" id="7394074">]</span><span class="builtintype" id="7394075">byte</span><span class="op" id="7394079">{</span><span class="num" id="7394080">1</span><span class="op" id="7394081">,</span>&nbsp;<span class="num" id="7394083">0</span><span class="op" id="7394084">,</span>&nbsp;<span class="num" id="7394086">0</span><span class="op" id="7394087">,</span>&nbsp;<span class="num" id="7394089">255</span><span class="op" id="7394092">,</span>&nbsp;<span class="num" id="7394094">255</span><span class="op" id="7394097">}</span><span class="op" id="7394098">}</span><span class="op" id="7394099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394102">{</span><span class="op" id="7394103">[</span><span class="op" id="7394104">]</span><span class="builtintype" id="7394105">byte</span><span class="op" id="7394109">{</span><span class="num" id="7394110">0x11</span><span class="op" id="7394114">}</span><span class="op" id="7394115">,</span>&nbsp;<span class="num" id="7394117">9</span><span class="op" id="7394118">,</span>&nbsp;<span class="op" id="7394120">[</span><span class="op" id="7394121">]</span><span class="builtintype" id="7394122">byte</span><span class="op" id="7394126">{</span><span class="num" id="7394127">18</span><span class="op" id="7394129">,</span>&nbsp;<span class="num" id="7394131">4</span><span class="op" id="7394132">,</span>&nbsp;<span class="num" id="7394134">4</span><span class="op" id="7394135">,</span>&nbsp;<span class="num" id="7394137">0</span><span class="op" id="7394138">,</span>&nbsp;<span class="num" id="7394140">0</span><span class="op" id="7394141">,</span>&nbsp;<span class="num" id="7394143">255</span><span class="op" id="7394146">,</span>&nbsp;<span class="num" id="7394148">255</span><span class="op" id="7394151">}</span><span class="op" id="7394152">}</span><span class="op" id="7394153">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394156">{</span><span class="op" id="7394157">[</span><span class="op" id="7394158">]</span><span class="builtintype" id="7394159">byte</span><span class="op" id="7394163">{</span><span class="num" id="7394164">0x11</span><span class="op" id="7394168">,</span>&nbsp;<span class="num" id="7394170">0x12</span><span class="op" id="7394174">}</span><span class="op" id="7394175">,</span>&nbsp;<span class="num" id="7394177">9</span><span class="op" id="7394178">,</span>&nbsp;<span class="op" id="7394180">[</span><span class="op" id="7394181">]</span><span class="builtintype" id="7394182">byte</span><span class="op" id="7394186">{</span><span class="num" id="7394187">18</span><span class="op" id="7394189">,</span>&nbsp;<span class="num" id="7394191">20</span><span class="op" id="7394193">,</span>&nbsp;<span class="num" id="7394195">2</span><span class="op" id="7394196">,</span>&nbsp;<span class="num" id="7394198">4</span><span class="op" id="7394199">,</span>&nbsp;<span class="num" id="7394201">0</span><span class="op" id="7394202">,</span>&nbsp;<span class="num" id="7394204">0</span><span class="op" id="7394205">,</span>&nbsp;<span class="num" id="7394207">255</span><span class="op" id="7394210">,</span>&nbsp;<span class="num" id="7394212">255</span><span class="op" id="7394215">}</span><span class="op" id="7394216">}</span><span class="op" id="7394217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394220">{</span><span class="op" id="7394221">[</span><span class="op" id="7394222">]</span><span class="builtintype" id="7394223">byte</span><span class="op" id="7394227">{</span><span class="num" id="7394228">0x11</span><span class="op" id="7394232">,</span>&nbsp;<span class="num" id="7394234">0x11</span><span class="op" id="7394238">,</span>&nbsp;<span class="num" id="7394240">0x11</span><span class="op" id="7394244">,</span>&nbsp;<span class="num" id="7394246">0x11</span><span class="op" id="7394250">,</span>&nbsp;<span class="num" id="7394252">0x11</span><span class="op" id="7394256">,</span>&nbsp;<span class="num" id="7394258">0x11</span><span class="op" id="7394262">,</span>&nbsp;<span class="num" id="7394264">0x11</span><span class="op" id="7394268">,</span>&nbsp;<span class="num" id="7394270">0x11</span><span class="op" id="7394274">}</span><span class="op" id="7394275">,</span>&nbsp;<span class="num" id="7394277">9</span><span class="op" id="7394278">,</span>&nbsp;<span class="op" id="7394280">[</span><span class="op" id="7394281">]</span><span class="builtintype" id="7394282">byte</span><span class="op" id="7394286">{</span><span class="num" id="7394287">18</span><span class="op" id="7394289">,</span>&nbsp;<span class="num" id="7394291">132</span><span class="op" id="7394294">,</span>&nbsp;<span class="num" id="7394296">2</span><span class="op" id="7394297">,</span>&nbsp;<span class="num" id="7394299">64</span><span class="op" id="7394301">,</span>&nbsp;<span class="num" id="7394303">0</span><span class="op" id="7394304">,</span>&nbsp;<span class="num" id="7394306">0</span><span class="op" id="7394307">,</span>&nbsp;<span class="num" id="7394309">0</span><span class="op" id="7394310">,</span>&nbsp;<span class="num" id="7394312">255</span><span class="op" id="7394315">,</span>&nbsp;<span class="num" id="7394317">255</span><span class="op" id="7394320">}</span><span class="op" id="7394321">}</span><span class="op" id="7394322">,</span><br>
<span class="lineno"></span><span class="op" id="7394324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7394327">var</span>&nbsp;<span class="ident" id="7394331">deflateInflateTests</span>&nbsp;<span class="op" id="7394351">=</span>&nbsp;<span class="op" id="7394353">[</span><span class="op" id="7394354">]</span><span class="op" id="7394355">*</span><span class="ident" id="7394356">deflateInflateTest</span><span class="op" id="7394374">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394377">{</span><span class="op" id="7394378">[</span><span class="op" id="7394379">]</span><span class="builtintype" id="7394380">byte</span><span class="op" id="7394384">{</span><span class="op" id="7394385">}</span><span class="op" id="7394386">}</span><span class="op" id="7394387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394390">{</span><span class="op" id="7394391">[</span><span class="op" id="7394392">]</span><span class="builtintype" id="7394393">byte</span><span class="op" id="7394397">{</span><span class="num" id="7394398">0x11</span><span class="op" id="7394402">}</span><span class="op" id="7394403">}</span><span class="op" id="7394404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394407">{</span><span class="op" id="7394408">[</span><span class="op" id="7394409">]</span><span class="builtintype" id="7394410">byte</span><span class="op" id="7394414">{</span><span class="num" id="7394415">0x11</span><span class="op" id="7394419">,</span>&nbsp;<span class="num" id="7394421">0x12</span><span class="op" id="7394425">}</span><span class="op" id="7394426">}</span><span class="op" id="7394427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394430">{</span><span class="op" id="7394431">[</span><span class="op" id="7394432">]</span><span class="builtintype" id="7394433">byte</span><span class="op" id="7394437">{</span><span class="num" id="7394438">0x11</span><span class="op" id="7394442">,</span>&nbsp;<span class="num" id="7394444">0x11</span><span class="op" id="7394448">,</span>&nbsp;<span class="num" id="7394450">0x11</span><span class="op" id="7394454">,</span>&nbsp;<span class="num" id="7394456">0x11</span><span class="op" id="7394460">,</span>&nbsp;<span class="num" id="7394462">0x11</span><span class="op" id="7394466">,</span>&nbsp;<span class="num" id="7394468">0x11</span><span class="op" id="7394472">,</span>&nbsp;<span class="num" id="7394474">0x11</span><span class="op" id="7394478">,</span>&nbsp;<span class="num" id="7394480">0x11</span><span class="op" id="7394484">}</span><span class="op" id="7394485">}</span><span class="op" id="7394486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394489">{</span><span class="op" id="7394490">[</span><span class="op" id="7394491">]</span><span class="builtintype" id="7394492">byte</span><span class="op" id="7394496">{</span><span class="num" id="7394497">0x11</span><span class="op" id="7394501">,</span>&nbsp;<span class="num" id="7394503">0x10</span><span class="op" id="7394507">,</span>&nbsp;<span class="num" id="7394509">0x13</span><span class="op" id="7394513">,</span>&nbsp;<span class="num" id="7394515">0x41</span><span class="op" id="7394519">,</span>&nbsp;<span class="num" id="7394521">0x21</span><span class="op" id="7394525">,</span>&nbsp;<span class="num" id="7394527">0x21</span><span class="op" id="7394531">,</span>&nbsp;<span class="num" id="7394533">0x41</span><span class="op" id="7394537">,</span>&nbsp;<span class="num" id="7394539">0x13</span><span class="op" id="7394543">,</span>&nbsp;<span class="num" id="7394545">0x87</span><span class="op" id="7394549">,</span>&nbsp;<span class="num" id="7394551">0x78</span><span class="op" id="7394555">,</span>&nbsp;<span class="num" id="7394557">0x13</span><span class="op" id="7394561">}</span><span class="op" id="7394562">}</span><span class="op" id="7394563">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394566">{</span><span class="ident" id="7394567">largeDataChunk</span><span class="op" id="7394581">(</span><span class="op" id="7394582">)</span><span class="op" id="7394583">}</span><span class="op" id="7394584">,</span><br>
<span class="lineno"></span><span class="op" id="7394586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7394589">var</span>&nbsp;<span class="ident" id="7394593">reverseBitsTests</span>&nbsp;<span class="op" id="7394610">=</span>&nbsp;<span class="op" id="7394612">[</span><span class="op" id="7394613">]</span><span class="op" id="7394614">*</span><span class="ident" id="7394615">reverseBitsTest</span><span class="op" id="7394630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394633">{</span><span class="num" id="7394634">1</span><span class="op" id="7394635">,</span>&nbsp;<span class="num" id="7394637">1</span><span class="op" id="7394638">,</span>&nbsp;<span class="num" id="7394640">1</span><span class="op" id="7394641">}</span><span class="op" id="7394642">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394645">{</span><span class="num" id="7394646">1</span><span class="op" id="7394647">,</span>&nbsp;<span class="num" id="7394649">2</span><span class="op" id="7394650">,</span>&nbsp;<span class="num" id="7394652">2</span><span class="op" id="7394653">}</span><span class="op" id="7394654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394657">{</span><span class="num" id="7394658">1</span><span class="op" id="7394659">,</span>&nbsp;<span class="num" id="7394661">3</span><span class="op" id="7394662">,</span>&nbsp;<span class="num" id="7394664">4</span><span class="op" id="7394665">}</span><span class="op" id="7394666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394669">{</span><span class="num" id="7394670">1</span><span class="op" id="7394671">,</span>&nbsp;<span class="num" id="7394673">4</span><span class="op" id="7394674">,</span>&nbsp;<span class="num" id="7394676">8</span><span class="op" id="7394677">}</span><span class="op" id="7394678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394681">{</span><span class="num" id="7394682">1</span><span class="op" id="7394683">,</span>&nbsp;<span class="num" id="7394685">5</span><span class="op" id="7394686">,</span>&nbsp;<span class="num" id="7394688">16</span><span class="op" id="7394690">}</span><span class="op" id="7394691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394694">{</span><span class="num" id="7394695">17</span><span class="op" id="7394697">,</span>&nbsp;<span class="num" id="7394699">5</span><span class="op" id="7394700">,</span>&nbsp;<span class="num" id="7394702">17</span><span class="op" id="7394704">}</span><span class="op" id="7394705">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394708">{</span><span class="num" id="7394709">257</span><span class="op" id="7394712">,</span>&nbsp;<span class="num" id="7394714">9</span><span class="op" id="7394715">,</span>&nbsp;<span class="num" id="7394717">257</span><span class="op" id="7394720">}</span><span class="op" id="7394721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394724">{</span><span class="num" id="7394725">29</span><span class="op" id="7394727">,</span>&nbsp;<span class="num" id="7394729">5</span><span class="op" id="7394730">,</span>&nbsp;<span class="num" id="7394732">23</span><span class="op" id="7394734">}</span><span class="op" id="7394735">,</span><br>
<span class="lineno"></span><span class="op" id="7394737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7394740">func</span>&nbsp;<span class="ident" id="7394745">largeDataChunk</span><span class="op" id="7394759">(</span><span class="op" id="7394760">)</span>&nbsp;<span class="op" id="7394762">[</span><span class="op" id="7394763">]</span><span class="builtintype" id="7394764">byte</span>&nbsp;<span class="op" id="7394769">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394772">result</span>&nbsp;<span class="op" id="7394779">:=</span>&nbsp;<span class="builtinfunc" id="7394782">make</span><span class="op" id="7394786">(</span><span class="op" id="7394787">[</span><span class="op" id="7394788">]</span><span class="builtintype" id="7394789">byte</span><span class="op" id="7394793">,</span>&nbsp;<span class="num" id="7394795">100000</span><span class="op" id="7394801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394804">for</span>&nbsp;<span class="ident" id="7394808">i</span>&nbsp;<span class="op" id="7394810">:=</span>&nbsp;<span class="keyword" id="7394813">range</span>&nbsp;<span class="ident" id="7394819">result</span>&nbsp;<span class="op" id="7394826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394830">result</span><span class="op" id="7394836">[</span><span class="ident" id="7394837">i</span><span class="op" id="7394838">]</span>&nbsp;<span class="op" id="7394840">=</span>&nbsp;<span class="builtintype" id="7394842">byte</span><span class="op" id="7394846">(</span><span class="ident" id="7394847">i</span>&nbsp;<span class="op" id="7394849">*</span>&nbsp;<span class="ident" id="7394851">i</span>&nbsp;<span class="op" id="7394853">&amp;</span>&nbsp;<span class="num" id="7394855">0xFF</span><span class="op" id="7394859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7394862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394865">return</span>&nbsp;<span class="ident" id="7394872">result</span><br>
<span class="lineno">80</span><span class="op" id="7394879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7394882">func</span>&nbsp;<span class="ident" id="7394887">TestDeflate</span><span class="op" id="7394898">(</span><span class="ident" id="7394899">t</span>&nbsp;<span class="op" id="7394901">*</span><span class="ident" id="7394902">testing</span><span class="op" id="7394909">.</span><span class="ident" id="7394910">T</span><span class="op" id="7394911">)</span>&nbsp;<span class="op" id="7394913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394916">for</span>&nbsp;<span class="ident" id="7394920">_</span><span class="op" id="7394921">,</span>&nbsp;<span class="ident" id="7394923">h</span>&nbsp;<span class="op" id="7394925">:=</span>&nbsp;<span class="keyword" id="7394928">range</span>&nbsp;<span class="ident" id="7394934">deflateTests</span>&nbsp;<span class="op" id="7394947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7394951">var</span>&nbsp;<span class="ident" id="7394955">buf</span>&nbsp;<span class="ident" id="7394959">bytes</span><span class="op" id="7394964">.</span><span class="ident" id="7394965">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7394974">w</span><span class="op" id="7394975">,</span>&nbsp;<span class="ident" id="7394977">err</span>&nbsp;<span class="op" id="7394981">:=</span>&nbsp;<span class="ident" id="7394984">NewWriter</span><span class="op" id="7394993">(</span><span class="op" id="7394994">&amp;</span><span class="ident" id="7394995">buf</span><span class="op" id="7394998">,</span>&nbsp;<span class="ident" id="7395000">h</span><span class="op" id="7395001">.</span><span class="ident" id="7395002">level</span><span class="op" id="7395007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395011">if</span>&nbsp;<span class="ident" id="7395014">err</span>&nbsp;<span class="op" id="7395018">!=</span>&nbsp;<span class="ident" id="7395021">nil</span>&nbsp;<span class="op" id="7395025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395030">t</span><span class="op" id="7395031">.</span><span class="ident" id="7395032">Errorf</span><span class="op" id="7395038">(</span><span class="string" id="7395039">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7395054">,</span>&nbsp;<span class="ident" id="7395056">err</span><span class="op" id="7395059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395064">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395075">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395079">w</span><span class="op" id="7395080">.</span><span class="ident" id="7395081">Write</span><span class="op" id="7395086">(</span><span class="ident" id="7395087">h</span><span class="op" id="7395088">.</span><span class="ident" id="7395089">in</span><span class="op" id="7395091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395095">w</span><span class="op" id="7395096">.</span><span class="ident" id="7395097">Close</span><span class="op" id="7395102">(</span><span class="op" id="7395103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395107">if</span>&nbsp;<span class="op" id="7395110">!</span><span class="ident" id="7395111">bytes</span><span class="op" id="7395116">.</span><span class="ident" id="7395117">Equal</span><span class="op" id="7395122">(</span><span class="ident" id="7395123">buf</span><span class="op" id="7395126">.</span><span class="ident" id="7395127">Bytes</span><span class="op" id="7395132">(</span><span class="op" id="7395133">)</span><span class="op" id="7395134">,</span>&nbsp;<span class="ident" id="7395136">h</span><span class="op" id="7395137">.</span><span class="ident" id="7395138">out</span><span class="op" id="7395141">)</span>&nbsp;<span class="op" id="7395143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395148">t</span><span class="op" id="7395149">.</span><span class="ident" id="7395150">Errorf</span><span class="op" id="7395156">(</span><span class="string" id="7395157">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="7395188">,</span>&nbsp;<span class="ident" id="7395190">h</span><span class="op" id="7395191">.</span><span class="ident" id="7395192">level</span><span class="op" id="7395197">,</span>&nbsp;<span class="ident" id="7395199">h</span><span class="op" id="7395200">.</span><span class="ident" id="7395201">in</span><span class="op" id="7395203">,</span>&nbsp;<span class="ident" id="7395205">buf</span><span class="op" id="7395208">.</span><span class="ident" id="7395209">Bytes</span><span class="op" id="7395214">(</span><span class="op" id="7395215">)</span><span class="op" id="7395216">,</span>&nbsp;<span class="ident" id="7395218">h</span><span class="op" id="7395219">.</span><span class="ident" id="7395220">out</span><span class="op" id="7395223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395227">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395230">}</span><br>
<span class="lineno"></span><span class="op" id="7395232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7395235">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="7395309">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="7395370">type</span>&nbsp;<span class="ident" id="7395375">sparseReader</span>&nbsp;<span class="keyword" id="7395388">struct</span>&nbsp;<span class="op" id="7395395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395398">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7395402">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395409">cur</span>&nbsp;<span class="ident" id="7395413">int64</span><br>
<span class="lineno"></span><span class="op" id="7395419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7395422">func</span>&nbsp;<span class="op" id="7395427">(</span><span class="ident" id="7395428">r</span>&nbsp;<span class="op" id="7395430">*</span><span class="ident" id="7395431">sparseReader</span><span class="op" id="7395443">)</span>&nbsp;<span class="ident" id="7395445">Read</span><span class="op" id="7395449">(</span><span class="ident" id="7395450">b</span>&nbsp;<span class="op" id="7395452">[</span><span class="op" id="7395453">]</span><span class="builtintype" id="7395454">byte</span><span class="op" id="7395458">)</span>&nbsp;<span class="op" id="7395460">(</span><span class="ident" id="7395461">n</span>&nbsp;<span class="builtintype" id="7395463">int</span><span class="op" id="7395466">,</span>&nbsp;<span class="ident" id="7395468">err</span>&nbsp;<span class="builtintype" id="7395472">error</span><span class="op" id="7395477">)</span>&nbsp;<span class="op" id="7395479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395482">if</span>&nbsp;<span class="ident" id="7395485">r</span><span class="op" id="7395486">.</span><span class="ident" id="7395487">cur</span>&nbsp;<span class="op" id="7395491">&gt;=</span>&nbsp;<span class="ident" id="7395494">r</span><span class="op" id="7395495">.</span><span class="ident" id="7395496">l</span>&nbsp;<span class="op" id="7395498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395502">return</span>&nbsp;<span class="num" id="7395509">0</span><span class="op" id="7395510">,</span>&nbsp;<span class="ident" id="7395512">io</span><span class="op" id="7395514">.</span><span class="ident" id="7395515">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395523">n</span>&nbsp;<span class="op" id="7395525">=</span>&nbsp;<span class="builtinfunc" id="7395527">len</span><span class="op" id="7395530">(</span><span class="ident" id="7395531">b</span><span class="op" id="7395532">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395535">cur</span>&nbsp;<span class="op" id="7395539">:=</span>&nbsp;<span class="ident" id="7395542">r</span><span class="op" id="7395543">.</span><span class="ident" id="7395544">cur</span>&nbsp;<span class="op" id="7395548">+</span>&nbsp;<span class="ident" id="7395550">int64</span><span class="op" id="7395555">(</span><span class="ident" id="7395556">n</span><span class="op" id="7395557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395560">if</span>&nbsp;<span class="ident" id="7395563">cur</span>&nbsp;<span class="op" id="7395567">&gt;</span>&nbsp;<span class="ident" id="7395569">r</span><span class="op" id="7395570">.</span><span class="ident" id="7395571">l</span>&nbsp;<span class="op" id="7395573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395577">n</span>&nbsp;<span class="op" id="7395579">-=</span>&nbsp;<span class="builtintype" id="7395582">int</span><span class="op" id="7395585">(</span><span class="ident" id="7395586">cur</span>&nbsp;<span class="op" id="7395590">-</span>&nbsp;<span class="ident" id="7395592">r</span><span class="op" id="7395593">.</span><span class="ident" id="7395594">l</span><span class="op" id="7395595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395599">cur</span>&nbsp;<span class="op" id="7395603">=</span>&nbsp;<span class="ident" id="7395605">r</span><span class="op" id="7395606">.</span><span class="ident" id="7395607">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395610">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395613">for</span>&nbsp;<span class="ident" id="7395617">i</span>&nbsp;<span class="op" id="7395619">:=</span>&nbsp;<span class="keyword" id="7395622">range</span>&nbsp;<span class="ident" id="7395628">b</span><span class="op" id="7395629">[</span><span class="num" id="7395630">0</span><span class="op" id="7395631">:</span><span class="ident" id="7395632">n</span><span class="op" id="7395633">]</span>&nbsp;<span class="op" id="7395635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395639">if</span>&nbsp;<span class="ident" id="7395642">r</span><span class="op" id="7395643">.</span><span class="ident" id="7395644">cur</span><span class="op" id="7395647">+</span><span class="ident" id="7395648">int64</span><span class="op" id="7395653">(</span><span class="ident" id="7395654">i</span><span class="op" id="7395655">)</span>&nbsp;<span class="op" id="7395657">&gt;=</span>&nbsp;<span class="ident" id="7395660">r</span><span class="op" id="7395661">.</span><span class="ident" id="7395662">l</span><span class="op" id="7395663">-</span><span class="num" id="7395664">1</span><span class="op" id="7395665">&lt;&lt;</span><span class="num" id="7395667">16</span>&nbsp;<span class="op" id="7395670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395675">b</span><span class="op" id="7395676">[</span><span class="ident" id="7395677">i</span><span class="op" id="7395678">]</span>&nbsp;<span class="op" id="7395680">=</span>&nbsp;<span class="num" id="7395682">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395686">}</span>&nbsp;<span class="keyword" id="7395688">else</span>&nbsp;<span class="op" id="7395693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395698">b</span><span class="op" id="7395699">[</span><span class="ident" id="7395700">i</span><span class="op" id="7395701">]</span>&nbsp;<span class="op" id="7395703">=</span>&nbsp;<span class="num" id="7395705">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395715">r</span><span class="op" id="7395716">.</span><span class="ident" id="7395717">cur</span>&nbsp;<span class="op" id="7395721">=</span>&nbsp;<span class="ident" id="7395723">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395728">return</span><br>
<span class="lineno"></span><span class="op" id="7395735">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7395738">func</span>&nbsp;<span class="ident" id="7395743">TestVeryLongSparseChunk</span><span class="op" id="7395766">(</span><span class="ident" id="7395767">t</span>&nbsp;<span class="op" id="7395769">*</span><span class="ident" id="7395770">testing</span><span class="op" id="7395777">.</span><span class="ident" id="7395778">T</span><span class="op" id="7395779">)</span>&nbsp;<span class="op" id="7395781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395784">if</span>&nbsp;<span class="ident" id="7395787">testing</span><span class="op" id="7395794">.</span><span class="ident" id="7395795">Short</span><span class="op" id="7395800">(</span><span class="op" id="7395801">)</span>&nbsp;<span class="op" id="7395803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395807">t</span><span class="op" id="7395808">.</span><span class="ident" id="7395809">Skip</span><span class="op" id="7395813">(</span><span class="string" id="7395814">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="7395855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395858">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395861">w</span><span class="op" id="7395862">,</span>&nbsp;<span class="ident" id="7395864">err</span>&nbsp;<span class="op" id="7395868">:=</span>&nbsp;<span class="ident" id="7395871">NewWriter</span><span class="op" id="7395880">(</span><span class="ident" id="7395881">ioutil</span><span class="op" id="7395887">.</span><span class="ident" id="7395888">Discard</span><span class="op" id="7395895">,</span>&nbsp;<span class="num" id="7395897">1</span><span class="op" id="7395898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395901">if</span>&nbsp;<span class="ident" id="7395904">err</span>&nbsp;<span class="op" id="7395908">!=</span>&nbsp;<span class="ident" id="7395911">nil</span>&nbsp;<span class="op" id="7395915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7395919">t</span><span class="op" id="7395920">.</span><span class="ident" id="7395921">Errorf</span><span class="op" id="7395927">(</span><span class="string" id="7395928">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7395943">,</span>&nbsp;<span class="ident" id="7395945">err</span><span class="op" id="7395948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395952">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7395960">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7395963">if</span>&nbsp;<span class="ident" id="7395966">_</span><span class="op" id="7395967">,</span>&nbsp;<span class="ident" id="7395969">err</span>&nbsp;<span class="op" id="7395973">=</span>&nbsp;<span class="ident" id="7395975">io</span><span class="op" id="7395977">.</span><span class="ident" id="7395978">Copy</span><span class="op" id="7395982">(</span><span class="ident" id="7395983">w</span><span class="op" id="7395984">,</span>&nbsp;<span class="op" id="7395986">&amp;</span><span class="ident" id="7395987">sparseReader</span><span class="op" id="7395999">{</span><span class="ident" id="7396000">l</span><span class="op" id="7396001">:</span>&nbsp;<span class="num" id="7396003">23E8</span><span class="op" id="7396007">}</span><span class="op" id="7396008">)</span><span class="op" id="7396009">;</span>&nbsp;<span class="ident" id="7396011">err</span>&nbsp;<span class="op" id="7396015">!=</span>&nbsp;<span class="ident" id="7396018">nil</span>&nbsp;<span class="op" id="7396022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396026">t</span><span class="op" id="7396027">.</span><span class="ident" id="7396028">Errorf</span><span class="op" id="7396034">(</span><span class="string" id="7396035">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7396056">,</span>&nbsp;<span class="ident" id="7396058">err</span><span class="op" id="7396061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396065">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396073">}</span><br>
<span class="lineno"></span><span class="op" id="7396075">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7396078">type</span>&nbsp;<span class="ident" id="7396083">syncBuffer</span>&nbsp;<span class="keyword" id="7396094">struct</span>&nbsp;<span class="op" id="7396101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396104">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396111">bytes</span><span class="op" id="7396116">.</span><span class="ident" id="7396117">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396125">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396132">sync</span><span class="op" id="7396136">.</span><span class="ident" id="7396137">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396146">closed</span>&nbsp;<span class="builtintype" id="7396153">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396159">ready</span>&nbsp;&nbsp;<span class="keyword" id="7396166">chan</span>&nbsp;<span class="builtintype" id="7396171">bool</span><br>
<span class="lineno"></span><span class="op" id="7396176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396179">func</span>&nbsp;<span class="ident" id="7396184">newSyncBuffer</span><span class="op" id="7396197">(</span><span class="op" id="7396198">)</span>&nbsp;<span class="op" id="7396200">*</span><span class="ident" id="7396201">syncBuffer</span>&nbsp;<span class="op" id="7396212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396215">return</span>&nbsp;<span class="op" id="7396222">&amp;</span><span class="ident" id="7396223">syncBuffer</span><span class="op" id="7396233">{</span><span class="ident" id="7396234">ready</span><span class="op" id="7396239">:</span>&nbsp;<span class="builtinfunc" id="7396241">make</span><span class="op" id="7396245">(</span><span class="keyword" id="7396246">chan</span>&nbsp;<span class="builtintype" id="7396251">bool</span><span class="op" id="7396255">,</span>&nbsp;<span class="num" id="7396257">1</span><span class="op" id="7396258">)</span><span class="op" id="7396259">}</span><br>
<span class="lineno">150</span><span class="op" id="7396261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396264">func</span>&nbsp;<span class="op" id="7396269">(</span><span class="ident" id="7396270">b</span>&nbsp;<span class="op" id="7396272">*</span><span class="ident" id="7396273">syncBuffer</span><span class="op" id="7396283">)</span>&nbsp;<span class="ident" id="7396285">Read</span><span class="op" id="7396289">(</span><span class="ident" id="7396290">p</span>&nbsp;<span class="op" id="7396292">[</span><span class="op" id="7396293">]</span><span class="builtintype" id="7396294">byte</span><span class="op" id="7396298">)</span>&nbsp;<span class="op" id="7396300">(</span><span class="ident" id="7396301">n</span>&nbsp;<span class="builtintype" id="7396303">int</span><span class="op" id="7396306">,</span>&nbsp;<span class="ident" id="7396308">err</span>&nbsp;<span class="builtintype" id="7396312">error</span><span class="op" id="7396317">)</span>&nbsp;<span class="op" id="7396319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396322">for</span>&nbsp;<span class="op" id="7396326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396330">b</span><span class="op" id="7396331">.</span><span class="ident" id="7396332">mu</span><span class="op" id="7396334">.</span><span class="ident" id="7396335">RLock</span><span class="op" id="7396340">(</span><span class="op" id="7396341">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396345">n</span><span class="op" id="7396346">,</span>&nbsp;<span class="ident" id="7396348">err</span>&nbsp;<span class="op" id="7396352">=</span>&nbsp;<span class="ident" id="7396354">b</span><span class="op" id="7396355">.</span><span class="ident" id="7396356">buf</span><span class="op" id="7396359">.</span><span class="ident" id="7396360">Read</span><span class="op" id="7396364">(</span><span class="ident" id="7396365">p</span><span class="op" id="7396366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396370">b</span><span class="op" id="7396371">.</span><span class="ident" id="7396372">mu</span><span class="op" id="7396374">.</span><span class="ident" id="7396375">RUnlock</span><span class="op" id="7396382">(</span><span class="op" id="7396383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396387">if</span>&nbsp;<span class="ident" id="7396390">n</span>&nbsp;<span class="op" id="7396392">&gt;</span>&nbsp;<span class="num" id="7396394">0</span>&nbsp;<span class="op" id="7396396">||</span>&nbsp;<span class="ident" id="7396399">b</span><span class="op" id="7396400">.</span><span class="ident" id="7396401">closed</span>&nbsp;<span class="op" id="7396408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396422">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396426">&lt;-</span><span class="ident" id="7396428">b</span><span class="op" id="7396429">.</span><span class="ident" id="7396430">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396437">}</span><br>
<span class="lineno"></span><span class="op" id="7396439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396442">func</span>&nbsp;<span class="op" id="7396447">(</span><span class="ident" id="7396448">b</span>&nbsp;<span class="op" id="7396450">*</span><span class="ident" id="7396451">syncBuffer</span><span class="op" id="7396461">)</span>&nbsp;<span class="ident" id="7396463">signal</span><span class="op" id="7396469">(</span><span class="op" id="7396470">)</span>&nbsp;<span class="op" id="7396472">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396475">select</span>&nbsp;<span class="op" id="7396482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396485">case</span>&nbsp;<span class="ident" id="7396490">b</span><span class="op" id="7396491">.</span><span class="ident" id="7396492">ready</span>&nbsp;<span class="op" id="7396498">&lt;-</span>&nbsp;<span class="builtintype" id="7396501">true</span><span class="op" id="7396505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396508">default</span><span class="op" id="7396515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396518">}</span><br>
<span class="lineno"></span><span class="op" id="7396520">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7396523">func</span>&nbsp;<span class="op" id="7396528">(</span><span class="ident" id="7396529">b</span>&nbsp;<span class="op" id="7396531">*</span><span class="ident" id="7396532">syncBuffer</span><span class="op" id="7396542">)</span>&nbsp;<span class="ident" id="7396544">Write</span><span class="op" id="7396549">(</span><span class="ident" id="7396550">p</span>&nbsp;<span class="op" id="7396552">[</span><span class="op" id="7396553">]</span><span class="builtintype" id="7396554">byte</span><span class="op" id="7396558">)</span>&nbsp;<span class="op" id="7396560">(</span><span class="ident" id="7396561">n</span>&nbsp;<span class="builtintype" id="7396563">int</span><span class="op" id="7396566">,</span>&nbsp;<span class="ident" id="7396568">err</span>&nbsp;<span class="builtintype" id="7396572">error</span><span class="op" id="7396577">)</span>&nbsp;<span class="op" id="7396579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396582">n</span><span class="op" id="7396583">,</span>&nbsp;<span class="ident" id="7396585">err</span>&nbsp;<span class="op" id="7396589">=</span>&nbsp;<span class="ident" id="7396591">b</span><span class="op" id="7396592">.</span><span class="ident" id="7396593">buf</span><span class="op" id="7396596">.</span><span class="ident" id="7396597">Write</span><span class="op" id="7396602">(</span><span class="ident" id="7396603">p</span><span class="op" id="7396604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396607">b</span><span class="op" id="7396608">.</span><span class="ident" id="7396609">signal</span><span class="op" id="7396615">(</span><span class="op" id="7396616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396619">return</span><br>
<span class="lineno">175</span><span class="op" id="7396626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396629">func</span>&nbsp;<span class="op" id="7396634">(</span><span class="ident" id="7396635">b</span>&nbsp;<span class="op" id="7396637">*</span><span class="ident" id="7396638">syncBuffer</span><span class="op" id="7396648">)</span>&nbsp;<span class="ident" id="7396650">WriteMode</span><span class="op" id="7396659">(</span><span class="op" id="7396660">)</span>&nbsp;<span class="op" id="7396662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396665">b</span><span class="op" id="7396666">.</span><span class="ident" id="7396667">mu</span><span class="op" id="7396669">.</span><span class="ident" id="7396670">Lock</span><span class="op" id="7396674">(</span><span class="op" id="7396675">)</span><br>
<span class="lineno"></span><span class="op" id="7396677">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="7396680">func</span>&nbsp;<span class="op" id="7396685">(</span><span class="ident" id="7396686">b</span>&nbsp;<span class="op" id="7396688">*</span><span class="ident" id="7396689">syncBuffer</span><span class="op" id="7396699">)</span>&nbsp;<span class="ident" id="7396701">ReadMode</span><span class="op" id="7396709">(</span><span class="op" id="7396710">)</span>&nbsp;<span class="op" id="7396712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396715">b</span><span class="op" id="7396716">.</span><span class="ident" id="7396717">mu</span><span class="op" id="7396719">.</span><span class="ident" id="7396720">Unlock</span><span class="op" id="7396726">(</span><span class="op" id="7396727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396730">b</span><span class="op" id="7396731">.</span><span class="ident" id="7396732">signal</span><span class="op" id="7396738">(</span><span class="op" id="7396739">)</span><br>
<span class="lineno"></span><span class="op" id="7396741">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7396744">func</span>&nbsp;<span class="op" id="7396749">(</span><span class="ident" id="7396750">b</span>&nbsp;<span class="op" id="7396752">*</span><span class="ident" id="7396753">syncBuffer</span><span class="op" id="7396763">)</span>&nbsp;<span class="ident" id="7396765">Close</span><span class="op" id="7396770">(</span><span class="op" id="7396771">)</span>&nbsp;<span class="builtintype" id="7396773">error</span>&nbsp;<span class="op" id="7396779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396782">b</span><span class="op" id="7396783">.</span><span class="ident" id="7396784">closed</span>&nbsp;<span class="op" id="7396791">=</span>&nbsp;<span class="builtintype" id="7396793">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396799">b</span><span class="op" id="7396800">.</span><span class="ident" id="7396801">signal</span><span class="op" id="7396807">(</span><span class="op" id="7396808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396811">return</span>&nbsp;<span class="ident" id="7396818">nil</span><br>
<span class="lineno">190</span><span class="op" id="7396822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396825">func</span>&nbsp;<span class="ident" id="7396830">testSync</span><span class="op" id="7396838">(</span><span class="ident" id="7396839">t</span>&nbsp;<span class="op" id="7396841">*</span><span class="ident" id="7396842">testing</span><span class="op" id="7396849">.</span><span class="ident" id="7396850">T</span><span class="op" id="7396851">,</span>&nbsp;<span class="ident" id="7396853">level</span>&nbsp;<span class="builtintype" id="7396859">int</span><span class="op" id="7396862">,</span>&nbsp;<span class="ident" id="7396864">input</span>&nbsp;<span class="op" id="7396870">[</span><span class="op" id="7396871">]</span><span class="builtintype" id="7396872">byte</span><span class="op" id="7396876">,</span>&nbsp;<span class="ident" id="7396878">name</span>&nbsp;<span class="builtintype" id="7396883">string</span><span class="op" id="7396889">)</span>&nbsp;<span class="op" id="7396891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396894">if</span>&nbsp;<span class="builtinfunc" id="7396897">len</span><span class="op" id="7396900">(</span><span class="ident" id="7396901">input</span><span class="op" id="7396906">)</span>&nbsp;<span class="op" id="7396908">==</span>&nbsp;<span class="num" id="7396911">0</span>&nbsp;<span class="op" id="7396913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7396917">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7396925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396929">t</span><span class="op" id="7396930">.</span><span class="ident" id="7396931">Logf</span><span class="op" id="7396935">(</span><span class="string" id="7396936">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="7396959">,</span>&nbsp;<span class="ident" id="7396961">level</span><span class="op" id="7396966">,</span>&nbsp;<span class="builtinfunc" id="7396968">len</span><span class="op" id="7396971">(</span><span class="ident" id="7396972">input</span><span class="op" id="7396977">)</span><span class="op" id="7396978">,</span>&nbsp;<span class="ident" id="7396980">name</span><span class="op" id="7396984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7396987">buf</span>&nbsp;<span class="op" id="7396991">:=</span>&nbsp;<span class="ident" id="7396994">newSyncBuffer</span><span class="op" id="7397007">(</span><span class="op" id="7397008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397011">buf1</span>&nbsp;<span class="op" id="7397016">:=</span>&nbsp;<span class="builtinfunc" id="7397019">new</span><span class="op" id="7397022">(</span><span class="ident" id="7397023">bytes</span><span class="op" id="7397028">.</span><span class="ident" id="7397029">Buffer</span><span class="op" id="7397035">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397038">buf</span><span class="op" id="7397041">.</span><span class="ident" id="7397042">WriteMode</span><span class="op" id="7397051">(</span><span class="op" id="7397052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397055">w</span><span class="op" id="7397056">,</span>&nbsp;<span class="ident" id="7397058">err</span>&nbsp;<span class="op" id="7397062">:=</span>&nbsp;<span class="ident" id="7397065">NewWriter</span><span class="op" id="7397074">(</span><span class="ident" id="7397075">io</span><span class="op" id="7397077">.</span><span class="ident" id="7397078">MultiWriter</span><span class="op" id="7397089">(</span><span class="ident" id="7397090">buf</span><span class="op" id="7397093">,</span>&nbsp;<span class="ident" id="7397095">buf1</span><span class="op" id="7397099">)</span><span class="op" id="7397100">,</span>&nbsp;<span class="ident" id="7397102">level</span><span class="op" id="7397107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397110">if</span>&nbsp;<span class="ident" id="7397113">err</span>&nbsp;<span class="op" id="7397117">!=</span>&nbsp;<span class="ident" id="7397120">nil</span>&nbsp;<span class="op" id="7397124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397128">t</span><span class="op" id="7397129">.</span><span class="ident" id="7397130">Errorf</span><span class="op" id="7397136">(</span><span class="string" id="7397137">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7397152">,</span>&nbsp;<span class="ident" id="7397154">err</span><span class="op" id="7397157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397161">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397172">r</span>&nbsp;<span class="op" id="7397174">:=</span>&nbsp;<span class="ident" id="7397177">NewReader</span><span class="op" id="7397186">(</span><span class="ident" id="7397187">buf</span><span class="op" id="7397190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7397194">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397234">for</span>&nbsp;<span class="ident" id="7397238">i</span>&nbsp;<span class="op" id="7397240">:=</span>&nbsp;<span class="num" id="7397243">0</span><span class="op" id="7397244">;</span>&nbsp;<span class="ident" id="7397246">i</span>&nbsp;<span class="op" id="7397248">&lt;</span>&nbsp;<span class="num" id="7397250">2</span><span class="op" id="7397251">;</span>&nbsp;<span class="ident" id="7397253">i</span><span class="op" id="7397254">++</span>&nbsp;<span class="op" id="7397257">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397261">var</span>&nbsp;<span class="ident" id="7397265">lo</span><span class="op" id="7397267">,</span>&nbsp;<span class="ident" id="7397269">hi</span>&nbsp;<span class="builtintype" id="7397272">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397278">if</span>&nbsp;<span class="ident" id="7397281">i</span>&nbsp;<span class="op" id="7397283">==</span>&nbsp;<span class="num" id="7397286">0</span>&nbsp;<span class="op" id="7397288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397293">lo</span><span class="op" id="7397295">,</span>&nbsp;<span class="ident" id="7397297">hi</span>&nbsp;<span class="op" id="7397300">=</span>&nbsp;<span class="num" id="7397302">0</span><span class="op" id="7397303">,</span>&nbsp;<span class="op" id="7397305">(</span><span class="builtinfunc" id="7397306">len</span><span class="op" id="7397309">(</span><span class="ident" id="7397310">input</span><span class="op" id="7397315">)</span><span class="op" id="7397316">+</span><span class="num" id="7397317">1</span><span class="op" id="7397318">)</span><span class="op" id="7397319">/</span><span class="num" id="7397320">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397324">}</span>&nbsp;<span class="keyword" id="7397326">else</span>&nbsp;<span class="op" id="7397331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397336">lo</span><span class="op" id="7397338">,</span>&nbsp;<span class="ident" id="7397340">hi</span>&nbsp;<span class="op" id="7397343">=</span>&nbsp;<span class="op" id="7397345">(</span><span class="builtinfunc" id="7397346">len</span><span class="op" id="7397349">(</span><span class="ident" id="7397350">input</span><span class="op" id="7397355">)</span><span class="op" id="7397356">+</span><span class="num" id="7397357">1</span><span class="op" id="7397358">)</span><span class="op" id="7397359">/</span><span class="num" id="7397360">2</span><span class="op" id="7397361">,</span>&nbsp;<span class="builtinfunc" id="7397363">len</span><span class="op" id="7397366">(</span><span class="ident" id="7397367">input</span><span class="op" id="7397372">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397380">t</span><span class="op" id="7397381">.</span><span class="ident" id="7397382">Logf</span><span class="op" id="7397386">(</span><span class="string" id="7397387">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="7397405">,</span>&nbsp;<span class="ident" id="7397407">i</span><span class="op" id="7397408">,</span>&nbsp;<span class="ident" id="7397410">lo</span><span class="op" id="7397412">,</span>&nbsp;<span class="ident" id="7397414">hi</span><span class="op" id="7397416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397420">if</span>&nbsp;<span class="ident" id="7397423">_</span><span class="op" id="7397424">,</span>&nbsp;<span class="ident" id="7397426">err</span>&nbsp;<span class="op" id="7397430">:=</span>&nbsp;<span class="ident" id="7397433">w</span><span class="op" id="7397434">.</span><span class="ident" id="7397435">Write</span><span class="op" id="7397440">(</span><span class="ident" id="7397441">input</span><span class="op" id="7397446">[</span><span class="ident" id="7397447">lo</span><span class="op" id="7397449">:</span><span class="ident" id="7397450">hi</span><span class="op" id="7397452">]</span><span class="op" id="7397453">)</span><span class="op" id="7397454">;</span>&nbsp;<span class="ident" id="7397456">err</span>&nbsp;<span class="op" id="7397460">!=</span>&nbsp;<span class="ident" id="7397463">nil</span>&nbsp;<span class="op" id="7397467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397472">t</span><span class="op" id="7397473">.</span><span class="ident" id="7397474">Errorf</span><span class="op" id="7397480">(</span><span class="string" id="7397481">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="7397502">,</span>&nbsp;<span class="ident" id="7397504">err</span><span class="op" id="7397507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397512">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397525">if</span>&nbsp;<span class="ident" id="7397528">i</span>&nbsp;<span class="op" id="7397530">==</span>&nbsp;<span class="num" id="7397533">0</span>&nbsp;<span class="op" id="7397535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397540">if</span>&nbsp;<span class="ident" id="7397543">err</span>&nbsp;<span class="op" id="7397547">:=</span>&nbsp;<span class="ident" id="7397550">w</span><span class="op" id="7397551">.</span><span class="ident" id="7397552">Flush</span><span class="op" id="7397557">(</span><span class="op" id="7397558">)</span><span class="op" id="7397559">;</span>&nbsp;<span class="ident" id="7397561">err</span>&nbsp;<span class="op" id="7397565">!=</span>&nbsp;<span class="ident" id="7397568">nil</span>&nbsp;<span class="op" id="7397572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397578">t</span><span class="op" id="7397579">.</span><span class="ident" id="7397580">Errorf</span><span class="op" id="7397586">(</span><span class="string" id="7397587">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="7397608">,</span>&nbsp;<span class="ident" id="7397610">err</span><span class="op" id="7397613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397619">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397633">}</span>&nbsp;<span class="keyword" id="7397635">else</span>&nbsp;<span class="op" id="7397640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397645">if</span>&nbsp;<span class="ident" id="7397648">err</span>&nbsp;<span class="op" id="7397652">:=</span>&nbsp;<span class="ident" id="7397655">w</span><span class="op" id="7397656">.</span><span class="ident" id="7397657">Close</span><span class="op" id="7397662">(</span><span class="op" id="7397663">)</span><span class="op" id="7397664">;</span>&nbsp;<span class="ident" id="7397666">err</span>&nbsp;<span class="op" id="7397670">!=</span>&nbsp;<span class="ident" id="7397673">nil</span>&nbsp;<span class="op" id="7397677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397683">t</span><span class="op" id="7397684">.</span><span class="ident" id="7397685">Errorf</span><span class="op" id="7397691">(</span><span class="string" id="7397692">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="7397713">,</span>&nbsp;<span class="ident" id="7397715">err</span><span class="op" id="7397718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397723">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7397727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397731">buf</span><span class="op" id="7397734">.</span><span class="ident" id="7397735">ReadMode</span><span class="op" id="7397743">(</span><span class="op" id="7397744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397748">out</span>&nbsp;<span class="op" id="7397752">:=</span>&nbsp;<span class="builtinfunc" id="7397755">make</span><span class="op" id="7397759">(</span><span class="op" id="7397760">[</span><span class="op" id="7397761">]</span><span class="builtintype" id="7397762">byte</span><span class="op" id="7397766">,</span>&nbsp;<span class="ident" id="7397768">hi</span><span class="op" id="7397770">-</span><span class="ident" id="7397771">lo</span><span class="op" id="7397773">+</span><span class="num" id="7397774">1</span><span class="op" id="7397775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397779">m</span><span class="op" id="7397780">,</span>&nbsp;<span class="ident" id="7397782">err</span>&nbsp;<span class="op" id="7397786">:=</span>&nbsp;<span class="ident" id="7397789">io</span><span class="op" id="7397791">.</span><span class="ident" id="7397792">ReadAtLeast</span><span class="op" id="7397803">(</span><span class="ident" id="7397804">r</span><span class="op" id="7397805">,</span>&nbsp;<span class="ident" id="7397807">out</span><span class="op" id="7397810">,</span>&nbsp;<span class="ident" id="7397812">hi</span><span class="op" id="7397814">-</span><span class="ident" id="7397815">lo</span><span class="op" id="7397817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397821">t</span><span class="op" id="7397822">.</span><span class="ident" id="7397823">Logf</span><span class="op" id="7397827">(</span><span class="string" id="7397828">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7397842">,</span>&nbsp;<span class="ident" id="7397844">i</span><span class="op" id="7397845">,</span>&nbsp;<span class="ident" id="7397847">m</span><span class="op" id="7397848">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7397852">if</span>&nbsp;<span class="ident" id="7397855">m</span>&nbsp;<span class="op" id="7397857">!=</span>&nbsp;<span class="ident" id="7397860">hi</span><span class="op" id="7397862">-</span><span class="ident" id="7397863">lo</span>&nbsp;<span class="op" id="7397866">||</span>&nbsp;<span class="ident" id="7397869">err</span>&nbsp;<span class="op" id="7397873">!=</span>&nbsp;<span class="ident" id="7397876">nil</span>&nbsp;<span class="op" id="7397880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7397885">t</span><span class="op" id="7397886">.</span><span class="ident" id="7397887">Errorf</span><span class="op" id="7397893">(</span><span class="string" id="7397894">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="7397947">,</span>&nbsp;<span class="ident" id="7397949">i</span><span class="op" id="7397950">,</span>&nbsp;<span class="ident" id="7397952">level</span><span class="op" id="7397957">,</span>&nbsp;<span class="builtinfunc" id="7397959">len</span><span class="op" id="7397962">(</span><span class="ident" id="7397963">input</span><span class="op" id="7397968">)</span><span class="op" id="7397969">,</span>&nbsp;<span class="ident" id="7397971">name</span><span class="op" id="7397975">,</span>&nbsp;<span class="ident" id="7397977">hi</span><span class="op" id="7397979">-</span><span class="ident" id="7397980">lo</span><span class="op" id="7397982">,</span>&nbsp;<span class="ident" id="7397984">m</span><span class="op" id="7397985">,</span>&nbsp;<span class="ident" id="7397987">err</span><span class="op" id="7397990">,</span>&nbsp;<span class="ident" id="7397992">buf</span><span class="op" id="7397995">.</span><span class="ident" id="7397996">buf</span><span class="op" id="7397999">.</span><span class="ident" id="7398000">Len</span><span class="op" id="7398003">(</span><span class="op" id="7398004">)</span><span class="op" id="7398005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398010">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398023">if</span>&nbsp;<span class="op" id="7398026">!</span><span class="ident" id="7398027">bytes</span><span class="op" id="7398032">.</span><span class="ident" id="7398033">Equal</span><span class="op" id="7398038">(</span><span class="ident" id="7398039">input</span><span class="op" id="7398044">[</span><span class="ident" id="7398045">lo</span><span class="op" id="7398047">:</span><span class="ident" id="7398048">hi</span><span class="op" id="7398050">]</span><span class="op" id="7398051">,</span>&nbsp;<span class="ident" id="7398053">out</span><span class="op" id="7398056">[</span><span class="op" id="7398057">:</span><span class="ident" id="7398058">hi</span><span class="op" id="7398060">-</span><span class="ident" id="7398061">lo</span><span class="op" id="7398063">]</span><span class="op" id="7398064">)</span>&nbsp;<span class="op" id="7398066">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398071">t</span><span class="op" id="7398072">.</span><span class="ident" id="7398073">Errorf</span><span class="op" id="7398079">(</span><span class="string" id="7398080">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="7398121">,</span>&nbsp;<span class="ident" id="7398123">i</span><span class="op" id="7398124">,</span>&nbsp;<span class="ident" id="7398126">input</span><span class="op" id="7398131">[</span><span class="ident" id="7398132">lo</span><span class="op" id="7398134">:</span><span class="ident" id="7398135">hi</span><span class="op" id="7398137">]</span><span class="op" id="7398138">,</span>&nbsp;<span class="ident" id="7398140">out</span><span class="op" id="7398143">[</span><span class="op" id="7398144">:</span><span class="ident" id="7398145">hi</span><span class="op" id="7398147">-</span><span class="ident" id="7398148">lo</span><span class="op" id="7398150">]</span><span class="op" id="7398151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398169">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398222">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398279">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398336">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398392">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398444">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398505">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398566">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398618">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7398679">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398691">buf</span><span class="op" id="7398694">.</span><span class="ident" id="7398695">WriteMode</span><span class="op" id="7398704">(</span><span class="op" id="7398705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398708">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398711">buf</span><span class="op" id="7398714">.</span><span class="ident" id="7398715">ReadMode</span><span class="op" id="7398723">(</span><span class="op" id="7398724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398727">out</span>&nbsp;<span class="op" id="7398731">:=</span>&nbsp;<span class="builtinfunc" id="7398734">make</span><span class="op" id="7398738">(</span><span class="op" id="7398739">[</span><span class="op" id="7398740">]</span><span class="builtintype" id="7398741">byte</span><span class="op" id="7398745">,</span>&nbsp;<span class="num" id="7398747">10</span><span class="op" id="7398749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398752">if</span>&nbsp;<span class="ident" id="7398755">n</span><span class="op" id="7398756">,</span>&nbsp;<span class="ident" id="7398758">err</span>&nbsp;<span class="op" id="7398762">:=</span>&nbsp;<span class="ident" id="7398765">r</span><span class="op" id="7398766">.</span><span class="ident" id="7398767">Read</span><span class="op" id="7398771">(</span><span class="ident" id="7398772">out</span><span class="op" id="7398775">)</span><span class="op" id="7398776">;</span>&nbsp;<span class="ident" id="7398778">n</span>&nbsp;<span class="op" id="7398780">&gt;</span>&nbsp;<span class="num" id="7398782">0</span>&nbsp;<span class="op" id="7398784">||</span>&nbsp;<span class="ident" id="7398787">err</span>&nbsp;<span class="op" id="7398791">!=</span>&nbsp;<span class="ident" id="7398794">io</span><span class="op" id="7398796">.</span><span class="ident" id="7398797">EOF</span>&nbsp;<span class="op" id="7398801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398805">t</span><span class="op" id="7398806">.</span><span class="ident" id="7398807">Errorf</span><span class="op" id="7398813">(</span><span class="string" id="7398814">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="7398867">,</span>&nbsp;<span class="ident" id="7398869">level</span><span class="op" id="7398874">,</span>&nbsp;<span class="builtinfunc" id="7398876">len</span><span class="op" id="7398879">(</span><span class="ident" id="7398880">input</span><span class="op" id="7398885">)</span><span class="op" id="7398886">,</span>&nbsp;<span class="ident" id="7398888">name</span><span class="op" id="7398892">,</span>&nbsp;<span class="ident" id="7398894">n</span><span class="op" id="7398895">,</span>&nbsp;<span class="ident" id="7398897">err</span><span class="op" id="7398900">,</span>&nbsp;<span class="ident" id="7398902">out</span><span class="op" id="7398905">[</span><span class="num" id="7398906">0</span><span class="op" id="7398907">:</span><span class="ident" id="7398908">n</span><span class="op" id="7398909">]</span><span class="op" id="7398910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7398913">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7398916">if</span>&nbsp;<span class="ident" id="7398919">buf</span><span class="op" id="7398922">.</span><span class="ident" id="7398923">buf</span><span class="op" id="7398926">.</span><span class="ident" id="7398927">Len</span><span class="op" id="7398930">(</span><span class="op" id="7398931">)</span>&nbsp;<span class="op" id="7398933">!=</span>&nbsp;<span class="num" id="7398936">0</span>&nbsp;<span class="op" id="7398938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7398942">t</span><span class="op" id="7398943">.</span><span class="ident" id="7398944">Errorf</span><span class="op" id="7398950">(</span><span class="string" id="7398951">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="7398993">,</span>&nbsp;<span class="ident" id="7398995">level</span><span class="op" id="7399000">,</span>&nbsp;<span class="builtinfunc" id="7399002">len</span><span class="op" id="7399005">(</span><span class="ident" id="7399006">input</span><span class="op" id="7399011">)</span><span class="op" id="7399012">,</span>&nbsp;<span class="ident" id="7399014">name</span><span class="op" id="7399018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399024">r</span><span class="op" id="7399025">.</span><span class="ident" id="7399026">Close</span><span class="op" id="7399031">(</span><span class="op" id="7399032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7399036">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399083">r</span>&nbsp;<span class="op" id="7399085">=</span>&nbsp;<span class="ident" id="7399087">NewReader</span><span class="op" id="7399096">(</span><span class="ident" id="7399097">buf1</span><span class="op" id="7399101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399104">out</span><span class="op" id="7399107">,</span>&nbsp;<span class="ident" id="7399109">err</span>&nbsp;<span class="op" id="7399113">=</span>&nbsp;<span class="ident" id="7399115">ioutil</span><span class="op" id="7399121">.</span><span class="ident" id="7399122">ReadAll</span><span class="op" id="7399129">(</span><span class="ident" id="7399130">r</span><span class="op" id="7399131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399134">if</span>&nbsp;<span class="ident" id="7399137">err</span>&nbsp;<span class="op" id="7399141">!=</span>&nbsp;<span class="ident" id="7399144">nil</span>&nbsp;<span class="op" id="7399148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399152">t</span><span class="op" id="7399153">.</span><span class="ident" id="7399154">Errorf</span><span class="op" id="7399160">(</span><span class="string" id="7399161">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="7399181">,</span>&nbsp;<span class="ident" id="7399183">err</span><span class="op" id="7399186">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399190">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399201">r</span><span class="op" id="7399202">.</span><span class="ident" id="7399203">Close</span><span class="op" id="7399208">(</span><span class="op" id="7399209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399212">if</span>&nbsp;<span class="op" id="7399215">!</span><span class="ident" id="7399216">bytes</span><span class="op" id="7399221">.</span><span class="ident" id="7399222">Equal</span><span class="op" id="7399227">(</span><span class="ident" id="7399228">input</span><span class="op" id="7399233">,</span>&nbsp;<span class="ident" id="7399235">out</span><span class="op" id="7399238">)</span>&nbsp;<span class="op" id="7399240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399244">t</span><span class="op" id="7399245">.</span><span class="ident" id="7399246">Errorf</span><span class="op" id="7399252">(</span><span class="string" id="7399253">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7399318">,</span>&nbsp;<span class="ident" id="7399320">level</span><span class="op" id="7399325">,</span>&nbsp;<span class="ident" id="7399327">name</span><span class="op" id="7399331">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399334">}</span><br>
<span class="lineno"></span><span class="op" id="7399336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7399339">func</span>&nbsp;<span class="ident" id="7399344">testToFromWithLevelAndLimit</span><span class="op" id="7399371">(</span><span class="ident" id="7399372">t</span>&nbsp;<span class="op" id="7399374">*</span><span class="ident" id="7399375">testing</span><span class="op" id="7399382">.</span><span class="ident" id="7399383">T</span><span class="op" id="7399384">,</span>&nbsp;<span class="ident" id="7399386">level</span>&nbsp;<span class="builtintype" id="7399392">int</span><span class="op" id="7399395">,</span>&nbsp;<span class="ident" id="7399397">input</span>&nbsp;<span class="op" id="7399403">[</span><span class="op" id="7399404">]</span><span class="builtintype" id="7399405">byte</span><span class="op" id="7399409">,</span>&nbsp;<span class="ident" id="7399411">name</span>&nbsp;<span class="builtintype" id="7399416">string</span><span class="op" id="7399422">,</span>&nbsp;<span class="ident" id="7399424">limit</span>&nbsp;<span class="builtintype" id="7399430">int</span><span class="op" id="7399433">)</span>&nbsp;<span class="op" id="7399435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399438">var</span>&nbsp;<span class="ident" id="7399442">buffer</span>&nbsp;<span class="ident" id="7399449">bytes</span><span class="op" id="7399454">.</span><span class="ident" id="7399455">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399463">w</span><span class="op" id="7399464">,</span>&nbsp;<span class="ident" id="7399466">err</span>&nbsp;<span class="op" id="7399470">:=</span>&nbsp;<span class="ident" id="7399473">NewWriter</span><span class="op" id="7399482">(</span><span class="op" id="7399483">&amp;</span><span class="ident" id="7399484">buffer</span><span class="op" id="7399490">,</span>&nbsp;<span class="ident" id="7399492">level</span><span class="op" id="7399497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399500">if</span>&nbsp;<span class="ident" id="7399503">err</span>&nbsp;<span class="op" id="7399507">!=</span>&nbsp;<span class="ident" id="7399510">nil</span>&nbsp;<span class="op" id="7399514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399518">t</span><span class="op" id="7399519">.</span><span class="ident" id="7399520">Errorf</span><span class="op" id="7399526">(</span><span class="string" id="7399527">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7399542">,</span>&nbsp;<span class="ident" id="7399544">err</span><span class="op" id="7399547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399551">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399559">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399562">w</span><span class="op" id="7399563">.</span><span class="ident" id="7399564">Write</span><span class="op" id="7399569">(</span><span class="ident" id="7399570">input</span><span class="op" id="7399575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399578">w</span><span class="op" id="7399579">.</span><span class="ident" id="7399580">Close</span><span class="op" id="7399585">(</span><span class="op" id="7399586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399589">if</span>&nbsp;<span class="ident" id="7399592">limit</span>&nbsp;<span class="op" id="7399598">&gt;</span>&nbsp;<span class="num" id="7399600">0</span>&nbsp;<span class="op" id="7399602">&amp;&amp;</span>&nbsp;<span class="ident" id="7399605">buffer</span><span class="op" id="7399611">.</span><span class="ident" id="7399612">Len</span><span class="op" id="7399615">(</span><span class="op" id="7399616">)</span>&nbsp;<span class="op" id="7399618">&gt;</span>&nbsp;<span class="ident" id="7399620">limit</span>&nbsp;<span class="op" id="7399626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399630">t</span><span class="op" id="7399631">.</span><span class="ident" id="7399632">Errorf</span><span class="op" id="7399638">(</span><span class="string" id="7399639">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7399689">,</span>&nbsp;<span class="ident" id="7399691">level</span><span class="op" id="7399696">,</span>&nbsp;<span class="ident" id="7399698">buffer</span><span class="op" id="7399704">.</span><span class="ident" id="7399705">Len</span><span class="op" id="7399708">(</span><span class="op" id="7399709">)</span><span class="op" id="7399710">,</span>&nbsp;<span class="ident" id="7399712">limit</span><span class="op" id="7399717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399721">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399732">r</span>&nbsp;<span class="op" id="7399734">:=</span>&nbsp;<span class="ident" id="7399737">NewReader</span><span class="op" id="7399746">(</span><span class="op" id="7399747">&amp;</span><span class="ident" id="7399748">buffer</span><span class="op" id="7399754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399757">out</span><span class="op" id="7399760">,</span>&nbsp;<span class="ident" id="7399762">err</span>&nbsp;<span class="op" id="7399766">:=</span>&nbsp;<span class="ident" id="7399769">ioutil</span><span class="op" id="7399775">.</span><span class="ident" id="7399776">ReadAll</span><span class="op" id="7399783">(</span><span class="ident" id="7399784">r</span><span class="op" id="7399785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399788">if</span>&nbsp;<span class="ident" id="7399791">err</span>&nbsp;<span class="op" id="7399795">!=</span>&nbsp;<span class="ident" id="7399798">nil</span>&nbsp;<span class="op" id="7399802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399806">t</span><span class="op" id="7399807">.</span><span class="ident" id="7399808">Errorf</span><span class="op" id="7399814">(</span><span class="string" id="7399815">&#34;read:&nbsp;%s&#34;</span><span class="op" id="7399825">,</span>&nbsp;<span class="ident" id="7399827">err</span><span class="op" id="7399830">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399834">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399845">r</span><span class="op" id="7399846">.</span><span class="ident" id="7399847">Close</span><span class="op" id="7399852">(</span><span class="op" id="7399853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399856">if</span>&nbsp;<span class="op" id="7399859">!</span><span class="ident" id="7399860">bytes</span><span class="op" id="7399865">.</span><span class="ident" id="7399866">Equal</span><span class="op" id="7399871">(</span><span class="ident" id="7399872">input</span><span class="op" id="7399877">,</span>&nbsp;<span class="ident" id="7399879">out</span><span class="op" id="7399882">)</span>&nbsp;<span class="op" id="7399884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399888">t</span><span class="op" id="7399889">.</span><span class="ident" id="7399890">Errorf</span><span class="op" id="7399896">(</span><span class="string" id="7399897">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7399952">,</span>&nbsp;<span class="ident" id="7399954">level</span><span class="op" id="7399959">,</span>&nbsp;<span class="ident" id="7399961">name</span><span class="op" id="7399965">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7399969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7399977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7399980">testSync</span><span class="op" id="7399988">(</span><span class="ident" id="7399989">t</span><span class="op" id="7399990">,</span>&nbsp;<span class="ident" id="7399992">level</span><span class="op" id="7399997">,</span>&nbsp;<span class="ident" id="7399999">input</span><span class="op" id="7400004">,</span>&nbsp;<span class="ident" id="7400006">name</span><span class="op" id="7400010">)</span><br>
<span class="lineno"></span><span class="op" id="7400012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="7400015">func</span>&nbsp;<span class="ident" id="7400020">testToFromWithLimit</span><span class="op" id="7400039">(</span><span class="ident" id="7400040">t</span>&nbsp;<span class="op" id="7400042">*</span><span class="ident" id="7400043">testing</span><span class="op" id="7400050">.</span><span class="ident" id="7400051">T</span><span class="op" id="7400052">,</span>&nbsp;<span class="ident" id="7400054">input</span>&nbsp;<span class="op" id="7400060">[</span><span class="op" id="7400061">]</span><span class="builtintype" id="7400062">byte</span><span class="op" id="7400066">,</span>&nbsp;<span class="ident" id="7400068">name</span>&nbsp;<span class="builtintype" id="7400073">string</span><span class="op" id="7400079">,</span>&nbsp;<span class="ident" id="7400081">limit</span>&nbsp;<span class="op" id="7400087">[</span><span class="num" id="7400088">10</span><span class="op" id="7400090">]</span><span class="builtintype" id="7400091">int</span><span class="op" id="7400094">)</span>&nbsp;<span class="op" id="7400096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400099">for</span>&nbsp;<span class="ident" id="7400103">i</span>&nbsp;<span class="op" id="7400105">:=</span>&nbsp;<span class="num" id="7400108">0</span><span class="op" id="7400109">;</span>&nbsp;<span class="ident" id="7400111">i</span>&nbsp;<span class="op" id="7400113">&lt;</span>&nbsp;<span class="num" id="7400115">10</span><span class="op" id="7400117">;</span>&nbsp;<span class="ident" id="7400119">i</span><span class="op" id="7400120">++</span>&nbsp;<span class="op" id="7400123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400127">testToFromWithLevelAndLimit</span><span class="op" id="7400154">(</span><span class="ident" id="7400155">t</span><span class="op" id="7400156">,</span>&nbsp;<span class="ident" id="7400158">i</span><span class="op" id="7400159">,</span>&nbsp;<span class="ident" id="7400161">input</span><span class="op" id="7400166">,</span>&nbsp;<span class="ident" id="7400168">name</span><span class="op" id="7400172">,</span>&nbsp;<span class="ident" id="7400174">limit</span><span class="op" id="7400179">[</span><span class="ident" id="7400180">i</span><span class="op" id="7400181">]</span><span class="op" id="7400182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400185">}</span><br>
<span class="lineno"></span><span class="op" id="7400187">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="7400190">func</span>&nbsp;<span class="ident" id="7400195">TestDeflateInflate</span><span class="op" id="7400213">(</span><span class="ident" id="7400214">t</span>&nbsp;<span class="op" id="7400216">*</span><span class="ident" id="7400217">testing</span><span class="op" id="7400224">.</span><span class="ident" id="7400225">T</span><span class="op" id="7400226">)</span>&nbsp;<span class="op" id="7400228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400231">for</span>&nbsp;<span class="ident" id="7400235">i</span><span class="op" id="7400236">,</span>&nbsp;<span class="ident" id="7400238">h</span>&nbsp;<span class="op" id="7400240">:=</span>&nbsp;<span class="keyword" id="7400243">range</span>&nbsp;<span class="ident" id="7400249">deflateInflateTests</span>&nbsp;<span class="op" id="7400269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400273">testToFromWithLimit</span><span class="op" id="7400292">(</span><span class="ident" id="7400293">t</span><span class="op" id="7400294">,</span>&nbsp;<span class="ident" id="7400296">h</span><span class="op" id="7400297">.</span><span class="ident" id="7400298">in</span><span class="op" id="7400300">,</span>&nbsp;<span class="ident" id="7400302">fmt</span><span class="op" id="7400305">.</span><span class="ident" id="7400306">Sprintf</span><span class="op" id="7400313">(</span><span class="string" id="7400314">&#34;#%d&#34;</span><span class="op" id="7400319">,</span>&nbsp;<span class="ident" id="7400321">i</span><span class="op" id="7400322">)</span><span class="op" id="7400323">,</span>&nbsp;<span class="op" id="7400325">[</span><span class="num" id="7400326">10</span><span class="op" id="7400328">]</span><span class="builtintype" id="7400329">int</span><span class="op" id="7400332">{</span><span class="op" id="7400333">}</span><span class="op" id="7400334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400337">}</span><br>
<span class="lineno">315</span><span class="op" id="7400339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7400342">func</span>&nbsp;<span class="ident" id="7400347">TestReverseBits</span><span class="op" id="7400362">(</span><span class="ident" id="7400363">t</span>&nbsp;<span class="op" id="7400365">*</span><span class="ident" id="7400366">testing</span><span class="op" id="7400373">.</span><span class="ident" id="7400374">T</span><span class="op" id="7400375">)</span>&nbsp;<span class="op" id="7400377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400380">for</span>&nbsp;<span class="ident" id="7400384">_</span><span class="op" id="7400385">,</span>&nbsp;<span class="ident" id="7400387">h</span>&nbsp;<span class="op" id="7400389">:=</span>&nbsp;<span class="keyword" id="7400392">range</span>&nbsp;<span class="ident" id="7400398">reverseBitsTests</span>&nbsp;<span class="op" id="7400415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7400419">if</span>&nbsp;<span class="ident" id="7400422">v</span>&nbsp;<span class="op" id="7400424">:=</span>&nbsp;<span class="ident" id="7400427">reverseBits</span><span class="op" id="7400438">(</span><span class="ident" id="7400439">h</span><span class="op" id="7400440">.</span><span class="ident" id="7400441">in</span><span class="op" id="7400443">,</span>&nbsp;<span class="ident" id="7400445">h</span><span class="op" id="7400446">.</span><span class="ident" id="7400447">bitCount</span><span class="op" id="7400455">)</span><span class="op" id="7400456">;</span>&nbsp;<span class="ident" id="7400458">v</span>&nbsp;<span class="op" id="7400460">!=</span>&nbsp;<span class="ident" id="7400463">h</span><span class="op" id="7400464">.</span><span class="ident" id="7400465">out</span>&nbsp;<span class="op" id="7400469">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400474">t</span><span class="op" id="7400475">.</span><span class="ident" id="7400476">Errorf</span><span class="op" id="7400482">(</span><span class="string" id="7400483">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7400517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400523">h</span><span class="op" id="7400524">.</span><span class="ident" id="7400525">in</span><span class="op" id="7400527">,</span>&nbsp;<span class="ident" id="7400529">h</span><span class="op" id="7400530">.</span><span class="ident" id="7400531">bitCount</span><span class="op" id="7400539">,</span>&nbsp;<span class="ident" id="7400541">v</span><span class="op" id="7400542">,</span>&nbsp;<span class="ident" id="7400544">h</span><span class="op" id="7400545">.</span><span class="ident" id="7400546">out</span><span class="op" id="7400549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400556">}</span><br>
<span class="lineno"></span><span class="op" id="7400558">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7400561">type</span>&nbsp;<span class="ident" id="7400566">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="7400591">struct</span>&nbsp;<span class="op" id="7400598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400601">filename</span>&nbsp;<span class="builtintype" id="7400610">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400618">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7400627">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7400635">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400644">[</span><span class="num" id="7400645">10</span><span class="op" id="7400647">]</span><span class="builtintype" id="7400648">int</span><br>
<span class="lineno">330</span><span class="op" id="7400652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7400655">var</span>&nbsp;<span class="ident" id="7400659">deflateInflateStringTests</span>&nbsp;<span class="op" id="7400685">=</span>&nbsp;<span class="op" id="7400687">[</span><span class="op" id="7400688">]</span><span class="ident" id="7400689">deflateInflateStringTest</span><span class="op" id="7400713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7400720">&#34;../testdata/e.txt&#34;</span><span class="op" id="7400739">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7400743">&#34;2.718281828...&#34;</span><span class="op" id="7400759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400763">[</span><span class="op" id="7400764">...</span><span class="op" id="7400767">]</span><span class="builtintype" id="7400768">int</span><span class="op" id="7400771">{</span><span class="num" id="7400772">100018</span><span class="op" id="7400778">,</span>&nbsp;<span class="num" id="7400780">50650</span><span class="op" id="7400785">,</span>&nbsp;<span class="num" id="7400787">50960</span><span class="op" id="7400792">,</span>&nbsp;<span class="num" id="7400794">51150</span><span class="op" id="7400799">,</span>&nbsp;<span class="num" id="7400801">50930</span><span class="op" id="7400806">,</span>&nbsp;<span class="num" id="7400808">50790</span><span class="op" id="7400813">,</span>&nbsp;<span class="num" id="7400815">50790</span><span class="op" id="7400820">,</span>&nbsp;<span class="num" id="7400822">50790</span><span class="op" id="7400827">,</span>&nbsp;<span class="num" id="7400829">50790</span><span class="op" id="7400834">,</span>&nbsp;<span class="num" id="7400836">50790</span><span class="op" id="7400841">}</span><span class="op" id="7400842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400845">}</span><span class="op" id="7400846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7400853">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="7400892">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7400896">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="7400919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7400923">[</span><span class="op" id="7400924">...</span><span class="op" id="7400927">]</span><span class="builtintype" id="7400928">int</span><span class="op" id="7400931">{</span><span class="num" id="7400932">407330</span><span class="op" id="7400938">,</span>&nbsp;<span class="num" id="7400940">187598</span><span class="op" id="7400946">,</span>&nbsp;<span class="num" id="7400948">180361</span><span class="op" id="7400954">,</span>&nbsp;<span class="num" id="7400956">172974</span><span class="op" id="7400962">,</span>&nbsp;<span class="num" id="7400964">169160</span><span class="op" id="7400970">,</span>&nbsp;<span class="num" id="7400972">163476</span><span class="op" id="7400978">,</span>&nbsp;<span class="num" id="7400980">160936</span><span class="op" id="7400986">,</span>&nbsp;<span class="num" id="7400988">160506</span><span class="op" id="7400994">,</span>&nbsp;<span class="num" id="7400996">160295</span><span class="op" id="7401002">,</span>&nbsp;<span class="num" id="7401004">160295</span><span class="op" id="7401010">}</span><span class="op" id="7401011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401014">}</span><span class="op" id="7401015">,</span><br>
<span class="lineno"></span><span class="op" id="7401017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="7401020">func</span>&nbsp;<span class="ident" id="7401025">TestDeflateInflateString</span><span class="op" id="7401049">(</span><span class="ident" id="7401050">t</span>&nbsp;<span class="op" id="7401052">*</span><span class="ident" id="7401053">testing</span><span class="op" id="7401060">.</span><span class="ident" id="7401061">T</span><span class="op" id="7401062">)</span>&nbsp;<span class="op" id="7401064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401067">for</span>&nbsp;<span class="ident" id="7401071">_</span><span class="op" id="7401072">,</span>&nbsp;<span class="ident" id="7401074">test</span>&nbsp;<span class="op" id="7401079">:=</span>&nbsp;<span class="keyword" id="7401082">range</span>&nbsp;<span class="ident" id="7401088">deflateInflateStringTests</span>&nbsp;<span class="op" id="7401114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401118">gold</span><span class="op" id="7401122">,</span>&nbsp;<span class="ident" id="7401124">err</span>&nbsp;<span class="op" id="7401128">:=</span>&nbsp;<span class="ident" id="7401131">ioutil</span><span class="op" id="7401137">.</span><span class="ident" id="7401138">ReadFile</span><span class="op" id="7401146">(</span><span class="ident" id="7401147">test</span><span class="op" id="7401151">.</span><span class="ident" id="7401152">filename</span><span class="op" id="7401160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401164">if</span>&nbsp;<span class="ident" id="7401167">err</span>&nbsp;<span class="op" id="7401171">!=</span>&nbsp;<span class="ident" id="7401174">nil</span>&nbsp;<span class="op" id="7401178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401183">t</span><span class="op" id="7401184">.</span><span class="ident" id="7401185">Error</span><span class="op" id="7401190">(</span><span class="ident" id="7401191">err</span><span class="op" id="7401194">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401202">testToFromWithLimit</span><span class="op" id="7401221">(</span><span class="ident" id="7401222">t</span><span class="op" id="7401223">,</span>&nbsp;<span class="ident" id="7401225">gold</span><span class="op" id="7401229">,</span>&nbsp;<span class="ident" id="7401231">test</span><span class="op" id="7401235">.</span><span class="ident" id="7401236">label</span><span class="op" id="7401241">,</span>&nbsp;<span class="ident" id="7401243">test</span><span class="op" id="7401247">.</span><span class="ident" id="7401248">limit</span><span class="op" id="7401253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401257">if</span>&nbsp;<span class="ident" id="7401260">testing</span><span class="op" id="7401267">.</span><span class="ident" id="7401268">Short</span><span class="op" id="7401273">(</span><span class="op" id="7401274">)</span>&nbsp;<span class="op" id="7401276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401281">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401289">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401292">}</span><br>
<span class="lineno"></span><span class="op" id="7401294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7401297">func</span>&nbsp;<span class="ident" id="7401302">TestReaderDict</span><span class="op" id="7401316">(</span><span class="ident" id="7401317">t</span>&nbsp;<span class="op" id="7401319">*</span><span class="ident" id="7401320">testing</span><span class="op" id="7401327">.</span><span class="ident" id="7401328">T</span><span class="op" id="7401329">)</span>&nbsp;<span class="op" id="7401331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401334">const</span>&nbsp;<span class="op" id="7401340">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401344">dict</span>&nbsp;<span class="op" id="7401349">=</span>&nbsp;<span class="string" id="7401351">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401367">text</span>&nbsp;<span class="op" id="7401372">=</span>&nbsp;<span class="string" id="7401374">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401398">var</span>&nbsp;<span class="ident" id="7401402">b</span>&nbsp;<span class="ident" id="7401404">bytes</span><span class="op" id="7401409">.</span><span class="ident" id="7401410">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401418">w</span><span class="op" id="7401419">,</span>&nbsp;<span class="ident" id="7401421">err</span>&nbsp;<span class="op" id="7401425">:=</span>&nbsp;<span class="ident" id="7401428">NewWriter</span><span class="op" id="7401437">(</span><span class="op" id="7401438">&amp;</span><span class="ident" id="7401439">b</span><span class="op" id="7401440">,</span>&nbsp;<span class="num" id="7401442">5</span><span class="op" id="7401443">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401446">if</span>&nbsp;<span class="ident" id="7401449">err</span>&nbsp;<span class="op" id="7401453">!=</span>&nbsp;<span class="ident" id="7401456">nil</span>&nbsp;<span class="op" id="7401460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401464">t</span><span class="op" id="7401465">.</span><span class="ident" id="7401466">Fatalf</span><span class="op" id="7401472">(</span><span class="string" id="7401473">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7401488">,</span>&nbsp;<span class="ident" id="7401490">err</span><span class="op" id="7401493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401499">w</span><span class="op" id="7401500">.</span><span class="ident" id="7401501">Write</span><span class="op" id="7401506">(</span><span class="op" id="7401507">[</span><span class="op" id="7401508">]</span><span class="builtintype" id="7401509">byte</span><span class="op" id="7401513">(</span><span class="ident" id="7401514">dict</span><span class="op" id="7401518">)</span><span class="op" id="7401519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401522">w</span><span class="op" id="7401523">.</span><span class="ident" id="7401524">Flush</span><span class="op" id="7401529">(</span><span class="op" id="7401530">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401533">b</span><span class="op" id="7401534">.</span><span class="ident" id="7401535">Reset</span><span class="op" id="7401540">(</span><span class="op" id="7401541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401544">w</span><span class="op" id="7401545">.</span><span class="ident" id="7401546">Write</span><span class="op" id="7401551">(</span><span class="op" id="7401552">[</span><span class="op" id="7401553">]</span><span class="builtintype" id="7401554">byte</span><span class="op" id="7401558">(</span><span class="ident" id="7401559">text</span><span class="op" id="7401563">)</span><span class="op" id="7401564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401567">w</span><span class="op" id="7401568">.</span><span class="ident" id="7401569">Close</span><span class="op" id="7401574">(</span><span class="op" id="7401575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401579">r</span>&nbsp;<span class="op" id="7401581">:=</span>&nbsp;<span class="ident" id="7401584">NewReaderDict</span><span class="op" id="7401597">(</span><span class="op" id="7401598">&amp;</span><span class="ident" id="7401599">b</span><span class="op" id="7401600">,</span>&nbsp;<span class="op" id="7401602">[</span><span class="op" id="7401603">]</span><span class="builtintype" id="7401604">byte</span><span class="op" id="7401608">(</span><span class="ident" id="7401609">dict</span><span class="op" id="7401613">)</span><span class="op" id="7401614">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401617">data</span><span class="op" id="7401621">,</span>&nbsp;<span class="ident" id="7401623">err</span>&nbsp;<span class="op" id="7401627">:=</span>&nbsp;<span class="ident" id="7401630">ioutil</span><span class="op" id="7401636">.</span><span class="ident" id="7401637">ReadAll</span><span class="op" id="7401644">(</span><span class="ident" id="7401645">r</span><span class="op" id="7401646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401649">if</span>&nbsp;<span class="ident" id="7401652">err</span>&nbsp;<span class="op" id="7401656">!=</span>&nbsp;<span class="ident" id="7401659">nil</span>&nbsp;<span class="op" id="7401663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401667">t</span><span class="op" id="7401668">.</span><span class="ident" id="7401669">Fatal</span><span class="op" id="7401674">(</span><span class="ident" id="7401675">err</span><span class="op" id="7401678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401684">if</span>&nbsp;<span class="builtintype" id="7401687">string</span><span class="op" id="7401693">(</span><span class="ident" id="7401694">data</span><span class="op" id="7401698">)</span>&nbsp;<span class="op" id="7401700">!=</span>&nbsp;<span class="string" id="7401703">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="7401723">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401727">t</span><span class="op" id="7401728">.</span><span class="ident" id="7401729">Fatalf</span><span class="op" id="7401735">(</span><span class="string" id="7401736">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7401762">,</span>&nbsp;<span class="builtintype" id="7401764">string</span><span class="op" id="7401770">(</span><span class="ident" id="7401771">data</span><span class="op" id="7401775">)</span><span class="op" id="7401776">,</span>&nbsp;<span class="ident" id="7401778">text</span><span class="op" id="7401782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401785">}</span><br>
<span class="lineno"></span><span class="op" id="7401787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7401790">func</span>&nbsp;<span class="ident" id="7401795">TestWriterDict</span><span class="op" id="7401809">(</span><span class="ident" id="7401810">t</span>&nbsp;<span class="op" id="7401812">*</span><span class="ident" id="7401813">testing</span><span class="op" id="7401820">.</span><span class="ident" id="7401821">T</span><span class="op" id="7401822">)</span>&nbsp;<span class="op" id="7401824">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401827">const</span>&nbsp;<span class="op" id="7401833">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401837">dict</span>&nbsp;<span class="op" id="7401842">=</span>&nbsp;<span class="string" id="7401844">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401860">text</span>&nbsp;<span class="op" id="7401865">=</span>&nbsp;<span class="string" id="7401867">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401891">var</span>&nbsp;<span class="ident" id="7401895">b</span>&nbsp;<span class="ident" id="7401897">bytes</span><span class="op" id="7401902">.</span><span class="ident" id="7401903">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401911">w</span><span class="op" id="7401912">,</span>&nbsp;<span class="ident" id="7401914">err</span>&nbsp;<span class="op" id="7401918">:=</span>&nbsp;<span class="ident" id="7401921">NewWriter</span><span class="op" id="7401930">(</span><span class="op" id="7401931">&amp;</span><span class="ident" id="7401932">b</span><span class="op" id="7401933">,</span>&nbsp;<span class="num" id="7401935">5</span><span class="op" id="7401936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7401939">if</span>&nbsp;<span class="ident" id="7401942">err</span>&nbsp;<span class="op" id="7401946">!=</span>&nbsp;<span class="ident" id="7401949">nil</span>&nbsp;<span class="op" id="7401953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401957">t</span><span class="op" id="7401958">.</span><span class="ident" id="7401959">Fatalf</span><span class="op" id="7401965">(</span><span class="string" id="7401966">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7401981">,</span>&nbsp;<span class="ident" id="7401983">err</span><span class="op" id="7401986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7401989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7401992">w</span><span class="op" id="7401993">.</span><span class="ident" id="7401994">Write</span><span class="op" id="7401999">(</span><span class="op" id="7402000">[</span><span class="op" id="7402001">]</span><span class="builtintype" id="7402002">byte</span><span class="op" id="7402006">(</span><span class="ident" id="7402007">dict</span><span class="op" id="7402011">)</span><span class="op" id="7402012">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402015">w</span><span class="op" id="7402016">.</span><span class="ident" id="7402017">Flush</span><span class="op" id="7402022">(</span><span class="op" id="7402023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402026">b</span><span class="op" id="7402027">.</span><span class="ident" id="7402028">Reset</span><span class="op" id="7402033">(</span><span class="op" id="7402034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402037">w</span><span class="op" id="7402038">.</span><span class="ident" id="7402039">Write</span><span class="op" id="7402044">(</span><span class="op" id="7402045">[</span><span class="op" id="7402046">]</span><span class="builtintype" id="7402047">byte</span><span class="op" id="7402051">(</span><span class="ident" id="7402052">text</span><span class="op" id="7402056">)</span><span class="op" id="7402057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402060">w</span><span class="op" id="7402061">.</span><span class="ident" id="7402062">Close</span><span class="op" id="7402067">(</span><span class="op" id="7402068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402072">var</span>&nbsp;<span class="ident" id="7402076">b1</span>&nbsp;<span class="ident" id="7402079">bytes</span><span class="op" id="7402084">.</span><span class="ident" id="7402085">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402093">w</span><span class="op" id="7402094">,</span>&nbsp;<span class="ident" id="7402096">_</span>&nbsp;<span class="op" id="7402098">=</span>&nbsp;<span class="ident" id="7402100">NewWriterDict</span><span class="op" id="7402113">(</span><span class="op" id="7402114">&amp;</span><span class="ident" id="7402115">b1</span><span class="op" id="7402117">,</span>&nbsp;<span class="num" id="7402119">5</span><span class="op" id="7402120">,</span>&nbsp;<span class="op" id="7402122">[</span><span class="op" id="7402123">]</span><span class="builtintype" id="7402124">byte</span><span class="op" id="7402128">(</span><span class="ident" id="7402129">dict</span><span class="op" id="7402133">)</span><span class="op" id="7402134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402137">w</span><span class="op" id="7402138">.</span><span class="ident" id="7402139">Write</span><span class="op" id="7402144">(</span><span class="op" id="7402145">[</span><span class="op" id="7402146">]</span><span class="builtintype" id="7402147">byte</span><span class="op" id="7402151">(</span><span class="ident" id="7402152">text</span><span class="op" id="7402156">)</span><span class="op" id="7402157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402160">w</span><span class="op" id="7402161">.</span><span class="ident" id="7402162">Close</span><span class="op" id="7402167">(</span><span class="op" id="7402168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402172">if</span>&nbsp;<span class="op" id="7402175">!</span><span class="ident" id="7402176">bytes</span><span class="op" id="7402181">.</span><span class="ident" id="7402182">Equal</span><span class="op" id="7402187">(</span><span class="ident" id="7402188">b1</span><span class="op" id="7402190">.</span><span class="ident" id="7402191">Bytes</span><span class="op" id="7402196">(</span><span class="op" id="7402197">)</span><span class="op" id="7402198">,</span>&nbsp;<span class="ident" id="7402200">b</span><span class="op" id="7402201">.</span><span class="ident" id="7402202">Bytes</span><span class="op" id="7402207">(</span><span class="op" id="7402208">)</span><span class="op" id="7402209">)</span>&nbsp;<span class="op" id="7402211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402215">t</span><span class="op" id="7402216">.</span><span class="ident" id="7402217">Fatalf</span><span class="op" id="7402223">(</span><span class="string" id="7402224">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7402249">,</span>&nbsp;<span class="ident" id="7402251">b1</span><span class="op" id="7402253">.</span><span class="ident" id="7402254">Bytes</span><span class="op" id="7402259">(</span><span class="op" id="7402260">)</span><span class="op" id="7402261">,</span>&nbsp;<span class="ident" id="7402263">b</span><span class="op" id="7402264">.</span><span class="ident" id="7402265">Bytes</span><span class="op" id="7402270">(</span><span class="op" id="7402271">)</span><span class="op" id="7402272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402275">}</span><br>
<span class="lineno"></span><span class="op" id="7402277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7402280">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="7402337">func</span>&nbsp;<span class="ident" id="7402342">TestRegression2508</span><span class="op" id="7402360">(</span><span class="ident" id="7402361">t</span>&nbsp;<span class="op" id="7402363">*</span><span class="ident" id="7402364">testing</span><span class="op" id="7402371">.</span><span class="ident" id="7402372">T</span><span class="op" id="7402373">)</span>&nbsp;<span class="op" id="7402375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402378">if</span>&nbsp;<span class="ident" id="7402381">testing</span><span class="op" id="7402388">.</span><span class="ident" id="7402389">Short</span><span class="op" id="7402394">(</span><span class="op" id="7402395">)</span>&nbsp;<span class="op" id="7402397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402401">t</span><span class="op" id="7402402">.</span><span class="ident" id="7402403">Logf</span><span class="op" id="7402407">(</span><span class="string" id="7402408">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="7402435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402439">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402450">w</span><span class="op" id="7402451">,</span>&nbsp;<span class="ident" id="7402453">err</span>&nbsp;<span class="op" id="7402457">:=</span>&nbsp;<span class="ident" id="7402460">NewWriter</span><span class="op" id="7402469">(</span><span class="ident" id="7402470">ioutil</span><span class="op" id="7402476">.</span><span class="ident" id="7402477">Discard</span><span class="op" id="7402484">,</span>&nbsp;<span class="num" id="7402486">1</span><span class="op" id="7402487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402490">if</span>&nbsp;<span class="ident" id="7402493">err</span>&nbsp;<span class="op" id="7402497">!=</span>&nbsp;<span class="ident" id="7402500">nil</span>&nbsp;<span class="op" id="7402504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402508">t</span><span class="op" id="7402509">.</span><span class="ident" id="7402510">Fatalf</span><span class="op" id="7402516">(</span><span class="string" id="7402517">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7402532">,</span>&nbsp;<span class="ident" id="7402534">err</span><span class="op" id="7402537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402540">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402543">buf</span>&nbsp;<span class="op" id="7402547">:=</span>&nbsp;<span class="builtinfunc" id="7402550">make</span><span class="op" id="7402554">(</span><span class="op" id="7402555">[</span><span class="op" id="7402556">]</span><span class="builtintype" id="7402557">byte</span><span class="op" id="7402561">,</span>&nbsp;<span class="num" id="7402563">1024</span><span class="op" id="7402567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402570">for</span>&nbsp;<span class="ident" id="7402574">i</span>&nbsp;<span class="op" id="7402576">:=</span>&nbsp;<span class="num" id="7402579">0</span><span class="op" id="7402580">;</span>&nbsp;<span class="ident" id="7402582">i</span>&nbsp;<span class="op" id="7402584">&lt;</span>&nbsp;<span class="num" id="7402586">131072</span><span class="op" id="7402592">;</span>&nbsp;<span class="ident" id="7402594">i</span><span class="op" id="7402595">++</span>&nbsp;<span class="op" id="7402598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402602">if</span>&nbsp;<span class="ident" id="7402605">_</span><span class="op" id="7402606">,</span>&nbsp;<span class="ident" id="7402608">err</span>&nbsp;<span class="op" id="7402612">:=</span>&nbsp;<span class="ident" id="7402615">w</span><span class="op" id="7402616">.</span><span class="ident" id="7402617">Write</span><span class="op" id="7402622">(</span><span class="ident" id="7402623">buf</span><span class="op" id="7402626">)</span><span class="op" id="7402627">;</span>&nbsp;<span class="ident" id="7402629">err</span>&nbsp;<span class="op" id="7402633">!=</span>&nbsp;<span class="ident" id="7402636">nil</span>&nbsp;<span class="op" id="7402640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402645">t</span><span class="op" id="7402646">.</span><span class="ident" id="7402647">Fatalf</span><span class="op" id="7402653">(</span><span class="string" id="7402654">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7402673">,</span>&nbsp;<span class="ident" id="7402675">err</span><span class="op" id="7402678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402682">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402688">w</span><span class="op" id="7402689">.</span><span class="ident" id="7402690">Close</span><span class="op" id="7402695">(</span><span class="op" id="7402696">)</span><br>
<span class="lineno"></span><span class="op" id="7402698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7402701">func</span>&nbsp;<span class="ident" id="7402706">TestWriterReset</span><span class="op" id="7402721">(</span><span class="ident" id="7402722">t</span>&nbsp;<span class="op" id="7402724">*</span><span class="ident" id="7402725">testing</span><span class="op" id="7402732">.</span><span class="ident" id="7402733">T</span><span class="op" id="7402734">)</span>&nbsp;<span class="op" id="7402736">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402739">for</span>&nbsp;<span class="ident" id="7402743">level</span>&nbsp;<span class="op" id="7402749">:=</span>&nbsp;<span class="num" id="7402752">0</span><span class="op" id="7402753">;</span>&nbsp;<span class="ident" id="7402755">level</span>&nbsp;<span class="op" id="7402761">&lt;=</span>&nbsp;<span class="num" id="7402764">9</span><span class="op" id="7402765">;</span>&nbsp;<span class="ident" id="7402767">level</span><span class="op" id="7402772">++</span>&nbsp;<span class="op" id="7402775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402779">if</span>&nbsp;<span class="ident" id="7402782">testing</span><span class="op" id="7402789">.</span><span class="ident" id="7402790">Short</span><span class="op" id="7402795">(</span><span class="op" id="7402796">)</span>&nbsp;<span class="op" id="7402798">&amp;&amp;</span>&nbsp;<span class="ident" id="7402801">level</span>&nbsp;<span class="op" id="7402807">&gt;</span>&nbsp;<span class="num" id="7402809">1</span>&nbsp;<span class="op" id="7402811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402816">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402828">w</span><span class="op" id="7402829">,</span>&nbsp;<span class="ident" id="7402831">err</span>&nbsp;<span class="op" id="7402835">:=</span>&nbsp;<span class="ident" id="7402838">NewWriter</span><span class="op" id="7402847">(</span><span class="ident" id="7402848">ioutil</span><span class="op" id="7402854">.</span><span class="ident" id="7402855">Discard</span><span class="op" id="7402862">,</span>&nbsp;<span class="ident" id="7402864">level</span><span class="op" id="7402869">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402873">if</span>&nbsp;<span class="ident" id="7402876">err</span>&nbsp;<span class="op" id="7402880">!=</span>&nbsp;<span class="ident" id="7402883">nil</span>&nbsp;<span class="op" id="7402887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402892">t</span><span class="op" id="7402893">.</span><span class="ident" id="7402894">Fatalf</span><span class="op" id="7402900">(</span><span class="string" id="7402901">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7402916">,</span>&nbsp;<span class="ident" id="7402918">err</span><span class="op" id="7402921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7402925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402929">buf</span>&nbsp;<span class="op" id="7402933">:=</span>&nbsp;<span class="op" id="7402936">[</span><span class="op" id="7402937">]</span><span class="builtintype" id="7402938">byte</span><span class="op" id="7402942">(</span><span class="string" id="7402943">&#34;hello&nbsp;world&#34;</span><span class="op" id="7402956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7402960">for</span>&nbsp;<span class="ident" id="7402964">i</span>&nbsp;<span class="op" id="7402966">:=</span>&nbsp;<span class="num" id="7402969">0</span><span class="op" id="7402970">;</span>&nbsp;<span class="ident" id="7402972">i</span>&nbsp;<span class="op" id="7402974">&lt;</span>&nbsp;<span class="num" id="7402976">1024</span><span class="op" id="7402980">;</span>&nbsp;<span class="ident" id="7402982">i</span><span class="op" id="7402983">++</span>&nbsp;<span class="op" id="7402986">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7402991">w</span><span class="op" id="7402992">.</span><span class="ident" id="7402993">Write</span><span class="op" id="7402998">(</span><span class="ident" id="7402999">buf</span><span class="op" id="7403002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7403006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403010">w</span><span class="op" id="7403011">.</span><span class="ident" id="7403012">Reset</span><span class="op" id="7403017">(</span><span class="ident" id="7403018">ioutil</span><span class="op" id="7403024">.</span><span class="ident" id="7403025">Discard</span><span class="op" id="7403032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403037">wref</span><span class="op" id="7403041">,</span>&nbsp;<span class="ident" id="7403043">err</span>&nbsp;<span class="op" id="7403047">:=</span>&nbsp;<span class="ident" id="7403050">NewWriter</span><span class="op" id="7403059">(</span><span class="ident" id="7403060">ioutil</span><span class="op" id="7403066">.</span><span class="ident" id="7403067">Discard</span><span class="op" id="7403074">,</span>&nbsp;<span class="ident" id="7403076">level</span><span class="op" id="7403081">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403085">if</span>&nbsp;<span class="ident" id="7403088">err</span>&nbsp;<span class="op" id="7403092">!=</span>&nbsp;<span class="ident" id="7403095">nil</span>&nbsp;<span class="op" id="7403099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403104">t</span><span class="op" id="7403105">.</span><span class="ident" id="7403106">Fatalf</span><span class="op" id="7403112">(</span><span class="string" id="7403113">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7403128">,</span>&nbsp;<span class="ident" id="7403130">err</span><span class="op" id="7403133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7403137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7403142">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403184">w</span><span class="op" id="7403185">.</span><span class="ident" id="7403186">d</span><span class="op" id="7403187">.</span><span class="ident" id="7403188">fill</span><span class="op" id="7403192">,</span>&nbsp;<span class="ident" id="7403194">wref</span><span class="op" id="7403198">.</span><span class="ident" id="7403199">d</span><span class="op" id="7403200">.</span><span class="ident" id="7403201">fill</span>&nbsp;<span class="op" id="7403206">=</span>&nbsp;<span class="ident" id="7403208">nil</span><span class="op" id="7403211">,</span>&nbsp;<span class="ident" id="7403213">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403219">w</span><span class="op" id="7403220">.</span><span class="ident" id="7403221">d</span><span class="op" id="7403222">.</span><span class="ident" id="7403223">step</span><span class="op" id="7403227">,</span>&nbsp;<span class="ident" id="7403229">wref</span><span class="op" id="7403233">.</span><span class="ident" id="7403234">d</span><span class="op" id="7403235">.</span><span class="ident" id="7403236">step</span>&nbsp;<span class="op" id="7403241">=</span>&nbsp;<span class="ident" id="7403243">nil</span><span class="op" id="7403246">,</span>&nbsp;<span class="ident" id="7403248">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7403254">if</span>&nbsp;<span class="op" id="7403257">!</span><span class="ident" id="7403258">reflect</span><span class="op" id="7403265">.</span><span class="ident" id="7403266">DeepEqual</span><span class="op" id="7403275">(</span><span class="ident" id="7403276">w</span><span class="op" id="7403277">,</span>&nbsp;<span class="ident" id="7403279">wref</span><span class="op" id="7403283">)</span>&nbsp;<span class="op" id="7403285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403290">t</span><span class="op" id="7403291">.</span><span class="ident" id="7403292">Errorf</span><span class="op" id="7403298">(</span><span class="string" id="7403299">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="7403338">,</span>&nbsp;<span class="ident" id="7403340">level</span><span class="op" id="7403345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7403349">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7403352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403355">testResetOutput</span><span class="op" id="7403370">(</span><span class="ident" id="7403371">t</span><span class="op" id="7403372">,</span>&nbsp;<span class="keyword" id="7403374">func</span><span class="op" id="7403378">(</span><span class="ident" id="7403379">w</span>&nbsp;<span class="ident" id="7403381">io</span><span class="op" id="7403383">.</span><span class="ident" id="7403384">Writer</span><span class="op" id="7403390">)</span>&nbsp;<span class="op" id="7403392">(</span><span class="op" id="7403393">*</span><span class="ident" id="7403394">Writer</span><span class="op" id="7403400">,</span>&nbsp;<span class="builtintype" id="7403402">error</span><span class="op" id="7403407">)</span>&nbsp;<span class="op" id="7403409">{</span>&nbsp;<span class="keyword" id="7403411">return</span>&nbsp;<span class="ident" id="7403418">NewWriter</span><span class="op" id="7403427">(</span><span class="ident" id="7403428">w</span><span class="op" id="7403429">,</span>&nbsp;<span class="ident" id="7403431">NoCompression</span><span class="op" id="7403444">)</span>&nbsp;<span class="op" id="7403446">}</span><span class="op" id="7403447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403450">testResetOutput</span><span class="op" id="7403465">(</span><span class="ident" id="7403466">t</span><span class="op" id="7403467">,</span>&nbsp;<span class="keyword" id="7403469">func</span><span class="op" id="7403473">(</span><span class="ident" id="7403474">w</span>&nbsp;<span class="ident" id="7403476">io</span><span class="op" id="7403478">.</span><span class="ident" id="7403479">Writer</span><span class="op" id="7403485">)</span>&nbsp;<span class="op" id="7403487">(</span><span class="op" id="7403488">*</span><span class="ident" id="7403489">Writer</span><span class="op" id="7403495">,</span>&nbsp;<span class="builtintype" id="7403497">error</span><span class="op" id="7403502">)</span>&nbsp;<span class="op" id="7403504">{</span>&nbsp;<span class="keyword" id="7403506">return</span>&nbsp;<span class="ident" id="7403513">NewWriter</span><span class="op" id="7403522">(</span><span class="ident" id="7403523">w</span><span class="op" id="7403524">,</span>&nbsp;<span class="ident" id="7403526">DefaultCompression</span><span class="op" id="7403544">)</span>&nbsp;<span class="op" id="7403546">}</span><span class="op" id="7403547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403550">testResetOutput</span><span class="op" id="7403565">(</span><span class="ident" id="7403566">t</span><span class="op" id="7403567">,</span>&nbsp;<span class="keyword" id="7403569">func</span><span class="op" id="7403573">(</span><span class="ident" id="7403574">w</span>&nbsp;<span class="ident" id="7403576">io</span><span class="op" id="7403578">.</span><span class="ident" id="7403579">Writer</span><span class="op" id="7403585">)</span>&nbsp;<span class="op" id="7403587">(</span><span class="op" id="7403588">*</span><span class="ident" id="7403589">Writer</span><span class="op" id="7403595">,</span>&nbsp;<span class="builtintype" id="7403597">error</span><span class="op" id="7403602">)</span>&nbsp;<span class="op" id="7403604">{</span>&nbsp;<span class="keyword" id="7403606">return</span>&nbsp;<span class="ident" id="7403613">NewWriter</span><span class="op" id="7403622">(</span><span class="ident" id="7403623">w</span><span class="op" id="7403624">,</span>&nbsp;<span class="ident" id="7403626">BestCompression</span><span class="op" id="7403641">)</span>&nbsp;<span class="op" id="7403643">}</span><span class="op" id="7403644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403647">dict</span>&nbsp;<span class="op" id="7403652">:=</span>&nbsp;<span class="op" id="7403655">[</span><span class="op" id="7403656">]</span><span class="builtintype" id="7403657">byte</span><span class="op" id="7403661">(</span><span class="string" id="7403662">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="7403680">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403683">testResetOutput</span><span class="op" id="7403698">(</span><span class="ident" id="7403699">t</span><span class="op" id="7403700">,</span>&nbsp;<span class="keyword" id="7403702">func</span><span class="op" id="7403706">(</span><span class="ident" id="7403707">w</span>&nbsp;<span class="ident" id="7403709">io</span><span class="op" id="7403711">.</span><span class="ident" id="7403712">Writer</span><span class="op" id="7403718">)</span>&nbsp;<span class="op" id="7403720">(</span><span class="op" id="7403721">*</span><span class="ident" id="7403722">Writer</span><span class="op" id="7403728">,</span>&nbsp;<span class="builtintype" id="7403730">error</span><span class="op" id="7403735">)</span>&nbsp;<span class="op" id="7403737">{</span>&nbsp;<span class="keyword" id="7403739">return</span>&nbsp;<span class="ident" id="7403746">NewWriterDict</span><span class="op" id="7403759">(</span><span class="ident" id="7403760">w</span><span class="op" id="7403761">,</span>&nbsp;<span class="ident" id="7403763">NoCompression</span><span class="op" id="7403776">,</span>&nbsp;<span class="ident" id="7403778">dict</span><span class="op" id="7403782">)</span>&nbsp;<span class="op" id="7403784">}</span><span class="op" id="7403785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403788">testResetOutput</span><span class="op" id="7403803">(</span><span class="ident" id="7403804">t</span><span class="op" id="7403805">,</span>&nbsp;<span class="keyword" id="7403807">func</span><span class="op" id="7403811">(</span><span class="ident" id="7403812">w</span>&nbsp;<span class="ident" id="7403814">io</span><span class="op" id="7403816">.</span><span class="ident" id="7403817">Writer</span><span class="op" id="7403823">)</span>&nbsp;<span class="op" id="7403825">(</span><span class="op" id="7403826">*</span><span class="ident" id="7403827">Writer</span><span class="op" id="7403833">,</span>&nbsp;<span class="builtintype" id="7403835">error</span><span class="op" id="7403840">)</span>&nbsp;<span class="op" id="7403842">{</span>&nbsp;<span class="keyword" id="7403844">return</span>&nbsp;<span class="ident" id="7403851">NewWriterDict</span><span class="op" id="7403864">(</span><span class="ident" id="7403865">w</span><span class="op" id="7403866">,</span>&nbsp;<span class="ident" id="7403868">DefaultCompression</span><span class="op" id="7403886">,</span>&nbsp;<span class="ident" id="7403888">dict</span><span class="op" id="7403892">)</span>&nbsp;<span class="op" id="7403894">}</span><span class="op" id="7403895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7403898">testResetOutput</span><span class="op" id="7403913">(</span><span class="ident" id="7403914">t</span><span class="op" id="7403915">,</span>&nbsp;<span class="keyword" id="7403917">func</span><span class="op" id="7403921">(</span><span class="ident" id="7403922">w</span>&nbsp;<span class="ident" id="7403924">io</span><span class="op" id="7403926">.</span><span class="ident" id="7403927">Writer</span><span class="op" id="7403933">)</span>&nbsp;<span class="op" id="7403935">(</span><span class="op" id="7403936">*</span><span class="ident" id="7403937">Writer</span><span class="op" id="7403943">,</span>&nbsp;<span class="builtintype" id="7403945">error</span><span class="op" id="7403950">)</span>&nbsp;<span class="op" id="7403952">{</span>&nbsp;<span class="keyword" id="7403954">return</span>&nbsp;<span class="ident" id="7403961">NewWriterDict</span><span class="op" id="7403974">(</span><span class="ident" id="7403975">w</span><span class="op" id="7403976">,</span>&nbsp;<span class="ident" id="7403978">BestCompression</span><span class="op" id="7403993">,</span>&nbsp;<span class="ident" id="7403995">dict</span><span class="op" id="7403999">)</span>&nbsp;<span class="op" id="7404001">}</span><span class="op" id="7404002">)</span><br>
<span class="lineno"></span><span class="op" id="7404004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="7404007">func</span>&nbsp;<span class="ident" id="7404012">testResetOutput</span><span class="op" id="7404027">(</span><span class="ident" id="7404028">t</span>&nbsp;<span class="op" id="7404030">*</span><span class="ident" id="7404031">testing</span><span class="op" id="7404038">.</span><span class="ident" id="7404039">T</span><span class="op" id="7404040">,</span>&nbsp;<span class="ident" id="7404042">newWriter</span>&nbsp;<span class="keyword" id="7404052">func</span><span class="op" id="7404056">(</span><span class="ident" id="7404057">w</span>&nbsp;<span class="ident" id="7404059">io</span><span class="op" id="7404061">.</span><span class="ident" id="7404062">Writer</span><span class="op" id="7404068">)</span>&nbsp;<span class="op" id="7404070">(</span><span class="op" id="7404071">*</span><span class="ident" id="7404072">Writer</span><span class="op" id="7404078">,</span>&nbsp;<span class="builtintype" id="7404080">error</span><span class="op" id="7404085">)</span><span class="op" id="7404086">)</span>&nbsp;<span class="op" id="7404088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404091">buf</span>&nbsp;<span class="op" id="7404095">:=</span>&nbsp;<span class="builtinfunc" id="7404098">new</span><span class="op" id="7404101">(</span><span class="ident" id="7404102">bytes</span><span class="op" id="7404107">.</span><span class="ident" id="7404108">Buffer</span><span class="op" id="7404114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404117">w</span><span class="op" id="7404118">,</span>&nbsp;<span class="ident" id="7404120">err</span>&nbsp;<span class="op" id="7404124">:=</span>&nbsp;<span class="ident" id="7404127">newWriter</span><span class="op" id="7404136">(</span><span class="ident" id="7404137">buf</span><span class="op" id="7404140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404143">if</span>&nbsp;<span class="ident" id="7404146">err</span>&nbsp;<span class="op" id="7404150">!=</span>&nbsp;<span class="ident" id="7404153">nil</span>&nbsp;<span class="op" id="7404157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404161">t</span><span class="op" id="7404162">.</span><span class="ident" id="7404163">Fatalf</span><span class="op" id="7404169">(</span><span class="string" id="7404170">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7404185">,</span>&nbsp;<span class="ident" id="7404187">err</span><span class="op" id="7404190">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404196">b</span>&nbsp;<span class="op" id="7404198">:=</span>&nbsp;<span class="op" id="7404201">[</span><span class="op" id="7404202">]</span><span class="builtintype" id="7404203">byte</span><span class="op" id="7404207">(</span><span class="string" id="7404208">&#34;hello&nbsp;world&#34;</span><span class="op" id="7404221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404224">for</span>&nbsp;<span class="ident" id="7404228">i</span>&nbsp;<span class="op" id="7404230">:=</span>&nbsp;<span class="num" id="7404233">0</span><span class="op" id="7404234">;</span>&nbsp;<span class="ident" id="7404236">i</span>&nbsp;<span class="op" id="7404238">&lt;</span>&nbsp;<span class="num" id="7404240">1024</span><span class="op" id="7404244">;</span>&nbsp;<span class="ident" id="7404246">i</span><span class="op" id="7404247">++</span>&nbsp;<span class="op" id="7404250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404254">w</span><span class="op" id="7404255">.</span><span class="ident" id="7404256">Write</span><span class="op" id="7404261">(</span><span class="ident" id="7404262">b</span><span class="op" id="7404263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404266">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404269">w</span><span class="op" id="7404270">.</span><span class="ident" id="7404271">Close</span><span class="op" id="7404276">(</span><span class="op" id="7404277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404280">out1</span>&nbsp;<span class="op" id="7404285">:=</span>&nbsp;<span class="ident" id="7404288">buf</span><span class="op" id="7404291">.</span><span class="ident" id="7404292">String</span><span class="op" id="7404298">(</span><span class="op" id="7404299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404303">buf2</span>&nbsp;<span class="op" id="7404308">:=</span>&nbsp;<span class="builtinfunc" id="7404311">new</span><span class="op" id="7404314">(</span><span class="ident" id="7404315">bytes</span><span class="op" id="7404320">.</span><span class="ident" id="7404321">Buffer</span><span class="op" id="7404327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404330">w</span><span class="op" id="7404331">.</span><span class="ident" id="7404332">Reset</span><span class="op" id="7404337">(</span><span class="ident" id="7404338">buf2</span><span class="op" id="7404342">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404345">for</span>&nbsp;<span class="ident" id="7404349">i</span>&nbsp;<span class="op" id="7404351">:=</span>&nbsp;<span class="num" id="7404354">0</span><span class="op" id="7404355">;</span>&nbsp;<span class="ident" id="7404357">i</span>&nbsp;<span class="op" id="7404359">&lt;</span>&nbsp;<span class="num" id="7404361">1024</span><span class="op" id="7404365">;</span>&nbsp;<span class="ident" id="7404367">i</span><span class="op" id="7404368">++</span>&nbsp;<span class="op" id="7404371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404375">w</span><span class="op" id="7404376">.</span><span class="ident" id="7404377">Write</span><span class="op" id="7404382">(</span><span class="ident" id="7404383">b</span><span class="op" id="7404384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404390">w</span><span class="op" id="7404391">.</span><span class="ident" id="7404392">Close</span><span class="op" id="7404397">(</span><span class="op" id="7404398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404401">out2</span>&nbsp;<span class="op" id="7404406">:=</span>&nbsp;<span class="ident" id="7404409">buf2</span><span class="op" id="7404413">.</span><span class="ident" id="7404414">String</span><span class="op" id="7404420">(</span><span class="op" id="7404421">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7404425">if</span>&nbsp;<span class="ident" id="7404428">out1</span>&nbsp;<span class="op" id="7404433">!=</span>&nbsp;<span class="ident" id="7404436">out2</span>&nbsp;<span class="op" id="7404441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404445">t</span><span class="op" id="7404446">.</span><span class="ident" id="7404447">Errorf</span><span class="op" id="7404453">(</span><span class="string" id="7404454">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7404475">,</span>&nbsp;<span class="ident" id="7404477">out2</span><span class="op" id="7404481">,</span>&nbsp;<span class="ident" id="7404483">out1</span><span class="op" id="7404487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7404490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7404493">t</span><span class="op" id="7404494">.</span><span class="ident" id="7404495">Logf</span><span class="op" id="7404499">(</span><span class="string" id="7404500">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7404514">,</span>&nbsp;<span class="builtinfunc" id="7404516">len</span><span class="op" id="7404519">(</span><span class="ident" id="7404520">out1</span><span class="op" id="7404524">)</span><span class="op" id="7404525">)</span><br>
<span class="lineno">490</span><span class="op" id="7404527">}</span>
</div>
</body>
</html>
