<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6533218">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6533273">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6533327">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6533378">package</span>&nbsp;<span class="ident" id="6533386">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533391">import</span>&nbsp;<span class="op" id="6533398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533401">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533411">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533418">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533424">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533431">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533438">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533459">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533470">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533481">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533489">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533504">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533515">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6533522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533525">var</span>&nbsp;<span class="op" id="6533529">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533532">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533558">*</span><span class="ident" id="6533559">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533567">serverAddr</span><span class="op" id="6533577">,</span>&nbsp;<span class="ident" id="6533579">newServerAddr</span>&nbsp;<span class="builtintype" id="6533593">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533601">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6533627">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533635">once</span><span class="op" id="6533639">,</span>&nbsp;<span class="ident" id="6533641">newOnce</span><span class="op" id="6533648">,</span>&nbsp;<span class="ident" id="6533650">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6533661">sync</span><span class="op" id="6533665">.</span><span class="ident" id="6533666">Once</span><br>
<span class="lineno"></span><span class="op" id="6533671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533674">const</span>&nbsp;<span class="op" id="6533680">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533683">newHttpPath</span>&nbsp;<span class="op" id="6533695">=</span>&nbsp;<span class="string" id="6533697">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="6533704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533707">type</span>&nbsp;<span class="ident" id="6533712">Args</span>&nbsp;<span class="keyword" id="6533717">struct</span>&nbsp;<span class="op" id="6533724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533727">A</span><span class="op" id="6533728">,</span>&nbsp;<span class="ident" id="6533730">B</span>&nbsp;<span class="builtintype" id="6533732">int</span><br>
<span class="lineno">35</span><span class="op" id="6533736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533739">type</span>&nbsp;<span class="ident" id="6533744">Reply</span>&nbsp;<span class="keyword" id="6533750">struct</span>&nbsp;<span class="op" id="6533757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533760">C</span>&nbsp;<span class="builtintype" id="6533762">int</span><br>
<span class="lineno"></span><span class="op" id="6533766">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6533769">type</span>&nbsp;<span class="ident" id="6533774">Arith</span>&nbsp;<span class="builtintype" id="6533780">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6533785">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6533873">func</span>&nbsp;<span class="op" id="6533878">(</span><span class="ident" id="6533879">t</span>&nbsp;<span class="op" id="6533881">*</span><span class="ident" id="6533882">Arith</span><span class="op" id="6533887">)</span>&nbsp;<span class="ident" id="6533889">Add</span><span class="op" id="6533892">(</span><span class="ident" id="6533893">args</span>&nbsp;<span class="ident" id="6533898">Args</span><span class="op" id="6533902">,</span>&nbsp;<span class="ident" id="6533904">reply</span>&nbsp;<span class="op" id="6533910">*</span><span class="ident" id="6533911">Reply</span><span class="op" id="6533916">)</span>&nbsp;<span class="builtintype" id="6533918">error</span>&nbsp;<span class="op" id="6533924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533927">reply</span><span class="op" id="6533932">.</span><span class="ident" id="6533933">C</span>&nbsp;<span class="op" id="6533935">=</span>&nbsp;<span class="ident" id="6533937">args</span><span class="op" id="6533941">.</span><span class="ident" id="6533942">A</span>&nbsp;<span class="op" id="6533944">+</span>&nbsp;<span class="ident" id="6533946">args</span><span class="op" id="6533950">.</span><span class="ident" id="6533951">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533954">return</span>&nbsp;<span class="ident" id="6533961">nil</span><br>
<span class="lineno"></span><span class="op" id="6533965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6533968">func</span>&nbsp;<span class="op" id="6533973">(</span><span class="ident" id="6533974">t</span>&nbsp;<span class="op" id="6533976">*</span><span class="ident" id="6533977">Arith</span><span class="op" id="6533982">)</span>&nbsp;<span class="ident" id="6533984">Mul</span><span class="op" id="6533987">(</span><span class="ident" id="6533988">args</span>&nbsp;<span class="op" id="6533993">*</span><span class="ident" id="6533994">Args</span><span class="op" id="6533998">,</span>&nbsp;<span class="ident" id="6534000">reply</span>&nbsp;<span class="op" id="6534006">*</span><span class="ident" id="6534007">Reply</span><span class="op" id="6534012">)</span>&nbsp;<span class="builtintype" id="6534014">error</span>&nbsp;<span class="op" id="6534020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534023">reply</span><span class="op" id="6534028">.</span><span class="ident" id="6534029">C</span>&nbsp;<span class="op" id="6534031">=</span>&nbsp;<span class="ident" id="6534033">args</span><span class="op" id="6534037">.</span><span class="ident" id="6534038">A</span>&nbsp;<span class="op" id="6534040">*</span>&nbsp;<span class="ident" id="6534042">args</span><span class="op" id="6534046">.</span><span class="ident" id="6534047">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534050">return</span>&nbsp;<span class="ident" id="6534057">nil</span><br>
<span class="lineno"></span><span class="op" id="6534061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6534064">func</span>&nbsp;<span class="op" id="6534069">(</span><span class="ident" id="6534070">t</span>&nbsp;<span class="op" id="6534072">*</span><span class="ident" id="6534073">Arith</span><span class="op" id="6534078">)</span>&nbsp;<span class="ident" id="6534080">Div</span><span class="op" id="6534083">(</span><span class="ident" id="6534084">args</span>&nbsp;<span class="ident" id="6534089">Args</span><span class="op" id="6534093">,</span>&nbsp;<span class="ident" id="6534095">reply</span>&nbsp;<span class="op" id="6534101">*</span><span class="ident" id="6534102">Reply</span><span class="op" id="6534107">)</span>&nbsp;<span class="builtintype" id="6534109">error</span>&nbsp;<span class="op" id="6534115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534118">if</span>&nbsp;<span class="ident" id="6534121">args</span><span class="op" id="6534125">.</span><span class="ident" id="6534126">B</span>&nbsp;<span class="op" id="6534128">==</span>&nbsp;<span class="num" id="6534131">0</span>&nbsp;<span class="op" id="6534133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534137">return</span>&nbsp;<span class="ident" id="6534144">errors</span><span class="op" id="6534150">.</span><span class="ident" id="6534151">New</span><span class="op" id="6534154">(</span><span class="string" id="6534155">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6534171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534177">reply</span><span class="op" id="6534182">.</span><span class="ident" id="6534183">C</span>&nbsp;<span class="op" id="6534185">=</span>&nbsp;<span class="ident" id="6534187">args</span><span class="op" id="6534191">.</span><span class="ident" id="6534192">A</span>&nbsp;<span class="op" id="6534194">/</span>&nbsp;<span class="ident" id="6534196">args</span><span class="op" id="6534200">.</span><span class="ident" id="6534201">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534204">return</span>&nbsp;<span class="ident" id="6534211">nil</span><br>
<span class="lineno"></span><span class="op" id="6534215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534218">func</span>&nbsp;<span class="op" id="6534223">(</span><span class="ident" id="6534224">t</span>&nbsp;<span class="op" id="6534226">*</span><span class="ident" id="6534227">Arith</span><span class="op" id="6534232">)</span>&nbsp;<span class="ident" id="6534234">String</span><span class="op" id="6534240">(</span><span class="ident" id="6534241">args</span>&nbsp;<span class="op" id="6534246">*</span><span class="ident" id="6534247">Args</span><span class="op" id="6534251">,</span>&nbsp;<span class="ident" id="6534253">reply</span>&nbsp;<span class="op" id="6534259">*</span><span class="builtintype" id="6534260">string</span><span class="op" id="6534266">)</span>&nbsp;<span class="builtintype" id="6534268">error</span>&nbsp;<span class="op" id="6534274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534277">*</span><span class="ident" id="6534278">reply</span>&nbsp;<span class="op" id="6534284">=</span>&nbsp;<span class="ident" id="6534286">fmt</span><span class="op" id="6534289">.</span><span class="ident" id="6534290">Sprintf</span><span class="op" id="6534297">(</span><span class="string" id="6534298">&#34;%d+%d=%d&#34;</span><span class="op" id="6534308">,</span>&nbsp;<span class="ident" id="6534310">args</span><span class="op" id="6534314">.</span><span class="ident" id="6534315">A</span><span class="op" id="6534316">,</span>&nbsp;<span class="ident" id="6534318">args</span><span class="op" id="6534322">.</span><span class="ident" id="6534323">B</span><span class="op" id="6534324">,</span>&nbsp;<span class="ident" id="6534326">args</span><span class="op" id="6534330">.</span><span class="ident" id="6534331">A</span><span class="op" id="6534332">+</span><span class="ident" id="6534333">args</span><span class="op" id="6534337">.</span><span class="ident" id="6534338">B</span><span class="op" id="6534339">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534342">return</span>&nbsp;<span class="ident" id="6534349">nil</span><br>
<span class="lineno"></span><span class="op" id="6534353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534356">func</span>&nbsp;<span class="op" id="6534361">(</span><span class="ident" id="6534362">t</span>&nbsp;<span class="op" id="6534364">*</span><span class="ident" id="6534365">Arith</span><span class="op" id="6534370">)</span>&nbsp;<span class="ident" id="6534372">Scan</span><span class="op" id="6534376">(</span><span class="ident" id="6534377">args</span>&nbsp;<span class="builtintype" id="6534382">string</span><span class="op" id="6534388">,</span>&nbsp;<span class="ident" id="6534390">reply</span>&nbsp;<span class="op" id="6534396">*</span><span class="ident" id="6534397">Reply</span><span class="op" id="6534402">)</span>&nbsp;<span class="op" id="6534404">(</span><span class="ident" id="6534405">err</span>&nbsp;<span class="builtintype" id="6534409">error</span><span class="op" id="6534414">)</span>&nbsp;<span class="op" id="6534416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534419">_</span><span class="op" id="6534420">,</span>&nbsp;<span class="ident" id="6534422">err</span>&nbsp;<span class="op" id="6534426">=</span>&nbsp;<span class="ident" id="6534428">fmt</span><span class="op" id="6534431">.</span><span class="ident" id="6534432">Sscan</span><span class="op" id="6534437">(</span><span class="ident" id="6534438">args</span><span class="op" id="6534442">,</span>&nbsp;<span class="op" id="6534444">&amp;</span><span class="ident" id="6534445">reply</span><span class="op" id="6534450">.</span><span class="ident" id="6534451">C</span><span class="op" id="6534452">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534455">return</span><br>
<span class="lineno"></span><span class="op" id="6534462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534465">func</span>&nbsp;<span class="op" id="6534470">(</span><span class="ident" id="6534471">t</span>&nbsp;<span class="op" id="6534473">*</span><span class="ident" id="6534474">Arith</span><span class="op" id="6534479">)</span>&nbsp;<span class="ident" id="6534481">Error</span><span class="op" id="6534486">(</span><span class="ident" id="6534487">args</span>&nbsp;<span class="op" id="6534492">*</span><span class="ident" id="6534493">Args</span><span class="op" id="6534497">,</span>&nbsp;<span class="ident" id="6534499">reply</span>&nbsp;<span class="op" id="6534505">*</span><span class="ident" id="6534506">Reply</span><span class="op" id="6534511">)</span>&nbsp;<span class="builtintype" id="6534513">error</span>&nbsp;<span class="op" id="6534519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6534522">panic</span><span class="op" id="6534527">(</span><span class="string" id="6534528">&#34;ERROR&#34;</span><span class="op" id="6534535">)</span><br>
<span class="lineno">75</span><span class="op" id="6534537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534540">func</span>&nbsp;<span class="ident" id="6534545">listenTCP</span><span class="op" id="6534554">(</span><span class="op" id="6534555">)</span>&nbsp;<span class="op" id="6534557">(</span><span class="ident" id="6534558">net</span><span class="op" id="6534561">.</span><span class="ident" id="6534562">Listener</span><span class="op" id="6534570">,</span>&nbsp;<span class="builtintype" id="6534572">string</span><span class="op" id="6534578">)</span>&nbsp;<span class="op" id="6534580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534583">l</span><span class="op" id="6534584">,</span>&nbsp;<span class="ident" id="6534586">e</span>&nbsp;<span class="op" id="6534588">:=</span>&nbsp;<span class="ident" id="6534591">net</span><span class="op" id="6534594">.</span><span class="ident" id="6534595">Listen</span><span class="op" id="6534601">(</span><span class="string" id="6534602">&#34;tcp&#34;</span><span class="op" id="6534607">,</span>&nbsp;<span class="string" id="6534609">&#34;127.0.0.1:0&#34;</span><span class="op" id="6534622">)</span>&nbsp;<span class="comment" id="6534624">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534650">if</span>&nbsp;<span class="ident" id="6534653">e</span>&nbsp;<span class="op" id="6534655">!=</span>&nbsp;<span class="ident" id="6534658">nil</span>&nbsp;<span class="op" id="6534662">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534666">log</span><span class="op" id="6534669">.</span><span class="ident" id="6534670">Fatalf</span><span class="op" id="6534676">(</span><span class="string" id="6534677">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6534700">,</span>&nbsp;<span class="ident" id="6534702">e</span><span class="op" id="6534703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534709">return</span>&nbsp;<span class="ident" id="6534716">l</span><span class="op" id="6534717">,</span>&nbsp;<span class="ident" id="6534719">l</span><span class="op" id="6534720">.</span><span class="ident" id="6534721">Addr</span><span class="op" id="6534725">(</span><span class="op" id="6534726">)</span><span class="op" id="6534727">.</span><span class="ident" id="6534728">String</span><span class="op" id="6534734">(</span><span class="op" id="6534735">)</span><br>
<span class="lineno"></span><span class="op" id="6534737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="6534740">func</span>&nbsp;<span class="ident" id="6534745">startServer</span><span class="op" id="6534756">(</span><span class="op" id="6534757">)</span>&nbsp;<span class="op" id="6534759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534762">Register</span><span class="op" id="6534770">(</span><span class="builtinfunc" id="6534771">new</span><span class="op" id="6534774">(</span><span class="ident" id="6534775">Arith</span><span class="op" id="6534780">)</span><span class="op" id="6534781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534784">RegisterName</span><span class="op" id="6534796">(</span><span class="string" id="6534797">&#34;net.rpc.Arith&#34;</span><span class="op" id="6534812">,</span>&nbsp;<span class="builtinfunc" id="6534814">new</span><span class="op" id="6534817">(</span><span class="ident" id="6534818">Arith</span><span class="op" id="6534823">)</span><span class="op" id="6534824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534828">var</span>&nbsp;<span class="ident" id="6534832">l</span>&nbsp;<span class="ident" id="6534834">net</span><span class="op" id="6534837">.</span><span class="ident" id="6534838">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534848">l</span><span class="op" id="6534849">,</span>&nbsp;<span class="ident" id="6534851">serverAddr</span>&nbsp;<span class="op" id="6534862">=</span>&nbsp;<span class="ident" id="6534864">listenTCP</span><span class="op" id="6534873">(</span><span class="op" id="6534874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534877">log</span><span class="op" id="6534880">.</span><span class="ident" id="6534881">Println</span><span class="op" id="6534888">(</span><span class="string" id="6534889">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6534919">,</span>&nbsp;<span class="ident" id="6534921">serverAddr</span><span class="op" id="6534931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534934">go</span>&nbsp;<span class="ident" id="6534937">Accept</span><span class="op" id="6534943">(</span><span class="ident" id="6534944">l</span><span class="op" id="6534945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534949">HandleHTTP</span><span class="op" id="6534959">(</span><span class="op" id="6534960">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534963">httpOnce</span><span class="op" id="6534971">.</span><span class="ident" id="6534972">Do</span><span class="op" id="6534974">(</span><span class="ident" id="6534975">startHttpServer</span><span class="op" id="6534990">)</span><br>
<span class="lineno"></span><span class="op" id="6534992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534995">func</span>&nbsp;<span class="ident" id="6535000">startNewServer</span><span class="op" id="6535014">(</span><span class="op" id="6535015">)</span>&nbsp;<span class="op" id="6535017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535020">newServer</span>&nbsp;<span class="op" id="6535030">=</span>&nbsp;<span class="ident" id="6535032">NewServer</span><span class="op" id="6535041">(</span><span class="op" id="6535042">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535045">newServer</span><span class="op" id="6535054">.</span><span class="ident" id="6535055">Register</span><span class="op" id="6535063">(</span><span class="builtinfunc" id="6535064">new</span><span class="op" id="6535067">(</span><span class="ident" id="6535068">Arith</span><span class="op" id="6535073">)</span><span class="op" id="6535074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535077">newServer</span><span class="op" id="6535086">.</span><span class="ident" id="6535087">RegisterName</span><span class="op" id="6535099">(</span><span class="string" id="6535100">&#34;net.rpc.Arith&#34;</span><span class="op" id="6535115">,</span>&nbsp;<span class="builtinfunc" id="6535117">new</span><span class="op" id="6535120">(</span><span class="ident" id="6535121">Arith</span><span class="op" id="6535126">)</span><span class="op" id="6535127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535130">newServer</span><span class="op" id="6535139">.</span><span class="ident" id="6535140">RegisterName</span><span class="op" id="6535152">(</span><span class="string" id="6535153">&#34;newServer.Arith&#34;</span><span class="op" id="6535170">,</span>&nbsp;<span class="builtinfunc" id="6535172">new</span><span class="op" id="6535175">(</span><span class="ident" id="6535176">Arith</span><span class="op" id="6535181">)</span><span class="op" id="6535182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535186">var</span>&nbsp;<span class="ident" id="6535190">l</span>&nbsp;<span class="ident" id="6535192">net</span><span class="op" id="6535195">.</span><span class="ident" id="6535196">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535206">l</span><span class="op" id="6535207">,</span>&nbsp;<span class="ident" id="6535209">newServerAddr</span>&nbsp;<span class="op" id="6535223">=</span>&nbsp;<span class="ident" id="6535225">listenTCP</span><span class="op" id="6535234">(</span><span class="op" id="6535235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535238">log</span><span class="op" id="6535241">.</span><span class="ident" id="6535242">Println</span><span class="op" id="6535249">(</span><span class="string" id="6535250">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6535290">,</span>&nbsp;<span class="ident" id="6535292">newServerAddr</span><span class="op" id="6535305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535308">go</span>&nbsp;<span class="ident" id="6535311">newServer</span><span class="op" id="6535320">.</span><span class="ident" id="6535321">Accept</span><span class="op" id="6535327">(</span><span class="ident" id="6535328">l</span><span class="op" id="6535329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535333">newServer</span><span class="op" id="6535342">.</span><span class="ident" id="6535343">HandleHTTP</span><span class="op" id="6535353">(</span><span class="ident" id="6535354">newHttpPath</span><span class="op" id="6535365">,</span>&nbsp;<span class="string" id="6535367">&#34;/bar&#34;</span><span class="op" id="6535373">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535376">httpOnce</span><span class="op" id="6535384">.</span><span class="ident" id="6535385">Do</span><span class="op" id="6535387">(</span><span class="ident" id="6535388">startHttpServer</span><span class="op" id="6535403">)</span><br>
<span class="lineno"></span><span class="op" id="6535405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535408">func</span>&nbsp;<span class="ident" id="6535413">startHttpServer</span><span class="op" id="6535428">(</span><span class="op" id="6535429">)</span>&nbsp;<span class="op" id="6535431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535434">server</span>&nbsp;<span class="op" id="6535441">:=</span>&nbsp;<span class="ident" id="6535444">httptest</span><span class="op" id="6535452">.</span><span class="ident" id="6535453">NewServer</span><span class="op" id="6535462">(</span><span class="ident" id="6535463">nil</span><span class="op" id="6535466">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535469">httpServerAddr</span>&nbsp;<span class="op" id="6535484">=</span>&nbsp;<span class="ident" id="6535486">server</span><span class="op" id="6535492">.</span><span class="ident" id="6535493">Listener</span><span class="op" id="6535501">.</span><span class="ident" id="6535502">Addr</span><span class="op" id="6535506">(</span><span class="op" id="6535507">)</span><span class="op" id="6535508">.</span><span class="ident" id="6535509">String</span><span class="op" id="6535515">(</span><span class="op" id="6535516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535519">log</span><span class="op" id="6535522">.</span><span class="ident" id="6535523">Println</span><span class="op" id="6535530">(</span><span class="string" id="6535531">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6535566">,</span>&nbsp;<span class="ident" id="6535568">httpServerAddr</span><span class="op" id="6535582">)</span><br>
<span class="lineno"></span><span class="op" id="6535584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535587">func</span>&nbsp;<span class="ident" id="6535592">TestRPC</span><span class="op" id="6535599">(</span><span class="ident" id="6535600">t</span>&nbsp;<span class="op" id="6535602">*</span><span class="ident" id="6535603">testing</span><span class="op" id="6535610">.</span><span class="ident" id="6535611">T</span><span class="op" id="6535612">)</span>&nbsp;<span class="op" id="6535614">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535617">once</span><span class="op" id="6535621">.</span><span class="ident" id="6535622">Do</span><span class="op" id="6535624">(</span><span class="ident" id="6535625">startServer</span><span class="op" id="6535636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535639">testRPC</span><span class="op" id="6535646">(</span><span class="ident" id="6535647">t</span><span class="op" id="6535648">,</span>&nbsp;<span class="ident" id="6535650">serverAddr</span><span class="op" id="6535660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535663">newOnce</span><span class="op" id="6535670">.</span><span class="ident" id="6535671">Do</span><span class="op" id="6535673">(</span><span class="ident" id="6535674">startNewServer</span><span class="op" id="6535688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535691">testRPC</span><span class="op" id="6535698">(</span><span class="ident" id="6535699">t</span><span class="op" id="6535700">,</span>&nbsp;<span class="ident" id="6535702">newServerAddr</span><span class="op" id="6535715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535718">testNewServerRPC</span><span class="op" id="6535734">(</span><span class="ident" id="6535735">t</span><span class="op" id="6535736">,</span>&nbsp;<span class="ident" id="6535738">newServerAddr</span><span class="op" id="6535751">)</span><br>
<span class="lineno">125</span><span class="op" id="6535753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535756">func</span>&nbsp;<span class="ident" id="6535761">testRPC</span><span class="op" id="6535768">(</span><span class="ident" id="6535769">t</span>&nbsp;<span class="op" id="6535771">*</span><span class="ident" id="6535772">testing</span><span class="op" id="6535779">.</span><span class="ident" id="6535780">T</span><span class="op" id="6535781">,</span>&nbsp;<span class="ident" id="6535783">addr</span>&nbsp;<span class="builtintype" id="6535788">string</span><span class="op" id="6535794">)</span>&nbsp;<span class="op" id="6535796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535799">client</span><span class="op" id="6535805">,</span>&nbsp;<span class="ident" id="6535807">err</span>&nbsp;<span class="op" id="6535811">:=</span>&nbsp;<span class="ident" id="6535814">Dial</span><span class="op" id="6535818">(</span><span class="string" id="6535819">&#34;tcp&#34;</span><span class="op" id="6535824">,</span>&nbsp;<span class="ident" id="6535826">addr</span><span class="op" id="6535830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535833">if</span>&nbsp;<span class="ident" id="6535836">err</span>&nbsp;<span class="op" id="6535840">!=</span>&nbsp;<span class="ident" id="6535843">nil</span>&nbsp;<span class="op" id="6535847">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535851">t</span><span class="op" id="6535852">.</span><span class="ident" id="6535853">Fatal</span><span class="op" id="6535858">(</span><span class="string" id="6535859">&#34;dialing&#34;</span><span class="op" id="6535868">,</span>&nbsp;<span class="ident" id="6535870">err</span><span class="op" id="6535873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535879">defer</span>&nbsp;<span class="ident" id="6535885">client</span><span class="op" id="6535891">.</span><span class="ident" id="6535892">Close</span><span class="op" id="6535897">(</span><span class="op" id="6535898">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6535902">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535924">args</span>&nbsp;<span class="op" id="6535929">:=</span>&nbsp;<span class="op" id="6535932">&amp;</span><span class="ident" id="6535933">Args</span><span class="op" id="6535937">{</span><span class="num" id="6535938">7</span><span class="op" id="6535939">,</span>&nbsp;<span class="num" id="6535941">8</span><span class="op" id="6535942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535945">reply</span>&nbsp;<span class="op" id="6535951">:=</span>&nbsp;<span class="builtinfunc" id="6535954">new</span><span class="op" id="6535957">(</span><span class="ident" id="6535958">Reply</span><span class="op" id="6535963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535966">err</span>&nbsp;<span class="op" id="6535970">=</span>&nbsp;<span class="ident" id="6535972">client</span><span class="op" id="6535978">.</span><span class="ident" id="6535979">Call</span><span class="op" id="6535983">(</span><span class="string" id="6535984">&#34;Arith.Add&#34;</span><span class="op" id="6535995">,</span>&nbsp;<span class="ident" id="6535997">args</span><span class="op" id="6536001">,</span>&nbsp;<span class="ident" id="6536003">reply</span><span class="op" id="6536008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536011">if</span>&nbsp;<span class="ident" id="6536014">err</span>&nbsp;<span class="op" id="6536018">!=</span>&nbsp;<span class="ident" id="6536021">nil</span>&nbsp;<span class="op" id="6536025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536029">t</span><span class="op" id="6536030">.</span><span class="ident" id="6536031">Errorf</span><span class="op" id="6536037">(</span><span class="string" id="6536038">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6536080">,</span>&nbsp;<span class="ident" id="6536082">err</span><span class="op" id="6536085">.</span><span class="ident" id="6536086">Error</span><span class="op" id="6536091">(</span><span class="op" id="6536092">)</span><span class="op" id="6536093">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536099">if</span>&nbsp;<span class="ident" id="6536102">reply</span><span class="op" id="6536107">.</span><span class="ident" id="6536108">C</span>&nbsp;<span class="op" id="6536110">!=</span>&nbsp;<span class="ident" id="6536113">args</span><span class="op" id="6536117">.</span><span class="ident" id="6536118">A</span><span class="op" id="6536119">+</span><span class="ident" id="6536120">args</span><span class="op" id="6536124">.</span><span class="ident" id="6536125">B</span>&nbsp;<span class="op" id="6536127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536131">t</span><span class="op" id="6536132">.</span><span class="ident" id="6536133">Errorf</span><span class="op" id="6536139">(</span><span class="string" id="6536140">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6536165">,</span>&nbsp;<span class="ident" id="6536167">reply</span><span class="op" id="6536172">.</span><span class="ident" id="6536173">C</span><span class="op" id="6536174">,</span>&nbsp;<span class="ident" id="6536176">args</span><span class="op" id="6536180">.</span><span class="ident" id="6536181">A</span><span class="op" id="6536182">+</span><span class="ident" id="6536183">args</span><span class="op" id="6536187">.</span><span class="ident" id="6536188">B</span><span class="op" id="6536189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536196">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536219">args</span>&nbsp;<span class="op" id="6536224">=</span>&nbsp;<span class="op" id="6536226">&amp;</span><span class="ident" id="6536227">Args</span><span class="op" id="6536231">{</span><span class="num" id="6536232">7</span><span class="op" id="6536233">,</span>&nbsp;<span class="num" id="6536235">0</span><span class="op" id="6536236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536239">reply</span>&nbsp;<span class="op" id="6536245">=</span>&nbsp;<span class="builtinfunc" id="6536247">new</span><span class="op" id="6536250">(</span><span class="ident" id="6536251">Reply</span><span class="op" id="6536256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536259">err</span>&nbsp;<span class="op" id="6536263">=</span>&nbsp;<span class="ident" id="6536265">client</span><span class="op" id="6536271">.</span><span class="ident" id="6536272">Call</span><span class="op" id="6536276">(</span><span class="string" id="6536277">&#34;Arith.BadOperation&#34;</span><span class="op" id="6536297">,</span>&nbsp;<span class="ident" id="6536299">args</span><span class="op" id="6536303">,</span>&nbsp;<span class="ident" id="6536305">reply</span><span class="op" id="6536310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536313">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536333">if</span>&nbsp;<span class="ident" id="6536336">err</span>&nbsp;<span class="op" id="6536340">==</span>&nbsp;<span class="ident" id="6536343">nil</span>&nbsp;<span class="op" id="6536347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536351">t</span><span class="op" id="6536352">.</span><span class="ident" id="6536353">Error</span><span class="op" id="6536358">(</span><span class="string" id="6536359">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6536389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536392">}</span>&nbsp;<span class="keyword" id="6536394">else</span>&nbsp;<span class="keyword" id="6536399">if</span>&nbsp;<span class="op" id="6536402">!</span><span class="ident" id="6536403">strings</span><span class="op" id="6536410">.</span><span class="ident" id="6536411">HasPrefix</span><span class="op" id="6536420">(</span><span class="ident" id="6536421">err</span><span class="op" id="6536424">.</span><span class="ident" id="6536425">Error</span><span class="op" id="6536430">(</span><span class="op" id="6536431">)</span><span class="op" id="6536432">,</span>&nbsp;<span class="string" id="6536434">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="6536459">)</span>&nbsp;<span class="op" id="6536461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536465">t</span><span class="op" id="6536466">.</span><span class="ident" id="6536467">Errorf</span><span class="op" id="6536473">(</span><span class="string" id="6536474">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6536530">,</span>&nbsp;<span class="ident" id="6536532">err</span><span class="op" id="6536535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536538">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536542">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536562">args</span>&nbsp;<span class="op" id="6536567">=</span>&nbsp;<span class="op" id="6536569">&amp;</span><span class="ident" id="6536570">Args</span><span class="op" id="6536574">{</span><span class="num" id="6536575">7</span><span class="op" id="6536576">,</span>&nbsp;<span class="num" id="6536578">8</span><span class="op" id="6536579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536582">reply</span>&nbsp;<span class="op" id="6536588">=</span>&nbsp;<span class="builtinfunc" id="6536590">new</span><span class="op" id="6536593">(</span><span class="ident" id="6536594">Reply</span><span class="op" id="6536599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536602">err</span>&nbsp;<span class="op" id="6536606">=</span>&nbsp;<span class="ident" id="6536608">client</span><span class="op" id="6536614">.</span><span class="ident" id="6536615">Call</span><span class="op" id="6536619">(</span><span class="string" id="6536620">&#34;Arith.Unknown&#34;</span><span class="op" id="6536635">,</span>&nbsp;<span class="ident" id="6536637">args</span><span class="op" id="6536641">,</span>&nbsp;<span class="ident" id="6536643">reply</span><span class="op" id="6536648">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536651">if</span>&nbsp;<span class="ident" id="6536654">err</span>&nbsp;<span class="op" id="6536658">==</span>&nbsp;<span class="ident" id="6536661">nil</span>&nbsp;<span class="op" id="6536665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536669">t</span><span class="op" id="6536670">.</span><span class="ident" id="6536671">Error</span><span class="op" id="6536676">(</span><span class="string" id="6536677">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="6536717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536720">}</span>&nbsp;<span class="keyword" id="6536722">else</span>&nbsp;<span class="keyword" id="6536727">if</span>&nbsp;<span class="ident" id="6536730">strings</span><span class="op" id="6536737">.</span><span class="ident" id="6536738">Index</span><span class="op" id="6536743">(</span><span class="ident" id="6536744">err</span><span class="op" id="6536747">.</span><span class="ident" id="6536748">Error</span><span class="op" id="6536753">(</span><span class="op" id="6536754">)</span><span class="op" id="6536755">,</span>&nbsp;<span class="string" id="6536757">&#34;method&#34;</span><span class="op" id="6536765">)</span>&nbsp;<span class="op" id="6536767">&lt;</span>&nbsp;<span class="num" id="6536769">0</span>&nbsp;<span class="op" id="6536771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536775">t</span><span class="op" id="6536776">.</span><span class="ident" id="6536777">Error</span><span class="op" id="6536782">(</span><span class="string" id="6536783">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="6536817">,</span>&nbsp;<span class="ident" id="6536819">err</span><span class="op" id="6536822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536825">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536829">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536847">args</span>&nbsp;<span class="op" id="6536852">=</span>&nbsp;<span class="op" id="6536854">&amp;</span><span class="ident" id="6536855">Args</span><span class="op" id="6536859">{</span><span class="num" id="6536860">7</span><span class="op" id="6536861">,</span>&nbsp;<span class="num" id="6536863">8</span><span class="op" id="6536864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536867">mulReply</span>&nbsp;<span class="op" id="6536876">:=</span>&nbsp;<span class="builtinfunc" id="6536879">new</span><span class="op" id="6536882">(</span><span class="ident" id="6536883">Reply</span><span class="op" id="6536888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536891">mulCall</span>&nbsp;<span class="op" id="6536899">:=</span>&nbsp;<span class="ident" id="6536902">client</span><span class="op" id="6536908">.</span><span class="ident" id="6536909">Go</span><span class="op" id="6536911">(</span><span class="string" id="6536912">&#34;Arith.Mul&#34;</span><span class="op" id="6536923">,</span>&nbsp;<span class="ident" id="6536925">args</span><span class="op" id="6536929">,</span>&nbsp;<span class="ident" id="6536931">mulReply</span><span class="op" id="6536939">,</span>&nbsp;<span class="ident" id="6536941">nil</span><span class="op" id="6536944">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536947">addReply</span>&nbsp;<span class="op" id="6536956">:=</span>&nbsp;<span class="builtinfunc" id="6536959">new</span><span class="op" id="6536962">(</span><span class="ident" id="6536963">Reply</span><span class="op" id="6536968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536971">addCall</span>&nbsp;<span class="op" id="6536979">:=</span>&nbsp;<span class="ident" id="6536982">client</span><span class="op" id="6536988">.</span><span class="ident" id="6536989">Go</span><span class="op" id="6536991">(</span><span class="string" id="6536992">&#34;Arith.Add&#34;</span><span class="op" id="6537003">,</span>&nbsp;<span class="ident" id="6537005">args</span><span class="op" id="6537009">,</span>&nbsp;<span class="ident" id="6537011">addReply</span><span class="op" id="6537019">,</span>&nbsp;<span class="ident" id="6537021">nil</span><span class="op" id="6537024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537028">addCall</span>&nbsp;<span class="op" id="6537036">=</span>&nbsp;<span class="op" id="6537038">&lt;-</span><span class="ident" id="6537040">addCall</span><span class="op" id="6537047">.</span><span class="ident" id="6537048">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537054">if</span>&nbsp;<span class="ident" id="6537057">addCall</span><span class="op" id="6537064">.</span><span class="ident" id="6537065">Error</span>&nbsp;<span class="op" id="6537071">!=</span>&nbsp;<span class="ident" id="6537074">nil</span>&nbsp;<span class="op" id="6537078">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537082">t</span><span class="op" id="6537083">.</span><span class="ident" id="6537084">Errorf</span><span class="op" id="6537090">(</span><span class="string" id="6537091">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6537133">,</span>&nbsp;<span class="ident" id="6537135">addCall</span><span class="op" id="6537142">.</span><span class="ident" id="6537143">Error</span><span class="op" id="6537148">.</span><span class="ident" id="6537149">Error</span><span class="op" id="6537154">(</span><span class="op" id="6537155">)</span><span class="op" id="6537156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537162">if</span>&nbsp;<span class="ident" id="6537165">addReply</span><span class="op" id="6537173">.</span><span class="ident" id="6537174">C</span>&nbsp;<span class="op" id="6537176">!=</span>&nbsp;<span class="ident" id="6537179">args</span><span class="op" id="6537183">.</span><span class="ident" id="6537184">A</span><span class="op" id="6537185">+</span><span class="ident" id="6537186">args</span><span class="op" id="6537190">.</span><span class="ident" id="6537191">B</span>&nbsp;<span class="op" id="6537193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537197">t</span><span class="op" id="6537198">.</span><span class="ident" id="6537199">Errorf</span><span class="op" id="6537205">(</span><span class="string" id="6537206">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6537231">,</span>&nbsp;<span class="ident" id="6537233">addReply</span><span class="op" id="6537241">.</span><span class="ident" id="6537242">C</span><span class="op" id="6537243">,</span>&nbsp;<span class="ident" id="6537245">args</span><span class="op" id="6537249">.</span><span class="ident" id="6537250">A</span><span class="op" id="6537251">+</span><span class="ident" id="6537252">args</span><span class="op" id="6537256">.</span><span class="ident" id="6537257">B</span><span class="op" id="6537258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537261">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537265">mulCall</span>&nbsp;<span class="op" id="6537273">=</span>&nbsp;<span class="op" id="6537275">&lt;-</span><span class="ident" id="6537277">mulCall</span><span class="op" id="6537284">.</span><span class="ident" id="6537285">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537291">if</span>&nbsp;<span class="ident" id="6537294">mulCall</span><span class="op" id="6537301">.</span><span class="ident" id="6537302">Error</span>&nbsp;<span class="op" id="6537308">!=</span>&nbsp;<span class="ident" id="6537311">nil</span>&nbsp;<span class="op" id="6537315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537319">t</span><span class="op" id="6537320">.</span><span class="ident" id="6537321">Errorf</span><span class="op" id="6537327">(</span><span class="string" id="6537328">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6537370">,</span>&nbsp;<span class="ident" id="6537372">mulCall</span><span class="op" id="6537379">.</span><span class="ident" id="6537380">Error</span><span class="op" id="6537385">.</span><span class="ident" id="6537386">Error</span><span class="op" id="6537391">(</span><span class="op" id="6537392">)</span><span class="op" id="6537393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537396">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537399">if</span>&nbsp;<span class="ident" id="6537402">mulReply</span><span class="op" id="6537410">.</span><span class="ident" id="6537411">C</span>&nbsp;<span class="op" id="6537413">!=</span>&nbsp;<span class="ident" id="6537416">args</span><span class="op" id="6537420">.</span><span class="ident" id="6537421">A</span><span class="op" id="6537422">*</span><span class="ident" id="6537423">args</span><span class="op" id="6537427">.</span><span class="ident" id="6537428">B</span>&nbsp;<span class="op" id="6537430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537434">t</span><span class="op" id="6537435">.</span><span class="ident" id="6537436">Errorf</span><span class="op" id="6537442">(</span><span class="string" id="6537443">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6537468">,</span>&nbsp;<span class="ident" id="6537470">mulReply</span><span class="op" id="6537478">.</span><span class="ident" id="6537479">C</span><span class="op" id="6537480">,</span>&nbsp;<span class="ident" id="6537482">args</span><span class="op" id="6537486">.</span><span class="ident" id="6537487">A</span><span class="op" id="6537488">*</span><span class="ident" id="6537489">args</span><span class="op" id="6537493">.</span><span class="ident" id="6537494">B</span><span class="op" id="6537495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537502">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537517">args</span>&nbsp;<span class="op" id="6537522">=</span>&nbsp;<span class="op" id="6537524">&amp;</span><span class="ident" id="6537525">Args</span><span class="op" id="6537529">{</span><span class="num" id="6537530">7</span><span class="op" id="6537531">,</span>&nbsp;<span class="num" id="6537533">0</span><span class="op" id="6537534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537537">reply</span>&nbsp;<span class="op" id="6537543">=</span>&nbsp;<span class="builtinfunc" id="6537545">new</span><span class="op" id="6537548">(</span><span class="ident" id="6537549">Reply</span><span class="op" id="6537554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537557">err</span>&nbsp;<span class="op" id="6537561">=</span>&nbsp;<span class="ident" id="6537563">client</span><span class="op" id="6537569">.</span><span class="ident" id="6537570">Call</span><span class="op" id="6537574">(</span><span class="string" id="6537575">&#34;Arith.Div&#34;</span><span class="op" id="6537586">,</span>&nbsp;<span class="ident" id="6537588">args</span><span class="op" id="6537592">,</span>&nbsp;<span class="ident" id="6537594">reply</span><span class="op" id="6537599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537602">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537635">if</span>&nbsp;<span class="ident" id="6537638">err</span>&nbsp;<span class="op" id="6537642">==</span>&nbsp;<span class="ident" id="6537645">nil</span>&nbsp;<span class="op" id="6537649">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537653">t</span><span class="op" id="6537654">.</span><span class="ident" id="6537655">Error</span><span class="op" id="6537660">(</span><span class="string" id="6537661">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6537682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537685">}</span>&nbsp;<span class="keyword" id="6537687">else</span>&nbsp;<span class="keyword" id="6537692">if</span>&nbsp;<span class="ident" id="6537695">err</span><span class="op" id="6537698">.</span><span class="ident" id="6537699">Error</span><span class="op" id="6537704">(</span><span class="op" id="6537705">)</span>&nbsp;<span class="op" id="6537707">!=</span>&nbsp;<span class="string" id="6537710">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6537727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537731">t</span><span class="op" id="6537732">.</span><span class="ident" id="6537733">Error</span><span class="op" id="6537738">(</span><span class="string" id="6537739">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6537780">,</span>&nbsp;<span class="ident" id="6537782">err</span><span class="op" id="6537785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537792">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537806">reply</span>&nbsp;<span class="op" id="6537812">=</span>&nbsp;<span class="builtinfunc" id="6537814">new</span><span class="op" id="6537817">(</span><span class="ident" id="6537818">Reply</span><span class="op" id="6537823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537826">err</span>&nbsp;<span class="op" id="6537830">=</span>&nbsp;<span class="ident" id="6537832">client</span><span class="op" id="6537838">.</span><span class="ident" id="6537839">Call</span><span class="op" id="6537843">(</span><span class="string" id="6537844">&#34;Arith.Add&#34;</span><span class="op" id="6537855">,</span>&nbsp;<span class="ident" id="6537857">reply</span><span class="op" id="6537862">,</span>&nbsp;<span class="ident" id="6537864">reply</span><span class="op" id="6537869">)</span>&nbsp;<span class="comment" id="6537871">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537921">if</span>&nbsp;<span class="ident" id="6537924">err</span>&nbsp;<span class="op" id="6537928">==</span>&nbsp;<span class="ident" id="6537931">nil</span>&nbsp;<span class="op" id="6537935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537939">t</span><span class="op" id="6537940">.</span><span class="ident" id="6537941">Error</span><span class="op" id="6537946">(</span><span class="string" id="6537947">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="6538001">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538004">}</span>&nbsp;<span class="keyword" id="6538006">else</span>&nbsp;<span class="keyword" id="6538011">if</span>&nbsp;<span class="ident" id="6538014">strings</span><span class="op" id="6538021">.</span><span class="ident" id="6538022">Index</span><span class="op" id="6538027">(</span><span class="ident" id="6538028">err</span><span class="op" id="6538031">.</span><span class="ident" id="6538032">Error</span><span class="op" id="6538037">(</span><span class="op" id="6538038">)</span><span class="op" id="6538039">,</span>&nbsp;<span class="string" id="6538041">&#34;type&#34;</span><span class="op" id="6538047">)</span>&nbsp;<span class="op" id="6538049">&lt;</span>&nbsp;<span class="num" id="6538051">0</span>&nbsp;<span class="op" id="6538053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538057">t</span><span class="op" id="6538058">.</span><span class="ident" id="6538059">Error</span><span class="op" id="6538064">(</span><span class="string" id="6538065">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="6538097">,</span>&nbsp;<span class="ident" id="6538099">err</span><span class="op" id="6538102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6538109">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538133">const</span>&nbsp;<span class="ident" id="6538139">Val</span>&nbsp;<span class="op" id="6538143">=</span>&nbsp;<span class="num" id="6538145">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538152">str</span>&nbsp;<span class="op" id="6538156">:=</span>&nbsp;<span class="ident" id="6538159">fmt</span><span class="op" id="6538162">.</span><span class="ident" id="6538163">Sprint</span><span class="op" id="6538169">(</span><span class="ident" id="6538170">Val</span><span class="op" id="6538173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538176">reply</span>&nbsp;<span class="op" id="6538182">=</span>&nbsp;<span class="builtinfunc" id="6538184">new</span><span class="op" id="6538187">(</span><span class="ident" id="6538188">Reply</span><span class="op" id="6538193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538196">err</span>&nbsp;<span class="op" id="6538200">=</span>&nbsp;<span class="ident" id="6538202">client</span><span class="op" id="6538208">.</span><span class="ident" id="6538209">Call</span><span class="op" id="6538213">(</span><span class="string" id="6538214">&#34;Arith.Scan&#34;</span><span class="op" id="6538226">,</span>&nbsp;<span class="op" id="6538228">&amp;</span><span class="ident" id="6538229">str</span><span class="op" id="6538232">,</span>&nbsp;<span class="ident" id="6538234">reply</span><span class="op" id="6538239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538242">if</span>&nbsp;<span class="ident" id="6538245">err</span>&nbsp;<span class="op" id="6538249">!=</span>&nbsp;<span class="ident" id="6538252">nil</span>&nbsp;<span class="op" id="6538256">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538260">t</span><span class="op" id="6538261">.</span><span class="ident" id="6538262">Errorf</span><span class="op" id="6538268">(</span><span class="string" id="6538269">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6538312">,</span>&nbsp;<span class="ident" id="6538314">err</span><span class="op" id="6538317">.</span><span class="ident" id="6538318">Error</span><span class="op" id="6538323">(</span><span class="op" id="6538324">)</span><span class="op" id="6538325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538328">}</span>&nbsp;<span class="keyword" id="6538330">else</span>&nbsp;<span class="keyword" id="6538335">if</span>&nbsp;<span class="ident" id="6538338">reply</span><span class="op" id="6538343">.</span><span class="ident" id="6538344">C</span>&nbsp;<span class="op" id="6538346">!=</span>&nbsp;<span class="ident" id="6538349">Val</span>&nbsp;<span class="op" id="6538353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538357">t</span><span class="op" id="6538358">.</span><span class="ident" id="6538359">Errorf</span><span class="op" id="6538365">(</span><span class="string" id="6538366">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6538392">,</span>&nbsp;<span class="ident" id="6538394">Val</span><span class="op" id="6538397">,</span>&nbsp;<span class="ident" id="6538399">reply</span><span class="op" id="6538404">.</span><span class="ident" id="6538405">C</span><span class="op" id="6538406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6538413">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538434">args</span>&nbsp;<span class="op" id="6538439">=</span>&nbsp;<span class="op" id="6538441">&amp;</span><span class="ident" id="6538442">Args</span><span class="op" id="6538446">{</span><span class="num" id="6538447">27</span><span class="op" id="6538449">,</span>&nbsp;<span class="num" id="6538451">35</span><span class="op" id="6538453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538456">str</span>&nbsp;<span class="op" id="6538460">=</span>&nbsp;<span class="string" id="6538462">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538466">err</span>&nbsp;<span class="op" id="6538470">=</span>&nbsp;<span class="ident" id="6538472">client</span><span class="op" id="6538478">.</span><span class="ident" id="6538479">Call</span><span class="op" id="6538483">(</span><span class="string" id="6538484">&#34;Arith.String&#34;</span><span class="op" id="6538498">,</span>&nbsp;<span class="ident" id="6538500">args</span><span class="op" id="6538504">,</span>&nbsp;<span class="op" id="6538506">&amp;</span><span class="ident" id="6538507">str</span><span class="op" id="6538510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538513">if</span>&nbsp;<span class="ident" id="6538516">err</span>&nbsp;<span class="op" id="6538520">!=</span>&nbsp;<span class="ident" id="6538523">nil</span>&nbsp;<span class="op" id="6538527">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538531">t</span><span class="op" id="6538532">.</span><span class="ident" id="6538533">Errorf</span><span class="op" id="6538539">(</span><span class="string" id="6538540">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6538585">,</span>&nbsp;<span class="ident" id="6538587">err</span><span class="op" id="6538590">.</span><span class="ident" id="6538591">Error</span><span class="op" id="6538596">(</span><span class="op" id="6538597">)</span><span class="op" id="6538598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538604">expect</span>&nbsp;<span class="op" id="6538611">:=</span>&nbsp;<span class="ident" id="6538614">fmt</span><span class="op" id="6538617">.</span><span class="ident" id="6538618">Sprintf</span><span class="op" id="6538625">(</span><span class="string" id="6538626">&#34;%d+%d=%d&#34;</span><span class="op" id="6538636">,</span>&nbsp;<span class="ident" id="6538638">args</span><span class="op" id="6538642">.</span><span class="ident" id="6538643">A</span><span class="op" id="6538644">,</span>&nbsp;<span class="ident" id="6538646">args</span><span class="op" id="6538650">.</span><span class="ident" id="6538651">B</span><span class="op" id="6538652">,</span>&nbsp;<span class="ident" id="6538654">args</span><span class="op" id="6538658">.</span><span class="ident" id="6538659">A</span><span class="op" id="6538660">+</span><span class="ident" id="6538661">args</span><span class="op" id="6538665">.</span><span class="ident" id="6538666">B</span><span class="op" id="6538667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538670">if</span>&nbsp;<span class="ident" id="6538673">str</span>&nbsp;<span class="op" id="6538677">!=</span>&nbsp;<span class="ident" id="6538680">expect</span>&nbsp;<span class="op" id="6538687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538691">t</span><span class="op" id="6538692">.</span><span class="ident" id="6538693">Errorf</span><span class="op" id="6538699">(</span><span class="string" id="6538700">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6538728">,</span>&nbsp;<span class="ident" id="6538730">expect</span><span class="op" id="6538736">,</span>&nbsp;<span class="ident" id="6538738">str</span><span class="op" id="6538741">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538748">args</span>&nbsp;<span class="op" id="6538753">=</span>&nbsp;<span class="op" id="6538755">&amp;</span><span class="ident" id="6538756">Args</span><span class="op" id="6538760">{</span><span class="num" id="6538761">7</span><span class="op" id="6538762">,</span>&nbsp;<span class="num" id="6538764">8</span><span class="op" id="6538765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538768">reply</span>&nbsp;<span class="op" id="6538774">=</span>&nbsp;<span class="builtinfunc" id="6538776">new</span><span class="op" id="6538779">(</span><span class="ident" id="6538780">Reply</span><span class="op" id="6538785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538788">err</span>&nbsp;<span class="op" id="6538792">=</span>&nbsp;<span class="ident" id="6538794">client</span><span class="op" id="6538800">.</span><span class="ident" id="6538801">Call</span><span class="op" id="6538805">(</span><span class="string" id="6538806">&#34;Arith.Mul&#34;</span><span class="op" id="6538817">,</span>&nbsp;<span class="ident" id="6538819">args</span><span class="op" id="6538823">,</span>&nbsp;<span class="ident" id="6538825">reply</span><span class="op" id="6538830">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538833">if</span>&nbsp;<span class="ident" id="6538836">err</span>&nbsp;<span class="op" id="6538840">!=</span>&nbsp;<span class="ident" id="6538843">nil</span>&nbsp;<span class="op" id="6538847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538851">t</span><span class="op" id="6538852">.</span><span class="ident" id="6538853">Errorf</span><span class="op" id="6538859">(</span><span class="string" id="6538860">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6538902">,</span>&nbsp;<span class="ident" id="6538904">err</span><span class="op" id="6538907">.</span><span class="ident" id="6538908">Error</span><span class="op" id="6538913">(</span><span class="op" id="6538914">)</span><span class="op" id="6538915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538921">if</span>&nbsp;<span class="ident" id="6538924">reply</span><span class="op" id="6538929">.</span><span class="ident" id="6538930">C</span>&nbsp;<span class="op" id="6538932">!=</span>&nbsp;<span class="ident" id="6538935">args</span><span class="op" id="6538939">.</span><span class="ident" id="6538940">A</span><span class="op" id="6538941">*</span><span class="ident" id="6538942">args</span><span class="op" id="6538946">.</span><span class="ident" id="6538947">B</span>&nbsp;<span class="op" id="6538949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538953">t</span><span class="op" id="6538954">.</span><span class="ident" id="6538955">Errorf</span><span class="op" id="6538961">(</span><span class="string" id="6538962">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6538987">,</span>&nbsp;<span class="ident" id="6538989">reply</span><span class="op" id="6538994">.</span><span class="ident" id="6538995">C</span><span class="op" id="6538996">,</span>&nbsp;<span class="ident" id="6538998">args</span><span class="op" id="6539002">.</span><span class="ident" id="6539003">A</span><span class="op" id="6539004">*</span><span class="ident" id="6539005">args</span><span class="op" id="6539009">.</span><span class="ident" id="6539010">B</span><span class="op" id="6539011">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6539018">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539056">args</span>&nbsp;<span class="op" id="6539061">=</span>&nbsp;<span class="op" id="6539063">&amp;</span><span class="ident" id="6539064">Args</span><span class="op" id="6539068">{</span><span class="num" id="6539069">7</span><span class="op" id="6539070">,</span>&nbsp;<span class="num" id="6539072">8</span><span class="op" id="6539073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539076">reply</span>&nbsp;<span class="op" id="6539082">=</span>&nbsp;<span class="builtinfunc" id="6539084">new</span><span class="op" id="6539087">(</span><span class="ident" id="6539088">Reply</span><span class="op" id="6539093">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539096">err</span>&nbsp;<span class="op" id="6539100">=</span>&nbsp;<span class="ident" id="6539102">client</span><span class="op" id="6539108">.</span><span class="ident" id="6539109">Call</span><span class="op" id="6539113">(</span><span class="string" id="6539114">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="6539133">,</span>&nbsp;<span class="ident" id="6539135">args</span><span class="op" id="6539139">,</span>&nbsp;<span class="ident" id="6539141">reply</span><span class="op" id="6539146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539149">if</span>&nbsp;<span class="ident" id="6539152">err</span>&nbsp;<span class="op" id="6539156">!=</span>&nbsp;<span class="ident" id="6539159">nil</span>&nbsp;<span class="op" id="6539163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539167">t</span><span class="op" id="6539168">.</span><span class="ident" id="6539169">Errorf</span><span class="op" id="6539175">(</span><span class="string" id="6539176">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6539218">,</span>&nbsp;<span class="ident" id="6539220">err</span><span class="op" id="6539223">.</span><span class="ident" id="6539224">Error</span><span class="op" id="6539229">(</span><span class="op" id="6539230">)</span><span class="op" id="6539231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539237">if</span>&nbsp;<span class="ident" id="6539240">reply</span><span class="op" id="6539245">.</span><span class="ident" id="6539246">C</span>&nbsp;<span class="op" id="6539248">!=</span>&nbsp;<span class="ident" id="6539251">args</span><span class="op" id="6539255">.</span><span class="ident" id="6539256">A</span><span class="op" id="6539257">+</span><span class="ident" id="6539258">args</span><span class="op" id="6539262">.</span><span class="ident" id="6539263">B</span>&nbsp;<span class="op" id="6539265">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539269">t</span><span class="op" id="6539270">.</span><span class="ident" id="6539271">Errorf</span><span class="op" id="6539277">(</span><span class="string" id="6539278">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6539303">,</span>&nbsp;<span class="ident" id="6539305">reply</span><span class="op" id="6539310">.</span><span class="ident" id="6539311">C</span><span class="op" id="6539312">,</span>&nbsp;<span class="ident" id="6539314">args</span><span class="op" id="6539318">.</span><span class="ident" id="6539319">A</span><span class="op" id="6539320">+</span><span class="ident" id="6539321">args</span><span class="op" id="6539325">.</span><span class="ident" id="6539326">B</span><span class="op" id="6539327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539330">}</span><br>
<span class="lineno"></span><span class="op" id="6539332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539335">func</span>&nbsp;<span class="ident" id="6539340">testNewServerRPC</span><span class="op" id="6539356">(</span><span class="ident" id="6539357">t</span>&nbsp;<span class="op" id="6539359">*</span><span class="ident" id="6539360">testing</span><span class="op" id="6539367">.</span><span class="ident" id="6539368">T</span><span class="op" id="6539369">,</span>&nbsp;<span class="ident" id="6539371">addr</span>&nbsp;<span class="builtintype" id="6539376">string</span><span class="op" id="6539382">)</span>&nbsp;<span class="op" id="6539384">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539387">client</span><span class="op" id="6539393">,</span>&nbsp;<span class="ident" id="6539395">err</span>&nbsp;<span class="op" id="6539399">:=</span>&nbsp;<span class="ident" id="6539402">Dial</span><span class="op" id="6539406">(</span><span class="string" id="6539407">&#34;tcp&#34;</span><span class="op" id="6539412">,</span>&nbsp;<span class="ident" id="6539414">addr</span><span class="op" id="6539418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539421">if</span>&nbsp;<span class="ident" id="6539424">err</span>&nbsp;<span class="op" id="6539428">!=</span>&nbsp;<span class="ident" id="6539431">nil</span>&nbsp;<span class="op" id="6539435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539439">t</span><span class="op" id="6539440">.</span><span class="ident" id="6539441">Fatal</span><span class="op" id="6539446">(</span><span class="string" id="6539447">&#34;dialing&#34;</span><span class="op" id="6539456">,</span>&nbsp;<span class="ident" id="6539458">err</span><span class="op" id="6539461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539467">defer</span>&nbsp;<span class="ident" id="6539473">client</span><span class="op" id="6539479">.</span><span class="ident" id="6539480">Close</span><span class="op" id="6539485">(</span><span class="op" id="6539486">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6539490">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539512">args</span>&nbsp;<span class="op" id="6539517">:=</span>&nbsp;<span class="op" id="6539520">&amp;</span><span class="ident" id="6539521">Args</span><span class="op" id="6539525">{</span><span class="num" id="6539526">7</span><span class="op" id="6539527">,</span>&nbsp;<span class="num" id="6539529">8</span><span class="op" id="6539530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539533">reply</span>&nbsp;<span class="op" id="6539539">:=</span>&nbsp;<span class="builtinfunc" id="6539542">new</span><span class="op" id="6539545">(</span><span class="ident" id="6539546">Reply</span><span class="op" id="6539551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539554">err</span>&nbsp;<span class="op" id="6539558">=</span>&nbsp;<span class="ident" id="6539560">client</span><span class="op" id="6539566">.</span><span class="ident" id="6539567">Call</span><span class="op" id="6539571">(</span><span class="string" id="6539572">&#34;newServer.Arith.Add&#34;</span><span class="op" id="6539593">,</span>&nbsp;<span class="ident" id="6539595">args</span><span class="op" id="6539599">,</span>&nbsp;<span class="ident" id="6539601">reply</span><span class="op" id="6539606">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539609">if</span>&nbsp;<span class="ident" id="6539612">err</span>&nbsp;<span class="op" id="6539616">!=</span>&nbsp;<span class="ident" id="6539619">nil</span>&nbsp;<span class="op" id="6539623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539627">t</span><span class="op" id="6539628">.</span><span class="ident" id="6539629">Errorf</span><span class="op" id="6539635">(</span><span class="string" id="6539636">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6539678">,</span>&nbsp;<span class="ident" id="6539680">err</span><span class="op" id="6539683">.</span><span class="ident" id="6539684">Error</span><span class="op" id="6539689">(</span><span class="op" id="6539690">)</span><span class="op" id="6539691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539697">if</span>&nbsp;<span class="ident" id="6539700">reply</span><span class="op" id="6539705">.</span><span class="ident" id="6539706">C</span>&nbsp;<span class="op" id="6539708">!=</span>&nbsp;<span class="ident" id="6539711">args</span><span class="op" id="6539715">.</span><span class="ident" id="6539716">A</span><span class="op" id="6539717">+</span><span class="ident" id="6539718">args</span><span class="op" id="6539722">.</span><span class="ident" id="6539723">B</span>&nbsp;<span class="op" id="6539725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539729">t</span><span class="op" id="6539730">.</span><span class="ident" id="6539731">Errorf</span><span class="op" id="6539737">(</span><span class="string" id="6539738">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6539763">,</span>&nbsp;<span class="ident" id="6539765">reply</span><span class="op" id="6539770">.</span><span class="ident" id="6539771">C</span><span class="op" id="6539772">,</span>&nbsp;<span class="ident" id="6539774">args</span><span class="op" id="6539778">.</span><span class="ident" id="6539779">A</span><span class="op" id="6539780">+</span><span class="ident" id="6539781">args</span><span class="op" id="6539785">.</span><span class="ident" id="6539786">B</span><span class="op" id="6539787">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539790">}</span><br>
<span class="lineno"></span><span class="op" id="6539792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539795">func</span>&nbsp;<span class="ident" id="6539800">TestHTTP</span><span class="op" id="6539808">(</span><span class="ident" id="6539809">t</span>&nbsp;<span class="op" id="6539811">*</span><span class="ident" id="6539812">testing</span><span class="op" id="6539819">.</span><span class="ident" id="6539820">T</span><span class="op" id="6539821">)</span>&nbsp;<span class="op" id="6539823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539826">once</span><span class="op" id="6539830">.</span><span class="ident" id="6539831">Do</span><span class="op" id="6539833">(</span><span class="ident" id="6539834">startServer</span><span class="op" id="6539845">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539848">testHTTPRPC</span><span class="op" id="6539859">(</span><span class="ident" id="6539860">t</span><span class="op" id="6539861">,</span>&nbsp;<span class="string" id="6539863">&#34;&#34;</span><span class="op" id="6539865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539868">newOnce</span><span class="op" id="6539875">.</span><span class="ident" id="6539876">Do</span><span class="op" id="6539878">(</span><span class="ident" id="6539879">startNewServer</span><span class="op" id="6539893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539896">testHTTPRPC</span><span class="op" id="6539907">(</span><span class="ident" id="6539908">t</span><span class="op" id="6539909">,</span>&nbsp;<span class="ident" id="6539911">newHttpPath</span><span class="op" id="6539922">)</span><br>
<span class="lineno"></span><span class="op" id="6539924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6539927">func</span>&nbsp;<span class="ident" id="6539932">testHTTPRPC</span><span class="op" id="6539943">(</span><span class="ident" id="6539944">t</span>&nbsp;<span class="op" id="6539946">*</span><span class="ident" id="6539947">testing</span><span class="op" id="6539954">.</span><span class="ident" id="6539955">T</span><span class="op" id="6539956">,</span>&nbsp;<span class="ident" id="6539958">path</span>&nbsp;<span class="builtintype" id="6539963">string</span><span class="op" id="6539969">)</span>&nbsp;<span class="op" id="6539971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539974">var</span>&nbsp;<span class="ident" id="6539978">client</span>&nbsp;<span class="op" id="6539985">*</span><span class="ident" id="6539986">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539994">var</span>&nbsp;<span class="ident" id="6539998">err</span>&nbsp;<span class="builtintype" id="6540002">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540009">if</span>&nbsp;<span class="ident" id="6540012">path</span>&nbsp;<span class="op" id="6540017">==</span>&nbsp;<span class="string" id="6540020">&#34;&#34;</span>&nbsp;<span class="op" id="6540023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540027">client</span><span class="op" id="6540033">,</span>&nbsp;<span class="ident" id="6540035">err</span>&nbsp;<span class="op" id="6540039">=</span>&nbsp;<span class="ident" id="6540041">DialHTTP</span><span class="op" id="6540049">(</span><span class="string" id="6540050">&#34;tcp&#34;</span><span class="op" id="6540055">,</span>&nbsp;<span class="ident" id="6540057">httpServerAddr</span><span class="op" id="6540071">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540074">}</span>&nbsp;<span class="keyword" id="6540076">else</span>&nbsp;<span class="op" id="6540081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540085">client</span><span class="op" id="6540091">,</span>&nbsp;<span class="ident" id="6540093">err</span>&nbsp;<span class="op" id="6540097">=</span>&nbsp;<span class="ident" id="6540099">DialHTTPPath</span><span class="op" id="6540111">(</span><span class="string" id="6540112">&#34;tcp&#34;</span><span class="op" id="6540117">,</span>&nbsp;<span class="ident" id="6540119">httpServerAddr</span><span class="op" id="6540133">,</span>&nbsp;<span class="ident" id="6540135">path</span><span class="op" id="6540139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540145">if</span>&nbsp;<span class="ident" id="6540148">err</span>&nbsp;<span class="op" id="6540152">!=</span>&nbsp;<span class="ident" id="6540155">nil</span>&nbsp;<span class="op" id="6540159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540163">t</span><span class="op" id="6540164">.</span><span class="ident" id="6540165">Fatal</span><span class="op" id="6540170">(</span><span class="string" id="6540171">&#34;dialing&#34;</span><span class="op" id="6540180">,</span>&nbsp;<span class="ident" id="6540182">err</span><span class="op" id="6540185">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540191">defer</span>&nbsp;<span class="ident" id="6540197">client</span><span class="op" id="6540203">.</span><span class="ident" id="6540204">Close</span><span class="op" id="6540209">(</span><span class="op" id="6540210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6540214">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540236">args</span>&nbsp;<span class="op" id="6540241">:=</span>&nbsp;<span class="op" id="6540244">&amp;</span><span class="ident" id="6540245">Args</span><span class="op" id="6540249">{</span><span class="num" id="6540250">7</span><span class="op" id="6540251">,</span>&nbsp;<span class="num" id="6540253">8</span><span class="op" id="6540254">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540257">reply</span>&nbsp;<span class="op" id="6540263">:=</span>&nbsp;<span class="builtinfunc" id="6540266">new</span><span class="op" id="6540269">(</span><span class="ident" id="6540270">Reply</span><span class="op" id="6540275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540278">err</span>&nbsp;<span class="op" id="6540282">=</span>&nbsp;<span class="ident" id="6540284">client</span><span class="op" id="6540290">.</span><span class="ident" id="6540291">Call</span><span class="op" id="6540295">(</span><span class="string" id="6540296">&#34;Arith.Add&#34;</span><span class="op" id="6540307">,</span>&nbsp;<span class="ident" id="6540309">args</span><span class="op" id="6540313">,</span>&nbsp;<span class="ident" id="6540315">reply</span><span class="op" id="6540320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540323">if</span>&nbsp;<span class="ident" id="6540326">err</span>&nbsp;<span class="op" id="6540330">!=</span>&nbsp;<span class="ident" id="6540333">nil</span>&nbsp;<span class="op" id="6540337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540341">t</span><span class="op" id="6540342">.</span><span class="ident" id="6540343">Errorf</span><span class="op" id="6540349">(</span><span class="string" id="6540350">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6540392">,</span>&nbsp;<span class="ident" id="6540394">err</span><span class="op" id="6540397">.</span><span class="ident" id="6540398">Error</span><span class="op" id="6540403">(</span><span class="op" id="6540404">)</span><span class="op" id="6540405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540408">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540411">if</span>&nbsp;<span class="ident" id="6540414">reply</span><span class="op" id="6540419">.</span><span class="ident" id="6540420">C</span>&nbsp;<span class="op" id="6540422">!=</span>&nbsp;<span class="ident" id="6540425">args</span><span class="op" id="6540429">.</span><span class="ident" id="6540430">A</span><span class="op" id="6540431">+</span><span class="ident" id="6540432">args</span><span class="op" id="6540436">.</span><span class="ident" id="6540437">B</span>&nbsp;<span class="op" id="6540439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540443">t</span><span class="op" id="6540444">.</span><span class="ident" id="6540445">Errorf</span><span class="op" id="6540451">(</span><span class="string" id="6540452">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6540477">,</span>&nbsp;<span class="ident" id="6540479">reply</span><span class="op" id="6540484">.</span><span class="ident" id="6540485">C</span><span class="op" id="6540486">,</span>&nbsp;<span class="ident" id="6540488">args</span><span class="op" id="6540492">.</span><span class="ident" id="6540493">A</span><span class="op" id="6540494">+</span><span class="ident" id="6540495">args</span><span class="op" id="6540499">.</span><span class="ident" id="6540500">B</span><span class="op" id="6540501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540504">}</span><br>
<span class="lineno"></span><span class="op" id="6540506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="6540509">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6540582">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="6540619">type</span>&nbsp;<span class="ident" id="6540624">CodecEmulator</span>&nbsp;<span class="keyword" id="6540638">struct</span>&nbsp;<span class="op" id="6540645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540648">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6540662">*</span><span class="ident" id="6540663">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540671">serviceMethod</span>&nbsp;<span class="builtintype" id="6540685">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540693">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6540707">*</span><span class="ident" id="6540708">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540714">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6540728">*</span><span class="ident" id="6540729">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540736">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6540750">error</span><br>
<span class="lineno"></span><span class="op" id="6540756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6540759">func</span>&nbsp;<span class="op" id="6540764">(</span><span class="ident" id="6540765">codec</span>&nbsp;<span class="op" id="6540771">*</span><span class="ident" id="6540772">CodecEmulator</span><span class="op" id="6540785">)</span>&nbsp;<span class="ident" id="6540787">Call</span><span class="op" id="6540791">(</span><span class="ident" id="6540792">serviceMethod</span>&nbsp;<span class="builtintype" id="6540806">string</span><span class="op" id="6540812">,</span>&nbsp;<span class="ident" id="6540814">args</span>&nbsp;<span class="op" id="6540819">*</span><span class="ident" id="6540820">Args</span><span class="op" id="6540824">,</span>&nbsp;<span class="ident" id="6540826">reply</span>&nbsp;<span class="op" id="6540832">*</span><span class="ident" id="6540833">Reply</span><span class="op" id="6540838">)</span>&nbsp;<span class="builtintype" id="6540840">error</span>&nbsp;<span class="op" id="6540846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540849">codec</span><span class="op" id="6540854">.</span><span class="ident" id="6540855">serviceMethod</span>&nbsp;<span class="op" id="6540869">=</span>&nbsp;<span class="ident" id="6540871">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540886">codec</span><span class="op" id="6540891">.</span><span class="ident" id="6540892">args</span>&nbsp;<span class="op" id="6540897">=</span>&nbsp;<span class="ident" id="6540899">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540905">codec</span><span class="op" id="6540910">.</span><span class="ident" id="6540911">reply</span>&nbsp;<span class="op" id="6540917">=</span>&nbsp;<span class="ident" id="6540919">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540926">codec</span><span class="op" id="6540931">.</span><span class="ident" id="6540932">err</span>&nbsp;<span class="op" id="6540936">=</span>&nbsp;<span class="ident" id="6540938">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540943">var</span>&nbsp;<span class="ident" id="6540947">serverError</span>&nbsp;<span class="builtintype" id="6540959">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540966">if</span>&nbsp;<span class="ident" id="6540969">codec</span><span class="op" id="6540974">.</span><span class="ident" id="6540975">server</span>&nbsp;<span class="op" id="6540982">==</span>&nbsp;<span class="ident" id="6540985">nil</span>&nbsp;<span class="op" id="6540989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540993">serverError</span>&nbsp;<span class="op" id="6541005">=</span>&nbsp;<span class="ident" id="6541007">ServeRequest</span><span class="op" id="6541019">(</span><span class="ident" id="6541020">codec</span><span class="op" id="6541025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541028">}</span>&nbsp;<span class="keyword" id="6541030">else</span>&nbsp;<span class="op" id="6541035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541039">serverError</span>&nbsp;<span class="op" id="6541051">=</span>&nbsp;<span class="ident" id="6541053">codec</span><span class="op" id="6541058">.</span><span class="ident" id="6541059">server</span><span class="op" id="6541065">.</span><span class="ident" id="6541066">ServeRequest</span><span class="op" id="6541078">(</span><span class="ident" id="6541079">codec</span><span class="op" id="6541084">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541090">if</span>&nbsp;<span class="ident" id="6541093">codec</span><span class="op" id="6541098">.</span><span class="ident" id="6541099">err</span>&nbsp;<span class="op" id="6541103">==</span>&nbsp;<span class="ident" id="6541106">nil</span>&nbsp;<span class="op" id="6541110">&amp;&amp;</span>&nbsp;<span class="ident" id="6541113">serverError</span>&nbsp;<span class="op" id="6541125">!=</span>&nbsp;<span class="ident" id="6541128">nil</span>&nbsp;<span class="op" id="6541132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541136">codec</span><span class="op" id="6541141">.</span><span class="ident" id="6541142">err</span>&nbsp;<span class="op" id="6541146">=</span>&nbsp;<span class="ident" id="6541148">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541164">return</span>&nbsp;<span class="ident" id="6541171">codec</span><span class="op" id="6541176">.</span><span class="ident" id="6541177">err</span><br>
<span class="lineno">330</span><span class="op" id="6541181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6541184">func</span>&nbsp;<span class="op" id="6541189">(</span><span class="ident" id="6541190">codec</span>&nbsp;<span class="op" id="6541196">*</span><span class="ident" id="6541197">CodecEmulator</span><span class="op" id="6541210">)</span>&nbsp;<span class="ident" id="6541212">ReadRequestHeader</span><span class="op" id="6541229">(</span><span class="ident" id="6541230">req</span>&nbsp;<span class="op" id="6541234">*</span><span class="ident" id="6541235">Request</span><span class="op" id="6541242">)</span>&nbsp;<span class="builtintype" id="6541244">error</span>&nbsp;<span class="op" id="6541250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541253">req</span><span class="op" id="6541256">.</span><span class="ident" id="6541257">ServiceMethod</span>&nbsp;<span class="op" id="6541271">=</span>&nbsp;<span class="ident" id="6541273">codec</span><span class="op" id="6541278">.</span><span class="ident" id="6541279">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541294">req</span><span class="op" id="6541297">.</span><span class="ident" id="6541298">Seq</span>&nbsp;<span class="op" id="6541302">=</span>&nbsp;<span class="num" id="6541304">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541307">return</span>&nbsp;<span class="ident" id="6541314">nil</span><br>
<span class="lineno"></span><span class="op" id="6541318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6541321">func</span>&nbsp;<span class="op" id="6541326">(</span><span class="ident" id="6541327">codec</span>&nbsp;<span class="op" id="6541333">*</span><span class="ident" id="6541334">CodecEmulator</span><span class="op" id="6541347">)</span>&nbsp;<span class="ident" id="6541349">ReadRequestBody</span><span class="op" id="6541364">(</span><span class="ident" id="6541365">argv</span>&nbsp;<span class="keyword" id="6541370">interface</span><span class="op" id="6541379">{</span><span class="op" id="6541380">}</span><span class="op" id="6541381">)</span>&nbsp;<span class="builtintype" id="6541383">error</span>&nbsp;<span class="op" id="6541389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541392">if</span>&nbsp;<span class="ident" id="6541395">codec</span><span class="op" id="6541400">.</span><span class="ident" id="6541401">args</span>&nbsp;<span class="op" id="6541406">==</span>&nbsp;<span class="ident" id="6541409">nil</span>&nbsp;<span class="op" id="6541413">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541417">return</span>&nbsp;<span class="ident" id="6541424">io</span><span class="op" id="6541426">.</span><span class="ident" id="6541427">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541448">*</span><span class="op" id="6541449">(</span><span class="ident" id="6541450">argv</span><span class="op" id="6541454">.</span><span class="op" id="6541455">(</span><span class="op" id="6541456">*</span><span class="ident" id="6541457">Args</span><span class="op" id="6541461">)</span><span class="op" id="6541462">)</span>&nbsp;<span class="op" id="6541464">=</span>&nbsp;<span class="op" id="6541466">*</span><span class="ident" id="6541467">codec</span><span class="op" id="6541472">.</span><span class="ident" id="6541473">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541479">return</span>&nbsp;<span class="ident" id="6541486">nil</span><br>
<span class="lineno"></span><span class="op" id="6541490">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6541493">func</span>&nbsp;<span class="op" id="6541498">(</span><span class="ident" id="6541499">codec</span>&nbsp;<span class="op" id="6541505">*</span><span class="ident" id="6541506">CodecEmulator</span><span class="op" id="6541519">)</span>&nbsp;<span class="ident" id="6541521">WriteResponse</span><span class="op" id="6541534">(</span><span class="ident" id="6541535">resp</span>&nbsp;<span class="op" id="6541540">*</span><span class="ident" id="6541541">Response</span><span class="op" id="6541549">,</span>&nbsp;<span class="ident" id="6541551">reply</span>&nbsp;<span class="keyword" id="6541557">interface</span><span class="op" id="6541566">{</span><span class="op" id="6541567">}</span><span class="op" id="6541568">)</span>&nbsp;<span class="builtintype" id="6541570">error</span>&nbsp;<span class="op" id="6541576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541579">if</span>&nbsp;<span class="ident" id="6541582">resp</span><span class="op" id="6541586">.</span><span class="ident" id="6541587">Error</span>&nbsp;<span class="op" id="6541593">!=</span>&nbsp;<span class="string" id="6541596">&#34;&#34;</span>&nbsp;<span class="op" id="6541599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541603">codec</span><span class="op" id="6541608">.</span><span class="ident" id="6541609">err</span>&nbsp;<span class="op" id="6541613">=</span>&nbsp;<span class="ident" id="6541615">errors</span><span class="op" id="6541621">.</span><span class="ident" id="6541622">New</span><span class="op" id="6541625">(</span><span class="ident" id="6541626">resp</span><span class="op" id="6541630">.</span><span class="ident" id="6541631">Error</span><span class="op" id="6541636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541639">}</span>&nbsp;<span class="keyword" id="6541641">else</span>&nbsp;<span class="op" id="6541646">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541650">*</span><span class="ident" id="6541651">codec</span><span class="op" id="6541656">.</span><span class="ident" id="6541657">reply</span>&nbsp;<span class="op" id="6541663">=</span>&nbsp;<span class="op" id="6541665">*</span><span class="op" id="6541666">(</span><span class="ident" id="6541667">reply</span><span class="op" id="6541672">.</span><span class="op" id="6541673">(</span><span class="op" id="6541674">*</span><span class="ident" id="6541675">Reply</span><span class="op" id="6541680">)</span><span class="op" id="6541681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541687">return</span>&nbsp;<span class="ident" id="6541694">nil</span><br>
<span class="lineno"></span><span class="op" id="6541698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="6541701">func</span>&nbsp;<span class="op" id="6541706">(</span><span class="ident" id="6541707">codec</span>&nbsp;<span class="op" id="6541713">*</span><span class="ident" id="6541714">CodecEmulator</span><span class="op" id="6541727">)</span>&nbsp;<span class="ident" id="6541729">Close</span><span class="op" id="6541734">(</span><span class="op" id="6541735">)</span>&nbsp;<span class="builtintype" id="6541737">error</span>&nbsp;<span class="op" id="6541743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541746">return</span>&nbsp;<span class="ident" id="6541753">nil</span><br>
<span class="lineno"></span><span class="op" id="6541757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6541760">func</span>&nbsp;<span class="ident" id="6541765">TestServeRequest</span><span class="op" id="6541781">(</span><span class="ident" id="6541782">t</span>&nbsp;<span class="op" id="6541784">*</span><span class="ident" id="6541785">testing</span><span class="op" id="6541792">.</span><span class="ident" id="6541793">T</span><span class="op" id="6541794">)</span>&nbsp;<span class="op" id="6541796">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541799">once</span><span class="op" id="6541803">.</span><span class="ident" id="6541804">Do</span><span class="op" id="6541806">(</span><span class="ident" id="6541807">startServer</span><span class="op" id="6541818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541821">testServeRequest</span><span class="op" id="6541837">(</span><span class="ident" id="6541838">t</span><span class="op" id="6541839">,</span>&nbsp;<span class="ident" id="6541841">nil</span><span class="op" id="6541844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541847">newOnce</span><span class="op" id="6541854">.</span><span class="ident" id="6541855">Do</span><span class="op" id="6541857">(</span><span class="ident" id="6541858">startNewServer</span><span class="op" id="6541872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541875">testServeRequest</span><span class="op" id="6541891">(</span><span class="ident" id="6541892">t</span><span class="op" id="6541893">,</span>&nbsp;<span class="ident" id="6541895">newServer</span><span class="op" id="6541904">)</span><br>
<span class="lineno"></span><span class="op" id="6541906">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6541909">func</span>&nbsp;<span class="ident" id="6541914">testServeRequest</span><span class="op" id="6541930">(</span><span class="ident" id="6541931">t</span>&nbsp;<span class="op" id="6541933">*</span><span class="ident" id="6541934">testing</span><span class="op" id="6541941">.</span><span class="ident" id="6541942">T</span><span class="op" id="6541943">,</span>&nbsp;<span class="ident" id="6541945">server</span>&nbsp;<span class="op" id="6541952">*</span><span class="ident" id="6541953">Server</span><span class="op" id="6541959">)</span>&nbsp;<span class="op" id="6541961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541964">client</span>&nbsp;<span class="op" id="6541971">:=</span>&nbsp;<span class="ident" id="6541974">CodecEmulator</span><span class="op" id="6541987">{</span><span class="ident" id="6541988">server</span><span class="op" id="6541994">:</span>&nbsp;<span class="ident" id="6541996">server</span><span class="op" id="6542002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542005">defer</span>&nbsp;<span class="ident" id="6542011">client</span><span class="op" id="6542017">.</span><span class="ident" id="6542018">Close</span><span class="op" id="6542023">(</span><span class="op" id="6542024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542028">args</span>&nbsp;<span class="op" id="6542033">:=</span>&nbsp;<span class="op" id="6542036">&amp;</span><span class="ident" id="6542037">Args</span><span class="op" id="6542041">{</span><span class="num" id="6542042">7</span><span class="op" id="6542043">,</span>&nbsp;<span class="num" id="6542045">8</span><span class="op" id="6542046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542049">reply</span>&nbsp;<span class="op" id="6542055">:=</span>&nbsp;<span class="builtinfunc" id="6542058">new</span><span class="op" id="6542061">(</span><span class="ident" id="6542062">Reply</span><span class="op" id="6542067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542070">err</span>&nbsp;<span class="op" id="6542074">:=</span>&nbsp;<span class="ident" id="6542077">client</span><span class="op" id="6542083">.</span><span class="ident" id="6542084">Call</span><span class="op" id="6542088">(</span><span class="string" id="6542089">&#34;Arith.Add&#34;</span><span class="op" id="6542100">,</span>&nbsp;<span class="ident" id="6542102">args</span><span class="op" id="6542106">,</span>&nbsp;<span class="ident" id="6542108">reply</span><span class="op" id="6542113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542116">if</span>&nbsp;<span class="ident" id="6542119">err</span>&nbsp;<span class="op" id="6542123">!=</span>&nbsp;<span class="ident" id="6542126">nil</span>&nbsp;<span class="op" id="6542130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542134">t</span><span class="op" id="6542135">.</span><span class="ident" id="6542136">Errorf</span><span class="op" id="6542142">(</span><span class="string" id="6542143">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6542185">,</span>&nbsp;<span class="ident" id="6542187">err</span><span class="op" id="6542190">.</span><span class="ident" id="6542191">Error</span><span class="op" id="6542196">(</span><span class="op" id="6542197">)</span><span class="op" id="6542198">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542204">if</span>&nbsp;<span class="ident" id="6542207">reply</span><span class="op" id="6542212">.</span><span class="ident" id="6542213">C</span>&nbsp;<span class="op" id="6542215">!=</span>&nbsp;<span class="ident" id="6542218">args</span><span class="op" id="6542222">.</span><span class="ident" id="6542223">A</span><span class="op" id="6542224">+</span><span class="ident" id="6542225">args</span><span class="op" id="6542229">.</span><span class="ident" id="6542230">B</span>&nbsp;<span class="op" id="6542232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542236">t</span><span class="op" id="6542237">.</span><span class="ident" id="6542238">Errorf</span><span class="op" id="6542244">(</span><span class="string" id="6542245">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6542270">,</span>&nbsp;<span class="ident" id="6542272">reply</span><span class="op" id="6542277">.</span><span class="ident" id="6542278">C</span><span class="op" id="6542279">,</span>&nbsp;<span class="ident" id="6542281">args</span><span class="op" id="6542285">.</span><span class="ident" id="6542286">A</span><span class="op" id="6542287">+</span><span class="ident" id="6542288">args</span><span class="op" id="6542292">.</span><span class="ident" id="6542293">B</span><span class="op" id="6542294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542301">err</span>&nbsp;<span class="op" id="6542305">=</span>&nbsp;<span class="ident" id="6542307">client</span><span class="op" id="6542313">.</span><span class="ident" id="6542314">Call</span><span class="op" id="6542318">(</span><span class="string" id="6542319">&#34;Arith.Add&#34;</span><span class="op" id="6542330">,</span>&nbsp;<span class="ident" id="6542332">nil</span><span class="op" id="6542335">,</span>&nbsp;<span class="ident" id="6542337">reply</span><span class="op" id="6542342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542345">if</span>&nbsp;<span class="ident" id="6542348">err</span>&nbsp;<span class="op" id="6542352">==</span>&nbsp;<span class="ident" id="6542355">nil</span>&nbsp;<span class="op" id="6542359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542363">t</span><span class="op" id="6542364">.</span><span class="ident" id="6542365">Errorf</span><span class="op" id="6542371">(</span><span class="string" id="6542372">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="6542419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542422">}</span><br>
<span class="lineno"></span><span class="op" id="6542424">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="6542427">type</span>&nbsp;<span class="ident" id="6542432">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="6542448">int</span><br>
<span class="lineno"></span><span class="keyword" id="6542452">type</span>&nbsp;<span class="ident" id="6542457">ArgNotPublic</span>&nbsp;<span class="builtintype" id="6542470">int</span><br>
<span class="lineno"></span><span class="keyword" id="6542474">type</span>&nbsp;<span class="ident" id="6542479">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="6542494">int</span><br>
<span class="lineno"></span><span class="keyword" id="6542498">type</span>&nbsp;<span class="ident" id="6542503">NeedsPtrType</span>&nbsp;<span class="builtintype" id="6542516">int</span><br>
<span class="lineno">390</span><span class="keyword" id="6542520">type</span>&nbsp;<span class="ident" id="6542525">local</span>&nbsp;<span class="keyword" id="6542531">struct</span><span class="op" id="6542537">{</span><span class="op" id="6542538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6542541">func</span>&nbsp;<span class="op" id="6542546">(</span><span class="ident" id="6542547">t</span>&nbsp;<span class="op" id="6542549">*</span><span class="ident" id="6542550">ReplyNotPointer</span><span class="op" id="6542565">)</span>&nbsp;<span class="ident" id="6542567">ReplyNotPointer</span><span class="op" id="6542582">(</span><span class="ident" id="6542583">args</span>&nbsp;<span class="op" id="6542588">*</span><span class="ident" id="6542589">Args</span><span class="op" id="6542593">,</span>&nbsp;<span class="ident" id="6542595">reply</span>&nbsp;<span class="ident" id="6542601">Reply</span><span class="op" id="6542606">)</span>&nbsp;<span class="builtintype" id="6542608">error</span>&nbsp;<span class="op" id="6542614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542617">return</span>&nbsp;<span class="ident" id="6542624">nil</span><br>
<span class="lineno"></span><span class="op" id="6542628">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6542631">func</span>&nbsp;<span class="op" id="6542636">(</span><span class="ident" id="6542637">t</span>&nbsp;<span class="op" id="6542639">*</span><span class="ident" id="6542640">ArgNotPublic</span><span class="op" id="6542652">)</span>&nbsp;<span class="ident" id="6542654">ArgNotPublic</span><span class="op" id="6542666">(</span><span class="ident" id="6542667">args</span>&nbsp;<span class="op" id="6542672">*</span><span class="ident" id="6542673">local</span><span class="op" id="6542678">,</span>&nbsp;<span class="ident" id="6542680">reply</span>&nbsp;<span class="op" id="6542686">*</span><span class="ident" id="6542687">Reply</span><span class="op" id="6542692">)</span>&nbsp;<span class="builtintype" id="6542694">error</span>&nbsp;<span class="op" id="6542700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542703">return</span>&nbsp;<span class="ident" id="6542710">nil</span><br>
<span class="lineno"></span><span class="op" id="6542714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="6542717">func</span>&nbsp;<span class="op" id="6542722">(</span><span class="ident" id="6542723">t</span>&nbsp;<span class="op" id="6542725">*</span><span class="ident" id="6542726">ReplyNotPublic</span><span class="op" id="6542740">)</span>&nbsp;<span class="ident" id="6542742">ReplyNotPublic</span><span class="op" id="6542756">(</span><span class="ident" id="6542757">args</span>&nbsp;<span class="op" id="6542762">*</span><span class="ident" id="6542763">Args</span><span class="op" id="6542767">,</span>&nbsp;<span class="ident" id="6542769">reply</span>&nbsp;<span class="op" id="6542775">*</span><span class="ident" id="6542776">local</span><span class="op" id="6542781">)</span>&nbsp;<span class="builtintype" id="6542783">error</span>&nbsp;<span class="op" id="6542789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542792">return</span>&nbsp;<span class="ident" id="6542799">nil</span><br>
<span class="lineno"></span><span class="op" id="6542803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6542806">func</span>&nbsp;<span class="op" id="6542811">(</span><span class="ident" id="6542812">t</span>&nbsp;<span class="op" id="6542814">*</span><span class="ident" id="6542815">NeedsPtrType</span><span class="op" id="6542827">)</span>&nbsp;<span class="ident" id="6542829">NeedsPtrType</span><span class="op" id="6542841">(</span><span class="ident" id="6542842">args</span>&nbsp;<span class="op" id="6542847">*</span><span class="ident" id="6542848">Args</span><span class="op" id="6542852">,</span>&nbsp;<span class="ident" id="6542854">reply</span>&nbsp;<span class="op" id="6542860">*</span><span class="ident" id="6542861">Reply</span><span class="op" id="6542866">)</span>&nbsp;<span class="builtintype" id="6542868">error</span>&nbsp;<span class="op" id="6542874">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542877">return</span>&nbsp;<span class="ident" id="6542884">nil</span><br>
<span class="lineno"></span><span class="op" id="6542888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6542891">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6542983">func</span>&nbsp;<span class="ident" id="6542988">TestRegistrationError</span><span class="op" id="6543009">(</span><span class="ident" id="6543010">t</span>&nbsp;<span class="op" id="6543012">*</span><span class="ident" id="6543013">testing</span><span class="op" id="6543020">.</span><span class="ident" id="6543021">T</span><span class="op" id="6543022">)</span>&nbsp;<span class="op" id="6543024">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543027">err</span>&nbsp;<span class="op" id="6543031">:=</span>&nbsp;<span class="ident" id="6543034">Register</span><span class="op" id="6543042">(</span><span class="builtinfunc" id="6543043">new</span><span class="op" id="6543046">(</span><span class="ident" id="6543047">ReplyNotPointer</span><span class="op" id="6543062">)</span><span class="op" id="6543063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543066">if</span>&nbsp;<span class="ident" id="6543069">err</span>&nbsp;<span class="op" id="6543073">==</span>&nbsp;<span class="ident" id="6543076">nil</span>&nbsp;<span class="op" id="6543080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543084">t</span><span class="op" id="6543085">.</span><span class="ident" id="6543086">Error</span><span class="op" id="6543091">(</span><span class="string" id="6543092">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="6543136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543142">err</span>&nbsp;<span class="op" id="6543146">=</span>&nbsp;<span class="ident" id="6543148">Register</span><span class="op" id="6543156">(</span><span class="builtinfunc" id="6543157">new</span><span class="op" id="6543160">(</span><span class="ident" id="6543161">ArgNotPublic</span><span class="op" id="6543173">)</span><span class="op" id="6543174">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543177">if</span>&nbsp;<span class="ident" id="6543180">err</span>&nbsp;<span class="op" id="6543184">==</span>&nbsp;<span class="ident" id="6543187">nil</span>&nbsp;<span class="op" id="6543191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543195">t</span><span class="op" id="6543196">.</span><span class="ident" id="6543197">Error</span><span class="op" id="6543202">(</span><span class="string" id="6543203">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="6543244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543250">err</span>&nbsp;<span class="op" id="6543254">=</span>&nbsp;<span class="ident" id="6543256">Register</span><span class="op" id="6543264">(</span><span class="builtinfunc" id="6543265">new</span><span class="op" id="6543268">(</span><span class="ident" id="6543269">ReplyNotPublic</span><span class="op" id="6543283">)</span><span class="op" id="6543284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543287">if</span>&nbsp;<span class="ident" id="6543290">err</span>&nbsp;<span class="op" id="6543294">==</span>&nbsp;<span class="ident" id="6543297">nil</span>&nbsp;<span class="op" id="6543301">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543305">t</span><span class="op" id="6543306">.</span><span class="ident" id="6543307">Error</span><span class="op" id="6543312">(</span><span class="string" id="6543313">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="6543356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543362">err</span>&nbsp;<span class="op" id="6543366">=</span>&nbsp;<span class="ident" id="6543368">Register</span><span class="op" id="6543376">(</span><span class="ident" id="6543377">NeedsPtrType</span><span class="op" id="6543389">(</span><span class="num" id="6543390">0</span><span class="op" id="6543391">)</span><span class="op" id="6543392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543395">if</span>&nbsp;<span class="ident" id="6543398">err</span>&nbsp;<span class="op" id="6543402">==</span>&nbsp;<span class="ident" id="6543405">nil</span>&nbsp;<span class="op" id="6543409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543413">t</span><span class="op" id="6543414">.</span><span class="ident" id="6543415">Error</span><span class="op" id="6543420">(</span><span class="string" id="6543421">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6543462">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543465">}</span>&nbsp;<span class="keyword" id="6543467">else</span>&nbsp;<span class="keyword" id="6543472">if</span>&nbsp;<span class="op" id="6543475">!</span><span class="ident" id="6543476">strings</span><span class="op" id="6543483">.</span><span class="ident" id="6543484">Contains</span><span class="op" id="6543492">(</span><span class="ident" id="6543493">err</span><span class="op" id="6543496">.</span><span class="ident" id="6543497">Error</span><span class="op" id="6543502">(</span><span class="op" id="6543503">)</span><span class="op" id="6543504">,</span>&nbsp;<span class="string" id="6543506">&#34;pointer&#34;</span><span class="op" id="6543515">)</span>&nbsp;<span class="op" id="6543517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543521">t</span><span class="op" id="6543522">.</span><span class="ident" id="6543523">Error</span><span class="op" id="6543528">(</span><span class="string" id="6543529">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6543574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543577">}</span><br>
<span class="lineno"></span><span class="op" id="6543579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6543582">type</span>&nbsp;<span class="ident" id="6543587">WriteFailCodec</span>&nbsp;<span class="builtintype" id="6543602">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6543607">func</span>&nbsp;<span class="op" id="6543612">(</span><span class="ident" id="6543613">WriteFailCodec</span><span class="op" id="6543627">)</span>&nbsp;<span class="ident" id="6543629">WriteRequest</span><span class="op" id="6543641">(</span><span class="op" id="6543642">*</span><span class="ident" id="6543643">Request</span><span class="op" id="6543650">,</span>&nbsp;<span class="keyword" id="6543652">interface</span><span class="op" id="6543661">{</span><span class="op" id="6543662">}</span><span class="op" id="6543663">)</span>&nbsp;<span class="builtintype" id="6543665">error</span>&nbsp;<span class="op" id="6543671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6543674">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543736">return</span>&nbsp;<span class="ident" id="6543743">errors</span><span class="op" id="6543749">.</span><span class="ident" id="6543750">New</span><span class="op" id="6543753">(</span><span class="string" id="6543754">&#34;fail&#34;</span><span class="op" id="6543760">)</span><br>
<span class="lineno">435</span><span class="op" id="6543762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6543765">func</span>&nbsp;<span class="op" id="6543770">(</span><span class="ident" id="6543771">WriteFailCodec</span><span class="op" id="6543785">)</span>&nbsp;<span class="ident" id="6543787">ReadResponseHeader</span><span class="op" id="6543805">(</span><span class="op" id="6543806">*</span><span class="ident" id="6543807">Response</span><span class="op" id="6543815">)</span>&nbsp;<span class="builtintype" id="6543817">error</span>&nbsp;<span class="op" id="6543823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543826">select</span>&nbsp;<span class="op" id="6543833">{</span><span class="op" id="6543834">}</span><br>
<span class="lineno"></span><span class="op" id="6543836">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="6543839">func</span>&nbsp;<span class="op" id="6543844">(</span><span class="ident" id="6543845">WriteFailCodec</span><span class="op" id="6543859">)</span>&nbsp;<span class="ident" id="6543861">ReadResponseBody</span><span class="op" id="6543877">(</span><span class="keyword" id="6543878">interface</span><span class="op" id="6543887">{</span><span class="op" id="6543888">}</span><span class="op" id="6543889">)</span>&nbsp;<span class="builtintype" id="6543891">error</span>&nbsp;<span class="op" id="6543897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543900">select</span>&nbsp;<span class="op" id="6543907">{</span><span class="op" id="6543908">}</span><br>
<span class="lineno"></span><span class="op" id="6543910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="6543913">func</span>&nbsp;<span class="op" id="6543918">(</span><span class="ident" id="6543919">WriteFailCodec</span><span class="op" id="6543933">)</span>&nbsp;<span class="ident" id="6543935">Close</span><span class="op" id="6543940">(</span><span class="op" id="6543941">)</span>&nbsp;<span class="builtintype" id="6543943">error</span>&nbsp;<span class="op" id="6543949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543952">return</span>&nbsp;<span class="ident" id="6543959">nil</span><br>
<span class="lineno"></span><span class="op" id="6543963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6543966">func</span>&nbsp;<span class="ident" id="6543971">TestSendDeadlock</span><span class="op" id="6543987">(</span><span class="ident" id="6543988">t</span>&nbsp;<span class="op" id="6543990">*</span><span class="ident" id="6543991">testing</span><span class="op" id="6543998">.</span><span class="ident" id="6543999">T</span><span class="op" id="6544000">)</span>&nbsp;<span class="op" id="6544002">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544005">client</span>&nbsp;<span class="op" id="6544012">:=</span>&nbsp;<span class="ident" id="6544015">NewClientWithCodec</span><span class="op" id="6544033">(</span><span class="ident" id="6544034">WriteFailCodec</span><span class="op" id="6544048">(</span><span class="num" id="6544049">0</span><span class="op" id="6544050">)</span><span class="op" id="6544051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544054">defer</span>&nbsp;<span class="ident" id="6544060">client</span><span class="op" id="6544066">.</span><span class="ident" id="6544067">Close</span><span class="op" id="6544072">(</span><span class="op" id="6544073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544077">done</span>&nbsp;<span class="op" id="6544082">:=</span>&nbsp;<span class="builtinfunc" id="6544085">make</span><span class="op" id="6544089">(</span><span class="keyword" id="6544090">chan</span>&nbsp;<span class="builtintype" id="6544095">bool</span><span class="op" id="6544099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544102">go</span>&nbsp;<span class="keyword" id="6544105">func</span><span class="op" id="6544109">(</span><span class="op" id="6544110">)</span>&nbsp;<span class="op" id="6544112">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544116">testSendDeadlock</span><span class="op" id="6544132">(</span><span class="ident" id="6544133">client</span><span class="op" id="6544139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544143">testSendDeadlock</span><span class="op" id="6544159">(</span><span class="ident" id="6544160">client</span><span class="op" id="6544166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544170">done</span>&nbsp;<span class="op" id="6544175">&lt;-</span>&nbsp;<span class="builtintype" id="6544178">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6544184">}</span><span class="op" id="6544185">(</span><span class="op" id="6544186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544189">select</span>&nbsp;<span class="op" id="6544196">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544199">case</span>&nbsp;<span class="op" id="6544204">&lt;-</span><span class="ident" id="6544206">done</span><span class="op" id="6544210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544214">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544222">case</span>&nbsp;<span class="op" id="6544227">&lt;-</span><span class="ident" id="6544229">time</span><span class="op" id="6544233">.</span><span class="ident" id="6544234">After</span><span class="op" id="6544239">(</span><span class="num" id="6544240">5</span>&nbsp;<span class="op" id="6544242">*</span>&nbsp;<span class="ident" id="6544244">time</span><span class="op" id="6544248">.</span><span class="ident" id="6544249">Second</span><span class="op" id="6544255">)</span><span class="op" id="6544256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544260">t</span><span class="op" id="6544261">.</span><span class="ident" id="6544262">Fatal</span><span class="op" id="6544267">(</span><span class="string" id="6544268">&#34;deadlock&#34;</span><span class="op" id="6544278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6544281">}</span><br>
<span class="lineno">465</span><span class="op" id="6544283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6544286">func</span>&nbsp;<span class="ident" id="6544291">testSendDeadlock</span><span class="op" id="6544307">(</span><span class="ident" id="6544308">client</span>&nbsp;<span class="op" id="6544315">*</span><span class="ident" id="6544316">Client</span><span class="op" id="6544322">)</span>&nbsp;<span class="op" id="6544324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544327">defer</span>&nbsp;<span class="keyword" id="6544333">func</span><span class="op" id="6544337">(</span><span class="op" id="6544338">)</span>&nbsp;<span class="op" id="6544340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6544344">recover</span><span class="op" id="6544351">(</span><span class="op" id="6544352">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6544355">}</span><span class="op" id="6544356">(</span><span class="op" id="6544357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544360">args</span>&nbsp;<span class="op" id="6544365">:=</span>&nbsp;<span class="op" id="6544368">&amp;</span><span class="ident" id="6544369">Args</span><span class="op" id="6544373">{</span><span class="num" id="6544374">7</span><span class="op" id="6544375">,</span>&nbsp;<span class="num" id="6544377">8</span><span class="op" id="6544378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544381">reply</span>&nbsp;<span class="op" id="6544387">:=</span>&nbsp;<span class="builtinfunc" id="6544390">new</span><span class="op" id="6544393">(</span><span class="ident" id="6544394">Reply</span><span class="op" id="6544399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544402">client</span><span class="op" id="6544408">.</span><span class="ident" id="6544409">Call</span><span class="op" id="6544413">(</span><span class="string" id="6544414">&#34;Arith.Add&#34;</span><span class="op" id="6544425">,</span>&nbsp;<span class="ident" id="6544427">args</span><span class="op" id="6544431">,</span>&nbsp;<span class="ident" id="6544433">reply</span><span class="op" id="6544438">)</span><br>
<span class="lineno"></span><span class="op" id="6544440">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6544443">func</span>&nbsp;<span class="ident" id="6544448">dialDirect</span><span class="op" id="6544458">(</span><span class="op" id="6544459">)</span>&nbsp;<span class="op" id="6544461">(</span><span class="op" id="6544462">*</span><span class="ident" id="6544463">Client</span><span class="op" id="6544469">,</span>&nbsp;<span class="builtintype" id="6544471">error</span><span class="op" id="6544476">)</span>&nbsp;<span class="op" id="6544478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544481">return</span>&nbsp;<span class="ident" id="6544488">Dial</span><span class="op" id="6544492">(</span><span class="string" id="6544493">&#34;tcp&#34;</span><span class="op" id="6544498">,</span>&nbsp;<span class="ident" id="6544500">serverAddr</span><span class="op" id="6544510">)</span><br>
<span class="lineno"></span><span class="op" id="6544512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6544515">func</span>&nbsp;<span class="ident" id="6544520">dialHTTP</span><span class="op" id="6544528">(</span><span class="op" id="6544529">)</span>&nbsp;<span class="op" id="6544531">(</span><span class="op" id="6544532">*</span><span class="ident" id="6544533">Client</span><span class="op" id="6544539">,</span>&nbsp;<span class="builtintype" id="6544541">error</span><span class="op" id="6544546">)</span>&nbsp;<span class="op" id="6544548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544551">return</span>&nbsp;<span class="ident" id="6544558">DialHTTP</span><span class="op" id="6544566">(</span><span class="string" id="6544567">&#34;tcp&#34;</span><span class="op" id="6544572">,</span>&nbsp;<span class="ident" id="6544574">httpServerAddr</span><span class="op" id="6544588">)</span><br>
<span class="lineno"></span><span class="op" id="6544590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6544593">func</span>&nbsp;<span class="ident" id="6544598">countMallocs</span><span class="op" id="6544610">(</span><span class="ident" id="6544611">dial</span>&nbsp;<span class="keyword" id="6544616">func</span><span class="op" id="6544620">(</span><span class="op" id="6544621">)</span>&nbsp;<span class="op" id="6544623">(</span><span class="op" id="6544624">*</span><span class="ident" id="6544625">Client</span><span class="op" id="6544631">,</span>&nbsp;<span class="builtintype" id="6544633">error</span><span class="op" id="6544638">)</span><span class="op" id="6544639">,</span>&nbsp;<span class="ident" id="6544641">t</span>&nbsp;<span class="op" id="6544643">*</span><span class="ident" id="6544644">testing</span><span class="op" id="6544651">.</span><span class="ident" id="6544652">T</span><span class="op" id="6544653">)</span>&nbsp;<span class="builtintype" id="6544655">float64</span>&nbsp;<span class="op" id="6544663">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544666">once</span><span class="op" id="6544670">.</span><span class="ident" id="6544671">Do</span><span class="op" id="6544673">(</span><span class="ident" id="6544674">startServer</span><span class="op" id="6544685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544688">client</span><span class="op" id="6544694">,</span>&nbsp;<span class="ident" id="6544696">err</span>&nbsp;<span class="op" id="6544700">:=</span>&nbsp;<span class="ident" id="6544703">dial</span><span class="op" id="6544707">(</span><span class="op" id="6544708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544711">if</span>&nbsp;<span class="ident" id="6544714">err</span>&nbsp;<span class="op" id="6544718">!=</span>&nbsp;<span class="ident" id="6544721">nil</span>&nbsp;<span class="op" id="6544725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544729">t</span><span class="op" id="6544730">.</span><span class="ident" id="6544731">Fatal</span><span class="op" id="6544736">(</span><span class="string" id="6544737">&#34;error&nbsp;dialing&#34;</span><span class="op" id="6544752">,</span>&nbsp;<span class="ident" id="6544754">err</span><span class="op" id="6544757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6544760">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544763">defer</span>&nbsp;<span class="ident" id="6544769">client</span><span class="op" id="6544775">.</span><span class="ident" id="6544776">Close</span><span class="op" id="6544781">(</span><span class="op" id="6544782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544786">args</span>&nbsp;<span class="op" id="6544791">:=</span>&nbsp;<span class="op" id="6544794">&amp;</span><span class="ident" id="6544795">Args</span><span class="op" id="6544799">{</span><span class="num" id="6544800">7</span><span class="op" id="6544801">,</span>&nbsp;<span class="num" id="6544803">8</span><span class="op" id="6544804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544807">reply</span>&nbsp;<span class="op" id="6544813">:=</span>&nbsp;<span class="builtinfunc" id="6544816">new</span><span class="op" id="6544819">(</span><span class="ident" id="6544820">Reply</span><span class="op" id="6544825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544828">return</span>&nbsp;<span class="ident" id="6544835">testing</span><span class="op" id="6544842">.</span><span class="ident" id="6544843">AllocsPerRun</span><span class="op" id="6544855">(</span><span class="num" id="6544856">100</span><span class="op" id="6544859">,</span>&nbsp;<span class="keyword" id="6544861">func</span><span class="op" id="6544865">(</span><span class="op" id="6544866">)</span>&nbsp;<span class="op" id="6544868">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544872">err</span>&nbsp;<span class="op" id="6544876">:=</span>&nbsp;<span class="ident" id="6544879">client</span><span class="op" id="6544885">.</span><span class="ident" id="6544886">Call</span><span class="op" id="6544890">(</span><span class="string" id="6544891">&#34;Arith.Add&#34;</span><span class="op" id="6544902">,</span>&nbsp;<span class="ident" id="6544904">args</span><span class="op" id="6544908">,</span>&nbsp;<span class="ident" id="6544910">reply</span><span class="op" id="6544915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6544919">if</span>&nbsp;<span class="ident" id="6544922">err</span>&nbsp;<span class="op" id="6544926">!=</span>&nbsp;<span class="ident" id="6544929">nil</span>&nbsp;<span class="op" id="6544933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6544938">t</span><span class="op" id="6544939">.</span><span class="ident" id="6544940">Errorf</span><span class="op" id="6544946">(</span><span class="string" id="6544947">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6544989">,</span>&nbsp;<span class="ident" id="6544991">err</span><span class="op" id="6544994">.</span><span class="ident" id="6544995">Error</span><span class="op" id="6545000">(</span><span class="op" id="6545001">)</span><span class="op" id="6545002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545010">if</span>&nbsp;<span class="ident" id="6545013">reply</span><span class="op" id="6545018">.</span><span class="ident" id="6545019">C</span>&nbsp;<span class="op" id="6545021">!=</span>&nbsp;<span class="ident" id="6545024">args</span><span class="op" id="6545028">.</span><span class="ident" id="6545029">A</span><span class="op" id="6545030">+</span><span class="ident" id="6545031">args</span><span class="op" id="6545035">.</span><span class="ident" id="6545036">B</span>&nbsp;<span class="op" id="6545038">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545043">t</span><span class="op" id="6545044">.</span><span class="ident" id="6545045">Errorf</span><span class="op" id="6545051">(</span><span class="string" id="6545052">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6545077">,</span>&nbsp;<span class="ident" id="6545079">reply</span><span class="op" id="6545084">.</span><span class="ident" id="6545085">C</span><span class="op" id="6545086">,</span>&nbsp;<span class="ident" id="6545088">args</span><span class="op" id="6545092">.</span><span class="ident" id="6545093">A</span><span class="op" id="6545094">+</span><span class="ident" id="6545095">args</span><span class="op" id="6545099">.</span><span class="ident" id="6545100">B</span><span class="op" id="6545101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545108">}</span><span class="op" id="6545109">)</span><br>
<span class="lineno"></span><span class="op" id="6545111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="6545114">func</span>&nbsp;<span class="ident" id="6545119">TestCountMallocs</span><span class="op" id="6545135">(</span><span class="ident" id="6545136">t</span>&nbsp;<span class="op" id="6545138">*</span><span class="ident" id="6545139">testing</span><span class="op" id="6545146">.</span><span class="ident" id="6545147">T</span><span class="op" id="6545148">)</span>&nbsp;<span class="op" id="6545150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545153">if</span>&nbsp;<span class="ident" id="6545156">testing</span><span class="op" id="6545163">.</span><span class="ident" id="6545164">Short</span><span class="op" id="6545169">(</span><span class="op" id="6545170">)</span>&nbsp;<span class="op" id="6545172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545176">t</span><span class="op" id="6545177">.</span><span class="ident" id="6545178">Skip</span><span class="op" id="6545182">(</span><span class="string" id="6545183">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6545220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545226">if</span>&nbsp;<span class="ident" id="6545229">runtime</span><span class="op" id="6545236">.</span><span class="ident" id="6545237">GOMAXPROCS</span><span class="op" id="6545247">(</span><span class="num" id="6545248">0</span><span class="op" id="6545249">)</span>&nbsp;<span class="op" id="6545251">&gt;</span>&nbsp;<span class="num" id="6545253">1</span>&nbsp;<span class="op" id="6545255">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545259">t</span><span class="op" id="6545260">.</span><span class="ident" id="6545261">Skip</span><span class="op" id="6545265">(</span><span class="string" id="6545266">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6545290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545296">fmt</span><span class="op" id="6545299">.</span><span class="ident" id="6545300">Printf</span><span class="op" id="6545306">(</span><span class="string" id="6545307">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6545341">,</span>&nbsp;<span class="ident" id="6545343">countMallocs</span><span class="op" id="6545355">(</span><span class="ident" id="6545356">dialDirect</span><span class="op" id="6545366">,</span>&nbsp;<span class="ident" id="6545368">t</span><span class="op" id="6545369">)</span><span class="op" id="6545370">)</span><br>
<span class="lineno"></span><span class="op" id="6545372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="6545375">func</span>&nbsp;<span class="ident" id="6545380">TestCountMallocsOverHTTP</span><span class="op" id="6545404">(</span><span class="ident" id="6545405">t</span>&nbsp;<span class="op" id="6545407">*</span><span class="ident" id="6545408">testing</span><span class="op" id="6545415">.</span><span class="ident" id="6545416">T</span><span class="op" id="6545417">)</span>&nbsp;<span class="op" id="6545419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545422">if</span>&nbsp;<span class="ident" id="6545425">testing</span><span class="op" id="6545432">.</span><span class="ident" id="6545433">Short</span><span class="op" id="6545438">(</span><span class="op" id="6545439">)</span>&nbsp;<span class="op" id="6545441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545445">t</span><span class="op" id="6545446">.</span><span class="ident" id="6545447">Skip</span><span class="op" id="6545451">(</span><span class="string" id="6545452">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6545489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545495">if</span>&nbsp;<span class="ident" id="6545498">runtime</span><span class="op" id="6545505">.</span><span class="ident" id="6545506">GOMAXPROCS</span><span class="op" id="6545516">(</span><span class="num" id="6545517">0</span><span class="op" id="6545518">)</span>&nbsp;<span class="op" id="6545520">&gt;</span>&nbsp;<span class="num" id="6545522">1</span>&nbsp;<span class="op" id="6545524">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545528">t</span><span class="op" id="6545529">.</span><span class="ident" id="6545530">Skip</span><span class="op" id="6545534">(</span><span class="string" id="6545535">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6545559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545565">fmt</span><span class="op" id="6545568">.</span><span class="ident" id="6545569">Printf</span><span class="op" id="6545575">(</span><span class="string" id="6545576">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6545615">,</span>&nbsp;<span class="ident" id="6545617">countMallocs</span><span class="op" id="6545629">(</span><span class="ident" id="6545630">dialHTTP</span><span class="op" id="6545638">,</span>&nbsp;<span class="ident" id="6545640">t</span><span class="op" id="6545641">)</span><span class="op" id="6545642">)</span><br>
<span class="lineno"></span><span class="op" id="6545644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="6545647">type</span>&nbsp;<span class="ident" id="6545652">writeCrasher</span>&nbsp;<span class="keyword" id="6545665">struct</span>&nbsp;<span class="op" id="6545672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545675">done</span>&nbsp;<span class="keyword" id="6545680">chan</span>&nbsp;<span class="builtintype" id="6545685">bool</span><br>
<span class="lineno"></span><span class="op" id="6545690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6545693">func</span>&nbsp;<span class="op" id="6545698">(</span><span class="ident" id="6545699">writeCrasher</span><span class="op" id="6545711">)</span>&nbsp;<span class="ident" id="6545713">Close</span><span class="op" id="6545718">(</span><span class="op" id="6545719">)</span>&nbsp;<span class="builtintype" id="6545721">error</span>&nbsp;<span class="op" id="6545727">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545730">return</span>&nbsp;<span class="ident" id="6545737">nil</span><br>
<span class="lineno"></span><span class="op" id="6545741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6545744">func</span>&nbsp;<span class="op" id="6545749">(</span><span class="ident" id="6545750">w</span>&nbsp;<span class="op" id="6545752">*</span><span class="ident" id="6545753">writeCrasher</span><span class="op" id="6545765">)</span>&nbsp;<span class="ident" id="6545767">Read</span><span class="op" id="6545771">(</span><span class="ident" id="6545772">p</span>&nbsp;<span class="op" id="6545774">[</span><span class="op" id="6545775">]</span><span class="builtintype" id="6545776">byte</span><span class="op" id="6545780">)</span>&nbsp;<span class="op" id="6545782">(</span><span class="builtintype" id="6545783">int</span><span class="op" id="6545786">,</span>&nbsp;<span class="builtintype" id="6545788">error</span><span class="op" id="6545793">)</span>&nbsp;<span class="op" id="6545795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6545798">&lt;-</span><span class="ident" id="6545800">w</span><span class="op" id="6545801">.</span><span class="ident" id="6545802">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545808">return</span>&nbsp;<span class="num" id="6545815">0</span><span class="op" id="6545816">,</span>&nbsp;<span class="ident" id="6545818">io</span><span class="op" id="6545820">.</span><span class="ident" id="6545821">EOF</span><br>
<span class="lineno"></span><span class="op" id="6545825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6545828">func</span>&nbsp;<span class="op" id="6545833">(</span><span class="ident" id="6545834">writeCrasher</span><span class="op" id="6545846">)</span>&nbsp;<span class="ident" id="6545848">Write</span><span class="op" id="6545853">(</span><span class="ident" id="6545854">p</span>&nbsp;<span class="op" id="6545856">[</span><span class="op" id="6545857">]</span><span class="builtintype" id="6545858">byte</span><span class="op" id="6545862">)</span>&nbsp;<span class="op" id="6545864">(</span><span class="builtintype" id="6545865">int</span><span class="op" id="6545868">,</span>&nbsp;<span class="builtintype" id="6545870">error</span><span class="op" id="6545875">)</span>&nbsp;<span class="op" id="6545877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6545880">return</span>&nbsp;<span class="num" id="6545887">0</span><span class="op" id="6545888">,</span>&nbsp;<span class="ident" id="6545890">errors</span><span class="op" id="6545896">.</span><span class="ident" id="6545897">New</span><span class="op" id="6545900">(</span><span class="string" id="6545901">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="6545921">)</span><br>
<span class="lineno">540</span><span class="op" id="6545923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6545926">func</span>&nbsp;<span class="ident" id="6545931">TestClientWriteError</span><span class="op" id="6545951">(</span><span class="ident" id="6545952">t</span>&nbsp;<span class="op" id="6545954">*</span><span class="ident" id="6545955">testing</span><span class="op" id="6545962">.</span><span class="ident" id="6545963">T</span><span class="op" id="6545964">)</span>&nbsp;<span class="op" id="6545966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6545969">w</span>&nbsp;<span class="op" id="6545971">:=</span>&nbsp;<span class="op" id="6545974">&amp;</span><span class="ident" id="6545975">writeCrasher</span><span class="op" id="6545987">{</span><span class="ident" id="6545988">done</span><span class="op" id="6545992">:</span>&nbsp;<span class="builtinfunc" id="6545994">make</span><span class="op" id="6545998">(</span><span class="keyword" id="6545999">chan</span>&nbsp;<span class="builtintype" id="6546004">bool</span><span class="op" id="6546008">)</span><span class="op" id="6546009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546012">c</span>&nbsp;<span class="op" id="6546014">:=</span>&nbsp;<span class="ident" id="6546017">NewClient</span><span class="op" id="6546026">(</span><span class="ident" id="6546027">w</span><span class="op" id="6546028">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546031">defer</span>&nbsp;<span class="ident" id="6546037">c</span><span class="op" id="6546038">.</span><span class="ident" id="6546039">Close</span><span class="op" id="6546044">(</span><span class="op" id="6546045">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546049">res</span>&nbsp;<span class="op" id="6546053">:=</span>&nbsp;<span class="builtintype" id="6546056">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546063">err</span>&nbsp;<span class="op" id="6546067">:=</span>&nbsp;<span class="ident" id="6546070">c</span><span class="op" id="6546071">.</span><span class="ident" id="6546072">Call</span><span class="op" id="6546076">(</span><span class="string" id="6546077">&#34;foo&#34;</span><span class="op" id="6546082">,</span>&nbsp;<span class="num" id="6546084">1</span><span class="op" id="6546085">,</span>&nbsp;<span class="op" id="6546087">&amp;</span><span class="ident" id="6546088">res</span><span class="op" id="6546091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546094">if</span>&nbsp;<span class="ident" id="6546097">err</span>&nbsp;<span class="op" id="6546101">==</span>&nbsp;<span class="ident" id="6546104">nil</span>&nbsp;<span class="op" id="6546108">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546112">t</span><span class="op" id="6546113">.</span><span class="ident" id="6546114">Fatal</span><span class="op" id="6546119">(</span><span class="string" id="6546120">&#34;expected&nbsp;error&#34;</span><span class="op" id="6546136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546142">if</span>&nbsp;<span class="ident" id="6546145">err</span><span class="op" id="6546148">.</span><span class="ident" id="6546149">Error</span><span class="op" id="6546154">(</span><span class="op" id="6546155">)</span>&nbsp;<span class="op" id="6546157">!=</span>&nbsp;<span class="string" id="6546160">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="6546181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546185">t</span><span class="op" id="6546186">.</span><span class="ident" id="6546187">Error</span><span class="op" id="6546192">(</span><span class="string" id="6546193">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="6546221">,</span>&nbsp;<span class="ident" id="6546223">err</span><span class="op" id="6546226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546229">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546232">w</span><span class="op" id="6546233">.</span><span class="ident" id="6546234">done</span>&nbsp;<span class="op" id="6546239">&lt;-</span>&nbsp;<span class="builtintype" id="6546242">true</span><br>
<span class="lineno"></span><span class="op" id="6546247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6546250">func</span>&nbsp;<span class="ident" id="6546255">TestTCPClose</span><span class="op" id="6546267">(</span><span class="ident" id="6546268">t</span>&nbsp;<span class="op" id="6546270">*</span><span class="ident" id="6546271">testing</span><span class="op" id="6546278">.</span><span class="ident" id="6546279">T</span><span class="op" id="6546280">)</span>&nbsp;<span class="op" id="6546282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546285">once</span><span class="op" id="6546289">.</span><span class="ident" id="6546290">Do</span><span class="op" id="6546292">(</span><span class="ident" id="6546293">startServer</span><span class="op" id="6546304">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546308">client</span><span class="op" id="6546314">,</span>&nbsp;<span class="ident" id="6546316">err</span>&nbsp;<span class="op" id="6546320">:=</span>&nbsp;<span class="ident" id="6546323">dialHTTP</span><span class="op" id="6546331">(</span><span class="op" id="6546332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546335">if</span>&nbsp;<span class="ident" id="6546338">err</span>&nbsp;<span class="op" id="6546342">!=</span>&nbsp;<span class="ident" id="6546345">nil</span>&nbsp;<span class="op" id="6546349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546353">t</span><span class="op" id="6546354">.</span><span class="ident" id="6546355">Fatalf</span><span class="op" id="6546361">(</span><span class="string" id="6546362">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6546375">,</span>&nbsp;<span class="ident" id="6546377">err</span><span class="op" id="6546380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546383">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546386">defer</span>&nbsp;<span class="ident" id="6546392">client</span><span class="op" id="6546398">.</span><span class="ident" id="6546399">Close</span><span class="op" id="6546404">(</span><span class="op" id="6546405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546409">args</span>&nbsp;<span class="op" id="6546414">:=</span>&nbsp;<span class="ident" id="6546417">Args</span><span class="op" id="6546421">{</span><span class="num" id="6546422">17</span><span class="op" id="6546424">,</span>&nbsp;<span class="num" id="6546426">8</span><span class="op" id="6546427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546430">var</span>&nbsp;<span class="ident" id="6546434">reply</span>&nbsp;<span class="ident" id="6546440">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546447">err</span>&nbsp;<span class="op" id="6546451">=</span>&nbsp;<span class="ident" id="6546453">client</span><span class="op" id="6546459">.</span><span class="ident" id="6546460">Call</span><span class="op" id="6546464">(</span><span class="string" id="6546465">&#34;Arith.Mul&#34;</span><span class="op" id="6546476">,</span>&nbsp;<span class="ident" id="6546478">args</span><span class="op" id="6546482">,</span>&nbsp;<span class="op" id="6546484">&amp;</span><span class="ident" id="6546485">reply</span><span class="op" id="6546490">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546493">if</span>&nbsp;<span class="ident" id="6546496">err</span>&nbsp;<span class="op" id="6546500">!=</span>&nbsp;<span class="ident" id="6546503">nil</span>&nbsp;<span class="op" id="6546507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546511">t</span><span class="op" id="6546512">.</span><span class="ident" id="6546513">Fatal</span><span class="op" id="6546518">(</span><span class="string" id="6546519">&#34;arith&nbsp;error:&#34;</span><span class="op" id="6546533">,</span>&nbsp;<span class="ident" id="6546535">err</span><span class="op" id="6546538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546544">t</span><span class="op" id="6546545">.</span><span class="ident" id="6546546">Logf</span><span class="op" id="6546550">(</span><span class="string" id="6546551">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="6546570">,</span>&nbsp;<span class="ident" id="6546572">args</span><span class="op" id="6546576">.</span><span class="ident" id="6546577">A</span><span class="op" id="6546578">,</span>&nbsp;<span class="ident" id="6546580">args</span><span class="op" id="6546584">.</span><span class="ident" id="6546585">B</span><span class="op" id="6546586">,</span>&nbsp;<span class="ident" id="6546588">reply</span><span class="op" id="6546593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546596">if</span>&nbsp;<span class="ident" id="6546599">reply</span><span class="op" id="6546604">.</span><span class="ident" id="6546605">C</span>&nbsp;<span class="op" id="6546607">!=</span>&nbsp;<span class="ident" id="6546610">args</span><span class="op" id="6546614">.</span><span class="ident" id="6546615">A</span><span class="op" id="6546616">*</span><span class="ident" id="6546617">args</span><span class="op" id="6546621">.</span><span class="ident" id="6546622">B</span>&nbsp;<span class="op" id="6546624">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546628">t</span><span class="op" id="6546629">.</span><span class="ident" id="6546630">Errorf</span><span class="op" id="6546636">(</span><span class="string" id="6546637">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6546662">,</span>&nbsp;<span class="ident" id="6546664">reply</span><span class="op" id="6546669">.</span><span class="ident" id="6546670">C</span><span class="op" id="6546671">,</span>&nbsp;<span class="ident" id="6546673">args</span><span class="op" id="6546677">.</span><span class="ident" id="6546678">A</span><span class="op" id="6546679">*</span><span class="ident" id="6546680">args</span><span class="op" id="6546684">.</span><span class="ident" id="6546685">B</span><span class="op" id="6546686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546689">}</span><br>
<span class="lineno"></span><span class="op" id="6546691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6546694">func</span>&nbsp;<span class="ident" id="6546699">TestErrorAfterClientClose</span><span class="op" id="6546724">(</span><span class="ident" id="6546725">t</span>&nbsp;<span class="op" id="6546727">*</span><span class="ident" id="6546728">testing</span><span class="op" id="6546735">.</span><span class="ident" id="6546736">T</span><span class="op" id="6546737">)</span>&nbsp;<span class="op" id="6546739">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546742">once</span><span class="op" id="6546746">.</span><span class="ident" id="6546747">Do</span><span class="op" id="6546749">(</span><span class="ident" id="6546750">startServer</span><span class="op" id="6546761">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546765">client</span><span class="op" id="6546771">,</span>&nbsp;<span class="ident" id="6546773">err</span>&nbsp;<span class="op" id="6546777">:=</span>&nbsp;<span class="ident" id="6546780">dialHTTP</span><span class="op" id="6546788">(</span><span class="op" id="6546789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546792">if</span>&nbsp;<span class="ident" id="6546795">err</span>&nbsp;<span class="op" id="6546799">!=</span>&nbsp;<span class="ident" id="6546802">nil</span>&nbsp;<span class="op" id="6546806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546810">t</span><span class="op" id="6546811">.</span><span class="ident" id="6546812">Fatalf</span><span class="op" id="6546818">(</span><span class="string" id="6546819">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6546832">,</span>&nbsp;<span class="ident" id="6546834">err</span><span class="op" id="6546837">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546843">err</span>&nbsp;<span class="op" id="6546847">=</span>&nbsp;<span class="ident" id="6546849">client</span><span class="op" id="6546855">.</span><span class="ident" id="6546856">Close</span><span class="op" id="6546861">(</span><span class="op" id="6546862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546865">if</span>&nbsp;<span class="ident" id="6546868">err</span>&nbsp;<span class="op" id="6546872">!=</span>&nbsp;<span class="ident" id="6546875">nil</span>&nbsp;<span class="op" id="6546879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546883">t</span><span class="op" id="6546884">.</span><span class="ident" id="6546885">Fatal</span><span class="op" id="6546890">(</span><span class="string" id="6546891">&#34;close&nbsp;error:&#34;</span><span class="op" id="6546905">,</span>&nbsp;<span class="ident" id="6546907">err</span><span class="op" id="6546910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546913">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546916">err</span>&nbsp;<span class="op" id="6546920">=</span>&nbsp;<span class="ident" id="6546922">client</span><span class="op" id="6546928">.</span><span class="ident" id="6546929">Call</span><span class="op" id="6546933">(</span><span class="string" id="6546934">&#34;Arith.Add&#34;</span><span class="op" id="6546945">,</span>&nbsp;<span class="op" id="6546947">&amp;</span><span class="ident" id="6546948">Args</span><span class="op" id="6546952">{</span><span class="num" id="6546953">7</span><span class="op" id="6546954">,</span>&nbsp;<span class="num" id="6546956">9</span><span class="op" id="6546957">}</span><span class="op" id="6546958">,</span>&nbsp;<span class="builtinfunc" id="6546960">new</span><span class="op" id="6546963">(</span><span class="ident" id="6546964">Reply</span><span class="op" id="6546969">)</span><span class="op" id="6546970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546973">if</span>&nbsp;<span class="ident" id="6546976">err</span>&nbsp;<span class="op" id="6546980">!=</span>&nbsp;<span class="ident" id="6546983">ErrShutdown</span>&nbsp;<span class="op" id="6546995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546999">t</span><span class="op" id="6547000">.</span><span class="ident" id="6547001">Errorf</span><span class="op" id="6547007">(</span><span class="string" id="6547008">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6547046">,</span>&nbsp;<span class="ident" id="6547048">err</span><span class="op" id="6547051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547054">}</span><br>
<span class="lineno"></span><span class="op" id="6547056">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="6547059">func</span>&nbsp;<span class="ident" id="6547064">benchmarkEndToEnd</span><span class="op" id="6547081">(</span><span class="ident" id="6547082">dial</span>&nbsp;<span class="keyword" id="6547087">func</span><span class="op" id="6547091">(</span><span class="op" id="6547092">)</span>&nbsp;<span class="op" id="6547094">(</span><span class="op" id="6547095">*</span><span class="ident" id="6547096">Client</span><span class="op" id="6547102">,</span>&nbsp;<span class="builtintype" id="6547104">error</span><span class="op" id="6547109">)</span><span class="op" id="6547110">,</span>&nbsp;<span class="ident" id="6547112">b</span>&nbsp;<span class="op" id="6547114">*</span><span class="ident" id="6547115">testing</span><span class="op" id="6547122">.</span><span class="ident" id="6547123">B</span><span class="op" id="6547124">)</span>&nbsp;<span class="op" id="6547126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547129">once</span><span class="op" id="6547133">.</span><span class="ident" id="6547134">Do</span><span class="op" id="6547136">(</span><span class="ident" id="6547137">startServer</span><span class="op" id="6547148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547151">client</span><span class="op" id="6547157">,</span>&nbsp;<span class="ident" id="6547159">err</span>&nbsp;<span class="op" id="6547163">:=</span>&nbsp;<span class="ident" id="6547166">dial</span><span class="op" id="6547170">(</span><span class="op" id="6547171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547174">if</span>&nbsp;<span class="ident" id="6547177">err</span>&nbsp;<span class="op" id="6547181">!=</span>&nbsp;<span class="ident" id="6547184">nil</span>&nbsp;<span class="op" id="6547188">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547192">b</span><span class="op" id="6547193">.</span><span class="ident" id="6547194">Fatal</span><span class="op" id="6547199">(</span><span class="string" id="6547200">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6547216">,</span>&nbsp;<span class="ident" id="6547218">err</span><span class="op" id="6547221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547227">defer</span>&nbsp;<span class="ident" id="6547233">client</span><span class="op" id="6547239">.</span><span class="ident" id="6547240">Close</span><span class="op" id="6547245">(</span><span class="op" id="6547246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6547250">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547272">args</span>&nbsp;<span class="op" id="6547277">:=</span>&nbsp;<span class="op" id="6547280">&amp;</span><span class="ident" id="6547281">Args</span><span class="op" id="6547285">{</span><span class="num" id="6547286">7</span><span class="op" id="6547287">,</span>&nbsp;<span class="num" id="6547289">8</span><span class="op" id="6547290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547293">b</span><span class="op" id="6547294">.</span><span class="ident" id="6547295">ResetTimer</span><span class="op" id="6547305">(</span><span class="op" id="6547306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547310">b</span><span class="op" id="6547311">.</span><span class="ident" id="6547312">RunParallel</span><span class="op" id="6547323">(</span><span class="keyword" id="6547324">func</span><span class="op" id="6547328">(</span><span class="ident" id="6547329">pb</span>&nbsp;<span class="op" id="6547332">*</span><span class="ident" id="6547333">testing</span><span class="op" id="6547340">.</span><span class="ident" id="6547341">PB</span><span class="op" id="6547343">)</span>&nbsp;<span class="op" id="6547345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547349">reply</span>&nbsp;<span class="op" id="6547355">:=</span>&nbsp;<span class="builtinfunc" id="6547358">new</span><span class="op" id="6547361">(</span><span class="ident" id="6547362">Reply</span><span class="op" id="6547367">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547371">for</span>&nbsp;<span class="ident" id="6547375">pb</span><span class="op" id="6547377">.</span><span class="ident" id="6547378">Next</span><span class="op" id="6547382">(</span><span class="op" id="6547383">)</span>&nbsp;<span class="op" id="6547385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547390">err</span>&nbsp;<span class="op" id="6547394">:=</span>&nbsp;<span class="ident" id="6547397">client</span><span class="op" id="6547403">.</span><span class="ident" id="6547404">Call</span><span class="op" id="6547408">(</span><span class="string" id="6547409">&#34;Arith.Add&#34;</span><span class="op" id="6547420">,</span>&nbsp;<span class="ident" id="6547422">args</span><span class="op" id="6547426">,</span>&nbsp;<span class="ident" id="6547428">reply</span><span class="op" id="6547433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547438">if</span>&nbsp;<span class="ident" id="6547441">err</span>&nbsp;<span class="op" id="6547445">!=</span>&nbsp;<span class="ident" id="6547448">nil</span>&nbsp;<span class="op" id="6547452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547458">b</span><span class="op" id="6547459">.</span><span class="ident" id="6547460">Fatalf</span><span class="op" id="6547466">(</span><span class="string" id="6547467">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6547520">,</span>&nbsp;<span class="ident" id="6547522">err</span><span class="op" id="6547525">.</span><span class="ident" id="6547526">Error</span><span class="op" id="6547531">(</span><span class="op" id="6547532">)</span><span class="op" id="6547533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547538">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547543">if</span>&nbsp;<span class="ident" id="6547546">reply</span><span class="op" id="6547551">.</span><span class="ident" id="6547552">C</span>&nbsp;<span class="op" id="6547554">!=</span>&nbsp;<span class="ident" id="6547557">args</span><span class="op" id="6547561">.</span><span class="ident" id="6547562">A</span><span class="op" id="6547563">+</span><span class="ident" id="6547564">args</span><span class="op" id="6547568">.</span><span class="ident" id="6547569">B</span>&nbsp;<span class="op" id="6547571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547577">b</span><span class="op" id="6547578">.</span><span class="ident" id="6547579">Fatalf</span><span class="op" id="6547585">(</span><span class="string" id="6547586">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6547622">,</span>&nbsp;<span class="ident" id="6547624">reply</span><span class="op" id="6547629">.</span><span class="ident" id="6547630">C</span><span class="op" id="6547631">,</span>&nbsp;<span class="ident" id="6547633">args</span><span class="op" id="6547637">.</span><span class="ident" id="6547638">A</span><span class="op" id="6547639">+</span><span class="ident" id="6547640">args</span><span class="op" id="6547644">.</span><span class="ident" id="6547645">B</span><span class="op" id="6547646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547658">}</span><span class="op" id="6547659">)</span><br>
<span class="lineno">620</span><span class="op" id="6547661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6547664">func</span>&nbsp;<span class="ident" id="6547669">benchmarkEndToEndAsync</span><span class="op" id="6547691">(</span><span class="ident" id="6547692">dial</span>&nbsp;<span class="keyword" id="6547697">func</span><span class="op" id="6547701">(</span><span class="op" id="6547702">)</span>&nbsp;<span class="op" id="6547704">(</span><span class="op" id="6547705">*</span><span class="ident" id="6547706">Client</span><span class="op" id="6547712">,</span>&nbsp;<span class="builtintype" id="6547714">error</span><span class="op" id="6547719">)</span><span class="op" id="6547720">,</span>&nbsp;<span class="ident" id="6547722">b</span>&nbsp;<span class="op" id="6547724">*</span><span class="ident" id="6547725">testing</span><span class="op" id="6547732">.</span><span class="ident" id="6547733">B</span><span class="op" id="6547734">)</span>&nbsp;<span class="op" id="6547736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547739">const</span>&nbsp;<span class="ident" id="6547745">MaxConcurrentCalls</span>&nbsp;<span class="op" id="6547764">=</span>&nbsp;<span class="num" id="6547766">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547771">once</span><span class="op" id="6547775">.</span><span class="ident" id="6547776">Do</span><span class="op" id="6547778">(</span><span class="ident" id="6547779">startServer</span><span class="op" id="6547790">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547793">client</span><span class="op" id="6547799">,</span>&nbsp;<span class="ident" id="6547801">err</span>&nbsp;<span class="op" id="6547805">:=</span>&nbsp;<span class="ident" id="6547808">dial</span><span class="op" id="6547812">(</span><span class="op" id="6547813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547816">if</span>&nbsp;<span class="ident" id="6547819">err</span>&nbsp;<span class="op" id="6547823">!=</span>&nbsp;<span class="ident" id="6547826">nil</span>&nbsp;<span class="op" id="6547830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547834">b</span><span class="op" id="6547835">.</span><span class="ident" id="6547836">Fatal</span><span class="op" id="6547841">(</span><span class="string" id="6547842">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6547858">,</span>&nbsp;<span class="ident" id="6547860">err</span><span class="op" id="6547863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547869">defer</span>&nbsp;<span class="ident" id="6547875">client</span><span class="op" id="6547881">.</span><span class="ident" id="6547882">Close</span><span class="op" id="6547887">(</span><span class="op" id="6547888">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6547892">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547915">args</span>&nbsp;<span class="op" id="6547920">:=</span>&nbsp;<span class="op" id="6547923">&amp;</span><span class="ident" id="6547924">Args</span><span class="op" id="6547928">{</span><span class="num" id="6547929">7</span><span class="op" id="6547930">,</span>&nbsp;<span class="num" id="6547932">8</span><span class="op" id="6547933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547936">procs</span>&nbsp;<span class="op" id="6547942">:=</span>&nbsp;<span class="num" id="6547945">4</span>&nbsp;<span class="op" id="6547947">*</span>&nbsp;<span class="ident" id="6547949">runtime</span><span class="op" id="6547956">.</span><span class="ident" id="6547957">GOMAXPROCS</span><span class="op" id="6547967">(</span><span class="op" id="6547968">-</span><span class="num" id="6547969">1</span><span class="op" id="6547970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547973">send</span>&nbsp;<span class="op" id="6547978">:=</span>&nbsp;<span class="builtintype" id="6547981">int32</span><span class="op" id="6547986">(</span><span class="ident" id="6547987">b</span><span class="op" id="6547988">.</span><span class="ident" id="6547989">N</span><span class="op" id="6547990">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547993">recv</span>&nbsp;<span class="op" id="6547998">:=</span>&nbsp;<span class="builtintype" id="6548001">int32</span><span class="op" id="6548006">(</span><span class="ident" id="6548007">b</span><span class="op" id="6548008">.</span><span class="ident" id="6548009">N</span><span class="op" id="6548010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548013">var</span>&nbsp;<span class="ident" id="6548017">wg</span>&nbsp;<span class="ident" id="6548020">sync</span><span class="op" id="6548024">.</span><span class="ident" id="6548025">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548036">wg</span><span class="op" id="6548038">.</span><span class="ident" id="6548039">Add</span><span class="op" id="6548042">(</span><span class="ident" id="6548043">procs</span><span class="op" id="6548048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548051">gate</span>&nbsp;<span class="op" id="6548056">:=</span>&nbsp;<span class="builtinfunc" id="6548059">make</span><span class="op" id="6548063">(</span><span class="keyword" id="6548064">chan</span>&nbsp;<span class="builtintype" id="6548069">bool</span><span class="op" id="6548073">,</span>&nbsp;<span class="ident" id="6548075">MaxConcurrentCalls</span><span class="op" id="6548093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548096">res</span>&nbsp;<span class="op" id="6548100">:=</span>&nbsp;<span class="builtinfunc" id="6548103">make</span><span class="op" id="6548107">(</span><span class="keyword" id="6548108">chan</span>&nbsp;<span class="op" id="6548113">*</span><span class="ident" id="6548114">Call</span><span class="op" id="6548118">,</span>&nbsp;<span class="ident" id="6548120">MaxConcurrentCalls</span><span class="op" id="6548138">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548141">b</span><span class="op" id="6548142">.</span><span class="ident" id="6548143">ResetTimer</span><span class="op" id="6548153">(</span><span class="op" id="6548154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548158">for</span>&nbsp;<span class="ident" id="6548162">p</span>&nbsp;<span class="op" id="6548164">:=</span>&nbsp;<span class="num" id="6548167">0</span><span class="op" id="6548168">;</span>&nbsp;<span class="ident" id="6548170">p</span>&nbsp;<span class="op" id="6548172">&lt;</span>&nbsp;<span class="ident" id="6548174">procs</span><span class="op" id="6548179">;</span>&nbsp;<span class="ident" id="6548181">p</span><span class="op" id="6548182">++</span>&nbsp;<span class="op" id="6548185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548189">go</span>&nbsp;<span class="keyword" id="6548192">func</span><span class="op" id="6548196">(</span><span class="op" id="6548197">)</span>&nbsp;<span class="op" id="6548199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548204">for</span>&nbsp;<span class="ident" id="6548208">atomic</span><span class="op" id="6548214">.</span><span class="ident" id="6548215">AddInt32</span><span class="op" id="6548223">(</span><span class="op" id="6548224">&amp;</span><span class="ident" id="6548225">send</span><span class="op" id="6548229">,</span>&nbsp;<span class="op" id="6548231">-</span><span class="num" id="6548232">1</span><span class="op" id="6548233">)</span>&nbsp;<span class="op" id="6548235">&gt;=</span>&nbsp;<span class="num" id="6548238">0</span>&nbsp;<span class="op" id="6548240">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548246">gate</span>&nbsp;<span class="op" id="6548251">&lt;-</span>&nbsp;<span class="builtintype" id="6548254">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548263">reply</span>&nbsp;<span class="op" id="6548269">:=</span>&nbsp;<span class="builtinfunc" id="6548272">new</span><span class="op" id="6548275">(</span><span class="ident" id="6548276">Reply</span><span class="op" id="6548281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548287">client</span><span class="op" id="6548293">.</span><span class="ident" id="6548294">Go</span><span class="op" id="6548296">(</span><span class="string" id="6548297">&#34;Arith.Add&#34;</span><span class="op" id="6548308">,</span>&nbsp;<span class="ident" id="6548310">args</span><span class="op" id="6548314">,</span>&nbsp;<span class="ident" id="6548316">reply</span><span class="op" id="6548321">,</span>&nbsp;<span class="ident" id="6548323">res</span><span class="op" id="6548326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548335">}</span><span class="op" id="6548336">(</span><span class="op" id="6548337">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548341">go</span>&nbsp;<span class="keyword" id="6548344">func</span><span class="op" id="6548348">(</span><span class="op" id="6548349">)</span>&nbsp;<span class="op" id="6548351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548356">for</span>&nbsp;<span class="ident" id="6548360">call</span>&nbsp;<span class="op" id="6548365">:=</span>&nbsp;<span class="keyword" id="6548368">range</span>&nbsp;<span class="ident" id="6548374">res</span>&nbsp;<span class="op" id="6548378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548384">A</span>&nbsp;<span class="op" id="6548386">:=</span>&nbsp;<span class="ident" id="6548389">call</span><span class="op" id="6548393">.</span><span class="ident" id="6548394">Args</span><span class="op" id="6548398">.</span><span class="op" id="6548399">(</span><span class="op" id="6548400">*</span><span class="ident" id="6548401">Args</span><span class="op" id="6548405">)</span><span class="op" id="6548406">.</span><span class="ident" id="6548407">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548413">B</span>&nbsp;<span class="op" id="6548415">:=</span>&nbsp;<span class="ident" id="6548418">call</span><span class="op" id="6548422">.</span><span class="ident" id="6548423">Args</span><span class="op" id="6548427">.</span><span class="op" id="6548428">(</span><span class="op" id="6548429">*</span><span class="ident" id="6548430">Args</span><span class="op" id="6548434">)</span><span class="op" id="6548435">.</span><span class="ident" id="6548436">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548442">C</span>&nbsp;<span class="op" id="6548444">:=</span>&nbsp;<span class="ident" id="6548447">call</span><span class="op" id="6548451">.</span><span class="ident" id="6548452">Reply</span><span class="op" id="6548457">.</span><span class="op" id="6548458">(</span><span class="op" id="6548459">*</span><span class="ident" id="6548460">Reply</span><span class="op" id="6548465">)</span><span class="op" id="6548466">.</span><span class="ident" id="6548467">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548473">if</span>&nbsp;<span class="ident" id="6548476">A</span><span class="op" id="6548477">+</span><span class="ident" id="6548478">B</span>&nbsp;<span class="op" id="6548480">!=</span>&nbsp;<span class="ident" id="6548483">C</span>&nbsp;<span class="op" id="6548485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548492">b</span><span class="op" id="6548493">.</span><span class="ident" id="6548494">Fatalf</span><span class="op" id="6548500">(</span><span class="string" id="6548501">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6548543">,</span>&nbsp;<span class="ident" id="6548545">A</span><span class="op" id="6548546">+</span><span class="ident" id="6548547">B</span><span class="op" id="6548548">,</span>&nbsp;<span class="ident" id="6548550">C</span><span class="op" id="6548551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548563">&lt;-</span><span class="ident" id="6548565">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548574">if</span>&nbsp;<span class="ident" id="6548577">atomic</span><span class="op" id="6548583">.</span><span class="ident" id="6548584">AddInt32</span><span class="op" id="6548592">(</span><span class="op" id="6548593">&amp;</span><span class="ident" id="6548594">recv</span><span class="op" id="6548598">,</span>&nbsp;<span class="op" id="6548600">-</span><span class="num" id="6548601">1</span><span class="op" id="6548602">)</span>&nbsp;<span class="op" id="6548604">==</span>&nbsp;<span class="num" id="6548607">0</span>&nbsp;<span class="op" id="6548609">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6548616">close</span><span class="op" id="6548621">(</span><span class="ident" id="6548622">res</span><span class="op" id="6548625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548641">wg</span><span class="op" id="6548643">.</span><span class="ident" id="6548644">Done</span><span class="op" id="6548648">(</span><span class="op" id="6548649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548653">}</span><span class="op" id="6548654">(</span><span class="op" id="6548655">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548661">wg</span><span class="op" id="6548663">.</span><span class="ident" id="6548664">Wait</span><span class="op" id="6548668">(</span><span class="op" id="6548669">)</span><br>
<span class="lineno"></span><span class="op" id="6548671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6548674">func</span>&nbsp;<span class="ident" id="6548679">BenchmarkEndToEnd</span><span class="op" id="6548696">(</span><span class="ident" id="6548697">b</span>&nbsp;<span class="op" id="6548699">*</span><span class="ident" id="6548700">testing</span><span class="op" id="6548707">.</span><span class="ident" id="6548708">B</span><span class="op" id="6548709">)</span>&nbsp;<span class="op" id="6548711">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548714">benchmarkEndToEnd</span><span class="op" id="6548731">(</span><span class="ident" id="6548732">dialDirect</span><span class="op" id="6548742">,</span>&nbsp;<span class="ident" id="6548744">b</span><span class="op" id="6548745">)</span><br>
<span class="lineno"></span><span class="op" id="6548747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6548750">func</span>&nbsp;<span class="ident" id="6548755">BenchmarkEndToEndHTTP</span><span class="op" id="6548776">(</span><span class="ident" id="6548777">b</span>&nbsp;<span class="op" id="6548779">*</span><span class="ident" id="6548780">testing</span><span class="op" id="6548787">.</span><span class="ident" id="6548788">B</span><span class="op" id="6548789">)</span>&nbsp;<span class="op" id="6548791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548794">benchmarkEndToEnd</span><span class="op" id="6548811">(</span><span class="ident" id="6548812">dialHTTP</span><span class="op" id="6548820">,</span>&nbsp;<span class="ident" id="6548822">b</span><span class="op" id="6548823">)</span><br>
<span class="lineno">675</span><span class="op" id="6548825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6548828">func</span>&nbsp;<span class="ident" id="6548833">BenchmarkEndToEndAsync</span><span class="op" id="6548855">(</span><span class="ident" id="6548856">b</span>&nbsp;<span class="op" id="6548858">*</span><span class="ident" id="6548859">testing</span><span class="op" id="6548866">.</span><span class="ident" id="6548867">B</span><span class="op" id="6548868">)</span>&nbsp;<span class="op" id="6548870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548873">benchmarkEndToEndAsync</span><span class="op" id="6548895">(</span><span class="ident" id="6548896">dialDirect</span><span class="op" id="6548906">,</span>&nbsp;<span class="ident" id="6548908">b</span><span class="op" id="6548909">)</span><br>
<span class="lineno"></span><span class="op" id="6548911">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="6548914">func</span>&nbsp;<span class="ident" id="6548919">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="6548945">(</span><span class="ident" id="6548946">b</span>&nbsp;<span class="op" id="6548948">*</span><span class="ident" id="6548949">testing</span><span class="op" id="6548956">.</span><span class="ident" id="6548957">B</span><span class="op" id="6548958">)</span>&nbsp;<span class="op" id="6548960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548963">benchmarkEndToEndAsync</span><span class="op" id="6548985">(</span><span class="ident" id="6548986">dialHTTP</span><span class="op" id="6548994">,</span>&nbsp;<span class="ident" id="6548996">b</span><span class="op" id="6548997">)</span><br>
<span class="lineno"></span><span class="op" id="6548999">}</span>
</div>
</body>
</html>
