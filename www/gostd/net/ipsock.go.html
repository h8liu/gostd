<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3333959">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3334015">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3334069">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3334120">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334157">package</span>&nbsp;<span class="ident" id="3334165">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334170">import</span>&nbsp;<span class="op" id="3334177">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3334180">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3334190">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3334197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334200">var</span>&nbsp;<span class="op" id="3334204">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334207">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334267">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334297">supportsIPv4</span>&nbsp;<span class="builtintype" id="3334310">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334317">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334377">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334407">supportsIPv6</span>&nbsp;<span class="builtintype" id="3334420">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334427">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334485">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334549">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334608">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3334624">bool</span><br>
<span class="lineno"></span><span class="op" id="3334629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334632">func</span>&nbsp;<span class="ident" id="3334637">init</span><span class="op" id="3334641">(</span><span class="op" id="3334642">)</span>&nbsp;<span class="op" id="3334644">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334647">sysInit</span><span class="op" id="3334654">(</span><span class="op" id="3334655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334658">supportsIPv4</span>&nbsp;<span class="op" id="3334671">=</span>&nbsp;<span class="ident" id="3334673">probeIPv4Stack</span><span class="op" id="3334687">(</span><span class="op" id="3334688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334691">supportsIPv6</span><span class="op" id="3334703">,</span>&nbsp;<span class="ident" id="3334705">supportsIPv4map</span>&nbsp;<span class="op" id="3334721">=</span>&nbsp;<span class="ident" id="3334723">probeIPv6Stack</span><span class="op" id="3334737">(</span><span class="op" id="3334738">)</span><br>
<span class="lineno"></span><span class="op" id="3334740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3334743">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3334807">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3334838">type</span>&nbsp;<span class="ident" id="3334843">netaddr</span>&nbsp;<span class="keyword" id="3334851">interface</span>&nbsp;<span class="op" id="3334861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334864">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334926">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334982">toAddr</span><span class="op" id="3334988">(</span><span class="op" id="3334989">)</span>&nbsp;<span class="ident" id="3334991">Addr</span><br>
<span class="lineno"></span><span class="op" id="3334996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3334999">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3335063">type</span>&nbsp;<span class="ident" id="3335068">addrList</span>&nbsp;<span class="op" id="3335077">[</span><span class="op" id="3335078">]</span><span class="ident" id="3335079">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3335088">func</span>&nbsp;<span class="op" id="3335093">(</span><span class="ident" id="3335094">al</span>&nbsp;<span class="ident" id="3335097">addrList</span><span class="op" id="3335105">)</span>&nbsp;<span class="ident" id="3335107">toAddr</span><span class="op" id="3335113">(</span><span class="op" id="3335114">)</span>&nbsp;<span class="ident" id="3335116">Addr</span>&nbsp;<span class="op" id="3335121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335124">switch</span>&nbsp;<span class="builtinfunc" id="3335131">len</span><span class="op" id="3335134">(</span><span class="ident" id="3335135">al</span><span class="op" id="3335137">)</span>&nbsp;<span class="op" id="3335139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335142">case</span>&nbsp;<span class="num" id="3335147">0</span><span class="op" id="3335148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335152">return</span>&nbsp;<span class="ident" id="3335159">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335164">case</span>&nbsp;<span class="num" id="3335169">1</span><span class="op" id="3335170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335174">return</span>&nbsp;<span class="ident" id="3335181">al</span><span class="op" id="3335183">[</span><span class="num" id="3335184">0</span><span class="op" id="3335185">]</span><span class="op" id="3335186">.</span><span class="ident" id="3335187">toAddr</span><span class="op" id="3335193">(</span><span class="op" id="3335194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335197">default</span><span class="op" id="3335204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335208">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335259">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335313">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335367">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335385">return</span>&nbsp;<span class="ident" id="3335392">al</span><span class="op" id="3335394">[</span><span class="num" id="3335395">0</span><span class="op" id="3335396">]</span><span class="op" id="3335397">.</span><span class="ident" id="3335398">toAddr</span><span class="op" id="3335404">(</span><span class="op" id="3335405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335408">}</span><br>
<span class="lineno"></span><span class="op" id="3335410">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3335413">var</span>&nbsp;<span class="ident" id="3335417">errNoSuitableAddress</span>&nbsp;<span class="op" id="3335438">=</span>&nbsp;<span class="ident" id="3335440">errors</span><span class="op" id="3335446">.</span><span class="ident" id="3335447">New</span><span class="op" id="3335450">(</span><span class="string" id="3335451">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3335478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3335481">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3335549">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3335617">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3335688">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3335740">func</span>&nbsp;<span class="ident" id="3335745">firstFavoriteAddr</span><span class="op" id="3335762">(</span><span class="ident" id="3335763">filter</span>&nbsp;<span class="keyword" id="3335770">func</span><span class="op" id="3335774">(</span><span class="ident" id="3335775">IP</span><span class="op" id="3335777">)</span>&nbsp;<span class="ident" id="3335779">IP</span><span class="op" id="3335781">,</span>&nbsp;<span class="ident" id="3335783">ips</span>&nbsp;<span class="op" id="3335787">[</span><span class="op" id="3335788">]</span><span class="ident" id="3335789">IP</span><span class="op" id="3335791">,</span>&nbsp;<span class="ident" id="3335793">inetaddr</span>&nbsp;<span class="keyword" id="3335802">func</span><span class="op" id="3335806">(</span><span class="ident" id="3335807">IP</span><span class="op" id="3335809">)</span>&nbsp;<span class="ident" id="3335811">netaddr</span><span class="op" id="3335818">)</span>&nbsp;<span class="op" id="3335820">(</span><span class="ident" id="3335821">netaddr</span><span class="op" id="3335828">,</span>&nbsp;<span class="builtintype" id="3335830">error</span><span class="op" id="3335835">)</span>&nbsp;<span class="op" id="3335837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335840">if</span>&nbsp;<span class="ident" id="3335843">filter</span>&nbsp;<span class="op" id="3335850">!=</span>&nbsp;<span class="ident" id="3335853">nil</span>&nbsp;<span class="op" id="3335857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335861">return</span>&nbsp;<span class="ident" id="3335868">firstSupportedAddr</span><span class="op" id="3335886">(</span><span class="ident" id="3335887">filter</span><span class="op" id="3335893">,</span>&nbsp;<span class="ident" id="3335895">ips</span><span class="op" id="3335898">,</span>&nbsp;<span class="ident" id="3335900">inetaddr</span><span class="op" id="3335908">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335914">var</span>&nbsp;<span class="op" id="3335918">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335922">ipv4</span><span class="op" id="3335926">,</span>&nbsp;<span class="ident" id="3335928">ipv6</span><span class="op" id="3335932">,</span>&nbsp;<span class="ident" id="3335934">swap</span>&nbsp;<span class="builtintype" id="3335939">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335946">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335963">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335973">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335976">for</span>&nbsp;<span class="ident" id="3335980">_</span><span class="op" id="3335981">,</span>&nbsp;<span class="ident" id="3335983">ip</span>&nbsp;<span class="op" id="3335986">:=</span>&nbsp;<span class="keyword" id="3335989">range</span>&nbsp;<span class="ident" id="3335995">ips</span>&nbsp;<span class="op" id="3335999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336003">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336057">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336103">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336154">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336210">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336265">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336317">if</span>&nbsp;<span class="ident" id="3336320">ip4</span>&nbsp;<span class="op" id="3336324">:=</span>&nbsp;<span class="ident" id="3336327">ipv4only</span><span class="op" id="3336335">(</span><span class="ident" id="3336336">ip</span><span class="op" id="3336338">)</span><span class="op" id="3336339">;</span>&nbsp;<span class="ident" id="3336341">ip4</span>&nbsp;<span class="op" id="3336345">!=</span>&nbsp;<span class="ident" id="3336348">nil</span>&nbsp;<span class="op" id="3336352">&amp;&amp;</span>&nbsp;<span class="op" id="3336355">!</span><span class="ident" id="3336356">ipv4</span>&nbsp;<span class="op" id="3336361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336366">list</span>&nbsp;<span class="op" id="3336371">=</span>&nbsp;<span class="builtinfunc" id="3336373">append</span><span class="op" id="3336379">(</span><span class="ident" id="3336380">list</span><span class="op" id="3336384">,</span>&nbsp;<span class="ident" id="3336386">inetaddr</span><span class="op" id="3336394">(</span><span class="ident" id="3336395">ip4</span><span class="op" id="3336398">)</span><span class="op" id="3336399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336404">ipv4</span>&nbsp;<span class="op" id="3336409">=</span>&nbsp;<span class="builtintype" id="3336411">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336419">if</span>&nbsp;<span class="ident" id="3336422">ipv6</span>&nbsp;<span class="op" id="3336427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336433">swap</span>&nbsp;<span class="op" id="3336438">=</span>&nbsp;<span class="builtintype" id="3336440">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336452">}</span>&nbsp;<span class="keyword" id="3336454">else</span>&nbsp;<span class="keyword" id="3336459">if</span>&nbsp;<span class="ident" id="3336462">ip6</span>&nbsp;<span class="op" id="3336466">:=</span>&nbsp;<span class="ident" id="3336469">ipv6only</span><span class="op" id="3336477">(</span><span class="ident" id="3336478">ip</span><span class="op" id="3336480">)</span><span class="op" id="3336481">;</span>&nbsp;<span class="ident" id="3336483">ip6</span>&nbsp;<span class="op" id="3336487">!=</span>&nbsp;<span class="ident" id="3336490">nil</span>&nbsp;<span class="op" id="3336494">&amp;&amp;</span>&nbsp;<span class="op" id="3336497">!</span><span class="ident" id="3336498">ipv6</span>&nbsp;<span class="op" id="3336503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336508">list</span>&nbsp;<span class="op" id="3336513">=</span>&nbsp;<span class="builtinfunc" id="3336515">append</span><span class="op" id="3336521">(</span><span class="ident" id="3336522">list</span><span class="op" id="3336526">,</span>&nbsp;<span class="ident" id="3336528">inetaddr</span><span class="op" id="3336536">(</span><span class="ident" id="3336537">ip6</span><span class="op" id="3336540">)</span><span class="op" id="3336541">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336546">ipv6</span>&nbsp;<span class="op" id="3336551">=</span>&nbsp;<span class="builtintype" id="3336553">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336564">if</span>&nbsp;<span class="ident" id="3336567">ipv4</span>&nbsp;<span class="op" id="3336572">&amp;&amp;</span>&nbsp;<span class="ident" id="3336575">ipv6</span>&nbsp;<span class="op" id="3336580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336585">if</span>&nbsp;<span class="ident" id="3336588">swap</span>&nbsp;<span class="op" id="3336593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336599">list</span><span class="op" id="3336603">[</span><span class="num" id="3336604">0</span><span class="op" id="3336605">]</span><span class="op" id="3336606">,</span>&nbsp;<span class="ident" id="3336608">list</span><span class="op" id="3336612">[</span><span class="num" id="3336613">1</span><span class="op" id="3336614">]</span>&nbsp;<span class="op" id="3336616">=</span>&nbsp;<span class="ident" id="3336618">list</span><span class="op" id="3336622">[</span><span class="num" id="3336623">1</span><span class="op" id="3336624">]</span><span class="op" id="3336625">,</span>&nbsp;<span class="ident" id="3336627">list</span><span class="op" id="3336631">[</span><span class="num" id="3336632">0</span><span class="op" id="3336633">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336643">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336657">switch</span>&nbsp;<span class="builtinfunc" id="3336664">len</span><span class="op" id="3336667">(</span><span class="ident" id="3336668">list</span><span class="op" id="3336672">)</span>&nbsp;<span class="op" id="3336674">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336677">case</span>&nbsp;<span class="num" id="3336682">0</span><span class="op" id="3336683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336687">return</span>&nbsp;<span class="ident" id="3336694">nil</span><span class="op" id="3336697">,</span>&nbsp;<span class="ident" id="3336699">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336721">case</span>&nbsp;<span class="num" id="3336726">1</span><span class="op" id="3336727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336731">return</span>&nbsp;<span class="ident" id="3336738">list</span><span class="op" id="3336742">[</span><span class="num" id="3336743">0</span><span class="op" id="3336744">]</span><span class="op" id="3336745">,</span>&nbsp;<span class="ident" id="3336747">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336752">default</span><span class="op" id="3336759">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336763">return</span>&nbsp;<span class="ident" id="3336770">list</span><span class="op" id="3336774">,</span>&nbsp;<span class="ident" id="3336776">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336781">}</span><br>
<span class="lineno"></span><span class="op" id="3336783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3336786">func</span>&nbsp;<span class="ident" id="3336791">firstSupportedAddr</span><span class="op" id="3336809">(</span><span class="ident" id="3336810">filter</span>&nbsp;<span class="keyword" id="3336817">func</span><span class="op" id="3336821">(</span><span class="ident" id="3336822">IP</span><span class="op" id="3336824">)</span>&nbsp;<span class="ident" id="3336826">IP</span><span class="op" id="3336828">,</span>&nbsp;<span class="ident" id="3336830">ips</span>&nbsp;<span class="op" id="3336834">[</span><span class="op" id="3336835">]</span><span class="ident" id="3336836">IP</span><span class="op" id="3336838">,</span>&nbsp;<span class="ident" id="3336840">inetaddr</span>&nbsp;<span class="keyword" id="3336849">func</span><span class="op" id="3336853">(</span><span class="ident" id="3336854">IP</span><span class="op" id="3336856">)</span>&nbsp;<span class="ident" id="3336858">netaddr</span><span class="op" id="3336865">)</span>&nbsp;<span class="op" id="3336867">(</span><span class="ident" id="3336868">netaddr</span><span class="op" id="3336875">,</span>&nbsp;<span class="builtintype" id="3336877">error</span><span class="op" id="3336882">)</span>&nbsp;<span class="op" id="3336884">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336887">for</span>&nbsp;<span class="ident" id="3336891">_</span><span class="op" id="3336892">,</span>&nbsp;<span class="ident" id="3336894">ip</span>&nbsp;<span class="op" id="3336897">:=</span>&nbsp;<span class="keyword" id="3336900">range</span>&nbsp;<span class="ident" id="3336906">ips</span>&nbsp;<span class="op" id="3336910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336914">if</span>&nbsp;<span class="ident" id="3336917">ip</span>&nbsp;<span class="op" id="3336920">:=</span>&nbsp;<span class="ident" id="3336923">filter</span><span class="op" id="3336929">(</span><span class="ident" id="3336930">ip</span><span class="op" id="3336932">)</span><span class="op" id="3336933">;</span>&nbsp;<span class="ident" id="3336935">ip</span>&nbsp;<span class="op" id="3336938">!=</span>&nbsp;<span class="ident" id="3336941">nil</span>&nbsp;<span class="op" id="3336945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336950">return</span>&nbsp;<span class="ident" id="3336957">inetaddr</span><span class="op" id="3336965">(</span><span class="ident" id="3336966">ip</span><span class="op" id="3336968">)</span><span class="op" id="3336969">,</span>&nbsp;<span class="ident" id="3336971">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336980">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336983">return</span>&nbsp;<span class="ident" id="3336990">nil</span><span class="op" id="3336993">,</span>&nbsp;<span class="ident" id="3336995">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3337016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337019">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3337088">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3337161">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3337190">func</span>&nbsp;<span class="ident" id="3337195">ipv4only</span><span class="op" id="3337203">(</span><span class="ident" id="3337204">ip</span>&nbsp;<span class="ident" id="3337207">IP</span><span class="op" id="3337209">)</span>&nbsp;<span class="ident" id="3337211">IP</span>&nbsp;<span class="op" id="3337214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337217">if</span>&nbsp;<span class="ident" id="3337220">supportsIPv4</span>&nbsp;<span class="op" id="3337233">&amp;&amp;</span>&nbsp;<span class="ident" id="3337236">ip</span><span class="op" id="3337238">.</span><span class="ident" id="3337239">To4</span><span class="op" id="3337242">(</span><span class="op" id="3337243">)</span>&nbsp;<span class="op" id="3337245">!=</span>&nbsp;<span class="ident" id="3337248">nil</span>&nbsp;<span class="op" id="3337252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337256">return</span>&nbsp;<span class="ident" id="3337263">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337267">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337270">return</span>&nbsp;<span class="ident" id="3337277">nil</span><br>
<span class="lineno"></span><span class="op" id="3337281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337284">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3337353">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3337421">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3337485">func</span>&nbsp;<span class="ident" id="3337490">ipv6only</span><span class="op" id="3337498">(</span><span class="ident" id="3337499">ip</span>&nbsp;<span class="ident" id="3337502">IP</span><span class="op" id="3337504">)</span>&nbsp;<span class="ident" id="3337506">IP</span>&nbsp;<span class="op" id="3337509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337512">if</span>&nbsp;<span class="ident" id="3337515">supportsIPv6</span>&nbsp;<span class="op" id="3337528">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3337531">len</span><span class="op" id="3337534">(</span><span class="ident" id="3337535">ip</span><span class="op" id="3337537">)</span>&nbsp;<span class="op" id="3337539">==</span>&nbsp;<span class="ident" id="3337542">IPv6len</span>&nbsp;<span class="op" id="3337550">&amp;&amp;</span>&nbsp;<span class="ident" id="3337553">ip</span><span class="op" id="3337555">.</span><span class="ident" id="3337556">To4</span><span class="op" id="3337559">(</span><span class="op" id="3337560">)</span>&nbsp;<span class="op" id="3337562">==</span>&nbsp;<span class="ident" id="3337565">nil</span>&nbsp;<span class="op" id="3337569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337573">return</span>&nbsp;<span class="ident" id="3337580">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337584">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337587">return</span>&nbsp;<span class="ident" id="3337594">nil</span><br>
<span class="lineno"></span><span class="op" id="3337598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337601">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3337668">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3337725">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3337794">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3337852">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3337900">func</span>&nbsp;<span class="ident" id="3337905">SplitHostPort</span><span class="op" id="3337918">(</span><span class="ident" id="3337919">hostport</span>&nbsp;<span class="builtintype" id="3337928">string</span><span class="op" id="3337934">)</span>&nbsp;<span class="op" id="3337936">(</span><span class="ident" id="3337937">host</span><span class="op" id="3337941">,</span>&nbsp;<span class="ident" id="3337943">port</span>&nbsp;<span class="builtintype" id="3337948">string</span><span class="op" id="3337954">,</span>&nbsp;<span class="ident" id="3337956">err</span>&nbsp;<span class="builtintype" id="3337960">error</span><span class="op" id="3337965">)</span>&nbsp;<span class="op" id="3337967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337970">j</span><span class="op" id="3337971">,</span>&nbsp;<span class="ident" id="3337973">k</span>&nbsp;<span class="op" id="3337975">:=</span>&nbsp;<span class="num" id="3337978">0</span><span class="op" id="3337979">,</span>&nbsp;<span class="num" id="3337981">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337985">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338027">i</span>&nbsp;<span class="op" id="3338029">:=</span>&nbsp;<span class="ident" id="3338032">last</span><span class="op" id="3338036">(</span><span class="ident" id="3338037">hostport</span><span class="op" id="3338045">,</span>&nbsp;<span class="string" id="3338047">&#39;:&#39;</span><span class="op" id="3338050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338053">if</span>&nbsp;<span class="ident" id="3338056">i</span>&nbsp;<span class="op" id="3338058">&lt;</span>&nbsp;<span class="num" id="3338060">0</span>&nbsp;<span class="op" id="3338062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338066">goto</span>&nbsp;<span class="ident" id="3338071">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338088">if</span>&nbsp;<span class="ident" id="3338091">hostport</span><span class="op" id="3338099">[</span><span class="num" id="3338100">0</span><span class="op" id="3338101">]</span>&nbsp;<span class="op" id="3338103">==</span>&nbsp;<span class="string" id="3338106">&#39;[&#39;</span>&nbsp;<span class="op" id="3338110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338114">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338166">end</span>&nbsp;<span class="op" id="3338170">:=</span>&nbsp;<span class="ident" id="3338173">byteIndex</span><span class="op" id="3338182">(</span><span class="ident" id="3338183">hostport</span><span class="op" id="3338191">,</span>&nbsp;<span class="string" id="3338193">&#39;]&#39;</span><span class="op" id="3338196">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338200">if</span>&nbsp;<span class="ident" id="3338203">end</span>&nbsp;<span class="op" id="3338207">&lt;</span>&nbsp;<span class="num" id="3338209">0</span>&nbsp;<span class="op" id="3338211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338216">err</span>&nbsp;<span class="op" id="3338220">=</span>&nbsp;<span class="op" id="3338222">&amp;</span><span class="ident" id="3338223">AddrError</span><span class="op" id="3338232">{</span><span class="string" id="3338233">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3338257">,</span>&nbsp;<span class="ident" id="3338259">hostport</span><span class="op" id="3338267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338272">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338285">switch</span>&nbsp;<span class="ident" id="3338292">end</span>&nbsp;<span class="op" id="3338296">+</span>&nbsp;<span class="num" id="3338298">1</span>&nbsp;<span class="op" id="3338300">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338304">case</span>&nbsp;<span class="builtinfunc" id="3338309">len</span><span class="op" id="3338312">(</span><span class="ident" id="3338313">hostport</span><span class="op" id="3338321">)</span><span class="op" id="3338322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338327">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338374">goto</span>&nbsp;<span class="ident" id="3338379">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338393">case</span>&nbsp;<span class="ident" id="3338398">i</span><span class="op" id="3338399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338404">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338430">default</span><span class="op" id="3338437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338442">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338495">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338547">if</span>&nbsp;<span class="ident" id="3338550">hostport</span><span class="op" id="3338558">[</span><span class="ident" id="3338559">end</span><span class="op" id="3338562">+</span><span class="num" id="3338563">1</span><span class="op" id="3338564">]</span>&nbsp;<span class="op" id="3338566">==</span>&nbsp;<span class="string" id="3338569">&#39;:&#39;</span>&nbsp;<span class="op" id="3338573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338579">goto</span>&nbsp;<span class="ident" id="3338584">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338606">goto</span>&nbsp;<span class="ident" id="3338611">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338629">host</span>&nbsp;<span class="op" id="3338634">=</span>&nbsp;<span class="ident" id="3338636">hostport</span><span class="op" id="3338644">[</span><span class="num" id="3338645">1</span><span class="op" id="3338646">:</span><span class="ident" id="3338647">end</span><span class="op" id="3338650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338654">j</span><span class="op" id="3338655">,</span>&nbsp;<span class="ident" id="3338657">k</span>&nbsp;<span class="op" id="3338659">=</span>&nbsp;<span class="num" id="3338661">1</span><span class="op" id="3338662">,</span>&nbsp;<span class="ident" id="3338664">end</span><span class="op" id="3338667">+</span><span class="num" id="3338668">1</span>&nbsp;<span class="comment" id="3338670">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338728">}</span>&nbsp;<span class="keyword" id="3338730">else</span>&nbsp;<span class="op" id="3338735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338739">host</span>&nbsp;<span class="op" id="3338744">=</span>&nbsp;<span class="ident" id="3338746">hostport</span><span class="op" id="3338754">[</span><span class="op" id="3338755">:</span><span class="ident" id="3338756">i</span><span class="op" id="3338757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338761">if</span>&nbsp;<span class="ident" id="3338764">byteIndex</span><span class="op" id="3338773">(</span><span class="ident" id="3338774">host</span><span class="op" id="3338778">,</span>&nbsp;<span class="string" id="3338780">&#39;:&#39;</span><span class="op" id="3338783">)</span>&nbsp;<span class="op" id="3338785">&gt;=</span>&nbsp;<span class="num" id="3338788">0</span>&nbsp;<span class="op" id="3338790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338795">goto</span>&nbsp;<span class="ident" id="3338800">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338816">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338820">if</span>&nbsp;<span class="ident" id="3338823">byteIndex</span><span class="op" id="3338832">(</span><span class="ident" id="3338833">host</span><span class="op" id="3338837">,</span>&nbsp;<span class="string" id="3338839">&#39;%&#39;</span><span class="op" id="3338842">)</span>&nbsp;<span class="op" id="3338844">&gt;=</span>&nbsp;<span class="num" id="3338847">0</span>&nbsp;<span class="op" id="3338849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338854">goto</span>&nbsp;<span class="ident" id="3338859">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338883">if</span>&nbsp;<span class="ident" id="3338886">byteIndex</span><span class="op" id="3338895">(</span><span class="ident" id="3338896">hostport</span><span class="op" id="3338904">[</span><span class="ident" id="3338905">j</span><span class="op" id="3338906">:</span><span class="op" id="3338907">]</span><span class="op" id="3338908">,</span>&nbsp;<span class="string" id="3338910">&#39;[&#39;</span><span class="op" id="3338913">)</span>&nbsp;<span class="op" id="3338915">&gt;=</span>&nbsp;<span class="num" id="3338918">0</span>&nbsp;<span class="op" id="3338920">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338924">err</span>&nbsp;<span class="op" id="3338928">=</span>&nbsp;<span class="op" id="3338930">&amp;</span><span class="ident" id="3338931">AddrError</span><span class="op" id="3338940">{</span><span class="string" id="3338941">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3338968">,</span>&nbsp;<span class="ident" id="3338970">hostport</span><span class="op" id="3338978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338982">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338993">if</span>&nbsp;<span class="ident" id="3338996">byteIndex</span><span class="op" id="3339005">(</span><span class="ident" id="3339006">hostport</span><span class="op" id="3339014">[</span><span class="ident" id="3339015">k</span><span class="op" id="3339016">:</span><span class="op" id="3339017">]</span><span class="op" id="3339018">,</span>&nbsp;<span class="string" id="3339020">&#39;]&#39;</span><span class="op" id="3339023">)</span>&nbsp;<span class="op" id="3339025">&gt;=</span>&nbsp;<span class="num" id="3339028">0</span>&nbsp;<span class="op" id="3339030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339034">err</span>&nbsp;<span class="op" id="3339038">=</span>&nbsp;<span class="op" id="3339040">&amp;</span><span class="ident" id="3339041">AddrError</span><span class="op" id="3339050">{</span><span class="string" id="3339051">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3339078">,</span>&nbsp;<span class="ident" id="3339080">hostport</span><span class="op" id="3339088">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339092">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339104">port</span>&nbsp;<span class="op" id="3339109">=</span>&nbsp;<span class="ident" id="3339111">hostport</span><span class="op" id="3339119">[</span><span class="ident" id="3339120">i</span><span class="op" id="3339121">+</span><span class="num" id="3339122">1</span><span class="op" id="3339123">:</span><span class="op" id="3339124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339127">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3339135">missingPort</span><span class="op" id="3339146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339149">err</span>&nbsp;<span class="op" id="3339153">=</span>&nbsp;<span class="op" id="3339155">&amp;</span><span class="ident" id="3339156">AddrError</span><span class="op" id="3339165">{</span><span class="string" id="3339166">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3339191">,</span>&nbsp;<span class="ident" id="3339193">hostport</span><span class="op" id="3339201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339204">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3339212">tooManyColons</span><span class="op" id="3339225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339228">err</span>&nbsp;<span class="op" id="3339232">=</span>&nbsp;<span class="op" id="3339234">&amp;</span><span class="ident" id="3339235">AddrError</span><span class="op" id="3339244">{</span><span class="string" id="3339245">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3339273">,</span>&nbsp;<span class="ident" id="3339275">hostport</span><span class="op" id="3339283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339286">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3339294">missingBrackets</span><span class="op" id="3339309">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339312">err</span>&nbsp;<span class="op" id="3339316">=</span>&nbsp;<span class="op" id="3339318">&amp;</span><span class="ident" id="3339319">AddrError</span><span class="op" id="3339328">{</span><span class="string" id="3339329">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3339358">,</span>&nbsp;<span class="ident" id="3339360">hostport</span><span class="op" id="3339368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339371">return</span><br>
<span class="lineno"></span><span class="op" id="3339378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339381">func</span>&nbsp;<span class="ident" id="3339386">splitHostZone</span><span class="op" id="3339399">(</span><span class="ident" id="3339400">s</span>&nbsp;<span class="builtintype" id="3339402">string</span><span class="op" id="3339408">)</span>&nbsp;<span class="op" id="3339410">(</span><span class="ident" id="3339411">host</span><span class="op" id="3339415">,</span>&nbsp;<span class="ident" id="3339417">zone</span>&nbsp;<span class="builtintype" id="3339422">string</span><span class="op" id="3339428">)</span>&nbsp;<span class="op" id="3339430">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339433">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339497">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339520">if</span>&nbsp;<span class="ident" id="3339523">i</span>&nbsp;<span class="op" id="3339525">:=</span>&nbsp;<span class="ident" id="3339528">last</span><span class="op" id="3339532">(</span><span class="ident" id="3339533">s</span><span class="op" id="3339534">,</span>&nbsp;<span class="string" id="3339536">&#39;%&#39;</span><span class="op" id="3339539">)</span><span class="op" id="3339540">;</span>&nbsp;<span class="ident" id="3339542">i</span>&nbsp;<span class="op" id="3339544">&gt;</span>&nbsp;<span class="num" id="3339546">0</span>&nbsp;<span class="op" id="3339548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339552">host</span><span class="op" id="3339556">,</span>&nbsp;<span class="ident" id="3339558">zone</span>&nbsp;<span class="op" id="3339563">=</span>&nbsp;<span class="ident" id="3339565">s</span><span class="op" id="3339566">[</span><span class="op" id="3339567">:</span><span class="ident" id="3339568">i</span><span class="op" id="3339569">]</span><span class="op" id="3339570">,</span>&nbsp;<span class="ident" id="3339572">s</span><span class="op" id="3339573">[</span><span class="ident" id="3339574">i</span><span class="op" id="3339575">+</span><span class="num" id="3339576">1</span><span class="op" id="3339577">:</span><span class="op" id="3339578">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339581">}</span>&nbsp;<span class="keyword" id="3339583">else</span>&nbsp;<span class="op" id="3339588">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339592">host</span>&nbsp;<span class="op" id="3339597">=</span>&nbsp;<span class="ident" id="3339599">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339605">return</span><br>
<span class="lineno"></span><span class="op" id="3339612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3339615">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3339684">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3339752">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3339770">func</span>&nbsp;<span class="ident" id="3339775">JoinHostPort</span><span class="op" id="3339787">(</span><span class="ident" id="3339788">host</span><span class="op" id="3339792">,</span>&nbsp;<span class="ident" id="3339794">port</span>&nbsp;<span class="builtintype" id="3339799">string</span><span class="op" id="3339805">)</span>&nbsp;<span class="builtintype" id="3339807">string</span>&nbsp;<span class="op" id="3339814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339817">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339879">if</span>&nbsp;<span class="ident" id="3339882">byteIndex</span><span class="op" id="3339891">(</span><span class="ident" id="3339892">host</span><span class="op" id="3339896">,</span>&nbsp;<span class="string" id="3339898">&#39;:&#39;</span><span class="op" id="3339901">)</span>&nbsp;<span class="op" id="3339903">&gt;=</span>&nbsp;<span class="num" id="3339906">0</span>&nbsp;<span class="op" id="3339908">||</span>&nbsp;<span class="ident" id="3339911">byteIndex</span><span class="op" id="3339920">(</span><span class="ident" id="3339921">host</span><span class="op" id="3339925">,</span>&nbsp;<span class="string" id="3339927">&#39;%&#39;</span><span class="op" id="3339930">)</span>&nbsp;<span class="op" id="3339932">&gt;=</span>&nbsp;<span class="num" id="3339935">0</span>&nbsp;<span class="op" id="3339937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339941">return</span>&nbsp;<span class="string" id="3339948">&#34;[&#34;</span>&nbsp;<span class="op" id="3339952">+</span>&nbsp;<span class="ident" id="3339954">host</span>&nbsp;<span class="op" id="3339959">+</span>&nbsp;<span class="string" id="3339961">&#34;]:&#34;</span>&nbsp;<span class="op" id="3339966">+</span>&nbsp;<span class="ident" id="3339968">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339977">return</span>&nbsp;<span class="ident" id="3339984">host</span>&nbsp;<span class="op" id="3339989">+</span>&nbsp;<span class="string" id="3339991">&#34;:&#34;</span>&nbsp;<span class="op" id="3339995">+</span>&nbsp;<span class="ident" id="3339997">port</span><br>
<span class="lineno"></span><span class="op" id="3340002">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3340005">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3340070">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3340135">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3340199">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3340268">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3340337">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3340367">func</span>&nbsp;<span class="ident" id="3340372">resolveInternetAddr</span><span class="op" id="3340391">(</span><span class="ident" id="3340392">net</span><span class="op" id="3340395">,</span>&nbsp;<span class="ident" id="3340397">addr</span>&nbsp;<span class="builtintype" id="3340402">string</span><span class="op" id="3340408">,</span>&nbsp;<span class="ident" id="3340410">deadline</span>&nbsp;<span class="ident" id="3340419">time</span><span class="op" id="3340423">.</span><span class="ident" id="3340424">Time</span><span class="op" id="3340428">)</span>&nbsp;<span class="op" id="3340430">(</span><span class="ident" id="3340431">netaddr</span><span class="op" id="3340438">,</span>&nbsp;<span class="builtintype" id="3340440">error</span><span class="op" id="3340445">)</span>&nbsp;<span class="op" id="3340447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340450">var</span>&nbsp;<span class="op" id="3340454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340458">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3340475">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340483">host</span><span class="op" id="3340487">,</span>&nbsp;<span class="ident" id="3340489">port</span><span class="op" id="3340493">,</span>&nbsp;<span class="ident" id="3340495">zone</span>&nbsp;<span class="builtintype" id="3340500">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340509">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3340526">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340534">switch</span>&nbsp;<span class="ident" id="3340541">net</span>&nbsp;<span class="op" id="3340545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340548">case</span>&nbsp;<span class="string" id="3340553">&#34;tcp&#34;</span><span class="op" id="3340558">,</span>&nbsp;<span class="string" id="3340560">&#34;tcp4&#34;</span><span class="op" id="3340566">,</span>&nbsp;<span class="string" id="3340568">&#34;tcp6&#34;</span><span class="op" id="3340574">,</span>&nbsp;<span class="string" id="3340576">&#34;udp&#34;</span><span class="op" id="3340581">,</span>&nbsp;<span class="string" id="3340583">&#34;udp4&#34;</span><span class="op" id="3340589">,</span>&nbsp;<span class="string" id="3340591">&#34;udp6&#34;</span><span class="op" id="3340597">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340601">if</span>&nbsp;<span class="ident" id="3340604">addr</span>&nbsp;<span class="op" id="3340609">!=</span>&nbsp;<span class="string" id="3340612">&#34;&#34;</span>&nbsp;<span class="op" id="3340615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340620">if</span>&nbsp;<span class="ident" id="3340623">host</span><span class="op" id="3340627">,</span>&nbsp;<span class="ident" id="3340629">port</span><span class="op" id="3340633">,</span>&nbsp;<span class="ident" id="3340635">err</span>&nbsp;<span class="op" id="3340639">=</span>&nbsp;<span class="ident" id="3340641">SplitHostPort</span><span class="op" id="3340654">(</span><span class="ident" id="3340655">addr</span><span class="op" id="3340659">)</span><span class="op" id="3340660">;</span>&nbsp;<span class="ident" id="3340662">err</span>&nbsp;<span class="op" id="3340666">!=</span>&nbsp;<span class="ident" id="3340669">nil</span>&nbsp;<span class="op" id="3340673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340679">return</span>&nbsp;<span class="ident" id="3340686">nil</span><span class="op" id="3340689">,</span>&nbsp;<span class="ident" id="3340691">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340703">if</span>&nbsp;<span class="ident" id="3340706">portnum</span><span class="op" id="3340713">,</span>&nbsp;<span class="ident" id="3340715">err</span>&nbsp;<span class="op" id="3340719">=</span>&nbsp;<span class="ident" id="3340721">parsePort</span><span class="op" id="3340730">(</span><span class="ident" id="3340731">net</span><span class="op" id="3340734">,</span>&nbsp;<span class="ident" id="3340736">port</span><span class="op" id="3340740">)</span><span class="op" id="3340741">;</span>&nbsp;<span class="ident" id="3340743">err</span>&nbsp;<span class="op" id="3340747">!=</span>&nbsp;<span class="ident" id="3340750">nil</span>&nbsp;<span class="op" id="3340754">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340760">return</span>&nbsp;<span class="ident" id="3340767">nil</span><span class="op" id="3340770">,</span>&nbsp;<span class="ident" id="3340772">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340786">case</span>&nbsp;<span class="string" id="3340791">&#34;ip&#34;</span><span class="op" id="3340795">,</span>&nbsp;<span class="string" id="3340797">&#34;ip4&#34;</span><span class="op" id="3340802">,</span>&nbsp;<span class="string" id="3340804">&#34;ip6&#34;</span><span class="op" id="3340809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340813">if</span>&nbsp;<span class="ident" id="3340816">addr</span>&nbsp;<span class="op" id="3340821">!=</span>&nbsp;<span class="string" id="3340824">&#34;&#34;</span>&nbsp;<span class="op" id="3340827">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340832">host</span>&nbsp;<span class="op" id="3340837">=</span>&nbsp;<span class="ident" id="3340839">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340849">default</span><span class="op" id="3340856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340860">return</span>&nbsp;<span class="ident" id="3340867">nil</span><span class="op" id="3340870">,</span>&nbsp;<span class="ident" id="3340872">UnknownNetworkError</span><span class="op" id="3340891">(</span><span class="ident" id="3340892">net</span><span class="op" id="3340895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340898">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340901">inetaddr</span>&nbsp;<span class="op" id="3340910">:=</span>&nbsp;<span class="keyword" id="3340913">func</span><span class="op" id="3340917">(</span><span class="ident" id="3340918">ip</span>&nbsp;<span class="ident" id="3340921">IP</span><span class="op" id="3340923">)</span>&nbsp;<span class="ident" id="3340925">netaddr</span>&nbsp;<span class="op" id="3340933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340937">switch</span>&nbsp;<span class="ident" id="3340944">net</span>&nbsp;<span class="op" id="3340948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340952">case</span>&nbsp;<span class="string" id="3340957">&#34;tcp&#34;</span><span class="op" id="3340962">,</span>&nbsp;<span class="string" id="3340964">&#34;tcp4&#34;</span><span class="op" id="3340970">,</span>&nbsp;<span class="string" id="3340972">&#34;tcp6&#34;</span><span class="op" id="3340978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340983">return</span>&nbsp;<span class="op" id="3340990">&amp;</span><span class="ident" id="3340991">TCPAddr</span><span class="op" id="3340998">{</span><span class="ident" id="3340999">IP</span><span class="op" id="3341001">:</span>&nbsp;<span class="ident" id="3341003">ip</span><span class="op" id="3341005">,</span>&nbsp;<span class="ident" id="3341007">Port</span><span class="op" id="3341011">:</span>&nbsp;<span class="ident" id="3341013">portnum</span><span class="op" id="3341020">,</span>&nbsp;<span class="ident" id="3341022">Zone</span><span class="op" id="3341026">:</span>&nbsp;<span class="ident" id="3341028">zone</span><span class="op" id="3341032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341036">case</span>&nbsp;<span class="string" id="3341041">&#34;udp&#34;</span><span class="op" id="3341046">,</span>&nbsp;<span class="string" id="3341048">&#34;udp4&#34;</span><span class="op" id="3341054">,</span>&nbsp;<span class="string" id="3341056">&#34;udp6&#34;</span><span class="op" id="3341062">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341067">return</span>&nbsp;<span class="op" id="3341074">&amp;</span><span class="ident" id="3341075">UDPAddr</span><span class="op" id="3341082">{</span><span class="ident" id="3341083">IP</span><span class="op" id="3341085">:</span>&nbsp;<span class="ident" id="3341087">ip</span><span class="op" id="3341089">,</span>&nbsp;<span class="ident" id="3341091">Port</span><span class="op" id="3341095">:</span>&nbsp;<span class="ident" id="3341097">portnum</span><span class="op" id="3341104">,</span>&nbsp;<span class="ident" id="3341106">Zone</span><span class="op" id="3341110">:</span>&nbsp;<span class="ident" id="3341112">zone</span><span class="op" id="3341116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341120">case</span>&nbsp;<span class="string" id="3341125">&#34;ip&#34;</span><span class="op" id="3341129">,</span>&nbsp;<span class="string" id="3341131">&#34;ip4&#34;</span><span class="op" id="3341136">,</span>&nbsp;<span class="string" id="3341138">&#34;ip6&#34;</span><span class="op" id="3341143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341148">return</span>&nbsp;<span class="op" id="3341155">&amp;</span><span class="ident" id="3341156">IPAddr</span><span class="op" id="3341162">{</span><span class="ident" id="3341163">IP</span><span class="op" id="3341165">:</span>&nbsp;<span class="ident" id="3341167">ip</span><span class="op" id="3341169">,</span>&nbsp;<span class="ident" id="3341171">Zone</span><span class="op" id="3341175">:</span>&nbsp;<span class="ident" id="3341177">zone</span><span class="op" id="3341181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341185">default</span><span class="op" id="3341192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3341197">panic</span><span class="op" id="3341202">(</span><span class="string" id="3341203">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3341226">+</span>&nbsp;<span class="ident" id="3341228">net</span><span class="op" id="3341231">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341241">if</span>&nbsp;<span class="ident" id="3341244">host</span>&nbsp;<span class="op" id="3341249">==</span>&nbsp;<span class="string" id="3341252">&#34;&#34;</span>&nbsp;<span class="op" id="3341255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341259">return</span>&nbsp;<span class="ident" id="3341266">inetaddr</span><span class="op" id="3341274">(</span><span class="ident" id="3341275">nil</span><span class="op" id="3341278">)</span><span class="op" id="3341279">,</span>&nbsp;<span class="ident" id="3341281">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341286">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341289">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341322">var</span>&nbsp;<span class="ident" id="3341326">ip</span>&nbsp;<span class="ident" id="3341329">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341333">if</span>&nbsp;<span class="ident" id="3341336">ip</span>&nbsp;<span class="op" id="3341339">=</span>&nbsp;<span class="ident" id="3341341">parseIPv4</span><span class="op" id="3341350">(</span><span class="ident" id="3341351">host</span><span class="op" id="3341355">)</span><span class="op" id="3341356">;</span>&nbsp;<span class="ident" id="3341358">ip</span>&nbsp;<span class="op" id="3341361">!=</span>&nbsp;<span class="ident" id="3341364">nil</span>&nbsp;<span class="op" id="3341368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341372">return</span>&nbsp;<span class="ident" id="3341379">inetaddr</span><span class="op" id="3341387">(</span><span class="ident" id="3341388">ip</span><span class="op" id="3341390">)</span><span class="op" id="3341391">,</span>&nbsp;<span class="ident" id="3341393">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341398">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341401">if</span>&nbsp;<span class="ident" id="3341404">ip</span><span class="op" id="3341406">,</span>&nbsp;<span class="ident" id="3341408">zone</span>&nbsp;<span class="op" id="3341413">=</span>&nbsp;<span class="ident" id="3341415">parseIPv6</span><span class="op" id="3341424">(</span><span class="ident" id="3341425">host</span><span class="op" id="3341429">,</span>&nbsp;<span class="builtintype" id="3341431">true</span><span class="op" id="3341435">)</span><span class="op" id="3341436">;</span>&nbsp;<span class="ident" id="3341438">ip</span>&nbsp;<span class="op" id="3341441">!=</span>&nbsp;<span class="ident" id="3341444">nil</span>&nbsp;<span class="op" id="3341448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341452">return</span>&nbsp;<span class="ident" id="3341459">inetaddr</span><span class="op" id="3341467">(</span><span class="ident" id="3341468">ip</span><span class="op" id="3341470">)</span><span class="op" id="3341471">,</span>&nbsp;<span class="ident" id="3341473">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341481">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341504">host</span><span class="op" id="3341508">,</span>&nbsp;<span class="ident" id="3341510">zone</span>&nbsp;<span class="op" id="3341515">=</span>&nbsp;<span class="ident" id="3341517">splitHostZone</span><span class="op" id="3341530">(</span><span class="ident" id="3341531">host</span><span class="op" id="3341535">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341538">ips</span><span class="op" id="3341541">,</span>&nbsp;<span class="ident" id="3341543">err</span>&nbsp;<span class="op" id="3341547">:=</span>&nbsp;<span class="ident" id="3341550">lookupIPDeadline</span><span class="op" id="3341566">(</span><span class="ident" id="3341567">host</span><span class="op" id="3341571">,</span>&nbsp;<span class="ident" id="3341573">deadline</span><span class="op" id="3341581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341584">if</span>&nbsp;<span class="ident" id="3341587">err</span>&nbsp;<span class="op" id="3341591">!=</span>&nbsp;<span class="ident" id="3341594">nil</span>&nbsp;<span class="op" id="3341598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341602">return</span>&nbsp;<span class="ident" id="3341609">nil</span><span class="op" id="3341612">,</span>&nbsp;<span class="ident" id="3341614">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341622">var</span>&nbsp;<span class="ident" id="3341626">filter</span>&nbsp;<span class="keyword" id="3341633">func</span><span class="op" id="3341637">(</span><span class="ident" id="3341638">IP</span><span class="op" id="3341640">)</span>&nbsp;<span class="ident" id="3341642">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341646">if</span>&nbsp;<span class="ident" id="3341649">net</span>&nbsp;<span class="op" id="3341653">!=</span>&nbsp;<span class="string" id="3341656">&#34;&#34;</span>&nbsp;<span class="op" id="3341659">&amp;&amp;</span>&nbsp;<span class="ident" id="3341662">net</span><span class="op" id="3341665">[</span><span class="builtinfunc" id="3341666">len</span><span class="op" id="3341669">(</span><span class="ident" id="3341670">net</span><span class="op" id="3341673">)</span><span class="op" id="3341674">-</span><span class="num" id="3341675">1</span><span class="op" id="3341676">]</span>&nbsp;<span class="op" id="3341678">==</span>&nbsp;<span class="string" id="3341681">&#39;4&#39;</span>&nbsp;<span class="op" id="3341685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341689">filter</span>&nbsp;<span class="op" id="3341696">=</span>&nbsp;<span class="ident" id="3341698">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341711">if</span>&nbsp;<span class="ident" id="3341714">net</span>&nbsp;<span class="op" id="3341718">!=</span>&nbsp;<span class="string" id="3341721">&#34;&#34;</span>&nbsp;<span class="op" id="3341724">&amp;&amp;</span>&nbsp;<span class="ident" id="3341727">net</span><span class="op" id="3341730">[</span><span class="builtinfunc" id="3341731">len</span><span class="op" id="3341734">(</span><span class="ident" id="3341735">net</span><span class="op" id="3341738">)</span><span class="op" id="3341739">-</span><span class="num" id="3341740">1</span><span class="op" id="3341741">]</span>&nbsp;<span class="op" id="3341743">==</span>&nbsp;<span class="string" id="3341746">&#39;6&#39;</span>&nbsp;<span class="op" id="3341750">||</span>&nbsp;<span class="ident" id="3341753">zone</span>&nbsp;<span class="op" id="3341758">!=</span>&nbsp;<span class="string" id="3341761">&#34;&#34;</span>&nbsp;<span class="op" id="3341764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341768">filter</span>&nbsp;<span class="op" id="3341775">=</span>&nbsp;<span class="ident" id="3341777">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341790">return</span>&nbsp;<span class="ident" id="3341797">firstFavoriteAddr</span><span class="op" id="3341814">(</span><span class="ident" id="3341815">filter</span><span class="op" id="3341821">,</span>&nbsp;<span class="ident" id="3341823">ips</span><span class="op" id="3341826">,</span>&nbsp;<span class="ident" id="3341828">inetaddr</span><span class="op" id="3341836">)</span><br>
<span class="lineno"></span><span class="op" id="3341838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3341841">func</span>&nbsp;<span class="ident" id="3341846">zoneToString</span><span class="op" id="3341858">(</span><span class="ident" id="3341859">zone</span>&nbsp;<span class="builtintype" id="3341864">int</span><span class="op" id="3341867">)</span>&nbsp;<span class="builtintype" id="3341869">string</span>&nbsp;<span class="op" id="3341876">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341879">if</span>&nbsp;<span class="ident" id="3341882">zone</span>&nbsp;<span class="op" id="3341887">==</span>&nbsp;<span class="num" id="3341890">0</span>&nbsp;<span class="op" id="3341892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341896">return</span>&nbsp;<span class="string" id="3341903">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341910">if</span>&nbsp;<span class="ident" id="3341913">ifi</span><span class="op" id="3341916">,</span>&nbsp;<span class="ident" id="3341918">err</span>&nbsp;<span class="op" id="3341922">:=</span>&nbsp;<span class="ident" id="3341925">InterfaceByIndex</span><span class="op" id="3341941">(</span><span class="ident" id="3341942">zone</span><span class="op" id="3341946">)</span><span class="op" id="3341947">;</span>&nbsp;<span class="ident" id="3341949">err</span>&nbsp;<span class="op" id="3341953">==</span>&nbsp;<span class="ident" id="3341956">nil</span>&nbsp;<span class="op" id="3341960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341964">return</span>&nbsp;<span class="ident" id="3341971">ifi</span><span class="op" id="3341974">.</span><span class="ident" id="3341975">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341984">return</span>&nbsp;<span class="ident" id="3341991">itod</span><span class="op" id="3341995">(</span><span class="builtintype" id="3341996">uint</span><span class="op" id="3342000">(</span><span class="ident" id="3342001">zone</span><span class="op" id="3342005">)</span><span class="op" id="3342006">)</span><br>
<span class="lineno"></span><span class="op" id="3342008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3342011">func</span>&nbsp;<span class="ident" id="3342016">zoneToInt</span><span class="op" id="3342025">(</span><span class="ident" id="3342026">zone</span>&nbsp;<span class="builtintype" id="3342031">string</span><span class="op" id="3342037">)</span>&nbsp;<span class="builtintype" id="3342039">int</span>&nbsp;<span class="op" id="3342043">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342046">if</span>&nbsp;<span class="ident" id="3342049">zone</span>&nbsp;<span class="op" id="3342054">==</span>&nbsp;<span class="string" id="3342057">&#34;&#34;</span>&nbsp;<span class="op" id="3342060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342064">return</span>&nbsp;<span class="num" id="3342071">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3342074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342077">if</span>&nbsp;<span class="ident" id="3342080">ifi</span><span class="op" id="3342083">,</span>&nbsp;<span class="ident" id="3342085">err</span>&nbsp;<span class="op" id="3342089">:=</span>&nbsp;<span class="ident" id="3342092">InterfaceByName</span><span class="op" id="3342107">(</span><span class="ident" id="3342108">zone</span><span class="op" id="3342112">)</span><span class="op" id="3342113">;</span>&nbsp;<span class="ident" id="3342115">err</span>&nbsp;<span class="op" id="3342119">==</span>&nbsp;<span class="ident" id="3342122">nil</span>&nbsp;<span class="op" id="3342126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342130">return</span>&nbsp;<span class="ident" id="3342137">ifi</span><span class="op" id="3342140">.</span><span class="ident" id="3342141">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3342148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342151">n</span><span class="op" id="3342152">,</span>&nbsp;<span class="ident" id="3342154">_</span><span class="op" id="3342155">,</span>&nbsp;<span class="ident" id="3342157">_</span>&nbsp;<span class="op" id="3342159">:=</span>&nbsp;<span class="ident" id="3342162">dtoi</span><span class="op" id="3342166">(</span><span class="ident" id="3342167">zone</span><span class="op" id="3342171">,</span>&nbsp;<span class="num" id="3342173">0</span><span class="op" id="3342174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3342177">return</span>&nbsp;<span class="ident" id="3342184">n</span><br>
<span class="lineno"></span><span class="op" id="3342186">}</span>
</div>
</body>
</html>
