<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html" class="current">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4983439">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4983494">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4983548">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4983599">package</span>&nbsp;<span class="ident" id="4983607">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4983613">import</span>&nbsp;<span class="op" id="4983620">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4983623">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4983641">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4983651">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4983658">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4983666">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4983680">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4983685">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4983688">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4983768">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4983834">const</span>&nbsp;<span class="op" id="4983840">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983843">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4983862">=</span>&nbsp;<span class="ident" id="4983864">flate</span><span class="op" id="4983869">.</span><span class="ident" id="4983870">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983885">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4983904">=</span>&nbsp;<span class="ident" id="4983906">flate</span><span class="op" id="4983911">.</span><span class="ident" id="4983912">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983923">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4983942">=</span>&nbsp;<span class="ident" id="4983944">flate</span><span class="op" id="4983949">.</span><span class="ident" id="4983950">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983967">DefaultCompression</span>&nbsp;<span class="op" id="4983986">=</span>&nbsp;<span class="ident" id="4983988">flate</span><span class="op" id="4983993">.</span><span class="ident" id="4983994">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4984013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4984016">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4984050">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4984105">type</span>&nbsp;<span class="ident" id="4984110">Writer</span>&nbsp;<span class="keyword" id="4984117">struct</span>&nbsp;<span class="op" id="4984124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984127">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984135">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984147">io</span><span class="op" id="4984149">.</span><span class="ident" id="4984150">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984158">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4984170">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984175">wroteHeader</span>&nbsp;<span class="builtintype" id="4984187">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984193">compressor</span>&nbsp;&nbsp;<span class="op" id="4984205">*</span><span class="ident" id="4984206">flate</span><span class="op" id="4984211">.</span><span class="ident" id="4984212">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984220">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984232">hash</span><span class="op" id="4984236">.</span><span class="ident" id="4984237">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984245">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4984257">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984265">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4984277">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984283">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984295">[</span><span class="num" id="4984296">10</span><span class="op" id="4984298">]</span><span class="builtintype" id="4984299">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984305">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4984317">error</span><br>
<span class="lineno"></span><span class="op" id="4984323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4984326">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4984361">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4984427">//</span><br>
<span class="lineno"></span><span class="comment" id="4984430">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4984511">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4984566">//</span><br>
<span class="lineno"></span><span class="comment" id="4984569">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4984643">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4984719">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4984797">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4984876">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4984895">func</span>&nbsp;<span class="ident" id="4984900">NewWriter</span><span class="op" id="4984909">(</span><span class="ident" id="4984910">w</span>&nbsp;<span class="ident" id="4984912">io</span><span class="op" id="4984914">.</span><span class="ident" id="4984915">Writer</span><span class="op" id="4984921">)</span>&nbsp;<span class="op" id="4984923">*</span><span class="ident" id="4984924">Writer</span>&nbsp;<span class="op" id="4984931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984934">z</span><span class="op" id="4984935">,</span>&nbsp;<span class="ident" id="4984937">_</span>&nbsp;<span class="op" id="4984939">:=</span>&nbsp;<span class="ident" id="4984942">NewWriterLevel</span><span class="op" id="4984956">(</span><span class="ident" id="4984957">w</span><span class="op" id="4984958">,</span>&nbsp;<span class="ident" id="4984960">DefaultCompression</span><span class="op" id="4984978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984981">return</span>&nbsp;<span class="ident" id="4984988">z</span><br>
<span class="lineno"></span><span class="op" id="4984990">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4984993">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4985073">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4985108">//</span><br>
<span class="lineno"></span><span class="comment" id="4985111">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4985185">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4985261">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4985308">func</span>&nbsp;<span class="ident" id="4985313">NewWriterLevel</span><span class="op" id="4985327">(</span><span class="ident" id="4985328">w</span>&nbsp;<span class="ident" id="4985330">io</span><span class="op" id="4985332">.</span><span class="ident" id="4985333">Writer</span><span class="op" id="4985339">,</span>&nbsp;<span class="ident" id="4985341">level</span>&nbsp;<span class="builtintype" id="4985347">int</span><span class="op" id="4985350">)</span>&nbsp;<span class="op" id="4985352">(</span><span class="op" id="4985353">*</span><span class="ident" id="4985354">Writer</span><span class="op" id="4985360">,</span>&nbsp;<span class="builtintype" id="4985362">error</span><span class="op" id="4985367">)</span>&nbsp;<span class="op" id="4985369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985372">if</span>&nbsp;<span class="ident" id="4985375">level</span>&nbsp;<span class="op" id="4985381">&lt;</span>&nbsp;<span class="ident" id="4985383">DefaultCompression</span>&nbsp;<span class="op" id="4985402">||</span>&nbsp;<span class="ident" id="4985405">level</span>&nbsp;<span class="op" id="4985411">&gt;</span>&nbsp;<span class="ident" id="4985413">BestCompression</span>&nbsp;<span class="op" id="4985429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985433">return</span>&nbsp;<span class="ident" id="4985440">nil</span><span class="op" id="4985443">,</span>&nbsp;<span class="ident" id="4985445">fmt</span><span class="op" id="4985448">.</span><span class="ident" id="4985449">Errorf</span><span class="op" id="4985455">(</span><span class="string" id="4985456">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4985493">,</span>&nbsp;<span class="ident" id="4985495">level</span><span class="op" id="4985500">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985506">z</span>&nbsp;<span class="op" id="4985508">:=</span>&nbsp;<span class="builtinfunc" id="4985511">new</span><span class="op" id="4985514">(</span><span class="ident" id="4985515">Writer</span><span class="op" id="4985521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985524">z</span><span class="op" id="4985525">.</span><span class="ident" id="4985526">init</span><span class="op" id="4985530">(</span><span class="ident" id="4985531">w</span><span class="op" id="4985532">,</span>&nbsp;<span class="ident" id="4985534">level</span><span class="op" id="4985539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985542">return</span>&nbsp;<span class="ident" id="4985549">z</span><span class="op" id="4985550">,</span>&nbsp;<span class="ident" id="4985552">nil</span><br>
<span class="lineno"></span><span class="op" id="4985556">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4985559">func</span>&nbsp;<span class="op" id="4985564">(</span><span class="ident" id="4985565">z</span>&nbsp;<span class="op" id="4985567">*</span><span class="ident" id="4985568">Writer</span><span class="op" id="4985574">)</span>&nbsp;<span class="ident" id="4985576">init</span><span class="op" id="4985580">(</span><span class="ident" id="4985581">w</span>&nbsp;<span class="ident" id="4985583">io</span><span class="op" id="4985585">.</span><span class="ident" id="4985586">Writer</span><span class="op" id="4985592">,</span>&nbsp;<span class="ident" id="4985594">level</span>&nbsp;<span class="builtintype" id="4985600">int</span><span class="op" id="4985603">)</span>&nbsp;<span class="op" id="4985605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985608">digest</span>&nbsp;<span class="op" id="4985615">:=</span>&nbsp;<span class="ident" id="4985618">z</span><span class="op" id="4985619">.</span><span class="ident" id="4985620">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985628">if</span>&nbsp;<span class="ident" id="4985631">digest</span>&nbsp;<span class="op" id="4985638">!=</span>&nbsp;<span class="ident" id="4985641">nil</span>&nbsp;<span class="op" id="4985645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985649">digest</span><span class="op" id="4985655">.</span><span class="ident" id="4985656">Reset</span><span class="op" id="4985661">(</span><span class="op" id="4985662">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985665">}</span>&nbsp;<span class="keyword" id="4985667">else</span>&nbsp;<span class="op" id="4985672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985676">digest</span>&nbsp;<span class="op" id="4985683">=</span>&nbsp;<span class="ident" id="4985685">crc32</span><span class="op" id="4985690">.</span><span class="ident" id="4985691">NewIEEE</span><span class="op" id="4985698">(</span><span class="op" id="4985699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985705">compressor</span>&nbsp;<span class="op" id="4985716">:=</span>&nbsp;<span class="ident" id="4985719">z</span><span class="op" id="4985720">.</span><span class="ident" id="4985721">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985733">if</span>&nbsp;<span class="ident" id="4985736">compressor</span>&nbsp;<span class="op" id="4985747">!=</span>&nbsp;<span class="ident" id="4985750">nil</span>&nbsp;<span class="op" id="4985754">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985758">compressor</span><span class="op" id="4985768">.</span><span class="ident" id="4985769">Reset</span><span class="op" id="4985774">(</span><span class="ident" id="4985775">w</span><span class="op" id="4985776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985782">*</span><span class="ident" id="4985783">z</span>&nbsp;<span class="op" id="4985785">=</span>&nbsp;<span class="ident" id="4985787">Writer</span><span class="op" id="4985793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985797">Header</span><span class="op" id="4985803">:</span>&nbsp;<span class="ident" id="4985805">Header</span><span class="op" id="4985811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985816">OS</span><span class="op" id="4985818">:</span>&nbsp;<span class="num" id="4985820">255</span><span class="op" id="4985823">,</span>&nbsp;<span class="comment" id="4985825">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985838">}</span><span class="op" id="4985839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985843">w</span><span class="op" id="4985844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4985855">w</span><span class="op" id="4985856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985860">level</span><span class="op" id="4985865">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4985872">level</span><span class="op" id="4985877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985881">digest</span><span class="op" id="4985887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4985893">digest</span><span class="op" id="4985899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985903">compressor</span><span class="op" id="4985913">:</span>&nbsp;<span class="ident" id="4985915">compressor</span><span class="op" id="4985925">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985928">}</span><br>
<span class="lineno"></span><span class="op" id="4985930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4985933">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4986003">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4986073">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4986140">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4986165">func</span>&nbsp;<span class="op" id="4986170">(</span><span class="ident" id="4986171">z</span>&nbsp;<span class="op" id="4986173">*</span><span class="ident" id="4986174">Writer</span><span class="op" id="4986180">)</span>&nbsp;<span class="ident" id="4986182">Reset</span><span class="op" id="4986187">(</span><span class="ident" id="4986188">w</span>&nbsp;<span class="ident" id="4986190">io</span><span class="op" id="4986192">.</span><span class="ident" id="4986193">Writer</span><span class="op" id="4986199">)</span>&nbsp;<span class="op" id="4986201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986204">z</span><span class="op" id="4986205">.</span><span class="ident" id="4986206">init</span><span class="op" id="4986210">(</span><span class="ident" id="4986211">w</span><span class="op" id="4986212">,</span>&nbsp;<span class="ident" id="4986214">z</span><span class="op" id="4986215">.</span><span class="ident" id="4986216">level</span><span class="op" id="4986221">)</span><br>
<span class="lineno"></span><span class="op" id="4986223">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4986226">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4986287">func</span>&nbsp;<span class="ident" id="4986292">put2</span><span class="op" id="4986296">(</span><span class="ident" id="4986297">p</span>&nbsp;<span class="op" id="4986299">[</span><span class="op" id="4986300">]</span><span class="builtintype" id="4986301">byte</span><span class="op" id="4986305">,</span>&nbsp;<span class="ident" id="4986307">v</span>&nbsp;<span class="builtintype" id="4986309">uint16</span><span class="op" id="4986315">)</span>&nbsp;<span class="op" id="4986317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986320">p</span><span class="op" id="4986321">[</span><span class="num" id="4986322">0</span><span class="op" id="4986323">]</span>&nbsp;<span class="op" id="4986325">=</span>&nbsp;<span class="builtintype" id="4986327">uint8</span><span class="op" id="4986332">(</span><span class="ident" id="4986333">v</span>&nbsp;<span class="op" id="4986335">&gt;&gt;</span>&nbsp;<span class="num" id="4986338">0</span><span class="op" id="4986339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986342">p</span><span class="op" id="4986343">[</span><span class="num" id="4986344">1</span><span class="op" id="4986345">]</span>&nbsp;<span class="op" id="4986347">=</span>&nbsp;<span class="builtintype" id="4986349">uint8</span><span class="op" id="4986354">(</span><span class="ident" id="4986355">v</span>&nbsp;<span class="op" id="4986357">&gt;&gt;</span>&nbsp;<span class="num" id="4986360">8</span><span class="op" id="4986361">)</span><br>
<span class="lineno">105</span><span class="op" id="4986363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4986366">func</span>&nbsp;<span class="ident" id="4986371">put4</span><span class="op" id="4986375">(</span><span class="ident" id="4986376">p</span>&nbsp;<span class="op" id="4986378">[</span><span class="op" id="4986379">]</span><span class="builtintype" id="4986380">byte</span><span class="op" id="4986384">,</span>&nbsp;<span class="ident" id="4986386">v</span>&nbsp;<span class="builtintype" id="4986388">uint32</span><span class="op" id="4986394">)</span>&nbsp;<span class="op" id="4986396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986399">p</span><span class="op" id="4986400">[</span><span class="num" id="4986401">0</span><span class="op" id="4986402">]</span>&nbsp;<span class="op" id="4986404">=</span>&nbsp;<span class="builtintype" id="4986406">uint8</span><span class="op" id="4986411">(</span><span class="ident" id="4986412">v</span>&nbsp;<span class="op" id="4986414">&gt;&gt;</span>&nbsp;<span class="num" id="4986417">0</span><span class="op" id="4986418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986421">p</span><span class="op" id="4986422">[</span><span class="num" id="4986423">1</span><span class="op" id="4986424">]</span>&nbsp;<span class="op" id="4986426">=</span>&nbsp;<span class="builtintype" id="4986428">uint8</span><span class="op" id="4986433">(</span><span class="ident" id="4986434">v</span>&nbsp;<span class="op" id="4986436">&gt;&gt;</span>&nbsp;<span class="num" id="4986439">8</span><span class="op" id="4986440">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986443">p</span><span class="op" id="4986444">[</span><span class="num" id="4986445">2</span><span class="op" id="4986446">]</span>&nbsp;<span class="op" id="4986448">=</span>&nbsp;<span class="builtintype" id="4986450">uint8</span><span class="op" id="4986455">(</span><span class="ident" id="4986456">v</span>&nbsp;<span class="op" id="4986458">&gt;&gt;</span>&nbsp;<span class="num" id="4986461">16</span><span class="op" id="4986463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986466">p</span><span class="op" id="4986467">[</span><span class="num" id="4986468">3</span><span class="op" id="4986469">]</span>&nbsp;<span class="op" id="4986471">=</span>&nbsp;<span class="builtintype" id="4986473">uint8</span><span class="op" id="4986478">(</span><span class="ident" id="4986479">v</span>&nbsp;<span class="op" id="4986481">&gt;&gt;</span>&nbsp;<span class="num" id="4986484">24</span><span class="op" id="4986486">)</span><br>
<span class="lineno"></span><span class="op" id="4986488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986491">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4986549">func</span>&nbsp;<span class="op" id="4986554">(</span><span class="ident" id="4986555">z</span>&nbsp;<span class="op" id="4986557">*</span><span class="ident" id="4986558">Writer</span><span class="op" id="4986564">)</span>&nbsp;<span class="ident" id="4986566">writeBytes</span><span class="op" id="4986576">(</span><span class="ident" id="4986577">b</span>&nbsp;<span class="op" id="4986579">[</span><span class="op" id="4986580">]</span><span class="builtintype" id="4986581">byte</span><span class="op" id="4986585">)</span>&nbsp;<span class="builtintype" id="4986587">error</span>&nbsp;<span class="op" id="4986593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986596">if</span>&nbsp;<span class="builtinfunc" id="4986599">len</span><span class="op" id="4986602">(</span><span class="ident" id="4986603">b</span><span class="op" id="4986604">)</span>&nbsp;<span class="op" id="4986606">&gt;</span>&nbsp;<span class="num" id="4986608">0xffff</span>&nbsp;<span class="op" id="4986615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986619">return</span>&nbsp;<span class="ident" id="4986626">errors</span><span class="op" id="4986632">.</span><span class="ident" id="4986633">New</span><span class="op" id="4986636">(</span><span class="string" id="4986637">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4986674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986680">put2</span><span class="op" id="4986684">(</span><span class="ident" id="4986685">z</span><span class="op" id="4986686">.</span><span class="ident" id="4986687">buf</span><span class="op" id="4986690">[</span><span class="num" id="4986691">0</span><span class="op" id="4986692">:</span><span class="num" id="4986693">2</span><span class="op" id="4986694">]</span><span class="op" id="4986695">,</span>&nbsp;<span class="builtintype" id="4986697">uint16</span><span class="op" id="4986703">(</span><span class="builtinfunc" id="4986704">len</span><span class="op" id="4986707">(</span><span class="ident" id="4986708">b</span><span class="op" id="4986709">)</span><span class="op" id="4986710">)</span><span class="op" id="4986711">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986714">_</span><span class="op" id="4986715">,</span>&nbsp;<span class="ident" id="4986717">err</span>&nbsp;<span class="op" id="4986721">:=</span>&nbsp;<span class="ident" id="4986724">z</span><span class="op" id="4986725">.</span><span class="ident" id="4986726">w</span><span class="op" id="4986727">.</span><span class="ident" id="4986728">Write</span><span class="op" id="4986733">(</span><span class="ident" id="4986734">z</span><span class="op" id="4986735">.</span><span class="ident" id="4986736">buf</span><span class="op" id="4986739">[</span><span class="num" id="4986740">0</span><span class="op" id="4986741">:</span><span class="num" id="4986742">2</span><span class="op" id="4986743">]</span><span class="op" id="4986744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986747">if</span>&nbsp;<span class="ident" id="4986750">err</span>&nbsp;<span class="op" id="4986754">!=</span>&nbsp;<span class="ident" id="4986757">nil</span>&nbsp;<span class="op" id="4986761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986765">return</span>&nbsp;<span class="ident" id="4986772">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986780">_</span><span class="op" id="4986781">,</span>&nbsp;<span class="ident" id="4986783">err</span>&nbsp;<span class="op" id="4986787">=</span>&nbsp;<span class="ident" id="4986789">z</span><span class="op" id="4986790">.</span><span class="ident" id="4986791">w</span><span class="op" id="4986792">.</span><span class="ident" id="4986793">Write</span><span class="op" id="4986798">(</span><span class="ident" id="4986799">b</span><span class="op" id="4986800">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986803">return</span>&nbsp;<span class="ident" id="4986810">err</span><br>
<span class="lineno"></span><span class="op" id="4986814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986817">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4986881">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4986964">func</span>&nbsp;<span class="op" id="4986969">(</span><span class="ident" id="4986970">z</span>&nbsp;<span class="op" id="4986972">*</span><span class="ident" id="4986973">Writer</span><span class="op" id="4986979">)</span>&nbsp;<span class="ident" id="4986981">writeString</span><span class="op" id="4986992">(</span><span class="ident" id="4986993">s</span>&nbsp;<span class="builtintype" id="4986995">string</span><span class="op" id="4987001">)</span>&nbsp;<span class="op" id="4987003">(</span><span class="ident" id="4987004">err</span>&nbsp;<span class="builtintype" id="4987008">error</span><span class="op" id="4987013">)</span>&nbsp;<span class="op" id="4987015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987018">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987095">needconv</span>&nbsp;<span class="op" id="4987104">:=</span>&nbsp;<span class="builtintype" id="4987107">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987114">for</span>&nbsp;<span class="ident" id="4987118">_</span><span class="op" id="4987119">,</span>&nbsp;<span class="ident" id="4987121">v</span>&nbsp;<span class="op" id="4987123">:=</span>&nbsp;<span class="keyword" id="4987126">range</span>&nbsp;<span class="ident" id="4987132">s</span>&nbsp;<span class="op" id="4987134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987138">if</span>&nbsp;<span class="ident" id="4987141">v</span>&nbsp;<span class="op" id="4987143">==</span>&nbsp;<span class="num" id="4987146">0</span>&nbsp;<span class="op" id="4987148">||</span>&nbsp;<span class="ident" id="4987151">v</span>&nbsp;<span class="op" id="4987153">&gt;</span>&nbsp;<span class="num" id="4987155">0xff</span>&nbsp;<span class="op" id="4987160">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987165">return</span>&nbsp;<span class="ident" id="4987172">errors</span><span class="op" id="4987178">.</span><span class="ident" id="4987179">New</span><span class="op" id="4987182">(</span><span class="string" id="4987183">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4987222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987230">if</span>&nbsp;<span class="ident" id="4987233">v</span>&nbsp;<span class="op" id="4987235">&gt;</span>&nbsp;<span class="num" id="4987237">0x7f</span>&nbsp;<span class="op" id="4987242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987247">needconv</span>&nbsp;<span class="op" id="4987256">=</span>&nbsp;<span class="builtintype" id="4987258">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987265">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987271">if</span>&nbsp;<span class="ident" id="4987274">needconv</span>&nbsp;<span class="op" id="4987283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987287">b</span>&nbsp;<span class="op" id="4987289">:=</span>&nbsp;<span class="builtinfunc" id="4987292">make</span><span class="op" id="4987296">(</span><span class="op" id="4987297">[</span><span class="op" id="4987298">]</span><span class="builtintype" id="4987299">byte</span><span class="op" id="4987303">,</span>&nbsp;<span class="num" id="4987305">0</span><span class="op" id="4987306">,</span>&nbsp;<span class="builtinfunc" id="4987308">len</span><span class="op" id="4987311">(</span><span class="ident" id="4987312">s</span><span class="op" id="4987313">)</span><span class="op" id="4987314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987318">for</span>&nbsp;<span class="ident" id="4987322">_</span><span class="op" id="4987323">,</span>&nbsp;<span class="ident" id="4987325">v</span>&nbsp;<span class="op" id="4987327">:=</span>&nbsp;<span class="keyword" id="4987330">range</span>&nbsp;<span class="ident" id="4987336">s</span>&nbsp;<span class="op" id="4987338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987343">b</span>&nbsp;<span class="op" id="4987345">=</span>&nbsp;<span class="builtinfunc" id="4987347">append</span><span class="op" id="4987353">(</span><span class="ident" id="4987354">b</span><span class="op" id="4987355">,</span>&nbsp;<span class="builtintype" id="4987357">byte</span><span class="op" id="4987361">(</span><span class="ident" id="4987362">v</span><span class="op" id="4987363">)</span><span class="op" id="4987364">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987372">_</span><span class="op" id="4987373">,</span>&nbsp;<span class="ident" id="4987375">err</span>&nbsp;<span class="op" id="4987379">=</span>&nbsp;<span class="ident" id="4987381">z</span><span class="op" id="4987382">.</span><span class="ident" id="4987383">w</span><span class="op" id="4987384">.</span><span class="ident" id="4987385">Write</span><span class="op" id="4987390">(</span><span class="ident" id="4987391">b</span><span class="op" id="4987392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987395">}</span>&nbsp;<span class="keyword" id="4987397">else</span>&nbsp;<span class="op" id="4987402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987406">_</span><span class="op" id="4987407">,</span>&nbsp;<span class="ident" id="4987409">err</span>&nbsp;<span class="op" id="4987413">=</span>&nbsp;<span class="ident" id="4987415">io</span><span class="op" id="4987417">.</span><span class="ident" id="4987418">WriteString</span><span class="op" id="4987429">(</span><span class="ident" id="4987430">z</span><span class="op" id="4987431">.</span><span class="ident" id="4987432">w</span><span class="op" id="4987433">,</span>&nbsp;<span class="ident" id="4987435">s</span><span class="op" id="4987436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987439">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987442">if</span>&nbsp;<span class="ident" id="4987445">err</span>&nbsp;<span class="op" id="4987449">!=</span>&nbsp;<span class="ident" id="4987452">nil</span>&nbsp;<span class="op" id="4987456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987460">return</span>&nbsp;<span class="ident" id="4987467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987475">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987512">z</span><span class="op" id="4987513">.</span><span class="ident" id="4987514">buf</span><span class="op" id="4987517">[</span><span class="num" id="4987518">0</span><span class="op" id="4987519">]</span>&nbsp;<span class="op" id="4987521">=</span>&nbsp;<span class="num" id="4987523">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987526">_</span><span class="op" id="4987527">,</span>&nbsp;<span class="ident" id="4987529">err</span>&nbsp;<span class="op" id="4987533">=</span>&nbsp;<span class="ident" id="4987535">z</span><span class="op" id="4987536">.</span><span class="ident" id="4987537">w</span><span class="op" id="4987538">.</span><span class="ident" id="4987539">Write</span><span class="op" id="4987544">(</span><span class="ident" id="4987545">z</span><span class="op" id="4987546">.</span><span class="ident" id="4987547">buf</span><span class="op" id="4987550">[</span><span class="num" id="4987551">0</span><span class="op" id="4987552">:</span><span class="num" id="4987553">1</span><span class="op" id="4987554">]</span><span class="op" id="4987555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987558">return</span>&nbsp;<span class="ident" id="4987565">err</span><br>
<span class="lineno"></span><span class="op" id="4987569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4987572">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4987644">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4987720">func</span>&nbsp;<span class="op" id="4987725">(</span><span class="ident" id="4987726">z</span>&nbsp;<span class="op" id="4987728">*</span><span class="ident" id="4987729">Writer</span><span class="op" id="4987735">)</span>&nbsp;<span class="ident" id="4987737">Write</span><span class="op" id="4987742">(</span><span class="ident" id="4987743">p</span>&nbsp;<span class="op" id="4987745">[</span><span class="op" id="4987746">]</span><span class="builtintype" id="4987747">byte</span><span class="op" id="4987751">)</span>&nbsp;<span class="op" id="4987753">(</span><span class="builtintype" id="4987754">int</span><span class="op" id="4987757">,</span>&nbsp;<span class="builtintype" id="4987759">error</span><span class="op" id="4987764">)</span>&nbsp;<span class="op" id="4987766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987769">if</span>&nbsp;<span class="ident" id="4987772">z</span><span class="op" id="4987773">.</span><span class="ident" id="4987774">err</span>&nbsp;<span class="op" id="4987778">!=</span>&nbsp;<span class="ident" id="4987781">nil</span>&nbsp;<span class="op" id="4987785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987789">return</span>&nbsp;<span class="num" id="4987796">0</span><span class="op" id="4987797">,</span>&nbsp;<span class="ident" id="4987799">z</span><span class="op" id="4987800">.</span><span class="ident" id="4987801">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987806">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987809">var</span>&nbsp;<span class="ident" id="4987813">n</span>&nbsp;<span class="builtintype" id="4987815">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987820">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987854">if</span>&nbsp;<span class="op" id="4987857">!</span><span class="ident" id="4987858">z</span><span class="op" id="4987859">.</span><span class="ident" id="4987860">wroteHeader</span>&nbsp;<span class="op" id="4987872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987876">z</span><span class="op" id="4987877">.</span><span class="ident" id="4987878">wroteHeader</span>&nbsp;<span class="op" id="4987890">=</span>&nbsp;<span class="builtintype" id="4987892">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987899">z</span><span class="op" id="4987900">.</span><span class="ident" id="4987901">buf</span><span class="op" id="4987904">[</span><span class="num" id="4987905">0</span><span class="op" id="4987906">]</span>&nbsp;<span class="op" id="4987908">=</span>&nbsp;<span class="ident" id="4987910">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987920">z</span><span class="op" id="4987921">.</span><span class="ident" id="4987922">buf</span><span class="op" id="4987925">[</span><span class="num" id="4987926">1</span><span class="op" id="4987927">]</span>&nbsp;<span class="op" id="4987929">=</span>&nbsp;<span class="ident" id="4987931">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987941">z</span><span class="op" id="4987942">.</span><span class="ident" id="4987943">buf</span><span class="op" id="4987946">[</span><span class="num" id="4987947">2</span><span class="op" id="4987948">]</span>&nbsp;<span class="op" id="4987950">=</span>&nbsp;<span class="ident" id="4987952">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987966">z</span><span class="op" id="4987967">.</span><span class="ident" id="4987968">buf</span><span class="op" id="4987971">[</span><span class="num" id="4987972">3</span><span class="op" id="4987973">]</span>&nbsp;<span class="op" id="4987975">=</span>&nbsp;<span class="num" id="4987977">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987981">if</span>&nbsp;<span class="ident" id="4987984">z</span><span class="op" id="4987985">.</span><span class="ident" id="4987986">Extra</span>&nbsp;<span class="op" id="4987992">!=</span>&nbsp;<span class="ident" id="4987995">nil</span>&nbsp;<span class="op" id="4987999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988004">z</span><span class="op" id="4988005">.</span><span class="ident" id="4988006">buf</span><span class="op" id="4988009">[</span><span class="num" id="4988010">3</span><span class="op" id="4988011">]</span>&nbsp;<span class="op" id="4988013">|=</span>&nbsp;<span class="num" id="4988016">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988027">if</span>&nbsp;<span class="ident" id="4988030">z</span><span class="op" id="4988031">.</span><span class="ident" id="4988032">Name</span>&nbsp;<span class="op" id="4988037">!=</span>&nbsp;<span class="string" id="4988040">&#34;&#34;</span>&nbsp;<span class="op" id="4988043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988048">z</span><span class="op" id="4988049">.</span><span class="ident" id="4988050">buf</span><span class="op" id="4988053">[</span><span class="num" id="4988054">3</span><span class="op" id="4988055">]</span>&nbsp;<span class="op" id="4988057">|=</span>&nbsp;<span class="num" id="4988060">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988071">if</span>&nbsp;<span class="ident" id="4988074">z</span><span class="op" id="4988075">.</span><span class="ident" id="4988076">Comment</span>&nbsp;<span class="op" id="4988084">!=</span>&nbsp;<span class="string" id="4988087">&#34;&#34;</span>&nbsp;<span class="op" id="4988090">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988095">z</span><span class="op" id="4988096">.</span><span class="ident" id="4988097">buf</span><span class="op" id="4988100">[</span><span class="num" id="4988101">3</span><span class="op" id="4988102">]</span>&nbsp;<span class="op" id="4988104">|=</span>&nbsp;<span class="num" id="4988107">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988118">put4</span><span class="op" id="4988122">(</span><span class="ident" id="4988123">z</span><span class="op" id="4988124">.</span><span class="ident" id="4988125">buf</span><span class="op" id="4988128">[</span><span class="num" id="4988129">4</span><span class="op" id="4988130">:</span><span class="num" id="4988131">8</span><span class="op" id="4988132">]</span><span class="op" id="4988133">,</span>&nbsp;<span class="builtintype" id="4988135">uint32</span><span class="op" id="4988141">(</span><span class="ident" id="4988142">z</span><span class="op" id="4988143">.</span><span class="ident" id="4988144">ModTime</span><span class="op" id="4988151">.</span><span class="ident" id="4988152">Unix</span><span class="op" id="4988156">(</span><span class="op" id="4988157">)</span><span class="op" id="4988158">)</span><span class="op" id="4988159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988163">if</span>&nbsp;<span class="ident" id="4988166">z</span><span class="op" id="4988167">.</span><span class="ident" id="4988168">level</span>&nbsp;<span class="op" id="4988174">==</span>&nbsp;<span class="ident" id="4988177">BestCompression</span>&nbsp;<span class="op" id="4988193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988198">z</span><span class="op" id="4988199">.</span><span class="ident" id="4988200">buf</span><span class="op" id="4988203">[</span><span class="num" id="4988204">8</span><span class="op" id="4988205">]</span>&nbsp;<span class="op" id="4988207">=</span>&nbsp;<span class="num" id="4988209">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988213">}</span>&nbsp;<span class="keyword" id="4988215">else</span>&nbsp;<span class="keyword" id="4988220">if</span>&nbsp;<span class="ident" id="4988223">z</span><span class="op" id="4988224">.</span><span class="ident" id="4988225">level</span>&nbsp;<span class="op" id="4988231">==</span>&nbsp;<span class="ident" id="4988234">BestSpeed</span>&nbsp;<span class="op" id="4988244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988249">z</span><span class="op" id="4988250">.</span><span class="ident" id="4988251">buf</span><span class="op" id="4988254">[</span><span class="num" id="4988255">8</span><span class="op" id="4988256">]</span>&nbsp;<span class="op" id="4988258">=</span>&nbsp;<span class="num" id="4988260">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988264">}</span>&nbsp;<span class="keyword" id="4988266">else</span>&nbsp;<span class="op" id="4988271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988276">z</span><span class="op" id="4988277">.</span><span class="ident" id="4988278">buf</span><span class="op" id="4988281">[</span><span class="num" id="4988282">8</span><span class="op" id="4988283">]</span>&nbsp;<span class="op" id="4988285">=</span>&nbsp;<span class="num" id="4988287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988291">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988295">z</span><span class="op" id="4988296">.</span><span class="ident" id="4988297">buf</span><span class="op" id="4988300">[</span><span class="num" id="4988301">9</span><span class="op" id="4988302">]</span>&nbsp;<span class="op" id="4988304">=</span>&nbsp;<span class="ident" id="4988306">z</span><span class="op" id="4988307">.</span><span class="ident" id="4988308">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988313">n</span><span class="op" id="4988314">,</span>&nbsp;<span class="ident" id="4988316">z</span><span class="op" id="4988317">.</span><span class="ident" id="4988318">err</span>&nbsp;<span class="op" id="4988322">=</span>&nbsp;<span class="ident" id="4988324">z</span><span class="op" id="4988325">.</span><span class="ident" id="4988326">w</span><span class="op" id="4988327">.</span><span class="ident" id="4988328">Write</span><span class="op" id="4988333">(</span><span class="ident" id="4988334">z</span><span class="op" id="4988335">.</span><span class="ident" id="4988336">buf</span><span class="op" id="4988339">[</span><span class="num" id="4988340">0</span><span class="op" id="4988341">:</span><span class="num" id="4988342">10</span><span class="op" id="4988344">]</span><span class="op" id="4988345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988349">if</span>&nbsp;<span class="ident" id="4988352">z</span><span class="op" id="4988353">.</span><span class="ident" id="4988354">err</span>&nbsp;<span class="op" id="4988358">!=</span>&nbsp;<span class="ident" id="4988361">nil</span>&nbsp;<span class="op" id="4988365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988370">return</span>&nbsp;<span class="ident" id="4988377">n</span><span class="op" id="4988378">,</span>&nbsp;<span class="ident" id="4988380">z</span><span class="op" id="4988381">.</span><span class="ident" id="4988382">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988388">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988392">if</span>&nbsp;<span class="ident" id="4988395">z</span><span class="op" id="4988396">.</span><span class="ident" id="4988397">Extra</span>&nbsp;<span class="op" id="4988403">!=</span>&nbsp;<span class="ident" id="4988406">nil</span>&nbsp;<span class="op" id="4988410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988415">z</span><span class="op" id="4988416">.</span><span class="ident" id="4988417">err</span>&nbsp;<span class="op" id="4988421">=</span>&nbsp;<span class="ident" id="4988423">z</span><span class="op" id="4988424">.</span><span class="ident" id="4988425">writeBytes</span><span class="op" id="4988435">(</span><span class="ident" id="4988436">z</span><span class="op" id="4988437">.</span><span class="ident" id="4988438">Extra</span><span class="op" id="4988443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988448">if</span>&nbsp;<span class="ident" id="4988451">z</span><span class="op" id="4988452">.</span><span class="ident" id="4988453">err</span>&nbsp;<span class="op" id="4988457">!=</span>&nbsp;<span class="ident" id="4988460">nil</span>&nbsp;<span class="op" id="4988464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988470">return</span>&nbsp;<span class="ident" id="4988477">n</span><span class="op" id="4988478">,</span>&nbsp;<span class="ident" id="4988480">z</span><span class="op" id="4988481">.</span><span class="ident" id="4988482">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988489">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988497">if</span>&nbsp;<span class="ident" id="4988500">z</span><span class="op" id="4988501">.</span><span class="ident" id="4988502">Name</span>&nbsp;<span class="op" id="4988507">!=</span>&nbsp;<span class="string" id="4988510">&#34;&#34;</span>&nbsp;<span class="op" id="4988513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988518">z</span><span class="op" id="4988519">.</span><span class="ident" id="4988520">err</span>&nbsp;<span class="op" id="4988524">=</span>&nbsp;<span class="ident" id="4988526">z</span><span class="op" id="4988527">.</span><span class="ident" id="4988528">writeString</span><span class="op" id="4988539">(</span><span class="ident" id="4988540">z</span><span class="op" id="4988541">.</span><span class="ident" id="4988542">Name</span><span class="op" id="4988546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988551">if</span>&nbsp;<span class="ident" id="4988554">z</span><span class="op" id="4988555">.</span><span class="ident" id="4988556">err</span>&nbsp;<span class="op" id="4988560">!=</span>&nbsp;<span class="ident" id="4988563">nil</span>&nbsp;<span class="op" id="4988567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988573">return</span>&nbsp;<span class="ident" id="4988580">n</span><span class="op" id="4988581">,</span>&nbsp;<span class="ident" id="4988583">z</span><span class="op" id="4988584">.</span><span class="ident" id="4988585">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988600">if</span>&nbsp;<span class="ident" id="4988603">z</span><span class="op" id="4988604">.</span><span class="ident" id="4988605">Comment</span>&nbsp;<span class="op" id="4988613">!=</span>&nbsp;<span class="string" id="4988616">&#34;&#34;</span>&nbsp;<span class="op" id="4988619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988624">z</span><span class="op" id="4988625">.</span><span class="ident" id="4988626">err</span>&nbsp;<span class="op" id="4988630">=</span>&nbsp;<span class="ident" id="4988632">z</span><span class="op" id="4988633">.</span><span class="ident" id="4988634">writeString</span><span class="op" id="4988645">(</span><span class="ident" id="4988646">z</span><span class="op" id="4988647">.</span><span class="ident" id="4988648">Comment</span><span class="op" id="4988655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988660">if</span>&nbsp;<span class="ident" id="4988663">z</span><span class="op" id="4988664">.</span><span class="ident" id="4988665">err</span>&nbsp;<span class="op" id="4988669">!=</span>&nbsp;<span class="ident" id="4988672">nil</span>&nbsp;<span class="op" id="4988676">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988682">return</span>&nbsp;<span class="ident" id="4988689">n</span><span class="op" id="4988690">,</span>&nbsp;<span class="ident" id="4988692">z</span><span class="op" id="4988693">.</span><span class="ident" id="4988694">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988709">if</span>&nbsp;<span class="ident" id="4988712">z</span><span class="op" id="4988713">.</span><span class="ident" id="4988714">compressor</span>&nbsp;<span class="op" id="4988725">==</span>&nbsp;<span class="ident" id="4988728">nil</span>&nbsp;<span class="op" id="4988732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988737">z</span><span class="op" id="4988738">.</span><span class="ident" id="4988739">compressor</span><span class="op" id="4988749">,</span>&nbsp;<span class="ident" id="4988751">_</span>&nbsp;<span class="op" id="4988753">=</span>&nbsp;<span class="ident" id="4988755">flate</span><span class="op" id="4988760">.</span><span class="ident" id="4988761">NewWriter</span><span class="op" id="4988770">(</span><span class="ident" id="4988771">z</span><span class="op" id="4988772">.</span><span class="ident" id="4988773">w</span><span class="op" id="4988774">,</span>&nbsp;<span class="ident" id="4988776">z</span><span class="op" id="4988777">.</span><span class="ident" id="4988778">level</span><span class="op" id="4988783">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988793">z</span><span class="op" id="4988794">.</span><span class="ident" id="4988795">size</span>&nbsp;<span class="op" id="4988800">+=</span>&nbsp;<span class="builtintype" id="4988803">uint32</span><span class="op" id="4988809">(</span><span class="builtinfunc" id="4988810">len</span><span class="op" id="4988813">(</span><span class="ident" id="4988814">p</span><span class="op" id="4988815">)</span><span class="op" id="4988816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988819">z</span><span class="op" id="4988820">.</span><span class="ident" id="4988821">digest</span><span class="op" id="4988827">.</span><span class="ident" id="4988828">Write</span><span class="op" id="4988833">(</span><span class="ident" id="4988834">p</span><span class="op" id="4988835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988838">n</span><span class="op" id="4988839">,</span>&nbsp;<span class="ident" id="4988841">z</span><span class="op" id="4988842">.</span><span class="ident" id="4988843">err</span>&nbsp;<span class="op" id="4988847">=</span>&nbsp;<span class="ident" id="4988849">z</span><span class="op" id="4988850">.</span><span class="ident" id="4988851">compressor</span><span class="op" id="4988861">.</span><span class="ident" id="4988862">Write</span><span class="op" id="4988867">(</span><span class="ident" id="4988868">p</span><span class="op" id="4988869">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988872">return</span>&nbsp;<span class="ident" id="4988879">n</span><span class="op" id="4988880">,</span>&nbsp;<span class="ident" id="4988882">z</span><span class="op" id="4988883">.</span><span class="ident" id="4988884">err</span><br>
<span class="lineno"></span><span class="op" id="4988888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4988891">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4988962">//</span><br>
<span class="lineno">225</span><span class="comment" id="4988965">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4989036">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4989107">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4989172">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4989226">//</span><br>
<span class="lineno">230</span><span class="comment" id="4989229">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4989309">func</span>&nbsp;<span class="op" id="4989314">(</span><span class="ident" id="4989315">z</span>&nbsp;<span class="op" id="4989317">*</span><span class="ident" id="4989318">Writer</span><span class="op" id="4989324">)</span>&nbsp;<span class="ident" id="4989326">Flush</span><span class="op" id="4989331">(</span><span class="op" id="4989332">)</span>&nbsp;<span class="builtintype" id="4989334">error</span>&nbsp;<span class="op" id="4989340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989343">if</span>&nbsp;<span class="ident" id="4989346">z</span><span class="op" id="4989347">.</span><span class="ident" id="4989348">err</span>&nbsp;<span class="op" id="4989352">!=</span>&nbsp;<span class="ident" id="4989355">nil</span>&nbsp;<span class="op" id="4989359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989363">return</span>&nbsp;<span class="ident" id="4989370">z</span><span class="op" id="4989371">.</span><span class="ident" id="4989372">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989377">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989380">if</span>&nbsp;<span class="ident" id="4989383">z</span><span class="op" id="4989384">.</span><span class="ident" id="4989385">closed</span>&nbsp;<span class="op" id="4989392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989396">return</span>&nbsp;<span class="ident" id="4989403">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989411">if</span>&nbsp;<span class="op" id="4989414">!</span><span class="ident" id="4989415">z</span><span class="op" id="4989416">.</span><span class="ident" id="4989417">wroteHeader</span>&nbsp;<span class="op" id="4989429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989433">z</span><span class="op" id="4989434">.</span><span class="ident" id="4989435">Write</span><span class="op" id="4989440">(</span><span class="ident" id="4989441">nil</span><span class="op" id="4989444">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989448">if</span>&nbsp;<span class="ident" id="4989451">z</span><span class="op" id="4989452">.</span><span class="ident" id="4989453">err</span>&nbsp;<span class="op" id="4989457">!=</span>&nbsp;<span class="ident" id="4989460">nil</span>&nbsp;<span class="op" id="4989464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989469">return</span>&nbsp;<span class="ident" id="4989476">z</span><span class="op" id="4989477">.</span><span class="ident" id="4989478">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989490">z</span><span class="op" id="4989491">.</span><span class="ident" id="4989492">err</span>&nbsp;<span class="op" id="4989496">=</span>&nbsp;<span class="ident" id="4989498">z</span><span class="op" id="4989499">.</span><span class="ident" id="4989500">compressor</span><span class="op" id="4989510">.</span><span class="ident" id="4989511">Flush</span><span class="op" id="4989516">(</span><span class="op" id="4989517">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989520">return</span>&nbsp;<span class="ident" id="4989527">z</span><span class="op" id="4989528">.</span><span class="ident" id="4989529">err</span><br>
<span class="lineno"></span><span class="op" id="4989533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4989536">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4989610">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4989669">func</span>&nbsp;<span class="op" id="4989674">(</span><span class="ident" id="4989675">z</span>&nbsp;<span class="op" id="4989677">*</span><span class="ident" id="4989678">Writer</span><span class="op" id="4989684">)</span>&nbsp;<span class="ident" id="4989686">Close</span><span class="op" id="4989691">(</span><span class="op" id="4989692">)</span>&nbsp;<span class="builtintype" id="4989694">error</span>&nbsp;<span class="op" id="4989700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989703">if</span>&nbsp;<span class="ident" id="4989706">z</span><span class="op" id="4989707">.</span><span class="ident" id="4989708">err</span>&nbsp;<span class="op" id="4989712">!=</span>&nbsp;<span class="ident" id="4989715">nil</span>&nbsp;<span class="op" id="4989719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989723">return</span>&nbsp;<span class="ident" id="4989730">z</span><span class="op" id="4989731">.</span><span class="ident" id="4989732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989740">if</span>&nbsp;<span class="ident" id="4989743">z</span><span class="op" id="4989744">.</span><span class="ident" id="4989745">closed</span>&nbsp;<span class="op" id="4989752">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989756">return</span>&nbsp;<span class="ident" id="4989763">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989771">z</span><span class="op" id="4989772">.</span><span class="ident" id="4989773">closed</span>&nbsp;<span class="op" id="4989780">=</span>&nbsp;<span class="builtintype" id="4989782">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989788">if</span>&nbsp;<span class="op" id="4989791">!</span><span class="ident" id="4989792">z</span><span class="op" id="4989793">.</span><span class="ident" id="4989794">wroteHeader</span>&nbsp;<span class="op" id="4989806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989810">z</span><span class="op" id="4989811">.</span><span class="ident" id="4989812">Write</span><span class="op" id="4989817">(</span><span class="ident" id="4989818">nil</span><span class="op" id="4989821">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989825">if</span>&nbsp;<span class="ident" id="4989828">z</span><span class="op" id="4989829">.</span><span class="ident" id="4989830">err</span>&nbsp;<span class="op" id="4989834">!=</span>&nbsp;<span class="ident" id="4989837">nil</span>&nbsp;<span class="op" id="4989841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989846">return</span>&nbsp;<span class="ident" id="4989853">z</span><span class="op" id="4989854">.</span><span class="ident" id="4989855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989867">z</span><span class="op" id="4989868">.</span><span class="ident" id="4989869">err</span>&nbsp;<span class="op" id="4989873">=</span>&nbsp;<span class="ident" id="4989875">z</span><span class="op" id="4989876">.</span><span class="ident" id="4989877">compressor</span><span class="op" id="4989887">.</span><span class="ident" id="4989888">Close</span><span class="op" id="4989893">(</span><span class="op" id="4989894">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989897">if</span>&nbsp;<span class="ident" id="4989900">z</span><span class="op" id="4989901">.</span><span class="ident" id="4989902">err</span>&nbsp;<span class="op" id="4989906">!=</span>&nbsp;<span class="ident" id="4989909">nil</span>&nbsp;<span class="op" id="4989913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989917">return</span>&nbsp;<span class="ident" id="4989924">z</span><span class="op" id="4989925">.</span><span class="ident" id="4989926">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989934">put4</span><span class="op" id="4989938">(</span><span class="ident" id="4989939">z</span><span class="op" id="4989940">.</span><span class="ident" id="4989941">buf</span><span class="op" id="4989944">[</span><span class="num" id="4989945">0</span><span class="op" id="4989946">:</span><span class="num" id="4989947">4</span><span class="op" id="4989948">]</span><span class="op" id="4989949">,</span>&nbsp;<span class="ident" id="4989951">z</span><span class="op" id="4989952">.</span><span class="ident" id="4989953">digest</span><span class="op" id="4989959">.</span><span class="ident" id="4989960">Sum32</span><span class="op" id="4989965">(</span><span class="op" id="4989966">)</span><span class="op" id="4989967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989970">put4</span><span class="op" id="4989974">(</span><span class="ident" id="4989975">z</span><span class="op" id="4989976">.</span><span class="ident" id="4989977">buf</span><span class="op" id="4989980">[</span><span class="num" id="4989981">4</span><span class="op" id="4989982">:</span><span class="num" id="4989983">8</span><span class="op" id="4989984">]</span><span class="op" id="4989985">,</span>&nbsp;<span class="ident" id="4989987">z</span><span class="op" id="4989988">.</span><span class="ident" id="4989989">size</span><span class="op" id="4989993">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989996">_</span><span class="op" id="4989997">,</span>&nbsp;<span class="ident" id="4989999">z</span><span class="op" id="4990000">.</span><span class="ident" id="4990001">err</span>&nbsp;<span class="op" id="4990005">=</span>&nbsp;<span class="ident" id="4990007">z</span><span class="op" id="4990008">.</span><span class="ident" id="4990009">w</span><span class="op" id="4990010">.</span><span class="ident" id="4990011">Write</span><span class="op" id="4990016">(</span><span class="ident" id="4990017">z</span><span class="op" id="4990018">.</span><span class="ident" id="4990019">buf</span><span class="op" id="4990022">[</span><span class="num" id="4990023">0</span><span class="op" id="4990024">:</span><span class="num" id="4990025">8</span><span class="op" id="4990026">]</span><span class="op" id="4990027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990030">return</span>&nbsp;<span class="ident" id="4990037">z</span><span class="op" id="4990038">.</span><span class="ident" id="4990039">err</span><br>
<span class="lineno"></span><span class="op" id="4990043">}</span>
</div>
</body>
</html>
