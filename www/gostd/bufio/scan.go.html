<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1836628">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1836683">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1836737">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1836788">package</span>&nbsp;<span class="ident" id="1836796">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1836803">import</span>&nbsp;<span class="op" id="1836810">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1836813">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1836822">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1836832">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1836838">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1836853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1836856">//&nbsp;Scanner&nbsp;provides&nbsp;a&nbsp;convenient&nbsp;interface&nbsp;for&nbsp;reading&nbsp;data&nbsp;such&nbsp;as</span><br>
<span class="lineno">15</span><span class="comment" id="1836924">//&nbsp;a&nbsp;file&nbsp;of&nbsp;newline-delimited&nbsp;lines&nbsp;of&nbsp;text.&nbsp;Successive&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1836990">//&nbsp;the&nbsp;Scan&nbsp;method&nbsp;will&nbsp;step&nbsp;through&nbsp;the&nbsp;&#39;tokens&#39;&nbsp;of&nbsp;a&nbsp;file,&nbsp;skipping</span><br>
<span class="lineno"></span><span class="comment" id="1837060">//&nbsp;the&nbsp;bytes&nbsp;between&nbsp;the&nbsp;tokens.&nbsp;The&nbsp;specification&nbsp;of&nbsp;a&nbsp;token&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1837125">//&nbsp;defined&nbsp;by&nbsp;a&nbsp;split&nbsp;function&nbsp;of&nbsp;type&nbsp;SplitFunc;&nbsp;the&nbsp;default&nbsp;split</span><br>
<span class="lineno"></span><span class="comment" id="1837193">//&nbsp;function&nbsp;breaks&nbsp;the&nbsp;input&nbsp;into&nbsp;lines&nbsp;with&nbsp;line&nbsp;termination&nbsp;stripped.&nbsp;Split</span><br>
<span class="lineno">20</span><span class="comment" id="1837271">//&nbsp;functions&nbsp;are&nbsp;defined&nbsp;in&nbsp;this&nbsp;package&nbsp;for&nbsp;scanning&nbsp;a&nbsp;file&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="1837337">//&nbsp;lines,&nbsp;bytes,&nbsp;UTF-8-encoded&nbsp;runes,&nbsp;and&nbsp;space-delimited&nbsp;words.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="1837406">//&nbsp;client&nbsp;may&nbsp;instead&nbsp;provide&nbsp;a&nbsp;custom&nbsp;split&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="1837461">//</span><br>
<span class="lineno"></span><span class="comment" id="1837464">//&nbsp;Scanning&nbsp;stops&nbsp;unrecoverably&nbsp;at&nbsp;EOF,&nbsp;the&nbsp;first&nbsp;I/O&nbsp;error,&nbsp;or&nbsp;a&nbsp;token&nbsp;too</span><br>
<span class="lineno">25</span><span class="comment" id="1837540">//&nbsp;large&nbsp;to&nbsp;fit&nbsp;in&nbsp;the&nbsp;buffer.&nbsp;When&nbsp;a&nbsp;scan&nbsp;stops,&nbsp;the&nbsp;reader&nbsp;may&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="1837610">//&nbsp;advanced&nbsp;arbitrarily&nbsp;far&nbsp;past&nbsp;the&nbsp;last&nbsp;token.&nbsp;Programs&nbsp;that&nbsp;need&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="1837683">//&nbsp;control&nbsp;over&nbsp;error&nbsp;handling&nbsp;or&nbsp;large&nbsp;tokens,&nbsp;or&nbsp;must&nbsp;run&nbsp;sequential&nbsp;scans</span><br>
<span class="lineno"></span><span class="comment" id="1837760">//&nbsp;on&nbsp;a&nbsp;reader,&nbsp;should&nbsp;use&nbsp;bufio.Reader&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="1837809">//</span><br>
<span class="lineno">30</span><span class="keyword" id="1837812">type</span>&nbsp;<span class="ident" id="1837817">Scanner</span>&nbsp;<span class="keyword" id="1837825">struct</span>&nbsp;<span class="op" id="1837832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1837835">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1837848">io</span><span class="op" id="1837850">.</span><span class="ident" id="1837851">Reader</span>&nbsp;<span class="comment" id="1837858">//&nbsp;The&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1837897">split</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1837910">SplitFunc</span>&nbsp;<span class="comment" id="1837920">//&nbsp;The&nbsp;function&nbsp;to&nbsp;split&nbsp;the&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1837958">maxTokenSize</span>&nbsp;<span class="builtintype" id="1837971">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1837981">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;a&nbsp;token;&nbsp;modified&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1838029">token</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1838042">[</span><span class="op" id="1838043">]</span><span class="builtintype" id="1838044">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1838052">//&nbsp;Last&nbsp;token&nbsp;returned&nbsp;by&nbsp;split.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1838086">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1838099">[</span><span class="op" id="1838100">]</span><span class="builtintype" id="1838101">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1838109">//&nbsp;Buffer&nbsp;used&nbsp;as&nbsp;argument&nbsp;to&nbsp;split.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1838147">start</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1838160">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1838170">//&nbsp;First&nbsp;non-processed&nbsp;byte&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1838207">end</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1838220">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1838230">//&nbsp;End&nbsp;of&nbsp;data&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1838254">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1838267">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1838277">//&nbsp;Sticky&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1838295">empties</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1838308">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1838318">//&nbsp;Count&nbsp;of&nbsp;successive&nbsp;empty&nbsp;tokens.</span><br>
<span class="lineno">40</span><span class="op" id="1838355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1838358">//&nbsp;SplitFunc&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;the&nbsp;split&nbsp;function&nbsp;used&nbsp;to&nbsp;tokenize&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1838431">//&nbsp;input.&nbsp;The&nbsp;arguments&nbsp;are&nbsp;an&nbsp;initial&nbsp;substring&nbsp;of&nbsp;the&nbsp;remaining&nbsp;unprocessed</span><br>
<span class="lineno"></span><span class="comment" id="1838509">//&nbsp;data&nbsp;and&nbsp;a&nbsp;flag,&nbsp;atEOF,&nbsp;that&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Reader&nbsp;has&nbsp;no&nbsp;more&nbsp;data</span><br>
<span class="lineno">45</span><span class="comment" id="1838585">//&nbsp;to&nbsp;give.&nbsp;The&nbsp;return&nbsp;values&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;advance&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="1838660">//&nbsp;and&nbsp;the&nbsp;next&nbsp;token&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;user,&nbsp;plus&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1838735">//&nbsp;data&nbsp;does&nbsp;not&nbsp;yet&nbsp;hold&nbsp;a&nbsp;complete&nbsp;token,&nbsp;for&nbsp;instance&nbsp;if&nbsp;it&nbsp;has&nbsp;no&nbsp;newline</span><br>
<span class="lineno"></span><span class="comment" id="1838813">//&nbsp;while&nbsp;scanning&nbsp;lines,&nbsp;SplitFunc&nbsp;can&nbsp;return&nbsp;(0,&nbsp;nil,&nbsp;nil)&nbsp;to&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1838887">//&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;more&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;and&nbsp;try&nbsp;again&nbsp;with&nbsp;a&nbsp;longer&nbsp;slice</span><br>
<span class="lineno">50</span><span class="comment" id="1838965">//&nbsp;starting&nbsp;at&nbsp;the&nbsp;same&nbsp;point&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="1839009">//</span><br>
<span class="lineno"></span><span class="comment" id="1839012">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;error&nbsp;is&nbsp;non-nil,&nbsp;scanning&nbsp;stops&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1839078">//&nbsp;is&nbsp;returned&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="1839108">//</span><br>
<span class="lineno">55</span><span class="comment" id="1839111">//&nbsp;The&nbsp;function&nbsp;is&nbsp;never&nbsp;called&nbsp;with&nbsp;an&nbsp;empty&nbsp;data&nbsp;slice&nbsp;unless&nbsp;atEOF</span><br>
<span class="lineno"></span><span class="comment" id="1839181">//&nbsp;is&nbsp;true.&nbsp;If&nbsp;atEOF&nbsp;is&nbsp;true,&nbsp;however,&nbsp;data&nbsp;may&nbsp;be&nbsp;non-empty&nbsp;and,</span><br>
<span class="lineno"></span><span class="comment" id="1839247">//&nbsp;as&nbsp;always,&nbsp;holds&nbsp;unprocessed&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="1839285">type</span>&nbsp;<span class="ident" id="1839290">SplitFunc</span>&nbsp;<span class="keyword" id="1839300">func</span><span class="op" id="1839304">(</span><span class="ident" id="1839305">data</span>&nbsp;<span class="op" id="1839310">[</span><span class="op" id="1839311">]</span><span class="builtintype" id="1839312">byte</span><span class="op" id="1839316">,</span>&nbsp;<span class="ident" id="1839318">atEOF</span>&nbsp;<span class="builtintype" id="1839324">bool</span><span class="op" id="1839328">)</span>&nbsp;<span class="op" id="1839330">(</span><span class="ident" id="1839331">advance</span>&nbsp;<span class="builtintype" id="1839339">int</span><span class="op" id="1839342">,</span>&nbsp;<span class="ident" id="1839344">token</span>&nbsp;<span class="op" id="1839350">[</span><span class="op" id="1839351">]</span><span class="builtintype" id="1839352">byte</span><span class="op" id="1839356">,</span>&nbsp;<span class="ident" id="1839358">err</span>&nbsp;<span class="builtintype" id="1839362">error</span><span class="op" id="1839367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1839370">//&nbsp;Errors&nbsp;returned&nbsp;by&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="1839401">var</span>&nbsp;<span class="op" id="1839405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1839408">ErrTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1839427">=</span>&nbsp;<span class="ident" id="1839429">errors</span><span class="op" id="1839435">.</span><span class="ident" id="1839436">New</span><span class="op" id="1839439">(</span><span class="string" id="1839440">&#34;bufio.Scanner:&nbsp;token&nbsp;too&nbsp;long&#34;</span><span class="op" id="1839471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1839474">ErrNegativeAdvance</span>&nbsp;<span class="op" id="1839493">=</span>&nbsp;<span class="ident" id="1839495">errors</span><span class="op" id="1839501">.</span><span class="ident" id="1839502">New</span><span class="op" id="1839505">(</span><span class="string" id="1839506">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;negative&nbsp;advance&nbsp;count&#34;</span><span class="op" id="1839563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1839566">ErrAdvanceTooFar</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1839585">=</span>&nbsp;<span class="ident" id="1839587">errors</span><span class="op" id="1839593">.</span><span class="ident" id="1839594">New</span><span class="op" id="1839597">(</span><span class="string" id="1839598">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;advance&nbsp;count&nbsp;beyond&nbsp;input&#34;</span><span class="op" id="1839659">)</span><br>
<span class="lineno">65</span><span class="op" id="1839661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1839664">const</span>&nbsp;<span class="op" id="1839670">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1839673">//&nbsp;MaxScanTokenSize&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;used&nbsp;to&nbsp;buffer&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1839738">//&nbsp;The&nbsp;actual&nbsp;maximum&nbsp;token&nbsp;size&nbsp;may&nbsp;be&nbsp;smaller&nbsp;as&nbsp;the&nbsp;buffer</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1839801">//&nbsp;may&nbsp;need&nbsp;to&nbsp;include,&nbsp;for&nbsp;instance,&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1839851">MaxScanTokenSize</span>&nbsp;<span class="op" id="1839868">=</span>&nbsp;<span class="num" id="1839870">64</span>&nbsp;<span class="op" id="1839873">*</span>&nbsp;<span class="num" id="1839875">1024</span><br>
<span class="lineno"></span><span class="op" id="1839880">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1839883">//&nbsp;NewScanner&nbsp;returns&nbsp;a&nbsp;new&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno">75</span><span class="comment" id="1839935">//&nbsp;The&nbsp;split&nbsp;function&nbsp;defaults&nbsp;to&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="1839980">func</span>&nbsp;<span class="ident" id="1839985">NewScanner</span><span class="op" id="1839995">(</span><span class="ident" id="1839996">r</span>&nbsp;<span class="ident" id="1839998">io</span><span class="op" id="1840000">.</span><span class="ident" id="1840001">Reader</span><span class="op" id="1840007">)</span>&nbsp;<span class="op" id="1840009">*</span><span class="ident" id="1840010">Scanner</span>&nbsp;<span class="op" id="1840018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1840021">return</span>&nbsp;<span class="op" id="1840028">&amp;</span><span class="ident" id="1840029">Scanner</span><span class="op" id="1840036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1840040">r</span><span class="op" id="1840041">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1840054">r</span><span class="op" id="1840055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1840059">split</span><span class="op" id="1840064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1840073">ScanLines</span><span class="op" id="1840082">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1840086">maxTokenSize</span><span class="op" id="1840098">:</span>&nbsp;<span class="ident" id="1840100">MaxScanTokenSize</span><span class="op" id="1840116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1840120">buf</span><span class="op" id="1840123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1840134">make</span><span class="op" id="1840138">(</span><span class="op" id="1840139">[</span><span class="op" id="1840140">]</span><span class="builtintype" id="1840141">byte</span><span class="op" id="1840145">,</span>&nbsp;<span class="num" id="1840147">4096</span><span class="op" id="1840151">)</span><span class="op" id="1840152">,</span>&nbsp;<span class="comment" id="1840154">//&nbsp;Plausible&nbsp;starting&nbsp;size;&nbsp;needn&#39;t&nbsp;be&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1840201">}</span><br>
<span class="lineno"></span><span class="op" id="1840203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1840206">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;first&nbsp;non-EOF&nbsp;error&nbsp;that&nbsp;was&nbsp;encountered&nbsp;by&nbsp;the&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="1840282">func</span>&nbsp;<span class="op" id="1840287">(</span><span class="ident" id="1840288">s</span>&nbsp;<span class="op" id="1840290">*</span><span class="ident" id="1840291">Scanner</span><span class="op" id="1840298">)</span>&nbsp;<span class="ident" id="1840300">Err</span><span class="op" id="1840303">(</span><span class="op" id="1840304">)</span>&nbsp;<span class="builtintype" id="1840306">error</span>&nbsp;<span class="op" id="1840312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1840315">if</span>&nbsp;<span class="ident" id="1840318">s</span><span class="op" id="1840319">.</span><span class="ident" id="1840320">err</span>&nbsp;<span class="op" id="1840324">==</span>&nbsp;<span class="ident" id="1840327">io</span><span class="op" id="1840329">.</span><span class="ident" id="1840330">EOF</span>&nbsp;<span class="op" id="1840334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1840338">return</span>&nbsp;<span class="builtintype" id="1840345">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1840350">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1840353">return</span>&nbsp;<span class="ident" id="1840360">s</span><span class="op" id="1840361">.</span><span class="ident" id="1840362">err</span><br>
<span class="lineno"></span><span class="op" id="1840366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1840369">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="comment" id="1840437">//&nbsp;The&nbsp;underlying&nbsp;array&nbsp;may&nbsp;point&nbsp;to&nbsp;data&nbsp;that&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno">95</span><span class="comment" id="1840504">//&nbsp;by&nbsp;a&nbsp;subsequent&nbsp;call&nbsp;to&nbsp;Scan.&nbsp;It&nbsp;does&nbsp;no&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="1840560">func</span>&nbsp;<span class="op" id="1840565">(</span><span class="ident" id="1840566">s</span>&nbsp;<span class="op" id="1840568">*</span><span class="ident" id="1840569">Scanner</span><span class="op" id="1840576">)</span>&nbsp;<span class="ident" id="1840578">Bytes</span><span class="op" id="1840583">(</span><span class="op" id="1840584">)</span>&nbsp;<span class="op" id="1840586">[</span><span class="op" id="1840587">]</span><span class="builtintype" id="1840588">byte</span>&nbsp;<span class="op" id="1840593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1840596">return</span>&nbsp;<span class="ident" id="1840603">s</span><span class="op" id="1840604">.</span><span class="ident" id="1840605">token</span><br>
<span class="lineno"></span><span class="op" id="1840611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="1840614">//&nbsp;Text&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan</span><br>
<span class="lineno"></span><span class="comment" id="1840680">//&nbsp;as&nbsp;a&nbsp;newly&nbsp;allocated&nbsp;string&nbsp;holding&nbsp;its&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1840730">func</span>&nbsp;<span class="op" id="1840735">(</span><span class="ident" id="1840736">s</span>&nbsp;<span class="op" id="1840738">*</span><span class="ident" id="1840739">Scanner</span><span class="op" id="1840746">)</span>&nbsp;<span class="ident" id="1840748">Text</span><span class="op" id="1840752">(</span><span class="op" id="1840753">)</span>&nbsp;<span class="builtintype" id="1840755">string</span>&nbsp;<span class="op" id="1840762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1840765">return</span>&nbsp;<span class="builtintype" id="1840772">string</span><span class="op" id="1840778">(</span><span class="ident" id="1840779">s</span><span class="op" id="1840780">.</span><span class="ident" id="1840781">token</span><span class="op" id="1840786">)</span><br>
<span class="lineno"></span><span class="op" id="1840788">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="1840791">//&nbsp;Scan&nbsp;advances&nbsp;the&nbsp;Scanner&nbsp;to&nbsp;the&nbsp;next&nbsp;token,&nbsp;which&nbsp;will&nbsp;then&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1840858">//&nbsp;available&nbsp;through&nbsp;the&nbsp;Bytes&nbsp;or&nbsp;Text&nbsp;method.&nbsp;It&nbsp;returns&nbsp;false&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1840931">//&nbsp;scan&nbsp;stops,&nbsp;either&nbsp;by&nbsp;reaching&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;or&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="1840999">//&nbsp;After&nbsp;Scan&nbsp;returns&nbsp;false,&nbsp;the&nbsp;Err&nbsp;method&nbsp;will&nbsp;return&nbsp;any&nbsp;error&nbsp;that</span><br>
<span class="lineno">110</span><span class="comment" id="1841070">//&nbsp;occurred&nbsp;during&nbsp;scanning,&nbsp;except&nbsp;that&nbsp;if&nbsp;it&nbsp;was&nbsp;io.EOF,&nbsp;Err</span><br>
<span class="lineno"></span><span class="comment" id="1841133">//&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1841153">//&nbsp;Split&nbsp;panics&nbsp;if&nbsp;the&nbsp;split&nbsp;function&nbsp;returns&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="1841224">//&nbsp;advancing&nbsp;the&nbsp;input.&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;error&nbsp;mode&nbsp;for&nbsp;scanners.</span><br>
<span class="lineno"></span><span class="keyword" id="1841290">func</span>&nbsp;<span class="op" id="1841295">(</span><span class="ident" id="1841296">s</span>&nbsp;<span class="op" id="1841298">*</span><span class="ident" id="1841299">Scanner</span><span class="op" id="1841306">)</span>&nbsp;<span class="ident" id="1841308">Scan</span><span class="op" id="1841312">(</span><span class="op" id="1841313">)</span>&nbsp;<span class="builtintype" id="1841315">bool</span>&nbsp;<span class="op" id="1841320">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1841323">//&nbsp;Loop&nbsp;until&nbsp;we&nbsp;have&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841355">for</span>&nbsp;<span class="op" id="1841359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1841363">//&nbsp;See&nbsp;if&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;already&nbsp;have.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1841421">//&nbsp;If&nbsp;we&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;data&nbsp;but&nbsp;have&nbsp;an&nbsp;error,&nbsp;give&nbsp;the&nbsp;split&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1841494">//&nbsp;a&nbsp;chance&nbsp;to&nbsp;recover&nbsp;any&nbsp;remaining,&nbsp;possibly&nbsp;empty&nbsp;token.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841556">if</span>&nbsp;<span class="ident" id="1841559">s</span><span class="op" id="1841560">.</span><span class="ident" id="1841561">end</span>&nbsp;<span class="op" id="1841565">&gt;</span>&nbsp;<span class="ident" id="1841567">s</span><span class="op" id="1841568">.</span><span class="ident" id="1841569">start</span>&nbsp;<span class="op" id="1841575">||</span>&nbsp;<span class="ident" id="1841578">s</span><span class="op" id="1841579">.</span><span class="ident" id="1841580">err</span>&nbsp;<span class="op" id="1841584">!=</span>&nbsp;<span class="builtintype" id="1841587">nil</span>&nbsp;<span class="op" id="1841591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1841596">advance</span><span class="op" id="1841603">,</span>&nbsp;<span class="ident" id="1841605">token</span><span class="op" id="1841610">,</span>&nbsp;<span class="ident" id="1841612">err</span>&nbsp;<span class="op" id="1841616">:=</span>&nbsp;<span class="ident" id="1841619">s</span><span class="op" id="1841620">.</span><span class="ident" id="1841621">split</span><span class="op" id="1841626">(</span><span class="ident" id="1841627">s</span><span class="op" id="1841628">.</span><span class="ident" id="1841629">buf</span><span class="op" id="1841632">[</span><span class="ident" id="1841633">s</span><span class="op" id="1841634">.</span><span class="ident" id="1841635">start</span><span class="op" id="1841640">:</span><span class="ident" id="1841641">s</span><span class="op" id="1841642">.</span><span class="ident" id="1841643">end</span><span class="op" id="1841646">]</span><span class="op" id="1841647">,</span>&nbsp;<span class="ident" id="1841649">s</span><span class="op" id="1841650">.</span><span class="ident" id="1841651">err</span>&nbsp;<span class="op" id="1841655">!=</span>&nbsp;<span class="builtintype" id="1841658">nil</span><span class="op" id="1841661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841666">if</span>&nbsp;<span class="ident" id="1841669">err</span>&nbsp;<span class="op" id="1841673">!=</span>&nbsp;<span class="builtintype" id="1841676">nil</span>&nbsp;<span class="op" id="1841680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1841686">s</span><span class="op" id="1841687">.</span><span class="ident" id="1841688">setErr</span><span class="op" id="1841694">(</span><span class="ident" id="1841695">err</span><span class="op" id="1841698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841704">return</span>&nbsp;<span class="builtintype" id="1841711">false</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1841720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841725">if</span>&nbsp;<span class="op" id="1841728">!</span><span class="ident" id="1841729">s</span><span class="op" id="1841730">.</span><span class="ident" id="1841731">advance</span><span class="op" id="1841738">(</span><span class="ident" id="1841739">advance</span><span class="op" id="1841746">)</span>&nbsp;<span class="op" id="1841748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841754">return</span>&nbsp;<span class="builtintype" id="1841761">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1841770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1841775">s</span><span class="op" id="1841776">.</span><span class="ident" id="1841777">token</span>&nbsp;<span class="op" id="1841783">=</span>&nbsp;<span class="ident" id="1841785">token</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841794">if</span>&nbsp;<span class="ident" id="1841797">token</span>&nbsp;<span class="op" id="1841803">!=</span>&nbsp;<span class="builtintype" id="1841806">nil</span>&nbsp;<span class="op" id="1841810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841816">if</span>&nbsp;<span class="ident" id="1841819">s</span><span class="op" id="1841820">.</span><span class="ident" id="1841821">err</span>&nbsp;<span class="op" id="1841825">==</span>&nbsp;<span class="builtintype" id="1841828">nil</span>&nbsp;<span class="op" id="1841832">||</span>&nbsp;<span class="ident" id="1841835">advance</span>&nbsp;<span class="op" id="1841843">&gt;</span>&nbsp;<span class="num" id="1841845">0</span>&nbsp;<span class="op" id="1841847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1841854">s</span><span class="op" id="1841855">.</span><span class="ident" id="1841856">empties</span>&nbsp;<span class="op" id="1841864">=</span>&nbsp;<span class="num" id="1841866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1841872">}</span>&nbsp;<span class="keyword" id="1841874">else</span>&nbsp;<span class="op" id="1841879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1841886">//&nbsp;Returning&nbsp;tokens&nbsp;not&nbsp;advancing&nbsp;input&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1841939">s</span><span class="op" id="1841940">.</span><span class="ident" id="1841941">empties</span><span class="op" id="1841948">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1841956">if</span>&nbsp;<span class="ident" id="1841959">s</span><span class="op" id="1841960">.</span><span class="ident" id="1841961">empties</span>&nbsp;<span class="op" id="1841969">&gt;</span>&nbsp;<span class="num" id="1841971">100</span>&nbsp;<span class="op" id="1841975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1841983">panic</span><span class="op" id="1841988">(</span><span class="string" id="1841989">&#34;bufio.Scan:&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without&nbsp;progressing&#34;</span><span class="op" id="1842039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842052">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842058">return</span>&nbsp;<span class="builtintype" id="1842065">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842081">//&nbsp;We&nbsp;cannot&nbsp;generate&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;are&nbsp;holding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842139">//&nbsp;If&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;EOF&nbsp;or&nbsp;an&nbsp;I/O&nbsp;error,&nbsp;we&nbsp;are&nbsp;done.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842199">if</span>&nbsp;<span class="ident" id="1842202">s</span><span class="op" id="1842203">.</span><span class="ident" id="1842204">err</span>&nbsp;<span class="op" id="1842208">!=</span>&nbsp;<span class="builtintype" id="1842211">nil</span>&nbsp;<span class="op" id="1842215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842220">//&nbsp;Shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842240">s</span><span class="op" id="1842241">.</span><span class="ident" id="1842242">start</span>&nbsp;<span class="op" id="1842248">=</span>&nbsp;<span class="num" id="1842250">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842255">s</span><span class="op" id="1842256">.</span><span class="ident" id="1842257">end</span>&nbsp;<span class="op" id="1842261">=</span>&nbsp;<span class="num" id="1842263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842268">return</span>&nbsp;<span class="builtintype" id="1842275">false</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842287">//&nbsp;Must&nbsp;read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842313">//&nbsp;First,&nbsp;shift&nbsp;data&nbsp;to&nbsp;beginning&nbsp;of&nbsp;buffer&nbsp;if&nbsp;there&#39;s&nbsp;lots&nbsp;of&nbsp;empty&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842390">//&nbsp;or&nbsp;space&nbsp;is&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842415">if</span>&nbsp;<span class="ident" id="1842418">s</span><span class="op" id="1842419">.</span><span class="ident" id="1842420">start</span>&nbsp;<span class="op" id="1842426">&gt;</span>&nbsp;<span class="num" id="1842428">0</span>&nbsp;<span class="op" id="1842430">&amp;&amp;</span>&nbsp;<span class="op" id="1842433">(</span><span class="ident" id="1842434">s</span><span class="op" id="1842435">.</span><span class="ident" id="1842436">end</span>&nbsp;<span class="op" id="1842440">==</span>&nbsp;<span class="builtinfunc" id="1842443">len</span><span class="op" id="1842446">(</span><span class="ident" id="1842447">s</span><span class="op" id="1842448">.</span><span class="ident" id="1842449">buf</span><span class="op" id="1842452">)</span>&nbsp;<span class="op" id="1842454">||</span>&nbsp;<span class="ident" id="1842457">s</span><span class="op" id="1842458">.</span><span class="ident" id="1842459">start</span>&nbsp;<span class="op" id="1842465">&gt;</span>&nbsp;<span class="builtinfunc" id="1842467">len</span><span class="op" id="1842470">(</span><span class="ident" id="1842471">s</span><span class="op" id="1842472">.</span><span class="ident" id="1842473">buf</span><span class="op" id="1842476">)</span><span class="op" id="1842477">/</span><span class="num" id="1842478">2</span><span class="op" id="1842479">)</span>&nbsp;<span class="op" id="1842481">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1842486">copy</span><span class="op" id="1842490">(</span><span class="ident" id="1842491">s</span><span class="op" id="1842492">.</span><span class="ident" id="1842493">buf</span><span class="op" id="1842496">,</span>&nbsp;<span class="ident" id="1842498">s</span><span class="op" id="1842499">.</span><span class="ident" id="1842500">buf</span><span class="op" id="1842503">[</span><span class="ident" id="1842504">s</span><span class="op" id="1842505">.</span><span class="ident" id="1842506">start</span><span class="op" id="1842511">:</span><span class="ident" id="1842512">s</span><span class="op" id="1842513">.</span><span class="ident" id="1842514">end</span><span class="op" id="1842517">]</span><span class="op" id="1842518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842523">s</span><span class="op" id="1842524">.</span><span class="ident" id="1842525">end</span>&nbsp;<span class="op" id="1842529">-=</span>&nbsp;<span class="ident" id="1842532">s</span><span class="op" id="1842533">.</span><span class="ident" id="1842534">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842543">s</span><span class="op" id="1842544">.</span><span class="ident" id="1842545">start</span>&nbsp;<span class="op" id="1842551">=</span>&nbsp;<span class="num" id="1842553">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842561">//&nbsp;Is&nbsp;the&nbsp;buffer&nbsp;full?&nbsp;If&nbsp;so,&nbsp;resize.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842601">if</span>&nbsp;<span class="ident" id="1842604">s</span><span class="op" id="1842605">.</span><span class="ident" id="1842606">end</span>&nbsp;<span class="op" id="1842610">==</span>&nbsp;<span class="builtinfunc" id="1842613">len</span><span class="op" id="1842616">(</span><span class="ident" id="1842617">s</span><span class="op" id="1842618">.</span><span class="ident" id="1842619">buf</span><span class="op" id="1842622">)</span>&nbsp;<span class="op" id="1842624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842629">if</span>&nbsp;<span class="builtinfunc" id="1842632">len</span><span class="op" id="1842635">(</span><span class="ident" id="1842636">s</span><span class="op" id="1842637">.</span><span class="ident" id="1842638">buf</span><span class="op" id="1842641">)</span>&nbsp;<span class="op" id="1842643">&gt;=</span>&nbsp;<span class="ident" id="1842646">s</span><span class="op" id="1842647">.</span><span class="ident" id="1842648">maxTokenSize</span>&nbsp;<span class="op" id="1842661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842667">s</span><span class="op" id="1842668">.</span><span class="ident" id="1842669">setErr</span><span class="op" id="1842675">(</span><span class="ident" id="1842676">ErrTooLong</span><span class="op" id="1842686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842692">return</span>&nbsp;<span class="builtintype" id="1842699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842708">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842713">newSize</span>&nbsp;<span class="op" id="1842721">:=</span>&nbsp;<span class="builtinfunc" id="1842724">len</span><span class="op" id="1842727">(</span><span class="ident" id="1842728">s</span><span class="op" id="1842729">.</span><span class="ident" id="1842730">buf</span><span class="op" id="1842733">)</span>&nbsp;<span class="op" id="1842735">*</span>&nbsp;<span class="num" id="1842737">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842742">if</span>&nbsp;<span class="ident" id="1842745">newSize</span>&nbsp;<span class="op" id="1842753">&gt;</span>&nbsp;<span class="ident" id="1842755">s</span><span class="op" id="1842756">.</span><span class="ident" id="1842757">maxTokenSize</span>&nbsp;<span class="op" id="1842770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842776">newSize</span>&nbsp;<span class="op" id="1842784">=</span>&nbsp;<span class="ident" id="1842786">s</span><span class="op" id="1842787">.</span><span class="ident" id="1842788">maxTokenSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842809">newBuf</span>&nbsp;<span class="op" id="1842816">:=</span>&nbsp;<span class="builtinfunc" id="1842819">make</span><span class="op" id="1842823">(</span><span class="op" id="1842824">[</span><span class="op" id="1842825">]</span><span class="builtintype" id="1842826">byte</span><span class="op" id="1842830">,</span>&nbsp;<span class="ident" id="1842832">newSize</span><span class="op" id="1842839">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1842844">copy</span><span class="op" id="1842848">(</span><span class="ident" id="1842849">newBuf</span><span class="op" id="1842855">,</span>&nbsp;<span class="ident" id="1842857">s</span><span class="op" id="1842858">.</span><span class="ident" id="1842859">buf</span><span class="op" id="1842862">[</span><span class="ident" id="1842863">s</span><span class="op" id="1842864">.</span><span class="ident" id="1842865">start</span><span class="op" id="1842870">:</span><span class="ident" id="1842871">s</span><span class="op" id="1842872">.</span><span class="ident" id="1842873">end</span><span class="op" id="1842876">]</span><span class="op" id="1842877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842882">s</span><span class="op" id="1842883">.</span><span class="ident" id="1842884">buf</span>&nbsp;<span class="op" id="1842888">=</span>&nbsp;<span class="ident" id="1842890">newBuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842900">s</span><span class="op" id="1842901">.</span><span class="ident" id="1842902">end</span>&nbsp;<span class="op" id="1842906">-=</span>&nbsp;<span class="ident" id="1842909">s</span><span class="op" id="1842910">.</span><span class="ident" id="1842911">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1842920">s</span><span class="op" id="1842921">.</span><span class="ident" id="1842922">start</span>&nbsp;<span class="op" id="1842928">=</span>&nbsp;<span class="num" id="1842930">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1842935">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842950">//&nbsp;Finally&nbsp;we&nbsp;can&nbsp;read&nbsp;some&nbsp;input.&nbsp;Make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;stuck&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1843021">//&nbsp;a&nbsp;misbehaving&nbsp;Reader.&nbsp;Officially&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;do&nbsp;this,&nbsp;but&nbsp;let&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1843095">//&nbsp;be&nbsp;extra&nbsp;careful:&nbsp;Scanner&nbsp;is&nbsp;for&nbsp;safe,&nbsp;simple&nbsp;jobs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843152">for</span>&nbsp;<span class="ident" id="1843156">loop</span>&nbsp;<span class="op" id="1843161">:=</span>&nbsp;<span class="num" id="1843164">0</span><span class="op" id="1843165">;</span>&nbsp;<span class="op" id="1843167">;</span>&nbsp;<span class="op" id="1843169">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843174">n</span><span class="op" id="1843175">,</span>&nbsp;<span class="ident" id="1843177">err</span>&nbsp;<span class="op" id="1843181">:=</span>&nbsp;<span class="ident" id="1843184">s</span><span class="op" id="1843185">.</span><span class="ident" id="1843186">r</span><span class="op" id="1843187">.</span><span class="ident" id="1843188">Read</span><span class="op" id="1843192">(</span><span class="ident" id="1843193">s</span><span class="op" id="1843194">.</span><span class="ident" id="1843195">buf</span><span class="op" id="1843198">[</span><span class="ident" id="1843199">s</span><span class="op" id="1843200">.</span><span class="ident" id="1843201">end</span><span class="op" id="1843204">:</span><span class="builtinfunc" id="1843205">len</span><span class="op" id="1843208">(</span><span class="ident" id="1843209">s</span><span class="op" id="1843210">.</span><span class="ident" id="1843211">buf</span><span class="op" id="1843214">)</span><span class="op" id="1843215">]</span><span class="op" id="1843216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843221">s</span><span class="op" id="1843222">.</span><span class="ident" id="1843223">end</span>&nbsp;<span class="op" id="1843227">+=</span>&nbsp;<span class="ident" id="1843230">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843235">if</span>&nbsp;<span class="ident" id="1843238">err</span>&nbsp;<span class="op" id="1843242">!=</span>&nbsp;<span class="builtintype" id="1843245">nil</span>&nbsp;<span class="op" id="1843249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843255">s</span><span class="op" id="1843256">.</span><span class="ident" id="1843257">setErr</span><span class="op" id="1843263">(</span><span class="ident" id="1843264">err</span><span class="op" id="1843267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843273">break</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843287">if</span>&nbsp;<span class="ident" id="1843290">n</span>&nbsp;<span class="op" id="1843292">&gt;</span>&nbsp;<span class="num" id="1843294">0</span>&nbsp;<span class="op" id="1843296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843302">s</span><span class="op" id="1843303">.</span><span class="ident" id="1843304">empties</span>&nbsp;<span class="op" id="1843312">=</span>&nbsp;<span class="num" id="1843314">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843320">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843329">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843334">loop</span><span class="op" id="1843338">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843344">if</span>&nbsp;<span class="ident" id="1843347">loop</span>&nbsp;<span class="op" id="1843352">&gt;</span>&nbsp;<span class="ident" id="1843354">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="1843379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843385">s</span><span class="op" id="1843386">.</span><span class="ident" id="1843387">setErr</span><span class="op" id="1843393">(</span><span class="ident" id="1843394">io</span><span class="op" id="1843396">.</span><span class="ident" id="1843397">ErrNoProgress</span><span class="op" id="1843410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843416">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843425">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843432">}</span><br>
<span class="lineno"></span><span class="op" id="1843434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1843437">//&nbsp;advance&nbsp;consumes&nbsp;n&nbsp;bytes&nbsp;of&nbsp;the&nbsp;buffer.&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;advance&nbsp;was&nbsp;legal.</span><br>
<span class="lineno">200</span><span class="keyword" id="1843522">func</span>&nbsp;<span class="op" id="1843527">(</span><span class="ident" id="1843528">s</span>&nbsp;<span class="op" id="1843530">*</span><span class="ident" id="1843531">Scanner</span><span class="op" id="1843538">)</span>&nbsp;<span class="ident" id="1843540">advance</span><span class="op" id="1843547">(</span><span class="ident" id="1843548">n</span>&nbsp;<span class="builtintype" id="1843550">int</span><span class="op" id="1843553">)</span>&nbsp;<span class="builtintype" id="1843555">bool</span>&nbsp;<span class="op" id="1843560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843563">if</span>&nbsp;<span class="ident" id="1843566">n</span>&nbsp;<span class="op" id="1843568">&lt;</span>&nbsp;<span class="num" id="1843570">0</span>&nbsp;<span class="op" id="1843572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843576">s</span><span class="op" id="1843577">.</span><span class="ident" id="1843578">setErr</span><span class="op" id="1843584">(</span><span class="ident" id="1843585">ErrNegativeAdvance</span><span class="op" id="1843603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843607">return</span>&nbsp;<span class="builtintype" id="1843614">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843621">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843624">if</span>&nbsp;<span class="ident" id="1843627">n</span>&nbsp;<span class="op" id="1843629">&gt;</span>&nbsp;<span class="ident" id="1843631">s</span><span class="op" id="1843632">.</span><span class="ident" id="1843633">end</span><span class="op" id="1843636">-</span><span class="ident" id="1843637">s</span><span class="op" id="1843638">.</span><span class="ident" id="1843639">start</span>&nbsp;<span class="op" id="1843645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843649">s</span><span class="op" id="1843650">.</span><span class="ident" id="1843651">setErr</span><span class="op" id="1843657">(</span><span class="ident" id="1843658">ErrAdvanceTooFar</span><span class="op" id="1843674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843678">return</span>&nbsp;<span class="builtintype" id="1843685">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843695">s</span><span class="op" id="1843696">.</span><span class="ident" id="1843697">start</span>&nbsp;<span class="op" id="1843703">+=</span>&nbsp;<span class="ident" id="1843706">n</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843709">return</span>&nbsp;<span class="builtintype" id="1843716">true</span><br>
<span class="lineno"></span><span class="op" id="1843721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1843724">//&nbsp;setErr&nbsp;records&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="1843771">func</span>&nbsp;<span class="op" id="1843776">(</span><span class="ident" id="1843777">s</span>&nbsp;<span class="op" id="1843779">*</span><span class="ident" id="1843780">Scanner</span><span class="op" id="1843787">)</span>&nbsp;<span class="ident" id="1843789">setErr</span><span class="op" id="1843795">(</span><span class="ident" id="1843796">err</span>&nbsp;<span class="builtintype" id="1843800">error</span><span class="op" id="1843805">)</span>&nbsp;<span class="op" id="1843807">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1843810">if</span>&nbsp;<span class="ident" id="1843813">s</span><span class="op" id="1843814">.</span><span class="ident" id="1843815">err</span>&nbsp;<span class="op" id="1843819">==</span>&nbsp;<span class="builtintype" id="1843822">nil</span>&nbsp;<span class="op" id="1843826">||</span>&nbsp;<span class="ident" id="1843829">s</span><span class="op" id="1843830">.</span><span class="ident" id="1843831">err</span>&nbsp;<span class="op" id="1843835">==</span>&nbsp;<span class="ident" id="1843838">io</span><span class="op" id="1843840">.</span><span class="ident" id="1843841">EOF</span>&nbsp;<span class="op" id="1843845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1843849">s</span><span class="op" id="1843850">.</span><span class="ident" id="1843851">err</span>&nbsp;<span class="op" id="1843855">=</span>&nbsp;<span class="ident" id="1843857">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1843862">}</span><br>
<span class="lineno"></span><span class="op" id="1843864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1843867">//&nbsp;Split&nbsp;sets&nbsp;the&nbsp;split&nbsp;function&nbsp;for&nbsp;the&nbsp;Scanner.&nbsp;If&nbsp;called,&nbsp;it&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1843939">//&nbsp;called&nbsp;before&nbsp;Scan.&nbsp;The&nbsp;default&nbsp;split&nbsp;function&nbsp;is&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="1844003">func</span>&nbsp;<span class="op" id="1844008">(</span><span class="ident" id="1844009">s</span>&nbsp;<span class="op" id="1844011">*</span><span class="ident" id="1844012">Scanner</span><span class="op" id="1844019">)</span>&nbsp;<span class="ident" id="1844021">Split</span><span class="op" id="1844026">(</span><span class="ident" id="1844027">split</span>&nbsp;<span class="ident" id="1844033">SplitFunc</span><span class="op" id="1844042">)</span>&nbsp;<span class="op" id="1844044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1844047">s</span><span class="op" id="1844048">.</span><span class="ident" id="1844049">split</span>&nbsp;<span class="op" id="1844055">=</span>&nbsp;<span class="ident" id="1844057">split</span><br>
<span class="lineno"></span><span class="op" id="1844063">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="1844066">//&nbsp;Split&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1844086">//&nbsp;ScanBytes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;byte&nbsp;as&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="1844168">func</span>&nbsp;<span class="ident" id="1844173">ScanBytes</span><span class="op" id="1844182">(</span><span class="ident" id="1844183">data</span>&nbsp;<span class="op" id="1844188">[</span><span class="op" id="1844189">]</span><span class="builtintype" id="1844190">byte</span><span class="op" id="1844194">,</span>&nbsp;<span class="ident" id="1844196">atEOF</span>&nbsp;<span class="builtintype" id="1844202">bool</span><span class="op" id="1844206">)</span>&nbsp;<span class="op" id="1844208">(</span><span class="ident" id="1844209">advance</span>&nbsp;<span class="builtintype" id="1844217">int</span><span class="op" id="1844220">,</span>&nbsp;<span class="ident" id="1844222">token</span>&nbsp;<span class="op" id="1844228">[</span><span class="op" id="1844229">]</span><span class="builtintype" id="1844230">byte</span><span class="op" id="1844234">,</span>&nbsp;<span class="ident" id="1844236">err</span>&nbsp;<span class="builtintype" id="1844240">error</span><span class="op" id="1844245">)</span>&nbsp;<span class="op" id="1844247">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1844250">if</span>&nbsp;<span class="ident" id="1844253">atEOF</span>&nbsp;<span class="op" id="1844259">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1844262">len</span><span class="op" id="1844265">(</span><span class="ident" id="1844266">data</span><span class="op" id="1844270">)</span>&nbsp;<span class="op" id="1844272">==</span>&nbsp;<span class="num" id="1844275">0</span>&nbsp;<span class="op" id="1844277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1844281">return</span>&nbsp;<span class="num" id="1844288">0</span><span class="op" id="1844289">,</span>&nbsp;<span class="builtintype" id="1844291">nil</span><span class="op" id="1844294">,</span>&nbsp;<span class="builtintype" id="1844296">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1844301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1844304">return</span>&nbsp;<span class="num" id="1844311">1</span><span class="op" id="1844312">,</span>&nbsp;<span class="ident" id="1844314">data</span><span class="op" id="1844318">[</span><span class="num" id="1844319">0</span><span class="op" id="1844320">:</span><span class="num" id="1844321">1</span><span class="op" id="1844322">]</span><span class="op" id="1844323">,</span>&nbsp;<span class="builtintype" id="1844325">nil</span><br>
<span class="lineno"></span><span class="op" id="1844329">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1844332">var</span>&nbsp;<span class="ident" id="1844336">errorRune</span>&nbsp;<span class="op" id="1844346">=</span>&nbsp;<span class="op" id="1844348">[</span><span class="op" id="1844349">]</span><span class="builtintype" id="1844350">byte</span><span class="op" id="1844354">(</span><span class="builtintype" id="1844355">string</span><span class="op" id="1844361">(</span><span class="ident" id="1844362">utf8</span><span class="op" id="1844366">.</span><span class="ident" id="1844367">RuneError</span><span class="op" id="1844376">)</span><span class="op" id="1844377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1844380">//&nbsp;ScanRunes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="1844445">//&nbsp;UTF-8-encoded&nbsp;rune&nbsp;as&nbsp;a&nbsp;token.&nbsp;The&nbsp;sequence&nbsp;of&nbsp;runes&nbsp;returned&nbsp;is</span><br>
<span class="lineno">240</span><span class="comment" id="1844513">//&nbsp;equivalent&nbsp;to&nbsp;that&nbsp;from&nbsp;a&nbsp;range&nbsp;loop&nbsp;over&nbsp;the&nbsp;input&nbsp;as&nbsp;a&nbsp;string,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="1844587">//&nbsp;means&nbsp;that&nbsp;erroneous&nbsp;UTF-8&nbsp;encodings&nbsp;translate&nbsp;to&nbsp;U+FFFD&nbsp;=&nbsp;&#34;\xef\xbf\xbd&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1844665">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;Scan&nbsp;interface,&nbsp;this&nbsp;makes&nbsp;it&nbsp;impossible&nbsp;for&nbsp;the&nbsp;client&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1844742">//&nbsp;distinguish&nbsp;correctly&nbsp;encoded&nbsp;replacement&nbsp;runes&nbsp;from&nbsp;encoding&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="1844815">func</span>&nbsp;<span class="ident" id="1844820">ScanRunes</span><span class="op" id="1844829">(</span><span class="ident" id="1844830">data</span>&nbsp;<span class="op" id="1844835">[</span><span class="op" id="1844836">]</span><span class="builtintype" id="1844837">byte</span><span class="op" id="1844841">,</span>&nbsp;<span class="ident" id="1844843">atEOF</span>&nbsp;<span class="builtintype" id="1844849">bool</span><span class="op" id="1844853">)</span>&nbsp;<span class="op" id="1844855">(</span><span class="ident" id="1844856">advance</span>&nbsp;<span class="builtintype" id="1844864">int</span><span class="op" id="1844867">,</span>&nbsp;<span class="ident" id="1844869">token</span>&nbsp;<span class="op" id="1844875">[</span><span class="op" id="1844876">]</span><span class="builtintype" id="1844877">byte</span><span class="op" id="1844881">,</span>&nbsp;<span class="ident" id="1844883">err</span>&nbsp;<span class="builtintype" id="1844887">error</span><span class="op" id="1844892">)</span>&nbsp;<span class="op" id="1844894">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1844897">if</span>&nbsp;<span class="ident" id="1844900">atEOF</span>&nbsp;<span class="op" id="1844906">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1844909">len</span><span class="op" id="1844912">(</span><span class="ident" id="1844913">data</span><span class="op" id="1844917">)</span>&nbsp;<span class="op" id="1844919">==</span>&nbsp;<span class="num" id="1844922">0</span>&nbsp;<span class="op" id="1844924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1844928">return</span>&nbsp;<span class="num" id="1844935">0</span><span class="op" id="1844936">,</span>&nbsp;<span class="builtintype" id="1844938">nil</span><span class="op" id="1844941">,</span>&nbsp;<span class="builtintype" id="1844943">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1844948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1844952">//&nbsp;Fast&nbsp;path&nbsp;1:&nbsp;ASCII.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1844976">if</span>&nbsp;<span class="ident" id="1844979">data</span><span class="op" id="1844983">[</span><span class="num" id="1844984">0</span><span class="op" id="1844985">]</span>&nbsp;<span class="op" id="1844987">&lt;</span>&nbsp;<span class="ident" id="1844989">utf8</span><span class="op" id="1844993">.</span><span class="ident" id="1844994">RuneSelf</span>&nbsp;<span class="op" id="1845003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845007">return</span>&nbsp;<span class="num" id="1845014">1</span><span class="op" id="1845015">,</span>&nbsp;<span class="ident" id="1845017">data</span><span class="op" id="1845021">[</span><span class="num" id="1845022">0</span><span class="op" id="1845023">:</span><span class="num" id="1845024">1</span><span class="op" id="1845025">]</span><span class="op" id="1845026">,</span>&nbsp;<span class="builtintype" id="1845028">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1845033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845037">//&nbsp;Fast&nbsp;path&nbsp;2:&nbsp;Correct&nbsp;UTF-8&nbsp;decode&nbsp;without&nbsp;error.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1845090">_</span><span class="op" id="1845091">,</span>&nbsp;<span class="ident" id="1845093">width</span>&nbsp;<span class="op" id="1845099">:=</span>&nbsp;<span class="ident" id="1845102">utf8</span><span class="op" id="1845106">.</span><span class="ident" id="1845107">DecodeRune</span><span class="op" id="1845117">(</span><span class="ident" id="1845118">data</span><span class="op" id="1845122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845125">if</span>&nbsp;<span class="ident" id="1845128">width</span>&nbsp;<span class="op" id="1845134">&gt;</span>&nbsp;<span class="num" id="1845136">1</span>&nbsp;<span class="op" id="1845138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845142">//&nbsp;It&#39;s&nbsp;a&nbsp;valid&nbsp;encoding.&nbsp;Width&nbsp;cannot&nbsp;be&nbsp;one&nbsp;for&nbsp;a&nbsp;correctly&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845214">//&nbsp;non-ASCII&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845235">return</span>&nbsp;<span class="ident" id="1845242">width</span><span class="op" id="1845247">,</span>&nbsp;<span class="ident" id="1845249">data</span><span class="op" id="1845253">[</span><span class="num" id="1845254">0</span><span class="op" id="1845255">:</span><span class="ident" id="1845256">width</span><span class="op" id="1845261">]</span><span class="op" id="1845262">,</span>&nbsp;<span class="builtintype" id="1845264">nil</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1845269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845273">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;an&nbsp;error:&nbsp;we&nbsp;have&nbsp;width==1&nbsp;and&nbsp;implicitly&nbsp;r==utf8.RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845351">//&nbsp;Is&nbsp;the&nbsp;error&nbsp;because&nbsp;there&nbsp;wasn&#39;t&nbsp;a&nbsp;full&nbsp;rune&nbsp;to&nbsp;be&nbsp;decoded?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845416">//&nbsp;FullRune&nbsp;distinguishes&nbsp;correctly&nbsp;between&nbsp;erroneous&nbsp;and&nbsp;incomplete&nbsp;encodings.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845497">if</span>&nbsp;<span class="op" id="1845500">!</span><span class="ident" id="1845501">atEOF</span>&nbsp;<span class="op" id="1845507">&amp;&amp;</span>&nbsp;<span class="op" id="1845510">!</span><span class="ident" id="1845511">utf8</span><span class="op" id="1845515">.</span><span class="ident" id="1845516">FullRune</span><span class="op" id="1845524">(</span><span class="ident" id="1845525">data</span><span class="op" id="1845529">)</span>&nbsp;<span class="op" id="1845531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845535">//&nbsp;Incomplete;&nbsp;get&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845568">return</span>&nbsp;<span class="num" id="1845575">0</span><span class="op" id="1845576">,</span>&nbsp;<span class="builtintype" id="1845578">nil</span><span class="op" id="1845581">,</span>&nbsp;<span class="builtintype" id="1845583">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1845588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845592">//&nbsp;We&nbsp;have&nbsp;a&nbsp;real&nbsp;UTF-8&nbsp;encoding&nbsp;error.&nbsp;Return&nbsp;a&nbsp;properly&nbsp;encoded&nbsp;error&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845670">//&nbsp;but&nbsp;advance&nbsp;only&nbsp;one&nbsp;byte.&nbsp;This&nbsp;matches&nbsp;the&nbsp;behavior&nbsp;of&nbsp;a&nbsp;range&nbsp;loop&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1845748">//&nbsp;an&nbsp;incorrectly&nbsp;encoded&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845783">return</span>&nbsp;<span class="num" id="1845790">1</span><span class="op" id="1845791">,</span>&nbsp;<span class="ident" id="1845793">errorRune</span><span class="op" id="1845802">,</span>&nbsp;<span class="builtintype" id="1845804">nil</span><br>
<span class="lineno"></span><span class="op" id="1845808">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="1845811">//&nbsp;dropCR&nbsp;drops&nbsp;a&nbsp;terminal&nbsp;\r&nbsp;from&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1845856">func</span>&nbsp;<span class="ident" id="1845861">dropCR</span><span class="op" id="1845867">(</span><span class="ident" id="1845868">data</span>&nbsp;<span class="op" id="1845873">[</span><span class="op" id="1845874">]</span><span class="builtintype" id="1845875">byte</span><span class="op" id="1845879">)</span>&nbsp;<span class="op" id="1845881">[</span><span class="op" id="1845882">]</span><span class="builtintype" id="1845883">byte</span>&nbsp;<span class="op" id="1845888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845891">if</span>&nbsp;<span class="builtinfunc" id="1845894">len</span><span class="op" id="1845897">(</span><span class="ident" id="1845898">data</span><span class="op" id="1845902">)</span>&nbsp;<span class="op" id="1845904">&gt;</span>&nbsp;<span class="num" id="1845906">0</span>&nbsp;<span class="op" id="1845908">&amp;&amp;</span>&nbsp;<span class="ident" id="1845911">data</span><span class="op" id="1845915">[</span><span class="builtinfunc" id="1845916">len</span><span class="op" id="1845919">(</span><span class="ident" id="1845920">data</span><span class="op" id="1845924">)</span><span class="op" id="1845925">-</span><span class="num" id="1845926">1</span><span class="op" id="1845927">]</span>&nbsp;<span class="op" id="1845929">==</span>&nbsp;<span class="string" id="1845932">&#39;\r&#39;</span>&nbsp;<span class="op" id="1845937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845941">return</span>&nbsp;<span class="ident" id="1845948">data</span><span class="op" id="1845952">[</span><span class="num" id="1845953">0</span>&nbsp;<span class="op" id="1845955">:</span>&nbsp;<span class="builtinfunc" id="1845957">len</span><span class="op" id="1845960">(</span><span class="ident" id="1845961">data</span><span class="op" id="1845965">)</span><span class="op" id="1845966">-</span><span class="num" id="1845967">1</span><span class="op" id="1845968">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1845971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1845974">return</span>&nbsp;<span class="ident" id="1845981">data</span><br>
<span class="lineno"></span><span class="op" id="1845986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1845989">//&nbsp;ScanLines&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;line&nbsp;of</span><br>
<span class="lineno">285</span><span class="comment" id="1846062">//&nbsp;text,&nbsp;stripped&nbsp;of&nbsp;any&nbsp;trailing&nbsp;end-of-line&nbsp;marker.&nbsp;The&nbsp;returned&nbsp;line&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="1846138">//&nbsp;be&nbsp;empty.&nbsp;The&nbsp;end-of-line&nbsp;marker&nbsp;is&nbsp;one&nbsp;optional&nbsp;carriage&nbsp;return&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="1846215">//&nbsp;by&nbsp;one&nbsp;mandatory&nbsp;newline.&nbsp;In&nbsp;regular&nbsp;expression&nbsp;notation,&nbsp;it&nbsp;is&nbsp;`\r?\n`.</span><br>
<span class="lineno"></span><span class="comment" id="1846291">//&nbsp;The&nbsp;last&nbsp;non-empty&nbsp;line&nbsp;of&nbsp;input&nbsp;will&nbsp;be&nbsp;returned&nbsp;even&nbsp;if&nbsp;it&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="1846362">//&nbsp;newline.</span><br>
<span class="lineno">290</span><span class="keyword" id="1846374">func</span>&nbsp;<span class="ident" id="1846379">ScanLines</span><span class="op" id="1846388">(</span><span class="ident" id="1846389">data</span>&nbsp;<span class="op" id="1846394">[</span><span class="op" id="1846395">]</span><span class="builtintype" id="1846396">byte</span><span class="op" id="1846400">,</span>&nbsp;<span class="ident" id="1846402">atEOF</span>&nbsp;<span class="builtintype" id="1846408">bool</span><span class="op" id="1846412">)</span>&nbsp;<span class="op" id="1846414">(</span><span class="ident" id="1846415">advance</span>&nbsp;<span class="builtintype" id="1846423">int</span><span class="op" id="1846426">,</span>&nbsp;<span class="ident" id="1846428">token</span>&nbsp;<span class="op" id="1846434">[</span><span class="op" id="1846435">]</span><span class="builtintype" id="1846436">byte</span><span class="op" id="1846440">,</span>&nbsp;<span class="ident" id="1846442">err</span>&nbsp;<span class="builtintype" id="1846446">error</span><span class="op" id="1846451">)</span>&nbsp;<span class="op" id="1846453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846456">if</span>&nbsp;<span class="ident" id="1846459">atEOF</span>&nbsp;<span class="op" id="1846465">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1846468">len</span><span class="op" id="1846471">(</span><span class="ident" id="1846472">data</span><span class="op" id="1846476">)</span>&nbsp;<span class="op" id="1846478">==</span>&nbsp;<span class="num" id="1846481">0</span>&nbsp;<span class="op" id="1846483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846487">return</span>&nbsp;<span class="num" id="1846494">0</span><span class="op" id="1846495">,</span>&nbsp;<span class="builtintype" id="1846497">nil</span><span class="op" id="1846500">,</span>&nbsp;<span class="builtintype" id="1846502">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1846507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846510">if</span>&nbsp;<span class="ident" id="1846513">i</span>&nbsp;<span class="op" id="1846515">:=</span>&nbsp;<span class="ident" id="1846518">bytes</span><span class="op" id="1846523">.</span><span class="ident" id="1846524">IndexByte</span><span class="op" id="1846533">(</span><span class="ident" id="1846534">data</span><span class="op" id="1846538">,</span>&nbsp;<span class="string" id="1846540">&#39;\n&#39;</span><span class="op" id="1846544">)</span><span class="op" id="1846545">;</span>&nbsp;<span class="ident" id="1846547">i</span>&nbsp;<span class="op" id="1846549">&gt;=</span>&nbsp;<span class="num" id="1846552">0</span>&nbsp;<span class="op" id="1846554">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1846558">//&nbsp;We&nbsp;have&nbsp;a&nbsp;full&nbsp;newline-terminated&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846603">return</span>&nbsp;<span class="ident" id="1846610">i</span>&nbsp;<span class="op" id="1846612">+</span>&nbsp;<span class="num" id="1846614">1</span><span class="op" id="1846615">,</span>&nbsp;<span class="ident" id="1846617">dropCR</span><span class="op" id="1846623">(</span><span class="ident" id="1846624">data</span><span class="op" id="1846628">[</span><span class="num" id="1846629">0</span><span class="op" id="1846630">:</span><span class="ident" id="1846631">i</span><span class="op" id="1846632">]</span><span class="op" id="1846633">)</span><span class="op" id="1846634">,</span>&nbsp;<span class="builtintype" id="1846636">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1846641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1846644">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-terminated&nbsp;line.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846714">if</span>&nbsp;<span class="ident" id="1846717">atEOF</span>&nbsp;<span class="op" id="1846723">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846727">return</span>&nbsp;<span class="builtinfunc" id="1846734">len</span><span class="op" id="1846737">(</span><span class="ident" id="1846738">data</span><span class="op" id="1846742">)</span><span class="op" id="1846743">,</span>&nbsp;<span class="ident" id="1846745">dropCR</span><span class="op" id="1846751">(</span><span class="ident" id="1846752">data</span><span class="op" id="1846756">)</span><span class="op" id="1846757">,</span>&nbsp;<span class="builtintype" id="1846759">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1846764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1846767">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1846790">return</span>&nbsp;<span class="num" id="1846797">0</span><span class="op" id="1846798">,</span>&nbsp;<span class="builtintype" id="1846800">nil</span><span class="op" id="1846803">,</span>&nbsp;<span class="builtintype" id="1846805">nil</span><br>
<span class="lineno"></span><span class="op" id="1846809">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="comment" id="1846812">//&nbsp;isSpace&nbsp;reports&nbsp;whether&nbsp;the&nbsp;character&nbsp;is&nbsp;a&nbsp;Unicode&nbsp;white&nbsp;space&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="1846889">//&nbsp;We&nbsp;avoid&nbsp;dependency&nbsp;on&nbsp;the&nbsp;unicode&nbsp;package,&nbsp;but&nbsp;check&nbsp;validity&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="1846977">//&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="1846994">func</span>&nbsp;<span class="ident" id="1846999">isSpace</span><span class="op" id="1847006">(</span><span class="ident" id="1847007">r</span>&nbsp;<span class="builtintype" id="1847009">rune</span><span class="op" id="1847013">)</span>&nbsp;<span class="builtintype" id="1847015">bool</span>&nbsp;<span class="op" id="1847020">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847023">if</span>&nbsp;<span class="ident" id="1847026">r</span>&nbsp;<span class="op" id="1847028">&lt;=</span>&nbsp;<span class="string" id="1847031">&#39;\u00FF&#39;</span>&nbsp;<span class="op" id="1847040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1847044">//&nbsp;Obvious&nbsp;ASCII&nbsp;ones:&nbsp;\t&nbsp;through&nbsp;\r&nbsp;plus&nbsp;space.&nbsp;Plus&nbsp;two&nbsp;Latin-1&nbsp;oddballs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847122">switch</span>&nbsp;<span class="ident" id="1847129">r</span>&nbsp;<span class="op" id="1847131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847135">case</span>&nbsp;<span class="string" id="1847140">&#39;&nbsp;&#39;</span><span class="op" id="1847143">,</span>&nbsp;<span class="string" id="1847145">&#39;\t&#39;</span><span class="op" id="1847149">,</span>&nbsp;<span class="string" id="1847151">&#39;\n&#39;</span><span class="op" id="1847155">,</span>&nbsp;<span class="string" id="1847157">&#39;\v&#39;</span><span class="op" id="1847161">,</span>&nbsp;<span class="string" id="1847163">&#39;\f&#39;</span><span class="op" id="1847167">,</span>&nbsp;<span class="string" id="1847169">&#39;\r&#39;</span><span class="op" id="1847173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847178">return</span>&nbsp;<span class="builtintype" id="1847185">true</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847192">case</span>&nbsp;<span class="string" id="1847197">&#39;\u0085&#39;</span><span class="op" id="1847205">,</span>&nbsp;<span class="string" id="1847207">&#39;\u00A0&#39;</span><span class="op" id="1847215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847220">return</span>&nbsp;<span class="builtintype" id="1847227">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1847234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847238">return</span>&nbsp;<span class="builtintype" id="1847245">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1847252">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1847255">//&nbsp;High-valued&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847277">if</span>&nbsp;<span class="string" id="1847280">&#39;\u2000&#39;</span>&nbsp;<span class="op" id="1847289">&lt;=</span>&nbsp;<span class="ident" id="1847292">r</span>&nbsp;<span class="op" id="1847294">&amp;&amp;</span>&nbsp;<span class="ident" id="1847297">r</span>&nbsp;<span class="op" id="1847299">&lt;=</span>&nbsp;<span class="string" id="1847302">&#39;\u200a&#39;</span>&nbsp;<span class="op" id="1847311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847315">return</span>&nbsp;<span class="builtintype" id="1847322">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1847328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847331">switch</span>&nbsp;<span class="ident" id="1847338">r</span>&nbsp;<span class="op" id="1847340">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847343">case</span>&nbsp;<span class="string" id="1847348">&#39;\u1680&#39;</span><span class="op" id="1847356">,</span>&nbsp;<span class="string" id="1847358">&#39;\u2028&#39;</span><span class="op" id="1847366">,</span>&nbsp;<span class="string" id="1847368">&#39;\u2029&#39;</span><span class="op" id="1847376">,</span>&nbsp;<span class="string" id="1847378">&#39;\u202f&#39;</span><span class="op" id="1847386">,</span>&nbsp;<span class="string" id="1847388">&#39;\u205f&#39;</span><span class="op" id="1847396">,</span>&nbsp;<span class="string" id="1847398">&#39;\u3000&#39;</span><span class="op" id="1847406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847410">return</span>&nbsp;<span class="builtintype" id="1847417">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1847423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847426">return</span>&nbsp;<span class="builtintype" id="1847433">false</span><br>
<span class="lineno"></span><span class="op" id="1847439">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="1847442">//&nbsp;ScanWords&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="1847507">//&nbsp;space-separated&nbsp;word&nbsp;of&nbsp;text,&nbsp;with&nbsp;surrounding&nbsp;spaces&nbsp;deleted.&nbsp;It&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1847581">//&nbsp;never&nbsp;return&nbsp;an&nbsp;empty&nbsp;string.&nbsp;The&nbsp;definition&nbsp;of&nbsp;space&nbsp;is&nbsp;set&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1847648">//&nbsp;unicode.IsSpace.</span><br>
<span class="lineno">335</span><span class="keyword" id="1847668">func</span>&nbsp;<span class="ident" id="1847673">ScanWords</span><span class="op" id="1847682">(</span><span class="ident" id="1847683">data</span>&nbsp;<span class="op" id="1847688">[</span><span class="op" id="1847689">]</span><span class="builtintype" id="1847690">byte</span><span class="op" id="1847694">,</span>&nbsp;<span class="ident" id="1847696">atEOF</span>&nbsp;<span class="builtintype" id="1847702">bool</span><span class="op" id="1847706">)</span>&nbsp;<span class="op" id="1847708">(</span><span class="ident" id="1847709">advance</span>&nbsp;<span class="builtintype" id="1847717">int</span><span class="op" id="1847720">,</span>&nbsp;<span class="ident" id="1847722">token</span>&nbsp;<span class="op" id="1847728">[</span><span class="op" id="1847729">]</span><span class="builtintype" id="1847730">byte</span><span class="op" id="1847734">,</span>&nbsp;<span class="ident" id="1847736">err</span>&nbsp;<span class="builtintype" id="1847740">error</span><span class="op" id="1847745">)</span>&nbsp;<span class="op" id="1847747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1847750">//&nbsp;Skip&nbsp;leading&nbsp;spaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1847775">start</span>&nbsp;<span class="op" id="1847781">:=</span>&nbsp;<span class="num" id="1847784">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847787">for</span>&nbsp;<span class="ident" id="1847791">width</span>&nbsp;<span class="op" id="1847797">:=</span>&nbsp;<span class="num" id="1847800">0</span><span class="op" id="1847801">;</span>&nbsp;<span class="ident" id="1847803">start</span>&nbsp;<span class="op" id="1847809">&lt;</span>&nbsp;<span class="builtinfunc" id="1847811">len</span><span class="op" id="1847814">(</span><span class="ident" id="1847815">data</span><span class="op" id="1847819">)</span><span class="op" id="1847820">;</span>&nbsp;<span class="ident" id="1847822">start</span>&nbsp;<span class="op" id="1847828">+=</span>&nbsp;<span class="ident" id="1847831">width</span>&nbsp;<span class="op" id="1847837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847841">var</span>&nbsp;<span class="ident" id="1847845">r</span>&nbsp;<span class="builtintype" id="1847847">rune</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1847854">r</span><span class="op" id="1847855">,</span>&nbsp;<span class="ident" id="1847857">width</span>&nbsp;<span class="op" id="1847863">=</span>&nbsp;<span class="ident" id="1847865">utf8</span><span class="op" id="1847869">.</span><span class="ident" id="1847870">DecodeRune</span><span class="op" id="1847880">(</span><span class="ident" id="1847881">data</span><span class="op" id="1847885">[</span><span class="ident" id="1847886">start</span><span class="op" id="1847891">:</span><span class="op" id="1847892">]</span><span class="op" id="1847893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847897">if</span>&nbsp;<span class="op" id="1847900">!</span><span class="ident" id="1847901">isSpace</span><span class="op" id="1847908">(</span><span class="ident" id="1847909">r</span><span class="op" id="1847910">)</span>&nbsp;<span class="op" id="1847912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847917">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1847925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1847928">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1847931">//&nbsp;Scan&nbsp;until&nbsp;space,&nbsp;marking&nbsp;end&nbsp;of&nbsp;word.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1847974">for</span>&nbsp;<span class="ident" id="1847978">width</span><span class="op" id="1847983">,</span>&nbsp;<span class="ident" id="1847985">i</span>&nbsp;<span class="op" id="1847987">:=</span>&nbsp;<span class="num" id="1847990">0</span><span class="op" id="1847991">,</span>&nbsp;<span class="ident" id="1847993">start</span><span class="op" id="1847998">;</span>&nbsp;<span class="ident" id="1848000">i</span>&nbsp;<span class="op" id="1848002">&lt;</span>&nbsp;<span class="builtinfunc" id="1848004">len</span><span class="op" id="1848007">(</span><span class="ident" id="1848008">data</span><span class="op" id="1848012">)</span><span class="op" id="1848013">;</span>&nbsp;<span class="ident" id="1848015">i</span>&nbsp;<span class="op" id="1848017">+=</span>&nbsp;<span class="ident" id="1848020">width</span>&nbsp;<span class="op" id="1848026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1848030">var</span>&nbsp;<span class="ident" id="1848034">r</span>&nbsp;<span class="builtintype" id="1848036">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1848043">r</span><span class="op" id="1848044">,</span>&nbsp;<span class="ident" id="1848046">width</span>&nbsp;<span class="op" id="1848052">=</span>&nbsp;<span class="ident" id="1848054">utf8</span><span class="op" id="1848058">.</span><span class="ident" id="1848059">DecodeRune</span><span class="op" id="1848069">(</span><span class="ident" id="1848070">data</span><span class="op" id="1848074">[</span><span class="ident" id="1848075">i</span><span class="op" id="1848076">:</span><span class="op" id="1848077">]</span><span class="op" id="1848078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1848082">if</span>&nbsp;<span class="ident" id="1848085">isSpace</span><span class="op" id="1848092">(</span><span class="ident" id="1848093">r</span><span class="op" id="1848094">)</span>&nbsp;<span class="op" id="1848096">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1848101">return</span>&nbsp;<span class="ident" id="1848108">i</span>&nbsp;<span class="op" id="1848110">+</span>&nbsp;<span class="ident" id="1848112">width</span><span class="op" id="1848117">,</span>&nbsp;<span class="ident" id="1848119">data</span><span class="op" id="1848123">[</span><span class="ident" id="1848124">start</span><span class="op" id="1848129">:</span><span class="ident" id="1848130">i</span><span class="op" id="1848131">]</span><span class="op" id="1848132">,</span>&nbsp;<span class="builtintype" id="1848134">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1848146">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-empty,&nbsp;non-terminated&nbsp;word.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1848227">if</span>&nbsp;<span class="ident" id="1848230">atEOF</span>&nbsp;<span class="op" id="1848236">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1848239">len</span><span class="op" id="1848242">(</span><span class="ident" id="1848243">data</span><span class="op" id="1848247">)</span>&nbsp;<span class="op" id="1848249">&gt;</span>&nbsp;<span class="ident" id="1848251">start</span>&nbsp;<span class="op" id="1848257">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1848261">return</span>&nbsp;<span class="builtinfunc" id="1848268">len</span><span class="op" id="1848271">(</span><span class="ident" id="1848272">data</span><span class="op" id="1848276">)</span><span class="op" id="1848277">,</span>&nbsp;<span class="ident" id="1848279">data</span><span class="op" id="1848283">[</span><span class="ident" id="1848284">start</span><span class="op" id="1848289">:</span><span class="op" id="1848290">]</span><span class="op" id="1848291">,</span>&nbsp;<span class="builtintype" id="1848293">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1848301">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1848324">return</span>&nbsp;<span class="ident" id="1848331">start</span><span class="op" id="1848336">,</span>&nbsp;<span class="builtintype" id="1848338">nil</span><span class="op" id="1848341">,</span>&nbsp;<span class="builtintype" id="1848343">nil</span><br>
<span class="lineno"></span><span class="op" id="1848347">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
