<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3882790">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3882845">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3882899">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3882950">package</span>&nbsp;<span class="ident" id="3882958">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3882963">import</span>&nbsp;<span class="op" id="3882970">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3882973">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3882991">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883001">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883016">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883031">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883038">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883044">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883056">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883067">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3883075">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3883082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3883085">const</span>&nbsp;<span class="op" id="3883091">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883094">VersionSSL30</span>&nbsp;<span class="op" id="3883107">=</span>&nbsp;<span class="num" id="3883109">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883117">VersionTLS10</span>&nbsp;<span class="op" id="3883130">=</span>&nbsp;<span class="num" id="3883132">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883140">VersionTLS11</span>&nbsp;<span class="op" id="3883153">=</span>&nbsp;<span class="num" id="3883155">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883163">VersionTLS12</span>&nbsp;<span class="op" id="3883176">=</span>&nbsp;<span class="num" id="3883178">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="3883185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3883188">const</span>&nbsp;<span class="op" id="3883194">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883197">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3883213">=</span>&nbsp;<span class="num" id="3883215">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3883228">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883265">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3883281">=</span>&nbsp;<span class="num" id="3883283">16384</span>&nbsp;<span class="op" id="3883289">+</span>&nbsp;<span class="num" id="3883291">2048</span>&nbsp;<span class="comment" id="3883296">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883334">recordHeaderLen</span>&nbsp;<span class="op" id="3883350">=</span>&nbsp;<span class="num" id="3883352">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3883365">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883390">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3883406">=</span>&nbsp;<span class="num" id="3883408">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3883421">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883479">minVersion</span>&nbsp;<span class="op" id="3883490">=</span>&nbsp;<span class="ident" id="3883492">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883506">maxVersion</span>&nbsp;<span class="op" id="3883517">=</span>&nbsp;<span class="ident" id="3883519">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="3883532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3883535">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3883556">type</span>&nbsp;<span class="ident" id="3883561">recordType</span>&nbsp;<span class="builtintype" id="3883572">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3883579">const</span>&nbsp;<span class="op" id="3883585">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883588">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="3883615">recordType</span>&nbsp;<span class="op" id="3883626">=</span>&nbsp;<span class="num" id="3883628">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883632">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3883659">recordType</span>&nbsp;<span class="op" id="3883670">=</span>&nbsp;<span class="num" id="3883672">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883676">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3883703">recordType</span>&nbsp;<span class="op" id="3883714">=</span>&nbsp;<span class="num" id="3883716">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883720">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="3883747">recordType</span>&nbsp;<span class="op" id="3883758">=</span>&nbsp;<span class="num" id="3883760">23</span><br>
<span class="lineno">45</span><span class="op" id="3883763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3883766">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3883798">const</span>&nbsp;<span class="op" id="3883804">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883807">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3883830">uint8</span>&nbsp;<span class="op" id="3883836">=</span>&nbsp;<span class="num" id="3883838">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883841">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3883864">uint8</span>&nbsp;<span class="op" id="3883870">=</span>&nbsp;<span class="num" id="3883872">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883875">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3883898">uint8</span>&nbsp;<span class="op" id="3883904">=</span>&nbsp;<span class="num" id="3883906">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883909">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3883932">uint8</span>&nbsp;<span class="op" id="3883938">=</span>&nbsp;<span class="num" id="3883940">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883944">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3883967">uint8</span>&nbsp;<span class="op" id="3883973">=</span>&nbsp;<span class="num" id="3883975">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883979">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="3884002">uint8</span>&nbsp;<span class="op" id="3884008">=</span>&nbsp;<span class="num" id="3884010">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884014">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884037">uint8</span>&nbsp;<span class="op" id="3884043">=</span>&nbsp;<span class="num" id="3884045">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884049">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="3884072">uint8</span>&nbsp;<span class="op" id="3884078">=</span>&nbsp;<span class="num" id="3884080">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884084">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3884107">uint8</span>&nbsp;<span class="op" id="3884113">=</span>&nbsp;<span class="num" id="3884115">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884119">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884142">uint8</span>&nbsp;<span class="op" id="3884148">=</span>&nbsp;<span class="num" id="3884150">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884154">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="3884177">uint8</span>&nbsp;<span class="op" id="3884183">=</span>&nbsp;<span class="num" id="3884185">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884189">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884212">uint8</span>&nbsp;<span class="op" id="3884218">=</span>&nbsp;<span class="num" id="3884220">67</span>&nbsp;<span class="comment" id="3884223">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="3884244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3884247">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3884273">const</span>&nbsp;<span class="op" id="3884279">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884282">compressionNone</span>&nbsp;<span class="builtintype" id="3884298">uint8</span>&nbsp;<span class="op" id="3884304">=</span>&nbsp;<span class="num" id="3884306">0</span><br>
<span class="lineno"></span><span class="op" id="3884308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3884311">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3884336">const</span>&nbsp;<span class="op" id="3884342">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884345">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884374">uint16</span>&nbsp;<span class="op" id="3884381">=</span>&nbsp;<span class="num" id="3884383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884386">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884415">uint16</span>&nbsp;<span class="op" id="3884422">=</span>&nbsp;<span class="num" id="3884424">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884427">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884456">uint16</span>&nbsp;<span class="op" id="3884463">=</span>&nbsp;<span class="num" id="3884465">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884469">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884498">uint16</span>&nbsp;<span class="op" id="3884505">=</span>&nbsp;<span class="num" id="3884507">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884511">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="3884540">uint16</span>&nbsp;<span class="op" id="3884547">=</span>&nbsp;<span class="num" id="3884549">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884553">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884582">uint16</span>&nbsp;<span class="op" id="3884589">=</span>&nbsp;<span class="num" id="3884591">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884595">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884624">uint16</span>&nbsp;<span class="op" id="3884631">=</span>&nbsp;<span class="num" id="3884633">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884637">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884666">uint16</span>&nbsp;<span class="op" id="3884673">=</span>&nbsp;<span class="num" id="3884675">13172</span>&nbsp;<span class="comment" id="3884681">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884703">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3884732">uint16</span>&nbsp;<span class="op" id="3884739">=</span>&nbsp;<span class="num" id="3884741">0xff01</span><br>
<span class="lineno"></span><span class="op" id="3884748">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3884751">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="3884788">const</span>&nbsp;<span class="op" id="3884794">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884797">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="3884815">uint16</span>&nbsp;<span class="op" id="3884822">=</span>&nbsp;<span class="num" id="3884824">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="3884831">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3884834">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3884904">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="3884990">type</span>&nbsp;<span class="ident" id="3884995">CurveID</span>&nbsp;<span class="builtintype" id="3885003">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3885011">const</span>&nbsp;<span class="op" id="3885017">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885020">CurveP256</span>&nbsp;<span class="ident" id="3885030">CurveID</span>&nbsp;<span class="op" id="3885038">=</span>&nbsp;<span class="num" id="3885040">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885044">CurveP384</span>&nbsp;<span class="ident" id="3885054">CurveID</span>&nbsp;<span class="op" id="3885062">=</span>&nbsp;<span class="num" id="3885064">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885068">CurveP521</span>&nbsp;<span class="ident" id="3885078">CurveID</span>&nbsp;<span class="op" id="3885086">=</span>&nbsp;<span class="num" id="3885088">25</span><br>
<span class="lineno"></span><span class="op" id="3885091">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3885094">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="3885130">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="3885216">const</span>&nbsp;<span class="op" id="3885222">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885225">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="3885249">uint8</span>&nbsp;<span class="op" id="3885255">=</span>&nbsp;<span class="num" id="3885257">0</span><br>
<span class="lineno">100</span><span class="op" id="3885259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3885262">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="3885302">const</span>&nbsp;<span class="op" id="3885308">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885311">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="3885326">uint8</span>&nbsp;<span class="op" id="3885332">=</span>&nbsp;<span class="num" id="3885334">1</span><br>
<span class="lineno">105</span><span class="op" id="3885336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3885339">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="3885388">const</span>&nbsp;<span class="op" id="3885394">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885397">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3885416">=</span>&nbsp;<span class="num" id="3885418">1</span>&nbsp;<span class="comment" id="3885420">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885460">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3885479">=</span>&nbsp;<span class="num" id="3885481">2</span>&nbsp;<span class="comment" id="3885483">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885522">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="3885541">=</span>&nbsp;<span class="num" id="3885543">3</span>&nbsp;<span class="comment" id="3885545">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885590">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="3885609">=</span>&nbsp;<span class="num" id="3885611">4</span>&nbsp;<span class="comment" id="3885613">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3885659">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885695">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3885718">=</span>&nbsp;<span class="num" id="3885720">64</span>&nbsp;<span class="comment" id="3885723">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885800">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3885823">=</span>&nbsp;<span class="num" id="3885825">65</span>&nbsp;<span class="comment" id="3885828">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885902">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="3885925">=</span>&nbsp;<span class="num" id="3885927">66</span>&nbsp;<span class="comment" id="3885930">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3886007">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="3886053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3886056">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3886116">const</span>&nbsp;<span class="op" id="3886122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886125">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3886136">uint8</span>&nbsp;<span class="op" id="3886142">=</span>&nbsp;<span class="num" id="3886144">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886147">hashSHA256</span>&nbsp;<span class="builtintype" id="3886158">uint8</span>&nbsp;<span class="op" id="3886164">=</span>&nbsp;<span class="num" id="3886166">4</span><br>
<span class="lineno"></span><span class="op" id="3886168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3886171">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3886237">const</span>&nbsp;<span class="op" id="3886243">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886246">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3886261">uint8</span>&nbsp;<span class="op" id="3886267">=</span>&nbsp;<span class="num" id="3886269">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886272">signatureECDSA</span>&nbsp;<span class="builtintype" id="3886287">uint8</span>&nbsp;<span class="op" id="3886293">=</span>&nbsp;<span class="num" id="3886295">3</span><br>
<span class="lineno"></span><span class="op" id="3886297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3886300">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="3886379">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3886407">type</span>&nbsp;<span class="ident" id="3886412">signatureAndHash</span>&nbsp;<span class="keyword" id="3886429">struct</span>&nbsp;<span class="op" id="3886436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886439">hash</span><span class="op" id="3886443">,</span>&nbsp;<span class="ident" id="3886445">signature</span>&nbsp;<span class="builtintype" id="3886455">uint8</span><br>
<span class="lineno"></span><span class="op" id="3886461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3886464">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="3886542">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="3886609">var</span>&nbsp;<span class="ident" id="3886613">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="3886645">=</span>&nbsp;<span class="op" id="3886647">[</span><span class="op" id="3886648">]</span><span class="ident" id="3886649">signatureAndHash</span><span class="op" id="3886665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886668">{</span><span class="ident" id="3886669">hashSHA256</span><span class="op" id="3886679">,</span>&nbsp;<span class="ident" id="3886681">signatureRSA</span><span class="op" id="3886693">}</span><span class="op" id="3886694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886697">{</span><span class="ident" id="3886698">hashSHA256</span><span class="op" id="3886708">,</span>&nbsp;<span class="ident" id="3886710">signatureECDSA</span><span class="op" id="3886724">}</span><span class="op" id="3886725">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886728">{</span><span class="ident" id="3886729">hashSHA1</span><span class="op" id="3886737">,</span>&nbsp;<span class="ident" id="3886739">signatureRSA</span><span class="op" id="3886751">}</span><span class="op" id="3886752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886755">{</span><span class="ident" id="3886756">hashSHA1</span><span class="op" id="3886764">,</span>&nbsp;<span class="ident" id="3886766">signatureECDSA</span><span class="op" id="3886780">}</span><span class="op" id="3886781">,</span><br>
<span class="lineno"></span><span class="op" id="3886783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3886786">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="3886860">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="3886925">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3886948">var</span>&nbsp;<span class="ident" id="3886952">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="3886991">=</span>&nbsp;<span class="op" id="3886993">[</span><span class="op" id="3886994">]</span><span class="ident" id="3886995">signatureAndHash</span><span class="op" id="3887011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887014">{</span><span class="ident" id="3887015">hashSHA256</span><span class="op" id="3887025">,</span>&nbsp;<span class="ident" id="3887027">signatureRSA</span><span class="op" id="3887039">}</span><span class="op" id="3887040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887043">{</span><span class="ident" id="3887044">hashSHA256</span><span class="op" id="3887054">,</span>&nbsp;<span class="ident" id="3887056">signatureECDSA</span><span class="op" id="3887070">}</span><span class="op" id="3887071">,</span><br>
<span class="lineno">155</span><span class="op" id="3887073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3887076">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3887143">type</span>&nbsp;<span class="ident" id="3887148">ConnectionState</span>&nbsp;<span class="keyword" id="3887164">struct</span>&nbsp;<span class="op" id="3887171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887174">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887201">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887223">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887282">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887309">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887331">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887361">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887388">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887410">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887459">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887486">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887508">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887564">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887591">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887613">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887667">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="3887694">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887716">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887765">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3887792">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3887814">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887877">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3887904">[</span><span class="op" id="3887905">]</span><span class="op" id="3887906">*</span><span class="ident" id="3887907">x509</span><span class="op" id="3887911">.</span><span class="ident" id="3887912">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3887926">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887973">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3888000">[</span><span class="op" id="3888001">]</span><span class="op" id="3888002">[</span><span class="op" id="3888003">]</span><span class="op" id="3888004">*</span><span class="ident" id="3888005">x509</span><span class="op" id="3888009">.</span><span class="ident" id="3888010">Certificate</span>&nbsp;<span class="comment" id="3888022">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3888071">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3888142">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3888208">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3888268">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3888341">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3888407">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888441">TLSUnique</span>&nbsp;<span class="op" id="3888451">[</span><span class="op" id="3888452">]</span><span class="builtintype" id="3888453">byte</span><br>
<span class="lineno"></span><span class="op" id="3888458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3888461">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3888526">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="3888556">type</span>&nbsp;<span class="ident" id="3888561">ClientAuthType</span>&nbsp;<span class="builtintype" id="3888576">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3888581">const</span>&nbsp;<span class="op" id="3888587">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888590">NoClientCert</span>&nbsp;<span class="ident" id="3888603">ClientAuthType</span>&nbsp;<span class="op" id="3888618">=</span>&nbsp;<span class="ident" id="3888620">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888626">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888645">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888667">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888692">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="3888719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3888722">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3888795">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="3888808">type</span>&nbsp;<span class="ident" id="3888813">ClientSessionState</span>&nbsp;<span class="keyword" id="3888832">struct</span>&nbsp;<span class="op" id="3888839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888842">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3888861">[</span><span class="op" id="3888862">]</span><span class="builtintype" id="3888863">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3888881">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888942">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3888961">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3888981">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889028">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3889047">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3889067">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889110">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3889129">[</span><span class="op" id="3889130">]</span><span class="builtintype" id="3889131">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3889149">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889206">serverCertificates</span>&nbsp;<span class="op" id="3889225">[</span><span class="op" id="3889226">]</span><span class="op" id="3889227">*</span><span class="ident" id="3889228">x509</span><span class="op" id="3889232">.</span><span class="ident" id="3889233">Certificate</span>&nbsp;<span class="comment" id="3889245">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="3889290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3889293">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3889373">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="3889452">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3889526">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3889541">type</span>&nbsp;<span class="ident" id="3889546">ClientSessionCache</span>&nbsp;<span class="keyword" id="3889565">interface</span>&nbsp;<span class="op" id="3889575">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3889578">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3889651">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889695">Get</span><span class="op" id="3889698">(</span><span class="ident" id="3889699">sessionKey</span>&nbsp;<span class="builtintype" id="3889710">string</span><span class="op" id="3889716">)</span>&nbsp;<span class="op" id="3889718">(</span><span class="ident" id="3889719">session</span>&nbsp;<span class="op" id="3889727">*</span><span class="ident" id="3889728">ClientSessionState</span><span class="op" id="3889746">,</span>&nbsp;<span class="ident" id="3889748">ok</span>&nbsp;<span class="builtintype" id="3889751">bool</span><span class="op" id="3889755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3889759">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889828">Put</span><span class="op" id="3889831">(</span><span class="ident" id="3889832">sessionKey</span>&nbsp;<span class="builtintype" id="3889843">string</span><span class="op" id="3889849">,</span>&nbsp;<span class="ident" id="3889851">cs</span>&nbsp;<span class="op" id="3889854">*</span><span class="ident" id="3889855">ClientSessionState</span><span class="op" id="3889873">)</span><br>
<span class="lineno"></span><span class="op" id="3889875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3889878">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3889957">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="3890020">type</span>&nbsp;<span class="ident" id="3890025">ClientHelloInfo</span>&nbsp;<span class="keyword" id="3890041">struct</span>&nbsp;<span class="op" id="3890048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890051">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890121">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890152">CipherSuites</span>&nbsp;<span class="op" id="3890165">[</span><span class="op" id="3890166">]</span><span class="builtintype" id="3890167">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890176">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890248">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890319">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890348">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890401">ServerName</span>&nbsp;<span class="builtintype" id="3890412">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890421">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890492">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890557">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890590">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890645">SupportedCurves</span>&nbsp;<span class="op" id="3890661">[</span><span class="op" id="3890662">]</span><span class="ident" id="3890663">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890673">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890742">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890815">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890838">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890893">SupportedPoints</span>&nbsp;<span class="op" id="3890909">[</span><span class="op" id="3890910">]</span><span class="builtintype" id="3890911">uint8</span><br>
<span class="lineno"></span><span class="op" id="3890917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3890920">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="3890987">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3891049">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3891116">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3891130">type</span>&nbsp;<span class="ident" id="3891135">Config</span>&nbsp;<span class="keyword" id="3891142">struct</span>&nbsp;<span class="op" id="3891149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891152">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891221">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891293">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891310">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891370">Rand</span>&nbsp;<span class="ident" id="3891375">io</span><span class="op" id="3891377">.</span><span class="ident" id="3891378">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891387">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891463">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891502">Time</span>&nbsp;<span class="keyword" id="3891507">func</span><span class="op" id="3891511">(</span><span class="op" id="3891512">)</span>&nbsp;<span class="ident" id="3891514">time</span><span class="op" id="3891518">.</span><span class="ident" id="3891519">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891526">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891583">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891635">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891700">Certificates</span>&nbsp;<span class="op" id="3891713">[</span><span class="op" id="3891714">]</span><span class="ident" id="3891715">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891729">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891797">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891863">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891932">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891970">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892040">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892065">NameToCertificate</span>&nbsp;<span class="keyword" id="3892083">map</span><span class="op" id="3892086">[</span><span class="builtintype" id="3892087">string</span><span class="op" id="3892093">]</span><span class="op" id="3892094">*</span><span class="ident" id="3892095">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892109">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892169">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892240">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892296">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892368">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892378">GetCertificate</span>&nbsp;<span class="keyword" id="3892393">func</span><span class="op" id="3892397">(</span><span class="ident" id="3892398">clientHello</span>&nbsp;<span class="op" id="3892410">*</span><span class="ident" id="3892411">ClientHelloInfo</span><span class="op" id="3892426">)</span>&nbsp;<span class="op" id="3892428">(</span><span class="op" id="3892429">*</span><span class="ident" id="3892430">Certificate</span><span class="op" id="3892441">,</span>&nbsp;<span class="builtintype" id="3892443">error</span><span class="op" id="3892448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892452">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892512">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892569">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892625">RootCAs</span>&nbsp;<span class="op" id="3892633">*</span><span class="ident" id="3892634">x509</span><span class="op" id="3892638">.</span><span class="ident" id="3892639">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892650">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892718">NextProtos</span>&nbsp;<span class="op" id="3892729">[</span><span class="op" id="3892730">]</span><span class="builtintype" id="3892731">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892740">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892802">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892875">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892933">ServerName</span>&nbsp;<span class="builtintype" id="3892944">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892953">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893003">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893063">ClientAuth</span>&nbsp;<span class="ident" id="3893074">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893091">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893153">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893217">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893250">ClientCAs</span>&nbsp;<span class="op" id="3893260">*</span><span class="ident" id="3893261">x509</span><span class="op" id="3893265">.</span><span class="ident" id="3893266">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893277">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893339">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893385">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893448">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893515">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893582">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893624">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="3893643">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893650">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893721">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893792">CipherSuites</span>&nbsp;<span class="op" id="3893805">[</span><span class="op" id="3893806">]</span><span class="builtintype" id="3893807">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893816">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893885">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893957">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894028">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894080">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="3894105">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894112">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894184">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894210">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="3894233">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894240">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894303">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894365">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894416">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894420">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894490">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894549">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894612">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894660">SessionTicketKey</span>&nbsp;<span class="op" id="3894677">[</span><span class="num" id="3894678">32</span><span class="op" id="3894680">]</span><span class="builtintype" id="3894681">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894688">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894762">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894778">ClientSessionCache</span>&nbsp;<span class="ident" id="3894797">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894818">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894890">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894939">MinVersion</span>&nbsp;<span class="builtintype" id="3894950">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3894959">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895031">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895104">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895136">MaxVersion</span>&nbsp;<span class="builtintype" id="3895147">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895156">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895227">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895299">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895312">CurvePreferences</span>&nbsp;<span class="op" id="3895329">[</span><span class="op" id="3895330">]</span><span class="ident" id="3895331">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895341">serverInitOnce</span>&nbsp;<span class="ident" id="3895356">sync</span><span class="op" id="3895360">.</span><span class="ident" id="3895361">Once</span>&nbsp;<span class="comment" id="3895366">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="3895405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3895408">func</span>&nbsp;<span class="op" id="3895413">(</span><span class="ident" id="3895414">c</span>&nbsp;<span class="op" id="3895416">*</span><span class="ident" id="3895417">Config</span><span class="op" id="3895423">)</span>&nbsp;<span class="ident" id="3895425">serverInit</span><span class="op" id="3895435">(</span><span class="op" id="3895436">)</span>&nbsp;<span class="op" id="3895438">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895441">if</span>&nbsp;<span class="ident" id="3895444">c</span><span class="op" id="3895445">.</span><span class="ident" id="3895446">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3895469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895473">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895485">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895549">for</span>&nbsp;<span class="ident" id="3895553">_</span><span class="op" id="3895554">,</span>&nbsp;<span class="ident" id="3895556">b</span>&nbsp;<span class="op" id="3895558">:=</span>&nbsp;<span class="keyword" id="3895561">range</span>&nbsp;<span class="ident" id="3895567">c</span><span class="op" id="3895568">.</span><span class="ident" id="3895569">SessionTicketKey</span>&nbsp;<span class="op" id="3895586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895590">if</span>&nbsp;<span class="ident" id="3895593">b</span>&nbsp;<span class="op" id="3895595">!=</span>&nbsp;<span class="num" id="3895598">0</span>&nbsp;<span class="op" id="3895600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895617">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895621">if</span>&nbsp;<span class="ident" id="3895624">_</span><span class="op" id="3895625">,</span>&nbsp;<span class="ident" id="3895627">err</span>&nbsp;<span class="op" id="3895631">:=</span>&nbsp;<span class="ident" id="3895634">io</span><span class="op" id="3895636">.</span><span class="ident" id="3895637">ReadFull</span><span class="op" id="3895645">(</span><span class="ident" id="3895646">c</span><span class="op" id="3895647">.</span><span class="ident" id="3895648">rand</span><span class="op" id="3895652">(</span><span class="op" id="3895653">)</span><span class="op" id="3895654">,</span>&nbsp;<span class="ident" id="3895656">c</span><span class="op" id="3895657">.</span><span class="ident" id="3895658">SessionTicketKey</span><span class="op" id="3895674">[</span><span class="op" id="3895675">:</span><span class="op" id="3895676">]</span><span class="op" id="3895677">)</span><span class="op" id="3895678">;</span>&nbsp;<span class="ident" id="3895680">err</span>&nbsp;<span class="op" id="3895684">!=</span>&nbsp;<span class="ident" id="3895687">nil</span>&nbsp;<span class="op" id="3895691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895695">c</span><span class="op" id="3895696">.</span><span class="ident" id="3895697">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3895720">=</span>&nbsp;<span class="ident" id="3895722">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895728">}</span><br>
<span class="lineno"></span><span class="op" id="3895730">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3895733">func</span>&nbsp;<span class="op" id="3895738">(</span><span class="ident" id="3895739">c</span>&nbsp;<span class="op" id="3895741">*</span><span class="ident" id="3895742">Config</span><span class="op" id="3895748">)</span>&nbsp;<span class="ident" id="3895750">rand</span><span class="op" id="3895754">(</span><span class="op" id="3895755">)</span>&nbsp;<span class="ident" id="3895757">io</span><span class="op" id="3895759">.</span><span class="ident" id="3895760">Reader</span>&nbsp;<span class="op" id="3895767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895770">r</span>&nbsp;<span class="op" id="3895772">:=</span>&nbsp;<span class="ident" id="3895775">c</span><span class="op" id="3895776">.</span><span class="ident" id="3895777">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895783">if</span>&nbsp;<span class="ident" id="3895786">r</span>&nbsp;<span class="op" id="3895788">==</span>&nbsp;<span class="ident" id="3895791">nil</span>&nbsp;<span class="op" id="3895795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895799">return</span>&nbsp;<span class="ident" id="3895806">rand</span><span class="op" id="3895810">.</span><span class="ident" id="3895811">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895822">return</span>&nbsp;<span class="ident" id="3895829">r</span><br>
<span class="lineno"></span><span class="op" id="3895831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3895834">func</span>&nbsp;<span class="op" id="3895839">(</span><span class="ident" id="3895840">c</span>&nbsp;<span class="op" id="3895842">*</span><span class="ident" id="3895843">Config</span><span class="op" id="3895849">)</span>&nbsp;<span class="ident" id="3895851">time</span><span class="op" id="3895855">(</span><span class="op" id="3895856">)</span>&nbsp;<span class="ident" id="3895858">time</span><span class="op" id="3895862">.</span><span class="ident" id="3895863">Time</span>&nbsp;<span class="op" id="3895868">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895871">t</span>&nbsp;<span class="op" id="3895873">:=</span>&nbsp;<span class="ident" id="3895876">c</span><span class="op" id="3895877">.</span><span class="ident" id="3895878">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895884">if</span>&nbsp;<span class="ident" id="3895887">t</span>&nbsp;<span class="op" id="3895889">==</span>&nbsp;<span class="ident" id="3895892">nil</span>&nbsp;<span class="op" id="3895896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895900">t</span>&nbsp;<span class="op" id="3895902">=</span>&nbsp;<span class="ident" id="3895904">time</span><span class="op" id="3895908">.</span><span class="ident" id="3895909">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895917">return</span>&nbsp;<span class="ident" id="3895924">t</span><span class="op" id="3895925">(</span><span class="op" id="3895926">)</span><br>
<span class="lineno">380</span><span class="op" id="3895928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3895931">func</span>&nbsp;<span class="op" id="3895936">(</span><span class="ident" id="3895937">c</span>&nbsp;<span class="op" id="3895939">*</span><span class="ident" id="3895940">Config</span><span class="op" id="3895946">)</span>&nbsp;<span class="ident" id="3895948">cipherSuites</span><span class="op" id="3895960">(</span><span class="op" id="3895961">)</span>&nbsp;<span class="op" id="3895963">[</span><span class="op" id="3895964">]</span><span class="builtintype" id="3895965">uint16</span>&nbsp;<span class="op" id="3895972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895975">s</span>&nbsp;<span class="op" id="3895977">:=</span>&nbsp;<span class="ident" id="3895980">c</span><span class="op" id="3895981">.</span><span class="ident" id="3895982">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895996">if</span>&nbsp;<span class="ident" id="3895999">s</span>&nbsp;<span class="op" id="3896001">==</span>&nbsp;<span class="ident" id="3896004">nil</span>&nbsp;<span class="op" id="3896008">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896012">s</span>&nbsp;<span class="op" id="3896014">=</span>&nbsp;<span class="ident" id="3896016">defaultCipherSuites</span><span class="op" id="3896035">(</span><span class="op" id="3896036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896042">return</span>&nbsp;<span class="ident" id="3896049">s</span><br>
<span class="lineno"></span><span class="op" id="3896051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="3896054">func</span>&nbsp;<span class="op" id="3896059">(</span><span class="ident" id="3896060">c</span>&nbsp;<span class="op" id="3896062">*</span><span class="ident" id="3896063">Config</span><span class="op" id="3896069">)</span>&nbsp;<span class="ident" id="3896071">minVersion</span><span class="op" id="3896081">(</span><span class="op" id="3896082">)</span>&nbsp;<span class="builtintype" id="3896084">uint16</span>&nbsp;<span class="op" id="3896091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896094">if</span>&nbsp;<span class="ident" id="3896097">c</span>&nbsp;<span class="op" id="3896099">==</span>&nbsp;<span class="ident" id="3896102">nil</span>&nbsp;<span class="op" id="3896106">||</span>&nbsp;<span class="ident" id="3896109">c</span><span class="op" id="3896110">.</span><span class="ident" id="3896111">MinVersion</span>&nbsp;<span class="op" id="3896122">==</span>&nbsp;<span class="num" id="3896125">0</span>&nbsp;<span class="op" id="3896127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896131">return</span>&nbsp;<span class="ident" id="3896138">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896153">return</span>&nbsp;<span class="ident" id="3896160">c</span><span class="op" id="3896161">.</span><span class="ident" id="3896162">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="3896173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896176">func</span>&nbsp;<span class="op" id="3896181">(</span><span class="ident" id="3896182">c</span>&nbsp;<span class="op" id="3896184">*</span><span class="ident" id="3896185">Config</span><span class="op" id="3896191">)</span>&nbsp;<span class="ident" id="3896193">maxVersion</span><span class="op" id="3896203">(</span><span class="op" id="3896204">)</span>&nbsp;<span class="builtintype" id="3896206">uint16</span>&nbsp;<span class="op" id="3896213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896216">if</span>&nbsp;<span class="ident" id="3896219">c</span>&nbsp;<span class="op" id="3896221">==</span>&nbsp;<span class="ident" id="3896224">nil</span>&nbsp;<span class="op" id="3896228">||</span>&nbsp;<span class="ident" id="3896231">c</span><span class="op" id="3896232">.</span><span class="ident" id="3896233">MaxVersion</span>&nbsp;<span class="op" id="3896244">==</span>&nbsp;<span class="num" id="3896247">0</span>&nbsp;<span class="op" id="3896249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896253">return</span>&nbsp;<span class="ident" id="3896260">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896275">return</span>&nbsp;<span class="ident" id="3896282">c</span><span class="op" id="3896283">.</span><span class="ident" id="3896284">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="3896295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896298">var</span>&nbsp;<span class="ident" id="3896302">defaultCurvePreferences</span>&nbsp;<span class="op" id="3896326">=</span>&nbsp;<span class="op" id="3896328">[</span><span class="op" id="3896329">]</span><span class="ident" id="3896330">CurveID</span><span class="op" id="3896337">{</span><span class="ident" id="3896338">CurveP256</span><span class="op" id="3896347">,</span>&nbsp;<span class="ident" id="3896349">CurveP384</span><span class="op" id="3896358">,</span>&nbsp;<span class="ident" id="3896360">CurveP521</span><span class="op" id="3896369">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3896372">func</span>&nbsp;<span class="op" id="3896377">(</span><span class="ident" id="3896378">c</span>&nbsp;<span class="op" id="3896380">*</span><span class="ident" id="3896381">Config</span><span class="op" id="3896387">)</span>&nbsp;<span class="ident" id="3896389">curvePreferences</span><span class="op" id="3896405">(</span><span class="op" id="3896406">)</span>&nbsp;<span class="op" id="3896408">[</span><span class="op" id="3896409">]</span><span class="ident" id="3896410">CurveID</span>&nbsp;<span class="op" id="3896418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896421">if</span>&nbsp;<span class="ident" id="3896424">c</span>&nbsp;<span class="op" id="3896426">==</span>&nbsp;<span class="ident" id="3896429">nil</span>&nbsp;<span class="op" id="3896433">||</span>&nbsp;<span class="builtinfunc" id="3896436">len</span><span class="op" id="3896439">(</span><span class="ident" id="3896440">c</span><span class="op" id="3896441">.</span><span class="ident" id="3896442">CurvePreferences</span><span class="op" id="3896458">)</span>&nbsp;<span class="op" id="3896460">==</span>&nbsp;<span class="num" id="3896463">0</span>&nbsp;<span class="op" id="3896465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896469">return</span>&nbsp;<span class="ident" id="3896476">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896501">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896504">return</span>&nbsp;<span class="ident" id="3896511">c</span><span class="op" id="3896512">.</span><span class="ident" id="3896513">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="3896530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3896533">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="3896607">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="3896631">func</span>&nbsp;<span class="op" id="3896636">(</span><span class="ident" id="3896637">c</span>&nbsp;<span class="op" id="3896639">*</span><span class="ident" id="3896640">Config</span><span class="op" id="3896646">)</span>&nbsp;<span class="ident" id="3896648">mutualVersion</span><span class="op" id="3896661">(</span><span class="ident" id="3896662">vers</span>&nbsp;<span class="builtintype" id="3896667">uint16</span><span class="op" id="3896673">)</span>&nbsp;<span class="op" id="3896675">(</span><span class="builtintype" id="3896676">uint16</span><span class="op" id="3896682">,</span>&nbsp;<span class="builtintype" id="3896684">bool</span><span class="op" id="3896688">)</span>&nbsp;<span class="op" id="3896690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896693">minVersion</span>&nbsp;<span class="op" id="3896704">:=</span>&nbsp;<span class="ident" id="3896707">c</span><span class="op" id="3896708">.</span><span class="ident" id="3896709">minVersion</span><span class="op" id="3896719">(</span><span class="op" id="3896720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896723">maxVersion</span>&nbsp;<span class="op" id="3896734">:=</span>&nbsp;<span class="ident" id="3896737">c</span><span class="op" id="3896738">.</span><span class="ident" id="3896739">maxVersion</span><span class="op" id="3896749">(</span><span class="op" id="3896750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896754">if</span>&nbsp;<span class="ident" id="3896757">vers</span>&nbsp;<span class="op" id="3896762">&lt;</span>&nbsp;<span class="ident" id="3896764">minVersion</span>&nbsp;<span class="op" id="3896775">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896779">return</span>&nbsp;<span class="num" id="3896786">0</span><span class="op" id="3896787">,</span>&nbsp;<span class="ident" id="3896789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896799">if</span>&nbsp;<span class="ident" id="3896802">vers</span>&nbsp;<span class="op" id="3896807">&gt;</span>&nbsp;<span class="ident" id="3896809">maxVersion</span>&nbsp;<span class="op" id="3896820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896824">vers</span>&nbsp;<span class="op" id="3896829">=</span>&nbsp;<span class="ident" id="3896831">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896843">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896846">return</span>&nbsp;<span class="ident" id="3896853">vers</span><span class="op" id="3896857">,</span>&nbsp;<span class="ident" id="3896859">true</span><br>
<span class="lineno"></span><span class="op" id="3896864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3896867">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="3896945">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="3896999">func</span>&nbsp;<span class="op" id="3897004">(</span><span class="ident" id="3897005">c</span>&nbsp;<span class="op" id="3897007">*</span><span class="ident" id="3897008">Config</span><span class="op" id="3897014">)</span>&nbsp;<span class="ident" id="3897016">getCertificate</span><span class="op" id="3897030">(</span><span class="ident" id="3897031">clientHello</span>&nbsp;<span class="op" id="3897043">*</span><span class="ident" id="3897044">ClientHelloInfo</span><span class="op" id="3897059">)</span>&nbsp;<span class="op" id="3897061">(</span><span class="op" id="3897062">*</span><span class="ident" id="3897063">Certificate</span><span class="op" id="3897074">,</span>&nbsp;<span class="builtintype" id="3897076">error</span><span class="op" id="3897081">)</span>&nbsp;<span class="op" id="3897083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897086">if</span>&nbsp;<span class="ident" id="3897089">c</span><span class="op" id="3897090">.</span><span class="ident" id="3897091">GetCertificate</span>&nbsp;<span class="op" id="3897106">!=</span>&nbsp;<span class="ident" id="3897109">nil</span>&nbsp;<span class="op" id="3897113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897117">cert</span><span class="op" id="3897121">,</span>&nbsp;<span class="ident" id="3897123">err</span>&nbsp;<span class="op" id="3897127">:=</span>&nbsp;<span class="ident" id="3897130">c</span><span class="op" id="3897131">.</span><span class="ident" id="3897132">GetCertificate</span><span class="op" id="3897146">(</span><span class="ident" id="3897147">clientHello</span><span class="op" id="3897158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897162">if</span>&nbsp;<span class="ident" id="3897165">cert</span>&nbsp;<span class="op" id="3897170">!=</span>&nbsp;<span class="ident" id="3897173">nil</span>&nbsp;<span class="op" id="3897177">||</span>&nbsp;<span class="ident" id="3897180">err</span>&nbsp;<span class="op" id="3897184">!=</span>&nbsp;<span class="ident" id="3897187">nil</span>&nbsp;<span class="op" id="3897191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897196">return</span>&nbsp;<span class="ident" id="3897203">cert</span><span class="op" id="3897207">,</span>&nbsp;<span class="ident" id="3897209">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897222">if</span>&nbsp;<span class="builtinfunc" id="3897225">len</span><span class="op" id="3897228">(</span><span class="ident" id="3897229">c</span><span class="op" id="3897230">.</span><span class="ident" id="3897231">Certificates</span><span class="op" id="3897243">)</span>&nbsp;<span class="op" id="3897245">==</span>&nbsp;<span class="num" id="3897248">1</span>&nbsp;<span class="op" id="3897250">||</span>&nbsp;<span class="ident" id="3897253">c</span><span class="op" id="3897254">.</span><span class="ident" id="3897255">NameToCertificate</span>&nbsp;<span class="op" id="3897273">==</span>&nbsp;<span class="ident" id="3897276">nil</span>&nbsp;<span class="op" id="3897280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3897284">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897342">return</span>&nbsp;<span class="op" id="3897349">&amp;</span><span class="ident" id="3897350">c</span><span class="op" id="3897351">.</span><span class="ident" id="3897352">Certificates</span><span class="op" id="3897364">[</span><span class="num" id="3897365">0</span><span class="op" id="3897366">]</span><span class="op" id="3897367">,</span>&nbsp;<span class="ident" id="3897369">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897378">name</span>&nbsp;<span class="op" id="3897383">:=</span>&nbsp;<span class="ident" id="3897386">strings</span><span class="op" id="3897393">.</span><span class="ident" id="3897394">ToLower</span><span class="op" id="3897401">(</span><span class="ident" id="3897402">clientHello</span><span class="op" id="3897413">.</span><span class="ident" id="3897414">ServerName</span><span class="op" id="3897424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897427">for</span>&nbsp;<span class="builtinfunc" id="3897431">len</span><span class="op" id="3897434">(</span><span class="ident" id="3897435">name</span><span class="op" id="3897439">)</span>&nbsp;<span class="op" id="3897441">&gt;</span>&nbsp;<span class="num" id="3897443">0</span>&nbsp;<span class="op" id="3897445">&amp;&amp;</span>&nbsp;<span class="ident" id="3897448">name</span><span class="op" id="3897452">[</span><span class="builtinfunc" id="3897453">len</span><span class="op" id="3897456">(</span><span class="ident" id="3897457">name</span><span class="op" id="3897461">)</span><span class="op" id="3897462">-</span><span class="num" id="3897463">1</span><span class="op" id="3897464">]</span>&nbsp;<span class="op" id="3897466">==</span>&nbsp;<span class="string" id="3897469">&#39;.&#39;</span>&nbsp;<span class="op" id="3897473">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897477">name</span>&nbsp;<span class="op" id="3897482">=</span>&nbsp;<span class="ident" id="3897484">name</span><span class="op" id="3897488">[</span><span class="op" id="3897489">:</span><span class="builtinfunc" id="3897490">len</span><span class="op" id="3897493">(</span><span class="ident" id="3897494">name</span><span class="op" id="3897498">)</span><span class="op" id="3897499">-</span><span class="num" id="3897500">1</span><span class="op" id="3897501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897508">if</span>&nbsp;<span class="ident" id="3897511">cert</span><span class="op" id="3897515">,</span>&nbsp;<span class="ident" id="3897517">ok</span>&nbsp;<span class="op" id="3897520">:=</span>&nbsp;<span class="ident" id="3897523">c</span><span class="op" id="3897524">.</span><span class="ident" id="3897525">NameToCertificate</span><span class="op" id="3897542">[</span><span class="ident" id="3897543">name</span><span class="op" id="3897547">]</span><span class="op" id="3897548">;</span>&nbsp;<span class="ident" id="3897550">ok</span>&nbsp;<span class="op" id="3897553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897557">return</span>&nbsp;<span class="ident" id="3897564">cert</span><span class="op" id="3897568">,</span>&nbsp;<span class="ident" id="3897570">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3897579">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3897646">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897657">labels</span>&nbsp;<span class="op" id="3897664">:=</span>&nbsp;<span class="ident" id="3897667">strings</span><span class="op" id="3897674">.</span><span class="ident" id="3897675">Split</span><span class="op" id="3897680">(</span><span class="ident" id="3897681">name</span><span class="op" id="3897685">,</span>&nbsp;<span class="string" id="3897687">&#34;.&#34;</span><span class="op" id="3897690">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897693">for</span>&nbsp;<span class="ident" id="3897697">i</span>&nbsp;<span class="op" id="3897699">:=</span>&nbsp;<span class="keyword" id="3897702">range</span>&nbsp;<span class="ident" id="3897708">labels</span>&nbsp;<span class="op" id="3897715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897719">labels</span><span class="op" id="3897725">[</span><span class="ident" id="3897726">i</span><span class="op" id="3897727">]</span>&nbsp;<span class="op" id="3897729">=</span>&nbsp;<span class="string" id="3897731">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897737">candidate</span>&nbsp;<span class="op" id="3897747">:=</span>&nbsp;<span class="ident" id="3897750">strings</span><span class="op" id="3897757">.</span><span class="ident" id="3897758">Join</span><span class="op" id="3897762">(</span><span class="ident" id="3897763">labels</span><span class="op" id="3897769">,</span>&nbsp;<span class="string" id="3897771">&#34;.&#34;</span><span class="op" id="3897774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897778">if</span>&nbsp;<span class="ident" id="3897781">cert</span><span class="op" id="3897785">,</span>&nbsp;<span class="ident" id="3897787">ok</span>&nbsp;<span class="op" id="3897790">:=</span>&nbsp;<span class="ident" id="3897793">c</span><span class="op" id="3897794">.</span><span class="ident" id="3897795">NameToCertificate</span><span class="op" id="3897812">[</span><span class="ident" id="3897813">candidate</span><span class="op" id="3897822">]</span><span class="op" id="3897823">;</span>&nbsp;<span class="ident" id="3897825">ok</span>&nbsp;<span class="op" id="3897828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897833">return</span>&nbsp;<span class="ident" id="3897840">cert</span><span class="op" id="3897844">,</span>&nbsp;<span class="ident" id="3897846">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3897859">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897913">return</span>&nbsp;<span class="op" id="3897920">&amp;</span><span class="ident" id="3897921">c</span><span class="op" id="3897922">.</span><span class="ident" id="3897923">Certificates</span><span class="op" id="3897935">[</span><span class="num" id="3897936">0</span><span class="op" id="3897937">]</span><span class="op" id="3897938">,</span>&nbsp;<span class="ident" id="3897940">nil</span><br>
<span class="lineno">465</span><span class="op" id="3897944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3897947">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="3898026">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="3898101">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="3898118">func</span>&nbsp;<span class="op" id="3898123">(</span><span class="ident" id="3898124">c</span>&nbsp;<span class="op" id="3898126">*</span><span class="ident" id="3898127">Config</span><span class="op" id="3898133">)</span>&nbsp;<span class="ident" id="3898135">BuildNameToCertificate</span><span class="op" id="3898157">(</span><span class="op" id="3898158">)</span>&nbsp;<span class="op" id="3898160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898163">c</span><span class="op" id="3898164">.</span><span class="ident" id="3898165">NameToCertificate</span>&nbsp;<span class="op" id="3898183">=</span>&nbsp;<span class="builtinfunc" id="3898185">make</span><span class="op" id="3898189">(</span><span class="keyword" id="3898190">map</span><span class="op" id="3898193">[</span><span class="builtintype" id="3898194">string</span><span class="op" id="3898200">]</span><span class="op" id="3898201">*</span><span class="ident" id="3898202">Certificate</span><span class="op" id="3898213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898216">for</span>&nbsp;<span class="ident" id="3898220">i</span>&nbsp;<span class="op" id="3898222">:=</span>&nbsp;<span class="keyword" id="3898225">range</span>&nbsp;<span class="ident" id="3898231">c</span><span class="op" id="3898232">.</span><span class="ident" id="3898233">Certificates</span>&nbsp;<span class="op" id="3898246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898250">cert</span>&nbsp;<span class="op" id="3898255">:=</span>&nbsp;<span class="op" id="3898258">&amp;</span><span class="ident" id="3898259">c</span><span class="op" id="3898260">.</span><span class="ident" id="3898261">Certificates</span><span class="op" id="3898273">[</span><span class="ident" id="3898274">i</span><span class="op" id="3898275">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898279">x509Cert</span><span class="op" id="3898287">,</span>&nbsp;<span class="ident" id="3898289">err</span>&nbsp;<span class="op" id="3898293">:=</span>&nbsp;<span class="ident" id="3898296">x509</span><span class="op" id="3898300">.</span><span class="ident" id="3898301">ParseCertificate</span><span class="op" id="3898317">(</span><span class="ident" id="3898318">cert</span><span class="op" id="3898322">.</span><span class="ident" id="3898323">Certificate</span><span class="op" id="3898334">[</span><span class="num" id="3898335">0</span><span class="op" id="3898336">]</span><span class="op" id="3898337">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898341">if</span>&nbsp;<span class="ident" id="3898344">err</span>&nbsp;<span class="op" id="3898348">!=</span>&nbsp;<span class="ident" id="3898351">nil</span>&nbsp;<span class="op" id="3898355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898360">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898375">if</span>&nbsp;<span class="builtinfunc" id="3898378">len</span><span class="op" id="3898381">(</span><span class="ident" id="3898382">x509Cert</span><span class="op" id="3898390">.</span><span class="ident" id="3898391">Subject</span><span class="op" id="3898398">.</span><span class="ident" id="3898399">CommonName</span><span class="op" id="3898409">)</span>&nbsp;<span class="op" id="3898411">&gt;</span>&nbsp;<span class="num" id="3898413">0</span>&nbsp;<span class="op" id="3898415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898420">c</span><span class="op" id="3898421">.</span><span class="ident" id="3898422">NameToCertificate</span><span class="op" id="3898439">[</span><span class="ident" id="3898440">x509Cert</span><span class="op" id="3898448">.</span><span class="ident" id="3898449">Subject</span><span class="op" id="3898456">.</span><span class="ident" id="3898457">CommonName</span><span class="op" id="3898467">]</span>&nbsp;<span class="op" id="3898469">=</span>&nbsp;<span class="ident" id="3898471">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898482">for</span>&nbsp;<span class="ident" id="3898486">_</span><span class="op" id="3898487">,</span>&nbsp;<span class="ident" id="3898489">san</span>&nbsp;<span class="op" id="3898493">:=</span>&nbsp;<span class="keyword" id="3898496">range</span>&nbsp;<span class="ident" id="3898502">x509Cert</span><span class="op" id="3898510">.</span><span class="ident" id="3898511">DNSNames</span>&nbsp;<span class="op" id="3898520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898525">c</span><span class="op" id="3898526">.</span><span class="ident" id="3898527">NameToCertificate</span><span class="op" id="3898544">[</span><span class="ident" id="3898545">san</span><span class="op" id="3898548">]</span>&nbsp;<span class="op" id="3898550">=</span>&nbsp;<span class="ident" id="3898552">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898562">}</span><br>
<span class="lineno">485</span><span class="op" id="3898564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3898567">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3898636">type</span>&nbsp;<span class="ident" id="3898641">Certificate</span>&nbsp;<span class="keyword" id="3898653">struct</span>&nbsp;<span class="op" id="3898660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898663">Certificate</span>&nbsp;<span class="op" id="3898675">[</span><span class="op" id="3898676">]</span><span class="op" id="3898677">[</span><span class="op" id="3898678">]</span><span class="builtintype" id="3898679">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898685">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898757">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898818">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898888">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898958">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898987">PrivateKey</span>&nbsp;<span class="ident" id="3898998">crypto</span><span class="op" id="3899004">.</span><span class="ident" id="3899005">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899017">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899088">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899120">OCSPStaple</span>&nbsp;<span class="op" id="3899131">[</span><span class="op" id="3899132">]</span><span class="builtintype" id="3899133">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899139">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899205">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899273">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899345">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899392">Leaf</span>&nbsp;<span class="op" id="3899397">*</span><span class="ident" id="3899398">x509</span><span class="op" id="3899402">.</span><span class="ident" id="3899403">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3899415">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="3899418">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3899435">type</span>&nbsp;<span class="ident" id="3899440">record</span>&nbsp;<span class="keyword" id="3899447">struct</span>&nbsp;<span class="op" id="3899454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899457">contentType</span>&nbsp;&nbsp;<span class="ident" id="3899470">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899482">major</span><span class="op" id="3899487">,</span>&nbsp;<span class="ident" id="3899489">minor</span>&nbsp;<span class="builtintype" id="3899495">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899502">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3899515">[</span><span class="op" id="3899516">]</span><span class="builtintype" id="3899517">byte</span><br>
<span class="lineno"></span><span class="op" id="3899522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899525">type</span>&nbsp;<span class="ident" id="3899530">handshakeMessage</span>&nbsp;<span class="keyword" id="3899547">interface</span>&nbsp;<span class="op" id="3899557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899560">marshal</span><span class="op" id="3899567">(</span><span class="op" id="3899568">)</span>&nbsp;<span class="op" id="3899570">[</span><span class="op" id="3899571">]</span><span class="builtintype" id="3899572">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899578">unmarshal</span><span class="op" id="3899587">(</span><span class="op" id="3899588">[</span><span class="op" id="3899589">]</span><span class="builtintype" id="3899590">byte</span><span class="op" id="3899594">)</span>&nbsp;<span class="builtintype" id="3899596">bool</span><br>
<span class="lineno"></span><span class="op" id="3899601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3899604">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="3899679">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="3899700">type</span>&nbsp;<span class="ident" id="3899705">lruSessionCache</span>&nbsp;<span class="keyword" id="3899721">struct</span>&nbsp;<span class="op" id="3899728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899731">sync</span><span class="op" id="3899735">.</span><span class="ident" id="3899736">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899744">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3899753">map</span><span class="op" id="3899756">[</span><span class="builtintype" id="3899757">string</span><span class="op" id="3899763">]</span><span class="op" id="3899764">*</span><span class="ident" id="3899765">list</span><span class="op" id="3899769">.</span><span class="ident" id="3899770">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899779">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3899788">*</span><span class="ident" id="3899789">list</span><span class="op" id="3899793">.</span><span class="ident" id="3899794">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899800">capacity</span>&nbsp;<span class="builtintype" id="3899809">int</span><br>
<span class="lineno"></span><span class="op" id="3899813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899816">type</span>&nbsp;<span class="ident" id="3899821">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="3899842">struct</span>&nbsp;<span class="op" id="3899849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899852">sessionKey</span>&nbsp;<span class="builtintype" id="3899863">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899871">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3899882">*</span><span class="ident" id="3899883">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="3899902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3899905">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3899977">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="3900055">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3900075">func</span>&nbsp;<span class="ident" id="3900080">NewLRUClientSessionCache</span><span class="op" id="3900104">(</span><span class="ident" id="3900105">capacity</span>&nbsp;<span class="builtintype" id="3900114">int</span><span class="op" id="3900117">)</span>&nbsp;<span class="ident" id="3900119">ClientSessionCache</span>&nbsp;<span class="op" id="3900138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900141">const</span>&nbsp;<span class="ident" id="3900147">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="3900175">=</span>&nbsp;<span class="num" id="3900177">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900182">if</span>&nbsp;<span class="ident" id="3900185">capacity</span>&nbsp;<span class="op" id="3900194">&lt;</span>&nbsp;<span class="num" id="3900196">1</span>&nbsp;<span class="op" id="3900198">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900202">capacity</span>&nbsp;<span class="op" id="3900211">=</span>&nbsp;<span class="ident" id="3900213">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900245">return</span>&nbsp;<span class="op" id="3900252">&amp;</span><span class="ident" id="3900253">lruSessionCache</span><span class="op" id="3900268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900272">m</span><span class="op" id="3900273">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3900282">make</span><span class="op" id="3900286">(</span><span class="keyword" id="3900287">map</span><span class="op" id="3900290">[</span><span class="builtintype" id="3900291">string</span><span class="op" id="3900297">]</span><span class="op" id="3900298">*</span><span class="ident" id="3900299">list</span><span class="op" id="3900303">.</span><span class="ident" id="3900304">Element</span><span class="op" id="3900311">)</span><span class="op" id="3900312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900316">q</span><span class="op" id="3900317">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3900326">list</span><span class="op" id="3900330">.</span><span class="ident" id="3900331">New</span><span class="op" id="3900334">(</span><span class="op" id="3900335">)</span><span class="op" id="3900336">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900340">capacity</span><span class="op" id="3900348">:</span>&nbsp;<span class="ident" id="3900350">capacity</span><span class="op" id="3900358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900361">}</span><br>
<span class="lineno"></span><span class="op" id="3900363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3900366">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="3900427">func</span>&nbsp;<span class="op" id="3900432">(</span><span class="ident" id="3900433">c</span>&nbsp;<span class="op" id="3900435">*</span><span class="ident" id="3900436">lruSessionCache</span><span class="op" id="3900451">)</span>&nbsp;<span class="ident" id="3900453">Put</span><span class="op" id="3900456">(</span><span class="ident" id="3900457">sessionKey</span>&nbsp;<span class="builtintype" id="3900468">string</span><span class="op" id="3900474">,</span>&nbsp;<span class="ident" id="3900476">cs</span>&nbsp;<span class="op" id="3900479">*</span><span class="ident" id="3900480">ClientSessionState</span><span class="op" id="3900498">)</span>&nbsp;<span class="op" id="3900500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900503">c</span><span class="op" id="3900504">.</span><span class="ident" id="3900505">Lock</span><span class="op" id="3900509">(</span><span class="op" id="3900510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900513">defer</span>&nbsp;<span class="ident" id="3900519">c</span><span class="op" id="3900520">.</span><span class="ident" id="3900521">Unlock</span><span class="op" id="3900527">(</span><span class="op" id="3900528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900532">if</span>&nbsp;<span class="ident" id="3900535">elem</span><span class="op" id="3900539">,</span>&nbsp;<span class="ident" id="3900541">ok</span>&nbsp;<span class="op" id="3900544">:=</span>&nbsp;<span class="ident" id="3900547">c</span><span class="op" id="3900548">.</span><span class="ident" id="3900549">m</span><span class="op" id="3900550">[</span><span class="ident" id="3900551">sessionKey</span><span class="op" id="3900561">]</span><span class="op" id="3900562">;</span>&nbsp;<span class="ident" id="3900564">ok</span>&nbsp;<span class="op" id="3900567">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900571">entry</span>&nbsp;<span class="op" id="3900577">:=</span>&nbsp;<span class="ident" id="3900580">elem</span><span class="op" id="3900584">.</span><span class="ident" id="3900585">Value</span><span class="op" id="3900590">.</span><span class="op" id="3900591">(</span><span class="op" id="3900592">*</span><span class="ident" id="3900593">lruSessionCacheEntry</span><span class="op" id="3900613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900617">entry</span><span class="op" id="3900622">.</span><span class="ident" id="3900623">state</span>&nbsp;<span class="op" id="3900629">=</span>&nbsp;<span class="ident" id="3900631">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900636">c</span><span class="op" id="3900637">.</span><span class="ident" id="3900638">q</span><span class="op" id="3900639">.</span><span class="ident" id="3900640">MoveToFront</span><span class="op" id="3900651">(</span><span class="ident" id="3900652">elem</span><span class="op" id="3900656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900660">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900668">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900672">if</span>&nbsp;<span class="ident" id="3900675">c</span><span class="op" id="3900676">.</span><span class="ident" id="3900677">q</span><span class="op" id="3900678">.</span><span class="ident" id="3900679">Len</span><span class="op" id="3900682">(</span><span class="op" id="3900683">)</span>&nbsp;<span class="op" id="3900685">&lt;</span>&nbsp;<span class="ident" id="3900687">c</span><span class="op" id="3900688">.</span><span class="ident" id="3900689">capacity</span>&nbsp;<span class="op" id="3900698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900702">entry</span>&nbsp;<span class="op" id="3900708">:=</span>&nbsp;<span class="op" id="3900711">&amp;</span><span class="ident" id="3900712">lruSessionCacheEntry</span><span class="op" id="3900732">{</span><span class="ident" id="3900733">sessionKey</span><span class="op" id="3900743">,</span>&nbsp;<span class="ident" id="3900745">cs</span><span class="op" id="3900747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900751">c</span><span class="op" id="3900752">.</span><span class="ident" id="3900753">m</span><span class="op" id="3900754">[</span><span class="ident" id="3900755">sessionKey</span><span class="op" id="3900765">]</span>&nbsp;<span class="op" id="3900767">=</span>&nbsp;<span class="ident" id="3900769">c</span><span class="op" id="3900770">.</span><span class="ident" id="3900771">q</span><span class="op" id="3900772">.</span><span class="ident" id="3900773">PushFront</span><span class="op" id="3900782">(</span><span class="ident" id="3900783">entry</span><span class="op" id="3900788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900792">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900804">elem</span>&nbsp;<span class="op" id="3900809">:=</span>&nbsp;<span class="ident" id="3900812">c</span><span class="op" id="3900813">.</span><span class="ident" id="3900814">q</span><span class="op" id="3900815">.</span><span class="ident" id="3900816">Back</span><span class="op" id="3900820">(</span><span class="op" id="3900821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900824">entry</span>&nbsp;<span class="op" id="3900830">:=</span>&nbsp;<span class="ident" id="3900833">elem</span><span class="op" id="3900837">.</span><span class="ident" id="3900838">Value</span><span class="op" id="3900843">.</span><span class="op" id="3900844">(</span><span class="op" id="3900845">*</span><span class="ident" id="3900846">lruSessionCacheEntry</span><span class="op" id="3900866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3900869">delete</span><span class="op" id="3900875">(</span><span class="ident" id="3900876">c</span><span class="op" id="3900877">.</span><span class="ident" id="3900878">m</span><span class="op" id="3900879">,</span>&nbsp;<span class="ident" id="3900881">entry</span><span class="op" id="3900886">.</span><span class="ident" id="3900887">sessionKey</span><span class="op" id="3900897">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900900">entry</span><span class="op" id="3900905">.</span><span class="ident" id="3900906">sessionKey</span>&nbsp;<span class="op" id="3900917">=</span>&nbsp;<span class="ident" id="3900919">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900931">entry</span><span class="op" id="3900936">.</span><span class="ident" id="3900937">state</span>&nbsp;<span class="op" id="3900943">=</span>&nbsp;<span class="ident" id="3900945">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900949">c</span><span class="op" id="3900950">.</span><span class="ident" id="3900951">q</span><span class="op" id="3900952">.</span><span class="ident" id="3900953">MoveToFront</span><span class="op" id="3900964">(</span><span class="ident" id="3900965">elem</span><span class="op" id="3900969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900972">c</span><span class="op" id="3900973">.</span><span class="ident" id="3900974">m</span><span class="op" id="3900975">[</span><span class="ident" id="3900976">sessionKey</span><span class="op" id="3900986">]</span>&nbsp;<span class="op" id="3900988">=</span>&nbsp;<span class="ident" id="3900990">elem</span><br>
<span class="lineno"></span><span class="op" id="3900995">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3900998">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3901074">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3901120">func</span>&nbsp;<span class="op" id="3901125">(</span><span class="ident" id="3901126">c</span>&nbsp;<span class="op" id="3901128">*</span><span class="ident" id="3901129">lruSessionCache</span><span class="op" id="3901144">)</span>&nbsp;<span class="ident" id="3901146">Get</span><span class="op" id="3901149">(</span><span class="ident" id="3901150">sessionKey</span>&nbsp;<span class="builtintype" id="3901161">string</span><span class="op" id="3901167">)</span>&nbsp;<span class="op" id="3901169">(</span><span class="op" id="3901170">*</span><span class="ident" id="3901171">ClientSessionState</span><span class="op" id="3901189">,</span>&nbsp;<span class="builtintype" id="3901191">bool</span><span class="op" id="3901195">)</span>&nbsp;<span class="op" id="3901197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901200">c</span><span class="op" id="3901201">.</span><span class="ident" id="3901202">Lock</span><span class="op" id="3901206">(</span><span class="op" id="3901207">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901210">defer</span>&nbsp;<span class="ident" id="3901216">c</span><span class="op" id="3901217">.</span><span class="ident" id="3901218">Unlock</span><span class="op" id="3901224">(</span><span class="op" id="3901225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901229">if</span>&nbsp;<span class="ident" id="3901232">elem</span><span class="op" id="3901236">,</span>&nbsp;<span class="ident" id="3901238">ok</span>&nbsp;<span class="op" id="3901241">:=</span>&nbsp;<span class="ident" id="3901244">c</span><span class="op" id="3901245">.</span><span class="ident" id="3901246">m</span><span class="op" id="3901247">[</span><span class="ident" id="3901248">sessionKey</span><span class="op" id="3901258">]</span><span class="op" id="3901259">;</span>&nbsp;<span class="ident" id="3901261">ok</span>&nbsp;<span class="op" id="3901264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901268">c</span><span class="op" id="3901269">.</span><span class="ident" id="3901270">q</span><span class="op" id="3901271">.</span><span class="ident" id="3901272">MoveToFront</span><span class="op" id="3901283">(</span><span class="ident" id="3901284">elem</span><span class="op" id="3901288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901292">return</span>&nbsp;<span class="ident" id="3901299">elem</span><span class="op" id="3901303">.</span><span class="ident" id="3901304">Value</span><span class="op" id="3901309">.</span><span class="op" id="3901310">(</span><span class="op" id="3901311">*</span><span class="ident" id="3901312">lruSessionCacheEntry</span><span class="op" id="3901332">)</span><span class="op" id="3901333">.</span><span class="ident" id="3901334">state</span><span class="op" id="3901339">,</span>&nbsp;<span class="ident" id="3901341">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901350">return</span>&nbsp;<span class="ident" id="3901357">nil</span><span class="op" id="3901360">,</span>&nbsp;<span class="ident" id="3901362">false</span><br>
<span class="lineno"></span><span class="op" id="3901368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3901371">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="3901444">type</span>&nbsp;<span class="ident" id="3901449">dsaSignature</span>&nbsp;<span class="keyword" id="3901462">struct</span>&nbsp;<span class="op" id="3901469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901472">R</span><span class="op" id="3901473">,</span>&nbsp;<span class="ident" id="3901475">S</span>&nbsp;<span class="op" id="3901477">*</span><span class="ident" id="3901478">big</span><span class="op" id="3901481">.</span><span class="ident" id="3901482">Int</span><br>
<span class="lineno"></span><span class="op" id="3901486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901489">type</span>&nbsp;<span class="ident" id="3901494">ecdsaSignature</span>&nbsp;<span class="ident" id="3901509">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="3901523">var</span>&nbsp;<span class="ident" id="3901527">emptyConfig</span>&nbsp;<span class="ident" id="3901539">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901547">func</span>&nbsp;<span class="ident" id="3901552">defaultConfig</span><span class="op" id="3901565">(</span><span class="op" id="3901566">)</span>&nbsp;<span class="op" id="3901568">*</span><span class="ident" id="3901569">Config</span>&nbsp;<span class="op" id="3901576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901579">return</span>&nbsp;<span class="op" id="3901586">&amp;</span><span class="ident" id="3901587">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="3901599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901602">var</span>&nbsp;<span class="op" id="3901606">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901609">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3901632">sync</span><span class="op" id="3901636">.</span><span class="ident" id="3901637">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901643">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3901666">[</span><span class="op" id="3901667">]</span><span class="builtintype" id="3901668">uint16</span><br>
<span class="lineno">605</span><span class="op" id="3901675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901678">func</span>&nbsp;<span class="ident" id="3901683">defaultCipherSuites</span><span class="op" id="3901702">(</span><span class="op" id="3901703">)</span>&nbsp;<span class="op" id="3901705">[</span><span class="op" id="3901706">]</span><span class="builtintype" id="3901707">uint16</span>&nbsp;<span class="op" id="3901714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901717">once</span><span class="op" id="3901721">.</span><span class="ident" id="3901722">Do</span><span class="op" id="3901724">(</span><span class="ident" id="3901725">initDefaultCipherSuites</span><span class="op" id="3901748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901751">return</span>&nbsp;<span class="ident" id="3901758">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="3901781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901784">func</span>&nbsp;<span class="ident" id="3901789">initDefaultCipherSuites</span><span class="op" id="3901812">(</span><span class="op" id="3901813">)</span>&nbsp;<span class="op" id="3901815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901818">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3901841">=</span>&nbsp;<span class="builtinfunc" id="3901843">make</span><span class="op" id="3901847">(</span><span class="op" id="3901848">[</span><span class="op" id="3901849">]</span><span class="builtintype" id="3901850">uint16</span><span class="op" id="3901856">,</span>&nbsp;<span class="builtinfunc" id="3901858">len</span><span class="op" id="3901861">(</span><span class="ident" id="3901862">cipherSuites</span><span class="op" id="3901874">)</span><span class="op" id="3901875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901878">for</span>&nbsp;<span class="ident" id="3901882">i</span><span class="op" id="3901883">,</span>&nbsp;<span class="ident" id="3901885">suite</span>&nbsp;<span class="op" id="3901891">:=</span>&nbsp;<span class="keyword" id="3901894">range</span>&nbsp;<span class="ident" id="3901900">cipherSuites</span>&nbsp;<span class="op" id="3901913">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901917">varDefaultCipherSuites</span><span class="op" id="3901939">[</span><span class="ident" id="3901940">i</span><span class="op" id="3901941">]</span>&nbsp;<span class="op" id="3901943">=</span>&nbsp;<span class="ident" id="3901945">suite</span><span class="op" id="3901950">.</span><span class="ident" id="3901951">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901955">}</span><br>
<span class="lineno"></span><span class="op" id="3901957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901960">func</span>&nbsp;<span class="ident" id="3901965">unexpectedMessageError</span><span class="op" id="3901987">(</span><span class="ident" id="3901988">wanted</span><span class="op" id="3901994">,</span>&nbsp;<span class="ident" id="3901996">got</span>&nbsp;<span class="keyword" id="3902000">interface</span><span class="op" id="3902009">{</span><span class="op" id="3902010">}</span><span class="op" id="3902011">)</span>&nbsp;<span class="builtintype" id="3902013">error</span>&nbsp;<span class="op" id="3902019">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902022">return</span>&nbsp;<span class="ident" id="3902029">fmt</span><span class="op" id="3902032">.</span><span class="ident" id="3902033">Errorf</span><span class="op" id="3902039">(</span><span class="string" id="3902040">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="3902115">,</span>&nbsp;<span class="ident" id="3902117">got</span><span class="op" id="3902120">,</span>&nbsp;<span class="ident" id="3902122">wanted</span><span class="op" id="3902128">)</span><br>
<span class="lineno"></span><span class="op" id="3902130">}</span>
</div>
</body>
</html>
