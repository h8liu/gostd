<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6069031">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6069086">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6069140">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6069191">package</span>&nbsp;<span class="ident" id="6069199">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6069204">import</span>&nbsp;<span class="op" id="6069211">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069214">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069223">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069242">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069252">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069260">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069274">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6069279">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6069282">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="6069322">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069370">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="6069410">type</span>&nbsp;<span class="ident" id="6069415">Writer</span>&nbsp;<span class="keyword" id="6069422">struct</span>&nbsp;<span class="op" id="6069429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069432">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069439">*</span><span class="ident" id="6069440">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069453">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069460">[</span><span class="op" id="6069461">]</span><span class="op" id="6069462">*</span><span class="ident" id="6069463">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069471">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6069478">*</span><span class="ident" id="6069479">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069491">closed</span>&nbsp;<span class="builtintype" id="6069498">bool</span><br>
<span class="lineno">25</span><span class="op" id="6069503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6069506">type</span>&nbsp;<span class="ident" id="6069511">header</span>&nbsp;<span class="keyword" id="6069518">struct</span>&nbsp;<span class="op" id="6069525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069528">*</span><span class="ident" id="6069529">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069541">offset</span>&nbsp;<span class="ident" id="6069548">uint64</span><br>
<span class="lineno">30</span><span class="op" id="6069555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069558">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6069617">func</span>&nbsp;<span class="ident" id="6069622">NewWriter</span><span class="op" id="6069631">(</span><span class="ident" id="6069632">w</span>&nbsp;<span class="ident" id="6069634">io</span><span class="op" id="6069636">.</span><span class="ident" id="6069637">Writer</span><span class="op" id="6069643">)</span>&nbsp;<span class="op" id="6069645">*</span><span class="ident" id="6069646">Writer</span>&nbsp;<span class="op" id="6069653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069656">return</span>&nbsp;<span class="op" id="6069663">&amp;</span><span class="ident" id="6069664">Writer</span><span class="op" id="6069670">{</span><span class="ident" id="6069671">cw</span><span class="op" id="6069673">:</span>&nbsp;<span class="op" id="6069675">&amp;</span><span class="ident" id="6069676">countWriter</span><span class="op" id="6069687">{</span><span class="ident" id="6069688">w</span><span class="op" id="6069689">:</span>&nbsp;<span class="ident" id="6069691">bufio</span><span class="op" id="6069696">.</span><span class="ident" id="6069697">NewWriter</span><span class="op" id="6069706">(</span><span class="ident" id="6069707">w</span><span class="op" id="6069708">)</span><span class="op" id="6069709">}</span><span class="op" id="6069710">}</span><br>
<span class="lineno">35</span><span class="op" id="6069712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069715">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="6069776">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="6069849">func</span>&nbsp;<span class="op" id="6069854">(</span><span class="ident" id="6069855">w</span>&nbsp;<span class="op" id="6069857">*</span><span class="ident" id="6069858">Writer</span><span class="op" id="6069864">)</span>&nbsp;<span class="ident" id="6069866">Flush</span><span class="op" id="6069871">(</span><span class="op" id="6069872">)</span>&nbsp;<span class="builtintype" id="6069874">error</span>&nbsp;<span class="op" id="6069880">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069883">return</span>&nbsp;<span class="ident" id="6069890">w</span><span class="op" id="6069891">.</span><span class="ident" id="6069892">cw</span><span class="op" id="6069894">.</span><span class="ident" id="6069895">w</span><span class="op" id="6069896">.</span><span class="op" id="6069897">(</span><span class="op" id="6069898">*</span><span class="ident" id="6069899">bufio</span><span class="op" id="6069904">.</span><span class="ident" id="6069905">Writer</span><span class="op" id="6069911">)</span><span class="op" id="6069912">.</span><span class="ident" id="6069913">Flush</span><span class="op" id="6069918">(</span><span class="op" id="6069919">)</span><br>
<span class="lineno"></span><span class="op" id="6069921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069924">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="6069997">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="6070055">func</span>&nbsp;<span class="op" id="6070060">(</span><span class="ident" id="6070061">w</span>&nbsp;<span class="op" id="6070063">*</span><span class="ident" id="6070064">Writer</span><span class="op" id="6070070">)</span>&nbsp;<span class="ident" id="6070072">Close</span><span class="op" id="6070077">(</span><span class="op" id="6070078">)</span>&nbsp;<span class="builtintype" id="6070080">error</span>&nbsp;<span class="op" id="6070086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070089">if</span>&nbsp;<span class="ident" id="6070092">w</span><span class="op" id="6070093">.</span><span class="ident" id="6070094">last</span>&nbsp;<span class="op" id="6070099">!=</span>&nbsp;<span class="ident" id="6070102">nil</span>&nbsp;<span class="op" id="6070106">&amp;&amp;</span>&nbsp;<span class="op" id="6070109">!</span><span class="ident" id="6070110">w</span><span class="op" id="6070111">.</span><span class="ident" id="6070112">last</span><span class="op" id="6070116">.</span><span class="ident" id="6070117">closed</span>&nbsp;<span class="op" id="6070124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070128">if</span>&nbsp;<span class="ident" id="6070131">err</span>&nbsp;<span class="op" id="6070135">:=</span>&nbsp;<span class="ident" id="6070138">w</span><span class="op" id="6070139">.</span><span class="ident" id="6070140">last</span><span class="op" id="6070144">.</span><span class="builtinfunc" id="6070145">close</span><span class="op" id="6070150">(</span><span class="op" id="6070151">)</span><span class="op" id="6070152">;</span>&nbsp;<span class="ident" id="6070154">err</span>&nbsp;<span class="op" id="6070158">!=</span>&nbsp;<span class="ident" id="6070161">nil</span>&nbsp;<span class="op" id="6070165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070170">return</span>&nbsp;<span class="ident" id="6070177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070183">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070187">w</span><span class="op" id="6070188">.</span><span class="ident" id="6070189">last</span>&nbsp;<span class="op" id="6070194">=</span>&nbsp;<span class="ident" id="6070196">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070204">if</span>&nbsp;<span class="ident" id="6070207">w</span><span class="op" id="6070208">.</span><span class="ident" id="6070209">closed</span>&nbsp;<span class="op" id="6070216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070220">return</span>&nbsp;<span class="ident" id="6070227">errors</span><span class="op" id="6070233">.</span><span class="ident" id="6070234">New</span><span class="op" id="6070237">(</span><span class="string" id="6070238">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6070264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070267">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070270">w</span><span class="op" id="6070271">.</span><span class="ident" id="6070272">closed</span>&nbsp;<span class="op" id="6070279">=</span>&nbsp;<span class="builtintype" id="6070281">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070288">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070316">start</span>&nbsp;<span class="op" id="6070322">:=</span>&nbsp;<span class="ident" id="6070325">w</span><span class="op" id="6070326">.</span><span class="ident" id="6070327">cw</span><span class="op" id="6070329">.</span><span class="ident" id="6070330">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070337">for</span>&nbsp;<span class="ident" id="6070341">_</span><span class="op" id="6070342">,</span>&nbsp;<span class="ident" id="6070344">h</span>&nbsp;<span class="op" id="6070346">:=</span>&nbsp;<span class="keyword" id="6070349">range</span>&nbsp;<span class="ident" id="6070355">w</span><span class="op" id="6070356">.</span><span class="ident" id="6070357">dir</span>&nbsp;<span class="op" id="6070361">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070365">var</span>&nbsp;<span class="ident" id="6070369">buf</span>&nbsp;<span class="op" id="6070373">[</span><span class="ident" id="6070374">directoryHeaderLen</span><span class="op" id="6070392">]</span><span class="builtintype" id="6070393">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070400">b</span>&nbsp;<span class="op" id="6070402">:=</span>&nbsp;<span class="ident" id="6070405">writeBuf</span><span class="op" id="6070413">(</span><span class="ident" id="6070414">buf</span><span class="op" id="6070417">[</span><span class="op" id="6070418">:</span><span class="op" id="6070419">]</span><span class="op" id="6070420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070424">b</span><span class="op" id="6070425">.</span><span class="builtintype" id="6070426">uint32</span><span class="op" id="6070432">(</span><span class="builtintype" id="6070433">uint32</span><span class="op" id="6070439">(</span><span class="ident" id="6070440">directoryHeaderSignature</span><span class="op" id="6070464">)</span><span class="op" id="6070465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070469">b</span><span class="op" id="6070470">.</span><span class="builtintype" id="6070471">uint16</span><span class="op" id="6070477">(</span><span class="ident" id="6070478">h</span><span class="op" id="6070479">.</span><span class="ident" id="6070480">CreatorVersion</span><span class="op" id="6070494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070498">b</span><span class="op" id="6070499">.</span><span class="builtintype" id="6070500">uint16</span><span class="op" id="6070506">(</span><span class="ident" id="6070507">h</span><span class="op" id="6070508">.</span><span class="ident" id="6070509">ReaderVersion</span><span class="op" id="6070522">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070526">b</span><span class="op" id="6070527">.</span><span class="builtintype" id="6070528">uint16</span><span class="op" id="6070534">(</span><span class="ident" id="6070535">h</span><span class="op" id="6070536">.</span><span class="ident" id="6070537">Flags</span><span class="op" id="6070542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070546">b</span><span class="op" id="6070547">.</span><span class="builtintype" id="6070548">uint16</span><span class="op" id="6070554">(</span><span class="ident" id="6070555">h</span><span class="op" id="6070556">.</span><span class="ident" id="6070557">Method</span><span class="op" id="6070563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070567">b</span><span class="op" id="6070568">.</span><span class="builtintype" id="6070569">uint16</span><span class="op" id="6070575">(</span><span class="ident" id="6070576">h</span><span class="op" id="6070577">.</span><span class="ident" id="6070578">ModifiedTime</span><span class="op" id="6070590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070594">b</span><span class="op" id="6070595">.</span><span class="builtintype" id="6070596">uint16</span><span class="op" id="6070602">(</span><span class="ident" id="6070603">h</span><span class="op" id="6070604">.</span><span class="ident" id="6070605">ModifiedDate</span><span class="op" id="6070617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070621">b</span><span class="op" id="6070622">.</span><span class="builtintype" id="6070623">uint32</span><span class="op" id="6070629">(</span><span class="ident" id="6070630">h</span><span class="op" id="6070631">.</span><span class="ident" id="6070632">CRC32</span><span class="op" id="6070637">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070641">if</span>&nbsp;<span class="ident" id="6070644">h</span><span class="op" id="6070645">.</span><span class="ident" id="6070646">isZip64</span><span class="op" id="6070653">(</span><span class="op" id="6070654">)</span>&nbsp;<span class="op" id="6070656">||</span>&nbsp;<span class="ident" id="6070659">h</span><span class="op" id="6070660">.</span><span class="ident" id="6070661">offset</span>&nbsp;<span class="op" id="6070668">&gt;</span>&nbsp;<span class="ident" id="6070670">uint32max</span>&nbsp;<span class="op" id="6070680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070685">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070743">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070806">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070847">b</span><span class="op" id="6070848">.</span><span class="builtintype" id="6070849">uint32</span><span class="op" id="6070855">(</span><span class="ident" id="6070856">uint32max</span><span class="op" id="6070865">)</span>&nbsp;<span class="comment" id="6070867">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070889">b</span><span class="op" id="6070890">.</span><span class="builtintype" id="6070891">uint32</span><span class="op" id="6070897">(</span><span class="ident" id="6070898">uint32max</span><span class="op" id="6070907">)</span>&nbsp;<span class="comment" id="6070909">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070934">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070976">var</span>&nbsp;<span class="ident" id="6070980">buf</span>&nbsp;<span class="op" id="6070984">[</span><span class="num" id="6070985">28</span><span class="op" id="6070987">]</span><span class="builtintype" id="6070988">byte</span>&nbsp;<span class="comment" id="6070993">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071021">eb</span>&nbsp;<span class="op" id="6071024">:=</span>&nbsp;<span class="ident" id="6071027">writeBuf</span><span class="op" id="6071035">(</span><span class="ident" id="6071036">buf</span><span class="op" id="6071039">[</span><span class="op" id="6071040">:</span><span class="op" id="6071041">]</span><span class="op" id="6071042">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071047">eb</span><span class="op" id="6071049">.</span><span class="builtintype" id="6071050">uint16</span><span class="op" id="6071056">(</span><span class="ident" id="6071057">zip64ExtraId</span><span class="op" id="6071069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071074">eb</span><span class="op" id="6071076">.</span><span class="builtintype" id="6071077">uint16</span><span class="op" id="6071083">(</span><span class="num" id="6071084">24</span><span class="op" id="6071086">)</span>&nbsp;<span class="comment" id="6071088">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071111">eb</span><span class="op" id="6071113">.</span><span class="ident" id="6071114">uint64</span><span class="op" id="6071120">(</span><span class="ident" id="6071121">h</span><span class="op" id="6071122">.</span><span class="ident" id="6071123">UncompressedSize64</span><span class="op" id="6071141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071146">eb</span><span class="op" id="6071148">.</span><span class="ident" id="6071149">uint64</span><span class="op" id="6071155">(</span><span class="ident" id="6071156">h</span><span class="op" id="6071157">.</span><span class="ident" id="6071158">CompressedSize64</span><span class="op" id="6071174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071179">eb</span><span class="op" id="6071181">.</span><span class="ident" id="6071182">uint64</span><span class="op" id="6071188">(</span><span class="ident" id="6071189">h</span><span class="op" id="6071190">.</span><span class="ident" id="6071191">offset</span><span class="op" id="6071197">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071202">h</span><span class="op" id="6071203">.</span><span class="ident" id="6071204">Extra</span>&nbsp;<span class="op" id="6071210">=</span>&nbsp;<span class="builtinfunc" id="6071212">append</span><span class="op" id="6071218">(</span><span class="ident" id="6071219">h</span><span class="op" id="6071220">.</span><span class="ident" id="6071221">Extra</span><span class="op" id="6071226">,</span>&nbsp;<span class="ident" id="6071228">buf</span><span class="op" id="6071231">[</span><span class="op" id="6071232">:</span><span class="op" id="6071233">]</span><span class="op" id="6071234">...</span><span class="op" id="6071237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071241">}</span>&nbsp;<span class="keyword" id="6071243">else</span>&nbsp;<span class="op" id="6071248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071253">b</span><span class="op" id="6071254">.</span><span class="builtintype" id="6071255">uint32</span><span class="op" id="6071261">(</span><span class="ident" id="6071262">h</span><span class="op" id="6071263">.</span><span class="ident" id="6071264">CompressedSize</span><span class="op" id="6071278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071283">b</span><span class="op" id="6071284">.</span><span class="builtintype" id="6071285">uint32</span><span class="op" id="6071291">(</span><span class="ident" id="6071292">h</span><span class="op" id="6071293">.</span><span class="ident" id="6071294">UncompressedSize</span><span class="op" id="6071310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071314">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071318">b</span><span class="op" id="6071319">.</span><span class="builtintype" id="6071320">uint16</span><span class="op" id="6071326">(</span><span class="builtintype" id="6071327">uint16</span><span class="op" id="6071333">(</span><span class="builtinfunc" id="6071334">len</span><span class="op" id="6071337">(</span><span class="ident" id="6071338">h</span><span class="op" id="6071339">.</span><span class="ident" id="6071340">Name</span><span class="op" id="6071344">)</span><span class="op" id="6071345">)</span><span class="op" id="6071346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071350">b</span><span class="op" id="6071351">.</span><span class="builtintype" id="6071352">uint16</span><span class="op" id="6071358">(</span><span class="builtintype" id="6071359">uint16</span><span class="op" id="6071365">(</span><span class="builtinfunc" id="6071366">len</span><span class="op" id="6071369">(</span><span class="ident" id="6071370">h</span><span class="op" id="6071371">.</span><span class="ident" id="6071372">Extra</span><span class="op" id="6071377">)</span><span class="op" id="6071378">)</span><span class="op" id="6071379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071383">b</span><span class="op" id="6071384">.</span><span class="builtintype" id="6071385">uint16</span><span class="op" id="6071391">(</span><span class="builtintype" id="6071392">uint16</span><span class="op" id="6071398">(</span><span class="builtinfunc" id="6071399">len</span><span class="op" id="6071402">(</span><span class="ident" id="6071403">h</span><span class="op" id="6071404">.</span><span class="ident" id="6071405">Comment</span><span class="op" id="6071412">)</span><span class="op" id="6071413">)</span><span class="op" id="6071414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071418">b</span>&nbsp;<span class="op" id="6071420">=</span>&nbsp;<span class="ident" id="6071422">b</span><span class="op" id="6071423">[</span><span class="num" id="6071424">4</span><span class="op" id="6071425">:</span><span class="op" id="6071426">]</span>&nbsp;<span class="comment" id="6071428">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071491">b</span><span class="op" id="6071492">.</span><span class="builtintype" id="6071493">uint32</span><span class="op" id="6071499">(</span><span class="ident" id="6071500">h</span><span class="op" id="6071501">.</span><span class="ident" id="6071502">ExternalAttrs</span><span class="op" id="6071515">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071519">if</span>&nbsp;<span class="ident" id="6071522">h</span><span class="op" id="6071523">.</span><span class="ident" id="6071524">offset</span>&nbsp;<span class="op" id="6071531">&gt;</span>&nbsp;<span class="ident" id="6071533">uint32max</span>&nbsp;<span class="op" id="6071543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071548">b</span><span class="op" id="6071549">.</span><span class="builtintype" id="6071550">uint32</span><span class="op" id="6071556">(</span><span class="ident" id="6071557">uint32max</span><span class="op" id="6071566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071570">}</span>&nbsp;<span class="keyword" id="6071572">else</span>&nbsp;<span class="op" id="6071577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071582">b</span><span class="op" id="6071583">.</span><span class="builtintype" id="6071584">uint32</span><span class="op" id="6071590">(</span><span class="builtintype" id="6071591">uint32</span><span class="op" id="6071597">(</span><span class="ident" id="6071598">h</span><span class="op" id="6071599">.</span><span class="ident" id="6071600">offset</span><span class="op" id="6071606">)</span><span class="op" id="6071607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071611">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071615">if</span>&nbsp;<span class="ident" id="6071618">_</span><span class="op" id="6071619">,</span>&nbsp;<span class="ident" id="6071621">err</span>&nbsp;<span class="op" id="6071625">:=</span>&nbsp;<span class="ident" id="6071628">w</span><span class="op" id="6071629">.</span><span class="ident" id="6071630">cw</span><span class="op" id="6071632">.</span><span class="ident" id="6071633">Write</span><span class="op" id="6071638">(</span><span class="ident" id="6071639">buf</span><span class="op" id="6071642">[</span><span class="op" id="6071643">:</span><span class="op" id="6071644">]</span><span class="op" id="6071645">)</span><span class="op" id="6071646">;</span>&nbsp;<span class="ident" id="6071648">err</span>&nbsp;<span class="op" id="6071652">!=</span>&nbsp;<span class="ident" id="6071655">nil</span>&nbsp;<span class="op" id="6071659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071664">return</span>&nbsp;<span class="ident" id="6071671">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071681">if</span>&nbsp;<span class="ident" id="6071684">_</span><span class="op" id="6071685">,</span>&nbsp;<span class="ident" id="6071687">err</span>&nbsp;<span class="op" id="6071691">:=</span>&nbsp;<span class="ident" id="6071694">io</span><span class="op" id="6071696">.</span><span class="ident" id="6071697">WriteString</span><span class="op" id="6071708">(</span><span class="ident" id="6071709">w</span><span class="op" id="6071710">.</span><span class="ident" id="6071711">cw</span><span class="op" id="6071713">,</span>&nbsp;<span class="ident" id="6071715">h</span><span class="op" id="6071716">.</span><span class="ident" id="6071717">Name</span><span class="op" id="6071721">)</span><span class="op" id="6071722">;</span>&nbsp;<span class="ident" id="6071724">err</span>&nbsp;<span class="op" id="6071728">!=</span>&nbsp;<span class="ident" id="6071731">nil</span>&nbsp;<span class="op" id="6071735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071740">return</span>&nbsp;<span class="ident" id="6071747">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071757">if</span>&nbsp;<span class="ident" id="6071760">_</span><span class="op" id="6071761">,</span>&nbsp;<span class="ident" id="6071763">err</span>&nbsp;<span class="op" id="6071767">:=</span>&nbsp;<span class="ident" id="6071770">w</span><span class="op" id="6071771">.</span><span class="ident" id="6071772">cw</span><span class="op" id="6071774">.</span><span class="ident" id="6071775">Write</span><span class="op" id="6071780">(</span><span class="ident" id="6071781">h</span><span class="op" id="6071782">.</span><span class="ident" id="6071783">Extra</span><span class="op" id="6071788">)</span><span class="op" id="6071789">;</span>&nbsp;<span class="ident" id="6071791">err</span>&nbsp;<span class="op" id="6071795">!=</span>&nbsp;<span class="ident" id="6071798">nil</span>&nbsp;<span class="op" id="6071802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071807">return</span>&nbsp;<span class="ident" id="6071814">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071824">if</span>&nbsp;<span class="ident" id="6071827">_</span><span class="op" id="6071828">,</span>&nbsp;<span class="ident" id="6071830">err</span>&nbsp;<span class="op" id="6071834">:=</span>&nbsp;<span class="ident" id="6071837">io</span><span class="op" id="6071839">.</span><span class="ident" id="6071840">WriteString</span><span class="op" id="6071851">(</span><span class="ident" id="6071852">w</span><span class="op" id="6071853">.</span><span class="ident" id="6071854">cw</span><span class="op" id="6071856">,</span>&nbsp;<span class="ident" id="6071858">h</span><span class="op" id="6071859">.</span><span class="ident" id="6071860">Comment</span><span class="op" id="6071867">)</span><span class="op" id="6071868">;</span>&nbsp;<span class="ident" id="6071870">err</span>&nbsp;<span class="op" id="6071874">!=</span>&nbsp;<span class="ident" id="6071877">nil</span>&nbsp;<span class="op" id="6071881">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071886">return</span>&nbsp;<span class="ident" id="6071893">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071905">end</span>&nbsp;<span class="op" id="6071909">:=</span>&nbsp;<span class="ident" id="6071912">w</span><span class="op" id="6071913">.</span><span class="ident" id="6071914">cw</span><span class="op" id="6071916">.</span><span class="ident" id="6071917">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071925">records</span>&nbsp;<span class="op" id="6071933">:=</span>&nbsp;<span class="ident" id="6071936">uint64</span><span class="op" id="6071942">(</span><span class="builtinfunc" id="6071943">len</span><span class="op" id="6071946">(</span><span class="ident" id="6071947">w</span><span class="op" id="6071948">.</span><span class="ident" id="6071949">dir</span><span class="op" id="6071952">)</span><span class="op" id="6071953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071956">size</span>&nbsp;<span class="op" id="6071961">:=</span>&nbsp;<span class="ident" id="6071964">uint64</span><span class="op" id="6071970">(</span><span class="ident" id="6071971">end</span>&nbsp;<span class="op" id="6071975">-</span>&nbsp;<span class="ident" id="6071977">start</span><span class="op" id="6071982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071985">offset</span>&nbsp;<span class="op" id="6071992">:=</span>&nbsp;<span class="ident" id="6071995">uint64</span><span class="op" id="6072001">(</span><span class="ident" id="6072002">start</span><span class="op" id="6072007">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072011">if</span>&nbsp;<span class="ident" id="6072014">records</span>&nbsp;<span class="op" id="6072022">&gt;</span>&nbsp;<span class="ident" id="6072024">uint16max</span>&nbsp;<span class="op" id="6072034">||</span>&nbsp;<span class="ident" id="6072037">size</span>&nbsp;<span class="op" id="6072042">&gt;</span>&nbsp;<span class="ident" id="6072044">uint32max</span>&nbsp;<span class="op" id="6072054">||</span>&nbsp;<span class="ident" id="6072057">offset</span>&nbsp;<span class="op" id="6072064">&gt;</span>&nbsp;<span class="ident" id="6072066">uint32max</span>&nbsp;<span class="op" id="6072076">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072080">var</span>&nbsp;<span class="ident" id="6072084">buf</span>&nbsp;<span class="op" id="6072088">[</span><span class="ident" id="6072089">directory64EndLen</span>&nbsp;<span class="op" id="6072107">+</span>&nbsp;<span class="ident" id="6072109">directory64LocLen</span><span class="op" id="6072126">]</span><span class="builtintype" id="6072127">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072134">b</span>&nbsp;<span class="op" id="6072136">:=</span>&nbsp;<span class="ident" id="6072139">writeBuf</span><span class="op" id="6072147">(</span><span class="ident" id="6072148">buf</span><span class="op" id="6072151">[</span><span class="op" id="6072152">:</span><span class="op" id="6072153">]</span><span class="op" id="6072154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072159">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072202">b</span><span class="op" id="6072203">.</span><span class="builtintype" id="6072204">uint32</span><span class="op" id="6072210">(</span><span class="ident" id="6072211">directory64EndSignature</span><span class="op" id="6072234">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072238">b</span><span class="op" id="6072239">.</span><span class="ident" id="6072240">uint64</span><span class="op" id="6072246">(</span><span class="ident" id="6072247">directory64EndLen</span><span class="op" id="6072264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072268">b</span><span class="op" id="6072269">.</span><span class="builtintype" id="6072270">uint16</span><span class="op" id="6072276">(</span><span class="ident" id="6072277">zipVersion45</span><span class="op" id="6072289">)</span>&nbsp;<span class="comment" id="6072291">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072312">b</span><span class="op" id="6072313">.</span><span class="builtintype" id="6072314">uint16</span><span class="op" id="6072320">(</span><span class="ident" id="6072321">zipVersion45</span><span class="op" id="6072333">)</span>&nbsp;<span class="comment" id="6072335">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072366">b</span><span class="op" id="6072367">.</span><span class="builtintype" id="6072368">uint32</span><span class="op" id="6072374">(</span><span class="num" id="6072375">0</span><span class="op" id="6072376">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072389">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072414">b</span><span class="op" id="6072415">.</span><span class="builtintype" id="6072416">uint32</span><span class="op" id="6072422">(</span><span class="num" id="6072423">0</span><span class="op" id="6072424">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072437">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072501">b</span><span class="op" id="6072502">.</span><span class="ident" id="6072503">uint64</span><span class="op" id="6072509">(</span><span class="ident" id="6072510">records</span><span class="op" id="6072517">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072524">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072591">b</span><span class="op" id="6072592">.</span><span class="ident" id="6072593">uint64</span><span class="op" id="6072599">(</span><span class="ident" id="6072600">records</span><span class="op" id="6072607">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072614">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072668">b</span><span class="op" id="6072669">.</span><span class="ident" id="6072670">uint64</span><span class="op" id="6072676">(</span><span class="ident" id="6072677">size</span><span class="op" id="6072681">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072691">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072726">b</span><span class="op" id="6072727">.</span><span class="ident" id="6072728">uint64</span><span class="op" id="6072734">(</span><span class="ident" id="6072735">offset</span><span class="op" id="6072741">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072749">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072833">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072877">b</span><span class="op" id="6072878">.</span><span class="builtintype" id="6072879">uint32</span><span class="op" id="6072885">(</span><span class="ident" id="6072886">directory64LocSignature</span><span class="op" id="6072909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072913">b</span><span class="op" id="6072914">.</span><span class="builtintype" id="6072915">uint32</span><span class="op" id="6072921">(</span><span class="num" id="6072922">0</span><span class="op" id="6072923">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072935">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073012">b</span><span class="op" id="6073013">.</span><span class="ident" id="6073014">uint64</span><span class="op" id="6073020">(</span><span class="ident" id="6073021">uint64</span><span class="op" id="6073027">(</span><span class="ident" id="6073028">end</span><span class="op" id="6073031">)</span><span class="op" id="6073032">)</span>&nbsp;<span class="comment" id="6073034">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073100">b</span><span class="op" id="6073101">.</span><span class="builtintype" id="6073102">uint32</span><span class="op" id="6073108">(</span><span class="num" id="6073109">1</span><span class="op" id="6073110">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073122">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073150">if</span>&nbsp;<span class="ident" id="6073153">_</span><span class="op" id="6073154">,</span>&nbsp;<span class="ident" id="6073156">err</span>&nbsp;<span class="op" id="6073160">:=</span>&nbsp;<span class="ident" id="6073163">w</span><span class="op" id="6073164">.</span><span class="ident" id="6073165">cw</span><span class="op" id="6073167">.</span><span class="ident" id="6073168">Write</span><span class="op" id="6073173">(</span><span class="ident" id="6073174">buf</span><span class="op" id="6073177">[</span><span class="op" id="6073178">:</span><span class="op" id="6073179">]</span><span class="op" id="6073180">)</span><span class="op" id="6073181">;</span>&nbsp;<span class="ident" id="6073183">err</span>&nbsp;<span class="op" id="6073187">!=</span>&nbsp;<span class="ident" id="6073190">nil</span>&nbsp;<span class="op" id="6073194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073199">return</span>&nbsp;<span class="ident" id="6073206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073217">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073280">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073330">records</span>&nbsp;<span class="op" id="6073338">=</span>&nbsp;<span class="ident" id="6073340">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073352">size</span>&nbsp;<span class="op" id="6073357">=</span>&nbsp;<span class="ident" id="6073359">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073371">offset</span>&nbsp;<span class="op" id="6073378">=</span>&nbsp;<span class="ident" id="6073380">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073395">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073416">var</span>&nbsp;<span class="ident" id="6073420">buf</span>&nbsp;<span class="op" id="6073424">[</span><span class="ident" id="6073425">directoryEndLen</span><span class="op" id="6073440">]</span><span class="builtintype" id="6073441">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073447">b</span>&nbsp;<span class="op" id="6073449">:=</span>&nbsp;<span class="ident" id="6073452">writeBuf</span><span class="op" id="6073460">(</span><span class="ident" id="6073461">buf</span><span class="op" id="6073464">[</span><span class="op" id="6073465">:</span><span class="op" id="6073466">]</span><span class="op" id="6073467">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073470">b</span><span class="op" id="6073471">.</span><span class="builtintype" id="6073472">uint32</span><span class="op" id="6073478">(</span><span class="builtintype" id="6073479">uint32</span><span class="op" id="6073485">(</span><span class="ident" id="6073486">directoryEndSignature</span><span class="op" id="6073507">)</span><span class="op" id="6073508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073511">b</span>&nbsp;<span class="op" id="6073513">=</span>&nbsp;<span class="ident" id="6073515">b</span><span class="op" id="6073516">[</span><span class="num" id="6073517">4</span><span class="op" id="6073518">:</span><span class="op" id="6073519">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073537">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073597">b</span><span class="op" id="6073598">.</span><span class="builtintype" id="6073599">uint16</span><span class="op" id="6073605">(</span><span class="builtintype" id="6073606">uint16</span><span class="op" id="6073612">(</span><span class="ident" id="6073613">records</span><span class="op" id="6073620">)</span><span class="op" id="6073621">)</span>&nbsp;<span class="comment" id="6073623">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073655">b</span><span class="op" id="6073656">.</span><span class="builtintype" id="6073657">uint16</span><span class="op" id="6073663">(</span><span class="builtintype" id="6073664">uint16</span><span class="op" id="6073670">(</span><span class="ident" id="6073671">records</span><span class="op" id="6073678">)</span><span class="op" id="6073679">)</span>&nbsp;<span class="comment" id="6073681">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073709">b</span><span class="op" id="6073710">.</span><span class="builtintype" id="6073711">uint32</span><span class="op" id="6073717">(</span><span class="builtintype" id="6073718">uint32</span><span class="op" id="6073724">(</span><span class="ident" id="6073725">size</span><span class="op" id="6073729">)</span><span class="op" id="6073730">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073735">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073757">b</span><span class="op" id="6073758">.</span><span class="builtintype" id="6073759">uint32</span><span class="op" id="6073765">(</span><span class="builtintype" id="6073766">uint32</span><span class="op" id="6073772">(</span><span class="ident" id="6073773">offset</span><span class="op" id="6073779">)</span><span class="op" id="6073780">)</span>&nbsp;&nbsp;<span class="comment" id="6073783">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073806">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073848">if</span>&nbsp;<span class="ident" id="6073851">_</span><span class="op" id="6073852">,</span>&nbsp;<span class="ident" id="6073854">err</span>&nbsp;<span class="op" id="6073858">:=</span>&nbsp;<span class="ident" id="6073861">w</span><span class="op" id="6073862">.</span><span class="ident" id="6073863">cw</span><span class="op" id="6073865">.</span><span class="ident" id="6073866">Write</span><span class="op" id="6073871">(</span><span class="ident" id="6073872">buf</span><span class="op" id="6073875">[</span><span class="op" id="6073876">:</span><span class="op" id="6073877">]</span><span class="op" id="6073878">)</span><span class="op" id="6073879">;</span>&nbsp;<span class="ident" id="6073881">err</span>&nbsp;<span class="op" id="6073885">!=</span>&nbsp;<span class="ident" id="6073888">nil</span>&nbsp;<span class="op" id="6073892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073896">return</span>&nbsp;<span class="ident" id="6073903">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073908">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073912">return</span>&nbsp;<span class="ident" id="6073919">w</span><span class="op" id="6073920">.</span><span class="ident" id="6073921">cw</span><span class="op" id="6073923">.</span><span class="ident" id="6073924">w</span><span class="op" id="6073925">.</span><span class="op" id="6073926">(</span><span class="op" id="6073927">*</span><span class="ident" id="6073928">bufio</span><span class="op" id="6073933">.</span><span class="ident" id="6073934">Writer</span><span class="op" id="6073940">)</span><span class="op" id="6073941">.</span><span class="ident" id="6073942">Flush</span><span class="op" id="6073947">(</span><span class="op" id="6073948">)</span><br>
<span class="lineno"></span><span class="op" id="6073950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073953">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="6074016">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6074085">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="6074153">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6074220">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="6074232">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="6074304">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6074347">func</span>&nbsp;<span class="op" id="6074352">(</span><span class="ident" id="6074353">w</span>&nbsp;<span class="op" id="6074355">*</span><span class="ident" id="6074356">Writer</span><span class="op" id="6074362">)</span>&nbsp;<span class="ident" id="6074364">Create</span><span class="op" id="6074370">(</span><span class="ident" id="6074371">name</span>&nbsp;<span class="builtintype" id="6074376">string</span><span class="op" id="6074382">)</span>&nbsp;<span class="op" id="6074384">(</span><span class="ident" id="6074385">io</span><span class="op" id="6074387">.</span><span class="ident" id="6074388">Writer</span><span class="op" id="6074394">,</span>&nbsp;<span class="builtintype" id="6074396">error</span><span class="op" id="6074401">)</span>&nbsp;<span class="op" id="6074403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074406">header</span>&nbsp;<span class="op" id="6074413">:=</span>&nbsp;<span class="op" id="6074416">&amp;</span><span class="ident" id="6074417">FileHeader</span><span class="op" id="6074427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074431">Name</span><span class="op" id="6074435">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6074439">name</span><span class="op" id="6074443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074447">Method</span><span class="op" id="6074453">:</span>&nbsp;<span class="ident" id="6074455">Deflate</span><span class="op" id="6074462">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074468">return</span>&nbsp;<span class="ident" id="6074475">w</span><span class="op" id="6074476">.</span><span class="ident" id="6074477">CreateHeader</span><span class="op" id="6074489">(</span><span class="ident" id="6074490">header</span><span class="op" id="6074496">)</span><br>
<span class="lineno"></span><span class="op" id="6074498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6074501">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="6074575">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="6074601">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6074670">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6074742">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6074785">func</span>&nbsp;<span class="op" id="6074790">(</span><span class="ident" id="6074791">w</span>&nbsp;<span class="op" id="6074793">*</span><span class="ident" id="6074794">Writer</span><span class="op" id="6074800">)</span>&nbsp;<span class="ident" id="6074802">CreateHeader</span><span class="op" id="6074814">(</span><span class="ident" id="6074815">fh</span>&nbsp;<span class="op" id="6074818">*</span><span class="ident" id="6074819">FileHeader</span><span class="op" id="6074829">)</span>&nbsp;<span class="op" id="6074831">(</span><span class="ident" id="6074832">io</span><span class="op" id="6074834">.</span><span class="ident" id="6074835">Writer</span><span class="op" id="6074841">,</span>&nbsp;<span class="builtintype" id="6074843">error</span><span class="op" id="6074848">)</span>&nbsp;<span class="op" id="6074850">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074853">if</span>&nbsp;<span class="ident" id="6074856">w</span><span class="op" id="6074857">.</span><span class="ident" id="6074858">last</span>&nbsp;<span class="op" id="6074863">!=</span>&nbsp;<span class="ident" id="6074866">nil</span>&nbsp;<span class="op" id="6074870">&amp;&amp;</span>&nbsp;<span class="op" id="6074873">!</span><span class="ident" id="6074874">w</span><span class="op" id="6074875">.</span><span class="ident" id="6074876">last</span><span class="op" id="6074880">.</span><span class="ident" id="6074881">closed</span>&nbsp;<span class="op" id="6074888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074892">if</span>&nbsp;<span class="ident" id="6074895">err</span>&nbsp;<span class="op" id="6074899">:=</span>&nbsp;<span class="ident" id="6074902">w</span><span class="op" id="6074903">.</span><span class="ident" id="6074904">last</span><span class="op" id="6074908">.</span><span class="builtinfunc" id="6074909">close</span><span class="op" id="6074914">(</span><span class="op" id="6074915">)</span><span class="op" id="6074916">;</span>&nbsp;<span class="ident" id="6074918">err</span>&nbsp;<span class="op" id="6074922">!=</span>&nbsp;<span class="ident" id="6074925">nil</span>&nbsp;<span class="op" id="6074929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074934">return</span>&nbsp;<span class="ident" id="6074941">nil</span><span class="op" id="6074944">,</span>&nbsp;<span class="ident" id="6074946">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074955">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074959">fh</span><span class="op" id="6074961">.</span><span class="ident" id="6074962">Flags</span>&nbsp;<span class="op" id="6074968">|=</span>&nbsp;<span class="num" id="6074971">0x8</span>&nbsp;<span class="comment" id="6074975">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075012">fh</span><span class="op" id="6075014">.</span><span class="ident" id="6075015">CreatorVersion</span>&nbsp;<span class="op" id="6075030">=</span>&nbsp;<span class="ident" id="6075032">fh</span><span class="op" id="6075034">.</span><span class="ident" id="6075035">CreatorVersion</span><span class="op" id="6075049">&amp;</span><span class="num" id="6075050">0xff00</span>&nbsp;<span class="op" id="6075057">|</span>&nbsp;<span class="ident" id="6075059">zipVersion20</span>&nbsp;<span class="comment" id="6075072">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075104">fh</span><span class="op" id="6075106">.</span><span class="ident" id="6075107">ReaderVersion</span>&nbsp;<span class="op" id="6075121">=</span>&nbsp;<span class="ident" id="6075123">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075138">fw</span>&nbsp;<span class="op" id="6075141">:=</span>&nbsp;<span class="op" id="6075144">&amp;</span><span class="ident" id="6075145">fileWriter</span><span class="op" id="6075155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075159">zipw</span><span class="op" id="6075163">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075170">w</span><span class="op" id="6075171">.</span><span class="ident" id="6075172">cw</span><span class="op" id="6075174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075178">compCount</span><span class="op" id="6075187">:</span>&nbsp;<span class="op" id="6075189">&amp;</span><span class="ident" id="6075190">countWriter</span><span class="op" id="6075201">{</span><span class="ident" id="6075202">w</span><span class="op" id="6075203">:</span>&nbsp;<span class="ident" id="6075205">w</span><span class="op" id="6075206">.</span><span class="ident" id="6075207">cw</span><span class="op" id="6075209">}</span><span class="op" id="6075210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075214">crc32</span><span class="op" id="6075219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075225">crc32</span><span class="op" id="6075230">.</span><span class="ident" id="6075231">NewIEEE</span><span class="op" id="6075238">(</span><span class="op" id="6075239">)</span><span class="op" id="6075240">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075246">comp</span>&nbsp;<span class="op" id="6075251">:=</span>&nbsp;<span class="ident" id="6075254">compressor</span><span class="op" id="6075264">(</span><span class="ident" id="6075265">fh</span><span class="op" id="6075267">.</span><span class="ident" id="6075268">Method</span><span class="op" id="6075274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075277">if</span>&nbsp;<span class="ident" id="6075280">comp</span>&nbsp;<span class="op" id="6075285">==</span>&nbsp;<span class="ident" id="6075288">nil</span>&nbsp;<span class="op" id="6075292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075296">return</span>&nbsp;<span class="ident" id="6075303">nil</span><span class="op" id="6075306">,</span>&nbsp;<span class="ident" id="6075308">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075322">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075325">var</span>&nbsp;<span class="ident" id="6075329">err</span>&nbsp;<span class="builtintype" id="6075333">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075340">fw</span><span class="op" id="6075342">.</span><span class="ident" id="6075343">comp</span><span class="op" id="6075347">,</span>&nbsp;<span class="ident" id="6075349">err</span>&nbsp;<span class="op" id="6075353">=</span>&nbsp;<span class="ident" id="6075355">comp</span><span class="op" id="6075359">(</span><span class="ident" id="6075360">fw</span><span class="op" id="6075362">.</span><span class="ident" id="6075363">compCount</span><span class="op" id="6075372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075375">if</span>&nbsp;<span class="ident" id="6075378">err</span>&nbsp;<span class="op" id="6075382">!=</span>&nbsp;<span class="ident" id="6075385">nil</span>&nbsp;<span class="op" id="6075389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075393">return</span>&nbsp;<span class="ident" id="6075400">nil</span><span class="op" id="6075403">,</span>&nbsp;<span class="ident" id="6075405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075410">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075413">fw</span><span class="op" id="6075415">.</span><span class="ident" id="6075416">rawCount</span>&nbsp;<span class="op" id="6075425">=</span>&nbsp;<span class="op" id="6075427">&amp;</span><span class="ident" id="6075428">countWriter</span><span class="op" id="6075439">{</span><span class="ident" id="6075440">w</span><span class="op" id="6075441">:</span>&nbsp;<span class="ident" id="6075443">fw</span><span class="op" id="6075445">.</span><span class="ident" id="6075446">comp</span><span class="op" id="6075450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075454">h</span>&nbsp;<span class="op" id="6075456">:=</span>&nbsp;<span class="op" id="6075459">&amp;</span><span class="ident" id="6075460">header</span><span class="op" id="6075466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075470">FileHeader</span><span class="op" id="6075480">:</span>&nbsp;<span class="ident" id="6075482">fh</span><span class="op" id="6075484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075488">offset</span><span class="op" id="6075494">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075500">uint64</span><span class="op" id="6075506">(</span><span class="ident" id="6075507">w</span><span class="op" id="6075508">.</span><span class="ident" id="6075509">cw</span><span class="op" id="6075511">.</span><span class="ident" id="6075512">count</span><span class="op" id="6075517">)</span><span class="op" id="6075518">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075524">w</span><span class="op" id="6075525">.</span><span class="ident" id="6075526">dir</span>&nbsp;<span class="op" id="6075530">=</span>&nbsp;<span class="builtinfunc" id="6075532">append</span><span class="op" id="6075538">(</span><span class="ident" id="6075539">w</span><span class="op" id="6075540">.</span><span class="ident" id="6075541">dir</span><span class="op" id="6075544">,</span>&nbsp;<span class="ident" id="6075546">h</span><span class="op" id="6075547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075550">fw</span><span class="op" id="6075552">.</span><span class="ident" id="6075553">header</span>&nbsp;<span class="op" id="6075560">=</span>&nbsp;<span class="ident" id="6075562">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075566">if</span>&nbsp;<span class="ident" id="6075569">err</span>&nbsp;<span class="op" id="6075573">:=</span>&nbsp;<span class="ident" id="6075576">writeHeader</span><span class="op" id="6075587">(</span><span class="ident" id="6075588">w</span><span class="op" id="6075589">.</span><span class="ident" id="6075590">cw</span><span class="op" id="6075592">,</span>&nbsp;<span class="ident" id="6075594">fh</span><span class="op" id="6075596">)</span><span class="op" id="6075597">;</span>&nbsp;<span class="ident" id="6075599">err</span>&nbsp;<span class="op" id="6075603">!=</span>&nbsp;<span class="ident" id="6075606">nil</span>&nbsp;<span class="op" id="6075610">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075614">return</span>&nbsp;<span class="ident" id="6075621">nil</span><span class="op" id="6075624">,</span>&nbsp;<span class="ident" id="6075626">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075635">w</span><span class="op" id="6075636">.</span><span class="ident" id="6075637">last</span>&nbsp;<span class="op" id="6075642">=</span>&nbsp;<span class="ident" id="6075644">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075648">return</span>&nbsp;<span class="ident" id="6075655">fw</span><span class="op" id="6075657">,</span>&nbsp;<span class="ident" id="6075659">nil</span><br>
<span class="lineno">230</span><span class="op" id="6075663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6075666">func</span>&nbsp;<span class="ident" id="6075671">writeHeader</span><span class="op" id="6075682">(</span><span class="ident" id="6075683">w</span>&nbsp;<span class="ident" id="6075685">io</span><span class="op" id="6075687">.</span><span class="ident" id="6075688">Writer</span><span class="op" id="6075694">,</span>&nbsp;<span class="ident" id="6075696">h</span>&nbsp;<span class="op" id="6075698">*</span><span class="ident" id="6075699">FileHeader</span><span class="op" id="6075709">)</span>&nbsp;<span class="builtintype" id="6075711">error</span>&nbsp;<span class="op" id="6075717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075720">var</span>&nbsp;<span class="ident" id="6075724">buf</span>&nbsp;<span class="op" id="6075728">[</span><span class="ident" id="6075729">fileHeaderLen</span><span class="op" id="6075742">]</span><span class="builtintype" id="6075743">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075749">b</span>&nbsp;<span class="op" id="6075751">:=</span>&nbsp;<span class="ident" id="6075754">writeBuf</span><span class="op" id="6075762">(</span><span class="ident" id="6075763">buf</span><span class="op" id="6075766">[</span><span class="op" id="6075767">:</span><span class="op" id="6075768">]</span><span class="op" id="6075769">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075772">b</span><span class="op" id="6075773">.</span><span class="builtintype" id="6075774">uint32</span><span class="op" id="6075780">(</span><span class="builtintype" id="6075781">uint32</span><span class="op" id="6075787">(</span><span class="ident" id="6075788">fileHeaderSignature</span><span class="op" id="6075807">)</span><span class="op" id="6075808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075811">b</span><span class="op" id="6075812">.</span><span class="builtintype" id="6075813">uint16</span><span class="op" id="6075819">(</span><span class="ident" id="6075820">h</span><span class="op" id="6075821">.</span><span class="ident" id="6075822">ReaderVersion</span><span class="op" id="6075835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075838">b</span><span class="op" id="6075839">.</span><span class="builtintype" id="6075840">uint16</span><span class="op" id="6075846">(</span><span class="ident" id="6075847">h</span><span class="op" id="6075848">.</span><span class="ident" id="6075849">Flags</span><span class="op" id="6075854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075857">b</span><span class="op" id="6075858">.</span><span class="builtintype" id="6075859">uint16</span><span class="op" id="6075865">(</span><span class="ident" id="6075866">h</span><span class="op" id="6075867">.</span><span class="ident" id="6075868">Method</span><span class="op" id="6075874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075877">b</span><span class="op" id="6075878">.</span><span class="builtintype" id="6075879">uint16</span><span class="op" id="6075885">(</span><span class="ident" id="6075886">h</span><span class="op" id="6075887">.</span><span class="ident" id="6075888">ModifiedTime</span><span class="op" id="6075900">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075903">b</span><span class="op" id="6075904">.</span><span class="builtintype" id="6075905">uint16</span><span class="op" id="6075911">(</span><span class="ident" id="6075912">h</span><span class="op" id="6075913">.</span><span class="ident" id="6075914">ModifiedDate</span><span class="op" id="6075926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075929">b</span><span class="op" id="6075930">.</span><span class="builtintype" id="6075931">uint32</span><span class="op" id="6075937">(</span><span class="num" id="6075938">0</span><span class="op" id="6075939">)</span>&nbsp;<span class="comment" id="6075941">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075991">b</span><span class="op" id="6075992">.</span><span class="builtintype" id="6075993">uint32</span><span class="op" id="6075999">(</span><span class="num" id="6076000">0</span><span class="op" id="6076001">)</span>&nbsp;<span class="comment" id="6076003">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076024">b</span><span class="op" id="6076025">.</span><span class="builtintype" id="6076026">uint32</span><span class="op" id="6076032">(</span><span class="num" id="6076033">0</span><span class="op" id="6076034">)</span>&nbsp;<span class="comment" id="6076036">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076077">b</span><span class="op" id="6076078">.</span><span class="builtintype" id="6076079">uint16</span><span class="op" id="6076085">(</span><span class="builtintype" id="6076086">uint16</span><span class="op" id="6076092">(</span><span class="builtinfunc" id="6076093">len</span><span class="op" id="6076096">(</span><span class="ident" id="6076097">h</span><span class="op" id="6076098">.</span><span class="ident" id="6076099">Name</span><span class="op" id="6076103">)</span><span class="op" id="6076104">)</span><span class="op" id="6076105">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076108">b</span><span class="op" id="6076109">.</span><span class="builtintype" id="6076110">uint16</span><span class="op" id="6076116">(</span><span class="builtintype" id="6076117">uint16</span><span class="op" id="6076123">(</span><span class="builtinfunc" id="6076124">len</span><span class="op" id="6076127">(</span><span class="ident" id="6076128">h</span><span class="op" id="6076129">.</span><span class="ident" id="6076130">Extra</span><span class="op" id="6076135">)</span><span class="op" id="6076136">)</span><span class="op" id="6076137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076140">if</span>&nbsp;<span class="ident" id="6076143">_</span><span class="op" id="6076144">,</span>&nbsp;<span class="ident" id="6076146">err</span>&nbsp;<span class="op" id="6076150">:=</span>&nbsp;<span class="ident" id="6076153">w</span><span class="op" id="6076154">.</span><span class="ident" id="6076155">Write</span><span class="op" id="6076160">(</span><span class="ident" id="6076161">buf</span><span class="op" id="6076164">[</span><span class="op" id="6076165">:</span><span class="op" id="6076166">]</span><span class="op" id="6076167">)</span><span class="op" id="6076168">;</span>&nbsp;<span class="ident" id="6076170">err</span>&nbsp;<span class="op" id="6076174">!=</span>&nbsp;<span class="ident" id="6076177">nil</span>&nbsp;<span class="op" id="6076181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076185">return</span>&nbsp;<span class="ident" id="6076192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076200">if</span>&nbsp;<span class="ident" id="6076203">_</span><span class="op" id="6076204">,</span>&nbsp;<span class="ident" id="6076206">err</span>&nbsp;<span class="op" id="6076210">:=</span>&nbsp;<span class="ident" id="6076213">io</span><span class="op" id="6076215">.</span><span class="ident" id="6076216">WriteString</span><span class="op" id="6076227">(</span><span class="ident" id="6076228">w</span><span class="op" id="6076229">,</span>&nbsp;<span class="ident" id="6076231">h</span><span class="op" id="6076232">.</span><span class="ident" id="6076233">Name</span><span class="op" id="6076237">)</span><span class="op" id="6076238">;</span>&nbsp;<span class="ident" id="6076240">err</span>&nbsp;<span class="op" id="6076244">!=</span>&nbsp;<span class="ident" id="6076247">nil</span>&nbsp;<span class="op" id="6076251">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076255">return</span>&nbsp;<span class="ident" id="6076262">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076270">_</span><span class="op" id="6076271">,</span>&nbsp;<span class="ident" id="6076273">err</span>&nbsp;<span class="op" id="6076277">:=</span>&nbsp;<span class="ident" id="6076280">w</span><span class="op" id="6076281">.</span><span class="ident" id="6076282">Write</span><span class="op" id="6076287">(</span><span class="ident" id="6076288">h</span><span class="op" id="6076289">.</span><span class="ident" id="6076290">Extra</span><span class="op" id="6076295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076298">return</span>&nbsp;<span class="ident" id="6076305">err</span><br>
<span class="lineno"></span><span class="op" id="6076309">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6076312">type</span>&nbsp;<span class="ident" id="6076317">fileWriter</span>&nbsp;<span class="keyword" id="6076328">struct</span>&nbsp;<span class="op" id="6076335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076338">*</span><span class="ident" id="6076339">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076347">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076357">io</span><span class="op" id="6076359">.</span><span class="ident" id="6076360">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076368">rawCount</span>&nbsp;&nbsp;<span class="op" id="6076378">*</span><span class="ident" id="6076379">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076392">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076402">io</span><span class="op" id="6076404">.</span><span class="ident" id="6076405">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076418">compCount</span>&nbsp;<span class="op" id="6076428">*</span><span class="ident" id="6076429">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076442">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076452">hash</span><span class="op" id="6076456">.</span><span class="ident" id="6076457">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076465">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6076475">bool</span><br>
<span class="lineno"></span><span class="op" id="6076480">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="6076483">func</span>&nbsp;<span class="op" id="6076488">(</span><span class="ident" id="6076489">w</span>&nbsp;<span class="op" id="6076491">*</span><span class="ident" id="6076492">fileWriter</span><span class="op" id="6076502">)</span>&nbsp;<span class="ident" id="6076504">Write</span><span class="op" id="6076509">(</span><span class="ident" id="6076510">p</span>&nbsp;<span class="op" id="6076512">[</span><span class="op" id="6076513">]</span><span class="builtintype" id="6076514">byte</span><span class="op" id="6076518">)</span>&nbsp;<span class="op" id="6076520">(</span><span class="builtintype" id="6076521">int</span><span class="op" id="6076524">,</span>&nbsp;<span class="builtintype" id="6076526">error</span><span class="op" id="6076531">)</span>&nbsp;<span class="op" id="6076533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076536">if</span>&nbsp;<span class="ident" id="6076539">w</span><span class="op" id="6076540">.</span><span class="ident" id="6076541">closed</span>&nbsp;<span class="op" id="6076548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076552">return</span>&nbsp;<span class="num" id="6076559">0</span><span class="op" id="6076560">,</span>&nbsp;<span class="ident" id="6076562">errors</span><span class="op" id="6076568">.</span><span class="ident" id="6076569">New</span><span class="op" id="6076572">(</span><span class="string" id="6076573">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="6076600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076603">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076606">w</span><span class="op" id="6076607">.</span><span class="ident" id="6076608">crc32</span><span class="op" id="6076613">.</span><span class="ident" id="6076614">Write</span><span class="op" id="6076619">(</span><span class="ident" id="6076620">p</span><span class="op" id="6076621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076624">return</span>&nbsp;<span class="ident" id="6076631">w</span><span class="op" id="6076632">.</span><span class="ident" id="6076633">rawCount</span><span class="op" id="6076641">.</span><span class="ident" id="6076642">Write</span><span class="op" id="6076647">(</span><span class="ident" id="6076648">p</span><span class="op" id="6076649">)</span><br>
<span class="lineno"></span><span class="op" id="6076651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6076654">func</span>&nbsp;<span class="op" id="6076659">(</span><span class="ident" id="6076660">w</span>&nbsp;<span class="op" id="6076662">*</span><span class="ident" id="6076663">fileWriter</span><span class="op" id="6076673">)</span>&nbsp;<span class="builtinfunc" id="6076675">close</span><span class="op" id="6076680">(</span><span class="op" id="6076681">)</span>&nbsp;<span class="builtintype" id="6076683">error</span>&nbsp;<span class="op" id="6076689">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076692">if</span>&nbsp;<span class="ident" id="6076695">w</span><span class="op" id="6076696">.</span><span class="ident" id="6076697">closed</span>&nbsp;<span class="op" id="6076704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076708">return</span>&nbsp;<span class="ident" id="6076715">errors</span><span class="op" id="6076721">.</span><span class="ident" id="6076722">New</span><span class="op" id="6076725">(</span><span class="string" id="6076726">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6076750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076756">w</span><span class="op" id="6076757">.</span><span class="ident" id="6076758">closed</span>&nbsp;<span class="op" id="6076765">=</span>&nbsp;<span class="builtintype" id="6076767">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076773">if</span>&nbsp;<span class="ident" id="6076776">err</span>&nbsp;<span class="op" id="6076780">:=</span>&nbsp;<span class="ident" id="6076783">w</span><span class="op" id="6076784">.</span><span class="ident" id="6076785">comp</span><span class="op" id="6076789">.</span><span class="ident" id="6076790">Close</span><span class="op" id="6076795">(</span><span class="op" id="6076796">)</span><span class="op" id="6076797">;</span>&nbsp;<span class="ident" id="6076799">err</span>&nbsp;<span class="op" id="6076803">!=</span>&nbsp;<span class="ident" id="6076806">nil</span>&nbsp;<span class="op" id="6076810">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076814">return</span>&nbsp;<span class="ident" id="6076821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6076830">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076852">fh</span>&nbsp;<span class="op" id="6076855">:=</span>&nbsp;<span class="ident" id="6076858">w</span><span class="op" id="6076859">.</span><span class="ident" id="6076860">header</span><span class="op" id="6076866">.</span><span class="ident" id="6076867">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076879">fh</span><span class="op" id="6076881">.</span><span class="ident" id="6076882">CRC32</span>&nbsp;<span class="op" id="6076888">=</span>&nbsp;<span class="ident" id="6076890">w</span><span class="op" id="6076891">.</span><span class="ident" id="6076892">crc32</span><span class="op" id="6076897">.</span><span class="ident" id="6076898">Sum32</span><span class="op" id="6076903">(</span><span class="op" id="6076904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076907">fh</span><span class="op" id="6076909">.</span><span class="ident" id="6076910">CompressedSize64</span>&nbsp;<span class="op" id="6076927">=</span>&nbsp;<span class="ident" id="6076929">uint64</span><span class="op" id="6076935">(</span><span class="ident" id="6076936">w</span><span class="op" id="6076937">.</span><span class="ident" id="6076938">compCount</span><span class="op" id="6076947">.</span><span class="ident" id="6076948">count</span><span class="op" id="6076953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076956">fh</span><span class="op" id="6076958">.</span><span class="ident" id="6076959">UncompressedSize64</span>&nbsp;<span class="op" id="6076978">=</span>&nbsp;<span class="ident" id="6076980">uint64</span><span class="op" id="6076986">(</span><span class="ident" id="6076987">w</span><span class="op" id="6076988">.</span><span class="ident" id="6076989">rawCount</span><span class="op" id="6076997">.</span><span class="ident" id="6076998">count</span><span class="op" id="6077003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077007">if</span>&nbsp;<span class="ident" id="6077010">fh</span><span class="op" id="6077012">.</span><span class="ident" id="6077013">isZip64</span><span class="op" id="6077020">(</span><span class="op" id="6077021">)</span>&nbsp;<span class="op" id="6077023">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077027">fh</span><span class="op" id="6077029">.</span><span class="ident" id="6077030">CompressedSize</span>&nbsp;<span class="op" id="6077045">=</span>&nbsp;<span class="ident" id="6077047">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077059">fh</span><span class="op" id="6077061">.</span><span class="ident" id="6077062">UncompressedSize</span>&nbsp;<span class="op" id="6077079">=</span>&nbsp;<span class="ident" id="6077081">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077093">fh</span><span class="op" id="6077095">.</span><span class="ident" id="6077096">ReaderVersion</span>&nbsp;<span class="op" id="6077110">=</span>&nbsp;<span class="ident" id="6077112">zipVersion45</span>&nbsp;<span class="comment" id="6077125">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077178">}</span>&nbsp;<span class="keyword" id="6077180">else</span>&nbsp;<span class="op" id="6077185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077189">fh</span><span class="op" id="6077191">.</span><span class="ident" id="6077192">CompressedSize</span>&nbsp;<span class="op" id="6077207">=</span>&nbsp;<span class="builtintype" id="6077209">uint32</span><span class="op" id="6077215">(</span><span class="ident" id="6077216">fh</span><span class="op" id="6077218">.</span><span class="ident" id="6077219">CompressedSize64</span><span class="op" id="6077235">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077239">fh</span><span class="op" id="6077241">.</span><span class="ident" id="6077242">UncompressedSize</span>&nbsp;<span class="op" id="6077259">=</span>&nbsp;<span class="builtintype" id="6077261">uint32</span><span class="op" id="6077267">(</span><span class="ident" id="6077268">fh</span><span class="op" id="6077270">.</span><span class="ident" id="6077271">UncompressedSize64</span><span class="op" id="6077289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077296">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077363">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077423">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077487">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077552">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077616">var</span>&nbsp;<span class="ident" id="6077620">buf</span>&nbsp;<span class="op" id="6077624">[</span><span class="op" id="6077625">]</span><span class="builtintype" id="6077626">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077632">if</span>&nbsp;<span class="ident" id="6077635">fh</span><span class="op" id="6077637">.</span><span class="ident" id="6077638">isZip64</span><span class="op" id="6077645">(</span><span class="op" id="6077646">)</span>&nbsp;<span class="op" id="6077648">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077652">buf</span>&nbsp;<span class="op" id="6077656">=</span>&nbsp;<span class="builtinfunc" id="6077658">make</span><span class="op" id="6077662">(</span><span class="op" id="6077663">[</span><span class="op" id="6077664">]</span><span class="builtintype" id="6077665">byte</span><span class="op" id="6077669">,</span>&nbsp;<span class="ident" id="6077671">dataDescriptor64Len</span><span class="op" id="6077690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077693">}</span>&nbsp;<span class="keyword" id="6077695">else</span>&nbsp;<span class="op" id="6077700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077704">buf</span>&nbsp;<span class="op" id="6077708">=</span>&nbsp;<span class="builtinfunc" id="6077710">make</span><span class="op" id="6077714">(</span><span class="op" id="6077715">[</span><span class="op" id="6077716">]</span><span class="builtintype" id="6077717">byte</span><span class="op" id="6077721">,</span>&nbsp;<span class="ident" id="6077723">dataDescriptorLen</span><span class="op" id="6077740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077746">b</span>&nbsp;<span class="op" id="6077748">:=</span>&nbsp;<span class="ident" id="6077751">writeBuf</span><span class="op" id="6077759">(</span><span class="ident" id="6077760">buf</span><span class="op" id="6077763">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077766">b</span><span class="op" id="6077767">.</span><span class="builtintype" id="6077768">uint32</span><span class="op" id="6077774">(</span><span class="ident" id="6077775">dataDescriptorSignature</span><span class="op" id="6077798">)</span>&nbsp;<span class="comment" id="6077800">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077840">b</span><span class="op" id="6077841">.</span><span class="builtintype" id="6077842">uint32</span><span class="op" id="6077848">(</span><span class="ident" id="6077849">fh</span><span class="op" id="6077851">.</span><span class="ident" id="6077852">CRC32</span><span class="op" id="6077857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077860">if</span>&nbsp;<span class="ident" id="6077863">fh</span><span class="op" id="6077865">.</span><span class="ident" id="6077866">isZip64</span><span class="op" id="6077873">(</span><span class="op" id="6077874">)</span>&nbsp;<span class="op" id="6077876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077880">b</span><span class="op" id="6077881">.</span><span class="ident" id="6077882">uint64</span><span class="op" id="6077888">(</span><span class="ident" id="6077889">fh</span><span class="op" id="6077891">.</span><span class="ident" id="6077892">CompressedSize64</span><span class="op" id="6077908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077912">b</span><span class="op" id="6077913">.</span><span class="ident" id="6077914">uint64</span><span class="op" id="6077920">(</span><span class="ident" id="6077921">fh</span><span class="op" id="6077923">.</span><span class="ident" id="6077924">UncompressedSize64</span><span class="op" id="6077942">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077945">}</span>&nbsp;<span class="keyword" id="6077947">else</span>&nbsp;<span class="op" id="6077952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077956">b</span><span class="op" id="6077957">.</span><span class="builtintype" id="6077958">uint32</span><span class="op" id="6077964">(</span><span class="ident" id="6077965">fh</span><span class="op" id="6077967">.</span><span class="ident" id="6077968">CompressedSize</span><span class="op" id="6077982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077986">b</span><span class="op" id="6077987">.</span><span class="builtintype" id="6077988">uint32</span><span class="op" id="6077994">(</span><span class="ident" id="6077995">fh</span><span class="op" id="6077997">.</span><span class="ident" id="6077998">UncompressedSize</span><span class="op" id="6078014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078020">_</span><span class="op" id="6078021">,</span>&nbsp;<span class="ident" id="6078023">err</span>&nbsp;<span class="op" id="6078027">:=</span>&nbsp;<span class="ident" id="6078030">w</span><span class="op" id="6078031">.</span><span class="ident" id="6078032">zipw</span><span class="op" id="6078036">.</span><span class="ident" id="6078037">Write</span><span class="op" id="6078042">(</span><span class="ident" id="6078043">buf</span><span class="op" id="6078046">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078049">return</span>&nbsp;<span class="ident" id="6078056">err</span><br>
<span class="lineno"></span><span class="op" id="6078060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078063">type</span>&nbsp;<span class="ident" id="6078068">countWriter</span>&nbsp;<span class="keyword" id="6078080">struct</span>&nbsp;<span class="op" id="6078087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078090">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078096">io</span><span class="op" id="6078098">.</span><span class="ident" id="6078099">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078107">count</span>&nbsp;<span class="ident" id="6078113">int64</span><br>
<span class="lineno"></span><span class="op" id="6078119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078122">func</span>&nbsp;<span class="op" id="6078127">(</span><span class="ident" id="6078128">w</span>&nbsp;<span class="op" id="6078130">*</span><span class="ident" id="6078131">countWriter</span><span class="op" id="6078142">)</span>&nbsp;<span class="ident" id="6078144">Write</span><span class="op" id="6078149">(</span><span class="ident" id="6078150">p</span>&nbsp;<span class="op" id="6078152">[</span><span class="op" id="6078153">]</span><span class="builtintype" id="6078154">byte</span><span class="op" id="6078158">)</span>&nbsp;<span class="op" id="6078160">(</span><span class="builtintype" id="6078161">int</span><span class="op" id="6078164">,</span>&nbsp;<span class="builtintype" id="6078166">error</span><span class="op" id="6078171">)</span>&nbsp;<span class="op" id="6078173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078176">n</span><span class="op" id="6078177">,</span>&nbsp;<span class="ident" id="6078179">err</span>&nbsp;<span class="op" id="6078183">:=</span>&nbsp;<span class="ident" id="6078186">w</span><span class="op" id="6078187">.</span><span class="ident" id="6078188">w</span><span class="op" id="6078189">.</span><span class="ident" id="6078190">Write</span><span class="op" id="6078195">(</span><span class="ident" id="6078196">p</span><span class="op" id="6078197">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078200">w</span><span class="op" id="6078201">.</span><span class="ident" id="6078202">count</span>&nbsp;<span class="op" id="6078208">+=</span>&nbsp;<span class="ident" id="6078211">int64</span><span class="op" id="6078216">(</span><span class="ident" id="6078217">n</span><span class="op" id="6078218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078221">return</span>&nbsp;<span class="ident" id="6078228">n</span><span class="op" id="6078229">,</span>&nbsp;<span class="ident" id="6078231">err</span><br>
<span class="lineno"></span><span class="op" id="6078235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078238">type</span>&nbsp;<span class="ident" id="6078243">nopCloser</span>&nbsp;<span class="keyword" id="6078253">struct</span>&nbsp;<span class="op" id="6078260">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078263">io</span><span class="op" id="6078265">.</span><span class="ident" id="6078266">Writer</span><br>
<span class="lineno"></span><span class="op" id="6078273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078276">func</span>&nbsp;<span class="op" id="6078281">(</span><span class="ident" id="6078282">w</span>&nbsp;<span class="ident" id="6078284">nopCloser</span><span class="op" id="6078293">)</span>&nbsp;<span class="ident" id="6078295">Close</span><span class="op" id="6078300">(</span><span class="op" id="6078301">)</span>&nbsp;<span class="builtintype" id="6078303">error</span>&nbsp;<span class="op" id="6078309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078312">return</span>&nbsp;<span class="ident" id="6078319">nil</span><br>
<span class="lineno">340</span><span class="op" id="6078323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078326">type</span>&nbsp;<span class="ident" id="6078331">writeBuf</span>&nbsp;<span class="op" id="6078340">[</span><span class="op" id="6078341">]</span><span class="builtintype" id="6078342">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078348">func</span>&nbsp;<span class="op" id="6078353">(</span><span class="ident" id="6078354">b</span>&nbsp;<span class="op" id="6078356">*</span><span class="ident" id="6078357">writeBuf</span><span class="op" id="6078365">)</span>&nbsp;<span class="builtintype" id="6078367">uint16</span><span class="op" id="6078373">(</span><span class="ident" id="6078374">v</span>&nbsp;<span class="builtintype" id="6078376">uint16</span><span class="op" id="6078382">)</span>&nbsp;<span class="op" id="6078384">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078387">binary</span><span class="op" id="6078393">.</span><span class="ident" id="6078394">LittleEndian</span><span class="op" id="6078406">.</span><span class="ident" id="6078407">PutUint16</span><span class="op" id="6078416">(</span><span class="op" id="6078417">*</span><span class="ident" id="6078418">b</span><span class="op" id="6078419">,</span>&nbsp;<span class="ident" id="6078421">v</span><span class="op" id="6078422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078425">*</span><span class="ident" id="6078426">b</span>&nbsp;<span class="op" id="6078428">=</span>&nbsp;<span class="op" id="6078430">(</span><span class="op" id="6078431">*</span><span class="ident" id="6078432">b</span><span class="op" id="6078433">)</span><span class="op" id="6078434">[</span><span class="num" id="6078435">2</span><span class="op" id="6078436">:</span><span class="op" id="6078437">]</span><br>
<span class="lineno"></span><span class="op" id="6078439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078442">func</span>&nbsp;<span class="op" id="6078447">(</span><span class="ident" id="6078448">b</span>&nbsp;<span class="op" id="6078450">*</span><span class="ident" id="6078451">writeBuf</span><span class="op" id="6078459">)</span>&nbsp;<span class="builtintype" id="6078461">uint32</span><span class="op" id="6078467">(</span><span class="ident" id="6078468">v</span>&nbsp;<span class="builtintype" id="6078470">uint32</span><span class="op" id="6078476">)</span>&nbsp;<span class="op" id="6078478">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078481">binary</span><span class="op" id="6078487">.</span><span class="ident" id="6078488">LittleEndian</span><span class="op" id="6078500">.</span><span class="ident" id="6078501">PutUint32</span><span class="op" id="6078510">(</span><span class="op" id="6078511">*</span><span class="ident" id="6078512">b</span><span class="op" id="6078513">,</span>&nbsp;<span class="ident" id="6078515">v</span><span class="op" id="6078516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078519">*</span><span class="ident" id="6078520">b</span>&nbsp;<span class="op" id="6078522">=</span>&nbsp;<span class="op" id="6078524">(</span><span class="op" id="6078525">*</span><span class="ident" id="6078526">b</span><span class="op" id="6078527">)</span><span class="op" id="6078528">[</span><span class="num" id="6078529">4</span><span class="op" id="6078530">:</span><span class="op" id="6078531">]</span><br>
<span class="lineno"></span><span class="op" id="6078533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078536">func</span>&nbsp;<span class="op" id="6078541">(</span><span class="ident" id="6078542">b</span>&nbsp;<span class="op" id="6078544">*</span><span class="ident" id="6078545">writeBuf</span><span class="op" id="6078553">)</span>&nbsp;<span class="ident" id="6078555">uint64</span><span class="op" id="6078561">(</span><span class="ident" id="6078562">v</span>&nbsp;<span class="ident" id="6078564">uint64</span><span class="op" id="6078570">)</span>&nbsp;<span class="op" id="6078572">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078575">binary</span><span class="op" id="6078581">.</span><span class="ident" id="6078582">LittleEndian</span><span class="op" id="6078594">.</span><span class="ident" id="6078595">PutUint64</span><span class="op" id="6078604">(</span><span class="op" id="6078605">*</span><span class="ident" id="6078606">b</span><span class="op" id="6078607">,</span>&nbsp;<span class="ident" id="6078609">v</span><span class="op" id="6078610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078613">*</span><span class="ident" id="6078614">b</span>&nbsp;<span class="op" id="6078616">=</span>&nbsp;<span class="op" id="6078618">(</span><span class="op" id="6078619">*</span><span class="ident" id="6078620">b</span><span class="op" id="6078621">)</span><span class="op" id="6078622">[</span><span class="num" id="6078623">8</span><span class="op" id="6078624">:</span><span class="op" id="6078625">]</span><br>
<span class="lineno"></span><span class="op" id="6078627">}</span>
</div>
</body>
</html>
