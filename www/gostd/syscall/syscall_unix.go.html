<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2574624">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2574679">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2574733">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2574784">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2574849">package</span>&nbsp;<span class="ident" id="2574857">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2574866">import</span>&nbsp;<span class="op" id="2574873">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2574876">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2574887">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2574895">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2574904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2574907">var</span>&nbsp;<span class="op" id="2574911">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2574914">Stdin</span>&nbsp;&nbsp;<span class="op" id="2574921">=</span>&nbsp;<span class="num" id="2574923">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2574926">Stdout</span>&nbsp;<span class="op" id="2574933">=</span>&nbsp;<span class="num" id="2574935">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2574938">Stderr</span>&nbsp;<span class="op" id="2574945">=</span>&nbsp;<span class="num" id="2574947">2</span><br>
<span class="lineno"></span><span class="op" id="2574949">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2574952">const</span>&nbsp;<span class="op" id="2574958">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2574961">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2574976">=</span>&nbsp;<span class="ident" id="2574978">runtime</span><span class="op" id="2574985">.</span><span class="ident" id="2574986">GOOS</span>&nbsp;<span class="op" id="2574991">==</span>&nbsp;<span class="string" id="2574994">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2575003">&amp;&amp;</span>&nbsp;<span class="ident" id="2575006">sizeofPtr</span>&nbsp;<span class="op" id="2575016">==</span>&nbsp;<span class="num" id="2575019">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575022">dragonfly64Bit</span>&nbsp;<span class="op" id="2575037">=</span>&nbsp;<span class="ident" id="2575039">runtime</span><span class="op" id="2575046">.</span><span class="ident" id="2575047">GOOS</span>&nbsp;<span class="op" id="2575052">==</span>&nbsp;<span class="string" id="2575055">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2575067">&amp;&amp;</span>&nbsp;<span class="ident" id="2575070">sizeofPtr</span>&nbsp;<span class="op" id="2575080">==</span>&nbsp;<span class="num" id="2575083">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575086">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2575101">=</span>&nbsp;<span class="ident" id="2575103">runtime</span><span class="op" id="2575110">.</span><span class="ident" id="2575111">GOOS</span>&nbsp;<span class="op" id="2575116">==</span>&nbsp;<span class="string" id="2575119">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2575128">&amp;&amp;</span>&nbsp;<span class="ident" id="2575131">sizeofPtr</span>&nbsp;<span class="op" id="2575141">==</span>&nbsp;<span class="num" id="2575144">4</span><br>
<span class="lineno">25</span><span class="op" id="2575146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2575149">func</span>&nbsp;<span class="ident" id="2575154">Syscall</span><span class="op" id="2575161">(</span><span class="ident" id="2575162">trap</span><span class="op" id="2575166">,</span>&nbsp;<span class="ident" id="2575168">a1</span><span class="op" id="2575170">,</span>&nbsp;<span class="ident" id="2575172">a2</span><span class="op" id="2575174">,</span>&nbsp;<span class="ident" id="2575176">a3</span>&nbsp;<span class="builtintype" id="2575179">uintptr</span><span class="op" id="2575186">)</span>&nbsp;<span class="op" id="2575188">(</span><span class="ident" id="2575189">r1</span><span class="op" id="2575191">,</span>&nbsp;<span class="ident" id="2575193">r2</span>&nbsp;<span class="builtintype" id="2575196">uintptr</span><span class="op" id="2575203">,</span>&nbsp;<span class="ident" id="2575205">err</span>&nbsp;<span class="ident" id="2575209">Errno</span><span class="op" id="2575214">)</span><br>
<span class="lineno"></span><span class="keyword" id="2575216">func</span>&nbsp;<span class="ident" id="2575221">Syscall6</span><span class="op" id="2575229">(</span><span class="ident" id="2575230">trap</span><span class="op" id="2575234">,</span>&nbsp;<span class="ident" id="2575236">a1</span><span class="op" id="2575238">,</span>&nbsp;<span class="ident" id="2575240">a2</span><span class="op" id="2575242">,</span>&nbsp;<span class="ident" id="2575244">a3</span><span class="op" id="2575246">,</span>&nbsp;<span class="ident" id="2575248">a4</span><span class="op" id="2575250">,</span>&nbsp;<span class="ident" id="2575252">a5</span><span class="op" id="2575254">,</span>&nbsp;<span class="ident" id="2575256">a6</span>&nbsp;<span class="builtintype" id="2575259">uintptr</span><span class="op" id="2575266">)</span>&nbsp;<span class="op" id="2575268">(</span><span class="ident" id="2575269">r1</span><span class="op" id="2575271">,</span>&nbsp;<span class="ident" id="2575273">r2</span>&nbsp;<span class="builtintype" id="2575276">uintptr</span><span class="op" id="2575283">,</span>&nbsp;<span class="ident" id="2575285">err</span>&nbsp;<span class="ident" id="2575289">Errno</span><span class="op" id="2575294">)</span><br>
<span class="lineno"></span><span class="keyword" id="2575296">func</span>&nbsp;<span class="ident" id="2575301">RawSyscall</span><span class="op" id="2575311">(</span><span class="ident" id="2575312">trap</span><span class="op" id="2575316">,</span>&nbsp;<span class="ident" id="2575318">a1</span><span class="op" id="2575320">,</span>&nbsp;<span class="ident" id="2575322">a2</span><span class="op" id="2575324">,</span>&nbsp;<span class="ident" id="2575326">a3</span>&nbsp;<span class="builtintype" id="2575329">uintptr</span><span class="op" id="2575336">)</span>&nbsp;<span class="op" id="2575338">(</span><span class="ident" id="2575339">r1</span><span class="op" id="2575341">,</span>&nbsp;<span class="ident" id="2575343">r2</span>&nbsp;<span class="builtintype" id="2575346">uintptr</span><span class="op" id="2575353">,</span>&nbsp;<span class="ident" id="2575355">err</span>&nbsp;<span class="ident" id="2575359">Errno</span><span class="op" id="2575364">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2575366">func</span>&nbsp;<span class="ident" id="2575371">RawSyscall6</span><span class="op" id="2575382">(</span><span class="ident" id="2575383">trap</span><span class="op" id="2575387">,</span>&nbsp;<span class="ident" id="2575389">a1</span><span class="op" id="2575391">,</span>&nbsp;<span class="ident" id="2575393">a2</span><span class="op" id="2575395">,</span>&nbsp;<span class="ident" id="2575397">a3</span><span class="op" id="2575399">,</span>&nbsp;<span class="ident" id="2575401">a4</span><span class="op" id="2575403">,</span>&nbsp;<span class="ident" id="2575405">a5</span><span class="op" id="2575407">,</span>&nbsp;<span class="ident" id="2575409">a6</span>&nbsp;<span class="builtintype" id="2575412">uintptr</span><span class="op" id="2575419">)</span>&nbsp;<span class="op" id="2575421">(</span><span class="ident" id="2575422">r1</span><span class="op" id="2575424">,</span>&nbsp;<span class="ident" id="2575426">r2</span>&nbsp;<span class="builtintype" id="2575429">uintptr</span><span class="op" id="2575436">,</span>&nbsp;<span class="ident" id="2575438">err</span>&nbsp;<span class="ident" id="2575442">Errno</span><span class="op" id="2575447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2575450">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2575522">type</span>&nbsp;<span class="ident" id="2575527">mmapper</span>&nbsp;<span class="keyword" id="2575535">struct</span>&nbsp;<span class="op" id="2575542">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575545">sync</span><span class="op" id="2575549">.</span><span class="ident" id="2575550">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575557">active</span>&nbsp;<span class="keyword" id="2575564">map</span><span class="op" id="2575567">[</span><span class="op" id="2575568">*</span><span class="builtintype" id="2575569">byte</span><span class="op" id="2575573">]</span><span class="op" id="2575574">[</span><span class="op" id="2575575">]</span><span class="builtintype" id="2575576">byte</span>&nbsp;<span class="comment" id="2575581">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575630">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2575637">func</span><span class="op" id="2575641">(</span><span class="ident" id="2575642">addr</span><span class="op" id="2575646">,</span>&nbsp;<span class="ident" id="2575648">length</span>&nbsp;<span class="builtintype" id="2575655">uintptr</span><span class="op" id="2575662">,</span>&nbsp;<span class="ident" id="2575664">prot</span><span class="op" id="2575668">,</span>&nbsp;<span class="ident" id="2575670">flags</span><span class="op" id="2575675">,</span>&nbsp;<span class="ident" id="2575677">fd</span>&nbsp;<span class="builtintype" id="2575680">int</span><span class="op" id="2575683">,</span>&nbsp;<span class="ident" id="2575685">offset</span>&nbsp;<span class="ident" id="2575692">int64</span><span class="op" id="2575697">)</span>&nbsp;<span class="op" id="2575699">(</span><span class="builtintype" id="2575700">uintptr</span><span class="op" id="2575707">,</span>&nbsp;<span class="builtintype" id="2575709">error</span><span class="op" id="2575714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575717">munmap</span>&nbsp;<span class="keyword" id="2575724">func</span><span class="op" id="2575728">(</span><span class="ident" id="2575729">addr</span>&nbsp;<span class="builtintype" id="2575734">uintptr</span><span class="op" id="2575741">,</span>&nbsp;<span class="ident" id="2575743">length</span>&nbsp;<span class="builtintype" id="2575750">uintptr</span><span class="op" id="2575757">)</span>&nbsp;<span class="builtintype" id="2575759">error</span><br>
<span class="lineno"></span><span class="op" id="2575765">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2575768">func</span>&nbsp;<span class="op" id="2575773">(</span><span class="ident" id="2575774">m</span>&nbsp;<span class="op" id="2575776">*</span><span class="ident" id="2575777">mmapper</span><span class="op" id="2575784">)</span>&nbsp;<span class="ident" id="2575786">Mmap</span><span class="op" id="2575790">(</span><span class="ident" id="2575791">fd</span>&nbsp;<span class="builtintype" id="2575794">int</span><span class="op" id="2575797">,</span>&nbsp;<span class="ident" id="2575799">offset</span>&nbsp;<span class="ident" id="2575806">int64</span><span class="op" id="2575811">,</span>&nbsp;<span class="ident" id="2575813">length</span>&nbsp;<span class="builtintype" id="2575820">int</span><span class="op" id="2575823">,</span>&nbsp;<span class="ident" id="2575825">prot</span>&nbsp;<span class="builtintype" id="2575830">int</span><span class="op" id="2575833">,</span>&nbsp;<span class="ident" id="2575835">flags</span>&nbsp;<span class="builtintype" id="2575841">int</span><span class="op" id="2575844">)</span>&nbsp;<span class="op" id="2575846">(</span><span class="ident" id="2575847">data</span>&nbsp;<span class="op" id="2575852">[</span><span class="op" id="2575853">]</span><span class="builtintype" id="2575854">byte</span><span class="op" id="2575858">,</span>&nbsp;<span class="ident" id="2575860">err</span>&nbsp;<span class="builtintype" id="2575864">error</span><span class="op" id="2575869">)</span>&nbsp;<span class="op" id="2575871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2575874">if</span>&nbsp;<span class="ident" id="2575877">length</span>&nbsp;<span class="op" id="2575884">&lt;=</span>&nbsp;<span class="num" id="2575887">0</span>&nbsp;<span class="op" id="2575889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2575893">return</span>&nbsp;<span class="ident" id="2575900">nil</span><span class="op" id="2575903">,</span>&nbsp;<span class="ident" id="2575905">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2575913">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2575917">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2575947">addr</span><span class="op" id="2575951">,</span>&nbsp;<span class="ident" id="2575953">errno</span>&nbsp;<span class="op" id="2575959">:=</span>&nbsp;<span class="ident" id="2575962">m</span><span class="op" id="2575963">.</span><span class="ident" id="2575964">mmap</span><span class="op" id="2575968">(</span><span class="num" id="2575969">0</span><span class="op" id="2575970">,</span>&nbsp;<span class="builtintype" id="2575972">uintptr</span><span class="op" id="2575979">(</span><span class="ident" id="2575980">length</span><span class="op" id="2575986">)</span><span class="op" id="2575987">,</span>&nbsp;<span class="ident" id="2575989">prot</span><span class="op" id="2575993">,</span>&nbsp;<span class="ident" id="2575995">flags</span><span class="op" id="2576000">,</span>&nbsp;<span class="ident" id="2576002">fd</span><span class="op" id="2576004">,</span>&nbsp;<span class="ident" id="2576006">offset</span><span class="op" id="2576012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576015">if</span>&nbsp;<span class="ident" id="2576018">errno</span>&nbsp;<span class="op" id="2576024">!=</span>&nbsp;<span class="ident" id="2576027">nil</span>&nbsp;<span class="op" id="2576031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576035">return</span>&nbsp;<span class="ident" id="2576042">nil</span><span class="op" id="2576045">,</span>&nbsp;<span class="ident" id="2576047">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2576054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2576058">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576082">var</span>&nbsp;<span class="ident" id="2576086">sl</span>&nbsp;<span class="op" id="2576089">=</span>&nbsp;<span class="keyword" id="2576091">struct</span>&nbsp;<span class="op" id="2576098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576102">addr</span>&nbsp;<span class="builtintype" id="2576107">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2576117">len</span>&nbsp;&nbsp;<span class="builtintype" id="2576122">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2576128">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2576133">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2576138">}</span><span class="op" id="2576139">{</span><span class="ident" id="2576140">addr</span><span class="op" id="2576144">,</span>&nbsp;<span class="ident" id="2576146">length</span><span class="op" id="2576152">,</span>&nbsp;<span class="ident" id="2576154">length</span><span class="op" id="2576160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2576164">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576205">b</span>&nbsp;<span class="op" id="2576207">:=</span>&nbsp;<span class="op" id="2576210">*</span><span class="op" id="2576211">(</span><span class="op" id="2576212">*</span><span class="op" id="2576213">[</span><span class="op" id="2576214">]</span><span class="builtintype" id="2576215">byte</span><span class="op" id="2576219">)</span><span class="op" id="2576220">(</span><span class="ident" id="2576221">unsafe</span><span class="op" id="2576227">.</span><span class="ident" id="2576228">Pointer</span><span class="op" id="2576235">(</span><span class="op" id="2576236">&amp;</span><span class="ident" id="2576237">sl</span><span class="op" id="2576239">)</span><span class="op" id="2576240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2576244">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576285">p</span>&nbsp;<span class="op" id="2576287">:=</span>&nbsp;<span class="op" id="2576290">&amp;</span><span class="ident" id="2576291">b</span><span class="op" id="2576292">[</span><span class="builtinfunc" id="2576293">cap</span><span class="op" id="2576296">(</span><span class="ident" id="2576297">b</span><span class="op" id="2576298">)</span><span class="op" id="2576299">-</span><span class="num" id="2576300">1</span><span class="op" id="2576301">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576304">m</span><span class="op" id="2576305">.</span><span class="ident" id="2576306">Lock</span><span class="op" id="2576310">(</span><span class="op" id="2576311">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576314">defer</span>&nbsp;<span class="ident" id="2576320">m</span><span class="op" id="2576321">.</span><span class="ident" id="2576322">Unlock</span><span class="op" id="2576328">(</span><span class="op" id="2576329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576332">m</span><span class="op" id="2576333">.</span><span class="ident" id="2576334">active</span><span class="op" id="2576340">[</span><span class="ident" id="2576341">p</span><span class="op" id="2576342">]</span>&nbsp;<span class="op" id="2576344">=</span>&nbsp;<span class="ident" id="2576346">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576349">return</span>&nbsp;<span class="ident" id="2576356">b</span><span class="op" id="2576357">,</span>&nbsp;<span class="ident" id="2576359">nil</span><br>
<span class="lineno"></span><span class="op" id="2576363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2576366">func</span>&nbsp;<span class="op" id="2576371">(</span><span class="ident" id="2576372">m</span>&nbsp;<span class="op" id="2576374">*</span><span class="ident" id="2576375">mmapper</span><span class="op" id="2576382">)</span>&nbsp;<span class="ident" id="2576384">Munmap</span><span class="op" id="2576390">(</span><span class="ident" id="2576391">data</span>&nbsp;<span class="op" id="2576396">[</span><span class="op" id="2576397">]</span><span class="builtintype" id="2576398">byte</span><span class="op" id="2576402">)</span>&nbsp;<span class="op" id="2576404">(</span><span class="ident" id="2576405">err</span>&nbsp;<span class="builtintype" id="2576409">error</span><span class="op" id="2576414">)</span>&nbsp;<span class="op" id="2576416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576419">if</span>&nbsp;<span class="builtinfunc" id="2576422">len</span><span class="op" id="2576425">(</span><span class="ident" id="2576426">data</span><span class="op" id="2576430">)</span>&nbsp;<span class="op" id="2576432">==</span>&nbsp;<span class="num" id="2576435">0</span>&nbsp;<span class="op" id="2576437">||</span>&nbsp;<span class="builtinfunc" id="2576440">len</span><span class="op" id="2576443">(</span><span class="ident" id="2576444">data</span><span class="op" id="2576448">)</span>&nbsp;<span class="op" id="2576450">!=</span>&nbsp;<span class="builtinfunc" id="2576453">cap</span><span class="op" id="2576456">(</span><span class="ident" id="2576457">data</span><span class="op" id="2576461">)</span>&nbsp;<span class="op" id="2576463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576467">return</span>&nbsp;<span class="ident" id="2576474">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2576482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2576486">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576520">p</span>&nbsp;<span class="op" id="2576522">:=</span>&nbsp;<span class="op" id="2576525">&amp;</span><span class="ident" id="2576526">data</span><span class="op" id="2576530">[</span><span class="builtinfunc" id="2576531">cap</span><span class="op" id="2576534">(</span><span class="ident" id="2576535">data</span><span class="op" id="2576539">)</span><span class="op" id="2576540">-</span><span class="num" id="2576541">1</span><span class="op" id="2576542">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576545">m</span><span class="op" id="2576546">.</span><span class="ident" id="2576547">Lock</span><span class="op" id="2576551">(</span><span class="op" id="2576552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576555">defer</span>&nbsp;<span class="ident" id="2576561">m</span><span class="op" id="2576562">.</span><span class="ident" id="2576563">Unlock</span><span class="op" id="2576569">(</span><span class="op" id="2576570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2576573">b</span>&nbsp;<span class="op" id="2576575">:=</span>&nbsp;<span class="ident" id="2576578">m</span><span class="op" id="2576579">.</span><span class="ident" id="2576580">active</span><span class="op" id="2576586">[</span><span class="ident" id="2576587">p</span><span class="op" id="2576588">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576591">if</span>&nbsp;<span class="ident" id="2576594">b</span>&nbsp;<span class="op" id="2576596">==</span>&nbsp;<span class="ident" id="2576599">nil</span>&nbsp;<span class="op" id="2576603">||</span>&nbsp;<span class="op" id="2576606">&amp;</span><span class="ident" id="2576607">b</span><span class="op" id="2576608">[</span><span class="num" id="2576609">0</span><span class="op" id="2576610">]</span>&nbsp;<span class="op" id="2576612">!=</span>&nbsp;<span class="op" id="2576615">&amp;</span><span class="ident" id="2576616">data</span><span class="op" id="2576620">[</span><span class="num" id="2576621">0</span><span class="op" id="2576622">]</span>&nbsp;<span class="op" id="2576624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576628">return</span>&nbsp;<span class="ident" id="2576635">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2576643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2576647">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576682">if</span>&nbsp;<span class="ident" id="2576685">errno</span>&nbsp;<span class="op" id="2576691">:=</span>&nbsp;<span class="ident" id="2576694">m</span><span class="op" id="2576695">.</span><span class="ident" id="2576696">munmap</span><span class="op" id="2576702">(</span><span class="builtintype" id="2576703">uintptr</span><span class="op" id="2576710">(</span><span class="ident" id="2576711">unsafe</span><span class="op" id="2576717">.</span><span class="ident" id="2576718">Pointer</span><span class="op" id="2576725">(</span><span class="op" id="2576726">&amp;</span><span class="ident" id="2576727">b</span><span class="op" id="2576728">[</span><span class="num" id="2576729">0</span><span class="op" id="2576730">]</span><span class="op" id="2576731">)</span><span class="op" id="2576732">)</span><span class="op" id="2576733">,</span>&nbsp;<span class="builtintype" id="2576735">uintptr</span><span class="op" id="2576742">(</span><span class="builtinfunc" id="2576743">len</span><span class="op" id="2576746">(</span><span class="ident" id="2576747">b</span><span class="op" id="2576748">)</span><span class="op" id="2576749">)</span><span class="op" id="2576750">)</span><span class="op" id="2576751">;</span>&nbsp;<span class="ident" id="2576753">errno</span>&nbsp;<span class="op" id="2576759">!=</span>&nbsp;<span class="ident" id="2576762">nil</span>&nbsp;<span class="op" id="2576766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576770">return</span>&nbsp;<span class="ident" id="2576777">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2576784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2576787">delete</span><span class="op" id="2576793">(</span><span class="ident" id="2576794">m</span><span class="op" id="2576795">.</span><span class="ident" id="2576796">active</span><span class="op" id="2576802">,</span>&nbsp;<span class="ident" id="2576804">p</span><span class="op" id="2576805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2576808">return</span>&nbsp;<span class="ident" id="2576815">nil</span><br>
<span class="lineno">90</span><span class="op" id="2576819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2576822">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2576887">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2576958">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2577025">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2577038">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2577057">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2577073">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2577078">type</span>&nbsp;<span class="ident" id="2577083">Errno</span>&nbsp;<span class="builtintype" id="2577089">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2577098">func</span>&nbsp;<span class="op" id="2577103">(</span><span class="ident" id="2577104">e</span>&nbsp;<span class="ident" id="2577106">Errno</span><span class="op" id="2577111">)</span>&nbsp;<span class="ident" id="2577113">Error</span><span class="op" id="2577118">(</span><span class="op" id="2577119">)</span>&nbsp;<span class="builtintype" id="2577121">string</span>&nbsp;<span class="op" id="2577128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577131">if</span>&nbsp;<span class="num" id="2577134">0</span>&nbsp;<span class="op" id="2577136">&lt;=</span>&nbsp;<span class="builtintype" id="2577139">int</span><span class="op" id="2577142">(</span><span class="ident" id="2577143">e</span><span class="op" id="2577144">)</span>&nbsp;<span class="op" id="2577146">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2577149">int</span><span class="op" id="2577152">(</span><span class="ident" id="2577153">e</span><span class="op" id="2577154">)</span>&nbsp;<span class="op" id="2577156">&lt;</span>&nbsp;<span class="builtinfunc" id="2577158">len</span><span class="op" id="2577161">(</span><span class="ident" id="2577162">errors</span><span class="op" id="2577168">)</span>&nbsp;<span class="op" id="2577170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2577174">s</span>&nbsp;<span class="op" id="2577176">:=</span>&nbsp;<span class="ident" id="2577179">errors</span><span class="op" id="2577185">[</span><span class="ident" id="2577186">e</span><span class="op" id="2577187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577191">if</span>&nbsp;<span class="ident" id="2577194">s</span>&nbsp;<span class="op" id="2577196">!=</span>&nbsp;<span class="string" id="2577199">&#34;&#34;</span>&nbsp;<span class="op" id="2577202">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577207">return</span>&nbsp;<span class="ident" id="2577214">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577224">return</span>&nbsp;<span class="string" id="2577231">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2577240">+</span>&nbsp;<span class="ident" id="2577242">itoa</span><span class="op" id="2577246">(</span><span class="builtintype" id="2577247">int</span><span class="op" id="2577250">(</span><span class="ident" id="2577251">e</span><span class="op" id="2577252">)</span><span class="op" id="2577253">)</span><br>
<span class="lineno"></span><span class="op" id="2577255">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2577258">func</span>&nbsp;<span class="op" id="2577263">(</span><span class="ident" id="2577264">e</span>&nbsp;<span class="ident" id="2577266">Errno</span><span class="op" id="2577271">)</span>&nbsp;<span class="ident" id="2577273">Temporary</span><span class="op" id="2577282">(</span><span class="op" id="2577283">)</span>&nbsp;<span class="builtintype" id="2577285">bool</span>&nbsp;<span class="op" id="2577290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577293">return</span>&nbsp;<span class="ident" id="2577300">e</span>&nbsp;<span class="op" id="2577302">==</span>&nbsp;<span class="ident" id="2577305">EINTR</span>&nbsp;<span class="op" id="2577311">||</span>&nbsp;<span class="ident" id="2577314">e</span>&nbsp;<span class="op" id="2577316">==</span>&nbsp;<span class="ident" id="2577319">EMFILE</span>&nbsp;<span class="op" id="2577326">||</span>&nbsp;<span class="ident" id="2577329">e</span>&nbsp;<span class="op" id="2577331">==</span>&nbsp;<span class="ident" id="2577334">ECONNRESET</span>&nbsp;<span class="op" id="2577345">||</span>&nbsp;<span class="ident" id="2577348">e</span>&nbsp;<span class="op" id="2577350">==</span>&nbsp;<span class="ident" id="2577353">ECONNABORTED</span>&nbsp;<span class="op" id="2577366">||</span>&nbsp;<span class="ident" id="2577369">e</span><span class="op" id="2577370">.</span><span class="ident" id="2577371">Timeout</span><span class="op" id="2577378">(</span><span class="op" id="2577379">)</span><br>
<span class="lineno"></span><span class="op" id="2577381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2577384">func</span>&nbsp;<span class="op" id="2577389">(</span><span class="ident" id="2577390">e</span>&nbsp;<span class="ident" id="2577392">Errno</span><span class="op" id="2577397">)</span>&nbsp;<span class="ident" id="2577399">Timeout</span><span class="op" id="2577406">(</span><span class="op" id="2577407">)</span>&nbsp;<span class="builtintype" id="2577409">bool</span>&nbsp;<span class="op" id="2577414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577417">return</span>&nbsp;<span class="ident" id="2577424">e</span>&nbsp;<span class="op" id="2577426">==</span>&nbsp;<span class="ident" id="2577429">EAGAIN</span>&nbsp;<span class="op" id="2577436">||</span>&nbsp;<span class="ident" id="2577439">e</span>&nbsp;<span class="op" id="2577441">==</span>&nbsp;<span class="ident" id="2577444">EWOULDBLOCK</span>&nbsp;<span class="op" id="2577456">||</span>&nbsp;<span class="ident" id="2577459">e</span>&nbsp;<span class="op" id="2577461">==</span>&nbsp;<span class="ident" id="2577464">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2577474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2577477">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2577530">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2577572">type</span>&nbsp;<span class="ident" id="2577577">Signal</span>&nbsp;<span class="builtintype" id="2577584">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2577589">func</span>&nbsp;<span class="op" id="2577594">(</span><span class="ident" id="2577595">s</span>&nbsp;<span class="ident" id="2577597">Signal</span><span class="op" id="2577603">)</span>&nbsp;<span class="ident" id="2577605">Signal</span><span class="op" id="2577611">(</span><span class="op" id="2577612">)</span>&nbsp;<span class="op" id="2577614">{</span><span class="op" id="2577615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2577618">func</span>&nbsp;<span class="op" id="2577623">(</span><span class="ident" id="2577624">s</span>&nbsp;<span class="ident" id="2577626">Signal</span><span class="op" id="2577632">)</span>&nbsp;<span class="ident" id="2577634">String</span><span class="op" id="2577640">(</span><span class="op" id="2577641">)</span>&nbsp;<span class="builtintype" id="2577643">string</span>&nbsp;<span class="op" id="2577650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577653">if</span>&nbsp;<span class="num" id="2577656">0</span>&nbsp;<span class="op" id="2577658">&lt;=</span>&nbsp;<span class="ident" id="2577661">s</span>&nbsp;<span class="op" id="2577663">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2577666">int</span><span class="op" id="2577669">(</span><span class="ident" id="2577670">s</span><span class="op" id="2577671">)</span>&nbsp;<span class="op" id="2577673">&lt;</span>&nbsp;<span class="builtinfunc" id="2577675">len</span><span class="op" id="2577678">(</span><span class="ident" id="2577679">signals</span><span class="op" id="2577686">)</span>&nbsp;<span class="op" id="2577688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2577692">str</span>&nbsp;<span class="op" id="2577696">:=</span>&nbsp;<span class="ident" id="2577699">signals</span><span class="op" id="2577706">[</span><span class="ident" id="2577707">s</span><span class="op" id="2577708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577712">if</span>&nbsp;<span class="ident" id="2577715">str</span>&nbsp;<span class="op" id="2577719">!=</span>&nbsp;<span class="string" id="2577722">&#34;&#34;</span>&nbsp;<span class="op" id="2577725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577730">return</span>&nbsp;<span class="ident" id="2577737">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577749">return</span>&nbsp;<span class="string" id="2577756">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2577766">+</span>&nbsp;<span class="ident" id="2577768">itoa</span><span class="op" id="2577772">(</span><span class="builtintype" id="2577773">int</span><span class="op" id="2577776">(</span><span class="ident" id="2577777">s</span><span class="op" id="2577778">)</span><span class="op" id="2577779">)</span><br>
<span class="lineno"></span><span class="op" id="2577781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2577784">func</span>&nbsp;<span class="ident" id="2577789">Read</span><span class="op" id="2577793">(</span><span class="ident" id="2577794">fd</span>&nbsp;<span class="builtintype" id="2577797">int</span><span class="op" id="2577800">,</span>&nbsp;<span class="ident" id="2577802">p</span>&nbsp;<span class="op" id="2577804">[</span><span class="op" id="2577805">]</span><span class="builtintype" id="2577806">byte</span><span class="op" id="2577810">)</span>&nbsp;<span class="op" id="2577812">(</span><span class="ident" id="2577813">n</span>&nbsp;<span class="builtintype" id="2577815">int</span><span class="op" id="2577818">,</span>&nbsp;<span class="ident" id="2577820">err</span>&nbsp;<span class="builtintype" id="2577824">error</span><span class="op" id="2577829">)</span>&nbsp;<span class="op" id="2577831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2577834">n</span><span class="op" id="2577835">,</span>&nbsp;<span class="ident" id="2577837">err</span>&nbsp;<span class="op" id="2577841">=</span>&nbsp;<span class="ident" id="2577843">read</span><span class="op" id="2577847">(</span><span class="ident" id="2577848">fd</span><span class="op" id="2577850">,</span>&nbsp;<span class="ident" id="2577852">p</span><span class="op" id="2577853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577856">if</span>&nbsp;<span class="ident" id="2577859">raceenabled</span>&nbsp;<span class="op" id="2577871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577875">if</span>&nbsp;<span class="ident" id="2577878">n</span>&nbsp;<span class="op" id="2577880">&gt;</span>&nbsp;<span class="num" id="2577882">0</span>&nbsp;<span class="op" id="2577884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2577889">raceWriteRange</span><span class="op" id="2577903">(</span><span class="ident" id="2577904">unsafe</span><span class="op" id="2577910">.</span><span class="ident" id="2577911">Pointer</span><span class="op" id="2577918">(</span><span class="op" id="2577919">&amp;</span><span class="ident" id="2577920">p</span><span class="op" id="2577921">[</span><span class="num" id="2577922">0</span><span class="op" id="2577923">]</span><span class="op" id="2577924">)</span><span class="op" id="2577925">,</span>&nbsp;<span class="ident" id="2577927">n</span><span class="op" id="2577928">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2577936">if</span>&nbsp;<span class="ident" id="2577939">err</span>&nbsp;<span class="op" id="2577943">==</span>&nbsp;<span class="ident" id="2577946">nil</span>&nbsp;<span class="op" id="2577950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2577955">raceAcquire</span><span class="op" id="2577966">(</span><span class="ident" id="2577967">unsafe</span><span class="op" id="2577973">.</span><span class="ident" id="2577974">Pointer</span><span class="op" id="2577981">(</span><span class="op" id="2577982">&amp;</span><span class="ident" id="2577983">ioSync</span><span class="op" id="2577989">)</span><span class="op" id="2577990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2577997">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578000">return</span><br>
<span class="lineno"></span><span class="op" id="2578007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578010">func</span>&nbsp;<span class="ident" id="2578015">Write</span><span class="op" id="2578020">(</span><span class="ident" id="2578021">fd</span>&nbsp;<span class="builtintype" id="2578024">int</span><span class="op" id="2578027">,</span>&nbsp;<span class="ident" id="2578029">p</span>&nbsp;<span class="op" id="2578031">[</span><span class="op" id="2578032">]</span><span class="builtintype" id="2578033">byte</span><span class="op" id="2578037">)</span>&nbsp;<span class="op" id="2578039">(</span><span class="ident" id="2578040">n</span>&nbsp;<span class="builtintype" id="2578042">int</span><span class="op" id="2578045">,</span>&nbsp;<span class="ident" id="2578047">err</span>&nbsp;<span class="builtintype" id="2578051">error</span><span class="op" id="2578056">)</span>&nbsp;<span class="op" id="2578058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578061">if</span>&nbsp;<span class="ident" id="2578064">raceenabled</span>&nbsp;<span class="op" id="2578076">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578080">raceReleaseMerge</span><span class="op" id="2578096">(</span><span class="ident" id="2578097">unsafe</span><span class="op" id="2578103">.</span><span class="ident" id="2578104">Pointer</span><span class="op" id="2578111">(</span><span class="op" id="2578112">&amp;</span><span class="ident" id="2578113">ioSync</span><span class="op" id="2578119">)</span><span class="op" id="2578120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2578123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578126">n</span><span class="op" id="2578127">,</span>&nbsp;<span class="ident" id="2578129">err</span>&nbsp;<span class="op" id="2578133">=</span>&nbsp;<span class="ident" id="2578135">write</span><span class="op" id="2578140">(</span><span class="ident" id="2578141">fd</span><span class="op" id="2578143">,</span>&nbsp;<span class="ident" id="2578145">p</span><span class="op" id="2578146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578149">if</span>&nbsp;<span class="ident" id="2578152">raceenabled</span>&nbsp;<span class="op" id="2578164">&amp;&amp;</span>&nbsp;<span class="ident" id="2578167">n</span>&nbsp;<span class="op" id="2578169">&gt;</span>&nbsp;<span class="num" id="2578171">0</span>&nbsp;<span class="op" id="2578173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578177">raceReadRange</span><span class="op" id="2578190">(</span><span class="ident" id="2578191">unsafe</span><span class="op" id="2578197">.</span><span class="ident" id="2578198">Pointer</span><span class="op" id="2578205">(</span><span class="op" id="2578206">&amp;</span><span class="ident" id="2578207">p</span><span class="op" id="2578208">[</span><span class="num" id="2578209">0</span><span class="op" id="2578210">]</span><span class="op" id="2578211">)</span><span class="op" id="2578212">,</span>&nbsp;<span class="ident" id="2578214">n</span><span class="op" id="2578215">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2578218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578221">return</span><br>
<span class="lineno"></span><span class="op" id="2578228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2578231">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2578282">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2578334">var</span>&nbsp;<span class="ident" id="2578338">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2578356">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578362">type</span>&nbsp;<span class="ident" id="2578367">Sockaddr</span>&nbsp;<span class="keyword" id="2578376">interface</span>&nbsp;<span class="op" id="2578386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578389">sockaddr</span><span class="op" id="2578397">(</span><span class="op" id="2578398">)</span>&nbsp;<span class="op" id="2578400">(</span><span class="ident" id="2578401">ptr</span>&nbsp;<span class="ident" id="2578405">unsafe</span><span class="op" id="2578411">.</span><span class="ident" id="2578412">Pointer</span><span class="op" id="2578419">,</span>&nbsp;<span class="builtinfunc" id="2578421">len</span>&nbsp;<span class="ident" id="2578425">_Socklen</span><span class="op" id="2578433">,</span>&nbsp;<span class="ident" id="2578435">err</span>&nbsp;<span class="builtintype" id="2578439">error</span><span class="op" id="2578444">)</span>&nbsp;<span class="comment" id="2578446">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2578489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578492">type</span>&nbsp;<span class="ident" id="2578497">SockaddrInet4</span>&nbsp;<span class="keyword" id="2578511">struct</span>&nbsp;<span class="op" id="2578518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578521">Port</span>&nbsp;<span class="builtintype" id="2578526">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578531">Addr</span>&nbsp;<span class="op" id="2578536">[</span><span class="num" id="2578537">4</span><span class="op" id="2578538">]</span><span class="builtintype" id="2578539">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578545">raw</span>&nbsp;&nbsp;<span class="ident" id="2578550">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2578567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578570">type</span>&nbsp;<span class="ident" id="2578575">SockaddrInet6</span>&nbsp;<span class="keyword" id="2578589">struct</span>&nbsp;<span class="op" id="2578596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578599">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2578606">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578611">ZoneId</span>&nbsp;<span class="builtintype" id="2578618">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578626">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2578633">[</span><span class="num" id="2578634">16</span><span class="op" id="2578636">]</span><span class="builtintype" id="2578637">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578643">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2578650">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2578667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2578670">type</span>&nbsp;<span class="ident" id="2578675">SockaddrUnix</span>&nbsp;<span class="keyword" id="2578688">struct</span>&nbsp;<span class="op" id="2578695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578698">Name</span>&nbsp;<span class="builtintype" id="2578703">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578711">raw</span>&nbsp;&nbsp;<span class="ident" id="2578716">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2578732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2578735">func</span>&nbsp;<span class="ident" id="2578740">Bind</span><span class="op" id="2578744">(</span><span class="ident" id="2578745">fd</span>&nbsp;<span class="builtintype" id="2578748">int</span><span class="op" id="2578751">,</span>&nbsp;<span class="ident" id="2578753">sa</span>&nbsp;<span class="ident" id="2578756">Sockaddr</span><span class="op" id="2578764">)</span>&nbsp;<span class="op" id="2578766">(</span><span class="ident" id="2578767">err</span>&nbsp;<span class="builtintype" id="2578771">error</span><span class="op" id="2578776">)</span>&nbsp;<span class="op" id="2578778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578781">ptr</span><span class="op" id="2578784">,</span>&nbsp;<span class="ident" id="2578786">n</span><span class="op" id="2578787">,</span>&nbsp;<span class="ident" id="2578789">err</span>&nbsp;<span class="op" id="2578793">:=</span>&nbsp;<span class="ident" id="2578796">sa</span><span class="op" id="2578798">.</span><span class="ident" id="2578799">sockaddr</span><span class="op" id="2578807">(</span><span class="op" id="2578808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578811">if</span>&nbsp;<span class="ident" id="2578814">err</span>&nbsp;<span class="op" id="2578818">!=</span>&nbsp;<span class="ident" id="2578821">nil</span>&nbsp;<span class="op" id="2578825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578829">return</span>&nbsp;<span class="ident" id="2578836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2578841">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578844">return</span>&nbsp;<span class="ident" id="2578851">bind</span><span class="op" id="2578855">(</span><span class="ident" id="2578856">fd</span><span class="op" id="2578858">,</span>&nbsp;<span class="ident" id="2578860">ptr</span><span class="op" id="2578863">,</span>&nbsp;<span class="ident" id="2578865">n</span><span class="op" id="2578866">)</span><br>
<span class="lineno"></span><span class="op" id="2578868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578871">func</span>&nbsp;<span class="ident" id="2578876">Connect</span><span class="op" id="2578883">(</span><span class="ident" id="2578884">fd</span>&nbsp;<span class="builtintype" id="2578887">int</span><span class="op" id="2578890">,</span>&nbsp;<span class="ident" id="2578892">sa</span>&nbsp;<span class="ident" id="2578895">Sockaddr</span><span class="op" id="2578903">)</span>&nbsp;<span class="op" id="2578905">(</span><span class="ident" id="2578906">err</span>&nbsp;<span class="builtintype" id="2578910">error</span><span class="op" id="2578915">)</span>&nbsp;<span class="op" id="2578917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2578920">ptr</span><span class="op" id="2578923">,</span>&nbsp;<span class="ident" id="2578925">n</span><span class="op" id="2578926">,</span>&nbsp;<span class="ident" id="2578928">err</span>&nbsp;<span class="op" id="2578932">:=</span>&nbsp;<span class="ident" id="2578935">sa</span><span class="op" id="2578937">.</span><span class="ident" id="2578938">sockaddr</span><span class="op" id="2578946">(</span><span class="op" id="2578947">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578950">if</span>&nbsp;<span class="ident" id="2578953">err</span>&nbsp;<span class="op" id="2578957">!=</span>&nbsp;<span class="ident" id="2578960">nil</span>&nbsp;<span class="op" id="2578964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578968">return</span>&nbsp;<span class="ident" id="2578975">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2578980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2578983">return</span>&nbsp;<span class="ident" id="2578990">connect</span><span class="op" id="2578997">(</span><span class="ident" id="2578998">fd</span><span class="op" id="2579000">,</span>&nbsp;<span class="ident" id="2579002">ptr</span><span class="op" id="2579005">,</span>&nbsp;<span class="ident" id="2579007">n</span><span class="op" id="2579008">)</span><br>
<span class="lineno"></span><span class="op" id="2579010">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2579013">func</span>&nbsp;<span class="ident" id="2579018">Getpeername</span><span class="op" id="2579029">(</span><span class="ident" id="2579030">fd</span>&nbsp;<span class="builtintype" id="2579033">int</span><span class="op" id="2579036">)</span>&nbsp;<span class="op" id="2579038">(</span><span class="ident" id="2579039">sa</span>&nbsp;<span class="ident" id="2579042">Sockaddr</span><span class="op" id="2579050">,</span>&nbsp;<span class="ident" id="2579052">err</span>&nbsp;<span class="builtintype" id="2579056">error</span><span class="op" id="2579061">)</span>&nbsp;<span class="op" id="2579063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579066">var</span>&nbsp;<span class="ident" id="2579070">rsa</span>&nbsp;<span class="ident" id="2579074">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579090">var</span>&nbsp;<span class="builtinfunc" id="2579094">len</span>&nbsp;<span class="ident" id="2579098">_Socklen</span>&nbsp;<span class="op" id="2579107">=</span>&nbsp;<span class="ident" id="2579109">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579128">if</span>&nbsp;<span class="ident" id="2579131">err</span>&nbsp;<span class="op" id="2579135">=</span>&nbsp;<span class="ident" id="2579137">getpeername</span><span class="op" id="2579148">(</span><span class="ident" id="2579149">fd</span><span class="op" id="2579151">,</span>&nbsp;<span class="op" id="2579153">&amp;</span><span class="ident" id="2579154">rsa</span><span class="op" id="2579157">,</span>&nbsp;<span class="op" id="2579159">&amp;</span><span class="builtinfunc" id="2579160">len</span><span class="op" id="2579163">)</span><span class="op" id="2579164">;</span>&nbsp;<span class="ident" id="2579166">err</span>&nbsp;<span class="op" id="2579170">!=</span>&nbsp;<span class="ident" id="2579173">nil</span>&nbsp;<span class="op" id="2579177">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579181">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2579189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579192">return</span>&nbsp;<span class="ident" id="2579199">anyToSockaddr</span><span class="op" id="2579212">(</span><span class="op" id="2579213">&amp;</span><span class="ident" id="2579214">rsa</span><span class="op" id="2579217">)</span><br>
<span class="lineno"></span><span class="op" id="2579219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2579222">func</span>&nbsp;<span class="ident" id="2579227">GetsockoptInt</span><span class="op" id="2579240">(</span><span class="ident" id="2579241">fd</span><span class="op" id="2579243">,</span>&nbsp;<span class="ident" id="2579245">level</span><span class="op" id="2579250">,</span>&nbsp;<span class="ident" id="2579252">opt</span>&nbsp;<span class="builtintype" id="2579256">int</span><span class="op" id="2579259">)</span>&nbsp;<span class="op" id="2579261">(</span><span class="ident" id="2579262">value</span>&nbsp;<span class="builtintype" id="2579268">int</span><span class="op" id="2579271">,</span>&nbsp;<span class="ident" id="2579273">err</span>&nbsp;<span class="builtintype" id="2579277">error</span><span class="op" id="2579282">)</span>&nbsp;<span class="op" id="2579284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579287">var</span>&nbsp;<span class="ident" id="2579291">n</span>&nbsp;<span class="builtintype" id="2579293">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2579300">vallen</span>&nbsp;<span class="op" id="2579307">:=</span>&nbsp;<span class="ident" id="2579310">_Socklen</span><span class="op" id="2579318">(</span><span class="num" id="2579319">4</span><span class="op" id="2579320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2579323">err</span>&nbsp;<span class="op" id="2579327">=</span>&nbsp;<span class="ident" id="2579329">getsockopt</span><span class="op" id="2579339">(</span><span class="ident" id="2579340">fd</span><span class="op" id="2579342">,</span>&nbsp;<span class="ident" id="2579344">level</span><span class="op" id="2579349">,</span>&nbsp;<span class="ident" id="2579351">opt</span><span class="op" id="2579354">,</span>&nbsp;<span class="ident" id="2579356">unsafe</span><span class="op" id="2579362">.</span><span class="ident" id="2579363">Pointer</span><span class="op" id="2579370">(</span><span class="op" id="2579371">&amp;</span><span class="ident" id="2579372">n</span><span class="op" id="2579373">)</span><span class="op" id="2579374">,</span>&nbsp;<span class="op" id="2579376">&amp;</span><span class="ident" id="2579377">vallen</span><span class="op" id="2579383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579386">return</span>&nbsp;<span class="builtintype" id="2579393">int</span><span class="op" id="2579396">(</span><span class="ident" id="2579397">n</span><span class="op" id="2579398">)</span><span class="op" id="2579399">,</span>&nbsp;<span class="ident" id="2579401">err</span><br>
<span class="lineno">215</span><span class="op" id="2579405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2579408">func</span>&nbsp;<span class="ident" id="2579413">Recvfrom</span><span class="op" id="2579421">(</span><span class="ident" id="2579422">fd</span>&nbsp;<span class="builtintype" id="2579425">int</span><span class="op" id="2579428">,</span>&nbsp;<span class="ident" id="2579430">p</span>&nbsp;<span class="op" id="2579432">[</span><span class="op" id="2579433">]</span><span class="builtintype" id="2579434">byte</span><span class="op" id="2579438">,</span>&nbsp;<span class="ident" id="2579440">flags</span>&nbsp;<span class="builtintype" id="2579446">int</span><span class="op" id="2579449">)</span>&nbsp;<span class="op" id="2579451">(</span><span class="ident" id="2579452">n</span>&nbsp;<span class="builtintype" id="2579454">int</span><span class="op" id="2579457">,</span>&nbsp;<span class="ident" id="2579459">from</span>&nbsp;<span class="ident" id="2579464">Sockaddr</span><span class="op" id="2579472">,</span>&nbsp;<span class="ident" id="2579474">err</span>&nbsp;<span class="builtintype" id="2579478">error</span><span class="op" id="2579483">)</span>&nbsp;<span class="op" id="2579485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579488">var</span>&nbsp;<span class="ident" id="2579492">rsa</span>&nbsp;<span class="ident" id="2579496">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579512">var</span>&nbsp;<span class="builtinfunc" id="2579516">len</span>&nbsp;<span class="ident" id="2579520">_Socklen</span>&nbsp;<span class="op" id="2579529">=</span>&nbsp;<span class="ident" id="2579531">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579550">if</span>&nbsp;<span class="ident" id="2579553">n</span><span class="op" id="2579554">,</span>&nbsp;<span class="ident" id="2579556">err</span>&nbsp;<span class="op" id="2579560">=</span>&nbsp;<span class="ident" id="2579562">recvfrom</span><span class="op" id="2579570">(</span><span class="ident" id="2579571">fd</span><span class="op" id="2579573">,</span>&nbsp;<span class="ident" id="2579575">p</span><span class="op" id="2579576">,</span>&nbsp;<span class="ident" id="2579578">flags</span><span class="op" id="2579583">,</span>&nbsp;<span class="op" id="2579585">&amp;</span><span class="ident" id="2579586">rsa</span><span class="op" id="2579589">,</span>&nbsp;<span class="op" id="2579591">&amp;</span><span class="builtinfunc" id="2579592">len</span><span class="op" id="2579595">)</span><span class="op" id="2579596">;</span>&nbsp;<span class="ident" id="2579598">err</span>&nbsp;<span class="op" id="2579602">!=</span>&nbsp;<span class="ident" id="2579605">nil</span>&nbsp;<span class="op" id="2579609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579613">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2579621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579624">if</span>&nbsp;<span class="ident" id="2579627">rsa</span><span class="op" id="2579630">.</span><span class="ident" id="2579631">Addr</span><span class="op" id="2579635">.</span><span class="ident" id="2579636">Family</span>&nbsp;<span class="op" id="2579643">!=</span>&nbsp;<span class="ident" id="2579646">AF_UNSPEC</span>&nbsp;<span class="op" id="2579656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2579660">from</span><span class="op" id="2579664">,</span>&nbsp;<span class="ident" id="2579666">err</span>&nbsp;<span class="op" id="2579670">=</span>&nbsp;<span class="ident" id="2579672">anyToSockaddr</span><span class="op" id="2579685">(</span><span class="op" id="2579686">&amp;</span><span class="ident" id="2579687">rsa</span><span class="op" id="2579690">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2579693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579696">return</span><br>
<span class="lineno"></span><span class="op" id="2579703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2579706">func</span>&nbsp;<span class="ident" id="2579711">Sendto</span><span class="op" id="2579717">(</span><span class="ident" id="2579718">fd</span>&nbsp;<span class="builtintype" id="2579721">int</span><span class="op" id="2579724">,</span>&nbsp;<span class="ident" id="2579726">p</span>&nbsp;<span class="op" id="2579728">[</span><span class="op" id="2579729">]</span><span class="builtintype" id="2579730">byte</span><span class="op" id="2579734">,</span>&nbsp;<span class="ident" id="2579736">flags</span>&nbsp;<span class="builtintype" id="2579742">int</span><span class="op" id="2579745">,</span>&nbsp;<span class="ident" id="2579747">to</span>&nbsp;<span class="ident" id="2579750">Sockaddr</span><span class="op" id="2579758">)</span>&nbsp;<span class="op" id="2579760">(</span><span class="ident" id="2579761">err</span>&nbsp;<span class="builtintype" id="2579765">error</span><span class="op" id="2579770">)</span>&nbsp;<span class="op" id="2579772">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2579775">ptr</span><span class="op" id="2579778">,</span>&nbsp;<span class="ident" id="2579780">n</span><span class="op" id="2579781">,</span>&nbsp;<span class="ident" id="2579783">err</span>&nbsp;<span class="op" id="2579787">:=</span>&nbsp;<span class="ident" id="2579790">to</span><span class="op" id="2579792">.</span><span class="ident" id="2579793">sockaddr</span><span class="op" id="2579801">(</span><span class="op" id="2579802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579805">if</span>&nbsp;<span class="ident" id="2579808">err</span>&nbsp;<span class="op" id="2579812">!=</span>&nbsp;<span class="ident" id="2579815">nil</span>&nbsp;<span class="op" id="2579819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579823">return</span>&nbsp;<span class="ident" id="2579830">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2579835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579838">return</span>&nbsp;<span class="ident" id="2579845">sendto</span><span class="op" id="2579851">(</span><span class="ident" id="2579852">fd</span><span class="op" id="2579854">,</span>&nbsp;<span class="ident" id="2579856">p</span><span class="op" id="2579857">,</span>&nbsp;<span class="ident" id="2579859">flags</span><span class="op" id="2579864">,</span>&nbsp;<span class="ident" id="2579866">ptr</span><span class="op" id="2579869">,</span>&nbsp;<span class="ident" id="2579871">n</span><span class="op" id="2579872">)</span><br>
<span class="lineno">235</span><span class="op" id="2579874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2579877">func</span>&nbsp;<span class="ident" id="2579882">SetsockoptByte</span><span class="op" id="2579896">(</span><span class="ident" id="2579897">fd</span><span class="op" id="2579899">,</span>&nbsp;<span class="ident" id="2579901">level</span><span class="op" id="2579906">,</span>&nbsp;<span class="ident" id="2579908">opt</span>&nbsp;<span class="builtintype" id="2579912">int</span><span class="op" id="2579915">,</span>&nbsp;<span class="ident" id="2579917">value</span>&nbsp;<span class="builtintype" id="2579923">byte</span><span class="op" id="2579927">)</span>&nbsp;<span class="op" id="2579929">(</span><span class="ident" id="2579930">err</span>&nbsp;<span class="builtintype" id="2579934">error</span><span class="op" id="2579939">)</span>&nbsp;<span class="op" id="2579941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2579944">return</span>&nbsp;<span class="ident" id="2579951">setsockopt</span><span class="op" id="2579961">(</span><span class="ident" id="2579962">fd</span><span class="op" id="2579964">,</span>&nbsp;<span class="ident" id="2579966">level</span><span class="op" id="2579971">,</span>&nbsp;<span class="ident" id="2579973">opt</span><span class="op" id="2579976">,</span>&nbsp;<span class="ident" id="2579978">unsafe</span><span class="op" id="2579984">.</span><span class="ident" id="2579985">Pointer</span><span class="op" id="2579992">(</span><span class="op" id="2579993">&amp;</span><span class="ident" id="2579994">value</span><span class="op" id="2579999">)</span><span class="op" id="2580000">,</span>&nbsp;<span class="num" id="2580002">1</span><span class="op" id="2580003">)</span><br>
<span class="lineno"></span><span class="op" id="2580005">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2580008">func</span>&nbsp;<span class="ident" id="2580013">SetsockoptInt</span><span class="op" id="2580026">(</span><span class="ident" id="2580027">fd</span><span class="op" id="2580029">,</span>&nbsp;<span class="ident" id="2580031">level</span><span class="op" id="2580036">,</span>&nbsp;<span class="ident" id="2580038">opt</span>&nbsp;<span class="builtintype" id="2580042">int</span><span class="op" id="2580045">,</span>&nbsp;<span class="ident" id="2580047">value</span>&nbsp;<span class="builtintype" id="2580053">int</span><span class="op" id="2580056">)</span>&nbsp;<span class="op" id="2580058">(</span><span class="ident" id="2580059">err</span>&nbsp;<span class="builtintype" id="2580063">error</span><span class="op" id="2580068">)</span>&nbsp;<span class="op" id="2580070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580073">var</span>&nbsp;<span class="ident" id="2580077">n</span>&nbsp;<span class="op" id="2580079">=</span>&nbsp;<span class="builtintype" id="2580081">int32</span><span class="op" id="2580086">(</span><span class="ident" id="2580087">value</span><span class="op" id="2580092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580095">return</span>&nbsp;<span class="ident" id="2580102">setsockopt</span><span class="op" id="2580112">(</span><span class="ident" id="2580113">fd</span><span class="op" id="2580115">,</span>&nbsp;<span class="ident" id="2580117">level</span><span class="op" id="2580122">,</span>&nbsp;<span class="ident" id="2580124">opt</span><span class="op" id="2580127">,</span>&nbsp;<span class="ident" id="2580129">unsafe</span><span class="op" id="2580135">.</span><span class="ident" id="2580136">Pointer</span><span class="op" id="2580143">(</span><span class="op" id="2580144">&amp;</span><span class="ident" id="2580145">n</span><span class="op" id="2580146">)</span><span class="op" id="2580147">,</span>&nbsp;<span class="num" id="2580149">4</span><span class="op" id="2580150">)</span><br>
<span class="lineno"></span><span class="op" id="2580152">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2580155">func</span>&nbsp;<span class="ident" id="2580160">SetsockoptInet4Addr</span><span class="op" id="2580179">(</span><span class="ident" id="2580180">fd</span><span class="op" id="2580182">,</span>&nbsp;<span class="ident" id="2580184">level</span><span class="op" id="2580189">,</span>&nbsp;<span class="ident" id="2580191">opt</span>&nbsp;<span class="builtintype" id="2580195">int</span><span class="op" id="2580198">,</span>&nbsp;<span class="ident" id="2580200">value</span>&nbsp;<span class="op" id="2580206">[</span><span class="num" id="2580207">4</span><span class="op" id="2580208">]</span><span class="builtintype" id="2580209">byte</span><span class="op" id="2580213">)</span>&nbsp;<span class="op" id="2580215">(</span><span class="ident" id="2580216">err</span>&nbsp;<span class="builtintype" id="2580220">error</span><span class="op" id="2580225">)</span>&nbsp;<span class="op" id="2580227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580230">return</span>&nbsp;<span class="ident" id="2580237">setsockopt</span><span class="op" id="2580247">(</span><span class="ident" id="2580248">fd</span><span class="op" id="2580250">,</span>&nbsp;<span class="ident" id="2580252">level</span><span class="op" id="2580257">,</span>&nbsp;<span class="ident" id="2580259">opt</span><span class="op" id="2580262">,</span>&nbsp;<span class="ident" id="2580264">unsafe</span><span class="op" id="2580270">.</span><span class="ident" id="2580271">Pointer</span><span class="op" id="2580278">(</span><span class="op" id="2580279">&amp;</span><span class="ident" id="2580280">value</span><span class="op" id="2580285">[</span><span class="num" id="2580286">0</span><span class="op" id="2580287">]</span><span class="op" id="2580288">)</span><span class="op" id="2580289">,</span>&nbsp;<span class="num" id="2580291">4</span><span class="op" id="2580292">)</span><br>
<span class="lineno"></span><span class="op" id="2580294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2580297">func</span>&nbsp;<span class="ident" id="2580302">SetsockoptIPMreq</span><span class="op" id="2580318">(</span><span class="ident" id="2580319">fd</span><span class="op" id="2580321">,</span>&nbsp;<span class="ident" id="2580323">level</span><span class="op" id="2580328">,</span>&nbsp;<span class="ident" id="2580330">opt</span>&nbsp;<span class="builtintype" id="2580334">int</span><span class="op" id="2580337">,</span>&nbsp;<span class="ident" id="2580339">mreq</span>&nbsp;<span class="op" id="2580344">*</span><span class="ident" id="2580345">IPMreq</span><span class="op" id="2580351">)</span>&nbsp;<span class="op" id="2580353">(</span><span class="ident" id="2580354">err</span>&nbsp;<span class="builtintype" id="2580358">error</span><span class="op" id="2580363">)</span>&nbsp;<span class="op" id="2580365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580368">return</span>&nbsp;<span class="ident" id="2580375">setsockopt</span><span class="op" id="2580385">(</span><span class="ident" id="2580386">fd</span><span class="op" id="2580388">,</span>&nbsp;<span class="ident" id="2580390">level</span><span class="op" id="2580395">,</span>&nbsp;<span class="ident" id="2580397">opt</span><span class="op" id="2580400">,</span>&nbsp;<span class="ident" id="2580402">unsafe</span><span class="op" id="2580408">.</span><span class="ident" id="2580409">Pointer</span><span class="op" id="2580416">(</span><span class="ident" id="2580417">mreq</span><span class="op" id="2580421">)</span><span class="op" id="2580422">,</span>&nbsp;<span class="ident" id="2580424">SizeofIPMreq</span><span class="op" id="2580436">)</span><br>
<span class="lineno"></span><span class="op" id="2580438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2580441">func</span>&nbsp;<span class="ident" id="2580446">SetsockoptIPv6Mreq</span><span class="op" id="2580464">(</span><span class="ident" id="2580465">fd</span><span class="op" id="2580467">,</span>&nbsp;<span class="ident" id="2580469">level</span><span class="op" id="2580474">,</span>&nbsp;<span class="ident" id="2580476">opt</span>&nbsp;<span class="builtintype" id="2580480">int</span><span class="op" id="2580483">,</span>&nbsp;<span class="ident" id="2580485">mreq</span>&nbsp;<span class="op" id="2580490">*</span><span class="ident" id="2580491">IPv6Mreq</span><span class="op" id="2580499">)</span>&nbsp;<span class="op" id="2580501">(</span><span class="ident" id="2580502">err</span>&nbsp;<span class="builtintype" id="2580506">error</span><span class="op" id="2580511">)</span>&nbsp;<span class="op" id="2580513">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580516">return</span>&nbsp;<span class="ident" id="2580523">setsockopt</span><span class="op" id="2580533">(</span><span class="ident" id="2580534">fd</span><span class="op" id="2580536">,</span>&nbsp;<span class="ident" id="2580538">level</span><span class="op" id="2580543">,</span>&nbsp;<span class="ident" id="2580545">opt</span><span class="op" id="2580548">,</span>&nbsp;<span class="ident" id="2580550">unsafe</span><span class="op" id="2580556">.</span><span class="ident" id="2580557">Pointer</span><span class="op" id="2580564">(</span><span class="ident" id="2580565">mreq</span><span class="op" id="2580569">)</span><span class="op" id="2580570">,</span>&nbsp;<span class="ident" id="2580572">SizeofIPv6Mreq</span><span class="op" id="2580586">)</span><br>
<span class="lineno"></span><span class="op" id="2580588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2580591">func</span>&nbsp;<span class="ident" id="2580596">SetsockoptICMPv6Filter</span><span class="op" id="2580618">(</span><span class="ident" id="2580619">fd</span><span class="op" id="2580621">,</span>&nbsp;<span class="ident" id="2580623">level</span><span class="op" id="2580628">,</span>&nbsp;<span class="ident" id="2580630">opt</span>&nbsp;<span class="builtintype" id="2580634">int</span><span class="op" id="2580637">,</span>&nbsp;<span class="ident" id="2580639">filter</span>&nbsp;<span class="op" id="2580646">*</span><span class="ident" id="2580647">ICMPv6Filter</span><span class="op" id="2580659">)</span>&nbsp;<span class="builtintype" id="2580661">error</span>&nbsp;<span class="op" id="2580667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580670">return</span>&nbsp;<span class="ident" id="2580677">setsockopt</span><span class="op" id="2580687">(</span><span class="ident" id="2580688">fd</span><span class="op" id="2580690">,</span>&nbsp;<span class="ident" id="2580692">level</span><span class="op" id="2580697">,</span>&nbsp;<span class="ident" id="2580699">opt</span><span class="op" id="2580702">,</span>&nbsp;<span class="ident" id="2580704">unsafe</span><span class="op" id="2580710">.</span><span class="ident" id="2580711">Pointer</span><span class="op" id="2580718">(</span><span class="ident" id="2580719">filter</span><span class="op" id="2580725">)</span><span class="op" id="2580726">,</span>&nbsp;<span class="ident" id="2580728">SizeofICMPv6Filter</span><span class="op" id="2580746">)</span><br>
<span class="lineno">260</span><span class="op" id="2580748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2580751">func</span>&nbsp;<span class="ident" id="2580756">SetsockoptLinger</span><span class="op" id="2580772">(</span><span class="ident" id="2580773">fd</span><span class="op" id="2580775">,</span>&nbsp;<span class="ident" id="2580777">level</span><span class="op" id="2580782">,</span>&nbsp;<span class="ident" id="2580784">opt</span>&nbsp;<span class="builtintype" id="2580788">int</span><span class="op" id="2580791">,</span>&nbsp;<span class="ident" id="2580793">l</span>&nbsp;<span class="op" id="2580795">*</span><span class="ident" id="2580796">Linger</span><span class="op" id="2580802">)</span>&nbsp;<span class="op" id="2580804">(</span><span class="ident" id="2580805">err</span>&nbsp;<span class="builtintype" id="2580809">error</span><span class="op" id="2580814">)</span>&nbsp;<span class="op" id="2580816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580819">return</span>&nbsp;<span class="ident" id="2580826">setsockopt</span><span class="op" id="2580836">(</span><span class="ident" id="2580837">fd</span><span class="op" id="2580839">,</span>&nbsp;<span class="ident" id="2580841">level</span><span class="op" id="2580846">,</span>&nbsp;<span class="ident" id="2580848">opt</span><span class="op" id="2580851">,</span>&nbsp;<span class="ident" id="2580853">unsafe</span><span class="op" id="2580859">.</span><span class="ident" id="2580860">Pointer</span><span class="op" id="2580867">(</span><span class="ident" id="2580868">l</span><span class="op" id="2580869">)</span><span class="op" id="2580870">,</span>&nbsp;<span class="ident" id="2580872">SizeofLinger</span><span class="op" id="2580884">)</span><br>
<span class="lineno"></span><span class="op" id="2580886">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2580889">func</span>&nbsp;<span class="ident" id="2580894">SetsockoptString</span><span class="op" id="2580910">(</span><span class="ident" id="2580911">fd</span><span class="op" id="2580913">,</span>&nbsp;<span class="ident" id="2580915">level</span><span class="op" id="2580920">,</span>&nbsp;<span class="ident" id="2580922">opt</span>&nbsp;<span class="builtintype" id="2580926">int</span><span class="op" id="2580929">,</span>&nbsp;<span class="ident" id="2580931">s</span>&nbsp;<span class="builtintype" id="2580933">string</span><span class="op" id="2580939">)</span>&nbsp;<span class="op" id="2580941">(</span><span class="ident" id="2580942">err</span>&nbsp;<span class="builtintype" id="2580946">error</span><span class="op" id="2580951">)</span>&nbsp;<span class="op" id="2580953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2580956">return</span>&nbsp;<span class="ident" id="2580963">setsockopt</span><span class="op" id="2580973">(</span><span class="ident" id="2580974">fd</span><span class="op" id="2580976">,</span>&nbsp;<span class="ident" id="2580978">level</span><span class="op" id="2580983">,</span>&nbsp;<span class="ident" id="2580985">opt</span><span class="op" id="2580988">,</span>&nbsp;<span class="ident" id="2580990">unsafe</span><span class="op" id="2580996">.</span><span class="ident" id="2580997">Pointer</span><span class="op" id="2581004">(</span><span class="op" id="2581005">&amp;</span><span class="op" id="2581006">[</span><span class="op" id="2581007">]</span><span class="builtintype" id="2581008">byte</span><span class="op" id="2581012">(</span><span class="ident" id="2581013">s</span><span class="op" id="2581014">)</span><span class="op" id="2581015">[</span><span class="num" id="2581016">0</span><span class="op" id="2581017">]</span><span class="op" id="2581018">)</span><span class="op" id="2581019">,</span>&nbsp;<span class="builtintype" id="2581021">uintptr</span><span class="op" id="2581028">(</span><span class="builtinfunc" id="2581029">len</span><span class="op" id="2581032">(</span><span class="ident" id="2581033">s</span><span class="op" id="2581034">)</span><span class="op" id="2581035">)</span><span class="op" id="2581036">)</span><br>
<span class="lineno"></span><span class="op" id="2581038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2581041">func</span>&nbsp;<span class="ident" id="2581046">SetsockoptTimeval</span><span class="op" id="2581063">(</span><span class="ident" id="2581064">fd</span><span class="op" id="2581066">,</span>&nbsp;<span class="ident" id="2581068">level</span><span class="op" id="2581073">,</span>&nbsp;<span class="ident" id="2581075">opt</span>&nbsp;<span class="builtintype" id="2581079">int</span><span class="op" id="2581082">,</span>&nbsp;<span class="ident" id="2581084">tv</span>&nbsp;<span class="op" id="2581087">*</span><span class="ident" id="2581088">Timeval</span><span class="op" id="2581095">)</span>&nbsp;<span class="op" id="2581097">(</span><span class="ident" id="2581098">err</span>&nbsp;<span class="builtintype" id="2581102">error</span><span class="op" id="2581107">)</span>&nbsp;<span class="op" id="2581109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581112">return</span>&nbsp;<span class="ident" id="2581119">setsockopt</span><span class="op" id="2581129">(</span><span class="ident" id="2581130">fd</span><span class="op" id="2581132">,</span>&nbsp;<span class="ident" id="2581134">level</span><span class="op" id="2581139">,</span>&nbsp;<span class="ident" id="2581141">opt</span><span class="op" id="2581144">,</span>&nbsp;<span class="ident" id="2581146">unsafe</span><span class="op" id="2581152">.</span><span class="ident" id="2581153">Pointer</span><span class="op" id="2581160">(</span><span class="ident" id="2581161">tv</span><span class="op" id="2581163">)</span><span class="op" id="2581164">,</span>&nbsp;<span class="ident" id="2581166">unsafe</span><span class="op" id="2581172">.</span><span class="ident" id="2581173">Sizeof</span><span class="op" id="2581179">(</span><span class="op" id="2581180">*</span><span class="ident" id="2581181">tv</span><span class="op" id="2581183">)</span><span class="op" id="2581184">)</span><br>
<span class="lineno"></span><span class="op" id="2581186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2581189">func</span>&nbsp;<span class="ident" id="2581194">Socket</span><span class="op" id="2581200">(</span><span class="ident" id="2581201">domain</span><span class="op" id="2581207">,</span>&nbsp;<span class="ident" id="2581209">typ</span><span class="op" id="2581212">,</span>&nbsp;<span class="ident" id="2581214">proto</span>&nbsp;<span class="builtintype" id="2581220">int</span><span class="op" id="2581223">)</span>&nbsp;<span class="op" id="2581225">(</span><span class="ident" id="2581226">fd</span>&nbsp;<span class="builtintype" id="2581229">int</span><span class="op" id="2581232">,</span>&nbsp;<span class="ident" id="2581234">err</span>&nbsp;<span class="builtintype" id="2581238">error</span><span class="op" id="2581243">)</span>&nbsp;<span class="op" id="2581245">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581248">if</span>&nbsp;<span class="ident" id="2581251">domain</span>&nbsp;<span class="op" id="2581258">==</span>&nbsp;<span class="ident" id="2581261">AF_INET6</span>&nbsp;<span class="op" id="2581270">&amp;&amp;</span>&nbsp;<span class="ident" id="2581273">SocketDisableIPv6</span>&nbsp;<span class="op" id="2581291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581295">return</span>&nbsp;<span class="op" id="2581302">-</span><span class="num" id="2581303">1</span><span class="op" id="2581304">,</span>&nbsp;<span class="ident" id="2581306">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581323">fd</span><span class="op" id="2581325">,</span>&nbsp;<span class="ident" id="2581327">err</span>&nbsp;<span class="op" id="2581331">=</span>&nbsp;<span class="ident" id="2581333">socket</span><span class="op" id="2581339">(</span><span class="ident" id="2581340">domain</span><span class="op" id="2581346">,</span>&nbsp;<span class="ident" id="2581348">typ</span><span class="op" id="2581351">,</span>&nbsp;<span class="ident" id="2581353">proto</span><span class="op" id="2581358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581361">return</span><br>
<span class="lineno">280</span><span class="op" id="2581368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2581371">func</span>&nbsp;<span class="ident" id="2581376">Socketpair</span><span class="op" id="2581386">(</span><span class="ident" id="2581387">domain</span><span class="op" id="2581393">,</span>&nbsp;<span class="ident" id="2581395">typ</span><span class="op" id="2581398">,</span>&nbsp;<span class="ident" id="2581400">proto</span>&nbsp;<span class="builtintype" id="2581406">int</span><span class="op" id="2581409">)</span>&nbsp;<span class="op" id="2581411">(</span><span class="ident" id="2581412">fd</span>&nbsp;<span class="op" id="2581415">[</span><span class="num" id="2581416">2</span><span class="op" id="2581417">]</span><span class="builtintype" id="2581418">int</span><span class="op" id="2581421">,</span>&nbsp;<span class="ident" id="2581423">err</span>&nbsp;<span class="builtintype" id="2581427">error</span><span class="op" id="2581432">)</span>&nbsp;<span class="op" id="2581434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581437">var</span>&nbsp;<span class="ident" id="2581441">fdx</span>&nbsp;<span class="op" id="2581445">[</span><span class="num" id="2581446">2</span><span class="op" id="2581447">]</span><span class="builtintype" id="2581448">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581455">err</span>&nbsp;<span class="op" id="2581459">=</span>&nbsp;<span class="ident" id="2581461">socketpair</span><span class="op" id="2581471">(</span><span class="ident" id="2581472">domain</span><span class="op" id="2581478">,</span>&nbsp;<span class="ident" id="2581480">typ</span><span class="op" id="2581483">,</span>&nbsp;<span class="ident" id="2581485">proto</span><span class="op" id="2581490">,</span>&nbsp;<span class="op" id="2581492">&amp;</span><span class="ident" id="2581493">fdx</span><span class="op" id="2581496">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581499">if</span>&nbsp;<span class="ident" id="2581502">err</span>&nbsp;<span class="op" id="2581506">==</span>&nbsp;<span class="ident" id="2581509">nil</span>&nbsp;<span class="op" id="2581513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581517">fd</span><span class="op" id="2581519">[</span><span class="num" id="2581520">0</span><span class="op" id="2581521">]</span>&nbsp;<span class="op" id="2581523">=</span>&nbsp;<span class="builtintype" id="2581525">int</span><span class="op" id="2581528">(</span><span class="ident" id="2581529">fdx</span><span class="op" id="2581532">[</span><span class="num" id="2581533">0</span><span class="op" id="2581534">]</span><span class="op" id="2581535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581539">fd</span><span class="op" id="2581541">[</span><span class="num" id="2581542">1</span><span class="op" id="2581543">]</span>&nbsp;<span class="op" id="2581545">=</span>&nbsp;<span class="builtintype" id="2581547">int</span><span class="op" id="2581550">(</span><span class="ident" id="2581551">fdx</span><span class="op" id="2581554">[</span><span class="num" id="2581555">1</span><span class="op" id="2581556">]</span><span class="op" id="2581557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581563">return</span><br>
<span class="lineno">290</span><span class="op" id="2581570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2581573">func</span>&nbsp;<span class="ident" id="2581578">Sendfile</span><span class="op" id="2581586">(</span><span class="ident" id="2581587">outfd</span>&nbsp;<span class="builtintype" id="2581593">int</span><span class="op" id="2581596">,</span>&nbsp;<span class="ident" id="2581598">infd</span>&nbsp;<span class="builtintype" id="2581603">int</span><span class="op" id="2581606">,</span>&nbsp;<span class="ident" id="2581608">offset</span>&nbsp;<span class="op" id="2581615">*</span><span class="ident" id="2581616">int64</span><span class="op" id="2581621">,</span>&nbsp;<span class="ident" id="2581623">count</span>&nbsp;<span class="builtintype" id="2581629">int</span><span class="op" id="2581632">)</span>&nbsp;<span class="op" id="2581634">(</span><span class="ident" id="2581635">written</span>&nbsp;<span class="builtintype" id="2581643">int</span><span class="op" id="2581646">,</span>&nbsp;<span class="ident" id="2581648">err</span>&nbsp;<span class="builtintype" id="2581652">error</span><span class="op" id="2581657">)</span>&nbsp;<span class="op" id="2581659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581662">if</span>&nbsp;<span class="ident" id="2581665">raceenabled</span>&nbsp;<span class="op" id="2581677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581681">raceReleaseMerge</span><span class="op" id="2581697">(</span><span class="ident" id="2581698">unsafe</span><span class="op" id="2581704">.</span><span class="ident" id="2581705">Pointer</span><span class="op" id="2581712">(</span><span class="op" id="2581713">&amp;</span><span class="ident" id="2581714">ioSync</span><span class="op" id="2581720">)</span><span class="op" id="2581721">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581727">return</span>&nbsp;<span class="ident" id="2581734">sendfile</span><span class="op" id="2581742">(</span><span class="ident" id="2581743">outfd</span><span class="op" id="2581748">,</span>&nbsp;<span class="ident" id="2581750">infd</span><span class="op" id="2581754">,</span>&nbsp;<span class="ident" id="2581756">offset</span><span class="op" id="2581762">,</span>&nbsp;<span class="ident" id="2581764">count</span><span class="op" id="2581769">)</span><br>
<span class="lineno"></span><span class="op" id="2581771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2581774">var</span>&nbsp;<span class="ident" id="2581778">ioSync</span>&nbsp;<span class="ident" id="2581785">int64</span>
</div>
</body>
</html>
