<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html" class="current">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5398769">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5398824">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5398878">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5398929">package</span>&nbsp;<span class="ident" id="5398937">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398942">import</span>&nbsp;<span class="op" id="5398949">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5398952">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5398958">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5398969">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5398976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5398979">//&nbsp;An&nbsp;Encoder&nbsp;manages&nbsp;the&nbsp;transmission&nbsp;of&nbsp;type&nbsp;and&nbsp;data&nbsp;information&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5399054">//&nbsp;other&nbsp;side&nbsp;of&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="5399085">type</span>&nbsp;<span class="ident" id="5399090">Encoder</span>&nbsp;<span class="keyword" id="5399098">struct</span>&nbsp;<span class="op" id="5399105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399108">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399119"><a href="/gostd/encoding/gob/encoder.go.html#5398969">sync</a></span><span class="op" id="5399123">.</span><span class="ident" id="5399124"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5399143">//&nbsp;each&nbsp;item&nbsp;must&nbsp;be&nbsp;sent&nbsp;atomically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399181">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5399192">[</span><span class="op" id="5399193">]</span><span class="ident" id="5399194"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5399196">.</span><span class="ident" id="5399197"><a href="/gostd/io/io.go.html#1422314">Writer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5399216">//&nbsp;where&nbsp;to&nbsp;send&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399243">sent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5399254">map</span><span class="op" id="5399257">[</span><span class="ident" id="5399258"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5399265">.</span><span class="ident" id="5399266"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="5399270">]</span><span class="ident" id="5399271"><a href="/gostd/encoding/gob/type.go.html#5413374">typeId</a></span>&nbsp;<span class="comment" id="5399278">//&nbsp;which&nbsp;types&nbsp;we&#39;ve&nbsp;already&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399313">countState</span>&nbsp;<span class="op" id="5399324">*</span><span class="ident" id="5399325"><a href="/gostd/encoding/gob/encode.go.html#5379125">encoderState</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5399348">//&nbsp;stage&nbsp;for&nbsp;writing&nbsp;counts</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399377">freeList</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5399388">*</span><span class="ident" id="5399389"><a href="/gostd/encoding/gob/encode.go.html#5379125">encoderState</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5399412">//&nbsp;list&nbsp;of&nbsp;free&nbsp;encoderStates;&nbsp;avoids&nbsp;reallocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399464">byteBuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399475"><a href="/gostd/encoding/gob/encode.go.html#5379677">encBuffer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5399499">//&nbsp;buffer&nbsp;for&nbsp;top-level&nbsp;encoderState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399537">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5399548">error</span><br>
<span class="lineno"></span><span class="op" id="5399554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5399557">//&nbsp;Before&nbsp;we&nbsp;encode&nbsp;a&nbsp;message,&nbsp;we&nbsp;reserve&nbsp;space&nbsp;at&nbsp;the&nbsp;head&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5399624">//&nbsp;buffer&nbsp;in&nbsp;which&nbsp;to&nbsp;encode&nbsp;its&nbsp;length.&nbsp;This&nbsp;means&nbsp;we&nbsp;can&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5399691">//&nbsp;buffer&nbsp;to&nbsp;assemble&nbsp;the&nbsp;message&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5399753">const</span>&nbsp;<span class="ident" id="5399759">maxLength</span>&nbsp;<span class="op" id="5399769">=</span>&nbsp;<span class="num" id="5399771">9</span>&nbsp;<span class="comment" id="5399773">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;an&nbsp;encoded&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5399811">var</span>&nbsp;<span class="ident" id="5399815">spaceForLength</span>&nbsp;<span class="op" id="5399830">=</span>&nbsp;<span class="builtinfunc" id="5399832">make</span><span class="op" id="5399836">(</span><span class="op" id="5399837">[</span><span class="op" id="5399838">]</span><span class="builtintype" id="5399839">byte</span><span class="op" id="5399843">,</span>&nbsp;<span class="ident" id="5399845"><a href="/gostd/encoding/gob/encoder.go.html#5399759">maxLength</a></span><span class="op" id="5399854">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5399857">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;will&nbsp;transmit&nbsp;on&nbsp;the&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5399930">func</span>&nbsp;<span class="ident" id="5399935">NewEncoder</span><span class="op" id="5399945">(</span><span class="ident" id="5399946">w</span>&nbsp;<span class="ident" id="5399948"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5399950">.</span><span class="ident" id="5399951"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5399957">)</span>&nbsp;<span class="op" id="5399959">*</span><span class="ident" id="5399960"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span>&nbsp;<span class="op" id="5399968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399971">enc</span>&nbsp;<span class="op" id="5399975">:=</span>&nbsp;<span class="builtinfunc" id="5399978">new</span><span class="op" id="5399981">(</span><span class="ident" id="5399982"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5399989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399992"><a href="/gostd/encoding/gob/encoder.go.html#5399971">enc</a></span><span class="op" id="5399995">.</span><span class="ident" id="5399996"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span>&nbsp;<span class="op" id="5399998">=</span>&nbsp;<span class="op" id="5400000">[</span><span class="op" id="5400001">]</span><span class="ident" id="5400002"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5400004">.</span><span class="ident" id="5400005"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5400011">{</span><span class="ident" id="5400012"><a href="/gostd/encoding/gob/encoder.go.html#5399946">w</a></span><span class="op" id="5400013">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400016"><a href="/gostd/encoding/gob/encoder.go.html#5399971">enc</a></span><span class="op" id="5400019">.</span><span class="ident" id="5400020"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span>&nbsp;<span class="op" id="5400025">=</span>&nbsp;<span class="builtinfunc" id="5400027">make</span><span class="op" id="5400031">(</span><span class="keyword" id="5400032">map</span><span class="op" id="5400035">[</span><span class="ident" id="5400036"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5400043">.</span><span class="ident" id="5400044"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="5400048">]</span><span class="ident" id="5400049"><a href="/gostd/encoding/gob/type.go.html#5413374">typeId</a></span><span class="op" id="5400055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400058"><a href="/gostd/encoding/gob/encoder.go.html#5399971">enc</a></span><span class="op" id="5400061">.</span><span class="ident" id="5400062"><a href="/gostd/encoding/gob/encoder.go.html#5399313">countState</a></span>&nbsp;<span class="op" id="5400073">=</span>&nbsp;<span class="ident" id="5400075"><a href="/gostd/encoding/gob/encoder.go.html#5399971">enc</a></span><span class="op" id="5400078">.</span><span class="ident" id="5400079"><a href="/gostd/encoding/gob/encode.go.html#5380172">newEncoderState</a></span><span class="op" id="5400094">(</span><span class="builtinfunc" id="5400095">new</span><span class="op" id="5400098">(</span><span class="ident" id="5400099"><a href="/gostd/encoding/gob/encode.go.html#5379677">encBuffer</a></span><span class="op" id="5400108">)</span><span class="op" id="5400109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5400112">return</span>&nbsp;<span class="ident" id="5400119"><a href="/gostd/encoding/gob/encoder.go.html#5399971">enc</a></span><br>
<span class="lineno"></span><span class="op" id="5400123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="5400126">//&nbsp;writer()&nbsp;returns&nbsp;the&nbsp;innermost&nbsp;writer&nbsp;the&nbsp;encoder&nbsp;is&nbsp;using</span><br>
<span class="lineno"></span><span class="keyword" id="5400188">func</span>&nbsp;<span class="op" id="5400193">(</span><span class="ident" id="5400194">enc</span>&nbsp;<span class="op" id="5400198">*</span><span class="ident" id="5400199"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5400206">)</span>&nbsp;<span class="ident" id="5400208">writer</span><span class="op" id="5400214">(</span><span class="op" id="5400215">)</span>&nbsp;<span class="ident" id="5400217"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5400219">.</span><span class="ident" id="5400220"><a href="/gostd/io/io.go.html#1422314">Writer</a></span>&nbsp;<span class="op" id="5400227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5400230">return</span>&nbsp;<span class="ident" id="5400237"><a href="/gostd/encoding/gob/encoder.go.html#5400194">enc</a></span><span class="op" id="5400240">.</span><span class="ident" id="5400241"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span><span class="op" id="5400242">[</span><span class="builtinfunc" id="5400243">len</span><span class="op" id="5400246">(</span><span class="ident" id="5400247"><a href="/gostd/encoding/gob/encoder.go.html#5400194">enc</a></span><span class="op" id="5400250">.</span><span class="ident" id="5400251"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span><span class="op" id="5400252">)</span><span class="op" id="5400253">-</span><span class="num" id="5400254">1</span><span class="op" id="5400255">]</span><br>
<span class="lineno"></span><span class="op" id="5400257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5400260">//&nbsp;pushWriter&nbsp;adds&nbsp;a&nbsp;writer&nbsp;to&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5400304">func</span>&nbsp;<span class="op" id="5400309">(</span><span class="ident" id="5400310">enc</span>&nbsp;<span class="op" id="5400314">*</span><span class="ident" id="5400315"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5400322">)</span>&nbsp;<span class="ident" id="5400324">pushWriter</span><span class="op" id="5400334">(</span><span class="ident" id="5400335">w</span>&nbsp;<span class="ident" id="5400337"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5400339">.</span><span class="ident" id="5400340"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5400346">)</span>&nbsp;<span class="op" id="5400348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400351"><a href="/gostd/encoding/gob/encoder.go.html#5400310">enc</a></span><span class="op" id="5400354">.</span><span class="ident" id="5400355"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span>&nbsp;<span class="op" id="5400357">=</span>&nbsp;<span class="builtinfunc" id="5400359">append</span><span class="op" id="5400365">(</span><span class="ident" id="5400366"><a href="/gostd/encoding/gob/encoder.go.html#5400310">enc</a></span><span class="op" id="5400369">.</span><span class="ident" id="5400370"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span><span class="op" id="5400371">,</span>&nbsp;<span class="ident" id="5400373"><a href="/gostd/encoding/gob/encoder.go.html#5400335">w</a></span><span class="op" id="5400374">)</span><br>
<span class="lineno"></span><span class="op" id="5400376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5400379">//&nbsp;popWriter&nbsp;pops&nbsp;the&nbsp;innermost&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5400419">func</span>&nbsp;<span class="op" id="5400424">(</span><span class="ident" id="5400425">enc</span>&nbsp;<span class="op" id="5400429">*</span><span class="ident" id="5400430"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5400437">)</span>&nbsp;<span class="ident" id="5400439">popWriter</span><span class="op" id="5400448">(</span><span class="op" id="5400449">)</span>&nbsp;<span class="op" id="5400451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400454"><a href="/gostd/encoding/gob/encoder.go.html#5400425">enc</a></span><span class="op" id="5400457">.</span><span class="ident" id="5400458"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span>&nbsp;<span class="op" id="5400460">=</span>&nbsp;<span class="ident" id="5400462"><a href="/gostd/encoding/gob/encoder.go.html#5400425">enc</a></span><span class="op" id="5400465">.</span><span class="ident" id="5400466"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span><span class="op" id="5400467">[</span><span class="num" id="5400468">0</span>&nbsp;<span class="op" id="5400470">:</span>&nbsp;<span class="builtinfunc" id="5400472">len</span><span class="op" id="5400475">(</span><span class="ident" id="5400476"><a href="/gostd/encoding/gob/encoder.go.html#5400425">enc</a></span><span class="op" id="5400479">.</span><span class="ident" id="5400480"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span><span class="op" id="5400481">)</span><span class="op" id="5400482">-</span><span class="num" id="5400483">1</span><span class="op" id="5400484">]</span><br>
<span class="lineno"></span><span class="op" id="5400486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5400489">func</span>&nbsp;<span class="op" id="5400494">(</span><span class="ident" id="5400495">enc</span>&nbsp;<span class="op" id="5400499">*</span><span class="ident" id="5400500"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5400507">)</span>&nbsp;<span class="ident" id="5400509">setError</span><span class="op" id="5400517">(</span><span class="ident" id="5400518">err</span>&nbsp;<span class="builtintype" id="5400522">error</span><span class="op" id="5400527">)</span>&nbsp;<span class="op" id="5400529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5400532">if</span>&nbsp;<span class="ident" id="5400535"><a href="/gostd/encoding/gob/encoder.go.html#5400495">enc</a></span><span class="op" id="5400538">.</span><span class="ident" id="5400539"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5400543">==</span>&nbsp;<span class="builtintype" id="5400546">nil</span>&nbsp;<span class="op" id="5400550">{</span>&nbsp;<span class="comment" id="5400552">//&nbsp;remember&nbsp;the&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400577"><a href="/gostd/encoding/gob/encoder.go.html#5400495">enc</a></span><span class="op" id="5400580">.</span><span class="ident" id="5400581"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5400585">=</span>&nbsp;<span class="ident" id="5400587"><a href="/gostd/encoding/gob/encoder.go.html#5400518">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5400592">}</span><br>
<span class="lineno"></span><span class="op" id="5400594">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5400597">//&nbsp;writeMessage&nbsp;sends&nbsp;the&nbsp;data&nbsp;item&nbsp;preceded&nbsp;by&nbsp;a&nbsp;unsigned&nbsp;count&nbsp;of&nbsp;its&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5400677">func</span>&nbsp;<span class="op" id="5400682">(</span><span class="ident" id="5400683">enc</span>&nbsp;<span class="op" id="5400687">*</span><span class="ident" id="5400688"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5400695">)</span>&nbsp;<span class="ident" id="5400697">writeMessage</span><span class="op" id="5400709">(</span><span class="ident" id="5400710">w</span>&nbsp;<span class="ident" id="5400712"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5400714">.</span><span class="ident" id="5400715"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5400721">,</span>&nbsp;<span class="ident" id="5400723">b</span>&nbsp;<span class="op" id="5400725">*</span><span class="ident" id="5400726"><a href="/gostd/encoding/gob/encode.go.html#5379677">encBuffer</a></span><span class="op" id="5400735">)</span>&nbsp;<span class="op" id="5400737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5400740">//&nbsp;Space&nbsp;has&nbsp;been&nbsp;reserved&nbsp;for&nbsp;the&nbsp;length&nbsp;at&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5400811">//&nbsp;This&nbsp;is&nbsp;a&nbsp;little&nbsp;dirty:&nbsp;we&nbsp;grab&nbsp;the&nbsp;slice&nbsp;from&nbsp;the&nbsp;bytes.Buffer&nbsp;and&nbsp;massage</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5400891">//&nbsp;it&nbsp;by&nbsp;hand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400907">message</span>&nbsp;<span class="op" id="5400915">:=</span>&nbsp;<span class="ident" id="5400918"><a href="/gostd/encoding/gob/encoder.go.html#5400723">b</a></span><span class="op" id="5400919">.</span><span class="ident" id="5400920"><a href="/gostd/encoding/gob/encode.go.html#5380062">Bytes</a></span><span class="op" id="5400925">(</span><span class="op" id="5400926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400929">messageLen</span>&nbsp;<span class="op" id="5400940">:=</span>&nbsp;<span class="builtinfunc" id="5400943">len</span><span class="op" id="5400946">(</span><span class="ident" id="5400947"><a href="/gostd/encoding/gob/encoder.go.html#5400907">message</a></span><span class="op" id="5400954">)</span>&nbsp;<span class="op" id="5400956">-</span>&nbsp;<span class="ident" id="5400958"><a href="/gostd/encoding/gob/encoder.go.html#5399759">maxLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5400969">//&nbsp;Encode&nbsp;the&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400992"><a href="/gostd/encoding/gob/encoder.go.html#5400683">enc</a></span><span class="op" id="5400995">.</span><span class="ident" id="5400996"><a href="/gostd/encoding/gob/encoder.go.html#5399313">countState</a></span><span class="op" id="5401006">.</span><span class="ident" id="5401007"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5401008">.</span><span class="ident" id="5401009"><a href="/gostd/encoding/gob/encode.go.html#5380117">Reset</a></span><span class="op" id="5401014">(</span><span class="op" id="5401015">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401018"><a href="/gostd/encoding/gob/encoder.go.html#5400683">enc</a></span><span class="op" id="5401021">.</span><span class="ident" id="5401022"><a href="/gostd/encoding/gob/encoder.go.html#5399313">countState</a></span><span class="op" id="5401032">.</span><span class="ident" id="5401033"><a href="/gostd/encoding/gob/encode.go.html#5380858">encodeUint</a></span><span class="op" id="5401043">(</span><span class="builtintype" id="5401044">uint64</span><span class="op" id="5401050">(</span><span class="ident" id="5401051"><a href="/gostd/encoding/gob/encoder.go.html#5400929">messageLen</a></span><span class="op" id="5401061">)</span><span class="op" id="5401062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5401065">//&nbsp;Copy&nbsp;the&nbsp;length&nbsp;to&nbsp;be&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401116">offset</span>&nbsp;<span class="op" id="5401123">:=</span>&nbsp;<span class="ident" id="5401126"><a href="/gostd/encoding/gob/encoder.go.html#5399759">maxLength</a></span>&nbsp;<span class="op" id="5401136">-</span>&nbsp;<span class="ident" id="5401138"><a href="/gostd/encoding/gob/encoder.go.html#5400683">enc</a></span><span class="op" id="5401141">.</span><span class="ident" id="5401142"><a href="/gostd/encoding/gob/encoder.go.html#5399313">countState</a></span><span class="op" id="5401152">.</span><span class="ident" id="5401153"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5401154">.</span><span class="ident" id="5401155"><a href="/gostd/encoding/gob/encode.go.html#5380007">Len</a></span><span class="op" id="5401158">(</span><span class="op" id="5401159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5401162">copy</span><span class="op" id="5401166">(</span><span class="ident" id="5401167"><a href="/gostd/encoding/gob/encoder.go.html#5400907">message</a></span><span class="op" id="5401174">[</span><span class="ident" id="5401175"><a href="/gostd/encoding/gob/encoder.go.html#5401116">offset</a></span><span class="op" id="5401181">:</span><span class="op" id="5401182">]</span><span class="op" id="5401183">,</span>&nbsp;<span class="ident" id="5401185"><a href="/gostd/encoding/gob/encoder.go.html#5400683">enc</a></span><span class="op" id="5401188">.</span><span class="ident" id="5401189"><a href="/gostd/encoding/gob/encoder.go.html#5399313">countState</a></span><span class="op" id="5401199">.</span><span class="ident" id="5401200"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5401201">.</span><span class="ident" id="5401202"><a href="/gostd/encoding/gob/encode.go.html#5380062">Bytes</a></span><span class="op" id="5401207">(</span><span class="op" id="5401208">)</span><span class="op" id="5401209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5401212">//&nbsp;Write&nbsp;the&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401232">_</span><span class="op" id="5401233">,</span>&nbsp;<span class="ident" id="5401235">err</span>&nbsp;<span class="op" id="5401239">:=</span>&nbsp;<span class="ident" id="5401242"><a href="/gostd/encoding/gob/encoder.go.html#5400710">w</a></span><span class="op" id="5401243">.</span><span class="ident" id="5401244"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5401249">(</span><span class="ident" id="5401250"><a href="/gostd/encoding/gob/encoder.go.html#5400907">message</a></span><span class="op" id="5401257">[</span><span class="ident" id="5401258"><a href="/gostd/encoding/gob/encoder.go.html#5401116">offset</a></span><span class="op" id="5401264">:</span><span class="op" id="5401265">]</span><span class="op" id="5401266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5401269">//&nbsp;Drain&nbsp;the&nbsp;buffer&nbsp;and&nbsp;restore&nbsp;the&nbsp;space&nbsp;at&nbsp;the&nbsp;front&nbsp;for&nbsp;the&nbsp;count&nbsp;of&nbsp;the&nbsp;next&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401360"><a href="/gostd/encoding/gob/encoder.go.html#5400723">b</a></span><span class="op" id="5401361">.</span><span class="ident" id="5401362"><a href="/gostd/encoding/gob/encode.go.html#5380117">Reset</a></span><span class="op" id="5401367">(</span><span class="op" id="5401368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401371"><a href="/gostd/encoding/gob/encoder.go.html#5400723">b</a></span><span class="op" id="5401372">.</span><span class="ident" id="5401373"><a href="/gostd/encoding/gob/encode.go.html#5379824">Write</a></span><span class="op" id="5401378">(</span><span class="ident" id="5401379"><a href="/gostd/encoding/gob/encoder.go.html#5399815">spaceForLength</a></span><span class="op" id="5401393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5401396">if</span>&nbsp;<span class="ident" id="5401399"><a href="/gostd/encoding/gob/encoder.go.html#5401235">err</a></span>&nbsp;<span class="op" id="5401403">!=</span>&nbsp;<span class="builtintype" id="5401406">nil</span>&nbsp;<span class="op" id="5401410">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401414"><a href="/gostd/encoding/gob/encoder.go.html#5400683">enc</a></span><span class="op" id="5401417">.</span><span class="ident" id="5401418"><a href="/gostd/encoding/gob/encoder.go.html#5400509">setError</a></span><span class="op" id="5401426">(</span><span class="ident" id="5401427"><a href="/gostd/encoding/gob/encoder.go.html#5401235">err</a></span><span class="op" id="5401430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5401433">}</span><br>
<span class="lineno"></span><span class="op" id="5401435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5401438">//&nbsp;sendActualType&nbsp;sends&nbsp;the&nbsp;requested&nbsp;type,&nbsp;without&nbsp;further&nbsp;investigation,&nbsp;unless</span><br>
<span class="lineno">85</span><span class="comment" id="5401520">//&nbsp;it&#39;s&nbsp;been&nbsp;sent&nbsp;before.</span><br>
<span class="lineno"></span><span class="keyword" id="5401546">func</span>&nbsp;<span class="op" id="5401551">(</span><span class="ident" id="5401552">enc</span>&nbsp;<span class="op" id="5401556">*</span><span class="ident" id="5401557"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5401564">)</span>&nbsp;<span class="ident" id="5401566">sendActualType</span><span class="op" id="5401580">(</span><span class="ident" id="5401581">w</span>&nbsp;<span class="ident" id="5401583"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5401585">.</span><span class="ident" id="5401586"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5401592">,</span>&nbsp;<span class="ident" id="5401594">state</span>&nbsp;<span class="op" id="5401600">*</span><span class="ident" id="5401601"><a href="/gostd/encoding/gob/encode.go.html#5379125">encoderState</a></span><span class="op" id="5401613">,</span>&nbsp;<span class="ident" id="5401615">ut</span>&nbsp;<span class="op" id="5401618">*</span><span class="ident" id="5401619"><a href="/gostd/encoding/gob/type.go.html#5408173">userTypeInfo</a></span><span class="op" id="5401631">,</span>&nbsp;<span class="ident" id="5401633">actual</span>&nbsp;<span class="ident" id="5401640"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5401647">.</span><span class="ident" id="5401648"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="5401652">)</span>&nbsp;<span class="op" id="5401654">(</span><span class="ident" id="5401655">sent</span>&nbsp;<span class="builtintype" id="5401660">bool</span><span class="op" id="5401664">)</span>&nbsp;<span class="op" id="5401666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5401669">if</span>&nbsp;<span class="ident" id="5401672">_</span><span class="op" id="5401673">,</span>&nbsp;<span class="ident" id="5401675">alreadySent</span>&nbsp;<span class="op" id="5401687">:=</span>&nbsp;<span class="ident" id="5401690"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5401693">.</span><span class="ident" id="5401694"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span><span class="op" id="5401698">[</span><span class="ident" id="5401699"><a href="/gostd/encoding/gob/encoder.go.html#5401633">actual</a></span><span class="op" id="5401705">]</span><span class="op" id="5401706">;</span>&nbsp;<span class="ident" id="5401708"><a href="/gostd/encoding/gob/encoder.go.html#5401675">alreadySent</a></span>&nbsp;<span class="op" id="5401720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5401724">return</span>&nbsp;<span class="builtintype" id="5401731">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5401738">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401741">info</span><span class="op" id="5401745">,</span>&nbsp;<span class="ident" id="5401747">err</span>&nbsp;<span class="op" id="5401751">:=</span>&nbsp;<span class="ident" id="5401754"><a href="/gostd/encoding/gob/type.go.html#5428443">getTypeInfo</a></span><span class="op" id="5401765">(</span><span class="ident" id="5401766"><a href="/gostd/encoding/gob/encoder.go.html#5401615">ut</a></span><span class="op" id="5401768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5401771">if</span>&nbsp;<span class="ident" id="5401774"><a href="/gostd/encoding/gob/encoder.go.html#5401747">err</a></span>&nbsp;<span class="op" id="5401778">!=</span>&nbsp;<span class="builtintype" id="5401781">nil</span>&nbsp;<span class="op" id="5401785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401789"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5401792">.</span><span class="ident" id="5401793"><a href="/gostd/encoding/gob/encoder.go.html#5400509">setError</a></span><span class="op" id="5401801">(</span><span class="ident" id="5401802"><a href="/gostd/encoding/gob/encoder.go.html#5401747">err</a></span><span class="op" id="5401805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5401809">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5401817">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5401820">//&nbsp;Send&nbsp;the&nbsp;pair&nbsp;(-id,&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5401850">//&nbsp;Id:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401858"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5401863">.</span><span class="ident" id="5401864"><a href="/gostd/encoding/gob/encode.go.html#5381323">encodeInt</a></span><span class="op" id="5401873">(</span><span class="op" id="5401874">-</span><span class="builtintype" id="5401875">int64</span><span class="op" id="5401880">(</span><span class="ident" id="5401881"><a href="/gostd/encoding/gob/encoder.go.html#5401741">info</a></span><span class="op" id="5401885">.</span><span class="ident" id="5401886"><a href="/gostd/encoding/gob/type.go.html#5427792">id</a></span><span class="op" id="5401888">)</span><span class="op" id="5401889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5401892">//&nbsp;Type:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401902"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5401905">.</span><span class="ident" id="5401906"><a href="/gostd/encoding/gob/encode.go.html#5398347">encode</a></span><span class="op" id="5401912">(</span><span class="ident" id="5401913"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5401918">.</span><span class="ident" id="5401919"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5401920">,</span>&nbsp;<span class="ident" id="5401922"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5401929">.</span><span class="ident" id="5401930"><a href="/gostd/reflect/value.go.html#2892536">ValueOf</a></span><span class="op" id="5401937">(</span><span class="ident" id="5401938"><a href="/gostd/encoding/gob/encoder.go.html#5401741">info</a></span><span class="op" id="5401942">.</span><span class="ident" id="5401943"><a href="/gostd/encoding/gob/type.go.html#5427898">wire</a></span><span class="op" id="5401947">)</span><span class="op" id="5401948">,</span>&nbsp;<span class="ident" id="5401950"><a href="/gostd/encoding/gob/type.go.html#5416532">wireTypeUserInfo</a></span><span class="op" id="5401966">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5401969"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5401972">.</span><span class="ident" id="5401973"><a href="/gostd/encoding/gob/encoder.go.html#5400697">writeMessage</a></span><span class="op" id="5401985">(</span><span class="ident" id="5401986"><a href="/gostd/encoding/gob/encoder.go.html#5401581">w</a></span><span class="op" id="5401987">,</span>&nbsp;<span class="ident" id="5401989"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5401994">.</span><span class="ident" id="5401995"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5401996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5401999">if</span>&nbsp;<span class="ident" id="5402002"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402005">.</span><span class="ident" id="5402006"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5402010">!=</span>&nbsp;<span class="builtintype" id="5402013">nil</span>&nbsp;<span class="op" id="5402017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402021">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5402029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402033">//&nbsp;Remember&nbsp;we&#39;ve&nbsp;sent&nbsp;this&nbsp;type,&nbsp;both&nbsp;what&nbsp;the&nbsp;user&nbsp;gave&nbsp;us&nbsp;and&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402114"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402117">.</span><span class="ident" id="5402118"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span><span class="op" id="5402122">[</span><span class="ident" id="5402123"><a href="/gostd/encoding/gob/encoder.go.html#5401615">ut</a></span><span class="op" id="5402125">.</span><span class="ident" id="5402126"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span><span class="op" id="5402130">]</span>&nbsp;<span class="op" id="5402132">=</span>&nbsp;<span class="ident" id="5402134"><a href="/gostd/encoding/gob/encoder.go.html#5401741">info</a></span><span class="op" id="5402138">.</span><span class="ident" id="5402139"><a href="/gostd/encoding/gob/type.go.html#5427792">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402143">if</span>&nbsp;<span class="ident" id="5402146"><a href="/gostd/encoding/gob/encoder.go.html#5401615">ut</a></span><span class="op" id="5402148">.</span><span class="ident" id="5402149"><a href="/gostd/encoding/gob/type.go.html#5408196">user</a></span>&nbsp;<span class="op" id="5402154">!=</span>&nbsp;<span class="ident" id="5402157"><a href="/gostd/encoding/gob/encoder.go.html#5401615">ut</a></span><span class="op" id="5402159">.</span><span class="ident" id="5402160"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span>&nbsp;<span class="op" id="5402165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402169"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402172">.</span><span class="ident" id="5402173"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span><span class="op" id="5402177">[</span><span class="ident" id="5402178"><a href="/gostd/encoding/gob/encoder.go.html#5401615">ut</a></span><span class="op" id="5402180">.</span><span class="ident" id="5402181"><a href="/gostd/encoding/gob/type.go.html#5408196">user</a></span><span class="op" id="5402185">]</span>&nbsp;<span class="op" id="5402187">=</span>&nbsp;<span class="ident" id="5402189"><a href="/gostd/encoding/gob/encoder.go.html#5401741">info</a></span><span class="op" id="5402193">.</span><span class="ident" id="5402194"><a href="/gostd/encoding/gob/type.go.html#5427792">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5402198">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402201">//&nbsp;Now&nbsp;send&nbsp;the&nbsp;inner&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402230">switch</span>&nbsp;<span class="ident" id="5402237">st</span>&nbsp;<span class="op" id="5402240">:=</span>&nbsp;<span class="ident" id="5402243"><a href="/gostd/encoding/gob/encoder.go.html#5401633">actual</a></span><span class="op" id="5402249">;</span>&nbsp;<span class="ident" id="5402251"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402253">.</span><span class="ident" id="5402254"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="5402258">(</span><span class="op" id="5402259">)</span>&nbsp;<span class="op" id="5402261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402264">case</span>&nbsp;<span class="ident" id="5402269"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5402276">.</span><span class="ident" id="5402277"><a href="/gostd/reflect/type.go.html#2788077">Struct</a></span><span class="op" id="5402283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402287">for</span>&nbsp;<span class="ident" id="5402291">i</span>&nbsp;<span class="op" id="5402293">:=</span>&nbsp;<span class="num" id="5402296">0</span><span class="op" id="5402297">;</span>&nbsp;<span class="ident" id="5402299"><a href="/gostd/encoding/gob/encoder.go.html#5402291">i</a></span>&nbsp;<span class="op" id="5402301">&lt;</span>&nbsp;<span class="ident" id="5402303"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402305">.</span><span class="ident" id="5402306"><a href="/gostd/reflect/type.go.html#2786550">NumField</a></span><span class="op" id="5402314">(</span><span class="op" id="5402315">)</span><span class="op" id="5402316">;</span>&nbsp;<span class="ident" id="5402318"><a href="/gostd/encoding/gob/encoder.go.html#5402291">i</a></span><span class="op" id="5402319">++</span>&nbsp;<span class="op" id="5402322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402327">if</span>&nbsp;<span class="ident" id="5402330"><a href="/gostd/encoding/gob/type.go.html#5424238">isExported</a></span><span class="op" id="5402340">(</span><span class="ident" id="5402341"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402343">.</span><span class="ident" id="5402344"><a href="/gostd/reflect/type.go.html#2785427">Field</a></span><span class="op" id="5402349">(</span><span class="ident" id="5402350"><a href="/gostd/encoding/gob/encoder.go.html#5402291">i</a></span><span class="op" id="5402351">)</span><span class="op" id="5402352">.</span><span class="ident" id="5402353"><a href="/gostd/reflect/type.go.html#2801001">Name</a></span><span class="op" id="5402357">)</span>&nbsp;<span class="op" id="5402359">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402365"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402368">.</span><span class="ident" id="5402369"><a href="/gostd/encoding/gob/encoder.go.html#5402681">sendType</a></span><span class="op" id="5402377">(</span><span class="ident" id="5402378"><a href="/gostd/encoding/gob/encoder.go.html#5401581">w</a></span><span class="op" id="5402379">,</span>&nbsp;<span class="ident" id="5402381"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5402386">,</span>&nbsp;<span class="ident" id="5402388"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402390">.</span><span class="ident" id="5402391"><a href="/gostd/reflect/type.go.html#2785427">Field</a></span><span class="op" id="5402396">(</span><span class="ident" id="5402397"><a href="/gostd/encoding/gob/encoder.go.html#5402291">i</a></span><span class="op" id="5402398">)</span><span class="op" id="5402399">.</span><span class="ident" id="5402400"><a href="/gostd/reflect/type.go.html#2801034">Type</a></span><span class="op" id="5402404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5402409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5402413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402416">case</span>&nbsp;<span class="ident" id="5402421"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5402428">.</span><span class="ident" id="5402429"><a href="/gostd/reflect/type.go.html#2788022">Array</a></span><span class="op" id="5402434">,</span>&nbsp;<span class="ident" id="5402436"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5402443">.</span><span class="ident" id="5402444"><a href="/gostd/reflect/type.go.html#2788062">Slice</a></span><span class="op" id="5402449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402453"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402456">.</span><span class="ident" id="5402457"><a href="/gostd/encoding/gob/encoder.go.html#5402681">sendType</a></span><span class="op" id="5402465">(</span><span class="ident" id="5402466"><a href="/gostd/encoding/gob/encoder.go.html#5401581">w</a></span><span class="op" id="5402467">,</span>&nbsp;<span class="ident" id="5402469"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5402474">,</span>&nbsp;<span class="ident" id="5402476"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402478">.</span><span class="ident" id="5402479"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5402483">(</span><span class="op" id="5402484">)</span><span class="op" id="5402485">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402488">case</span>&nbsp;<span class="ident" id="5402493"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5402500">.</span><span class="ident" id="5402501"><a href="/gostd/reflect/type.go.html#2788052">Map</a></span><span class="op" id="5402504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402508"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402511">.</span><span class="ident" id="5402512"><a href="/gostd/encoding/gob/encoder.go.html#5402681">sendType</a></span><span class="op" id="5402520">(</span><span class="ident" id="5402521"><a href="/gostd/encoding/gob/encoder.go.html#5401581">w</a></span><span class="op" id="5402522">,</span>&nbsp;<span class="ident" id="5402524"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5402529">,</span>&nbsp;<span class="ident" id="5402531"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402533">.</span><span class="ident" id="5402534"><a href="/gostd/reflect/type.go.html#2786340">Key</a></span><span class="op" id="5402537">(</span><span class="op" id="5402538">)</span><span class="op" id="5402539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402543"><a href="/gostd/encoding/gob/encoder.go.html#5401552">enc</a></span><span class="op" id="5402546">.</span><span class="ident" id="5402547"><a href="/gostd/encoding/gob/encoder.go.html#5402681">sendType</a></span><span class="op" id="5402555">(</span><span class="ident" id="5402556"><a href="/gostd/encoding/gob/encoder.go.html#5401581">w</a></span><span class="op" id="5402557">,</span>&nbsp;<span class="ident" id="5402559"><a href="/gostd/encoding/gob/encoder.go.html#5401594">state</a></span><span class="op" id="5402564">,</span>&nbsp;<span class="ident" id="5402566"><a href="/gostd/encoding/gob/encoder.go.html#5402237">st</a></span><span class="op" id="5402568">.</span><span class="ident" id="5402569"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5402573">(</span><span class="op" id="5402574">)</span><span class="op" id="5402575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5402578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402581">return</span>&nbsp;<span class="builtintype" id="5402588">true</span><br>
<span class="lineno">125</span><span class="op" id="5402593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5402596">//&nbsp;sendType&nbsp;sends&nbsp;the&nbsp;type&nbsp;info&nbsp;to&nbsp;the&nbsp;other&nbsp;side,&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5402661">func</span>&nbsp;<span class="op" id="5402666">(</span><span class="ident" id="5402667">enc</span>&nbsp;<span class="op" id="5402671">*</span><span class="ident" id="5402672"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5402679">)</span>&nbsp;<span class="ident" id="5402681">sendType</span><span class="op" id="5402689">(</span><span class="ident" id="5402690">w</span>&nbsp;<span class="ident" id="5402692"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5402694">.</span><span class="ident" id="5402695"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5402701">,</span>&nbsp;<span class="ident" id="5402703">state</span>&nbsp;<span class="op" id="5402709">*</span><span class="ident" id="5402710"><a href="/gostd/encoding/gob/encode.go.html#5379125">encoderState</a></span><span class="op" id="5402722">,</span>&nbsp;<span class="ident" id="5402724">origt</span>&nbsp;<span class="ident" id="5402730"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5402737">.</span><span class="ident" id="5402738"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="5402742">)</span>&nbsp;<span class="op" id="5402744">(</span><span class="ident" id="5402745">sent</span>&nbsp;<span class="builtintype" id="5402750">bool</span><span class="op" id="5402754">)</span>&nbsp;<span class="op" id="5402756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402759">ut</span>&nbsp;<span class="op" id="5402762">:=</span>&nbsp;<span class="ident" id="5402765"><a href="/gostd/encoding/gob/type.go.html#5413083">userType</a></span><span class="op" id="5402773">(</span><span class="ident" id="5402774"><a href="/gostd/encoding/gob/encoder.go.html#5402724">origt</a></span><span class="op" id="5402779">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402782">if</span>&nbsp;<span class="ident" id="5402785"><a href="/gostd/encoding/gob/encoder.go.html#5402759">ut</a></span><span class="op" id="5402787">.</span><span class="ident" id="5402788"><a href="/gostd/encoding/gob/type.go.html#5408394">externalEnc</a></span>&nbsp;<span class="op" id="5402800">!=</span>&nbsp;<span class="num" id="5402803">0</span>&nbsp;<span class="op" id="5402805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402809">//&nbsp;The&nbsp;rules&nbsp;are&nbsp;different:&nbsp;regardless&nbsp;of&nbsp;the&nbsp;underlying&nbsp;type&#39;s&nbsp;representation,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402891">//&nbsp;we&nbsp;need&nbsp;to&nbsp;tell&nbsp;the&nbsp;other&nbsp;side&nbsp;that&nbsp;the&nbsp;base&nbsp;type&nbsp;is&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5402963">return</span>&nbsp;<span class="ident" id="5402970"><a href="/gostd/encoding/gob/encoder.go.html#5402667">enc</a></span><span class="op" id="5402973">.</span><span class="ident" id="5402974"><a href="/gostd/encoding/gob/encoder.go.html#5401566">sendActualType</a></span><span class="op" id="5402988">(</span><span class="ident" id="5402989"><a href="/gostd/encoding/gob/encoder.go.html#5402690">w</a></span><span class="op" id="5402990">,</span>&nbsp;<span class="ident" id="5402992"><a href="/gostd/encoding/gob/encoder.go.html#5402703">state</a></span><span class="op" id="5402997">,</span>&nbsp;<span class="ident" id="5402999"><a href="/gostd/encoding/gob/encoder.go.html#5402759">ut</a></span><span class="op" id="5403001">,</span>&nbsp;<span class="ident" id="5403003"><a href="/gostd/encoding/gob/encoder.go.html#5402759">ut</a></span><span class="op" id="5403005">.</span><span class="ident" id="5403006"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span><span class="op" id="5403010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5403013">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403017">//&nbsp;It&#39;s&nbsp;a&nbsp;concrete&nbsp;value,&nbsp;so&nbsp;drill&nbsp;down&nbsp;to&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403076">switch</span>&nbsp;<span class="ident" id="5403083">rt</span>&nbsp;<span class="op" id="5403086">:=</span>&nbsp;<span class="ident" id="5403089"><a href="/gostd/encoding/gob/encoder.go.html#5402759">ut</a></span><span class="op" id="5403091">.</span><span class="ident" id="5403092"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span><span class="op" id="5403096">;</span>&nbsp;<span class="ident" id="5403098"><a href="/gostd/encoding/gob/encoder.go.html#5403083">rt</a></span><span class="op" id="5403100">.</span><span class="ident" id="5403101"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="5403105">(</span><span class="op" id="5403106">)</span>&nbsp;<span class="op" id="5403108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403111">default</span><span class="op" id="5403118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403122">//&nbsp;Basic&nbsp;types&nbsp;and&nbsp;interfaces&nbsp;do&nbsp;not&nbsp;need&nbsp;to&nbsp;be&nbsp;described.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403183">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403191">case</span>&nbsp;<span class="ident" id="5403196"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403203">.</span><span class="ident" id="5403204"><a href="/gostd/reflect/type.go.html#2788062">Slice</a></span><span class="op" id="5403209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403213">//&nbsp;If&nbsp;it&#39;s&nbsp;[]uint8,&nbsp;don&#39;t&nbsp;send;&nbsp;it&#39;s&nbsp;considered&nbsp;basic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403270">if</span>&nbsp;<span class="ident" id="5403273"><a href="/gostd/encoding/gob/encoder.go.html#5403083">rt</a></span><span class="op" id="5403275">.</span><span class="ident" id="5403276"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5403280">(</span><span class="op" id="5403281">)</span><span class="op" id="5403282">.</span><span class="ident" id="5403283"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="5403287">(</span><span class="op" id="5403288">)</span>&nbsp;<span class="op" id="5403290">==</span>&nbsp;<span class="ident" id="5403293"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403300">.</span><span class="ident" id="5403301"><a href="/gostd/reflect/type.go.html#2787941">Uint8</a></span>&nbsp;<span class="op" id="5403307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403312">return</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5403321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403325">//&nbsp;Otherwise&nbsp;we&nbsp;do&nbsp;send.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403352">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403359">case</span>&nbsp;<span class="ident" id="5403364"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403371">.</span><span class="ident" id="5403372"><a href="/gostd/reflect/type.go.html#2788022">Array</a></span><span class="op" id="5403377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403381">//&nbsp;arrays&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;lengths&nbsp;and&nbsp;element&nbsp;types.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403450">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403457">case</span>&nbsp;<span class="ident" id="5403462"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403469">.</span><span class="ident" id="5403470"><a href="/gostd/reflect/type.go.html#2788052">Map</a></span><span class="op" id="5403473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403477">//&nbsp;maps&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;lengths&nbsp;and&nbsp;key/value&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403546">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403553">case</span>&nbsp;<span class="ident" id="5403558"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403565">.</span><span class="ident" id="5403566"><a href="/gostd/reflect/type.go.html#2788077">Struct</a></span><span class="op" id="5403572">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403576">//&nbsp;structs&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403627">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403634">case</span>&nbsp;<span class="ident" id="5403639"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403646">.</span><span class="ident" id="5403647"><a href="/gostd/reflect/type.go.html#2788029">Chan</a></span><span class="op" id="5403651">,</span>&nbsp;<span class="ident" id="5403653"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5403660">.</span><span class="ident" id="5403661"><a href="/gostd/reflect/type.go.html#2788035">Func</a></span><span class="op" id="5403665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5403669">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here,&nbsp;it&#39;s&nbsp;a&nbsp;field&nbsp;of&nbsp;a&nbsp;struct;&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403727">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5403735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403739">return</span>&nbsp;<span class="ident" id="5403746"><a href="/gostd/encoding/gob/encoder.go.html#5402667">enc</a></span><span class="op" id="5403749">.</span><span class="ident" id="5403750"><a href="/gostd/encoding/gob/encoder.go.html#5401566">sendActualType</a></span><span class="op" id="5403764">(</span><span class="ident" id="5403765"><a href="/gostd/encoding/gob/encoder.go.html#5402690">w</a></span><span class="op" id="5403766">,</span>&nbsp;<span class="ident" id="5403768"><a href="/gostd/encoding/gob/encoder.go.html#5402703">state</a></span><span class="op" id="5403773">,</span>&nbsp;<span class="ident" id="5403775"><a href="/gostd/encoding/gob/encoder.go.html#5402759">ut</a></span><span class="op" id="5403777">,</span>&nbsp;<span class="ident" id="5403779"><a href="/gostd/encoding/gob/encoder.go.html#5402759">ut</a></span><span class="op" id="5403781">.</span><span class="ident" id="5403782"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span><span class="op" id="5403786">)</span><br>
<span class="lineno"></span><span class="op" id="5403788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5403791">//&nbsp;Encode&nbsp;transmits&nbsp;the&nbsp;data&nbsp;item&nbsp;represented&nbsp;by&nbsp;the&nbsp;empty&nbsp;interface&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="5403867">//&nbsp;guaranteeing&nbsp;that&nbsp;all&nbsp;necessary&nbsp;type&nbsp;information&nbsp;has&nbsp;been&nbsp;transmitted&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5403947">func</span>&nbsp;<span class="op" id="5403952">(</span><span class="ident" id="5403953">enc</span>&nbsp;<span class="op" id="5403957">*</span><span class="ident" id="5403958"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5403965">)</span>&nbsp;<span class="ident" id="5403967">Encode</span><span class="op" id="5403973">(</span><span class="ident" id="5403974">e</span>&nbsp;<span class="keyword" id="5403976">interface</span><span class="op" id="5403985">{</span><span class="op" id="5403986">}</span><span class="op" id="5403987">)</span>&nbsp;<span class="builtintype" id="5403989">error</span>&nbsp;<span class="op" id="5403995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5403998">return</span>&nbsp;<span class="ident" id="5404005"><a href="/gostd/encoding/gob/encoder.go.html#5403953">enc</a></span><span class="op" id="5404008">.</span><span class="ident" id="5404009"><a href="/gostd/encoding/gob/encoder.go.html#5405343">EncodeValue</a></span><span class="op" id="5404020">(</span><span class="ident" id="5404021"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5404028">.</span><span class="ident" id="5404029"><a href="/gostd/reflect/value.go.html#2892536">ValueOf</a></span><span class="op" id="5404036">(</span><span class="ident" id="5404037"><a href="/gostd/encoding/gob/encoder.go.html#5403974">e</a></span><span class="op" id="5404038">)</span><span class="op" id="5404039">)</span><br>
<span class="lineno"></span><span class="op" id="5404041">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="comment" id="5404044">//&nbsp;sendTypeDescriptor&nbsp;makes&nbsp;sure&nbsp;the&nbsp;remote&nbsp;side&nbsp;knows&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5404116">//&nbsp;It&nbsp;will&nbsp;send&nbsp;a&nbsp;descriptor&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;first&nbsp;time&nbsp;the&nbsp;type&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="5404189">//&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5404198">func</span>&nbsp;<span class="op" id="5404203">(</span><span class="ident" id="5404204">enc</span>&nbsp;<span class="op" id="5404208">*</span><span class="ident" id="5404209"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5404216">)</span>&nbsp;<span class="ident" id="5404218">sendTypeDescriptor</span><span class="op" id="5404236">(</span><span class="ident" id="5404237">w</span>&nbsp;<span class="ident" id="5404239"><a href="/gostd/encoding/gob/encoder.go.html#5398952">io</a></span><span class="op" id="5404241">.</span><span class="ident" id="5404242"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5404248">,</span>&nbsp;<span class="ident" id="5404250">state</span>&nbsp;<span class="op" id="5404256">*</span><span class="ident" id="5404257"><a href="/gostd/encoding/gob/encode.go.html#5379125">encoderState</a></span><span class="op" id="5404269">,</span>&nbsp;<span class="ident" id="5404271">ut</span>&nbsp;<span class="op" id="5404274">*</span><span class="ident" id="5404275"><a href="/gostd/encoding/gob/type.go.html#5408173">userTypeInfo</a></span><span class="op" id="5404287">)</span>&nbsp;<span class="op" id="5404289">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404292">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;type&nbsp;is&nbsp;known&nbsp;to&nbsp;the&nbsp;other&nbsp;side.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404343">//&nbsp;First,&nbsp;have&nbsp;we&nbsp;already&nbsp;sent&nbsp;this&nbsp;type?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404386">rt</span>&nbsp;<span class="op" id="5404389">:=</span>&nbsp;<span class="ident" id="5404392"><a href="/gostd/encoding/gob/encoder.go.html#5404271">ut</a></span><span class="op" id="5404394">.</span><span class="ident" id="5404395"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404401">if</span>&nbsp;<span class="ident" id="5404404"><a href="/gostd/encoding/gob/encoder.go.html#5404271">ut</a></span><span class="op" id="5404406">.</span><span class="ident" id="5404407"><a href="/gostd/encoding/gob/type.go.html#5408394">externalEnc</a></span>&nbsp;<span class="op" id="5404419">!=</span>&nbsp;<span class="num" id="5404422">0</span>&nbsp;<span class="op" id="5404424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404428"><a href="/gostd/encoding/gob/encoder.go.html#5404386">rt</a></span>&nbsp;<span class="op" id="5404431">=</span>&nbsp;<span class="ident" id="5404433"><a href="/gostd/encoding/gob/encoder.go.html#5404271">ut</a></span><span class="op" id="5404435">.</span><span class="ident" id="5404436"><a href="/gostd/encoding/gob/type.go.html#5408196">user</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404445">if</span>&nbsp;<span class="ident" id="5404448">_</span><span class="op" id="5404449">,</span>&nbsp;<span class="ident" id="5404451">alreadySent</span>&nbsp;<span class="op" id="5404463">:=</span>&nbsp;<span class="ident" id="5404466"><a href="/gostd/encoding/gob/encoder.go.html#5404204">enc</a></span><span class="op" id="5404469">.</span><span class="ident" id="5404470"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span><span class="op" id="5404474">[</span><span class="ident" id="5404475"><a href="/gostd/encoding/gob/encoder.go.html#5404386">rt</a></span><span class="op" id="5404477">]</span><span class="op" id="5404478">;</span>&nbsp;<span class="op" id="5404480">!</span><span class="ident" id="5404481"><a href="/gostd/encoding/gob/encoder.go.html#5404451">alreadySent</a></span>&nbsp;<span class="op" id="5404493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404497">//&nbsp;No,&nbsp;so&nbsp;send&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404518">sent</span>&nbsp;<span class="op" id="5404523">:=</span>&nbsp;<span class="ident" id="5404526"><a href="/gostd/encoding/gob/encoder.go.html#5404204">enc</a></span><span class="op" id="5404529">.</span><span class="ident" id="5404530"><a href="/gostd/encoding/gob/encoder.go.html#5402681">sendType</a></span><span class="op" id="5404538">(</span><span class="ident" id="5404539"><a href="/gostd/encoding/gob/encoder.go.html#5404237">w</a></span><span class="op" id="5404540">,</span>&nbsp;<span class="ident" id="5404542"><a href="/gostd/encoding/gob/encoder.go.html#5404250">state</a></span><span class="op" id="5404547">,</span>&nbsp;<span class="ident" id="5404549"><a href="/gostd/encoding/gob/encoder.go.html#5404386">rt</a></span><span class="op" id="5404551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404555">if</span>&nbsp;<span class="ident" id="5404558"><a href="/gostd/encoding/gob/encoder.go.html#5404204">enc</a></span><span class="op" id="5404561">.</span><span class="ident" id="5404562"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5404566">!=</span>&nbsp;<span class="builtintype" id="5404569">nil</span>&nbsp;<span class="op" id="5404573">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404578">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404591">//&nbsp;If&nbsp;the&nbsp;type&nbsp;info&nbsp;has&nbsp;still&nbsp;not&nbsp;been&nbsp;transmitted,&nbsp;it&nbsp;means&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404662">//&nbsp;a&nbsp;singleton&nbsp;basic&nbsp;type&nbsp;(int,&nbsp;[]byte&nbsp;etc.)&nbsp;at&nbsp;top&nbsp;level.&nbsp;&nbsp;We&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404733">//&nbsp;need&nbsp;to&nbsp;send&nbsp;the&nbsp;type&nbsp;info&nbsp;but&nbsp;we&nbsp;do&nbsp;need&nbsp;to&nbsp;update&nbsp;enc.sent.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404800">if</span>&nbsp;<span class="op" id="5404803">!</span><span class="ident" id="5404804"><a href="/gostd/encoding/gob/encoder.go.html#5404518">sent</a></span>&nbsp;<span class="op" id="5404809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404814">info</span><span class="op" id="5404818">,</span>&nbsp;<span class="ident" id="5404820">err</span>&nbsp;<span class="op" id="5404824">:=</span>&nbsp;<span class="ident" id="5404827"><a href="/gostd/encoding/gob/type.go.html#5428443">getTypeInfo</a></span><span class="op" id="5404838">(</span><span class="ident" id="5404839"><a href="/gostd/encoding/gob/encoder.go.html#5404271">ut</a></span><span class="op" id="5404841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404846">if</span>&nbsp;<span class="ident" id="5404849"><a href="/gostd/encoding/gob/encoder.go.html#5404820">err</a></span>&nbsp;<span class="op" id="5404853">!=</span>&nbsp;<span class="builtintype" id="5404856">nil</span>&nbsp;<span class="op" id="5404860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404866"><a href="/gostd/encoding/gob/encoder.go.html#5404204">enc</a></span><span class="op" id="5404869">.</span><span class="ident" id="5404870"><a href="/gostd/encoding/gob/encoder.go.html#5400509">setError</a></span><span class="op" id="5404878">(</span><span class="ident" id="5404879"><a href="/gostd/encoding/gob/encoder.go.html#5404820">err</a></span><span class="op" id="5404882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404888">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404903"><a href="/gostd/encoding/gob/encoder.go.html#5404204">enc</a></span><span class="op" id="5404906">.</span><span class="ident" id="5404907"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span><span class="op" id="5404911">[</span><span class="ident" id="5404912"><a href="/gostd/encoding/gob/encoder.go.html#5404386">rt</a></span><span class="op" id="5404914">]</span>&nbsp;<span class="op" id="5404916">=</span>&nbsp;<span class="ident" id="5404918"><a href="/gostd/encoding/gob/encoder.go.html#5404814">info</a></span><span class="op" id="5404922">.</span><span class="ident" id="5404923"><a href="/gostd/encoding/gob/type.go.html#5427792">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404931">}</span><br>
<span class="lineno"></span><span class="op" id="5404933">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5404936">//&nbsp;sendTypeId&nbsp;sends&nbsp;the&nbsp;id,&nbsp;which&nbsp;must&nbsp;have&nbsp;already&nbsp;been&nbsp;defined.</span><br>
<span class="lineno"></span><span class="keyword" id="5405002">func</span>&nbsp;<span class="op" id="5405007">(</span><span class="ident" id="5405008">enc</span>&nbsp;<span class="op" id="5405012">*</span><span class="ident" id="5405013"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5405020">)</span>&nbsp;<span class="ident" id="5405022">sendTypeId</span><span class="op" id="5405032">(</span><span class="ident" id="5405033">state</span>&nbsp;<span class="op" id="5405039">*</span><span class="ident" id="5405040"><a href="/gostd/encoding/gob/encode.go.html#5379125">encoderState</a></span><span class="op" id="5405052">,</span>&nbsp;<span class="ident" id="5405054">ut</span>&nbsp;<span class="op" id="5405057">*</span><span class="ident" id="5405058"><a href="/gostd/encoding/gob/type.go.html#5408173">userTypeInfo</a></span><span class="op" id="5405070">)</span>&nbsp;<span class="op" id="5405072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405075">//&nbsp;Identify&nbsp;the&nbsp;type&nbsp;of&nbsp;this&nbsp;top-level&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405122"><a href="/gostd/encoding/gob/encoder.go.html#5405033">state</a></span><span class="op" id="5405127">.</span><span class="ident" id="5405128"><a href="/gostd/encoding/gob/encode.go.html#5381323">encodeInt</a></span><span class="op" id="5405137">(</span><span class="builtintype" id="5405138">int64</span><span class="op" id="5405143">(</span><span class="ident" id="5405144"><a href="/gostd/encoding/gob/encoder.go.html#5405008">enc</a></span><span class="op" id="5405147">.</span><span class="ident" id="5405148"><a href="/gostd/encoding/gob/encoder.go.html#5399243">sent</a></span><span class="op" id="5405152">[</span><span class="ident" id="5405153"><a href="/gostd/encoding/gob/encoder.go.html#5405054">ut</a></span><span class="op" id="5405155">.</span><span class="ident" id="5405156"><a href="/gostd/encoding/gob/type.go.html#5408253">base</a></span><span class="op" id="5405160">]</span><span class="op" id="5405161">)</span><span class="op" id="5405162">)</span><br>
<span class="lineno">205</span><span class="op" id="5405164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5405167">//&nbsp;EncodeValue&nbsp;transmits&nbsp;the&nbsp;data&nbsp;item&nbsp;represented&nbsp;by&nbsp;the&nbsp;reflection&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="5405243">//&nbsp;guaranteeing&nbsp;that&nbsp;all&nbsp;necessary&nbsp;type&nbsp;information&nbsp;has&nbsp;been&nbsp;transmitted&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5405323">func</span>&nbsp;<span class="op" id="5405328">(</span><span class="ident" id="5405329">enc</span>&nbsp;<span class="op" id="5405333">*</span><span class="ident" id="5405334"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><span class="op" id="5405341">)</span>&nbsp;<span class="ident" id="5405343">EncodeValue</span><span class="op" id="5405354">(</span><span class="ident" id="5405355">value</span>&nbsp;<span class="ident" id="5405361"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5405368">.</span><span class="ident" id="5405369"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="5405374">)</span>&nbsp;<span class="builtintype" id="5405376">error</span>&nbsp;<span class="op" id="5405382">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405385">//&nbsp;Gobs&nbsp;contain&nbsp;values.&nbsp;They&nbsp;cannot&nbsp;represent&nbsp;nil&nbsp;pointers,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405452">//&nbsp;have&nbsp;no&nbsp;value&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405481">if</span>&nbsp;<span class="ident" id="5405484"><a href="/gostd/encoding/gob/encoder.go.html#5405355">value</a></span><span class="op" id="5405489">.</span><span class="ident" id="5405490"><a href="/gostd/reflect/value.go.html#2861487">Kind</a></span><span class="op" id="5405494">(</span><span class="op" id="5405495">)</span>&nbsp;<span class="op" id="5405497">==</span>&nbsp;<span class="ident" id="5405500"><a href="/gostd/encoding/gob/encoder.go.html#5398958">reflect</a></span><span class="op" id="5405507">.</span><span class="ident" id="5405508"><a href="/gostd/reflect/type.go.html#2788057">Ptr</a></span>&nbsp;<span class="op" id="5405512">&amp;&amp;</span>&nbsp;<span class="ident" id="5405515"><a href="/gostd/encoding/gob/encoder.go.html#5405355">value</a></span><span class="op" id="5405520">.</span><span class="ident" id="5405521"><a href="/gostd/reflect/value.go.html#2860565">IsNil</a></span><span class="op" id="5405526">(</span><span class="op" id="5405527">)</span>&nbsp;<span class="op" id="5405529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5405533">panic</span><span class="op" id="5405538">(</span><span class="string" id="5405539">&#34;gob:&nbsp;cannot&nbsp;encode&nbsp;nil&nbsp;pointer&nbsp;of&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5405581">+</span>&nbsp;<span class="ident" id="5405583"><a href="/gostd/encoding/gob/encoder.go.html#5405355">value</a></span><span class="op" id="5405588">.</span><span class="ident" id="5405589"><a href="/gostd/reflect/value.go.html#2880910">Type</a></span><span class="op" id="5405593">(</span><span class="op" id="5405594">)</span><span class="op" id="5405595">.</span><span class="ident" id="5405596"><a href="/gostd/reflect/type.go.html#2783552">String</a></span><span class="op" id="5405602">(</span><span class="op" id="5405603">)</span><span class="op" id="5405604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405607">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405611">//&nbsp;Make&nbsp;sure&nbsp;we&#39;re&nbsp;single-threaded&nbsp;through&nbsp;here,&nbsp;so&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405673">//&nbsp;goroutines&nbsp;can&nbsp;share&nbsp;an&nbsp;encoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405710"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405713">.</span><span class="ident" id="5405714"><a href="/gostd/encoding/gob/encoder.go.html#5399108">mutex</a></span><span class="op" id="5405719">.</span><span class="ident" id="5405720"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5405724">(</span><span class="op" id="5405725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405728">defer</span>&nbsp;<span class="ident" id="5405734"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405737">.</span><span class="ident" id="5405738"><a href="/gostd/encoding/gob/encoder.go.html#5399108">mutex</a></span><span class="op" id="5405743">.</span><span class="ident" id="5405744"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5405750">(</span><span class="op" id="5405751">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405755">//&nbsp;Remove&nbsp;any&nbsp;nested&nbsp;writers&nbsp;remaining&nbsp;due&nbsp;to&nbsp;previous&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405819"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405822">.</span><span class="ident" id="5405823"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span>&nbsp;<span class="op" id="5405825">=</span>&nbsp;<span class="ident" id="5405827"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405830">.</span><span class="ident" id="5405831"><a href="/gostd/encoding/gob/encoder.go.html#5399181">w</a></span><span class="op" id="5405832">[</span><span class="num" id="5405833">0</span><span class="op" id="5405834">:</span><span class="num" id="5405835">1</span><span class="op" id="5405836">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405840">ut</span><span class="op" id="5405842">,</span>&nbsp;<span class="ident" id="5405844">err</span>&nbsp;<span class="op" id="5405848">:=</span>&nbsp;<span class="ident" id="5405851"><a href="/gostd/encoding/gob/type.go.html#5409346">validUserType</a></span><span class="op" id="5405864">(</span><span class="ident" id="5405865"><a href="/gostd/encoding/gob/encoder.go.html#5405355">value</a></span><span class="op" id="5405870">.</span><span class="ident" id="5405871"><a href="/gostd/reflect/value.go.html#2880910">Type</a></span><span class="op" id="5405875">(</span><span class="op" id="5405876">)</span><span class="op" id="5405877">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405880">if</span>&nbsp;<span class="ident" id="5405883"><a href="/gostd/encoding/gob/encoder.go.html#5405844">err</a></span>&nbsp;<span class="op" id="5405887">!=</span>&nbsp;<span class="builtintype" id="5405890">nil</span>&nbsp;<span class="op" id="5405894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405898">return</span>&nbsp;<span class="ident" id="5405905"><a href="/gostd/encoding/gob/encoder.go.html#5405844">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405914"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405917">.</span><span class="ident" id="5405918"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5405922">=</span>&nbsp;<span class="builtintype" id="5405924">nil</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405929"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405932">.</span><span class="ident" id="5405933"><a href="/gostd/encoding/gob/encoder.go.html#5399464">byteBuf</a></span><span class="op" id="5405940">.</span><span class="ident" id="5405941"><a href="/gostd/encoding/gob/encode.go.html#5380117">Reset</a></span><span class="op" id="5405946">(</span><span class="op" id="5405947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405950"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405953">.</span><span class="ident" id="5405954"><a href="/gostd/encoding/gob/encoder.go.html#5399464">byteBuf</a></span><span class="op" id="5405961">.</span><span class="ident" id="5405962"><a href="/gostd/encoding/gob/encode.go.html#5379824">Write</a></span><span class="op" id="5405967">(</span><span class="ident" id="5405968"><a href="/gostd/encoding/gob/encoder.go.html#5399815">spaceForLength</a></span><span class="op" id="5405982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405985">state</span>&nbsp;<span class="op" id="5405991">:=</span>&nbsp;<span class="ident" id="5405994"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5405997">.</span><span class="ident" id="5405998"><a href="/gostd/encoding/gob/encode.go.html#5380172">newEncoderState</a></span><span class="op" id="5406013">(</span><span class="op" id="5406014">&amp;</span><span class="ident" id="5406015"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406018">.</span><span class="ident" id="5406019"><a href="/gostd/encoding/gob/encoder.go.html#5399464">byteBuf</a></span><span class="op" id="5406026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406030"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406033">.</span><span class="ident" id="5406034"><a href="/gostd/encoding/gob/encoder.go.html#5404218">sendTypeDescriptor</a></span><span class="op" id="5406052">(</span><span class="ident" id="5406053"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406056">.</span><span class="ident" id="5406057"><a href="/gostd/encoding/gob/encoder.go.html#5400208">writer</a></span><span class="op" id="5406063">(</span><span class="op" id="5406064">)</span><span class="op" id="5406065">,</span>&nbsp;<span class="ident" id="5406067"><a href="/gostd/encoding/gob/encoder.go.html#5405985">state</a></span><span class="op" id="5406072">,</span>&nbsp;<span class="ident" id="5406074"><a href="/gostd/encoding/gob/encoder.go.html#5405840">ut</a></span><span class="op" id="5406076">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406079"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406082">.</span><span class="ident" id="5406083"><a href="/gostd/encoding/gob/encoder.go.html#5405022">sendTypeId</a></span><span class="op" id="5406093">(</span><span class="ident" id="5406094"><a href="/gostd/encoding/gob/encoder.go.html#5405985">state</a></span><span class="op" id="5406099">,</span>&nbsp;<span class="ident" id="5406101"><a href="/gostd/encoding/gob/encoder.go.html#5405840">ut</a></span><span class="op" id="5406103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406106">if</span>&nbsp;<span class="ident" id="5406109"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406112">.</span><span class="ident" id="5406113"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5406117">!=</span>&nbsp;<span class="builtintype" id="5406120">nil</span>&nbsp;<span class="op" id="5406124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406128">return</span>&nbsp;<span class="ident" id="5406135"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406138">.</span><span class="ident" id="5406139"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5406148">//&nbsp;Encode&nbsp;the&nbsp;object.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406171"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406174">.</span><span class="ident" id="5406175"><a href="/gostd/encoding/gob/encode.go.html#5398347">encode</a></span><span class="op" id="5406181">(</span><span class="ident" id="5406182"><a href="/gostd/encoding/gob/encoder.go.html#5405985">state</a></span><span class="op" id="5406187">.</span><span class="ident" id="5406188"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5406189">,</span>&nbsp;<span class="ident" id="5406191"><a href="/gostd/encoding/gob/encoder.go.html#5405355">value</a></span><span class="op" id="5406196">,</span>&nbsp;<span class="ident" id="5406198"><a href="/gostd/encoding/gob/encoder.go.html#5405840">ut</a></span><span class="op" id="5406200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406203">if</span>&nbsp;<span class="ident" id="5406206"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406209">.</span><span class="ident" id="5406210"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span>&nbsp;<span class="op" id="5406214">==</span>&nbsp;<span class="builtintype" id="5406217">nil</span>&nbsp;<span class="op" id="5406221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406225"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406228">.</span><span class="ident" id="5406229"><a href="/gostd/encoding/gob/encoder.go.html#5400697">writeMessage</a></span><span class="op" id="5406241">(</span><span class="ident" id="5406242"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406245">.</span><span class="ident" id="5406246"><a href="/gostd/encoding/gob/encoder.go.html#5400208">writer</a></span><span class="op" id="5406252">(</span><span class="op" id="5406253">)</span><span class="op" id="5406254">,</span>&nbsp;<span class="ident" id="5406256"><a href="/gostd/encoding/gob/encoder.go.html#5405985">state</a></span><span class="op" id="5406261">.</span><span class="ident" id="5406262"><a href="/gostd/encoding/gob/encode.go.html#5379167">b</a></span><span class="op" id="5406263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406266">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406270"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406273">.</span><span class="ident" id="5406274"><a href="/gostd/encoding/gob/encode.go.html#5380457">freeEncoderState</a></span><span class="op" id="5406290">(</span><span class="ident" id="5406291"><a href="/gostd/encoding/gob/encoder.go.html#5405985">state</a></span><span class="op" id="5406296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406299">return</span>&nbsp;<span class="ident" id="5406306"><a href="/gostd/encoding/gob/encoder.go.html#5405329">enc</a></span><span class="op" id="5406309">.</span><span class="ident" id="5406310"><a href="/gostd/encoding/gob/encoder.go.html#5399537">err</a></span><br>
<span class="lineno"></span><span class="op" id="5406314">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
