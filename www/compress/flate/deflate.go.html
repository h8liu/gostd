<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4309968">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4310023">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4310077">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4310128">package</span>&nbsp;<span class="ident" id="4310136">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4310143">import</span>&nbsp;<span class="op" id="4310150">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310153">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310160">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310166">&#34;math&#34;</span><br>
<span class="lineno"></span><span class="op" id="4310173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4310176">const</span>&nbsp;<span class="op" id="4310182">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310185">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310204">=</span>&nbsp;<span class="num" id="4310206">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310209">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310228">=</span>&nbsp;<span class="num" id="4310230">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310233">fastCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310252">=</span>&nbsp;<span class="num" id="4310254">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310257">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310276">=</span>&nbsp;<span class="num" id="4310278">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310281">DefaultCompression</span>&nbsp;<span class="op" id="4310300">=</span>&nbsp;<span class="op" id="4310302">-</span><span class="num" id="4310303">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310306">logWindowSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310325">=</span>&nbsp;<span class="num" id="4310327">15</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310331">windowSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310350">=</span>&nbsp;<span class="num" id="4310352">1</span>&nbsp;<span class="op" id="4310354">&lt;&lt;</span>&nbsp;<span class="ident" id="4310357"><a href="/compress/flate/deflate.go.html#4310306">logWindowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310372">windowMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310391">=</span>&nbsp;<span class="ident" id="4310393"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span>&nbsp;<span class="op" id="4310404">-</span>&nbsp;<span class="num" id="4310406">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310409">logMaxOffsetSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4310428">=</span>&nbsp;<span class="num" id="4310430">15</span>&nbsp;&nbsp;<span class="comment" id="4310434">//&nbsp;Standard&nbsp;DEFLATE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310455">minMatchLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310474">=</span>&nbsp;<span class="num" id="4310476">3</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4310480">//&nbsp;The&nbsp;smallest&nbsp;match&nbsp;that&nbsp;the&nbsp;compressor&nbsp;looks&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310533">maxMatchLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310552">=</span>&nbsp;<span class="num" id="4310554">258</span>&nbsp;<span class="comment" id="4310558">//&nbsp;The&nbsp;longest&nbsp;match&nbsp;for&nbsp;the&nbsp;compressor</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310599">minOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310618">=</span>&nbsp;<span class="num" id="4310620">1</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4310624">//&nbsp;The&nbsp;shortest&nbsp;offset&nbsp;that&nbsp;makes&nbsp;any&nbsp;sense</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310670">//&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;tokens&nbsp;we&nbsp;put&nbsp;into&nbsp;a&nbsp;single&nbsp;flat&nbsp;block,&nbsp;just&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310745">//&nbsp;stop&nbsp;things&nbsp;from&nbsp;getting&nbsp;too&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310785">maxFlateBlockTokens</span>&nbsp;<span class="op" id="4310805">=</span>&nbsp;<span class="num" id="4310807">1</span>&nbsp;<span class="op" id="4310809">&lt;&lt;</span>&nbsp;<span class="num" id="4310812">14</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310816">maxStoreBlockSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4310836">=</span>&nbsp;<span class="num" id="4310838">65535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310845">hashBits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310865">=</span>&nbsp;<span class="num" id="4310867">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310871">hashSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310891">=</span>&nbsp;<span class="num" id="4310893">1</span>&nbsp;<span class="op" id="4310895">&lt;&lt;</span>&nbsp;<span class="ident" id="4310898"><a href="/compress/flate/deflate.go.html#4310845">hashBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310908">hashMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310928">=</span>&nbsp;<span class="op" id="4310930">(</span><span class="num" id="4310931">1</span>&nbsp;<span class="op" id="4310933">&lt;&lt;</span>&nbsp;<span class="ident" id="4310936"><a href="/compress/flate/deflate.go.html#4310845">hashBits</a></span><span class="op" id="4310944">)</span>&nbsp;<span class="op" id="4310946">-</span>&nbsp;<span class="num" id="4310948">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310951">hashShift</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310971">=</span>&nbsp;<span class="op" id="4310973">(</span><span class="ident" id="4310974"><a href="/compress/flate/deflate.go.html#4310845">hashBits</a></span>&nbsp;<span class="op" id="4310983">+</span>&nbsp;<span class="ident" id="4310985"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4311000">-</span>&nbsp;<span class="num" id="4311002">1</span><span class="op" id="4311003">)</span>&nbsp;<span class="op" id="4311005">/</span>&nbsp;<span class="ident" id="4311007"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311023">maxHashOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311043">=</span>&nbsp;<span class="num" id="4311045">1</span>&nbsp;<span class="op" id="4311047">&lt;&lt;</span>&nbsp;<span class="num" id="4311050">24</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311055">skipNever</span>&nbsp;<span class="op" id="4311065">=</span>&nbsp;<span class="ident" id="4311067"><a href="/compress/flate/deflate.go.html#4310166">math</a></span><span class="op" id="4311071">.</span><span class="ident" id="4311072">MaxInt32</span><br>
<span class="lineno"></span><span class="op" id="4311081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4311084">type</span>&nbsp;<span class="ident" id="4311089">compressionLevel</span>&nbsp;<span class="keyword" id="4311106">struct</span>&nbsp;<span class="op" id="4311113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311116">good</span><span class="op" id="4311120">,</span>&nbsp;<span class="ident" id="4311122">lazy</span><span class="op" id="4311126">,</span>&nbsp;<span class="ident" id="4311128">nice</span><span class="op" id="4311132">,</span>&nbsp;<span class="ident" id="4311134">chain</span><span class="op" id="4311139">,</span>&nbsp;<span class="ident" id="4311141">fastSkipHashing</span>&nbsp;<span class="builtintype" id="4311157">int</span><br>
<span class="lineno"></span><span class="op" id="4311161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4311164">var</span>&nbsp;<span class="ident" id="4311168">levels</span>&nbsp;<span class="op" id="4311175">=</span>&nbsp;<span class="op" id="4311177">[</span><span class="op" id="4311178">]</span><span class="ident" id="4311179"><a href="/compress/flate/deflate.go.html#4311089">compressionLevel</a></span><span class="op" id="4311195">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311198">{</span><span class="op" id="4311199">}</span><span class="op" id="4311200">,</span>&nbsp;<span class="comment" id="4311202">//&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311208">//&nbsp;For&nbsp;levels&nbsp;1-3&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;trying&nbsp;with&nbsp;lazy&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311268">{</span><span class="num" id="4311269">3</span><span class="op" id="4311270">,</span>&nbsp;<span class="num" id="4311272">0</span><span class="op" id="4311273">,</span>&nbsp;<span class="num" id="4311275">8</span><span class="op" id="4311276">,</span>&nbsp;<span class="num" id="4311278">4</span><span class="op" id="4311279">,</span>&nbsp;<span class="num" id="4311281">4</span><span class="op" id="4311282">}</span><span class="op" id="4311283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311286">{</span><span class="num" id="4311287">3</span><span class="op" id="4311288">,</span>&nbsp;<span class="num" id="4311290">0</span><span class="op" id="4311291">,</span>&nbsp;<span class="num" id="4311293">16</span><span class="op" id="4311295">,</span>&nbsp;<span class="num" id="4311297">8</span><span class="op" id="4311298">,</span>&nbsp;<span class="num" id="4311300">5</span><span class="op" id="4311301">}</span><span class="op" id="4311302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311305">{</span><span class="num" id="4311306">3</span><span class="op" id="4311307">,</span>&nbsp;<span class="num" id="4311309">0</span><span class="op" id="4311310">,</span>&nbsp;<span class="num" id="4311312">32</span><span class="op" id="4311314">,</span>&nbsp;<span class="num" id="4311316">32</span><span class="op" id="4311318">,</span>&nbsp;<span class="num" id="4311320">6</span><span class="op" id="4311321">}</span><span class="op" id="4311322">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311325">//&nbsp;Levels&nbsp;4-9&nbsp;use&nbsp;increasingly&nbsp;more&nbsp;lazy&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311376">//&nbsp;and&nbsp;increasingly&nbsp;stringent&nbsp;conditions&nbsp;for&nbsp;&#34;good&nbsp;enough&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311437">{</span><span class="num" id="4311438">4</span><span class="op" id="4311439">,</span>&nbsp;<span class="num" id="4311441">4</span><span class="op" id="4311442">,</span>&nbsp;<span class="num" id="4311444">16</span><span class="op" id="4311446">,</span>&nbsp;<span class="num" id="4311448">16</span><span class="op" id="4311450">,</span>&nbsp;<span class="ident" id="4311452"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span><span class="op" id="4311461">}</span><span class="op" id="4311462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311465">{</span><span class="num" id="4311466">8</span><span class="op" id="4311467">,</span>&nbsp;<span class="num" id="4311469">16</span><span class="op" id="4311471">,</span>&nbsp;<span class="num" id="4311473">32</span><span class="op" id="4311475">,</span>&nbsp;<span class="num" id="4311477">32</span><span class="op" id="4311479">,</span>&nbsp;<span class="ident" id="4311481"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span><span class="op" id="4311490">}</span><span class="op" id="4311491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311494">{</span><span class="num" id="4311495">8</span><span class="op" id="4311496">,</span>&nbsp;<span class="num" id="4311498">16</span><span class="op" id="4311500">,</span>&nbsp;<span class="num" id="4311502">128</span><span class="op" id="4311505">,</span>&nbsp;<span class="num" id="4311507">128</span><span class="op" id="4311510">,</span>&nbsp;<span class="ident" id="4311512"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span><span class="op" id="4311521">}</span><span class="op" id="4311522">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311525">{</span><span class="num" id="4311526">8</span><span class="op" id="4311527">,</span>&nbsp;<span class="num" id="4311529">32</span><span class="op" id="4311531">,</span>&nbsp;<span class="num" id="4311533">128</span><span class="op" id="4311536">,</span>&nbsp;<span class="num" id="4311538">256</span><span class="op" id="4311541">,</span>&nbsp;<span class="ident" id="4311543"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span><span class="op" id="4311552">}</span><span class="op" id="4311553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311556">{</span><span class="num" id="4311557">32</span><span class="op" id="4311559">,</span>&nbsp;<span class="num" id="4311561">128</span><span class="op" id="4311564">,</span>&nbsp;<span class="num" id="4311566">258</span><span class="op" id="4311569">,</span>&nbsp;<span class="num" id="4311571">1024</span><span class="op" id="4311575">,</span>&nbsp;<span class="ident" id="4311577"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span><span class="op" id="4311586">}</span><span class="op" id="4311587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311590">{</span><span class="num" id="4311591">32</span><span class="op" id="4311593">,</span>&nbsp;<span class="num" id="4311595">258</span><span class="op" id="4311598">,</span>&nbsp;<span class="num" id="4311600">258</span><span class="op" id="4311603">,</span>&nbsp;<span class="num" id="4311605">4096</span><span class="op" id="4311609">,</span>&nbsp;<span class="ident" id="4311611"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span><span class="op" id="4311620">}</span><span class="op" id="4311621">,</span><br>
<span class="lineno"></span><span class="op" id="4311623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4311626">type</span>&nbsp;<span class="ident" id="4311631">compressor</span>&nbsp;<span class="keyword" id="4311642">struct</span>&nbsp;<span class="op" id="4311649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311652"><a href="/compress/flate/deflate.go.html#4311089">compressionLevel</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311671">w</span>&nbsp;<span class="op" id="4311673">*</span><span class="ident" id="4311674"><a href="/compress/flate/huffman_bit_writer.go.html#4331675">huffmanBitWriter</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311693">//&nbsp;compression&nbsp;algorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311719">fill</span>&nbsp;<span class="keyword" id="4311724">func</span><span class="op" id="4311728">(</span><span class="op" id="4311729">*</span><span class="ident" id="4311730"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4311740">,</span>&nbsp;<span class="op" id="4311742">[</span><span class="op" id="4311743">]</span><span class="builtintype" id="4311744">byte</span><span class="op" id="4311748">)</span>&nbsp;<span class="builtintype" id="4311750">int</span>&nbsp;<span class="comment" id="4311754">//&nbsp;copy&nbsp;data&nbsp;to&nbsp;window</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311778">step</span>&nbsp;<span class="keyword" id="4311783">func</span><span class="op" id="4311787">(</span><span class="op" id="4311788">*</span><span class="ident" id="4311789"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4311799">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4311813">//&nbsp;process&nbsp;window</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311832">sync</span>&nbsp;<span class="builtintype" id="4311837">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4311867">//&nbsp;requesting&nbsp;flush</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311889">//&nbsp;Input&nbsp;hash&nbsp;chains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311911">//&nbsp;hashHead[hashValue]&nbsp;contains&nbsp;the&nbsp;largest&nbsp;inputIndex&nbsp;with&nbsp;the&nbsp;specified&nbsp;hash&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311997">//&nbsp;If&nbsp;hashHead[hashValue]&nbsp;is&nbsp;within&nbsp;the&nbsp;current&nbsp;window,&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312059">//&nbsp;hashPrev[hashHead[hashValue]&nbsp;&amp;&nbsp;windowMask]&nbsp;contains&nbsp;the&nbsp;previous&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312134">//&nbsp;with&nbsp;the&nbsp;same&nbsp;hash&nbsp;value.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312164">chainHead</span>&nbsp;&nbsp;<span class="builtintype" id="4312175">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312180">hashHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4312191">[</span><span class="op" id="4312192">]</span><span class="builtintype" id="4312193">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312198">hashPrev</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4312209">[</span><span class="op" id="4312210">]</span><span class="builtintype" id="4312211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312216">hashOffset</span>&nbsp;<span class="builtintype" id="4312227">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312233">//&nbsp;input&nbsp;window:&nbsp;unprocessed&nbsp;data&nbsp;is&nbsp;window[index:windowEnd]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312295">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312309">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312314">window</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4312328">[</span><span class="op" id="4312329">]</span><span class="builtintype" id="4312330">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312336">windowEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312350">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312355">blockStart</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312369">int</span>&nbsp;&nbsp;<span class="comment" id="4312374">//&nbsp;window&nbsp;index&nbsp;where&nbsp;current&nbsp;tokens&nbsp;start</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312418">byteAvailable</span>&nbsp;<span class="builtintype" id="4312432">bool</span>&nbsp;<span class="comment" id="4312437">//&nbsp;if&nbsp;true,&nbsp;still&nbsp;need&nbsp;to&nbsp;process&nbsp;window[index-1].</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312490">//&nbsp;queued&nbsp;output&nbsp;tokens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312515">tokens</span>&nbsp;<span class="op" id="4312522">[</span><span class="op" id="4312523">]</span><span class="ident" id="4312524"><a href="/compress/flate/token.go.html#4374045">token</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312532">//&nbsp;deflate&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312550">length</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312565">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312570">offset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312585">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312590">hash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312605">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312610">maxInsertIndex</span>&nbsp;<span class="builtintype" id="4312625">int</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312630">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312645">error</span><br>
<span class="lineno"></span><span class="op" id="4312651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4312654">func</span>&nbsp;<span class="op" id="4312659">(</span><span class="ident" id="4312660">d</span>&nbsp;<span class="op" id="4312662">*</span><span class="ident" id="4312663"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4312673">)</span>&nbsp;<span class="ident" id="4312675">fillDeflate</span><span class="op" id="4312686">(</span><span class="ident" id="4312687">b</span>&nbsp;<span class="op" id="4312689">[</span><span class="op" id="4312690">]</span><span class="builtintype" id="4312691">byte</span><span class="op" id="4312695">)</span>&nbsp;<span class="builtintype" id="4312697">int</span>&nbsp;<span class="op" id="4312701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312704">if</span>&nbsp;<span class="ident" id="4312707"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312708">.</span><span class="ident" id="4312709">index</span>&nbsp;<span class="op" id="4312715">&gt;=</span>&nbsp;<span class="num" id="4312718">2</span><span class="op" id="4312719">*</span><span class="ident" id="4312720"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><span class="op" id="4312730">-</span><span class="op" id="4312731">(</span><span class="ident" id="4312732"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4312746">+</span><span class="ident" id="4312747"><a href="/compress/flate/deflate.go.html#4310533">maxMatchLength</a></span><span class="op" id="4312761">)</span>&nbsp;<span class="op" id="4312763">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312767">//&nbsp;shift&nbsp;the&nbsp;window&nbsp;by&nbsp;windowSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4312803">copy</span><span class="op" id="4312807">(</span><span class="ident" id="4312808"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312809">.</span><span class="ident" id="4312810">window</span><span class="op" id="4312816">,</span>&nbsp;<span class="ident" id="4312818"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312819">.</span><span class="ident" id="4312820">window</span><span class="op" id="4312826">[</span><span class="ident" id="4312827"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><span class="op" id="4312837">:</span><span class="num" id="4312838">2</span><span class="op" id="4312839">*</span><span class="ident" id="4312840"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><span class="op" id="4312850">]</span><span class="op" id="4312851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312855"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312856">.</span><span class="ident" id="4312857">index</span>&nbsp;<span class="op" id="4312863">-=</span>&nbsp;<span class="ident" id="4312866"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312879"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312880">.</span><span class="ident" id="4312881">windowEnd</span>&nbsp;<span class="op" id="4312891">-=</span>&nbsp;<span class="ident" id="4312894"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312907">if</span>&nbsp;<span class="ident" id="4312910"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312911">.</span><span class="ident" id="4312912">blockStart</span>&nbsp;<span class="op" id="4312923">&gt;=</span>&nbsp;<span class="ident" id="4312926"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span>&nbsp;<span class="op" id="4312937">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312942"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312943">.</span><span class="ident" id="4312944">blockStart</span>&nbsp;<span class="op" id="4312955">-=</span>&nbsp;<span class="ident" id="4312958"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312971">}</span>&nbsp;<span class="keyword" id="4312973">else</span>&nbsp;<span class="op" id="4312978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312983"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4312984">.</span><span class="ident" id="4312985">blockStart</span>&nbsp;<span class="op" id="4312996">=</span>&nbsp;<span class="ident" id="4312998"><a href="/compress/flate/deflate.go.html#4310166">math</a></span><span class="op" id="4313002">.</span><span class="ident" id="4313003">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313018"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313019">.</span><span class="ident" id="4313020">hashOffset</span>&nbsp;<span class="op" id="4313031">+=</span>&nbsp;<span class="ident" id="4313034"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313047">if</span>&nbsp;<span class="ident" id="4313050"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313051">.</span><span class="ident" id="4313052">hashOffset</span>&nbsp;<span class="op" id="4313063">&gt;</span>&nbsp;<span class="ident" id="4313065"><a href="/compress/flate/deflate.go.html#4311023">maxHashOffset</a></span>&nbsp;<span class="op" id="4313079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313084">delta</span>&nbsp;<span class="op" id="4313090">:=</span>&nbsp;<span class="ident" id="4313093"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313094">.</span><span class="ident" id="4313095">hashOffset</span>&nbsp;<span class="op" id="4313106">-</span>&nbsp;<span class="num" id="4313108">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313113"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313114">.</span><span class="ident" id="4313115">hashOffset</span>&nbsp;<span class="op" id="4313126">-=</span>&nbsp;<span class="ident" id="4313129"><a href="/compress/flate/deflate.go.html#4313084">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313138"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313139">.</span><span class="ident" id="4313140">chainHead</span>&nbsp;<span class="op" id="4313150">-=</span>&nbsp;<span class="ident" id="4313153"><a href="/compress/flate/deflate.go.html#4313084">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313162">for</span>&nbsp;<span class="ident" id="4313166">i</span><span class="op" id="4313167">,</span>&nbsp;<span class="ident" id="4313169">v</span>&nbsp;<span class="op" id="4313171">:=</span>&nbsp;<span class="keyword" id="4313174">range</span>&nbsp;<span class="ident" id="4313180"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313181">.</span><span class="ident" id="4313182">hashPrev</span>&nbsp;<span class="op" id="4313191">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313197">if</span>&nbsp;<span class="ident" id="4313200"><a href="/compress/flate/deflate.go.html#4313169">v</a></span>&nbsp;<span class="op" id="4313202">&gt;</span>&nbsp;<span class="ident" id="4313204"><a href="/compress/flate/deflate.go.html#4313084">delta</a></span>&nbsp;<span class="op" id="4313210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313217"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313218">.</span><span class="ident" id="4313219">hashPrev</span><span class="op" id="4313227">[</span><span class="ident" id="4313228"><a href="/compress/flate/deflate.go.html#4313166">i</a></span><span class="op" id="4313229">]</span>&nbsp;<span class="op" id="4313231">-=</span>&nbsp;<span class="ident" id="4313234"><a href="/compress/flate/deflate.go.html#4313084">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313244">}</span>&nbsp;<span class="keyword" id="4313246">else</span>&nbsp;<span class="op" id="4313251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313258"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313259">.</span><span class="ident" id="4313260">hashPrev</span><span class="op" id="4313268">[</span><span class="ident" id="4313269"><a href="/compress/flate/deflate.go.html#4313166">i</a></span><span class="op" id="4313270">]</span>&nbsp;<span class="op" id="4313272">=</span>&nbsp;<span class="num" id="4313274">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313280">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313290">for</span>&nbsp;<span class="ident" id="4313294">i</span><span class="op" id="4313295">,</span>&nbsp;<span class="ident" id="4313297">v</span>&nbsp;<span class="op" id="4313299">:=</span>&nbsp;<span class="keyword" id="4313302">range</span>&nbsp;<span class="ident" id="4313308"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313309">.</span><span class="ident" id="4313310">hashHead</span>&nbsp;<span class="op" id="4313319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313325">if</span>&nbsp;<span class="ident" id="4313328"><a href="/compress/flate/deflate.go.html#4313297">v</a></span>&nbsp;<span class="op" id="4313330">&gt;</span>&nbsp;<span class="ident" id="4313332"><a href="/compress/flate/deflate.go.html#4313084">delta</a></span>&nbsp;<span class="op" id="4313338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313345"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313346">.</span><span class="ident" id="4313347">hashHead</span><span class="op" id="4313355">[</span><span class="ident" id="4313356"><a href="/compress/flate/deflate.go.html#4313294">i</a></span><span class="op" id="4313357">]</span>&nbsp;<span class="op" id="4313359">-=</span>&nbsp;<span class="ident" id="4313362"><a href="/compress/flate/deflate.go.html#4313084">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313372">}</span>&nbsp;<span class="keyword" id="4313374">else</span>&nbsp;<span class="op" id="4313379">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313386"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313387">.</span><span class="ident" id="4313388">hashHead</span><span class="op" id="4313396">[</span><span class="ident" id="4313397"><a href="/compress/flate/deflate.go.html#4313294">i</a></span><span class="op" id="4313398">]</span>&nbsp;<span class="op" id="4313400">=</span>&nbsp;<span class="num" id="4313402">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313420">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313423">n</span>&nbsp;<span class="op" id="4313425">:=</span>&nbsp;<span class="builtinfunc" id="4313428">copy</span><span class="op" id="4313432">(</span><span class="ident" id="4313433"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313434">.</span><span class="ident" id="4313435">window</span><span class="op" id="4313441">[</span><span class="ident" id="4313442"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313443">.</span><span class="ident" id="4313444">windowEnd</span><span class="op" id="4313453">:</span><span class="op" id="4313454">]</span><span class="op" id="4313455">,</span>&nbsp;<span class="ident" id="4313457"><a href="/compress/flate/deflate.go.html#4312687">b</a></span><span class="op" id="4313458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313461"><a href="/compress/flate/deflate.go.html#4312660">d</a></span><span class="op" id="4313462">.</span><span class="ident" id="4313463">windowEnd</span>&nbsp;<span class="op" id="4313473">+=</span>&nbsp;<span class="ident" id="4313476"><a href="/compress/flate/deflate.go.html#4313423">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313479">return</span>&nbsp;<span class="ident" id="4313486"><a href="/compress/flate/deflate.go.html#4313423">n</a></span><br>
<span class="lineno"></span><span class="op" id="4313488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="4313491">func</span>&nbsp;<span class="op" id="4313496">(</span><span class="ident" id="4313497">d</span>&nbsp;<span class="op" id="4313499">*</span><span class="ident" id="4313500"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4313510">)</span>&nbsp;<span class="ident" id="4313512">writeBlock</span><span class="op" id="4313522">(</span><span class="ident" id="4313523">tokens</span>&nbsp;<span class="op" id="4313530">[</span><span class="op" id="4313531">]</span><span class="ident" id="4313532"><a href="/compress/flate/token.go.html#4374045">token</a></span><span class="op" id="4313537">,</span>&nbsp;<span class="ident" id="4313539">index</span>&nbsp;<span class="builtintype" id="4313545">int</span><span class="op" id="4313548">,</span>&nbsp;<span class="ident" id="4313550">eof</span>&nbsp;<span class="builtintype" id="4313554">bool</span><span class="op" id="4313558">)</span>&nbsp;<span class="builtintype" id="4313560">error</span>&nbsp;<span class="op" id="4313566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313569">if</span>&nbsp;<span class="ident" id="4313572"><a href="/compress/flate/deflate.go.html#4313539">index</a></span>&nbsp;<span class="op" id="4313578">&gt;</span>&nbsp;<span class="num" id="4313580">0</span>&nbsp;<span class="op" id="4313582">||</span>&nbsp;<span class="ident" id="4313585"><a href="/compress/flate/deflate.go.html#4313550">eof</a></span>&nbsp;<span class="op" id="4313589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313593">var</span>&nbsp;<span class="ident" id="4313597">window</span>&nbsp;<span class="op" id="4313604">[</span><span class="op" id="4313605">]</span><span class="builtintype" id="4313606">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313613">if</span>&nbsp;<span class="ident" id="4313616"><a href="/compress/flate/deflate.go.html#4313497">d</a></span><span class="op" id="4313617">.</span><span class="ident" id="4313618">blockStart</span>&nbsp;<span class="op" id="4313629">&lt;=</span>&nbsp;<span class="ident" id="4313632"><a href="/compress/flate/deflate.go.html#4313539">index</a></span>&nbsp;<span class="op" id="4313638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313643"><a href="/compress/flate/deflate.go.html#4313597">window</a></span>&nbsp;<span class="op" id="4313650">=</span>&nbsp;<span class="ident" id="4313652"><a href="/compress/flate/deflate.go.html#4313497">d</a></span><span class="op" id="4313653">.</span><span class="ident" id="4313654">window</span><span class="op" id="4313660">[</span><span class="ident" id="4313661"><a href="/compress/flate/deflate.go.html#4313497">d</a></span><span class="op" id="4313662">.</span><span class="ident" id="4313663">blockStart</span><span class="op" id="4313673">:</span><span class="ident" id="4313674"><a href="/compress/flate/deflate.go.html#4313539">index</a></span><span class="op" id="4313679">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313687"><a href="/compress/flate/deflate.go.html#4313497">d</a></span><span class="op" id="4313688">.</span><span class="ident" id="4313689">blockStart</span>&nbsp;<span class="op" id="4313700">=</span>&nbsp;<span class="ident" id="4313702"><a href="/compress/flate/deflate.go.html#4313539">index</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313710"><a href="/compress/flate/deflate.go.html#4313497">d</a></span><span class="op" id="4313711">.</span><span class="ident" id="4313712">w</span><span class="op" id="4313713">.</span><span class="ident" id="4313714">writeBlock</span><span class="op" id="4313724">(</span><span class="ident" id="4313725"><a href="/compress/flate/deflate.go.html#4313523">tokens</a></span><span class="op" id="4313731">,</span>&nbsp;<span class="ident" id="4313733"><a href="/compress/flate/deflate.go.html#4313550">eof</a></span><span class="op" id="4313736">,</span>&nbsp;<span class="ident" id="4313738"><a href="/compress/flate/deflate.go.html#4313597">window</a></span><span class="op" id="4313744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313748">return</span>&nbsp;<span class="ident" id="4313755"><a href="/compress/flate/deflate.go.html#4313497">d</a></span><span class="op" id="4313756">.</span><span class="ident" id="4313757">w</span><span class="op" id="4313758">.</span><span class="ident" id="4313759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313764">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313767">return</span>&nbsp;<span class="ident" id="4313774">nil</span><br>
<span class="lineno"></span><span class="op" id="4313778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4313781">//&nbsp;Try&nbsp;to&nbsp;find&nbsp;a&nbsp;match&nbsp;starting&nbsp;at&nbsp;index&nbsp;whose&nbsp;length&nbsp;is&nbsp;greater&nbsp;than&nbsp;prevSize.</span><br>
<span class="lineno"></span><span class="comment" id="4313861">//&nbsp;We&nbsp;only&nbsp;look&nbsp;at&nbsp;chainCount&nbsp;possibilities&nbsp;before&nbsp;giving&nbsp;up.</span><br>
<span class="lineno">150</span><span class="keyword" id="4313923">func</span>&nbsp;<span class="op" id="4313928">(</span><span class="ident" id="4313929">d</span>&nbsp;<span class="op" id="4313931">*</span><span class="ident" id="4313932"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4313942">)</span>&nbsp;<span class="ident" id="4313944">findMatch</span><span class="op" id="4313953">(</span><span class="ident" id="4313954">pos</span>&nbsp;<span class="builtintype" id="4313958">int</span><span class="op" id="4313961">,</span>&nbsp;<span class="ident" id="4313963">prevHead</span>&nbsp;<span class="builtintype" id="4313972">int</span><span class="op" id="4313975">,</span>&nbsp;<span class="ident" id="4313977">prevLength</span>&nbsp;<span class="builtintype" id="4313988">int</span><span class="op" id="4313991">,</span>&nbsp;<span class="ident" id="4313993">lookahead</span>&nbsp;<span class="builtintype" id="4314003">int</span><span class="op" id="4314006">)</span>&nbsp;<span class="op" id="4314008">(</span><span class="ident" id="4314009">length</span><span class="op" id="4314015">,</span>&nbsp;<span class="ident" id="4314017">offset</span>&nbsp;<span class="builtintype" id="4314024">int</span><span class="op" id="4314027">,</span>&nbsp;<span class="ident" id="4314029">ok</span>&nbsp;<span class="builtintype" id="4314032">bool</span><span class="op" id="4314036">)</span>&nbsp;<span class="op" id="4314038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314041">minMatchLook</span>&nbsp;<span class="op" id="4314054">:=</span>&nbsp;<span class="ident" id="4314057"><a href="/compress/flate/deflate.go.html#4310533">maxMatchLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314073">if</span>&nbsp;<span class="ident" id="4314076"><a href="/compress/flate/deflate.go.html#4313993">lookahead</a></span>&nbsp;<span class="op" id="4314086">&lt;</span>&nbsp;<span class="ident" id="4314088"><a href="/compress/flate/deflate.go.html#4314041">minMatchLook</a></span>&nbsp;<span class="op" id="4314101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314105"><a href="/compress/flate/deflate.go.html#4314041">minMatchLook</a></span>&nbsp;<span class="op" id="4314118">=</span>&nbsp;<span class="ident" id="4314120"><a href="/compress/flate/deflate.go.html#4313993">lookahead</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314131">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314135">win</span>&nbsp;<span class="op" id="4314139">:=</span>&nbsp;<span class="ident" id="4314142"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4314143">.</span><span class="ident" id="4314144">window</span><span class="op" id="4314150">[</span><span class="num" id="4314151">0</span>&nbsp;<span class="op" id="4314153">:</span>&nbsp;<span class="ident" id="4314155"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314158">+</span><span class="ident" id="4314159"><a href="/compress/flate/deflate.go.html#4314041">minMatchLook</a></span><span class="op" id="4314171">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4314175">//&nbsp;We&nbsp;quit&nbsp;when&nbsp;we&nbsp;get&nbsp;a&nbsp;match&nbsp;that&#39;s&nbsp;at&nbsp;least&nbsp;nice&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314233">nice</span>&nbsp;<span class="op" id="4314238">:=</span>&nbsp;<span class="builtinfunc" id="4314241">len</span><span class="op" id="4314244">(</span><span class="ident" id="4314245"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314248">)</span>&nbsp;<span class="op" id="4314250">-</span>&nbsp;<span class="ident" id="4314252"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314257">if</span>&nbsp;<span class="ident" id="4314260"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4314261">.</span><span class="ident" id="4314262">nice</span>&nbsp;<span class="op" id="4314267">&lt;</span>&nbsp;<span class="ident" id="4314269"><a href="/compress/flate/deflate.go.html#4314233">nice</a></span>&nbsp;<span class="op" id="4314274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314278"><a href="/compress/flate/deflate.go.html#4314233">nice</a></span>&nbsp;<span class="op" id="4314283">=</span>&nbsp;<span class="ident" id="4314285"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4314286">.</span><span class="ident" id="4314287">nice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4314297">//&nbsp;If&nbsp;we&#39;ve&nbsp;got&nbsp;a&nbsp;match&nbsp;that&#39;s&nbsp;good&nbsp;enough,&nbsp;only&nbsp;look&nbsp;in&nbsp;1/4&nbsp;the&nbsp;chain.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314370">tries</span>&nbsp;<span class="op" id="4314376">:=</span>&nbsp;<span class="ident" id="4314379"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4314380">.</span><span class="ident" id="4314381">chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314388"><a href="/compress/flate/deflate.go.html#4314009">length</a></span>&nbsp;<span class="op" id="4314395">=</span>&nbsp;<span class="ident" id="4314397"><a href="/compress/flate/deflate.go.html#4313977">prevLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314409">if</span>&nbsp;<span class="ident" id="4314412"><a href="/compress/flate/deflate.go.html#4314009">length</a></span>&nbsp;<span class="op" id="4314419">&gt;=</span>&nbsp;<span class="ident" id="4314422"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4314423">.</span><span class="ident" id="4314424">good</span>&nbsp;<span class="op" id="4314429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314433"><a href="/compress/flate/deflate.go.html#4314370">tries</a></span>&nbsp;<span class="op" id="4314439">&gt;&gt;=</span>&nbsp;<span class="num" id="4314443">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314446">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314450">w0</span>&nbsp;<span class="op" id="4314453">:=</span>&nbsp;<span class="ident" id="4314456"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314459">[</span><span class="ident" id="4314460"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314463">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314466">w1</span>&nbsp;<span class="op" id="4314469">:=</span>&nbsp;<span class="ident" id="4314472"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314475">[</span><span class="ident" id="4314476"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314479">+</span><span class="num" id="4314480">1</span><span class="op" id="4314481">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314484">wEnd</span>&nbsp;<span class="op" id="4314489">:=</span>&nbsp;<span class="ident" id="4314492"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314495">[</span><span class="ident" id="4314496"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314499">+</span><span class="ident" id="4314500"><a href="/compress/flate/deflate.go.html#4314009">length</a></span><span class="op" id="4314506">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314509">minIndex</span>&nbsp;<span class="op" id="4314518">:=</span>&nbsp;<span class="ident" id="4314521"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span>&nbsp;<span class="op" id="4314525">-</span>&nbsp;<span class="ident" id="4314527"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314540">for</span>&nbsp;<span class="ident" id="4314544">i</span>&nbsp;<span class="op" id="4314546">:=</span>&nbsp;<span class="ident" id="4314549"><a href="/compress/flate/deflate.go.html#4313963">prevHead</a></span><span class="op" id="4314557">;</span>&nbsp;<span class="ident" id="4314559"><a href="/compress/flate/deflate.go.html#4314370">tries</a></span>&nbsp;<span class="op" id="4314565">&gt;</span>&nbsp;<span class="num" id="4314567">0</span><span class="op" id="4314568">;</span>&nbsp;<span class="ident" id="4314570"><a href="/compress/flate/deflate.go.html#4314370">tries</a></span><span class="op" id="4314575">--</span>&nbsp;<span class="op" id="4314578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314582">if</span>&nbsp;<span class="ident" id="4314585"><a href="/compress/flate/deflate.go.html#4314450">w0</a></span>&nbsp;<span class="op" id="4314588">==</span>&nbsp;<span class="ident" id="4314591"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314594">[</span><span class="ident" id="4314595"><a href="/compress/flate/deflate.go.html#4314544">i</a></span><span class="op" id="4314596">]</span>&nbsp;<span class="op" id="4314598">&amp;&amp;</span>&nbsp;<span class="ident" id="4314601"><a href="/compress/flate/deflate.go.html#4314466">w1</a></span>&nbsp;<span class="op" id="4314604">==</span>&nbsp;<span class="ident" id="4314607"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314610">[</span><span class="ident" id="4314611"><a href="/compress/flate/deflate.go.html#4314544">i</a></span><span class="op" id="4314612">+</span><span class="num" id="4314613">1</span><span class="op" id="4314614">]</span>&nbsp;<span class="op" id="4314616">&amp;&amp;</span>&nbsp;<span class="ident" id="4314619"><a href="/compress/flate/deflate.go.html#4314484">wEnd</a></span>&nbsp;<span class="op" id="4314624">==</span>&nbsp;<span class="ident" id="4314627"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314630">[</span><span class="ident" id="4314631"><a href="/compress/flate/deflate.go.html#4314544">i</a></span><span class="op" id="4314632">+</span><span class="ident" id="4314633"><a href="/compress/flate/deflate.go.html#4314009">length</a></span><span class="op" id="4314639">]</span>&nbsp;<span class="op" id="4314641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4314646">//&nbsp;The&nbsp;hash&nbsp;function&nbsp;ensures&nbsp;that&nbsp;if&nbsp;win[i]&nbsp;and&nbsp;win[i+1]&nbsp;match,&nbsp;win[i+2]&nbsp;matches</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314731">n</span>&nbsp;<span class="op" id="4314733">:=</span>&nbsp;<span class="num" id="4314736">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314741">for</span>&nbsp;<span class="ident" id="4314745"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314748">+</span><span class="ident" id="4314749"><a href="/compress/flate/deflate.go.html#4314731">n</a></span>&nbsp;<span class="op" id="4314751">&lt;</span>&nbsp;<span class="builtinfunc" id="4314753">len</span><span class="op" id="4314756">(</span><span class="ident" id="4314757"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314760">)</span>&nbsp;<span class="op" id="4314762">&amp;&amp;</span>&nbsp;<span class="ident" id="4314765"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314768">[</span><span class="ident" id="4314769"><a href="/compress/flate/deflate.go.html#4314544">i</a></span><span class="op" id="4314770">+</span><span class="ident" id="4314771"><a href="/compress/flate/deflate.go.html#4314731">n</a></span><span class="op" id="4314772">]</span>&nbsp;<span class="op" id="4314774">==</span>&nbsp;<span class="ident" id="4314777"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4314780">[</span><span class="ident" id="4314781"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314784">+</span><span class="ident" id="4314785"><a href="/compress/flate/deflate.go.html#4314731">n</a></span><span class="op" id="4314786">]</span>&nbsp;<span class="op" id="4314788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314794"><a href="/compress/flate/deflate.go.html#4314731">n</a></span><span class="op" id="4314795">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314806">if</span>&nbsp;<span class="ident" id="4314809"><a href="/compress/flate/deflate.go.html#4314731">n</a></span>&nbsp;<span class="op" id="4314811">&gt;</span>&nbsp;<span class="ident" id="4314813"><a href="/compress/flate/deflate.go.html#4314009">length</a></span>&nbsp;<span class="op" id="4314820">&amp;&amp;</span>&nbsp;<span class="op" id="4314823">(</span><span class="ident" id="4314824"><a href="/compress/flate/deflate.go.html#4314731">n</a></span>&nbsp;<span class="op" id="4314826">&gt;</span>&nbsp;<span class="num" id="4314828">3</span>&nbsp;<span class="op" id="4314830">||</span>&nbsp;<span class="ident" id="4314833"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4314836">-</span><span class="ident" id="4314837"><a href="/compress/flate/deflate.go.html#4314544">i</a></span>&nbsp;<span class="op" id="4314839">&lt;=</span>&nbsp;<span class="num" id="4314842">4096</span><span class="op" id="4314846">)</span>&nbsp;<span class="op" id="4314848">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314854"><a href="/compress/flate/deflate.go.html#4314009">length</a></span>&nbsp;<span class="op" id="4314861">=</span>&nbsp;<span class="ident" id="4314863"><a href="/compress/flate/deflate.go.html#4314731">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314869"><a href="/compress/flate/deflate.go.html#4314017">offset</a></span>&nbsp;<span class="op" id="4314876">=</span>&nbsp;<span class="ident" id="4314878"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span>&nbsp;<span class="op" id="4314882">-</span>&nbsp;<span class="ident" id="4314884"><a href="/compress/flate/deflate.go.html#4314544">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314890"><a href="/compress/flate/deflate.go.html#4314029">ok</a></span>&nbsp;<span class="op" id="4314893">=</span>&nbsp;<span class="builtintype" id="4314895">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314904">if</span>&nbsp;<span class="ident" id="4314907"><a href="/compress/flate/deflate.go.html#4314731">n</a></span>&nbsp;<span class="op" id="4314909">&gt;=</span>&nbsp;<span class="ident" id="4314912"><a href="/compress/flate/deflate.go.html#4314233">nice</a></span>&nbsp;<span class="op" id="4314917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4314924">//&nbsp;The&nbsp;match&nbsp;is&nbsp;good&nbsp;enough&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;try&nbsp;to&nbsp;find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314997">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315013"><a href="/compress/flate/deflate.go.html#4314484">wEnd</a></span>&nbsp;<span class="op" id="4315018">=</span>&nbsp;<span class="ident" id="4315020"><a href="/compress/flate/deflate.go.html#4314135">win</a></span><span class="op" id="4315023">[</span><span class="ident" id="4315024"><a href="/compress/flate/deflate.go.html#4313954">pos</a></span><span class="op" id="4315027">+</span><span class="ident" id="4315028"><a href="/compress/flate/deflate.go.html#4314731">n</a></span><span class="op" id="4315029">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315038">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315042">if</span>&nbsp;<span class="ident" id="4315045"><a href="/compress/flate/deflate.go.html#4314544">i</a></span>&nbsp;<span class="op" id="4315047">==</span>&nbsp;<span class="ident" id="4315050"><a href="/compress/flate/deflate.go.html#4314509">minIndex</a></span>&nbsp;<span class="op" id="4315059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4315064">//&nbsp;hashPrev[i&nbsp;&amp;&nbsp;windowMask]&nbsp;has&nbsp;already&nbsp;been&nbsp;overwritten,&nbsp;so&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315138">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315150">if</span>&nbsp;<span class="ident" id="4315153"><a href="/compress/flate/deflate.go.html#4314544">i</a></span>&nbsp;<span class="op" id="4315155">=</span>&nbsp;<span class="ident" id="4315157"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4315158">.</span><span class="ident" id="4315159">hashPrev</span><span class="op" id="4315167">[</span><span class="ident" id="4315168"><a href="/compress/flate/deflate.go.html#4314544">i</a></span><span class="op" id="4315169">&amp;</span><span class="ident" id="4315170"><a href="/compress/flate/deflate.go.html#4310372">windowMask</a></span><span class="op" id="4315180">]</span>&nbsp;<span class="op" id="4315182">-</span>&nbsp;<span class="ident" id="4315184"><a href="/compress/flate/deflate.go.html#4313929">d</a></span><span class="op" id="4315185">.</span><span class="ident" id="4315186">hashOffset</span><span class="op" id="4315196">;</span>&nbsp;<span class="ident" id="4315198"><a href="/compress/flate/deflate.go.html#4314544">i</a></span>&nbsp;<span class="op" id="4315200">&lt;</span>&nbsp;<span class="ident" id="4315202"><a href="/compress/flate/deflate.go.html#4314509">minIndex</a></span>&nbsp;<span class="op" id="4315211">||</span>&nbsp;<span class="ident" id="4315214"><a href="/compress/flate/deflate.go.html#4314544">i</a></span>&nbsp;<span class="op" id="4315216">&lt;</span>&nbsp;<span class="num" id="4315218">0</span>&nbsp;<span class="op" id="4315220">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315225">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315239">return</span><br>
<span class="lineno"></span><span class="op" id="4315246">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="4315249">func</span>&nbsp;<span class="op" id="4315254">(</span><span class="ident" id="4315255">d</span>&nbsp;<span class="op" id="4315257">*</span><span class="ident" id="4315258"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4315268">)</span>&nbsp;<span class="ident" id="4315270">writeStoredBlock</span><span class="op" id="4315286">(</span><span class="ident" id="4315287">buf</span>&nbsp;<span class="op" id="4315291">[</span><span class="op" id="4315292">]</span><span class="builtintype" id="4315293">byte</span><span class="op" id="4315297">)</span>&nbsp;<span class="builtintype" id="4315299">error</span>&nbsp;<span class="op" id="4315305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315308">if</span>&nbsp;<span class="ident" id="4315311"><a href="/compress/flate/deflate.go.html#4315255">d</a></span><span class="op" id="4315312">.</span><span class="ident" id="4315313">w</span><span class="op" id="4315314">.</span><span class="ident" id="4315315">writeStoredHeader</span><span class="op" id="4315332">(</span><span class="builtinfunc" id="4315333">len</span><span class="op" id="4315336">(</span><span class="ident" id="4315337"><a href="/compress/flate/deflate.go.html#4315287">buf</a></span><span class="op" id="4315340">)</span><span class="op" id="4315341">,</span>&nbsp;<span class="builtintype" id="4315343">false</span><span class="op" id="4315348">)</span><span class="op" id="4315349">;</span>&nbsp;<span class="ident" id="4315351"><a href="/compress/flate/deflate.go.html#4315255">d</a></span><span class="op" id="4315352">.</span><span class="ident" id="4315353">w</span><span class="op" id="4315354">.</span><span class="ident" id="4315355">err</span>&nbsp;<span class="op" id="4315359">!=</span>&nbsp;<span class="ident" id="4315362">nil</span>&nbsp;<span class="op" id="4315366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315370">return</span>&nbsp;<span class="ident" id="4315377"><a href="/compress/flate/deflate.go.html#4315255">d</a></span><span class="op" id="4315378">.</span><span class="ident" id="4315379">w</span><span class="op" id="4315380">.</span><span class="ident" id="4315381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315386">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315389"><a href="/compress/flate/deflate.go.html#4315255">d</a></span><span class="op" id="4315390">.</span><span class="ident" id="4315391">w</span><span class="op" id="4315392">.</span><span class="ident" id="4315393">writeBytes</span><span class="op" id="4315403">(</span><span class="ident" id="4315404"><a href="/compress/flate/deflate.go.html#4315287">buf</a></span><span class="op" id="4315407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315410">return</span>&nbsp;<span class="ident" id="4315417"><a href="/compress/flate/deflate.go.html#4315255">d</a></span><span class="op" id="4315418">.</span><span class="ident" id="4315419">w</span><span class="op" id="4315420">.</span><span class="ident" id="4315421">err</span><br>
<span class="lineno"></span><span class="op" id="4315425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4315428">func</span>&nbsp;<span class="op" id="4315433">(</span><span class="ident" id="4315434">d</span>&nbsp;<span class="op" id="4315436">*</span><span class="ident" id="4315437"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4315447">)</span>&nbsp;<span class="ident" id="4315449">initDeflate</span><span class="op" id="4315460">(</span><span class="op" id="4315461">)</span>&nbsp;<span class="op" id="4315463">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315466"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315467">.</span><span class="ident" id="4315468">hashHead</span>&nbsp;<span class="op" id="4315477">=</span>&nbsp;<span class="builtinfunc" id="4315479">make</span><span class="op" id="4315483">(</span><span class="op" id="4315484">[</span><span class="op" id="4315485">]</span><span class="builtintype" id="4315486">int</span><span class="op" id="4315489">,</span>&nbsp;<span class="ident" id="4315491"><a href="/compress/flate/deflate.go.html#4310871">hashSize</a></span><span class="op" id="4315499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315502"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315503">.</span><span class="ident" id="4315504">hashPrev</span>&nbsp;<span class="op" id="4315513">=</span>&nbsp;<span class="builtinfunc" id="4315515">make</span><span class="op" id="4315519">(</span><span class="op" id="4315520">[</span><span class="op" id="4315521">]</span><span class="builtintype" id="4315522">int</span><span class="op" id="4315525">,</span>&nbsp;<span class="ident" id="4315527"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><span class="op" id="4315537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315540"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315541">.</span><span class="ident" id="4315542">window</span>&nbsp;<span class="op" id="4315549">=</span>&nbsp;<span class="builtinfunc" id="4315551">make</span><span class="op" id="4315555">(</span><span class="op" id="4315556">[</span><span class="op" id="4315557">]</span><span class="builtintype" id="4315558">byte</span><span class="op" id="4315562">,</span>&nbsp;<span class="num" id="4315564">2</span><span class="op" id="4315565">*</span><span class="ident" id="4315566"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><span class="op" id="4315576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315579"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315580">.</span><span class="ident" id="4315581">hashOffset</span>&nbsp;<span class="op" id="4315592">=</span>&nbsp;<span class="num" id="4315594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315597"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315598">.</span><span class="ident" id="4315599">tokens</span>&nbsp;<span class="op" id="4315606">=</span>&nbsp;<span class="builtinfunc" id="4315608">make</span><span class="op" id="4315612">(</span><span class="op" id="4315613">[</span><span class="op" id="4315614">]</span><span class="ident" id="4315615"><a href="/compress/flate/token.go.html#4374045">token</a></span><span class="op" id="4315620">,</span>&nbsp;<span class="num" id="4315622">0</span><span class="op" id="4315623">,</span>&nbsp;<span class="ident" id="4315625"><a href="/compress/flate/deflate.go.html#4310785">maxFlateBlockTokens</a></span><span class="op" id="4315644">+</span><span class="num" id="4315645">1</span><span class="op" id="4315646">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315649"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315650">.</span><span class="ident" id="4315651">length</span>&nbsp;<span class="op" id="4315658">=</span>&nbsp;<span class="ident" id="4315660"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4315675">-</span>&nbsp;<span class="num" id="4315677">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315680"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315681">.</span><span class="ident" id="4315682">offset</span>&nbsp;<span class="op" id="4315689">=</span>&nbsp;<span class="num" id="4315691">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315694"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315695">.</span><span class="ident" id="4315696">byteAvailable</span>&nbsp;<span class="op" id="4315710">=</span>&nbsp;<span class="builtintype" id="4315712">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315719"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315720">.</span><span class="ident" id="4315721">index</span>&nbsp;<span class="op" id="4315727">=</span>&nbsp;<span class="num" id="4315729">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315732"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315733">.</span><span class="ident" id="4315734">hash</span>&nbsp;<span class="op" id="4315739">=</span>&nbsp;<span class="num" id="4315741">0</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315744"><a href="/compress/flate/deflate.go.html#4315434">d</a></span><span class="op" id="4315745">.</span><span class="ident" id="4315746">chainHead</span>&nbsp;<span class="op" id="4315756">=</span>&nbsp;<span class="op" id="4315758">-</span><span class="num" id="4315759">1</span><br>
<span class="lineno"></span><span class="op" id="4315761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4315764">func</span>&nbsp;<span class="op" id="4315769">(</span><span class="ident" id="4315770">d</span>&nbsp;<span class="op" id="4315772">*</span><span class="ident" id="4315773"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4315783">)</span>&nbsp;<span class="ident" id="4315785">deflate</span><span class="op" id="4315792">(</span><span class="op" id="4315793">)</span>&nbsp;<span class="op" id="4315795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315798">if</span>&nbsp;<span class="ident" id="4315801"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315802">.</span><span class="ident" id="4315803">windowEnd</span><span class="op" id="4315812">-</span><span class="ident" id="4315813"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315814">.</span><span class="ident" id="4315815">index</span>&nbsp;<span class="op" id="4315821">&lt;</span>&nbsp;<span class="ident" id="4315823"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4315837">+</span><span class="ident" id="4315838"><a href="/compress/flate/deflate.go.html#4310533">maxMatchLength</a></span>&nbsp;<span class="op" id="4315853">&amp;&amp;</span>&nbsp;<span class="op" id="4315856">!</span><span class="ident" id="4315857"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315858">.</span><span class="ident" id="4315859">sync</span>&nbsp;<span class="op" id="4315864">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315868">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315880"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315881">.</span><span class="ident" id="4315882">maxInsertIndex</span>&nbsp;<span class="op" id="4315897">=</span>&nbsp;<span class="ident" id="4315899"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315900">.</span><span class="ident" id="4315901">windowEnd</span>&nbsp;<span class="op" id="4315911">-</span>&nbsp;<span class="op" id="4315913">(</span><span class="ident" id="4315914"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4315929">-</span>&nbsp;<span class="num" id="4315931">1</span><span class="op" id="4315932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315935">if</span>&nbsp;<span class="ident" id="4315938"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315939">.</span><span class="ident" id="4315940">index</span>&nbsp;<span class="op" id="4315946">&lt;</span>&nbsp;<span class="ident" id="4315948"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315949">.</span><span class="ident" id="4315950">maxInsertIndex</span>&nbsp;<span class="op" id="4315965">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315969"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315970">.</span><span class="ident" id="4315971">hash</span>&nbsp;<span class="op" id="4315976">=</span>&nbsp;<span class="builtintype" id="4315978">int</span><span class="op" id="4315981">(</span><span class="ident" id="4315982"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315983">.</span><span class="ident" id="4315984">window</span><span class="op" id="4315990">[</span><span class="ident" id="4315991"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4315992">.</span><span class="ident" id="4315993">index</span><span class="op" id="4315998">]</span><span class="op" id="4315999">)</span><span class="op" id="4316000">&lt;&lt;</span><span class="ident" id="4316002"><a href="/compress/flate/deflate.go.html#4310951">hashShift</a></span>&nbsp;<span class="op" id="4316012">+</span>&nbsp;<span class="builtintype" id="4316014">int</span><span class="op" id="4316017">(</span><span class="ident" id="4316018"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316019">.</span><span class="ident" id="4316020">window</span><span class="op" id="4316026">[</span><span class="ident" id="4316027"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316028">.</span><span class="ident" id="4316029">index</span><span class="op" id="4316034">+</span><span class="num" id="4316035">1</span><span class="op" id="4316036">]</span><span class="op" id="4316037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4316043">Loop</span><span class="op" id="4316047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316050">for</span>&nbsp;<span class="op" id="4316054">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316058">if</span>&nbsp;<span class="ident" id="4316061"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316062">.</span><span class="ident" id="4316063">index</span>&nbsp;<span class="op" id="4316069">&gt;</span>&nbsp;<span class="ident" id="4316071"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316072">.</span><span class="ident" id="4316073">windowEnd</span>&nbsp;<span class="op" id="4316083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4316088">panic</span><span class="op" id="4316093">(</span><span class="string" id="4316094">&#34;index&nbsp;&gt;&nbsp;windowEnd&#34;</span><span class="op" id="4316113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316121">lookahead</span>&nbsp;<span class="op" id="4316131">:=</span>&nbsp;<span class="ident" id="4316134"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316135">.</span><span class="ident" id="4316136">windowEnd</span>&nbsp;<span class="op" id="4316146">-</span>&nbsp;<span class="ident" id="4316148"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316149">.</span><span class="ident" id="4316150">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316158">if</span>&nbsp;<span class="ident" id="4316161"><a href="/compress/flate/deflate.go.html#4316121">lookahead</a></span>&nbsp;<span class="op" id="4316171">&lt;</span>&nbsp;<span class="ident" id="4316173"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4316187">+</span><span class="ident" id="4316188"><a href="/compress/flate/deflate.go.html#4310533">maxMatchLength</a></span>&nbsp;<span class="op" id="4316203">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316208">if</span>&nbsp;<span class="op" id="4316211">!</span><span class="ident" id="4316212"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316213">.</span><span class="ident" id="4316214">sync</span>&nbsp;<span class="op" id="4316219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316225">break</span>&nbsp;<span class="ident" id="4316231">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316244">if</span>&nbsp;<span class="ident" id="4316247"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316248">.</span><span class="ident" id="4316249">index</span>&nbsp;<span class="op" id="4316255">&gt;</span>&nbsp;<span class="ident" id="4316257"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316258">.</span><span class="ident" id="4316259">windowEnd</span>&nbsp;<span class="op" id="4316269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4316275">panic</span><span class="op" id="4316280">(</span><span class="string" id="4316281">&#34;index&nbsp;&gt;&nbsp;windowEnd&#34;</span><span class="op" id="4316300">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316310">if</span>&nbsp;<span class="ident" id="4316313"><a href="/compress/flate/deflate.go.html#4316121">lookahead</a></span>&nbsp;<span class="op" id="4316323">==</span>&nbsp;<span class="num" id="4316326">0</span>&nbsp;<span class="op" id="4316328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4316334">//&nbsp;Flush&nbsp;current&nbsp;output&nbsp;block&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316376">if</span>&nbsp;<span class="ident" id="4316379"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316380">.</span><span class="ident" id="4316381">byteAvailable</span>&nbsp;<span class="op" id="4316395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4316402">//&nbsp;There&nbsp;is&nbsp;still&nbsp;one&nbsp;pending&nbsp;token&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;flushed</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316468"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316469">.</span><span class="ident" id="4316470">tokens</span>&nbsp;<span class="op" id="4316477">=</span>&nbsp;<span class="builtinfunc" id="4316479">append</span><span class="op" id="4316485">(</span><span class="ident" id="4316486"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316487">.</span><span class="ident" id="4316488">tokens</span><span class="op" id="4316494">,</span>&nbsp;<span class="ident" id="4316496"><a href="/compress/flate/token.go.html#4374107">literalToken</a></span><span class="op" id="4316508">(</span><span class="builtintype" id="4316509">uint32</span><span class="op" id="4316515">(</span><span class="ident" id="4316516"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316517">.</span><span class="ident" id="4316518">window</span><span class="op" id="4316524">[</span><span class="ident" id="4316525"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316526">.</span><span class="ident" id="4316527">index</span><span class="op" id="4316532">-</span><span class="num" id="4316533">1</span><span class="op" id="4316534">]</span><span class="op" id="4316535">)</span><span class="op" id="4316536">)</span><span class="op" id="4316537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316544"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316545">.</span><span class="ident" id="4316546">byteAvailable</span>&nbsp;<span class="op" id="4316560">=</span>&nbsp;<span class="builtintype" id="4316562">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316578">if</span>&nbsp;<span class="builtinfunc" id="4316581">len</span><span class="op" id="4316584">(</span><span class="ident" id="4316585"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316586">.</span><span class="ident" id="4316587">tokens</span><span class="op" id="4316593">)</span>&nbsp;<span class="op" id="4316595">&gt;</span>&nbsp;<span class="num" id="4316597">0</span>&nbsp;<span class="op" id="4316599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316606">if</span>&nbsp;<span class="ident" id="4316609"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316610">.</span><span class="ident" id="4316611">err</span>&nbsp;<span class="op" id="4316615">=</span>&nbsp;<span class="ident" id="4316617"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316618">.</span><span class="ident" id="4316619">writeBlock</span><span class="op" id="4316629">(</span><span class="ident" id="4316630"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316631">.</span><span class="ident" id="4316632">tokens</span><span class="op" id="4316638">,</span>&nbsp;<span class="ident" id="4316640"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316641">.</span><span class="ident" id="4316642">index</span><span class="op" id="4316647">,</span>&nbsp;<span class="builtintype" id="4316649">false</span><span class="op" id="4316654">)</span><span class="op" id="4316655">;</span>&nbsp;<span class="ident" id="4316657"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316658">.</span><span class="ident" id="4316659">err</span>&nbsp;<span class="op" id="4316663">!=</span>&nbsp;<span class="ident" id="4316666">nil</span>&nbsp;<span class="op" id="4316670">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316678">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316697"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316698">.</span><span class="ident" id="4316699">tokens</span>&nbsp;<span class="op" id="4316706">=</span>&nbsp;<span class="ident" id="4316708"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316709">.</span><span class="ident" id="4316710">tokens</span><span class="op" id="4316716">[</span><span class="op" id="4316717">:</span><span class="num" id="4316718">0</span><span class="op" id="4316719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316731">break</span>&nbsp;<span class="ident" id="4316737">Loop</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316753">if</span>&nbsp;<span class="ident" id="4316756"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316757">.</span><span class="ident" id="4316758">index</span>&nbsp;<span class="op" id="4316764">&lt;</span>&nbsp;<span class="ident" id="4316766"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316767">.</span><span class="ident" id="4316768">maxInsertIndex</span>&nbsp;<span class="op" id="4316783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4316788">//&nbsp;Update&nbsp;the&nbsp;hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316810"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316811">.</span><span class="ident" id="4316812">hash</span>&nbsp;<span class="op" id="4316817">=</span>&nbsp;<span class="op" id="4316819">(</span><span class="ident" id="4316820"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316821">.</span><span class="ident" id="4316822">hash</span><span class="op" id="4316826">&lt;&lt;</span><span class="ident" id="4316828"><a href="/compress/flate/deflate.go.html#4310951">hashShift</a></span>&nbsp;<span class="op" id="4316838">+</span>&nbsp;<span class="builtintype" id="4316840">int</span><span class="op" id="4316843">(</span><span class="ident" id="4316844"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316845">.</span><span class="ident" id="4316846">window</span><span class="op" id="4316852">[</span><span class="ident" id="4316853"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316854">.</span><span class="ident" id="4316855">index</span><span class="op" id="4316860">+</span><span class="num" id="4316861">2</span><span class="op" id="4316862">]</span><span class="op" id="4316863">)</span><span class="op" id="4316864">)</span>&nbsp;<span class="op" id="4316866">&amp;</span>&nbsp;<span class="ident" id="4316868"><a href="/compress/flate/deflate.go.html#4310908">hashMask</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316880"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316881">.</span><span class="ident" id="4316882">chainHead</span>&nbsp;<span class="op" id="4316892">=</span>&nbsp;<span class="ident" id="4316894"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316895">.</span><span class="ident" id="4316896">hashHead</span><span class="op" id="4316904">[</span><span class="ident" id="4316905"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316906">.</span><span class="ident" id="4316907">hash</span><span class="op" id="4316911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316916"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316917">.</span><span class="ident" id="4316918">hashPrev</span><span class="op" id="4316926">[</span><span class="ident" id="4316927"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316928">.</span><span class="ident" id="4316929">index</span><span class="op" id="4316934">&amp;</span><span class="ident" id="4316935"><a href="/compress/flate/deflate.go.html#4310372">windowMask</a></span><span class="op" id="4316945">]</span>&nbsp;<span class="op" id="4316947">=</span>&nbsp;<span class="ident" id="4316949"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316950">.</span><span class="ident" id="4316951">chainHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316964"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316965">.</span><span class="ident" id="4316966">hashHead</span><span class="op" id="4316974">[</span><span class="ident" id="4316975"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316976">.</span><span class="ident" id="4316977">hash</span><span class="op" id="4316981">]</span>&nbsp;<span class="op" id="4316983">=</span>&nbsp;<span class="ident" id="4316985"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316986">.</span><span class="ident" id="4316987">index</span>&nbsp;<span class="op" id="4316993">+</span>&nbsp;<span class="ident" id="4316995"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4316996">.</span><span class="ident" id="4316997">hashOffset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317014">prevLength</span>&nbsp;<span class="op" id="4317025">:=</span>&nbsp;<span class="ident" id="4317028"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317029">.</span><span class="ident" id="4317030">length</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317039">prevOffset</span>&nbsp;<span class="op" id="4317050">:=</span>&nbsp;<span class="ident" id="4317053"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317054">.</span><span class="ident" id="4317055">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317064"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317065">.</span><span class="ident" id="4317066">length</span>&nbsp;<span class="op" id="4317073">=</span>&nbsp;<span class="ident" id="4317075"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4317090">-</span>&nbsp;<span class="num" id="4317092">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317096"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317097">.</span><span class="ident" id="4317098">offset</span>&nbsp;<span class="op" id="4317105">=</span>&nbsp;<span class="num" id="4317107">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317111">minIndex</span>&nbsp;<span class="op" id="4317120">:=</span>&nbsp;<span class="ident" id="4317123"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317124">.</span><span class="ident" id="4317125">index</span>&nbsp;<span class="op" id="4317131">-</span>&nbsp;<span class="ident" id="4317133"><a href="/compress/flate/deflate.go.html#4310331">windowSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317146">if</span>&nbsp;<span class="ident" id="4317149"><a href="/compress/flate/deflate.go.html#4317111">minIndex</a></span>&nbsp;<span class="op" id="4317158">&lt;</span>&nbsp;<span class="num" id="4317160">0</span>&nbsp;<span class="op" id="4317162">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317167"><a href="/compress/flate/deflate.go.html#4317111">minIndex</a></span>&nbsp;<span class="op" id="4317176">=</span>&nbsp;<span class="num" id="4317178">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317187">if</span>&nbsp;<span class="ident" id="4317190"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317191">.</span><span class="ident" id="4317192">chainHead</span><span class="op" id="4317201">-</span><span class="ident" id="4317202"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317203">.</span><span class="ident" id="4317204">hashOffset</span>&nbsp;<span class="op" id="4317215">&gt;=</span>&nbsp;<span class="ident" id="4317218"><a href="/compress/flate/deflate.go.html#4317111">minIndex</a></span>&nbsp;<span class="op" id="4317227">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317233">(</span><span class="ident" id="4317234"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317235">.</span><span class="ident" id="4317236">fastSkipHashing</span>&nbsp;<span class="op" id="4317252">!=</span>&nbsp;<span class="ident" id="4317255"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4317265">&amp;&amp;</span>&nbsp;<span class="ident" id="4317268"><a href="/compress/flate/deflate.go.html#4316121">lookahead</a></span>&nbsp;<span class="op" id="4317278">&gt;</span>&nbsp;<span class="ident" id="4317280"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4317294">-</span><span class="num" id="4317295">1</span>&nbsp;<span class="op" id="4317297">||</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317304"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317305">.</span><span class="ident" id="4317306">fastSkipHashing</span>&nbsp;<span class="op" id="4317322">==</span>&nbsp;<span class="ident" id="4317325"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4317335">&amp;&amp;</span>&nbsp;<span class="ident" id="4317338"><a href="/compress/flate/deflate.go.html#4316121">lookahead</a></span>&nbsp;<span class="op" id="4317348">&gt;</span>&nbsp;<span class="ident" id="4317350"><a href="/compress/flate/deflate.go.html#4317014">prevLength</a></span>&nbsp;<span class="op" id="4317361">&amp;&amp;</span>&nbsp;<span class="ident" id="4317364"><a href="/compress/flate/deflate.go.html#4317014">prevLength</a></span>&nbsp;<span class="op" id="4317375">&lt;</span>&nbsp;<span class="ident" id="4317377"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317378">.</span><span class="ident" id="4317379">lazy</span><span class="op" id="4317383">)</span>&nbsp;<span class="op" id="4317385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317390">if</span>&nbsp;<span class="ident" id="4317393">newLength</span><span class="op" id="4317402">,</span>&nbsp;<span class="ident" id="4317404">newOffset</span><span class="op" id="4317413">,</span>&nbsp;<span class="ident" id="4317415">ok</span>&nbsp;<span class="op" id="4317418">:=</span>&nbsp;<span class="ident" id="4317421"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317422">.</span><span class="ident" id="4317423">findMatch</span><span class="op" id="4317432">(</span><span class="ident" id="4317433"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317434">.</span><span class="ident" id="4317435">index</span><span class="op" id="4317440">,</span>&nbsp;<span class="ident" id="4317442"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317443">.</span><span class="ident" id="4317444">chainHead</span><span class="op" id="4317453">-</span><span class="ident" id="4317454"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317455">.</span><span class="ident" id="4317456">hashOffset</span><span class="op" id="4317466">,</span>&nbsp;<span class="ident" id="4317468"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4317482">-</span><span class="num" id="4317483">1</span><span class="op" id="4317484">,</span>&nbsp;<span class="ident" id="4317486"><a href="/compress/flate/deflate.go.html#4316121">lookahead</a></span><span class="op" id="4317495">)</span><span class="op" id="4317496">;</span>&nbsp;<span class="ident" id="4317498"><a href="/compress/flate/deflate.go.html#4317415">ok</a></span>&nbsp;<span class="op" id="4317501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317507"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317508">.</span><span class="ident" id="4317509">length</span>&nbsp;<span class="op" id="4317516">=</span>&nbsp;<span class="ident" id="4317518"><a href="/compress/flate/deflate.go.html#4317393">newLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317532"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317533">.</span><span class="ident" id="4317534">offset</span>&nbsp;<span class="op" id="4317541">=</span>&nbsp;<span class="ident" id="4317543"><a href="/compress/flate/deflate.go.html#4317404">newOffset</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317556">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317564">if</span>&nbsp;<span class="ident" id="4317567"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317568">.</span><span class="ident" id="4317569">fastSkipHashing</span>&nbsp;<span class="op" id="4317585">!=</span>&nbsp;<span class="ident" id="4317588"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4317598">&amp;&amp;</span>&nbsp;<span class="ident" id="4317601"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317602">.</span><span class="ident" id="4317603">length</span>&nbsp;<span class="op" id="4317610">&gt;=</span>&nbsp;<span class="ident" id="4317613"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4317628">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317634"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317635">.</span><span class="ident" id="4317636">fastSkipHashing</span>&nbsp;<span class="op" id="4317652">==</span>&nbsp;<span class="ident" id="4317655"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4317665">&amp;&amp;</span>&nbsp;<span class="ident" id="4317668"><a href="/compress/flate/deflate.go.html#4317014">prevLength</a></span>&nbsp;<span class="op" id="4317679">&gt;=</span>&nbsp;<span class="ident" id="4317682"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4317697">&amp;&amp;</span>&nbsp;<span class="ident" id="4317700"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317701">.</span><span class="ident" id="4317702">length</span>&nbsp;<span class="op" id="4317709">&lt;=</span>&nbsp;<span class="ident" id="4317712"><a href="/compress/flate/deflate.go.html#4317014">prevLength</a></span>&nbsp;<span class="op" id="4317723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317728">//&nbsp;There&nbsp;was&nbsp;a&nbsp;match&nbsp;at&nbsp;the&nbsp;previous&nbsp;step,&nbsp;and&nbsp;the&nbsp;current&nbsp;match&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317799">//&nbsp;not&nbsp;better.&nbsp;Output&nbsp;the&nbsp;previous&nbsp;match.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317844">if</span>&nbsp;<span class="ident" id="4317847"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317848">.</span><span class="ident" id="4317849">fastSkipHashing</span>&nbsp;<span class="op" id="4317865">!=</span>&nbsp;<span class="ident" id="4317868"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4317878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317884"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317885">.</span><span class="ident" id="4317886">tokens</span>&nbsp;<span class="op" id="4317893">=</span>&nbsp;<span class="builtinfunc" id="4317895">append</span><span class="op" id="4317901">(</span><span class="ident" id="4317902"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317903">.</span><span class="ident" id="4317904">tokens</span><span class="op" id="4317910">,</span>&nbsp;<span class="ident" id="4317912"><a href="/compress/flate/token.go.html#4374247">matchToken</a></span><span class="op" id="4317922">(</span><span class="builtintype" id="4317923">uint32</span><span class="op" id="4317929">(</span><span class="ident" id="4317930"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317931">.</span><span class="ident" id="4317932">length</span><span class="op" id="4317938">-</span><span class="ident" id="4317939"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4317953">)</span><span class="op" id="4317954">,</span>&nbsp;<span class="builtintype" id="4317956">uint32</span><span class="op" id="4317962">(</span><span class="ident" id="4317963"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4317964">.</span><span class="ident" id="4317965">offset</span><span class="op" id="4317971">-</span><span class="ident" id="4317972"><a href="/compress/flate/deflate.go.html#4310599">minOffsetSize</a></span><span class="op" id="4317985">)</span><span class="op" id="4317986">)</span><span class="op" id="4317987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317992">}</span>&nbsp;<span class="keyword" id="4317994">else</span>&nbsp;<span class="op" id="4317999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318005"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318006">.</span><span class="ident" id="4318007">tokens</span>&nbsp;<span class="op" id="4318014">=</span>&nbsp;<span class="builtinfunc" id="4318016">append</span><span class="op" id="4318022">(</span><span class="ident" id="4318023"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318024">.</span><span class="ident" id="4318025">tokens</span><span class="op" id="4318031">,</span>&nbsp;<span class="ident" id="4318033"><a href="/compress/flate/token.go.html#4374247">matchToken</a></span><span class="op" id="4318043">(</span><span class="builtintype" id="4318044">uint32</span><span class="op" id="4318050">(</span><span class="ident" id="4318051"><a href="/compress/flate/deflate.go.html#4317014">prevLength</a></span><span class="op" id="4318061">-</span><span class="ident" id="4318062"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span><span class="op" id="4318076">)</span><span class="op" id="4318077">,</span>&nbsp;<span class="builtintype" id="4318079">uint32</span><span class="op" id="4318085">(</span><span class="ident" id="4318086"><a href="/compress/flate/deflate.go.html#4317039">prevOffset</a></span><span class="op" id="4318096">-</span><span class="ident" id="4318097"><a href="/compress/flate/deflate.go.html#4310599">minOffsetSize</a></span><span class="op" id="4318110">)</span><span class="op" id="4318111">)</span><span class="op" id="4318112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318117">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318122">//&nbsp;Insert&nbsp;in&nbsp;the&nbsp;hash&nbsp;table&nbsp;all&nbsp;strings&nbsp;up&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318193">//&nbsp;index&nbsp;and&nbsp;index-1&nbsp;are&nbsp;already&nbsp;inserted.&nbsp;If&nbsp;there&nbsp;is&nbsp;not&nbsp;enough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318262">//&nbsp;lookahead,&nbsp;the&nbsp;last&nbsp;two&nbsp;strings&nbsp;are&nbsp;not&nbsp;inserted&nbsp;into&nbsp;the&nbsp;hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318331">//&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318344">if</span>&nbsp;<span class="ident" id="4318347"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318348">.</span><span class="ident" id="4318349">length</span>&nbsp;<span class="op" id="4318356">&lt;=</span>&nbsp;<span class="ident" id="4318359"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318360">.</span><span class="ident" id="4318361">fastSkipHashing</span>&nbsp;<span class="op" id="4318377">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318383">var</span>&nbsp;<span class="ident" id="4318387">newIndex</span>&nbsp;<span class="builtintype" id="4318396">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318404">if</span>&nbsp;<span class="ident" id="4318407"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318408">.</span><span class="ident" id="4318409">fastSkipHashing</span>&nbsp;<span class="op" id="4318425">!=</span>&nbsp;<span class="ident" id="4318428"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4318438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318445"><a href="/compress/flate/deflate.go.html#4318387">newIndex</a></span>&nbsp;<span class="op" id="4318454">=</span>&nbsp;<span class="ident" id="4318456"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318457">.</span><span class="ident" id="4318458">index</span>&nbsp;<span class="op" id="4318464">+</span>&nbsp;<span class="ident" id="4318466"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318467">.</span><span class="ident" id="4318468">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318479">}</span>&nbsp;<span class="keyword" id="4318481">else</span>&nbsp;<span class="op" id="4318486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318493"><a href="/compress/flate/deflate.go.html#4318387">newIndex</a></span>&nbsp;<span class="op" id="4318502">=</span>&nbsp;<span class="ident" id="4318504"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318505">.</span><span class="ident" id="4318506">index</span>&nbsp;<span class="op" id="4318512">+</span>&nbsp;<span class="ident" id="4318514"><a href="/compress/flate/deflate.go.html#4317014">prevLength</a></span>&nbsp;<span class="op" id="4318525">-</span>&nbsp;<span class="num" id="4318527">1</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318539">for</span>&nbsp;<span class="ident" id="4318543"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318544">.</span><span class="ident" id="4318545">index</span><span class="op" id="4318550">++</span><span class="op" id="4318552">;</span>&nbsp;<span class="ident" id="4318554"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318555">.</span><span class="ident" id="4318556">index</span>&nbsp;<span class="op" id="4318562">&lt;</span>&nbsp;<span class="ident" id="4318564"><a href="/compress/flate/deflate.go.html#4318387">newIndex</a></span><span class="op" id="4318572">;</span>&nbsp;<span class="ident" id="4318574"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318575">.</span><span class="ident" id="4318576">index</span><span class="op" id="4318581">++</span>&nbsp;<span class="op" id="4318584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318591">if</span>&nbsp;<span class="ident" id="4318594"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318595">.</span><span class="ident" id="4318596">index</span>&nbsp;<span class="op" id="4318602">&lt;</span>&nbsp;<span class="ident" id="4318604"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318605">.</span><span class="ident" id="4318606">maxInsertIndex</span>&nbsp;<span class="op" id="4318621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318629"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318630">.</span><span class="ident" id="4318631">hash</span>&nbsp;<span class="op" id="4318636">=</span>&nbsp;<span class="op" id="4318638">(</span><span class="ident" id="4318639"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318640">.</span><span class="ident" id="4318641">hash</span><span class="op" id="4318645">&lt;&lt;</span><span class="ident" id="4318647"><a href="/compress/flate/deflate.go.html#4310951">hashShift</a></span>&nbsp;<span class="op" id="4318657">+</span>&nbsp;<span class="builtintype" id="4318659">int</span><span class="op" id="4318662">(</span><span class="ident" id="4318663"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318664">.</span><span class="ident" id="4318665">window</span><span class="op" id="4318671">[</span><span class="ident" id="4318672"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318673">.</span><span class="ident" id="4318674">index</span><span class="op" id="4318679">+</span><span class="num" id="4318680">2</span><span class="op" id="4318681">]</span><span class="op" id="4318682">)</span><span class="op" id="4318683">)</span>&nbsp;<span class="op" id="4318685">&amp;</span>&nbsp;<span class="ident" id="4318687"><a href="/compress/flate/deflate.go.html#4310908">hashMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318702">//&nbsp;Get&nbsp;previous&nbsp;value&nbsp;with&nbsp;the&nbsp;same&nbsp;hash.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318750">//&nbsp;Our&nbsp;chain&nbsp;should&nbsp;point&nbsp;to&nbsp;the&nbsp;previous&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318805"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318806">.</span><span class="ident" id="4318807">hashPrev</span><span class="op" id="4318815">[</span><span class="ident" id="4318816"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318817">.</span><span class="ident" id="4318818">index</span><span class="op" id="4318823">&amp;</span><span class="ident" id="4318824"><a href="/compress/flate/deflate.go.html#4310372">windowMask</a></span><span class="op" id="4318834">]</span>&nbsp;<span class="op" id="4318836">=</span>&nbsp;<span class="ident" id="4318838"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318839">.</span><span class="ident" id="4318840">hashHead</span><span class="op" id="4318848">[</span><span class="ident" id="4318849"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318850">.</span><span class="ident" id="4318851">hash</span><span class="op" id="4318855">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318863">//&nbsp;Set&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;hash&nbsp;chain&nbsp;to&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318910"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318911">.</span><span class="ident" id="4318912">hashHead</span><span class="op" id="4318920">[</span><span class="ident" id="4318921"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318922">.</span><span class="ident" id="4318923">hash</span><span class="op" id="4318927">]</span>&nbsp;<span class="op" id="4318929">=</span>&nbsp;<span class="ident" id="4318931"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318932">.</span><span class="ident" id="4318933">index</span>&nbsp;<span class="op" id="4318939">+</span>&nbsp;<span class="ident" id="4318941"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318942">.</span><span class="ident" id="4318943">hashOffset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318959">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318971">if</span>&nbsp;<span class="ident" id="4318974"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4318975">.</span><span class="ident" id="4318976">fastSkipHashing</span>&nbsp;<span class="op" id="4318992">==</span>&nbsp;<span class="ident" id="4318995"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4319005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319012"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319013">.</span><span class="ident" id="4319014">byteAvailable</span>&nbsp;<span class="op" id="4319028">=</span>&nbsp;<span class="builtintype" id="4319030">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319041"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319042">.</span><span class="ident" id="4319043">length</span>&nbsp;<span class="op" id="4319050">=</span>&nbsp;<span class="ident" id="4319052"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4319067">-</span>&nbsp;<span class="num" id="4319069">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319075">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319080">}</span>&nbsp;<span class="keyword" id="4319082">else</span>&nbsp;<span class="op" id="4319087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319093">//&nbsp;For&nbsp;matches&nbsp;this&nbsp;long,&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;inserting&nbsp;each&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319165">//&nbsp;item&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319193"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319194">.</span><span class="ident" id="4319195">index</span>&nbsp;<span class="op" id="4319201">+=</span>&nbsp;<span class="ident" id="4319204"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319205">.</span><span class="ident" id="4319206">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319217">if</span>&nbsp;<span class="ident" id="4319220"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319221">.</span><span class="ident" id="4319222">index</span>&nbsp;<span class="op" id="4319228">&lt;</span>&nbsp;<span class="ident" id="4319230"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319231">.</span><span class="ident" id="4319232">maxInsertIndex</span>&nbsp;<span class="op" id="4319247">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319254"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319255">.</span><span class="ident" id="4319256">hash</span>&nbsp;<span class="op" id="4319261">=</span>&nbsp;<span class="op" id="4319263">(</span><span class="builtintype" id="4319264">int</span><span class="op" id="4319267">(</span><span class="ident" id="4319268"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319269">.</span><span class="ident" id="4319270">window</span><span class="op" id="4319276">[</span><span class="ident" id="4319277"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319278">.</span><span class="ident" id="4319279">index</span><span class="op" id="4319284">]</span><span class="op" id="4319285">)</span><span class="op" id="4319286">&lt;&lt;</span><span class="ident" id="4319288"><a href="/compress/flate/deflate.go.html#4310951">hashShift</a></span>&nbsp;<span class="op" id="4319298">+</span>&nbsp;<span class="builtintype" id="4319300">int</span><span class="op" id="4319303">(</span><span class="ident" id="4319304"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319305">.</span><span class="ident" id="4319306">window</span><span class="op" id="4319312">[</span><span class="ident" id="4319313"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319314">.</span><span class="ident" id="4319315">index</span><span class="op" id="4319320">+</span><span class="num" id="4319321">1</span><span class="op" id="4319322">]</span><span class="op" id="4319323">)</span><span class="op" id="4319324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319340">if</span>&nbsp;<span class="builtinfunc" id="4319343">len</span><span class="op" id="4319346">(</span><span class="ident" id="4319347"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319348">.</span><span class="ident" id="4319349">tokens</span><span class="op" id="4319355">)</span>&nbsp;<span class="op" id="4319357">==</span>&nbsp;<span class="ident" id="4319360"><a href="/compress/flate/deflate.go.html#4310785">maxFlateBlockTokens</a></span>&nbsp;<span class="op" id="4319380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319386">//&nbsp;The&nbsp;block&nbsp;includes&nbsp;the&nbsp;current&nbsp;character</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319434">if</span>&nbsp;<span class="ident" id="4319437"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319438">.</span><span class="ident" id="4319439">err</span>&nbsp;<span class="op" id="4319443">=</span>&nbsp;<span class="ident" id="4319445"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319446">.</span><span class="ident" id="4319447">writeBlock</span><span class="op" id="4319457">(</span><span class="ident" id="4319458"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319459">.</span><span class="ident" id="4319460">tokens</span><span class="op" id="4319466">,</span>&nbsp;<span class="ident" id="4319468"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319469">.</span><span class="ident" id="4319470">index</span><span class="op" id="4319475">,</span>&nbsp;<span class="builtintype" id="4319477">false</span><span class="op" id="4319482">)</span><span class="op" id="4319483">;</span>&nbsp;<span class="ident" id="4319485"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319486">.</span><span class="ident" id="4319487">err</span>&nbsp;<span class="op" id="4319491">!=</span>&nbsp;<span class="ident" id="4319494">nil</span>&nbsp;<span class="op" id="4319498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319505">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319522"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319523">.</span><span class="ident" id="4319524">tokens</span>&nbsp;<span class="op" id="4319531">=</span>&nbsp;<span class="ident" id="4319533"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319534">.</span><span class="ident" id="4319535">tokens</span><span class="op" id="4319541">[</span><span class="op" id="4319542">:</span><span class="num" id="4319543">0</span><span class="op" id="4319544">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319549">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319553">}</span>&nbsp;<span class="keyword" id="4319555">else</span>&nbsp;<span class="op" id="4319560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319565">if</span>&nbsp;<span class="ident" id="4319568"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319569">.</span><span class="ident" id="4319570">fastSkipHashing</span>&nbsp;<span class="op" id="4319586">!=</span>&nbsp;<span class="ident" id="4319589"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4319599">||</span>&nbsp;<span class="ident" id="4319602"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319603">.</span><span class="ident" id="4319604">byteAvailable</span>&nbsp;<span class="op" id="4319618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319624">i</span>&nbsp;<span class="op" id="4319626">:=</span>&nbsp;<span class="ident" id="4319629"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319630">.</span><span class="ident" id="4319631">index</span>&nbsp;<span class="op" id="4319637">-</span>&nbsp;<span class="num" id="4319639">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319645">if</span>&nbsp;<span class="ident" id="4319648"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319649">.</span><span class="ident" id="4319650">fastSkipHashing</span>&nbsp;<span class="op" id="4319666">!=</span>&nbsp;<span class="ident" id="4319669"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4319679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319686"><a href="/compress/flate/deflate.go.html#4319624">i</a></span>&nbsp;<span class="op" id="4319688">=</span>&nbsp;<span class="ident" id="4319690"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319691">.</span><span class="ident" id="4319692">index</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319708"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319709">.</span><span class="ident" id="4319710">tokens</span>&nbsp;<span class="op" id="4319717">=</span>&nbsp;<span class="builtinfunc" id="4319719">append</span><span class="op" id="4319725">(</span><span class="ident" id="4319726"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319727">.</span><span class="ident" id="4319728">tokens</span><span class="op" id="4319734">,</span>&nbsp;<span class="ident" id="4319736"><a href="/compress/flate/token.go.html#4374107">literalToken</a></span><span class="op" id="4319748">(</span><span class="builtintype" id="4319749">uint32</span><span class="op" id="4319755">(</span><span class="ident" id="4319756"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319757">.</span><span class="ident" id="4319758">window</span><span class="op" id="4319764">[</span><span class="ident" id="4319765"><a href="/compress/flate/deflate.go.html#4319624">i</a></span><span class="op" id="4319766">]</span><span class="op" id="4319767">)</span><span class="op" id="4319768">)</span><span class="op" id="4319769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319775">if</span>&nbsp;<span class="builtinfunc" id="4319778">len</span><span class="op" id="4319781">(</span><span class="ident" id="4319782"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319783">.</span><span class="ident" id="4319784">tokens</span><span class="op" id="4319790">)</span>&nbsp;<span class="op" id="4319792">==</span>&nbsp;<span class="ident" id="4319795"><a href="/compress/flate/deflate.go.html#4310785">maxFlateBlockTokens</a></span>&nbsp;<span class="op" id="4319815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319822">if</span>&nbsp;<span class="ident" id="4319825"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319826">.</span><span class="ident" id="4319827">err</span>&nbsp;<span class="op" id="4319831">=</span>&nbsp;<span class="ident" id="4319833"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319834">.</span><span class="ident" id="4319835">writeBlock</span><span class="op" id="4319845">(</span><span class="ident" id="4319846"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319847">.</span><span class="ident" id="4319848">tokens</span><span class="op" id="4319854">,</span>&nbsp;<span class="ident" id="4319856"><a href="/compress/flate/deflate.go.html#4319624">i</a></span><span class="op" id="4319857">+</span><span class="num" id="4319858">1</span><span class="op" id="4319859">,</span>&nbsp;<span class="builtintype" id="4319861">false</span><span class="op" id="4319866">)</span><span class="op" id="4319867">;</span>&nbsp;<span class="ident" id="4319869"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319870">.</span><span class="ident" id="4319871">err</span>&nbsp;<span class="op" id="4319875">!=</span>&nbsp;<span class="ident" id="4319878">nil</span>&nbsp;<span class="op" id="4319882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319890">return</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319909"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319910">.</span><span class="ident" id="4319911">tokens</span>&nbsp;<span class="op" id="4319918">=</span>&nbsp;<span class="ident" id="4319920"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319921">.</span><span class="ident" id="4319922">tokens</span><span class="op" id="4319928">[</span><span class="op" id="4319929">:</span><span class="num" id="4319930">0</span><span class="op" id="4319931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319947"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319948">.</span><span class="ident" id="4319949">index</span><span class="op" id="4319954">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319960">if</span>&nbsp;<span class="ident" id="4319963"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4319964">.</span><span class="ident" id="4319965">fastSkipHashing</span>&nbsp;<span class="op" id="4319981">==</span>&nbsp;<span class="ident" id="4319984"><a href="/compress/flate/deflate.go.html#4311055">skipNever</a></span>&nbsp;<span class="op" id="4319994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320000"><a href="/compress/flate/deflate.go.html#4315770">d</a></span><span class="op" id="4320001">.</span><span class="ident" id="4320002">byteAvailable</span>&nbsp;<span class="op" id="4320016">=</span>&nbsp;<span class="builtintype" id="4320018">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320033">}</span><br>
<span class="lineno">360</span><span class="op" id="4320035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4320038">func</span>&nbsp;<span class="op" id="4320043">(</span><span class="ident" id="4320044">d</span>&nbsp;<span class="op" id="4320046">*</span><span class="ident" id="4320047"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320057">)</span>&nbsp;<span class="ident" id="4320059">fillStore</span><span class="op" id="4320068">(</span><span class="ident" id="4320069">b</span>&nbsp;<span class="op" id="4320071">[</span><span class="op" id="4320072">]</span><span class="builtintype" id="4320073">byte</span><span class="op" id="4320077">)</span>&nbsp;<span class="builtintype" id="4320079">int</span>&nbsp;<span class="op" id="4320083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320086">n</span>&nbsp;<span class="op" id="4320088">:=</span>&nbsp;<span class="builtinfunc" id="4320091">copy</span><span class="op" id="4320095">(</span><span class="ident" id="4320096"><a href="/compress/flate/deflate.go.html#4320044">d</a></span><span class="op" id="4320097">.</span><span class="ident" id="4320098">window</span><span class="op" id="4320104">[</span><span class="ident" id="4320105"><a href="/compress/flate/deflate.go.html#4320044">d</a></span><span class="op" id="4320106">.</span><span class="ident" id="4320107">windowEnd</span><span class="op" id="4320116">:</span><span class="op" id="4320117">]</span><span class="op" id="4320118">,</span>&nbsp;<span class="ident" id="4320120"><a href="/compress/flate/deflate.go.html#4320069">b</a></span><span class="op" id="4320121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320124"><a href="/compress/flate/deflate.go.html#4320044">d</a></span><span class="op" id="4320125">.</span><span class="ident" id="4320126">windowEnd</span>&nbsp;<span class="op" id="4320136">+=</span>&nbsp;<span class="ident" id="4320139"><a href="/compress/flate/deflate.go.html#4320086">n</a></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320142">return</span>&nbsp;<span class="ident" id="4320149"><a href="/compress/flate/deflate.go.html#4320086">n</a></span><br>
<span class="lineno"></span><span class="op" id="4320151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4320154">func</span>&nbsp;<span class="op" id="4320159">(</span><span class="ident" id="4320160">d</span>&nbsp;<span class="op" id="4320162">*</span><span class="ident" id="4320163"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320173">)</span>&nbsp;<span class="ident" id="4320175">store</span><span class="op" id="4320180">(</span><span class="op" id="4320181">)</span>&nbsp;<span class="op" id="4320183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320186">if</span>&nbsp;<span class="ident" id="4320189"><a href="/compress/flate/deflate.go.html#4320160">d</a></span><span class="op" id="4320190">.</span><span class="ident" id="4320191">windowEnd</span>&nbsp;<span class="op" id="4320201">&gt;</span>&nbsp;<span class="num" id="4320203">0</span>&nbsp;<span class="op" id="4320205">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320209"><a href="/compress/flate/deflate.go.html#4320160">d</a></span><span class="op" id="4320210">.</span><span class="ident" id="4320211">err</span>&nbsp;<span class="op" id="4320215">=</span>&nbsp;<span class="ident" id="4320217"><a href="/compress/flate/deflate.go.html#4320160">d</a></span><span class="op" id="4320218">.</span><span class="ident" id="4320219">writeStoredBlock</span><span class="op" id="4320235">(</span><span class="ident" id="4320236"><a href="/compress/flate/deflate.go.html#4320160">d</a></span><span class="op" id="4320237">.</span><span class="ident" id="4320238">window</span><span class="op" id="4320244">[</span><span class="op" id="4320245">:</span><span class="ident" id="4320246"><a href="/compress/flate/deflate.go.html#4320160">d</a></span><span class="op" id="4320247">.</span><span class="ident" id="4320248">windowEnd</span><span class="op" id="4320257">]</span><span class="op" id="4320258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320264"><a href="/compress/flate/deflate.go.html#4320160">d</a></span><span class="op" id="4320265">.</span><span class="ident" id="4320266">windowEnd</span>&nbsp;<span class="op" id="4320276">=</span>&nbsp;<span class="num" id="4320278">0</span><br>
<span class="lineno"></span><span class="op" id="4320280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="keyword" id="4320283">func</span>&nbsp;<span class="op" id="4320288">(</span><span class="ident" id="4320289">d</span>&nbsp;<span class="op" id="4320291">*</span><span class="ident" id="4320292"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320302">)</span>&nbsp;<span class="ident" id="4320304">write</span><span class="op" id="4320309">(</span><span class="ident" id="4320310">b</span>&nbsp;<span class="op" id="4320312">[</span><span class="op" id="4320313">]</span><span class="builtintype" id="4320314">byte</span><span class="op" id="4320318">)</span>&nbsp;<span class="op" id="4320320">(</span><span class="ident" id="4320321">n</span>&nbsp;<span class="builtintype" id="4320323">int</span><span class="op" id="4320326">,</span>&nbsp;<span class="ident" id="4320328">err</span>&nbsp;<span class="builtintype" id="4320332">error</span><span class="op" id="4320337">)</span>&nbsp;<span class="op" id="4320339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320342"><a href="/compress/flate/deflate.go.html#4320321">n</a></span>&nbsp;<span class="op" id="4320344">=</span>&nbsp;<span class="builtinfunc" id="4320346">len</span><span class="op" id="4320349">(</span><span class="ident" id="4320350"><a href="/compress/flate/deflate.go.html#4320310">b</a></span><span class="op" id="4320351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320354"><a href="/compress/flate/deflate.go.html#4320310">b</a></span>&nbsp;<span class="op" id="4320356">=</span>&nbsp;<span class="ident" id="4320358"><a href="/compress/flate/deflate.go.html#4320310">b</a></span><span class="op" id="4320359">[</span><span class="ident" id="4320360"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320361">.</span><span class="ident" id="4320362">fill</span><span class="op" id="4320366">(</span><span class="ident" id="4320367"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320368">,</span>&nbsp;<span class="ident" id="4320370"><a href="/compress/flate/deflate.go.html#4320310">b</a></span><span class="op" id="4320371">)</span><span class="op" id="4320372">:</span><span class="op" id="4320373">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320376">for</span>&nbsp;<span class="builtinfunc" id="4320380">len</span><span class="op" id="4320383">(</span><span class="ident" id="4320384"><a href="/compress/flate/deflate.go.html#4320310">b</a></span><span class="op" id="4320385">)</span>&nbsp;<span class="op" id="4320387">&gt;</span>&nbsp;<span class="num" id="4320389">0</span>&nbsp;<span class="op" id="4320391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320395"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320396">.</span><span class="ident" id="4320397">step</span><span class="op" id="4320401">(</span><span class="ident" id="4320402"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320403">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320407"><a href="/compress/flate/deflate.go.html#4320310">b</a></span>&nbsp;<span class="op" id="4320409">=</span>&nbsp;<span class="ident" id="4320411"><a href="/compress/flate/deflate.go.html#4320310">b</a></span><span class="op" id="4320412">[</span><span class="ident" id="4320413"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320414">.</span><span class="ident" id="4320415">fill</span><span class="op" id="4320419">(</span><span class="ident" id="4320420"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320421">,</span>&nbsp;<span class="ident" id="4320423"><a href="/compress/flate/deflate.go.html#4320310">b</a></span><span class="op" id="4320424">)</span><span class="op" id="4320425">:</span><span class="op" id="4320426">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320432">return</span>&nbsp;<span class="ident" id="4320439"><a href="/compress/flate/deflate.go.html#4320321">n</a></span><span class="op" id="4320440">,</span>&nbsp;<span class="ident" id="4320442"><a href="/compress/flate/deflate.go.html#4320289">d</a></span><span class="op" id="4320443">.</span><span class="ident" id="4320444">err</span><br>
<span class="lineno"></span><span class="op" id="4320448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4320451">func</span>&nbsp;<span class="op" id="4320456">(</span><span class="ident" id="4320457">d</span>&nbsp;<span class="op" id="4320459">*</span><span class="ident" id="4320460"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320470">)</span>&nbsp;<span class="ident" id="4320472">syncFlush</span><span class="op" id="4320481">(</span><span class="op" id="4320482">)</span>&nbsp;<span class="builtintype" id="4320484">error</span>&nbsp;<span class="op" id="4320490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320493"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320494">.</span><span class="ident" id="4320495">sync</span>&nbsp;<span class="op" id="4320500">=</span>&nbsp;<span class="builtintype" id="4320502">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320508"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320509">.</span><span class="ident" id="4320510">step</span><span class="op" id="4320514">(</span><span class="ident" id="4320515"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320519">if</span>&nbsp;<span class="ident" id="4320522"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320523">.</span><span class="ident" id="4320524">err</span>&nbsp;<span class="op" id="4320528">==</span>&nbsp;<span class="ident" id="4320531">nil</span>&nbsp;<span class="op" id="4320535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320539"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320540">.</span><span class="ident" id="4320541">w</span><span class="op" id="4320542">.</span><span class="ident" id="4320543">writeStoredHeader</span><span class="op" id="4320560">(</span><span class="num" id="4320561">0</span><span class="op" id="4320562">,</span>&nbsp;<span class="builtintype" id="4320564">false</span><span class="op" id="4320569">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320573"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320574">.</span><span class="ident" id="4320575">w</span><span class="op" id="4320576">.</span><span class="ident" id="4320577">flush</span><span class="op" id="4320582">(</span><span class="op" id="4320583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320587"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320588">.</span><span class="ident" id="4320589">err</span>&nbsp;<span class="op" id="4320593">=</span>&nbsp;<span class="ident" id="4320595"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320596">.</span><span class="ident" id="4320597">w</span><span class="op" id="4320598">.</span><span class="ident" id="4320599">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320607"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320608">.</span><span class="ident" id="4320609">sync</span>&nbsp;<span class="op" id="4320614">=</span>&nbsp;<span class="builtintype" id="4320616">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320623">return</span>&nbsp;<span class="ident" id="4320630"><a href="/compress/flate/deflate.go.html#4320457">d</a></span><span class="op" id="4320631">.</span><span class="ident" id="4320632">err</span><br>
<span class="lineno">395</span><span class="op" id="4320636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4320639">func</span>&nbsp;<span class="op" id="4320644">(</span><span class="ident" id="4320645">d</span>&nbsp;<span class="op" id="4320647">*</span><span class="ident" id="4320648"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320658">)</span>&nbsp;<span class="ident" id="4320660">init</span><span class="op" id="4320664">(</span><span class="ident" id="4320665">w</span>&nbsp;<span class="ident" id="4320667"><a href="/compress/flate/deflate.go.html#4310160">io</a></span><span class="op" id="4320669">.</span><span class="ident" id="4320670">Writer</span><span class="op" id="4320676">,</span>&nbsp;<span class="ident" id="4320678">level</span>&nbsp;<span class="builtintype" id="4320684">int</span><span class="op" id="4320687">)</span>&nbsp;<span class="op" id="4320689">(</span><span class="ident" id="4320690">err</span>&nbsp;<span class="builtintype" id="4320694">error</span><span class="op" id="4320699">)</span>&nbsp;<span class="op" id="4320701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320704"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4320705">.</span><span class="ident" id="4320706">w</span>&nbsp;<span class="op" id="4320708">=</span>&nbsp;<span class="ident" id="4320710"><a href="/compress/flate/huffman_bit_writer.go.html#4332125">newHuffmanBitWriter</a></span><span class="op" id="4320729">(</span><span class="ident" id="4320730"><a href="/compress/flate/deflate.go.html#4320665">w</a></span><span class="op" id="4320731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320735">switch</span>&nbsp;<span class="op" id="4320742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320745">case</span>&nbsp;<span class="ident" id="4320750"><a href="/compress/flate/deflate.go.html#4320678">level</a></span>&nbsp;<span class="op" id="4320756">==</span>&nbsp;<span class="ident" id="4320759"><a href="/compress/flate/deflate.go.html#4310185">NoCompression</a></span><span class="op" id="4320772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320776"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4320777">.</span><span class="ident" id="4320778">window</span>&nbsp;<span class="op" id="4320785">=</span>&nbsp;<span class="builtinfunc" id="4320787">make</span><span class="op" id="4320791">(</span><span class="op" id="4320792">[</span><span class="op" id="4320793">]</span><span class="builtintype" id="4320794">byte</span><span class="op" id="4320798">,</span>&nbsp;<span class="ident" id="4320800"><a href="/compress/flate/deflate.go.html#4310816">maxStoreBlockSize</a></span><span class="op" id="4320817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320821"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4320822">.</span><span class="ident" id="4320823">fill</span>&nbsp;<span class="op" id="4320828">=</span>&nbsp;<span class="op" id="4320830">(</span><span class="op" id="4320831">*</span><span class="ident" id="4320832"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320842">)</span><span class="op" id="4320843">.</span><span class="ident" id="4320844">fillStore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320856"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4320857">.</span><span class="ident" id="4320858">step</span>&nbsp;<span class="op" id="4320863">=</span>&nbsp;<span class="op" id="4320865">(</span><span class="op" id="4320866">*</span><span class="ident" id="4320867"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4320877">)</span><span class="op" id="4320878">.</span><span class="ident" id="4320879">store</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320886">case</span>&nbsp;<span class="ident" id="4320891"><a href="/compress/flate/deflate.go.html#4320678">level</a></span>&nbsp;<span class="op" id="4320897">==</span>&nbsp;<span class="ident" id="4320900"><a href="/compress/flate/deflate.go.html#4310281">DefaultCompression</a></span><span class="op" id="4320918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320922"><a href="/compress/flate/deflate.go.html#4320678">level</a></span>&nbsp;<span class="op" id="4320928">=</span>&nbsp;<span class="num" id="4320930">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320934">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320947">case</span>&nbsp;<span class="num" id="4320952">1</span>&nbsp;<span class="op" id="4320954">&lt;=</span>&nbsp;<span class="ident" id="4320957"><a href="/compress/flate/deflate.go.html#4320678">level</a></span>&nbsp;<span class="op" id="4320963">&amp;&amp;</span>&nbsp;<span class="ident" id="4320966"><a href="/compress/flate/deflate.go.html#4320678">level</a></span>&nbsp;<span class="op" id="4320972">&lt;=</span>&nbsp;<span class="num" id="4320975">9</span><span class="op" id="4320976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320980"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4320981">.</span><span class="ident" id="4320982">compressionLevel</span>&nbsp;<span class="op" id="4320999">=</span>&nbsp;<span class="ident" id="4321001"><a href="/compress/flate/deflate.go.html#4311168">levels</a></span><span class="op" id="4321007">[</span><span class="ident" id="4321008"><a href="/compress/flate/deflate.go.html#4320678">level</a></span><span class="op" id="4321013">]</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321017"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4321018">.</span><span class="ident" id="4321019">initDeflate</span><span class="op" id="4321030">(</span><span class="op" id="4321031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321035"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4321036">.</span><span class="ident" id="4321037">fill</span>&nbsp;<span class="op" id="4321042">=</span>&nbsp;<span class="op" id="4321044">(</span><span class="op" id="4321045">*</span><span class="ident" id="4321046"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4321056">)</span><span class="op" id="4321057">.</span><span class="ident" id="4321058">fillDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321072"><a href="/compress/flate/deflate.go.html#4320645">d</a></span><span class="op" id="4321073">.</span><span class="ident" id="4321074">step</span>&nbsp;<span class="op" id="4321079">=</span>&nbsp;<span class="op" id="4321081">(</span><span class="op" id="4321082">*</span><span class="ident" id="4321083"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4321093">)</span><span class="op" id="4321094">.</span><span class="ident" id="4321095">deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321104">default</span><span class="op" id="4321111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321115">return</span>&nbsp;<span class="ident" id="4321122"><a href="/compress/flate/deflate.go.html#4310153">fmt</a></span><span class="op" id="4321125">.</span><span class="ident" id="4321126">Errorf</span><span class="op" id="4321132">(</span><span class="string" id="4321133">&#34;flate:&nbsp;invalid&nbsp;compression&nbsp;level&nbsp;%d:&nbsp;want&nbsp;value&nbsp;in&nbsp;range&nbsp;[-1,&nbsp;9]&#34;</span><span class="op" id="4321199">,</span>&nbsp;<span class="ident" id="4321201"><a href="/compress/flate/deflate.go.html#4320678">level</a></span><span class="op" id="4321206">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321212">return</span>&nbsp;<span class="ident" id="4321219">nil</span><br>
<span class="lineno"></span><span class="op" id="4321223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4321226">var</span>&nbsp;<span class="ident" id="4321230">zeroes</span>&nbsp;<span class="op" id="4321237">[</span><span class="num" id="4321238">32</span><span class="op" id="4321240">]</span><span class="builtintype" id="4321241">int</span><br>
<span class="lineno">420</span><span class="keyword" id="4321245">var</span>&nbsp;<span class="ident" id="4321249">bzeroes</span>&nbsp;<span class="op" id="4321257">[</span><span class="num" id="4321258">256</span><span class="op" id="4321261">]</span><span class="builtintype" id="4321262">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4321268">func</span>&nbsp;<span class="op" id="4321273">(</span><span class="ident" id="4321274">d</span>&nbsp;<span class="op" id="4321276">*</span><span class="ident" id="4321277"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4321287">)</span>&nbsp;<span class="ident" id="4321289">reset</span><span class="op" id="4321294">(</span><span class="ident" id="4321295">w</span>&nbsp;<span class="ident" id="4321297"><a href="/compress/flate/deflate.go.html#4310160">io</a></span><span class="op" id="4321299">.</span><span class="ident" id="4321300">Writer</span><span class="op" id="4321306">)</span>&nbsp;<span class="op" id="4321308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321311"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321312">.</span><span class="ident" id="4321313">w</span><span class="op" id="4321314">.</span><span class="ident" id="4321315">reset</span><span class="op" id="4321320">(</span><span class="ident" id="4321321"><a href="/compress/flate/deflate.go.html#4321295">w</a></span><span class="op" id="4321322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321325"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321326">.</span><span class="ident" id="4321327">sync</span>&nbsp;<span class="op" id="4321332">=</span>&nbsp;<span class="builtintype" id="4321334">false</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321341"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321342">.</span><span class="ident" id="4321343">err</span>&nbsp;<span class="op" id="4321347">=</span>&nbsp;<span class="ident" id="4321349">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321354">switch</span>&nbsp;<span class="ident" id="4321361"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321362">.</span><span class="ident" id="4321363">compressionLevel</span><span class="op" id="4321379">.</span><span class="ident" id="4321380">chain</span>&nbsp;<span class="op" id="4321386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321389">case</span>&nbsp;<span class="num" id="4321394">0</span><span class="op" id="4321395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4321399">//&nbsp;level&nbsp;was&nbsp;NoCompression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321429">for</span>&nbsp;<span class="ident" id="4321433">i</span>&nbsp;<span class="op" id="4321435">:=</span>&nbsp;<span class="keyword" id="4321438">range</span>&nbsp;<span class="ident" id="4321444"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321445">.</span><span class="ident" id="4321446">window</span>&nbsp;<span class="op" id="4321453">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321458"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321459">.</span><span class="ident" id="4321460">window</span><span class="op" id="4321466">[</span><span class="ident" id="4321467"><a href="/compress/flate/deflate.go.html#4321433">i</a></span><span class="op" id="4321468">]</span>&nbsp;<span class="op" id="4321470">=</span>&nbsp;<span class="num" id="4321472">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321480"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321481">.</span><span class="ident" id="4321482">windowEnd</span>&nbsp;<span class="op" id="4321492">=</span>&nbsp;<span class="num" id="4321494">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321497">default</span><span class="op" id="4321504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321508"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321509">.</span><span class="ident" id="4321510">chainHead</span>&nbsp;<span class="op" id="4321520">=</span>&nbsp;<span class="op" id="4321522">-</span><span class="num" id="4321523">1</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321527">for</span>&nbsp;<span class="ident" id="4321531">s</span>&nbsp;<span class="op" id="4321533">:=</span>&nbsp;<span class="ident" id="4321536"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321537">.</span><span class="ident" id="4321538">hashHead</span><span class="op" id="4321546">;</span>&nbsp;<span class="builtinfunc" id="4321548">len</span><span class="op" id="4321551">(</span><span class="ident" id="4321552"><a href="/compress/flate/deflate.go.html#4321531">s</a></span><span class="op" id="4321553">)</span>&nbsp;<span class="op" id="4321555">&gt;</span>&nbsp;<span class="num" id="4321557">0</span><span class="op" id="4321558">;</span>&nbsp;<span class="op" id="4321560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321565">n</span>&nbsp;<span class="op" id="4321567">:=</span>&nbsp;<span class="builtinfunc" id="4321570">copy</span><span class="op" id="4321574">(</span><span class="ident" id="4321575"><a href="/compress/flate/deflate.go.html#4321531">s</a></span><span class="op" id="4321576">,</span>&nbsp;<span class="ident" id="4321578"><a href="/compress/flate/deflate.go.html#4321230">zeroes</a></span><span class="op" id="4321584">[</span><span class="op" id="4321585">:</span><span class="op" id="4321586">]</span><span class="op" id="4321587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321592"><a href="/compress/flate/deflate.go.html#4321531">s</a></span>&nbsp;<span class="op" id="4321594">=</span>&nbsp;<span class="ident" id="4321596"><a href="/compress/flate/deflate.go.html#4321531">s</a></span><span class="op" id="4321597">[</span><span class="ident" id="4321598"><a href="/compress/flate/deflate.go.html#4321565">n</a></span><span class="op" id="4321599">:</span><span class="op" id="4321600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321608">for</span>&nbsp;<span class="ident" id="4321612">s</span>&nbsp;<span class="op" id="4321614">:=</span>&nbsp;<span class="ident" id="4321617"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321618">.</span><span class="ident" id="4321619">hashPrev</span><span class="op" id="4321627">;</span>&nbsp;<span class="builtinfunc" id="4321629">len</span><span class="op" id="4321632">(</span><span class="ident" id="4321633"><a href="/compress/flate/deflate.go.html#4321612">s</a></span><span class="op" id="4321634">)</span>&nbsp;<span class="op" id="4321636">&gt;</span>&nbsp;<span class="num" id="4321638">0</span><span class="op" id="4321639">;</span>&nbsp;<span class="ident" id="4321641"><a href="/compress/flate/deflate.go.html#4321612">s</a></span>&nbsp;<span class="op" id="4321643">=</span>&nbsp;<span class="ident" id="4321645"><a href="/compress/flate/deflate.go.html#4321612">s</a></span><span class="op" id="4321646">[</span><span class="builtinfunc" id="4321647">len</span><span class="op" id="4321650">(</span><span class="ident" id="4321651"><a href="/compress/flate/deflate.go.html#4321230">zeroes</a></span><span class="op" id="4321657">)</span><span class="op" id="4321658">:</span><span class="op" id="4321659">]</span>&nbsp;<span class="op" id="4321661">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4321666">copy</span><span class="op" id="4321670">(</span><span class="ident" id="4321671"><a href="/compress/flate/deflate.go.html#4321612">s</a></span><span class="op" id="4321672">,</span>&nbsp;<span class="ident" id="4321674"><a href="/compress/flate/deflate.go.html#4321230">zeroes</a></span><span class="op" id="4321680">[</span><span class="op" id="4321681">:</span><span class="op" id="4321682">]</span><span class="op" id="4321683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321691"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321692">.</span><span class="ident" id="4321693">hashOffset</span>&nbsp;<span class="op" id="4321704">=</span>&nbsp;<span class="num" id="4321706">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321711"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321712">.</span><span class="ident" id="4321713">index</span><span class="op" id="4321718">,</span>&nbsp;<span class="ident" id="4321720"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321721">.</span><span class="ident" id="4321722">windowEnd</span>&nbsp;<span class="op" id="4321732">=</span>&nbsp;<span class="num" id="4321734">0</span><span class="op" id="4321735">,</span>&nbsp;<span class="num" id="4321737">0</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321741">for</span>&nbsp;<span class="ident" id="4321745">s</span>&nbsp;<span class="op" id="4321747">:=</span>&nbsp;<span class="ident" id="4321750"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321751">.</span><span class="ident" id="4321752">window</span><span class="op" id="4321758">;</span>&nbsp;<span class="builtinfunc" id="4321760">len</span><span class="op" id="4321763">(</span><span class="ident" id="4321764"><a href="/compress/flate/deflate.go.html#4321745">s</a></span><span class="op" id="4321765">)</span>&nbsp;<span class="op" id="4321767">&gt;</span>&nbsp;<span class="num" id="4321769">0</span><span class="op" id="4321770">;</span>&nbsp;<span class="op" id="4321772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321777">n</span>&nbsp;<span class="op" id="4321779">:=</span>&nbsp;<span class="builtinfunc" id="4321782">copy</span><span class="op" id="4321786">(</span><span class="ident" id="4321787"><a href="/compress/flate/deflate.go.html#4321745">s</a></span><span class="op" id="4321788">,</span>&nbsp;<span class="ident" id="4321790"><a href="/compress/flate/deflate.go.html#4321249">bzeroes</a></span><span class="op" id="4321797">[</span><span class="op" id="4321798">:</span><span class="op" id="4321799">]</span><span class="op" id="4321800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321805"><a href="/compress/flate/deflate.go.html#4321745">s</a></span>&nbsp;<span class="op" id="4321807">=</span>&nbsp;<span class="ident" id="4321809"><a href="/compress/flate/deflate.go.html#4321745">s</a></span><span class="op" id="4321810">[</span><span class="ident" id="4321811"><a href="/compress/flate/deflate.go.html#4321777">n</a></span><span class="op" id="4321812">:</span><span class="op" id="4321813">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321821"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321822">.</span><span class="ident" id="4321823">blockStart</span><span class="op" id="4321833">,</span>&nbsp;<span class="ident" id="4321835"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321836">.</span><span class="ident" id="4321837">byteAvailable</span>&nbsp;<span class="op" id="4321851">=</span>&nbsp;<span class="num" id="4321853">0</span><span class="op" id="4321854">,</span>&nbsp;<span class="builtintype" id="4321856">false</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321865"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321866">.</span><span class="ident" id="4321867">tokens</span>&nbsp;<span class="op" id="4321874">=</span>&nbsp;<span class="ident" id="4321876"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321877">.</span><span class="ident" id="4321878">tokens</span><span class="op" id="4321884">[</span><span class="op" id="4321885">:</span><span class="ident" id="4321886"><a href="/compress/flate/deflate.go.html#4310785">maxFlateBlockTokens</a></span><span class="op" id="4321905">+</span><span class="num" id="4321906">1</span><span class="op" id="4321907">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321911">for</span>&nbsp;<span class="ident" id="4321915">i</span>&nbsp;<span class="op" id="4321917">:=</span>&nbsp;<span class="num" id="4321920">0</span><span class="op" id="4321921">;</span>&nbsp;<span class="ident" id="4321923"><a href="/compress/flate/deflate.go.html#4321915">i</a></span>&nbsp;<span class="op" id="4321925">&lt;=</span>&nbsp;<span class="ident" id="4321928"><a href="/compress/flate/deflate.go.html#4310785">maxFlateBlockTokens</a></span><span class="op" id="4321947">;</span>&nbsp;<span class="ident" id="4321949"><a href="/compress/flate/deflate.go.html#4321915">i</a></span><span class="op" id="4321950">++</span>&nbsp;<span class="op" id="4321953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321958"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321959">.</span><span class="ident" id="4321960">tokens</span><span class="op" id="4321966">[</span><span class="ident" id="4321967"><a href="/compress/flate/deflate.go.html#4321915">i</a></span><span class="op" id="4321968">]</span>&nbsp;<span class="op" id="4321970">=</span>&nbsp;<span class="num" id="4321972">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321976">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321980"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321981">.</span><span class="ident" id="4321982">tokens</span>&nbsp;<span class="op" id="4321989">=</span>&nbsp;<span class="ident" id="4321991"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4321992">.</span><span class="ident" id="4321993">tokens</span><span class="op" id="4321999">[</span><span class="op" id="4322000">:</span><span class="num" id="4322001">0</span><span class="op" id="4322002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322006"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4322007">.</span><span class="ident" id="4322008">length</span>&nbsp;<span class="op" id="4322015">=</span>&nbsp;<span class="ident" id="4322017"><a href="/compress/flate/deflate.go.html#4310455">minMatchLength</a></span>&nbsp;<span class="op" id="4322032">-</span>&nbsp;<span class="num" id="4322034">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322038"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4322039">.</span><span class="ident" id="4322040">offset</span>&nbsp;<span class="op" id="4322047">=</span>&nbsp;<span class="num" id="4322049">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322053"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4322054">.</span><span class="ident" id="4322055">hash</span>&nbsp;<span class="op" id="4322060">=</span>&nbsp;<span class="num" id="4322062">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322066"><a href="/compress/flate/deflate.go.html#4321274">d</a></span><span class="op" id="4322067">.</span><span class="ident" id="4322068">maxInsertIndex</span>&nbsp;<span class="op" id="4322083">=</span>&nbsp;<span class="num" id="4322085">0</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322088">}</span><br>
<span class="lineno"></span><span class="op" id="4322090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4322093">func</span>&nbsp;<span class="op" id="4322098">(</span><span class="ident" id="4322099">d</span>&nbsp;<span class="op" id="4322101">*</span><span class="ident" id="4322102"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><span class="op" id="4322112">)</span>&nbsp;<span class="builtinfunc" id="4322114">close</span><span class="op" id="4322119">(</span><span class="op" id="4322120">)</span>&nbsp;<span class="builtintype" id="4322122">error</span>&nbsp;<span class="op" id="4322128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322131"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322132">.</span><span class="ident" id="4322133">sync</span>&nbsp;<span class="op" id="4322138">=</span>&nbsp;<span class="builtintype" id="4322140">true</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322146"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322147">.</span><span class="ident" id="4322148">step</span><span class="op" id="4322152">(</span><span class="ident" id="4322153"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322157">if</span>&nbsp;<span class="ident" id="4322160"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322161">.</span><span class="ident" id="4322162">err</span>&nbsp;<span class="op" id="4322166">!=</span>&nbsp;<span class="ident" id="4322169">nil</span>&nbsp;<span class="op" id="4322173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322177">return</span>&nbsp;<span class="ident" id="4322184"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322185">.</span><span class="ident" id="4322186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322194">if</span>&nbsp;<span class="ident" id="4322197"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322198">.</span><span class="ident" id="4322199">w</span><span class="op" id="4322200">.</span><span class="ident" id="4322201">writeStoredHeader</span><span class="op" id="4322218">(</span><span class="num" id="4322219">0</span><span class="op" id="4322220">,</span>&nbsp;<span class="builtintype" id="4322222">true</span><span class="op" id="4322226">)</span><span class="op" id="4322227">;</span>&nbsp;<span class="ident" id="4322229"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322230">.</span><span class="ident" id="4322231">w</span><span class="op" id="4322232">.</span><span class="ident" id="4322233">err</span>&nbsp;<span class="op" id="4322237">!=</span>&nbsp;<span class="ident" id="4322240">nil</span>&nbsp;<span class="op" id="4322244">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322248">return</span>&nbsp;<span class="ident" id="4322255"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322256">.</span><span class="ident" id="4322257">w</span><span class="op" id="4322258">.</span><span class="ident" id="4322259">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322267"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322268">.</span><span class="ident" id="4322269">w</span><span class="op" id="4322270">.</span><span class="ident" id="4322271">flush</span><span class="op" id="4322276">(</span><span class="op" id="4322277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322280">return</span>&nbsp;<span class="ident" id="4322287"><a href="/compress/flate/deflate.go.html#4322099">d</a></span><span class="op" id="4322288">.</span><span class="ident" id="4322289">w</span><span class="op" id="4322290">.</span><span class="ident" id="4322291">err</span><br>
<span class="lineno"></span><span class="op" id="4322295">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4322298">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;compressing&nbsp;data&nbsp;at&nbsp;the&nbsp;given&nbsp;level.</span><br>
<span class="lineno"></span><span class="comment" id="4322369">//&nbsp;Following&nbsp;zlib,&nbsp;levels&nbsp;range&nbsp;from&nbsp;1&nbsp;(BestSpeed)&nbsp;to&nbsp;9&nbsp;(BestCompression);</span><br>
<span class="lineno"></span><span class="comment" id="4322444">//&nbsp;higher&nbsp;levels&nbsp;typically&nbsp;run&nbsp;slower&nbsp;but&nbsp;compress&nbsp;more.&nbsp;Level&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4322509">//&nbsp;(NoCompression)&nbsp;does&nbsp;not&nbsp;attempt&nbsp;any&nbsp;compression;&nbsp;it&nbsp;only&nbsp;adds&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="4322579">//&nbsp;necessary&nbsp;DEFLATE&nbsp;framing.&nbsp;Level&nbsp;-1&nbsp;(DefaultCompression)&nbsp;uses&nbsp;the&nbsp;default</span><br>
<span class="lineno"></span><span class="comment" id="4322656">//&nbsp;compression&nbsp;level.</span><br>
<span class="lineno"></span><span class="comment" id="4322678">//</span><br>
<span class="lineno"></span><span class="comment" id="4322681">//&nbsp;If&nbsp;level&nbsp;is&nbsp;in&nbsp;the&nbsp;range&nbsp;[-1,&nbsp;9]&nbsp;then&nbsp;the&nbsp;error&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4322754">//&nbsp;Otherwise&nbsp;the&nbsp;error&nbsp;returned&nbsp;will&nbsp;be&nbsp;non-nil.</span><br>
<span class="lineno">485</span><span class="keyword" id="4322803">func</span>&nbsp;<span class="ident" id="4322808">NewWriter</span><span class="op" id="4322817">(</span><span class="ident" id="4322818">w</span>&nbsp;<span class="ident" id="4322820"><a href="/compress/flate/deflate.go.html#4310160">io</a></span><span class="op" id="4322822">.</span><span class="ident" id="4322823">Writer</span><span class="op" id="4322829">,</span>&nbsp;<span class="ident" id="4322831">level</span>&nbsp;<span class="builtintype" id="4322837">int</span><span class="op" id="4322840">)</span>&nbsp;<span class="op" id="4322842">(</span><span class="op" id="4322843">*</span><span class="ident" id="4322844"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><span class="op" id="4322850">,</span>&nbsp;<span class="builtintype" id="4322852">error</span><span class="op" id="4322857">)</span>&nbsp;<span class="op" id="4322859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322862">var</span>&nbsp;<span class="ident" id="4322866">dw</span>&nbsp;<span class="ident" id="4322869"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322877">if</span>&nbsp;<span class="ident" id="4322880">err</span>&nbsp;<span class="op" id="4322884">:=</span>&nbsp;<span class="ident" id="4322887"><a href="/compress/flate/deflate.go.html#4322866">dw</a></span><span class="op" id="4322889">.</span><span class="ident" id="4322890">d</span><span class="op" id="4322891">.</span><span class="ident" id="4322892">init</span><span class="op" id="4322896">(</span><span class="ident" id="4322897"><a href="/compress/flate/deflate.go.html#4322818">w</a></span><span class="op" id="4322898">,</span>&nbsp;<span class="ident" id="4322900"><a href="/compress/flate/deflate.go.html#4322831">level</a></span><span class="op" id="4322905">)</span><span class="op" id="4322906">;</span>&nbsp;<span class="ident" id="4322908"><a href="/compress/flate/deflate.go.html#4322880">err</a></span>&nbsp;<span class="op" id="4322912">!=</span>&nbsp;<span class="ident" id="4322915">nil</span>&nbsp;<span class="op" id="4322919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322923">return</span>&nbsp;<span class="ident" id="4322930">nil</span><span class="op" id="4322933">,</span>&nbsp;<span class="ident" id="4322935"><a href="/compress/flate/deflate.go.html#4322880">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322940">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322943">return</span>&nbsp;<span class="op" id="4322950">&amp;</span><span class="ident" id="4322951"><a href="/compress/flate/deflate.go.html#4322866">dw</a></span><span class="op" id="4322953">,</span>&nbsp;<span class="ident" id="4322955">nil</span><br>
<span class="lineno"></span><span class="op" id="4322959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4322962">//&nbsp;NewWriterDict&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;initializes&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4323021">//&nbsp;Writer&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Writer&nbsp;behaves</span><br>
<span class="lineno">495</span><span class="comment" id="4323086">//&nbsp;as&nbsp;if&nbsp;the&nbsp;dictionary&nbsp;had&nbsp;been&nbsp;written&nbsp;to&nbsp;it&nbsp;without&nbsp;producing</span><br>
<span class="lineno"></span><span class="comment" id="4323151">//&nbsp;any&nbsp;compressed&nbsp;output.&nbsp;&nbsp;The&nbsp;compressed&nbsp;data&nbsp;written&nbsp;to&nbsp;w</span><br>
<span class="lineno"></span><span class="comment" id="4323211">//&nbsp;can&nbsp;only&nbsp;be&nbsp;decompressed&nbsp;by&nbsp;a&nbsp;Reader&nbsp;initialized&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4323272">//&nbsp;same&nbsp;dictionary.</span><br>
<span class="lineno"></span><span class="keyword" id="4323292">func</span>&nbsp;<span class="ident" id="4323297">NewWriterDict</span><span class="op" id="4323310">(</span><span class="ident" id="4323311">w</span>&nbsp;<span class="ident" id="4323313"><a href="/compress/flate/deflate.go.html#4310160">io</a></span><span class="op" id="4323315">.</span><span class="ident" id="4323316">Writer</span><span class="op" id="4323322">,</span>&nbsp;<span class="ident" id="4323324">level</span>&nbsp;<span class="builtintype" id="4323330">int</span><span class="op" id="4323333">,</span>&nbsp;<span class="ident" id="4323335">dict</span>&nbsp;<span class="op" id="4323340">[</span><span class="op" id="4323341">]</span><span class="builtintype" id="4323342">byte</span><span class="op" id="4323346">)</span>&nbsp;<span class="op" id="4323348">(</span><span class="op" id="4323349">*</span><span class="ident" id="4323350"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><span class="op" id="4323356">,</span>&nbsp;<span class="builtintype" id="4323358">error</span><span class="op" id="4323363">)</span>&nbsp;<span class="op" id="4323365">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323368">dw</span>&nbsp;<span class="op" id="4323371">:=</span>&nbsp;<span class="op" id="4323374">&amp;</span><span class="ident" id="4323375"><a href="/compress/flate/deflate.go.html#4323616">dictWriter</a></span><span class="op" id="4323385">{</span><span class="ident" id="4323386"><a href="/compress/flate/deflate.go.html#4323311">w</a></span><span class="op" id="4323387">,</span>&nbsp;<span class="builtintype" id="4323389">false</span><span class="op" id="4323394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323397">zw</span><span class="op" id="4323399">,</span>&nbsp;<span class="ident" id="4323401">err</span>&nbsp;<span class="op" id="4323405">:=</span>&nbsp;<span class="ident" id="4323408"><a href="/compress/flate/deflate.go.html#4322808">NewWriter</a></span><span class="op" id="4323417">(</span><span class="ident" id="4323418"><a href="/compress/flate/deflate.go.html#4323368">dw</a></span><span class="op" id="4323420">,</span>&nbsp;<span class="ident" id="4323422"><a href="/compress/flate/deflate.go.html#4323324">level</a></span><span class="op" id="4323427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323430">if</span>&nbsp;<span class="ident" id="4323433"><a href="/compress/flate/deflate.go.html#4323401">err</a></span>&nbsp;<span class="op" id="4323437">!=</span>&nbsp;<span class="ident" id="4323440">nil</span>&nbsp;<span class="op" id="4323444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323448">return</span>&nbsp;<span class="ident" id="4323455">nil</span><span class="op" id="4323458">,</span>&nbsp;<span class="ident" id="4323460"><a href="/compress/flate/deflate.go.html#4323401">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4323465">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323468"><a href="/compress/flate/deflate.go.html#4323397">zw</a></span><span class="op" id="4323470">.</span><span class="ident" id="4323471">Write</span><span class="op" id="4323476">(</span><span class="ident" id="4323477"><a href="/compress/flate/deflate.go.html#4323335">dict</a></span><span class="op" id="4323481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323484"><a href="/compress/flate/deflate.go.html#4323397">zw</a></span><span class="op" id="4323486">.</span><span class="ident" id="4323487">Flush</span><span class="op" id="4323492">(</span><span class="op" id="4323493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323496"><a href="/compress/flate/deflate.go.html#4323368">dw</a></span><span class="op" id="4323498">.</span><span class="ident" id="4323499">enabled</span>&nbsp;<span class="op" id="4323507">=</span>&nbsp;<span class="builtintype" id="4323509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323515"><a href="/compress/flate/deflate.go.html#4323397">zw</a></span><span class="op" id="4323517">.</span><span class="ident" id="4323518">dict</span>&nbsp;<span class="op" id="4323523">=</span>&nbsp;<span class="builtinfunc" id="4323525">append</span><span class="op" id="4323531">(</span><span class="ident" id="4323532"><a href="/compress/flate/deflate.go.html#4323397">zw</a></span><span class="op" id="4323534">.</span><span class="ident" id="4323535">dict</span><span class="op" id="4323539">,</span>&nbsp;<span class="ident" id="4323541"><a href="/compress/flate/deflate.go.html#4323335">dict</a></span><span class="op" id="4323545">...</span><span class="op" id="4323548">)</span>&nbsp;<span class="comment" id="4323550">//&nbsp;duplicate&nbsp;dictionary&nbsp;for&nbsp;Reset&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323593">return</span>&nbsp;<span class="ident" id="4323600"><a href="/compress/flate/deflate.go.html#4323397">zw</a></span><span class="op" id="4323602">,</span>&nbsp;<span class="ident" id="4323604"><a href="/compress/flate/deflate.go.html#4323401">err</a></span><br>
<span class="lineno">510</span><span class="op" id="4323608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4323611">type</span>&nbsp;<span class="ident" id="4323616">dictWriter</span>&nbsp;<span class="keyword" id="4323627">struct</span>&nbsp;<span class="op" id="4323634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323637">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4323645"><a href="/compress/flate/deflate.go.html#4310160">io</a></span><span class="op" id="4323647">.</span><span class="ident" id="4323648">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323656">enabled</span>&nbsp;<span class="builtintype" id="4323664">bool</span><br>
<span class="lineno">515</span><span class="op" id="4323669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4323672">func</span>&nbsp;<span class="op" id="4323677">(</span><span class="ident" id="4323678">w</span>&nbsp;<span class="op" id="4323680">*</span><span class="ident" id="4323681"><a href="/compress/flate/deflate.go.html#4323616">dictWriter</a></span><span class="op" id="4323691">)</span>&nbsp;<span class="ident" id="4323693">Write</span><span class="op" id="4323698">(</span><span class="ident" id="4323699">b</span>&nbsp;<span class="op" id="4323701">[</span><span class="op" id="4323702">]</span><span class="builtintype" id="4323703">byte</span><span class="op" id="4323707">)</span>&nbsp;<span class="op" id="4323709">(</span><span class="ident" id="4323710">n</span>&nbsp;<span class="builtintype" id="4323712">int</span><span class="op" id="4323715">,</span>&nbsp;<span class="ident" id="4323717">err</span>&nbsp;<span class="builtintype" id="4323721">error</span><span class="op" id="4323726">)</span>&nbsp;<span class="op" id="4323728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323731">if</span>&nbsp;<span class="ident" id="4323734"><a href="/compress/flate/deflate.go.html#4323678">w</a></span><span class="op" id="4323735">.</span><span class="ident" id="4323736">enabled</span>&nbsp;<span class="op" id="4323744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323748">return</span>&nbsp;<span class="ident" id="4323755"><a href="/compress/flate/deflate.go.html#4323678">w</a></span><span class="op" id="4323756">.</span><span class="ident" id="4323757">w</span><span class="op" id="4323758">.</span><span class="ident" id="4323759">Write</span><span class="op" id="4323764">(</span><span class="ident" id="4323765"><a href="/compress/flate/deflate.go.html#4323699">b</a></span><span class="op" id="4323766">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4323769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323772">return</span>&nbsp;<span class="builtinfunc" id="4323779">len</span><span class="op" id="4323782">(</span><span class="ident" id="4323783"><a href="/compress/flate/deflate.go.html#4323699">b</a></span><span class="op" id="4323784">)</span><span class="op" id="4323785">,</span>&nbsp;<span class="ident" id="4323787">nil</span><br>
<span class="lineno"></span><span class="op" id="4323791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4323794">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">525</span><span class="comment" id="4323857">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="4323919">type</span>&nbsp;<span class="ident" id="4323924">Writer</span>&nbsp;<span class="keyword" id="4323931">struct</span>&nbsp;<span class="op" id="4323938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323941">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4323946"><a href="/compress/flate/deflate.go.html#4311631">compressor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323958">dict</span>&nbsp;<span class="op" id="4323963">[</span><span class="op" id="4323964">]</span><span class="builtintype" id="4323965">byte</span><br>
<span class="lineno"></span><span class="op" id="4323970">}</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span><span class="comment" id="4323973">//&nbsp;Write&nbsp;writes&nbsp;data&nbsp;to&nbsp;w,&nbsp;which&nbsp;will&nbsp;eventually&nbsp;write&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4324032">//&nbsp;compressed&nbsp;form&nbsp;of&nbsp;data&nbsp;to&nbsp;its&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4324085">func</span>&nbsp;<span class="op" id="4324090">(</span><span class="ident" id="4324091">w</span>&nbsp;<span class="op" id="4324093">*</span><span class="ident" id="4324094"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><span class="op" id="4324100">)</span>&nbsp;<span class="ident" id="4324102">Write</span><span class="op" id="4324107">(</span><span class="ident" id="4324108">data</span>&nbsp;<span class="op" id="4324113">[</span><span class="op" id="4324114">]</span><span class="builtintype" id="4324115">byte</span><span class="op" id="4324119">)</span>&nbsp;<span class="op" id="4324121">(</span><span class="ident" id="4324122">n</span>&nbsp;<span class="builtintype" id="4324124">int</span><span class="op" id="4324127">,</span>&nbsp;<span class="ident" id="4324129">err</span>&nbsp;<span class="builtintype" id="4324133">error</span><span class="op" id="4324138">)</span>&nbsp;<span class="op" id="4324140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324143">return</span>&nbsp;<span class="ident" id="4324150"><a href="/compress/flate/deflate.go.html#4324091">w</a></span><span class="op" id="4324151">.</span><span class="ident" id="4324152">d</span><span class="op" id="4324153">.</span><span class="ident" id="4324154">write</span><span class="op" id="4324159">(</span><span class="ident" id="4324160"><a href="/compress/flate/deflate.go.html#4324108">data</a></span><span class="op" id="4324164">)</span><br>
<span class="lineno">535</span><span class="op" id="4324166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4324169">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4324240">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4324311">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.</span><br>
<span class="lineno">540</span><span class="comment" id="4324371">//&nbsp;Flush&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4324429">//&nbsp;If&nbsp;the&nbsp;underlying&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4324501">//</span><br>
<span class="lineno"></span><span class="comment" id="4324504">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4324584">func</span>&nbsp;<span class="op" id="4324589">(</span><span class="ident" id="4324590">w</span>&nbsp;<span class="op" id="4324592">*</span><span class="ident" id="4324593"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><span class="op" id="4324599">)</span>&nbsp;<span class="ident" id="4324601">Flush</span><span class="op" id="4324606">(</span><span class="op" id="4324607">)</span>&nbsp;<span class="builtintype" id="4324609">error</span>&nbsp;<span class="op" id="4324615">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324618">//&nbsp;For&nbsp;more&nbsp;about&nbsp;flushing:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324647">//&nbsp;http://www.bolet.org/~pornin/deflate-flush.html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324699">return</span>&nbsp;<span class="ident" id="4324706"><a href="/compress/flate/deflate.go.html#4324590">w</a></span><span class="op" id="4324707">.</span><span class="ident" id="4324708">d</span><span class="op" id="4324709">.</span><span class="ident" id="4324710">syncFlush</span><span class="op" id="4324719">(</span><span class="op" id="4324720">)</span><br>
<span class="lineno"></span><span class="op" id="4324722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="4324725">//&nbsp;Close&nbsp;flushes&nbsp;and&nbsp;closes&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4324765">func</span>&nbsp;<span class="op" id="4324770">(</span><span class="ident" id="4324771">w</span>&nbsp;<span class="op" id="4324773">*</span><span class="ident" id="4324774"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><span class="op" id="4324780">)</span>&nbsp;<span class="ident" id="4324782">Close</span><span class="op" id="4324787">(</span><span class="op" id="4324788">)</span>&nbsp;<span class="builtintype" id="4324790">error</span>&nbsp;<span class="op" id="4324796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324799">return</span>&nbsp;<span class="ident" id="4324806"><a href="/compress/flate/deflate.go.html#4324771">w</a></span><span class="op" id="4324807">.</span><span class="ident" id="4324808">d</span><span class="op" id="4324809">.</span><span class="builtinfunc" id="4324810">close</span><span class="op" id="4324815">(</span><span class="op" id="4324816">)</span><br>
<span class="lineno"></span><span class="op" id="4324818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span><span class="comment" id="4324821">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;writer&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4324885">//&nbsp;the&nbsp;result&nbsp;of&nbsp;NewWriter&nbsp;or&nbsp;NewWriterDict&nbsp;called&nbsp;with&nbsp;dst</span><br>
<span class="lineno"></span><span class="comment" id="4324945">//&nbsp;and&nbsp;w&#39;s&nbsp;level&nbsp;and&nbsp;dictionary.</span><br>
<span class="lineno"></span><span class="keyword" id="4324978">func</span>&nbsp;<span class="op" id="4324983">(</span><span class="ident" id="4324984">w</span>&nbsp;<span class="op" id="4324986">*</span><span class="ident" id="4324987"><a href="/compress/flate/deflate.go.html#4323924">Writer</a></span><span class="op" id="4324993">)</span>&nbsp;<span class="ident" id="4324995">Reset</span><span class="op" id="4325000">(</span><span class="ident" id="4325001">dst</span>&nbsp;<span class="ident" id="4325005"><a href="/compress/flate/deflate.go.html#4310160">io</a></span><span class="op" id="4325007">.</span><span class="ident" id="4325008">Writer</span><span class="op" id="4325014">)</span>&nbsp;<span class="op" id="4325016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325019">if</span>&nbsp;<span class="ident" id="4325022">dw</span><span class="op" id="4325024">,</span>&nbsp;<span class="ident" id="4325026">ok</span>&nbsp;<span class="op" id="4325029">:=</span>&nbsp;<span class="ident" id="4325032"><a href="/compress/flate/deflate.go.html#4324984">w</a></span><span class="op" id="4325033">.</span><span class="ident" id="4325034">d</span><span class="op" id="4325035">.</span><span class="ident" id="4325036">w</span><span class="op" id="4325037">.</span><span class="ident" id="4325038">w</span><span class="op" id="4325039">.</span><span class="op" id="4325040">(</span><span class="op" id="4325041">*</span><span class="ident" id="4325042"><a href="/compress/flate/deflate.go.html#4323616">dictWriter</a></span><span class="op" id="4325052">)</span><span class="op" id="4325053">;</span>&nbsp;<span class="ident" id="4325055"><a href="/compress/flate/deflate.go.html#4325026">ok</a></span>&nbsp;<span class="op" id="4325058">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4325062">//&nbsp;w&nbsp;was&nbsp;created&nbsp;with&nbsp;NewWriterDict</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325100"><a href="/compress/flate/deflate.go.html#4325022">dw</a></span><span class="op" id="4325102">.</span><span class="ident" id="4325103">w</span>&nbsp;<span class="op" id="4325105">=</span>&nbsp;<span class="ident" id="4325107"><a href="/compress/flate/deflate.go.html#4325001">dst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325113"><a href="/compress/flate/deflate.go.html#4324984">w</a></span><span class="op" id="4325114">.</span><span class="ident" id="4325115">d</span><span class="op" id="4325116">.</span><span class="ident" id="4325117">reset</span><span class="op" id="4325122">(</span><span class="ident" id="4325123"><a href="/compress/flate/deflate.go.html#4325022">dw</a></span><span class="op" id="4325125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325129"><a href="/compress/flate/deflate.go.html#4325022">dw</a></span><span class="op" id="4325131">.</span><span class="ident" id="4325132">enabled</span>&nbsp;<span class="op" id="4325140">=</span>&nbsp;<span class="builtintype" id="4325142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325150"><a href="/compress/flate/deflate.go.html#4324984">w</a></span><span class="op" id="4325151">.</span><span class="ident" id="4325152">Write</span><span class="op" id="4325157">(</span><span class="ident" id="4325158"><a href="/compress/flate/deflate.go.html#4324984">w</a></span><span class="op" id="4325159">.</span><span class="ident" id="4325160">dict</span><span class="op" id="4325164">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325168"><a href="/compress/flate/deflate.go.html#4324984">w</a></span><span class="op" id="4325169">.</span><span class="ident" id="4325170">Flush</span><span class="op" id="4325175">(</span><span class="op" id="4325176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325180"><a href="/compress/flate/deflate.go.html#4325022">dw</a></span><span class="op" id="4325182">.</span><span class="ident" id="4325183">enabled</span>&nbsp;<span class="op" id="4325191">=</span>&nbsp;<span class="builtintype" id="4325193">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325199">}</span>&nbsp;<span class="keyword" id="4325201">else</span>&nbsp;<span class="op" id="4325206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4325210">//&nbsp;w&nbsp;was&nbsp;created&nbsp;with&nbsp;NewWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325244"><a href="/compress/flate/deflate.go.html#4324984">w</a></span><span class="op" id="4325245">.</span><span class="ident" id="4325246">d</span><span class="op" id="4325247">.</span><span class="ident" id="4325248">reset</span><span class="op" id="4325253">(</span><span class="ident" id="4325254"><a href="/compress/flate/deflate.go.html#4325001">dst</a></span><span class="op" id="4325257">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325260">}</span><br>
<span class="lineno"></span><span class="op" id="4325262">}</span>
</div>
</body>
</html>
