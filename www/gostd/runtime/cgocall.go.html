<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html" class="current">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1428473">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1428529">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1428583">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1428634">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1428668">//</span><br>
<span class="lineno"></span><span class="comment" id="1428671">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1428742">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1428807">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1428848">//</span><br>
<span class="lineno"></span><span class="comment" id="1428851">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1428911">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1428976">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1429035">//</span><br>
<span class="lineno">15</span><span class="comment" id="1429038">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1429107">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1429177">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1429233">//</span><br>
<span class="lineno"></span><span class="comment" id="1429236">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1429299">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1429368">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1429406">//</span><br>
<span class="lineno"></span><span class="comment" id="1429409">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1429478">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1429542">//</span><br>
<span class="lineno"></span><span class="comment" id="1429545">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1429622">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1429695">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1429725">//</span><br>
<span class="lineno">30</span><span class="comment" id="1429728">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1429802">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1429873">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1429919">//</span><br>
<span class="lineno"></span><span class="comment" id="1429922">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1429998">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1430076">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1430143">//</span><br>
<span class="lineno"></span><span class="comment" id="1430146">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1430214">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1430288">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1430359">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1430429">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1430494">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1430560">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1430631">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1430666">//</span><br>
<span class="lineno"></span><span class="comment" id="1430669">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1430736">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1430806">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1430880">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1430938">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1430973">//</span><br>
<span class="lineno"></span><span class="comment" id="1430976">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1431040">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1431104">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1431154">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1431224">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1431294">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1431369">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1431439">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1431489">//</span><br>
<span class="lineno"></span><span class="comment" id="1431492">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1431559">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1431638">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1431706">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1431785">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1431862">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1431932">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1432009">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1432064">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1432139">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1432216">//</span><br>
<span class="lineno"></span><span class="comment" id="1432219">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1432285">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1432361">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1432429">//</span><br>
<span class="lineno"></span><span class="comment" id="1432432">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1432501">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1432575">package</span>&nbsp;<span class="ident" id="1432583">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1432592">import</span>&nbsp;<span class="string" id="1432599">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1432609">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1432631">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1432644">func</span>&nbsp;<span class="ident" id="1432649">cgocall</span><span class="op" id="1432656">(</span><span class="ident" id="1432657">fn</span><span class="op" id="1432659">,</span>&nbsp;<span class="ident" id="1432661">arg</span>&nbsp;<span class="ident" id="1432665">unsafe</span><span class="op" id="1432671">.</span><span class="ident" id="1432672">Pointer</span><span class="op" id="1432679">)</span>&nbsp;<span class="op" id="1432681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1432684">cgocall_errno</span><span class="op" id="1432697">(</span><span class="ident" id="1432698">fn</span><span class="op" id="1432700">,</span>&nbsp;<span class="ident" id="1432702">arg</span><span class="op" id="1432705">)</span><br>
<span class="lineno"></span><span class="op" id="1432707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1432710">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1432723">func</span>&nbsp;<span class="ident" id="1432728">cgocall_errno</span><span class="op" id="1432741">(</span><span class="ident" id="1432742">fn</span><span class="op" id="1432744">,</span>&nbsp;<span class="ident" id="1432746">arg</span>&nbsp;<span class="ident" id="1432750">unsafe</span><span class="op" id="1432756">.</span><span class="ident" id="1432757">Pointer</span><span class="op" id="1432764">)</span>&nbsp;<span class="builtintype" id="1432766">int32</span>&nbsp;<span class="op" id="1432772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1432775">if</span>&nbsp;<span class="op" id="1432778">!</span><span class="ident" id="1432779">iscgo</span>&nbsp;<span class="op" id="1432785">&amp;&amp;</span>&nbsp;<span class="ident" id="1432788">GOOS</span>&nbsp;<span class="op" id="1432793">!=</span>&nbsp;<span class="string" id="1432796">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1432806">&amp;&amp;</span>&nbsp;<span class="ident" id="1432809">GOOS</span>&nbsp;<span class="op" id="1432814">!=</span>&nbsp;<span class="string" id="1432817">&#34;windows&#34;</span>&nbsp;<span class="op" id="1432827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1432831">gothrow</span><span class="op" id="1432838">(</span><span class="string" id="1432839">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1432860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1432863">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1432867">if</span>&nbsp;<span class="ident" id="1432870">fn</span>&nbsp;<span class="op" id="1432873">==</span>&nbsp;<span class="ident" id="1432876">nil</span>&nbsp;<span class="op" id="1432880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1432884">gothrow</span><span class="op" id="1432891">(</span><span class="string" id="1432892">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1432905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1432908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1432912">if</span>&nbsp;<span class="ident" id="1432915">raceenabled</span>&nbsp;<span class="op" id="1432927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1432931">racereleasemerge</span><span class="op" id="1432947">(</span><span class="ident" id="1432948">unsafe</span><span class="op" id="1432954">.</span><span class="ident" id="1432955">Pointer</span><span class="op" id="1432962">(</span><span class="op" id="1432963">&amp;</span><span class="ident" id="1432964">racecgosync</span><span class="op" id="1432975">)</span><span class="op" id="1432976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1432979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1432983">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1433067">if</span>&nbsp;<span class="ident" id="1433070">needextram</span>&nbsp;<span class="op" id="1433081">==</span>&nbsp;<span class="num" id="1433084">1</span>&nbsp;<span class="op" id="1433086">&amp;&amp;</span>&nbsp;<span class="ident" id="1433089">cas</span><span class="op" id="1433092">(</span><span class="op" id="1433093">&amp;</span><span class="ident" id="1433094">needextram</span><span class="op" id="1433104">,</span>&nbsp;<span class="num" id="1433106">1</span><span class="op" id="1433107">,</span>&nbsp;<span class="num" id="1433109">0</span><span class="op" id="1433110">)</span>&nbsp;<span class="op" id="1433112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433116">onM</span><span class="op" id="1433119">(</span><span class="ident" id="1433120">newextram</span><span class="op" id="1433129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1433132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1433136">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433269">lockOSThread</span><span class="op" id="1433281">(</span><span class="op" id="1433282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433285">mp</span>&nbsp;<span class="op" id="1433288">:=</span>&nbsp;<span class="ident" id="1433291">getg</span><span class="op" id="1433295">(</span><span class="op" id="1433296">)</span><span class="op" id="1433297">.</span><span class="ident" id="1433298">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433301">mp</span><span class="op" id="1433303">.</span><span class="ident" id="1433304">ncgocall</span><span class="op" id="1433312">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433316">mp</span><span class="op" id="1433318">.</span><span class="ident" id="1433319">ncgo</span><span class="op" id="1433323">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1433327">defer</span>&nbsp;<span class="ident" id="1433333">endcgo</span><span class="op" id="1433339">(</span><span class="ident" id="1433340">mp</span><span class="op" id="1433342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1433346">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433704">entersyscall</span><span class="op" id="1433716">(</span><span class="op" id="1433717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433720">errno</span>&nbsp;<span class="op" id="1433726">:=</span>&nbsp;<span class="ident" id="1433729">asmcgocall_errno</span><span class="op" id="1433745">(</span><span class="ident" id="1433746">fn</span><span class="op" id="1433748">,</span>&nbsp;<span class="ident" id="1433750">arg</span><span class="op" id="1433753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433756">exitsyscall</span><span class="op" id="1433767">(</span><span class="op" id="1433768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1433772">return</span>&nbsp;<span class="ident" id="1433779">errno</span><br>
<span class="lineno">135</span><span class="op" id="1433785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433788">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1433801">func</span>&nbsp;<span class="ident" id="1433806">endcgo</span><span class="op" id="1433812">(</span><span class="ident" id="1433813">mp</span>&nbsp;<span class="op" id="1433816">*</span><span class="ident" id="1433817">m</span><span class="op" id="1433818">)</span>&nbsp;<span class="op" id="1433820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1433823">mp</span><span class="op" id="1433825">.</span><span class="ident" id="1433826">ncgo</span><span class="op" id="1433830">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1433834">if</span>&nbsp;<span class="ident" id="1433837">mp</span><span class="op" id="1433839">.</span><span class="ident" id="1433840">ncgo</span>&nbsp;<span class="op" id="1433845">==</span>&nbsp;<span class="num" id="1433848">0</span>&nbsp;<span class="op" id="1433850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1433854">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1433910">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1433966">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434015">mp</span><span class="op" id="1434017">.</span><span class="ident" id="1434018">cgomal</span>&nbsp;<span class="op" id="1434025">=</span>&nbsp;<span class="ident" id="1434027">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1434032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1434036">if</span>&nbsp;<span class="ident" id="1434039">raceenabled</span>&nbsp;<span class="op" id="1434051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434055">raceacquire</span><span class="op" id="1434066">(</span><span class="ident" id="1434067">unsafe</span><span class="op" id="1434073">.</span><span class="ident" id="1434074">Pointer</span><span class="op" id="1434081">(</span><span class="op" id="1434082">&amp;</span><span class="ident" id="1434083">racecgosync</span><span class="op" id="1434094">)</span><span class="op" id="1434095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1434098">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434102">unlockOSThread</span><span class="op" id="1434116">(</span><span class="op" id="1434117">)</span>&nbsp;<span class="comment" id="1434119">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1434137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1434140">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1434175">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1434230">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1434302">var</span>&nbsp;<span class="ident" id="1434306">cgoMalloc</span><span class="op" id="1434315">,</span>&nbsp;<span class="ident" id="1434317">cgoFree</span>&nbsp;<span class="ident" id="1434325">unsafe</span><span class="op" id="1434331">.</span><span class="ident" id="1434332">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1434341">func</span>&nbsp;<span class="ident" id="1434346">cmalloc</span><span class="op" id="1434353">(</span><span class="ident" id="1434354">n</span>&nbsp;<span class="builtintype" id="1434356">uintptr</span><span class="op" id="1434363">)</span>&nbsp;<span class="ident" id="1434365">unsafe</span><span class="op" id="1434371">.</span><span class="ident" id="1434372">Pointer</span>&nbsp;<span class="op" id="1434380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1434383">var</span>&nbsp;<span class="ident" id="1434387">args</span>&nbsp;<span class="keyword" id="1434392">struct</span>&nbsp;<span class="op" id="1434399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434403">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1434407">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434416">ret</span>&nbsp;<span class="ident" id="1434420">unsafe</span><span class="op" id="1434426">.</span><span class="ident" id="1434427">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1434436">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434439">args</span><span class="op" id="1434443">.</span><span class="ident" id="1434444">n</span>&nbsp;<span class="op" id="1434446">=</span>&nbsp;<span class="ident" id="1434448">uint64</span><span class="op" id="1434454">(</span><span class="ident" id="1434455">n</span><span class="op" id="1434456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434459">cgocall</span><span class="op" id="1434466">(</span><span class="ident" id="1434467">cgoMalloc</span><span class="op" id="1434476">,</span>&nbsp;<span class="ident" id="1434478">unsafe</span><span class="op" id="1434484">.</span><span class="ident" id="1434485">Pointer</span><span class="op" id="1434492">(</span><span class="op" id="1434493">&amp;</span><span class="ident" id="1434494">args</span><span class="op" id="1434498">)</span><span class="op" id="1434499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1434502">if</span>&nbsp;<span class="ident" id="1434505">args</span><span class="op" id="1434509">.</span><span class="ident" id="1434510">ret</span>&nbsp;<span class="op" id="1434514">==</span>&nbsp;<span class="ident" id="1434517">nil</span>&nbsp;<span class="op" id="1434521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434525">gothrow</span><span class="op" id="1434532">(</span><span class="string" id="1434533">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1434550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1434553">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1434556">return</span>&nbsp;<span class="ident" id="1434563">args</span><span class="op" id="1434567">.</span><span class="ident" id="1434568">ret</span><br>
<span class="lineno"></span><span class="op" id="1434572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1434575">func</span>&nbsp;<span class="ident" id="1434580">cfree</span><span class="op" id="1434585">(</span><span class="ident" id="1434586">p</span>&nbsp;<span class="ident" id="1434588">unsafe</span><span class="op" id="1434594">.</span><span class="ident" id="1434595">Pointer</span><span class="op" id="1434602">)</span>&nbsp;<span class="op" id="1434604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434607">cgocall</span><span class="op" id="1434614">(</span><span class="ident" id="1434615">cgoFree</span><span class="op" id="1434622">,</span>&nbsp;<span class="ident" id="1434624">p</span><span class="op" id="1434625">)</span><br>
<span class="lineno">175</span><span class="op" id="1434627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1434630">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1434657">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1434670">func</span>&nbsp;<span class="ident" id="1434675">cgocallbackg</span><span class="op" id="1434687">(</span><span class="op" id="1434688">)</span>&nbsp;<span class="op" id="1434690">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434693">gp</span>&nbsp;<span class="op" id="1434696">:=</span>&nbsp;<span class="ident" id="1434699">getg</span><span class="op" id="1434703">(</span><span class="op" id="1434704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1434707">if</span>&nbsp;<span class="ident" id="1434710">gp</span>&nbsp;<span class="op" id="1434713">!=</span>&nbsp;<span class="ident" id="1434716">gp</span><span class="op" id="1434718">.</span><span class="ident" id="1434719">m</span><span class="op" id="1434720">.</span><span class="ident" id="1434721">curg</span>&nbsp;<span class="op" id="1434726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1434730">println</span><span class="op" id="1434737">(</span><span class="string" id="1434738">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1434769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434773">exit</span><span class="op" id="1434777">(</span><span class="num" id="1434778">2</span><span class="op" id="1434779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1434782">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1434786">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1434857">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1434929">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435000">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435055">savedsp</span>&nbsp;<span class="op" id="1435063">:=</span>&nbsp;<span class="ident" id="1435066">unsafe</span><span class="op" id="1435072">.</span><span class="ident" id="1435073">Pointer</span><span class="op" id="1435080">(</span><span class="ident" id="1435081">gp</span><span class="op" id="1435083">.</span><span class="ident" id="1435084">syscallsp</span><span class="op" id="1435093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435096">savedpc</span>&nbsp;<span class="op" id="1435104">:=</span>&nbsp;<span class="ident" id="1435107">gp</span><span class="op" id="1435109">.</span><span class="ident" id="1435110">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435121">exitsyscall</span><span class="op" id="1435132">(</span><span class="op" id="1435133">)</span>&nbsp;<span class="comment" id="1435135">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435162">cgocallbackg1</span><span class="op" id="1435175">(</span><span class="op" id="1435176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435179">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435206">reentersyscall</span><span class="op" id="1435220">(</span><span class="ident" id="1435221">savedpc</span><span class="op" id="1435228">,</span>&nbsp;<span class="ident" id="1435230">savedsp</span><span class="op" id="1435237">)</span><br>
<span class="lineno"></span><span class="op" id="1435239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1435242">func</span>&nbsp;<span class="ident" id="1435247">cgocallbackg1</span><span class="op" id="1435260">(</span><span class="op" id="1435261">)</span>&nbsp;<span class="op" id="1435263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435266">gp</span>&nbsp;<span class="op" id="1435269">:=</span>&nbsp;<span class="ident" id="1435272">getg</span><span class="op" id="1435276">(</span><span class="op" id="1435277">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435280">if</span>&nbsp;<span class="ident" id="1435283">gp</span><span class="op" id="1435285">.</span><span class="ident" id="1435286">m</span><span class="op" id="1435287">.</span><span class="ident" id="1435288">needextram</span>&nbsp;<span class="op" id="1435299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435303">gp</span><span class="op" id="1435305">.</span><span class="ident" id="1435306">m</span><span class="op" id="1435307">.</span><span class="ident" id="1435308">needextram</span>&nbsp;<span class="op" id="1435319">=</span>&nbsp;<span class="builtintype" id="1435321">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435329">onM</span><span class="op" id="1435332">(</span><span class="ident" id="1435333">newextram</span><span class="op" id="1435342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1435345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435349">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435396">restore</span>&nbsp;<span class="op" id="1435404">:=</span>&nbsp;<span class="builtintype" id="1435407">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435413">defer</span>&nbsp;<span class="ident" id="1435419">unwindm</span><span class="op" id="1435426">(</span><span class="op" id="1435427">&amp;</span><span class="ident" id="1435428">restore</span><span class="op" id="1435435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435439">if</span>&nbsp;<span class="ident" id="1435442">raceenabled</span>&nbsp;<span class="op" id="1435454">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435458">raceacquire</span><span class="op" id="1435469">(</span><span class="ident" id="1435470">unsafe</span><span class="op" id="1435476">.</span><span class="ident" id="1435477">Pointer</span><span class="op" id="1435484">(</span><span class="op" id="1435485">&amp;</span><span class="ident" id="1435486">racecgosync</span><span class="op" id="1435497">)</span><span class="op" id="1435498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1435501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435505">type</span>&nbsp;<span class="ident" id="1435510">args</span>&nbsp;<span class="keyword" id="1435515">struct</span>&nbsp;<span class="op" id="1435522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435526">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1435534">*</span><span class="ident" id="1435535">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435545">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435553">unsafe</span><span class="op" id="1435559">.</span><span class="ident" id="1435560">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435570">argsize</span>&nbsp;<span class="builtintype" id="1435578">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1435587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435590">var</span>&nbsp;<span class="ident" id="1435594">cb</span>&nbsp;<span class="op" id="1435597">*</span><span class="ident" id="1435598">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435605">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435670">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435721">sp</span>&nbsp;<span class="op" id="1435724">:=</span>&nbsp;<span class="ident" id="1435727">gp</span><span class="op" id="1435729">.</span><span class="ident" id="1435730">m</span><span class="op" id="1435731">.</span><span class="ident" id="1435732">g0</span><span class="op" id="1435734">.</span><span class="ident" id="1435735">sched</span><span class="op" id="1435740">.</span><span class="ident" id="1435741">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435745">switch</span>&nbsp;<span class="ident" id="1435752">GOARCH</span>&nbsp;<span class="op" id="1435759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435762">default</span><span class="op" id="1435769">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435773">gothrow</span><span class="op" id="1435780">(</span><span class="string" id="1435781">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1435820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435823">case</span>&nbsp;<span class="string" id="1435828">&#34;arm&#34;</span><span class="op" id="1435833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435837">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435906">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435981">cb</span>&nbsp;<span class="op" id="1435984">=</span>&nbsp;<span class="op" id="1435986">(</span><span class="op" id="1435987">*</span><span class="ident" id="1435988">args</span><span class="op" id="1435992">)</span><span class="op" id="1435993">(</span><span class="ident" id="1435994">unsafe</span><span class="op" id="1436000">.</span><span class="ident" id="1436001">Pointer</span><span class="op" id="1436008">(</span><span class="ident" id="1436009">sp</span>&nbsp;<span class="op" id="1436012">+</span>&nbsp;<span class="num" id="1436014">4</span><span class="op" id="1436015">*</span><span class="ident" id="1436016">ptrSize</span><span class="op" id="1436023">)</span><span class="op" id="1436024">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436027">case</span>&nbsp;<span class="string" id="1436032">&#34;amd64&#34;</span><span class="op" id="1436039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436043">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436099">cb</span>&nbsp;<span class="op" id="1436102">=</span>&nbsp;<span class="op" id="1436104">(</span><span class="op" id="1436105">*</span><span class="ident" id="1436106">args</span><span class="op" id="1436110">)</span><span class="op" id="1436111">(</span><span class="ident" id="1436112">unsafe</span><span class="op" id="1436118">.</span><span class="ident" id="1436119">Pointer</span><span class="op" id="1436126">(</span><span class="ident" id="1436127">sp</span>&nbsp;<span class="op" id="1436130">+</span>&nbsp;<span class="num" id="1436132">2</span><span class="op" id="1436133">*</span><span class="ident" id="1436134">ptrSize</span><span class="op" id="1436141">)</span><span class="op" id="1436142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436145">case</span>&nbsp;<span class="string" id="1436150">&#34;386&#34;</span><span class="op" id="1436155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436159">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436216">cb</span>&nbsp;<span class="op" id="1436219">=</span>&nbsp;<span class="op" id="1436221">(</span><span class="op" id="1436222">*</span><span class="ident" id="1436223">args</span><span class="op" id="1436227">)</span><span class="op" id="1436228">(</span><span class="ident" id="1436229">unsafe</span><span class="op" id="1436235">.</span><span class="ident" id="1436236">Pointer</span><span class="op" id="1436243">(</span><span class="ident" id="1436244">sp</span>&nbsp;<span class="op" id="1436247">+</span>&nbsp;<span class="num" id="1436249">4</span><span class="op" id="1436250">*</span><span class="ident" id="1436251">ptrSize</span><span class="op" id="1436258">)</span><span class="op" id="1436259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436266">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436287">reflectcall</span><span class="op" id="1436298">(</span><span class="ident" id="1436299">unsafe</span><span class="op" id="1436305">.</span><span class="ident" id="1436306">Pointer</span><span class="op" id="1436313">(</span><span class="ident" id="1436314">cb</span><span class="op" id="1436316">.</span><span class="ident" id="1436317">fn</span><span class="op" id="1436319">)</span><span class="op" id="1436320">,</span>&nbsp;<span class="ident" id="1436322">unsafe</span><span class="op" id="1436328">.</span><span class="ident" id="1436329">Pointer</span><span class="op" id="1436336">(</span><span class="ident" id="1436337">cb</span><span class="op" id="1436339">.</span><span class="ident" id="1436340">arg</span><span class="op" id="1436343">)</span><span class="op" id="1436344">,</span>&nbsp;<span class="builtintype" id="1436346">uint32</span><span class="op" id="1436352">(</span><span class="ident" id="1436353">cb</span><span class="op" id="1436355">.</span><span class="ident" id="1436356">argsize</span><span class="op" id="1436363">)</span><span class="op" id="1436364">,</span>&nbsp;<span class="num" id="1436366">0</span><span class="op" id="1436367">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436371">if</span>&nbsp;<span class="ident" id="1436374">raceenabled</span>&nbsp;<span class="op" id="1436386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436390">racereleasemerge</span><span class="op" id="1436406">(</span><span class="ident" id="1436407">unsafe</span><span class="op" id="1436413">.</span><span class="ident" id="1436414">Pointer</span><span class="op" id="1436421">(</span><span class="op" id="1436422">&amp;</span><span class="ident" id="1436423">racecgosync</span><span class="op" id="1436434">)</span><span class="op" id="1436435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436442">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436477">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436520">restore</span>&nbsp;<span class="op" id="1436528">=</span>&nbsp;<span class="builtintype" id="1436530">false</span><br>
<span class="lineno"></span><span class="op" id="1436536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1436539">func</span>&nbsp;<span class="ident" id="1436544">unwindm</span><span class="op" id="1436551">(</span><span class="ident" id="1436552">restore</span>&nbsp;<span class="op" id="1436560">*</span><span class="builtintype" id="1436561">bool</span><span class="op" id="1436565">)</span>&nbsp;<span class="op" id="1436567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436570">if</span>&nbsp;<span class="op" id="1436573">!</span><span class="op" id="1436574">*</span><span class="ident" id="1436575">restore</span>&nbsp;<span class="op" id="1436583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436587">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436598">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436641">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436695">mp</span>&nbsp;<span class="op" id="1436698">:=</span>&nbsp;<span class="ident" id="1436701">acquirem</span><span class="op" id="1436709">(</span><span class="op" id="1436710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436713">sched</span>&nbsp;<span class="op" id="1436719">:=</span>&nbsp;<span class="op" id="1436722">&amp;</span><span class="ident" id="1436723">mp</span><span class="op" id="1436725">.</span><span class="ident" id="1436726">g0</span><span class="op" id="1436728">.</span><span class="ident" id="1436729">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436736">switch</span>&nbsp;<span class="ident" id="1436743">GOARCH</span>&nbsp;<span class="op" id="1436750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436753">default</span><span class="op" id="1436760">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436764">gothrow</span><span class="op" id="1436771">(</span><span class="string" id="1436772">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1436797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436800">case</span>&nbsp;<span class="string" id="1436805">&#34;386&#34;</span><span class="op" id="1436810">,</span>&nbsp;<span class="string" id="1436812">&#34;amd64&#34;</span><span class="op" id="1436819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436823">sched</span><span class="op" id="1436828">.</span><span class="ident" id="1436829">sp</span>&nbsp;<span class="op" id="1436832">=</span>&nbsp;<span class="op" id="1436834">*</span><span class="op" id="1436835">(</span><span class="op" id="1436836">*</span><span class="builtintype" id="1436837">uintptr</span><span class="op" id="1436844">)</span><span class="op" id="1436845">(</span><span class="ident" id="1436846">unsafe</span><span class="op" id="1436852">.</span><span class="ident" id="1436853">Pointer</span><span class="op" id="1436860">(</span><span class="ident" id="1436861">sched</span><span class="op" id="1436866">.</span><span class="ident" id="1436867">sp</span><span class="op" id="1436869">)</span><span class="op" id="1436870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436873">case</span>&nbsp;<span class="string" id="1436878">&#34;arm&#34;</span><span class="op" id="1436883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436887">sched</span><span class="op" id="1436892">.</span><span class="ident" id="1436893">sp</span>&nbsp;<span class="op" id="1436896">=</span>&nbsp;<span class="op" id="1436898">*</span><span class="op" id="1436899">(</span><span class="op" id="1436900">*</span><span class="builtintype" id="1436901">uintptr</span><span class="op" id="1436908">)</span><span class="op" id="1436909">(</span><span class="ident" id="1436910">unsafe</span><span class="op" id="1436916">.</span><span class="ident" id="1436917">Pointer</span><span class="op" id="1436924">(</span><span class="ident" id="1436925">sched</span><span class="op" id="1436930">.</span><span class="ident" id="1436931">sp</span>&nbsp;<span class="op" id="1436934">+</span>&nbsp;<span class="num" id="1436936">4</span><span class="op" id="1436937">)</span><span class="op" id="1436938">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436944">releasem</span><span class="op" id="1436952">(</span><span class="ident" id="1436953">mp</span><span class="op" id="1436955">)</span><br>
<span class="lineno"></span><span class="op" id="1436957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1436960">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1436984">func</span>&nbsp;<span class="ident" id="1436989">badcgocallback</span><span class="op" id="1437003">(</span><span class="op" id="1437004">)</span>&nbsp;<span class="op" id="1437006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437009">gothrow</span><span class="op" id="1437016">(</span><span class="string" id="1437017">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1437050">)</span><br>
<span class="lineno"></span><span class="op" id="1437052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1437055">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1437092">func</span>&nbsp;<span class="ident" id="1437097">cgounimpl</span><span class="op" id="1437106">(</span><span class="op" id="1437107">)</span>&nbsp;<span class="op" id="1437109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437112">gothrow</span><span class="op" id="1437119">(</span><span class="string" id="1437120">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1437141">)</span><br>
<span class="lineno"></span><span class="op" id="1437143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1437146">var</span>&nbsp;<span class="ident" id="1437150">racecgosync</span>&nbsp;<span class="ident" id="1437162">uint64</span>&nbsp;<span class="comment" id="1437169">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
