<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html" class="current">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1708645">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1708700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1708754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1708805">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;runtime&nbsp;support&nbsp;for&nbsp;signal&nbsp;handling.</span><br>
<span class="lineno"></span><span class="comment" id="1708866">//</span><br>
<span class="lineno"></span><span class="comment" id="1708869">//&nbsp;Most&nbsp;synchronization&nbsp;primitives&nbsp;are&nbsp;not&nbsp;available&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="1708927">//&nbsp;the&nbsp;signal&nbsp;handler&nbsp;(it&nbsp;cannot&nbsp;block,&nbsp;allocate&nbsp;memory,&nbsp;or&nbsp;use&nbsp;locks)</span><br>
<span class="lineno"></span><span class="comment" id="1708998">//&nbsp;so&nbsp;the&nbsp;handler&nbsp;communicates&nbsp;with&nbsp;a&nbsp;processing&nbsp;goroutine</span><br>
<span class="lineno">10</span><span class="comment" id="1709057">//&nbsp;via&nbsp;struct&nbsp;sig,&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="1709083">//</span><br>
<span class="lineno"></span><span class="comment" id="1709086">//&nbsp;sigsend&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;signal&nbsp;handler&nbsp;to&nbsp;queue&nbsp;a&nbsp;new&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="1709152">//&nbsp;signal_recv&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;Go&nbsp;program&nbsp;to&nbsp;receive&nbsp;a&nbsp;newly&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="1709229">//&nbsp;Synchronization&nbsp;between&nbsp;sigsend&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;sig.state</span><br>
<span class="lineno">15</span><span class="comment" id="1709306">//&nbsp;variable.&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;3&nbsp;states:&nbsp;sigIdle,&nbsp;sigReceiving&nbsp;and&nbsp;sigSending.</span><br>
<span class="lineno"></span><span class="comment" id="1709381">//&nbsp;sigReceiving&nbsp;means&nbsp;that&nbsp;signal_recv&nbsp;is&nbsp;blocked&nbsp;on&nbsp;sig.Note&nbsp;and&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="1709460">//&nbsp;new&nbsp;pending&nbsp;signals.</span><br>
<span class="lineno"></span><span class="comment" id="1709484">//&nbsp;sigSending&nbsp;means&nbsp;that&nbsp;sig.mask&nbsp;*may*&nbsp;contain&nbsp;new&nbsp;pending&nbsp;signals,</span><br>
<span class="lineno"></span><span class="comment" id="1709553">//&nbsp;signal_recv&nbsp;can&#39;t&nbsp;be&nbsp;blocked&nbsp;in&nbsp;this&nbsp;state.</span><br>
<span class="lineno">20</span><span class="comment" id="1709600">//&nbsp;sigIdle&nbsp;means&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;new&nbsp;pending&nbsp;signals&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;not&nbsp;blocked.</span><br>
<span class="lineno"></span><span class="comment" id="1709687">//&nbsp;Transitions&nbsp;between&nbsp;states&nbsp;are&nbsp;done&nbsp;atomically&nbsp;with&nbsp;CAS.</span><br>
<span class="lineno"></span><span class="comment" id="1709747">//&nbsp;When&nbsp;signal_recv&nbsp;is&nbsp;unblocked,&nbsp;it&nbsp;resets&nbsp;sig.Note&nbsp;and&nbsp;rechecks&nbsp;sig.mask.</span><br>
<span class="lineno"></span><span class="comment" id="1709823">//&nbsp;If&nbsp;several&nbsp;sigsends&nbsp;and&nbsp;signal_recv&nbsp;execute&nbsp;concurrently,&nbsp;it&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1709899">//&nbsp;unnecessary&nbsp;rechecks&nbsp;of&nbsp;sig.mask,&nbsp;but&nbsp;it&nbsp;cannot&nbsp;lead&nbsp;to&nbsp;missed&nbsp;signals</span><br>
<span class="lineno">25</span><span class="comment" id="1709973">//&nbsp;nor&nbsp;deadlocks.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1709992">package</span>&nbsp;<span class="ident" id="1710000">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1710009">import</span>&nbsp;<span class="string" id="1710016">&#34;unsafe&#34;</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1710026">var</span>&nbsp;<span class="ident" id="1710030">sig</span>&nbsp;<span class="keyword" id="1710034">struct</span>&nbsp;<span class="op" id="1710041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710044">note</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1710051"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786244">note</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710057">mask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1710064">[</span><span class="op" id="1710065">(</span><span class="ident" id="1710066"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1800592">_NSIG</a></span>&nbsp;<span class="op" id="1710072">+</span>&nbsp;<span class="num" id="1710074">31</span><span class="op" id="1710076">)</span>&nbsp;<span class="op" id="1710078">/</span>&nbsp;<span class="num" id="1710080">32</span><span class="op" id="1710082">]</span><span class="builtintype" id="1710083">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710091">wanted</span>&nbsp;<span class="op" id="1710098">[</span><span class="op" id="1710099">(</span><span class="ident" id="1710100"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1800592">_NSIG</a></span>&nbsp;<span class="op" id="1710106">+</span>&nbsp;<span class="num" id="1710108">31</span><span class="op" id="1710110">)</span>&nbsp;<span class="op" id="1710112">/</span>&nbsp;<span class="num" id="1710114">32</span><span class="op" id="1710116">]</span><span class="builtintype" id="1710117">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710125">recv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1710132">[</span><span class="op" id="1710133">(</span><span class="ident" id="1710134"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1800592">_NSIG</a></span>&nbsp;<span class="op" id="1710140">+</span>&nbsp;<span class="num" id="1710142">31</span><span class="op" id="1710144">)</span>&nbsp;<span class="op" id="1710146">/</span>&nbsp;<span class="num" id="1710148">32</span><span class="op" id="1710150">]</span><span class="builtintype" id="1710151">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710159">state</span>&nbsp;&nbsp;<span class="builtintype" id="1710166">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710174">inuse</span>&nbsp;&nbsp;<span class="builtintype" id="1710181">bool</span><br>
<span class="lineno"></span><span class="op" id="1710186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1710189">const</span>&nbsp;<span class="op" id="1710195">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710198">sigIdle</span>&nbsp;<span class="op" id="1710206">=</span>&nbsp;<span class="ident" id="1710208">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710214">sigReceiving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710228">sigSending</span><br>
<span class="lineno"></span><span class="op" id="1710239">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1710242">//&nbsp;Called&nbsp;from&nbsp;sighandler&nbsp;to&nbsp;send&nbsp;a&nbsp;signal&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;signal&nbsp;handling&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1710325">//&nbsp;Reports&nbsp;whether&nbsp;the&nbsp;signal&nbsp;was&nbsp;sent.&nbsp;If&nbsp;not,&nbsp;the&nbsp;caller&nbsp;typically&nbsp;crashes&nbsp;the&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="1710415">func</span>&nbsp;<span class="ident" id="1710420">sigsend</span><span class="op" id="1710427">(</span><span class="ident" id="1710428">s</span>&nbsp;<span class="builtintype" id="1710430">int32</span><span class="op" id="1710435">)</span>&nbsp;<span class="builtintype" id="1710437">bool</span>&nbsp;<span class="op" id="1710442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710445">bit</span>&nbsp;<span class="op" id="1710449">:=</span>&nbsp;<span class="builtintype" id="1710452">uint32</span><span class="op" id="1710458">(</span><span class="num" id="1710459">1</span><span class="op" id="1710460">)</span>&nbsp;<span class="op" id="1710462">&lt;&lt;</span>&nbsp;<span class="builtintype" id="1710465">uint</span><span class="op" id="1710469">(</span><span class="ident" id="1710470"><a href="/gostd/runtime/sigqueue.go.html#1710428">s</a></span><span class="op" id="1710471">&amp;</span><span class="num" id="1710472">31</span><span class="op" id="1710474">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710477">if</span>&nbsp;<span class="op" id="1710480">!</span><span class="ident" id="1710481"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710484">.</span><span class="ident" id="1710485"><a href="/gostd/runtime/sigqueue.go.html#1710174">inuse</a></span>&nbsp;<span class="op" id="1710491">||</span>&nbsp;<span class="ident" id="1710494"><a href="/gostd/runtime/sigqueue.go.html#1710428">s</a></span>&nbsp;<span class="op" id="1710496">&lt;</span>&nbsp;<span class="num" id="1710498">0</span>&nbsp;<span class="op" id="1710500">||</span>&nbsp;<span class="builtintype" id="1710503">int</span><span class="op" id="1710506">(</span><span class="ident" id="1710507"><a href="/gostd/runtime/sigqueue.go.html#1710428">s</a></span><span class="op" id="1710508">)</span>&nbsp;<span class="op" id="1710510">&gt;=</span>&nbsp;<span class="num" id="1710513">32</span><span class="op" id="1710515">*</span><span class="builtinfunc" id="1710516">len</span><span class="op" id="1710519">(</span><span class="ident" id="1710520"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710523">.</span><span class="ident" id="1710524"><a href="/gostd/runtime/sigqueue.go.html#1710091">wanted</a></span><span class="op" id="1710530">)</span>&nbsp;<span class="op" id="1710532">||</span>&nbsp;<span class="ident" id="1710535"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710538">.</span><span class="ident" id="1710539"><a href="/gostd/runtime/sigqueue.go.html#1710091">wanted</a></span><span class="op" id="1710545">[</span><span class="ident" id="1710546"><a href="/gostd/runtime/sigqueue.go.html#1710428">s</a></span><span class="op" id="1710547">/</span><span class="num" id="1710548">32</span><span class="op" id="1710550">]</span><span class="op" id="1710551">&amp;</span><span class="ident" id="1710552"><a href="/gostd/runtime/sigqueue.go.html#1710445">bit</a></span>&nbsp;<span class="op" id="1710556">==</span>&nbsp;<span class="num" id="1710559">0</span>&nbsp;<span class="op" id="1710561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710565">return</span>&nbsp;<span class="builtintype" id="1710572">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1710579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1710583">//&nbsp;Add&nbsp;signal&nbsp;to&nbsp;outgoing&nbsp;queue.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710617">for</span>&nbsp;<span class="op" id="1710621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710625">mask</span>&nbsp;<span class="op" id="1710630">:=</span>&nbsp;<span class="ident" id="1710633"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710636">.</span><span class="ident" id="1710637"><a href="/gostd/runtime/sigqueue.go.html#1710057">mask</a></span><span class="op" id="1710641">[</span><span class="ident" id="1710642"><a href="/gostd/runtime/sigqueue.go.html#1710428">s</a></span><span class="op" id="1710643">/</span><span class="num" id="1710644">32</span><span class="op" id="1710646">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710650">if</span>&nbsp;<span class="ident" id="1710653"><a href="/gostd/runtime/sigqueue.go.html#1710625">mask</a></span><span class="op" id="1710657">&amp;</span><span class="ident" id="1710658"><a href="/gostd/runtime/sigqueue.go.html#1710445">bit</a></span>&nbsp;<span class="op" id="1710662">!=</span>&nbsp;<span class="num" id="1710665">0</span>&nbsp;<span class="op" id="1710667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710672">return</span>&nbsp;<span class="builtintype" id="1710679">true</span>&nbsp;<span class="comment" id="1710684">//&nbsp;signal&nbsp;already&nbsp;in&nbsp;queue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1710713">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710717">if</span>&nbsp;<span class="ident" id="1710720"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1710723">(</span><span class="op" id="1710724">&amp;</span><span class="ident" id="1710725"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710728">.</span><span class="ident" id="1710729"><a href="/gostd/runtime/sigqueue.go.html#1710057">mask</a></span><span class="op" id="1710733">[</span><span class="ident" id="1710734"><a href="/gostd/runtime/sigqueue.go.html#1710428">s</a></span><span class="op" id="1710735">/</span><span class="num" id="1710736">32</span><span class="op" id="1710738">]</span><span class="op" id="1710739">,</span>&nbsp;<span class="ident" id="1710741"><a href="/gostd/runtime/sigqueue.go.html#1710625">mask</a></span><span class="op" id="1710745">,</span>&nbsp;<span class="ident" id="1710747"><a href="/gostd/runtime/sigqueue.go.html#1710625">mask</a></span><span class="op" id="1710751">|</span><span class="ident" id="1710752"><a href="/gostd/runtime/sigqueue.go.html#1710445">bit</a></span><span class="op" id="1710755">)</span>&nbsp;<span class="op" id="1710757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710762">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1710770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1710773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1710777">//&nbsp;Notify&nbsp;receiver&nbsp;that&nbsp;queue&nbsp;has&nbsp;new&nbsp;bit.</span><br>
<span class="lineno"></span><span class="ident" id="1710820">Send</span><span class="op" id="1710824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710827">for</span>&nbsp;<span class="op" id="1710831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710835">switch</span>&nbsp;<span class="ident" id="1710842"><a href="/gostd/runtime/atomic.go.html#1481330">atomicload</a></span><span class="op" id="1710852">(</span><span class="op" id="1710853">&amp;</span><span class="ident" id="1710854"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710857">.</span><span class="ident" id="1710858"><a href="/gostd/runtime/sigqueue.go.html#1710159">state</a></span><span class="op" id="1710863">)</span>&nbsp;<span class="op" id="1710865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710869">default</span><span class="op" id="1710876">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1710881"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1710888">(</span><span class="string" id="1710889">&#34;sigsend:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="1710918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710922">case</span>&nbsp;<span class="ident" id="1710927"><a href="/gostd/runtime/sigqueue.go.html#1710198">sigIdle</a></span><span class="op" id="1710934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710939">if</span>&nbsp;<span class="ident" id="1710942"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1710945">(</span><span class="op" id="1710946">&amp;</span><span class="ident" id="1710947"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1710950">.</span><span class="ident" id="1710951"><a href="/gostd/runtime/sigqueue.go.html#1710159">state</a></span><span class="op" id="1710956">,</span>&nbsp;<span class="ident" id="1710958"><a href="/gostd/runtime/sigqueue.go.html#1710198">sigIdle</a></span><span class="op" id="1710965">,</span>&nbsp;<span class="ident" id="1710967"><a href="/gostd/runtime/sigqueue.go.html#1710228">sigSending</a></span><span class="op" id="1710977">)</span>&nbsp;<span class="op" id="1710979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1710985">break</span>&nbsp;<span class="ident" id="1710991"><a href="/gostd/runtime/sigqueue.go.html#1710820">Send</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1710999">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711003">case</span>&nbsp;<span class="ident" id="1711008"><a href="/gostd/runtime/sigqueue.go.html#1710228">sigSending</a></span><span class="op" id="1711018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1711023">//&nbsp;notification&nbsp;already&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711058">break</span>&nbsp;<span class="ident" id="1711064"><a href="/gostd/runtime/sigqueue.go.html#1710820">Send</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711071">case</span>&nbsp;<span class="ident" id="1711076"><a href="/gostd/runtime/sigqueue.go.html#1710214">sigReceiving</a></span><span class="op" id="1711088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711093">if</span>&nbsp;<span class="ident" id="1711096"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1711099">(</span><span class="op" id="1711100">&amp;</span><span class="ident" id="1711101"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711104">.</span><span class="ident" id="1711105"><a href="/gostd/runtime/sigqueue.go.html#1710159">state</a></span><span class="op" id="1711110">,</span>&nbsp;<span class="ident" id="1711112"><a href="/gostd/runtime/sigqueue.go.html#1710214">sigReceiving</a></span><span class="op" id="1711124">,</span>&nbsp;<span class="ident" id="1711126"><a href="/gostd/runtime/sigqueue.go.html#1710198">sigIdle</a></span><span class="op" id="1711133">)</span>&nbsp;<span class="op" id="1711135">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1711141"><a href="/gostd/runtime/lock_futex.go.html#1587128">notewakeup</a></span><span class="op" id="1711151">(</span><span class="op" id="1711152">&amp;</span><span class="ident" id="1711153"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711156">.</span><span class="ident" id="1711157"><a href="/gostd/runtime/sigqueue.go.html#1710044">note</a></span><span class="op" id="1711161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711167">break</span>&nbsp;<span class="ident" id="1711173"><a href="/gostd/runtime/sigqueue.go.html#1710820">Send</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711188">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711192">return</span>&nbsp;<span class="builtintype" id="1711199">true</span><br>
<span class="lineno"></span><span class="op" id="1711204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1711207">//&nbsp;Called&nbsp;to&nbsp;receive&nbsp;the&nbsp;next&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno">90</span><span class="comment" id="1711252">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1711310">func</span>&nbsp;<span class="ident" id="1711315">signal_recv</span><span class="op" id="1711326">(</span><span class="op" id="1711327">)</span>&nbsp;<span class="builtintype" id="1711329">uint32</span>&nbsp;<span class="op" id="1711336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711339">for</span>&nbsp;<span class="op" id="1711343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1711347">//&nbsp;Serve&nbsp;any&nbsp;signals&nbsp;from&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711387">for</span>&nbsp;<span class="ident" id="1711391">i</span>&nbsp;<span class="op" id="1711393">:=</span>&nbsp;<span class="builtintype" id="1711396">uint32</span><span class="op" id="1711402">(</span><span class="num" id="1711403">0</span><span class="op" id="1711404">)</span><span class="op" id="1711405">;</span>&nbsp;<span class="ident" id="1711407"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span>&nbsp;<span class="op" id="1711409">&lt;</span>&nbsp;<span class="ident" id="1711411"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1800592">_NSIG</a></span><span class="op" id="1711416">;</span>&nbsp;<span class="ident" id="1711418"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span><span class="op" id="1711419">++</span>&nbsp;<span class="op" id="1711422">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711427">if</span>&nbsp;<span class="ident" id="1711430"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711433">.</span><span class="ident" id="1711434"><a href="/gostd/runtime/sigqueue.go.html#1710125">recv</a></span><span class="op" id="1711438">[</span><span class="ident" id="1711439"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span><span class="op" id="1711440">/</span><span class="num" id="1711441">32</span><span class="op" id="1711443">]</span><span class="op" id="1711444">&amp;</span><span class="op" id="1711445">(</span><span class="num" id="1711446">1</span><span class="op" id="1711447">&lt;&lt;</span><span class="op" id="1711449">(</span><span class="ident" id="1711450"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span><span class="op" id="1711451">&amp;</span><span class="num" id="1711452">31</span><span class="op" id="1711454">)</span><span class="op" id="1711455">)</span>&nbsp;<span class="op" id="1711457">!=</span>&nbsp;<span class="num" id="1711460">0</span>&nbsp;<span class="op" id="1711462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1711468"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711471">.</span><span class="ident" id="1711472"><a href="/gostd/runtime/sigqueue.go.html#1710125">recv</a></span><span class="op" id="1711476">[</span><span class="ident" id="1711477"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span><span class="op" id="1711478">/</span><span class="num" id="1711479">32</span><span class="op" id="1711481">]</span>&nbsp;<span class="op" id="1711483">&amp;^=</span>&nbsp;<span class="num" id="1711487">1</span>&nbsp;<span class="op" id="1711489">&lt;&lt;</span>&nbsp;<span class="op" id="1711492">(</span><span class="ident" id="1711493"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span>&nbsp;<span class="op" id="1711495">&amp;</span>&nbsp;<span class="num" id="1711497">31</span><span class="op" id="1711499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711505">return</span>&nbsp;<span class="ident" id="1711512"><a href="/gostd/runtime/sigqueue.go.html#1711391">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711521">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1711526">//&nbsp;Wait&nbsp;for&nbsp;updates&nbsp;to&nbsp;be&nbsp;available&nbsp;from&nbsp;signal&nbsp;sender.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1711583">Receive</span><span class="op" id="1711590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711594">for</span>&nbsp;<span class="op" id="1711598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711603">switch</span>&nbsp;<span class="ident" id="1711610"><a href="/gostd/runtime/atomic.go.html#1481330">atomicload</a></span><span class="op" id="1711620">(</span><span class="op" id="1711621">&amp;</span><span class="ident" id="1711622"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711625">.</span><span class="ident" id="1711626"><a href="/gostd/runtime/sigqueue.go.html#1710159">state</a></span><span class="op" id="1711631">)</span>&nbsp;<span class="op" id="1711633">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711638">default</span><span class="op" id="1711645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1711651"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1711658">(</span><span class="string" id="1711659">&#34;signal_recv:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="1711692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711697">case</span>&nbsp;<span class="ident" id="1711702"><a href="/gostd/runtime/sigqueue.go.html#1710198">sigIdle</a></span><span class="op" id="1711709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711715">if</span>&nbsp;<span class="ident" id="1711718"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1711721">(</span><span class="op" id="1711722">&amp;</span><span class="ident" id="1711723"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711726">.</span><span class="ident" id="1711727"><a href="/gostd/runtime/sigqueue.go.html#1710159">state</a></span><span class="op" id="1711732">,</span>&nbsp;<span class="ident" id="1711734"><a href="/gostd/runtime/sigqueue.go.html#1710198">sigIdle</a></span><span class="op" id="1711741">,</span>&nbsp;<span class="ident" id="1711743"><a href="/gostd/runtime/sigqueue.go.html#1710214">sigReceiving</a></span><span class="op" id="1711755">)</span>&nbsp;<span class="op" id="1711757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1711764"><a href="/gostd/runtime/lock_futex.go.html#1588434">notetsleepg</a></span><span class="op" id="1711775">(</span><span class="op" id="1711776">&amp;</span><span class="ident" id="1711777"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711780">.</span><span class="ident" id="1711781"><a href="/gostd/runtime/sigqueue.go.html#1710044">note</a></span><span class="op" id="1711785">,</span>&nbsp;<span class="op" id="1711787">-</span><span class="num" id="1711788">1</span><span class="op" id="1711789">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1711796"><a href="/gostd/runtime/lock_futex.go.html#1587088">noteclear</a></span><span class="op" id="1711805">(</span><span class="op" id="1711806">&amp;</span><span class="ident" id="1711807"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711810">.</span><span class="ident" id="1711811"><a href="/gostd/runtime/sigqueue.go.html#1710044">note</a></span><span class="op" id="1711815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711822">break</span>&nbsp;<span class="ident" id="1711828"><a href="/gostd/runtime/sigqueue.go.html#1711583">Receive</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711845">case</span>&nbsp;<span class="ident" id="1711850"><a href="/gostd/runtime/sigqueue.go.html#1710228">sigSending</a></span><span class="op" id="1711860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711866">if</span>&nbsp;<span class="ident" id="1711869"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1711872">(</span><span class="op" id="1711873">&amp;</span><span class="ident" id="1711874"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1711877">.</span><span class="ident" id="1711878"><a href="/gostd/runtime/sigqueue.go.html#1710159">state</a></span><span class="op" id="1711883">,</span>&nbsp;<span class="ident" id="1711885"><a href="/gostd/runtime/sigqueue.go.html#1710228">sigSending</a></span><span class="op" id="1711895">,</span>&nbsp;<span class="ident" id="1711897"><a href="/gostd/runtime/sigqueue.go.html#1710198">sigIdle</a></span><span class="op" id="1711904">)</span>&nbsp;<span class="op" id="1711906">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711913">break</span>&nbsp;<span class="ident" id="1711919"><a href="/gostd/runtime/sigqueue.go.html#1711583">Receive</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1711940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1711945">//&nbsp;Incorporate&nbsp;updates&nbsp;from&nbsp;sender&nbsp;into&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1711999">for</span>&nbsp;<span class="ident" id="1712003">i</span>&nbsp;<span class="op" id="1712005">:=</span>&nbsp;<span class="keyword" id="1712008">range</span>&nbsp;<span class="ident" id="1712014"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712017">.</span><span class="ident" id="1712018"><a href="/gostd/runtime/sigqueue.go.html#1710057">mask</a></span>&nbsp;<span class="op" id="1712023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712028"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712031">.</span><span class="ident" id="1712032"><a href="/gostd/runtime/sigqueue.go.html#1710125">recv</a></span><span class="op" id="1712036">[</span><span class="ident" id="1712037"><a href="/gostd/runtime/sigqueue.go.html#1712003">i</a></span><span class="op" id="1712038">]</span>&nbsp;<span class="op" id="1712040">=</span>&nbsp;<span class="ident" id="1712042"><a href="/gostd/runtime/atomic.go.html#1481066">xchg</a></span><span class="op" id="1712046">(</span><span class="op" id="1712047">&amp;</span><span class="ident" id="1712048"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712051">.</span><span class="ident" id="1712052"><a href="/gostd/runtime/sigqueue.go.html#1710057">mask</a></span><span class="op" id="1712056">[</span><span class="ident" id="1712057"><a href="/gostd/runtime/sigqueue.go.html#1712003">i</a></span><span class="op" id="1712058">]</span><span class="op" id="1712059">,</span>&nbsp;<span class="num" id="1712061">0</span><span class="op" id="1712062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1712066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1712069">}</span><br>
<span class="lineno">125</span><span class="op" id="1712071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1712074">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1712132">func</span>&nbsp;<span class="ident" id="1712137">signal_enable</span><span class="op" id="1712150">(</span><span class="ident" id="1712151">s</span>&nbsp;<span class="builtintype" id="1712153">uint32</span><span class="op" id="1712159">)</span>&nbsp;<span class="op" id="1712161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1712164">if</span>&nbsp;<span class="op" id="1712167">!</span><span class="ident" id="1712168"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712171">.</span><span class="ident" id="1712172"><a href="/gostd/runtime/sigqueue.go.html#1710174">inuse</a></span>&nbsp;<span class="op" id="1712178">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1712182">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;signal_enable&nbsp;is&nbsp;for&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1712229">//&nbsp;to&nbsp;use&nbsp;for&nbsp;initialization.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;pass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1712279">//&nbsp;signal&nbsp;information&nbsp;in&nbsp;m.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712309"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712312">.</span><span class="ident" id="1712313"><a href="/gostd/runtime/sigqueue.go.html#1710174">inuse</a></span>&nbsp;<span class="op" id="1712319">=</span>&nbsp;<span class="builtintype" id="1712321">true</span>&nbsp;<span class="comment" id="1712326">//&nbsp;enable&nbsp;reception&nbsp;of&nbsp;signals;&nbsp;cannot&nbsp;disable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712375"><a href="/gostd/runtime/lock_futex.go.html#1587088">noteclear</a></span><span class="op" id="1712384">(</span><span class="op" id="1712385">&amp;</span><span class="ident" id="1712386"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712389">.</span><span class="ident" id="1712390"><a href="/gostd/runtime/sigqueue.go.html#1710044">note</a></span><span class="op" id="1712394">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1712398">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1712406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1712410">if</span>&nbsp;<span class="builtintype" id="1712413">int</span><span class="op" id="1712416">(</span><span class="ident" id="1712417"><a href="/gostd/runtime/sigqueue.go.html#1712151">s</a></span><span class="op" id="1712418">)</span>&nbsp;<span class="op" id="1712420">&gt;=</span>&nbsp;<span class="builtinfunc" id="1712423">len</span><span class="op" id="1712426">(</span><span class="ident" id="1712427"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712430">.</span><span class="ident" id="1712431"><a href="/gostd/runtime/sigqueue.go.html#1710091">wanted</a></span><span class="op" id="1712437">)</span><span class="op" id="1712438">*</span><span class="num" id="1712439">32</span>&nbsp;<span class="op" id="1712442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1712446">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1712454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712457"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712460">.</span><span class="ident" id="1712461"><a href="/gostd/runtime/sigqueue.go.html#1710091">wanted</a></span><span class="op" id="1712467">[</span><span class="ident" id="1712468"><a href="/gostd/runtime/sigqueue.go.html#1712151">s</a></span><span class="op" id="1712469">/</span><span class="num" id="1712470">32</span><span class="op" id="1712472">]</span>&nbsp;<span class="op" id="1712474">|=</span>&nbsp;<span class="num" id="1712477">1</span>&nbsp;<span class="op" id="1712479">&lt;&lt;</span>&nbsp;<span class="op" id="1712482">(</span><span class="ident" id="1712483"><a href="/gostd/runtime/sigqueue.go.html#1712151">s</a></span>&nbsp;<span class="op" id="1712485">&amp;</span>&nbsp;<span class="num" id="1712487">31</span><span class="op" id="1712489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712492"><a href="/gostd/runtime/sigqueue.go.html#1712965">sigenable_go</a></span><span class="op" id="1712504">(</span><span class="ident" id="1712505"><a href="/gostd/runtime/sigqueue.go.html#1712151">s</a></span><span class="op" id="1712506">)</span><br>
<span class="lineno"></span><span class="op" id="1712508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1712511">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1712569">func</span>&nbsp;<span class="ident" id="1712574">signal_disable</span><span class="op" id="1712588">(</span><span class="ident" id="1712589">s</span>&nbsp;<span class="builtintype" id="1712591">uint32</span><span class="op" id="1712597">)</span>&nbsp;<span class="op" id="1712599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1712602">if</span>&nbsp;<span class="builtintype" id="1712605">int</span><span class="op" id="1712608">(</span><span class="ident" id="1712609"><a href="/gostd/runtime/sigqueue.go.html#1712589">s</a></span><span class="op" id="1712610">)</span>&nbsp;<span class="op" id="1712612">&gt;=</span>&nbsp;<span class="builtinfunc" id="1712615">len</span><span class="op" id="1712618">(</span><span class="ident" id="1712619"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712622">.</span><span class="ident" id="1712623"><a href="/gostd/runtime/sigqueue.go.html#1710091">wanted</a></span><span class="op" id="1712629">)</span><span class="op" id="1712630">*</span><span class="num" id="1712631">32</span>&nbsp;<span class="op" id="1712634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1712638">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1712646">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712649"><a href="/gostd/runtime/sigqueue.go.html#1710030">sig</a></span><span class="op" id="1712652">.</span><span class="ident" id="1712653"><a href="/gostd/runtime/sigqueue.go.html#1710091">wanted</a></span><span class="op" id="1712659">[</span><span class="ident" id="1712660"><a href="/gostd/runtime/sigqueue.go.html#1712589">s</a></span><span class="op" id="1712661">/</span><span class="num" id="1712662">32</span><span class="op" id="1712664">]</span>&nbsp;<span class="op" id="1712666">&amp;^=</span>&nbsp;<span class="num" id="1712670">1</span>&nbsp;<span class="op" id="1712672">&lt;&lt;</span>&nbsp;<span class="op" id="1712675">(</span><span class="ident" id="1712676"><a href="/gostd/runtime/sigqueue.go.html#1712589">s</a></span>&nbsp;<span class="op" id="1712678">&amp;</span>&nbsp;<span class="num" id="1712680">31</span><span class="op" id="1712682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712685"><a href="/gostd/runtime/sigqueue.go.html#1713060">sigdisable_go</a></span><span class="op" id="1712698">(</span><span class="ident" id="1712699"><a href="/gostd/runtime/sigqueue.go.html#1712589">s</a></span><span class="op" id="1712700">)</span><br>
<span class="lineno"></span><span class="op" id="1712702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1712705">//&nbsp;This&nbsp;runs&nbsp;on&nbsp;a&nbsp;foreign&nbsp;stack,&nbsp;without&nbsp;an&nbsp;m&nbsp;or&nbsp;a&nbsp;g.&nbsp;&nbsp;No&nbsp;stack&nbsp;split.</span><br>
<span class="lineno">155</span><span class="comment" id="1712776">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1712789">func</span>&nbsp;<span class="ident" id="1712794">badsignal</span><span class="op" id="1712803">(</span><span class="ident" id="1712804">sig</span>&nbsp;<span class="builtintype" id="1712808">uintptr</span><span class="op" id="1712815">)</span>&nbsp;<span class="op" id="1712817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712820"><a href="/gostd/runtime/stubs.go.html#1743535">cgocallback</a></span><span class="op" id="1712831">(</span><span class="ident" id="1712832"><a href="/gostd/runtime/sigqueue.go.html#1710016">unsafe</a></span><span class="op" id="1712838">.</span><span class="ident" id="1712839">Pointer</span><span class="op" id="1712846">(</span><span class="ident" id="1712847"><a href="/gostd/runtime/proc.go.html#1675458">funcPC</a></span><span class="op" id="1712853">(</span><span class="ident" id="1712854"><a href="/gostd/runtime/sigqueue.go.html#1710420">sigsend</a></span><span class="op" id="1712861">)</span><span class="op" id="1712862">)</span><span class="op" id="1712863">,</span>&nbsp;<span class="ident" id="1712865"><a href="/gostd/runtime/stubs.go.html#1743320">noescape</a></span><span class="op" id="1712873">(</span><span class="ident" id="1712874"><a href="/gostd/runtime/sigqueue.go.html#1710016">unsafe</a></span><span class="op" id="1712880">.</span><span class="ident" id="1712881">Pointer</span><span class="op" id="1712888">(</span><span class="op" id="1712889">&amp;</span><span class="ident" id="1712890"><a href="/gostd/runtime/sigqueue.go.html#1712804">sig</a></span><span class="op" id="1712893">)</span><span class="op" id="1712894">)</span><span class="op" id="1712895">,</span>&nbsp;<span class="ident" id="1712897"><a href="/gostd/runtime/sigqueue.go.html#1710016">unsafe</a></span><span class="op" id="1712903">.</span><span class="ident" id="1712904">Sizeof</span><span class="op" id="1712910">(</span><span class="ident" id="1712911"><a href="/gostd/runtime/sigqueue.go.html#1712804">sig</a></span><span class="op" id="1712914">)</span><span class="op" id="1712915">)</span><br>
<span class="lineno"></span><span class="op" id="1712917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1712920">func</span>&nbsp;<span class="ident" id="1712925">sigenable_m</span><span class="op" id="1712936">(</span><span class="op" id="1712937">)</span><br>
<span class="lineno"></span><span class="keyword" id="1712939">func</span>&nbsp;<span class="ident" id="1712944">sigdisable_m</span><span class="op" id="1712956">(</span><span class="op" id="1712957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1712960">func</span>&nbsp;<span class="ident" id="1712965">sigenable_go</span><span class="op" id="1712977">(</span><span class="ident" id="1712978">s</span>&nbsp;<span class="builtintype" id="1712980">uint32</span><span class="op" id="1712986">)</span>&nbsp;<span class="op" id="1712988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1712991">g</span>&nbsp;<span class="op" id="1712993">:=</span>&nbsp;<span class="ident" id="1712996"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1713000">(</span><span class="op" id="1713001">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1713004"><a href="/gostd/runtime/sigqueue.go.html#1712991">g</a></span><span class="op" id="1713005">.</span><span class="ident" id="1713006"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1713007">.</span><span class="ident" id="1713008"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1713017">[</span><span class="num" id="1713018">0</span><span class="op" id="1713019">]</span>&nbsp;<span class="op" id="1713021">=</span>&nbsp;<span class="builtintype" id="1713023">uintptr</span><span class="op" id="1713030">(</span><span class="ident" id="1713031"><a href="/gostd/runtime/sigqueue.go.html#1712978">s</a></span><span class="op" id="1713032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1713035"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1713038">(</span><span class="ident" id="1713039"><a href="/gostd/runtime/sigqueue.go.html#1712925">sigenable_m</a></span><span class="op" id="1713050">)</span><br>
<span class="lineno"></span><span class="op" id="1713052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1713055">func</span>&nbsp;<span class="ident" id="1713060">sigdisable_go</span><span class="op" id="1713073">(</span><span class="ident" id="1713074">s</span>&nbsp;<span class="builtintype" id="1713076">uint32</span><span class="op" id="1713082">)</span>&nbsp;<span class="op" id="1713084">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1713087">g</span>&nbsp;<span class="op" id="1713089">:=</span>&nbsp;<span class="ident" id="1713092"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1713096">(</span><span class="op" id="1713097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1713100"><a href="/gostd/runtime/sigqueue.go.html#1713087">g</a></span><span class="op" id="1713101">.</span><span class="ident" id="1713102"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1713103">.</span><span class="ident" id="1713104"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1713113">[</span><span class="num" id="1713114">0</span><span class="op" id="1713115">]</span>&nbsp;<span class="op" id="1713117">=</span>&nbsp;<span class="builtintype" id="1713119">uintptr</span><span class="op" id="1713126">(</span><span class="ident" id="1713127"><a href="/gostd/runtime/sigqueue.go.html#1713074">s</a></span><span class="op" id="1713128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1713131"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1713134">(</span><span class="ident" id="1713135"><a href="/gostd/runtime/sigqueue.go.html#1712944">sigdisable_m</a></span><span class="op" id="1713147">)</span><br>
<span class="lineno"></span><span class="op" id="1713149">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
