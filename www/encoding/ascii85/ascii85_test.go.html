<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7901105">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7901160">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7901214">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7901265">package</span>&nbsp;<span class="ident" id="7901273">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7901282">import</span>&nbsp;<span class="op" id="7901289">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901292">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901301">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901307">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901320">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901331">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7901341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7901344">type</span>&nbsp;<span class="ident" id="7901349">testpair</span>&nbsp;<span class="keyword" id="7901358">struct</span>&nbsp;<span class="op" id="7901365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901368">decoded</span><span class="op" id="7901375">,</span>&nbsp;<span class="ident" id="7901377">encoded</span>&nbsp;<span class="builtintype" id="7901385">string</span><br>
<span class="lineno"></span><span class="op" id="7901392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7901395">var</span>&nbsp;<span class="ident" id="7901399">pairs</span>&nbsp;<span class="op" id="7901405">=</span>&nbsp;<span class="op" id="7901407">[</span><span class="op" id="7901408">]</span><span class="ident" id="7901409">testpair</span><span class="op" id="7901417">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901420">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901464">&#34;&#34;</span><span class="op" id="7901466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901470">&#34;&#34;</span><span class="op" id="7901472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901475">}</span><span class="op" id="7901476">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901479">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901505">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7901588">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901593">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7901677">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901682">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7901760">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901765">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7901800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901804">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7901882">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901887">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7901969">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901974">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7902054">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7902059">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7902139">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7902144">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7902187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902190">}</span><span class="op" id="7902191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7902194">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7902243">&#34;\000\000\000\000&#34;</span><span class="op" id="7902261">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7902265">&#34;z&#34;</span><span class="op" id="7902268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902271">}</span><span class="op" id="7902272">,</span><br>
<span class="lineno"></span><span class="op" id="7902274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7902277">var</span>&nbsp;<span class="ident" id="7902281">bigtest</span>&nbsp;<span class="op" id="7902289">=</span>&nbsp;<span class="ident" id="7902291">pairs</span><span class="op" id="7902296">[</span><span class="builtinfunc" id="7902297">len</span><span class="op" id="7902300">(</span><span class="ident" id="7902301">pairs</span><span class="op" id="7902306">)</span><span class="op" id="7902307">-</span><span class="num" id="7902308">1</span><span class="op" id="7902309">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7902312">func</span>&nbsp;<span class="ident" id="7902317">testEqual</span><span class="op" id="7902326">(</span><span class="ident" id="7902327">t</span>&nbsp;<span class="op" id="7902329">*</span><span class="ident" id="7902330">testing</span><span class="op" id="7902337">.</span><span class="ident" id="7902338">T</span><span class="op" id="7902339">,</span>&nbsp;<span class="ident" id="7902341">msg</span>&nbsp;<span class="builtintype" id="7902345">string</span><span class="op" id="7902351">,</span>&nbsp;<span class="ident" id="7902353">args</span>&nbsp;<span class="op" id="7902358">...</span><span class="keyword" id="7902361">interface</span><span class="op" id="7902370">{</span><span class="op" id="7902371">}</span><span class="op" id="7902372">)</span>&nbsp;<span class="builtintype" id="7902374">bool</span>&nbsp;<span class="op" id="7902379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902382">if</span>&nbsp;<span class="ident" id="7902385">args</span><span class="op" id="7902389">[</span><span class="builtinfunc" id="7902390">len</span><span class="op" id="7902393">(</span><span class="ident" id="7902394">args</span><span class="op" id="7902398">)</span><span class="op" id="7902399">-</span><span class="num" id="7902400">2</span><span class="op" id="7902401">]</span>&nbsp;<span class="op" id="7902403">!=</span>&nbsp;<span class="ident" id="7902406">args</span><span class="op" id="7902410">[</span><span class="builtinfunc" id="7902411">len</span><span class="op" id="7902414">(</span><span class="ident" id="7902415">args</span><span class="op" id="7902419">)</span><span class="op" id="7902420">-</span><span class="num" id="7902421">1</span><span class="op" id="7902422">]</span>&nbsp;<span class="op" id="7902424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902428">t</span><span class="op" id="7902429">.</span><span class="ident" id="7902430">Errorf</span><span class="op" id="7902436">(</span><span class="ident" id="7902437">msg</span><span class="op" id="7902440">,</span>&nbsp;<span class="ident" id="7902442">args</span><span class="op" id="7902446">...</span><span class="op" id="7902449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902453">return</span>&nbsp;<span class="ident" id="7902460">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902470">return</span>&nbsp;<span class="ident" id="7902477">true</span><br>
<span class="lineno"></span><span class="op" id="7902482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7902485">func</span>&nbsp;<span class="ident" id="7902490">strip85</span><span class="op" id="7902497">(</span><span class="ident" id="7902498">s</span>&nbsp;<span class="builtintype" id="7902500">string</span><span class="op" id="7902506">)</span>&nbsp;<span class="builtintype" id="7902508">string</span>&nbsp;<span class="op" id="7902515">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902518">t</span>&nbsp;<span class="op" id="7902520">:=</span>&nbsp;<span class="builtinfunc" id="7902523">make</span><span class="op" id="7902527">(</span><span class="op" id="7902528">[</span><span class="op" id="7902529">]</span><span class="builtintype" id="7902530">byte</span><span class="op" id="7902534">,</span>&nbsp;<span class="builtinfunc" id="7902536">len</span><span class="op" id="7902539">(</span><span class="ident" id="7902540">s</span><span class="op" id="7902541">)</span><span class="op" id="7902542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902545">w</span>&nbsp;<span class="op" id="7902547">:=</span>&nbsp;<span class="num" id="7902550">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902553">for</span>&nbsp;<span class="ident" id="7902557">r</span>&nbsp;<span class="op" id="7902559">:=</span>&nbsp;<span class="num" id="7902562">0</span><span class="op" id="7902563">;</span>&nbsp;<span class="ident" id="7902565">r</span>&nbsp;<span class="op" id="7902567">&lt;</span>&nbsp;<span class="builtinfunc" id="7902569">len</span><span class="op" id="7902572">(</span><span class="ident" id="7902573">s</span><span class="op" id="7902574">)</span><span class="op" id="7902575">;</span>&nbsp;<span class="ident" id="7902577">r</span><span class="op" id="7902578">++</span>&nbsp;<span class="op" id="7902581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902585">c</span>&nbsp;<span class="op" id="7902587">:=</span>&nbsp;<span class="ident" id="7902590">s</span><span class="op" id="7902591">[</span><span class="ident" id="7902592">r</span><span class="op" id="7902593">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902597">if</span>&nbsp;<span class="ident" id="7902600">c</span>&nbsp;<span class="op" id="7902602">&gt;</span>&nbsp;<span class="string" id="7902604">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7902608">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902613">t</span><span class="op" id="7902614">[</span><span class="ident" id="7902615">w</span><span class="op" id="7902616">]</span>&nbsp;<span class="op" id="7902618">=</span>&nbsp;<span class="ident" id="7902620">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902625">w</span><span class="op" id="7902626">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902637">return</span>&nbsp;<span class="builtintype" id="7902644">string</span><span class="op" id="7902650">(</span><span class="ident" id="7902651">t</span><span class="op" id="7902652">[</span><span class="num" id="7902653">0</span><span class="op" id="7902654">:</span><span class="ident" id="7902655">w</span><span class="op" id="7902656">]</span><span class="op" id="7902657">)</span><br>
<span class="lineno">65</span><span class="op" id="7902659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7902662">func</span>&nbsp;<span class="ident" id="7902667">TestEncode</span><span class="op" id="7902677">(</span><span class="ident" id="7902678">t</span>&nbsp;<span class="op" id="7902680">*</span><span class="ident" id="7902681">testing</span><span class="op" id="7902688">.</span><span class="ident" id="7902689">T</span><span class="op" id="7902690">)</span>&nbsp;<span class="op" id="7902692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902695">for</span>&nbsp;<span class="ident" id="7902699">_</span><span class="op" id="7902700">,</span>&nbsp;<span class="ident" id="7902702">p</span>&nbsp;<span class="op" id="7902704">:=</span>&nbsp;<span class="keyword" id="7902707">range</span>&nbsp;<span class="ident" id="7902713">pairs</span>&nbsp;<span class="op" id="7902719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902723">buf</span>&nbsp;<span class="op" id="7902727">:=</span>&nbsp;<span class="builtinfunc" id="7902730">make</span><span class="op" id="7902734">(</span><span class="op" id="7902735">[</span><span class="op" id="7902736">]</span><span class="builtintype" id="7902737">byte</span><span class="op" id="7902741">,</span>&nbsp;<span class="ident" id="7902743">MaxEncodedLen</span><span class="op" id="7902756">(</span><span class="builtinfunc" id="7902757">len</span><span class="op" id="7902760">(</span><span class="ident" id="7902761">p</span><span class="op" id="7902762">.</span><span class="ident" id="7902763">decoded</span><span class="op" id="7902770">)</span><span class="op" id="7902771">)</span><span class="op" id="7902772">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902776">n</span>&nbsp;<span class="op" id="7902778">:=</span>&nbsp;<span class="ident" id="7902781">Encode</span><span class="op" id="7902787">(</span><span class="ident" id="7902788">buf</span><span class="op" id="7902791">,</span>&nbsp;<span class="op" id="7902793">[</span><span class="op" id="7902794">]</span><span class="builtintype" id="7902795">byte</span><span class="op" id="7902799">(</span><span class="ident" id="7902800">p</span><span class="op" id="7902801">.</span><span class="ident" id="7902802">decoded</span><span class="op" id="7902809">)</span><span class="op" id="7902810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902814">buf</span>&nbsp;<span class="op" id="7902818">=</span>&nbsp;<span class="ident" id="7902820">buf</span><span class="op" id="7902823">[</span><span class="num" id="7902824">0</span><span class="op" id="7902825">:</span><span class="ident" id="7902826">n</span><span class="op" id="7902827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902831">testEqual</span><span class="op" id="7902840">(</span><span class="ident" id="7902841">t</span><span class="op" id="7902842">,</span>&nbsp;<span class="string" id="7902844">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7902870">,</span>&nbsp;<span class="ident" id="7902872">p</span><span class="op" id="7902873">.</span><span class="ident" id="7902874">decoded</span><span class="op" id="7902881">,</span>&nbsp;<span class="ident" id="7902883">strip85</span><span class="op" id="7902890">(</span><span class="builtintype" id="7902891">string</span><span class="op" id="7902897">(</span><span class="ident" id="7902898">buf</span><span class="op" id="7902901">)</span><span class="op" id="7902902">)</span><span class="op" id="7902903">,</span>&nbsp;<span class="ident" id="7902905">strip85</span><span class="op" id="7902912">(</span><span class="ident" id="7902913">p</span><span class="op" id="7902914">.</span><span class="ident" id="7902915">encoded</span><span class="op" id="7902922">)</span><span class="op" id="7902923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902926">}</span><br>
<span class="lineno"></span><span class="op" id="7902928">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7902931">func</span>&nbsp;<span class="ident" id="7902936">TestEncoder</span><span class="op" id="7902947">(</span><span class="ident" id="7902948">t</span>&nbsp;<span class="op" id="7902950">*</span><span class="ident" id="7902951">testing</span><span class="op" id="7902958">.</span><span class="ident" id="7902959">T</span><span class="op" id="7902960">)</span>&nbsp;<span class="op" id="7902962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902965">for</span>&nbsp;<span class="ident" id="7902969">_</span><span class="op" id="7902970">,</span>&nbsp;<span class="ident" id="7902972">p</span>&nbsp;<span class="op" id="7902974">:=</span>&nbsp;<span class="keyword" id="7902977">range</span>&nbsp;<span class="ident" id="7902983">pairs</span>&nbsp;<span class="op" id="7902989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902993">bb</span>&nbsp;<span class="op" id="7902996">:=</span>&nbsp;<span class="op" id="7902999">&amp;</span><span class="ident" id="7903000">bytes</span><span class="op" id="7903005">.</span><span class="ident" id="7903006">Buffer</span><span class="op" id="7903012">{</span><span class="op" id="7903013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903017">encoder</span>&nbsp;<span class="op" id="7903025">:=</span>&nbsp;<span class="ident" id="7903028">NewEncoder</span><span class="op" id="7903038">(</span><span class="ident" id="7903039">bb</span><span class="op" id="7903041">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903045">encoder</span><span class="op" id="7903052">.</span><span class="ident" id="7903053">Write</span><span class="op" id="7903058">(</span><span class="op" id="7903059">[</span><span class="op" id="7903060">]</span><span class="builtintype" id="7903061">byte</span><span class="op" id="7903065">(</span><span class="ident" id="7903066">p</span><span class="op" id="7903067">.</span><span class="ident" id="7903068">decoded</span><span class="op" id="7903075">)</span><span class="op" id="7903076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903080">encoder</span><span class="op" id="7903087">.</span><span class="ident" id="7903088">Close</span><span class="op" id="7903093">(</span><span class="op" id="7903094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903098">testEqual</span><span class="op" id="7903107">(</span><span class="ident" id="7903108">t</span><span class="op" id="7903109">,</span>&nbsp;<span class="string" id="7903111">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7903137">,</span>&nbsp;<span class="ident" id="7903139">p</span><span class="op" id="7903140">.</span><span class="ident" id="7903141">decoded</span><span class="op" id="7903148">,</span>&nbsp;<span class="ident" id="7903150">strip85</span><span class="op" id="7903157">(</span><span class="ident" id="7903158">bb</span><span class="op" id="7903160">.</span><span class="ident" id="7903161">String</span><span class="op" id="7903167">(</span><span class="op" id="7903168">)</span><span class="op" id="7903169">)</span><span class="op" id="7903170">,</span>&nbsp;<span class="ident" id="7903172">strip85</span><span class="op" id="7903179">(</span><span class="ident" id="7903180">p</span><span class="op" id="7903181">.</span><span class="ident" id="7903182">encoded</span><span class="op" id="7903189">)</span><span class="op" id="7903190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903193">}</span><br>
<span class="lineno"></span><span class="op" id="7903195">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7903198">func</span>&nbsp;<span class="ident" id="7903203">TestEncoderBuffering</span><span class="op" id="7903223">(</span><span class="ident" id="7903224">t</span>&nbsp;<span class="op" id="7903226">*</span><span class="ident" id="7903227">testing</span><span class="op" id="7903234">.</span><span class="ident" id="7903235">T</span><span class="op" id="7903236">)</span>&nbsp;<span class="op" id="7903238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903241">input</span>&nbsp;<span class="op" id="7903247">:=</span>&nbsp;<span class="op" id="7903250">[</span><span class="op" id="7903251">]</span><span class="builtintype" id="7903252">byte</span><span class="op" id="7903256">(</span><span class="ident" id="7903257">bigtest</span><span class="op" id="7903264">.</span><span class="ident" id="7903265">decoded</span><span class="op" id="7903272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903275">for</span>&nbsp;<span class="ident" id="7903279">bs</span>&nbsp;<span class="op" id="7903282">:=</span>&nbsp;<span class="num" id="7903285">1</span><span class="op" id="7903286">;</span>&nbsp;<span class="ident" id="7903288">bs</span>&nbsp;<span class="op" id="7903291">&lt;=</span>&nbsp;<span class="num" id="7903294">12</span><span class="op" id="7903296">;</span>&nbsp;<span class="ident" id="7903298">bs</span><span class="op" id="7903300">++</span>&nbsp;<span class="op" id="7903303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903307">bb</span>&nbsp;<span class="op" id="7903310">:=</span>&nbsp;<span class="op" id="7903313">&amp;</span><span class="ident" id="7903314">bytes</span><span class="op" id="7903319">.</span><span class="ident" id="7903320">Buffer</span><span class="op" id="7903326">{</span><span class="op" id="7903327">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903331">encoder</span>&nbsp;<span class="op" id="7903339">:=</span>&nbsp;<span class="ident" id="7903342">NewEncoder</span><span class="op" id="7903352">(</span><span class="ident" id="7903353">bb</span><span class="op" id="7903355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903359">for</span>&nbsp;<span class="ident" id="7903363">pos</span>&nbsp;<span class="op" id="7903367">:=</span>&nbsp;<span class="num" id="7903370">0</span><span class="op" id="7903371">;</span>&nbsp;<span class="ident" id="7903373">pos</span>&nbsp;<span class="op" id="7903377">&lt;</span>&nbsp;<span class="builtinfunc" id="7903379">len</span><span class="op" id="7903382">(</span><span class="ident" id="7903383">input</span><span class="op" id="7903388">)</span><span class="op" id="7903389">;</span>&nbsp;<span class="ident" id="7903391">pos</span>&nbsp;<span class="op" id="7903395">+=</span>&nbsp;<span class="ident" id="7903398">bs</span>&nbsp;<span class="op" id="7903401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903406">end</span>&nbsp;<span class="op" id="7903410">:=</span>&nbsp;<span class="ident" id="7903413">pos</span>&nbsp;<span class="op" id="7903417">+</span>&nbsp;<span class="ident" id="7903419">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903425">if</span>&nbsp;<span class="ident" id="7903428">end</span>&nbsp;<span class="op" id="7903432">&gt;</span>&nbsp;<span class="builtinfunc" id="7903434">len</span><span class="op" id="7903437">(</span><span class="ident" id="7903438">input</span><span class="op" id="7903443">)</span>&nbsp;<span class="op" id="7903445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903451">end</span>&nbsp;<span class="op" id="7903455">=</span>&nbsp;<span class="builtinfunc" id="7903457">len</span><span class="op" id="7903460">(</span><span class="ident" id="7903461">input</span><span class="op" id="7903466">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903476">n</span><span class="op" id="7903477">,</span>&nbsp;<span class="ident" id="7903479">err</span>&nbsp;<span class="op" id="7903483">:=</span>&nbsp;<span class="ident" id="7903486">encoder</span><span class="op" id="7903493">.</span><span class="ident" id="7903494">Write</span><span class="op" id="7903499">(</span><span class="ident" id="7903500">input</span><span class="op" id="7903505">[</span><span class="ident" id="7903506">pos</span><span class="op" id="7903509">:</span><span class="ident" id="7903510">end</span><span class="op" id="7903513">]</span><span class="op" id="7903514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903519">testEqual</span><span class="op" id="7903528">(</span><span class="ident" id="7903529">t</span><span class="op" id="7903530">,</span>&nbsp;<span class="string" id="7903532">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7903566">,</span>&nbsp;<span class="ident" id="7903568">input</span><span class="op" id="7903573">[</span><span class="ident" id="7903574">pos</span><span class="op" id="7903577">:</span><span class="ident" id="7903578">end</span><span class="op" id="7903581">]</span><span class="op" id="7903582">,</span>&nbsp;<span class="ident" id="7903584">err</span><span class="op" id="7903587">,</span>&nbsp;<span class="builtintype" id="7903589">error</span><span class="op" id="7903594">(</span><span class="ident" id="7903595">nil</span><span class="op" id="7903598">)</span><span class="op" id="7903599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903604">testEqual</span><span class="op" id="7903613">(</span><span class="ident" id="7903614">t</span><span class="op" id="7903615">,</span>&nbsp;<span class="string" id="7903617">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7903652">,</span>&nbsp;<span class="ident" id="7903654">input</span><span class="op" id="7903659">[</span><span class="ident" id="7903660">pos</span><span class="op" id="7903663">:</span><span class="ident" id="7903664">end</span><span class="op" id="7903667">]</span><span class="op" id="7903668">,</span>&nbsp;<span class="ident" id="7903670">n</span><span class="op" id="7903671">,</span>&nbsp;<span class="ident" id="7903673">end</span><span class="op" id="7903676">-</span><span class="ident" id="7903677">pos</span><span class="op" id="7903680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903684">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903688">err</span>&nbsp;<span class="op" id="7903692">:=</span>&nbsp;<span class="ident" id="7903695">encoder</span><span class="op" id="7903702">.</span><span class="ident" id="7903703">Close</span><span class="op" id="7903708">(</span><span class="op" id="7903709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903713">testEqual</span><span class="op" id="7903722">(</span><span class="ident" id="7903723">t</span><span class="op" id="7903724">,</span>&nbsp;<span class="string" id="7903726">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7903756">,</span>&nbsp;<span class="ident" id="7903758">err</span><span class="op" id="7903761">,</span>&nbsp;<span class="builtintype" id="7903763">error</span><span class="op" id="7903768">(</span><span class="ident" id="7903769">nil</span><span class="op" id="7903772">)</span><span class="op" id="7903773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903777">testEqual</span><span class="op" id="7903786">(</span><span class="ident" id="7903787">t</span><span class="op" id="7903788">,</span>&nbsp;<span class="string" id="7903790">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7903823">,</span>&nbsp;<span class="ident" id="7903825">bs</span><span class="op" id="7903827">,</span>&nbsp;<span class="ident" id="7903829">bigtest</span><span class="op" id="7903836">.</span><span class="ident" id="7903837">decoded</span><span class="op" id="7903844">,</span>&nbsp;<span class="ident" id="7903846">strip85</span><span class="op" id="7903853">(</span><span class="ident" id="7903854">bb</span><span class="op" id="7903856">.</span><span class="ident" id="7903857">String</span><span class="op" id="7903863">(</span><span class="op" id="7903864">)</span><span class="op" id="7903865">)</span><span class="op" id="7903866">,</span>&nbsp;<span class="ident" id="7903868">strip85</span><span class="op" id="7903875">(</span><span class="ident" id="7903876">bigtest</span><span class="op" id="7903883">.</span><span class="ident" id="7903884">encoded</span><span class="op" id="7903891">)</span><span class="op" id="7903892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903895">}</span><br>
<span class="lineno"></span><span class="op" id="7903897">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7903900">func</span>&nbsp;<span class="ident" id="7903905">TestDecode</span><span class="op" id="7903915">(</span><span class="ident" id="7903916">t</span>&nbsp;<span class="op" id="7903918">*</span><span class="ident" id="7903919">testing</span><span class="op" id="7903926">.</span><span class="ident" id="7903927">T</span><span class="op" id="7903928">)</span>&nbsp;<span class="op" id="7903930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903933">for</span>&nbsp;<span class="ident" id="7903937">_</span><span class="op" id="7903938">,</span>&nbsp;<span class="ident" id="7903940">p</span>&nbsp;<span class="op" id="7903942">:=</span>&nbsp;<span class="keyword" id="7903945">range</span>&nbsp;<span class="ident" id="7903951">pairs</span>&nbsp;<span class="op" id="7903957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903961">dbuf</span>&nbsp;<span class="op" id="7903966">:=</span>&nbsp;<span class="builtinfunc" id="7903969">make</span><span class="op" id="7903973">(</span><span class="op" id="7903974">[</span><span class="op" id="7903975">]</span><span class="builtintype" id="7903976">byte</span><span class="op" id="7903980">,</span>&nbsp;<span class="num" id="7903982">4</span><span class="op" id="7903983">*</span><span class="builtinfunc" id="7903984">len</span><span class="op" id="7903987">(</span><span class="ident" id="7903988">p</span><span class="op" id="7903989">.</span><span class="ident" id="7903990">encoded</span><span class="op" id="7903997">)</span><span class="op" id="7903998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904002">ndst</span><span class="op" id="7904006">,</span>&nbsp;<span class="ident" id="7904008">nsrc</span><span class="op" id="7904012">,</span>&nbsp;<span class="ident" id="7904014">err</span>&nbsp;<span class="op" id="7904018">:=</span>&nbsp;<span class="ident" id="7904021">Decode</span><span class="op" id="7904027">(</span><span class="ident" id="7904028">dbuf</span><span class="op" id="7904032">,</span>&nbsp;<span class="op" id="7904034">[</span><span class="op" id="7904035">]</span><span class="builtintype" id="7904036">byte</span><span class="op" id="7904040">(</span><span class="ident" id="7904041">p</span><span class="op" id="7904042">.</span><span class="ident" id="7904043">encoded</span><span class="op" id="7904050">)</span><span class="op" id="7904051">,</span>&nbsp;<span class="ident" id="7904053">true</span><span class="op" id="7904057">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904061">testEqual</span><span class="op" id="7904070">(</span><span class="ident" id="7904071">t</span><span class="op" id="7904072">,</span>&nbsp;<span class="string" id="7904074">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7904106">,</span>&nbsp;<span class="ident" id="7904108">p</span><span class="op" id="7904109">.</span><span class="ident" id="7904110">encoded</span><span class="op" id="7904117">,</span>&nbsp;<span class="ident" id="7904119">err</span><span class="op" id="7904122">,</span>&nbsp;<span class="builtintype" id="7904124">error</span><span class="op" id="7904129">(</span><span class="ident" id="7904130">nil</span><span class="op" id="7904133">)</span><span class="op" id="7904134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904138">testEqual</span><span class="op" id="7904147">(</span><span class="ident" id="7904148">t</span><span class="op" id="7904149">,</span>&nbsp;<span class="string" id="7904151">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7904182">,</span>&nbsp;<span class="ident" id="7904184">p</span><span class="op" id="7904185">.</span><span class="ident" id="7904186">encoded</span><span class="op" id="7904193">,</span>&nbsp;<span class="ident" id="7904195">nsrc</span><span class="op" id="7904199">,</span>&nbsp;<span class="builtinfunc" id="7904201">len</span><span class="op" id="7904204">(</span><span class="ident" id="7904205">p</span><span class="op" id="7904206">.</span><span class="ident" id="7904207">encoded</span><span class="op" id="7904214">)</span><span class="op" id="7904215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904219">testEqual</span><span class="op" id="7904228">(</span><span class="ident" id="7904229">t</span><span class="op" id="7904230">,</span>&nbsp;<span class="string" id="7904232">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7904263">,</span>&nbsp;<span class="ident" id="7904265">p</span><span class="op" id="7904266">.</span><span class="ident" id="7904267">encoded</span><span class="op" id="7904274">,</span>&nbsp;<span class="ident" id="7904276">ndst</span><span class="op" id="7904280">,</span>&nbsp;<span class="builtinfunc" id="7904282">len</span><span class="op" id="7904285">(</span><span class="ident" id="7904286">p</span><span class="op" id="7904287">.</span><span class="ident" id="7904288">decoded</span><span class="op" id="7904295">)</span><span class="op" id="7904296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904300">testEqual</span><span class="op" id="7904309">(</span><span class="ident" id="7904310">t</span><span class="op" id="7904311">,</span>&nbsp;<span class="string" id="7904313">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7904339">,</span>&nbsp;<span class="ident" id="7904341">p</span><span class="op" id="7904342">.</span><span class="ident" id="7904343">encoded</span><span class="op" id="7904350">,</span>&nbsp;<span class="builtintype" id="7904352">string</span><span class="op" id="7904358">(</span><span class="ident" id="7904359">dbuf</span><span class="op" id="7904363">[</span><span class="num" id="7904364">0</span><span class="op" id="7904365">:</span><span class="ident" id="7904366">ndst</span><span class="op" id="7904370">]</span><span class="op" id="7904371">)</span><span class="op" id="7904372">,</span>&nbsp;<span class="ident" id="7904374">p</span><span class="op" id="7904375">.</span><span class="ident" id="7904376">decoded</span><span class="op" id="7904383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904386">}</span><br>
<span class="lineno">115</span><span class="op" id="7904388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7904391">func</span>&nbsp;<span class="ident" id="7904396">TestDecoder</span><span class="op" id="7904407">(</span><span class="ident" id="7904408">t</span>&nbsp;<span class="op" id="7904410">*</span><span class="ident" id="7904411">testing</span><span class="op" id="7904418">.</span><span class="ident" id="7904419">T</span><span class="op" id="7904420">)</span>&nbsp;<span class="op" id="7904422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904425">for</span>&nbsp;<span class="ident" id="7904429">_</span><span class="op" id="7904430">,</span>&nbsp;<span class="ident" id="7904432">p</span>&nbsp;<span class="op" id="7904434">:=</span>&nbsp;<span class="keyword" id="7904437">range</span>&nbsp;<span class="ident" id="7904443">pairs</span>&nbsp;<span class="op" id="7904449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904453">decoder</span>&nbsp;<span class="op" id="7904461">:=</span>&nbsp;<span class="ident" id="7904464">NewDecoder</span><span class="op" id="7904474">(</span><span class="ident" id="7904475">strings</span><span class="op" id="7904482">.</span><span class="ident" id="7904483">NewReader</span><span class="op" id="7904492">(</span><span class="ident" id="7904493">p</span><span class="op" id="7904494">.</span><span class="ident" id="7904495">encoded</span><span class="op" id="7904502">)</span><span class="op" id="7904503">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904507">dbuf</span><span class="op" id="7904511">,</span>&nbsp;<span class="ident" id="7904513">err</span>&nbsp;<span class="op" id="7904517">:=</span>&nbsp;<span class="ident" id="7904520">ioutil</span><span class="op" id="7904526">.</span><span class="ident" id="7904527">ReadAll</span><span class="op" id="7904534">(</span><span class="ident" id="7904535">decoder</span><span class="op" id="7904542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904546">if</span>&nbsp;<span class="ident" id="7904549">err</span>&nbsp;<span class="op" id="7904553">!=</span>&nbsp;<span class="ident" id="7904556">nil</span>&nbsp;<span class="op" id="7904560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904565">t</span><span class="op" id="7904566">.</span><span class="ident" id="7904567">Fatal</span><span class="op" id="7904572">(</span><span class="string" id="7904573">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7904586">,</span>&nbsp;<span class="ident" id="7904588">err</span><span class="op" id="7904591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904599">testEqual</span><span class="op" id="7904608">(</span><span class="ident" id="7904609">t</span><span class="op" id="7904610">,</span>&nbsp;<span class="string" id="7904612">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7904647">,</span>&nbsp;<span class="ident" id="7904649">p</span><span class="op" id="7904650">.</span><span class="ident" id="7904651">encoded</span><span class="op" id="7904658">,</span>&nbsp;<span class="builtinfunc" id="7904660">len</span><span class="op" id="7904663">(</span><span class="ident" id="7904664">dbuf</span><span class="op" id="7904668">)</span><span class="op" id="7904669">,</span>&nbsp;<span class="builtinfunc" id="7904671">len</span><span class="op" id="7904674">(</span><span class="ident" id="7904675">p</span><span class="op" id="7904676">.</span><span class="ident" id="7904677">decoded</span><span class="op" id="7904684">)</span><span class="op" id="7904685">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904689">testEqual</span><span class="op" id="7904698">(</span><span class="ident" id="7904699">t</span><span class="op" id="7904700">,</span>&nbsp;<span class="string" id="7904702">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7904732">,</span>&nbsp;<span class="ident" id="7904734">p</span><span class="op" id="7904735">.</span><span class="ident" id="7904736">encoded</span><span class="op" id="7904743">,</span>&nbsp;<span class="builtintype" id="7904745">string</span><span class="op" id="7904751">(</span><span class="ident" id="7904752">dbuf</span><span class="op" id="7904756">)</span><span class="op" id="7904757">,</span>&nbsp;<span class="ident" id="7904759">p</span><span class="op" id="7904760">.</span><span class="ident" id="7904761">decoded</span><span class="op" id="7904768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904772">if</span>&nbsp;<span class="ident" id="7904775">err</span>&nbsp;<span class="op" id="7904779">!=</span>&nbsp;<span class="ident" id="7904782">nil</span>&nbsp;<span class="op" id="7904786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904791">testEqual</span><span class="op" id="7904800">(</span><span class="ident" id="7904801">t</span><span class="op" id="7904802">,</span>&nbsp;<span class="string" id="7904804">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7904832">,</span>&nbsp;<span class="ident" id="7904834">p</span><span class="op" id="7904835">.</span><span class="ident" id="7904836">encoded</span><span class="op" id="7904843">,</span>&nbsp;<span class="ident" id="7904845">err</span><span class="op" id="7904848">,</span>&nbsp;<span class="ident" id="7904850">io</span><span class="op" id="7904852">.</span><span class="ident" id="7904853">EOF</span><span class="op" id="7904856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904863">}</span><br>
<span class="lineno">130</span><span class="op" id="7904865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7904868">func</span>&nbsp;<span class="ident" id="7904873">TestDecoderBuffering</span><span class="op" id="7904893">(</span><span class="ident" id="7904894">t</span>&nbsp;<span class="op" id="7904896">*</span><span class="ident" id="7904897">testing</span><span class="op" id="7904904">.</span><span class="ident" id="7904905">T</span><span class="op" id="7904906">)</span>&nbsp;<span class="op" id="7904908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904911">for</span>&nbsp;<span class="ident" id="7904915">bs</span>&nbsp;<span class="op" id="7904918">:=</span>&nbsp;<span class="num" id="7904921">1</span><span class="op" id="7904922">;</span>&nbsp;<span class="ident" id="7904924">bs</span>&nbsp;<span class="op" id="7904927">&lt;=</span>&nbsp;<span class="num" id="7904930">12</span><span class="op" id="7904932">;</span>&nbsp;<span class="ident" id="7904934">bs</span><span class="op" id="7904936">++</span>&nbsp;<span class="op" id="7904939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904943">decoder</span>&nbsp;<span class="op" id="7904951">:=</span>&nbsp;<span class="ident" id="7904954">NewDecoder</span><span class="op" id="7904964">(</span><span class="ident" id="7904965">strings</span><span class="op" id="7904972">.</span><span class="ident" id="7904973">NewReader</span><span class="op" id="7904982">(</span><span class="ident" id="7904983">bigtest</span><span class="op" id="7904990">.</span><span class="ident" id="7904991">encoded</span><span class="op" id="7904998">)</span><span class="op" id="7904999">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905003">buf</span>&nbsp;<span class="op" id="7905007">:=</span>&nbsp;<span class="builtinfunc" id="7905010">make</span><span class="op" id="7905014">(</span><span class="op" id="7905015">[</span><span class="op" id="7905016">]</span><span class="builtintype" id="7905017">byte</span><span class="op" id="7905021">,</span>&nbsp;<span class="builtinfunc" id="7905023">len</span><span class="op" id="7905026">(</span><span class="ident" id="7905027">bigtest</span><span class="op" id="7905034">.</span><span class="ident" id="7905035">decoded</span><span class="op" id="7905042">)</span><span class="op" id="7905043">+</span><span class="num" id="7905044">12</span><span class="op" id="7905046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905050">var</span>&nbsp;<span class="ident" id="7905054">total</span>&nbsp;<span class="builtintype" id="7905060">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905066">for</span>&nbsp;<span class="ident" id="7905070">total</span>&nbsp;<span class="op" id="7905076">=</span>&nbsp;<span class="num" id="7905078">0</span><span class="op" id="7905079">;</span>&nbsp;<span class="ident" id="7905081">total</span>&nbsp;<span class="op" id="7905087">&lt;</span>&nbsp;<span class="builtinfunc" id="7905089">len</span><span class="op" id="7905092">(</span><span class="ident" id="7905093">bigtest</span><span class="op" id="7905100">.</span><span class="ident" id="7905101">decoded</span><span class="op" id="7905108">)</span><span class="op" id="7905109">;</span>&nbsp;<span class="op" id="7905111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905116">n</span><span class="op" id="7905117">,</span>&nbsp;<span class="ident" id="7905119">err</span>&nbsp;<span class="op" id="7905123">:=</span>&nbsp;<span class="ident" id="7905126">decoder</span><span class="op" id="7905133">.</span><span class="ident" id="7905134">Read</span><span class="op" id="7905138">(</span><span class="ident" id="7905139">buf</span><span class="op" id="7905142">[</span><span class="ident" id="7905143">total</span>&nbsp;<span class="op" id="7905149">:</span>&nbsp;<span class="ident" id="7905151">total</span><span class="op" id="7905156">+</span><span class="ident" id="7905157">bs</span><span class="op" id="7905159">]</span><span class="op" id="7905160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905165">testEqual</span><span class="op" id="7905174">(</span><span class="ident" id="7905175">t</span><span class="op" id="7905176">,</span>&nbsp;<span class="string" id="7905178">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7905223">,</span>&nbsp;<span class="ident" id="7905225">bigtest</span><span class="op" id="7905232">.</span><span class="ident" id="7905233">encoded</span><span class="op" id="7905240">,</span>&nbsp;<span class="ident" id="7905242">total</span><span class="op" id="7905247">,</span>&nbsp;<span class="ident" id="7905249">n</span><span class="op" id="7905250">,</span>&nbsp;<span class="ident" id="7905252">err</span><span class="op" id="7905255">,</span>&nbsp;<span class="builtintype" id="7905257">error</span><span class="op" id="7905262">(</span><span class="ident" id="7905263">nil</span><span class="op" id="7905266">)</span><span class="op" id="7905267">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905272">total</span>&nbsp;<span class="op" id="7905278">+=</span>&nbsp;<span class="ident" id="7905281">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905289">testEqual</span><span class="op" id="7905298">(</span><span class="ident" id="7905299">t</span><span class="op" id="7905300">,</span>&nbsp;<span class="string" id="7905302">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7905335">,</span>&nbsp;<span class="ident" id="7905337">bs</span><span class="op" id="7905339">,</span>&nbsp;<span class="ident" id="7905341">bigtest</span><span class="op" id="7905348">.</span><span class="ident" id="7905349">encoded</span><span class="op" id="7905356">,</span>&nbsp;<span class="builtintype" id="7905358">string</span><span class="op" id="7905364">(</span><span class="ident" id="7905365">buf</span><span class="op" id="7905368">[</span><span class="num" id="7905369">0</span><span class="op" id="7905370">:</span><span class="ident" id="7905371">total</span><span class="op" id="7905376">]</span><span class="op" id="7905377">)</span><span class="op" id="7905378">,</span>&nbsp;<span class="ident" id="7905380">bigtest</span><span class="op" id="7905387">.</span><span class="ident" id="7905388">decoded</span><span class="op" id="7905395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905398">}</span><br>
<span class="lineno"></span><span class="op" id="7905400">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7905403">func</span>&nbsp;<span class="ident" id="7905408">TestDecodeCorrupt</span><span class="op" id="7905425">(</span><span class="ident" id="7905426">t</span>&nbsp;<span class="op" id="7905428">*</span><span class="ident" id="7905429">testing</span><span class="op" id="7905436">.</span><span class="ident" id="7905437">T</span><span class="op" id="7905438">)</span>&nbsp;<span class="op" id="7905440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905443">type</span>&nbsp;<span class="ident" id="7905448">corrupt</span>&nbsp;<span class="keyword" id="7905456">struct</span>&nbsp;<span class="op" id="7905463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905467">e</span>&nbsp;<span class="builtintype" id="7905469">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905478">p</span>&nbsp;<span class="builtintype" id="7905480">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905488">examples</span>&nbsp;<span class="op" id="7905497">:=</span>&nbsp;<span class="op" id="7905500">[</span><span class="op" id="7905501">]</span><span class="ident" id="7905502">corrupt</span><span class="op" id="7905509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905513">{</span><span class="string" id="7905514">&#34;v&#34;</span><span class="op" id="7905517">,</span>&nbsp;<span class="num" id="7905519">0</span><span class="op" id="7905520">}</span><span class="op" id="7905521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905525">{</span><span class="string" id="7905526">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7905539">,</span>&nbsp;<span class="num" id="7905541">1</span><span class="op" id="7905542">}</span><span class="op" id="7905543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905546">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905550">for</span>&nbsp;<span class="ident" id="7905554">_</span><span class="op" id="7905555">,</span>&nbsp;<span class="ident" id="7905557">e</span>&nbsp;<span class="op" id="7905559">:=</span>&nbsp;<span class="keyword" id="7905562">range</span>&nbsp;<span class="ident" id="7905568">examples</span>&nbsp;<span class="op" id="7905577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905581">dbuf</span>&nbsp;<span class="op" id="7905586">:=</span>&nbsp;<span class="builtinfunc" id="7905589">make</span><span class="op" id="7905593">(</span><span class="op" id="7905594">[</span><span class="op" id="7905595">]</span><span class="builtintype" id="7905596">byte</span><span class="op" id="7905600">,</span>&nbsp;<span class="num" id="7905602">4</span><span class="op" id="7905603">*</span><span class="builtinfunc" id="7905604">len</span><span class="op" id="7905607">(</span><span class="ident" id="7905608">e</span><span class="op" id="7905609">.</span><span class="ident" id="7905610">e</span><span class="op" id="7905611">)</span><span class="op" id="7905612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905616">_</span><span class="op" id="7905617">,</span>&nbsp;<span class="ident" id="7905619">_</span><span class="op" id="7905620">,</span>&nbsp;<span class="ident" id="7905622">err</span>&nbsp;<span class="op" id="7905626">:=</span>&nbsp;<span class="ident" id="7905629">Decode</span><span class="op" id="7905635">(</span><span class="ident" id="7905636">dbuf</span><span class="op" id="7905640">,</span>&nbsp;<span class="op" id="7905642">[</span><span class="op" id="7905643">]</span><span class="builtintype" id="7905644">byte</span><span class="op" id="7905648">(</span><span class="ident" id="7905649">e</span><span class="op" id="7905650">.</span><span class="ident" id="7905651">e</span><span class="op" id="7905652">)</span><span class="op" id="7905653">,</span>&nbsp;<span class="ident" id="7905655">true</span><span class="op" id="7905659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905663">switch</span>&nbsp;<span class="ident" id="7905670">err</span>&nbsp;<span class="op" id="7905674">:=</span>&nbsp;<span class="ident" id="7905677">err</span><span class="op" id="7905680">.</span><span class="op" id="7905681">(</span><span class="keyword" id="7905682">type</span><span class="op" id="7905686">)</span>&nbsp;<span class="op" id="7905688">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905692">case</span>&nbsp;<span class="ident" id="7905697">CorruptInputError</span><span class="op" id="7905714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905719">testEqual</span><span class="op" id="7905728">(</span><span class="ident" id="7905729">t</span><span class="op" id="7905730">,</span>&nbsp;<span class="string" id="7905732">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7905772">,</span>&nbsp;<span class="ident" id="7905774">e</span><span class="op" id="7905775">.</span><span class="ident" id="7905776">e</span><span class="op" id="7905777">,</span>&nbsp;<span class="builtintype" id="7905779">int</span><span class="op" id="7905782">(</span><span class="ident" id="7905783">err</span><span class="op" id="7905786">)</span><span class="op" id="7905787">,</span>&nbsp;<span class="ident" id="7905789">e</span><span class="op" id="7905790">.</span><span class="ident" id="7905791">p</span><span class="op" id="7905792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905796">default</span><span class="op" id="7905803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905808">t</span><span class="op" id="7905809">.</span><span class="ident" id="7905810">Error</span><span class="op" id="7905815">(</span><span class="string" id="7905816">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7905856">,</span>&nbsp;<span class="ident" id="7905858">e</span><span class="op" id="7905859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905863">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905866">}</span><br>
<span class="lineno"></span><span class="op" id="7905868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7905871">func</span>&nbsp;<span class="ident" id="7905876">TestBig</span><span class="op" id="7905883">(</span><span class="ident" id="7905884">t</span>&nbsp;<span class="op" id="7905886">*</span><span class="ident" id="7905887">testing</span><span class="op" id="7905894">.</span><span class="ident" id="7905895">T</span><span class="op" id="7905896">)</span>&nbsp;<span class="op" id="7905898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905901">n</span>&nbsp;<span class="op" id="7905903">:=</span>&nbsp;<span class="num" id="7905906">3</span><span class="op" id="7905907">*</span><span class="num" id="7905908">1000</span>&nbsp;<span class="op" id="7905913">+</span>&nbsp;<span class="num" id="7905915">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905918">raw</span>&nbsp;<span class="op" id="7905922">:=</span>&nbsp;<span class="builtinfunc" id="7905925">make</span><span class="op" id="7905929">(</span><span class="op" id="7905930">[</span><span class="op" id="7905931">]</span><span class="builtintype" id="7905932">byte</span><span class="op" id="7905936">,</span>&nbsp;<span class="ident" id="7905938">n</span><span class="op" id="7905939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905942">const</span>&nbsp;<span class="ident" id="7905948">alpha</span>&nbsp;<span class="op" id="7905954">=</span>&nbsp;<span class="string" id="7905956">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906022">for</span>&nbsp;<span class="ident" id="7906026">i</span>&nbsp;<span class="op" id="7906028">:=</span>&nbsp;<span class="num" id="7906031">0</span><span class="op" id="7906032">;</span>&nbsp;<span class="ident" id="7906034">i</span>&nbsp;<span class="op" id="7906036">&lt;</span>&nbsp;<span class="ident" id="7906038">n</span><span class="op" id="7906039">;</span>&nbsp;<span class="ident" id="7906041">i</span><span class="op" id="7906042">++</span>&nbsp;<span class="op" id="7906045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906049">raw</span><span class="op" id="7906052">[</span><span class="ident" id="7906053">i</span><span class="op" id="7906054">]</span>&nbsp;<span class="op" id="7906056">=</span>&nbsp;<span class="ident" id="7906058">alpha</span><span class="op" id="7906063">[</span><span class="ident" id="7906064">i</span><span class="op" id="7906065">%</span><span class="builtinfunc" id="7906066">len</span><span class="op" id="7906069">(</span><span class="ident" id="7906070">alpha</span><span class="op" id="7906075">)</span><span class="op" id="7906076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906079">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906082">encoded</span>&nbsp;<span class="op" id="7906090">:=</span>&nbsp;<span class="builtinfunc" id="7906093">new</span><span class="op" id="7906096">(</span><span class="ident" id="7906097">bytes</span><span class="op" id="7906102">.</span><span class="ident" id="7906103">Buffer</span><span class="op" id="7906109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906112">w</span>&nbsp;<span class="op" id="7906114">:=</span>&nbsp;<span class="ident" id="7906117">NewEncoder</span><span class="op" id="7906127">(</span><span class="ident" id="7906128">encoded</span><span class="op" id="7906135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906138">nn</span><span class="op" id="7906140">,</span>&nbsp;<span class="ident" id="7906142">err</span>&nbsp;<span class="op" id="7906146">:=</span>&nbsp;<span class="ident" id="7906149">w</span><span class="op" id="7906150">.</span><span class="ident" id="7906151">Write</span><span class="op" id="7906156">(</span><span class="ident" id="7906157">raw</span><span class="op" id="7906160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906163">if</span>&nbsp;<span class="ident" id="7906166">nn</span>&nbsp;<span class="op" id="7906169">!=</span>&nbsp;<span class="ident" id="7906172">n</span>&nbsp;<span class="op" id="7906174">||</span>&nbsp;<span class="ident" id="7906177">err</span>&nbsp;<span class="op" id="7906181">!=</span>&nbsp;<span class="ident" id="7906184">nil</span>&nbsp;<span class="op" id="7906188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906192">t</span><span class="op" id="7906193">.</span><span class="ident" id="7906194">Fatalf</span><span class="op" id="7906200">(</span><span class="string" id="7906201">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7906243">,</span>&nbsp;<span class="ident" id="7906245">nn</span><span class="op" id="7906247">,</span>&nbsp;<span class="ident" id="7906249">err</span><span class="op" id="7906252">,</span>&nbsp;<span class="ident" id="7906254">n</span><span class="op" id="7906255">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906261">err</span>&nbsp;<span class="op" id="7906265">=</span>&nbsp;<span class="ident" id="7906267">w</span><span class="op" id="7906268">.</span><span class="ident" id="7906269">Close</span><span class="op" id="7906274">(</span><span class="op" id="7906275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906278">if</span>&nbsp;<span class="ident" id="7906281">err</span>&nbsp;<span class="op" id="7906285">!=</span>&nbsp;<span class="ident" id="7906288">nil</span>&nbsp;<span class="op" id="7906292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906296">t</span><span class="op" id="7906297">.</span><span class="ident" id="7906298">Fatalf</span><span class="op" id="7906304">(</span><span class="string" id="7906305">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7906336">,</span>&nbsp;<span class="ident" id="7906338">err</span><span class="op" id="7906341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906344">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906347">decoded</span><span class="op" id="7906354">,</span>&nbsp;<span class="ident" id="7906356">err</span>&nbsp;<span class="op" id="7906360">:=</span>&nbsp;<span class="ident" id="7906363">ioutil</span><span class="op" id="7906369">.</span><span class="ident" id="7906370">ReadAll</span><span class="op" id="7906377">(</span><span class="ident" id="7906378">NewDecoder</span><span class="op" id="7906388">(</span><span class="ident" id="7906389">encoded</span><span class="op" id="7906396">)</span><span class="op" id="7906397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906400">if</span>&nbsp;<span class="ident" id="7906403">err</span>&nbsp;<span class="op" id="7906407">!=</span>&nbsp;<span class="ident" id="7906410">nil</span>&nbsp;<span class="op" id="7906414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906418">t</span><span class="op" id="7906419">.</span><span class="ident" id="7906420">Fatalf</span><span class="op" id="7906426">(</span><span class="string" id="7906427">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7906460">,</span>&nbsp;<span class="ident" id="7906462">err</span><span class="op" id="7906465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906472">if</span>&nbsp;<span class="op" id="7906475">!</span><span class="ident" id="7906476">bytes</span><span class="op" id="7906481">.</span><span class="ident" id="7906482">Equal</span><span class="op" id="7906487">(</span><span class="ident" id="7906488">raw</span><span class="op" id="7906491">,</span>&nbsp;<span class="ident" id="7906493">decoded</span><span class="op" id="7906500">)</span>&nbsp;<span class="op" id="7906502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906506">var</span>&nbsp;<span class="ident" id="7906510">i</span>&nbsp;<span class="builtintype" id="7906512">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906518">for</span>&nbsp;<span class="ident" id="7906522">i</span>&nbsp;<span class="op" id="7906524">=</span>&nbsp;<span class="num" id="7906526">0</span><span class="op" id="7906527">;</span>&nbsp;<span class="ident" id="7906529">i</span>&nbsp;<span class="op" id="7906531">&lt;</span>&nbsp;<span class="builtinfunc" id="7906533">len</span><span class="op" id="7906536">(</span><span class="ident" id="7906537">decoded</span><span class="op" id="7906544">)</span>&nbsp;<span class="op" id="7906546">&amp;&amp;</span>&nbsp;<span class="ident" id="7906549">i</span>&nbsp;<span class="op" id="7906551">&lt;</span>&nbsp;<span class="builtinfunc" id="7906553">len</span><span class="op" id="7906556">(</span><span class="ident" id="7906557">raw</span><span class="op" id="7906560">)</span><span class="op" id="7906561">;</span>&nbsp;<span class="ident" id="7906563">i</span><span class="op" id="7906564">++</span>&nbsp;<span class="op" id="7906567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906572">if</span>&nbsp;<span class="ident" id="7906575">decoded</span><span class="op" id="7906582">[</span><span class="ident" id="7906583">i</span><span class="op" id="7906584">]</span>&nbsp;<span class="op" id="7906586">!=</span>&nbsp;<span class="ident" id="7906589">raw</span><span class="op" id="7906592">[</span><span class="ident" id="7906593">i</span><span class="op" id="7906594">]</span>&nbsp;<span class="op" id="7906596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906602">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906619">t</span><span class="op" id="7906620">.</span><span class="ident" id="7906621">Errorf</span><span class="op" id="7906627">(</span><span class="string" id="7906628">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7906680">,</span>&nbsp;<span class="ident" id="7906682">n</span><span class="op" id="7906683">,</span>&nbsp;<span class="ident" id="7906685">i</span><span class="op" id="7906686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906689">}</span><br>
<span class="lineno"></span><span class="op" id="7906691">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7906694">func</span>&nbsp;<span class="ident" id="7906699">TestDecoderInternalWhitespace</span><span class="op" id="7906728">(</span><span class="ident" id="7906729">t</span>&nbsp;<span class="op" id="7906731">*</span><span class="ident" id="7906732">testing</span><span class="op" id="7906739">.</span><span class="ident" id="7906740">T</span><span class="op" id="7906741">)</span>&nbsp;<span class="op" id="7906743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906746">s</span>&nbsp;<span class="op" id="7906748">:=</span>&nbsp;<span class="ident" id="7906751">strings</span><span class="op" id="7906758">.</span><span class="ident" id="7906759">Repeat</span><span class="op" id="7906765">(</span><span class="string" id="7906766">&#34;&nbsp;&#34;</span><span class="op" id="7906769">,</span>&nbsp;<span class="num" id="7906771">2048</span><span class="op" id="7906775">)</span>&nbsp;<span class="op" id="7906777">+</span>&nbsp;<span class="string" id="7906779">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906784">decoded</span><span class="op" id="7906791">,</span>&nbsp;<span class="ident" id="7906793">err</span>&nbsp;<span class="op" id="7906797">:=</span>&nbsp;<span class="ident" id="7906800">ioutil</span><span class="op" id="7906806">.</span><span class="ident" id="7906807">ReadAll</span><span class="op" id="7906814">(</span><span class="ident" id="7906815">NewDecoder</span><span class="op" id="7906825">(</span><span class="ident" id="7906826">strings</span><span class="op" id="7906833">.</span><span class="ident" id="7906834">NewReader</span><span class="op" id="7906843">(</span><span class="ident" id="7906844">s</span><span class="op" id="7906845">)</span><span class="op" id="7906846">)</span><span class="op" id="7906847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906850">if</span>&nbsp;<span class="ident" id="7906853">err</span>&nbsp;<span class="op" id="7906857">!=</span>&nbsp;<span class="ident" id="7906860">nil</span>&nbsp;<span class="op" id="7906864">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906868">t</span><span class="op" id="7906869">.</span><span class="ident" id="7906870">Errorf</span><span class="op" id="7906876">(</span><span class="string" id="7906877">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7906899">,</span>&nbsp;<span class="ident" id="7906901">err</span><span class="op" id="7906904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906910">if</span>&nbsp;<span class="ident" id="7906913">want</span>&nbsp;<span class="op" id="7906918">:=</span>&nbsp;<span class="op" id="7906921">[</span><span class="op" id="7906922">]</span><span class="builtintype" id="7906923">byte</span><span class="op" id="7906927">(</span><span class="string" id="7906928">&#34;\000\000\000\000&#34;</span><span class="op" id="7906946">)</span><span class="op" id="7906947">;</span>&nbsp;<span class="op" id="7906949">!</span><span class="ident" id="7906950">bytes</span><span class="op" id="7906955">.</span><span class="ident" id="7906956">Equal</span><span class="op" id="7906961">(</span><span class="ident" id="7906962">want</span><span class="op" id="7906966">,</span>&nbsp;<span class="ident" id="7906968">decoded</span><span class="op" id="7906975">)</span>&nbsp;<span class="op" id="7906977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906981">t</span><span class="op" id="7906982">.</span><span class="ident" id="7906983">Errorf</span><span class="op" id="7906989">(</span><span class="string" id="7906990">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7907022">,</span>&nbsp;<span class="ident" id="7907024">decoded</span><span class="op" id="7907031">,</span>&nbsp;<span class="ident" id="7907033">want</span><span class="op" id="7907037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907040">}</span><br>
<span class="lineno">210</span><span class="op" id="7907042">}</span>
</div>
</body>
</html>
