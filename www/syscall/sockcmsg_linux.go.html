<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2276293">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2276349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2276403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2276454">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2276482">package</span>&nbsp;<span class="ident" id="2276490">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2276499">import</span>&nbsp;<span class="string" id="2276506">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2276516">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2276585">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2276641">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2276660">func</span>&nbsp;<span class="ident" id="2276665">UnixCredentials</span><span class="op" id="2276680">(</span><span class="ident" id="2276681">ucred</span>&nbsp;<span class="op" id="2276687">*</span><span class="ident" id="2276688">Ucred</span><span class="op" id="2276693">)</span>&nbsp;<span class="op" id="2276695">[</span><span class="op" id="2276696">]</span><span class="builtintype" id="2276697">byte</span>&nbsp;<span class="op" id="2276702">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276705">b</span>&nbsp;<span class="op" id="2276707">:=</span>&nbsp;<span class="builtinfunc" id="2276710">make</span><span class="op" id="2276714">(</span><span class="op" id="2276715">[</span><span class="op" id="2276716">]</span><span class="builtintype" id="2276717">byte</span><span class="op" id="2276721">,</span>&nbsp;<span class="ident" id="2276723">CmsgSpace</span><span class="op" id="2276732">(</span><span class="ident" id="2276733">SizeofUcred</span><span class="op" id="2276744">)</span><span class="op" id="2276745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276748">h</span>&nbsp;<span class="op" id="2276750">:=</span>&nbsp;<span class="op" id="2276753">(</span><span class="op" id="2276754">*</span><span class="ident" id="2276755">Cmsghdr</span><span class="op" id="2276762">)</span><span class="op" id="2276763">(</span><span class="ident" id="2276764">unsafe</span><span class="op" id="2276770">.</span><span class="ident" id="2276771">Pointer</span><span class="op" id="2276778">(</span><span class="op" id="2276779">&amp;</span><span class="ident" id="2276780">b</span><span class="op" id="2276781">[</span><span class="num" id="2276782">0</span><span class="op" id="2276783">]</span><span class="op" id="2276784">)</span><span class="op" id="2276785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276788">h</span><span class="op" id="2276789">.</span><span class="ident" id="2276790">Level</span>&nbsp;<span class="op" id="2276796">=</span>&nbsp;<span class="ident" id="2276798">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276810">h</span><span class="op" id="2276811">.</span><span class="ident" id="2276812">Type</span>&nbsp;<span class="op" id="2276817">=</span>&nbsp;<span class="ident" id="2276819">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276836">h</span><span class="op" id="2276837">.</span><span class="ident" id="2276838">SetLen</span><span class="op" id="2276844">(</span><span class="ident" id="2276845">CmsgLen</span><span class="op" id="2276852">(</span><span class="ident" id="2276853">SizeofUcred</span><span class="op" id="2276864">)</span><span class="op" id="2276865">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276868">*</span><span class="op" id="2276869">(</span><span class="op" id="2276870">(</span><span class="op" id="2276871">*</span><span class="ident" id="2276872">Ucred</span><span class="op" id="2276877">)</span><span class="op" id="2276878">(</span><span class="ident" id="2276879">cmsgData</span><span class="op" id="2276887">(</span><span class="ident" id="2276888">h</span><span class="op" id="2276889">)</span><span class="op" id="2276890">)</span><span class="op" id="2276891">)</span>&nbsp;<span class="op" id="2276893">=</span>&nbsp;<span class="op" id="2276895">*</span><span class="ident" id="2276896">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276903">return</span>&nbsp;<span class="ident" id="2276910">b</span><br>
<span class="lineno"></span><span class="op" id="2276912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2276915">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2276986">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2277054">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2277107">func</span>&nbsp;<span class="ident" id="2277112">ParseUnixCredentials</span><span class="op" id="2277132">(</span><span class="ident" id="2277133">m</span>&nbsp;<span class="op" id="2277135">*</span><span class="ident" id="2277136">SocketControlMessage</span><span class="op" id="2277156">)</span>&nbsp;<span class="op" id="2277158">(</span><span class="op" id="2277159">*</span><span class="ident" id="2277160">Ucred</span><span class="op" id="2277165">,</span>&nbsp;<span class="builtintype" id="2277167">error</span><span class="op" id="2277172">)</span>&nbsp;<span class="op" id="2277174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277177">if</span>&nbsp;<span class="ident" id="2277180">m</span><span class="op" id="2277181">.</span><span class="ident" id="2277182">Header</span><span class="op" id="2277188">.</span><span class="ident" id="2277189">Level</span>&nbsp;<span class="op" id="2277195">!=</span>&nbsp;<span class="ident" id="2277198">SOL_SOCKET</span>&nbsp;<span class="op" id="2277209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277213">return</span>&nbsp;<span class="ident" id="2277220">nil</span><span class="op" id="2277223">,</span>&nbsp;<span class="ident" id="2277225">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277236">if</span>&nbsp;<span class="ident" id="2277239">m</span><span class="op" id="2277240">.</span><span class="ident" id="2277241">Header</span><span class="op" id="2277247">.</span><span class="ident" id="2277248">Type</span>&nbsp;<span class="op" id="2277253">!=</span>&nbsp;<span class="ident" id="2277256">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2277272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277276">return</span>&nbsp;<span class="ident" id="2277283">nil</span><span class="op" id="2277286">,</span>&nbsp;<span class="ident" id="2277288">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277299">ucred</span>&nbsp;<span class="op" id="2277305">:=</span>&nbsp;<span class="op" id="2277308">*</span><span class="op" id="2277309">(</span><span class="op" id="2277310">*</span><span class="ident" id="2277311">Ucred</span><span class="op" id="2277316">)</span><span class="op" id="2277317">(</span><span class="ident" id="2277318">unsafe</span><span class="op" id="2277324">.</span><span class="ident" id="2277325">Pointer</span><span class="op" id="2277332">(</span><span class="op" id="2277333">&amp;</span><span class="ident" id="2277334">m</span><span class="op" id="2277335">.</span><span class="ident" id="2277336">Data</span><span class="op" id="2277340">[</span><span class="num" id="2277341">0</span><span class="op" id="2277342">]</span><span class="op" id="2277343">)</span><span class="op" id="2277344">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277347">return</span>&nbsp;<span class="op" id="2277354">&amp;</span><span class="ident" id="2277355">ucred</span><span class="op" id="2277360">,</span>&nbsp;<span class="ident" id="2277362">nil</span><br>
<span class="lineno"></span><span class="op" id="2277366">}</span>
</div>
</body>
</html>
