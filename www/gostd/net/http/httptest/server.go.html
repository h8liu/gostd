<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html" class="current">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6133589">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6133644">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6133698">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6133749">//&nbsp;Implementation&nbsp;of&nbsp;Server</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6133778">package</span>&nbsp;<span class="ident" id="6133786">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6133796">import</span>&nbsp;<span class="op" id="6133803">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133806">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133820">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133828">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133835">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133842">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133854">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133860">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6133867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6133870">//&nbsp;A&nbsp;Server&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;listening&nbsp;on&nbsp;a&nbsp;system-chosen&nbsp;port&nbsp;on&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="6133941">//&nbsp;local&nbsp;loopback&nbsp;interface,&nbsp;for&nbsp;use&nbsp;in&nbsp;end-to-end&nbsp;HTTP&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6134004">type</span>&nbsp;<span class="ident" id="6134009">Server</span>&nbsp;<span class="keyword" id="6134016">struct</span>&nbsp;<span class="op" id="6134023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134026">URL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6134035">string</span>&nbsp;<span class="comment" id="6134042">//&nbsp;base&nbsp;URL&nbsp;of&nbsp;form&nbsp;http://ipaddr:port&nbsp;with&nbsp;no&nbsp;trailing&nbsp;slash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134105">Listener</span>&nbsp;<span class="ident" id="6134114"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6134117">.</span><span class="ident" id="6134118"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134129">//&nbsp;TLS&nbsp;is&nbsp;the&nbsp;optional&nbsp;TLS&nbsp;configuration,&nbsp;populated&nbsp;with&nbsp;a&nbsp;new&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134200">//&nbsp;after&nbsp;TLS&nbsp;is&nbsp;started.&nbsp;If&nbsp;set&nbsp;on&nbsp;an&nbsp;unstarted&nbsp;server&nbsp;before&nbsp;StartTLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134272">//&nbsp;is&nbsp;called,&nbsp;existing&nbsp;fields&nbsp;are&nbsp;copied&nbsp;into&nbsp;the&nbsp;new&nbsp;config.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134335">TLS</span>&nbsp;<span class="op" id="6134339">*</span><span class="ident" id="6134340"><a href="/gostd/net/http/httptest/server.go.html#6133806">tls</a></span><span class="op" id="6134343">.</span><span class="ident" id="6134344"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134353">//&nbsp;Config&nbsp;may&nbsp;be&nbsp;changed&nbsp;after&nbsp;calling&nbsp;NewUnstartedServer&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134416">//&nbsp;before&nbsp;Start&nbsp;or&nbsp;StartTLS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134446">Config</span>&nbsp;<span class="op" id="6134453">*</span><span class="ident" id="6134454"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6134458">.</span><span class="ident" id="6134459"><a href="/gostd/net/http/server.go.html#4216561">Server</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134468">//&nbsp;wg&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;outstanding&nbsp;HTTP&nbsp;requests&nbsp;on&nbsp;this&nbsp;server.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134538">//&nbsp;Close&nbsp;blocks&nbsp;until&nbsp;all&nbsp;requests&nbsp;are&nbsp;finished.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134588">wg</span>&nbsp;<span class="ident" id="6134591"><a href="/gostd/net/http/httptest/server.go.html#6133860">sync</a></span><span class="op" id="6134595">.</span><span class="ident" id="6134596"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span><span class="op" id="6134606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6134609">//&nbsp;historyListener&nbsp;keeps&nbsp;track&nbsp;of&nbsp;all&nbsp;connections&nbsp;that&nbsp;it&#39;s&nbsp;ever</span><br>
<span class="lineno">40</span><span class="comment" id="6134674">//&nbsp;accepted.</span><br>
<span class="lineno"></span><span class="keyword" id="6134687">type</span>&nbsp;<span class="ident" id="6134692">historyListener</span>&nbsp;<span class="keyword" id="6134708">struct</span>&nbsp;<span class="op" id="6134715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134718"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6134721">.</span><span class="ident" id="6134722"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134732"><a href="/gostd/net/http/httptest/server.go.html#6133860">sync</a></span><span class="op" id="6134736">.</span><span class="ident" id="6134737"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="6134743">//&nbsp;protects&nbsp;history</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134764">history</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134775">[</span><span class="op" id="6134776">]</span><span class="ident" id="6134777"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6134780">.</span><span class="ident" id="6134781"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno">45</span><span class="op" id="6134786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6134789">func</span>&nbsp;<span class="op" id="6134794">(</span><span class="ident" id="6134795">hs</span>&nbsp;<span class="op" id="6134798">*</span><span class="ident" id="6134799"><a href="/gostd/net/http/httptest/server.go.html#6134692">historyListener</a></span><span class="op" id="6134814">)</span>&nbsp;<span class="ident" id="6134816">Accept</span><span class="op" id="6134822">(</span><span class="op" id="6134823">)</span>&nbsp;<span class="op" id="6134825">(</span><span class="ident" id="6134826">c</span>&nbsp;<span class="ident" id="6134828"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6134831">.</span><span class="ident" id="6134832"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6134836">,</span>&nbsp;<span class="ident" id="6134838">err</span>&nbsp;<span class="builtintype" id="6134842">error</span><span class="op" id="6134847">)</span>&nbsp;<span class="op" id="6134849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134852"><a href="/gostd/net/http/httptest/server.go.html#6134826">c</a></span><span class="op" id="6134853">,</span>&nbsp;<span class="ident" id="6134855"><a href="/gostd/net/http/httptest/server.go.html#6134838">err</a></span>&nbsp;<span class="op" id="6134859">=</span>&nbsp;<span class="ident" id="6134861"><a href="/gostd/net/http/httptest/server.go.html#6134795">hs</a></span><span class="op" id="6134863">.</span><span class="ident" id="6134864"><a href="/gostd/net/http/httptest/server.go.html#6134718">Listener</a></span><span class="op" id="6134872">.</span><span class="ident" id="6134873"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6134879">(</span><span class="op" id="6134880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134883">if</span>&nbsp;<span class="ident" id="6134886"><a href="/gostd/net/http/httptest/server.go.html#6134838">err</a></span>&nbsp;<span class="op" id="6134890">==</span>&nbsp;<span class="builtintype" id="6134893">nil</span>&nbsp;<span class="op" id="6134897">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134901"><a href="/gostd/net/http/httptest/server.go.html#6134795">hs</a></span><span class="op" id="6134903">.</span><span class="ident" id="6134904"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6134908">(</span><span class="op" id="6134909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134913"><a href="/gostd/net/http/httptest/server.go.html#6134795">hs</a></span><span class="op" id="6134915">.</span><span class="ident" id="6134916"><a href="/gostd/net/http/httptest/server.go.html#6134764">history</a></span>&nbsp;<span class="op" id="6134924">=</span>&nbsp;<span class="builtinfunc" id="6134926">append</span><span class="op" id="6134932">(</span><span class="ident" id="6134933"><a href="/gostd/net/http/httptest/server.go.html#6134795">hs</a></span><span class="op" id="6134935">.</span><span class="ident" id="6134936"><a href="/gostd/net/http/httptest/server.go.html#6134764">history</a></span><span class="op" id="6134943">,</span>&nbsp;<span class="ident" id="6134945"><a href="/gostd/net/http/httptest/server.go.html#6134826">c</a></span><span class="op" id="6134946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134950"><a href="/gostd/net/http/httptest/server.go.html#6134795">hs</a></span><span class="op" id="6134952">.</span><span class="ident" id="6134953"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6134959">(</span><span class="op" id="6134960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134966">return</span><br>
<span class="lineno">55</span><span class="op" id="6134973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6134976">func</span>&nbsp;<span class="ident" id="6134981">newLocalListener</span><span class="op" id="6134997">(</span><span class="op" id="6134998">)</span>&nbsp;<span class="ident" id="6135000"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6135003">.</span><span class="ident" id="6135004"><a href="/gostd/net/net.go.html#3340703">Listener</a></span>&nbsp;<span class="op" id="6135013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135016">if</span>&nbsp;<span class="op" id="6135019">*</span><span class="ident" id="6135020"><a href="/gostd/net/http/httptest/server.go.html#6135604">serve</a></span>&nbsp;<span class="op" id="6135026">!=</span>&nbsp;<span class="string" id="6135029">&#34;&#34;</span>&nbsp;<span class="op" id="6135032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135036">l</span><span class="op" id="6135037">,</span>&nbsp;<span class="ident" id="6135039">err</span>&nbsp;<span class="op" id="6135043">:=</span>&nbsp;<span class="ident" id="6135046"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6135049">.</span><span class="ident" id="6135050"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6135056">(</span><span class="string" id="6135057">&#34;tcp&#34;</span><span class="op" id="6135062">,</span>&nbsp;<span class="op" id="6135064">*</span><span class="ident" id="6135065"><a href="/gostd/net/http/httptest/server.go.html#6135604">serve</a></span><span class="op" id="6135070">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135074">if</span>&nbsp;<span class="ident" id="6135077"><a href="/gostd/net/http/httptest/server.go.html#6135039">err</a></span>&nbsp;<span class="op" id="6135081">!=</span>&nbsp;<span class="builtintype" id="6135084">nil</span>&nbsp;<span class="op" id="6135088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6135093">panic</span><span class="op" id="6135098">(</span><span class="ident" id="6135099"><a href="/gostd/net/http/httptest/server.go.html#6133828">fmt</a></span><span class="op" id="6135102">.</span><span class="ident" id="6135103"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="6135110">(</span><span class="string" id="6135111">&#34;httptest:&nbsp;failed&nbsp;to&nbsp;listen&nbsp;on&nbsp;%v:&nbsp;%v&#34;</span><span class="op" id="6135149">,</span>&nbsp;<span class="op" id="6135151">*</span><span class="ident" id="6135152"><a href="/gostd/net/http/httptest/server.go.html#6135604">serve</a></span><span class="op" id="6135157">,</span>&nbsp;<span class="ident" id="6135159"><a href="/gostd/net/http/httptest/server.go.html#6135039">err</a></span><span class="op" id="6135162">)</span><span class="op" id="6135163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135171">return</span>&nbsp;<span class="ident" id="6135178"><a href="/gostd/net/http/httptest/server.go.html#6135036">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135181">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135184">l</span><span class="op" id="6135185">,</span>&nbsp;<span class="ident" id="6135187">err</span>&nbsp;<span class="op" id="6135191">:=</span>&nbsp;<span class="ident" id="6135194"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6135197">.</span><span class="ident" id="6135198"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6135204">(</span><span class="string" id="6135205">&#34;tcp&#34;</span><span class="op" id="6135210">,</span>&nbsp;<span class="string" id="6135212">&#34;127.0.0.1:0&#34;</span><span class="op" id="6135225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135228">if</span>&nbsp;<span class="ident" id="6135231"><a href="/gostd/net/http/httptest/server.go.html#6135187">err</a></span>&nbsp;<span class="op" id="6135235">!=</span>&nbsp;<span class="builtintype" id="6135238">nil</span>&nbsp;<span class="op" id="6135242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135246">if</span>&nbsp;<span class="ident" id="6135249"><a href="/gostd/net/http/httptest/server.go.html#6135184">l</a></span><span class="op" id="6135250">,</span>&nbsp;<span class="ident" id="6135252"><a href="/gostd/net/http/httptest/server.go.html#6135187">err</a></span>&nbsp;<span class="op" id="6135256">=</span>&nbsp;<span class="ident" id="6135258"><a href="/gostd/net/http/httptest/server.go.html#6133835">net</a></span><span class="op" id="6135261">.</span><span class="ident" id="6135262"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6135268">(</span><span class="string" id="6135269">&#34;tcp6&#34;</span><span class="op" id="6135275">,</span>&nbsp;<span class="string" id="6135277">&#34;[::1]:0&#34;</span><span class="op" id="6135286">)</span><span class="op" id="6135287">;</span>&nbsp;<span class="ident" id="6135289"><a href="/gostd/net/http/httptest/server.go.html#6135187">err</a></span>&nbsp;<span class="op" id="6135293">!=</span>&nbsp;<span class="builtintype" id="6135296">nil</span>&nbsp;<span class="op" id="6135300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6135305">panic</span><span class="op" id="6135310">(</span><span class="ident" id="6135311"><a href="/gostd/net/http/httptest/server.go.html#6133828">fmt</a></span><span class="op" id="6135314">.</span><span class="ident" id="6135315"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="6135322">(</span><span class="string" id="6135323">&#34;httptest:&nbsp;failed&nbsp;to&nbsp;listen&nbsp;on&nbsp;a&nbsp;port:&nbsp;%v&#34;</span><span class="op" id="6135365">,</span>&nbsp;<span class="ident" id="6135367"><a href="/gostd/net/http/httptest/server.go.html#6135187">err</a></span><span class="op" id="6135370">)</span><span class="op" id="6135371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135375">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135381">return</span>&nbsp;<span class="ident" id="6135388"><a href="/gostd/net/http/httptest/server.go.html#6135184">l</a></span><br>
<span class="lineno"></span><span class="op" id="6135390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6135393">//&nbsp;When&nbsp;debugging&nbsp;a&nbsp;particular&nbsp;http&nbsp;server-based&nbsp;test,</span><br>
<span class="lineno">75</span><span class="comment" id="6135448">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;you&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="6135474">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;test&nbsp;-run=BrokenTest&nbsp;-httptest.serve=127.0.0.1:8000</span><br>
<span class="lineno"></span><span class="comment" id="6135532">//&nbsp;to&nbsp;start&nbsp;the&nbsp;broken&nbsp;server&nbsp;so&nbsp;you&nbsp;can&nbsp;interact&nbsp;with&nbsp;it&nbsp;manually.</span><br>
<span class="lineno"></span><span class="keyword" id="6135600">var</span>&nbsp;<span class="ident" id="6135604">serve</span>&nbsp;<span class="op" id="6135610">=</span>&nbsp;<span class="ident" id="6135612"><a href="/gostd/net/http/httptest/server.go.html#6133820">flag</a></span><span class="op" id="6135616">.</span><span class="ident" id="6135617"><a href="/gostd/flag/flag.go.html#3954331">String</a></span><span class="op" id="6135623">(</span><span class="string" id="6135624">&#34;httptest.serve&#34;</span><span class="op" id="6135640">,</span>&nbsp;<span class="string" id="6135642">&#34;&#34;</span><span class="op" id="6135644">,</span>&nbsp;<span class="string" id="6135646">&#34;if&nbsp;non-empty,&nbsp;httptest.NewServer&nbsp;serves&nbsp;on&nbsp;this&nbsp;address&nbsp;and&nbsp;blocks&#34;</span><span class="op" id="6135714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="6135717">//&nbsp;NewServer&nbsp;starts&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server.</span><br>
<span class="lineno"></span><span class="comment" id="6135763">//&nbsp;The&nbsp;caller&nbsp;should&nbsp;call&nbsp;Close&nbsp;when&nbsp;finished,&nbsp;to&nbsp;shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="6135827">func</span>&nbsp;<span class="ident" id="6135832">NewServer</span><span class="op" id="6135841">(</span><span class="ident" id="6135842">handler</span>&nbsp;<span class="ident" id="6135850"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6135854">.</span><span class="ident" id="6135855"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><span class="op" id="6135862">)</span>&nbsp;<span class="op" id="6135864">*</span><span class="ident" id="6135865"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span>&nbsp;<span class="op" id="6135872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135875">ts</span>&nbsp;<span class="op" id="6135878">:=</span>&nbsp;<span class="ident" id="6135881"><a href="/gostd/net/http/httptest/server.go.html#6136157">NewUnstartedServer</a></span><span class="op" id="6135899">(</span><span class="ident" id="6135900"><a href="/gostd/net/http/httptest/server.go.html#6135842">handler</a></span><span class="op" id="6135907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135910"><a href="/gostd/net/http/httptest/server.go.html#6135875">ts</a></span><span class="op" id="6135912">.</span><span class="ident" id="6135913"><a href="/gostd/net/http/httptest/server.go.html#6136374">Start</a></span><span class="op" id="6135918">(</span><span class="op" id="6135919">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135922">return</span>&nbsp;<span class="ident" id="6135929"><a href="/gostd/net/http/httptest/server.go.html#6135875">ts</a></span><br>
<span class="lineno"></span><span class="op" id="6135932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6135935">//&nbsp;NewUnstartedServer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server&nbsp;but&nbsp;doesn&#39;t&nbsp;start&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6136000">//</span><br>
<span class="lineno">90</span><span class="comment" id="6136003">//&nbsp;After&nbsp;changing&nbsp;its&nbsp;configuration,&nbsp;the&nbsp;caller&nbsp;should&nbsp;call&nbsp;Start&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6136072">//&nbsp;StartTLS.</span><br>
<span class="lineno"></span><span class="comment" id="6136085">//</span><br>
<span class="lineno"></span><span class="comment" id="6136088">//&nbsp;The&nbsp;caller&nbsp;should&nbsp;call&nbsp;Close&nbsp;when&nbsp;finished,&nbsp;to&nbsp;shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="6136152">func</span>&nbsp;<span class="ident" id="6136157">NewUnstartedServer</span><span class="op" id="6136175">(</span><span class="ident" id="6136176">handler</span>&nbsp;<span class="ident" id="6136184"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6136188">.</span><span class="ident" id="6136189"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><span class="op" id="6136196">)</span>&nbsp;<span class="op" id="6136198">*</span><span class="ident" id="6136199"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span>&nbsp;<span class="op" id="6136206">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136209">return</span>&nbsp;<span class="op" id="6136216">&amp;</span><span class="ident" id="6136217"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><span class="op" id="6136223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136227"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6136235">:</span>&nbsp;<span class="ident" id="6136237"><a href="/gostd/net/http/httptest/server.go.html#6134981">newLocalListener</a></span><span class="op" id="6136253">(</span><span class="op" id="6136254">)</span><span class="op" id="6136255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136259"><a href="/gostd/net/http/httptest/server.go.html#6134446">Config</a></span><span class="op" id="6136265">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6136269">&amp;</span><span class="ident" id="6136270"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6136274">.</span><span class="ident" id="6136275"><a href="/gostd/net/http/server.go.html#4216561">Server</a></span><span class="op" id="6136281">{</span><span class="ident" id="6136282"><a href="/gostd/net/http/server.go.html#4216654">Handler</a></span><span class="op" id="6136289">:</span>&nbsp;<span class="ident" id="6136291"><a href="/gostd/net/http/httptest/server.go.html#6136176">handler</a></span><span class="op" id="6136298">}</span><span class="op" id="6136299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6136302">}</span><br>
<span class="lineno"></span><span class="op" id="6136304">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="6136307">//&nbsp;Start&nbsp;starts&nbsp;a&nbsp;server&nbsp;from&nbsp;NewUnstartedServer.</span><br>
<span class="lineno"></span><span class="keyword" id="6136357">func</span>&nbsp;<span class="op" id="6136362">(</span><span class="ident" id="6136363">s</span>&nbsp;<span class="op" id="6136365">*</span><span class="ident" id="6136366"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><span class="op" id="6136372">)</span>&nbsp;<span class="ident" id="6136374">Start</span><span class="op" id="6136379">(</span><span class="op" id="6136380">)</span>&nbsp;<span class="op" id="6136382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136385">if</span>&nbsp;<span class="ident" id="6136388"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136389">.</span><span class="ident" id="6136390"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span>&nbsp;<span class="op" id="6136394">!=</span>&nbsp;<span class="string" id="6136397">&#34;&#34;</span>&nbsp;<span class="op" id="6136400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6136404">panic</span><span class="op" id="6136409">(</span><span class="string" id="6136410">&#34;Server&nbsp;already&nbsp;started&#34;</span><span class="op" id="6136434">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6136437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136440"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136441">.</span><span class="ident" id="6136442"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span>&nbsp;<span class="op" id="6136451">=</span>&nbsp;<span class="op" id="6136453">&amp;</span><span class="ident" id="6136454"><a href="/gostd/net/http/httptest/server.go.html#6134692">historyListener</a></span><span class="op" id="6136469">{</span><span class="ident" id="6136470"><a href="/gostd/net/http/httptest/server.go.html#6134718">Listener</a></span><span class="op" id="6136478">:</span>&nbsp;<span class="ident" id="6136480"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136481">.</span><span class="ident" id="6136482"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6136490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136493"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136494">.</span><span class="ident" id="6136495"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span>&nbsp;<span class="op" id="6136499">=</span>&nbsp;<span class="string" id="6136501">&#34;http://&#34;</span>&nbsp;<span class="op" id="6136511">+</span>&nbsp;<span class="ident" id="6136513"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136514">.</span><span class="ident" id="6136515"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6136523">.</span><span class="ident" id="6136524"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6136528">(</span><span class="op" id="6136529">)</span><span class="op" id="6136530">.</span><span class="ident" id="6136531"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6136537">(</span><span class="op" id="6136538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136541"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136542">.</span><span class="ident" id="6136543"><a href="/gostd/net/http/httptest/server.go.html#6137454">wrapHandler</a></span><span class="op" id="6136554">(</span><span class="op" id="6136555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136558">go</span>&nbsp;<span class="ident" id="6136561"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136562">.</span><span class="ident" id="6136563"><a href="/gostd/net/http/httptest/server.go.html#6134446">Config</a></span><span class="op" id="6136569">.</span><span class="ident" id="6136570"><a href="/gostd/net/http/server.go.html#4220587">Serve</a></span><span class="op" id="6136575">(</span><span class="ident" id="6136576"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136577">.</span><span class="ident" id="6136578"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6136586">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136589">if</span>&nbsp;<span class="op" id="6136592">*</span><span class="ident" id="6136593"><a href="/gostd/net/http/httptest/server.go.html#6135604">serve</a></span>&nbsp;<span class="op" id="6136599">!=</span>&nbsp;<span class="string" id="6136602">&#34;&#34;</span>&nbsp;<span class="op" id="6136605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136609"><a href="/gostd/net/http/httptest/server.go.html#6133828">fmt</a></span><span class="op" id="6136612">.</span><span class="ident" id="6136613"><a href="/gostd/fmt/print.go.html#2145376">Fprintln</a></span><span class="op" id="6136621">(</span><span class="ident" id="6136622"><a href="/gostd/net/http/httptest/server.go.html#6133854">os</a></span><span class="op" id="6136624">.</span><span class="ident" id="6136625"><a href="/gostd/os/file.go.html#2441872">Stderr</a></span><span class="op" id="6136631">,</span>&nbsp;<span class="string" id="6136633">&#34;httptest:&nbsp;serving&nbsp;on&#34;</span><span class="op" id="6136655">,</span>&nbsp;<span class="ident" id="6136657"><a href="/gostd/net/http/httptest/server.go.html#6136363">s</a></span><span class="op" id="6136658">.</span><span class="ident" id="6136659"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6136662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136666">select</span>&nbsp;<span class="op" id="6136673">{</span><span class="op" id="6136674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6136677">}</span><br>
<span class="lineno"></span><span class="op" id="6136679">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6136682">//&nbsp;StartTLS&nbsp;starts&nbsp;TLS&nbsp;on&nbsp;a&nbsp;server&nbsp;from&nbsp;NewUnstartedServer.</span><br>
<span class="lineno"></span><span class="keyword" id="6136742">func</span>&nbsp;<span class="op" id="6136747">(</span><span class="ident" id="6136748">s</span>&nbsp;<span class="op" id="6136750">*</span><span class="ident" id="6136751"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><span class="op" id="6136757">)</span>&nbsp;<span class="ident" id="6136759">StartTLS</span><span class="op" id="6136767">(</span><span class="op" id="6136768">)</span>&nbsp;<span class="op" id="6136770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136773">if</span>&nbsp;<span class="ident" id="6136776"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6136777">.</span><span class="ident" id="6136778"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span>&nbsp;<span class="op" id="6136782">!=</span>&nbsp;<span class="string" id="6136785">&#34;&#34;</span>&nbsp;<span class="op" id="6136788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6136792">panic</span><span class="op" id="6136797">(</span><span class="string" id="6136798">&#34;Server&nbsp;already&nbsp;started&#34;</span><span class="op" id="6136822">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6136825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136828">cert</span><span class="op" id="6136832">,</span>&nbsp;<span class="ident" id="6136834">err</span>&nbsp;<span class="op" id="6136838">:=</span>&nbsp;<span class="ident" id="6136841"><a href="/gostd/net/http/httptest/server.go.html#6133806">tls</a></span><span class="op" id="6136844">.</span><span class="ident" id="6136845"><a href="/gostd/crypto/tls/tls.go.html#4588297">X509KeyPair</a></span><span class="op" id="6136856">(</span><span class="ident" id="6136857"><a href="/gostd/net/http/httptest/server.go.html#6139158">localhostCert</a></span><span class="op" id="6136870">,</span>&nbsp;<span class="ident" id="6136872"><a href="/gostd/net/http/httptest/server.go.html#6139813">localhostKey</a></span><span class="op" id="6136884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136887">if</span>&nbsp;<span class="ident" id="6136890"><a href="/gostd/net/http/httptest/server.go.html#6136834">err</a></span>&nbsp;<span class="op" id="6136894">!=</span>&nbsp;<span class="builtintype" id="6136897">nil</span>&nbsp;<span class="op" id="6136901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6136905">panic</span><span class="op" id="6136910">(</span><span class="ident" id="6136911"><a href="/gostd/net/http/httptest/server.go.html#6133828">fmt</a></span><span class="op" id="6136914">.</span><span class="ident" id="6136915"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="6136922">(</span><span class="string" id="6136923">&#34;httptest:&nbsp;NewTLSServer:&nbsp;%v&#34;</span><span class="op" id="6136951">,</span>&nbsp;<span class="ident" id="6136953"><a href="/gostd/net/http/httptest/server.go.html#6136834">err</a></span><span class="op" id="6136956">)</span><span class="op" id="6136957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6136960">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136964">existingConfig</span>&nbsp;<span class="op" id="6136979">:=</span>&nbsp;<span class="ident" id="6136982"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6136983">.</span><span class="ident" id="6136984"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136989"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6136990">.</span><span class="ident" id="6136991"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span>&nbsp;<span class="op" id="6136995">=</span>&nbsp;<span class="builtinfunc" id="6136997">new</span><span class="op" id="6137000">(</span><span class="ident" id="6137001"><a href="/gostd/net/http/httptest/server.go.html#6133806">tls</a></span><span class="op" id="6137004">.</span><span class="ident" id="6137005"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="6137011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137014">if</span>&nbsp;<span class="ident" id="6137017"><a href="/gostd/net/http/httptest/server.go.html#6136964">existingConfig</a></span>&nbsp;<span class="op" id="6137032">!=</span>&nbsp;<span class="builtintype" id="6137035">nil</span>&nbsp;<span class="op" id="6137039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137043">*</span><span class="ident" id="6137044"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137045">.</span><span class="ident" id="6137046"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span>&nbsp;<span class="op" id="6137050">=</span>&nbsp;<span class="op" id="6137052">*</span><span class="ident" id="6137053"><a href="/gostd/net/http/httptest/server.go.html#6136964">existingConfig</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137072">if</span>&nbsp;<span class="ident" id="6137075"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137076">.</span><span class="ident" id="6137077"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span><span class="op" id="6137080">.</span><span class="ident" id="6137081"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="6137092">==</span>&nbsp;<span class="builtintype" id="6137095">nil</span>&nbsp;<span class="op" id="6137099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137103"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137104">.</span><span class="ident" id="6137105"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span><span class="op" id="6137108">.</span><span class="ident" id="6137109"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="6137120">=</span>&nbsp;<span class="op" id="6137122">[</span><span class="op" id="6137123">]</span><span class="builtintype" id="6137124">string</span><span class="op" id="6137130">{</span><span class="string" id="6137131">&#34;http/1.1&#34;</span><span class="op" id="6137141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137147">if</span>&nbsp;<span class="builtinfunc" id="6137150">len</span><span class="op" id="6137153">(</span><span class="ident" id="6137154"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137155">.</span><span class="ident" id="6137156"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span><span class="op" id="6137159">.</span><span class="ident" id="6137160"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="6137172">)</span>&nbsp;<span class="op" id="6137174">==</span>&nbsp;<span class="num" id="6137177">0</span>&nbsp;<span class="op" id="6137179">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137183"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137184">.</span><span class="ident" id="6137185"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span><span class="op" id="6137188">.</span><span class="ident" id="6137189"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="6137202">=</span>&nbsp;<span class="op" id="6137204">[</span><span class="op" id="6137205">]</span><span class="ident" id="6137206"><a href="/gostd/net/http/httptest/server.go.html#6133806">tls</a></span><span class="op" id="6137209">.</span><span class="ident" id="6137210"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="6137221">{</span><span class="ident" id="6137222"><a href="/gostd/net/http/httptest/server.go.html#6136828">cert</a></span><span class="op" id="6137226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137232">tlsListener</span>&nbsp;<span class="op" id="6137244">:=</span>&nbsp;<span class="ident" id="6137247"><a href="/gostd/net/http/httptest/server.go.html#6133806">tls</a></span><span class="op" id="6137250">.</span><span class="ident" id="6137251"><a href="/gostd/crypto/tls/tls.go.html#4584756">NewListener</a></span><span class="op" id="6137262">(</span><span class="ident" id="6137263"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137264">.</span><span class="ident" id="6137265"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6137273">,</span>&nbsp;<span class="ident" id="6137275"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137276">.</span><span class="ident" id="6137277"><a href="/gostd/net/http/httptest/server.go.html#6134335">TLS</a></span><span class="op" id="6137280">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137284"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137285">.</span><span class="ident" id="6137286"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span>&nbsp;<span class="op" id="6137295">=</span>&nbsp;<span class="op" id="6137297">&amp;</span><span class="ident" id="6137298"><a href="/gostd/net/http/httptest/server.go.html#6134692">historyListener</a></span><span class="op" id="6137313">{</span><span class="ident" id="6137314"><a href="/gostd/net/http/httptest/server.go.html#6134718">Listener</a></span><span class="op" id="6137322">:</span>&nbsp;<span class="ident" id="6137324"><a href="/gostd/net/http/httptest/server.go.html#6137232">tlsListener</a></span><span class="op" id="6137335">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137338"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137339">.</span><span class="ident" id="6137340"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span>&nbsp;<span class="op" id="6137344">=</span>&nbsp;<span class="string" id="6137346">&#34;https://&#34;</span>&nbsp;<span class="op" id="6137357">+</span>&nbsp;<span class="ident" id="6137359"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137360">.</span><span class="ident" id="6137361"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6137369">.</span><span class="ident" id="6137370"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6137374">(</span><span class="op" id="6137375">)</span><span class="op" id="6137376">.</span><span class="ident" id="6137377"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6137383">(</span><span class="op" id="6137384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137387"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137388">.</span><span class="ident" id="6137389"><a href="/gostd/net/http/httptest/server.go.html#6137454">wrapHandler</a></span><span class="op" id="6137400">(</span><span class="op" id="6137401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137404">go</span>&nbsp;<span class="ident" id="6137407"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137408">.</span><span class="ident" id="6137409"><a href="/gostd/net/http/httptest/server.go.html#6134446">Config</a></span><span class="op" id="6137415">.</span><span class="ident" id="6137416"><a href="/gostd/net/http/server.go.html#4220587">Serve</a></span><span class="op" id="6137421">(</span><span class="ident" id="6137422"><a href="/gostd/net/http/httptest/server.go.html#6136748">s</a></span><span class="op" id="6137423">.</span><span class="ident" id="6137424"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6137432">)</span><br>
<span class="lineno"></span><span class="op" id="6137434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6137437">func</span>&nbsp;<span class="op" id="6137442">(</span><span class="ident" id="6137443">s</span>&nbsp;<span class="op" id="6137445">*</span><span class="ident" id="6137446"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><span class="op" id="6137452">)</span>&nbsp;<span class="ident" id="6137454">wrapHandler</span><span class="op" id="6137465">(</span><span class="op" id="6137466">)</span>&nbsp;<span class="op" id="6137468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137471">h</span>&nbsp;<span class="op" id="6137473">:=</span>&nbsp;<span class="ident" id="6137476"><a href="/gostd/net/http/httptest/server.go.html#6137443">s</a></span><span class="op" id="6137477">.</span><span class="ident" id="6137478"><a href="/gostd/net/http/httptest/server.go.html#6134446">Config</a></span><span class="op" id="6137484">.</span><span class="ident" id="6137485"><a href="/gostd/net/http/server.go.html#4216654">Handler</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137494">if</span>&nbsp;<span class="ident" id="6137497"><a href="/gostd/net/http/httptest/server.go.html#6137471">h</a></span>&nbsp;<span class="op" id="6137499">==</span>&nbsp;<span class="builtintype" id="6137502">nil</span>&nbsp;<span class="op" id="6137506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137510"><a href="/gostd/net/http/httptest/server.go.html#6137471">h</a></span>&nbsp;<span class="op" id="6137512">=</span>&nbsp;<span class="ident" id="6137514"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6137518">.</span><span class="ident" id="6137519"><a href="/gostd/net/http/server.go.html#4211381">DefaultServeMux</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137536">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137539"><a href="/gostd/net/http/httptest/server.go.html#6137443">s</a></span><span class="op" id="6137540">.</span><span class="ident" id="6137541"><a href="/gostd/net/http/httptest/server.go.html#6134446">Config</a></span><span class="op" id="6137547">.</span><span class="ident" id="6137548"><a href="/gostd/net/http/server.go.html#4216654">Handler</a></span>&nbsp;<span class="op" id="6137556">=</span>&nbsp;<span class="op" id="6137558">&amp;</span><span class="ident" id="6137559"><a href="/gostd/net/http/httptest/server.go.html#6138587">waitGroupHandler</a></span><span class="op" id="6137575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137579"><a href="/gostd/net/http/httptest/server.go.html#6138614">s</a></span><span class="op" id="6137580">:</span>&nbsp;<span class="ident" id="6137582"><a href="/gostd/net/http/httptest/server.go.html#6137443">s</a></span><span class="op" id="6137583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137587"><a href="/gostd/net/http/httptest/server.go.html#6138625">h</a></span><span class="op" id="6137588">:</span>&nbsp;<span class="ident" id="6137590"><a href="/gostd/net/http/httptest/server.go.html#6137471">h</a></span><span class="op" id="6137591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137594">}</span><br>
<span class="lineno"></span><span class="op" id="6137596">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="6137599">//&nbsp;NewTLSServer&nbsp;starts&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server&nbsp;using&nbsp;TLS.</span><br>
<span class="lineno"></span><span class="comment" id="6137658">//&nbsp;The&nbsp;caller&nbsp;should&nbsp;call&nbsp;Close&nbsp;when&nbsp;finished,&nbsp;to&nbsp;shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="6137722">func</span>&nbsp;<span class="ident" id="6137727">NewTLSServer</span><span class="op" id="6137739">(</span><span class="ident" id="6137740">handler</span>&nbsp;<span class="ident" id="6137748"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6137752">.</span><span class="ident" id="6137753"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><span class="op" id="6137760">)</span>&nbsp;<span class="op" id="6137762">*</span><span class="ident" id="6137763"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span>&nbsp;<span class="op" id="6137770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137773">ts</span>&nbsp;<span class="op" id="6137776">:=</span>&nbsp;<span class="ident" id="6137779"><a href="/gostd/net/http/httptest/server.go.html#6136157">NewUnstartedServer</a></span><span class="op" id="6137797">(</span><span class="ident" id="6137798"><a href="/gostd/net/http/httptest/server.go.html#6137740">handler</a></span><span class="op" id="6137805">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137808"><a href="/gostd/net/http/httptest/server.go.html#6137773">ts</a></span><span class="op" id="6137810">.</span><span class="ident" id="6137811"><a href="/gostd/net/http/httptest/server.go.html#6136759">StartTLS</a></span><span class="op" id="6137819">(</span><span class="op" id="6137820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137823">return</span>&nbsp;<span class="ident" id="6137830"><a href="/gostd/net/http/httptest/server.go.html#6137773">ts</a></span><br>
<span class="lineno"></span><span class="op" id="6137833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6137836">//&nbsp;Close&nbsp;shuts&nbsp;down&nbsp;the&nbsp;server&nbsp;and&nbsp;blocks&nbsp;until&nbsp;all&nbsp;outstanding</span><br>
<span class="lineno">165</span><span class="comment" id="6137900">//&nbsp;requests&nbsp;on&nbsp;this&nbsp;server&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="6137943">func</span>&nbsp;<span class="op" id="6137948">(</span><span class="ident" id="6137949">s</span>&nbsp;<span class="op" id="6137951">*</span><span class="ident" id="6137952"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><span class="op" id="6137958">)</span>&nbsp;<span class="ident" id="6137960">Close</span><span class="op" id="6137965">(</span><span class="op" id="6137966">)</span>&nbsp;<span class="op" id="6137968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137971"><a href="/gostd/net/http/httptest/server.go.html#6137949">s</a></span><span class="op" id="6137972">.</span><span class="ident" id="6137973"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6137981">.</span><span class="ident" id="6137982"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6137987">(</span><span class="op" id="6137988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137991"><a href="/gostd/net/http/httptest/server.go.html#6137949">s</a></span><span class="op" id="6137992">.</span><span class="ident" id="6137993"><a href="/gostd/net/http/httptest/server.go.html#6134588">wg</a></span><span class="op" id="6137995">.</span><span class="ident" id="6137996"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="6138000">(</span><span class="op" id="6138001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138004"><a href="/gostd/net/http/httptest/server.go.html#6137949">s</a></span><span class="op" id="6138005">.</span><span class="ident" id="6138006"><a href="/gostd/net/http/httptest/server.go.html#6138232">CloseClientConnections</a></span><span class="op" id="6138028">(</span><span class="op" id="6138029">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138032">if</span>&nbsp;<span class="ident" id="6138035">t</span><span class="op" id="6138036">,</span>&nbsp;<span class="ident" id="6138038">ok</span>&nbsp;<span class="op" id="6138041">:=</span>&nbsp;<span class="ident" id="6138044"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6138048">.</span><span class="ident" id="6138049"><a href="/gostd/net/http/transport.go.html#4260261">DefaultTransport</a></span><span class="op" id="6138065">.</span><span class="op" id="6138066">(</span><span class="op" id="6138067">*</span><span class="ident" id="6138068"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6138072">.</span><span class="ident" id="6138073"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="6138082">)</span><span class="op" id="6138083">;</span>&nbsp;<span class="ident" id="6138085"><a href="/gostd/net/http/httptest/server.go.html#6138038">ok</a></span>&nbsp;<span class="op" id="6138088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138092"><a href="/gostd/net/http/httptest/server.go.html#6138035">t</a></span><span class="op" id="6138093">.</span><span class="ident" id="6138094"><a href="/gostd/net/http/transport.go.html#4267990">CloseIdleConnections</a></span><span class="op" id="6138114">(</span><span class="op" id="6138115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6138118">}</span><br>
<span class="lineno"></span><span class="op" id="6138120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6138123">//&nbsp;CloseClientConnections&nbsp;closes&nbsp;any&nbsp;currently&nbsp;open&nbsp;HTTP&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="6138192">//&nbsp;to&nbsp;the&nbsp;test&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="6138215">func</span>&nbsp;<span class="op" id="6138220">(</span><span class="ident" id="6138221">s</span>&nbsp;<span class="op" id="6138223">*</span><span class="ident" id="6138224"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><span class="op" id="6138230">)</span>&nbsp;<span class="ident" id="6138232">CloseClientConnections</span><span class="op" id="6138254">(</span><span class="op" id="6138255">)</span>&nbsp;<span class="op" id="6138257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138260">hl</span><span class="op" id="6138262">,</span>&nbsp;<span class="ident" id="6138264">ok</span>&nbsp;<span class="op" id="6138267">:=</span>&nbsp;<span class="ident" id="6138270"><a href="/gostd/net/http/httptest/server.go.html#6138221">s</a></span><span class="op" id="6138271">.</span><span class="ident" id="6138272"><a href="/gostd/net/http/httptest/server.go.html#6134105">Listener</a></span><span class="op" id="6138280">.</span><span class="op" id="6138281">(</span><span class="op" id="6138282">*</span><span class="ident" id="6138283"><a href="/gostd/net/http/httptest/server.go.html#6134692">historyListener</a></span><span class="op" id="6138298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138301">if</span>&nbsp;<span class="op" id="6138304">!</span><span class="ident" id="6138305"><a href="/gostd/net/http/httptest/server.go.html#6138264">ok</a></span>&nbsp;<span class="op" id="6138308">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6138320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138323"><a href="/gostd/net/http/httptest/server.go.html#6138260">hl</a></span><span class="op" id="6138325">.</span><span class="ident" id="6138326"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6138330">(</span><span class="op" id="6138331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138334">for</span>&nbsp;<span class="ident" id="6138338">_</span><span class="op" id="6138339">,</span>&nbsp;<span class="ident" id="6138341">conn</span>&nbsp;<span class="op" id="6138346">:=</span>&nbsp;<span class="keyword" id="6138349">range</span>&nbsp;<span class="ident" id="6138355"><a href="/gostd/net/http/httptest/server.go.html#6138260">hl</a></span><span class="op" id="6138357">.</span><span class="ident" id="6138358"><a href="/gostd/net/http/httptest/server.go.html#6134764">history</a></span>&nbsp;<span class="op" id="6138366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138370"><a href="/gostd/net/http/httptest/server.go.html#6138341">conn</a></span><span class="op" id="6138374">.</span><span class="ident" id="6138375"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6138380">(</span><span class="op" id="6138381">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6138384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138387"><a href="/gostd/net/http/httptest/server.go.html#6138260">hl</a></span><span class="op" id="6138389">.</span><span class="ident" id="6138390"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6138396">(</span><span class="op" id="6138397">)</span><br>
<span class="lineno"></span><span class="op" id="6138399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6138402">//&nbsp;waitGroupHandler&nbsp;wraps&nbsp;a&nbsp;handler,&nbsp;incrementing&nbsp;and&nbsp;decrementing&nbsp;a</span><br>
<span class="lineno">190</span><span class="comment" id="6138471">//&nbsp;sync.WaitGroup&nbsp;on&nbsp;each&nbsp;request,&nbsp;to&nbsp;enable&nbsp;Server.Close&nbsp;to&nbsp;block</span><br>
<span class="lineno"></span><span class="comment" id="6138538">//&nbsp;until&nbsp;outstanding&nbsp;requests&nbsp;are&nbsp;finished.</span><br>
<span class="lineno"></span><span class="keyword" id="6138582">type</span>&nbsp;<span class="ident" id="6138587">waitGroupHandler</span>&nbsp;<span class="keyword" id="6138604">struct</span>&nbsp;<span class="op" id="6138611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138614">s</span>&nbsp;<span class="op" id="6138616">*</span><span class="ident" id="6138617"><a href="/gostd/net/http/httptest/server.go.html#6134009">Server</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138625">h</span>&nbsp;<span class="ident" id="6138627"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6138631">.</span><span class="ident" id="6138632"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span>&nbsp;<span class="comment" id="6138640">//&nbsp;non-nil</span><br>
<span class="lineno">195</span><span class="op" id="6138651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6138654">func</span>&nbsp;<span class="op" id="6138659">(</span><span class="ident" id="6138660">h</span>&nbsp;<span class="op" id="6138662">*</span><span class="ident" id="6138663"><a href="/gostd/net/http/httptest/server.go.html#6138587">waitGroupHandler</a></span><span class="op" id="6138679">)</span>&nbsp;<span class="ident" id="6138681">ServeHTTP</span><span class="op" id="6138690">(</span><span class="ident" id="6138691">w</span>&nbsp;<span class="ident" id="6138693"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6138697">.</span><span class="ident" id="6138698"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="6138712">,</span>&nbsp;<span class="ident" id="6138714">r</span>&nbsp;<span class="op" id="6138716">*</span><span class="ident" id="6138717"><a href="/gostd/net/http/httptest/server.go.html#6133842">http</a></span><span class="op" id="6138721">.</span><span class="ident" id="6138722"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6138729">)</span>&nbsp;<span class="op" id="6138731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138734"><a href="/gostd/net/http/httptest/server.go.html#6138660">h</a></span><span class="op" id="6138735">.</span><span class="ident" id="6138736"><a href="/gostd/net/http/httptest/server.go.html#6138614">s</a></span><span class="op" id="6138737">.</span><span class="ident" id="6138738"><a href="/gostd/net/http/httptest/server.go.html#6134588">wg</a></span><span class="op" id="6138740">.</span><span class="ident" id="6138741"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="6138744">(</span><span class="num" id="6138745">1</span><span class="op" id="6138746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138749">defer</span>&nbsp;<span class="ident" id="6138755"><a href="/gostd/net/http/httptest/server.go.html#6138660">h</a></span><span class="op" id="6138756">.</span><span class="ident" id="6138757"><a href="/gostd/net/http/httptest/server.go.html#6138614">s</a></span><span class="op" id="6138758">.</span><span class="ident" id="6138759"><a href="/gostd/net/http/httptest/server.go.html#6134588">wg</a></span><span class="op" id="6138761">.</span><span class="ident" id="6138762"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6138766">(</span><span class="op" id="6138767">)</span>&nbsp;<span class="comment" id="6138769">//&nbsp;a&nbsp;defer,&nbsp;in&nbsp;case&nbsp;ServeHTTP&nbsp;below&nbsp;panics</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138813"><a href="/gostd/net/http/httptest/server.go.html#6138660">h</a></span><span class="op" id="6138814">.</span><span class="ident" id="6138815"><a href="/gostd/net/http/httptest/server.go.html#6138625">h</a></span><span class="op" id="6138816">.</span><span class="ident" id="6138817"><a href="/gostd/net/http/server.go.html#4170434">ServeHTTP</a></span><span class="op" id="6138826">(</span><span class="ident" id="6138827"><a href="/gostd/net/http/httptest/server.go.html#6138691">w</a></span><span class="op" id="6138828">,</span>&nbsp;<span class="ident" id="6138830"><a href="/gostd/net/http/httptest/server.go.html#6138714">r</a></span><span class="op" id="6138831">)</span><br>
<span class="lineno"></span><span class="op" id="6138833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6138836">//&nbsp;localhostCert&nbsp;is&nbsp;a&nbsp;PEM-encoded&nbsp;TLS&nbsp;cert&nbsp;with&nbsp;SAN&nbsp;IPs</span><br>
<span class="lineno"></span><span class="comment" id="6138892">//&nbsp;&#34;127.0.0.1&#34;&nbsp;and&nbsp;&#34;[::1]&#34;,&nbsp;expiring&nbsp;at&nbsp;the&nbsp;last&nbsp;second&nbsp;of&nbsp;2049&nbsp;(the&nbsp;end</span><br>
<span class="lineno">205</span><span class="comment" id="6138965">//&nbsp;of&nbsp;ASN.1&nbsp;time).</span><br>
<span class="lineno"></span><span class="comment" id="6138984">//&nbsp;generated&nbsp;from&nbsp;src/crypto/tls:</span><br>
<span class="lineno"></span><span class="comment" id="6139018">//&nbsp;go&nbsp;run&nbsp;generate_cert.go&nbsp;&nbsp;--rsa-bits&nbsp;512&nbsp;--host&nbsp;127.0.0.1,::1,example.com&nbsp;--ca&nbsp;--start-date&nbsp;&#34;Jan&nbsp;1&nbsp;00:00:00&nbsp;1970&#34;&nbsp;--duration=1000000h</span><br>
<span class="lineno"></span><span class="keyword" id="6139154">var</span>&nbsp;<span class="ident" id="6139158">localhostCert</span>&nbsp;<span class="op" id="6139172">=</span>&nbsp;<span class="op" id="6139174">[</span><span class="op" id="6139175">]</span><span class="builtintype" id="6139176">byte</span><span class="op" id="6139180">(</span><span class="string" id="6139181">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIBdzCCASOgAwIBAgIBADALBgkqhkiG9w0BAQUwEjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">210</span>bzAeFw03MDAxMDEwMDAwMDBaFw00OTEyMzEyMzU5NTlaMBIxEDAOBgNVBAoTB0Fj<br>
<span class="lineno"></span>bWUgQ28wWjALBgkqhkiG9w0BAQEDSwAwSAJBAN55NcYKZeInyTuhcCwFMhDHCmwa<br>
<span class="lineno"></span>IUSdtXdcbItRB/yfXGBhiex00IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEA<br>
<span class="lineno"></span>AaNoMGYwDgYDVR0PAQH/BAQDAgCkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA8GA1Ud<br>
<span class="lineno"></span>EwEB/wQFMAMBAf8wLgYDVR0RBCcwJYILZXhhbXBsZS5jb22HBH8AAAGHEAAAAAAA<br>
<span class="lineno">215</span>AAAAAAAAAAAAAAEwCwYJKoZIhvcNAQEFA0EAAoQn/ytgqpiLcZu9XKbCJsJcvkgk<br>
<span class="lineno"></span>Se6AbGXgSlq+ZCEVo0qIwSgeBqmsJxUu7NCSOwVJLYNEBO2DtIxoYVk+MA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><span class="op" id="6139752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6139755">//&nbsp;localhostKey&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;localhostCert.</span><br>
<span class="lineno">220</span><span class="keyword" id="6139809">var</span>&nbsp;<span class="ident" id="6139813">localhostKey</span>&nbsp;<span class="op" id="6139826">=</span>&nbsp;<span class="op" id="6139828">[</span><span class="op" id="6139829">]</span><span class="builtintype" id="6139830">byte</span><span class="op" id="6139834">(</span><span class="string" id="6139835">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBPAIBAAJBAN55NcYKZeInyTuhcCwFMhDHCmwaIUSdtXdcbItRB/yfXGBhiex0<br>
<span class="lineno"></span>0IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEAAQJBAQdUx66rfh8sYsgfdcvV<br>
<span class="lineno"></span>NoafYpnEcB5s4m/vSVe6SU7dCK6eYec9f9wpT353ljhDUHq3EbmE4foNzJngh35d<br>
<span class="lineno"></span>AekCIQDhRQG5Li0Wj8TM4obOnnXUXf1jRv0UkzE9AHWLG5q3AwIhAPzSjpYUDjVW<br>
<span class="lineno">225</span>MCUXgckTpKCuGwbJk7424Nb8bLzf3kllAiA5mUBgjfr/WtFSJdWcPQ4Zt9KTMNKD<br>
<span class="lineno"></span>EUO0ukpTwEIl6wIhAMbGqZK3zAAFdq8DD2jPx+UJXnh0rnOkZBzDtJ6/iN69AiEA<br>
<span class="lineno"></span>1Aq8MJgTaYsDQWyU/hDq5YkDJc9e9DSCvUIzqxQWMQE=<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><span class="op" id="6140333">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
