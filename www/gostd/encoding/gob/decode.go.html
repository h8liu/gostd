<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html" class="current">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5565516">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5565571">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5565625">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5565676">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5565731">package</span>&nbsp;<span class="ident" id="5565739">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5565744">import</span>&nbsp;<span class="op" id="5565751">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565754">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565766">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565776">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565782">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565790">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5565800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5565803">var</span>&nbsp;<span class="op" id="5565807">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565810">errBadUint</span>&nbsp;<span class="op" id="5565821">=</span>&nbsp;<span class="ident" id="5565823">errors</span><span class="op" id="5565829">.</span><span class="ident" id="5565830">New</span><span class="op" id="5565833">(</span><span class="string" id="5565834">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5565878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565881">errBadType</span>&nbsp;<span class="op" id="5565892">=</span>&nbsp;<span class="ident" id="5565894">errors</span><span class="op" id="5565900">.</span><span class="ident" id="5565901">New</span><span class="op" id="5565904">(</span><span class="string" id="5565905">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="5565945">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565948">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5565959">=</span>&nbsp;<span class="ident" id="5565961">errors</span><span class="op" id="5565967">.</span><span class="ident" id="5565968">New</span><span class="op" id="5565971">(</span><span class="string" id="5565972">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="5566016">)</span><br>
<span class="lineno"></span><span class="op" id="5566018">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5566021">type</span>&nbsp;<span class="ident" id="5566026">decHelper</span>&nbsp;<span class="keyword" id="5566036">func</span><span class="op" id="5566040">(</span><span class="ident" id="5566041">state</span>&nbsp;<span class="op" id="5566047">*</span><span class="ident" id="5566048">decoderState</span><span class="op" id="5566060">,</span>&nbsp;<span class="ident" id="5566062">v</span>&nbsp;<span class="ident" id="5566064">reflect</span><span class="op" id="5566071">.</span><span class="ident" id="5566072">Value</span><span class="op" id="5566077">,</span>&nbsp;<span class="ident" id="5566079">length</span>&nbsp;<span class="builtintype" id="5566086">int</span><span class="op" id="5566089">,</span>&nbsp;<span class="ident" id="5566091">ovfl</span>&nbsp;<span class="builtintype" id="5566096">error</span><span class="op" id="5566101">)</span>&nbsp;<span class="builtintype" id="5566103">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5566109">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5566191">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="5566225">type</span>&nbsp;<span class="ident" id="5566230">decoderState</span>&nbsp;<span class="keyword" id="5566243">struct</span>&nbsp;<span class="op" id="5566250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566253">dec</span>&nbsp;<span class="op" id="5566257">*</span><span class="ident" id="5566258">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5566267">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5566345">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566416">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566425">*</span><span class="ident" id="5566426">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566437">fieldnum</span>&nbsp;<span class="builtintype" id="5566446">int</span>&nbsp;<span class="comment" id="5566450">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566482">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566491">[</span><span class="op" id="5566492">]</span><span class="builtintype" id="5566493">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566499">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566508">*</span><span class="ident" id="5566509">decoderState</span>&nbsp;<span class="comment" id="5566522">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="5566539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5566542">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5566627">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="5566726">type</span>&nbsp;<span class="ident" id="5566731">decBuffer</span>&nbsp;<span class="keyword" id="5566741">struct</span>&nbsp;<span class="op" id="5566748">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566751">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5566758">[</span><span class="op" id="5566759">]</span><span class="builtintype" id="5566760">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566766">offset</span>&nbsp;<span class="builtintype" id="5566773">int</span>&nbsp;<span class="comment" id="5566777">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="5566793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5566796">func</span>&nbsp;<span class="op" id="5566801">(</span><span class="ident" id="5566802">d</span>&nbsp;<span class="op" id="5566804">*</span><span class="ident" id="5566805">decBuffer</span><span class="op" id="5566814">)</span>&nbsp;<span class="ident" id="5566816">Read</span><span class="op" id="5566820">(</span><span class="ident" id="5566821">p</span>&nbsp;<span class="op" id="5566823">[</span><span class="op" id="5566824">]</span><span class="builtintype" id="5566825">byte</span><span class="op" id="5566829">)</span>&nbsp;<span class="op" id="5566831">(</span><span class="builtintype" id="5566832">int</span><span class="op" id="5566835">,</span>&nbsp;<span class="builtintype" id="5566837">error</span><span class="op" id="5566842">)</span>&nbsp;<span class="op" id="5566844">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566847">n</span>&nbsp;<span class="op" id="5566849">:=</span>&nbsp;<span class="builtinfunc" id="5566852">copy</span><span class="op" id="5566856">(</span><span class="ident" id="5566857">p</span><span class="op" id="5566858">,</span>&nbsp;<span class="ident" id="5566860">d</span><span class="op" id="5566861">.</span><span class="ident" id="5566862">data</span><span class="op" id="5566866">[</span><span class="ident" id="5566867">d</span><span class="op" id="5566868">.</span><span class="ident" id="5566869">offset</span><span class="op" id="5566875">:</span><span class="op" id="5566876">]</span><span class="op" id="5566877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566880">if</span>&nbsp;<span class="ident" id="5566883">n</span>&nbsp;<span class="op" id="5566885">==</span>&nbsp;<span class="num" id="5566888">0</span>&nbsp;<span class="op" id="5566890">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5566893">len</span><span class="op" id="5566896">(</span><span class="ident" id="5566897">p</span><span class="op" id="5566898">)</span>&nbsp;<span class="op" id="5566900">!=</span>&nbsp;<span class="num" id="5566903">0</span>&nbsp;<span class="op" id="5566905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566909">return</span>&nbsp;<span class="num" id="5566916">0</span><span class="op" id="5566917">,</span>&nbsp;<span class="ident" id="5566919">io</span><span class="op" id="5566921">.</span><span class="ident" id="5566922">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566930">d</span><span class="op" id="5566931">.</span><span class="ident" id="5566932">offset</span>&nbsp;<span class="op" id="5566939">+=</span>&nbsp;<span class="ident" id="5566942">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566945">return</span>&nbsp;<span class="ident" id="5566952">n</span><span class="op" id="5566953">,</span>&nbsp;<span class="builtintype" id="5566955">nil</span><br>
<span class="lineno"></span><span class="op" id="5566959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5566962">func</span>&nbsp;<span class="op" id="5566967">(</span><span class="ident" id="5566968">d</span>&nbsp;<span class="op" id="5566970">*</span><span class="ident" id="5566971">decBuffer</span><span class="op" id="5566980">)</span>&nbsp;<span class="ident" id="5566982">Drop</span><span class="op" id="5566986">(</span><span class="ident" id="5566987">n</span>&nbsp;<span class="builtintype" id="5566989">int</span><span class="op" id="5566992">)</span>&nbsp;<span class="op" id="5566994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566997">if</span>&nbsp;<span class="ident" id="5567000">n</span>&nbsp;<span class="op" id="5567002">&gt;</span>&nbsp;<span class="ident" id="5567004">d</span><span class="op" id="5567005">.</span><span class="ident" id="5567006">Len</span><span class="op" id="5567009">(</span><span class="op" id="5567010">)</span>&nbsp;<span class="op" id="5567012">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5567016">panic</span><span class="op" id="5567021">(</span><span class="string" id="5567022">&#34;drop&#34;</span><span class="op" id="5567028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567034">d</span><span class="op" id="5567035">.</span><span class="ident" id="5567036">offset</span>&nbsp;<span class="op" id="5567043">+=</span>&nbsp;<span class="ident" id="5567046">n</span><br>
<span class="lineno"></span><span class="op" id="5567048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5567051">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5567114">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5567179">func</span>&nbsp;<span class="op" id="5567184">(</span><span class="ident" id="5567185">d</span>&nbsp;<span class="op" id="5567187">*</span><span class="ident" id="5567188">decBuffer</span><span class="op" id="5567197">)</span>&nbsp;<span class="ident" id="5567199">Size</span><span class="op" id="5567203">(</span><span class="ident" id="5567204">n</span>&nbsp;<span class="builtintype" id="5567206">int</span><span class="op" id="5567209">)</span>&nbsp;<span class="op" id="5567211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567214">d</span><span class="op" id="5567215">.</span><span class="ident" id="5567216">Reset</span><span class="op" id="5567221">(</span><span class="op" id="5567222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567225">if</span>&nbsp;<span class="builtinfunc" id="5567228">cap</span><span class="op" id="5567231">(</span><span class="ident" id="5567232">d</span><span class="op" id="5567233">.</span><span class="ident" id="5567234">data</span><span class="op" id="5567238">)</span>&nbsp;<span class="op" id="5567240">&lt;</span>&nbsp;<span class="ident" id="5567242">n</span>&nbsp;<span class="op" id="5567244">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567248">d</span><span class="op" id="5567249">.</span><span class="ident" id="5567250">data</span>&nbsp;<span class="op" id="5567255">=</span>&nbsp;<span class="builtinfunc" id="5567257">make</span><span class="op" id="5567261">(</span><span class="op" id="5567262">[</span><span class="op" id="5567263">]</span><span class="builtintype" id="5567264">byte</span><span class="op" id="5567268">,</span>&nbsp;<span class="ident" id="5567270">n</span><span class="op" id="5567271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567274">}</span>&nbsp;<span class="keyword" id="5567276">else</span>&nbsp;<span class="op" id="5567281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567285">d</span><span class="op" id="5567286">.</span><span class="ident" id="5567287">data</span>&nbsp;<span class="op" id="5567292">=</span>&nbsp;<span class="ident" id="5567294">d</span><span class="op" id="5567295">.</span><span class="ident" id="5567296">data</span><span class="op" id="5567300">[</span><span class="num" id="5567301">0</span><span class="op" id="5567302">:</span><span class="ident" id="5567303">n</span><span class="op" id="5567304">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567307">}</span><br>
<span class="lineno"></span><span class="op" id="5567309">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5567312">func</span>&nbsp;<span class="op" id="5567317">(</span><span class="ident" id="5567318">d</span>&nbsp;<span class="op" id="5567320">*</span><span class="ident" id="5567321">decBuffer</span><span class="op" id="5567330">)</span>&nbsp;<span class="ident" id="5567332">ReadByte</span><span class="op" id="5567340">(</span><span class="op" id="5567341">)</span>&nbsp;<span class="op" id="5567343">(</span><span class="builtintype" id="5567344">byte</span><span class="op" id="5567348">,</span>&nbsp;<span class="builtintype" id="5567350">error</span><span class="op" id="5567355">)</span>&nbsp;<span class="op" id="5567357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567360">if</span>&nbsp;<span class="ident" id="5567363">d</span><span class="op" id="5567364">.</span><span class="ident" id="5567365">offset</span>&nbsp;<span class="op" id="5567372">&gt;=</span>&nbsp;<span class="builtinfunc" id="5567375">len</span><span class="op" id="5567378">(</span><span class="ident" id="5567379">d</span><span class="op" id="5567380">.</span><span class="ident" id="5567381">data</span><span class="op" id="5567385">)</span>&nbsp;<span class="op" id="5567387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567391">return</span>&nbsp;<span class="num" id="5567398">0</span><span class="op" id="5567399">,</span>&nbsp;<span class="ident" id="5567401">io</span><span class="op" id="5567403">.</span><span class="ident" id="5567404">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567409">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567412">c</span>&nbsp;<span class="op" id="5567414">:=</span>&nbsp;<span class="ident" id="5567417">d</span><span class="op" id="5567418">.</span><span class="ident" id="5567419">data</span><span class="op" id="5567423">[</span><span class="ident" id="5567424">d</span><span class="op" id="5567425">.</span><span class="ident" id="5567426">offset</span><span class="op" id="5567432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567435">d</span><span class="op" id="5567436">.</span><span class="ident" id="5567437">offset</span><span class="op" id="5567443">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567447">return</span>&nbsp;<span class="ident" id="5567454">c</span><span class="op" id="5567455">,</span>&nbsp;<span class="builtintype" id="5567457">nil</span><br>
<span class="lineno"></span><span class="op" id="5567461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5567464">func</span>&nbsp;<span class="op" id="5567469">(</span><span class="ident" id="5567470">d</span>&nbsp;<span class="op" id="5567472">*</span><span class="ident" id="5567473">decBuffer</span><span class="op" id="5567482">)</span>&nbsp;<span class="ident" id="5567484">Len</span><span class="op" id="5567487">(</span><span class="op" id="5567488">)</span>&nbsp;<span class="builtintype" id="5567490">int</span>&nbsp;<span class="op" id="5567494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567497">return</span>&nbsp;<span class="builtinfunc" id="5567504">len</span><span class="op" id="5567507">(</span><span class="ident" id="5567508">d</span><span class="op" id="5567509">.</span><span class="ident" id="5567510">data</span><span class="op" id="5567514">)</span>&nbsp;<span class="op" id="5567516">-</span>&nbsp;<span class="ident" id="5567518">d</span><span class="op" id="5567519">.</span><span class="ident" id="5567520">offset</span><br>
<span class="lineno"></span><span class="op" id="5567527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5567530">func</span>&nbsp;<span class="op" id="5567535">(</span><span class="ident" id="5567536">d</span>&nbsp;<span class="op" id="5567538">*</span><span class="ident" id="5567539">decBuffer</span><span class="op" id="5567548">)</span>&nbsp;<span class="ident" id="5567550">Bytes</span><span class="op" id="5567555">(</span><span class="op" id="5567556">)</span>&nbsp;<span class="op" id="5567558">[</span><span class="op" id="5567559">]</span><span class="builtintype" id="5567560">byte</span>&nbsp;<span class="op" id="5567565">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567568">return</span>&nbsp;<span class="ident" id="5567575">d</span><span class="op" id="5567576">.</span><span class="ident" id="5567577">data</span><span class="op" id="5567581">[</span><span class="ident" id="5567582">d</span><span class="op" id="5567583">.</span><span class="ident" id="5567584">offset</span><span class="op" id="5567590">:</span><span class="op" id="5567591">]</span><br>
<span class="lineno"></span><span class="op" id="5567593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5567596">func</span>&nbsp;<span class="op" id="5567601">(</span><span class="ident" id="5567602">d</span>&nbsp;<span class="op" id="5567604">*</span><span class="ident" id="5567605">decBuffer</span><span class="op" id="5567614">)</span>&nbsp;<span class="ident" id="5567616">Reset</span><span class="op" id="5567621">(</span><span class="op" id="5567622">)</span>&nbsp;<span class="op" id="5567624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567627">d</span><span class="op" id="5567628">.</span><span class="ident" id="5567629">data</span>&nbsp;<span class="op" id="5567634">=</span>&nbsp;<span class="ident" id="5567636">d</span><span class="op" id="5567637">.</span><span class="ident" id="5567638">data</span><span class="op" id="5567642">[</span><span class="num" id="5567643">0</span><span class="op" id="5567644">:</span><span class="num" id="5567645">0</span><span class="op" id="5567646">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567649">d</span><span class="op" id="5567650">.</span><span class="ident" id="5567651">offset</span>&nbsp;<span class="op" id="5567658">=</span>&nbsp;<span class="num" id="5567660">0</span><br>
<span class="lineno"></span><span class="op" id="5567662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5567665">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="5567745">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="5567782">func</span>&nbsp;<span class="op" id="5567787">(</span><span class="ident" id="5567788">dec</span>&nbsp;<span class="op" id="5567792">*</span><span class="ident" id="5567793">Decoder</span><span class="op" id="5567800">)</span>&nbsp;<span class="ident" id="5567802">newDecoderState</span><span class="op" id="5567817">(</span><span class="ident" id="5567818">buf</span>&nbsp;<span class="op" id="5567822">*</span><span class="ident" id="5567823">decBuffer</span><span class="op" id="5567832">)</span>&nbsp;<span class="op" id="5567834">*</span><span class="ident" id="5567835">decoderState</span>&nbsp;<span class="op" id="5567848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567851">d</span>&nbsp;<span class="op" id="5567853">:=</span>&nbsp;<span class="ident" id="5567856">dec</span><span class="op" id="5567859">.</span><span class="ident" id="5567860">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567870">if</span>&nbsp;<span class="ident" id="5567873">d</span>&nbsp;<span class="op" id="5567875">==</span>&nbsp;<span class="builtintype" id="5567878">nil</span>&nbsp;<span class="op" id="5567882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567886">d</span>&nbsp;<span class="op" id="5567888">=</span>&nbsp;<span class="builtinfunc" id="5567890">new</span><span class="op" id="5567893">(</span><span class="ident" id="5567894">decoderState</span><span class="op" id="5567906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567910">d</span><span class="op" id="5567911">.</span><span class="ident" id="5567912">dec</span>&nbsp;<span class="op" id="5567916">=</span>&nbsp;<span class="ident" id="5567918">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567924">d</span><span class="op" id="5567925">.</span><span class="ident" id="5567926">buf</span>&nbsp;<span class="op" id="5567930">=</span>&nbsp;<span class="builtinfunc" id="5567932">make</span><span class="op" id="5567936">(</span><span class="op" id="5567937">[</span><span class="op" id="5567938">]</span><span class="builtintype" id="5567939">byte</span><span class="op" id="5567943">,</span>&nbsp;<span class="ident" id="5567945">uint64Size</span><span class="op" id="5567955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567958">}</span>&nbsp;<span class="keyword" id="5567960">else</span>&nbsp;<span class="op" id="5567965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567969">dec</span><span class="op" id="5567972">.</span><span class="ident" id="5567973">freeList</span>&nbsp;<span class="op" id="5567982">=</span>&nbsp;<span class="ident" id="5567984">d</span><span class="op" id="5567985">.</span><span class="ident" id="5567986">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567995">d</span><span class="op" id="5567996">.</span><span class="ident" id="5567997">b</span>&nbsp;<span class="op" id="5567999">=</span>&nbsp;<span class="ident" id="5568001">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568006">return</span>&nbsp;<span class="ident" id="5568013">d</span><br>
<span class="lineno"></span><span class="op" id="5568015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5568018">func</span>&nbsp;<span class="op" id="5568023">(</span><span class="ident" id="5568024">dec</span>&nbsp;<span class="op" id="5568028">*</span><span class="ident" id="5568029">Decoder</span><span class="op" id="5568036">)</span>&nbsp;<span class="ident" id="5568038">freeDecoderState</span><span class="op" id="5568054">(</span><span class="ident" id="5568055">d</span>&nbsp;<span class="op" id="5568057">*</span><span class="ident" id="5568058">decoderState</span><span class="op" id="5568070">)</span>&nbsp;<span class="op" id="5568072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568075">d</span><span class="op" id="5568076">.</span><span class="ident" id="5568077">next</span>&nbsp;<span class="op" id="5568082">=</span>&nbsp;<span class="ident" id="5568084">dec</span><span class="op" id="5568087">.</span><span class="ident" id="5568088">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568098">dec</span><span class="op" id="5568101">.</span><span class="ident" id="5568102">freeList</span>&nbsp;<span class="op" id="5568111">=</span>&nbsp;<span class="ident" id="5568113">d</span><br>
<span class="lineno"></span><span class="op" id="5568115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5568118">func</span>&nbsp;<span class="ident" id="5568123">overflow</span><span class="op" id="5568131">(</span><span class="ident" id="5568132">name</span>&nbsp;<span class="builtintype" id="5568137">string</span><span class="op" id="5568143">)</span>&nbsp;<span class="builtintype" id="5568145">error</span>&nbsp;<span class="op" id="5568151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568154">return</span>&nbsp;<span class="ident" id="5568161">errors</span><span class="op" id="5568167">.</span><span class="ident" id="5568168">New</span><span class="op" id="5568171">(</span><span class="string" id="5568172">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5568186">+</span>&nbsp;<span class="ident" id="5568188">name</span>&nbsp;<span class="op" id="5568193">+</span>&nbsp;<span class="string" id="5568195">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5568211">)</span><br>
<span class="lineno">115</span><span class="op" id="5568213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5568216">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5568289">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5568345">func</span>&nbsp;<span class="ident" id="5568350">decodeUintReader</span><span class="op" id="5568366">(</span><span class="ident" id="5568367">r</span>&nbsp;<span class="ident" id="5568369">io</span><span class="op" id="5568371">.</span><span class="ident" id="5568372">Reader</span><span class="op" id="5568378">,</span>&nbsp;<span class="ident" id="5568380">buf</span>&nbsp;<span class="op" id="5568384">[</span><span class="op" id="5568385">]</span><span class="builtintype" id="5568386">byte</span><span class="op" id="5568390">)</span>&nbsp;<span class="op" id="5568392">(</span><span class="ident" id="5568393">x</span>&nbsp;<span class="builtintype" id="5568395">uint64</span><span class="op" id="5568401">,</span>&nbsp;<span class="ident" id="5568403">width</span>&nbsp;<span class="builtintype" id="5568409">int</span><span class="op" id="5568412">,</span>&nbsp;<span class="ident" id="5568414">err</span>&nbsp;<span class="builtintype" id="5568418">error</span><span class="op" id="5568423">)</span>&nbsp;<span class="op" id="5568425">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568428">width</span>&nbsp;<span class="op" id="5568434">=</span>&nbsp;<span class="num" id="5568436">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568439">n</span><span class="op" id="5568440">,</span>&nbsp;<span class="ident" id="5568442">err</span>&nbsp;<span class="op" id="5568446">:=</span>&nbsp;<span class="ident" id="5568449">io</span><span class="op" id="5568451">.</span><span class="ident" id="5568452">ReadFull</span><span class="op" id="5568460">(</span><span class="ident" id="5568461">r</span><span class="op" id="5568462">,</span>&nbsp;<span class="ident" id="5568464">buf</span><span class="op" id="5568467">[</span><span class="num" id="5568468">0</span><span class="op" id="5568469">:</span><span class="ident" id="5568470">width</span><span class="op" id="5568475">]</span><span class="op" id="5568476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568479">if</span>&nbsp;<span class="ident" id="5568482">n</span>&nbsp;<span class="op" id="5568484">==</span>&nbsp;<span class="num" id="5568487">0</span>&nbsp;<span class="op" id="5568489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568493">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568501">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568504">b</span>&nbsp;<span class="op" id="5568506">:=</span>&nbsp;<span class="ident" id="5568509">buf</span><span class="op" id="5568512">[</span><span class="num" id="5568513">0</span><span class="op" id="5568514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568517">if</span>&nbsp;<span class="ident" id="5568520">b</span>&nbsp;<span class="op" id="5568522">&lt;=</span>&nbsp;<span class="num" id="5568525">0x7f</span>&nbsp;<span class="op" id="5568530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568534">return</span>&nbsp;<span class="builtintype" id="5568541">uint64</span><span class="op" id="5568547">(</span><span class="ident" id="5568548">b</span><span class="op" id="5568549">)</span><span class="op" id="5568550">,</span>&nbsp;<span class="ident" id="5568552">width</span><span class="op" id="5568557">,</span>&nbsp;<span class="builtintype" id="5568559">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568567">n</span>&nbsp;<span class="op" id="5568569">=</span>&nbsp;<span class="op" id="5568571">-</span><span class="builtintype" id="5568572">int</span><span class="op" id="5568575">(</span><span class="builtintype" id="5568576">int8</span><span class="op" id="5568580">(</span><span class="ident" id="5568581">b</span><span class="op" id="5568582">)</span><span class="op" id="5568583">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568586">if</span>&nbsp;<span class="ident" id="5568589">n</span>&nbsp;<span class="op" id="5568591">&gt;</span>&nbsp;<span class="ident" id="5568593">uint64Size</span>&nbsp;<span class="op" id="5568604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568608">err</span>&nbsp;<span class="op" id="5568612">=</span>&nbsp;<span class="ident" id="5568614">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568638">width</span><span class="op" id="5568643">,</span>&nbsp;<span class="ident" id="5568645">err</span>&nbsp;<span class="op" id="5568649">=</span>&nbsp;<span class="ident" id="5568651">io</span><span class="op" id="5568653">.</span><span class="ident" id="5568654">ReadFull</span><span class="op" id="5568662">(</span><span class="ident" id="5568663">r</span><span class="op" id="5568664">,</span>&nbsp;<span class="ident" id="5568666">buf</span><span class="op" id="5568669">[</span><span class="num" id="5568670">0</span><span class="op" id="5568671">:</span><span class="ident" id="5568672">n</span><span class="op" id="5568673">]</span><span class="op" id="5568674">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568677">if</span>&nbsp;<span class="ident" id="5568680">err</span>&nbsp;<span class="op" id="5568684">!=</span>&nbsp;<span class="builtintype" id="5568687">nil</span>&nbsp;<span class="op" id="5568691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568695">if</span>&nbsp;<span class="ident" id="5568698">err</span>&nbsp;<span class="op" id="5568702">==</span>&nbsp;<span class="ident" id="5568705">io</span><span class="op" id="5568707">.</span><span class="ident" id="5568708">EOF</span>&nbsp;<span class="op" id="5568712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568717">err</span>&nbsp;<span class="op" id="5568721">=</span>&nbsp;<span class="ident" id="5568723">io</span><span class="op" id="5568725">.</span><span class="ident" id="5568726">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568749">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5568760">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568826">for</span>&nbsp;<span class="ident" id="5568830">_</span><span class="op" id="5568831">,</span>&nbsp;<span class="ident" id="5568833">b</span>&nbsp;<span class="op" id="5568835">:=</span>&nbsp;<span class="keyword" id="5568838">range</span>&nbsp;<span class="ident" id="5568844">buf</span><span class="op" id="5568847">[</span><span class="num" id="5568848">0</span><span class="op" id="5568849">:</span><span class="ident" id="5568850">width</span><span class="op" id="5568855">]</span>&nbsp;<span class="op" id="5568857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568861">x</span>&nbsp;<span class="op" id="5568863">=</span>&nbsp;<span class="ident" id="5568865">x</span><span class="op" id="5568866">&lt;&lt;</span><span class="num" id="5568868">8</span>&nbsp;<span class="op" id="5568870">|</span>&nbsp;<span class="builtintype" id="5568872">uint64</span><span class="op" id="5568878">(</span><span class="ident" id="5568879">b</span><span class="op" id="5568880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568883">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568886">width</span><span class="op" id="5568891">++</span>&nbsp;<span class="comment" id="5568894">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568917">return</span><br>
<span class="lineno"></span><span class="op" id="5568924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5568927">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="5568989">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5569021">func</span>&nbsp;<span class="op" id="5569026">(</span><span class="ident" id="5569027">state</span>&nbsp;<span class="op" id="5569033">*</span><span class="ident" id="5569034">decoderState</span><span class="op" id="5569046">)</span>&nbsp;<span class="ident" id="5569048">decodeUint</span><span class="op" id="5569058">(</span><span class="op" id="5569059">)</span>&nbsp;<span class="op" id="5569061">(</span><span class="ident" id="5569062">x</span>&nbsp;<span class="builtintype" id="5569064">uint64</span><span class="op" id="5569070">)</span>&nbsp;<span class="op" id="5569072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569075">b</span><span class="op" id="5569076">,</span>&nbsp;<span class="ident" id="5569078">err</span>&nbsp;<span class="op" id="5569082">:=</span>&nbsp;<span class="ident" id="5569085">state</span><span class="op" id="5569090">.</span><span class="ident" id="5569091">b</span><span class="op" id="5569092">.</span><span class="ident" id="5569093">ReadByte</span><span class="op" id="5569101">(</span><span class="op" id="5569102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569105">if</span>&nbsp;<span class="ident" id="5569108">err</span>&nbsp;<span class="op" id="5569112">!=</span>&nbsp;<span class="builtintype" id="5569115">nil</span>&nbsp;<span class="op" id="5569119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569123">error_</span><span class="op" id="5569129">(</span><span class="ident" id="5569130">err</span><span class="op" id="5569133">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569139">if</span>&nbsp;<span class="ident" id="5569142">b</span>&nbsp;<span class="op" id="5569144">&lt;=</span>&nbsp;<span class="num" id="5569147">0x7f</span>&nbsp;<span class="op" id="5569152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569156">return</span>&nbsp;<span class="builtintype" id="5569163">uint64</span><span class="op" id="5569169">(</span><span class="ident" id="5569170">b</span><span class="op" id="5569171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569177">n</span>&nbsp;<span class="op" id="5569179">:=</span>&nbsp;<span class="op" id="5569182">-</span><span class="builtintype" id="5569183">int</span><span class="op" id="5569186">(</span><span class="builtintype" id="5569187">int8</span><span class="op" id="5569191">(</span><span class="ident" id="5569192">b</span><span class="op" id="5569193">)</span><span class="op" id="5569194">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569197">if</span>&nbsp;<span class="ident" id="5569200">n</span>&nbsp;<span class="op" id="5569202">&gt;</span>&nbsp;<span class="ident" id="5569204">uint64Size</span>&nbsp;<span class="op" id="5569215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569219">error_</span><span class="op" id="5569225">(</span><span class="ident" id="5569226">errBadUint</span><span class="op" id="5569236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569242">width</span><span class="op" id="5569247">,</span>&nbsp;<span class="ident" id="5569249">err</span>&nbsp;<span class="op" id="5569253">:=</span>&nbsp;<span class="ident" id="5569256">state</span><span class="op" id="5569261">.</span><span class="ident" id="5569262">b</span><span class="op" id="5569263">.</span><span class="ident" id="5569264">Read</span><span class="op" id="5569268">(</span><span class="ident" id="5569269">state</span><span class="op" id="5569274">.</span><span class="ident" id="5569275">buf</span><span class="op" id="5569278">[</span><span class="num" id="5569279">0</span><span class="op" id="5569280">:</span><span class="ident" id="5569281">n</span><span class="op" id="5569282">]</span><span class="op" id="5569283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569286">if</span>&nbsp;<span class="ident" id="5569289">err</span>&nbsp;<span class="op" id="5569293">!=</span>&nbsp;<span class="builtintype" id="5569296">nil</span>&nbsp;<span class="op" id="5569300">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569304">error_</span><span class="op" id="5569310">(</span><span class="ident" id="5569311">err</span><span class="op" id="5569314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5569320">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5569381">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569447">for</span>&nbsp;<span class="ident" id="5569451">_</span><span class="op" id="5569452">,</span>&nbsp;<span class="ident" id="5569454">b</span>&nbsp;<span class="op" id="5569456">:=</span>&nbsp;<span class="keyword" id="5569459">range</span>&nbsp;<span class="ident" id="5569465">state</span><span class="op" id="5569470">.</span><span class="ident" id="5569471">buf</span><span class="op" id="5569474">[</span><span class="num" id="5569475">0</span><span class="op" id="5569476">:</span><span class="ident" id="5569477">width</span><span class="op" id="5569482">]</span>&nbsp;<span class="op" id="5569484">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569488">x</span>&nbsp;<span class="op" id="5569490">=</span>&nbsp;<span class="ident" id="5569492">x</span><span class="op" id="5569493">&lt;&lt;</span><span class="num" id="5569495">8</span>&nbsp;<span class="op" id="5569497">|</span>&nbsp;<span class="builtintype" id="5569499">uint64</span><span class="op" id="5569505">(</span><span class="ident" id="5569506">b</span><span class="op" id="5569507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569513">return</span>&nbsp;<span class="ident" id="5569520">x</span><br>
<span class="lineno"></span><span class="op" id="5569522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5569525">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="5569584">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5569616">func</span>&nbsp;<span class="op" id="5569621">(</span><span class="ident" id="5569622">state</span>&nbsp;<span class="op" id="5569628">*</span><span class="ident" id="5569629">decoderState</span><span class="op" id="5569641">)</span>&nbsp;<span class="ident" id="5569643">decodeInt</span><span class="op" id="5569652">(</span><span class="op" id="5569653">)</span>&nbsp;<span class="builtintype" id="5569655">int64</span>&nbsp;<span class="op" id="5569661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569664">x</span>&nbsp;<span class="op" id="5569666">:=</span>&nbsp;<span class="ident" id="5569669">state</span><span class="op" id="5569674">.</span><span class="ident" id="5569675">decodeUint</span><span class="op" id="5569685">(</span><span class="op" id="5569686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569689">if</span>&nbsp;<span class="ident" id="5569692">x</span><span class="op" id="5569693">&amp;</span><span class="num" id="5569694">1</span>&nbsp;<span class="op" id="5569696">!=</span>&nbsp;<span class="num" id="5569699">0</span>&nbsp;<span class="op" id="5569701">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569705">return</span>&nbsp;<span class="op" id="5569712">^</span><span class="builtintype" id="5569713">int64</span><span class="op" id="5569718">(</span><span class="ident" id="5569719">x</span>&nbsp;<span class="op" id="5569721">&gt;&gt;</span>&nbsp;<span class="num" id="5569724">1</span><span class="op" id="5569725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569731">return</span>&nbsp;<span class="builtintype" id="5569738">int64</span><span class="op" id="5569743">(</span><span class="ident" id="5569744">x</span>&nbsp;<span class="op" id="5569746">&gt;&gt;</span>&nbsp;<span class="num" id="5569749">1</span><span class="op" id="5569750">)</span><br>
<span class="lineno"></span><span class="op" id="5569752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5569755">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5569822">type</span>&nbsp;<span class="ident" id="5569827">decOp</span>&nbsp;<span class="keyword" id="5569833">func</span><span class="op" id="5569837">(</span><span class="ident" id="5569838">i</span>&nbsp;<span class="op" id="5569840">*</span><span class="ident" id="5569841">decInstr</span><span class="op" id="5569849">,</span>&nbsp;<span class="ident" id="5569851">state</span>&nbsp;<span class="op" id="5569857">*</span><span class="ident" id="5569858">decoderState</span><span class="op" id="5569870">,</span>&nbsp;<span class="ident" id="5569872">v</span>&nbsp;<span class="ident" id="5569874">reflect</span><span class="op" id="5569881">.</span><span class="ident" id="5569882">Value</span><span class="op" id="5569887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5569890">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="5569936">type</span>&nbsp;<span class="ident" id="5569941">decInstr</span>&nbsp;<span class="keyword" id="5569950">struct</span>&nbsp;<span class="op" id="5569957">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569960">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569966">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569973">field</span>&nbsp;<span class="builtintype" id="5569979">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5569985">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570019">index</span>&nbsp;<span class="op" id="5570025">[</span><span class="op" id="5570026">]</span><span class="builtintype" id="5570027">int</span>&nbsp;<span class="comment" id="5570031">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570077">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="5570083">error</span>&nbsp;<span class="comment" id="5570089">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="5570159">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5570162">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5570219">func</span>&nbsp;<span class="ident" id="5570224">ignoreUint</span><span class="op" id="5570234">(</span><span class="ident" id="5570235">i</span>&nbsp;<span class="op" id="5570237">*</span><span class="ident" id="5570238">decInstr</span><span class="op" id="5570246">,</span>&nbsp;<span class="ident" id="5570248">state</span>&nbsp;<span class="op" id="5570254">*</span><span class="ident" id="5570255">decoderState</span><span class="op" id="5570267">,</span>&nbsp;<span class="ident" id="5570269">v</span>&nbsp;<span class="ident" id="5570271">reflect</span><span class="op" id="5570278">.</span><span class="ident" id="5570279">Value</span><span class="op" id="5570284">)</span>&nbsp;<span class="op" id="5570286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570289">state</span><span class="op" id="5570294">.</span><span class="ident" id="5570295">decodeUint</span><span class="op" id="5570305">(</span><span class="op" id="5570306">)</span><br>
<span class="lineno"></span><span class="op" id="5570308">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5570311">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="5570390">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5570409">func</span>&nbsp;<span class="ident" id="5570414">ignoreTwoUints</span><span class="op" id="5570428">(</span><span class="ident" id="5570429">i</span>&nbsp;<span class="op" id="5570431">*</span><span class="ident" id="5570432">decInstr</span><span class="op" id="5570440">,</span>&nbsp;<span class="ident" id="5570442">state</span>&nbsp;<span class="op" id="5570448">*</span><span class="ident" id="5570449">decoderState</span><span class="op" id="5570461">,</span>&nbsp;<span class="ident" id="5570463">v</span>&nbsp;<span class="ident" id="5570465">reflect</span><span class="op" id="5570472">.</span><span class="ident" id="5570473">Value</span><span class="op" id="5570478">)</span>&nbsp;<span class="op" id="5570480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570483">state</span><span class="op" id="5570488">.</span><span class="ident" id="5570489">decodeUint</span><span class="op" id="5570499">(</span><span class="op" id="5570500">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570503">state</span><span class="op" id="5570508">.</span><span class="ident" id="5570509">decodeUint</span><span class="op" id="5570519">(</span><span class="op" id="5570520">)</span><br>
<span class="lineno"></span><span class="op" id="5570522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5570525">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5570597">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="5570670">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="5570714">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5570786">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5570865">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5570878">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5570942">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="5571030">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="5571108">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5571153">func</span>&nbsp;<span class="ident" id="5571158">decAlloc</span><span class="op" id="5571166">(</span><span class="ident" id="5571167">v</span>&nbsp;<span class="ident" id="5571169">reflect</span><span class="op" id="5571176">.</span><span class="ident" id="5571177">Value</span><span class="op" id="5571182">)</span>&nbsp;<span class="ident" id="5571184">reflect</span><span class="op" id="5571191">.</span><span class="ident" id="5571192">Value</span>&nbsp;<span class="op" id="5571198">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571201">for</span>&nbsp;<span class="ident" id="5571205">v</span><span class="op" id="5571206">.</span><span class="ident" id="5571207">Kind</span><span class="op" id="5571211">(</span><span class="op" id="5571212">)</span>&nbsp;<span class="op" id="5571214">==</span>&nbsp;<span class="ident" id="5571217">reflect</span><span class="op" id="5571224">.</span><span class="ident" id="5571225">Ptr</span>&nbsp;<span class="op" id="5571229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571233">if</span>&nbsp;<span class="ident" id="5571236">v</span><span class="op" id="5571237">.</span><span class="ident" id="5571238">IsNil</span><span class="op" id="5571243">(</span><span class="op" id="5571244">)</span>&nbsp;<span class="op" id="5571246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571251">v</span><span class="op" id="5571252">.</span><span class="ident" id="5571253">Set</span><span class="op" id="5571256">(</span><span class="ident" id="5571257">reflect</span><span class="op" id="5571264">.</span><span class="ident" id="5571265">New</span><span class="op" id="5571268">(</span><span class="ident" id="5571269">v</span><span class="op" id="5571270">.</span><span class="ident" id="5571271">Type</span><span class="op" id="5571275">(</span><span class="op" id="5571276">)</span><span class="op" id="5571277">.</span><span class="ident" id="5571278">Elem</span><span class="op" id="5571282">(</span><span class="op" id="5571283">)</span><span class="op" id="5571284">)</span><span class="op" id="5571285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571293">v</span>&nbsp;<span class="op" id="5571295">=</span>&nbsp;<span class="ident" id="5571297">v</span><span class="op" id="5571298">.</span><span class="ident" id="5571299">Elem</span><span class="op" id="5571303">(</span><span class="op" id="5571304">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571310">return</span>&nbsp;<span class="ident" id="5571317">v</span><br>
<span class="lineno"></span><span class="op" id="5571319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5571322">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="5571385">func</span>&nbsp;<span class="ident" id="5571390">decBool</span><span class="op" id="5571397">(</span><span class="ident" id="5571398">i</span>&nbsp;<span class="op" id="5571400">*</span><span class="ident" id="5571401">decInstr</span><span class="op" id="5571409">,</span>&nbsp;<span class="ident" id="5571411">state</span>&nbsp;<span class="op" id="5571417">*</span><span class="ident" id="5571418">decoderState</span><span class="op" id="5571430">,</span>&nbsp;<span class="ident" id="5571432">value</span>&nbsp;<span class="ident" id="5571438">reflect</span><span class="op" id="5571445">.</span><span class="ident" id="5571446">Value</span><span class="op" id="5571451">)</span>&nbsp;<span class="op" id="5571453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571456">value</span><span class="op" id="5571461">.</span><span class="ident" id="5571462">SetBool</span><span class="op" id="5571469">(</span><span class="ident" id="5571470">state</span><span class="op" id="5571475">.</span><span class="ident" id="5571476">decodeUint</span><span class="op" id="5571486">(</span><span class="op" id="5571487">)</span>&nbsp;<span class="op" id="5571489">!=</span>&nbsp;<span class="num" id="5571492">0</span><span class="op" id="5571493">)</span><br>
<span class="lineno"></span><span class="op" id="5571495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5571498">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="5571563">func</span>&nbsp;<span class="ident" id="5571568">decInt8</span><span class="op" id="5571575">(</span><span class="ident" id="5571576">i</span>&nbsp;<span class="op" id="5571578">*</span><span class="ident" id="5571579">decInstr</span><span class="op" id="5571587">,</span>&nbsp;<span class="ident" id="5571589">state</span>&nbsp;<span class="op" id="5571595">*</span><span class="ident" id="5571596">decoderState</span><span class="op" id="5571608">,</span>&nbsp;<span class="ident" id="5571610">value</span>&nbsp;<span class="ident" id="5571616">reflect</span><span class="op" id="5571623">.</span><span class="ident" id="5571624">Value</span><span class="op" id="5571629">)</span>&nbsp;<span class="op" id="5571631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571634">v</span>&nbsp;<span class="op" id="5571636">:=</span>&nbsp;<span class="ident" id="5571639">state</span><span class="op" id="5571644">.</span><span class="ident" id="5571645">decodeInt</span><span class="op" id="5571654">(</span><span class="op" id="5571655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571658">if</span>&nbsp;<span class="ident" id="5571661">v</span>&nbsp;<span class="op" id="5571663">&lt;</span>&nbsp;<span class="ident" id="5571665">math</span><span class="op" id="5571669">.</span><span class="ident" id="5571670">MinInt8</span>&nbsp;<span class="op" id="5571678">||</span>&nbsp;<span class="ident" id="5571681">math</span><span class="op" id="5571685">.</span><span class="ident" id="5571686">MaxInt8</span>&nbsp;<span class="op" id="5571694">&lt;</span>&nbsp;<span class="ident" id="5571696">v</span>&nbsp;<span class="op" id="5571698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571702">error_</span><span class="op" id="5571708">(</span><span class="ident" id="5571709">i</span><span class="op" id="5571710">.</span><span class="ident" id="5571711">ovfl</span><span class="op" id="5571715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571718">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571721">value</span><span class="op" id="5571726">.</span><span class="ident" id="5571727">SetInt</span><span class="op" id="5571733">(</span><span class="ident" id="5571734">v</span><span class="op" id="5571735">)</span><br>
<span class="lineno"></span><span class="op" id="5571737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5571740">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5571815">func</span>&nbsp;<span class="ident" id="5571820">decUint8</span><span class="op" id="5571828">(</span><span class="ident" id="5571829">i</span>&nbsp;<span class="op" id="5571831">*</span><span class="ident" id="5571832">decInstr</span><span class="op" id="5571840">,</span>&nbsp;<span class="ident" id="5571842">state</span>&nbsp;<span class="op" id="5571848">*</span><span class="ident" id="5571849">decoderState</span><span class="op" id="5571861">,</span>&nbsp;<span class="ident" id="5571863">value</span>&nbsp;<span class="ident" id="5571869">reflect</span><span class="op" id="5571876">.</span><span class="ident" id="5571877">Value</span><span class="op" id="5571882">)</span>&nbsp;<span class="op" id="5571884">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571887">v</span>&nbsp;<span class="op" id="5571889">:=</span>&nbsp;<span class="ident" id="5571892">state</span><span class="op" id="5571897">.</span><span class="ident" id="5571898">decodeUint</span><span class="op" id="5571908">(</span><span class="op" id="5571909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571912">if</span>&nbsp;<span class="ident" id="5571915">math</span><span class="op" id="5571919">.</span><span class="ident" id="5571920">MaxUint8</span>&nbsp;<span class="op" id="5571929">&lt;</span>&nbsp;<span class="ident" id="5571931">v</span>&nbsp;<span class="op" id="5571933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571937">error_</span><span class="op" id="5571943">(</span><span class="ident" id="5571944">i</span><span class="op" id="5571945">.</span><span class="ident" id="5571946">ovfl</span><span class="op" id="5571950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571956">value</span><span class="op" id="5571961">.</span><span class="ident" id="5571962">SetUint</span><span class="op" id="5571969">(</span><span class="ident" id="5571970">v</span><span class="op" id="5571971">)</span><br>
<span class="lineno">250</span><span class="op" id="5571973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5571976">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5572043">func</span>&nbsp;<span class="ident" id="5572048">decInt16</span><span class="op" id="5572056">(</span><span class="ident" id="5572057">i</span>&nbsp;<span class="op" id="5572059">*</span><span class="ident" id="5572060">decInstr</span><span class="op" id="5572068">,</span>&nbsp;<span class="ident" id="5572070">state</span>&nbsp;<span class="op" id="5572076">*</span><span class="ident" id="5572077">decoderState</span><span class="op" id="5572089">,</span>&nbsp;<span class="ident" id="5572091">value</span>&nbsp;<span class="ident" id="5572097">reflect</span><span class="op" id="5572104">.</span><span class="ident" id="5572105">Value</span><span class="op" id="5572110">)</span>&nbsp;<span class="op" id="5572112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572115">v</span>&nbsp;<span class="op" id="5572117">:=</span>&nbsp;<span class="ident" id="5572120">state</span><span class="op" id="5572125">.</span><span class="ident" id="5572126">decodeInt</span><span class="op" id="5572135">(</span><span class="op" id="5572136">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572139">if</span>&nbsp;<span class="ident" id="5572142">v</span>&nbsp;<span class="op" id="5572144">&lt;</span>&nbsp;<span class="ident" id="5572146">math</span><span class="op" id="5572150">.</span><span class="ident" id="5572151">MinInt16</span>&nbsp;<span class="op" id="5572160">||</span>&nbsp;<span class="ident" id="5572163">math</span><span class="op" id="5572167">.</span><span class="ident" id="5572168">MaxInt16</span>&nbsp;<span class="op" id="5572177">&lt;</span>&nbsp;<span class="ident" id="5572179">v</span>&nbsp;<span class="op" id="5572181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572185">error_</span><span class="op" id="5572191">(</span><span class="ident" id="5572192">i</span><span class="op" id="5572193">.</span><span class="ident" id="5572194">ovfl</span><span class="op" id="5572198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572204">value</span><span class="op" id="5572209">.</span><span class="ident" id="5572210">SetInt</span><span class="op" id="5572216">(</span><span class="ident" id="5572217">v</span><span class="op" id="5572218">)</span><br>
<span class="lineno"></span><span class="op" id="5572220">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="5572223">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5572300">func</span>&nbsp;<span class="ident" id="5572305">decUint16</span><span class="op" id="5572314">(</span><span class="ident" id="5572315">i</span>&nbsp;<span class="op" id="5572317">*</span><span class="ident" id="5572318">decInstr</span><span class="op" id="5572326">,</span>&nbsp;<span class="ident" id="5572328">state</span>&nbsp;<span class="op" id="5572334">*</span><span class="ident" id="5572335">decoderState</span><span class="op" id="5572347">,</span>&nbsp;<span class="ident" id="5572349">value</span>&nbsp;<span class="ident" id="5572355">reflect</span><span class="op" id="5572362">.</span><span class="ident" id="5572363">Value</span><span class="op" id="5572368">)</span>&nbsp;<span class="op" id="5572370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572373">v</span>&nbsp;<span class="op" id="5572375">:=</span>&nbsp;<span class="ident" id="5572378">state</span><span class="op" id="5572383">.</span><span class="ident" id="5572384">decodeUint</span><span class="op" id="5572394">(</span><span class="op" id="5572395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572398">if</span>&nbsp;<span class="ident" id="5572401">math</span><span class="op" id="5572405">.</span><span class="ident" id="5572406">MaxUint16</span>&nbsp;<span class="op" id="5572416">&lt;</span>&nbsp;<span class="ident" id="5572418">v</span>&nbsp;<span class="op" id="5572420">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572424">error_</span><span class="op" id="5572430">(</span><span class="ident" id="5572431">i</span><span class="op" id="5572432">.</span><span class="ident" id="5572433">ovfl</span><span class="op" id="5572437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572443">value</span><span class="op" id="5572448">.</span><span class="ident" id="5572449">SetUint</span><span class="op" id="5572456">(</span><span class="ident" id="5572457">v</span><span class="op" id="5572458">)</span><br>
<span class="lineno"></span><span class="op" id="5572460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5572463">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5572530">func</span>&nbsp;<span class="ident" id="5572535">decInt32</span><span class="op" id="5572543">(</span><span class="ident" id="5572544">i</span>&nbsp;<span class="op" id="5572546">*</span><span class="ident" id="5572547">decInstr</span><span class="op" id="5572555">,</span>&nbsp;<span class="ident" id="5572557">state</span>&nbsp;<span class="op" id="5572563">*</span><span class="ident" id="5572564">decoderState</span><span class="op" id="5572576">,</span>&nbsp;<span class="ident" id="5572578">value</span>&nbsp;<span class="ident" id="5572584">reflect</span><span class="op" id="5572591">.</span><span class="ident" id="5572592">Value</span><span class="op" id="5572597">)</span>&nbsp;<span class="op" id="5572599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572602">v</span>&nbsp;<span class="op" id="5572604">:=</span>&nbsp;<span class="ident" id="5572607">state</span><span class="op" id="5572612">.</span><span class="ident" id="5572613">decodeInt</span><span class="op" id="5572622">(</span><span class="op" id="5572623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572626">if</span>&nbsp;<span class="ident" id="5572629">v</span>&nbsp;<span class="op" id="5572631">&lt;</span>&nbsp;<span class="ident" id="5572633">math</span><span class="op" id="5572637">.</span><span class="ident" id="5572638">MinInt32</span>&nbsp;<span class="op" id="5572647">||</span>&nbsp;<span class="ident" id="5572650">math</span><span class="op" id="5572654">.</span><span class="ident" id="5572655">MaxInt32</span>&nbsp;<span class="op" id="5572664">&lt;</span>&nbsp;<span class="ident" id="5572666">v</span>&nbsp;<span class="op" id="5572668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572672">error_</span><span class="op" id="5572678">(</span><span class="ident" id="5572679">i</span><span class="op" id="5572680">.</span><span class="ident" id="5572681">ovfl</span><span class="op" id="5572685">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572691">value</span><span class="op" id="5572696">.</span><span class="ident" id="5572697">SetInt</span><span class="op" id="5572703">(</span><span class="ident" id="5572704">v</span><span class="op" id="5572705">)</span><br>
<span class="lineno"></span><span class="op" id="5572707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5572710">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="5572787">func</span>&nbsp;<span class="ident" id="5572792">decUint32</span><span class="op" id="5572801">(</span><span class="ident" id="5572802">i</span>&nbsp;<span class="op" id="5572804">*</span><span class="ident" id="5572805">decInstr</span><span class="op" id="5572813">,</span>&nbsp;<span class="ident" id="5572815">state</span>&nbsp;<span class="op" id="5572821">*</span><span class="ident" id="5572822">decoderState</span><span class="op" id="5572834">,</span>&nbsp;<span class="ident" id="5572836">value</span>&nbsp;<span class="ident" id="5572842">reflect</span><span class="op" id="5572849">.</span><span class="ident" id="5572850">Value</span><span class="op" id="5572855">)</span>&nbsp;<span class="op" id="5572857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572860">v</span>&nbsp;<span class="op" id="5572862">:=</span>&nbsp;<span class="ident" id="5572865">state</span><span class="op" id="5572870">.</span><span class="ident" id="5572871">decodeUint</span><span class="op" id="5572881">(</span><span class="op" id="5572882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572885">if</span>&nbsp;<span class="ident" id="5572888">math</span><span class="op" id="5572892">.</span><span class="ident" id="5572893">MaxUint32</span>&nbsp;<span class="op" id="5572903">&lt;</span>&nbsp;<span class="ident" id="5572905">v</span>&nbsp;<span class="op" id="5572907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572911">error_</span><span class="op" id="5572917">(</span><span class="ident" id="5572918">i</span><span class="op" id="5572919">.</span><span class="ident" id="5572920">ovfl</span><span class="op" id="5572924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572927">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572930">value</span><span class="op" id="5572935">.</span><span class="ident" id="5572936">SetUint</span><span class="op" id="5572943">(</span><span class="ident" id="5572944">v</span><span class="op" id="5572945">)</span><br>
<span class="lineno"></span><span class="op" id="5572947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5572950">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5573017">func</span>&nbsp;<span class="ident" id="5573022">decInt64</span><span class="op" id="5573030">(</span><span class="ident" id="5573031">i</span>&nbsp;<span class="op" id="5573033">*</span><span class="ident" id="5573034">decInstr</span><span class="op" id="5573042">,</span>&nbsp;<span class="ident" id="5573044">state</span>&nbsp;<span class="op" id="5573050">*</span><span class="ident" id="5573051">decoderState</span><span class="op" id="5573063">,</span>&nbsp;<span class="ident" id="5573065">value</span>&nbsp;<span class="ident" id="5573071">reflect</span><span class="op" id="5573078">.</span><span class="ident" id="5573079">Value</span><span class="op" id="5573084">)</span>&nbsp;<span class="op" id="5573086">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573089">v</span>&nbsp;<span class="op" id="5573091">:=</span>&nbsp;<span class="ident" id="5573094">state</span><span class="op" id="5573099">.</span><span class="ident" id="5573100">decodeInt</span><span class="op" id="5573109">(</span><span class="op" id="5573110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573113">value</span><span class="op" id="5573118">.</span><span class="ident" id="5573119">SetInt</span><span class="op" id="5573125">(</span><span class="ident" id="5573126">v</span><span class="op" id="5573127">)</span><br>
<span class="lineno"></span><span class="op" id="5573129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5573132">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="5573209">func</span>&nbsp;<span class="ident" id="5573214">decUint64</span><span class="op" id="5573223">(</span><span class="ident" id="5573224">i</span>&nbsp;<span class="op" id="5573226">*</span><span class="ident" id="5573227">decInstr</span><span class="op" id="5573235">,</span>&nbsp;<span class="ident" id="5573237">state</span>&nbsp;<span class="op" id="5573243">*</span><span class="ident" id="5573244">decoderState</span><span class="op" id="5573256">,</span>&nbsp;<span class="ident" id="5573258">value</span>&nbsp;<span class="ident" id="5573264">reflect</span><span class="op" id="5573271">.</span><span class="ident" id="5573272">Value</span><span class="op" id="5573277">)</span>&nbsp;<span class="op" id="5573279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573282">v</span>&nbsp;<span class="op" id="5573284">:=</span>&nbsp;<span class="ident" id="5573287">state</span><span class="op" id="5573292">.</span><span class="ident" id="5573293">decodeUint</span><span class="op" id="5573303">(</span><span class="op" id="5573304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573307">value</span><span class="op" id="5573312">.</span><span class="ident" id="5573313">SetUint</span><span class="op" id="5573320">(</span><span class="ident" id="5573321">v</span><span class="op" id="5573322">)</span><br>
<span class="lineno"></span><span class="op" id="5573324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5573327">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5573397">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5573469">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="5573541">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5573606">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="5573622">func</span>&nbsp;<span class="ident" id="5573627">float64FromBits</span><span class="op" id="5573642">(</span><span class="ident" id="5573643">u</span>&nbsp;<span class="builtintype" id="5573645">uint64</span><span class="op" id="5573651">)</span>&nbsp;<span class="builtintype" id="5573653">float64</span>&nbsp;<span class="op" id="5573661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5573664">var</span>&nbsp;<span class="ident" id="5573668">v</span>&nbsp;<span class="builtintype" id="5573670">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5573678">for</span>&nbsp;<span class="ident" id="5573682">i</span>&nbsp;<span class="op" id="5573684">:=</span>&nbsp;<span class="num" id="5573687">0</span><span class="op" id="5573688">;</span>&nbsp;<span class="ident" id="5573690">i</span>&nbsp;<span class="op" id="5573692">&lt;</span>&nbsp;<span class="num" id="5573694">8</span><span class="op" id="5573695">;</span>&nbsp;<span class="ident" id="5573697">i</span><span class="op" id="5573698">++</span>&nbsp;<span class="op" id="5573701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573705">v</span>&nbsp;<span class="op" id="5573707">&lt;&lt;=</span>&nbsp;<span class="num" id="5573711">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573715">v</span>&nbsp;<span class="op" id="5573717">|=</span>&nbsp;<span class="ident" id="5573720">u</span>&nbsp;<span class="op" id="5573722">&amp;</span>&nbsp;<span class="num" id="5573724">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573731">u</span>&nbsp;<span class="op" id="5573733">&gt;&gt;=</span>&nbsp;<span class="num" id="5573737">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5573740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5573743">return</span>&nbsp;<span class="ident" id="5573750">math</span><span class="op" id="5573754">.</span><span class="ident" id="5573755">Float64frombits</span><span class="op" id="5573770">(</span><span class="ident" id="5573771">v</span><span class="op" id="5573772">)</span><br>
<span class="lineno"></span><span class="op" id="5573774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5573777">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5573862">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="5573939">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5574016">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="5574079">func</span>&nbsp;<span class="ident" id="5574084">float32FromBits</span><span class="op" id="5574099">(</span><span class="ident" id="5574100">u</span>&nbsp;<span class="builtintype" id="5574102">uint64</span><span class="op" id="5574108">,</span>&nbsp;<span class="ident" id="5574110">ovfl</span>&nbsp;<span class="builtintype" id="5574115">error</span><span class="op" id="5574120">)</span>&nbsp;<span class="builtintype" id="5574122">float64</span>&nbsp;<span class="op" id="5574130">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574133">v</span>&nbsp;<span class="op" id="5574135">:=</span>&nbsp;<span class="ident" id="5574138">float64FromBits</span><span class="op" id="5574153">(</span><span class="ident" id="5574154">u</span><span class="op" id="5574155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574158">av</span>&nbsp;<span class="op" id="5574161">:=</span>&nbsp;<span class="ident" id="5574164">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5574167">if</span>&nbsp;<span class="ident" id="5574170">av</span>&nbsp;<span class="op" id="5574173">&lt;</span>&nbsp;<span class="num" id="5574175">0</span>&nbsp;<span class="op" id="5574177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574181">av</span>&nbsp;<span class="op" id="5574184">=</span>&nbsp;<span class="op" id="5574186">-</span><span class="ident" id="5574187">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5574191">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574194">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5574265">if</span>&nbsp;<span class="ident" id="5574268">math</span><span class="op" id="5574272">.</span><span class="ident" id="5574273">MaxFloat32</span>&nbsp;<span class="op" id="5574284">&lt;</span>&nbsp;<span class="ident" id="5574286">av</span>&nbsp;<span class="op" id="5574289">&amp;&amp;</span>&nbsp;<span class="ident" id="5574292">av</span>&nbsp;<span class="op" id="5574295">&lt;=</span>&nbsp;<span class="ident" id="5574298">math</span><span class="op" id="5574302">.</span><span class="ident" id="5574303">MaxFloat64</span>&nbsp;<span class="op" id="5574314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574318">error_</span><span class="op" id="5574324">(</span><span class="ident" id="5574325">ovfl</span><span class="op" id="5574329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5574332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5574335">return</span>&nbsp;<span class="ident" id="5574342">v</span><br>
<span class="lineno">330</span><span class="op" id="5574344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574347">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5574427">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5574462">func</span>&nbsp;<span class="ident" id="5574467">decFloat32</span><span class="op" id="5574477">(</span><span class="ident" id="5574478">i</span>&nbsp;<span class="op" id="5574480">*</span><span class="ident" id="5574481">decInstr</span><span class="op" id="5574489">,</span>&nbsp;<span class="ident" id="5574491">state</span>&nbsp;<span class="op" id="5574497">*</span><span class="ident" id="5574498">decoderState</span><span class="op" id="5574510">,</span>&nbsp;<span class="ident" id="5574512">value</span>&nbsp;<span class="ident" id="5574518">reflect</span><span class="op" id="5574525">.</span><span class="ident" id="5574526">Value</span><span class="op" id="5574531">)</span>&nbsp;<span class="op" id="5574533">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574536">value</span><span class="op" id="5574541">.</span><span class="ident" id="5574542">SetFloat</span><span class="op" id="5574550">(</span><span class="ident" id="5574551">float32FromBits</span><span class="op" id="5574566">(</span><span class="ident" id="5574567">state</span><span class="op" id="5574572">.</span><span class="ident" id="5574573">decodeUint</span><span class="op" id="5574583">(</span><span class="op" id="5574584">)</span><span class="op" id="5574585">,</span>&nbsp;<span class="ident" id="5574587">i</span><span class="op" id="5574588">.</span><span class="ident" id="5574589">ovfl</span><span class="op" id="5574593">)</span><span class="op" id="5574594">)</span><br>
<span class="lineno"></span><span class="op" id="5574596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574599">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5574679">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="5574714">func</span>&nbsp;<span class="ident" id="5574719">decFloat64</span><span class="op" id="5574729">(</span><span class="ident" id="5574730">i</span>&nbsp;<span class="op" id="5574732">*</span><span class="ident" id="5574733">decInstr</span><span class="op" id="5574741">,</span>&nbsp;<span class="ident" id="5574743">state</span>&nbsp;<span class="op" id="5574749">*</span><span class="ident" id="5574750">decoderState</span><span class="op" id="5574762">,</span>&nbsp;<span class="ident" id="5574764">value</span>&nbsp;<span class="ident" id="5574770">reflect</span><span class="op" id="5574777">.</span><span class="ident" id="5574778">Value</span><span class="op" id="5574783">)</span>&nbsp;<span class="op" id="5574785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574788">value</span><span class="op" id="5574793">.</span><span class="ident" id="5574794">SetFloat</span><span class="op" id="5574802">(</span><span class="ident" id="5574803">float64FromBits</span><span class="op" id="5574818">(</span><span class="ident" id="5574819">state</span><span class="op" id="5574824">.</span><span class="ident" id="5574825">decodeUint</span><span class="op" id="5574835">(</span><span class="op" id="5574836">)</span><span class="op" id="5574837">)</span><span class="op" id="5574838">)</span><br>
<span class="lineno"></span><span class="op" id="5574840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574843">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="5574913">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5574989">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5575019">func</span>&nbsp;<span class="ident" id="5575024">decComplex64</span><span class="op" id="5575036">(</span><span class="ident" id="5575037">i</span>&nbsp;<span class="op" id="5575039">*</span><span class="ident" id="5575040">decInstr</span><span class="op" id="5575048">,</span>&nbsp;<span class="ident" id="5575050">state</span>&nbsp;<span class="op" id="5575056">*</span><span class="ident" id="5575057">decoderState</span><span class="op" id="5575069">,</span>&nbsp;<span class="ident" id="5575071">value</span>&nbsp;<span class="ident" id="5575077">reflect</span><span class="op" id="5575084">.</span><span class="ident" id="5575085">Value</span><span class="op" id="5575090">)</span>&nbsp;<span class="op" id="5575092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5575095">real</span>&nbsp;<span class="op" id="5575100">:=</span>&nbsp;<span class="ident" id="5575103">float32FromBits</span><span class="op" id="5575118">(</span><span class="ident" id="5575119">state</span><span class="op" id="5575124">.</span><span class="ident" id="5575125">decodeUint</span><span class="op" id="5575135">(</span><span class="op" id="5575136">)</span><span class="op" id="5575137">,</span>&nbsp;<span class="ident" id="5575139">i</span><span class="op" id="5575140">.</span><span class="ident" id="5575141">ovfl</span><span class="op" id="5575145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5575148">imag</span>&nbsp;<span class="op" id="5575153">:=</span>&nbsp;<span class="ident" id="5575156">float32FromBits</span><span class="op" id="5575171">(</span><span class="ident" id="5575172">state</span><span class="op" id="5575177">.</span><span class="ident" id="5575178">decodeUint</span><span class="op" id="5575188">(</span><span class="op" id="5575189">)</span><span class="op" id="5575190">,</span>&nbsp;<span class="ident" id="5575192">i</span><span class="op" id="5575193">.</span><span class="ident" id="5575194">ovfl</span><span class="op" id="5575198">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575201">value</span><span class="op" id="5575206">.</span><span class="ident" id="5575207">SetComplex</span><span class="op" id="5575217">(</span><span class="builtinfunc" id="5575218">complex</span><span class="op" id="5575225">(</span><span class="builtinfunc" id="5575226">real</span><span class="op" id="5575230">,</span>&nbsp;<span class="builtinfunc" id="5575232">imag</span><span class="op" id="5575236">)</span><span class="op" id="5575237">)</span><br>
<span class="lineno"></span><span class="op" id="5575239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575242">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5575313">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="5575390">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5575420">func</span>&nbsp;<span class="ident" id="5575425">decComplex128</span><span class="op" id="5575438">(</span><span class="ident" id="5575439">i</span>&nbsp;<span class="op" id="5575441">*</span><span class="ident" id="5575442">decInstr</span><span class="op" id="5575450">,</span>&nbsp;<span class="ident" id="5575452">state</span>&nbsp;<span class="op" id="5575458">*</span><span class="ident" id="5575459">decoderState</span><span class="op" id="5575471">,</span>&nbsp;<span class="ident" id="5575473">value</span>&nbsp;<span class="ident" id="5575479">reflect</span><span class="op" id="5575486">.</span><span class="ident" id="5575487">Value</span><span class="op" id="5575492">)</span>&nbsp;<span class="op" id="5575494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5575497">real</span>&nbsp;<span class="op" id="5575502">:=</span>&nbsp;<span class="ident" id="5575505">float64FromBits</span><span class="op" id="5575520">(</span><span class="ident" id="5575521">state</span><span class="op" id="5575526">.</span><span class="ident" id="5575527">decodeUint</span><span class="op" id="5575537">(</span><span class="op" id="5575538">)</span><span class="op" id="5575539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5575542">imag</span>&nbsp;<span class="op" id="5575547">:=</span>&nbsp;<span class="ident" id="5575550">float64FromBits</span><span class="op" id="5575565">(</span><span class="ident" id="5575566">state</span><span class="op" id="5575571">.</span><span class="ident" id="5575572">decodeUint</span><span class="op" id="5575582">(</span><span class="op" id="5575583">)</span><span class="op" id="5575584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575587">value</span><span class="op" id="5575592">.</span><span class="ident" id="5575593">SetComplex</span><span class="op" id="5575603">(</span><span class="builtinfunc" id="5575604">complex</span><span class="op" id="5575611">(</span><span class="builtinfunc" id="5575612">real</span><span class="op" id="5575616">,</span>&nbsp;<span class="builtinfunc" id="5575618">imag</span><span class="op" id="5575622">)</span><span class="op" id="5575623">)</span><br>
<span class="lineno">360</span><span class="op" id="5575625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575628">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5575701">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5575725">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="5575801">func</span>&nbsp;<span class="ident" id="5575806">decUint8Slice</span><span class="op" id="5575819">(</span><span class="ident" id="5575820">i</span>&nbsp;<span class="op" id="5575822">*</span><span class="ident" id="5575823">decInstr</span><span class="op" id="5575831">,</span>&nbsp;<span class="ident" id="5575833">state</span>&nbsp;<span class="op" id="5575839">*</span><span class="ident" id="5575840">decoderState</span><span class="op" id="5575852">,</span>&nbsp;<span class="ident" id="5575854">value</span>&nbsp;<span class="ident" id="5575860">reflect</span><span class="op" id="5575867">.</span><span class="ident" id="5575868">Value</span><span class="op" id="5575873">)</span>&nbsp;<span class="op" id="5575875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575878">u</span>&nbsp;<span class="op" id="5575880">:=</span>&nbsp;<span class="ident" id="5575883">state</span><span class="op" id="5575888">.</span><span class="ident" id="5575889">decodeUint</span><span class="op" id="5575899">(</span><span class="op" id="5575900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575903">n</span>&nbsp;<span class="op" id="5575905">:=</span>&nbsp;<span class="builtintype" id="5575908">int</span><span class="op" id="5575911">(</span><span class="ident" id="5575912">u</span><span class="op" id="5575913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575916">if</span>&nbsp;<span class="ident" id="5575919">n</span>&nbsp;<span class="op" id="5575921">&lt;</span>&nbsp;<span class="num" id="5575923">0</span>&nbsp;<span class="op" id="5575925">||</span>&nbsp;<span class="builtintype" id="5575928">uint64</span><span class="op" id="5575934">(</span><span class="ident" id="5575935">n</span><span class="op" id="5575936">)</span>&nbsp;<span class="op" id="5575938">!=</span>&nbsp;<span class="ident" id="5575941">u</span>&nbsp;<span class="op" id="5575943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575947">errorf</span><span class="op" id="5575953">(</span><span class="string" id="5575954">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5575998">,</span>&nbsp;<span class="ident" id="5576000">value</span><span class="op" id="5576005">.</span><span class="ident" id="5576006">Type</span><span class="op" id="5576010">(</span><span class="op" id="5576011">)</span><span class="op" id="5576012">,</span>&nbsp;<span class="ident" id="5576014">u</span><span class="op" id="5576015">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576021">if</span>&nbsp;<span class="ident" id="5576024">n</span>&nbsp;<span class="op" id="5576026">&gt;</span>&nbsp;<span class="ident" id="5576028">state</span><span class="op" id="5576033">.</span><span class="ident" id="5576034">b</span><span class="op" id="5576035">.</span><span class="ident" id="5576036">Len</span><span class="op" id="5576039">(</span><span class="op" id="5576040">)</span>&nbsp;<span class="op" id="5576042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576046">errorf</span><span class="op" id="5576052">(</span><span class="string" id="5576053">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5576086">,</span>&nbsp;<span class="ident" id="5576088">value</span><span class="op" id="5576093">.</span><span class="ident" id="5576094">Type</span><span class="op" id="5576098">(</span><span class="op" id="5576099">)</span><span class="op" id="5576100">,</span>&nbsp;<span class="ident" id="5576102">n</span><span class="op" id="5576103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576109">if</span>&nbsp;<span class="ident" id="5576112">n</span>&nbsp;<span class="op" id="5576114">&gt;</span>&nbsp;<span class="ident" id="5576116">tooBig</span>&nbsp;<span class="op" id="5576123">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576127">errorf</span><span class="op" id="5576133">(</span><span class="string" id="5576134">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="5576158">,</span>&nbsp;<span class="ident" id="5576160">n</span><span class="op" id="5576161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576167">if</span>&nbsp;<span class="ident" id="5576170">value</span><span class="op" id="5576175">.</span><span class="ident" id="5576176">Cap</span><span class="op" id="5576179">(</span><span class="op" id="5576180">)</span>&nbsp;<span class="op" id="5576182">&lt;</span>&nbsp;<span class="ident" id="5576184">n</span>&nbsp;<span class="op" id="5576186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576190">value</span><span class="op" id="5576195">.</span><span class="ident" id="5576196">Set</span><span class="op" id="5576199">(</span><span class="ident" id="5576200">reflect</span><span class="op" id="5576207">.</span><span class="ident" id="5576208">MakeSlice</span><span class="op" id="5576217">(</span><span class="ident" id="5576218">value</span><span class="op" id="5576223">.</span><span class="ident" id="5576224">Type</span><span class="op" id="5576228">(</span><span class="op" id="5576229">)</span><span class="op" id="5576230">,</span>&nbsp;<span class="ident" id="5576232">n</span><span class="op" id="5576233">,</span>&nbsp;<span class="ident" id="5576235">n</span><span class="op" id="5576236">)</span><span class="op" id="5576237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576240">}</span>&nbsp;<span class="keyword" id="5576242">else</span>&nbsp;<span class="op" id="5576247">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576251">value</span><span class="op" id="5576256">.</span><span class="ident" id="5576257">Set</span><span class="op" id="5576260">(</span><span class="ident" id="5576261">value</span><span class="op" id="5576266">.</span><span class="ident" id="5576267">Slice</span><span class="op" id="5576272">(</span><span class="num" id="5576273">0</span><span class="op" id="5576274">,</span>&nbsp;<span class="ident" id="5576276">n</span><span class="op" id="5576277">)</span><span class="op" id="5576278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576284">if</span>&nbsp;<span class="ident" id="5576287">_</span><span class="op" id="5576288">,</span>&nbsp;<span class="ident" id="5576290">err</span>&nbsp;<span class="op" id="5576294">:=</span>&nbsp;<span class="ident" id="5576297">state</span><span class="op" id="5576302">.</span><span class="ident" id="5576303">b</span><span class="op" id="5576304">.</span><span class="ident" id="5576305">Read</span><span class="op" id="5576309">(</span><span class="ident" id="5576310">value</span><span class="op" id="5576315">.</span><span class="ident" id="5576316">Bytes</span><span class="op" id="5576321">(</span><span class="op" id="5576322">)</span><span class="op" id="5576323">)</span><span class="op" id="5576324">;</span>&nbsp;<span class="ident" id="5576326">err</span>&nbsp;<span class="op" id="5576330">!=</span>&nbsp;<span class="builtintype" id="5576333">nil</span>&nbsp;<span class="op" id="5576337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576341">errorf</span><span class="op" id="5576347">(</span><span class="string" id="5576348">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="5576375">,</span>&nbsp;<span class="ident" id="5576377">err</span><span class="op" id="5576380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576383">}</span><br>
<span class="lineno">385</span><span class="op" id="5576385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5576388">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5576456">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5576480">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="5576551">func</span>&nbsp;<span class="ident" id="5576556">decString</span><span class="op" id="5576565">(</span><span class="ident" id="5576566">i</span>&nbsp;<span class="op" id="5576568">*</span><span class="ident" id="5576569">decInstr</span><span class="op" id="5576577">,</span>&nbsp;<span class="ident" id="5576579">state</span>&nbsp;<span class="op" id="5576585">*</span><span class="ident" id="5576586">decoderState</span><span class="op" id="5576598">,</span>&nbsp;<span class="ident" id="5576600">value</span>&nbsp;<span class="ident" id="5576606">reflect</span><span class="op" id="5576613">.</span><span class="ident" id="5576614">Value</span><span class="op" id="5576619">)</span>&nbsp;<span class="op" id="5576621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576624">u</span>&nbsp;<span class="op" id="5576626">:=</span>&nbsp;<span class="ident" id="5576629">state</span><span class="op" id="5576634">.</span><span class="ident" id="5576635">decodeUint</span><span class="op" id="5576645">(</span><span class="op" id="5576646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576649">n</span>&nbsp;<span class="op" id="5576651">:=</span>&nbsp;<span class="builtintype" id="5576654">int</span><span class="op" id="5576657">(</span><span class="ident" id="5576658">u</span><span class="op" id="5576659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576662">if</span>&nbsp;<span class="ident" id="5576665">n</span>&nbsp;<span class="op" id="5576667">&lt;</span>&nbsp;<span class="num" id="5576669">0</span>&nbsp;<span class="op" id="5576671">||</span>&nbsp;<span class="builtintype" id="5576674">uint64</span><span class="op" id="5576680">(</span><span class="ident" id="5576681">n</span><span class="op" id="5576682">)</span>&nbsp;<span class="op" id="5576684">!=</span>&nbsp;<span class="ident" id="5576687">u</span>&nbsp;<span class="op" id="5576689">||</span>&nbsp;<span class="ident" id="5576692">n</span>&nbsp;<span class="op" id="5576694">&gt;</span>&nbsp;<span class="ident" id="5576696">state</span><span class="op" id="5576701">.</span><span class="ident" id="5576702">b</span><span class="op" id="5576703">.</span><span class="ident" id="5576704">Len</span><span class="op" id="5576707">(</span><span class="op" id="5576708">)</span>&nbsp;<span class="op" id="5576710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576714">errorf</span><span class="op" id="5576720">(</span><span class="string" id="5576721">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5576765">,</span>&nbsp;<span class="ident" id="5576767">value</span><span class="op" id="5576772">.</span><span class="ident" id="5576773">Type</span><span class="op" id="5576777">(</span><span class="op" id="5576778">)</span><span class="op" id="5576779">,</span>&nbsp;<span class="ident" id="5576781">u</span><span class="op" id="5576782">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576788">if</span>&nbsp;<span class="ident" id="5576791">n</span>&nbsp;<span class="op" id="5576793">&gt;</span>&nbsp;<span class="ident" id="5576795">state</span><span class="op" id="5576800">.</span><span class="ident" id="5576801">b</span><span class="op" id="5576802">.</span><span class="ident" id="5576803">Len</span><span class="op" id="5576806">(</span><span class="op" id="5576807">)</span>&nbsp;<span class="op" id="5576809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576813">errorf</span><span class="op" id="5576819">(</span><span class="string" id="5576820">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5576853">,</span>&nbsp;<span class="ident" id="5576855">value</span><span class="op" id="5576860">.</span><span class="ident" id="5576861">Type</span><span class="op" id="5576865">(</span><span class="op" id="5576866">)</span><span class="op" id="5576867">,</span>&nbsp;<span class="ident" id="5576869">n</span><span class="op" id="5576870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576876">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576895">data</span>&nbsp;<span class="op" id="5576900">:=</span>&nbsp;<span class="builtinfunc" id="5576903">make</span><span class="op" id="5576907">(</span><span class="op" id="5576908">[</span><span class="op" id="5576909">]</span><span class="builtintype" id="5576910">byte</span><span class="op" id="5576914">,</span>&nbsp;<span class="ident" id="5576916">n</span><span class="op" id="5576917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576920">if</span>&nbsp;<span class="ident" id="5576923">_</span><span class="op" id="5576924">,</span>&nbsp;<span class="ident" id="5576926">err</span>&nbsp;<span class="op" id="5576930">:=</span>&nbsp;<span class="ident" id="5576933">state</span><span class="op" id="5576938">.</span><span class="ident" id="5576939">b</span><span class="op" id="5576940">.</span><span class="ident" id="5576941">Read</span><span class="op" id="5576945">(</span><span class="ident" id="5576946">data</span><span class="op" id="5576950">)</span><span class="op" id="5576951">;</span>&nbsp;<span class="ident" id="5576953">err</span>&nbsp;<span class="op" id="5576957">!=</span>&nbsp;<span class="builtintype" id="5576960">nil</span>&nbsp;<span class="op" id="5576964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576968">errorf</span><span class="op" id="5576974">(</span><span class="string" id="5576975">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="5577002">,</span>&nbsp;<span class="ident" id="5577004">err</span><span class="op" id="5577007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577013">value</span><span class="op" id="5577018">.</span><span class="ident" id="5577019">SetString</span><span class="op" id="5577028">(</span><span class="builtintype" id="5577029">string</span><span class="op" id="5577035">(</span><span class="ident" id="5577036">data</span><span class="op" id="5577040">)</span><span class="op" id="5577041">)</span><br>
<span class="lineno">405</span><span class="op" id="5577043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5577046">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5577130">func</span>&nbsp;<span class="ident" id="5577135">ignoreUint8Array</span><span class="op" id="5577151">(</span><span class="ident" id="5577152">i</span>&nbsp;<span class="op" id="5577154">*</span><span class="ident" id="5577155">decInstr</span><span class="op" id="5577163">,</span>&nbsp;<span class="ident" id="5577165">state</span>&nbsp;<span class="op" id="5577171">*</span><span class="ident" id="5577172">decoderState</span><span class="op" id="5577184">,</span>&nbsp;<span class="ident" id="5577186">value</span>&nbsp;<span class="ident" id="5577192">reflect</span><span class="op" id="5577199">.</span><span class="ident" id="5577200">Value</span><span class="op" id="5577205">)</span>&nbsp;<span class="op" id="5577207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577210">b</span>&nbsp;<span class="op" id="5577212">:=</span>&nbsp;<span class="builtinfunc" id="5577215">make</span><span class="op" id="5577219">(</span><span class="op" id="5577220">[</span><span class="op" id="5577221">]</span><span class="builtintype" id="5577222">byte</span><span class="op" id="5577226">,</span>&nbsp;<span class="ident" id="5577228">state</span><span class="op" id="5577233">.</span><span class="ident" id="5577234">decodeUint</span><span class="op" id="5577244">(</span><span class="op" id="5577245">)</span><span class="op" id="5577246">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577249">state</span><span class="op" id="5577254">.</span><span class="ident" id="5577255">b</span><span class="op" id="5577256">.</span><span class="ident" id="5577257">Read</span><span class="op" id="5577261">(</span><span class="ident" id="5577262">b</span><span class="op" id="5577263">)</span><br>
<span class="lineno"></span><span class="op" id="5577265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5577268">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5577289">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5577379">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="5577453">type</span>&nbsp;<span class="ident" id="5577458">decEngine</span>&nbsp;<span class="keyword" id="5577468">struct</span>&nbsp;<span class="op" id="5577475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577478">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577487">[</span><span class="op" id="5577488">]</span><span class="ident" id="5577489">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577499">numInstr</span>&nbsp;<span class="builtintype" id="5577508">int</span>&nbsp;<span class="comment" id="5577512">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="5577549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5577552">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5577639">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5577718">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="5577775">func</span>&nbsp;<span class="op" id="5577780">(</span><span class="ident" id="5577781">dec</span>&nbsp;<span class="op" id="5577785">*</span><span class="ident" id="5577786">Decoder</span><span class="op" id="5577793">)</span>&nbsp;<span class="ident" id="5577795">decodeSingle</span><span class="op" id="5577807">(</span><span class="ident" id="5577808">engine</span>&nbsp;<span class="op" id="5577815">*</span><span class="ident" id="5577816">decEngine</span><span class="op" id="5577825">,</span>&nbsp;<span class="ident" id="5577827">ut</span>&nbsp;<span class="op" id="5577830">*</span><span class="ident" id="5577831">userTypeInfo</span><span class="op" id="5577843">,</span>&nbsp;<span class="ident" id="5577845">value</span>&nbsp;<span class="ident" id="5577851">reflect</span><span class="op" id="5577858">.</span><span class="ident" id="5577859">Value</span><span class="op" id="5577864">)</span>&nbsp;<span class="op" id="5577866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577869">state</span>&nbsp;<span class="op" id="5577875">:=</span>&nbsp;<span class="ident" id="5577878">dec</span><span class="op" id="5577881">.</span><span class="ident" id="5577882">newDecoderState</span><span class="op" id="5577897">(</span><span class="op" id="5577898">&amp;</span><span class="ident" id="5577899">dec</span><span class="op" id="5577902">.</span><span class="ident" id="5577903">buf</span><span class="op" id="5577906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577909">defer</span>&nbsp;<span class="ident" id="5577915">dec</span><span class="op" id="5577918">.</span><span class="ident" id="5577919">freeDecoderState</span><span class="op" id="5577935">(</span><span class="ident" id="5577936">state</span><span class="op" id="5577941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577944">state</span><span class="op" id="5577949">.</span><span class="ident" id="5577950">fieldnum</span>&nbsp;<span class="op" id="5577959">=</span>&nbsp;<span class="ident" id="5577961">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577977">if</span>&nbsp;<span class="ident" id="5577980">state</span><span class="op" id="5577985">.</span><span class="ident" id="5577986">decodeUint</span><span class="op" id="5577996">(</span><span class="op" id="5577997">)</span>&nbsp;<span class="op" id="5577999">!=</span>&nbsp;<span class="num" id="5578002">0</span>&nbsp;<span class="op" id="5578004">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578008">errorf</span><span class="op" id="5578014">(</span><span class="string" id="5578015">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5578069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578075">instr</span>&nbsp;<span class="op" id="5578081">:=</span>&nbsp;<span class="op" id="5578084">&amp;</span><span class="ident" id="5578085">engine</span><span class="op" id="5578091">.</span><span class="ident" id="5578092">instr</span><span class="op" id="5578097">[</span><span class="ident" id="5578098">singletonField</span><span class="op" id="5578112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578115">instr</span><span class="op" id="5578120">.</span><span class="ident" id="5578121">op</span><span class="op" id="5578123">(</span><span class="ident" id="5578124">instr</span><span class="op" id="5578129">,</span>&nbsp;<span class="ident" id="5578131">state</span><span class="op" id="5578136">,</span>&nbsp;<span class="ident" id="5578138">value</span><span class="op" id="5578143">)</span><br>
<span class="lineno"></span><span class="op" id="5578145">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5578148">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5578215">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5578288">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="5578359">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="5578429">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="5578490">func</span>&nbsp;<span class="op" id="5578495">(</span><span class="ident" id="5578496">dec</span>&nbsp;<span class="op" id="5578500">*</span><span class="ident" id="5578501">Decoder</span><span class="op" id="5578508">)</span>&nbsp;<span class="ident" id="5578510">decodeStruct</span><span class="op" id="5578522">(</span><span class="ident" id="5578523">engine</span>&nbsp;<span class="op" id="5578530">*</span><span class="ident" id="5578531">decEngine</span><span class="op" id="5578540">,</span>&nbsp;<span class="ident" id="5578542">ut</span>&nbsp;<span class="op" id="5578545">*</span><span class="ident" id="5578546">userTypeInfo</span><span class="op" id="5578558">,</span>&nbsp;<span class="ident" id="5578560">value</span>&nbsp;<span class="ident" id="5578566">reflect</span><span class="op" id="5578573">.</span><span class="ident" id="5578574">Value</span><span class="op" id="5578579">)</span>&nbsp;<span class="op" id="5578581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578584">state</span>&nbsp;<span class="op" id="5578590">:=</span>&nbsp;<span class="ident" id="5578593">dec</span><span class="op" id="5578596">.</span><span class="ident" id="5578597">newDecoderState</span><span class="op" id="5578612">(</span><span class="op" id="5578613">&amp;</span><span class="ident" id="5578614">dec</span><span class="op" id="5578617">.</span><span class="ident" id="5578618">buf</span><span class="op" id="5578621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578624">defer</span>&nbsp;<span class="ident" id="5578630">dec</span><span class="op" id="5578633">.</span><span class="ident" id="5578634">freeDecoderState</span><span class="op" id="5578650">(</span><span class="ident" id="5578651">state</span><span class="op" id="5578656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578659">state</span><span class="op" id="5578664">.</span><span class="ident" id="5578665">fieldnum</span>&nbsp;<span class="op" id="5578674">=</span>&nbsp;<span class="op" id="5578676">-</span><span class="num" id="5578677">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578680">for</span>&nbsp;<span class="ident" id="5578684">state</span><span class="op" id="5578689">.</span><span class="ident" id="5578690">b</span><span class="op" id="5578691">.</span><span class="ident" id="5578692">Len</span><span class="op" id="5578695">(</span><span class="op" id="5578696">)</span>&nbsp;<span class="op" id="5578698">&gt;</span>&nbsp;<span class="num" id="5578700">0</span>&nbsp;<span class="op" id="5578702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578706">delta</span>&nbsp;<span class="op" id="5578712">:=</span>&nbsp;<span class="builtintype" id="5578715">int</span><span class="op" id="5578718">(</span><span class="ident" id="5578719">state</span><span class="op" id="5578724">.</span><span class="ident" id="5578725">decodeUint</span><span class="op" id="5578735">(</span><span class="op" id="5578736">)</span><span class="op" id="5578737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578741">if</span>&nbsp;<span class="ident" id="5578744">delta</span>&nbsp;<span class="op" id="5578750">&lt;</span>&nbsp;<span class="num" id="5578752">0</span>&nbsp;<span class="op" id="5578754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578759">errorf</span><span class="op" id="5578765">(</span><span class="string" id="5578766">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5578806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578810">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578814">if</span>&nbsp;<span class="ident" id="5578817">delta</span>&nbsp;<span class="op" id="5578823">==</span>&nbsp;<span class="num" id="5578826">0</span>&nbsp;<span class="op" id="5578828">{</span>&nbsp;<span class="comment" id="5578830">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578877">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578889">fieldnum</span>&nbsp;<span class="op" id="5578898">:=</span>&nbsp;<span class="ident" id="5578901">state</span><span class="op" id="5578906">.</span><span class="ident" id="5578907">fieldnum</span>&nbsp;<span class="op" id="5578916">+</span>&nbsp;<span class="ident" id="5578918">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578926">if</span>&nbsp;<span class="ident" id="5578929">fieldnum</span>&nbsp;<span class="op" id="5578938">&gt;=</span>&nbsp;<span class="builtinfunc" id="5578941">len</span><span class="op" id="5578944">(</span><span class="ident" id="5578945">engine</span><span class="op" id="5578951">.</span><span class="ident" id="5578952">instr</span><span class="op" id="5578957">)</span>&nbsp;<span class="op" id="5578959">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578964">error_</span><span class="op" id="5578970">(</span><span class="ident" id="5578971">errRange</span><span class="op" id="5578979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578984">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578996">instr</span>&nbsp;<span class="op" id="5579002">:=</span>&nbsp;<span class="op" id="5579005">&amp;</span><span class="ident" id="5579006">engine</span><span class="op" id="5579012">.</span><span class="ident" id="5579013">instr</span><span class="op" id="5579018">[</span><span class="ident" id="5579019">fieldnum</span><span class="op" id="5579027">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579031">var</span>&nbsp;<span class="ident" id="5579035">field</span>&nbsp;<span class="ident" id="5579041">reflect</span><span class="op" id="5579048">.</span><span class="ident" id="5579049">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579057">if</span>&nbsp;<span class="ident" id="5579060">instr</span><span class="op" id="5579065">.</span><span class="ident" id="5579066">index</span>&nbsp;<span class="op" id="5579072">!=</span>&nbsp;<span class="builtintype" id="5579075">nil</span>&nbsp;<span class="op" id="5579079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5579084">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579157">field</span>&nbsp;<span class="op" id="5579163">=</span>&nbsp;<span class="ident" id="5579165">value</span><span class="op" id="5579170">.</span><span class="ident" id="5579171">FieldByIndex</span><span class="op" id="5579183">(</span><span class="ident" id="5579184">instr</span><span class="op" id="5579189">.</span><span class="ident" id="5579190">index</span><span class="op" id="5579195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579200">if</span>&nbsp;<span class="ident" id="5579203">field</span><span class="op" id="5579208">.</span><span class="ident" id="5579209">Kind</span><span class="op" id="5579213">(</span><span class="op" id="5579214">)</span>&nbsp;<span class="op" id="5579216">==</span>&nbsp;<span class="ident" id="5579219">reflect</span><span class="op" id="5579226">.</span><span class="ident" id="5579227">Ptr</span>&nbsp;<span class="op" id="5579231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579237">field</span>&nbsp;<span class="op" id="5579243">=</span>&nbsp;<span class="ident" id="5579245">decAlloc</span><span class="op" id="5579253">(</span><span class="ident" id="5579254">field</span><span class="op" id="5579259">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579272">instr</span><span class="op" id="5579277">.</span><span class="ident" id="5579278">op</span><span class="op" id="5579280">(</span><span class="ident" id="5579281">instr</span><span class="op" id="5579286">,</span>&nbsp;<span class="ident" id="5579288">state</span><span class="op" id="5579293">,</span>&nbsp;<span class="ident" id="5579295">field</span><span class="op" id="5579300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579304">state</span><span class="op" id="5579309">.</span><span class="ident" id="5579310">fieldnum</span>&nbsp;<span class="op" id="5579319">=</span>&nbsp;<span class="ident" id="5579321">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579331">}</span><br>
<span class="lineno">470</span><span class="op" id="5579333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5579336">var</span>&nbsp;<span class="ident" id="5579340">noValue</span>&nbsp;<span class="ident" id="5579348">reflect</span><span class="op" id="5579355">.</span><span class="ident" id="5579356">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5579363">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="5579431">func</span>&nbsp;<span class="op" id="5579436">(</span><span class="ident" id="5579437">dec</span>&nbsp;<span class="op" id="5579441">*</span><span class="ident" id="5579442">Decoder</span><span class="op" id="5579449">)</span>&nbsp;<span class="ident" id="5579451">ignoreStruct</span><span class="op" id="5579463">(</span><span class="ident" id="5579464">engine</span>&nbsp;<span class="op" id="5579471">*</span><span class="ident" id="5579472">decEngine</span><span class="op" id="5579481">)</span>&nbsp;<span class="op" id="5579483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579486">state</span>&nbsp;<span class="op" id="5579492">:=</span>&nbsp;<span class="ident" id="5579495">dec</span><span class="op" id="5579498">.</span><span class="ident" id="5579499">newDecoderState</span><span class="op" id="5579514">(</span><span class="op" id="5579515">&amp;</span><span class="ident" id="5579516">dec</span><span class="op" id="5579519">.</span><span class="ident" id="5579520">buf</span><span class="op" id="5579523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579526">defer</span>&nbsp;<span class="ident" id="5579532">dec</span><span class="op" id="5579535">.</span><span class="ident" id="5579536">freeDecoderState</span><span class="op" id="5579552">(</span><span class="ident" id="5579553">state</span><span class="op" id="5579558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579561">state</span><span class="op" id="5579566">.</span><span class="ident" id="5579567">fieldnum</span>&nbsp;<span class="op" id="5579576">=</span>&nbsp;<span class="op" id="5579578">-</span><span class="num" id="5579579">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579582">for</span>&nbsp;<span class="ident" id="5579586">state</span><span class="op" id="5579591">.</span><span class="ident" id="5579592">b</span><span class="op" id="5579593">.</span><span class="ident" id="5579594">Len</span><span class="op" id="5579597">(</span><span class="op" id="5579598">)</span>&nbsp;<span class="op" id="5579600">&gt;</span>&nbsp;<span class="num" id="5579602">0</span>&nbsp;<span class="op" id="5579604">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579608">delta</span>&nbsp;<span class="op" id="5579614">:=</span>&nbsp;<span class="builtintype" id="5579617">int</span><span class="op" id="5579620">(</span><span class="ident" id="5579621">state</span><span class="op" id="5579626">.</span><span class="ident" id="5579627">decodeUint</span><span class="op" id="5579637">(</span><span class="op" id="5579638">)</span><span class="op" id="5579639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579643">if</span>&nbsp;<span class="ident" id="5579646">delta</span>&nbsp;<span class="op" id="5579652">&lt;</span>&nbsp;<span class="num" id="5579654">0</span>&nbsp;<span class="op" id="5579656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579661">errorf</span><span class="op" id="5579667">(</span><span class="string" id="5579668">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5579715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579723">if</span>&nbsp;<span class="ident" id="5579726">delta</span>&nbsp;<span class="op" id="5579732">==</span>&nbsp;<span class="num" id="5579735">0</span>&nbsp;<span class="op" id="5579737">{</span>&nbsp;<span class="comment" id="5579739">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579786">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579798">fieldnum</span>&nbsp;<span class="op" id="5579807">:=</span>&nbsp;<span class="ident" id="5579810">state</span><span class="op" id="5579815">.</span><span class="ident" id="5579816">fieldnum</span>&nbsp;<span class="op" id="5579825">+</span>&nbsp;<span class="ident" id="5579827">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579835">if</span>&nbsp;<span class="ident" id="5579838">fieldnum</span>&nbsp;<span class="op" id="5579847">&gt;=</span>&nbsp;<span class="builtinfunc" id="5579850">len</span><span class="op" id="5579853">(</span><span class="ident" id="5579854">engine</span><span class="op" id="5579860">.</span><span class="ident" id="5579861">instr</span><span class="op" id="5579866">)</span>&nbsp;<span class="op" id="5579868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579873">error_</span><span class="op" id="5579879">(</span><span class="ident" id="5579880">errRange</span><span class="op" id="5579888">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579896">instr</span>&nbsp;<span class="op" id="5579902">:=</span>&nbsp;<span class="op" id="5579905">&amp;</span><span class="ident" id="5579906">engine</span><span class="op" id="5579912">.</span><span class="ident" id="5579913">instr</span><span class="op" id="5579918">[</span><span class="ident" id="5579919">fieldnum</span><span class="op" id="5579927">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579931">instr</span><span class="op" id="5579936">.</span><span class="ident" id="5579937">op</span><span class="op" id="5579939">(</span><span class="ident" id="5579940">instr</span><span class="op" id="5579945">,</span>&nbsp;<span class="ident" id="5579947">state</span><span class="op" id="5579952">,</span>&nbsp;<span class="ident" id="5579954">noValue</span><span class="op" id="5579961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579965">state</span><span class="op" id="5579970">.</span><span class="ident" id="5579971">fieldnum</span>&nbsp;<span class="op" id="5579980">=</span>&nbsp;<span class="ident" id="5579982">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579992">}</span><br>
<span class="lineno">495</span><span class="op" id="5579994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5579997">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5580072">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5580136">func</span>&nbsp;<span class="op" id="5580141">(</span><span class="ident" id="5580142">dec</span>&nbsp;<span class="op" id="5580146">*</span><span class="ident" id="5580147">Decoder</span><span class="op" id="5580154">)</span>&nbsp;<span class="ident" id="5580156">ignoreSingle</span><span class="op" id="5580168">(</span><span class="ident" id="5580169">engine</span>&nbsp;<span class="op" id="5580176">*</span><span class="ident" id="5580177">decEngine</span><span class="op" id="5580186">)</span>&nbsp;<span class="op" id="5580188">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580191">state</span>&nbsp;<span class="op" id="5580197">:=</span>&nbsp;<span class="ident" id="5580200">dec</span><span class="op" id="5580203">.</span><span class="ident" id="5580204">newDecoderState</span><span class="op" id="5580219">(</span><span class="op" id="5580220">&amp;</span><span class="ident" id="5580221">dec</span><span class="op" id="5580224">.</span><span class="ident" id="5580225">buf</span><span class="op" id="5580228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580231">defer</span>&nbsp;<span class="ident" id="5580237">dec</span><span class="op" id="5580240">.</span><span class="ident" id="5580241">freeDecoderState</span><span class="op" id="5580257">(</span><span class="ident" id="5580258">state</span><span class="op" id="5580263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580266">state</span><span class="op" id="5580271">.</span><span class="ident" id="5580272">fieldnum</span>&nbsp;<span class="op" id="5580281">=</span>&nbsp;<span class="ident" id="5580283">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580299">delta</span>&nbsp;<span class="op" id="5580305">:=</span>&nbsp;<span class="builtintype" id="5580308">int</span><span class="op" id="5580311">(</span><span class="ident" id="5580312">state</span><span class="op" id="5580317">.</span><span class="ident" id="5580318">decodeUint</span><span class="op" id="5580328">(</span><span class="op" id="5580329">)</span><span class="op" id="5580330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580333">if</span>&nbsp;<span class="ident" id="5580336">delta</span>&nbsp;<span class="op" id="5580342">!=</span>&nbsp;<span class="num" id="5580345">0</span>&nbsp;<span class="op" id="5580347">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580351">errorf</span><span class="op" id="5580357">(</span><span class="string" id="5580358">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5580412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5580415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580418">instr</span>&nbsp;<span class="op" id="5580424">:=</span>&nbsp;<span class="op" id="5580427">&amp;</span><span class="ident" id="5580428">engine</span><span class="op" id="5580434">.</span><span class="ident" id="5580435">instr</span><span class="op" id="5580440">[</span><span class="ident" id="5580441">singletonField</span><span class="op" id="5580455">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580458">instr</span><span class="op" id="5580463">.</span><span class="ident" id="5580464">op</span><span class="op" id="5580466">(</span><span class="ident" id="5580467">instr</span><span class="op" id="5580472">,</span>&nbsp;<span class="ident" id="5580474">state</span><span class="op" id="5580479">,</span>&nbsp;<span class="ident" id="5580481">noValue</span><span class="op" id="5580488">)</span><br>
<span class="lineno"></span><span class="op" id="5580490">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="5580493">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5580560">func</span>&nbsp;<span class="op" id="5580565">(</span><span class="ident" id="5580566">dec</span>&nbsp;<span class="op" id="5580570">*</span><span class="ident" id="5580571">Decoder</span><span class="op" id="5580578">)</span>&nbsp;<span class="ident" id="5580580">decodeArrayHelper</span><span class="op" id="5580597">(</span><span class="ident" id="5580598">state</span>&nbsp;<span class="op" id="5580604">*</span><span class="ident" id="5580605">decoderState</span><span class="op" id="5580617">,</span>&nbsp;<span class="ident" id="5580619">value</span>&nbsp;<span class="ident" id="5580625">reflect</span><span class="op" id="5580632">.</span><span class="ident" id="5580633">Value</span><span class="op" id="5580638">,</span>&nbsp;<span class="ident" id="5580640">elemOp</span>&nbsp;<span class="ident" id="5580647">decOp</span><span class="op" id="5580652">,</span>&nbsp;<span class="ident" id="5580654">length</span>&nbsp;<span class="builtintype" id="5580661">int</span><span class="op" id="5580664">,</span>&nbsp;<span class="ident" id="5580666">ovfl</span>&nbsp;<span class="builtintype" id="5580671">error</span><span class="op" id="5580676">,</span>&nbsp;<span class="ident" id="5580678">helper</span>&nbsp;<span class="ident" id="5580685">decHelper</span><span class="op" id="5580694">)</span>&nbsp;<span class="op" id="5580696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580699">if</span>&nbsp;<span class="ident" id="5580702">helper</span>&nbsp;<span class="op" id="5580709">!=</span>&nbsp;<span class="builtintype" id="5580712">nil</span>&nbsp;<span class="op" id="5580716">&amp;&amp;</span>&nbsp;<span class="ident" id="5580719">helper</span><span class="op" id="5580725">(</span><span class="ident" id="5580726">state</span><span class="op" id="5580731">,</span>&nbsp;<span class="ident" id="5580733">value</span><span class="op" id="5580738">,</span>&nbsp;<span class="ident" id="5580740">length</span><span class="op" id="5580746">,</span>&nbsp;<span class="ident" id="5580748">ovfl</span><span class="op" id="5580752">)</span>&nbsp;<span class="op" id="5580754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580758">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5580766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580769">instr</span>&nbsp;<span class="op" id="5580775">:=</span>&nbsp;<span class="op" id="5580778">&amp;</span><span class="ident" id="5580779">decInstr</span><span class="op" id="5580787">{</span><span class="ident" id="5580788">elemOp</span><span class="op" id="5580794">,</span>&nbsp;<span class="num" id="5580796">0</span><span class="op" id="5580797">,</span>&nbsp;<span class="builtintype" id="5580799">nil</span><span class="op" id="5580802">,</span>&nbsp;<span class="ident" id="5580804">ovfl</span><span class="op" id="5580808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580811">isPtr</span>&nbsp;<span class="op" id="5580817">:=</span>&nbsp;<span class="ident" id="5580820">value</span><span class="op" id="5580825">.</span><span class="ident" id="5580826">Type</span><span class="op" id="5580830">(</span><span class="op" id="5580831">)</span><span class="op" id="5580832">.</span><span class="ident" id="5580833">Elem</span><span class="op" id="5580837">(</span><span class="op" id="5580838">)</span><span class="op" id="5580839">.</span><span class="ident" id="5580840">Kind</span><span class="op" id="5580844">(</span><span class="op" id="5580845">)</span>&nbsp;<span class="op" id="5580847">==</span>&nbsp;<span class="ident" id="5580850">reflect</span><span class="op" id="5580857">.</span><span class="ident" id="5580858">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580863">for</span>&nbsp;<span class="ident" id="5580867">i</span>&nbsp;<span class="op" id="5580869">:=</span>&nbsp;<span class="num" id="5580872">0</span><span class="op" id="5580873">;</span>&nbsp;<span class="ident" id="5580875">i</span>&nbsp;<span class="op" id="5580877">&lt;</span>&nbsp;<span class="ident" id="5580879">length</span><span class="op" id="5580885">;</span>&nbsp;<span class="ident" id="5580887">i</span><span class="op" id="5580888">++</span>&nbsp;<span class="op" id="5580891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580895">if</span>&nbsp;<span class="ident" id="5580898">state</span><span class="op" id="5580903">.</span><span class="ident" id="5580904">b</span><span class="op" id="5580905">.</span><span class="ident" id="5580906">Len</span><span class="op" id="5580909">(</span><span class="op" id="5580910">)</span>&nbsp;<span class="op" id="5580912">==</span>&nbsp;<span class="num" id="5580915">0</span>&nbsp;<span class="op" id="5580917">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580922">errorf</span><span class="op" id="5580928">(</span><span class="string" id="5580929">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="5580995">,</span>&nbsp;<span class="ident" id="5580997">length</span><span class="op" id="5581003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581011">v</span>&nbsp;<span class="op" id="5581013">:=</span>&nbsp;<span class="ident" id="5581016">value</span><span class="op" id="5581021">.</span><span class="ident" id="5581022">Index</span><span class="op" id="5581027">(</span><span class="ident" id="5581028">i</span><span class="op" id="5581029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5581033">if</span>&nbsp;<span class="ident" id="5581036">isPtr</span>&nbsp;<span class="op" id="5581042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581047">v</span>&nbsp;<span class="op" id="5581049">=</span>&nbsp;<span class="ident" id="5581051">decAlloc</span><span class="op" id="5581059">(</span><span class="ident" id="5581060">v</span><span class="op" id="5581061">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581069">elemOp</span><span class="op" id="5581075">(</span><span class="ident" id="5581076">instr</span><span class="op" id="5581081">,</span>&nbsp;<span class="ident" id="5581083">state</span><span class="op" id="5581088">,</span>&nbsp;<span class="ident" id="5581090">v</span><span class="op" id="5581091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581094">}</span><br>
<span class="lineno"></span><span class="op" id="5581096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5581099">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5581155">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="5581253">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5581334">func</span>&nbsp;<span class="op" id="5581339">(</span><span class="ident" id="5581340">dec</span>&nbsp;<span class="op" id="5581344">*</span><span class="ident" id="5581345">Decoder</span><span class="op" id="5581352">)</span>&nbsp;<span class="ident" id="5581354">decodeArray</span><span class="op" id="5581365">(</span><span class="ident" id="5581366">atyp</span>&nbsp;<span class="ident" id="5581371">reflect</span><span class="op" id="5581378">.</span><span class="ident" id="5581379">Type</span><span class="op" id="5581383">,</span>&nbsp;<span class="ident" id="5581385">state</span>&nbsp;<span class="op" id="5581391">*</span><span class="ident" id="5581392">decoderState</span><span class="op" id="5581404">,</span>&nbsp;<span class="ident" id="5581406">value</span>&nbsp;<span class="ident" id="5581412">reflect</span><span class="op" id="5581419">.</span><span class="ident" id="5581420">Value</span><span class="op" id="5581425">,</span>&nbsp;<span class="ident" id="5581427">elemOp</span>&nbsp;<span class="ident" id="5581434">decOp</span><span class="op" id="5581439">,</span>&nbsp;<span class="ident" id="5581441">length</span>&nbsp;<span class="builtintype" id="5581448">int</span><span class="op" id="5581451">,</span>&nbsp;<span class="ident" id="5581453">ovfl</span>&nbsp;<span class="builtintype" id="5581458">error</span><span class="op" id="5581463">,</span>&nbsp;<span class="ident" id="5581465">helper</span>&nbsp;<span class="ident" id="5581472">decHelper</span><span class="op" id="5581481">)</span>&nbsp;<span class="op" id="5581483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5581486">if</span>&nbsp;<span class="ident" id="5581489">n</span>&nbsp;<span class="op" id="5581491">:=</span>&nbsp;<span class="ident" id="5581494">state</span><span class="op" id="5581499">.</span><span class="ident" id="5581500">decodeUint</span><span class="op" id="5581510">(</span><span class="op" id="5581511">)</span><span class="op" id="5581512">;</span>&nbsp;<span class="ident" id="5581514">n</span>&nbsp;<span class="op" id="5581516">!=</span>&nbsp;<span class="builtintype" id="5581519">uint64</span><span class="op" id="5581525">(</span><span class="ident" id="5581526">length</span><span class="op" id="5581532">)</span>&nbsp;<span class="op" id="5581534">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581538">errorf</span><span class="op" id="5581544">(</span><span class="string" id="5581545">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="5581577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581583">dec</span><span class="op" id="5581586">.</span><span class="ident" id="5581587">decodeArrayHelper</span><span class="op" id="5581604">(</span><span class="ident" id="5581605">state</span><span class="op" id="5581610">,</span>&nbsp;<span class="ident" id="5581612">value</span><span class="op" id="5581617">,</span>&nbsp;<span class="ident" id="5581619">elemOp</span><span class="op" id="5581625">,</span>&nbsp;<span class="ident" id="5581627">length</span><span class="op" id="5581633">,</span>&nbsp;<span class="ident" id="5581635">ovfl</span><span class="op" id="5581639">,</span>&nbsp;<span class="ident" id="5581641">helper</span><span class="op" id="5581647">)</span><br>
<span class="lineno"></span><span class="op" id="5581649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5581652">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5581701">func</span>&nbsp;<span class="ident" id="5581706">decodeIntoValue</span><span class="op" id="5581721">(</span><span class="ident" id="5581722">state</span>&nbsp;<span class="op" id="5581728">*</span><span class="ident" id="5581729">decoderState</span><span class="op" id="5581741">,</span>&nbsp;<span class="ident" id="5581743">op</span>&nbsp;<span class="ident" id="5581746">decOp</span><span class="op" id="5581751">,</span>&nbsp;<span class="ident" id="5581753">isPtr</span>&nbsp;<span class="builtintype" id="5581759">bool</span><span class="op" id="5581763">,</span>&nbsp;<span class="ident" id="5581765">value</span>&nbsp;<span class="ident" id="5581771">reflect</span><span class="op" id="5581778">.</span><span class="ident" id="5581779">Value</span><span class="op" id="5581784">,</span>&nbsp;<span class="ident" id="5581786">ovfl</span>&nbsp;<span class="builtintype" id="5581791">error</span><span class="op" id="5581796">)</span>&nbsp;<span class="ident" id="5581798">reflect</span><span class="op" id="5581805">.</span><span class="ident" id="5581806">Value</span>&nbsp;<span class="op" id="5581812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581815">instr</span>&nbsp;<span class="op" id="5581821">:=</span>&nbsp;<span class="op" id="5581824">&amp;</span><span class="ident" id="5581825">decInstr</span><span class="op" id="5581833">{</span><span class="ident" id="5581834">op</span><span class="op" id="5581836">,</span>&nbsp;<span class="num" id="5581838">0</span><span class="op" id="5581839">,</span>&nbsp;<span class="builtintype" id="5581841">nil</span><span class="op" id="5581844">,</span>&nbsp;<span class="ident" id="5581846">ovfl</span><span class="op" id="5581850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581853">v</span>&nbsp;<span class="op" id="5581855">:=</span>&nbsp;<span class="ident" id="5581858">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5581865">if</span>&nbsp;<span class="ident" id="5581868">isPtr</span>&nbsp;<span class="op" id="5581874">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581878">v</span>&nbsp;<span class="op" id="5581880">=</span>&nbsp;<span class="ident" id="5581882">decAlloc</span><span class="op" id="5581890">(</span><span class="ident" id="5581891">value</span><span class="op" id="5581896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581902">op</span><span class="op" id="5581904">(</span><span class="ident" id="5581905">instr</span><span class="op" id="5581910">,</span>&nbsp;<span class="ident" id="5581912">state</span><span class="op" id="5581917">,</span>&nbsp;<span class="ident" id="5581919">v</span><span class="op" id="5581920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5581923">return</span>&nbsp;<span class="ident" id="5581930">value</span><br>
<span class="lineno"></span><span class="op" id="5581936">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="5581939">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5581990">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="5582051">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5582115">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="5582160">func</span>&nbsp;<span class="op" id="5582165">(</span><span class="ident" id="5582166">dec</span>&nbsp;<span class="op" id="5582170">*</span><span class="ident" id="5582171">Decoder</span><span class="op" id="5582178">)</span>&nbsp;<span class="ident" id="5582180">decodeMap</span><span class="op" id="5582189">(</span><span class="ident" id="5582190">mtyp</span>&nbsp;<span class="ident" id="5582195">reflect</span><span class="op" id="5582202">.</span><span class="ident" id="5582203">Type</span><span class="op" id="5582207">,</span>&nbsp;<span class="ident" id="5582209">state</span>&nbsp;<span class="op" id="5582215">*</span><span class="ident" id="5582216">decoderState</span><span class="op" id="5582228">,</span>&nbsp;<span class="ident" id="5582230">value</span>&nbsp;<span class="ident" id="5582236">reflect</span><span class="op" id="5582243">.</span><span class="ident" id="5582244">Value</span><span class="op" id="5582249">,</span>&nbsp;<span class="ident" id="5582251">keyOp</span><span class="op" id="5582256">,</span>&nbsp;<span class="ident" id="5582258">elemOp</span>&nbsp;<span class="ident" id="5582265">decOp</span><span class="op" id="5582270">,</span>&nbsp;<span class="ident" id="5582272">ovfl</span>&nbsp;<span class="builtintype" id="5582277">error</span><span class="op" id="5582282">)</span>&nbsp;<span class="op" id="5582284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5582287">if</span>&nbsp;<span class="ident" id="5582290">value</span><span class="op" id="5582295">.</span><span class="ident" id="5582296">IsNil</span><span class="op" id="5582301">(</span><span class="op" id="5582302">)</span>&nbsp;<span class="op" id="5582304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5582308">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582327">value</span><span class="op" id="5582332">.</span><span class="ident" id="5582333">Set</span><span class="op" id="5582336">(</span><span class="ident" id="5582337">reflect</span><span class="op" id="5582344">.</span><span class="ident" id="5582345">MakeMap</span><span class="op" id="5582352">(</span><span class="ident" id="5582353">mtyp</span><span class="op" id="5582357">)</span><span class="op" id="5582358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5582361">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582364">n</span>&nbsp;<span class="op" id="5582366">:=</span>&nbsp;<span class="builtintype" id="5582369">int</span><span class="op" id="5582372">(</span><span class="ident" id="5582373">state</span><span class="op" id="5582378">.</span><span class="ident" id="5582379">decodeUint</span><span class="op" id="5582389">(</span><span class="op" id="5582390">)</span><span class="op" id="5582391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582394">keyIsPtr</span>&nbsp;<span class="op" id="5582403">:=</span>&nbsp;<span class="ident" id="5582406">mtyp</span><span class="op" id="5582410">.</span><span class="ident" id="5582411">Key</span><span class="op" id="5582414">(</span><span class="op" id="5582415">)</span><span class="op" id="5582416">.</span><span class="ident" id="5582417">Kind</span><span class="op" id="5582421">(</span><span class="op" id="5582422">)</span>&nbsp;<span class="op" id="5582424">==</span>&nbsp;<span class="ident" id="5582427">reflect</span><span class="op" id="5582434">.</span><span class="ident" id="5582435">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582440">elemIsPtr</span>&nbsp;<span class="op" id="5582450">:=</span>&nbsp;<span class="ident" id="5582453">mtyp</span><span class="op" id="5582457">.</span><span class="ident" id="5582458">Elem</span><span class="op" id="5582462">(</span><span class="op" id="5582463">)</span><span class="op" id="5582464">.</span><span class="ident" id="5582465">Kind</span><span class="op" id="5582469">(</span><span class="op" id="5582470">)</span>&nbsp;<span class="op" id="5582472">==</span>&nbsp;<span class="ident" id="5582475">reflect</span><span class="op" id="5582482">.</span><span class="ident" id="5582483">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5582488">for</span>&nbsp;<span class="ident" id="5582492">i</span>&nbsp;<span class="op" id="5582494">:=</span>&nbsp;<span class="num" id="5582497">0</span><span class="op" id="5582498">;</span>&nbsp;<span class="ident" id="5582500">i</span>&nbsp;<span class="op" id="5582502">&lt;</span>&nbsp;<span class="ident" id="5582504">n</span><span class="op" id="5582505">;</span>&nbsp;<span class="ident" id="5582507">i</span><span class="op" id="5582508">++</span>&nbsp;<span class="op" id="5582511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582515">key</span>&nbsp;<span class="op" id="5582519">:=</span>&nbsp;<span class="ident" id="5582522">decodeIntoValue</span><span class="op" id="5582537">(</span><span class="ident" id="5582538">state</span><span class="op" id="5582543">,</span>&nbsp;<span class="ident" id="5582545">keyOp</span><span class="op" id="5582550">,</span>&nbsp;<span class="ident" id="5582552">keyIsPtr</span><span class="op" id="5582560">,</span>&nbsp;<span class="ident" id="5582562">allocValue</span><span class="op" id="5582572">(</span><span class="ident" id="5582573">mtyp</span><span class="op" id="5582577">.</span><span class="ident" id="5582578">Key</span><span class="op" id="5582581">(</span><span class="op" id="5582582">)</span><span class="op" id="5582583">)</span><span class="op" id="5582584">,</span>&nbsp;<span class="ident" id="5582586">ovfl</span><span class="op" id="5582590">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582594">elem</span>&nbsp;<span class="op" id="5582599">:=</span>&nbsp;<span class="ident" id="5582602">decodeIntoValue</span><span class="op" id="5582617">(</span><span class="ident" id="5582618">state</span><span class="op" id="5582623">,</span>&nbsp;<span class="ident" id="5582625">elemOp</span><span class="op" id="5582631">,</span>&nbsp;<span class="ident" id="5582633">elemIsPtr</span><span class="op" id="5582642">,</span>&nbsp;<span class="ident" id="5582644">allocValue</span><span class="op" id="5582654">(</span><span class="ident" id="5582655">mtyp</span><span class="op" id="5582659">.</span><span class="ident" id="5582660">Elem</span><span class="op" id="5582664">(</span><span class="op" id="5582665">)</span><span class="op" id="5582666">)</span><span class="op" id="5582667">,</span>&nbsp;<span class="ident" id="5582669">ovfl</span><span class="op" id="5582673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582677">value</span><span class="op" id="5582682">.</span><span class="ident" id="5582683">SetMapIndex</span><span class="op" id="5582694">(</span><span class="ident" id="5582695">key</span><span class="op" id="5582698">,</span>&nbsp;<span class="ident" id="5582700">elem</span><span class="op" id="5582704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5582707">}</span><br>
<span class="lineno"></span><span class="op" id="5582709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="5582712">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5582781">func</span>&nbsp;<span class="op" id="5582786">(</span><span class="ident" id="5582787">dec</span>&nbsp;<span class="op" id="5582791">*</span><span class="ident" id="5582792">Decoder</span><span class="op" id="5582799">)</span>&nbsp;<span class="ident" id="5582801">ignoreArrayHelper</span><span class="op" id="5582818">(</span><span class="ident" id="5582819">state</span>&nbsp;<span class="op" id="5582825">*</span><span class="ident" id="5582826">decoderState</span><span class="op" id="5582838">,</span>&nbsp;<span class="ident" id="5582840">elemOp</span>&nbsp;<span class="ident" id="5582847">decOp</span><span class="op" id="5582852">,</span>&nbsp;<span class="ident" id="5582854">length</span>&nbsp;<span class="builtintype" id="5582861">int</span><span class="op" id="5582864">)</span>&nbsp;<span class="op" id="5582866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582869">instr</span>&nbsp;<span class="op" id="5582875">:=</span>&nbsp;<span class="op" id="5582878">&amp;</span><span class="ident" id="5582879">decInstr</span><span class="op" id="5582887">{</span><span class="ident" id="5582888">elemOp</span><span class="op" id="5582894">,</span>&nbsp;<span class="num" id="5582896">0</span><span class="op" id="5582897">,</span>&nbsp;<span class="builtintype" id="5582899">nil</span><span class="op" id="5582902">,</span>&nbsp;<span class="ident" id="5582904">errors</span><span class="op" id="5582910">.</span><span class="ident" id="5582911">New</span><span class="op" id="5582914">(</span><span class="string" id="5582915">&#34;no&nbsp;error&#34;</span><span class="op" id="5582925">)</span><span class="op" id="5582926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5582929">for</span>&nbsp;<span class="ident" id="5582933">i</span>&nbsp;<span class="op" id="5582935">:=</span>&nbsp;<span class="num" id="5582938">0</span><span class="op" id="5582939">;</span>&nbsp;<span class="ident" id="5582941">i</span>&nbsp;<span class="op" id="5582943">&lt;</span>&nbsp;<span class="ident" id="5582945">length</span><span class="op" id="5582951">;</span>&nbsp;<span class="ident" id="5582953">i</span><span class="op" id="5582954">++</span>&nbsp;<span class="op" id="5582957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582961">elemOp</span><span class="op" id="5582967">(</span><span class="ident" id="5582968">instr</span><span class="op" id="5582973">,</span>&nbsp;<span class="ident" id="5582975">state</span><span class="op" id="5582980">,</span>&nbsp;<span class="ident" id="5582982">noValue</span><span class="op" id="5582989">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5582992">}</span><br>
<span class="lineno"></span><span class="op" id="5582994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5582997">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5583070">func</span>&nbsp;<span class="op" id="5583075">(</span><span class="ident" id="5583076">dec</span>&nbsp;<span class="op" id="5583080">*</span><span class="ident" id="5583081">Decoder</span><span class="op" id="5583088">)</span>&nbsp;<span class="ident" id="5583090">ignoreArray</span><span class="op" id="5583101">(</span><span class="ident" id="5583102">state</span>&nbsp;<span class="op" id="5583108">*</span><span class="ident" id="5583109">decoderState</span><span class="op" id="5583121">,</span>&nbsp;<span class="ident" id="5583123">elemOp</span>&nbsp;<span class="ident" id="5583130">decOp</span><span class="op" id="5583135">,</span>&nbsp;<span class="ident" id="5583137">length</span>&nbsp;<span class="builtintype" id="5583144">int</span><span class="op" id="5583147">)</span>&nbsp;<span class="op" id="5583149">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5583152">if</span>&nbsp;<span class="ident" id="5583155">n</span>&nbsp;<span class="op" id="5583157">:=</span>&nbsp;<span class="ident" id="5583160">state</span><span class="op" id="5583165">.</span><span class="ident" id="5583166">decodeUint</span><span class="op" id="5583176">(</span><span class="op" id="5583177">)</span><span class="op" id="5583178">;</span>&nbsp;<span class="ident" id="5583180">n</span>&nbsp;<span class="op" id="5583182">!=</span>&nbsp;<span class="builtintype" id="5583185">uint64</span><span class="op" id="5583191">(</span><span class="ident" id="5583192">length</span><span class="op" id="5583198">)</span>&nbsp;<span class="op" id="5583200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583204">errorf</span><span class="op" id="5583210">(</span><span class="string" id="5583211">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="5583243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583249">dec</span><span class="op" id="5583252">.</span><span class="ident" id="5583253">ignoreArrayHelper</span><span class="op" id="5583270">(</span><span class="ident" id="5583271">state</span><span class="op" id="5583276">,</span>&nbsp;<span class="ident" id="5583278">elemOp</span><span class="op" id="5583284">,</span>&nbsp;<span class="ident" id="5583286">length</span><span class="op" id="5583292">)</span><br>
<span class="lineno"></span><span class="op" id="5583294">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="5583297">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5583365">func</span>&nbsp;<span class="op" id="5583370">(</span><span class="ident" id="5583371">dec</span>&nbsp;<span class="op" id="5583375">*</span><span class="ident" id="5583376">Decoder</span><span class="op" id="5583383">)</span>&nbsp;<span class="ident" id="5583385">ignoreMap</span><span class="op" id="5583394">(</span><span class="ident" id="5583395">state</span>&nbsp;<span class="op" id="5583401">*</span><span class="ident" id="5583402">decoderState</span><span class="op" id="5583414">,</span>&nbsp;<span class="ident" id="5583416">keyOp</span><span class="op" id="5583421">,</span>&nbsp;<span class="ident" id="5583423">elemOp</span>&nbsp;<span class="ident" id="5583430">decOp</span><span class="op" id="5583435">)</span>&nbsp;<span class="op" id="5583437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583440">n</span>&nbsp;<span class="op" id="5583442">:=</span>&nbsp;<span class="builtintype" id="5583445">int</span><span class="op" id="5583448">(</span><span class="ident" id="5583449">state</span><span class="op" id="5583454">.</span><span class="ident" id="5583455">decodeUint</span><span class="op" id="5583465">(</span><span class="op" id="5583466">)</span><span class="op" id="5583467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583470">keyInstr</span>&nbsp;<span class="op" id="5583479">:=</span>&nbsp;<span class="op" id="5583482">&amp;</span><span class="ident" id="5583483">decInstr</span><span class="op" id="5583491">{</span><span class="ident" id="5583492">keyOp</span><span class="op" id="5583497">,</span>&nbsp;<span class="num" id="5583499">0</span><span class="op" id="5583500">,</span>&nbsp;<span class="builtintype" id="5583502">nil</span><span class="op" id="5583505">,</span>&nbsp;<span class="ident" id="5583507">errors</span><span class="op" id="5583513">.</span><span class="ident" id="5583514">New</span><span class="op" id="5583517">(</span><span class="string" id="5583518">&#34;no&nbsp;error&#34;</span><span class="op" id="5583528">)</span><span class="op" id="5583529">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583532">elemInstr</span>&nbsp;<span class="op" id="5583542">:=</span>&nbsp;<span class="op" id="5583545">&amp;</span><span class="ident" id="5583546">decInstr</span><span class="op" id="5583554">{</span><span class="ident" id="5583555">elemOp</span><span class="op" id="5583561">,</span>&nbsp;<span class="num" id="5583563">0</span><span class="op" id="5583564">,</span>&nbsp;<span class="builtintype" id="5583566">nil</span><span class="op" id="5583569">,</span>&nbsp;<span class="ident" id="5583571">errors</span><span class="op" id="5583577">.</span><span class="ident" id="5583578">New</span><span class="op" id="5583581">(</span><span class="string" id="5583582">&#34;no&nbsp;error&#34;</span><span class="op" id="5583592">)</span><span class="op" id="5583593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5583596">for</span>&nbsp;<span class="ident" id="5583600">i</span>&nbsp;<span class="op" id="5583602">:=</span>&nbsp;<span class="num" id="5583605">0</span><span class="op" id="5583606">;</span>&nbsp;<span class="ident" id="5583608">i</span>&nbsp;<span class="op" id="5583610">&lt;</span>&nbsp;<span class="ident" id="5583612">n</span><span class="op" id="5583613">;</span>&nbsp;<span class="ident" id="5583615">i</span><span class="op" id="5583616">++</span>&nbsp;<span class="op" id="5583619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583623">keyOp</span><span class="op" id="5583628">(</span><span class="ident" id="5583629">keyInstr</span><span class="op" id="5583637">,</span>&nbsp;<span class="ident" id="5583639">state</span><span class="op" id="5583644">,</span>&nbsp;<span class="ident" id="5583646">noValue</span><span class="op" id="5583653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583657">elemOp</span><span class="op" id="5583663">(</span><span class="ident" id="5583664">elemInstr</span><span class="op" id="5583673">,</span>&nbsp;<span class="ident" id="5583675">state</span><span class="op" id="5583680">,</span>&nbsp;<span class="ident" id="5583682">noValue</span><span class="op" id="5583689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583692">}</span><br>
<span class="lineno">595</span><span class="op" id="5583694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5583697">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5583752">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5583822">func</span>&nbsp;<span class="op" id="5583827">(</span><span class="ident" id="5583828">dec</span>&nbsp;<span class="op" id="5583832">*</span><span class="ident" id="5583833">Decoder</span><span class="op" id="5583840">)</span>&nbsp;<span class="ident" id="5583842">decodeSlice</span><span class="op" id="5583853">(</span><span class="ident" id="5583854">state</span>&nbsp;<span class="op" id="5583860">*</span><span class="ident" id="5583861">decoderState</span><span class="op" id="5583873">,</span>&nbsp;<span class="ident" id="5583875">value</span>&nbsp;<span class="ident" id="5583881">reflect</span><span class="op" id="5583888">.</span><span class="ident" id="5583889">Value</span><span class="op" id="5583894">,</span>&nbsp;<span class="ident" id="5583896">elemOp</span>&nbsp;<span class="ident" id="5583903">decOp</span><span class="op" id="5583908">,</span>&nbsp;<span class="ident" id="5583910">ovfl</span>&nbsp;<span class="builtintype" id="5583915">error</span><span class="op" id="5583920">,</span>&nbsp;<span class="ident" id="5583922">helper</span>&nbsp;<span class="ident" id="5583929">decHelper</span><span class="op" id="5583938">)</span>&nbsp;<span class="op" id="5583940">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583943">u</span>&nbsp;<span class="op" id="5583945">:=</span>&nbsp;<span class="ident" id="5583948">state</span><span class="op" id="5583953">.</span><span class="ident" id="5583954">decodeUint</span><span class="op" id="5583964">(</span><span class="op" id="5583965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583968">typ</span>&nbsp;<span class="op" id="5583972">:=</span>&nbsp;<span class="ident" id="5583975">value</span><span class="op" id="5583980">.</span><span class="ident" id="5583981">Type</span><span class="op" id="5583985">(</span><span class="op" id="5583986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583989">size</span>&nbsp;<span class="op" id="5583994">:=</span>&nbsp;<span class="builtintype" id="5583997">uint64</span><span class="op" id="5584003">(</span><span class="ident" id="5584004">typ</span><span class="op" id="5584007">.</span><span class="ident" id="5584008">Elem</span><span class="op" id="5584012">(</span><span class="op" id="5584013">)</span><span class="op" id="5584014">.</span><span class="ident" id="5584015">Size</span><span class="op" id="5584019">(</span><span class="op" id="5584020">)</span><span class="op" id="5584021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584024">nBytes</span>&nbsp;<span class="op" id="5584031">:=</span>&nbsp;<span class="ident" id="5584034">u</span>&nbsp;<span class="op" id="5584036">*</span>&nbsp;<span class="ident" id="5584038">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584044">n</span>&nbsp;<span class="op" id="5584046">:=</span>&nbsp;<span class="builtintype" id="5584049">int</span><span class="op" id="5584052">(</span><span class="ident" id="5584053">u</span><span class="op" id="5584054">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584057">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584106">if</span>&nbsp;<span class="ident" id="5584109">n</span>&nbsp;<span class="op" id="5584111">&lt;</span>&nbsp;<span class="num" id="5584113">0</span>&nbsp;<span class="op" id="5584115">||</span>&nbsp;<span class="builtintype" id="5584118">uint64</span><span class="op" id="5584124">(</span><span class="ident" id="5584125">n</span><span class="op" id="5584126">)</span>&nbsp;<span class="op" id="5584128">!=</span>&nbsp;<span class="ident" id="5584131">u</span>&nbsp;<span class="op" id="5584133">||</span>&nbsp;<span class="ident" id="5584136">nBytes</span>&nbsp;<span class="op" id="5584143">&gt;</span>&nbsp;<span class="ident" id="5584145">tooBig</span>&nbsp;<span class="op" id="5584152">||</span>&nbsp;<span class="op" id="5584155">(</span><span class="ident" id="5584156">size</span>&nbsp;<span class="op" id="5584161">&gt;</span>&nbsp;<span class="num" id="5584163">0</span>&nbsp;<span class="op" id="5584165">&amp;&amp;</span>&nbsp;<span class="ident" id="5584168">nBytes</span><span class="op" id="5584174">/</span><span class="ident" id="5584175">size</span>&nbsp;<span class="op" id="5584180">!=</span>&nbsp;<span class="ident" id="5584183">u</span><span class="op" id="5584184">)</span>&nbsp;<span class="op" id="5584186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584190">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584263">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584313">errorf</span><span class="op" id="5584319">(</span><span class="string" id="5584320">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5584363">,</span>&nbsp;<span class="ident" id="5584365">typ</span><span class="op" id="5584368">.</span><span class="ident" id="5584369">Elem</span><span class="op" id="5584373">(</span><span class="op" id="5584374">)</span><span class="op" id="5584375">,</span>&nbsp;<span class="ident" id="5584377">u</span><span class="op" id="5584378">,</span>&nbsp;<span class="ident" id="5584380">size</span><span class="op" id="5584384">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584390">if</span>&nbsp;<span class="ident" id="5584393">value</span><span class="op" id="5584398">.</span><span class="ident" id="5584399">Cap</span><span class="op" id="5584402">(</span><span class="op" id="5584403">)</span>&nbsp;<span class="op" id="5584405">&lt;</span>&nbsp;<span class="ident" id="5584407">n</span>&nbsp;<span class="op" id="5584409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584413">value</span><span class="op" id="5584418">.</span><span class="ident" id="5584419">Set</span><span class="op" id="5584422">(</span><span class="ident" id="5584423">reflect</span><span class="op" id="5584430">.</span><span class="ident" id="5584431">MakeSlice</span><span class="op" id="5584440">(</span><span class="ident" id="5584441">typ</span><span class="op" id="5584444">,</span>&nbsp;<span class="ident" id="5584446">n</span><span class="op" id="5584447">,</span>&nbsp;<span class="ident" id="5584449">n</span><span class="op" id="5584450">)</span><span class="op" id="5584451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584454">}</span>&nbsp;<span class="keyword" id="5584456">else</span>&nbsp;<span class="op" id="5584461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584465">value</span><span class="op" id="5584470">.</span><span class="ident" id="5584471">Set</span><span class="op" id="5584474">(</span><span class="ident" id="5584475">value</span><span class="op" id="5584480">.</span><span class="ident" id="5584481">Slice</span><span class="op" id="5584486">(</span><span class="num" id="5584487">0</span><span class="op" id="5584488">,</span>&nbsp;<span class="ident" id="5584490">n</span><span class="op" id="5584491">)</span><span class="op" id="5584492">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584498">dec</span><span class="op" id="5584501">.</span><span class="ident" id="5584502">decodeArrayHelper</span><span class="op" id="5584519">(</span><span class="ident" id="5584520">state</span><span class="op" id="5584525">,</span>&nbsp;<span class="ident" id="5584527">value</span><span class="op" id="5584532">,</span>&nbsp;<span class="ident" id="5584534">elemOp</span><span class="op" id="5584540">,</span>&nbsp;<span class="ident" id="5584542">n</span><span class="op" id="5584543">,</span>&nbsp;<span class="ident" id="5584545">ovfl</span><span class="op" id="5584549">,</span>&nbsp;<span class="ident" id="5584551">helper</span><span class="op" id="5584557">)</span><br>
<span class="lineno"></span><span class="op" id="5584559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5584562">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="5584636">func</span>&nbsp;<span class="op" id="5584641">(</span><span class="ident" id="5584642">dec</span>&nbsp;<span class="op" id="5584646">*</span><span class="ident" id="5584647">Decoder</span><span class="op" id="5584654">)</span>&nbsp;<span class="ident" id="5584656">ignoreSlice</span><span class="op" id="5584667">(</span><span class="ident" id="5584668">state</span>&nbsp;<span class="op" id="5584674">*</span><span class="ident" id="5584675">decoderState</span><span class="op" id="5584687">,</span>&nbsp;<span class="ident" id="5584689">elemOp</span>&nbsp;<span class="ident" id="5584696">decOp</span><span class="op" id="5584701">)</span>&nbsp;<span class="op" id="5584703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584706">dec</span><span class="op" id="5584709">.</span><span class="ident" id="5584710">ignoreArrayHelper</span><span class="op" id="5584727">(</span><span class="ident" id="5584728">state</span><span class="op" id="5584733">,</span>&nbsp;<span class="ident" id="5584735">elemOp</span><span class="op" id="5584741">,</span>&nbsp;<span class="builtintype" id="5584743">int</span><span class="op" id="5584746">(</span><span class="ident" id="5584747">state</span><span class="op" id="5584752">.</span><span class="ident" id="5584753">decodeUint</span><span class="op" id="5584763">(</span><span class="op" id="5584764">)</span><span class="op" id="5584765">)</span><span class="op" id="5584766">)</span><br>
<span class="lineno"></span><span class="op" id="5584768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5584771">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="5584841">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5584919">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5584983">func</span>&nbsp;<span class="op" id="5584988">(</span><span class="ident" id="5584989">dec</span>&nbsp;<span class="op" id="5584993">*</span><span class="ident" id="5584994">Decoder</span><span class="op" id="5585001">)</span>&nbsp;<span class="ident" id="5585003">decodeInterface</span><span class="op" id="5585018">(</span><span class="ident" id="5585019">ityp</span>&nbsp;<span class="ident" id="5585024">reflect</span><span class="op" id="5585031">.</span><span class="ident" id="5585032">Type</span><span class="op" id="5585036">,</span>&nbsp;<span class="ident" id="5585038">state</span>&nbsp;<span class="op" id="5585044">*</span><span class="ident" id="5585045">decoderState</span><span class="op" id="5585057">,</span>&nbsp;<span class="ident" id="5585059">value</span>&nbsp;<span class="ident" id="5585065">reflect</span><span class="op" id="5585072">.</span><span class="ident" id="5585073">Value</span><span class="op" id="5585078">)</span>&nbsp;<span class="op" id="5585080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585083">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585123">nr</span>&nbsp;<span class="op" id="5585126">:=</span>&nbsp;<span class="ident" id="5585129">state</span><span class="op" id="5585134">.</span><span class="ident" id="5585135">decodeUint</span><span class="op" id="5585145">(</span><span class="op" id="5585146">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585149">if</span>&nbsp;<span class="ident" id="5585152">nr</span>&nbsp;<span class="op" id="5585155">&lt;</span>&nbsp;<span class="num" id="5585157">0</span>&nbsp;<span class="op" id="5585159">||</span>&nbsp;<span class="ident" id="5585162">nr</span>&nbsp;<span class="op" id="5585165">&gt;</span>&nbsp;<span class="num" id="5585167">1</span><span class="op" id="5585168">&lt;&lt;</span><span class="num" id="5585170">31</span>&nbsp;<span class="op" id="5585173">{</span>&nbsp;<span class="comment" id="5585175">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585220">errorf</span><span class="op" id="5585226">(</span><span class="string" id="5585227">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="5585256">,</span>&nbsp;<span class="ident" id="5585258">nr</span><span class="op" id="5585260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585266">if</span>&nbsp;<span class="ident" id="5585269">nr</span>&nbsp;<span class="op" id="5585272">&gt;</span>&nbsp;<span class="builtintype" id="5585274">uint64</span><span class="op" id="5585280">(</span><span class="ident" id="5585281">state</span><span class="op" id="5585286">.</span><span class="ident" id="5585287">b</span><span class="op" id="5585288">.</span><span class="ident" id="5585289">Len</span><span class="op" id="5585292">(</span><span class="op" id="5585293">)</span><span class="op" id="5585294">)</span>&nbsp;<span class="op" id="5585296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585300">errorf</span><span class="op" id="5585306">(</span><span class="string" id="5585307">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="5585356">,</span>&nbsp;<span class="ident" id="5585358">nr</span><span class="op" id="5585360">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585366">b</span>&nbsp;<span class="op" id="5585368">:=</span>&nbsp;<span class="builtinfunc" id="5585371">make</span><span class="op" id="5585375">(</span><span class="op" id="5585376">[</span><span class="op" id="5585377">]</span><span class="builtintype" id="5585378">byte</span><span class="op" id="5585382">,</span>&nbsp;<span class="ident" id="5585384">nr</span><span class="op" id="5585386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585389">state</span><span class="op" id="5585394">.</span><span class="ident" id="5585395">b</span><span class="op" id="5585396">.</span><span class="ident" id="5585397">Read</span><span class="op" id="5585401">(</span><span class="ident" id="5585402">b</span><span class="op" id="5585403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585406">name</span>&nbsp;<span class="op" id="5585411">:=</span>&nbsp;<span class="builtintype" id="5585414">string</span><span class="op" id="5585420">(</span><span class="ident" id="5585421">b</span><span class="op" id="5585422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585425">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585471">if</span>&nbsp;<span class="ident" id="5585474">name</span>&nbsp;<span class="op" id="5585479">==</span>&nbsp;<span class="string" id="5585482">&#34;&#34;</span>&nbsp;<span class="op" id="5585485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585489">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585538">value</span><span class="op" id="5585543">.</span><span class="ident" id="5585544">Set</span><span class="op" id="5585547">(</span><span class="ident" id="5585548">reflect</span><span class="op" id="5585555">.</span><span class="ident" id="5585556">Zero</span><span class="op" id="5585560">(</span><span class="ident" id="5585561">value</span><span class="op" id="5585566">.</span><span class="ident" id="5585567">Type</span><span class="op" id="5585571">(</span><span class="op" id="5585572">)</span><span class="op" id="5585573">)</span><span class="op" id="5585574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585578">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585586">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585589">if</span>&nbsp;<span class="builtinfunc" id="5585592">len</span><span class="op" id="5585595">(</span><span class="ident" id="5585596">name</span><span class="op" id="5585600">)</span>&nbsp;<span class="op" id="5585602">&gt;</span>&nbsp;<span class="num" id="5585604">1024</span>&nbsp;<span class="op" id="5585609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585613">errorf</span><span class="op" id="5585619">(</span><span class="string" id="5585620">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="5585656">,</span>&nbsp;<span class="builtinfunc" id="5585658">len</span><span class="op" id="5585661">(</span><span class="ident" id="5585662">name</span><span class="op" id="5585666">)</span><span class="op" id="5585667">,</span>&nbsp;<span class="ident" id="5585669">name</span><span class="op" id="5585673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585679">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585721">registerLock</span><span class="op" id="5585733">.</span><span class="ident" id="5585734">RLock</span><span class="op" id="5585739">(</span><span class="op" id="5585740">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585743">typ</span><span class="op" id="5585746">,</span>&nbsp;<span class="ident" id="5585748">ok</span>&nbsp;<span class="op" id="5585751">:=</span>&nbsp;<span class="ident" id="5585754">nameToConcreteType</span><span class="op" id="5585772">[</span><span class="ident" id="5585773">name</span><span class="op" id="5585777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585780">registerLock</span><span class="op" id="5585792">.</span><span class="ident" id="5585793">RUnlock</span><span class="op" id="5585800">(</span><span class="op" id="5585801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585804">if</span>&nbsp;<span class="op" id="5585807">!</span><span class="ident" id="5585808">ok</span>&nbsp;<span class="op" id="5585811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585815">errorf</span><span class="op" id="5585821">(</span><span class="string" id="5585822">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="5585861">,</span>&nbsp;<span class="ident" id="5585863">name</span><span class="op" id="5585867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585870">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585873">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585917">concreteId</span>&nbsp;<span class="op" id="5585928">:=</span>&nbsp;<span class="ident" id="5585931">dec</span><span class="op" id="5585934">.</span><span class="ident" id="5585935">decodeTypeSequence</span><span class="op" id="5585953">(</span><span class="builtintype" id="5585954">true</span><span class="op" id="5585958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585961">if</span>&nbsp;<span class="ident" id="5585964">concreteId</span>&nbsp;<span class="op" id="5585975">&lt;</span>&nbsp;<span class="num" id="5585977">0</span>&nbsp;<span class="op" id="5585979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585983">error_</span><span class="op" id="5585989">(</span><span class="ident" id="5585990">dec</span><span class="op" id="5585993">.</span><span class="ident" id="5585994">err</span><span class="op" id="5585997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586000">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586003">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586073">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586141">state</span><span class="op" id="5586146">.</span><span class="ident" id="5586147">decodeUint</span><span class="op" id="5586157">(</span><span class="op" id="5586158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586161">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586190">v</span>&nbsp;<span class="op" id="5586192">:=</span>&nbsp;<span class="ident" id="5586195">allocValue</span><span class="op" id="5586205">(</span><span class="ident" id="5586206">typ</span><span class="op" id="5586209">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586212">dec</span><span class="op" id="5586215">.</span><span class="ident" id="5586216">decodeValue</span><span class="op" id="5586227">(</span><span class="ident" id="5586228">concreteId</span><span class="op" id="5586238">,</span>&nbsp;<span class="ident" id="5586240">v</span><span class="op" id="5586241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586244">if</span>&nbsp;<span class="ident" id="5586247">dec</span><span class="op" id="5586250">.</span><span class="ident" id="5586251">err</span>&nbsp;<span class="op" id="5586255">!=</span>&nbsp;<span class="builtintype" id="5586258">nil</span>&nbsp;<span class="op" id="5586262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586266">error_</span><span class="op" id="5586272">(</span><span class="ident" id="5586273">dec</span><span class="op" id="5586276">.</span><span class="ident" id="5586277">err</span><span class="op" id="5586280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586286">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586334">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586391">if</span>&nbsp;<span class="op" id="5586394">!</span><span class="ident" id="5586395">typ</span><span class="op" id="5586398">.</span><span class="ident" id="5586399">AssignableTo</span><span class="op" id="5586411">(</span><span class="ident" id="5586412">ityp</span><span class="op" id="5586416">)</span>&nbsp;<span class="op" id="5586418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586422">errorf</span><span class="op" id="5586428">(</span><span class="string" id="5586429">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5586462">,</span>&nbsp;<span class="ident" id="5586464">typ</span><span class="op" id="5586467">,</span>&nbsp;<span class="ident" id="5586469">ityp</span><span class="op" id="5586473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586479">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586523">value</span><span class="op" id="5586528">.</span><span class="ident" id="5586529">Set</span><span class="op" id="5586532">(</span><span class="ident" id="5586533">v</span><span class="op" id="5586534">)</span><br>
<span class="lineno"></span><span class="op" id="5586536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5586539">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5586620">func</span>&nbsp;<span class="op" id="5586625">(</span><span class="ident" id="5586626">dec</span>&nbsp;<span class="op" id="5586630">*</span><span class="ident" id="5586631">Decoder</span><span class="op" id="5586638">)</span>&nbsp;<span class="ident" id="5586640">ignoreInterface</span><span class="op" id="5586655">(</span><span class="ident" id="5586656">state</span>&nbsp;<span class="op" id="5586662">*</span><span class="ident" id="5586663">decoderState</span><span class="op" id="5586675">)</span>&nbsp;<span class="op" id="5586677">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586680">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586720">b</span>&nbsp;<span class="op" id="5586722">:=</span>&nbsp;<span class="builtinfunc" id="5586725">make</span><span class="op" id="5586729">(</span><span class="op" id="5586730">[</span><span class="op" id="5586731">]</span><span class="builtintype" id="5586732">byte</span><span class="op" id="5586736">,</span>&nbsp;<span class="ident" id="5586738">state</span><span class="op" id="5586743">.</span><span class="ident" id="5586744">decodeUint</span><span class="op" id="5586754">(</span><span class="op" id="5586755">)</span><span class="op" id="5586756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586759">_</span><span class="op" id="5586760">,</span>&nbsp;<span class="ident" id="5586762">err</span>&nbsp;<span class="op" id="5586766">:=</span>&nbsp;<span class="ident" id="5586769">state</span><span class="op" id="5586774">.</span><span class="ident" id="5586775">b</span><span class="op" id="5586776">.</span><span class="ident" id="5586777">Read</span><span class="op" id="5586781">(</span><span class="ident" id="5586782">b</span><span class="op" id="5586783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586786">if</span>&nbsp;<span class="ident" id="5586789">err</span>&nbsp;<span class="op" id="5586793">!=</span>&nbsp;<span class="builtintype" id="5586796">nil</span>&nbsp;<span class="op" id="5586800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586804">error_</span><span class="op" id="5586810">(</span><span class="ident" id="5586811">err</span><span class="op" id="5586814">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586820">id</span>&nbsp;<span class="op" id="5586823">:=</span>&nbsp;<span class="ident" id="5586826">dec</span><span class="op" id="5586829">.</span><span class="ident" id="5586830">decodeTypeSequence</span><span class="op" id="5586848">(</span><span class="builtintype" id="5586849">true</span><span class="op" id="5586853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586856">if</span>&nbsp;<span class="ident" id="5586859">id</span>&nbsp;<span class="op" id="5586862">&lt;</span>&nbsp;<span class="num" id="5586864">0</span>&nbsp;<span class="op" id="5586866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586870">error_</span><span class="op" id="5586876">(</span><span class="ident" id="5586877">dec</span><span class="op" id="5586880">.</span><span class="ident" id="5586881">err</span><span class="op" id="5586884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586887">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586890">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586970">state</span><span class="op" id="5586975">.</span><span class="ident" id="5586976">b</span><span class="op" id="5586977">.</span><span class="ident" id="5586978">Drop</span><span class="op" id="5586982">(</span><span class="builtintype" id="5586983">int</span><span class="op" id="5586986">(</span><span class="ident" id="5586987">state</span><span class="op" id="5586992">.</span><span class="ident" id="5586993">decodeUint</span><span class="op" id="5587003">(</span><span class="op" id="5587004">)</span><span class="op" id="5587005">)</span><span class="op" id="5587006">)</span><br>
<span class="lineno"></span><span class="op" id="5587008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5587011">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="5587088">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="5587128">func</span>&nbsp;<span class="op" id="5587133">(</span><span class="ident" id="5587134">dec</span>&nbsp;<span class="op" id="5587138">*</span><span class="ident" id="5587139">Decoder</span><span class="op" id="5587146">)</span>&nbsp;<span class="ident" id="5587148">decodeGobDecoder</span><span class="op" id="5587164">(</span><span class="ident" id="5587165">ut</span>&nbsp;<span class="op" id="5587168">*</span><span class="ident" id="5587169">userTypeInfo</span><span class="op" id="5587181">,</span>&nbsp;<span class="ident" id="5587183">state</span>&nbsp;<span class="op" id="5587189">*</span><span class="ident" id="5587190">decoderState</span><span class="op" id="5587202">,</span>&nbsp;<span class="ident" id="5587204">value</span>&nbsp;<span class="ident" id="5587210">reflect</span><span class="op" id="5587217">.</span><span class="ident" id="5587218">Value</span><span class="op" id="5587223">)</span>&nbsp;<span class="op" id="5587225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587228">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587262">b</span>&nbsp;<span class="op" id="5587264">:=</span>&nbsp;<span class="builtinfunc" id="5587267">make</span><span class="op" id="5587271">(</span><span class="op" id="5587272">[</span><span class="op" id="5587273">]</span><span class="builtintype" id="5587274">byte</span><span class="op" id="5587278">,</span>&nbsp;<span class="ident" id="5587280">state</span><span class="op" id="5587285">.</span><span class="ident" id="5587286">decodeUint</span><span class="op" id="5587296">(</span><span class="op" id="5587297">)</span><span class="op" id="5587298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587301">_</span><span class="op" id="5587302">,</span>&nbsp;<span class="ident" id="5587304">err</span>&nbsp;<span class="op" id="5587308">:=</span>&nbsp;<span class="ident" id="5587311">state</span><span class="op" id="5587316">.</span><span class="ident" id="5587317">b</span><span class="op" id="5587318">.</span><span class="ident" id="5587319">Read</span><span class="op" id="5587323">(</span><span class="ident" id="5587324">b</span><span class="op" id="5587325">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587328">if</span>&nbsp;<span class="ident" id="5587331">err</span>&nbsp;<span class="op" id="5587335">!=</span>&nbsp;<span class="builtintype" id="5587338">nil</span>&nbsp;<span class="op" id="5587342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587346">error_</span><span class="op" id="5587352">(</span><span class="ident" id="5587353">err</span><span class="op" id="5587356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587362">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587393">switch</span>&nbsp;<span class="ident" id="5587400">ut</span><span class="op" id="5587402">.</span><span class="ident" id="5587403">externalDec</span>&nbsp;<span class="op" id="5587415">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587418">case</span>&nbsp;<span class="ident" id="5587423">xGob</span><span class="op" id="5587427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587431">err</span>&nbsp;<span class="op" id="5587435">=</span>&nbsp;<span class="ident" id="5587437">value</span><span class="op" id="5587442">.</span><span class="ident" id="5587443">Interface</span><span class="op" id="5587452">(</span><span class="op" id="5587453">)</span><span class="op" id="5587454">.</span><span class="op" id="5587455">(</span><span class="ident" id="5587456">GobDecoder</span><span class="op" id="5587466">)</span><span class="op" id="5587467">.</span><span class="ident" id="5587468">GobDecode</span><span class="op" id="5587477">(</span><span class="ident" id="5587478">b</span><span class="op" id="5587479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587482">case</span>&nbsp;<span class="ident" id="5587487">xBinary</span><span class="op" id="5587494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587498">err</span>&nbsp;<span class="op" id="5587502">=</span>&nbsp;<span class="ident" id="5587504">value</span><span class="op" id="5587509">.</span><span class="ident" id="5587510">Interface</span><span class="op" id="5587519">(</span><span class="op" id="5587520">)</span><span class="op" id="5587521">.</span><span class="op" id="5587522">(</span><span class="ident" id="5587523">encoding</span><span class="op" id="5587531">.</span><span class="ident" id="5587532">BinaryUnmarshaler</span><span class="op" id="5587549">)</span><span class="op" id="5587550">.</span><span class="ident" id="5587551">UnmarshalBinary</span><span class="op" id="5587566">(</span><span class="ident" id="5587567">b</span><span class="op" id="5587568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587571">case</span>&nbsp;<span class="ident" id="5587576">xText</span><span class="op" id="5587581">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587585">err</span>&nbsp;<span class="op" id="5587589">=</span>&nbsp;<span class="ident" id="5587591">value</span><span class="op" id="5587596">.</span><span class="ident" id="5587597">Interface</span><span class="op" id="5587606">(</span><span class="op" id="5587607">)</span><span class="op" id="5587608">.</span><span class="op" id="5587609">(</span><span class="ident" id="5587610">encoding</span><span class="op" id="5587618">.</span><span class="ident" id="5587619">TextUnmarshaler</span><span class="op" id="5587634">)</span><span class="op" id="5587635">.</span><span class="ident" id="5587636">UnmarshalText</span><span class="op" id="5587649">(</span><span class="ident" id="5587650">b</span><span class="op" id="5587651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587657">if</span>&nbsp;<span class="ident" id="5587660">err</span>&nbsp;<span class="op" id="5587664">!=</span>&nbsp;<span class="builtintype" id="5587667">nil</span>&nbsp;<span class="op" id="5587671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587675">error_</span><span class="op" id="5587681">(</span><span class="ident" id="5587682">err</span><span class="op" id="5587685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587688">}</span><br>
<span class="lineno">715</span><span class="op" id="5587690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5587693">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5587775">func</span>&nbsp;<span class="op" id="5587780">(</span><span class="ident" id="5587781">dec</span>&nbsp;<span class="op" id="5587785">*</span><span class="ident" id="5587786">Decoder</span><span class="op" id="5587793">)</span>&nbsp;<span class="ident" id="5587795">ignoreGobDecoder</span><span class="op" id="5587811">(</span><span class="ident" id="5587812">state</span>&nbsp;<span class="op" id="5587818">*</span><span class="ident" id="5587819">decoderState</span><span class="op" id="5587831">)</span>&nbsp;<span class="op" id="5587833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587836">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587870">b</span>&nbsp;<span class="op" id="5587872">:=</span>&nbsp;<span class="builtinfunc" id="5587875">make</span><span class="op" id="5587879">(</span><span class="op" id="5587880">[</span><span class="op" id="5587881">]</span><span class="builtintype" id="5587882">byte</span><span class="op" id="5587886">,</span>&nbsp;<span class="ident" id="5587888">state</span><span class="op" id="5587893">.</span><span class="ident" id="5587894">decodeUint</span><span class="op" id="5587904">(</span><span class="op" id="5587905">)</span><span class="op" id="5587906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587909">_</span><span class="op" id="5587910">,</span>&nbsp;<span class="ident" id="5587912">err</span>&nbsp;<span class="op" id="5587916">:=</span>&nbsp;<span class="ident" id="5587919">state</span><span class="op" id="5587924">.</span><span class="ident" id="5587925">b</span><span class="op" id="5587926">.</span><span class="ident" id="5587927">Read</span><span class="op" id="5587931">(</span><span class="ident" id="5587932">b</span><span class="op" id="5587933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587936">if</span>&nbsp;<span class="ident" id="5587939">err</span>&nbsp;<span class="op" id="5587943">!=</span>&nbsp;<span class="builtintype" id="5587946">nil</span>&nbsp;<span class="op" id="5587950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587954">error_</span><span class="op" id="5587960">(</span><span class="ident" id="5587961">err</span><span class="op" id="5587964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587967">}</span><br>
<span class="lineno">725</span><span class="op" id="5587969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5587972">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="5587994">var</span>&nbsp;<span class="ident" id="5587998">decOpTable</span>&nbsp;<span class="op" id="5588009">=</span>&nbsp;<span class="op" id="5588011">[</span><span class="op" id="5588012">...</span><span class="op" id="5588015">]</span><span class="ident" id="5588016">decOp</span><span class="op" id="5588021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588024">reflect</span><span class="op" id="5588031">.</span><span class="ident" id="5588032">Bool</span><span class="op" id="5588036">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588044">decBool</span><span class="op" id="5588051">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588054">reflect</span><span class="op" id="5588061">.</span><span class="ident" id="5588062">Int8</span><span class="op" id="5588066">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588074">decInt8</span><span class="op" id="5588081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588084">reflect</span><span class="op" id="5588091">.</span><span class="ident" id="5588092">Int16</span><span class="op" id="5588097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588104">decInt16</span><span class="op" id="5588112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588115">reflect</span><span class="op" id="5588122">.</span><span class="ident" id="5588123">Int32</span><span class="op" id="5588128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588135">decInt32</span><span class="op" id="5588143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588146">reflect</span><span class="op" id="5588153">.</span><span class="ident" id="5588154">Int64</span><span class="op" id="5588159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588166">decInt64</span><span class="op" id="5588174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588177">reflect</span><span class="op" id="5588184">.</span><span class="ident" id="5588185">Uint8</span><span class="op" id="5588190">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588197">decUint8</span><span class="op" id="5588205">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588208">reflect</span><span class="op" id="5588215">.</span><span class="ident" id="5588216">Uint16</span><span class="op" id="5588222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588228">decUint16</span><span class="op" id="5588237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588240">reflect</span><span class="op" id="5588247">.</span><span class="ident" id="5588248">Uint32</span><span class="op" id="5588254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588260">decUint32</span><span class="op" id="5588269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588272">reflect</span><span class="op" id="5588279">.</span><span class="ident" id="5588280">Uint64</span><span class="op" id="5588286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588292">decUint64</span><span class="op" id="5588301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588304">reflect</span><span class="op" id="5588311">.</span><span class="ident" id="5588312">Float32</span><span class="op" id="5588319">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588324">decFloat32</span><span class="op" id="5588334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588337">reflect</span><span class="op" id="5588344">.</span><span class="ident" id="5588345">Float64</span><span class="op" id="5588352">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588357">decFloat64</span><span class="op" id="5588367">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588370">reflect</span><span class="op" id="5588377">.</span><span class="ident" id="5588378">Complex64</span><span class="op" id="5588387">:</span>&nbsp;&nbsp;<span class="ident" id="5588390">decComplex64</span><span class="op" id="5588402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588405">reflect</span><span class="op" id="5588412">.</span><span class="ident" id="5588413">Complex128</span><span class="op" id="5588423">:</span>&nbsp;<span class="ident" id="5588425">decComplex128</span><span class="op" id="5588438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588441">reflect</span><span class="op" id="5588448">.</span><span class="ident" id="5588449">String</span><span class="op" id="5588455">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588461">decString</span><span class="op" id="5588470">,</span><br>
<span class="lineno"></span><span class="op" id="5588472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5588475">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="5588544">var</span>&nbsp;<span class="ident" id="5588548">decIgnoreOpMap</span>&nbsp;<span class="op" id="5588563">=</span>&nbsp;<span class="keyword" id="5588565">map</span><span class="op" id="5588568">[</span><span class="ident" id="5588569">typeId</span><span class="op" id="5588575">]</span><span class="ident" id="5588576">decOp</span><span class="op" id="5588581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588584">tBool</span><span class="op" id="5588589">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588594">ignoreUint</span><span class="op" id="5588604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588607">tInt</span><span class="op" id="5588611">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588617">ignoreUint</span><span class="op" id="5588627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588630">tUint</span><span class="op" id="5588635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588640">ignoreUint</span><span class="op" id="5588650">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588653">tFloat</span><span class="op" id="5588659">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5588663">ignoreUint</span><span class="op" id="5588673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588676">tBytes</span><span class="op" id="5588682">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5588686">ignoreUint8Array</span><span class="op" id="5588702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588705">tString</span><span class="op" id="5588712">:</span>&nbsp;&nbsp;<span class="ident" id="5588715">ignoreUint8Array</span><span class="op" id="5588731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588734">tComplex</span><span class="op" id="5588742">:</span>&nbsp;<span class="ident" id="5588744">ignoreTwoUints</span><span class="op" id="5588758">,</span><br>
<span class="lineno"></span><span class="op" id="5588760">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="5588763">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5588830">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5588868">func</span>&nbsp;<span class="op" id="5588873">(</span><span class="ident" id="5588874">dec</span>&nbsp;<span class="op" id="5588878">*</span><span class="ident" id="5588879">Decoder</span><span class="op" id="5588886">)</span>&nbsp;<span class="ident" id="5588888">decOpFor</span><span class="op" id="5588896">(</span><span class="ident" id="5588897">wireId</span>&nbsp;<span class="ident" id="5588904">typeId</span><span class="op" id="5588910">,</span>&nbsp;<span class="ident" id="5588912">rt</span>&nbsp;<span class="ident" id="5588915">reflect</span><span class="op" id="5588922">.</span><span class="ident" id="5588923">Type</span><span class="op" id="5588927">,</span>&nbsp;<span class="ident" id="5588929">name</span>&nbsp;<span class="builtintype" id="5588934">string</span><span class="op" id="5588940">,</span>&nbsp;<span class="ident" id="5588942">inProgress</span>&nbsp;<span class="keyword" id="5588953">map</span><span class="op" id="5588956">[</span><span class="ident" id="5588957">reflect</span><span class="op" id="5588964">.</span><span class="ident" id="5588965">Type</span><span class="op" id="5588969">]</span><span class="op" id="5588970">*</span><span class="ident" id="5588971">decOp</span><span class="op" id="5588976">)</span>&nbsp;<span class="op" id="5588978">*</span><span class="ident" id="5588979">decOp</span>&nbsp;<span class="op" id="5588985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588988">ut</span>&nbsp;<span class="op" id="5588991">:=</span>&nbsp;<span class="ident" id="5588994">userType</span><span class="op" id="5589002">(</span><span class="ident" id="5589003">rt</span><span class="op" id="5589005">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589008">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589088">if</span>&nbsp;<span class="ident" id="5589091">ut</span><span class="op" id="5589093">.</span><span class="ident" id="5589094">externalDec</span>&nbsp;<span class="op" id="5589106">!=</span>&nbsp;<span class="num" id="5589109">0</span>&nbsp;<span class="op" id="5589111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589115">return</span>&nbsp;<span class="ident" id="5589122">dec</span><span class="op" id="5589125">.</span><span class="ident" id="5589126">gobDecodeOpFor</span><span class="op" id="5589140">(</span><span class="ident" id="5589141">ut</span><span class="op" id="5589143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589150">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589235">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589292">if</span>&nbsp;<span class="ident" id="5589295">opPtr</span>&nbsp;<span class="op" id="5589301">:=</span>&nbsp;<span class="ident" id="5589304">inProgress</span><span class="op" id="5589314">[</span><span class="ident" id="5589315">rt</span><span class="op" id="5589317">]</span><span class="op" id="5589318">;</span>&nbsp;<span class="ident" id="5589320">opPtr</span>&nbsp;<span class="op" id="5589326">!=</span>&nbsp;<span class="builtintype" id="5589329">nil</span>&nbsp;<span class="op" id="5589333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589337">return</span>&nbsp;<span class="ident" id="5589344">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589351">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589354">typ</span>&nbsp;<span class="op" id="5589358">:=</span>&nbsp;<span class="ident" id="5589361">ut</span><span class="op" id="5589363">.</span><span class="ident" id="5589364">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589370">var</span>&nbsp;<span class="ident" id="5589374">op</span>&nbsp;<span class="ident" id="5589377">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589384">k</span>&nbsp;<span class="op" id="5589386">:=</span>&nbsp;<span class="ident" id="5589389">typ</span><span class="op" id="5589392">.</span><span class="ident" id="5589393">Kind</span><span class="op" id="5589397">(</span><span class="op" id="5589398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589401">if</span>&nbsp;<span class="builtintype" id="5589404">int</span><span class="op" id="5589407">(</span><span class="ident" id="5589408">k</span><span class="op" id="5589409">)</span>&nbsp;<span class="op" id="5589411">&lt;</span>&nbsp;<span class="builtinfunc" id="5589413">len</span><span class="op" id="5589416">(</span><span class="ident" id="5589417">decOpTable</span><span class="op" id="5589427">)</span>&nbsp;<span class="op" id="5589429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589433">op</span>&nbsp;<span class="op" id="5589436">=</span>&nbsp;<span class="ident" id="5589438">decOpTable</span><span class="op" id="5589448">[</span><span class="ident" id="5589449">k</span><span class="op" id="5589450">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589456">if</span>&nbsp;<span class="ident" id="5589459">op</span>&nbsp;<span class="op" id="5589462">==</span>&nbsp;<span class="builtintype" id="5589465">nil</span>&nbsp;<span class="op" id="5589469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589473">inProgress</span><span class="op" id="5589483">[</span><span class="ident" id="5589484">rt</span><span class="op" id="5589486">]</span>&nbsp;<span class="op" id="5589488">=</span>&nbsp;<span class="op" id="5589490">&amp;</span><span class="ident" id="5589491">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589496">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589515">switch</span>&nbsp;<span class="ident" id="5589522">t</span>&nbsp;<span class="op" id="5589524">:=</span>&nbsp;<span class="ident" id="5589527">typ</span><span class="op" id="5589530">;</span>&nbsp;<span class="ident" id="5589532">t</span><span class="op" id="5589533">.</span><span class="ident" id="5589534">Kind</span><span class="op" id="5589538">(</span><span class="op" id="5589539">)</span>&nbsp;<span class="op" id="5589541">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589545">case</span>&nbsp;<span class="ident" id="5589550">reflect</span><span class="op" id="5589557">.</span><span class="ident" id="5589558">Array</span><span class="op" id="5589563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589568">name</span>&nbsp;<span class="op" id="5589573">=</span>&nbsp;<span class="string" id="5589575">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5589589">+</span>&nbsp;<span class="ident" id="5589591">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589599">elemId</span>&nbsp;<span class="op" id="5589606">:=</span>&nbsp;<span class="ident" id="5589609">dec</span><span class="op" id="5589612">.</span><span class="ident" id="5589613">wireType</span><span class="op" id="5589621">[</span><span class="ident" id="5589622">wireId</span><span class="op" id="5589628">]</span><span class="op" id="5589629">.</span><span class="ident" id="5589630">ArrayT</span><span class="op" id="5589636">.</span><span class="ident" id="5589637">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589645">elemOp</span>&nbsp;<span class="op" id="5589652">:=</span>&nbsp;<span class="ident" id="5589655">dec</span><span class="op" id="5589658">.</span><span class="ident" id="5589659">decOpFor</span><span class="op" id="5589667">(</span><span class="ident" id="5589668">elemId</span><span class="op" id="5589674">,</span>&nbsp;<span class="ident" id="5589676">t</span><span class="op" id="5589677">.</span><span class="ident" id="5589678">Elem</span><span class="op" id="5589682">(</span><span class="op" id="5589683">)</span><span class="op" id="5589684">,</span>&nbsp;<span class="ident" id="5589686">name</span><span class="op" id="5589690">,</span>&nbsp;<span class="ident" id="5589692">inProgress</span><span class="op" id="5589702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589707">ovfl</span>&nbsp;<span class="op" id="5589712">:=</span>&nbsp;<span class="ident" id="5589715">overflow</span><span class="op" id="5589723">(</span><span class="ident" id="5589724">name</span><span class="op" id="5589728">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589733">helper</span>&nbsp;<span class="op" id="5589740">:=</span>&nbsp;<span class="ident" id="5589743">decArrayHelper</span><span class="op" id="5589757">[</span><span class="ident" id="5589758">t</span><span class="op" id="5589759">.</span><span class="ident" id="5589760">Elem</span><span class="op" id="5589764">(</span><span class="op" id="5589765">)</span><span class="op" id="5589766">.</span><span class="ident" id="5589767">Kind</span><span class="op" id="5589771">(</span><span class="op" id="5589772">)</span><span class="op" id="5589773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589778">op</span>&nbsp;<span class="op" id="5589781">=</span>&nbsp;<span class="keyword" id="5589783">func</span><span class="op" id="5589787">(</span><span class="ident" id="5589788">i</span>&nbsp;<span class="op" id="5589790">*</span><span class="ident" id="5589791">decInstr</span><span class="op" id="5589799">,</span>&nbsp;<span class="ident" id="5589801">state</span>&nbsp;<span class="op" id="5589807">*</span><span class="ident" id="5589808">decoderState</span><span class="op" id="5589820">,</span>&nbsp;<span class="ident" id="5589822">value</span>&nbsp;<span class="ident" id="5589828">reflect</span><span class="op" id="5589835">.</span><span class="ident" id="5589836">Value</span><span class="op" id="5589841">)</span>&nbsp;<span class="op" id="5589843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589849">state</span><span class="op" id="5589854">.</span><span class="ident" id="5589855">dec</span><span class="op" id="5589858">.</span><span class="ident" id="5589859">decodeArray</span><span class="op" id="5589870">(</span><span class="ident" id="5589871">t</span><span class="op" id="5589872">,</span>&nbsp;<span class="ident" id="5589874">state</span><span class="op" id="5589879">,</span>&nbsp;<span class="ident" id="5589881">value</span><span class="op" id="5589886">,</span>&nbsp;<span class="op" id="5589888">*</span><span class="ident" id="5589889">elemOp</span><span class="op" id="5589895">,</span>&nbsp;<span class="ident" id="5589897">t</span><span class="op" id="5589898">.</span><span class="ident" id="5589899">Len</span><span class="op" id="5589902">(</span><span class="op" id="5589903">)</span><span class="op" id="5589904">,</span>&nbsp;<span class="ident" id="5589906">ovfl</span><span class="op" id="5589910">,</span>&nbsp;<span class="ident" id="5589912">helper</span><span class="op" id="5589918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589928">case</span>&nbsp;<span class="ident" id="5589933">reflect</span><span class="op" id="5589940">.</span><span class="ident" id="5589941">Map</span><span class="op" id="5589944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589949">keyId</span>&nbsp;<span class="op" id="5589955">:=</span>&nbsp;<span class="ident" id="5589958">dec</span><span class="op" id="5589961">.</span><span class="ident" id="5589962">wireType</span><span class="op" id="5589970">[</span><span class="ident" id="5589971">wireId</span><span class="op" id="5589977">]</span><span class="op" id="5589978">.</span><span class="ident" id="5589979">MapT</span><span class="op" id="5589983">.</span><span class="ident" id="5589984">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589991">elemId</span>&nbsp;<span class="op" id="5589998">:=</span>&nbsp;<span class="ident" id="5590001">dec</span><span class="op" id="5590004">.</span><span class="ident" id="5590005">wireType</span><span class="op" id="5590013">[</span><span class="ident" id="5590014">wireId</span><span class="op" id="5590020">]</span><span class="op" id="5590021">.</span><span class="ident" id="5590022">MapT</span><span class="op" id="5590026">.</span><span class="ident" id="5590027">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590035">keyOp</span>&nbsp;<span class="op" id="5590041">:=</span>&nbsp;<span class="ident" id="5590044">dec</span><span class="op" id="5590047">.</span><span class="ident" id="5590048">decOpFor</span><span class="op" id="5590056">(</span><span class="ident" id="5590057">keyId</span><span class="op" id="5590062">,</span>&nbsp;<span class="ident" id="5590064">t</span><span class="op" id="5590065">.</span><span class="ident" id="5590066">Key</span><span class="op" id="5590069">(</span><span class="op" id="5590070">)</span><span class="op" id="5590071">,</span>&nbsp;<span class="string" id="5590073">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="5590082">+</span><span class="ident" id="5590083">name</span><span class="op" id="5590087">,</span>&nbsp;<span class="ident" id="5590089">inProgress</span><span class="op" id="5590099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590104">elemOp</span>&nbsp;<span class="op" id="5590111">:=</span>&nbsp;<span class="ident" id="5590114">dec</span><span class="op" id="5590117">.</span><span class="ident" id="5590118">decOpFor</span><span class="op" id="5590126">(</span><span class="ident" id="5590127">elemId</span><span class="op" id="5590133">,</span>&nbsp;<span class="ident" id="5590135">t</span><span class="op" id="5590136">.</span><span class="ident" id="5590137">Elem</span><span class="op" id="5590141">(</span><span class="op" id="5590142">)</span><span class="op" id="5590143">,</span>&nbsp;<span class="string" id="5590145">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="5590158">+</span><span class="ident" id="5590159">name</span><span class="op" id="5590163">,</span>&nbsp;<span class="ident" id="5590165">inProgress</span><span class="op" id="5590175">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590180">ovfl</span>&nbsp;<span class="op" id="5590185">:=</span>&nbsp;<span class="ident" id="5590188">overflow</span><span class="op" id="5590196">(</span><span class="ident" id="5590197">name</span><span class="op" id="5590201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590206">op</span>&nbsp;<span class="op" id="5590209">=</span>&nbsp;<span class="keyword" id="5590211">func</span><span class="op" id="5590215">(</span><span class="ident" id="5590216">i</span>&nbsp;<span class="op" id="5590218">*</span><span class="ident" id="5590219">decInstr</span><span class="op" id="5590227">,</span>&nbsp;<span class="ident" id="5590229">state</span>&nbsp;<span class="op" id="5590235">*</span><span class="ident" id="5590236">decoderState</span><span class="op" id="5590248">,</span>&nbsp;<span class="ident" id="5590250">value</span>&nbsp;<span class="ident" id="5590256">reflect</span><span class="op" id="5590263">.</span><span class="ident" id="5590264">Value</span><span class="op" id="5590269">)</span>&nbsp;<span class="op" id="5590271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590277">state</span><span class="op" id="5590282">.</span><span class="ident" id="5590283">dec</span><span class="op" id="5590286">.</span><span class="ident" id="5590287">decodeMap</span><span class="op" id="5590296">(</span><span class="ident" id="5590297">t</span><span class="op" id="5590298">,</span>&nbsp;<span class="ident" id="5590300">state</span><span class="op" id="5590305">,</span>&nbsp;<span class="ident" id="5590307">value</span><span class="op" id="5590312">,</span>&nbsp;<span class="op" id="5590314">*</span><span class="ident" id="5590315">keyOp</span><span class="op" id="5590320">,</span>&nbsp;<span class="op" id="5590322">*</span><span class="ident" id="5590323">elemOp</span><span class="op" id="5590329">,</span>&nbsp;<span class="ident" id="5590331">ovfl</span><span class="op" id="5590335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590345">case</span>&nbsp;<span class="ident" id="5590350">reflect</span><span class="op" id="5590357">.</span><span class="ident" id="5590358">Slice</span><span class="op" id="5590363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590368">name</span>&nbsp;<span class="op" id="5590373">=</span>&nbsp;<span class="string" id="5590375">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5590389">+</span>&nbsp;<span class="ident" id="5590391">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590399">if</span>&nbsp;<span class="ident" id="5590402">t</span><span class="op" id="5590403">.</span><span class="ident" id="5590404">Elem</span><span class="op" id="5590408">(</span><span class="op" id="5590409">)</span><span class="op" id="5590410">.</span><span class="ident" id="5590411">Kind</span><span class="op" id="5590415">(</span><span class="op" id="5590416">)</span>&nbsp;<span class="op" id="5590418">==</span>&nbsp;<span class="ident" id="5590421">reflect</span><span class="op" id="5590428">.</span><span class="ident" id="5590429">Uint8</span>&nbsp;<span class="op" id="5590435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590441">op</span>&nbsp;<span class="op" id="5590444">=</span>&nbsp;<span class="ident" id="5590446">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590464">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590478">var</span>&nbsp;<span class="ident" id="5590482">elemId</span>&nbsp;<span class="ident" id="5590489">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590499">if</span>&nbsp;<span class="ident" id="5590502">tt</span><span class="op" id="5590504">,</span>&nbsp;<span class="ident" id="5590506">ok</span>&nbsp;<span class="op" id="5590509">:=</span>&nbsp;<span class="ident" id="5590512">builtinIdToType</span><span class="op" id="5590527">[</span><span class="ident" id="5590528">wireId</span><span class="op" id="5590534">]</span><span class="op" id="5590535">;</span>&nbsp;<span class="ident" id="5590537">ok</span>&nbsp;<span class="op" id="5590540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590546">elemId</span>&nbsp;<span class="op" id="5590553">=</span>&nbsp;<span class="ident" id="5590555">tt</span><span class="op" id="5590557">.</span><span class="op" id="5590558">(</span><span class="op" id="5590559">*</span><span class="ident" id="5590560">sliceType</span><span class="op" id="5590569">)</span><span class="op" id="5590570">.</span><span class="ident" id="5590571">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590579">}</span>&nbsp;<span class="keyword" id="5590581">else</span>&nbsp;<span class="op" id="5590586">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590592">elemId</span>&nbsp;<span class="op" id="5590599">=</span>&nbsp;<span class="ident" id="5590601">dec</span><span class="op" id="5590604">.</span><span class="ident" id="5590605">wireType</span><span class="op" id="5590613">[</span><span class="ident" id="5590614">wireId</span><span class="op" id="5590620">]</span><span class="op" id="5590621">.</span><span class="ident" id="5590622">SliceT</span><span class="op" id="5590628">.</span><span class="ident" id="5590629">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590642">elemOp</span>&nbsp;<span class="op" id="5590649">:=</span>&nbsp;<span class="ident" id="5590652">dec</span><span class="op" id="5590655">.</span><span class="ident" id="5590656">decOpFor</span><span class="op" id="5590664">(</span><span class="ident" id="5590665">elemId</span><span class="op" id="5590671">,</span>&nbsp;<span class="ident" id="5590673">t</span><span class="op" id="5590674">.</span><span class="ident" id="5590675">Elem</span><span class="op" id="5590679">(</span><span class="op" id="5590680">)</span><span class="op" id="5590681">,</span>&nbsp;<span class="ident" id="5590683">name</span><span class="op" id="5590687">,</span>&nbsp;<span class="ident" id="5590689">inProgress</span><span class="op" id="5590699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590704">ovfl</span>&nbsp;<span class="op" id="5590709">:=</span>&nbsp;<span class="ident" id="5590712">overflow</span><span class="op" id="5590720">(</span><span class="ident" id="5590721">name</span><span class="op" id="5590725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590730">helper</span>&nbsp;<span class="op" id="5590737">:=</span>&nbsp;<span class="ident" id="5590740">decSliceHelper</span><span class="op" id="5590754">[</span><span class="ident" id="5590755">t</span><span class="op" id="5590756">.</span><span class="ident" id="5590757">Elem</span><span class="op" id="5590761">(</span><span class="op" id="5590762">)</span><span class="op" id="5590763">.</span><span class="ident" id="5590764">Kind</span><span class="op" id="5590768">(</span><span class="op" id="5590769">)</span><span class="op" id="5590770">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590775">op</span>&nbsp;<span class="op" id="5590778">=</span>&nbsp;<span class="keyword" id="5590780">func</span><span class="op" id="5590784">(</span><span class="ident" id="5590785">i</span>&nbsp;<span class="op" id="5590787">*</span><span class="ident" id="5590788">decInstr</span><span class="op" id="5590796">,</span>&nbsp;<span class="ident" id="5590798">state</span>&nbsp;<span class="op" id="5590804">*</span><span class="ident" id="5590805">decoderState</span><span class="op" id="5590817">,</span>&nbsp;<span class="ident" id="5590819">value</span>&nbsp;<span class="ident" id="5590825">reflect</span><span class="op" id="5590832">.</span><span class="ident" id="5590833">Value</span><span class="op" id="5590838">)</span>&nbsp;<span class="op" id="5590840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590846">state</span><span class="op" id="5590851">.</span><span class="ident" id="5590852">dec</span><span class="op" id="5590855">.</span><span class="ident" id="5590856">decodeSlice</span><span class="op" id="5590867">(</span><span class="ident" id="5590868">state</span><span class="op" id="5590873">,</span>&nbsp;<span class="ident" id="5590875">value</span><span class="op" id="5590880">,</span>&nbsp;<span class="op" id="5590882">*</span><span class="ident" id="5590883">elemOp</span><span class="op" id="5590889">,</span>&nbsp;<span class="ident" id="5590891">ovfl</span><span class="op" id="5590895">,</span>&nbsp;<span class="ident" id="5590897">helper</span><span class="op" id="5590903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590913">case</span>&nbsp;<span class="ident" id="5590918">reflect</span><span class="op" id="5590925">.</span><span class="ident" id="5590926">Struct</span><span class="op" id="5590932">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5590937">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591012">ut</span>&nbsp;<span class="op" id="5591015">:=</span>&nbsp;<span class="ident" id="5591018">userType</span><span class="op" id="5591026">(</span><span class="ident" id="5591027">typ</span><span class="op" id="5591030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591035">enginePtr</span><span class="op" id="5591044">,</span>&nbsp;<span class="ident" id="5591046">err</span>&nbsp;<span class="op" id="5591050">:=</span>&nbsp;<span class="ident" id="5591053">dec</span><span class="op" id="5591056">.</span><span class="ident" id="5591057">getDecEnginePtr</span><span class="op" id="5591072">(</span><span class="ident" id="5591073">wireId</span><span class="op" id="5591079">,</span>&nbsp;<span class="ident" id="5591081">ut</span><span class="op" id="5591083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591088">if</span>&nbsp;<span class="ident" id="5591091">err</span>&nbsp;<span class="op" id="5591095">!=</span>&nbsp;<span class="builtintype" id="5591098">nil</span>&nbsp;<span class="op" id="5591102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591108">error_</span><span class="op" id="5591114">(</span><span class="ident" id="5591115">err</span><span class="op" id="5591118">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591128">op</span>&nbsp;<span class="op" id="5591131">=</span>&nbsp;<span class="keyword" id="5591133">func</span><span class="op" id="5591137">(</span><span class="ident" id="5591138">i</span>&nbsp;<span class="op" id="5591140">*</span><span class="ident" id="5591141">decInstr</span><span class="op" id="5591149">,</span>&nbsp;<span class="ident" id="5591151">state</span>&nbsp;<span class="op" id="5591157">*</span><span class="ident" id="5591158">decoderState</span><span class="op" id="5591170">,</span>&nbsp;<span class="ident" id="5591172">value</span>&nbsp;<span class="ident" id="5591178">reflect</span><span class="op" id="5591185">.</span><span class="ident" id="5591186">Value</span><span class="op" id="5591191">)</span>&nbsp;<span class="op" id="5591193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591199">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591276">dec</span><span class="op" id="5591279">.</span><span class="ident" id="5591280">decodeStruct</span><span class="op" id="5591292">(</span><span class="op" id="5591293">*</span><span class="ident" id="5591294">enginePtr</span><span class="op" id="5591303">,</span>&nbsp;<span class="ident" id="5591305">ut</span><span class="op" id="5591307">,</span>&nbsp;<span class="ident" id="5591309">value</span><span class="op" id="5591314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591319">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591323">case</span>&nbsp;<span class="ident" id="5591328">reflect</span><span class="op" id="5591335">.</span><span class="ident" id="5591336">Interface</span><span class="op" id="5591345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591350">op</span>&nbsp;<span class="op" id="5591353">=</span>&nbsp;<span class="keyword" id="5591355">func</span><span class="op" id="5591359">(</span><span class="ident" id="5591360">i</span>&nbsp;<span class="op" id="5591362">*</span><span class="ident" id="5591363">decInstr</span><span class="op" id="5591371">,</span>&nbsp;<span class="ident" id="5591373">state</span>&nbsp;<span class="op" id="5591379">*</span><span class="ident" id="5591380">decoderState</span><span class="op" id="5591392">,</span>&nbsp;<span class="ident" id="5591394">value</span>&nbsp;<span class="ident" id="5591400">reflect</span><span class="op" id="5591407">.</span><span class="ident" id="5591408">Value</span><span class="op" id="5591413">)</span>&nbsp;<span class="op" id="5591415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591421">state</span><span class="op" id="5591426">.</span><span class="ident" id="5591427">dec</span><span class="op" id="5591430">.</span><span class="ident" id="5591431">decodeInterface</span><span class="op" id="5591446">(</span><span class="ident" id="5591447">t</span><span class="op" id="5591448">,</span>&nbsp;<span class="ident" id="5591450">state</span><span class="op" id="5591455">,</span>&nbsp;<span class="ident" id="5591457">value</span><span class="op" id="5591462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591471">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591477">if</span>&nbsp;<span class="ident" id="5591480">op</span>&nbsp;<span class="op" id="5591483">==</span>&nbsp;<span class="builtintype" id="5591486">nil</span>&nbsp;<span class="op" id="5591490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591494">errorf</span><span class="op" id="5591500">(</span><span class="string" id="5591501">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5591530">,</span>&nbsp;<span class="ident" id="5591532">rt</span><span class="op" id="5591534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591540">return</span>&nbsp;<span class="op" id="5591547">&amp;</span><span class="ident" id="5591548">op</span><br>
<span class="lineno">840</span><span class="op" id="5591551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5591554">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5591633">func</span>&nbsp;<span class="op" id="5591638">(</span><span class="ident" id="5591639">dec</span>&nbsp;<span class="op" id="5591643">*</span><span class="ident" id="5591644">Decoder</span><span class="op" id="5591651">)</span>&nbsp;<span class="ident" id="5591653">decIgnoreOpFor</span><span class="op" id="5591667">(</span><span class="ident" id="5591668">wireId</span>&nbsp;<span class="ident" id="5591675">typeId</span><span class="op" id="5591681">)</span>&nbsp;<span class="ident" id="5591683">decOp</span>&nbsp;<span class="op" id="5591689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591692">op</span><span class="op" id="5591694">,</span>&nbsp;<span class="ident" id="5591696">ok</span>&nbsp;<span class="op" id="5591699">:=</span>&nbsp;<span class="ident" id="5591702">decIgnoreOpMap</span><span class="op" id="5591716">[</span><span class="ident" id="5591717">wireId</span><span class="op" id="5591723">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591726">if</span>&nbsp;<span class="op" id="5591729">!</span><span class="ident" id="5591730">ok</span>&nbsp;<span class="op" id="5591733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591737">if</span>&nbsp;<span class="ident" id="5591740">wireId</span>&nbsp;<span class="op" id="5591747">==</span>&nbsp;<span class="ident" id="5591750">tInterface</span>&nbsp;<span class="op" id="5591761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591766">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591831">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591900">op</span>&nbsp;<span class="op" id="5591903">=</span>&nbsp;<span class="keyword" id="5591905">func</span><span class="op" id="5591909">(</span><span class="ident" id="5591910">i</span>&nbsp;<span class="op" id="5591912">*</span><span class="ident" id="5591913">decInstr</span><span class="op" id="5591921">,</span>&nbsp;<span class="ident" id="5591923">state</span>&nbsp;<span class="op" id="5591929">*</span><span class="ident" id="5591930">decoderState</span><span class="op" id="5591942">,</span>&nbsp;<span class="ident" id="5591944">value</span>&nbsp;<span class="ident" id="5591950">reflect</span><span class="op" id="5591957">.</span><span class="ident" id="5591958">Value</span><span class="op" id="5591963">)</span>&nbsp;<span class="op" id="5591965">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591971">state</span><span class="op" id="5591976">.</span><span class="ident" id="5591977">dec</span><span class="op" id="5591980">.</span><span class="ident" id="5591981">ignoreInterface</span><span class="op" id="5591996">(</span><span class="ident" id="5591997">state</span><span class="op" id="5592002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592012">return</span>&nbsp;<span class="ident" id="5592019">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592028">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592047">wire</span>&nbsp;<span class="op" id="5592052">:=</span>&nbsp;<span class="ident" id="5592055">dec</span><span class="op" id="5592058">.</span><span class="ident" id="5592059">wireType</span><span class="op" id="5592067">[</span><span class="ident" id="5592068">wireId</span><span class="op" id="5592074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592078">switch</span>&nbsp;<span class="op" id="5592085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592089">case</span>&nbsp;<span class="ident" id="5592094">wire</span>&nbsp;<span class="op" id="5592099">==</span>&nbsp;<span class="builtintype" id="5592102">nil</span><span class="op" id="5592105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592110">errorf</span><span class="op" id="5592116">(</span><span class="string" id="5592117">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5592146">,</span>&nbsp;<span class="ident" id="5592148">wireId</span><span class="op" id="5592154">.</span><span class="builtintype" id="5592155">string</span><span class="op" id="5592161">(</span><span class="op" id="5592162">)</span><span class="op" id="5592163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592167">case</span>&nbsp;<span class="ident" id="5592172">wire</span><span class="op" id="5592176">.</span><span class="ident" id="5592177">ArrayT</span>&nbsp;<span class="op" id="5592184">!=</span>&nbsp;<span class="builtintype" id="5592187">nil</span><span class="op" id="5592190">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592195">elemId</span>&nbsp;<span class="op" id="5592202">:=</span>&nbsp;<span class="ident" id="5592205">wire</span><span class="op" id="5592209">.</span><span class="ident" id="5592210">ArrayT</span><span class="op" id="5592216">.</span><span class="ident" id="5592217">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592225">elemOp</span>&nbsp;<span class="op" id="5592232">:=</span>&nbsp;<span class="ident" id="5592235">dec</span><span class="op" id="5592238">.</span><span class="ident" id="5592239">decIgnoreOpFor</span><span class="op" id="5592253">(</span><span class="ident" id="5592254">elemId</span><span class="op" id="5592260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592265">op</span>&nbsp;<span class="op" id="5592268">=</span>&nbsp;<span class="keyword" id="5592270">func</span><span class="op" id="5592274">(</span><span class="ident" id="5592275">i</span>&nbsp;<span class="op" id="5592277">*</span><span class="ident" id="5592278">decInstr</span><span class="op" id="5592286">,</span>&nbsp;<span class="ident" id="5592288">state</span>&nbsp;<span class="op" id="5592294">*</span><span class="ident" id="5592295">decoderState</span><span class="op" id="5592307">,</span>&nbsp;<span class="ident" id="5592309">value</span>&nbsp;<span class="ident" id="5592315">reflect</span><span class="op" id="5592322">.</span><span class="ident" id="5592323">Value</span><span class="op" id="5592328">)</span>&nbsp;<span class="op" id="5592330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592336">state</span><span class="op" id="5592341">.</span><span class="ident" id="5592342">dec</span><span class="op" id="5592345">.</span><span class="ident" id="5592346">ignoreArray</span><span class="op" id="5592357">(</span><span class="ident" id="5592358">state</span><span class="op" id="5592363">,</span>&nbsp;<span class="ident" id="5592365">elemOp</span><span class="op" id="5592371">,</span>&nbsp;<span class="ident" id="5592373">wire</span><span class="op" id="5592377">.</span><span class="ident" id="5592378">ArrayT</span><span class="op" id="5592384">.</span><span class="ident" id="5592385">Len</span><span class="op" id="5592388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592393">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592398">case</span>&nbsp;<span class="ident" id="5592403">wire</span><span class="op" id="5592407">.</span><span class="ident" id="5592408">MapT</span>&nbsp;<span class="op" id="5592413">!=</span>&nbsp;<span class="builtintype" id="5592416">nil</span><span class="op" id="5592419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592424">keyId</span>&nbsp;<span class="op" id="5592430">:=</span>&nbsp;<span class="ident" id="5592433">dec</span><span class="op" id="5592436">.</span><span class="ident" id="5592437">wireType</span><span class="op" id="5592445">[</span><span class="ident" id="5592446">wireId</span><span class="op" id="5592452">]</span><span class="op" id="5592453">.</span><span class="ident" id="5592454">MapT</span><span class="op" id="5592458">.</span><span class="ident" id="5592459">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592466">elemId</span>&nbsp;<span class="op" id="5592473">:=</span>&nbsp;<span class="ident" id="5592476">dec</span><span class="op" id="5592479">.</span><span class="ident" id="5592480">wireType</span><span class="op" id="5592488">[</span><span class="ident" id="5592489">wireId</span><span class="op" id="5592495">]</span><span class="op" id="5592496">.</span><span class="ident" id="5592497">MapT</span><span class="op" id="5592501">.</span><span class="ident" id="5592502">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592510">keyOp</span>&nbsp;<span class="op" id="5592516">:=</span>&nbsp;<span class="ident" id="5592519">dec</span><span class="op" id="5592522">.</span><span class="ident" id="5592523">decIgnoreOpFor</span><span class="op" id="5592537">(</span><span class="ident" id="5592538">keyId</span><span class="op" id="5592543">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592548">elemOp</span>&nbsp;<span class="op" id="5592555">:=</span>&nbsp;<span class="ident" id="5592558">dec</span><span class="op" id="5592561">.</span><span class="ident" id="5592562">decIgnoreOpFor</span><span class="op" id="5592576">(</span><span class="ident" id="5592577">elemId</span><span class="op" id="5592583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592588">op</span>&nbsp;<span class="op" id="5592591">=</span>&nbsp;<span class="keyword" id="5592593">func</span><span class="op" id="5592597">(</span><span class="ident" id="5592598">i</span>&nbsp;<span class="op" id="5592600">*</span><span class="ident" id="5592601">decInstr</span><span class="op" id="5592609">,</span>&nbsp;<span class="ident" id="5592611">state</span>&nbsp;<span class="op" id="5592617">*</span><span class="ident" id="5592618">decoderState</span><span class="op" id="5592630">,</span>&nbsp;<span class="ident" id="5592632">value</span>&nbsp;<span class="ident" id="5592638">reflect</span><span class="op" id="5592645">.</span><span class="ident" id="5592646">Value</span><span class="op" id="5592651">)</span>&nbsp;<span class="op" id="5592653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592659">state</span><span class="op" id="5592664">.</span><span class="ident" id="5592665">dec</span><span class="op" id="5592668">.</span><span class="ident" id="5592669">ignoreMap</span><span class="op" id="5592678">(</span><span class="ident" id="5592679">state</span><span class="op" id="5592684">,</span>&nbsp;<span class="ident" id="5592686">keyOp</span><span class="op" id="5592691">,</span>&nbsp;<span class="ident" id="5592693">elemOp</span><span class="op" id="5592699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592709">case</span>&nbsp;<span class="ident" id="5592714">wire</span><span class="op" id="5592718">.</span><span class="ident" id="5592719">SliceT</span>&nbsp;<span class="op" id="5592726">!=</span>&nbsp;<span class="builtintype" id="5592729">nil</span><span class="op" id="5592732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592737">elemId</span>&nbsp;<span class="op" id="5592744">:=</span>&nbsp;<span class="ident" id="5592747">wire</span><span class="op" id="5592751">.</span><span class="ident" id="5592752">SliceT</span><span class="op" id="5592758">.</span><span class="ident" id="5592759">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592767">elemOp</span>&nbsp;<span class="op" id="5592774">:=</span>&nbsp;<span class="ident" id="5592777">dec</span><span class="op" id="5592780">.</span><span class="ident" id="5592781">decIgnoreOpFor</span><span class="op" id="5592795">(</span><span class="ident" id="5592796">elemId</span><span class="op" id="5592802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592807">op</span>&nbsp;<span class="op" id="5592810">=</span>&nbsp;<span class="keyword" id="5592812">func</span><span class="op" id="5592816">(</span><span class="ident" id="5592817">i</span>&nbsp;<span class="op" id="5592819">*</span><span class="ident" id="5592820">decInstr</span><span class="op" id="5592828">,</span>&nbsp;<span class="ident" id="5592830">state</span>&nbsp;<span class="op" id="5592836">*</span><span class="ident" id="5592837">decoderState</span><span class="op" id="5592849">,</span>&nbsp;<span class="ident" id="5592851">value</span>&nbsp;<span class="ident" id="5592857">reflect</span><span class="op" id="5592864">.</span><span class="ident" id="5592865">Value</span><span class="op" id="5592870">)</span>&nbsp;<span class="op" id="5592872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592878">state</span><span class="op" id="5592883">.</span><span class="ident" id="5592884">dec</span><span class="op" id="5592887">.</span><span class="ident" id="5592888">ignoreSlice</span><span class="op" id="5592899">(</span><span class="ident" id="5592900">state</span><span class="op" id="5592905">,</span>&nbsp;<span class="ident" id="5592907">elemOp</span><span class="op" id="5592913">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592923">case</span>&nbsp;<span class="ident" id="5592928">wire</span><span class="op" id="5592932">.</span><span class="ident" id="5592933">StructT</span>&nbsp;<span class="op" id="5592941">!=</span>&nbsp;<span class="builtintype" id="5592944">nil</span><span class="op" id="5592947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592952">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593027">enginePtr</span><span class="op" id="5593036">,</span>&nbsp;<span class="ident" id="5593038">err</span>&nbsp;<span class="op" id="5593042">:=</span>&nbsp;<span class="ident" id="5593045">dec</span><span class="op" id="5593048">.</span><span class="ident" id="5593049">getIgnoreEnginePtr</span><span class="op" id="5593067">(</span><span class="ident" id="5593068">wireId</span><span class="op" id="5593074">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593079">if</span>&nbsp;<span class="ident" id="5593082">err</span>&nbsp;<span class="op" id="5593086">!=</span>&nbsp;<span class="builtintype" id="5593089">nil</span>&nbsp;<span class="op" id="5593093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593099">error_</span><span class="op" id="5593105">(</span><span class="ident" id="5593106">err</span><span class="op" id="5593109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593119">op</span>&nbsp;<span class="op" id="5593122">=</span>&nbsp;<span class="keyword" id="5593124">func</span><span class="op" id="5593128">(</span><span class="ident" id="5593129">i</span>&nbsp;<span class="op" id="5593131">*</span><span class="ident" id="5593132">decInstr</span><span class="op" id="5593140">,</span>&nbsp;<span class="ident" id="5593142">state</span>&nbsp;<span class="op" id="5593148">*</span><span class="ident" id="5593149">decoderState</span><span class="op" id="5593161">,</span>&nbsp;<span class="ident" id="5593163">value</span>&nbsp;<span class="ident" id="5593169">reflect</span><span class="op" id="5593176">.</span><span class="ident" id="5593177">Value</span><span class="op" id="5593182">)</span>&nbsp;<span class="op" id="5593184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593190">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593266">state</span><span class="op" id="5593271">.</span><span class="ident" id="5593272">dec</span><span class="op" id="5593275">.</span><span class="ident" id="5593276">ignoreStruct</span><span class="op" id="5593288">(</span><span class="op" id="5593289">*</span><span class="ident" id="5593290">enginePtr</span><span class="op" id="5593299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593309">case</span>&nbsp;<span class="ident" id="5593314">wire</span><span class="op" id="5593318">.</span><span class="ident" id="5593319">GobEncoderT</span>&nbsp;<span class="op" id="5593331">!=</span>&nbsp;<span class="builtintype" id="5593334">nil</span><span class="op" id="5593337">,</span>&nbsp;<span class="ident" id="5593339">wire</span><span class="op" id="5593343">.</span><span class="ident" id="5593344">BinaryMarshalerT</span>&nbsp;<span class="op" id="5593361">!=</span>&nbsp;<span class="builtintype" id="5593364">nil</span><span class="op" id="5593367">,</span>&nbsp;<span class="ident" id="5593369">wire</span><span class="op" id="5593373">.</span><span class="ident" id="5593374">TextMarshalerT</span>&nbsp;<span class="op" id="5593389">!=</span>&nbsp;<span class="builtintype" id="5593392">nil</span><span class="op" id="5593395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593400">op</span>&nbsp;<span class="op" id="5593403">=</span>&nbsp;<span class="keyword" id="5593405">func</span><span class="op" id="5593409">(</span><span class="ident" id="5593410">i</span>&nbsp;<span class="op" id="5593412">*</span><span class="ident" id="5593413">decInstr</span><span class="op" id="5593421">,</span>&nbsp;<span class="ident" id="5593423">state</span>&nbsp;<span class="op" id="5593429">*</span><span class="ident" id="5593430">decoderState</span><span class="op" id="5593442">,</span>&nbsp;<span class="ident" id="5593444">value</span>&nbsp;<span class="ident" id="5593450">reflect</span><span class="op" id="5593457">.</span><span class="ident" id="5593458">Value</span><span class="op" id="5593463">)</span>&nbsp;<span class="op" id="5593465">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593471">state</span><span class="op" id="5593476">.</span><span class="ident" id="5593477">dec</span><span class="op" id="5593480">.</span><span class="ident" id="5593481">ignoreGobDecoder</span><span class="op" id="5593497">(</span><span class="ident" id="5593498">state</span><span class="op" id="5593503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593518">if</span>&nbsp;<span class="ident" id="5593521">op</span>&nbsp;<span class="op" id="5593524">==</span>&nbsp;<span class="builtintype" id="5593527">nil</span>&nbsp;<span class="op" id="5593531">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593535">errorf</span><span class="op" id="5593541">(</span><span class="string" id="5593542">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5593581">,</span>&nbsp;<span class="ident" id="5593583">wireId</span><span class="op" id="5593589">.</span><span class="builtintype" id="5593590">string</span><span class="op" id="5593596">(</span><span class="op" id="5593597">)</span><span class="op" id="5593598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593604">return</span>&nbsp;<span class="ident" id="5593611">op</span><br>
<span class="lineno"></span><span class="op" id="5593614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5593617">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="5593688">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5593703">func</span>&nbsp;<span class="op" id="5593708">(</span><span class="ident" id="5593709">dec</span>&nbsp;<span class="op" id="5593713">*</span><span class="ident" id="5593714">Decoder</span><span class="op" id="5593721">)</span>&nbsp;<span class="ident" id="5593723">gobDecodeOpFor</span><span class="op" id="5593737">(</span><span class="ident" id="5593738">ut</span>&nbsp;<span class="op" id="5593741">*</span><span class="ident" id="5593742">userTypeInfo</span><span class="op" id="5593754">)</span>&nbsp;<span class="op" id="5593756">*</span><span class="ident" id="5593757">decOp</span>&nbsp;<span class="op" id="5593763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593766">rcvrType</span>&nbsp;<span class="op" id="5593775">:=</span>&nbsp;<span class="ident" id="5593778">ut</span><span class="op" id="5593780">.</span><span class="ident" id="5593781">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593787">if</span>&nbsp;<span class="ident" id="5593790">ut</span><span class="op" id="5593792">.</span><span class="ident" id="5593793">decIndir</span>&nbsp;<span class="op" id="5593802">==</span>&nbsp;<span class="op" id="5593805">-</span><span class="num" id="5593806">1</span>&nbsp;<span class="op" id="5593808">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593812">rcvrType</span>&nbsp;<span class="op" id="5593821">=</span>&nbsp;<span class="ident" id="5593823">reflect</span><span class="op" id="5593830">.</span><span class="ident" id="5593831">PtrTo</span><span class="op" id="5593836">(</span><span class="ident" id="5593837">rcvrType</span><span class="op" id="5593845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593848">}</span>&nbsp;<span class="keyword" id="5593850">else</span>&nbsp;<span class="keyword" id="5593855">if</span>&nbsp;<span class="ident" id="5593858">ut</span><span class="op" id="5593860">.</span><span class="ident" id="5593861">decIndir</span>&nbsp;<span class="op" id="5593870">&gt;</span>&nbsp;<span class="num" id="5593872">0</span>&nbsp;<span class="op" id="5593874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593878">for</span>&nbsp;<span class="ident" id="5593882">i</span>&nbsp;<span class="op" id="5593884">:=</span>&nbsp;<span class="builtintype" id="5593887">int8</span><span class="op" id="5593891">(</span><span class="num" id="5593892">0</span><span class="op" id="5593893">)</span><span class="op" id="5593894">;</span>&nbsp;<span class="ident" id="5593896">i</span>&nbsp;<span class="op" id="5593898">&lt;</span>&nbsp;<span class="ident" id="5593900">ut</span><span class="op" id="5593902">.</span><span class="ident" id="5593903">decIndir</span><span class="op" id="5593911">;</span>&nbsp;<span class="ident" id="5593913">i</span><span class="op" id="5593914">++</span>&nbsp;<span class="op" id="5593917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593922">rcvrType</span>&nbsp;<span class="op" id="5593931">=</span>&nbsp;<span class="ident" id="5593933">rcvrType</span><span class="op" id="5593941">.</span><span class="ident" id="5593942">Elem</span><span class="op" id="5593946">(</span><span class="op" id="5593947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593951">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593957">var</span>&nbsp;<span class="ident" id="5593961">op</span>&nbsp;<span class="ident" id="5593964">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593971">op</span>&nbsp;<span class="op" id="5593974">=</span>&nbsp;<span class="keyword" id="5593976">func</span><span class="op" id="5593980">(</span><span class="ident" id="5593981">i</span>&nbsp;<span class="op" id="5593983">*</span><span class="ident" id="5593984">decInstr</span><span class="op" id="5593992">,</span>&nbsp;<span class="ident" id="5593994">state</span>&nbsp;<span class="op" id="5594000">*</span><span class="ident" id="5594001">decoderState</span><span class="op" id="5594013">,</span>&nbsp;<span class="ident" id="5594015">value</span>&nbsp;<span class="ident" id="5594021">reflect</span><span class="op" id="5594028">.</span><span class="ident" id="5594029">Value</span><span class="op" id="5594034">)</span>&nbsp;<span class="op" id="5594036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594040">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594122">if</span>&nbsp;<span class="ident" id="5594125">value</span><span class="op" id="5594130">.</span><span class="ident" id="5594131">Kind</span><span class="op" id="5594135">(</span><span class="op" id="5594136">)</span>&nbsp;<span class="op" id="5594138">!=</span>&nbsp;<span class="ident" id="5594141">reflect</span><span class="op" id="5594148">.</span><span class="ident" id="5594149">Ptr</span>&nbsp;<span class="op" id="5594153">&amp;&amp;</span>&nbsp;<span class="ident" id="5594156">rcvrType</span><span class="op" id="5594164">.</span><span class="ident" id="5594165">Kind</span><span class="op" id="5594169">(</span><span class="op" id="5594170">)</span>&nbsp;<span class="op" id="5594172">==</span>&nbsp;<span class="ident" id="5594175">reflect</span><span class="op" id="5594182">.</span><span class="ident" id="5594183">Ptr</span>&nbsp;<span class="op" id="5594187">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594192">value</span>&nbsp;<span class="op" id="5594198">=</span>&nbsp;<span class="ident" id="5594200">value</span><span class="op" id="5594205">.</span><span class="ident" id="5594206">Addr</span><span class="op" id="5594210">(</span><span class="op" id="5594211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594219">state</span><span class="op" id="5594224">.</span><span class="ident" id="5594225">dec</span><span class="op" id="5594228">.</span><span class="ident" id="5594229">decodeGobDecoder</span><span class="op" id="5594245">(</span><span class="ident" id="5594246">ut</span><span class="op" id="5594248">,</span>&nbsp;<span class="ident" id="5594250">state</span><span class="op" id="5594255">,</span>&nbsp;<span class="ident" id="5594257">value</span><span class="op" id="5594262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594268">return</span>&nbsp;<span class="op" id="5594275">&amp;</span><span class="ident" id="5594276">op</span><br>
<span class="lineno">925</span><span class="op" id="5594279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5594282">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="5594342">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="5594413">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="5594442">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="5594502">func</span>&nbsp;<span class="op" id="5594507">(</span><span class="ident" id="5594508">dec</span>&nbsp;<span class="op" id="5594512">*</span><span class="ident" id="5594513">Decoder</span><span class="op" id="5594520">)</span>&nbsp;<span class="ident" id="5594522">compatibleType</span><span class="op" id="5594536">(</span><span class="ident" id="5594537">fr</span>&nbsp;<span class="ident" id="5594540">reflect</span><span class="op" id="5594547">.</span><span class="ident" id="5594548">Type</span><span class="op" id="5594552">,</span>&nbsp;<span class="ident" id="5594554">fw</span>&nbsp;<span class="ident" id="5594557">typeId</span><span class="op" id="5594563">,</span>&nbsp;<span class="ident" id="5594565">inProgress</span>&nbsp;<span class="keyword" id="5594576">map</span><span class="op" id="5594579">[</span><span class="ident" id="5594580">reflect</span><span class="op" id="5594587">.</span><span class="ident" id="5594588">Type</span><span class="op" id="5594592">]</span><span class="ident" id="5594593">typeId</span><span class="op" id="5594599">)</span>&nbsp;<span class="builtintype" id="5594601">bool</span>&nbsp;<span class="op" id="5594606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594609">if</span>&nbsp;<span class="ident" id="5594612">rhs</span><span class="op" id="5594615">,</span>&nbsp;<span class="ident" id="5594617">ok</span>&nbsp;<span class="op" id="5594620">:=</span>&nbsp;<span class="ident" id="5594623">inProgress</span><span class="op" id="5594633">[</span><span class="ident" id="5594634">fr</span><span class="op" id="5594636">]</span><span class="op" id="5594637">;</span>&nbsp;<span class="ident" id="5594639">ok</span>&nbsp;<span class="op" id="5594642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594646">return</span>&nbsp;<span class="ident" id="5594653">rhs</span>&nbsp;<span class="op" id="5594657">==</span>&nbsp;<span class="ident" id="5594660">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594664">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594667">inProgress</span><span class="op" id="5594677">[</span><span class="ident" id="5594678">fr</span><span class="op" id="5594680">]</span>&nbsp;<span class="op" id="5594682">=</span>&nbsp;<span class="ident" id="5594684">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594688">ut</span>&nbsp;<span class="op" id="5594691">:=</span>&nbsp;<span class="ident" id="5594694">userType</span><span class="op" id="5594702">(</span><span class="ident" id="5594703">fr</span><span class="op" id="5594705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594708">wire</span><span class="op" id="5594712">,</span>&nbsp;<span class="ident" id="5594714">ok</span>&nbsp;<span class="op" id="5594717">:=</span>&nbsp;<span class="ident" id="5594720">dec</span><span class="op" id="5594723">.</span><span class="ident" id="5594724">wireType</span><span class="op" id="5594732">[</span><span class="ident" id="5594733">fw</span><span class="op" id="5594735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594738">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594813">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594842">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594888">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594958">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5595021">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595067">if</span>&nbsp;<span class="op" id="5595070">(</span><span class="ident" id="5595071">ut</span><span class="op" id="5595073">.</span><span class="ident" id="5595074">externalDec</span>&nbsp;<span class="op" id="5595086">==</span>&nbsp;<span class="ident" id="5595089">xGob</span><span class="op" id="5595093">)</span>&nbsp;<span class="op" id="5595095">!=</span>&nbsp;<span class="op" id="5595098">(</span><span class="ident" id="5595099">ok</span>&nbsp;<span class="op" id="5595102">&amp;&amp;</span>&nbsp;<span class="ident" id="5595105">wire</span><span class="op" id="5595109">.</span><span class="ident" id="5595110">GobEncoderT</span>&nbsp;<span class="op" id="5595122">!=</span>&nbsp;<span class="builtintype" id="5595125">nil</span><span class="op" id="5595128">)</span>&nbsp;<span class="op" id="5595130">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595135">(</span><span class="ident" id="5595136">ut</span><span class="op" id="5595138">.</span><span class="ident" id="5595139">externalDec</span>&nbsp;<span class="op" id="5595151">==</span>&nbsp;<span class="ident" id="5595154">xBinary</span><span class="op" id="5595161">)</span>&nbsp;<span class="op" id="5595163">!=</span>&nbsp;<span class="op" id="5595166">(</span><span class="ident" id="5595167">ok</span>&nbsp;<span class="op" id="5595170">&amp;&amp;</span>&nbsp;<span class="ident" id="5595173">wire</span><span class="op" id="5595177">.</span><span class="ident" id="5595178">BinaryMarshalerT</span>&nbsp;<span class="op" id="5595195">!=</span>&nbsp;<span class="builtintype" id="5595198">nil</span><span class="op" id="5595201">)</span>&nbsp;<span class="op" id="5595203">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595208">(</span><span class="ident" id="5595209">ut</span><span class="op" id="5595211">.</span><span class="ident" id="5595212">externalDec</span>&nbsp;<span class="op" id="5595224">==</span>&nbsp;<span class="ident" id="5595227">xText</span><span class="op" id="5595232">)</span>&nbsp;<span class="op" id="5595234">!=</span>&nbsp;<span class="op" id="5595237">(</span><span class="ident" id="5595238">ok</span>&nbsp;<span class="op" id="5595241">&amp;&amp;</span>&nbsp;<span class="ident" id="5595244">wire</span><span class="op" id="5595248">.</span><span class="ident" id="5595249">TextMarshalerT</span>&nbsp;<span class="op" id="5595264">!=</span>&nbsp;<span class="builtintype" id="5595267">nil</span><span class="op" id="5595270">)</span>&nbsp;<span class="op" id="5595272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595276">return</span>&nbsp;<span class="builtintype" id="5595283">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595293">if</span>&nbsp;<span class="ident" id="5595296">ut</span><span class="op" id="5595298">.</span><span class="ident" id="5595299">externalDec</span>&nbsp;<span class="op" id="5595311">!=</span>&nbsp;<span class="num" id="5595314">0</span>&nbsp;<span class="op" id="5595316">{</span>&nbsp;<span class="comment" id="5595318">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595352">return</span>&nbsp;<span class="builtintype" id="5595359">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595368">switch</span>&nbsp;<span class="ident" id="5595375">t</span>&nbsp;<span class="op" id="5595377">:=</span>&nbsp;<span class="ident" id="5595380">ut</span><span class="op" id="5595382">.</span><span class="ident" id="5595383">base</span><span class="op" id="5595387">;</span>&nbsp;<span class="ident" id="5595389">t</span><span class="op" id="5595390">.</span><span class="ident" id="5595391">Kind</span><span class="op" id="5595395">(</span><span class="op" id="5595396">)</span>&nbsp;<span class="op" id="5595398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595401">default</span><span class="op" id="5595408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5595412">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595443">return</span>&nbsp;<span class="builtintype" id="5595450">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595457">case</span>&nbsp;<span class="ident" id="5595462">reflect</span><span class="op" id="5595469">.</span><span class="ident" id="5595470">Bool</span><span class="op" id="5595474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595478">return</span>&nbsp;<span class="ident" id="5595485">fw</span>&nbsp;<span class="op" id="5595488">==</span>&nbsp;<span class="ident" id="5595491">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595498">case</span>&nbsp;<span class="ident" id="5595503">reflect</span><span class="op" id="5595510">.</span><span class="ident" id="5595511">Int</span><span class="op" id="5595514">,</span>&nbsp;<span class="ident" id="5595516">reflect</span><span class="op" id="5595523">.</span><span class="ident" id="5595524">Int8</span><span class="op" id="5595528">,</span>&nbsp;<span class="ident" id="5595530">reflect</span><span class="op" id="5595537">.</span><span class="ident" id="5595538">Int16</span><span class="op" id="5595543">,</span>&nbsp;<span class="ident" id="5595545">reflect</span><span class="op" id="5595552">.</span><span class="ident" id="5595553">Int32</span><span class="op" id="5595558">,</span>&nbsp;<span class="ident" id="5595560">reflect</span><span class="op" id="5595567">.</span><span class="ident" id="5595568">Int64</span><span class="op" id="5595573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595577">return</span>&nbsp;<span class="ident" id="5595584">fw</span>&nbsp;<span class="op" id="5595587">==</span>&nbsp;<span class="ident" id="5595590">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595596">case</span>&nbsp;<span class="ident" id="5595601">reflect</span><span class="op" id="5595608">.</span><span class="ident" id="5595609">Uint</span><span class="op" id="5595613">,</span>&nbsp;<span class="ident" id="5595615">reflect</span><span class="op" id="5595622">.</span><span class="ident" id="5595623">Uint8</span><span class="op" id="5595628">,</span>&nbsp;<span class="ident" id="5595630">reflect</span><span class="op" id="5595637">.</span><span class="ident" id="5595638">Uint16</span><span class="op" id="5595644">,</span>&nbsp;<span class="ident" id="5595646">reflect</span><span class="op" id="5595653">.</span><span class="ident" id="5595654">Uint32</span><span class="op" id="5595660">,</span>&nbsp;<span class="ident" id="5595662">reflect</span><span class="op" id="5595669">.</span><span class="ident" id="5595670">Uint64</span><span class="op" id="5595676">,</span>&nbsp;<span class="ident" id="5595678">reflect</span><span class="op" id="5595685">.</span><span class="ident" id="5595686">Uintptr</span><span class="op" id="5595693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595697">return</span>&nbsp;<span class="ident" id="5595704">fw</span>&nbsp;<span class="op" id="5595707">==</span>&nbsp;<span class="ident" id="5595710">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595717">case</span>&nbsp;<span class="ident" id="5595722">reflect</span><span class="op" id="5595729">.</span><span class="ident" id="5595730">Float32</span><span class="op" id="5595737">,</span>&nbsp;<span class="ident" id="5595739">reflect</span><span class="op" id="5595746">.</span><span class="ident" id="5595747">Float64</span><span class="op" id="5595754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595758">return</span>&nbsp;<span class="ident" id="5595765">fw</span>&nbsp;<span class="op" id="5595768">==</span>&nbsp;<span class="ident" id="5595771">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595779">case</span>&nbsp;<span class="ident" id="5595784">reflect</span><span class="op" id="5595791">.</span><span class="ident" id="5595792">Complex64</span><span class="op" id="5595801">,</span>&nbsp;<span class="ident" id="5595803">reflect</span><span class="op" id="5595810">.</span><span class="ident" id="5595811">Complex128</span><span class="op" id="5595821">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595825">return</span>&nbsp;<span class="ident" id="5595832">fw</span>&nbsp;<span class="op" id="5595835">==</span>&nbsp;<span class="ident" id="5595838">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595848">case</span>&nbsp;<span class="ident" id="5595853">reflect</span><span class="op" id="5595860">.</span><span class="ident" id="5595861">String</span><span class="op" id="5595867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595871">return</span>&nbsp;<span class="ident" id="5595878">fw</span>&nbsp;<span class="op" id="5595881">==</span>&nbsp;<span class="ident" id="5595884">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595893">case</span>&nbsp;<span class="ident" id="5595898">reflect</span><span class="op" id="5595905">.</span><span class="ident" id="5595906">Interface</span><span class="op" id="5595915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595919">return</span>&nbsp;<span class="ident" id="5595926">fw</span>&nbsp;<span class="op" id="5595929">==</span>&nbsp;<span class="ident" id="5595932">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595944">case</span>&nbsp;<span class="ident" id="5595949">reflect</span><span class="op" id="5595956">.</span><span class="ident" id="5595957">Array</span><span class="op" id="5595962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595966">if</span>&nbsp;<span class="op" id="5595969">!</span><span class="ident" id="5595970">ok</span>&nbsp;<span class="op" id="5595973">||</span>&nbsp;<span class="ident" id="5595976">wire</span><span class="op" id="5595980">.</span><span class="ident" id="5595981">ArrayT</span>&nbsp;<span class="op" id="5595988">==</span>&nbsp;<span class="builtintype" id="5595991">nil</span>&nbsp;<span class="op" id="5595995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596000">return</span>&nbsp;<span class="builtintype" id="5596007">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596019">array</span>&nbsp;<span class="op" id="5596025">:=</span>&nbsp;<span class="ident" id="5596028">wire</span><span class="op" id="5596032">.</span><span class="ident" id="5596033">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596042">return</span>&nbsp;<span class="ident" id="5596049">t</span><span class="op" id="5596050">.</span><span class="ident" id="5596051">Len</span><span class="op" id="5596054">(</span><span class="op" id="5596055">)</span>&nbsp;<span class="op" id="5596057">==</span>&nbsp;<span class="ident" id="5596060">array</span><span class="op" id="5596065">.</span><span class="ident" id="5596066">Len</span>&nbsp;<span class="op" id="5596070">&amp;&amp;</span>&nbsp;<span class="ident" id="5596073">dec</span><span class="op" id="5596076">.</span><span class="ident" id="5596077">compatibleType</span><span class="op" id="5596091">(</span><span class="ident" id="5596092">t</span><span class="op" id="5596093">.</span><span class="ident" id="5596094">Elem</span><span class="op" id="5596098">(</span><span class="op" id="5596099">)</span><span class="op" id="5596100">,</span>&nbsp;<span class="ident" id="5596102">array</span><span class="op" id="5596107">.</span><span class="ident" id="5596108">Elem</span><span class="op" id="5596112">,</span>&nbsp;<span class="ident" id="5596114">inProgress</span><span class="op" id="5596124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596127">case</span>&nbsp;<span class="ident" id="5596132">reflect</span><span class="op" id="5596139">.</span><span class="ident" id="5596140">Map</span><span class="op" id="5596143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596147">if</span>&nbsp;<span class="op" id="5596150">!</span><span class="ident" id="5596151">ok</span>&nbsp;<span class="op" id="5596154">||</span>&nbsp;<span class="ident" id="5596157">wire</span><span class="op" id="5596161">.</span><span class="ident" id="5596162">MapT</span>&nbsp;<span class="op" id="5596167">==</span>&nbsp;<span class="builtintype" id="5596170">nil</span>&nbsp;<span class="op" id="5596174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596179">return</span>&nbsp;<span class="builtintype" id="5596186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596194">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596198">MapType</span>&nbsp;<span class="op" id="5596206">:=</span>&nbsp;<span class="ident" id="5596209">wire</span><span class="op" id="5596213">.</span><span class="ident" id="5596214">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596221">return</span>&nbsp;<span class="ident" id="5596228">dec</span><span class="op" id="5596231">.</span><span class="ident" id="5596232">compatibleType</span><span class="op" id="5596246">(</span><span class="ident" id="5596247">t</span><span class="op" id="5596248">.</span><span class="ident" id="5596249">Key</span><span class="op" id="5596252">(</span><span class="op" id="5596253">)</span><span class="op" id="5596254">,</span>&nbsp;<span class="ident" id="5596256">MapType</span><span class="op" id="5596263">.</span><span class="ident" id="5596264">Key</span><span class="op" id="5596267">,</span>&nbsp;<span class="ident" id="5596269">inProgress</span><span class="op" id="5596279">)</span>&nbsp;<span class="op" id="5596281">&amp;&amp;</span>&nbsp;<span class="ident" id="5596284">dec</span><span class="op" id="5596287">.</span><span class="ident" id="5596288">compatibleType</span><span class="op" id="5596302">(</span><span class="ident" id="5596303">t</span><span class="op" id="5596304">.</span><span class="ident" id="5596305">Elem</span><span class="op" id="5596309">(</span><span class="op" id="5596310">)</span><span class="op" id="5596311">,</span>&nbsp;<span class="ident" id="5596313">MapType</span><span class="op" id="5596320">.</span><span class="ident" id="5596321">Elem</span><span class="op" id="5596325">,</span>&nbsp;<span class="ident" id="5596327">inProgress</span><span class="op" id="5596337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596340">case</span>&nbsp;<span class="ident" id="5596345">reflect</span><span class="op" id="5596352">.</span><span class="ident" id="5596353">Slice</span><span class="op" id="5596358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596362">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596392">if</span>&nbsp;<span class="ident" id="5596395">t</span><span class="op" id="5596396">.</span><span class="ident" id="5596397">Elem</span><span class="op" id="5596401">(</span><span class="op" id="5596402">)</span><span class="op" id="5596403">.</span><span class="ident" id="5596404">Kind</span><span class="op" id="5596408">(</span><span class="op" id="5596409">)</span>&nbsp;<span class="op" id="5596411">==</span>&nbsp;<span class="ident" id="5596414">reflect</span><span class="op" id="5596421">.</span><span class="ident" id="5596422">Uint8</span>&nbsp;<span class="op" id="5596428">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596433">return</span>&nbsp;<span class="ident" id="5596440">fw</span>&nbsp;<span class="op" id="5596443">==</span>&nbsp;<span class="ident" id="5596446">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596459">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596499">var</span>&nbsp;<span class="ident" id="5596503">sw</span>&nbsp;<span class="op" id="5596506">*</span><span class="ident" id="5596507">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596519">if</span>&nbsp;<span class="ident" id="5596522">tt</span><span class="op" id="5596524">,</span>&nbsp;<span class="ident" id="5596526">ok</span>&nbsp;<span class="op" id="5596529">:=</span>&nbsp;<span class="ident" id="5596532">builtinIdToType</span><span class="op" id="5596547">[</span><span class="ident" id="5596548">fw</span><span class="op" id="5596550">]</span><span class="op" id="5596551">;</span>&nbsp;<span class="ident" id="5596553">ok</span>&nbsp;<span class="op" id="5596556">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596561">sw</span><span class="op" id="5596563">,</span>&nbsp;<span class="ident" id="5596565">_</span>&nbsp;<span class="op" id="5596567">=</span>&nbsp;<span class="ident" id="5596569">tt</span><span class="op" id="5596571">.</span><span class="op" id="5596572">(</span><span class="op" id="5596573">*</span><span class="ident" id="5596574">sliceType</span><span class="op" id="5596583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596587">}</span>&nbsp;<span class="keyword" id="5596589">else</span>&nbsp;<span class="keyword" id="5596594">if</span>&nbsp;<span class="ident" id="5596597">wire</span>&nbsp;<span class="op" id="5596602">!=</span>&nbsp;<span class="builtintype" id="5596605">nil</span>&nbsp;<span class="op" id="5596609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596614">sw</span>&nbsp;<span class="op" id="5596617">=</span>&nbsp;<span class="ident" id="5596619">wire</span><span class="op" id="5596623">.</span><span class="ident" id="5596624">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596637">elem</span>&nbsp;<span class="op" id="5596642">:=</span>&nbsp;<span class="ident" id="5596645">userType</span><span class="op" id="5596653">(</span><span class="ident" id="5596654">t</span><span class="op" id="5596655">.</span><span class="ident" id="5596656">Elem</span><span class="op" id="5596660">(</span><span class="op" id="5596661">)</span><span class="op" id="5596662">)</span><span class="op" id="5596663">.</span><span class="ident" id="5596664">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596671">return</span>&nbsp;<span class="ident" id="5596678">sw</span>&nbsp;<span class="op" id="5596681">!=</span>&nbsp;<span class="builtintype" id="5596684">nil</span>&nbsp;<span class="op" id="5596688">&amp;&amp;</span>&nbsp;<span class="ident" id="5596691">dec</span><span class="op" id="5596694">.</span><span class="ident" id="5596695">compatibleType</span><span class="op" id="5596709">(</span><span class="ident" id="5596710">elem</span><span class="op" id="5596714">,</span>&nbsp;<span class="ident" id="5596716">sw</span><span class="op" id="5596718">.</span><span class="ident" id="5596719">Elem</span><span class="op" id="5596723">,</span>&nbsp;<span class="ident" id="5596725">inProgress</span><span class="op" id="5596735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596738">case</span>&nbsp;<span class="ident" id="5596743">reflect</span><span class="op" id="5596750">.</span><span class="ident" id="5596751">Struct</span><span class="op" id="5596757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596761">return</span>&nbsp;<span class="builtintype" id="5596768">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596774">}</span><br>
<span class="lineno"></span><span class="op" id="5596776">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="5596779">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="5596866">func</span>&nbsp;<span class="op" id="5596871">(</span><span class="ident" id="5596872">dec</span>&nbsp;<span class="op" id="5596876">*</span><span class="ident" id="5596877">Decoder</span><span class="op" id="5596884">)</span>&nbsp;<span class="ident" id="5596886">typeString</span><span class="op" id="5596896">(</span><span class="ident" id="5596897">remoteId</span>&nbsp;<span class="ident" id="5596906">typeId</span><span class="op" id="5596912">)</span>&nbsp;<span class="builtintype" id="5596914">string</span>&nbsp;<span class="op" id="5596921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596924">if</span>&nbsp;<span class="ident" id="5596927">t</span>&nbsp;<span class="op" id="5596929">:=</span>&nbsp;<span class="ident" id="5596932">idToType</span><span class="op" id="5596940">[</span><span class="ident" id="5596941">remoteId</span><span class="op" id="5596949">]</span><span class="op" id="5596950">;</span>&nbsp;<span class="ident" id="5596952">t</span>&nbsp;<span class="op" id="5596954">!=</span>&nbsp;<span class="builtintype" id="5596957">nil</span>&nbsp;<span class="op" id="5596961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596965">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596991">return</span>&nbsp;<span class="ident" id="5596998">t</span><span class="op" id="5596999">.</span><span class="builtintype" id="5597000">string</span><span class="op" id="5597006">(</span><span class="op" id="5597007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597013">return</span>&nbsp;<span class="ident" id="5597020">dec</span><span class="op" id="5597023">.</span><span class="ident" id="5597024">wireType</span><span class="op" id="5597032">[</span><span class="ident" id="5597033">remoteId</span><span class="op" id="5597041">]</span><span class="op" id="5597042">.</span><span class="builtintype" id="5597043">string</span><span class="op" id="5597049">(</span><span class="op" id="5597050">)</span><br>
<span class="lineno"></span><span class="op" id="5597052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="5597055">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="5597144">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="5597160">func</span>&nbsp;<span class="op" id="5597165">(</span><span class="ident" id="5597166">dec</span>&nbsp;<span class="op" id="5597170">*</span><span class="ident" id="5597171">Decoder</span><span class="op" id="5597178">)</span>&nbsp;<span class="ident" id="5597180">compileSingle</span><span class="op" id="5597193">(</span><span class="ident" id="5597194">remoteId</span>&nbsp;<span class="ident" id="5597203">typeId</span><span class="op" id="5597209">,</span>&nbsp;<span class="ident" id="5597211">ut</span>&nbsp;<span class="op" id="5597214">*</span><span class="ident" id="5597215">userTypeInfo</span><span class="op" id="5597227">)</span>&nbsp;<span class="op" id="5597229">(</span><span class="ident" id="5597230">engine</span>&nbsp;<span class="op" id="5597237">*</span><span class="ident" id="5597238">decEngine</span><span class="op" id="5597247">,</span>&nbsp;<span class="ident" id="5597249">err</span>&nbsp;<span class="builtintype" id="5597253">error</span><span class="op" id="5597258">)</span>&nbsp;<span class="op" id="5597260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597263">rt</span>&nbsp;<span class="op" id="5597266">:=</span>&nbsp;<span class="ident" id="5597269">ut</span><span class="op" id="5597271">.</span><span class="ident" id="5597272">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597278">engine</span>&nbsp;<span class="op" id="5597285">=</span>&nbsp;<span class="builtinfunc" id="5597287">new</span><span class="op" id="5597290">(</span><span class="ident" id="5597291">decEngine</span><span class="op" id="5597300">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597303">engine</span><span class="op" id="5597309">.</span><span class="ident" id="5597310">instr</span>&nbsp;<span class="op" id="5597316">=</span>&nbsp;<span class="builtinfunc" id="5597318">make</span><span class="op" id="5597322">(</span><span class="op" id="5597323">[</span><span class="op" id="5597324">]</span><span class="ident" id="5597325">decInstr</span><span class="op" id="5597333">,</span>&nbsp;<span class="num" id="5597335">1</span><span class="op" id="5597336">)</span>&nbsp;<span class="comment" id="5597338">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597351">name</span>&nbsp;<span class="op" id="5597356">:=</span>&nbsp;<span class="ident" id="5597359">rt</span><span class="op" id="5597361">.</span><span class="ident" id="5597362">String</span><span class="op" id="5597368">(</span><span class="op" id="5597369">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597386">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597405">if</span>&nbsp;<span class="op" id="5597408">!</span><span class="ident" id="5597409">dec</span><span class="op" id="5597412">.</span><span class="ident" id="5597413">compatibleType</span><span class="op" id="5597427">(</span><span class="ident" id="5597428">rt</span><span class="op" id="5597430">,</span>&nbsp;<span class="ident" id="5597432">remoteId</span><span class="op" id="5597440">,</span>&nbsp;<span class="builtinfunc" id="5597442">make</span><span class="op" id="5597446">(</span><span class="keyword" id="5597447">map</span><span class="op" id="5597450">[</span><span class="ident" id="5597451">reflect</span><span class="op" id="5597458">.</span><span class="ident" id="5597459">Type</span><span class="op" id="5597463">]</span><span class="ident" id="5597464">typeId</span><span class="op" id="5597470">)</span><span class="op" id="5597471">)</span>&nbsp;<span class="op" id="5597473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597477">remoteType</span>&nbsp;<span class="op" id="5597488">:=</span>&nbsp;<span class="ident" id="5597491">dec</span><span class="op" id="5597494">.</span><span class="ident" id="5597495">typeString</span><span class="op" id="5597505">(</span><span class="ident" id="5597506">remoteId</span><span class="op" id="5597514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597518">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597590">if</span>&nbsp;<span class="ident" id="5597593">ut</span><span class="op" id="5597595">.</span><span class="ident" id="5597596">base</span><span class="op" id="5597600">.</span><span class="ident" id="5597601">Kind</span><span class="op" id="5597605">(</span><span class="op" id="5597606">)</span>&nbsp;<span class="op" id="5597608">==</span>&nbsp;<span class="ident" id="5597611">reflect</span><span class="op" id="5597618">.</span><span class="ident" id="5597619">Interface</span>&nbsp;<span class="op" id="5597629">&amp;&amp;</span>&nbsp;<span class="ident" id="5597632">remoteId</span>&nbsp;<span class="op" id="5597641">!=</span>&nbsp;<span class="ident" id="5597644">tInterface</span>&nbsp;<span class="op" id="5597655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597660">return</span>&nbsp;<span class="builtintype" id="5597667">nil</span><span class="op" id="5597670">,</span>&nbsp;<span class="ident" id="5597672">errors</span><span class="op" id="5597678">.</span><span class="ident" id="5597679">New</span><span class="op" id="5597682">(</span><span class="string" id="5597683">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5597712">+</span>&nbsp;<span class="ident" id="5597714">name</span>&nbsp;<span class="op" id="5597719">+</span>&nbsp;<span class="string" id="5597721">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5597796">+</span>&nbsp;<span class="ident" id="5597798">remoteType</span><span class="op" id="5597808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597816">return</span>&nbsp;<span class="builtintype" id="5597823">nil</span><span class="op" id="5597826">,</span>&nbsp;<span class="ident" id="5597828">errors</span><span class="op" id="5597834">.</span><span class="ident" id="5597835">New</span><span class="op" id="5597838">(</span><span class="string" id="5597839">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5597872">+</span>&nbsp;<span class="ident" id="5597874">name</span>&nbsp;<span class="op" id="5597879">+</span>&nbsp;<span class="string" id="5597881">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5597907">+</span>&nbsp;<span class="ident" id="5597909">remoteType</span><span class="op" id="5597919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597922">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597925">op</span>&nbsp;<span class="op" id="5597928">:=</span>&nbsp;<span class="ident" id="5597931">dec</span><span class="op" id="5597934">.</span><span class="ident" id="5597935">decOpFor</span><span class="op" id="5597943">(</span><span class="ident" id="5597944">remoteId</span><span class="op" id="5597952">,</span>&nbsp;<span class="ident" id="5597954">rt</span><span class="op" id="5597956">,</span>&nbsp;<span class="ident" id="5597958">name</span><span class="op" id="5597962">,</span>&nbsp;<span class="builtinfunc" id="5597964">make</span><span class="op" id="5597968">(</span><span class="keyword" id="5597969">map</span><span class="op" id="5597972">[</span><span class="ident" id="5597973">reflect</span><span class="op" id="5597980">.</span><span class="ident" id="5597981">Type</span><span class="op" id="5597985">]</span><span class="op" id="5597986">*</span><span class="ident" id="5597987">decOp</span><span class="op" id="5597992">)</span><span class="op" id="5597993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597996">ovfl</span>&nbsp;<span class="op" id="5598001">:=</span>&nbsp;<span class="ident" id="5598004">errors</span><span class="op" id="5598010">.</span><span class="ident" id="5598011">New</span><span class="op" id="5598014">(</span><span class="string" id="5598015">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5598029">+</span>&nbsp;<span class="ident" id="5598031">name</span>&nbsp;<span class="op" id="5598036">+</span>&nbsp;<span class="string" id="5598038">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5598054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598057">engine</span><span class="op" id="5598063">.</span><span class="ident" id="5598064">instr</span><span class="op" id="5598069">[</span><span class="ident" id="5598070">singletonField</span><span class="op" id="5598084">]</span>&nbsp;<span class="op" id="5598086">=</span>&nbsp;<span class="ident" id="5598088">decInstr</span><span class="op" id="5598096">{</span><span class="op" id="5598097">*</span><span class="ident" id="5598098">op</span><span class="op" id="5598100">,</span>&nbsp;<span class="ident" id="5598102">singletonField</span><span class="op" id="5598116">,</span>&nbsp;<span class="builtintype" id="5598118">nil</span><span class="op" id="5598121">,</span>&nbsp;<span class="ident" id="5598123">ovfl</span><span class="op" id="5598127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598130">engine</span><span class="op" id="5598136">.</span><span class="ident" id="5598137">numInstr</span>&nbsp;<span class="op" id="5598146">=</span>&nbsp;<span class="num" id="5598148">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598151">return</span><br>
<span class="lineno">1030</span><span class="op" id="5598158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598161">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5598269">func</span>&nbsp;<span class="op" id="5598274">(</span><span class="ident" id="5598275">dec</span>&nbsp;<span class="op" id="5598279">*</span><span class="ident" id="5598280">Decoder</span><span class="op" id="5598287">)</span>&nbsp;<span class="ident" id="5598289">compileIgnoreSingle</span><span class="op" id="5598308">(</span><span class="ident" id="5598309">remoteId</span>&nbsp;<span class="ident" id="5598318">typeId</span><span class="op" id="5598324">)</span>&nbsp;<span class="op" id="5598326">(</span><span class="ident" id="5598327">engine</span>&nbsp;<span class="op" id="5598334">*</span><span class="ident" id="5598335">decEngine</span><span class="op" id="5598344">,</span>&nbsp;<span class="ident" id="5598346">err</span>&nbsp;<span class="builtintype" id="5598350">error</span><span class="op" id="5598355">)</span>&nbsp;<span class="op" id="5598357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598360">engine</span>&nbsp;<span class="op" id="5598367">=</span>&nbsp;<span class="builtinfunc" id="5598369">new</span><span class="op" id="5598372">(</span><span class="ident" id="5598373">decEngine</span><span class="op" id="5598382">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598385">engine</span><span class="op" id="5598391">.</span><span class="ident" id="5598392">instr</span>&nbsp;<span class="op" id="5598398">=</span>&nbsp;<span class="builtinfunc" id="5598400">make</span><span class="op" id="5598404">(</span><span class="op" id="5598405">[</span><span class="op" id="5598406">]</span><span class="ident" id="5598407">decInstr</span><span class="op" id="5598415">,</span>&nbsp;<span class="num" id="5598417">1</span><span class="op" id="5598418">)</span>&nbsp;<span class="comment" id="5598420">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598433">op</span>&nbsp;<span class="op" id="5598436">:=</span>&nbsp;<span class="ident" id="5598439">dec</span><span class="op" id="5598442">.</span><span class="ident" id="5598443">decIgnoreOpFor</span><span class="op" id="5598457">(</span><span class="ident" id="5598458">remoteId</span><span class="op" id="5598466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598469">ovfl</span>&nbsp;<span class="op" id="5598474">:=</span>&nbsp;<span class="ident" id="5598477">overflow</span><span class="op" id="5598485">(</span><span class="ident" id="5598486">dec</span><span class="op" id="5598489">.</span><span class="ident" id="5598490">typeString</span><span class="op" id="5598500">(</span><span class="ident" id="5598501">remoteId</span><span class="op" id="5598509">)</span><span class="op" id="5598510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598513">engine</span><span class="op" id="5598519">.</span><span class="ident" id="5598520">instr</span><span class="op" id="5598525">[</span><span class="num" id="5598526">0</span><span class="op" id="5598527">]</span>&nbsp;<span class="op" id="5598529">=</span>&nbsp;<span class="ident" id="5598531">decInstr</span><span class="op" id="5598539">{</span><span class="ident" id="5598540">op</span><span class="op" id="5598542">,</span>&nbsp;<span class="num" id="5598544">0</span><span class="op" id="5598545">,</span>&nbsp;<span class="builtintype" id="5598547">nil</span><span class="op" id="5598550">,</span>&nbsp;<span class="ident" id="5598552">ovfl</span><span class="op" id="5598556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598559">engine</span><span class="op" id="5598565">.</span><span class="ident" id="5598566">numInstr</span>&nbsp;<span class="op" id="5598575">=</span>&nbsp;<span class="num" id="5598577">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598580">return</span><br>
<span class="lineno"></span><span class="op" id="5598587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598590">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="5598676">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="5598710">func</span>&nbsp;<span class="op" id="5598715">(</span><span class="ident" id="5598716">dec</span>&nbsp;<span class="op" id="5598720">*</span><span class="ident" id="5598721">Decoder</span><span class="op" id="5598728">)</span>&nbsp;<span class="ident" id="5598730">compileDec</span><span class="op" id="5598740">(</span><span class="ident" id="5598741">remoteId</span>&nbsp;<span class="ident" id="5598750">typeId</span><span class="op" id="5598756">,</span>&nbsp;<span class="ident" id="5598758">ut</span>&nbsp;<span class="op" id="5598761">*</span><span class="ident" id="5598762">userTypeInfo</span><span class="op" id="5598774">)</span>&nbsp;<span class="op" id="5598776">(</span><span class="ident" id="5598777">engine</span>&nbsp;<span class="op" id="5598784">*</span><span class="ident" id="5598785">decEngine</span><span class="op" id="5598794">,</span>&nbsp;<span class="ident" id="5598796">err</span>&nbsp;<span class="builtintype" id="5598800">error</span><span class="op" id="5598805">)</span>&nbsp;<span class="op" id="5598807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598810">rt</span>&nbsp;<span class="op" id="5598813">:=</span>&nbsp;<span class="ident" id="5598816">ut</span><span class="op" id="5598818">.</span><span class="ident" id="5598819">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598825">srt</span>&nbsp;<span class="op" id="5598829">:=</span>&nbsp;<span class="ident" id="5598832">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598836">if</span>&nbsp;<span class="ident" id="5598839">srt</span><span class="op" id="5598842">.</span><span class="ident" id="5598843">Kind</span><span class="op" id="5598847">(</span><span class="op" id="5598848">)</span>&nbsp;<span class="op" id="5598850">!=</span>&nbsp;<span class="ident" id="5598853">reflect</span><span class="op" id="5598860">.</span><span class="ident" id="5598861">Struct</span>&nbsp;<span class="op" id="5598868">||</span>&nbsp;<span class="ident" id="5598871">ut</span><span class="op" id="5598873">.</span><span class="ident" id="5598874">externalDec</span>&nbsp;<span class="op" id="5598886">!=</span>&nbsp;<span class="num" id="5598889">0</span>&nbsp;<span class="op" id="5598891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598895">return</span>&nbsp;<span class="ident" id="5598902">dec</span><span class="op" id="5598905">.</span><span class="ident" id="5598906">compileSingle</span><span class="op" id="5598919">(</span><span class="ident" id="5598920">remoteId</span><span class="op" id="5598928">,</span>&nbsp;<span class="ident" id="5598930">ut</span><span class="op" id="5598932">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598938">var</span>&nbsp;<span class="ident" id="5598942">wireStruct</span>&nbsp;<span class="op" id="5598953">*</span><span class="ident" id="5598954">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598966">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599052">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599132">if</span>&nbsp;<span class="ident" id="5599135">t</span><span class="op" id="5599136">,</span>&nbsp;<span class="ident" id="5599138">ok</span>&nbsp;<span class="op" id="5599141">:=</span>&nbsp;<span class="ident" id="5599144">builtinIdToType</span><span class="op" id="5599159">[</span><span class="ident" id="5599160">remoteId</span><span class="op" id="5599168">]</span><span class="op" id="5599169">;</span>&nbsp;<span class="ident" id="5599171">ok</span>&nbsp;<span class="op" id="5599174">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599178">wireStruct</span><span class="op" id="5599188">,</span>&nbsp;<span class="ident" id="5599190">_</span>&nbsp;<span class="op" id="5599192">=</span>&nbsp;<span class="ident" id="5599194">t</span><span class="op" id="5599195">.</span><span class="op" id="5599196">(</span><span class="op" id="5599197">*</span><span class="ident" id="5599198">structType</span><span class="op" id="5599208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599211">}</span>&nbsp;<span class="keyword" id="5599213">else</span>&nbsp;<span class="op" id="5599218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599222">wire</span>&nbsp;<span class="op" id="5599227">:=</span>&nbsp;<span class="ident" id="5599230">dec</span><span class="op" id="5599233">.</span><span class="ident" id="5599234">wireType</span><span class="op" id="5599242">[</span><span class="ident" id="5599243">remoteId</span><span class="op" id="5599251">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599255">if</span>&nbsp;<span class="ident" id="5599258">wire</span>&nbsp;<span class="op" id="5599263">==</span>&nbsp;<span class="builtintype" id="5599266">nil</span>&nbsp;<span class="op" id="5599270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599275">error_</span><span class="op" id="5599281">(</span><span class="ident" id="5599282">errBadType</span><span class="op" id="5599292">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599300">wireStruct</span>&nbsp;<span class="op" id="5599311">=</span>&nbsp;<span class="ident" id="5599313">wire</span><span class="op" id="5599317">.</span><span class="ident" id="5599318">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599330">if</span>&nbsp;<span class="ident" id="5599333">wireStruct</span>&nbsp;<span class="op" id="5599344">==</span>&nbsp;<span class="builtintype" id="5599347">nil</span>&nbsp;<span class="op" id="5599351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599355">errorf</span><span class="op" id="5599361">(</span><span class="string" id="5599362">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="5599425">,</span>&nbsp;<span class="ident" id="5599427">rt</span><span class="op" id="5599429">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599435">engine</span>&nbsp;<span class="op" id="5599442">=</span>&nbsp;<span class="builtinfunc" id="5599444">new</span><span class="op" id="5599447">(</span><span class="ident" id="5599448">decEngine</span><span class="op" id="5599457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599460">engine</span><span class="op" id="5599466">.</span><span class="ident" id="5599467">instr</span>&nbsp;<span class="op" id="5599473">=</span>&nbsp;<span class="builtinfunc" id="5599475">make</span><span class="op" id="5599479">(</span><span class="op" id="5599480">[</span><span class="op" id="5599481">]</span><span class="ident" id="5599482">decInstr</span><span class="op" id="5599490">,</span>&nbsp;<span class="builtinfunc" id="5599492">len</span><span class="op" id="5599495">(</span><span class="ident" id="5599496">wireStruct</span><span class="op" id="5599506">.</span><span class="ident" id="5599507">Field</span><span class="op" id="5599512">)</span><span class="op" id="5599513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599516">seen</span>&nbsp;<span class="op" id="5599521">:=</span>&nbsp;<span class="builtinfunc" id="5599524">make</span><span class="op" id="5599528">(</span><span class="keyword" id="5599529">map</span><span class="op" id="5599532">[</span><span class="ident" id="5599533">reflect</span><span class="op" id="5599540">.</span><span class="ident" id="5599541">Type</span><span class="op" id="5599545">]</span><span class="op" id="5599546">*</span><span class="ident" id="5599547">decOp</span><span class="op" id="5599552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599555">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599598">for</span>&nbsp;<span class="ident" id="5599602">fieldnum</span>&nbsp;<span class="op" id="5599611">:=</span>&nbsp;<span class="num" id="5599614">0</span><span class="op" id="5599615">;</span>&nbsp;<span class="ident" id="5599617">fieldnum</span>&nbsp;<span class="op" id="5599626">&lt;</span>&nbsp;<span class="builtinfunc" id="5599628">len</span><span class="op" id="5599631">(</span><span class="ident" id="5599632">wireStruct</span><span class="op" id="5599642">.</span><span class="ident" id="5599643">Field</span><span class="op" id="5599648">)</span><span class="op" id="5599649">;</span>&nbsp;<span class="ident" id="5599651">fieldnum</span><span class="op" id="5599659">++</span>&nbsp;<span class="op" id="5599662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599666">wireField</span>&nbsp;<span class="op" id="5599676">:=</span>&nbsp;<span class="ident" id="5599679">wireStruct</span><span class="op" id="5599689">.</span><span class="ident" id="5599690">Field</span><span class="op" id="5599695">[</span><span class="ident" id="5599696">fieldnum</span><span class="op" id="5599704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599708">if</span>&nbsp;<span class="ident" id="5599711">wireField</span><span class="op" id="5599720">.</span><span class="ident" id="5599721">Name</span>&nbsp;<span class="op" id="5599726">==</span>&nbsp;<span class="string" id="5599729">&#34;&#34;</span>&nbsp;<span class="op" id="5599732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599737">errorf</span><span class="op" id="5599743">(</span><span class="string" id="5599744">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5599784">,</span>&nbsp;<span class="ident" id="5599786">wireStruct</span><span class="op" id="5599796">.</span><span class="ident" id="5599797">Name</span><span class="op" id="5599801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599805">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599809">ovfl</span>&nbsp;<span class="op" id="5599814">:=</span>&nbsp;<span class="ident" id="5599817">overflow</span><span class="op" id="5599825">(</span><span class="ident" id="5599826">wireField</span><span class="op" id="5599835">.</span><span class="ident" id="5599836">Name</span><span class="op" id="5599840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599844">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599902">localField</span><span class="op" id="5599912">,</span>&nbsp;<span class="ident" id="5599914">present</span>&nbsp;<span class="op" id="5599922">:=</span>&nbsp;<span class="ident" id="5599925">srt</span><span class="op" id="5599928">.</span><span class="ident" id="5599929">FieldByName</span><span class="op" id="5599940">(</span><span class="ident" id="5599941">wireField</span><span class="op" id="5599950">.</span><span class="ident" id="5599951">Name</span><span class="op" id="5599955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599959">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599989">if</span>&nbsp;<span class="op" id="5599992">!</span><span class="ident" id="5599993">present</span>&nbsp;<span class="op" id="5600001">||</span>&nbsp;<span class="op" id="5600004">!</span><span class="ident" id="5600005">isExported</span><span class="op" id="5600015">(</span><span class="ident" id="5600016">wireField</span><span class="op" id="5600025">.</span><span class="ident" id="5600026">Name</span><span class="op" id="5600030">)</span>&nbsp;<span class="op" id="5600032">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600037">op</span>&nbsp;<span class="op" id="5600040">:=</span>&nbsp;<span class="ident" id="5600043">dec</span><span class="op" id="5600046">.</span><span class="ident" id="5600047">decIgnoreOpFor</span><span class="op" id="5600061">(</span><span class="ident" id="5600062">wireField</span><span class="op" id="5600071">.</span><span class="ident" id="5600072">Id</span><span class="op" id="5600074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600079">engine</span><span class="op" id="5600085">.</span><span class="ident" id="5600086">instr</span><span class="op" id="5600091">[</span><span class="ident" id="5600092">fieldnum</span><span class="op" id="5600100">]</span>&nbsp;<span class="op" id="5600102">=</span>&nbsp;<span class="ident" id="5600104">decInstr</span><span class="op" id="5600112">{</span><span class="ident" id="5600113">op</span><span class="op" id="5600115">,</span>&nbsp;<span class="ident" id="5600117">fieldnum</span><span class="op" id="5600125">,</span>&nbsp;<span class="builtintype" id="5600127">nil</span><span class="op" id="5600130">,</span>&nbsp;<span class="ident" id="5600132">ovfl</span><span class="op" id="5600136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600141">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600156">if</span>&nbsp;<span class="op" id="5600159">!</span><span class="ident" id="5600160">dec</span><span class="op" id="5600163">.</span><span class="ident" id="5600164">compatibleType</span><span class="op" id="5600178">(</span><span class="ident" id="5600179">localField</span><span class="op" id="5600189">.</span><span class="ident" id="5600190">Type</span><span class="op" id="5600194">,</span>&nbsp;<span class="ident" id="5600196">wireField</span><span class="op" id="5600205">.</span><span class="ident" id="5600206">Id</span><span class="op" id="5600208">,</span>&nbsp;<span class="builtinfunc" id="5600210">make</span><span class="op" id="5600214">(</span><span class="keyword" id="5600215">map</span><span class="op" id="5600218">[</span><span class="ident" id="5600219">reflect</span><span class="op" id="5600226">.</span><span class="ident" id="5600227">Type</span><span class="op" id="5600231">]</span><span class="ident" id="5600232">typeId</span><span class="op" id="5600238">)</span><span class="op" id="5600239">)</span>&nbsp;<span class="op" id="5600241">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600246">errorf</span><span class="op" id="5600252">(</span><span class="string" id="5600253">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="5600295">,</span>&nbsp;<span class="ident" id="5600297">localField</span><span class="op" id="5600307">.</span><span class="ident" id="5600308">Type</span><span class="op" id="5600312">,</span>&nbsp;<span class="ident" id="5600314">wireStruct</span><span class="op" id="5600324">.</span><span class="ident" id="5600325">Name</span><span class="op" id="5600329">,</span>&nbsp;<span class="ident" id="5600331">wireField</span><span class="op" id="5600340">.</span><span class="ident" id="5600341">Name</span><span class="op" id="5600345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600353">op</span>&nbsp;<span class="op" id="5600356">:=</span>&nbsp;<span class="ident" id="5600359">dec</span><span class="op" id="5600362">.</span><span class="ident" id="5600363">decOpFor</span><span class="op" id="5600371">(</span><span class="ident" id="5600372">wireField</span><span class="op" id="5600381">.</span><span class="ident" id="5600382">Id</span><span class="op" id="5600384">,</span>&nbsp;<span class="ident" id="5600386">localField</span><span class="op" id="5600396">.</span><span class="ident" id="5600397">Type</span><span class="op" id="5600401">,</span>&nbsp;<span class="ident" id="5600403">localField</span><span class="op" id="5600413">.</span><span class="ident" id="5600414">Name</span><span class="op" id="5600418">,</span>&nbsp;<span class="ident" id="5600420">seen</span><span class="op" id="5600424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600428">engine</span><span class="op" id="5600434">.</span><span class="ident" id="5600435">instr</span><span class="op" id="5600440">[</span><span class="ident" id="5600441">fieldnum</span><span class="op" id="5600449">]</span>&nbsp;<span class="op" id="5600451">=</span>&nbsp;<span class="ident" id="5600453">decInstr</span><span class="op" id="5600461">{</span><span class="op" id="5600462">*</span><span class="ident" id="5600463">op</span><span class="op" id="5600465">,</span>&nbsp;<span class="ident" id="5600467">fieldnum</span><span class="op" id="5600475">,</span>&nbsp;<span class="ident" id="5600477">localField</span><span class="op" id="5600487">.</span><span class="ident" id="5600488">Index</span><span class="op" id="5600493">,</span>&nbsp;<span class="ident" id="5600495">ovfl</span><span class="op" id="5600499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600503">engine</span><span class="op" id="5600509">.</span><span class="ident" id="5600510">numInstr</span><span class="op" id="5600518">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600525">return</span><br>
<span class="lineno"></span><span class="op" id="5600532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5600535">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="5600597">func</span>&nbsp;<span class="op" id="5600602">(</span><span class="ident" id="5600603">dec</span>&nbsp;<span class="op" id="5600607">*</span><span class="ident" id="5600608">Decoder</span><span class="op" id="5600615">)</span>&nbsp;<span class="ident" id="5600617">getDecEnginePtr</span><span class="op" id="5600632">(</span><span class="ident" id="5600633">remoteId</span>&nbsp;<span class="ident" id="5600642">typeId</span><span class="op" id="5600648">,</span>&nbsp;<span class="ident" id="5600650">ut</span>&nbsp;<span class="op" id="5600653">*</span><span class="ident" id="5600654">userTypeInfo</span><span class="op" id="5600666">)</span>&nbsp;<span class="op" id="5600668">(</span><span class="ident" id="5600669">enginePtr</span>&nbsp;<span class="op" id="5600679">*</span><span class="op" id="5600680">*</span><span class="ident" id="5600681">decEngine</span><span class="op" id="5600690">,</span>&nbsp;<span class="ident" id="5600692">err</span>&nbsp;<span class="builtintype" id="5600696">error</span><span class="op" id="5600701">)</span>&nbsp;<span class="op" id="5600703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600706">rt</span>&nbsp;<span class="op" id="5600709">:=</span>&nbsp;<span class="ident" id="5600712">ut</span><span class="op" id="5600714">.</span><span class="ident" id="5600715">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600721">decoderMap</span><span class="op" id="5600731">,</span>&nbsp;<span class="ident" id="5600733">ok</span>&nbsp;<span class="op" id="5600736">:=</span>&nbsp;<span class="ident" id="5600739">dec</span><span class="op" id="5600742">.</span><span class="ident" id="5600743">decoderCache</span><span class="op" id="5600755">[</span><span class="ident" id="5600756">rt</span><span class="op" id="5600758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600761">if</span>&nbsp;<span class="op" id="5600764">!</span><span class="ident" id="5600765">ok</span>&nbsp;<span class="op" id="5600768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600772">decoderMap</span>&nbsp;<span class="op" id="5600783">=</span>&nbsp;<span class="builtinfunc" id="5600785">make</span><span class="op" id="5600789">(</span><span class="keyword" id="5600790">map</span><span class="op" id="5600793">[</span><span class="ident" id="5600794">typeId</span><span class="op" id="5600800">]</span><span class="op" id="5600801">*</span><span class="op" id="5600802">*</span><span class="ident" id="5600803">decEngine</span><span class="op" id="5600812">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600816">dec</span><span class="op" id="5600819">.</span><span class="ident" id="5600820">decoderCache</span><span class="op" id="5600832">[</span><span class="ident" id="5600833">rt</span><span class="op" id="5600835">]</span>&nbsp;<span class="op" id="5600837">=</span>&nbsp;<span class="ident" id="5600839">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600854">if</span>&nbsp;<span class="ident" id="5600857">enginePtr</span><span class="op" id="5600866">,</span>&nbsp;<span class="ident" id="5600868">ok</span>&nbsp;<span class="op" id="5600871">=</span>&nbsp;<span class="ident" id="5600873">decoderMap</span><span class="op" id="5600883">[</span><span class="ident" id="5600884">remoteId</span><span class="op" id="5600892">]</span><span class="op" id="5600893">;</span>&nbsp;<span class="op" id="5600895">!</span><span class="ident" id="5600896">ok</span>&nbsp;<span class="op" id="5600899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600903">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600982">enginePtr</span>&nbsp;<span class="op" id="5600992">=</span>&nbsp;<span class="builtinfunc" id="5600994">new</span><span class="op" id="5600997">(</span><span class="op" id="5600998">*</span><span class="ident" id="5600999">decEngine</span><span class="op" id="5601008">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601012">decoderMap</span><span class="op" id="5601022">[</span><span class="ident" id="5601023">remoteId</span><span class="op" id="5601031">]</span>&nbsp;<span class="op" id="5601033">=</span>&nbsp;<span class="ident" id="5601035">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601047">*</span><span class="ident" id="5601048">enginePtr</span><span class="op" id="5601057">,</span>&nbsp;<span class="ident" id="5601059">err</span>&nbsp;<span class="op" id="5601063">=</span>&nbsp;<span class="ident" id="5601065">dec</span><span class="op" id="5601068">.</span><span class="ident" id="5601069">compileDec</span><span class="op" id="5601079">(</span><span class="ident" id="5601080">remoteId</span><span class="op" id="5601088">,</span>&nbsp;<span class="ident" id="5601090">ut</span><span class="op" id="5601092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601096">if</span>&nbsp;<span class="ident" id="5601099">err</span>&nbsp;<span class="op" id="5601103">!=</span>&nbsp;<span class="builtintype" id="5601106">nil</span>&nbsp;<span class="op" id="5601110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5601115">delete</span><span class="op" id="5601121">(</span><span class="ident" id="5601122">decoderMap</span><span class="op" id="5601132">,</span>&nbsp;<span class="ident" id="5601134">remoteId</span><span class="op" id="5601142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601146">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601152">return</span><br>
<span class="lineno"></span><span class="op" id="5601159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601162">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5601235">type</span>&nbsp;<span class="ident" id="5601240">emptyStruct</span>&nbsp;<span class="keyword" id="5601252">struct</span><span class="op" id="5601258">{</span><span class="op" id="5601259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5601262">var</span>&nbsp;<span class="ident" id="5601266">emptyStructType</span>&nbsp;<span class="op" id="5601282">=</span>&nbsp;<span class="ident" id="5601284">reflect</span><span class="op" id="5601291">.</span><span class="ident" id="5601292">TypeOf</span><span class="op" id="5601298">(</span><span class="ident" id="5601299">emptyStruct</span><span class="op" id="5601310">{</span><span class="op" id="5601311">}</span><span class="op" id="5601312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601315">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="5601411">func</span>&nbsp;<span class="op" id="5601416">(</span><span class="ident" id="5601417">dec</span>&nbsp;<span class="op" id="5601421">*</span><span class="ident" id="5601422">Decoder</span><span class="op" id="5601429">)</span>&nbsp;<span class="ident" id="5601431">getIgnoreEnginePtr</span><span class="op" id="5601449">(</span><span class="ident" id="5601450">wireId</span>&nbsp;<span class="ident" id="5601457">typeId</span><span class="op" id="5601463">)</span>&nbsp;<span class="op" id="5601465">(</span><span class="ident" id="5601466">enginePtr</span>&nbsp;<span class="op" id="5601476">*</span><span class="op" id="5601477">*</span><span class="ident" id="5601478">decEngine</span><span class="op" id="5601487">,</span>&nbsp;<span class="ident" id="5601489">err</span>&nbsp;<span class="builtintype" id="5601493">error</span><span class="op" id="5601498">)</span>&nbsp;<span class="op" id="5601500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601503">var</span>&nbsp;<span class="ident" id="5601507">ok</span>&nbsp;<span class="builtintype" id="5601510">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601516">if</span>&nbsp;<span class="ident" id="5601519">enginePtr</span><span class="op" id="5601528">,</span>&nbsp;<span class="ident" id="5601530">ok</span>&nbsp;<span class="op" id="5601533">=</span>&nbsp;<span class="ident" id="5601535">dec</span><span class="op" id="5601538">.</span><span class="ident" id="5601539">ignorerCache</span><span class="op" id="5601551">[</span><span class="ident" id="5601552">wireId</span><span class="op" id="5601558">]</span><span class="op" id="5601559">;</span>&nbsp;<span class="op" id="5601561">!</span><span class="ident" id="5601562">ok</span>&nbsp;<span class="op" id="5601565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601569">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601648">enginePtr</span>&nbsp;<span class="op" id="5601658">=</span>&nbsp;<span class="builtinfunc" id="5601660">new</span><span class="op" id="5601663">(</span><span class="op" id="5601664">*</span><span class="ident" id="5601665">decEngine</span><span class="op" id="5601674">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601678">dec</span><span class="op" id="5601681">.</span><span class="ident" id="5601682">ignorerCache</span><span class="op" id="5601694">[</span><span class="ident" id="5601695">wireId</span><span class="op" id="5601701">]</span>&nbsp;<span class="op" id="5601703">=</span>&nbsp;<span class="ident" id="5601705">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601717">wire</span>&nbsp;<span class="op" id="5601722">:=</span>&nbsp;<span class="ident" id="5601725">dec</span><span class="op" id="5601728">.</span><span class="ident" id="5601729">wireType</span><span class="op" id="5601737">[</span><span class="ident" id="5601738">wireId</span><span class="op" id="5601744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601748">if</span>&nbsp;<span class="ident" id="5601751">wire</span>&nbsp;<span class="op" id="5601756">!=</span>&nbsp;<span class="builtintype" id="5601759">nil</span>&nbsp;<span class="op" id="5601763">&amp;&amp;</span>&nbsp;<span class="ident" id="5601766">wire</span><span class="op" id="5601770">.</span><span class="ident" id="5601771">StructT</span>&nbsp;<span class="op" id="5601779">!=</span>&nbsp;<span class="builtintype" id="5601782">nil</span>&nbsp;<span class="op" id="5601786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601791">*</span><span class="ident" id="5601792">enginePtr</span><span class="op" id="5601801">,</span>&nbsp;<span class="ident" id="5601803">err</span>&nbsp;<span class="op" id="5601807">=</span>&nbsp;<span class="ident" id="5601809">dec</span><span class="op" id="5601812">.</span><span class="ident" id="5601813">compileDec</span><span class="op" id="5601823">(</span><span class="ident" id="5601824">wireId</span><span class="op" id="5601830">,</span>&nbsp;<span class="ident" id="5601832">userType</span><span class="op" id="5601840">(</span><span class="ident" id="5601841">emptyStructType</span><span class="op" id="5601856">)</span><span class="op" id="5601857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601861">}</span>&nbsp;<span class="keyword" id="5601863">else</span>&nbsp;<span class="op" id="5601868">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601873">*</span><span class="ident" id="5601874">enginePtr</span><span class="op" id="5601883">,</span>&nbsp;<span class="ident" id="5601885">err</span>&nbsp;<span class="op" id="5601889">=</span>&nbsp;<span class="ident" id="5601891">dec</span><span class="op" id="5601894">.</span><span class="ident" id="5601895">compileIgnoreSingle</span><span class="op" id="5601914">(</span><span class="ident" id="5601915">wireId</span><span class="op" id="5601921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601929">if</span>&nbsp;<span class="ident" id="5601932">err</span>&nbsp;<span class="op" id="5601936">!=</span>&nbsp;<span class="builtintype" id="5601939">nil</span>&nbsp;<span class="op" id="5601943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5601948">delete</span><span class="op" id="5601954">(</span><span class="ident" id="5601955">dec</span><span class="op" id="5601958">.</span><span class="ident" id="5601959">ignorerCache</span><span class="op" id="5601971">,</span>&nbsp;<span class="ident" id="5601973">wireId</span><span class="op" id="5601979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601983">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601989">return</span><br>
<span class="lineno"></span><span class="op" id="5601996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601999">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="5602083">func</span>&nbsp;<span class="op" id="5602088">(</span><span class="ident" id="5602089">dec</span>&nbsp;<span class="op" id="5602093">*</span><span class="ident" id="5602094">Decoder</span><span class="op" id="5602101">)</span>&nbsp;<span class="ident" id="5602103">decodeValue</span><span class="op" id="5602114">(</span><span class="ident" id="5602115">wireId</span>&nbsp;<span class="ident" id="5602122">typeId</span><span class="op" id="5602128">,</span>&nbsp;<span class="ident" id="5602130">value</span>&nbsp;<span class="ident" id="5602136">reflect</span><span class="op" id="5602143">.</span><span class="ident" id="5602144">Value</span><span class="op" id="5602149">)</span>&nbsp;<span class="op" id="5602151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602154">defer</span>&nbsp;<span class="ident" id="5602160">catchError</span><span class="op" id="5602170">(</span><span class="op" id="5602171">&amp;</span><span class="ident" id="5602172">dec</span><span class="op" id="5602175">.</span><span class="ident" id="5602176">err</span><span class="op" id="5602179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602182">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602249">if</span>&nbsp;<span class="op" id="5602252">!</span><span class="ident" id="5602253">value</span><span class="op" id="5602258">.</span><span class="ident" id="5602259">IsValid</span><span class="op" id="5602266">(</span><span class="op" id="5602267">)</span>&nbsp;<span class="op" id="5602269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602273">dec</span><span class="op" id="5602276">.</span><span class="ident" id="5602277">decodeIgnoredValue</span><span class="op" id="5602295">(</span><span class="ident" id="5602296">wireId</span><span class="op" id="5602302">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602306">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602317">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602362">ut</span>&nbsp;<span class="op" id="5602365">:=</span>&nbsp;<span class="ident" id="5602368">userType</span><span class="op" id="5602376">(</span><span class="ident" id="5602377">value</span><span class="op" id="5602382">.</span><span class="ident" id="5602383">Type</span><span class="op" id="5602387">(</span><span class="op" id="5602388">)</span><span class="op" id="5602389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602392">base</span>&nbsp;<span class="op" id="5602397">:=</span>&nbsp;<span class="ident" id="5602400">ut</span><span class="op" id="5602402">.</span><span class="ident" id="5602403">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602409">var</span>&nbsp;<span class="ident" id="5602413">enginePtr</span>&nbsp;<span class="op" id="5602423">*</span><span class="op" id="5602424">*</span><span class="ident" id="5602425">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602436">enginePtr</span><span class="op" id="5602445">,</span>&nbsp;<span class="ident" id="5602447">dec</span><span class="op" id="5602450">.</span><span class="ident" id="5602451">err</span>&nbsp;<span class="op" id="5602455">=</span>&nbsp;<span class="ident" id="5602457">dec</span><span class="op" id="5602460">.</span><span class="ident" id="5602461">getDecEnginePtr</span><span class="op" id="5602476">(</span><span class="ident" id="5602477">wireId</span><span class="op" id="5602483">,</span>&nbsp;<span class="ident" id="5602485">ut</span><span class="op" id="5602487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602490">if</span>&nbsp;<span class="ident" id="5602493">dec</span><span class="op" id="5602496">.</span><span class="ident" id="5602497">err</span>&nbsp;<span class="op" id="5602501">!=</span>&nbsp;<span class="builtintype" id="5602504">nil</span>&nbsp;<span class="op" id="5602508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602512">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602520">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602523">value</span>&nbsp;<span class="op" id="5602529">=</span>&nbsp;<span class="ident" id="5602531">decAlloc</span><span class="op" id="5602539">(</span><span class="ident" id="5602540">value</span><span class="op" id="5602545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602548">engine</span>&nbsp;<span class="op" id="5602555">:=</span>&nbsp;<span class="op" id="5602558">*</span><span class="ident" id="5602559">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602570">if</span>&nbsp;<span class="ident" id="5602573">st</span>&nbsp;<span class="op" id="5602576">:=</span>&nbsp;<span class="ident" id="5602579">base</span><span class="op" id="5602583">;</span>&nbsp;<span class="ident" id="5602585">st</span><span class="op" id="5602587">.</span><span class="ident" id="5602588">Kind</span><span class="op" id="5602592">(</span><span class="op" id="5602593">)</span>&nbsp;<span class="op" id="5602595">==</span>&nbsp;<span class="ident" id="5602598">reflect</span><span class="op" id="5602605">.</span><span class="ident" id="5602606">Struct</span>&nbsp;<span class="op" id="5602613">&amp;&amp;</span>&nbsp;<span class="ident" id="5602616">ut</span><span class="op" id="5602618">.</span><span class="ident" id="5602619">externalDec</span>&nbsp;<span class="op" id="5602631">==</span>&nbsp;<span class="num" id="5602634">0</span>&nbsp;<span class="op" id="5602636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602640">if</span>&nbsp;<span class="ident" id="5602643">engine</span><span class="op" id="5602649">.</span><span class="ident" id="5602650">numInstr</span>&nbsp;<span class="op" id="5602659">==</span>&nbsp;<span class="num" id="5602662">0</span>&nbsp;<span class="op" id="5602664">&amp;&amp;</span>&nbsp;<span class="ident" id="5602667">st</span><span class="op" id="5602669">.</span><span class="ident" id="5602670">NumField</span><span class="op" id="5602678">(</span><span class="op" id="5602679">)</span>&nbsp;<span class="op" id="5602681">&gt;</span>&nbsp;<span class="num" id="5602683">0</span>&nbsp;<span class="op" id="5602685">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602691">dec</span><span class="op" id="5602694">.</span><span class="ident" id="5602695">wireType</span><span class="op" id="5602703">[</span><span class="ident" id="5602704">wireId</span><span class="op" id="5602710">]</span>&nbsp;<span class="op" id="5602712">!=</span>&nbsp;<span class="builtintype" id="5602715">nil</span>&nbsp;<span class="op" id="5602719">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5602722">len</span><span class="op" id="5602725">(</span><span class="ident" id="5602726">dec</span><span class="op" id="5602729">.</span><span class="ident" id="5602730">wireType</span><span class="op" id="5602738">[</span><span class="ident" id="5602739">wireId</span><span class="op" id="5602745">]</span><span class="op" id="5602746">.</span><span class="ident" id="5602747">StructT</span><span class="op" id="5602754">.</span><span class="ident" id="5602755">Field</span><span class="op" id="5602760">)</span>&nbsp;<span class="op" id="5602762">&gt;</span>&nbsp;<span class="num" id="5602764">0</span>&nbsp;<span class="op" id="5602766">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602771">name</span>&nbsp;<span class="op" id="5602776">:=</span>&nbsp;<span class="ident" id="5602779">base</span><span class="op" id="5602783">.</span><span class="ident" id="5602784">Name</span><span class="op" id="5602788">(</span><span class="op" id="5602789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602794">errorf</span><span class="op" id="5602800">(</span><span class="string" id="5602801">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5602860">,</span>&nbsp;<span class="ident" id="5602862">name</span><span class="op" id="5602866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602874">dec</span><span class="op" id="5602877">.</span><span class="ident" id="5602878">decodeStruct</span><span class="op" id="5602890">(</span><span class="ident" id="5602891">engine</span><span class="op" id="5602897">,</span>&nbsp;<span class="ident" id="5602899">ut</span><span class="op" id="5602901">,</span>&nbsp;<span class="ident" id="5602903">value</span><span class="op" id="5602908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602911">}</span>&nbsp;<span class="keyword" id="5602913">else</span>&nbsp;<span class="op" id="5602918">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602922">dec</span><span class="op" id="5602925">.</span><span class="ident" id="5602926">decodeSingle</span><span class="op" id="5602938">(</span><span class="ident" id="5602939">engine</span><span class="op" id="5602945">,</span>&nbsp;<span class="ident" id="5602947">ut</span><span class="op" id="5602949">,</span>&nbsp;<span class="ident" id="5602951">value</span><span class="op" id="5602956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602959">}</span><br>
<span class="lineno"></span><span class="op" id="5602961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5602964">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="5603070">func</span>&nbsp;<span class="op" id="5603075">(</span><span class="ident" id="5603076">dec</span>&nbsp;<span class="op" id="5603080">*</span><span class="ident" id="5603081">Decoder</span><span class="op" id="5603088">)</span>&nbsp;<span class="ident" id="5603090">decodeIgnoredValue</span><span class="op" id="5603108">(</span><span class="ident" id="5603109">wireId</span>&nbsp;<span class="ident" id="5603116">typeId</span><span class="op" id="5603122">)</span>&nbsp;<span class="op" id="5603124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603127">var</span>&nbsp;<span class="ident" id="5603131">enginePtr</span>&nbsp;<span class="op" id="5603141">*</span><span class="op" id="5603142">*</span><span class="ident" id="5603143">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603154">enginePtr</span><span class="op" id="5603163">,</span>&nbsp;<span class="ident" id="5603165">dec</span><span class="op" id="5603168">.</span><span class="ident" id="5603169">err</span>&nbsp;<span class="op" id="5603173">=</span>&nbsp;<span class="ident" id="5603175">dec</span><span class="op" id="5603178">.</span><span class="ident" id="5603179">getIgnoreEnginePtr</span><span class="op" id="5603197">(</span><span class="ident" id="5603198">wireId</span><span class="op" id="5603204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603207">if</span>&nbsp;<span class="ident" id="5603210">dec</span><span class="op" id="5603213">.</span><span class="ident" id="5603214">err</span>&nbsp;<span class="op" id="5603218">!=</span>&nbsp;<span class="builtintype" id="5603221">nil</span>&nbsp;<span class="op" id="5603225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603229">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603240">wire</span>&nbsp;<span class="op" id="5603245">:=</span>&nbsp;<span class="ident" id="5603248">dec</span><span class="op" id="5603251">.</span><span class="ident" id="5603252">wireType</span><span class="op" id="5603260">[</span><span class="ident" id="5603261">wireId</span><span class="op" id="5603267">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603270">if</span>&nbsp;<span class="ident" id="5603273">wire</span>&nbsp;<span class="op" id="5603278">!=</span>&nbsp;<span class="builtintype" id="5603281">nil</span>&nbsp;<span class="op" id="5603285">&amp;&amp;</span>&nbsp;<span class="ident" id="5603288">wire</span><span class="op" id="5603292">.</span><span class="ident" id="5603293">StructT</span>&nbsp;<span class="op" id="5603301">!=</span>&nbsp;<span class="builtintype" id="5603304">nil</span>&nbsp;<span class="op" id="5603308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603312">dec</span><span class="op" id="5603315">.</span><span class="ident" id="5603316">ignoreStruct</span><span class="op" id="5603328">(</span><span class="op" id="5603329">*</span><span class="ident" id="5603330">enginePtr</span><span class="op" id="5603339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603342">}</span>&nbsp;<span class="keyword" id="5603344">else</span>&nbsp;<span class="op" id="5603349">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603353">dec</span><span class="op" id="5603356">.</span><span class="ident" id="5603357">ignoreSingle</span><span class="op" id="5603369">(</span><span class="op" id="5603370">*</span><span class="ident" id="5603371">enginePtr</span><span class="op" id="5603380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603383">}</span><br>
<span class="lineno"></span><span class="op" id="5603385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603388">func</span>&nbsp;<span class="ident" id="5603393">init</span><span class="op" id="5603397">(</span><span class="op" id="5603398">)</span>&nbsp;<span class="op" id="5603400">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603403">var</span>&nbsp;<span class="ident" id="5603407">iop</span><span class="op" id="5603410">,</span>&nbsp;<span class="ident" id="5603412">uop</span>&nbsp;<span class="ident" id="5603416">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603423">switch</span>&nbsp;<span class="ident" id="5603430">reflect</span><span class="op" id="5603437">.</span><span class="ident" id="5603438">TypeOf</span><span class="op" id="5603444">(</span><span class="builtintype" id="5603445">int</span><span class="op" id="5603448">(</span><span class="num" id="5603449">0</span><span class="op" id="5603450">)</span><span class="op" id="5603451">)</span><span class="op" id="5603452">.</span><span class="ident" id="5603453">Bits</span><span class="op" id="5603457">(</span><span class="op" id="5603458">)</span>&nbsp;<span class="op" id="5603460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603463">case</span>&nbsp;<span class="num" id="5603468">32</span><span class="op" id="5603470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603474">iop</span>&nbsp;<span class="op" id="5603478">=</span>&nbsp;<span class="ident" id="5603480">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603491">uop</span>&nbsp;<span class="op" id="5603495">=</span>&nbsp;<span class="ident" id="5603497">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603508">case</span>&nbsp;<span class="num" id="5603513">64</span><span class="op" id="5603515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603519">iop</span>&nbsp;<span class="op" id="5603523">=</span>&nbsp;<span class="ident" id="5603525">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603536">uop</span>&nbsp;<span class="op" id="5603540">=</span>&nbsp;<span class="ident" id="5603542">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603553">default</span><span class="op" id="5603560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5603564">panic</span><span class="op" id="5603569">(</span><span class="string" id="5603570">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="5603601">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603607">decOpTable</span><span class="op" id="5603617">[</span><span class="ident" id="5603618">reflect</span><span class="op" id="5603625">.</span><span class="ident" id="5603626">Int</span><span class="op" id="5603629">]</span>&nbsp;<span class="op" id="5603631">=</span>&nbsp;<span class="ident" id="5603633">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603638">decOpTable</span><span class="op" id="5603648">[</span><span class="ident" id="5603649">reflect</span><span class="op" id="5603656">.</span><span class="ident" id="5603657">Uint</span><span class="op" id="5603661">]</span>&nbsp;<span class="op" id="5603663">=</span>&nbsp;<span class="ident" id="5603665">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5603671">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603691">switch</span>&nbsp;<span class="ident" id="5603698">reflect</span><span class="op" id="5603705">.</span><span class="ident" id="5603706">TypeOf</span><span class="op" id="5603712">(</span><span class="builtintype" id="5603713">uintptr</span><span class="op" id="5603720">(</span><span class="num" id="5603721">0</span><span class="op" id="5603722">)</span><span class="op" id="5603723">)</span><span class="op" id="5603724">.</span><span class="ident" id="5603725">Bits</span><span class="op" id="5603729">(</span><span class="op" id="5603730">)</span>&nbsp;<span class="op" id="5603732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603735">case</span>&nbsp;<span class="num" id="5603740">32</span><span class="op" id="5603742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603746">uop</span>&nbsp;<span class="op" id="5603750">=</span>&nbsp;<span class="ident" id="5603752">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603763">case</span>&nbsp;<span class="num" id="5603768">64</span><span class="op" id="5603770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603774">uop</span>&nbsp;<span class="op" id="5603778">=</span>&nbsp;<span class="ident" id="5603780">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603791">default</span><span class="op" id="5603798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5603802">panic</span><span class="op" id="5603807">(</span><span class="string" id="5603808">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="5603838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603844">decOpTable</span><span class="op" id="5603854">[</span><span class="ident" id="5603855">reflect</span><span class="op" id="5603862">.</span><span class="ident" id="5603863">Uintptr</span><span class="op" id="5603870">]</span>&nbsp;<span class="op" id="5603872">=</span>&nbsp;<span class="ident" id="5603874">uop</span><br>
<span class="lineno"></span><span class="op" id="5603878">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="5603881">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="5603930">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5603990">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="5604023">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5604052">func</span>&nbsp;<span class="ident" id="5604057">allocValue</span><span class="op" id="5604067">(</span><span class="ident" id="5604068">t</span>&nbsp;<span class="ident" id="5604070">reflect</span><span class="op" id="5604077">.</span><span class="ident" id="5604078">Type</span><span class="op" id="5604082">)</span>&nbsp;<span class="ident" id="5604084">reflect</span><span class="op" id="5604091">.</span><span class="ident" id="5604092">Value</span>&nbsp;<span class="op" id="5604098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604101">return</span>&nbsp;<span class="ident" id="5604108">reflect</span><span class="op" id="5604115">.</span><span class="ident" id="5604116">New</span><span class="op" id="5604119">(</span><span class="ident" id="5604120">t</span><span class="op" id="5604121">)</span><span class="op" id="5604122">.</span><span class="ident" id="5604123">Elem</span><span class="op" id="5604127">(</span><span class="op" id="5604128">)</span><br>
<span class="lineno"></span><span class="op" id="5604130">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
