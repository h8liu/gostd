<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html" class="current">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8105149">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8105204">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8105258">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8105309">package</span>&nbsp;<span class="ident" id="8105317">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105324">import</span>&nbsp;<span class="op" id="8105331">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105334">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105345">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8105355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105358">type</span>&nbsp;<span class="ident" id="8105363">T</span>&nbsp;<span class="builtintype" id="8105365">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105370">func</span>&nbsp;<span class="op" id="8105375">(</span><span class="ident" id="8105376">t</span>&nbsp;<span class="op" id="8105378">*</span><span class="ident" id="8105379">T</span><span class="op" id="8105380">)</span>&nbsp;<span class="ident" id="8105382">ptrmethod</span><span class="op" id="8105391">(</span><span class="op" id="8105392">)</span>&nbsp;<span class="op" id="8105394">[</span><span class="op" id="8105395">]</span><span class="builtintype" id="8105396">byte</span>&nbsp;<span class="op" id="8105401">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8105404">return</span>&nbsp;<span class="ident" id="8105411">Stack</span><span class="op" id="8105416">(</span><span class="op" id="8105417">)</span><br>
<span class="lineno"></span><span class="op" id="8105419">}</span><br>
<span class="lineno"></span><span class="keyword" id="8105421">func</span>&nbsp;<span class="op" id="8105426">(</span><span class="ident" id="8105427">t</span>&nbsp;<span class="ident" id="8105429">T</span><span class="op" id="8105430">)</span>&nbsp;<span class="ident" id="8105432">method</span><span class="op" id="8105438">(</span><span class="op" id="8105439">)</span>&nbsp;<span class="op" id="8105441">[</span><span class="op" id="8105442">]</span><span class="builtintype" id="8105443">byte</span>&nbsp;<span class="op" id="8105448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8105451">return</span>&nbsp;<span class="ident" id="8105458">t</span><span class="op" id="8105459">.</span><span class="ident" id="8105460">ptrmethod</span><span class="op" id="8105469">(</span><span class="op" id="8105470">)</span><br>
<span class="lineno"></span><span class="op" id="8105472">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8105475">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Don&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8106088">func</span>&nbsp;<span class="ident" id="8106093">TestStack</span><span class="op" id="8106102">(</span><span class="ident" id="8106103">t</span>&nbsp;<span class="op" id="8106105">*</span><span class="ident" id="8106106">testing</span><span class="op" id="8106113">.</span><span class="ident" id="8106114">T</span><span class="op" id="8106115">)</span>&nbsp;<span class="op" id="8106117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106120">b</span>&nbsp;<span class="op" id="8106122">:=</span>&nbsp;<span class="ident" id="8106125">T</span><span class="op" id="8106126">(</span><span class="num" id="8106127">0</span><span class="op" id="8106128">)</span><span class="op" id="8106129">.</span><span class="ident" id="8106130">method</span><span class="op" id="8106136">(</span><span class="op" id="8106137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106140">lines</span>&nbsp;<span class="op" id="8106146">:=</span>&nbsp;<span class="ident" id="8106149">strings</span><span class="op" id="8106156">.</span><span class="ident" id="8106157">Split</span><span class="op" id="8106162">(</span><span class="builtintype" id="8106163">string</span><span class="op" id="8106169">(</span><span class="ident" id="8106170">b</span><span class="op" id="8106171">)</span><span class="op" id="8106172">,</span>&nbsp;<span class="string" id="8106174">&#34;\n&#34;</span><span class="op" id="8106178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8106181">if</span>&nbsp;<span class="builtinfunc" id="8106184">len</span><span class="op" id="8106187">(</span><span class="ident" id="8106188">lines</span><span class="op" id="8106193">)</span>&nbsp;<span class="op" id="8106195">&lt;</span>&nbsp;<span class="num" id="8106197">6</span>&nbsp;<span class="op" id="8106199">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106203">t</span><span class="op" id="8106204">.</span><span class="ident" id="8106205">Fatal</span><span class="op" id="8106210">(</span><span class="string" id="8106211">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8106226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106232">n</span>&nbsp;<span class="op" id="8106234">:=</span>&nbsp;<span class="num" id="8106237">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106240">frame</span>&nbsp;<span class="op" id="8106246">:=</span>&nbsp;<span class="keyword" id="8106249">func</span><span class="op" id="8106253">(</span><span class="ident" id="8106254">line</span><span class="op" id="8106258">,</span>&nbsp;<span class="ident" id="8106260">code</span>&nbsp;<span class="builtintype" id="8106265">string</span><span class="op" id="8106271">)</span>&nbsp;<span class="op" id="8106273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106277">check</span><span class="op" id="8106282">(</span><span class="ident" id="8106283">t</span><span class="op" id="8106284">,</span>&nbsp;<span class="ident" id="8106286">lines</span><span class="op" id="8106291">[</span><span class="ident" id="8106292">n</span><span class="op" id="8106293">]</span><span class="op" id="8106294">,</span>&nbsp;<span class="ident" id="8106296">line</span><span class="op" id="8106300">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106304">n</span><span class="op" id="8106305">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8106310">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8106373">if</span>&nbsp;<span class="ident" id="8106376">strings</span><span class="op" id="8106383">.</span><span class="ident" id="8106384">HasPrefix</span><span class="op" id="8106393">(</span><span class="ident" id="8106394">lines</span><span class="op" id="8106399">[</span><span class="ident" id="8106400">n</span><span class="op" id="8106401">]</span><span class="op" id="8106402">,</span>&nbsp;<span class="string" id="8106404">&#34;\t&#34;</span><span class="op" id="8106408">)</span>&nbsp;<span class="op" id="8106410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106415">check</span><span class="op" id="8106420">(</span><span class="ident" id="8106421">t</span><span class="op" id="8106422">,</span>&nbsp;<span class="ident" id="8106424">lines</span><span class="op" id="8106429">[</span><span class="ident" id="8106430">n</span><span class="op" id="8106431">]</span><span class="op" id="8106432">,</span>&nbsp;<span class="ident" id="8106434">code</span><span class="op" id="8106438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106443">n</span><span class="op" id="8106444">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106455">frame</span><span class="op" id="8106460">(</span><span class="string" id="8106461">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8106494">,</span>&nbsp;<span class="string" id="8106496">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8106530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106533">frame</span><span class="op" id="8106538">(</span><span class="string" id="8106539">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8106572">,</span>&nbsp;<span class="string" id="8106574">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8106608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106611">frame</span><span class="op" id="8106616">(</span><span class="string" id="8106617">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8106650">,</span>&nbsp;<span class="string" id="8106652">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8106685">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106688">frame</span><span class="op" id="8106693">(</span><span class="string" id="8106694">&#34;src/testing/testing.go&#34;</span><span class="op" id="8106718">,</span>&nbsp;<span class="string" id="8106720">&#34;&#34;</span><span class="op" id="8106722">)</span><br>
<span class="lineno"></span><span class="op" id="8106724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8106727">func</span>&nbsp;<span class="ident" id="8106732">check</span><span class="op" id="8106737">(</span><span class="ident" id="8106738">t</span>&nbsp;<span class="op" id="8106740">*</span><span class="ident" id="8106741">testing</span><span class="op" id="8106748">.</span><span class="ident" id="8106749">T</span><span class="op" id="8106750">,</span>&nbsp;<span class="ident" id="8106752">line</span><span class="op" id="8106756">,</span>&nbsp;<span class="ident" id="8106758">has</span>&nbsp;<span class="builtintype" id="8106762">string</span><span class="op" id="8106768">)</span>&nbsp;<span class="op" id="8106770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8106773">if</span>&nbsp;<span class="ident" id="8106776">strings</span><span class="op" id="8106783">.</span><span class="ident" id="8106784">Index</span><span class="op" id="8106789">(</span><span class="ident" id="8106790">line</span><span class="op" id="8106794">,</span>&nbsp;<span class="ident" id="8106796">has</span><span class="op" id="8106799">)</span>&nbsp;<span class="op" id="8106801">&lt;</span>&nbsp;<span class="num" id="8106803">0</span>&nbsp;<span class="op" id="8106805">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8106809">t</span><span class="op" id="8106810">.</span><span class="ident" id="8106811">Errorf</span><span class="op" id="8106817">(</span><span class="string" id="8106818">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8106837">,</span>&nbsp;<span class="ident" id="8106839">has</span><span class="op" id="8106842">,</span>&nbsp;<span class="ident" id="8106844">line</span><span class="op" id="8106848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106851">}</span><br>
<span class="lineno"></span><span class="op" id="8106853">}</span>
</div>
</body>
</html>
