<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8179698">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8179753">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8179807">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8179858">package</span>&nbsp;<span class="ident" id="8179866">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8179871">import</span>&nbsp;<span class="op" id="8179878">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179881">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179890">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179906">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179925">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179939">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179955">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179971">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179981">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179988">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8179994">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180006">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180013">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180019">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180030">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180047">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180058">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8180069">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="8180076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8180079">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8180157">type</span>&nbsp;<span class="ident" id="8180162">zeroSource</span>&nbsp;<span class="keyword" id="8180173">struct</span><span class="op" id="8180179">{</span><span class="op" id="8180180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8180183">func</span>&nbsp;<span class="op" id="8180188">(</span><span class="ident" id="8180189">zeroSource</span><span class="op" id="8180199">)</span>&nbsp;<span class="ident" id="8180201">Read</span><span class="op" id="8180205">(</span><span class="ident" id="8180206">b</span>&nbsp;<span class="op" id="8180208">[</span><span class="op" id="8180209">]</span><span class="builtintype" id="8180210">byte</span><span class="op" id="8180214">)</span>&nbsp;<span class="op" id="8180216">(</span><span class="ident" id="8180217">n</span>&nbsp;<span class="builtintype" id="8180219">int</span><span class="op" id="8180222">,</span>&nbsp;<span class="ident" id="8180224">err</span>&nbsp;<span class="builtintype" id="8180228">error</span><span class="op" id="8180233">)</span>&nbsp;<span class="op" id="8180235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180238">for</span>&nbsp;<span class="ident" id="8180242">i</span>&nbsp;<span class="op" id="8180244">:=</span>&nbsp;<span class="keyword" id="8180247">range</span>&nbsp;<span class="ident" id="8180253">b</span>&nbsp;<span class="op" id="8180255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180259">b</span><span class="op" id="8180260">[</span><span class="ident" id="8180261">i</span><span class="op" id="8180262">]</span>&nbsp;<span class="op" id="8180264">=</span>&nbsp;<span class="num" id="8180266">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180273">return</span>&nbsp;<span class="builtinfunc" id="8180280">len</span><span class="op" id="8180283">(</span><span class="ident" id="8180284">b</span><span class="op" id="8180285">)</span><span class="op" id="8180286">,</span>&nbsp;<span class="ident" id="8180288">nil</span><br>
<span class="lineno"></span><span class="op" id="8180292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8180295">var</span>&nbsp;<span class="ident" id="8180299">testConfig</span>&nbsp;<span class="op" id="8180310">*</span><span class="ident" id="8180311">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8180319">func</span>&nbsp;<span class="ident" id="8180324">init</span><span class="op" id="8180328">(</span><span class="op" id="8180329">)</span>&nbsp;<span class="op" id="8180331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180334">testConfig</span>&nbsp;<span class="op" id="8180345">=</span>&nbsp;<span class="op" id="8180347">&amp;</span><span class="ident" id="8180348">Config</span><span class="op" id="8180354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180358">Time</span><span class="op" id="8180362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8180378">func</span><span class="op" id="8180382">(</span><span class="op" id="8180383">)</span>&nbsp;<span class="ident" id="8180385">time</span><span class="op" id="8180389">.</span><span class="ident" id="8180390">Time</span>&nbsp;<span class="op" id="8180395">{</span>&nbsp;<span class="keyword" id="8180397">return</span>&nbsp;<span class="ident" id="8180404">time</span><span class="op" id="8180408">.</span><span class="ident" id="8180409">Unix</span><span class="op" id="8180413">(</span><span class="num" id="8180414">0</span><span class="op" id="8180415">,</span>&nbsp;<span class="num" id="8180417">0</span><span class="op" id="8180418">)</span>&nbsp;<span class="op" id="8180420">}</span><span class="op" id="8180421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180425">Rand</span><span class="op" id="8180429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8180445">zeroSource</span><span class="op" id="8180455">{</span><span class="op" id="8180456">}</span><span class="op" id="8180457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180461">Certificates</span><span class="op" id="8180473">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8180481">make</span><span class="op" id="8180485">(</span><span class="op" id="8180486">[</span><span class="op" id="8180487">]</span><span class="ident" id="8180488">Certificate</span><span class="op" id="8180499">,</span>&nbsp;<span class="num" id="8180501">2</span><span class="op" id="8180502">)</span><span class="op" id="8180503">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180507">InsecureSkipVerify</span><span class="op" id="8180525">:</span>&nbsp;<span class="builtintype" id="8180527">true</span><span class="op" id="8180531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180535">MinVersion</span><span class="op" id="8180545">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8180555">VersionSSL30</span><span class="op" id="8180567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180571">MaxVersion</span><span class="op" id="8180581">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8180591">VersionTLS12</span><span class="op" id="8180603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180609">testConfig</span><span class="op" id="8180619">.</span><span class="ident" id="8180620">Certificates</span><span class="op" id="8180632">[</span><span class="num" id="8180633">0</span><span class="op" id="8180634">]</span><span class="op" id="8180635">.</span><span class="ident" id="8180636">Certificate</span>&nbsp;<span class="op" id="8180648">=</span>&nbsp;<span class="op" id="8180650">[</span><span class="op" id="8180651">]</span><span class="op" id="8180652">[</span><span class="op" id="8180653">]</span><span class="builtintype" id="8180654">byte</span><span class="op" id="8180658">{</span><span class="ident" id="8180659">testRSACertificate</span><span class="op" id="8180677">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180680">testConfig</span><span class="op" id="8180690">.</span><span class="ident" id="8180691">Certificates</span><span class="op" id="8180703">[</span><span class="num" id="8180704">0</span><span class="op" id="8180705">]</span><span class="op" id="8180706">.</span><span class="ident" id="8180707">PrivateKey</span>&nbsp;<span class="op" id="8180718">=</span>&nbsp;<span class="ident" id="8180720">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180739">testConfig</span><span class="op" id="8180749">.</span><span class="ident" id="8180750">Certificates</span><span class="op" id="8180762">[</span><span class="num" id="8180763">1</span><span class="op" id="8180764">]</span><span class="op" id="8180765">.</span><span class="ident" id="8180766">Certificate</span>&nbsp;<span class="op" id="8180778">=</span>&nbsp;<span class="op" id="8180780">[</span><span class="op" id="8180781">]</span><span class="op" id="8180782">[</span><span class="op" id="8180783">]</span><span class="builtintype" id="8180784">byte</span><span class="op" id="8180788">{</span><span class="ident" id="8180789">testSNICertificate</span><span class="op" id="8180807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180810">testConfig</span><span class="op" id="8180820">.</span><span class="ident" id="8180821">Certificates</span><span class="op" id="8180833">[</span><span class="num" id="8180834">1</span><span class="op" id="8180835">]</span><span class="op" id="8180836">.</span><span class="ident" id="8180837">PrivateKey</span>&nbsp;<span class="op" id="8180848">=</span>&nbsp;<span class="ident" id="8180850">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180869">testConfig</span><span class="op" id="8180879">.</span><span class="ident" id="8180880">BuildNameToCertificate</span><span class="op" id="8180902">(</span><span class="op" id="8180903">)</span><br>
<span class="lineno"></span><span class="op" id="8180905">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8180908">func</span>&nbsp;<span class="ident" id="8180913">testClientHelloFailure</span><span class="op" id="8180935">(</span><span class="ident" id="8180936">t</span>&nbsp;<span class="op" id="8180938">*</span><span class="ident" id="8180939">testing</span><span class="op" id="8180946">.</span><span class="ident" id="8180947">T</span><span class="op" id="8180948">,</span>&nbsp;<span class="ident" id="8180950">m</span>&nbsp;<span class="ident" id="8180952">handshakeMessage</span><span class="op" id="8180968">,</span>&nbsp;<span class="ident" id="8180970">expectedSubStr</span>&nbsp;<span class="builtintype" id="8180985">string</span><span class="op" id="8180991">)</span>&nbsp;<span class="op" id="8180993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8180996">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181037">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181080">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181100">c</span><span class="op" id="8181101">,</span>&nbsp;<span class="ident" id="8181103">s</span>&nbsp;<span class="op" id="8181105">:=</span>&nbsp;<span class="ident" id="8181108">net</span><span class="op" id="8181111">.</span><span class="ident" id="8181112">Pipe</span><span class="op" id="8181116">(</span><span class="op" id="8181117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181120">go</span>&nbsp;<span class="keyword" id="8181123">func</span><span class="op" id="8181127">(</span><span class="op" id="8181128">)</span>&nbsp;<span class="op" id="8181130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181134">cli</span>&nbsp;<span class="op" id="8181138">:=</span>&nbsp;<span class="ident" id="8181141">Client</span><span class="op" id="8181147">(</span><span class="ident" id="8181148">c</span><span class="op" id="8181149">,</span>&nbsp;<span class="ident" id="8181151">testConfig</span><span class="op" id="8181161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181165">if</span>&nbsp;<span class="ident" id="8181168">ch</span><span class="op" id="8181170">,</span>&nbsp;<span class="ident" id="8181172">ok</span>&nbsp;<span class="op" id="8181175">:=</span>&nbsp;<span class="ident" id="8181178">m</span><span class="op" id="8181179">.</span><span class="op" id="8181180">(</span><span class="op" id="8181181">*</span><span class="ident" id="8181182">clientHelloMsg</span><span class="op" id="8181196">)</span><span class="op" id="8181197">;</span>&nbsp;<span class="ident" id="8181199">ok</span>&nbsp;<span class="op" id="8181202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181207">cli</span><span class="op" id="8181210">.</span><span class="ident" id="8181211">vers</span>&nbsp;<span class="op" id="8181216">=</span>&nbsp;<span class="ident" id="8181218">ch</span><span class="op" id="8181220">.</span><span class="ident" id="8181221">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181232">cli</span><span class="op" id="8181235">.</span><span class="ident" id="8181236">writeRecord</span><span class="op" id="8181247">(</span><span class="ident" id="8181248">recordTypeHandshake</span><span class="op" id="8181267">,</span>&nbsp;<span class="ident" id="8181269">m</span><span class="op" id="8181270">.</span><span class="ident" id="8181271">marshal</span><span class="op" id="8181278">(</span><span class="op" id="8181279">)</span><span class="op" id="8181280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181284">c</span><span class="op" id="8181285">.</span><span class="ident" id="8181286">Close</span><span class="op" id="8181291">(</span><span class="op" id="8181292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181295">}</span><span class="op" id="8181296">(</span><span class="op" id="8181297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181300">err</span>&nbsp;<span class="op" id="8181304">:=</span>&nbsp;<span class="ident" id="8181307">Server</span><span class="op" id="8181313">(</span><span class="ident" id="8181314">s</span><span class="op" id="8181315">,</span>&nbsp;<span class="ident" id="8181317">testConfig</span><span class="op" id="8181327">)</span><span class="op" id="8181328">.</span><span class="ident" id="8181329">Handshake</span><span class="op" id="8181338">(</span><span class="op" id="8181339">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181342">s</span><span class="op" id="8181343">.</span><span class="ident" id="8181344">Close</span><span class="op" id="8181349">(</span><span class="op" id="8181350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181353">if</span>&nbsp;<span class="ident" id="8181356">err</span>&nbsp;<span class="op" id="8181360">==</span>&nbsp;<span class="ident" id="8181363">nil</span>&nbsp;<span class="op" id="8181367">||</span>&nbsp;<span class="op" id="8181370">!</span><span class="ident" id="8181371">strings</span><span class="op" id="8181378">.</span><span class="ident" id="8181379">Contains</span><span class="op" id="8181387">(</span><span class="ident" id="8181388">err</span><span class="op" id="8181391">.</span><span class="ident" id="8181392">Error</span><span class="op" id="8181397">(</span><span class="op" id="8181398">)</span><span class="op" id="8181399">,</span>&nbsp;<span class="ident" id="8181401">expectedSubStr</span><span class="op" id="8181415">)</span>&nbsp;<span class="op" id="8181417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181421">t</span><span class="op" id="8181422">.</span><span class="ident" id="8181423">Errorf</span><span class="op" id="8181429">(</span><span class="string" id="8181430">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8181479">,</span>&nbsp;<span class="ident" id="8181481">err</span><span class="op" id="8181484">,</span>&nbsp;<span class="ident" id="8181486">expectedSubStr</span><span class="op" id="8181500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181503">}</span><br>
<span class="lineno"></span><span class="op" id="8181505">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8181508">func</span>&nbsp;<span class="ident" id="8181513">TestSimpleError</span><span class="op" id="8181528">(</span><span class="ident" id="8181529">t</span>&nbsp;<span class="op" id="8181531">*</span><span class="ident" id="8181532">testing</span><span class="op" id="8181539">.</span><span class="ident" id="8181540">T</span><span class="op" id="8181541">)</span>&nbsp;<span class="op" id="8181543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181546">testClientHelloFailure</span><span class="op" id="8181568">(</span><span class="ident" id="8181569">t</span><span class="op" id="8181570">,</span>&nbsp;<span class="op" id="8181572">&amp;</span><span class="ident" id="8181573">serverHelloDoneMsg</span><span class="op" id="8181591">{</span><span class="op" id="8181592">}</span><span class="op" id="8181593">,</span>&nbsp;<span class="string" id="8181595">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="8181625">)</span><br>
<span class="lineno"></span><span class="op" id="8181627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8181630">var</span>&nbsp;<span class="ident" id="8181634">badProtocolVersions</span>&nbsp;<span class="op" id="8181654">=</span>&nbsp;<span class="op" id="8181656">[</span><span class="op" id="8181657">]</span><span class="builtintype" id="8181658">uint16</span><span class="op" id="8181664">{</span><span class="num" id="8181665">0x0000</span><span class="op" id="8181671">,</span>&nbsp;<span class="num" id="8181673">0x0005</span><span class="op" id="8181679">,</span>&nbsp;<span class="num" id="8181681">0x0100</span><span class="op" id="8181687">,</span>&nbsp;<span class="num" id="8181689">0x0105</span><span class="op" id="8181695">,</span>&nbsp;<span class="num" id="8181697">0x0200</span><span class="op" id="8181703">,</span>&nbsp;<span class="num" id="8181705">0x0205</span><span class="op" id="8181711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8181714">func</span>&nbsp;<span class="ident" id="8181719">TestRejectBadProtocolVersion</span><span class="op" id="8181747">(</span><span class="ident" id="8181748">t</span>&nbsp;<span class="op" id="8181750">*</span><span class="ident" id="8181751">testing</span><span class="op" id="8181758">.</span><span class="ident" id="8181759">T</span><span class="op" id="8181760">)</span>&nbsp;<span class="op" id="8181762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181765">for</span>&nbsp;<span class="ident" id="8181769">_</span><span class="op" id="8181770">,</span>&nbsp;<span class="ident" id="8181772">v</span>&nbsp;<span class="op" id="8181774">:=</span>&nbsp;<span class="keyword" id="8181777">range</span>&nbsp;<span class="ident" id="8181783">badProtocolVersions</span>&nbsp;<span class="op" id="8181803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181807">testClientHelloFailure</span><span class="op" id="8181829">(</span><span class="ident" id="8181830">t</span><span class="op" id="8181831">,</span>&nbsp;<span class="op" id="8181833">&amp;</span><span class="ident" id="8181834">clientHelloMsg</span><span class="op" id="8181848">{</span><span class="ident" id="8181849">vers</span><span class="op" id="8181853">:</span>&nbsp;<span class="ident" id="8181855">v</span><span class="op" id="8181856">}</span><span class="op" id="8181857">,</span>&nbsp;<span class="string" id="8181859">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="8181898">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181901">}</span><br>
<span class="lineno"></span><span class="op" id="8181903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8181906">func</span>&nbsp;<span class="ident" id="8181911">TestNoSuiteOverlap</span><span class="op" id="8181929">(</span><span class="ident" id="8181930">t</span>&nbsp;<span class="op" id="8181932">*</span><span class="ident" id="8181933">testing</span><span class="op" id="8181940">.</span><span class="ident" id="8181941">T</span><span class="op" id="8181942">)</span>&nbsp;<span class="op" id="8181944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181947">clientHello</span>&nbsp;<span class="op" id="8181959">:=</span>&nbsp;<span class="op" id="8181962">&amp;</span><span class="ident" id="8181963">clientHelloMsg</span><span class="op" id="8181977">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181981">vers</span><span class="op" id="8181985">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8182001">0x0301</span><span class="op" id="8182007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182011">cipherSuites</span><span class="op" id="8182023">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8182031">[</span><span class="op" id="8182032">]</span><span class="builtintype" id="8182033">uint16</span><span class="op" id="8182039">{</span><span class="num" id="8182040">0xff00</span><span class="op" id="8182046">}</span><span class="op" id="8182047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182051">compressionMethods</span><span class="op" id="8182069">:</span>&nbsp;<span class="op" id="8182071">[</span><span class="op" id="8182072">]</span><span class="builtintype" id="8182073">uint8</span><span class="op" id="8182078">{</span><span class="num" id="8182079">0</span><span class="op" id="8182080">}</span><span class="op" id="8182081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182087">testClientHelloFailure</span><span class="op" id="8182109">(</span><span class="ident" id="8182110">t</span><span class="op" id="8182111">,</span>&nbsp;<span class="ident" id="8182113">clientHello</span><span class="op" id="8182124">,</span>&nbsp;<span class="string" id="8182126">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="8182179">)</span><br>
<span class="lineno">95</span><span class="op" id="8182181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8182184">func</span>&nbsp;<span class="ident" id="8182189">TestNoCompressionOverlap</span><span class="op" id="8182213">(</span><span class="ident" id="8182214">t</span>&nbsp;<span class="op" id="8182216">*</span><span class="ident" id="8182217">testing</span><span class="op" id="8182224">.</span><span class="ident" id="8182225">T</span><span class="op" id="8182226">)</span>&nbsp;<span class="op" id="8182228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182231">clientHello</span>&nbsp;<span class="op" id="8182243">:=</span>&nbsp;<span class="op" id="8182246">&amp;</span><span class="ident" id="8182247">clientHelloMsg</span><span class="op" id="8182261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182265">vers</span><span class="op" id="8182269">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8182285">0x0301</span><span class="op" id="8182291">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182295">cipherSuites</span><span class="op" id="8182307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8182315">[</span><span class="op" id="8182316">]</span><span class="builtintype" id="8182317">uint16</span><span class="op" id="8182323">{</span><span class="ident" id="8182324">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8182348">}</span><span class="op" id="8182349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182353">compressionMethods</span><span class="op" id="8182371">:</span>&nbsp;<span class="op" id="8182373">[</span><span class="op" id="8182374">]</span><span class="builtintype" id="8182375">uint8</span><span class="op" id="8182380">{</span><span class="num" id="8182381">0xff</span><span class="op" id="8182385">}</span><span class="op" id="8182386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182392">testClientHelloFailure</span><span class="op" id="8182414">(</span><span class="ident" id="8182415">t</span><span class="op" id="8182416">,</span>&nbsp;<span class="ident" id="8182418">clientHello</span><span class="op" id="8182429">,</span>&nbsp;<span class="string" id="8182431">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="8182481">)</span><br>
<span class="lineno"></span><span class="op" id="8182483">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8182486">func</span>&nbsp;<span class="ident" id="8182491">TestTLS12OnlyCipherSuites</span><span class="op" id="8182516">(</span><span class="ident" id="8182517">t</span>&nbsp;<span class="op" id="8182519">*</span><span class="ident" id="8182520">testing</span><span class="op" id="8182527">.</span><span class="ident" id="8182528">T</span><span class="op" id="8182529">)</span>&nbsp;<span class="op" id="8182531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182534">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182605">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182640">var</span>&nbsp;<span class="ident" id="8182644">zeros</span>&nbsp;<span class="op" id="8182650">[</span><span class="num" id="8182651">32</span><span class="op" id="8182653">]</span><span class="builtintype" id="8182654">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182661">clientHello</span>&nbsp;<span class="op" id="8182673">:=</span>&nbsp;<span class="op" id="8182676">&amp;</span><span class="ident" id="8182677">clientHelloMsg</span><span class="op" id="8182691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182695">vers</span><span class="op" id="8182699">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8182703">VersionTLS11</span><span class="op" id="8182715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182719">random</span><span class="op" id="8182725">:</span>&nbsp;<span class="ident" id="8182727">zeros</span><span class="op" id="8182732">[</span><span class="op" id="8182733">:</span><span class="op" id="8182734">]</span><span class="op" id="8182735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182739">cipherSuites</span><span class="op" id="8182751">:</span>&nbsp;<span class="op" id="8182753">[</span><span class="op" id="8182754">]</span><span class="builtintype" id="8182755">uint16</span><span class="op" id="8182761">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182766">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182818">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182866">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182918">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182960">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="8182997">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183002">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8183026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183030">}</span><span class="op" id="8183031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183035">compressionMethods</span><span class="op" id="8183053">:</span>&nbsp;<span class="op" id="8183055">[</span><span class="op" id="8183056">]</span><span class="builtintype" id="8183057">uint8</span><span class="op" id="8183062">{</span><span class="ident" id="8183063">compressionNone</span><span class="op" id="8183078">}</span><span class="op" id="8183079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183083">supportedCurves</span><span class="op" id="8183098">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8183103">[</span><span class="op" id="8183104">]</span><span class="ident" id="8183105">CurveID</span><span class="op" id="8183112">{</span><span class="ident" id="8183113">CurveP256</span><span class="op" id="8183122">,</span>&nbsp;<span class="ident" id="8183124">CurveP384</span><span class="op" id="8183133">,</span>&nbsp;<span class="ident" id="8183135">CurveP521</span><span class="op" id="8183144">}</span><span class="op" id="8183145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183149">supportedPoints</span><span class="op" id="8183164">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8183169">[</span><span class="op" id="8183170">]</span><span class="builtintype" id="8183171">uint8</span><span class="op" id="8183176">{</span><span class="ident" id="8183177">pointFormatUncompressed</span><span class="op" id="8183200">}</span><span class="op" id="8183201">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183208">c</span><span class="op" id="8183209">,</span>&nbsp;<span class="ident" id="8183211">s</span>&nbsp;<span class="op" id="8183213">:=</span>&nbsp;<span class="ident" id="8183216">net</span><span class="op" id="8183219">.</span><span class="ident" id="8183220">Pipe</span><span class="op" id="8183224">(</span><span class="op" id="8183225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183228">var</span>&nbsp;<span class="ident" id="8183232">reply</span>&nbsp;<span class="keyword" id="8183238">interface</span><span class="op" id="8183247">{</span><span class="op" id="8183248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183251">var</span>&nbsp;<span class="ident" id="8183255">clientErr</span>&nbsp;<span class="builtintype" id="8183265">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183272">go</span>&nbsp;<span class="keyword" id="8183275">func</span><span class="op" id="8183279">(</span><span class="op" id="8183280">)</span>&nbsp;<span class="op" id="8183282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183286">cli</span>&nbsp;<span class="op" id="8183290">:=</span>&nbsp;<span class="ident" id="8183293">Client</span><span class="op" id="8183299">(</span><span class="ident" id="8183300">c</span><span class="op" id="8183301">,</span>&nbsp;<span class="ident" id="8183303">testConfig</span><span class="op" id="8183313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183317">cli</span><span class="op" id="8183320">.</span><span class="ident" id="8183321">vers</span>&nbsp;<span class="op" id="8183326">=</span>&nbsp;<span class="ident" id="8183328">clientHello</span><span class="op" id="8183339">.</span><span class="ident" id="8183340">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183347">cli</span><span class="op" id="8183350">.</span><span class="ident" id="8183351">writeRecord</span><span class="op" id="8183362">(</span><span class="ident" id="8183363">recordTypeHandshake</span><span class="op" id="8183382">,</span>&nbsp;<span class="ident" id="8183384">clientHello</span><span class="op" id="8183395">.</span><span class="ident" id="8183396">marshal</span><span class="op" id="8183403">(</span><span class="op" id="8183404">)</span><span class="op" id="8183405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183409">reply</span><span class="op" id="8183414">,</span>&nbsp;<span class="ident" id="8183416">clientErr</span>&nbsp;<span class="op" id="8183426">=</span>&nbsp;<span class="ident" id="8183428">cli</span><span class="op" id="8183431">.</span><span class="ident" id="8183432">readHandshake</span><span class="op" id="8183445">(</span><span class="op" id="8183446">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183450">c</span><span class="op" id="8183451">.</span><span class="ident" id="8183452">Close</span><span class="op" id="8183457">(</span><span class="op" id="8183458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183461">}</span><span class="op" id="8183462">(</span><span class="op" id="8183463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183466">config</span>&nbsp;<span class="op" id="8183473">:=</span>&nbsp;<span class="op" id="8183476">*</span><span class="ident" id="8183477">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183489">config</span><span class="op" id="8183495">.</span><span class="ident" id="8183496">CipherSuites</span>&nbsp;<span class="op" id="8183509">=</span>&nbsp;<span class="ident" id="8183511">clientHello</span><span class="op" id="8183522">.</span><span class="ident" id="8183523">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183537">Server</span><span class="op" id="8183543">(</span><span class="ident" id="8183544">s</span><span class="op" id="8183545">,</span>&nbsp;<span class="op" id="8183547">&amp;</span><span class="ident" id="8183548">config</span><span class="op" id="8183554">)</span><span class="op" id="8183555">.</span><span class="ident" id="8183556">Handshake</span><span class="op" id="8183565">(</span><span class="op" id="8183566">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183569">s</span><span class="op" id="8183570">.</span><span class="ident" id="8183571">Close</span><span class="op" id="8183576">(</span><span class="op" id="8183577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183580">if</span>&nbsp;<span class="ident" id="8183583">clientErr</span>&nbsp;<span class="op" id="8183593">!=</span>&nbsp;<span class="ident" id="8183596">nil</span>&nbsp;<span class="op" id="8183600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183604">t</span><span class="op" id="8183605">.</span><span class="ident" id="8183606">Fatal</span><span class="op" id="8183611">(</span><span class="ident" id="8183612">clientErr</span><span class="op" id="8183621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183627">serverHello</span><span class="op" id="8183638">,</span>&nbsp;<span class="ident" id="8183640">ok</span>&nbsp;<span class="op" id="8183643">:=</span>&nbsp;<span class="ident" id="8183646">reply</span><span class="op" id="8183651">.</span><span class="op" id="8183652">(</span><span class="op" id="8183653">*</span><span class="ident" id="8183654">serverHelloMsg</span><span class="op" id="8183668">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183671">if</span>&nbsp;<span class="op" id="8183674">!</span><span class="ident" id="8183675">ok</span>&nbsp;<span class="op" id="8183678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183682">t</span><span class="op" id="8183683">.</span><span class="ident" id="8183684">Fatalf</span><span class="op" id="8183690">(</span><span class="string" id="8183691">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="8183742">,</span>&nbsp;<span class="ident" id="8183744">reply</span><span class="op" id="8183749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183755">if</span>&nbsp;<span class="ident" id="8183758">s</span>&nbsp;<span class="op" id="8183760">:=</span>&nbsp;<span class="ident" id="8183763">serverHello</span><span class="op" id="8183774">.</span><span class="ident" id="8183775">cipherSuite</span><span class="op" id="8183786">;</span>&nbsp;<span class="ident" id="8183788">s</span>&nbsp;<span class="op" id="8183790">!=</span>&nbsp;<span class="ident" id="8183793">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8183818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183822">t</span><span class="op" id="8183823">.</span><span class="ident" id="8183824">Fatalf</span><span class="op" id="8183830">(</span><span class="string" id="8183831">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="8183865">,</span>&nbsp;<span class="ident" id="8183867">s</span><span class="op" id="8183868">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183871">}</span><br>
<span class="lineno"></span><span class="op" id="8183873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8183876">func</span>&nbsp;<span class="ident" id="8183881">TestAlertForwarding</span><span class="op" id="8183900">(</span><span class="ident" id="8183901">t</span>&nbsp;<span class="op" id="8183903">*</span><span class="ident" id="8183904">testing</span><span class="op" id="8183911">.</span><span class="ident" id="8183912">T</span><span class="op" id="8183913">)</span>&nbsp;<span class="op" id="8183915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183918">c</span><span class="op" id="8183919">,</span>&nbsp;<span class="ident" id="8183921">s</span>&nbsp;<span class="op" id="8183923">:=</span>&nbsp;<span class="ident" id="8183926">net</span><span class="op" id="8183929">.</span><span class="ident" id="8183930">Pipe</span><span class="op" id="8183934">(</span><span class="op" id="8183935">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183938">go</span>&nbsp;<span class="keyword" id="8183941">func</span><span class="op" id="8183945">(</span><span class="op" id="8183946">)</span>&nbsp;<span class="op" id="8183948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183952">Client</span><span class="op" id="8183958">(</span><span class="ident" id="8183959">c</span><span class="op" id="8183960">,</span>&nbsp;<span class="ident" id="8183962">testConfig</span><span class="op" id="8183972">)</span><span class="op" id="8183973">.</span><span class="ident" id="8183974">sendAlert</span><span class="op" id="8183983">(</span><span class="ident" id="8183984">alertUnknownCA</span><span class="op" id="8183998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184002">c</span><span class="op" id="8184003">.</span><span class="ident" id="8184004">Close</span><span class="op" id="8184009">(</span><span class="op" id="8184010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184013">}</span><span class="op" id="8184014">(</span><span class="op" id="8184015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184019">err</span>&nbsp;<span class="op" id="8184023">:=</span>&nbsp;<span class="ident" id="8184026">Server</span><span class="op" id="8184032">(</span><span class="ident" id="8184033">s</span><span class="op" id="8184034">,</span>&nbsp;<span class="ident" id="8184036">testConfig</span><span class="op" id="8184046">)</span><span class="op" id="8184047">.</span><span class="ident" id="8184048">Handshake</span><span class="op" id="8184057">(</span><span class="op" id="8184058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184061">s</span><span class="op" id="8184062">.</span><span class="ident" id="8184063">Close</span><span class="op" id="8184068">(</span><span class="op" id="8184069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184072">if</span>&nbsp;<span class="ident" id="8184075">e</span><span class="op" id="8184076">,</span>&nbsp;<span class="ident" id="8184078">ok</span>&nbsp;<span class="op" id="8184081">:=</span>&nbsp;<span class="ident" id="8184084">err</span><span class="op" id="8184087">.</span><span class="op" id="8184088">(</span><span class="op" id="8184089">*</span><span class="ident" id="8184090">net</span><span class="op" id="8184093">.</span><span class="ident" id="8184094">OpError</span><span class="op" id="8184101">)</span><span class="op" id="8184102">;</span>&nbsp;<span class="op" id="8184104">!</span><span class="ident" id="8184105">ok</span>&nbsp;<span class="op" id="8184108">||</span>&nbsp;<span class="ident" id="8184111">e</span><span class="op" id="8184112">.</span><span class="ident" id="8184113">Err</span>&nbsp;<span class="op" id="8184117">!=</span>&nbsp;<span class="builtintype" id="8184120">error</span><span class="op" id="8184125">(</span><span class="ident" id="8184126">alertUnknownCA</span><span class="op" id="8184140">)</span>&nbsp;<span class="op" id="8184142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184146">t</span><span class="op" id="8184147">.</span><span class="ident" id="8184148">Errorf</span><span class="op" id="8184154">(</span><span class="string" id="8184155">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8184184">,</span>&nbsp;<span class="ident" id="8184186">err</span><span class="op" id="8184189">,</span>&nbsp;<span class="builtintype" id="8184191">error</span><span class="op" id="8184196">(</span><span class="ident" id="8184197">alertUnknownCA</span><span class="op" id="8184211">)</span><span class="op" id="8184212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184215">}</span><br>
<span class="lineno">165</span><span class="op" id="8184217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184220">func</span>&nbsp;<span class="ident" id="8184225">TestClose</span><span class="op" id="8184234">(</span><span class="ident" id="8184235">t</span>&nbsp;<span class="op" id="8184237">*</span><span class="ident" id="8184238">testing</span><span class="op" id="8184245">.</span><span class="ident" id="8184246">T</span><span class="op" id="8184247">)</span>&nbsp;<span class="op" id="8184249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184252">c</span><span class="op" id="8184253">,</span>&nbsp;<span class="ident" id="8184255">s</span>&nbsp;<span class="op" id="8184257">:=</span>&nbsp;<span class="ident" id="8184260">net</span><span class="op" id="8184263">.</span><span class="ident" id="8184264">Pipe</span><span class="op" id="8184268">(</span><span class="op" id="8184269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184272">go</span>&nbsp;<span class="ident" id="8184275">c</span><span class="op" id="8184276">.</span><span class="ident" id="8184277">Close</span><span class="op" id="8184282">(</span><span class="op" id="8184283">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184287">err</span>&nbsp;<span class="op" id="8184291">:=</span>&nbsp;<span class="ident" id="8184294">Server</span><span class="op" id="8184300">(</span><span class="ident" id="8184301">s</span><span class="op" id="8184302">,</span>&nbsp;<span class="ident" id="8184304">testConfig</span><span class="op" id="8184314">)</span><span class="op" id="8184315">.</span><span class="ident" id="8184316">Handshake</span><span class="op" id="8184325">(</span><span class="op" id="8184326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184329">s</span><span class="op" id="8184330">.</span><span class="ident" id="8184331">Close</span><span class="op" id="8184336">(</span><span class="op" id="8184337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184340">if</span>&nbsp;<span class="ident" id="8184343">err</span>&nbsp;<span class="op" id="8184347">!=</span>&nbsp;<span class="ident" id="8184350">io</span><span class="op" id="8184352">.</span><span class="ident" id="8184353">EOF</span>&nbsp;<span class="op" id="8184357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184361">t</span><span class="op" id="8184362">.</span><span class="ident" id="8184363">Errorf</span><span class="op" id="8184369">(</span><span class="string" id="8184370">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8184399">,</span>&nbsp;<span class="ident" id="8184401">err</span><span class="op" id="8184404">,</span>&nbsp;<span class="ident" id="8184406">io</span><span class="op" id="8184408">.</span><span class="ident" id="8184409">EOF</span><span class="op" id="8184412">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184415">}</span><br>
<span class="lineno"></span><span class="op" id="8184417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184420">func</span>&nbsp;<span class="ident" id="8184425">testHandshake</span><span class="op" id="8184438">(</span><span class="ident" id="8184439">clientConfig</span><span class="op" id="8184451">,</span>&nbsp;<span class="ident" id="8184453">serverConfig</span>&nbsp;<span class="op" id="8184466">*</span><span class="ident" id="8184467">Config</span><span class="op" id="8184473">)</span>&nbsp;<span class="op" id="8184475">(</span><span class="ident" id="8184476">state</span>&nbsp;<span class="ident" id="8184482">ConnectionState</span><span class="op" id="8184497">,</span>&nbsp;<span class="ident" id="8184499">err</span>&nbsp;<span class="builtintype" id="8184503">error</span><span class="op" id="8184508">)</span>&nbsp;<span class="op" id="8184510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184513">c</span><span class="op" id="8184514">,</span>&nbsp;<span class="ident" id="8184516">s</span>&nbsp;<span class="op" id="8184518">:=</span>&nbsp;<span class="ident" id="8184521">net</span><span class="op" id="8184524">.</span><span class="ident" id="8184525">Pipe</span><span class="op" id="8184529">(</span><span class="op" id="8184530">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184533">done</span>&nbsp;<span class="op" id="8184538">:=</span>&nbsp;<span class="builtinfunc" id="8184541">make</span><span class="op" id="8184545">(</span><span class="keyword" id="8184546">chan</span>&nbsp;<span class="builtintype" id="8184551">bool</span><span class="op" id="8184555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184558">go</span>&nbsp;<span class="keyword" id="8184561">func</span><span class="op" id="8184565">(</span><span class="op" id="8184566">)</span>&nbsp;<span class="op" id="8184568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184572">cli</span>&nbsp;<span class="op" id="8184576">:=</span>&nbsp;<span class="ident" id="8184579">Client</span><span class="op" id="8184585">(</span><span class="ident" id="8184586">c</span><span class="op" id="8184587">,</span>&nbsp;<span class="ident" id="8184589">clientConfig</span><span class="op" id="8184601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184605">cli</span><span class="op" id="8184608">.</span><span class="ident" id="8184609">Handshake</span><span class="op" id="8184618">(</span><span class="op" id="8184619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184623">c</span><span class="op" id="8184624">.</span><span class="ident" id="8184625">Close</span><span class="op" id="8184630">(</span><span class="op" id="8184631">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184635">done</span>&nbsp;<span class="op" id="8184640">&lt;-</span>&nbsp;<span class="builtintype" id="8184643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184649">}</span><span class="op" id="8184650">(</span><span class="op" id="8184651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184654">server</span>&nbsp;<span class="op" id="8184661">:=</span>&nbsp;<span class="ident" id="8184664">Server</span><span class="op" id="8184670">(</span><span class="ident" id="8184671">s</span><span class="op" id="8184672">,</span>&nbsp;<span class="ident" id="8184674">serverConfig</span><span class="op" id="8184686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184689">err</span>&nbsp;<span class="op" id="8184693">=</span>&nbsp;<span class="ident" id="8184695">server</span><span class="op" id="8184701">.</span><span class="ident" id="8184702">Handshake</span><span class="op" id="8184711">(</span><span class="op" id="8184712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184715">if</span>&nbsp;<span class="ident" id="8184718">err</span>&nbsp;<span class="op" id="8184722">==</span>&nbsp;<span class="ident" id="8184725">nil</span>&nbsp;<span class="op" id="8184729">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184733">state</span>&nbsp;<span class="op" id="8184739">=</span>&nbsp;<span class="ident" id="8184741">server</span><span class="op" id="8184747">.</span><span class="ident" id="8184748">ConnectionState</span><span class="op" id="8184763">(</span><span class="op" id="8184764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184770">s</span><span class="op" id="8184771">.</span><span class="ident" id="8184772">Close</span><span class="op" id="8184777">(</span><span class="op" id="8184778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184781">&lt;-</span><span class="ident" id="8184783">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184789">return</span><br>
<span class="lineno">195</span><span class="op" id="8184796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184799">func</span>&nbsp;<span class="ident" id="8184804">TestVersion</span><span class="op" id="8184815">(</span><span class="ident" id="8184816">t</span>&nbsp;<span class="op" id="8184818">*</span><span class="ident" id="8184819">testing</span><span class="op" id="8184826">.</span><span class="ident" id="8184827">T</span><span class="op" id="8184828">)</span>&nbsp;<span class="op" id="8184830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184833">serverConfig</span>&nbsp;<span class="op" id="8184846">:=</span>&nbsp;<span class="op" id="8184849">&amp;</span><span class="ident" id="8184850">Config</span><span class="op" id="8184856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184860">Certificates</span><span class="op" id="8184872">:</span>&nbsp;<span class="ident" id="8184874">testConfig</span><span class="op" id="8184884">.</span><span class="ident" id="8184885">Certificates</span><span class="op" id="8184897">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184901">MaxVersion</span><span class="op" id="8184911">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8184915">VersionTLS11</span><span class="op" id="8184927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184933">clientConfig</span>&nbsp;<span class="op" id="8184946">:=</span>&nbsp;<span class="op" id="8184949">&amp;</span><span class="ident" id="8184950">Config</span><span class="op" id="8184956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184960">InsecureSkipVerify</span><span class="op" id="8184978">:</span>&nbsp;<span class="builtintype" id="8184980">true</span><span class="op" id="8184984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184987">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184990">state</span><span class="op" id="8184995">,</span>&nbsp;<span class="ident" id="8184997">err</span>&nbsp;<span class="op" id="8185001">:=</span>&nbsp;<span class="ident" id="8185004">testHandshake</span><span class="op" id="8185017">(</span><span class="ident" id="8185018">clientConfig</span><span class="op" id="8185030">,</span>&nbsp;<span class="ident" id="8185032">serverConfig</span><span class="op" id="8185044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185047">if</span>&nbsp;<span class="ident" id="8185050">err</span>&nbsp;<span class="op" id="8185054">!=</span>&nbsp;<span class="ident" id="8185057">nil</span>&nbsp;<span class="op" id="8185061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185065">t</span><span class="op" id="8185066">.</span><span class="ident" id="8185067">Fatalf</span><span class="op" id="8185073">(</span><span class="string" id="8185074">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8185096">,</span>&nbsp;<span class="ident" id="8185098">err</span><span class="op" id="8185101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185107">if</span>&nbsp;<span class="ident" id="8185110">state</span><span class="op" id="8185115">.</span><span class="ident" id="8185116">Version</span>&nbsp;<span class="op" id="8185124">!=</span>&nbsp;<span class="ident" id="8185127">VersionTLS11</span>&nbsp;<span class="op" id="8185140">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185144">t</span><span class="op" id="8185145">.</span><span class="ident" id="8185146">Fatalf</span><span class="op" id="8185152">(</span><span class="string" id="8185153">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="8185189">,</span>&nbsp;<span class="ident" id="8185191">state</span><span class="op" id="8185196">.</span><span class="ident" id="8185197">Version</span><span class="op" id="8185204">,</span>&nbsp;<span class="ident" id="8185206">VersionTLS11</span><span class="op" id="8185218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185221">}</span><br>
<span class="lineno"></span><span class="op" id="8185223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185226">func</span>&nbsp;<span class="ident" id="8185231">TestCipherSuitePreference</span><span class="op" id="8185256">(</span><span class="ident" id="8185257">t</span>&nbsp;<span class="op" id="8185259">*</span><span class="ident" id="8185260">testing</span><span class="op" id="8185267">.</span><span class="ident" id="8185268">T</span><span class="op" id="8185269">)</span>&nbsp;<span class="op" id="8185271">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185274">serverConfig</span>&nbsp;<span class="op" id="8185287">:=</span>&nbsp;<span class="op" id="8185290">&amp;</span><span class="ident" id="8185291">Config</span><span class="op" id="8185297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185301">CipherSuites</span><span class="op" id="8185313">:</span>&nbsp;<span class="op" id="8185315">[</span><span class="op" id="8185316">]</span><span class="builtintype" id="8185317">uint16</span><span class="op" id="8185323">{</span><span class="ident" id="8185324">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8185348">,</span>&nbsp;<span class="ident" id="8185350">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8185378">,</span>&nbsp;<span class="ident" id="8185380">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8185410">}</span><span class="op" id="8185411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185415">Certificates</span><span class="op" id="8185427">:</span>&nbsp;<span class="ident" id="8185429">testConfig</span><span class="op" id="8185439">.</span><span class="ident" id="8185440">Certificates</span><span class="op" id="8185452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185456">MaxVersion</span><span class="op" id="8185466">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8185470">VersionTLS11</span><span class="op" id="8185482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185485">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185488">clientConfig</span>&nbsp;<span class="op" id="8185501">:=</span>&nbsp;<span class="op" id="8185504">&amp;</span><span class="ident" id="8185505">Config</span><span class="op" id="8185511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185515">CipherSuites</span><span class="op" id="8185527">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8185535">[</span><span class="op" id="8185536">]</span><span class="builtintype" id="8185537">uint16</span><span class="op" id="8185543">{</span><span class="ident" id="8185544">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8185572">,</span>&nbsp;<span class="ident" id="8185574">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8185598">}</span><span class="op" id="8185599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185603">InsecureSkipVerify</span><span class="op" id="8185621">:</span>&nbsp;<span class="builtintype" id="8185623">true</span><span class="op" id="8185627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185633">state</span><span class="op" id="8185638">,</span>&nbsp;<span class="ident" id="8185640">err</span>&nbsp;<span class="op" id="8185644">:=</span>&nbsp;<span class="ident" id="8185647">testHandshake</span><span class="op" id="8185660">(</span><span class="ident" id="8185661">clientConfig</span><span class="op" id="8185673">,</span>&nbsp;<span class="ident" id="8185675">serverConfig</span><span class="op" id="8185687">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185690">if</span>&nbsp;<span class="ident" id="8185693">err</span>&nbsp;<span class="op" id="8185697">!=</span>&nbsp;<span class="ident" id="8185700">nil</span>&nbsp;<span class="op" id="8185704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185708">t</span><span class="op" id="8185709">.</span><span class="ident" id="8185710">Fatalf</span><span class="op" id="8185716">(</span><span class="string" id="8185717">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8185739">,</span>&nbsp;<span class="ident" id="8185741">err</span><span class="op" id="8185744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185750">if</span>&nbsp;<span class="ident" id="8185753">state</span><span class="op" id="8185758">.</span><span class="ident" id="8185759">CipherSuite</span>&nbsp;<span class="op" id="8185771">!=</span>&nbsp;<span class="ident" id="8185774">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="8185803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8185807">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185870">t</span><span class="op" id="8185871">.</span><span class="ident" id="8185872">Fatalf</span><span class="op" id="8185878">(</span><span class="string" id="8185879">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8185921">,</span>&nbsp;<span class="ident" id="8185923">state</span><span class="op" id="8185928">.</span><span class="ident" id="8185929">CipherSuite</span><span class="op" id="8185940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185947">serverConfig</span><span class="op" id="8185959">.</span><span class="ident" id="8185960">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8185985">=</span>&nbsp;<span class="builtintype" id="8185987">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185993">state</span><span class="op" id="8185998">,</span>&nbsp;<span class="ident" id="8186000">err</span>&nbsp;<span class="op" id="8186004">=</span>&nbsp;<span class="ident" id="8186006">testHandshake</span><span class="op" id="8186019">(</span><span class="ident" id="8186020">clientConfig</span><span class="op" id="8186032">,</span>&nbsp;<span class="ident" id="8186034">serverConfig</span><span class="op" id="8186046">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186049">if</span>&nbsp;<span class="ident" id="8186052">err</span>&nbsp;<span class="op" id="8186056">!=</span>&nbsp;<span class="ident" id="8186059">nil</span>&nbsp;<span class="op" id="8186063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186067">t</span><span class="op" id="8186068">.</span><span class="ident" id="8186069">Fatalf</span><span class="op" id="8186075">(</span><span class="string" id="8186076">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8186098">,</span>&nbsp;<span class="ident" id="8186100">err</span><span class="op" id="8186103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186109">if</span>&nbsp;<span class="ident" id="8186112">state</span><span class="op" id="8186117">.</span><span class="ident" id="8186118">CipherSuite</span>&nbsp;<span class="op" id="8186130">!=</span>&nbsp;<span class="ident" id="8186133">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8186158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186162">t</span><span class="op" id="8186163">.</span><span class="ident" id="8186164">Fatalf</span><span class="op" id="8186170">(</span><span class="string" id="8186171">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8186213">,</span>&nbsp;<span class="ident" id="8186215">state</span><span class="op" id="8186220">.</span><span class="ident" id="8186221">CipherSuite</span><span class="op" id="8186232">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186235">}</span><br>
<span class="lineno"></span><span class="op" id="8186237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8186240">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8186315">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8186331">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8186411">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8186430">type</span>&nbsp;<span class="ident" id="8186435">serverTest</span>&nbsp;<span class="keyword" id="8186446">struct</span>&nbsp;<span class="op" id="8186453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186456">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186529">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186570">name</span>&nbsp;<span class="builtintype" id="8186575">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186583">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186649">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186694">command</span>&nbsp;<span class="op" id="8186702">[</span><span class="op" id="8186703">]</span><span class="builtintype" id="8186704">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186712">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186776">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186810">expectedPeerCerts</span>&nbsp;<span class="op" id="8186828">[</span><span class="op" id="8186829">]</span><span class="builtintype" id="8186830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186838">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186909">config</span>&nbsp;<span class="op" id="8186916">*</span><span class="ident" id="8186917">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186925">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186999">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187037">expectAlert</span>&nbsp;<span class="builtintype" id="8187049">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8187055">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8187124">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187196">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="8187226">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8187234">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8187303">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8187376">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187413">validate</span>&nbsp;<span class="keyword" id="8187422">func</span><span class="op" id="8187426">(</span><span class="ident" id="8187427">ConnectionState</span><span class="op" id="8187442">)</span>&nbsp;<span class="builtintype" id="8187444">error</span><br>
<span class="lineno">270</span><span class="op" id="8187450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187453">var</span>&nbsp;<span class="ident" id="8187457">defaultClientCommand</span>&nbsp;<span class="op" id="8187478">=</span>&nbsp;<span class="op" id="8187480">[</span><span class="op" id="8187481">]</span><span class="builtintype" id="8187482">string</span><span class="op" id="8187488">{</span><span class="string" id="8187489">&#34;openssl&#34;</span><span class="op" id="8187498">,</span>&nbsp;<span class="string" id="8187500">&#34;s_client&#34;</span><span class="op" id="8187510">,</span>&nbsp;<span class="string" id="8187512">&#34;-no_ticket&#34;</span><span class="op" id="8187524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8187527">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="8187603">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8187683">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="8187698">func</span>&nbsp;<span class="op" id="8187703">(</span><span class="ident" id="8187704">test</span>&nbsp;<span class="op" id="8187709">*</span><span class="ident" id="8187710">serverTest</span><span class="op" id="8187720">)</span>&nbsp;<span class="ident" id="8187722">connFromCommand</span><span class="op" id="8187737">(</span><span class="op" id="8187738">)</span>&nbsp;<span class="op" id="8187740">(</span><span class="ident" id="8187741">conn</span>&nbsp;<span class="op" id="8187746">*</span><span class="ident" id="8187747">recordingConn</span><span class="op" id="8187760">,</span>&nbsp;<span class="ident" id="8187762">child</span>&nbsp;<span class="op" id="8187768">*</span><span class="ident" id="8187769">exec</span><span class="op" id="8187773">.</span><span class="ident" id="8187774">Cmd</span><span class="op" id="8187777">,</span>&nbsp;<span class="ident" id="8187779">err</span>&nbsp;<span class="builtintype" id="8187783">error</span><span class="op" id="8187788">)</span>&nbsp;<span class="op" id="8187790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187793">l</span><span class="op" id="8187794">,</span>&nbsp;<span class="ident" id="8187796">err</span>&nbsp;<span class="op" id="8187800">:=</span>&nbsp;<span class="ident" id="8187803">net</span><span class="op" id="8187806">.</span><span class="ident" id="8187807">ListenTCP</span><span class="op" id="8187816">(</span><span class="string" id="8187817">&#34;tcp&#34;</span><span class="op" id="8187822">,</span>&nbsp;<span class="op" id="8187824">&amp;</span><span class="ident" id="8187825">net</span><span class="op" id="8187828">.</span><span class="ident" id="8187829">TCPAddr</span><span class="op" id="8187836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187840">IP</span><span class="op" id="8187842">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8187846">net</span><span class="op" id="8187849">.</span><span class="ident" id="8187850">IPv4</span><span class="op" id="8187854">(</span><span class="num" id="8187855">127</span><span class="op" id="8187858">,</span>&nbsp;<span class="num" id="8187860">0</span><span class="op" id="8187861">,</span>&nbsp;<span class="num" id="8187863">0</span><span class="op" id="8187864">,</span>&nbsp;<span class="num" id="8187866">1</span><span class="op" id="8187867">)</span><span class="op" id="8187868">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187872">Port</span><span class="op" id="8187876">:</span>&nbsp;<span class="num" id="8187878">0</span><span class="op" id="8187879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187882">}</span><span class="op" id="8187883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187886">if</span>&nbsp;<span class="ident" id="8187889">err</span>&nbsp;<span class="op" id="8187893">!=</span>&nbsp;<span class="ident" id="8187896">nil</span>&nbsp;<span class="op" id="8187900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187904">return</span>&nbsp;<span class="ident" id="8187911">nil</span><span class="op" id="8187914">,</span>&nbsp;<span class="ident" id="8187916">nil</span><span class="op" id="8187919">,</span>&nbsp;<span class="ident" id="8187921">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187926">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187929">defer</span>&nbsp;<span class="ident" id="8187935">l</span><span class="op" id="8187936">.</span><span class="ident" id="8187937">Close</span><span class="op" id="8187942">(</span><span class="op" id="8187943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187947">port</span>&nbsp;<span class="op" id="8187952">:=</span>&nbsp;<span class="ident" id="8187955">l</span><span class="op" id="8187956">.</span><span class="ident" id="8187957">Addr</span><span class="op" id="8187961">(</span><span class="op" id="8187962">)</span><span class="op" id="8187963">.</span><span class="op" id="8187964">(</span><span class="op" id="8187965">*</span><span class="ident" id="8187966">net</span><span class="op" id="8187969">.</span><span class="ident" id="8187970">TCPAddr</span><span class="op" id="8187977">)</span><span class="op" id="8187978">.</span><span class="ident" id="8187979">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187986">var</span>&nbsp;<span class="ident" id="8187990">command</span>&nbsp;<span class="op" id="8187998">[</span><span class="op" id="8187999">]</span><span class="builtintype" id="8188000">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188008">command</span>&nbsp;<span class="op" id="8188016">=</span>&nbsp;<span class="builtinfunc" id="8188018">append</span><span class="op" id="8188024">(</span><span class="ident" id="8188025">command</span><span class="op" id="8188032">,</span>&nbsp;<span class="ident" id="8188034">test</span><span class="op" id="8188038">.</span><span class="ident" id="8188039">command</span><span class="op" id="8188046">...</span><span class="op" id="8188049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188052">if</span>&nbsp;<span class="builtinfunc" id="8188055">len</span><span class="op" id="8188058">(</span><span class="ident" id="8188059">command</span><span class="op" id="8188066">)</span>&nbsp;<span class="op" id="8188068">==</span>&nbsp;<span class="num" id="8188071">0</span>&nbsp;<span class="op" id="8188073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188077">command</span>&nbsp;<span class="op" id="8188085">=</span>&nbsp;<span class="ident" id="8188087">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188112">command</span>&nbsp;<span class="op" id="8188120">=</span>&nbsp;<span class="builtinfunc" id="8188122">append</span><span class="op" id="8188128">(</span><span class="ident" id="8188129">command</span><span class="op" id="8188136">,</span>&nbsp;<span class="string" id="8188138">&#34;-connect&#34;</span><span class="op" id="8188148">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188151">command</span>&nbsp;<span class="op" id="8188159">=</span>&nbsp;<span class="builtinfunc" id="8188161">append</span><span class="op" id="8188167">(</span><span class="ident" id="8188168">command</span><span class="op" id="8188175">,</span>&nbsp;<span class="ident" id="8188177">fmt</span><span class="op" id="8188180">.</span><span class="ident" id="8188181">Sprintf</span><span class="op" id="8188188">(</span><span class="string" id="8188189">&#34;127.0.0.1:%d&#34;</span><span class="op" id="8188203">,</span>&nbsp;<span class="ident" id="8188205">port</span><span class="op" id="8188209">)</span><span class="op" id="8188210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188213">cmd</span>&nbsp;<span class="op" id="8188217">:=</span>&nbsp;<span class="ident" id="8188220">exec</span><span class="op" id="8188224">.</span><span class="ident" id="8188225">Command</span><span class="op" id="8188232">(</span><span class="ident" id="8188233">command</span><span class="op" id="8188240">[</span><span class="num" id="8188241">0</span><span class="op" id="8188242">]</span><span class="op" id="8188243">,</span>&nbsp;<span class="ident" id="8188245">command</span><span class="op" id="8188252">[</span><span class="num" id="8188253">1</span><span class="op" id="8188254">:</span><span class="op" id="8188255">]</span><span class="op" id="8188256">...</span><span class="op" id="8188259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188262">cmd</span><span class="op" id="8188265">.</span><span class="ident" id="8188266">Stdin</span>&nbsp;<span class="op" id="8188272">=</span>&nbsp;<span class="ident" id="8188274">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188279">var</span>&nbsp;<span class="ident" id="8188283">output</span>&nbsp;<span class="ident" id="8188290">bytes</span><span class="op" id="8188295">.</span><span class="ident" id="8188296">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188304">cmd</span><span class="op" id="8188307">.</span><span class="ident" id="8188308">Stdout</span>&nbsp;<span class="op" id="8188315">=</span>&nbsp;<span class="op" id="8188317">&amp;</span><span class="ident" id="8188318">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188326">cmd</span><span class="op" id="8188329">.</span><span class="ident" id="8188330">Stderr</span>&nbsp;<span class="op" id="8188337">=</span>&nbsp;<span class="op" id="8188339">&amp;</span><span class="ident" id="8188340">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188348">if</span>&nbsp;<span class="ident" id="8188351">err</span>&nbsp;<span class="op" id="8188355">:=</span>&nbsp;<span class="ident" id="8188358">cmd</span><span class="op" id="8188361">.</span><span class="ident" id="8188362">Start</span><span class="op" id="8188367">(</span><span class="op" id="8188368">)</span><span class="op" id="8188369">;</span>&nbsp;<span class="ident" id="8188371">err</span>&nbsp;<span class="op" id="8188375">!=</span>&nbsp;<span class="ident" id="8188378">nil</span>&nbsp;<span class="op" id="8188382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188386">return</span>&nbsp;<span class="ident" id="8188393">nil</span><span class="op" id="8188396">,</span>&nbsp;<span class="ident" id="8188398">nil</span><span class="op" id="8188401">,</span>&nbsp;<span class="ident" id="8188403">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188412">connChan</span>&nbsp;<span class="op" id="8188421">:=</span>&nbsp;<span class="builtinfunc" id="8188424">make</span><span class="op" id="8188428">(</span><span class="keyword" id="8188429">chan</span>&nbsp;<span class="keyword" id="8188434">interface</span><span class="op" id="8188443">{</span><span class="op" id="8188444">}</span><span class="op" id="8188445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188448">go</span>&nbsp;<span class="keyword" id="8188451">func</span><span class="op" id="8188455">(</span><span class="op" id="8188456">)</span>&nbsp;<span class="op" id="8188458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188462">tcpConn</span><span class="op" id="8188469">,</span>&nbsp;<span class="ident" id="8188471">err</span>&nbsp;<span class="op" id="8188475">:=</span>&nbsp;<span class="ident" id="8188478">l</span><span class="op" id="8188479">.</span><span class="ident" id="8188480">Accept</span><span class="op" id="8188486">(</span><span class="op" id="8188487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188491">if</span>&nbsp;<span class="ident" id="8188494">err</span>&nbsp;<span class="op" id="8188498">!=</span>&nbsp;<span class="ident" id="8188501">nil</span>&nbsp;<span class="op" id="8188505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188510">connChan</span>&nbsp;<span class="op" id="8188519">&lt;-</span>&nbsp;<span class="ident" id="8188522">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188532">connChan</span>&nbsp;<span class="op" id="8188541">&lt;-</span>&nbsp;<span class="ident" id="8188544">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188553">}</span><span class="op" id="8188554">(</span><span class="op" id="8188555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188559">var</span>&nbsp;<span class="ident" id="8188563">tcpConn</span>&nbsp;<span class="ident" id="8188571">net</span><span class="op" id="8188574">.</span><span class="ident" id="8188575">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188581">select</span>&nbsp;<span class="op" id="8188588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188591">case</span>&nbsp;<span class="ident" id="8188596">connOrError</span>&nbsp;<span class="op" id="8188608">:=</span>&nbsp;<span class="op" id="8188611">&lt;-</span><span class="ident" id="8188613">connChan</span><span class="op" id="8188621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188625">if</span>&nbsp;<span class="ident" id="8188628">err</span><span class="op" id="8188631">,</span>&nbsp;<span class="ident" id="8188633">ok</span>&nbsp;<span class="op" id="8188636">:=</span>&nbsp;<span class="ident" id="8188639">connOrError</span><span class="op" id="8188650">.</span><span class="op" id="8188651">(</span><span class="builtintype" id="8188652">error</span><span class="op" id="8188657">)</span><span class="op" id="8188658">;</span>&nbsp;<span class="ident" id="8188660">ok</span>&nbsp;<span class="op" id="8188663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188668">return</span>&nbsp;<span class="ident" id="8188675">nil</span><span class="op" id="8188678">,</span>&nbsp;<span class="ident" id="8188680">nil</span><span class="op" id="8188683">,</span>&nbsp;<span class="ident" id="8188685">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188691">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188695">tcpConn</span>&nbsp;<span class="op" id="8188703">=</span>&nbsp;<span class="ident" id="8188705">connOrError</span><span class="op" id="8188716">.</span><span class="op" id="8188717">(</span><span class="ident" id="8188718">net</span><span class="op" id="8188721">.</span><span class="ident" id="8188722">Conn</span><span class="op" id="8188726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188729">case</span>&nbsp;<span class="op" id="8188734">&lt;-</span><span class="ident" id="8188736">time</span><span class="op" id="8188740">.</span><span class="ident" id="8188741">After</span><span class="op" id="8188746">(</span><span class="num" id="8188747">2</span>&nbsp;<span class="op" id="8188749">*</span>&nbsp;<span class="ident" id="8188751">time</span><span class="op" id="8188755">.</span><span class="ident" id="8188756">Second</span><span class="op" id="8188762">)</span><span class="op" id="8188763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188767">output</span><span class="op" id="8188773">.</span><span class="ident" id="8188774">WriteTo</span><span class="op" id="8188781">(</span><span class="ident" id="8188782">os</span><span class="op" id="8188784">.</span><span class="ident" id="8188785">Stdout</span><span class="op" id="8188791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188795">return</span>&nbsp;<span class="ident" id="8188802">nil</span><span class="op" id="8188805">,</span>&nbsp;<span class="ident" id="8188807">nil</span><span class="op" id="8188810">,</span>&nbsp;<span class="ident" id="8188812">errors</span><span class="op" id="8188818">.</span><span class="ident" id="8188819">New</span><span class="op" id="8188822">(</span><span class="string" id="8188823">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="8188876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188879">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188883">record</span>&nbsp;<span class="op" id="8188890">:=</span>&nbsp;<span class="op" id="8188893">&amp;</span><span class="ident" id="8188894">recordingConn</span><span class="op" id="8188907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188911">Conn</span><span class="op" id="8188915">:</span>&nbsp;<span class="ident" id="8188917">tcpConn</span><span class="op" id="8188924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188931">return</span>&nbsp;<span class="ident" id="8188938">record</span><span class="op" id="8188944">,</span>&nbsp;<span class="ident" id="8188946">cmd</span><span class="op" id="8188949">,</span>&nbsp;<span class="ident" id="8188951">nil</span><br>
<span class="lineno"></span><span class="op" id="8188955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188958">func</span>&nbsp;<span class="op" id="8188963">(</span><span class="ident" id="8188964">test</span>&nbsp;<span class="op" id="8188969">*</span><span class="ident" id="8188970">serverTest</span><span class="op" id="8188980">)</span>&nbsp;<span class="ident" id="8188982">dataPath</span><span class="op" id="8188990">(</span><span class="op" id="8188991">)</span>&nbsp;<span class="builtintype" id="8188993">string</span>&nbsp;<span class="op" id="8189000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189003">return</span>&nbsp;<span class="ident" id="8189010">filepath</span><span class="op" id="8189018">.</span><span class="ident" id="8189019">Join</span><span class="op" id="8189023">(</span><span class="string" id="8189024">&#34;testdata&#34;</span><span class="op" id="8189034">,</span>&nbsp;<span class="string" id="8189036">&#34;Server-&#34;</span><span class="op" id="8189045">+</span><span class="ident" id="8189046">test</span><span class="op" id="8189050">.</span><span class="ident" id="8189051">name</span><span class="op" id="8189055">)</span><br>
<span class="lineno">335</span><span class="op" id="8189057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189060">func</span>&nbsp;<span class="op" id="8189065">(</span><span class="ident" id="8189066">test</span>&nbsp;<span class="op" id="8189071">*</span><span class="ident" id="8189072">serverTest</span><span class="op" id="8189082">)</span>&nbsp;<span class="ident" id="8189084">loadData</span><span class="op" id="8189092">(</span><span class="op" id="8189093">)</span>&nbsp;<span class="op" id="8189095">(</span><span class="ident" id="8189096">flows</span>&nbsp;<span class="op" id="8189102">[</span><span class="op" id="8189103">]</span><span class="op" id="8189104">[</span><span class="op" id="8189105">]</span><span class="builtintype" id="8189106">byte</span><span class="op" id="8189110">,</span>&nbsp;<span class="ident" id="8189112">err</span>&nbsp;<span class="builtintype" id="8189116">error</span><span class="op" id="8189121">)</span>&nbsp;<span class="op" id="8189123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189126">in</span><span class="op" id="8189128">,</span>&nbsp;<span class="ident" id="8189130">err</span>&nbsp;<span class="op" id="8189134">:=</span>&nbsp;<span class="ident" id="8189137">os</span><span class="op" id="8189139">.</span><span class="ident" id="8189140">Open</span><span class="op" id="8189144">(</span><span class="ident" id="8189145">test</span><span class="op" id="8189149">.</span><span class="ident" id="8189150">dataPath</span><span class="op" id="8189158">(</span><span class="op" id="8189159">)</span><span class="op" id="8189160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189163">if</span>&nbsp;<span class="ident" id="8189166">err</span>&nbsp;<span class="op" id="8189170">!=</span>&nbsp;<span class="ident" id="8189173">nil</span>&nbsp;<span class="op" id="8189177">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189181">return</span>&nbsp;<span class="ident" id="8189188">nil</span><span class="op" id="8189191">,</span>&nbsp;<span class="ident" id="8189193">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189201">defer</span>&nbsp;<span class="ident" id="8189207">in</span><span class="op" id="8189209">.</span><span class="ident" id="8189210">Close</span><span class="op" id="8189215">(</span><span class="op" id="8189216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189219">return</span>&nbsp;<span class="ident" id="8189226">parseTestData</span><span class="op" id="8189239">(</span><span class="ident" id="8189240">in</span><span class="op" id="8189242">)</span><br>
<span class="lineno"></span><span class="op" id="8189244">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8189247">func</span>&nbsp;<span class="op" id="8189252">(</span><span class="ident" id="8189253">test</span>&nbsp;<span class="op" id="8189258">*</span><span class="ident" id="8189259">serverTest</span><span class="op" id="8189269">)</span>&nbsp;<span class="ident" id="8189271">run</span><span class="op" id="8189274">(</span><span class="ident" id="8189275">t</span>&nbsp;<span class="op" id="8189277">*</span><span class="ident" id="8189278">testing</span><span class="op" id="8189285">.</span><span class="ident" id="8189286">T</span><span class="op" id="8189287">,</span>&nbsp;<span class="ident" id="8189289">write</span>&nbsp;<span class="builtintype" id="8189295">bool</span><span class="op" id="8189299">)</span>&nbsp;<span class="op" id="8189301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189304">var</span>&nbsp;<span class="ident" id="8189308">clientConn</span><span class="op" id="8189318">,</span>&nbsp;<span class="ident" id="8189320">serverConn</span>&nbsp;<span class="ident" id="8189331">net</span><span class="op" id="8189334">.</span><span class="ident" id="8189335">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189341">var</span>&nbsp;<span class="ident" id="8189345">recordingConn</span>&nbsp;<span class="op" id="8189359">*</span><span class="ident" id="8189360">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189375">var</span>&nbsp;<span class="ident" id="8189379">childProcess</span>&nbsp;<span class="op" id="8189392">*</span><span class="ident" id="8189393">exec</span><span class="op" id="8189397">.</span><span class="ident" id="8189398">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189404">if</span>&nbsp;<span class="ident" id="8189407">write</span>&nbsp;<span class="op" id="8189413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189417">var</span>&nbsp;<span class="ident" id="8189421">err</span>&nbsp;<span class="builtintype" id="8189425">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189433">recordingConn</span><span class="op" id="8189446">,</span>&nbsp;<span class="ident" id="8189448">childProcess</span><span class="op" id="8189460">,</span>&nbsp;<span class="ident" id="8189462">err</span>&nbsp;<span class="op" id="8189466">=</span>&nbsp;<span class="ident" id="8189468">test</span><span class="op" id="8189472">.</span><span class="ident" id="8189473">connFromCommand</span><span class="op" id="8189488">(</span><span class="op" id="8189489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189493">if</span>&nbsp;<span class="ident" id="8189496">err</span>&nbsp;<span class="op" id="8189500">!=</span>&nbsp;<span class="ident" id="8189503">nil</span>&nbsp;<span class="op" id="8189507">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189512">t</span><span class="op" id="8189513">.</span><span class="ident" id="8189514">Fatalf</span><span class="op" id="8189520">(</span><span class="string" id="8189521">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8189553">,</span>&nbsp;<span class="ident" id="8189555">err</span><span class="op" id="8189558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189566">serverConn</span>&nbsp;<span class="op" id="8189577">=</span>&nbsp;<span class="ident" id="8189579">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189594">}</span>&nbsp;<span class="keyword" id="8189596">else</span>&nbsp;<span class="op" id="8189601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189605">clientConn</span><span class="op" id="8189615">,</span>&nbsp;<span class="ident" id="8189617">serverConn</span>&nbsp;<span class="op" id="8189628">=</span>&nbsp;<span class="ident" id="8189630">net</span><span class="op" id="8189633">.</span><span class="ident" id="8189634">Pipe</span><span class="op" id="8189638">(</span><span class="op" id="8189639">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189645">config</span>&nbsp;<span class="op" id="8189652">:=</span>&nbsp;<span class="ident" id="8189655">test</span><span class="op" id="8189659">.</span><span class="ident" id="8189660">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189668">if</span>&nbsp;<span class="ident" id="8189671">config</span>&nbsp;<span class="op" id="8189678">==</span>&nbsp;<span class="ident" id="8189681">nil</span>&nbsp;<span class="op" id="8189685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189689">config</span>&nbsp;<span class="op" id="8189696">=</span>&nbsp;<span class="ident" id="8189698">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189710">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189713">server</span>&nbsp;<span class="op" id="8189720">:=</span>&nbsp;<span class="ident" id="8189723">Server</span><span class="op" id="8189729">(</span><span class="ident" id="8189730">serverConn</span><span class="op" id="8189740">,</span>&nbsp;<span class="ident" id="8189742">config</span><span class="op" id="8189748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189751">connStateChan</span>&nbsp;<span class="op" id="8189765">:=</span>&nbsp;<span class="builtinfunc" id="8189768">make</span><span class="op" id="8189772">(</span><span class="keyword" id="8189773">chan</span>&nbsp;<span class="ident" id="8189778">ConnectionState</span><span class="op" id="8189793">,</span>&nbsp;<span class="num" id="8189795">1</span><span class="op" id="8189796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189799">go</span>&nbsp;<span class="keyword" id="8189802">func</span><span class="op" id="8189806">(</span><span class="op" id="8189807">)</span>&nbsp;<span class="op" id="8189809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189813">var</span>&nbsp;<span class="ident" id="8189817">err</span>&nbsp;<span class="builtintype" id="8189821">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189829">if</span>&nbsp;<span class="ident" id="8189832">_</span><span class="op" id="8189833">,</span>&nbsp;<span class="ident" id="8189835">err</span>&nbsp;<span class="op" id="8189839">=</span>&nbsp;<span class="ident" id="8189841">server</span><span class="op" id="8189847">.</span><span class="ident" id="8189848">Write</span><span class="op" id="8189853">(</span><span class="op" id="8189854">[</span><span class="op" id="8189855">]</span><span class="builtintype" id="8189856">byte</span><span class="op" id="8189860">(</span><span class="string" id="8189861">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="8189877">)</span><span class="op" id="8189878">)</span><span class="op" id="8189879">;</span>&nbsp;<span class="ident" id="8189881">err</span>&nbsp;<span class="op" id="8189885">!=</span>&nbsp;<span class="ident" id="8189888">nil</span>&nbsp;<span class="op" id="8189892">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189897">t</span><span class="op" id="8189898">.</span><span class="ident" id="8189899">Logf</span><span class="op" id="8189903">(</span><span class="string" id="8189904">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="8189933">,</span>&nbsp;<span class="ident" id="8189935">err</span><span class="op" id="8189938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189946">if</span>&nbsp;<span class="builtinfunc" id="8189949">len</span><span class="op" id="8189952">(</span><span class="ident" id="8189953">test</span><span class="op" id="8189957">.</span><span class="ident" id="8189958">expectHandshakeErrorIncluding</span><span class="op" id="8189987">)</span>&nbsp;<span class="op" id="8189989">&gt;</span>&nbsp;<span class="num" id="8189991">0</span>&nbsp;<span class="op" id="8189993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189998">if</span>&nbsp;<span class="ident" id="8190001">err</span>&nbsp;<span class="op" id="8190005">==</span>&nbsp;<span class="ident" id="8190008">nil</span>&nbsp;<span class="op" id="8190012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190018">t</span><span class="op" id="8190019">.</span><span class="ident" id="8190020">Errorf</span><span class="op" id="8190026">(</span><span class="string" id="8190027">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="8190066">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190071">}</span>&nbsp;<span class="keyword" id="8190073">else</span>&nbsp;<span class="keyword" id="8190078">if</span>&nbsp;<span class="ident" id="8190081">s</span>&nbsp;<span class="op" id="8190083">:=</span>&nbsp;<span class="ident" id="8190086">err</span><span class="op" id="8190089">.</span><span class="ident" id="8190090">Error</span><span class="op" id="8190095">(</span><span class="op" id="8190096">)</span><span class="op" id="8190097">;</span>&nbsp;<span class="op" id="8190099">!</span><span class="ident" id="8190100">strings</span><span class="op" id="8190107">.</span><span class="ident" id="8190108">Contains</span><span class="op" id="8190116">(</span><span class="ident" id="8190117">s</span><span class="op" id="8190118">,</span>&nbsp;<span class="ident" id="8190120">test</span><span class="op" id="8190124">.</span><span class="ident" id="8190125">expectHandshakeErrorIncluding</span><span class="op" id="8190154">)</span>&nbsp;<span class="op" id="8190156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190162">t</span><span class="op" id="8190163">.</span><span class="ident" id="8190164">Errorf</span><span class="op" id="8190170">(</span><span class="string" id="8190171">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8190216">,</span>&nbsp;<span class="ident" id="8190218">test</span><span class="op" id="8190222">.</span><span class="ident" id="8190223">expectHandshakeErrorIncluding</span><span class="op" id="8190252">,</span>&nbsp;<span class="ident" id="8190254">s</span><span class="op" id="8190255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190268">server</span><span class="op" id="8190274">.</span><span class="ident" id="8190275">Close</span><span class="op" id="8190280">(</span><span class="op" id="8190281">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190285">serverConn</span><span class="op" id="8190295">.</span><span class="ident" id="8190296">Close</span><span class="op" id="8190301">(</span><span class="op" id="8190302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190306">connStateChan</span>&nbsp;<span class="op" id="8190320">&lt;-</span>&nbsp;<span class="ident" id="8190323">server</span><span class="op" id="8190329">.</span><span class="ident" id="8190330">ConnectionState</span><span class="op" id="8190345">(</span><span class="op" id="8190346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190349">}</span><span class="op" id="8190350">(</span><span class="op" id="8190351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190355">if</span>&nbsp;<span class="op" id="8190358">!</span><span class="ident" id="8190359">write</span>&nbsp;<span class="op" id="8190365">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190369">flows</span><span class="op" id="8190374">,</span>&nbsp;<span class="ident" id="8190376">err</span>&nbsp;<span class="op" id="8190380">:=</span>&nbsp;<span class="ident" id="8190383">test</span><span class="op" id="8190387">.</span><span class="ident" id="8190388">loadData</span><span class="op" id="8190396">(</span><span class="op" id="8190397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190401">if</span>&nbsp;<span class="ident" id="8190404">err</span>&nbsp;<span class="op" id="8190408">!=</span>&nbsp;<span class="ident" id="8190411">nil</span>&nbsp;<span class="op" id="8190415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190420">if</span>&nbsp;<span class="op" id="8190423">!</span><span class="ident" id="8190424">test</span><span class="op" id="8190428">.</span><span class="ident" id="8190429">expectAlert</span>&nbsp;<span class="op" id="8190441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190447">t</span><span class="op" id="8190448">.</span><span class="ident" id="8190449">Fatalf</span><span class="op" id="8190455">(</span><span class="string" id="8190456">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="8190489">,</span>&nbsp;<span class="ident" id="8190491">test</span><span class="op" id="8190495">.</span><span class="ident" id="8190496">name</span><span class="op" id="8190500">,</span>&nbsp;<span class="ident" id="8190502">test</span><span class="op" id="8190506">.</span><span class="ident" id="8190507">dataPath</span><span class="op" id="8190515">(</span><span class="op" id="8190516">)</span><span class="op" id="8190517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190522">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190530">for</span>&nbsp;<span class="ident" id="8190534">i</span><span class="op" id="8190535">,</span>&nbsp;<span class="ident" id="8190537">b</span>&nbsp;<span class="op" id="8190539">:=</span>&nbsp;<span class="keyword" id="8190542">range</span>&nbsp;<span class="ident" id="8190548">flows</span>&nbsp;<span class="op" id="8190554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190559">if</span>&nbsp;<span class="ident" id="8190562">i</span><span class="op" id="8190563">%</span><span class="num" id="8190564">2</span>&nbsp;<span class="op" id="8190566">==</span>&nbsp;<span class="num" id="8190569">0</span>&nbsp;<span class="op" id="8190571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190577">clientConn</span><span class="op" id="8190587">.</span><span class="ident" id="8190588">Write</span><span class="op" id="8190593">(</span><span class="ident" id="8190594">b</span><span class="op" id="8190595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190601">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190618">bb</span>&nbsp;<span class="op" id="8190621">:=</span>&nbsp;<span class="builtinfunc" id="8190624">make</span><span class="op" id="8190628">(</span><span class="op" id="8190629">[</span><span class="op" id="8190630">]</span><span class="builtintype" id="8190631">byte</span><span class="op" id="8190635">,</span>&nbsp;<span class="builtinfunc" id="8190637">len</span><span class="op" id="8190640">(</span><span class="ident" id="8190641">b</span><span class="op" id="8190642">)</span><span class="op" id="8190643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190648">n</span><span class="op" id="8190649">,</span>&nbsp;<span class="ident" id="8190651">err</span>&nbsp;<span class="op" id="8190655">:=</span>&nbsp;<span class="ident" id="8190658">io</span><span class="op" id="8190660">.</span><span class="ident" id="8190661">ReadFull</span><span class="op" id="8190669">(</span><span class="ident" id="8190670">clientConn</span><span class="op" id="8190680">,</span>&nbsp;<span class="ident" id="8190682">bb</span><span class="op" id="8190684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190689">if</span>&nbsp;<span class="ident" id="8190692">test</span><span class="op" id="8190696">.</span><span class="ident" id="8190697">expectAlert</span>&nbsp;<span class="op" id="8190709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190715">if</span>&nbsp;<span class="ident" id="8190718">err</span>&nbsp;<span class="op" id="8190722">==</span>&nbsp;<span class="ident" id="8190725">nil</span>&nbsp;<span class="op" id="8190729">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190736">t</span><span class="op" id="8190737">.</span><span class="ident" id="8190738">Fatal</span><span class="op" id="8190743">(</span><span class="string" id="8190744">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="8190786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190797">}</span>&nbsp;<span class="keyword" id="8190799">else</span>&nbsp;<span class="op" id="8190804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190810">if</span>&nbsp;<span class="ident" id="8190813">err</span>&nbsp;<span class="op" id="8190817">!=</span>&nbsp;<span class="ident" id="8190820">nil</span>&nbsp;<span class="op" id="8190824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190831">t</span><span class="op" id="8190832">.</span><span class="ident" id="8190833">Fatalf</span><span class="op" id="8190839">(</span><span class="string" id="8190840">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="8190893">,</span>&nbsp;<span class="ident" id="8190895">test</span><span class="op" id="8190899">.</span><span class="ident" id="8190900">name</span><span class="op" id="8190904">,</span>&nbsp;<span class="ident" id="8190906">i</span><span class="op" id="8190907">+</span><span class="num" id="8190908">1</span><span class="op" id="8190909">,</span>&nbsp;<span class="ident" id="8190911">err</span><span class="op" id="8190914">,</span>&nbsp;<span class="ident" id="8190916">n</span><span class="op" id="8190917">,</span>&nbsp;<span class="builtinfunc" id="8190919">len</span><span class="op" id="8190922">(</span><span class="ident" id="8190923">bb</span><span class="op" id="8190925">)</span><span class="op" id="8190926">,</span>&nbsp;<span class="ident" id="8190928">bb</span><span class="op" id="8190930">[</span><span class="op" id="8190931">:</span><span class="ident" id="8190932">n</span><span class="op" id="8190933">]</span><span class="op" id="8190934">,</span>&nbsp;<span class="ident" id="8190936">b</span><span class="op" id="8190937">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190949">if</span>&nbsp;<span class="op" id="8190952">!</span><span class="ident" id="8190953">bytes</span><span class="op" id="8190958">.</span><span class="ident" id="8190959">Equal</span><span class="op" id="8190964">(</span><span class="ident" id="8190965">b</span><span class="op" id="8190966">,</span>&nbsp;<span class="ident" id="8190968">bb</span><span class="op" id="8190970">)</span>&nbsp;<span class="op" id="8190972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190979">t</span><span class="op" id="8190980">.</span><span class="ident" id="8190981">Fatalf</span><span class="op" id="8190987">(</span><span class="string" id="8190988">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8191030">,</span>&nbsp;<span class="ident" id="8191032">test</span><span class="op" id="8191036">.</span><span class="ident" id="8191037">name</span><span class="op" id="8191041">,</span>&nbsp;<span class="ident" id="8191043">i</span><span class="op" id="8191044">+</span><span class="num" id="8191045">1</span><span class="op" id="8191046">,</span>&nbsp;<span class="ident" id="8191048">bb</span><span class="op" id="8191050">,</span>&nbsp;<span class="ident" id="8191052">b</span><span class="op" id="8191053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191064">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191072">clientConn</span><span class="op" id="8191082">.</span><span class="ident" id="8191083">Close</span><span class="op" id="8191088">(</span><span class="op" id="8191089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191096">connState</span>&nbsp;<span class="op" id="8191106">:=</span>&nbsp;<span class="op" id="8191109">&lt;-</span><span class="ident" id="8191111">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191126">peerCerts</span>&nbsp;<span class="op" id="8191136">:=</span>&nbsp;<span class="ident" id="8191139">connState</span><span class="op" id="8191148">.</span><span class="ident" id="8191149">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191167">if</span>&nbsp;<span class="builtinfunc" id="8191170">len</span><span class="op" id="8191173">(</span><span class="ident" id="8191174">peerCerts</span><span class="op" id="8191183">)</span>&nbsp;<span class="op" id="8191185">==</span>&nbsp;<span class="builtinfunc" id="8191188">len</span><span class="op" id="8191191">(</span><span class="ident" id="8191192">test</span><span class="op" id="8191196">.</span><span class="ident" id="8191197">expectedPeerCerts</span><span class="op" id="8191214">)</span>&nbsp;<span class="op" id="8191216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191220">for</span>&nbsp;<span class="ident" id="8191224">i</span><span class="op" id="8191225">,</span>&nbsp;<span class="ident" id="8191227">peerCert</span>&nbsp;<span class="op" id="8191236">:=</span>&nbsp;<span class="keyword" id="8191239">range</span>&nbsp;<span class="ident" id="8191245">peerCerts</span>&nbsp;<span class="op" id="8191255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191260">block</span><span class="op" id="8191265">,</span>&nbsp;<span class="ident" id="8191267">_</span>&nbsp;<span class="op" id="8191269">:=</span>&nbsp;<span class="ident" id="8191272">pem</span><span class="op" id="8191275">.</span><span class="ident" id="8191276">Decode</span><span class="op" id="8191282">(</span><span class="op" id="8191283">[</span><span class="op" id="8191284">]</span><span class="builtintype" id="8191285">byte</span><span class="op" id="8191289">(</span><span class="ident" id="8191290">test</span><span class="op" id="8191294">.</span><span class="ident" id="8191295">expectedPeerCerts</span><span class="op" id="8191312">[</span><span class="ident" id="8191313">i</span><span class="op" id="8191314">]</span><span class="op" id="8191315">)</span><span class="op" id="8191316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191321">if</span>&nbsp;<span class="op" id="8191324">!</span><span class="ident" id="8191325">bytes</span><span class="op" id="8191330">.</span><span class="ident" id="8191331">Equal</span><span class="op" id="8191336">(</span><span class="ident" id="8191337">block</span><span class="op" id="8191342">.</span><span class="ident" id="8191343">Bytes</span><span class="op" id="8191348">,</span>&nbsp;<span class="ident" id="8191350">peerCert</span><span class="op" id="8191358">.</span><span class="ident" id="8191359">Raw</span><span class="op" id="8191362">)</span>&nbsp;<span class="op" id="8191364">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191370">t</span><span class="op" id="8191371">.</span><span class="ident" id="8191372">Fatalf</span><span class="op" id="8191378">(</span><span class="string" id="8191379">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="8191409">,</span>&nbsp;<span class="ident" id="8191411">test</span><span class="op" id="8191415">.</span><span class="ident" id="8191416">name</span><span class="op" id="8191420">,</span>&nbsp;<span class="ident" id="8191422">i</span><span class="op" id="8191423">+</span><span class="num" id="8191424">1</span><span class="op" id="8191425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191437">}</span>&nbsp;<span class="keyword" id="8191439">else</span>&nbsp;<span class="op" id="8191444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191448">t</span><span class="op" id="8191449">.</span><span class="ident" id="8191450">Fatalf</span><span class="op" id="8191456">(</span><span class="string" id="8191457">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="8191516">,</span>&nbsp;<span class="ident" id="8191518">test</span><span class="op" id="8191522">.</span><span class="ident" id="8191523">name</span><span class="op" id="8191527">,</span>&nbsp;<span class="builtinfunc" id="8191529">len</span><span class="op" id="8191532">(</span><span class="ident" id="8191533">test</span><span class="op" id="8191537">.</span><span class="ident" id="8191538">expectedPeerCerts</span><span class="op" id="8191555">)</span><span class="op" id="8191556">,</span>&nbsp;<span class="builtinfunc" id="8191558">len</span><span class="op" id="8191561">(</span><span class="ident" id="8191562">peerCerts</span><span class="op" id="8191571">)</span><span class="op" id="8191572">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191579">if</span>&nbsp;<span class="ident" id="8191582">test</span><span class="op" id="8191586">.</span><span class="ident" id="8191587">validate</span>&nbsp;<span class="op" id="8191596">!=</span>&nbsp;<span class="ident" id="8191599">nil</span>&nbsp;<span class="op" id="8191603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191607">if</span>&nbsp;<span class="ident" id="8191610">err</span>&nbsp;<span class="op" id="8191614">:=</span>&nbsp;<span class="ident" id="8191617">test</span><span class="op" id="8191621">.</span><span class="ident" id="8191622">validate</span><span class="op" id="8191630">(</span><span class="ident" id="8191631">connState</span><span class="op" id="8191640">)</span><span class="op" id="8191641">;</span>&nbsp;<span class="ident" id="8191643">err</span>&nbsp;<span class="op" id="8191647">!=</span>&nbsp;<span class="ident" id="8191650">nil</span>&nbsp;<span class="op" id="8191654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191659">t</span><span class="op" id="8191660">.</span><span class="ident" id="8191661">Fatalf</span><span class="op" id="8191667">(</span><span class="string" id="8191668">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8191706">,</span>&nbsp;<span class="ident" id="8191708">err</span><span class="op" id="8191711">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191722">if</span>&nbsp;<span class="ident" id="8191725">write</span>&nbsp;<span class="op" id="8191731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191735">path</span>&nbsp;<span class="op" id="8191740">:=</span>&nbsp;<span class="ident" id="8191743">test</span><span class="op" id="8191747">.</span><span class="ident" id="8191748">dataPath</span><span class="op" id="8191756">(</span><span class="op" id="8191757">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191761">out</span><span class="op" id="8191764">,</span>&nbsp;<span class="ident" id="8191766">err</span>&nbsp;<span class="op" id="8191770">:=</span>&nbsp;<span class="ident" id="8191773">os</span><span class="op" id="8191775">.</span><span class="ident" id="8191776">OpenFile</span><span class="op" id="8191784">(</span><span class="ident" id="8191785">path</span><span class="op" id="8191789">,</span>&nbsp;<span class="ident" id="8191791">os</span><span class="op" id="8191793">.</span><span class="ident" id="8191794">O_WRONLY</span><span class="op" id="8191802">|</span><span class="ident" id="8191803">os</span><span class="op" id="8191805">.</span><span class="ident" id="8191806">O_CREATE</span><span class="op" id="8191814">|</span><span class="ident" id="8191815">os</span><span class="op" id="8191817">.</span><span class="ident" id="8191818">O_TRUNC</span><span class="op" id="8191825">,</span>&nbsp;<span class="num" id="8191827">0644</span><span class="op" id="8191831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191835">if</span>&nbsp;<span class="ident" id="8191838">err</span>&nbsp;<span class="op" id="8191842">!=</span>&nbsp;<span class="ident" id="8191845">nil</span>&nbsp;<span class="op" id="8191849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191854">t</span><span class="op" id="8191855">.</span><span class="ident" id="8191856">Fatalf</span><span class="op" id="8191862">(</span><span class="string" id="8191863">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8191897">,</span>&nbsp;<span class="ident" id="8191899">err</span><span class="op" id="8191902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191910">defer</span>&nbsp;<span class="ident" id="8191916">out</span><span class="op" id="8191919">.</span><span class="ident" id="8191920">Close</span><span class="op" id="8191925">(</span><span class="op" id="8191926">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191930">recordingConn</span><span class="op" id="8191943">.</span><span class="ident" id="8191944">Close</span><span class="op" id="8191949">(</span><span class="op" id="8191950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191954">if</span>&nbsp;<span class="builtinfunc" id="8191957">len</span><span class="op" id="8191960">(</span><span class="ident" id="8191961">recordingConn</span><span class="op" id="8191974">.</span><span class="ident" id="8191975">flows</span><span class="op" id="8191980">)</span>&nbsp;<span class="op" id="8191982">&lt;</span>&nbsp;<span class="num" id="8191984">3</span>&nbsp;<span class="op" id="8191986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191991">childProcess</span><span class="op" id="8192003">.</span><span class="ident" id="8192004">Stdout</span><span class="op" id="8192010">.</span><span class="op" id="8192011">(</span><span class="op" id="8192012">*</span><span class="ident" id="8192013">bytes</span><span class="op" id="8192018">.</span><span class="ident" id="8192019">Buffer</span><span class="op" id="8192025">)</span><span class="op" id="8192026">.</span><span class="ident" id="8192027">WriteTo</span><span class="op" id="8192034">(</span><span class="ident" id="8192035">os</span><span class="op" id="8192037">.</span><span class="ident" id="8192038">Stdout</span><span class="op" id="8192044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192049">if</span>&nbsp;<span class="builtinfunc" id="8192052">len</span><span class="op" id="8192055">(</span><span class="ident" id="8192056">test</span><span class="op" id="8192060">.</span><span class="ident" id="8192061">expectHandshakeErrorIncluding</span><span class="op" id="8192090">)</span>&nbsp;<span class="op" id="8192092">==</span>&nbsp;<span class="num" id="8192095">0</span>&nbsp;<span class="op" id="8192097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192103">t</span><span class="op" id="8192104">.</span><span class="ident" id="8192105">Fatalf</span><span class="op" id="8192111">(</span><span class="string" id="8192112">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="8192130">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192143">recordingConn</span><span class="op" id="8192156">.</span><span class="ident" id="8192157">WriteTo</span><span class="op" id="8192164">(</span><span class="ident" id="8192165">out</span><span class="op" id="8192168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192172">fmt</span><span class="op" id="8192175">.</span><span class="ident" id="8192176">Printf</span><span class="op" id="8192182">(</span><span class="string" id="8192183">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8192195">,</span>&nbsp;<span class="ident" id="8192197">path</span><span class="op" id="8192201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192205">childProcess</span><span class="op" id="8192217">.</span><span class="ident" id="8192218">Wait</span><span class="op" id="8192222">(</span><span class="op" id="8192223">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192226">}</span><br>
<span class="lineno"></span><span class="op" id="8192228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192231">func</span>&nbsp;<span class="ident" id="8192236">runServerTestForVersion</span><span class="op" id="8192259">(</span><span class="ident" id="8192260">t</span>&nbsp;<span class="op" id="8192262">*</span><span class="ident" id="8192263">testing</span><span class="op" id="8192270">.</span><span class="ident" id="8192271">T</span><span class="op" id="8192272">,</span>&nbsp;<span class="ident" id="8192274">template</span>&nbsp;<span class="op" id="8192283">*</span><span class="ident" id="8192284">serverTest</span><span class="op" id="8192294">,</span>&nbsp;<span class="ident" id="8192296">prefix</span><span class="op" id="8192302">,</span>&nbsp;<span class="ident" id="8192304">option</span>&nbsp;<span class="builtintype" id="8192311">string</span><span class="op" id="8192317">)</span>&nbsp;<span class="op" id="8192319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192322">test</span>&nbsp;<span class="op" id="8192327">:=</span>&nbsp;<span class="op" id="8192330">*</span><span class="ident" id="8192331">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192341">test</span><span class="op" id="8192345">.</span><span class="ident" id="8192346">name</span>&nbsp;<span class="op" id="8192351">=</span>&nbsp;<span class="ident" id="8192353">prefix</span>&nbsp;<span class="op" id="8192360">+</span>&nbsp;<span class="ident" id="8192362">test</span><span class="op" id="8192366">.</span><span class="ident" id="8192367">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192373">if</span>&nbsp;<span class="builtinfunc" id="8192376">len</span><span class="op" id="8192379">(</span><span class="ident" id="8192380">test</span><span class="op" id="8192384">.</span><span class="ident" id="8192385">command</span><span class="op" id="8192392">)</span>&nbsp;<span class="op" id="8192394">==</span>&nbsp;<span class="num" id="8192397">0</span>&nbsp;<span class="op" id="8192399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192403">test</span><span class="op" id="8192407">.</span><span class="ident" id="8192408">command</span>&nbsp;<span class="op" id="8192416">=</span>&nbsp;<span class="ident" id="8192418">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192443">test</span><span class="op" id="8192447">.</span><span class="ident" id="8192448">command</span>&nbsp;<span class="op" id="8192456">=</span>&nbsp;<span class="builtinfunc" id="8192458">append</span><span class="op" id="8192464">(</span><span class="op" id="8192465">[</span><span class="op" id="8192466">]</span><span class="builtintype" id="8192467">string</span><span class="op" id="8192473">(</span><span class="ident" id="8192474">nil</span><span class="op" id="8192477">)</span><span class="op" id="8192478">,</span>&nbsp;<span class="ident" id="8192480">test</span><span class="op" id="8192484">.</span><span class="ident" id="8192485">command</span><span class="op" id="8192492">...</span><span class="op" id="8192495">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192498">test</span><span class="op" id="8192502">.</span><span class="ident" id="8192503">command</span>&nbsp;<span class="op" id="8192511">=</span>&nbsp;<span class="builtinfunc" id="8192513">append</span><span class="op" id="8192519">(</span><span class="ident" id="8192520">test</span><span class="op" id="8192524">.</span><span class="ident" id="8192525">command</span><span class="op" id="8192532">,</span>&nbsp;<span class="ident" id="8192534">option</span><span class="op" id="8192540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192543">test</span><span class="op" id="8192547">.</span><span class="ident" id="8192548">run</span><span class="op" id="8192551">(</span><span class="ident" id="8192552">t</span><span class="op" id="8192553">,</span>&nbsp;<span class="op" id="8192555">*</span><span class="ident" id="8192556">update</span><span class="op" id="8192562">)</span><br>
<span class="lineno"></span><span class="op" id="8192564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192567">func</span>&nbsp;<span class="ident" id="8192572">runServerTestSSLv3</span><span class="op" id="8192590">(</span><span class="ident" id="8192591">t</span>&nbsp;<span class="op" id="8192593">*</span><span class="ident" id="8192594">testing</span><span class="op" id="8192601">.</span><span class="ident" id="8192602">T</span><span class="op" id="8192603">,</span>&nbsp;<span class="ident" id="8192605">template</span>&nbsp;<span class="op" id="8192614">*</span><span class="ident" id="8192615">serverTest</span><span class="op" id="8192625">)</span>&nbsp;<span class="op" id="8192627">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192630">runServerTestForVersion</span><span class="op" id="8192653">(</span><span class="ident" id="8192654">t</span><span class="op" id="8192655">,</span>&nbsp;<span class="ident" id="8192657">template</span><span class="op" id="8192665">,</span>&nbsp;<span class="string" id="8192667">&#34;SSLv3-&#34;</span><span class="op" id="8192675">,</span>&nbsp;<span class="string" id="8192677">&#34;-ssl3&#34;</span><span class="op" id="8192684">)</span><br>
<span class="lineno"></span><span class="op" id="8192686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192689">func</span>&nbsp;<span class="ident" id="8192694">runServerTestTLS10</span><span class="op" id="8192712">(</span><span class="ident" id="8192713">t</span>&nbsp;<span class="op" id="8192715">*</span><span class="ident" id="8192716">testing</span><span class="op" id="8192723">.</span><span class="ident" id="8192724">T</span><span class="op" id="8192725">,</span>&nbsp;<span class="ident" id="8192727">template</span>&nbsp;<span class="op" id="8192736">*</span><span class="ident" id="8192737">serverTest</span><span class="op" id="8192747">)</span>&nbsp;<span class="op" id="8192749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192752">runServerTestForVersion</span><span class="op" id="8192775">(</span><span class="ident" id="8192776">t</span><span class="op" id="8192777">,</span>&nbsp;<span class="ident" id="8192779">template</span><span class="op" id="8192787">,</span>&nbsp;<span class="string" id="8192789">&#34;TLSv10-&#34;</span><span class="op" id="8192798">,</span>&nbsp;<span class="string" id="8192800">&#34;-tls1&#34;</span><span class="op" id="8192807">)</span><br>
<span class="lineno">470</span><span class="op" id="8192809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192812">func</span>&nbsp;<span class="ident" id="8192817">runServerTestTLS11</span><span class="op" id="8192835">(</span><span class="ident" id="8192836">t</span>&nbsp;<span class="op" id="8192838">*</span><span class="ident" id="8192839">testing</span><span class="op" id="8192846">.</span><span class="ident" id="8192847">T</span><span class="op" id="8192848">,</span>&nbsp;<span class="ident" id="8192850">template</span>&nbsp;<span class="op" id="8192859">*</span><span class="ident" id="8192860">serverTest</span><span class="op" id="8192870">)</span>&nbsp;<span class="op" id="8192872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192875">runServerTestForVersion</span><span class="op" id="8192898">(</span><span class="ident" id="8192899">t</span><span class="op" id="8192900">,</span>&nbsp;<span class="ident" id="8192902">template</span><span class="op" id="8192910">,</span>&nbsp;<span class="string" id="8192912">&#34;TLSv11-&#34;</span><span class="op" id="8192921">,</span>&nbsp;<span class="string" id="8192923">&#34;-tls1_1&#34;</span><span class="op" id="8192932">)</span><br>
<span class="lineno"></span><span class="op" id="8192934">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8192937">func</span>&nbsp;<span class="ident" id="8192942">runServerTestTLS12</span><span class="op" id="8192960">(</span><span class="ident" id="8192961">t</span>&nbsp;<span class="op" id="8192963">*</span><span class="ident" id="8192964">testing</span><span class="op" id="8192971">.</span><span class="ident" id="8192972">T</span><span class="op" id="8192973">,</span>&nbsp;<span class="ident" id="8192975">template</span>&nbsp;<span class="op" id="8192984">*</span><span class="ident" id="8192985">serverTest</span><span class="op" id="8192995">)</span>&nbsp;<span class="op" id="8192997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193000">runServerTestForVersion</span><span class="op" id="8193023">(</span><span class="ident" id="8193024">t</span><span class="op" id="8193025">,</span>&nbsp;<span class="ident" id="8193027">template</span><span class="op" id="8193035">,</span>&nbsp;<span class="string" id="8193037">&#34;TLSv12-&#34;</span><span class="op" id="8193046">,</span>&nbsp;<span class="string" id="8193048">&#34;-tls1_2&#34;</span><span class="op" id="8193057">)</span><br>
<span class="lineno"></span><span class="op" id="8193059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8193062">func</span>&nbsp;<span class="ident" id="8193067">TestHandshakeServerRSARC4</span><span class="op" id="8193092">(</span><span class="ident" id="8193093">t</span>&nbsp;<span class="op" id="8193095">*</span><span class="ident" id="8193096">testing</span><span class="op" id="8193103">.</span><span class="ident" id="8193104">T</span><span class="op" id="8193105">)</span>&nbsp;<span class="op" id="8193107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193110">test</span>&nbsp;<span class="op" id="8193115">:=</span>&nbsp;<span class="op" id="8193118">&amp;</span><span class="ident" id="8193119">serverTest</span><span class="op" id="8193129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193133">name</span><span class="op" id="8193137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8193142">&#34;RSA-RC4&#34;</span><span class="op" id="8193151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193155">command</span><span class="op" id="8193162">:</span>&nbsp;<span class="op" id="8193164">[</span><span class="op" id="8193165">]</span><span class="builtintype" id="8193166">string</span><span class="op" id="8193172">{</span><span class="string" id="8193173">&#34;openssl&#34;</span><span class="op" id="8193182">,</span>&nbsp;<span class="string" id="8193184">&#34;s_client&#34;</span><span class="op" id="8193194">,</span>&nbsp;<span class="string" id="8193196">&#34;-no_ticket&#34;</span><span class="op" id="8193208">,</span>&nbsp;<span class="string" id="8193210">&#34;-cipher&#34;</span><span class="op" id="8193219">,</span>&nbsp;<span class="string" id="8193221">&#34;RC4-SHA&#34;</span><span class="op" id="8193230">}</span><span class="op" id="8193231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193234">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193237">runServerTestSSLv3</span><span class="op" id="8193255">(</span><span class="ident" id="8193256">t</span><span class="op" id="8193257">,</span>&nbsp;<span class="ident" id="8193259">test</span><span class="op" id="8193263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193266">runServerTestTLS10</span><span class="op" id="8193284">(</span><span class="ident" id="8193285">t</span><span class="op" id="8193286">,</span>&nbsp;<span class="ident" id="8193288">test</span><span class="op" id="8193292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193295">runServerTestTLS11</span><span class="op" id="8193313">(</span><span class="ident" id="8193314">t</span><span class="op" id="8193315">,</span>&nbsp;<span class="ident" id="8193317">test</span><span class="op" id="8193321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193324">runServerTestTLS12</span><span class="op" id="8193342">(</span><span class="ident" id="8193343">t</span><span class="op" id="8193344">,</span>&nbsp;<span class="ident" id="8193346">test</span><span class="op" id="8193350">)</span><br>
<span class="lineno"></span><span class="op" id="8193352">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="8193355">func</span>&nbsp;<span class="ident" id="8193360">TestHandshakeServerRSA3DES</span><span class="op" id="8193386">(</span><span class="ident" id="8193387">t</span>&nbsp;<span class="op" id="8193389">*</span><span class="ident" id="8193390">testing</span><span class="op" id="8193397">.</span><span class="ident" id="8193398">T</span><span class="op" id="8193399">)</span>&nbsp;<span class="op" id="8193401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193404">test</span>&nbsp;<span class="op" id="8193409">:=</span>&nbsp;<span class="op" id="8193412">&amp;</span><span class="ident" id="8193413">serverTest</span><span class="op" id="8193423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193427">name</span><span class="op" id="8193431">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8193436">&#34;RSA-3DES&#34;</span><span class="op" id="8193446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193450">command</span><span class="op" id="8193457">:</span>&nbsp;<span class="op" id="8193459">[</span><span class="op" id="8193460">]</span><span class="builtintype" id="8193461">string</span><span class="op" id="8193467">{</span><span class="string" id="8193468">&#34;openssl&#34;</span><span class="op" id="8193477">,</span>&nbsp;<span class="string" id="8193479">&#34;s_client&#34;</span><span class="op" id="8193489">,</span>&nbsp;<span class="string" id="8193491">&#34;-no_ticket&#34;</span><span class="op" id="8193503">,</span>&nbsp;<span class="string" id="8193505">&#34;-cipher&#34;</span><span class="op" id="8193514">,</span>&nbsp;<span class="string" id="8193516">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="8193530">}</span><span class="op" id="8193531">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193537">runServerTestSSLv3</span><span class="op" id="8193555">(</span><span class="ident" id="8193556">t</span><span class="op" id="8193557">,</span>&nbsp;<span class="ident" id="8193559">test</span><span class="op" id="8193563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193566">runServerTestTLS10</span><span class="op" id="8193584">(</span><span class="ident" id="8193585">t</span><span class="op" id="8193586">,</span>&nbsp;<span class="ident" id="8193588">test</span><span class="op" id="8193592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193595">runServerTestTLS12</span><span class="op" id="8193613">(</span><span class="ident" id="8193614">t</span><span class="op" id="8193615">,</span>&nbsp;<span class="ident" id="8193617">test</span><span class="op" id="8193621">)</span><br>
<span class="lineno"></span><span class="op" id="8193623">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="8193626">func</span>&nbsp;<span class="ident" id="8193631">TestHandshakeServerRSAAES</span><span class="op" id="8193656">(</span><span class="ident" id="8193657">t</span>&nbsp;<span class="op" id="8193659">*</span><span class="ident" id="8193660">testing</span><span class="op" id="8193667">.</span><span class="ident" id="8193668">T</span><span class="op" id="8193669">)</span>&nbsp;<span class="op" id="8193671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193674">test</span>&nbsp;<span class="op" id="8193679">:=</span>&nbsp;<span class="op" id="8193682">&amp;</span><span class="ident" id="8193683">serverTest</span><span class="op" id="8193693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193697">name</span><span class="op" id="8193701">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8193706">&#34;RSA-AES&#34;</span><span class="op" id="8193715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193719">command</span><span class="op" id="8193726">:</span>&nbsp;<span class="op" id="8193728">[</span><span class="op" id="8193729">]</span><span class="builtintype" id="8193730">string</span><span class="op" id="8193736">{</span><span class="string" id="8193737">&#34;openssl&#34;</span><span class="op" id="8193746">,</span>&nbsp;<span class="string" id="8193748">&#34;s_client&#34;</span><span class="op" id="8193758">,</span>&nbsp;<span class="string" id="8193760">&#34;-no_ticket&#34;</span><span class="op" id="8193772">,</span>&nbsp;<span class="string" id="8193774">&#34;-cipher&#34;</span><span class="op" id="8193783">,</span>&nbsp;<span class="string" id="8193785">&#34;AES128-SHA&#34;</span><span class="op" id="8193797">}</span><span class="op" id="8193798">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193804">runServerTestSSLv3</span><span class="op" id="8193822">(</span><span class="ident" id="8193823">t</span><span class="op" id="8193824">,</span>&nbsp;<span class="ident" id="8193826">test</span><span class="op" id="8193830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193833">runServerTestTLS10</span><span class="op" id="8193851">(</span><span class="ident" id="8193852">t</span><span class="op" id="8193853">,</span>&nbsp;<span class="ident" id="8193855">test</span><span class="op" id="8193859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193862">runServerTestTLS12</span><span class="op" id="8193880">(</span><span class="ident" id="8193881">t</span><span class="op" id="8193882">,</span>&nbsp;<span class="ident" id="8193884">test</span><span class="op" id="8193888">)</span><br>
<span class="lineno"></span><span class="op" id="8193890">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="8193893">func</span>&nbsp;<span class="ident" id="8193898">TestHandshakeServerAESGCM</span><span class="op" id="8193923">(</span><span class="ident" id="8193924">t</span>&nbsp;<span class="op" id="8193926">*</span><span class="ident" id="8193927">testing</span><span class="op" id="8193934">.</span><span class="ident" id="8193935">T</span><span class="op" id="8193936">)</span>&nbsp;<span class="op" id="8193938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193941">test</span>&nbsp;<span class="op" id="8193946">:=</span>&nbsp;<span class="op" id="8193949">&amp;</span><span class="ident" id="8193950">serverTest</span><span class="op" id="8193960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193964">name</span><span class="op" id="8193968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8193973">&#34;RSA-AES-GCM&#34;</span><span class="op" id="8193986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193990">command</span><span class="op" id="8193997">:</span>&nbsp;<span class="op" id="8193999">[</span><span class="op" id="8194000">]</span><span class="builtintype" id="8194001">string</span><span class="op" id="8194007">{</span><span class="string" id="8194008">&#34;openssl&#34;</span><span class="op" id="8194017">,</span>&nbsp;<span class="string" id="8194019">&#34;s_client&#34;</span><span class="op" id="8194029">,</span>&nbsp;<span class="string" id="8194031">&#34;-no_ticket&#34;</span><span class="op" id="8194043">,</span>&nbsp;<span class="string" id="8194045">&#34;-cipher&#34;</span><span class="op" id="8194054">,</span>&nbsp;<span class="string" id="8194056">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8194085">}</span><span class="op" id="8194086">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194092">runServerTestTLS12</span><span class="op" id="8194110">(</span><span class="ident" id="8194111">t</span><span class="op" id="8194112">,</span>&nbsp;<span class="ident" id="8194114">test</span><span class="op" id="8194118">)</span><br>
<span class="lineno"></span><span class="op" id="8194120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8194123">func</span>&nbsp;<span class="ident" id="8194128">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="8194160">(</span><span class="ident" id="8194161">t</span>&nbsp;<span class="op" id="8194163">*</span><span class="ident" id="8194164">testing</span><span class="op" id="8194171">.</span><span class="ident" id="8194172">T</span><span class="op" id="8194173">)</span>&nbsp;<span class="op" id="8194175">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194178">config</span>&nbsp;<span class="op" id="8194185">:=</span>&nbsp;<span class="op" id="8194188">*</span><span class="ident" id="8194189">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194201">config</span><span class="op" id="8194207">.</span><span class="ident" id="8194208">Certificates</span>&nbsp;<span class="op" id="8194221">=</span>&nbsp;<span class="builtinfunc" id="8194223">make</span><span class="op" id="8194227">(</span><span class="op" id="8194228">[</span><span class="op" id="8194229">]</span><span class="ident" id="8194230">Certificate</span><span class="op" id="8194241">,</span>&nbsp;<span class="num" id="8194243">1</span><span class="op" id="8194244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194247">config</span><span class="op" id="8194253">.</span><span class="ident" id="8194254">Certificates</span><span class="op" id="8194266">[</span><span class="num" id="8194267">0</span><span class="op" id="8194268">]</span><span class="op" id="8194269">.</span><span class="ident" id="8194270">Certificate</span>&nbsp;<span class="op" id="8194282">=</span>&nbsp;<span class="op" id="8194284">[</span><span class="op" id="8194285">]</span><span class="op" id="8194286">[</span><span class="op" id="8194287">]</span><span class="builtintype" id="8194288">byte</span><span class="op" id="8194292">{</span><span class="ident" id="8194293">testECDSACertificate</span><span class="op" id="8194313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194316">config</span><span class="op" id="8194322">.</span><span class="ident" id="8194323">Certificates</span><span class="op" id="8194335">[</span><span class="num" id="8194336">0</span><span class="op" id="8194337">]</span><span class="op" id="8194338">.</span><span class="ident" id="8194339">PrivateKey</span>&nbsp;<span class="op" id="8194350">=</span>&nbsp;<span class="ident" id="8194352">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194373">config</span><span class="op" id="8194379">.</span><span class="ident" id="8194380">BuildNameToCertificate</span><span class="op" id="8194402">(</span><span class="op" id="8194403">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194407">test</span>&nbsp;<span class="op" id="8194412">:=</span>&nbsp;<span class="op" id="8194415">&amp;</span><span class="ident" id="8194416">serverTest</span><span class="op" id="8194426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194430">name</span><span class="op" id="8194434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8194439">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8194456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194460">command</span><span class="op" id="8194467">:</span>&nbsp;<span class="op" id="8194469">[</span><span class="op" id="8194470">]</span><span class="builtintype" id="8194471">string</span><span class="op" id="8194477">{</span><span class="string" id="8194478">&#34;openssl&#34;</span><span class="op" id="8194487">,</span>&nbsp;<span class="string" id="8194489">&#34;s_client&#34;</span><span class="op" id="8194499">,</span>&nbsp;<span class="string" id="8194501">&#34;-no_ticket&#34;</span><span class="op" id="8194513">,</span>&nbsp;<span class="string" id="8194515">&#34;-cipher&#34;</span><span class="op" id="8194524">,</span>&nbsp;<span class="string" id="8194526">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="8194550">}</span><span class="op" id="8194551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194555">config</span><span class="op" id="8194561">:</span>&nbsp;&nbsp;<span class="op" id="8194564">&amp;</span><span class="ident" id="8194565">config</span><span class="op" id="8194571">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194577">runServerTestTLS10</span><span class="op" id="8194595">(</span><span class="ident" id="8194596">t</span><span class="op" id="8194597">,</span>&nbsp;<span class="ident" id="8194599">test</span><span class="op" id="8194603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194606">runServerTestTLS12</span><span class="op" id="8194624">(</span><span class="ident" id="8194625">t</span><span class="op" id="8194626">,</span>&nbsp;<span class="ident" id="8194628">test</span><span class="op" id="8194632">)</span><br>
<span class="lineno"></span><span class="op" id="8194634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="8194637">func</span>&nbsp;<span class="ident" id="8194642">TestHandshakeServerALPN</span><span class="op" id="8194665">(</span><span class="ident" id="8194666">t</span>&nbsp;<span class="op" id="8194668">*</span><span class="ident" id="8194669">testing</span><span class="op" id="8194676">.</span><span class="ident" id="8194677">T</span><span class="op" id="8194678">)</span>&nbsp;<span class="op" id="8194680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194683">config</span>&nbsp;<span class="op" id="8194690">:=</span>&nbsp;<span class="op" id="8194693">*</span><span class="ident" id="8194694">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194706">config</span><span class="op" id="8194712">.</span><span class="ident" id="8194713">NextProtos</span>&nbsp;<span class="op" id="8194724">=</span>&nbsp;<span class="op" id="8194726">[</span><span class="op" id="8194727">]</span><span class="builtintype" id="8194728">string</span><span class="op" id="8194734">{</span><span class="string" id="8194735">&#34;proto1&#34;</span><span class="op" id="8194743">,</span>&nbsp;<span class="string" id="8194745">&#34;proto2&#34;</span><span class="op" id="8194753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194757">test</span>&nbsp;<span class="op" id="8194762">:=</span>&nbsp;<span class="op" id="8194765">&amp;</span><span class="ident" id="8194766">serverTest</span><span class="op" id="8194776">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194780">name</span><span class="op" id="8194784">:</span>&nbsp;<span class="string" id="8194786">&#34;ALPN&#34;</span><span class="op" id="8194792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8194796">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8194862">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194905">command</span><span class="op" id="8194912">:</span>&nbsp;<span class="op" id="8194914">[</span><span class="op" id="8194915">]</span><span class="builtintype" id="8194916">string</span><span class="op" id="8194922">{</span><span class="string" id="8194923">&#34;openssl&#34;</span><span class="op" id="8194932">,</span>&nbsp;<span class="string" id="8194934">&#34;s_client&#34;</span><span class="op" id="8194944">,</span>&nbsp;<span class="string" id="8194946">&#34;-alpn&#34;</span><span class="op" id="8194953">,</span>&nbsp;<span class="string" id="8194955">&#34;proto2,proto1&#34;</span><span class="op" id="8194970">}</span><span class="op" id="8194971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194975">config</span><span class="op" id="8194981">:</span>&nbsp;&nbsp;<span class="op" id="8194984">&amp;</span><span class="ident" id="8194985">config</span><span class="op" id="8194991">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194995">validate</span><span class="op" id="8195003">:</span>&nbsp;<span class="keyword" id="8195005">func</span><span class="op" id="8195009">(</span><span class="ident" id="8195010">state</span>&nbsp;<span class="ident" id="8195016">ConnectionState</span><span class="op" id="8195031">)</span>&nbsp;<span class="builtintype" id="8195033">error</span>&nbsp;<span class="op" id="8195039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8195044">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195103">if</span>&nbsp;<span class="ident" id="8195106">state</span><span class="op" id="8195111">.</span><span class="ident" id="8195112">NegotiatedProtocol</span>&nbsp;<span class="op" id="8195131">!=</span>&nbsp;<span class="string" id="8195134">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8195143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195149">return</span>&nbsp;<span class="ident" id="8195156">fmt</span><span class="op" id="8195159">.</span><span class="ident" id="8195160">Errorf</span><span class="op" id="8195166">(</span><span class="string" id="8195167">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8195199">,</span>&nbsp;<span class="ident" id="8195201">state</span><span class="op" id="8195206">.</span><span class="ident" id="8195207">NegotiatedProtocol</span><span class="op" id="8195225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195230">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195235">return</span>&nbsp;<span class="ident" id="8195242">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195248">}</span><span class="op" id="8195249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195255">runServerTestTLS12</span><span class="op" id="8195273">(</span><span class="ident" id="8195274">t</span><span class="op" id="8195275">,</span>&nbsp;<span class="ident" id="8195277">test</span><span class="op" id="8195281">)</span><br>
<span class="lineno"></span><span class="op" id="8195283">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="8195286">func</span>&nbsp;<span class="ident" id="8195291">TestHandshakeServerALPNNoMatch</span><span class="op" id="8195321">(</span><span class="ident" id="8195322">t</span>&nbsp;<span class="op" id="8195324">*</span><span class="ident" id="8195325">testing</span><span class="op" id="8195332">.</span><span class="ident" id="8195333">T</span><span class="op" id="8195334">)</span>&nbsp;<span class="op" id="8195336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195339">config</span>&nbsp;<span class="op" id="8195346">:=</span>&nbsp;<span class="op" id="8195349">*</span><span class="ident" id="8195350">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195362">config</span><span class="op" id="8195368">.</span><span class="ident" id="8195369">NextProtos</span>&nbsp;<span class="op" id="8195380">=</span>&nbsp;<span class="op" id="8195382">[</span><span class="op" id="8195383">]</span><span class="builtintype" id="8195384">string</span><span class="op" id="8195390">{</span><span class="string" id="8195391">&#34;proto3&#34;</span><span class="op" id="8195399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195403">test</span>&nbsp;<span class="op" id="8195408">:=</span>&nbsp;<span class="op" id="8195411">&amp;</span><span class="ident" id="8195412">serverTest</span><span class="op" id="8195422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195426">name</span><span class="op" id="8195430">:</span>&nbsp;<span class="string" id="8195432">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8195446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8195450">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8195516">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195559">command</span><span class="op" id="8195566">:</span>&nbsp;<span class="op" id="8195568">[</span><span class="op" id="8195569">]</span><span class="builtintype" id="8195570">string</span><span class="op" id="8195576">{</span><span class="string" id="8195577">&#34;openssl&#34;</span><span class="op" id="8195586">,</span>&nbsp;<span class="string" id="8195588">&#34;s_client&#34;</span><span class="op" id="8195598">,</span>&nbsp;<span class="string" id="8195600">&#34;-alpn&#34;</span><span class="op" id="8195607">,</span>&nbsp;<span class="string" id="8195609">&#34;proto2,proto1&#34;</span><span class="op" id="8195624">}</span><span class="op" id="8195625">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195629">config</span><span class="op" id="8195635">:</span>&nbsp;&nbsp;<span class="op" id="8195638">&amp;</span><span class="ident" id="8195639">config</span><span class="op" id="8195645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195649">validate</span><span class="op" id="8195657">:</span>&nbsp;<span class="keyword" id="8195659">func</span><span class="op" id="8195663">(</span><span class="ident" id="8195664">state</span>&nbsp;<span class="ident" id="8195670">ConnectionState</span><span class="op" id="8195685">)</span>&nbsp;<span class="builtintype" id="8195687">error</span>&nbsp;<span class="op" id="8195693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8195698">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8195757">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195800">if</span>&nbsp;<span class="ident" id="8195803">state</span><span class="op" id="8195808">.</span><span class="ident" id="8195809">NegotiatedProtocol</span>&nbsp;<span class="op" id="8195828">!=</span>&nbsp;<span class="string" id="8195831">&#34;&#34;</span>&nbsp;<span class="op" id="8195834">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195840">return</span>&nbsp;<span class="ident" id="8195847">fmt</span><span class="op" id="8195850">.</span><span class="ident" id="8195851">Errorf</span><span class="op" id="8195857">(</span><span class="string" id="8195858">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8195886">,</span>&nbsp;<span class="ident" id="8195888">state</span><span class="op" id="8195893">.</span><span class="ident" id="8195894">NegotiatedProtocol</span><span class="op" id="8195912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195922">return</span>&nbsp;<span class="ident" id="8195929">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195935">}</span><span class="op" id="8195936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195939">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195942">runServerTestTLS12</span><span class="op" id="8195960">(</span><span class="ident" id="8195961">t</span><span class="op" id="8195962">,</span>&nbsp;<span class="ident" id="8195964">test</span><span class="op" id="8195968">)</span><br>
<span class="lineno"></span><span class="op" id="8195970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8195973">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8196045">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="8196125">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8196189">func</span>&nbsp;<span class="ident" id="8196194">TestHandshakeServerSNI</span><span class="op" id="8196216">(</span><span class="ident" id="8196217">t</span>&nbsp;<span class="op" id="8196219">*</span><span class="ident" id="8196220">testing</span><span class="op" id="8196227">.</span><span class="ident" id="8196228">T</span><span class="op" id="8196229">)</span>&nbsp;<span class="op" id="8196231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196234">test</span>&nbsp;<span class="op" id="8196239">:=</span>&nbsp;<span class="op" id="8196242">&amp;</span><span class="ident" id="8196243">serverTest</span><span class="op" id="8196253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196257">name</span><span class="op" id="8196261">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8196266">&#34;SNI&#34;</span><span class="op" id="8196271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196275">command</span><span class="op" id="8196282">:</span>&nbsp;<span class="op" id="8196284">[</span><span class="op" id="8196285">]</span><span class="builtintype" id="8196286">string</span><span class="op" id="8196292">{</span><span class="string" id="8196293">&#34;openssl&#34;</span><span class="op" id="8196302">,</span>&nbsp;<span class="string" id="8196304">&#34;s_client&#34;</span><span class="op" id="8196314">,</span>&nbsp;<span class="string" id="8196316">&#34;-no_ticket&#34;</span><span class="op" id="8196328">,</span>&nbsp;<span class="string" id="8196330">&#34;-cipher&#34;</span><span class="op" id="8196339">,</span>&nbsp;<span class="string" id="8196341">&#34;AES128-SHA&#34;</span><span class="op" id="8196353">,</span>&nbsp;<span class="string" id="8196355">&#34;-servername&#34;</span><span class="op" id="8196368">,</span>&nbsp;<span class="string" id="8196370">&#34;snitest.com&#34;</span><span class="op" id="8196383">}</span><span class="op" id="8196384">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196390">runServerTestTLS12</span><span class="op" id="8196408">(</span><span class="ident" id="8196409">t</span><span class="op" id="8196410">,</span>&nbsp;<span class="ident" id="8196412">test</span><span class="op" id="8196416">)</span><br>
<span class="lineno"></span><span class="op" id="8196418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8196421">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="8196500">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="8196543">func</span>&nbsp;<span class="ident" id="8196548">TestHandshakeServerSNIGetCertificate</span><span class="op" id="8196584">(</span><span class="ident" id="8196585">t</span>&nbsp;<span class="op" id="8196587">*</span><span class="ident" id="8196588">testing</span><span class="op" id="8196595">.</span><span class="ident" id="8196596">T</span><span class="op" id="8196597">)</span>&nbsp;<span class="op" id="8196599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196602">config</span>&nbsp;<span class="op" id="8196609">:=</span>&nbsp;<span class="op" id="8196612">*</span><span class="ident" id="8196613">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8196626">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196695">nameToCert</span>&nbsp;<span class="op" id="8196706">:=</span>&nbsp;<span class="ident" id="8196709">config</span><span class="op" id="8196715">.</span><span class="ident" id="8196716">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196735">config</span><span class="op" id="8196741">.</span><span class="ident" id="8196742">NameToCertificate</span>&nbsp;<span class="op" id="8196760">=</span>&nbsp;<span class="ident" id="8196762">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196767">config</span><span class="op" id="8196773">.</span><span class="ident" id="8196774">GetCertificate</span>&nbsp;<span class="op" id="8196789">=</span>&nbsp;<span class="keyword" id="8196791">func</span><span class="op" id="8196795">(</span><span class="ident" id="8196796">clientHello</span>&nbsp;<span class="op" id="8196808">*</span><span class="ident" id="8196809">ClientHelloInfo</span><span class="op" id="8196824">)</span>&nbsp;<span class="op" id="8196826">(</span><span class="op" id="8196827">*</span><span class="ident" id="8196828">Certificate</span><span class="op" id="8196839">,</span>&nbsp;<span class="builtintype" id="8196841">error</span><span class="op" id="8196846">)</span>&nbsp;<span class="op" id="8196848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196852">cert</span><span class="op" id="8196856">,</span>&nbsp;<span class="ident" id="8196858">_</span>&nbsp;<span class="op" id="8196860">:=</span>&nbsp;<span class="ident" id="8196863">nameToCert</span><span class="op" id="8196873">[</span><span class="ident" id="8196874">clientHello</span><span class="op" id="8196885">.</span><span class="ident" id="8196886">ServerName</span><span class="op" id="8196896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196900">return</span>&nbsp;<span class="ident" id="8196907">cert</span><span class="op" id="8196911">,</span>&nbsp;<span class="ident" id="8196913">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196921">test</span>&nbsp;<span class="op" id="8196926">:=</span>&nbsp;<span class="op" id="8196929">&amp;</span><span class="ident" id="8196930">serverTest</span><span class="op" id="8196940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196944">name</span><span class="op" id="8196948">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8196953">&#34;SNI&#34;</span><span class="op" id="8196958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196962">command</span><span class="op" id="8196969">:</span>&nbsp;<span class="op" id="8196971">[</span><span class="op" id="8196972">]</span><span class="builtintype" id="8196973">string</span><span class="op" id="8196979">{</span><span class="string" id="8196980">&#34;openssl&#34;</span><span class="op" id="8196989">,</span>&nbsp;<span class="string" id="8196991">&#34;s_client&#34;</span><span class="op" id="8197001">,</span>&nbsp;<span class="string" id="8197003">&#34;-no_ticket&#34;</span><span class="op" id="8197015">,</span>&nbsp;<span class="string" id="8197017">&#34;-cipher&#34;</span><span class="op" id="8197026">,</span>&nbsp;<span class="string" id="8197028">&#34;AES128-SHA&#34;</span><span class="op" id="8197040">,</span>&nbsp;<span class="string" id="8197042">&#34;-servername&#34;</span><span class="op" id="8197055">,</span>&nbsp;<span class="string" id="8197057">&#34;snitest.com&#34;</span><span class="op" id="8197070">}</span><span class="op" id="8197071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197075">config</span><span class="op" id="8197081">:</span>&nbsp;&nbsp;<span class="op" id="8197084">&amp;</span><span class="ident" id="8197085">config</span><span class="op" id="8197091">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197097">runServerTestTLS12</span><span class="op" id="8197115">(</span><span class="ident" id="8197116">t</span><span class="op" id="8197117">,</span>&nbsp;<span class="ident" id="8197119">test</span><span class="op" id="8197123">)</span><br>
<span class="lineno"></span><span class="op" id="8197125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8197128">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="8197187">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8197262">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8197336">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8197366">func</span>&nbsp;<span class="ident" id="8197371">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="8197415">(</span><span class="ident" id="8197416">t</span>&nbsp;<span class="op" id="8197418">*</span><span class="ident" id="8197419">testing</span><span class="op" id="8197426">.</span><span class="ident" id="8197427">T</span><span class="op" id="8197428">)</span>&nbsp;<span class="op" id="8197430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197433">config</span>&nbsp;<span class="op" id="8197440">:=</span>&nbsp;<span class="op" id="8197443">*</span><span class="ident" id="8197444">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197457">config</span><span class="op" id="8197463">.</span><span class="ident" id="8197464">GetCertificate</span>&nbsp;<span class="op" id="8197479">=</span>&nbsp;<span class="keyword" id="8197481">func</span><span class="op" id="8197485">(</span><span class="ident" id="8197486">clientHello</span>&nbsp;<span class="op" id="8197498">*</span><span class="ident" id="8197499">ClientHelloInfo</span><span class="op" id="8197514">)</span>&nbsp;<span class="op" id="8197516">(</span><span class="op" id="8197517">*</span><span class="ident" id="8197518">Certificate</span><span class="op" id="8197529">,</span>&nbsp;<span class="builtintype" id="8197531">error</span><span class="op" id="8197536">)</span>&nbsp;<span class="op" id="8197538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197542">return</span>&nbsp;<span class="ident" id="8197549">nil</span><span class="op" id="8197552">,</span>&nbsp;<span class="ident" id="8197554">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197562">test</span>&nbsp;<span class="op" id="8197567">:=</span>&nbsp;<span class="op" id="8197570">&amp;</span><span class="ident" id="8197571">serverTest</span><span class="op" id="8197581">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197585">name</span><span class="op" id="8197589">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8197594">&#34;SNI&#34;</span><span class="op" id="8197599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197603">command</span><span class="op" id="8197610">:</span>&nbsp;<span class="op" id="8197612">[</span><span class="op" id="8197613">]</span><span class="builtintype" id="8197614">string</span><span class="op" id="8197620">{</span><span class="string" id="8197621">&#34;openssl&#34;</span><span class="op" id="8197630">,</span>&nbsp;<span class="string" id="8197632">&#34;s_client&#34;</span><span class="op" id="8197642">,</span>&nbsp;<span class="string" id="8197644">&#34;-no_ticket&#34;</span><span class="op" id="8197656">,</span>&nbsp;<span class="string" id="8197658">&#34;-cipher&#34;</span><span class="op" id="8197667">,</span>&nbsp;<span class="string" id="8197669">&#34;AES128-SHA&#34;</span><span class="op" id="8197681">,</span>&nbsp;<span class="string" id="8197683">&#34;-servername&#34;</span><span class="op" id="8197696">,</span>&nbsp;<span class="string" id="8197698">&#34;snitest.com&#34;</span><span class="op" id="8197711">}</span><span class="op" id="8197712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197716">config</span><span class="op" id="8197722">:</span>&nbsp;&nbsp;<span class="op" id="8197725">&amp;</span><span class="ident" id="8197726">config</span><span class="op" id="8197732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197738">runServerTestTLS12</span><span class="op" id="8197756">(</span><span class="ident" id="8197757">t</span><span class="op" id="8197758">,</span>&nbsp;<span class="ident" id="8197760">test</span><span class="op" id="8197764">)</span><br>
<span class="lineno">625</span><span class="op" id="8197766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8197769">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8197845">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="8197886">func</span>&nbsp;<span class="ident" id="8197891">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="8197932">(</span><span class="ident" id="8197933">t</span>&nbsp;<span class="op" id="8197935">*</span><span class="ident" id="8197936">testing</span><span class="op" id="8197943">.</span><span class="ident" id="8197944">T</span><span class="op" id="8197945">)</span>&nbsp;<span class="op" id="8197947">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197950">config</span>&nbsp;<span class="op" id="8197957">:=</span>&nbsp;<span class="op" id="8197960">*</span><span class="ident" id="8197961">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197974">config</span><span class="op" id="8197980">.</span><span class="ident" id="8197981">GetCertificate</span>&nbsp;<span class="op" id="8197996">=</span>&nbsp;<span class="keyword" id="8197998">func</span><span class="op" id="8198002">(</span><span class="ident" id="8198003">clientHello</span>&nbsp;<span class="op" id="8198015">*</span><span class="ident" id="8198016">ClientHelloInfo</span><span class="op" id="8198031">)</span>&nbsp;<span class="op" id="8198033">(</span><span class="op" id="8198034">*</span><span class="ident" id="8198035">Certificate</span><span class="op" id="8198046">,</span>&nbsp;<span class="builtintype" id="8198048">error</span><span class="op" id="8198053">)</span>&nbsp;<span class="op" id="8198055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198059">return</span>&nbsp;<span class="ident" id="8198066">nil</span><span class="op" id="8198069">,</span>&nbsp;<span class="ident" id="8198071">fmt</span><span class="op" id="8198074">.</span><span class="ident" id="8198075">Errorf</span><span class="op" id="8198081">(</span><span class="string" id="8198082">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="8198112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198115">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198118">test</span>&nbsp;<span class="op" id="8198123">:=</span>&nbsp;<span class="op" id="8198126">&amp;</span><span class="ident" id="8198127">serverTest</span><span class="op" id="8198137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198141">name</span><span class="op" id="8198145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8198154">&#34;SNI&#34;</span><span class="op" id="8198159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198163">command</span><span class="op" id="8198170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8198176">[</span><span class="op" id="8198177">]</span><span class="builtintype" id="8198178">string</span><span class="op" id="8198184">{</span><span class="string" id="8198185">&#34;openssl&#34;</span><span class="op" id="8198194">,</span>&nbsp;<span class="string" id="8198196">&#34;s_client&#34;</span><span class="op" id="8198206">,</span>&nbsp;<span class="string" id="8198208">&#34;-no_ticket&#34;</span><span class="op" id="8198220">,</span>&nbsp;<span class="string" id="8198222">&#34;-cipher&#34;</span><span class="op" id="8198231">,</span>&nbsp;<span class="string" id="8198233">&#34;AES128-SHA&#34;</span><span class="op" id="8198245">,</span>&nbsp;<span class="string" id="8198247">&#34;-servername&#34;</span><span class="op" id="8198260">,</span>&nbsp;<span class="string" id="8198262">&#34;snitest.com&#34;</span><span class="op" id="8198275">}</span><span class="op" id="8198276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198280">config</span><span class="op" id="8198286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8198293">&amp;</span><span class="ident" id="8198294">config</span><span class="op" id="8198300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198304">expectAlert</span><span class="op" id="8198315">:</span>&nbsp;<span class="builtintype" id="8198317">true</span><span class="op" id="8198321">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198327">runServerTestTLS12</span><span class="op" id="8198345">(</span><span class="ident" id="8198346">t</span><span class="op" id="8198347">,</span>&nbsp;<span class="ident" id="8198349">test</span><span class="op" id="8198353">)</span><br>
<span class="lineno"></span><span class="op" id="8198355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8198358">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="8198438">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8198512">func</span>&nbsp;<span class="ident" id="8198517">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="8198551">(</span><span class="ident" id="8198552">t</span>&nbsp;<span class="op" id="8198554">*</span><span class="ident" id="8198555">testing</span><span class="op" id="8198562">.</span><span class="ident" id="8198563">T</span><span class="op" id="8198564">)</span>&nbsp;<span class="op" id="8198566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198569">config</span>&nbsp;<span class="op" id="8198576">:=</span>&nbsp;<span class="op" id="8198579">*</span><span class="ident" id="8198580">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198592">config</span><span class="op" id="8198598">.</span><span class="ident" id="8198599">CipherSuites</span>&nbsp;<span class="op" id="8198612">=</span>&nbsp;<span class="op" id="8198614">[</span><span class="op" id="8198615">]</span><span class="builtintype" id="8198616">uint16</span><span class="op" id="8198622">{</span><span class="ident" id="8198623">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8198659">,</span>&nbsp;<span class="ident" id="8198661">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8198695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198698">config</span><span class="op" id="8198704">.</span><span class="ident" id="8198705">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8198730">=</span>&nbsp;<span class="builtintype" id="8198732">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198739">test</span>&nbsp;<span class="op" id="8198744">:=</span>&nbsp;<span class="op" id="8198747">&amp;</span><span class="ident" id="8198748">serverTest</span><span class="op" id="8198758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198762">name</span><span class="op" id="8198766">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8198770">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="8198800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198804">config</span><span class="op" id="8198810">:</span>&nbsp;<span class="op" id="8198812">&amp;</span><span class="ident" id="8198813">config</span><span class="op" id="8198819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198822">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198825">runServerTestTLS12</span><span class="op" id="8198843">(</span><span class="ident" id="8198844">t</span><span class="op" id="8198845">,</span>&nbsp;<span class="ident" id="8198847">test</span><span class="op" id="8198851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198855">config</span>&nbsp;<span class="op" id="8198862">=</span>&nbsp;<span class="op" id="8198864">*</span><span class="ident" id="8198865">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198877">config</span><span class="op" id="8198883">.</span><span class="ident" id="8198884">CipherSuites</span>&nbsp;<span class="op" id="8198897">=</span>&nbsp;<span class="op" id="8198899">[</span><span class="op" id="8198900">]</span><span class="builtintype" id="8198901">uint16</span><span class="op" id="8198907">{</span><span class="ident" id="8198908">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8198942">,</span>&nbsp;<span class="ident" id="8198944">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8198980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198983">config</span><span class="op" id="8198989">.</span><span class="ident" id="8198990">Certificates</span>&nbsp;<span class="op" id="8199003">=</span>&nbsp;<span class="op" id="8199005">[</span><span class="op" id="8199006">]</span><span class="ident" id="8199007">Certificate</span><span class="op" id="8199018">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199027">Certificate</span><span class="op" id="8199038">:</span>&nbsp;<span class="op" id="8199040">[</span><span class="op" id="8199041">]</span><span class="op" id="8199042">[</span><span class="op" id="8199043">]</span><span class="builtintype" id="8199044">byte</span><span class="op" id="8199048">{</span><span class="ident" id="8199049">testECDSACertificate</span><span class="op" id="8199069">}</span><span class="op" id="8199070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199075">PrivateKey</span><span class="op" id="8199085">:</span>&nbsp;&nbsp;<span class="ident" id="8199088">testECDSAPrivateKey</span><span class="op" id="8199107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199111">}</span><span class="op" id="8199112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199115">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199118">config</span><span class="op" id="8199124">.</span><span class="ident" id="8199125">BuildNameToCertificate</span><span class="op" id="8199147">(</span><span class="op" id="8199148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199151">config</span><span class="op" id="8199157">.</span><span class="ident" id="8199158">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8199183">=</span>&nbsp;<span class="builtintype" id="8199185">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199192">test</span>&nbsp;<span class="op" id="8199197">=</span>&nbsp;<span class="op" id="8199199">&amp;</span><span class="ident" id="8199200">serverTest</span><span class="op" id="8199210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199214">name</span><span class="op" id="8199218">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8199222">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="8199254">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199258">config</span><span class="op" id="8199264">:</span>&nbsp;<span class="op" id="8199266">&amp;</span><span class="ident" id="8199267">config</span><span class="op" id="8199273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199279">runServerTestTLS12</span><span class="op" id="8199297">(</span><span class="ident" id="8199298">t</span><span class="op" id="8199299">,</span>&nbsp;<span class="ident" id="8199301">test</span><span class="op" id="8199305">)</span><br>
<span class="lineno"></span><span class="op" id="8199307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="8199310">func</span>&nbsp;<span class="ident" id="8199315">TestResumption</span><span class="op" id="8199329">(</span><span class="ident" id="8199330">t</span>&nbsp;<span class="op" id="8199332">*</span><span class="ident" id="8199333">testing</span><span class="op" id="8199340">.</span><span class="ident" id="8199341">T</span><span class="op" id="8199342">)</span>&nbsp;<span class="op" id="8199344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199347">sessionFilePath</span>&nbsp;<span class="op" id="8199363">:=</span>&nbsp;<span class="ident" id="8199366">tempFile</span><span class="op" id="8199374">(</span><span class="string" id="8199375">&#34;&#34;</span><span class="op" id="8199377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199380">defer</span>&nbsp;<span class="ident" id="8199386">os</span><span class="op" id="8199388">.</span><span class="ident" id="8199389">Remove</span><span class="op" id="8199395">(</span><span class="ident" id="8199396">sessionFilePath</span><span class="op" id="8199411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199415">test</span>&nbsp;<span class="op" id="8199420">:=</span>&nbsp;<span class="op" id="8199423">&amp;</span><span class="ident" id="8199424">serverTest</span><span class="op" id="8199434">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199438">name</span><span class="op" id="8199442">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8199447">&#34;IssueTicket&#34;</span><span class="op" id="8199460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199464">command</span><span class="op" id="8199471">:</span>&nbsp;<span class="op" id="8199473">[</span><span class="op" id="8199474">]</span><span class="builtintype" id="8199475">string</span><span class="op" id="8199481">{</span><span class="string" id="8199482">&#34;openssl&#34;</span><span class="op" id="8199491">,</span>&nbsp;<span class="string" id="8199493">&#34;s_client&#34;</span><span class="op" id="8199503">,</span>&nbsp;<span class="string" id="8199505">&#34;-cipher&#34;</span><span class="op" id="8199514">,</span>&nbsp;<span class="string" id="8199516">&#34;RC4-SHA&#34;</span><span class="op" id="8199525">,</span>&nbsp;<span class="string" id="8199527">&#34;-sess_out&#34;</span><span class="op" id="8199538">,</span>&nbsp;<span class="ident" id="8199540">sessionFilePath</span><span class="op" id="8199555">}</span><span class="op" id="8199556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199562">runServerTestTLS12</span><span class="op" id="8199580">(</span><span class="ident" id="8199581">t</span><span class="op" id="8199582">,</span>&nbsp;<span class="ident" id="8199584">test</span><span class="op" id="8199588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199592">test</span>&nbsp;<span class="op" id="8199597">=</span>&nbsp;<span class="op" id="8199599">&amp;</span><span class="ident" id="8199600">serverTest</span><span class="op" id="8199610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199614">name</span><span class="op" id="8199618">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8199623">&#34;Resume&#34;</span><span class="op" id="8199631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199635">command</span><span class="op" id="8199642">:</span>&nbsp;<span class="op" id="8199644">[</span><span class="op" id="8199645">]</span><span class="builtintype" id="8199646">string</span><span class="op" id="8199652">{</span><span class="string" id="8199653">&#34;openssl&#34;</span><span class="op" id="8199662">,</span>&nbsp;<span class="string" id="8199664">&#34;s_client&#34;</span><span class="op" id="8199674">,</span>&nbsp;<span class="string" id="8199676">&#34;-cipher&#34;</span><span class="op" id="8199685">,</span>&nbsp;<span class="string" id="8199687">&#34;RC4-SHA&#34;</span><span class="op" id="8199696">,</span>&nbsp;<span class="string" id="8199698">&#34;-sess_in&#34;</span><span class="op" id="8199708">,</span>&nbsp;<span class="ident" id="8199710">sessionFilePath</span><span class="op" id="8199725">}</span><span class="op" id="8199726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199732">runServerTestTLS12</span><span class="op" id="8199750">(</span><span class="ident" id="8199751">t</span><span class="op" id="8199752">,</span>&nbsp;<span class="ident" id="8199754">test</span><span class="op" id="8199758">)</span><br>
<span class="lineno">690</span><span class="op" id="8199760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8199763">func</span>&nbsp;<span class="ident" id="8199768">TestResumptionDisabled</span><span class="op" id="8199790">(</span><span class="ident" id="8199791">t</span>&nbsp;<span class="op" id="8199793">*</span><span class="ident" id="8199794">testing</span><span class="op" id="8199801">.</span><span class="ident" id="8199802">T</span><span class="op" id="8199803">)</span>&nbsp;<span class="op" id="8199805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199808">sessionFilePath</span>&nbsp;<span class="op" id="8199824">:=</span>&nbsp;<span class="ident" id="8199827">tempFile</span><span class="op" id="8199835">(</span><span class="string" id="8199836">&#34;&#34;</span><span class="op" id="8199838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199841">defer</span>&nbsp;<span class="ident" id="8199847">os</span><span class="op" id="8199849">.</span><span class="ident" id="8199850">Remove</span><span class="op" id="8199856">(</span><span class="ident" id="8199857">sessionFilePath</span><span class="op" id="8199872">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199876">config</span>&nbsp;<span class="op" id="8199883">:=</span>&nbsp;<span class="op" id="8199886">*</span><span class="ident" id="8199887">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199900">test</span>&nbsp;<span class="op" id="8199905">:=</span>&nbsp;<span class="op" id="8199908">&amp;</span><span class="ident" id="8199909">serverTest</span><span class="op" id="8199919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199923">name</span><span class="op" id="8199927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8199932">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="8199955">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199959">command</span><span class="op" id="8199966">:</span>&nbsp;<span class="op" id="8199968">[</span><span class="op" id="8199969">]</span><span class="builtintype" id="8199970">string</span><span class="op" id="8199976">{</span><span class="string" id="8199977">&#34;openssl&#34;</span><span class="op" id="8199986">,</span>&nbsp;<span class="string" id="8199988">&#34;s_client&#34;</span><span class="op" id="8199998">,</span>&nbsp;<span class="string" id="8200000">&#34;-cipher&#34;</span><span class="op" id="8200009">,</span>&nbsp;<span class="string" id="8200011">&#34;RC4-SHA&#34;</span><span class="op" id="8200020">,</span>&nbsp;<span class="string" id="8200022">&#34;-sess_out&#34;</span><span class="op" id="8200033">,</span>&nbsp;<span class="ident" id="8200035">sessionFilePath</span><span class="op" id="8200050">}</span><span class="op" id="8200051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200055">config</span><span class="op" id="8200061">:</span>&nbsp;&nbsp;<span class="op" id="8200064">&amp;</span><span class="ident" id="8200065">config</span><span class="op" id="8200071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8200074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200077">runServerTestTLS12</span><span class="op" id="8200095">(</span><span class="ident" id="8200096">t</span><span class="op" id="8200097">,</span>&nbsp;<span class="ident" id="8200099">test</span><span class="op" id="8200103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200107">config</span><span class="op" id="8200113">.</span><span class="ident" id="8200114">SessionTicketsDisabled</span>&nbsp;<span class="op" id="8200137">=</span>&nbsp;<span class="builtintype" id="8200139">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200146">test</span>&nbsp;<span class="op" id="8200151">=</span>&nbsp;<span class="op" id="8200153">&amp;</span><span class="ident" id="8200154">serverTest</span><span class="op" id="8200164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200168">name</span><span class="op" id="8200172">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8200177">&#34;ResumeDisabled&#34;</span><span class="op" id="8200193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200197">command</span><span class="op" id="8200204">:</span>&nbsp;<span class="op" id="8200206">[</span><span class="op" id="8200207">]</span><span class="builtintype" id="8200208">string</span><span class="op" id="8200214">{</span><span class="string" id="8200215">&#34;openssl&#34;</span><span class="op" id="8200224">,</span>&nbsp;<span class="string" id="8200226">&#34;s_client&#34;</span><span class="op" id="8200236">,</span>&nbsp;<span class="string" id="8200238">&#34;-cipher&#34;</span><span class="op" id="8200247">,</span>&nbsp;<span class="string" id="8200249">&#34;RC4-SHA&#34;</span><span class="op" id="8200258">,</span>&nbsp;<span class="string" id="8200260">&#34;-sess_in&#34;</span><span class="op" id="8200270">,</span>&nbsp;<span class="ident" id="8200272">sessionFilePath</span><span class="op" id="8200287">}</span><span class="op" id="8200288">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200292">config</span><span class="op" id="8200298">:</span>&nbsp;&nbsp;<span class="op" id="8200301">&amp;</span><span class="ident" id="8200302">config</span><span class="op" id="8200308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8200311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200314">runServerTestTLS12</span><span class="op" id="8200332">(</span><span class="ident" id="8200333">t</span><span class="op" id="8200334">,</span>&nbsp;<span class="ident" id="8200336">test</span><span class="op" id="8200340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8200344">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8200416">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="8200484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8200487">func</span>&nbsp;<span class="ident" id="8200492">TestFallbackSCSV</span><span class="op" id="8200508">(</span><span class="ident" id="8200509">t</span>&nbsp;<span class="op" id="8200511">*</span><span class="ident" id="8200512">testing</span><span class="op" id="8200519">.</span><span class="ident" id="8200520">T</span><span class="op" id="8200521">)</span>&nbsp;<span class="op" id="8200523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200526">test</span>&nbsp;<span class="op" id="8200531">:=</span>&nbsp;<span class="op" id="8200534">&amp;</span><span class="ident" id="8200535">serverTest</span><span class="op" id="8200545">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200549">name</span><span class="op" id="8200553">:</span>&nbsp;<span class="string" id="8200555">&#34;FallbackSCSV&#34;</span><span class="op" id="8200569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8200573">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200634">command</span><span class="op" id="8200641">:</span>&nbsp;<span class="op" id="8200643">[</span><span class="op" id="8200644">]</span><span class="builtintype" id="8200645">string</span><span class="op" id="8200651">{</span><span class="string" id="8200652">&#34;openssl&#34;</span><span class="op" id="8200661">,</span>&nbsp;<span class="string" id="8200663">&#34;s_client&#34;</span><span class="op" id="8200673">,</span>&nbsp;<span class="string" id="8200675">&#34;-fallback_scsv&#34;</span><span class="op" id="8200691">}</span><span class="op" id="8200692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200696">expectHandshakeErrorIncluding</span><span class="op" id="8200725">:</span>&nbsp;<span class="string" id="8200727">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="8200759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8200762">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200765">runServerTestTLS11</span><span class="op" id="8200783">(</span><span class="ident" id="8200784">t</span><span class="op" id="8200785">,</span>&nbsp;<span class="ident" id="8200787">test</span><span class="op" id="8200791">)</span><br>
<span class="lineno"></span><span class="op" id="8200793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8200796">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="8200857">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="8200919">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8200955">const</span>&nbsp;<span class="ident" id="8200961">clientCertificatePEM</span>&nbsp;<span class="op" id="8200982">=</span>&nbsp;<span class="string" id="8200984">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8201717">const</span>&nbsp;<span class="ident" id="8201723">clientKeyPEM</span>&nbsp;<span class="op" id="8201736">=</span>&nbsp;<span class="string" id="8201738">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8202625">const</span>&nbsp;<span class="ident" id="8202631">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="8202657">=</span>&nbsp;<span class="string" id="8202659">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8203412">const</span>&nbsp;<span class="ident" id="8203418">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="8203436">=</span>&nbsp;<span class="string" id="8203438">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="8203878">func</span>&nbsp;<span class="ident" id="8203883">TestClientAuth</span><span class="op" id="8203897">(</span><span class="ident" id="8203898">t</span>&nbsp;<span class="op" id="8203900">*</span><span class="ident" id="8203901">testing</span><span class="op" id="8203908">.</span><span class="ident" id="8203909">T</span><span class="op" id="8203910">)</span>&nbsp;<span class="op" id="8203912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203915">var</span>&nbsp;<span class="ident" id="8203919">certPath</span><span class="op" id="8203927">,</span>&nbsp;<span class="ident" id="8203929">keyPath</span><span class="op" id="8203936">,</span>&nbsp;<span class="ident" id="8203938">ecdsaCertPath</span><span class="op" id="8203951">,</span>&nbsp;<span class="ident" id="8203953">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="8203966">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203975">if</span>&nbsp;<span class="op" id="8203978">*</span><span class="ident" id="8203979">update</span>&nbsp;<span class="op" id="8203986">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203990">certPath</span>&nbsp;<span class="op" id="8203999">=</span>&nbsp;<span class="ident" id="8204001">tempFile</span><span class="op" id="8204009">(</span><span class="ident" id="8204010">clientCertificatePEM</span><span class="op" id="8204030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204034">defer</span>&nbsp;<span class="ident" id="8204040">os</span><span class="op" id="8204042">.</span><span class="ident" id="8204043">Remove</span><span class="op" id="8204049">(</span><span class="ident" id="8204050">certPath</span><span class="op" id="8204058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204062">keyPath</span>&nbsp;<span class="op" id="8204070">=</span>&nbsp;<span class="ident" id="8204072">tempFile</span><span class="op" id="8204080">(</span><span class="ident" id="8204081">clientKeyPEM</span><span class="op" id="8204093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204097">defer</span>&nbsp;<span class="ident" id="8204103">os</span><span class="op" id="8204105">.</span><span class="ident" id="8204106">Remove</span><span class="op" id="8204112">(</span><span class="ident" id="8204113">keyPath</span><span class="op" id="8204120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204124">ecdsaCertPath</span>&nbsp;<span class="op" id="8204138">=</span>&nbsp;<span class="ident" id="8204140">tempFile</span><span class="op" id="8204148">(</span><span class="ident" id="8204149">clientECDSACertificatePEM</span><span class="op" id="8204174">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204178">defer</span>&nbsp;<span class="ident" id="8204184">os</span><span class="op" id="8204186">.</span><span class="ident" id="8204187">Remove</span><span class="op" id="8204193">(</span><span class="ident" id="8204194">ecdsaCertPath</span><span class="op" id="8204207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204211">ecdsaKeyPath</span>&nbsp;<span class="op" id="8204224">=</span>&nbsp;<span class="ident" id="8204226">tempFile</span><span class="op" id="8204234">(</span><span class="ident" id="8204235">clientECDSAKeyPEM</span><span class="op" id="8204252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204256">defer</span>&nbsp;<span class="ident" id="8204262">os</span><span class="op" id="8204264">.</span><span class="ident" id="8204265">Remove</span><span class="op" id="8204271">(</span><span class="ident" id="8204272">ecdsaKeyPath</span><span class="op" id="8204284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204291">config</span>&nbsp;<span class="op" id="8204298">:=</span>&nbsp;<span class="op" id="8204301">*</span><span class="ident" id="8204302">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204314">config</span><span class="op" id="8204320">.</span><span class="ident" id="8204321">ClientAuth</span>&nbsp;<span class="op" id="8204332">=</span>&nbsp;<span class="ident" id="8204334">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204354">test</span>&nbsp;<span class="op" id="8204359">:=</span>&nbsp;<span class="op" id="8204362">&amp;</span><span class="ident" id="8204363">serverTest</span><span class="op" id="8204373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204377">name</span><span class="op" id="8204381">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8204386">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="8204415">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204419">command</span><span class="op" id="8204426">:</span>&nbsp;<span class="op" id="8204428">[</span><span class="op" id="8204429">]</span><span class="builtintype" id="8204430">string</span><span class="op" id="8204436">{</span><span class="string" id="8204437">&#34;openssl&#34;</span><span class="op" id="8204446">,</span>&nbsp;<span class="string" id="8204448">&#34;s_client&#34;</span><span class="op" id="8204458">,</span>&nbsp;<span class="string" id="8204460">&#34;-no_ticket&#34;</span><span class="op" id="8204472">,</span>&nbsp;<span class="string" id="8204474">&#34;-cipher&#34;</span><span class="op" id="8204483">,</span>&nbsp;<span class="string" id="8204485">&#34;RC4-SHA&#34;</span><span class="op" id="8204494">}</span><span class="op" id="8204495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204499">config</span><span class="op" id="8204505">:</span>&nbsp;&nbsp;<span class="op" id="8204508">&amp;</span><span class="ident" id="8204509">config</span><span class="op" id="8204515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204521">runServerTestTLS12</span><span class="op" id="8204539">(</span><span class="ident" id="8204540">t</span><span class="op" id="8204541">,</span>&nbsp;<span class="ident" id="8204543">test</span><span class="op" id="8204547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204551">test</span>&nbsp;<span class="op" id="8204556">=</span>&nbsp;<span class="op" id="8204558">&amp;</span><span class="ident" id="8204559">serverTest</span><span class="op" id="8204569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204573">name</span><span class="op" id="8204577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8204592">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="8204621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204625">command</span><span class="op" id="8204632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204644">[</span><span class="op" id="8204645">]</span><span class="builtintype" id="8204646">string</span><span class="op" id="8204652">{</span><span class="string" id="8204653">&#34;openssl&#34;</span><span class="op" id="8204662">,</span>&nbsp;<span class="string" id="8204664">&#34;s_client&#34;</span><span class="op" id="8204674">,</span>&nbsp;<span class="string" id="8204676">&#34;-no_ticket&#34;</span><span class="op" id="8204688">,</span>&nbsp;<span class="string" id="8204690">&#34;-cipher&#34;</span><span class="op" id="8204699">,</span>&nbsp;<span class="string" id="8204701">&#34;RC4-SHA&#34;</span><span class="op" id="8204710">,</span>&nbsp;<span class="string" id="8204712">&#34;-cert&#34;</span><span class="op" id="8204719">,</span>&nbsp;<span class="ident" id="8204721">certPath</span><span class="op" id="8204729">,</span>&nbsp;<span class="string" id="8204731">&#34;-key&#34;</span><span class="op" id="8204737">,</span>&nbsp;<span class="ident" id="8204739">keyPath</span><span class="op" id="8204746">}</span><span class="op" id="8204747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204751">config</span><span class="op" id="8204757">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204770">&amp;</span><span class="ident" id="8204771">config</span><span class="op" id="8204777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204781">expectedPeerCerts</span><span class="op" id="8204798">:</span>&nbsp;<span class="op" id="8204800">[</span><span class="op" id="8204801">]</span><span class="builtintype" id="8204802">string</span><span class="op" id="8204808">{</span><span class="ident" id="8204809">clientCertificatePEM</span><span class="op" id="8204829">}</span><span class="op" id="8204830">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204836">runServerTestTLS12</span><span class="op" id="8204854">(</span><span class="ident" id="8204855">t</span><span class="op" id="8204856">,</span>&nbsp;<span class="ident" id="8204858">test</span><span class="op" id="8204862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204866">test</span>&nbsp;<span class="op" id="8204871">=</span>&nbsp;<span class="op" id="8204873">&amp;</span><span class="ident" id="8204874">serverTest</span><span class="op" id="8204884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204888">name</span><span class="op" id="8204892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8204907">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="8204941">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204945">command</span><span class="op" id="8204952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8204964">[</span><span class="op" id="8204965">]</span><span class="builtintype" id="8204966">string</span><span class="op" id="8204972">{</span><span class="string" id="8204973">&#34;openssl&#34;</span><span class="op" id="8204982">,</span>&nbsp;<span class="string" id="8204984">&#34;s_client&#34;</span><span class="op" id="8204994">,</span>&nbsp;<span class="string" id="8204996">&#34;-no_ticket&#34;</span><span class="op" id="8205008">,</span>&nbsp;<span class="string" id="8205010">&#34;-cipher&#34;</span><span class="op" id="8205019">,</span>&nbsp;<span class="string" id="8205021">&#34;RC4-SHA&#34;</span><span class="op" id="8205030">,</span>&nbsp;<span class="string" id="8205032">&#34;-cert&#34;</span><span class="op" id="8205039">,</span>&nbsp;<span class="ident" id="8205041">ecdsaCertPath</span><span class="op" id="8205054">,</span>&nbsp;<span class="string" id="8205056">&#34;-key&#34;</span><span class="op" id="8205062">,</span>&nbsp;<span class="ident" id="8205064">ecdsaKeyPath</span><span class="op" id="8205076">}</span><span class="op" id="8205077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205081">config</span><span class="op" id="8205087">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8205100">&amp;</span><span class="ident" id="8205101">config</span><span class="op" id="8205107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205111">expectedPeerCerts</span><span class="op" id="8205128">:</span>&nbsp;<span class="op" id="8205130">[</span><span class="op" id="8205131">]</span><span class="builtintype" id="8205132">string</span><span class="op" id="8205138">{</span><span class="ident" id="8205139">clientECDSACertificatePEM</span><span class="op" id="8205164">}</span><span class="op" id="8205165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205171">runServerTestTLS12</span><span class="op" id="8205189">(</span><span class="ident" id="8205190">t</span><span class="op" id="8205191">,</span>&nbsp;<span class="ident" id="8205193">test</span><span class="op" id="8205197">)</span><br>
<span class="lineno">830</span><span class="op" id="8205199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205202">func</span>&nbsp;<span class="ident" id="8205207">bigFromString</span><span class="op" id="8205220">(</span><span class="ident" id="8205221">s</span>&nbsp;<span class="builtintype" id="8205223">string</span><span class="op" id="8205229">)</span>&nbsp;<span class="op" id="8205231">*</span><span class="ident" id="8205232">big</span><span class="op" id="8205235">.</span><span class="ident" id="8205236">Int</span>&nbsp;<span class="op" id="8205240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205243">ret</span>&nbsp;<span class="op" id="8205247">:=</span>&nbsp;<span class="builtinfunc" id="8205250">new</span><span class="op" id="8205253">(</span><span class="ident" id="8205254">big</span><span class="op" id="8205257">.</span><span class="ident" id="8205258">Int</span><span class="op" id="8205261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205264">ret</span><span class="op" id="8205267">.</span><span class="ident" id="8205268">SetString</span><span class="op" id="8205277">(</span><span class="ident" id="8205278">s</span><span class="op" id="8205279">,</span>&nbsp;<span class="num" id="8205281">10</span><span class="op" id="8205283">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205286">return</span>&nbsp;<span class="ident" id="8205293">ret</span><br>
<span class="lineno"></span><span class="op" id="8205297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205300">func</span>&nbsp;<span class="ident" id="8205305">fromHex</span><span class="op" id="8205312">(</span><span class="ident" id="8205313">s</span>&nbsp;<span class="builtintype" id="8205315">string</span><span class="op" id="8205321">)</span>&nbsp;<span class="op" id="8205323">[</span><span class="op" id="8205324">]</span><span class="builtintype" id="8205325">byte</span>&nbsp;<span class="op" id="8205330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205333">b</span><span class="op" id="8205334">,</span>&nbsp;<span class="ident" id="8205336">_</span>&nbsp;<span class="op" id="8205338">:=</span>&nbsp;<span class="ident" id="8205341">hex</span><span class="op" id="8205344">.</span><span class="ident" id="8205345">DecodeString</span><span class="op" id="8205357">(</span><span class="ident" id="8205358">s</span><span class="op" id="8205359">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205362">return</span>&nbsp;<span class="ident" id="8205369">b</span><br>
<span class="lineno"></span><span class="op" id="8205371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205374">var</span>&nbsp;<span class="ident" id="8205378">testRSACertificate</span>&nbsp;<span class="op" id="8205397">=</span>&nbsp;<span class="ident" id="8205399">fromHex</span><span class="op" id="8205406">(</span><span class="string" id="8205407">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="8206793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="8206796">var</span>&nbsp;<span class="ident" id="8206800">testECDSACertificate</span>&nbsp;<span class="op" id="8206821">=</span>&nbsp;<span class="ident" id="8206823">fromHex</span><span class="op" id="8206830">(</span><span class="string" id="8206831">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="8207865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8207868">var</span>&nbsp;<span class="ident" id="8207872">testSNICertificate</span>&nbsp;<span class="op" id="8207891">=</span>&nbsp;<span class="ident" id="8207893">fromHex</span><span class="op" id="8207900">(</span><span class="string" id="8207901">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="8208907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8208910">var</span>&nbsp;<span class="ident" id="8208914">testRSAPrivateKey</span>&nbsp;<span class="op" id="8208932">=</span>&nbsp;<span class="op" id="8208934">&amp;</span><span class="ident" id="8208935">rsa</span><span class="op" id="8208938">.</span><span class="ident" id="8208939">PrivateKey</span><span class="op" id="8208949">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8208952">PublicKey</span><span class="op" id="8208961">:</span>&nbsp;<span class="ident" id="8208963">rsa</span><span class="op" id="8208966">.</span><span class="ident" id="8208967">PublicKey</span><span class="op" id="8208976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8208980">N</span><span class="op" id="8208981">:</span>&nbsp;<span class="ident" id="8208983">bigFromString</span><span class="op" id="8208996">(</span><span class="string" id="8208997">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="8209308">)</span><span class="op" id="8209309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8209313">E</span><span class="op" id="8209314">:</span>&nbsp;<span class="num" id="8209316">65537</span><span class="op" id="8209321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8209324">}</span><span class="op" id="8209325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8209328">D</span><span class="op" id="8209329">:</span>&nbsp;<span class="ident" id="8209331">bigFromString</span><span class="op" id="8209344">(</span><span class="string" id="8209345">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="8209655">)</span><span class="op" id="8209656">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8209659">Primes</span><span class="op" id="8209665">:</span>&nbsp;<span class="op" id="8209667">[</span><span class="op" id="8209668">]</span><span class="op" id="8209669">*</span><span class="ident" id="8209670">big</span><span class="op" id="8209673">.</span><span class="ident" id="8209674">Int</span><span class="op" id="8209677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8209681">bigFromString</span><span class="op" id="8209694">(</span><span class="string" id="8209695">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="8209852">)</span><span class="op" id="8209853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8209857">bigFromString</span><span class="op" id="8209870">(</span><span class="string" id="8209871">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="8210028">)</span><span class="op" id="8210029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8210032">}</span><span class="op" id="8210033">,</span><br>
<span class="lineno"></span><span class="op" id="8210035">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="8210038">var</span>&nbsp;<span class="ident" id="8210042">testECDSAPrivateKey</span>&nbsp;<span class="op" id="8210062">=</span>&nbsp;<span class="op" id="8210064">&amp;</span><span class="ident" id="8210065">ecdsa</span><span class="op" id="8210070">.</span><span class="ident" id="8210071">PrivateKey</span><span class="op" id="8210081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8210084">PublicKey</span><span class="op" id="8210093">:</span>&nbsp;<span class="ident" id="8210095">ecdsa</span><span class="op" id="8210100">.</span><span class="ident" id="8210101">PublicKey</span><span class="op" id="8210110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8210114">Curve</span><span class="op" id="8210119">:</span>&nbsp;<span class="ident" id="8210121">elliptic</span><span class="op" id="8210129">.</span><span class="ident" id="8210130">P521</span><span class="op" id="8210134">(</span><span class="op" id="8210135">)</span><span class="op" id="8210136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8210140">X</span><span class="op" id="8210141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210147">bigFromString</span><span class="op" id="8210160">(</span><span class="string" id="8210161">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="8210320">)</span><span class="op" id="8210321">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8210325">Y</span><span class="op" id="8210326">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210332">bigFromString</span><span class="op" id="8210345">(</span><span class="string" id="8210346">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="8210505">)</span><span class="op" id="8210506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8210509">}</span><span class="op" id="8210510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8210513">D</span><span class="op" id="8210514">:</span>&nbsp;<span class="ident" id="8210516">bigFromString</span><span class="op" id="8210529">(</span><span class="string" id="8210530">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="8210689">)</span><span class="op" id="8210690">,</span><br>
<span class="lineno"></span><span class="op" id="8210692">}</span>
</div>
</body>
</html>
